// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
/*
 MIT License <http://www.opensource.org/licenses/mit-license.php>
*/
(function(){function x(l,p,e){this.obj=l;this.right=this.left=null;this.parent=e;this.dimension=p}function A(l,p,e){function t(a,d,b){var q=d%e.length;if(0===a.length)return null;if(1===a.length)return new x(a[0],q,b);a.sort(function(k,h){return k[e[q]]-h[e[q]]});var c=Math.floor(a.length/2);b=new x(a[c],q,b);b.left=t(a.slice(0,c),d+1,b);b.right=t(a.slice(c+1),d+1,b);return b}function w(a){function d(b){b.left&&(b.left.parent=b,d(b.left));b.right&&(b.right.parent=b,d(b.right))}r.root=a;d(r.root)}
var r=this;Array.isArray(l)?this.root=t(l,0,null):w(l,p,e);this.toJSON=function(a){a||(a=this.root);var d=new x(a.obj,a.dimension,null);a.left&&(d.left=r.toJSON(a.left));a.right&&(d.right=r.toJSON(a.right));return d};this.insert=function(a){function d(k,h){if(null===k)return h;h=e[k.dimension];return a[h]<k.obj[h]?d(k.left,k):d(k.right,k)}var b=d(this.root,null);if(null===b)this.root=new x(a,0,null);else{var q=new x(a,(b.dimension+1)%e.length,b);var c=e[b.dimension];a[c]<b.obj[c]?b.left=q:b.right=
q}};this.remove=function(a){function d(c){if(null===c)return null;if(c.obj===a)return c;var k=e[c.dimension];return a[k]<c.obj[k]?d(c.left,c):d(c.right,c)}function b(c){function k(g,m){if(null===g)return null;var n=e[m];if(g.dimension===m)return null!==g.right?k(g.right,m):g;var y=g.obj[n];var u=k(g.left,m);m=k(g.right,m);null!==u&&u.obj[n]>y&&(g=u);null!==m&&m.obj[n]>g.obj[n]&&(g=m);return g}function h(g,m){if(null===g)return null;var n=e[m];if(g.dimension===m)return null!==g.left?h(g.left,m):g;
var y=g.obj[n];var u=h(g.left,m);m=h(g.right,m);null!==u&&u.obj[n]<y&&(g=u);null!==m&&m.obj[n]<g.obj[n]&&(g=m);return g}if(null===c.left&&null===c.right)if(null===c.parent)r.root=null;else{var f=e[c.parent.dimension];c.obj[f]<c.parent.obj[f]?c.parent.left=null:c.parent.right=null}else{f=null!==c.left?k(c.left,c.dimension):h(c.right,c.dimension);var v=f.obj;b(f);c.obj=v}}var q=d(r.root);null!==q&&b(q)};this.nearest=function(a,d,b,q){function c(f){var v=e[f.dimension];var g=p(a,f.obj),m={},n;for(n=
0;n<e.length;n+=1)m[e[n]]=n===f.dimension?a[e[n]]:f.obj[e[n]];m=p(m,f.obj);if(null===f.right&&null===f.left){if(h.size()<d||g<h.peek()[1])if(!b||b(f.obj))h.push([f,g]),h.size()>d&&h.pop()}else{v=null===f.right?f.left:null===f.left?f.right:a[v]<f.obj[v]?f.left:f.right;c(v);if(h.size()<d||g<h.peek()[1])if(!b||b(f.obj))h.push([f,g]),h.size()>d&&h.pop();if(h.size()<d||Math.abs(m)<h.peek()[1])f=v===f.left?f.right:f.left,null!==f&&c(f)}}var k;var h=new z(function(f){return-f[1]});if(q)for(k=0;k<d;k+=1)h.push([null,
q]);c(r.root);q=[];for(k=0;k<d&&k<h.content.length;k+=1)h.content[k][0]&&q.push([h.content[k][0].obj,h.content[k][1]]);return q};this.balanceFactor=function(){function a(b){return null===b?0:Math.max(a(b.left),a(b.right))+1}function d(b){return null===b?0:d(b.left)+d(b.right)+1}return a(r.root)/(Math.log(d(r.root))/Math.log(2))}}function z(l){this.content=[];this.scoreFunction=l}z.prototype={push:function(l){this.content.push(l);this.bubbleUp(this.content.length-1)},pop:function(){var l=this.content[0],
p=this.content.pop();0<this.content.length&&(this.content[0]=p,this.sinkDown(0));return l},peek:function(){return this.content[0]},remove:function(l){for(var p=this.content.length,e=0;e<p;e++)if(this.content[e]==l){var t=this.content.pop();e!=p-1&&(this.content[e]=t,this.scoreFunction(t)<this.scoreFunction(l)?this.bubbleUp(e):this.sinkDown(e));return}throw Error("Node not found.");},size:function(){return this.content.length},bubbleUp:function(l){for(var p=this.content[l];0<l;){var e=Math.floor((l+
1)/2)-1,t=this.content[e];if(this.scoreFunction(p)<this.scoreFunction(t))this.content[e]=p,this.content[l]=t,l=e;else break}},sinkDown:function(l){for(var p=this.content.length,e=this.content[l],t=this.scoreFunction(e);;){var w=2*(l+1),r=w-1,a=null;if(r<p){var d=this.scoreFunction(this.content[r]);d<t&&(a=r)}w<p&&this.scoreFunction(this.content[w])<(null==a?t:d)&&(a=w);if(null!=a)this.content[l]=this.content[a],this.content[a]=e,l=a;else break}}};this.kdTree=A;"undefined"!==typeof exports&&(exports.kdTree=
A,exports.BinaryHeap=z)})();