// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/IdentityManagerDialog","dojo/_base/kernel dojo/_base/declare dojo/_base/config dojo/_base/Deferred dojo/_base/lang dojo/has dojo/dom-attr dojo/keys dijit/registry dijit/Dialog ./kernel ./lang ./domUtils ./Credential ./IdentityManagerBase dojo/i18n!./nls/jsapi dojo/query dijit/form/Button dijit/form/Form dijit/form/ValidationTextBox".split(" "),function(k,p,w,B,C,D,q,E,l,t,r,u,m,F,G,H){p=p([G],{declaredClass:"esri.IdentityManager",_eventMap:{"dialog-cancel":["info"]},constructor:function(d){C.mixin(this,
d);this.registerConnectEvents()},_dialogContent:"\x3cdiv data-dojo-type\x3d'dijit.form.Form' data-dojo-props\x3d'\"class\":\"esriIdForm\"'\x3e\x3cdiv class\x3d'dijitDialogPaneContentArea'\x3e\x3cdiv style\x3d'padding-bottom: 5px; word-wrap: break-word;'\x3e${info}\x3c/div\x3e\x3cdiv style\x3d'margin: 0px; padding: 0px; height: 10px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriErrorMsg' style\x3d'display: none; color: white; background-color: #D46464; text-align: center; padding-top: 3px; padding-bottom: 3px;'\x3e${invalidUser}\x3c/div\x3e\x3cdiv style\x3d'margin: 0px; padding: 0px; height: 10px;'\x3e\x3c/div\x3e\x3ctable style\x3d'width: 100%;'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel\x3e${lblUser}\x3cbr/\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' data-dojo-props\x3d'type:\"text\", \"class\":\"esriIdUser\", required:true, trim:true, style:\"width: 100%;\", autocapitalize:\"none\", autocorrect:\"off\", spellcheck:false' /\x3e\x3c/label\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel\x3e${lblPwd}\x3cbr/\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' data-dojo-props\x3d'type:\"password\", \"class\":\"esriIdPwd\", required:true, style:\"width: 100%;\"' /\x3e\x3c/label\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitDialogPaneActionBar'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' data-dojo-props\x3d'type:\"button\", \"class\":\"esriIdSubmit\"'\x3e${lblOk}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' data-dojo-props\x3d'type:\"button\", \"class\":\"esriIdCancel\"'\x3e${lblCancel}\x3c/button\x3e\x3c/div\x3e\x3c/div\x3e",
onDialogCreate:function(){},onDialogCancel:function(){},signIn:function(d,e,a){this._nls||(this._nls=H.identity);this._loginDialog||(this._loginDialog=this.dialog=this._createLoginDialog(),this.onDialogCreate());var c=this._loginDialog,f=a&&a.error,n=a&&a.token,b=new B(function(){c.onCancel()});if(c.open)return d=Error("BUSY"),d.name="identity-manager:busy",d.code="IdentityManager.1",d.log=!!w.isDebug,b.errback(d),b;m.hide(c.errMsg_);f&&403==f.code&&n&&(q.set(c.errMsg_,"innerHTML",this._nls.forbidden),
m.show(c.errMsg_));c.dfd_=b;c.serverInfo_=e;c.resUrl_=d;c.admin_=a&&a.isAdmin;q.set(c.resLink_,{title:d,innerHTML:"("+(this.getResourceName(d)||this._nls.lblItem)+")"});q.set(c.serverLink_,{title:e.server,innerHTML:(-1!==e.server.toLowerCase().indexOf("arcgis.com")?"ArcGIS Online":e.server)+" "});c.txtPwd_.set("value","");c.show();return b},_createLoginDialog:function(){var d=this._nls,e=u.substitute(d,this._dialogContent);e=u.substitute({resource:"\x3cspan class\x3d'resLink' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e",
server:"\x3cspan class\x3d'serverLink' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e"},e);var a=new t({title:d.title,content:e,"class":"esriSignInDialog",style:"width: 18em;",esriIdMgr_:this,keypressed_:function(c){c.charOrCode===E.ENTER&&this.execute_()},execute_:function(){var c=this.txtUser_.get("value"),f=this.txtPwd_.get("value"),n=this.dfd_,b=this;if(this.form_.validate()&&c&&f){this.btnSubmit_.set("label",d.lblSigning);var v=r.id.findCredential(b.resUrl_,c),A=function(g){b.btnSubmit_.set("label",
d.lblOk);b.btnSubmit_.set("disabled",!1);m.hide(b.errMsg_);b.hide();t._DialogLevelManager.hide(b);var I=b.serverInfo_;b.dfd_=b.serverInfo_=b.generateDfd_=b.resUrl_=null;var h=v;if(g){var x=g.token;var y=u.isDefined(g.expires)?Number(g.expires):null;var z=!!g.ssl;h?(h.userId=c,h.token=x,h.expires=y,h.validity=g.validity,h.ssl=z,h.creationTime=(new Date).getTime()):h=new F({userId:c,server:I.server,token:x,expires:y,ssl:z,isAdmin:b.admin_,validity:g.validity})}n.callback(h)};v&&!v._enqueued?A():(b.btnSubmit_.set("disabled",
!0),b.generateDfd_=r.id.generateToken(this.serverInfo_,{username:c,password:f},{isAdmin:this.admin_}).addCallback(A).addErrback(function(g){b.btnSubmit_.set("disabled",!1);b.generateDfd_=null;b.btnSubmit_.set("label",d.lblOk);q.set(b.errMsg_,"innerHTML",g&&g.code?d.invalidUser:d.noAuthService);m.show(b.errMsg_)}))}},cancel_:function(){a.generateDfd_&&a.generateDfd_.cancel();var c=a.dfd_,f=a.resUrl_,n=a.serverInfo_;a.btnSubmit_.set("disabled",!1);a.dfd_=a.serverInfo_=a.generateDfd_=a.resUrl_=null;
m.hide(a.errMsg_);t._DialogLevelManager.hide(a);a.esriIdMgr_.onDialogCancel({resourceUrl:f,serverInfo:n});f=Error("ABORTED");f.name="identity-manager:user-aborted";f.code="IdentityManager.2";f.log=!!w.isDebug;c.errback(f)}});e=a.domNode;a.form_=l.byNode(k.query(".esriIdForm",e)[0]);a.txtUser_=l.byNode(k.query(".esriIdUser",e)[0]);a.txtPwd_=l.byNode(k.query(".esriIdPwd",e)[0]);a.btnSubmit_=l.byNode(k.query(".esriIdSubmit",e)[0]);a.btnCancel_=l.byNode(k.query(".esriIdCancel",e)[0]);a.resLink_=k.query(".resLink",
e)[0];a.serverLink_=k.query(".serverLink",e)[0];a.errMsg_=k.query(".esriErrorMsg",e)[0];a.connect(a.txtUser_,"onKeyPress",a.keypressed_);a.connect(a.txtPwd_,"onKeyPress",a.keypressed_);a.connect(a.btnSubmit_,"onClick",a.execute_);a.connect(a.btnCancel_,"onClick",a.onCancel);a.connect(a,"onCancel",a.cancel_);return a}});D("extend-esri")&&(r.IdentityManagerDialog=r.IdentityManager=p);return p});