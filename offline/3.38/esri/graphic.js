// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/graphic","dojo/_base/declare dojo/_base/lang dojo/has ./kernel ./domUtils ./lang ./InfoTemplate ./geometry/jsonUtils ./symbols/jsonUtils".split(" "),function(g,k,B,C,w,x,D,E,F){function y(){}g=g(null,{declaredClass:"esri.Graphic",constructor:function(a,b,c,d){this._construct();a&&!a.declaredClass?(this.geometry=a.geometry?E.fromJson(a.geometry):null,this.symbol=a.symbol?F.fromJson(a.symbol):null,this.attributes=a.attributes||null,this.infoTemplate=a.infoTemplate?new D(a.infoTemplate):
null):(this.geometry=a,this.symbol=b,this.attributes=c,this.infoTemplate=d)},_geomVersion:0,_resolution:null,_shape:null,_bgShape:null,_dataAttrs:null,_layer:null,_sourceLayer:null,_graphicsLayer:null,_parentGraphic:null,_suspended:!1,size:null,visible:!0,_aggregationSourceLayer:null,_aggregationInfo:null,_computedAttributes:null,_computedVersion:null,_computedGeomVersion:null,_isSnapTarget:!0,getParentGraphic:function(){return this._parentGraphic},setParentGraphic:function(a){this._parentGraphic=
a},setSize:function(a){this.size=a;return this},getAggregationSourceLayer:function(){return this._aggregationSourceLayer},setAggregationSourceLayer:function(a){this._aggregationSourceLayer=a;return this},isAggregate:function(){return!!this._aggregationInfo},getAggregationInfo:function(){return this._aggregationInfo},setAggregationInfo:function(a){this._aggregationInfo=a;return this},getChildGraphics:function(){var a=this.getAggregationSourceLayer();return a?a.getChildGraphics(this):[]},getDojoShape:function(){return this._shape},
getShapes:function(){var a=[];this._shape&&a.push(this._shape);this._bgShape&&a.push(this._bgShape);return a},getNode:function(){var a=this._shape&&this._shape.getNode();return a&&a.nodeType?a:null},getNodes:function(){var a=this.getShapes(),b,c,d=a.length,f=[];for(c=0;c<d;c++)(b=a[c]&&a[c].getNode())&&b.nodeType&&f.push(b);return f},getLayer:function(){return this._layer},getSourceLayer:function(){return this._sourceLayer||this._layer},clone:function(){var a=new this.constructor(this.toJson());a.visible=
this.visible;a._layer=this._layer;a._sourceLayer=this._sourceLayer;a._aggregationSourceLayer=this._aggregationSourceLayer;a._aggregationInfo=this._aggregationInfo;a._resolution=this._resolution;return a},draw:function(){var a=this._graphicsLayer;a&&a._draw(this,!0);return this},setGeometry:function(a){this.geometry=a;this._geomVersion++;var b=this._graphicsLayer;b&&(b._updateExtent(this),this.draw(),a&&"polyline"===a.type&&b._updateSVGMarkers());return this},setResolution:function(a){this._resolution=
a;return this},getResolution:function(){return this._resolution},setSymbol:function(a,b){var c=this._graphicsLayer,d=this._shape;this.symbol=a;c&&(b&&d&&c._removeShape(this),this.draw());return this},setAttributes:function(a){this.attributes=a;this.clearCache();return this},setInfoTemplate:function(a){this.infoTemplate=a;return this},getInfoTemplate:function(){return this._getEffInfoTemplate()},_getEffInfoTemplate:function(){var a=this.getLayer();return this.infoTemplate||a&&a.infoTemplate},getTitle:function(){var a=
this.getInfoTemplate(),b=a&&a.title;if(k.isFunction(b))b=b.call(a,this);else if(k.isString(b)){var c=(a=this.getLayer())&&a._getDateOpts;b=x.substitute(this.attributes,b,{first:!0,dateFormat:c&&c.call(a)})}return b},getContent:function(){var a=this.getInfoTemplate(),b=a&&a.content;if(k.isFunction(b))b=b.call(a,this);else if(k.isString(b)){var c=(a=this.getLayer())&&a._getDateOpts;b=x.substitute(this.attributes,b,{dateFormat:c&&c.call(a)})}return b},attr:function(a,b){null==b||this._dataAttrs||(this._dataAttrs=
{});this._dataAttrs&&(this._dataAttrs[a]=b,this._setDataAttr(a,b));return this},_isSuspended:function(){return this._suspended},_suspend:function(){this._suspended=!0;this.draw()},_resume:function(){this._suspended=!1;this.draw()},show:function(){this.visible=!0;this.attr("data-hidden");var a;if(this.getShapes().length){var b=this.getNodes();var c=b.length;for(a=0;a<c;a++)w.show(b[a])}else this.draw();(b=this._graphicsLayer)&&b._graphicVisibilityChanged(this);return this},hide:function(){this.visible=
!1;this.attr("data-hidden","");var a=this._graphicsLayer,b,c;if(a){if("canvas-2d"===a.surfaceType)a._removeShape(this);else{var d=this.getNodes();if(c=d.length)for(b=0;b<c;b++)w.hide(d[b])}a._graphicVisibilityChanged(this)}return this},toJson:function(){var a={};this.geometry&&(a.geometry=this.geometry.toJson());this.attributes&&(a.attributes=k.mixin({},this.attributes));this.symbol&&(a.symbol=this.symbol.toJson());this.infoTemplate&&(a.infoTemplate=this.infoTemplate.toJson());return a},_setDataAttr:function(a,
b){var c=this.getNodes(),d,f=c.length;for(d=0;d<f;d++)this._setDOMDataAttr(c[d],a,b)},_setDOMDataAttr:function(a,b,c){null==c?a.removeAttribute(b):a.setAttribute(b,c)},_applyDataAttrs:function(){var a=this._dataAttrs;if(a){var b=this.getNodes(),c,d=b.length;for(c=0;c<d;c++)for(var f in a)this._setDOMDataAttr(b[c],f,a[f])}},_getViewInfo:function(a){return(a=(a=a||this.getLayer())&&a.getMap())&&a.getViewInfo()},evaluateExpression:function(a,b){return this._getDataValue(a._attributeDef,a._attributeCache,
null,null,a,b)},_getDataValue:function(a,b,c,d,f,l){var h=b.id,m=this.attributes,t=a.field,n=b.isNumeric,e=null;if(h){var p=this._computedAttributes,q=this._computedVersion,r=this._computedGeomVersion;d=this._getViewInfo(d);var z=!(!f||!f.async),A=l&&l.skipCache||z,G=!l||!1!==l.strictReturnType,u=b.dependsOnView||b.isJSFunc,v=b.dependsOnGeometry;p||(p=this._computedAttributes={});u&&!q&&(q=this._computedVersion={});v&&!r&&(r=this._computedGeomVersion={});var H=u&&q[h]!==d.version||v&&r[h]!==this._geomVersion;
e=p[h];if(void 0===e||H||A)e=null,b.hasExpr?e=f?f.evaluate(l&&l.context):c.executeFunction(b.compiledFunc,c.createExecContext(this,d)):b.isJSFunc?e=t(this,a):m&&(e=m[t],n&&this._isValidNumber(e)&&(b=a.normalizationType||"field",c=e,e=null,f=a.normalizationTotal,a=m[a.normalizationField],"log"===b&&0!==c?e=Math.log(c)*Math.LOG10E:"percent-of-total"===b&&this._isValidNumber(f)&&0!==f?e=c/f*100:"field"===b&&this._isValidNumber(a)&&0!==a&&(e=c/a))),G&&(z?n&&(this._construct(),e=e.then(this._sanitizeNumericValue)):
e=this._sanitizeValue(e,n)),A||(p[h]=e,u&&(q[h]=d.version),v&&(r[h]=this._geomVersion))}else m&&(e=this._sanitizeValue(m[t],n));return e},_sanitizeValue:function(a,b){b&&!this._isValidNumber(a)&&(a=null);return a},_sanitizeNumericValue:function(a){return this._sanitizeValue(a,!0)},_construct:function(){this._constructed||(this._sanitizeNumericValue=k.hitch(this,this._sanitizeNumericValue),this._constructed=!0)},_isValidNumber:function(a){return"number"===typeof a&&!isNaN(a)&&Infinity!==a&&-Infinity!==
a},clearCache:function(a){if(null!=a){var b=this._computedAttributes,c=this._computedVersion,d=this._computedGeomVersion;b&&(b[a]=void 0);c&&(c[a]=void 0);d&&(d[a]=void 0)}else this._computedAttributes=this._computedVersion=this._computedGeomVersion=null}});g.prototype.getShape=g.prototype.getDojoShape;y.prototype=g.prototype;g.simpleConstructor=y;B("extend-esri")&&(C.Graphic=g);return g});