// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/toolbars/_GraphicMover","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(m,n,g,p,q,w,x,r,t,y,u,v,z,A){var k=m(null,{declaredClass:"esri.toolbars._GraphicMover",constructor:function(b,a,d,c){this.graphic=b;this.map=a;this.toolbar=d;this.tempPt=c;this._enableGraphicMover();
this._moved=!1},refresh:function(b){var a=this.graphic.getDojoShape();!a||!b&&a._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var b=this.graphic,a=b.getDojoShape();a&&(a._hostGraphic=b,this._moveable=new w(a,{mover:k.Mover}),this._moveStartHandle=g.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=g.connect(this._moveable,
"onFirstMove",this,this._firstMoveHandler),this._movingHandle=g.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=g.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(b=a.getEventSource())&&q.set(b,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var b=this._moveable;if(b){g.disconnect(this._moveStartHandle);g.disconnect(this._firstMoveHandle);g.disconnect(this._movingHandle);g.disconnect(this._moveStopHandle);var a=b.shape;a&&(a._hostGraphic=
null,(a=a.getEventSource())&&q.set(a,"cursor","inherit"));b.destroy()}this._moveable=null},_moveStartHandler:function(){var b=this.graphic,a=this.map;this._startTx=b.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&a.snappingManager&&a.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(b)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},_movingHandler:function(b,a,d){b=b.shape.getTransform();a=this.map;
var c;u("esri-pointer")?c=a.navigationManager.pointerEvents._processTouchEvent(d,d):d&&"pointermove"===d.type&&(c=y.prototype._processTouchEvent.call({map:a},d,d));c&&a.snappingManager&&a.snappingManager._onSnappingMouseMoveHandler(c);this.tempPt&&this.tempPt.getDojoShape().setTransform(b);this.toolbar.onGraphicMove(this.graphic,b)},_moveStopHandler:function(b){var a=this.graphic,d=this.toolbar,c=this.map,e=d._geo?v.geographicToWebMercator(a.geometry):a.geometry,f=e.type,l=a.getDojoShape(),h=l.getTransform();
if(p.toJson(h)!==p.toJson(this._startTx)){this._moved=!0;switch(f){case "point":f=[h,r.invert(this._startTx)];if(c.snappingManager)var B=c.snappingManager._snappingPoint;e=B||c.toMap(r.multiplyPoint(f,c.toScreen(e,!0)));c.snappingManager&&c.snappingManager._killOffSnapping();break;case "polyline":e=this._updatePolyGeometry(e,e.paths,h);break;case "polygon":e=this._updatePolyGeometry(e,e.rings,h)}l.setTransform(null);a.setGeometry(d._geo?v.webMercatorToGeographic(e,!0):e);this.tempPt&&this.tempPt.setGeometry(new A(a.geometry.toJson()))}else this._moved=
!1;d._endOperation("MOVE");d.onGraphicMoveStop(a,h);this._moved||(b=b.__e,c=this.map.position,b=new z(b.pageX-c.x,b.pageY-c.y),d.onGraphicClick(a,{screenPoint:b,mapPoint:this.map.toMap(b)}))},_updatePolyGeometry:function(b,a,d){var c=this.map,e=b.getPoint(0,0);c=c.toMap(c.toScreen(e).offset(d.dx,d.dy));d=c.x-e.x;e=c.y-e.y;var f;for(c=0;c<a.length;c++){var l=a[c];for(f=0;f<l.length;f++){var h=b.getPoint(c,f);b.setPoint(c,f,h.offset(d,e))}}return b}});k.Mover=m(x,{declaredClass:"esri.toolbars._Mover",
constructor:function(b,a,d){this.__e=a}});u("extend-esri")&&(n.setObject("toolbars._GraphicMover",k,t),n.setObject("toolbars._Mover",k.Mover,t));return k});