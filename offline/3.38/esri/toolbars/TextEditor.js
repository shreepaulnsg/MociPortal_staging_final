// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/toolbars/TextEditor","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),function(g,h,d,n,p,q,r,k,m,t){g=g(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(a,b,c){this._graphic=a;this._map=b;this._toolbar=c;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(a){this._editBox?(d.disconnect(this._addEditBoxHandler),
this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=d.connect(a.getLayer(),"onDblClick",this,function(b){this._map.navigationManager.setImmediateClick(!1);b.graphic==a&&(n.stop(b),d.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,this._addTextBox(a))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(d.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);
this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(a,b){if(!this._editBox){if(!a.symbol.text){a.symbol.text="Tempt text";a.setSymbol(a.symbol);var c=""}var e=this._createInputTextStyle(a,this._map);""!==c&&(c=b||a.symbol.text);this._editBox=q.create("input",{type:"text",value:c});k.set(this._editBox,e);r.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=d.connect(this._editBox,"onkeyup",h.hitch(this,
function(f){f.keyCode!=m.ENTER&&f.keyCode!==m.TAB||this._disable()}));this._editBoxBlurHandler=d.connect(this._editBox,"onblur",h.hitch(this,function(f){this._disable()}));a.symbol.text="";a.setSymbol(a.symbol);a.hide();var l=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",h.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(f){k.set(l,{left:this._editBoxLeft+f.delta.x+"px",top:this._editBoxTop+f.delta.y+"px"})});this._moveBoxStartHandler=
this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(k.get(l,"left"));this._editBoxTop=parseFloat(k.get(l,"top"))});this.onEditStart(a,this._editBox);this._toolbar.onTextEditStart(a,this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(d.disconnect(this._editBoxBlurHandler),this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=
null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&(d.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(a,b){b=a.getDojoShape().getTransformedBoundingBox();var c=a.getLayer();c=c.hasLocalNavigationTransform()?{dx:0,dy:0}:c.getNavigationTransform();var e=a.symbol.font;return{"font-family":e.family,
"font-size":e.size+"px","font-style":e.style,"font-variant":e.variant,"font-weight":e.weight,left:b[0].x+c.dx+"px",top:b[0].y+c.dy+"px",width:Math.abs(b[0].x-b[1].x)/Math.cos(a.symbol.angle/180*Math.PI)+"px"}},_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var a=this._graphic.symbol;a.text=this._editBox.value;this._graphic.setSymbol(a)}else this._graphic.getLayer().remove(this._graphic)}});p("extend-esri")&&h.setObject("toolbars.TextEditor",g,t);return g});