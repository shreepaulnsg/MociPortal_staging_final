// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/renderers/BlendRenderer","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/has ../kernel ../Color ./Renderer".split(" "),function(g,l,h,p,q,r,m,t){g=g(t,{declaredClass:"esri.renderer.BlendRenderer",constructor:function(a){l.mixin(this,a);this.blendMode=this.blendMode||"source-over";(this._supportsCanvas=window.CanvasRenderingContext2D?!0:!1)||console.log("BlendRenderer requires a Canvas enabled Browser. Internet Explorer versions 8 and earlier do not support Canvas.");
this._updateCache()},setFields:function(a){this.fields=a;this._updateCache()},setSymbol:function(a){this.symbol=a},setBlendMode:function(a){this.blendMode=a},setOpacityStops:function(a){this.opacityStops=a;this._updateCache()},setNormalizationField:function(a){this.normalizationField=a;this._updateCache()},toJson:function(){},getSymbol:function(a){var b=this._dataCache,c=this._opacityInfos;if(this._supportsCanvas&&b&&c){var d,e,f=[],k={};h.forEach(this.fields,function(u,n){this._getColorComponent(a,
c[n],b[n],!0,k);e=u.color.toRgba();e[3]=k.value||0;d=new m(e);d._data=k.data;f.push(d)},this);f.sort(this._colorSorter);this.symbol.setColor(this._getBlendedColor(f));return this.symbol}},_colorSorter:function(a,b){var c=null!=a._data,d=null!=b._data;return c&&d?a._data-b._data:c?1:d?-1:0},_getBlendedColor:function(a){var b=this._canvas;b||(b=this._canvas=this._createCanvas(1,1));var c=b.getContext("2d");c.globalCompositeOperation=this.blendMode;h.forEach(a,function(d){c.fillStyle=d.toCss(!0);c.fillRect(0,
0,1,1)});a=c.getImageData(0,0,1,1).data;c.clearRect(0,0,b.width,b.height);return new m([a[0],a[1],a[2],a[3]/255])},_createCanvas:function(a,b){return p.create("canvas",{width:a+"px",height:b+"px",style:"position: absolute; left: -10000px; top: 0px;"},document.body)},_updateCache:function(){var a=this.fields,b=this.opacityStops;this._dataCache=this._opacityInfos=null;if(a&&b){var c=this._dataCache=[],d=this._opacityInfos=[],e;h.forEach(a,function(f){e={field:f.field,normalizationField:this.normalizationField,
stops:b};d.push(e);c.push(this._processOpacityInfo(e))},this)}}});q("extend-esri")&&l.setObject("renderer.BlendRenderer",g,r);return g});