// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/renderers/UniqueValueRenderer","dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../lang ../symbols/jsonUtils ./Renderer ../support/expressionUtils".split(" "),function(k,g,e,m,n,p,l,q,r){k=k(q,{declaredClass:"esri.renderer.UniqueValueRenderer",constructor:function(b,a,c,d,f,h){this.values=[];this._symbols={};this.infos=[];b&&!b.declaredClass?(a=b,c=h&&h.geometryType,this.defaultSymbol=(b=a.defaultSymbol)&&(b.declaredClass?b:l.fromJson(b,h)),this.attributeField=
a.field1,this.attributeField2=a.field2,this.attributeField3=a.field3,this.fieldDelimiter=a.fieldDelimiter,this.defaultLabel=a.defaultLabel,this.setValueExpression(a.valueExpression),this.valueExpressionTitle=a.valueExpressionTitle,this.legendOptions=a.legendOptions,a.backgroundFillSymbol&&(this.backgroundFillSymbol=l.fromJson(a.backgroundFillSymbol,c?{geometryType:"esriGeometryPolygon"}:null)),"esriGeometryPolygon"===c&&this.hasVisualVariables("sizeInfo",!1)&&(h={geometryType:"esriGeometryPoint"}),
g.forEach(a.uniqueValueInfos,function(t){this._addValueInfo(t,h)},this)):(this.defaultSymbol=b,this.attributeField=a,this.attributeField2=c,this.attributeField3=d,this.fieldDelimiter=f);this._multiple=!!this.attributeField2},addValue:function(b,a){b=e.isObject(b)?b:{value:b,symbol:a};this._addValueInfo(b)},removeValue:function(b){var a=g.indexOf(this.values,b);-1!==a&&(this.values.splice(a,1),this._hasNullKeyword=this._evalNullKeyword(this.values),delete this._symbols[b],this.infos.splice(a,1))},
getUniqueValueInfo:function(b){var a=this.attributeField,c=b.attributes;if(this.valueExpression)a=this._getDataValue(b,this._uvInfo,null,this._cache.uvInfo),a=this._normalizeNullValue(a);else if(this._multiple){b=this.attributeField2;var d=this.attributeField3,f=[];a&&f.push(this._normalizeNullValue(c[a]));b&&f.push(this._normalizeNullValue(c[b]));d&&f.push(this._normalizeNullValue(c[d]));a=f.join(this.fieldDelimiter||"")}else a=e.isFunction(a)?a(b):c[a],a=this._normalizeNullValue(a);return this._symbols[a]},
setValueExpression:function(b){this.valueExpression=b;this._uvInfo={valueExpression:b};this._cache.uvInfo=this._createCache(this._uvInfo,!0)},getFieldsUsedInExpressions:function(b){var a=this.inherited(arguments);this.valueExpression&&(a=a.concat(r.extractFieldNames(this.valueExpression,b)));a.sort();return g.filter(a,function(c,d){return 0===d||a[d-1]!==c})},getSymbol:function(b){return(b=this.getUniqueValueInfo(b))&&b.symbol||this.defaultSymbol},_addValueInfo:function(b,a){var c=b.value;this.values.push(c);
this._hasNullKeyword=this._evalNullKeyword(this.values);this.infos.push(b);var d=b.symbol;d&&!d.declaredClass&&(b.symbol=l.fromJson(d,a));this._symbols[c]=b},_nullCode:"\x3cNull\x3e",_normalizeNullValue:function(b){return this._hasNullKeyword&&null==b?this._nullCode:b},_evalNullKeyword:function(b){var a=this.fieldDelimiter||"",c=new RegExp("(^|"+a+")("+this._nullCode+")("+a+"|$)");return g.some(b,function(d){return c.test(d)})},toJson:function(){var b=p.fixJson;var a={type:"uniqueValue",field1:this.attributeField,
field2:this.attributeField2,field3:this.attributeField3,fieldDelimiter:this.fieldDelimiter,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:e.clone(this.legendOptions),defaultSymbol:this.defaultSymbol&&this.defaultSymbol.toJson(),defaultLabel:this.defaultLabel,uniqueValueInfos:g.map(this.infos||[],function(c){c=e.mixin({},c);c.symbol=c.symbol&&c.symbol.toJson();c.value+="";return b(c)})};this.backgroundFillSymbol&&(a.backgroundFillSymbol=this.backgroundFillSymbol.toJson());
a=e.mixin(this.inherited(arguments),a);return b(a)}});m("extend-esri")&&e.setObject("renderer.UniqueValueRenderer",k,n);return k});