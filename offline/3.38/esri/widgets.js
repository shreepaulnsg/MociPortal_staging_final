// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],function(G,u,r,n,m){G=G([m],{declaredClass:"esri.toolbars._Toolbar",constructor:function(k){this.map=k},_cursors:{move:"pointer","move-v":"pointer","move-gv":"pointer",box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(k,d,a,b){var e=this.map;
k&&(this._mapNavState={isDoubleClickZoom:e.isDoubleClickZoom,isClickRecenter:e.isClickRecenter,isPan:e.isPan,isRubberBandZoom:e.isRubberBandZoom,isKeyboardNavigation:e.isKeyboardNavigation,isScrollWheelZoom:e.isScrollWheelZoom},e.disableDoubleClickZoom(),e.disableClickRecenter(),e.disablePan(),e.disableRubberBandZoom(),e.disableKeyboardNavigation());d&&e.hideZoomSlider();a&&e.hidePanArrows();b&&e.graphics.disableMouseEvents()},_activateMapTools:function(k,d,a,b){var e=this.map,g=this._mapNavState;
k&&g&&(g.isDoubleClickZoom&&e.enableDoubleClickZoom(),g.isClickRecenter&&e.enableClickRecenter(),g.isPan&&e.enablePan(),g.isRubberBandZoom&&e.enableRubberBandZoom(),g.isKeyboardNavigation&&e.enableKeyboardNavigation(),g.isScrollWheelZoom&&e.enableScrollWheelZoom());d&&e.showZoomSlider();a&&e.showPanArrows();b&&e.graphics.enableMouseEvents()},_deactivateScrollWheel:function(){var k=this.map;this._scrollWheelState={isScrollWheelZoom:k.isScrollWheelZoom,isScrollWheelPan:k.isScrollWheelPan};k.disableScrollWheelZoom();
k.disableScrollWheelPan()},_activateScrollWheel:function(){var k=this.map,d=this._scrollWheelState;d&&(d.isScrollWheelZoom&&k.enableScrollWheelZoom(),d.isScrollWheelPan&&k.enableScrollWheelPan())}});r("extend-esri")&&u.setObject("toolbars._Toolbar",G,n);return G})},"esri/toolbars/draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/window dojo/has dojo/sniff dojo/keys dojo/dom-construct dojo/dom-style dojo/dom-geometry ../kernel ../sniff ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/jsonUtils ../geometry/webMercatorUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/Rect dojo/i18n!../nls/jsapi".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z,E,J,D){var L=G(l,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(C,N){this.markerSymbol=new q(q.STYLE_SOLID,10,new t(t.STYLE_SOLID,new m([255,0,0]),2),new m([0,0,0,.25]));this.lineSymbol=new t(t.STYLE_SOLID,new m([255,0,0]),2);this.fillSymbol=new v(v.STYLE_SOLID,new t(t.STYLE_SOLID,new m([255,0,0]),2),new m([0,0,0,.25]));this._points=[];this._mouse=!d("esri-touch")&&!d("esri-pointer");
this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15};this._options=u.mixin(u.mixin({},this._defaultOptions),N||{});if(a("ios")||a("android"))this._options.showTooltips=!1;this._onKeyDownHandler=u.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=u.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=u.hitch(this,this._onMouseUpHandler);this._onClickHandler=u.hitch(this,this._onClickHandler);this._onMouseMoveHandler=u.hitch(this,this._onMouseMoveHandler);
this._onMouseDragHandler=u.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=u.hitch(this,this._onDblClickHandler);this._updateTooltip=u.hitch(this,this._updateTooltip);this._hideTooltip=u.hitch(this,this._hideTooltip);this._redrawGraphic=u.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(C){this.respectDrawingVertexOrder=C},setMarkerSymbol:function(C){this.markerSymbol=C},setLineSymbol:function(C){this.lineSymbol=C},
setFillSymbol:function(C){this.fillSymbol=C},activate:function(C,N){this._geometryType&&this.deactivate();var S=this.map,F=n.connect,T=L;this._options=u.mixin(u.mixin({},this._options),N||{});S.navigationManager.setImmediateClick(!1);switch(C){case T.ARROW:case T.LEFT_ARROW:case T.RIGHT_ARROW:case T.UP_ARROW:case T.DOWN_ARROW:case T.TRIANGLE:case T.CIRCLE:case T.ELLIPSE:case T.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0);this._onClickHandler_connect=F(S,"onClick",this._onClickHandler);this._mouse?
(this._onMouseDownHandler_connect=F(S,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=F(S,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=F(S,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=F(S,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=F(S,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=F(S,"onMouseDragEnd",this._onMouseUpHandler));d("esri-touch")&&(this._onMouseDownHandler2_connect=
F(S,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=F(S,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=F(S,"onSwipeEnd",this._onMouseUpHandler));break;case T.POINT:this._onClickHandler_connect=F(S,"onClick",this._onClickHandler);break;case T.LINE:case T.EXTENT:case T.FREEHAND_POLYLINE:case T.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0);this._mouse?(this._onMouseDownHandler_connect=F(S,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=
F(S,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=F(S,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=F(S,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=F(S,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=F(S,"onMouseDragEnd",this._onMouseUpHandler));d("esri-touch")&&(this._onMouseDownHandler2_connect=F(S,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=F(S,"onSwipeMove",
this._onMouseDragHandler),this._onMouseUpHandler2_connect=F(S,"onSwipeEnd",this._onMouseUpHandler));break;case T.POLYLINE:case T.POLYGON:case T.MULTI_POINT:S.navigationManager.setImmediateClick(!0);this._onClickHandler_connect=F(S,"onClick",this._onClickHandler);this._onDblClickHandler_connect=F(S,"onDblClick",this._onDblClickHandler);this._dblClickZoom=S.isDoubleClickZoom;S.disableDoubleClickZoom();break;default:console.error("Unsupported geometry type: "+C);return}this._onKeyDown_connect=F(S,"onKeyDown",
this._onKeyDownHandler);this._redrawConnect=F(S,"onExtentChange",this._redrawGraphic);this._geometryType=C;this._toggleTooltip(!0);S.snappingManager&&"freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType&&(S.snappingManager._startSelectionLayerQuery(),S.snappingManager._setUpSnapping());this.onActivate(this._geometryType)},deactivate:function(){var C=this.map;this._clear();var N=n.disconnect;N(this._onMouseMoveHandler_connect);N(this._onMouseDownHandler_connect);N(this._onMouseDragHandler_connect);
N(this._onMouseUpHandler_connect);N(this._onMouseDownHandler2_connect);N(this._onMouseDragHandler2_connect);N(this._onMouseUpHandler2_connect);N(this._onClickHandler_connect);N(this._onDblClickHandler_connect);N(this._onKeyDown_connect);N(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=this._onMouseUpHandler2_connect=this._onClickHandler_connect=
this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;C.snappingManager&&(C.snappingManager._stopSelectionLayerQuery(),C.snappingManager._killOffSnapping());switch(this._geometryType){case L.CIRCLE:case L.ELLIPSE:case L.TRIANGLE:case L.ARROW:case L.LEFT_ARROW:case L.RIGHT_ARROW:case L.UP_ARROW:case L.DOWN_ARROW:case L.RECTANGLE:case L.LINE:case L.EXTENT:case L.FREEHAND_POLYLINE:case L.FREEHAND_POLYGON:this._activateMapTools(!0,!1,!1,!0);break;case L.POLYLINE:case L.POLYGON:case L.MULTI_POINT:this._dblClickZoom&&
C.enableDoubleClickZoom()}N=this._geometryType;this._geometryType=null;C.navigationManager.setImmediateClick(!1);this._toggleTooltip(!1);this.onDeactivate(N)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0);this._graphic=null;this.map.snappingManager&&this.map.snappingManager._setGraphic(null);this._points=[]},finishDrawing:function(){var C=this._points,N=this.map.spatialReference,S=L;C=C.slice(0,C.length);switch(this._geometryType){case S.POLYLINE:if(!this._graphic||2>
C.length)return;var F=new A(N);F.addPath([].concat(C));break;case S.POLYGON:if(!this._graphic||3>C.length)return;F=new z(N);C=[].concat(C,[C[0].offset(0,0)]);z.prototype.isClockwise(C)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),C.reverse());F.addRing(C);break;case S.MULTI_POINT:F=new E(N),r.forEach(C,function(T){F.addPoint(T)})}n.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);
this._drawEnd(F)},_drawEnd:function(C){if(C){var N=this.map.spatialReference,S;this.onDrawEnd(C);N&&(N.isWebMercator()?S=H.webMercatorToGeographic(C,!0):4326===N.wkid&&(S=x.fromJson(C.toJson())));this.onDrawComplete({geometry:C,geographicGeometry:S})}},_normalizeRect:function(C,N,S){var F=C.x;C=C.y;var T=N.x;N=N.y;return{x:Math.min(F,T),y:Math.max(C,N),width:Math.abs(F-T),height:Math.abs(C-N),spatialReference:S}},_onMouseDownHandler:function(C){this._dragged=!1;if(this.map.snappingManager)var N=this.map.snappingManager._snappingPoint;
var S=N||C.mapPoint,F=L;N=this.map;var T=N.spatialReference;this._points.push(S.offset(0,0));switch(this._geometryType){case F.LINE:this._graphic=N.graphics.add(new w(new A({paths:[[[S.x,S.y],[S.x,S.y]]],spatialReference:T}),this.lineSymbol),!0);N.snappingManager&&N.snappingManager._setGraphic(this._graphic);break;case F.FREEHAND_POLYLINE:this._oldPoint=C.screenPoint;S=new A(T);S.addPath(this._points);this._graphic=N.graphics.add(new w(S,this.lineSymbol),!0);N.snappingManager&&N.snappingManager._setGraphic(this._graphic);
break;case F.CIRCLE:case F.ELLIPSE:case F.TRIANGLE:case F.ARROW:case F.LEFT_ARROW:case F.RIGHT_ARROW:case F.UP_ARROW:case F.DOWN_ARROW:case F.RECTANGLE:case F.FREEHAND_POLYGON:this._oldPoint=C.screenPoint,S=new z(T),S.addRing(this._points),this._graphic=N.graphics.add(new w(S,this.fillSymbol),!0),N.snappingManager&&N.snappingManager._setGraphic(this._graphic)}d("esri-touch")&&C.preventDefault();if(1===this._points.length)this.onDrawStart()},_onMouseMoveHandler:function(C){if(this.map.snappingManager)var N=
this.map.snappingManager._snappingPoint;C=N||C.mapPoint;N=this._graphic.geometry;switch(this._geometryType){case L.POLYLINE:case L.POLYGON:var S=this._points.length,F=!!N.getPoint(0,S);C=C.offset(0,0);F?N.setPoint(0,S,C):N.insertPoint(0,S,C);this._graphic.setGeometry(N)}},_onMouseDragHandler:function(C){if(this._graphic||this._points.length)if(d("esri-touch")&&!this._points.length)C.preventDefault();else{this._dragged=!0;if(this.map.snappingManager)var N=this.map.snappingManager._snappingPoint;var S=
this._points[0],F=N||C.mapPoint,T=this.map,y=T.spatialReference;N=this._graphic;var B=L,I=T.toScreen(S),P=T.toScreen(F),X=[];X=P.x-I.x;P=P.y-I.y;var Y=Math.sqrt(X*X+P*P);switch(this._geometryType){case B.CIRCLE:this._hideTooltip();N.geometry=z.createCircle({center:I,r:Y,numberOfPoints:60,map:T});N.setGeometry(N.geometry);break;case B.ELLIPSE:this._hideTooltip();N.geometry=z.createEllipse({center:I,longAxis:X,shortAxis:P,numberOfPoints:60,map:T});N.setGeometry(N.geometry);break;case B.TRIANGLE:this._hideTooltip();
X=[[0,-Y],[.8660254037844386*Y,.5*Y],[-.8660254037844386*Y,.5*Y],[0,-Y]];N.geometry=this._toPolygon(X,I.x,I.y);N.setGeometry(N.geometry);break;case B.ARROW:this._hideTooltip();S=P/Y;T=X/Y;F=.25*T*Y;y=.25*Y/(P/X);Y*=.25*S;X=[[X,P],[X-F*(1+24/y),P+24*T-Y],[X-F*(1+12/y),P+12*T-Y],[-12*S,12*T],[12*S,-12*T],[X-F*(1-12/y),P-12*T-Y],[X-F*(1-24/y),P-24*T-Y],[X,P]];N.geometry=this._toPolygon(X,I.x,I.y);N.setGeometry(N.geometry);break;case B.LEFT_ARROW:this._hideTooltip();X=0>=X?[[X,0],[.75*X,P],[.75*X,.5*
P],[0,.5*P],[0,-.5*P],[.75*X,-.5*P],[.75*X,-P],[X,0]]:[[0,0],[.25*X,P],[.25*X,.5*P],[X,.5*P],[X,-.5*P],[.25*X,-.5*P],[.25*X,-P],[0,0]];N.geometry=this._toPolygon(X,I.x,I.y);N.setGeometry(N.geometry);break;case B.RIGHT_ARROW:this._hideTooltip();X=0<=X?[[X,0],[.75*X,P],[.75*X,.5*P],[0,.5*P],[0,-.5*P],[.75*X,-.5*P],[.75*X,-P],[X,0]]:[[0,0],[.25*X,P],[.25*X,.5*P],[X,.5*P],[X,-.5*P],[.25*X,-.5*P],[.25*X,-P],[0,0]];N.geometry=this._toPolygon(X,I.x,I.y);N.setGeometry(N.geometry);break;case B.UP_ARROW:this._hideTooltip();
X=0>=P?[[0,P],[-X,.75*P],[-.5*X,.75*P],[-.5*X,0],[.5*X,0],[.5*X,.75*P],[X,.75*P],[0,P]]:[[0,0],[-X,.25*P],[-.5*X,.25*P],[-.5*X,P],[.5*X,P],[.5*X,.25*P],[X,.25*P],[0,0]];N.geometry=this._toPolygon(X,I.x,I.y);N.setGeometry(N.geometry);break;case B.DOWN_ARROW:this._hideTooltip();X=0<=P?[[0,P],[-X,.75*P],[-.5*X,.75*P],[-.5*X,0],[.5*X,0],[.5*X,.75*P],[X,.75*P],[0,P]]:[[0,0],[-X,.25*P],[-.5*X,.25*P],[-.5*X,P],[.5*X,P],[.5*X,.25*P],[X,.25*P],[0,0]];N.geometry=this._toPolygon(X,I.x,I.y);N.setGeometry(N.geometry);
break;case B.RECTANGLE:this._hideTooltip();X=[[0,0],[X,0],[X,P],[0,P],[0,0]];N.geometry=this._toPolygon(X,I.x,I.y);N.setGeometry(N.geometry);break;case B.LINE:N.setGeometry(u.mixin(N.geometry,{paths:[[[S.x,S.y],[F.x,F.y]]]}));break;case B.EXTENT:N&&T.graphics.remove(N,!0);N=new J(this._normalizeRect(S,F,y));N._originOnly=!0;this._graphic=T.graphics.add(new w(N,this.fillSymbol),!0);T.snappingManager&&T.snappingManager._setGraphic(this._graphic);break;case B.FREEHAND_POLYLINE:this._hideTooltip();if(!1===
this._canDrawFreehandPoint(C)){d("esri-touch")&&C.preventDefault();return}this._points.push(C.mapPoint.offset(0,0));N.geometry._insertPoints([F.offset(0,0)],0);N.setGeometry(N.geometry);break;case B.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(C)){d("esri-touch")&&C.preventDefault();return}this._points.push(C.mapPoint.offset(0,0));N.geometry._insertPoints([F.offset(0,0)],0);N.setGeometry(N.geometry)}d("esri-touch")&&C.preventDefault()}},_canDrawFreehandPoint:function(C){if(!this._oldPoint)return!1;
var N=this._oldPoint.x-C.screenPoint.x,S=this._oldPoint.y-C.screenPoint.y,F=this._options.tolerance;if((0>N?-1*N:N)<F&&(0>S?-1*S:S)<F)return!1;N=new Date;if(N-this._startTime<this._options.drawTime)return!1;this._startTime=N;this._oldPoint=C.screenPoint;return!0},_onMouseUpHandler:function(C){if(this._dragged&&this._graphic){0===this._points.length&&this._points.push(C.mapPoint.offset(0,0));if(this.map.snappingManager)var N=this.map.snappingManager._snappingPoint;var S=this._points[0];N=N||C.mapPoint;
var F=this.map.spatialReference,T=L;switch(this._geometryType){case T.CIRCLE:case T.ELLIPSE:case T.TRIANGLE:case T.ARROW:case T.LEFT_ARROW:case T.RIGHT_ARROW:case T.UP_ARROW:case T.DOWN_ARROW:case T.RECTANGLE:var y=this._graphic.geometry;break;case T.LINE:y=new A({paths:[[[S.x,S.y],[N.x,N.y]]],spatialReference:F});break;case T.EXTENT:y=(new J(this._normalizeRect(S,N,F))).getExtent();break;case T.FREEHAND_POLYLINE:y=new A(F);y.addPath([].concat(this._points,[N.offset(0,0)]));break;case T.FREEHAND_POLYGON:y=
new z(F),S=[].concat(this._points,[N.offset(0,0),this._points[0].offset(0,0)]),z.prototype.isClockwise(S)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),S.reverse()),y.addRing(S)}d("esri-touch")&&C.preventDefault();this._clear();this._drawEnd(y)}else this._clear()},_isPointToPointTool:function(C){switch(C){case L.POLYLINE:case L.POLYGON:case L.MULTI_POINT:return!0;default:return!1}},_onClickHandler:function(C){if(this.map.snappingManager)var N=
this.map.snappingManager._snappingPoint;N=N||C.mapPoint;C=this.map;var S=C.toScreen(N),F=L;if(this._isPointToPointTool(this._geometryType)){var T=this._points[this._points.length-1];if(N&&T&&N.x===T.x&&N.y===T.y)return;this._points.push(N.offset(0,0))}switch(this._geometryType){case F.POINT:this.onDrawStart();this._drawEnd(N.offset(0,0));this._setTooltipMessage(0);break;case F.POLYLINE:1===this._points.length?(N=new A(C.spatialReference),N.addPath(this._points),this._graphic=C.graphics.add(new w(N,
this.lineSymbol),!0),C.snappingManager&&C.snappingManager._setGraphic(this._graphic,{snapToLastVertex:!1}),this._onMouseMoveHandler_connect=n.connect(C,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry.setPoint(0,this._points.length-1,N.offset(0,0)),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol));break;case F.POLYGON:1===this._points.length?(N=new z(C.spatialReference),N.addRing(this._points),this._graphic=C.graphics.add(new w(N,this.fillSymbol),
!0),C.snappingManager&&C.snappingManager._setGraphic(this._graphic,{snapToLastVertex:!1}),this._onMouseMoveHandler_connect=n.connect(C,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry.setPoint(0,this._points.length-1,N.offset(0,0)),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol));break;case F.MULTI_POINT:N=this._points;1===N.length?(S=new E(C.spatialReference),S.addPoint(N[N.length-1]),this._graphic=C.graphics.add(new w(S,this.markerSymbol),
!0),C.snappingManager&&C.snappingManager._setGraphic(this._graphic),this.onDrawStart()):(this._graphic.geometry.addPoint(N[N.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));break;case F.ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],S.x,S.y);break;case F.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],S.x,S.y);break;case F.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,
12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],S.x,S.y);break;case F.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],S.x,S.y);break;case F.DOWN_ARROW:this._addShape([[0,0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],S.x,S.y);break;case F.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],S.x,S.y);break;case F.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],S.x-48,S.y+48);break;case F.CIRCLE:this._clear();
this.onDrawStart();this._drawEnd(z.createCircle({center:S,r:48,numberOfPoints:60,map:C}));break;case F.ELLIPSE:this._clear(),this.onDrawStart(),this._drawEnd(z.createEllipse({center:S,longAxis:48,shortAxis:24,numberOfPoints:60,map:C}))}this._setTooltipMessage(this._points.length)},_addShape:function(C,N,S){this._setTooltipMessage(0);this._clear();this.onDrawStart();this._drawEnd(this._toPolygon(C,N,S))},_toPolygon:function(C,N,S){var F=this.map,T=new z(F.spatialReference);T.addRing(r.map(C,function(y){return F.toMap({x:y[0]+
N,y:y[1]+S})}));return T},_onDblClickHandler:function(C){var N=this._points,S=this.map.spatialReference,F=L;d("esri-touch")&&N.push(C.mapPoint);var T=N[N.length-1],y=N[N.length-2];N=T&&y&&T.x===y.x&&T.y===y.y?N.slice(0,N.length-1):N.slice(0,N.length);switch(this._geometryType){case F.POLYLINE:if(!this._graphic||2>N.length){n.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(C);return}var B=new A(S);B.addPath([].concat(N));break;case F.POLYGON:if(!this._graphic||3>N.length)return;
B=new z(S);C=[].concat(N,[N[0].offset(0,0)]);z.prototype.isClockwise(C)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),C.reverse());B.addRing(C);break;case F.MULTI_POINT:B=new E(S),r.forEach(N,function(I){B.addPoint(I)})}n.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(B)},_onKeyDownHandler:function(C){C.keyCode===b.ESCAPE&&(n.disconnect(this._onMouseMoveHandler_connect),
this._clear(),this._setTooltipMessage(0))},_toggleTooltip:function(C){this._options.showTooltips&&(C?this._tooltip||(this._tooltip=e.create("div",{"class":"esriMapTooltip"},this.map.container),h.isBodyLtr()||g.set(this._tooltip,"direction","rtl"),this._tooltip.style.display="none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=n.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=n.connect(this.map,
"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=n.connect(this.map,"onMouseMove",this._updateTooltip)):this._tooltip&&(n.disconnect(this._onTooltipMouseEnterHandler_connect),n.disconnect(this._onTooltipMouseLeaveHandler_connect),n.disconnect(this._onTooltipMouseMoveHandler_connect),e.destroy(this._tooltip),this._tooltip=null))},_hideTooltip:function(){var C=this._tooltip;C&&(C.style.display="none")},_setTooltipMessage:function(C){var N=this._tooltip;if(N){var S="";switch(this._geometryType){case L.POINT:S=
D.toolbars.draw.addPoint;break;case L.ARROW:case L.LEFT_ARROW:case L.RIGHT_ARROW:case L.UP_ARROW:case L.DOWN_ARROW:case L.TRIANGLE:case L.RECTANGLE:case L.CIRCLE:case L.ELLIPSE:S=D.toolbars.draw.addShape;break;case L.LINE:case L.EXTENT:case L.FREEHAND_POLYLINE:case L.FREEHAND_POLYGON:S=D.toolbars.draw.freehand;break;case L.POLYLINE:case L.POLYGON:S=D.toolbars.draw.start;1===C?S=D.toolbars.draw.resume:2<=C&&(S=D.toolbars.draw.complete);break;case L.MULTI_POINT:S=D.toolbars.draw.addMultipoint,1<=C&&
(S=D.toolbars.draw.finish)}N.innerHTML=S}},_updateTooltip:function(C){var N=this._tooltip;if(N){if(C.clientX||C.pageY){var S=C.clientX;C=C.clientY}else S=C.clientX+k.body().scrollLeft-k.body().clientLeft,C=C.clientY+k.body().scrollTop-k.body().clientTop;N.style.display="none";g.set(N,{left:S+this._options.tooltipOffset+"px",top:C+"px"});N.style.display=""}},_redrawGraphic:function(C,N,S,F){(S||this.map.wrapAround180)&&(C=this._graphic)&&C.setGeometry(C.geometry)},onActivate:function(){},onDeactivate:function(){},
onDrawComplete:function(){},onDrawStart:function(){},onDrawEnd:function(){}});u.mixin(L,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});d("extend-esri")&&u.setObject("toolbars.Draw",L,c);return L})},
"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H){var A=u(c,{declaredClass:"esri.toolbars.Edit",constructor:function(z,E){this._map=
z;this._tool=0;if(this._map.loaded)this._scratchGL=z.graphics;else var J=n.connect(this._map,"onLoad",this,function(){n.disconnect(J);J=null;this._scratchGL=this._map.graphics});z=d("esri-mobile");this._defaultOptions=r.mixin({vertexSymbol:new v(v.STYLE_CIRCLE,z?20:12,new w(w.STYLE_SOLID,new k([0,0,0,.5]),1),new k([128,128,128])),ghostVertexSymbol:new v(v.STYLE_CIRCLE,z?18:10,new w(w.STYLE_SOLID,new k([0,0,0,.5]),1),new k([255,255,255,.75])),ghostLineSymbol:new w(w.STYLE_DOT,new k([128,128,128]),
2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:z?24:16,boxLineSymbol:new w(w.STYLE_DASH,new k([64,64,64]),1),boxHandleSymbol:new v(v.STYLE_SQUARE,z?16:9,new w(w.STYLE_SOLID,new k([0,0,0,.5]),1),new k([255,255,255,.75])),textAnchorSymbol:new v(v.STYLE_CIRCLE,10,null,new k([255,0,0]))},E||{})},activate:function(z,E,J){this.deactivate();this._graphic=E;this._options=r.mixin(r.mixin({},this._defaultOptions),J||{});var D=A.MOVE;J=A.EDIT_VERTICES;var L=A.SCALE,C=A.ROTATE,N=A.EDIT_TEXT,
S=!1,F=!1,T=!1,y=this._map,B=y.spatialReference,I=E.geometry.spatialReference;this._geo=!(!B||!I||B.equals(I)||!B.isWebMercator()||4326!==I.wkid);this._isTextPoint=this._prepareTextSymbolEditing(E,z);(z&D)===D&&(S=this._enableMove(E));D=(z&L)===L;C=(z&C)===C;if(D||C)T=this._enableBoxEditing(E,D,C);(z&J)===J&&(F=this._enableVertexEditing(E));(z&N)===N&&this._enableTextEditing(E);if(!(S||F||T))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");
if(this._tool=z)this._mapPanEndHandle=n.connect(y,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=n.connect(y,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,E);y.snappingManager&&(S||F)&&y.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var z=this._tool,E=this._graphic;if(z){var J=!!this._modified;this._clear();n.disconnect(this._mapPanEndHandle);n.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=
this._mapExtChgHandle=null;this.onDeactivate(z,E,{isModified:J});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(z,E){},onDeactivate:function(z,E,J){},onGraphicMoveStart:function(z){},onGraphicFirstMove:function(z){this._modified=!0},onGraphicMove:function(z,E){},onGraphicMoveStop:function(z,E){},
onGraphicClick:function(z,E){},onVertexMoveStart:function(z,E){},onVertexFirstMove:function(z,E){this._modified=!0},onVertexMove:function(z,E,J){},onVertexMoveStop:function(z,E,J){},onVertexAdd:function(z,E){this._modified=!0},onVertexClick:function(z,E){},onVertexMouseOver:function(z,E){},onVertexMouseOut:function(z,E){},onVertexDelete:function(z,E){this._modified=!0},onTextEditStart:function(z,E){},onTextEditEnd:function(z){},onScaleStart:function(z){},onScaleFirstMove:function(z){this._modified=
!0},onScale:function(z,E){},onScaleStop:function(z,E){},onRotateStart:function(z){},onRotateFirstMove:function(z){this._modified=!0},onRotate:function(z,E){},onRotateStop:function(z,E){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic","transform"],"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic",
"vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],
rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(z,E){if("point"===z.geometry.type||"multipoint"===z.geometry.type){var J=z.getLayer(),D=J.renderer;J=z.symbol||J._getSymbol(z);!J&&(D.hasVisualVariables("sizeInfo",!1)||D.hasVisualVariables("colorInfo",!1)||D.hasVisualVariables("opacityInfo",!1))&&D.addBreak&&D.infos&&1===D.infos.length&&(J=D.infos[0].symbol||D.defaultSymbol);if(J&&"textsymbol"===J.type){if((E&A.SCALE)===A.SCALE||(E&A.ROTATE)===A.ROTATE||
(E&A.EDIT_TEXT)===A.EDIT_TEXT){z.setSymbol(new x(J.toJson()));var L=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(z),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){L._boxEditor&&L._boxEditor.refresh()})):G(["../dijit/SymbolEditor"],function(C){if(!L._textSymbolEditor){var N=L._options.textSymbolEditorHolder?a.create("div",null,L._options.textSymbolEditorHolder):
a.create("div",null,L._map.root);L._textSymbolEditor=new C({graphic:z},N);C=L._textSymbolEditor.domNode.parentNode.id;b.set(L._textSymbolEditor.domNode,{position:"map_root"===C?"absolute":"relative",left:"map_root"===C?L._map.width/2-100+"px":"5px",top:"20px","z-index":50});L._textSymbolEditor.startup();L._textSymbolEditor.createForm(z);L._textSymbolEditor.show();L._textSymbolEditor.on("symbol-change",function(){L._boxEditor&&L._boxEditor.refresh()})}})}if((E&A.MOVE)===A.MOVE||(E&A.ROTATE)===A.ROTATE||
(E&A.SCALE)===A.SCALE)this._textAnchor=new H(z.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(z){var E=this._map;switch(z.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new l(z,E,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(z){var E=this._map;switch(z.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=q.create(z,E,this),!0}return!1},
_enableBoxEditing:function(z,E,J){var D=this._map,L=z.geometry.type;return"polyline"===L||"polygon"===L||this._isTextPoint?(this._boxEditor=new f(z,D,this,E,J,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(z){return this._isTextPoint?(this._textEditor=new t(z,this._map,this),n.connect(this._textEditor,"onEditStart",r.hitch(this,function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();
this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var z=this._graphicMover;z&&(z.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var z=this._vertexEditor;z&&(z.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var z=this._boxEditor;z&&(z.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&
this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},_mapExtentChangeHandler:function(z,E,J){J&&this._refreshMoveables()},_refreshMoveables:function(z){var E=m.filter([this._graphicMover,this._vertexEditor,
this._boxEditor],g.isDefined);m.forEach(E,function(J){J.refresh(z)})},_beginOperation:function(z){m.forEach(this._getAffectedTools(z),function(E){E.suspend()})},_endOperation:function(z){m.forEach(this._getAffectedTools(z),function(E){E.resume()})},_getAffectedTools:function(z){var E=[];switch(z){case "MOVE":E=[this._vertexEditor,this._boxEditor];break;case "VERTICES":E=[this._boxEditor];break;case "BOX":E=[this._vertexEditor]}return E=m.filter(E,g.isDefined)}});r.mixin(A,{MOVE:1,EDIT_VERTICES:2,
SCALE:4,ROTATE:8,EDIT_TEXT:16});d("extend-esri")&&r.setObject("toolbars.Edit",A,e);return A})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t){G=G(null,{declaredClass:"esri.toolbars._Box",
constructor:function(v,w,x,H,A,z,E){this._graphic=v;this._map=w;this._toolbar=x;this._scale=H;this._rotate=A;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=z;v=x._options;this._markerSymbol=v.boxHandleSymbol;this._lineSymbol=v.boxLineSymbol;this._moveStartHandler=u.hitch(this,this._moveStartHandler);this._firstMoveHandler=u.hitch(this,this._firstMoveHandler);this._moveStopHandler=u.hitch(this,this._moveStopHandler);this._moveHandler=u.hitch(this,
this._moveHandler);this._isTextPoint=E;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){r.forEach(this._getAllGraphics(),function(v){v.hide()})},resume:function(){r.forEach(this._getAllGraphics(),function(v){v.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&r.forEach(this._connects,n.disconnect);var v=this._toolbar._scratchGL;
this._anchors&&r.forEach(this._anchors,function(w){v.remove(w.graphic);(w=w.moveable)&&w.destroy()});this._box&&v.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var v=this._map,w=this._toolbar._scratchGL,x=this._getBoxCoords(),H=new c(v.spatialReference),A=u.clone(r.filter(x,function(z,E){return 8!==E&&0===E%2}));A[0]&&A.push([A[0][0],A[0][1]]);H.addPath(A);this._rotate&&H.addPath([x[1],x[8]]);this._box?this._box.setGeometry(H):(this._box=
new t(H,this._lineSymbol),w.add(this._box));this._anchors?r.forEach(this._anchors,function(z,E){this._scale||(E=8);var J=new h(x[E],v.spatialReference);z.graphic.setGeometry(J);J=z.moveable;var D=z.graphic.getDojoShape();D&&(J?D!==J.shape&&(J.destroy(),z.moveable=this._getMoveable(z.graphic,E)):z.moveable=this._getMoveable(z.graphic,E))},this):(this._anchors=[],this._connects=[],r.forEach(x,function(z,E){!this._scale&&8>E||(z=new h(z,v.spatialReference),z=new t(z,this._markerSymbol),this._isTextPoint&&
1===E%2&&z.hide(),w.add(z),this._anchors.push({graphic:z,moveable:this._getMoveable(z,E)}))},this))}else this._cleanUp()},_getBoxCoords:function(v){var w=this._map,x=[],H,A,z;if(this._isTextPoint){var E=this._graphic.getNode().getBoundingClientRect();var J=w.__container.getBoundingClientRect();E=[{x:E.left-J.left,y:E.top-J.top},{x:E.right-J.left,y:E.top-J.top},{x:E.right-J.left,y:E.bottom-J.top},{x:E.left-J.left,y:E.bottom-J.top}]}else E=this._getTransformedBoundingBox(this._graphic);r.forEach(E,
function(D,L,C){H=D;(A=C[L+1])||(A=C[0]);z={x:(H.x+A.x)/2,y:(H.y+A.y)/2};v||(H=w.toMap(H),z=w.toMap(z));x.push([H.x,H.y]);x.push([z.x,z.y])});this._rotate&&(E=u.clone(x[1]),E=v?{x:E[0],y:E[1]}:w.toScreen({x:E[0],y:E[1],spatialReference:w.spatialReference}),E.y-=this._toolbar._options.rotateHandleOffset,v||(E=w.toMap(E)),x.push([E.x,E.y]));return x},_getTransformedBoundingBox:function(v){var w=this._map,x=v.geometry.getExtent(),H=v.geometry.spatialReference;v=new h(x.xmin,x.ymax,H);x=new h(x.xmax,
x.ymin,H);v=w.toScreen(v);x=w.toScreen(x);return[{x:v.x,y:v.y},{x:x.x,y:v.y},{x:x.x,y:x.y},{x:v.x,y:x.y}]},_getAllGraphics:function(){var v=[this._box];this._anchors&&r.forEach(this._anchors,function(w){v.push(w.graphic)});return v=r.filter(v,g.isDefined)},_getMoveable:function(v,w){var x=v.getDojoShape();if(x)return v=new a(x),v._index=w,this._connects.push(n.connect(v,"onMoveStart",this._moveStartHandler)),this._connects.push(n.connect(v,"onFirstMove",this._firstMoveHandler)),this._connects.push(n.connect(v,
"onMoveStop",this._moveStopHandler)),v.onMove=this._moveHandler,(x=x.getEventSource())&&d.set(x,"cursor",this._toolbar._cursors["box"+w]),v},_moveStartHandler:function(v){this._toolbar["on"+(8===v.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(v){this._toolbar._deactivateScrollWheel();var w=v.host._index,x=this._wrapOffset=v.host.shape._wrapOffsets[0]||0,H=this._graphic.getLayer().getNavigationTransform();v=r.map(this._getBoxCoords(!0),function(z){return{x:z[0]+
x,y:z[1]}});var A=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:v[1].x,y:v[3].y};this._centerCoord=b.multiplyPoint(b.invert(H),A);if(8===w)A=b.multiplyPoint(b.invert(H),v[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,A)),this._startLine=[this._centerCoord,A],this._moveLine=u.clone(this._startLine);else if(A=b.multiplyPoint(b.invert(H),v[w]),H=b.multiplyPoint(b.invert(H),v[(w+4)%8]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,
A)),this._firstMoverToAnchor=Math.sqrt((A.x-this._centerCoord.x)*(A.x-this._centerCoord.x)+(A.y-this._centerCoord.y)*(A.y-this._centerCoord.y)),this._startBox=H,this._startBox.width=v[4].x-v[0].x,this._startBox.height=v[4].y-v[0].y,this._moveBox=u.clone(this._startBox),this._xfactor=A.x>H.x?1:-1,this._yfactor=A.y>H.y?1:-1,1===w||5===w)this._xfactor=0;else if(3===w||7===w)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===w?this._rotateEvent:this._scaleEvent)+"FirstMove"](this._graphic)},
_moveHandler:function(v,w){v=v.host._index;var x=this._defaultEventArgs;x.angle=0;x.scaleX=1;x.scaleY=1;if(8===v){var H=this._startLine;var A=this._moveLine;var z=A[1];z.x+=w.dx;z.y+=w.dy;w=this._getAngle(H,A);this._isTextPoint&&(w+=this._graphic.symbol.angle);A=b.rotategAt(w,H[0]);this._graphic.getDojoShape().setTransform(A);x.transform=A;x.angle=w;x.around=H[0]}else{H=this._startBox;A=this._moveBox;A.width+=w.dx*this._xfactor;A.height+=w.dy*this._yfactor;this._uniformScaling||this._isTextPoint?
(H=A.x+this._xfactor*A.width,A=A.y+this._yfactor*A.height,H=Math.sqrt((H-this._centerCoord.x)*(H-this._centerCoord.x)+(A-this._centerCoord.y)*(A-this._centerCoord.y)),this._scaleRatio=w=z=H/this._firstMoverToAnchor,H=this._centerCoord):(w=A.width/H.width,z=A.height/H.height,H={x:H.x,y:H.y});if(isNaN(w)||Infinity===w||-Infinity===w)w=1;if(isNaN(z)||Infinity===z||-Infinity===z)z=1;A=b.scaleAt(w,z,H);if(this._isTextPoint){var E=b.rotategAt(this._graphic.symbol.angle,H);this._graphic.getDojoShape().setTransform([E,
A])}else this._graphic.getDojoShape().setTransform(A);x.transform=A;x.scaleX=w;x.scaleY=z;x.around=H}this._toolbar["on"+(8===v?this._rotateEvent:this._scaleEvent)](this._graphic,x)},_moveStopHandler:function(v){this._toolbar._activateScrollWheel();var w=this._graphic,x=this._toolbar,H=x._geo?l.geographicToWebMercator(w.geometry):w.geometry,A=H.spatialReference,z=w.getDojoShape(),E=z.getTransform(),J=w.getLayer().getNavigationTransform();this._isTextPoint?(w=this._graphic.symbol,8===v.host._index?
w.angle+=this._getAngle(this._startLine,this._moveLine):w.font.setSize(Math.round(w.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(w)):(H=H.toJson(),this._updateSegments(H.paths||H.rings,E,J,A),z.setTransform(null),H=q.fromJson(H),w.setGeometry(x._geo?l.webMercatorToGeographic(H,!0):H));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;x._endOperation("BOX");this._defaultEventArgs.transform=E;x["on"+(8===v.host._index?this._rotateEvent:
this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(v,w,x,H){var A=this._map,z=this._wrapOffset||0;r.forEach(v,function(E){r.forEach(E,function(J){this._updatePoint(J,H,z,b,A,x,w)},this)},this)},_updatePoint:function(v,w,x,H,A,z,E){w=A.toScreen({x:v[0],y:v[1],spatialReference:w},!0);w.x+=x;w=H.multiplyPoint([z,E,H.invert(z)],w);w.x-=x;x=A.toMap(w);v[0]=x.x;v[1]=x.y},_getAngle:function(v,w){return 180*Math.atan2(w[0].y-w[1].y,w[0].x-w[1].x)/Math.PI-180*Math.atan2(v[0].y-
v[1].y,v[0].x-v[1].x)/Math.PI},_deNormalizePoint:function(v,w){var x=this._map._getFrameWidth();if(-1===x)return v;for(v={x:v.x,y:v.y};Math.abs(v.x-w.x)>=x;)v.x=v.x<w.x?v.x+x:v.x-x;var H=Math.abs(v.x-w.x);Math.abs(v.x-w.x+x)<H?v.x+=x:Math.abs(v.x-w.x-x)<H&&(v.x-=x);return v}});k("extend-esri")&&u.setObject("toolbars._Box",G,e);return G})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(G,u,r,n,m,k,d,a,b,e){return u("dojox.gfx.Moveable",null,{constructor:function(g,h){this.shape=g;this.delay=h&&0<h.delay?h.delay:0;this.mover=h&&h.mover?h.mover:b;this.leftButtonOnly=h&&h.leftButtonOnly;this.events=[this.shape.on(k.press,G.hitch(this,"onMouseDown"))]},destroy:function(){r.forEach(this.events,function(g){g.remove()});this.events=this.shape=null},onMouseDown:function(g){this.delay?(this.events.push(this.shape.on(k.move,G.hitch(this,"onMouseMove")),this.shape.on(k.release,G.hitch(this,
"onMouseUp"))),this._lastX=g.clientX,this._lastY=g.clientY):this.leftButtonOnly&&!e.isLeft(g)||new this.mover(this.shape,g,this);n.stop(g)},onMouseMove:function(g){var h=g.clientY;if(Math.abs(g.clientX-this._lastX)>this.delay||Math.abs(h-this._lastY)>this.delay)this.onMouseUp(g),new this.mover(this.shape,g,this);n.stop(g)},onMouseUp:function(g){this.events.pop().remove()},onMoveStart:function(g){m.publish("/gfx/move/start",g);d.add(a.body(),"dojoMove")},onMoveStop:function(g){m.publish("/gfx/move/stop",
g);d.remove(a.body(),"dojoMove")},onFirstMove:function(g){},onMove:function(g,h,c){this.onMoving(g,h,c);this.shape.applyLeftTransform(h);this.onMoved(g,h)},onMoving:function(g,h){},onMoved:function(g,h){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(G,u,r,n,m,k){return r("dojox.gfx.Mover",null,{constructor:function(d,a,b){this.shape=d;this.lastX=a.clientX;this.lastY=a.clientY;d=this.host=b;a=
document;b=n(a,m.move,G.hitch(this,"onFirstMove"));this.events=[n(a,m.move,G.hitch(this,"onMouseMove")),n(a,m.release,G.hitch(this,"destroy")),n(a,"dragstart",G.hitch(k,"stop")),n(a,"selectstart",G.hitch(k,"stop")),b];if(d&&d.onMoveStart)d.onMoveStart(this)},onMouseMove:function(d){var a=d.clientX,b=d.clientY;this.host.onMove(this,{dx:a-this.lastX,dy:b-this.lastY},d);this.lastX=a;this.lastY=b;k.stop(d)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){u.forEach(this.events,
function(a){a.remove()});var d=this.host;if(d&&d.onMoveStop)d.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(G,u,r,n,m,k,d,a,b,e,g,h,c,f){var l=G(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(q,t,v,w){this.graphic=q;this.map=t;this.toolbar=v;this.tempPt=w;this._enableGraphicMover();this._moved=!1},refresh:function(q){var t=this.graphic.getDojoShape();!t||!q&&t._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var q=this.graphic,t=q.getDojoShape();t&&(t._hostGraphic=q,this._moveable=new k(t,{mover:l.Mover}),this._moveStartHandle=
r.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=r.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=r.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=r.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(q=t.getEventSource())&&m.set(q,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var q=this._moveable;if(q){r.disconnect(this._moveStartHandle);r.disconnect(this._firstMoveHandle);
r.disconnect(this._movingHandle);r.disconnect(this._moveStopHandle);var t=q.shape;t&&(t._hostGraphic=null,(t=t.getEventSource())&&m.set(t,"cursor","inherit"));q.destroy()}this._moveable=null},_moveStartHandler:function(){var q=this.graphic,t=this.map;this._startTx=q.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&t.snappingManager&&t.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(q)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(q,t,v){q=q.shape.getTransform();t=this.map;var w;g("esri-pointer")?w=t.navigationManager.pointerEvents._processTouchEvent(v,v):v&&"pointermove"===v.type&&(w=e.prototype._processTouchEvent.call({map:t},v,v));w&&t.snappingManager&&t.snappingManager._onSnappingMouseMoveHandler(w);this.tempPt&&this.tempPt.getDojoShape().setTransform(q);this.toolbar.onGraphicMove(this.graphic,q)},_moveStopHandler:function(q){var t=this.graphic,v=this.toolbar,w=this.map,x=v._geo?h.geographicToWebMercator(t.geometry):
t.geometry,H=x.type,A=t.getDojoShape(),z=A.getTransform();if(n.toJson(z)!==n.toJson(this._startTx)){this._moved=!0;switch(H){case "point":H=[z,a.invert(this._startTx)];if(w.snappingManager)var E=w.snappingManager._snappingPoint;x=E||w.toMap(a.multiplyPoint(H,w.toScreen(x,!0)));w.snappingManager&&w.snappingManager._killOffSnapping();break;case "polyline":x=this._updatePolyGeometry(x,x.paths,z);break;case "polygon":x=this._updatePolyGeometry(x,x.rings,z)}A.setTransform(null);t.setGeometry(v._geo?h.webMercatorToGeographic(x,
!0):x);this.tempPt&&this.tempPt.setGeometry(new f(t.geometry.toJson()))}else this._moved=!1;v._endOperation("MOVE");v.onGraphicMoveStop(t,z);this._moved||(q=q.__e,w=this.map.position,q=new c(q.pageX-w.x,q.pageY-w.y),v.onGraphicClick(t,{screenPoint:q,mapPoint:this.map.toMap(q)}))},_updatePolyGeometry:function(q,t,v){var w=this.map,x=q.getPoint(0,0);w=w.toMap(w.toScreen(x).offset(v.dx,v.dy));v=w.x-x.x;x=w.y-x.y;var H;for(w=0;w<t.length;w++){var A=t[w];for(H=0;H<A.length;H++){var z=q.getPoint(w,H);q.setPoint(w,
H,z.offset(v,x))}}return q}});l.Mover=G(d,{declaredClass:"esri.toolbars._Mover",constructor:function(q,t,v){this.__e=t}});g("extend-esri")&&(u.setObject("toolbars._GraphicMover",l,b),u.setObject("toolbars._Mover",l.Mover,b));return l})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(G,
u,r,n,m,k,d,a,b,e,g,h){var c=G(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(f,l,q){this.graphic=f;this.map=l;this.toolbar=q;f=q._options;this._symbol1=f.vertexSymbol;this._symbol2=f.ghostVertexSymbol;l=f.ghostLineSymbol;this._lineStroke={style:l.style,width:l.width,color:l.color};this._canDel=f.allowDeleteVertices;this._canAdd=f.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(f){f?(this._removeControllers(),this._addControllers()):
(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=r.connect(b,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=r.connect(b,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&
(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var f=this._getGraphicsLayer();this._mouseOverHandle=r.connect(f,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=r.connect(f,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new k({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),f=this._ctxDelete=new d({label:h.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=
r.connect(f,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(f),this._ctxMenu.startup())},_removeControllers:function(){r.disconnect(this._firstMoveHandle);r.disconnect(this._moveStopHandle);r.disconnect(this._mouseOverHandle);r.disconnect(this._mouseOutHandle);r.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=
null},_add:function(f,l,q){var t,v,w=this.graphic,x=[];for(t=0;t<f.length;t++){var H=f[t],A=[];for(v=0;v<H.length;v++)A.push(new b(H[v],l,w,t,v,H.length,this,q));x.push(A)}return x},_remove:function(f){f&&n.forEach(f,function(l){n.forEach(l,function(q){q.destroy()})})},_refresh:function(f){f&&n.forEach(f,function(l){n.forEach(l,function(q){q.refresh()})})},_isNew:function(f){return-1===n.indexOf(this._vertexMovers[f.segIndex],f)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(f){f=this._selectedMover;this._updateRelatedGraphic(f,f.relatedGraphic,f.graphic.geometry,f.segIndex,f.ptIndex,f.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(f);this._deleteVertex(f);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(f){f=f.graphic;var l=this._findMover(f);l&&(this.toolbar.onVertexMouseOver(this.graphic,l._getInfo()),l._placeholder||(this._selectedMover=l,this._canDel&&this._bindCtxNode(f.getDojoShape().getNode())))},_mouseOutHandler:function(f){if(f=
this._findMover(f.graphic))this.toolbar.onVertexMouseOut(this.graphic,f._getInfo())},_bindCtxNode:function(f){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(f);this._bindNode=f},_unbindCtxNode:function(){var f=this._bindNode;f&&this._ctxMenu.unBindDomNode(f)},_findMover:function(f){var l=[];var q=this._mpVertexMovers;n.forEach(this._vertexMovers,function(v){l=l.concat(v)});q&&n.forEach(q,function(v){l=l.concat(v)});
for(q=0;q<l.length;q++){var t=l[q];if(t.graphic===f)return t}},_firstMoveHandler:function(f){!this._isNew(f)&&this._canAdd&&this._hideRelatedMidpoints(f);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(f,l){var q=this._isNew(f);l&&(l.dx||l.dy)?(this._updateRelatedGraphic(f,f.relatedGraphic,f.graphic.geometry,f.segIndex,f.ptIndex,f.segLength,q),this._canAdd&&(q?this._addMidpoints(f):(this._repositionRelatedMidpoints(f),this._showRelatedMidpoints(f))),this.toolbar._endOperation("VERTICES")):
!q&&this._canAdd&&this._showRelatedMidpoints(f)},_showRelatedMidpoints:function(f){var l=this._getAdjacentMidpoints(f.ptIndex,f.segLength),q=this._mpVertexMovers[f.segIndex];for(f=0;f<l.length;f++){var t=q[l[f]];t.graphic.show();t.refresh()}},_hideRelatedMidpoints:function(f){var l=this._getAdjacentMidpoints(f.ptIndex,f.segLength),q=this._mpVertexMovers[f.segIndex];for(f=0;f<l.length;f++)q[l[f]].graphic.hide()},_repositionRelatedMidpoints:function(f){var l,q=this._getAdjacentMidpoints(f.ptIndex,f.segLength),
t=this._mpVertexMovers[f.segIndex];for(l=0;l<q.length;l++){var v=this._getAdjacentVertices(q[l],f.segLength),w=f.relatedGraphic.geometry.getPoint(f.segIndex,v[0]);v=f.relatedGraphic.geometry.getPoint(f.segIndex,v[1]);w=new e({x:(w.x+v.x)/2,y:(w.y+v.y)/2,spatialReference:w.spatialReference.toJson()});t[q[l]].graphic.setGeometry(w)}},_addMidpoints:function(f){var l=f.segIndex,q=f.ptIndex,t=f.segLength,v=q+1,w,x=t+1;this._mpVertexMovers[l].splice(q,1);var H=this._vertexMovers[l];for(w=0;w<v;w++)H[w].segLength+=
1;for(w=v;w<H.length;w++)H[w].ptIndex+=1,H[w].segLength+=1;f.ptIndex=v;f.segLength=H.length+1;H.splice(v,0,f);f.graphic.setSymbol(this._symbol1);H=this._mpVertexMovers[l];for(w=0;w<q;w++)H[w].segLength+=1;for(w=q;w<t-1;w++)H[w].ptIndex+=1,H[w].segLength+=1;v=this._getAdjacentVertices(q,x);l=this._getAdjacentVertices(q+1,x);t=f.relatedGraphic.geometry.getPoint(f.segIndex,v[0]);w=f.relatedGraphic.geometry.getPoint(f.segIndex,v[1]);v=new e({x:(t.x+w.x)/2,y:(t.y+w.y)/2,spatialReference:t.spatialReference.toJson()});
t=f.relatedGraphic.geometry.getPoint(f.segIndex,l[0]);w=f.relatedGraphic.geometry.getPoint(f.segIndex,l[1]);l=new e({x:(t.x+w.x)/2,y:(t.y+w.y)/2,spatialReference:t.spatialReference.toJson()});t=new b(v,this._symbol2,this.graphic,f.segIndex,q,x,this,!0);f=new b(l,this._symbol2,this.graphic,f.segIndex,q+1,x,this,!0);H.splice(q,0,t,f)},_deleteVertex:function(f){var l,q=f.ptIndex,t=this._vertexMovers[f.segIndex];for(l=0;l<q;l++)--t[l].segLength;for(l=q+1;l<t.length;l++){var v=t[l];--v.ptIndex;--v.segLength}t.splice(q,
1);l=f._getInfo();f.destroy();this.toolbar.onVertexDelete(this.graphic,l)}});u.mixin(c,{create:function(f,l,q){switch(f.geometry.type){case "multipoint":return new c.MultipointVertexEditor(f,l,q);case "polyline":return new c.PolylineVertexEditor(f,l,q);case "polygon":return new c.PolygonVertexEditor(f,l,q)}}});c.MultipointVertexEditor=G(c,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=r.connect(b,"onMoveStart",this,this._moveStartHandler);
r.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);r.disconnect(this._moveStartHandle)},_getSegments:function(f){var l=f.points,q=[],t=f.spatialReference;for(f=0;f<l.length;f++){var v=l[f];q.push(new e({x:v[0],y:v[1],spatialReference:t.toJson()}))}return[q]},_getMidpointSegments:function(f){return[]},_getControlPoints:function(f,l,q,t,v){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(f){var l=f.graphic;if(f=this._findMover(f))this.toolbar.onVertexMouseOver(l,
f._getInfo()),this._selectedMover=f,this._canDel&&this._bindCtxNode(f.graphic.getDojoShape().getNode())},_mouseOutHandler:function(f){var l=f.graphic;if(f=this._findMover(f))this.toolbar.onVertexMouseOut(l,f._getInfo())},_findMover:function(f){var l=[].concat(this._vertexMovers[0]),q=f.target;for(f=0;f<l.length;f++){var t=l[f];if(t.graphic.getDojoShape().getNode()===q)return t}},_moveStartHandler:function(f){var l=f.ptIndex,q=f.segLength-1,t=f.relatedGraphic.geometry.points;f=t.splice(l,1);t.push(f[0]);
t=this._vertexMovers[0];for(f=q;f>l;f--)--t[f].ptIndex;f=t.splice(l,1);t.push(f[0]);f[0].ptIndex=q},_moveStopHandler:function(f){this._updateRelatedGraphic(f,f.relatedGraphic,f.graphic.geometry,f.segIndex,f.ptIndex,f.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(f,l,q,t,v,w,x,H){f=l.geometry;H?f.removePoint(v):f.setPoint(v,q);l.setGeometry(f)},_deleteMidpoints:function(f){}});c.PolylineVertexEditor=G(c,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(f){var l,q,t=f.paths,v=[];for(l=0;l<t.length;l++){var w=t[l],x=[];for(q=0;q<w.length;q++)x.push(f.getPoint(l,q));v.push(x)}return v},_getMidpointSegments:function(f){var l,q,t=f.paths,v=[],w=f.spatialReference;for(l=0;l<t.length;l++){var x=t[l],H=[];for(q=0;q<x.length-1;q++){var A=f.getPoint(l,q),z=f.getPoint(l,q+1);A=new e({x:(A.x+z.x)/2,y:(A.y+z.y)/2,spatialReference:w.toJson()});H.push(A)}v.push(H)}return v},_getControlPoints:function(f,l,q,t,v){var w=this.map,x,H;this._isNew(f)?
(f=t,t+=1,0<=f&&(x=w.toScreen(l.getPoint(q,f))),t<=v&&(H=w.toScreen(l.getPoint(q,t)))):(f=t-1,t+=1,0<=f&&(x=w.toScreen(l.getPoint(q,f))),t<v&&(H=w.toScreen(l.getPoint(q,t))));return[x,H]},_getAdjacentMidpoints:function(f,l){var q=[],t=f-1;0<=t&&q.push(t);f<l-1&&q.push(f);return q},_getAdjacentVertices:function(f,l){return[f,f+1]},_deleteMidpoints:function(f){var l=this._mpVertexMovers[f.segIndex],q=l.length-1,t=this._getAdjacentMidpoints(f.ptIndex,f.segLength).sort(),v,w=t[0];for(v=0;v<w;v++)--l[v].segLength;
for(v=w+1;v<l.length;v++){var x=l[v];--x.ptIndex;--x.segLength}if(1===t.length)l.splice(w,1)[0].destroy();else for(x=this._getAdjacentVertices(w,q),v=f.relatedGraphic.geometry.getPoint(f.segIndex,x[0]),x=f.relatedGraphic.geometry.getPoint(f.segIndex,x[1]),v=new e({x:(v.x+x.x)/2,y:(v.y+x.y)/2,spatialReference:v.spatialReference.toJson()}),f=new b(v,this._symbol2,this.graphic,f.segIndex,w,q,this,!0),l=l.splice(w,t.length,f),v=0;v<l.length;v++)l[v].destroy()},_updateRelatedGraphic:function(f,l,q,t,v,
w,x,H){f=l.geometry;x?f.insertPoint(t,v+1,g.fromJson(q.toJson())):H?f.removePoint(t,v):f.setPoint(t,v,g.fromJson(q.toJson()));l.setGeometry(f)}});c.PolygonVertexEditor=G(c,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(f){var l,q,t=f.rings,v=[];for(l=0;l<t.length;l++){var w=t[l],x=[];for(q=0;q<w.length-1;q++)x.push(f.getPoint(l,q));v.push(x)}return v},_getMidpointSegments:function(f){var l,q,t=f.rings,v=[],w=f.spatialReference;for(l=0;l<t.length;l++){var x=t[l],
H=[];for(q=0;q<x.length-1;q++){var A=f.getPoint(l,q),z=f.getPoint(l,q+1);A=new e({x:(A.x+z.x)/2,y:(A.y+z.y)/2,spatialReference:w.toJson()});H.push(A)}v.push(H)}return v},_getControlPoints:function(f,l,q,t,v){var w=this.map;this._isNew(f)?f=t:(f=t-1,f=0>f?(v+f)%v:f);t=(t+1)%v;v=w.toScreen(l.getPoint(q,f));l=w.toScreen(l.getPoint(q,t));return[v,l]},_getAdjacentMidpoints:function(f,l){var q=f-1;return[0>q?(l+q)%l:q,f]},_getAdjacentVertices:function(f,l){return[f,(f+1)%l]},_deleteMidpoints:function(f){var l=
f.ptIndex,q=this._mpVertexMovers[f.segIndex],t=q.length-1,v=this._getAdjacentMidpoints(l,f.segLength).sort();var w=v[0];var x=v[v.length-1];if(0===l){var H=this._getAdjacentVertices(t-1,t);l=f.relatedGraphic.geometry.getPoint(f.segIndex,H[0]);H=f.relatedGraphic.geometry.getPoint(f.segIndex,H[1]);l=new e({x:(l.x+H.x)/2,y:(l.y+H.y)/2,spatialReference:l.spatialReference.toJson()});f=new b(l,this._symbol2,this.graphic,f.segIndex,t-1,t,this,!0);q.splice(x,1,f)[0].destroy();q.splice(w,1)[0].destroy();for(v=
0;v<q.length-1;v++)w=q[v],--w.ptIndex,--w.segLength}else{H=this._getAdjacentVertices(w,t);l=f.relatedGraphic.geometry.getPoint(f.segIndex,H[0]);H=f.relatedGraphic.geometry.getPoint(f.segIndex,H[1]);l=new e({x:(l.x+H.x)/2,y:(l.y+H.y)/2,spatialReference:l.spatialReference.toJson()});f=new b(l,this._symbol2,this.graphic,f.segIndex,w,t,this,!0);x=q.splice(w,v.length,f);for(v=0;v<x.length;v++)x[v].destroy();for(v=0;v<w;v++)--q[v].segLength;for(v=w+1;v<q.length;v++)w=q[v],--w.ptIndex,--w.segLength}},_updateRelatedGraphic:function(f,
l,q,t,v,w,x,H){f=l.geometry;x?f.insertPoint(t,v+1,g.fromJson(q.toJson())):H?(f.removePoint(t,v),0===v&&f.setPoint(t,w-1,g.fromJson(f.getPoint(t,0).toJson()))):(f.setPoint(t,v,g.fromJson(q.toJson())),0===v&&f.setPoint(t,w,g.fromJson(q.toJson())));l.setGeometry(f)}});m("extend-esri")&&(u.setObject("toolbars._GraphicVertexEditor",c,a),u.setObject("toolbars._MultipointVertexEditor",c.MultipointVertexEditor,a),u.setObject("toolbars._PolylineVertexEditor",c.PolylineVertexEditor,a),u.setObject("toolbars._PolygonVertexEditor",
c.PolygonVertexEditor,a));return c})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q){g("dijit-legacy-requires")&&q(0,function(){G(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return r("dijit.Menu",l,{constructor:function(){this._bindings=
[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):u.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(t){return c.get(this._iframeContentDocument(t))||this._iframeContentDocument(t).__parent__||t.name&&document.frames[t.name]||null},_iframeContentDocument:function(t){return t.contentDocument||t.contentWindow&&t.contentWindow.document||
t.name&&document.frames[t.name]&&document.frames[t.name].document||null},bindDomNode:function(t){t=n.byId(t,this.ownerDocument);if("iframe"==t.tagName.toLowerCase()){var v=t;var w=this._iframeContentWindow(v);w=h.body(w.document)}else w=t==h.body(this.ownerDocument)?this.ownerDocument.documentElement:t;var x={node:t,iframe:v};m.set(t,"_dijitMenu"+this.id,this._bindings.push(x));var H=b.hitch(this,function(A){var z=this.selector,E=z?function(D){return e.selector(z,D)}:function(D){return D},J=this;
return[e(A,E(this.leftClickToOpen?"click":"contextmenu"),function(D){D.stopPropagation();D.preventDefault();(new Date).getTime()<J._lastKeyDown+500||J._scheduleOpen(this,v,{x:D.pageX,y:D.pageY},D.target)}),e(A,E("keydown"),function(D){if(93==D.keyCode||D.shiftKey&&D.keyCode==a.F10||J.leftClickToOpen&&D.keyCode==a.SPACE)D.stopPropagation(),D.preventDefault(),J._scheduleOpen(this,v,null,D.target),J._lastKeyDown=(new Date).getTime()})]});x.connects=w?H(w):[];v&&(x.onloadHandler=b.hitch(this,function(){var A=
this._iframeContentWindow(v);A=h.body(A.document);x.connects=H(A)}),v.addEventListener?v.addEventListener("load",x.onloadHandler,!1):v.attachEvent("onload",x.onloadHandler))},unBindDomNode:function(t){try{var v=n.byId(t,this.ownerDocument)}catch(A){return}t="_dijitMenu"+this.id;if(v&&m.has(v,t)){for(var w=m.get(v,t)-1,x=this._bindings[w],H;H=x.connects.pop();)H.remove();(H=x.iframe)&&(H.removeEventListener?H.removeEventListener("load",x.onloadHandler,!1):H.detachEvent("onload",x.onloadHandler));m.remove(v,
t);delete this._bindings[w]}},_scheduleOpen:function(t,v,w,x){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:x,delegatedTarget:t,iframe:v,coords:w})},1))},_openMyself:function(t){function v(){D.refocus&&L&&L.focus();f.close(D)}var w=t.target,x=t.iframe,H=t.coords,A=!H;this.currentTarget=t.delegatedTarget;if(H){if(x){t=k.position(x,!0);w=this._iframeContentWindow(x);w=k.docScroll(w.document);var z=d.getComputedStyle(x),E=d.toPixelValue,J=(g("ie")&&
g("quirks")?0:E(x,z.paddingLeft))+(g("ie")&&g("quirks")?E(x,z.borderLeftWidth):0);x=(g("ie")&&g("quirks")?0:E(x,z.paddingTop))+(g("ie")&&g("quirks")?E(x,z.borderTopWidth):0);H.x+=t.x+J-w.x;H.y+=t.y+x-w.y}}else H=k.position(w,!0),H.x+=10,H.y+=10;var D=this;x=this._focusManager.get("prevNode");t=this._focusManager.get("curNode");var L=!t||n.isDescendant(t,this.domNode)?x:t;f.open({popup:this,x:H.x,y:H.y,onExecute:v,onCancel:v,orient:this.isLeftToRight()?"L":"R"});this.focus();A||this.defer(function(){this._cleanUp(!0)});
this._onBlur=function(){this.inherited("_onBlur",arguments);f.close(this)}},destroy:function(){u.forEach(this._bindings,function(t){t&&this.unBindDomNode(t.node)},this);this.inherited(arguments)}})})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(G,u,r,n){return G("dijit.DropDownMenu",n,{templateString:r,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(m){this._moveToPopup(m);
m.stopPropagation();m.preventDefault()},_onLeftArrow:function(m){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else m.stopPropagation(),m.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(G,u,r,n,m,k,d,a,b,e,
g,h,c,f,l){return u("dijit._MenuBase",[h,l,f,c],{selected:null,_setSelectedAttr:function(q){this.selected!=q&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),q&&q._setSelected(!0),this._set("selected",q))},activated:!1,_setActivatedAttr:function(q){m.toggle(this.domNode,"dijitMenuActive",q);m.toggle(this.domNode,"dijitMenuPassive",!q);this._set("activated",q)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,childSelector:function(q){var t=
g.byNode(q);return q.parentNode==this.containerNode&&t&&t.focus},postCreate:function(){var q=this,t="string"==typeof this.childSelector?this.childSelector:k.hitch(this,"childSelector");this.own(a(this.containerNode,a.selector(t,d.enter),function(){q.onItemHover(g.byNode(this))}),a(this.containerNode,a.selector(t,d.leave),function(){q.onItemUnhover(g.byNode(this))}),a(this.containerNode,a.selector(t,e),function(v){q.onItemClick(g.byNode(this),v);v.stopPropagation()}),a(this.containerNode,a.selector(t,
"focusin"),function(){q._onItemFocus(g.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(q,t,v,w){this.inherited(arguments);if(q&&(-1==w||q.popup&&1==w))this.onItemClick(q,t)},_keyboardSearchCompare:function(q,t){return q.shortcutKey?t==q.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(q){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,
q);else(q=this._getTopMenu())&&q._isMenuBar&&q.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(q){this.activated?(this.set("selected",q),!q.popup||q.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(q)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(q,
{type:"click"})},this.passivePopupDelay));this._hoveredChild=q;q._set("hovering",!0)},_onChildDeselect:function(q){this._stopPopupTimer();this.currentPopupItem==q&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;q._closePopup()},this.popupDelay))},onItemUnhover:function(q){this._hoveredChild==q&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);q._set("hovering",
!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var q=this;q.parentMenu;q=q.parentMenu);return q},onItemClick:function(q,t){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(q);if(q.disabled)return!1;q.popup?(this.set("selected",q),this.set("activated",!0),t=/^key/.test(t._origType||
t.type)||0==t.clientX&&0==t.clientY,this._openItemPopup(q,t)):(this.onExecute(),q._onClick?q._onClick(t):q.onClick(t))},_openItemPopup:function(q,t){if(q!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var v=q.popup;v.parentMenu=this;this.own(this._mouseoverHandle=a.once(v.domNode,"mouseover",k.hitch(this,"_onPopupHover")));var w=this;q._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){t&&
w.focusChild(q);w._cleanUp()},onExecute:k.hitch(this,"_cleanUp",!0),onClose:function(){w._mouseoverHandle&&(w._mouseoverHandle.remove(),delete w._mouseoverHandle)}},t);this.currentPopupItem=q}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(n.set(this.selected.focusNode,"tabIndex",this.tabIndex),
this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(q){if(this._hoveredChild&&this._hoveredChild!=q)this.onItemUnhover(this._hoveredChild);this.set("selected",q)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(q){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);q&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(G,u,r,n,m,k,d,a,b,e){return u("dijit._KeyNavContainer",[b,e,a],{connectKeyNavHandlers:function(g,h){var c=this._keyNavCodes={},f=k.hitch(this,"focusPrev"),l=k.hitch(this,"focusNext");G.forEach(g,function(q){c[q]=f});G.forEach(h,function(q){c[q]=l});c[m.HOME]=k.hitch(this,"focusFirstChild");c[m.END]=k.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){n.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);G.forEach(this.getChildren(),
k.hitch(this,"_startupChild"))},addChild:function(g,h){this.inherited(arguments);this._startupChild(g)},_startupChild:function(g){g.set("tabIndex","-1")},_getFirst:function(){var g=this.getChildren();return g.length?g[0]:null},_getLast:function(){var g=this.getChildren();return g.length?g[g.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(g){return(g=
d.byNode(g))&&g.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(G,u,r,n,m,k,d,a){return u("dijit._KeyNavMixin",a,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);r.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var b=this._keyNavCodes={};b[n.HOME]=m.hitch(this,"focusFirstChild");b[n.END]=m.hitch(this,
"focusLastChild");b[this.isLeftToRight()?n.LEFT_ARROW:n.RIGHT_ARROW]=m.hitch(this,"_onLeftArrow");b[this.isLeftToRight()?n.RIGHT_ARROW:n.LEFT_ARROW]=m.hitch(this,"_onRightArrow");b[n.UP_ARROW]=m.hitch(this,"_onUpArrow");b[n.DOWN_ARROW]=m.hitch(this,"_onDownArrow")}var e=this;b="string"==typeof this.childSelector?this.childSelector:m.hitch(this,"childSelector");this.own(k(this.domNode,"keypress",m.hitch(this,"_onContainerKeypress")),k(this.domNode,"keydown",m.hitch(this,"_onContainerKeydown")),k(this.domNode,
"focus",m.hitch(this,"_onContainerFocus")),k(this.containerNode,k.selector(b,"focusin"),function(g){e._onChildFocus(d.getEnclosingWidget(this),g)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(b,e){b&&(this.focusedChild&&b!==this.focusedChild&&this._onChildBlur(this.focusedChild),b.set("tabIndex",this.tabIndex),b.focus(e?"end":"start"))},_onContainerFocus:function(b){b.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){r.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(b){r.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(b){b&&b!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),b.set("tabIndex",this.tabIndex),this.lastFocused=b,this._set("focusedChild",b))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(b,e,g,h){b&&this.focusChild(b)},_keyboardSearchCompare:function(b,e){var g=b.domNode;b=(b.label||(g.focusNode?
g.focusNode.label:"")||g.innerText||g.textContent||"").replace(/^\s+/,"").substr(0,e.length).toLowerCase();return e.length&&b==e?-1:0},_isFormElement:function(b){return"INPUT"===b.tagName||"TEXTAREA"===b.tagName||"SELECT"===b.tagName||"BUTTON"===b.tagName},_onContainerKeydown:function(b){if(!this._isFormElement(document.activeElement)){var e=this._keyNavCodes[b.keyCode];e?(e(b,this.focusedChild),b.stopPropagation(),b.preventDefault(),this._searchString=""):b.keyCode!=n.SPACE||!this._searchTimer||
b.ctrlKey||b.altKey||b.metaKey||(b.stopImmediatePropagation(),b.preventDefault(),this._keyboardSearch(b," "))}},_onContainerKeypress:function(b){this._isFormElement(document.activeElement)||b.charCode<=n.SPACE||b.ctrlKey||b.altKey||b.metaKey||(b.preventDefault(),b.stopPropagation(),this._keyboardSearch(b,String.fromCharCode(b.charCode).toLowerCase()))},_keyboardSearch:function(b,e){var g=null,h,c=0;m.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=e;var f=/^(.)\1*$/.test(this._searchString)?
1:this._searchString.length;h=this._searchString.substr(0,f);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var l=this.focusedChild||null;if(1==f||!l)if(l=this._getNextFocusableChild(l,1),!l)return;f=l;do{var q=this._keyboardSearchCompare(l,h);q&&0==c++&&(g=l);if(-1==q){c=-1;break}l=this._getNextFocusableChild(l,1)}while(l&&l!=f)})();this.onKeyboardSearch(g,b,h,c)},_onChildBlur:function(){},_getNextFocusableChild:function(b,e){var g=
b;do{if(b)b=this._getNext(b,e);else if(b=this[0<e?"_getFirst":"_getLast"](),!b)break;if(null!=b&&b!=g&&b.isFocusable())return b}while(b!=g);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(b,e){if(b)for(b=b.domNode;b;)if((b=b[0>e?"previousSibling":"nextSibling"])&&"getAttribute"in b){var g=d.byNode(b);if(g)return g}return null}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h){d=G("dijit.MenuItem"+(k("dojo-bidi")?"_NoBidi":""),[a,b,e,g],{templateString:h,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(c){this._set("label",c);var f="";var l=c.search(/{\S}/);if(0<=l){f=c.charAt(l+1);var q=c.substr(0,l);c=c.substr(l+3);l=q+f+c;c=q+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+f+"\x3c/span\x3e"+c}else l=c;this.domNode.setAttribute("aria-label",l+" "+this.accelKey);this.containerNode.innerHTML=c;this._set("shortcutKey",f)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(c){!c||"label"in this.params||this._set("label",c.innerHTML)},buildRendering:function(){this.inherited(arguments);r.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&r.set(this.accelKeyNode,"id",this.id+"_accel");u.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==k("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(c){}},_setSelected:function(c){n.toggle(this.domNode,
"dijitMenuItemSelected",c)},setLabel:function(c){m.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",c)},setDisabled:function(c){m.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",c)},_setDisabledAttr:function(c){this.focusNode.setAttribute("aria-disabled",c?"true":"false");this._set("disabled",c)},_setAccelKeyAttr:function(c){this.accelKeyNode&&(this.accelKeyNode.style.display=
c?"":"none",this.accelKeyNode.innerHTML=c,r.set(this.containerNode,"colSpan",c?"1":"2"));this._set("accelKey",c)}});k("dojo-bidi")&&(d=G("dijit.MenuItem",d,{_setLabelAttr:function(c){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return d})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(G,u){return G("dijit._Contained",null,{_getSibling:function(r){var n=this.getParent();return n&&n._getSiblingOfChild&&n._getSiblingOfChild(this,
"previous"==r?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var r=this.getParent();return r&&r.getIndexOfChild?r.getIndexOfChild(this):-1}})})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c){G=G(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(f,l,q,t,v,w,x,H){this.point=f;this.symbol=l;this.relatedGraphic=q;this.segIndex=t;this.ptIndex=v;this.segLength=w;this.editor=x;this.map=x.map;this._scratchGL=x.toolbar._scratchGL;this._placeholder=H||!1;this._type=q.geometry.type;this._init();this._enable()},refresh:function(f){if(f||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);
this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var f=new g(this.point.toJson());f=new h(f,this.symbol);switch(this._type){case "multipoint":f._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(f)}this.graphic=f},_enable:function(){var f=this.graphic.getDojoShape();f&&(f._hasMover=!0,this._moveable=this._getMoveable(f),
(f=f.getEventSource())&&m.set(f,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var f=this._moveable;if(f){r.disconnect(this._startHandle);r.disconnect(this._firstHandle);r.disconnect(this._movingHandle);r.disconnect(this._stopHandle);var l=f.shape;l&&(l=l.getEventSource())&&m.set(l,"cursor","inherit");f.destroy();this._moveable=null}},_needRefresh:function(){var f=this.graphic.getDojoShape(),l=!1;if(f)switch(this._type){case "multipoint":var q=this.relatedGraphic.getDojoShape();
q&&(q=q.children[this.ptIndex],f!==q&&(this.graphic._shape=q,l=!0));break;case "polyline":case "polygon":l=!f._hasMover}return l},_getMoveable:function(f){f=new k(f,n("mac")&&n("ff")&&!e("esri-touch")&&{leftButtonOnly:!0});this._startHandle=r.connect(f,"onMoveStart",this,this._moveStartHandler);this._firstHandle=r.connect(f,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=r.connect(f,"onMoving",this,this._movingHandler);this._stopHandle=r.connect(f,"onMoveStop",this,this._moveStopHandler);
return f},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(f){var l=this.map;l.snappingManager&&l.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();this._startTx=this.graphic.getDojoShape().getTransform();f.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,
this._getInfo())},_firstMoveHandler:function(f){var l=f.shape,q=this._getControlEdges(),t=this._scratchGL._div,v,w=[],x=f.host.shape._wrapOffsets[0]||0;for(v=0;v<q.length;v++){var H=q[v];H.x1+=x;H.x2+=x;w.push([t.createLine({x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2}).setStroke(this.editor._lineStroke),H.x1,H.y1,H.x2,H.y2])}l._lines=w;f.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(f,l,q){l=this.map;
var t;e("esri-pointer")?t=l.navigationManager.pointerEvents._processTouchEvent(q,q):q&&"pointermove"===q.type&&(t=b.prototype._processTouchEvent.call({map:l},q,q));t&&l.snappingManager&&l.snappingManager._onSnappingMouseMoveHandler(t);q=f.shape;f=q.getTransform();q=q._lines;for(t=0;t<q.length;t++)l=q[t],l[0].setShape({x1:l[1]+f.dx,y1:l[2]+f.dy,x2:l[3],y2:l[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),f)},_moveStopHandler:function(f){f=f.shape;var l=this.editor.toolbar,
q=f.getTransform(),t=this.map,v=this.graphic,w=l._geo?c.geographicToWebMercator(v.geometry):v.geometry;l._activateScrollWheel();var x,H=f._lines;if(H){for(x=0;x<H.length;x++)H[x][0].removeShape();f._lines=null}x=!1;H=!0;var A=this._getInfo();q&&(q.dx||q.dy)?this._placeholder&&(this._placeholder=!1,x=!0):H=!1;if(t.snappingManager)var z=t.snappingManager._snappingPoint;var E=[q,d.invert(this._startTx)];z=z||t.toMap(d.multiplyPoint(E,t.toScreen(w,!0)));t.snappingManager&&t.snappingManager._killOffSnapping();
f.setTransform(null);v.setGeometry(l._geo?c.webMercatorToGeographic(z,!0):z);this.constructor.onMoveStop(this,q);l.onVertexMoveStop(this.relatedGraphic,A,q);if(!H)l.onVertexClick(this.relatedGraphic,A);if(x)l.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var f=this.map,l=this.relatedGraphic.geometry,q=this.segIndex,t=this.ptIndex,v=this.segLength,w=this._scratchGL.getNavigationTransform(),x=w.dx;w=w.dy;var H=f.toScreen(this.graphic.geometry);f=H.x-x;H=H.y-w;var A=[];
l=this.editor._getControlPoints(this,l,q,t,v);l[0]&&A.push({x1:f,y1:H,x2:l[0].x-x,y2:l[0].y-w});l[1]&&A.push({x1:f,y1:H,x2:l[1].x-x,y2:l[1].y-w});return A}});e("extend-esri")&&u.setObject("toolbars.VertexMover",G,a);u.mixin(G,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return G})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),
function(G,u,r,n,m,k,d,a,b,e){G=G(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(g,h,c){this._graphic=g;this._map=h;this._toolbar=c;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(g){this._editBox?(r.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=r.connect(g.getLayer(),"onDblClick",this,function(h){this._map.navigationManager.setImmediateClick(!1);
h.graphic==g&&(n.stop(h),r.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,this._addTextBox(g))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(r.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(g,h){if(!this._editBox){if(!g.symbol.text){g.symbol.text="Tempt text";g.setSymbol(g.symbol);var c=""}var f=this._createInputTextStyle(g,
this._map);""!==c&&(c=h||g.symbol.text);this._editBox=k.create("input",{type:"text",value:c});a.set(this._editBox,f);d.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=r.connect(this._editBox,"onkeyup",u.hitch(this,function(q){q.keyCode!=b.ENTER&&q.keyCode!==b.TAB||this._disable()}));this._editBoxBlurHandler=r.connect(this._editBox,"onblur",u.hitch(this,function(q){this._disable()}));g.symbol.text="";g.setSymbol(g.symbol);
g.hide();var l=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",u.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(q){a.set(l,{left:this._editBoxLeft+q.delta.x+"px",top:this._editBoxTop+q.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(a.get(l,"left"));this._editBoxTop=parseFloat(a.get(l,"top"))});this.onEditStart(g,this._editBox);this._toolbar.onTextEditStart(g,
this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(r.disconnect(this._editBoxBlurHandler),this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&
(r.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(g,h){h=g.getDojoShape().getTransformedBoundingBox();var c=g.getLayer();c=c.hasLocalNavigationTransform()?{dx:0,dy:0}:c.getNavigationTransform();var f=g.symbol.font;return{"font-family":f.family,"font-size":f.size+"px","font-style":f.style,"font-variant":f.variant,"font-weight":f.weight,left:h[0].x+c.dx+"px",top:h[0].y+c.dy+"px",width:Math.abs(h[0].x-h[1].x)/Math.cos(g.symbol.angle/180*Math.PI)+"px"}},
_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var g=this._graphic.symbol;g.text=this._editBox.value;this._graphic.setSymbol(g)}else this._graphic.getLayer().remove(this._graphic)}});m("extend-esri")&&u.setObject("toolbars.TextEditor",G,e);return G})},"esri/tasks/geometry":function(){define("./GeometryService ./TrimExtendParameters ./BufferParameters ./AreasAndLengthsParameters ./LengthsParameters ./RelationParameters ./DensifyParameters ./GeneralizeParameters ./OffsetParameters ./DistanceParameters ./ProjectParameters".split(" "),
function(){return{}})},"esri/tasks/TrimExtendParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel".split(" "),function(G,u,r,n,m,k){G=G(null,{declaredClass:"esri.tasks.TrimExtendParameters",polylines:null,trimExtendTo:null,extendHow:null,toJson:function(){var d=r.map(this.polylines,function(b){return b.toJson()}),a={};a.polylines=n.toJson(d);a.trimExtendTo=n.toJson(this.trimExtendTo.toJson());a.sr=n.toJson(this.polylines[0].spatialReference.toJson());
a.extendHow=this.extendHow||0;return a}});u.mixin(G,{DEFAULT_CURVE_EXTENSION:0,RELOCATE_ENDS:1,KEEP_END_ATTRIBUTES:2,NO_END_ATTRIBUTES:4,NO_EXTEND_AT_FROM:8,NO_EXTEND_AT_TO:16});m("extend-esri")&&u.setObject("tasks.TrimExtendParameters",G,k);return G})},"esri/tasks/BufferParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/Polygon ../geometry/jsonUtils".split(" "),function(G,u,r,n,m,k,d,a){G=G(null,{declaredClass:"esri.tasks.BufferParameters",
geometries:null,outSpatialReference:null,bufferSpatialReference:null,distances:null,unit:null,unionResults:!1,geodesic:!1,toJson:function(){var b={unit:this.unit,unionResults:this.unionResults,geodesic:this.geodesic},e=this.distances,g=this.outSpatialReference,h=this.bufferSpatialReference,c=r.map(this.geometries,function(q){q="extent"===q.type?d.fromExtent(q):q;return q.toJson()},this),f=this.geometries;if(f&&0<f.length){var l="extent"===f[0].type?"esriGeometryPolygon":a.getJsonType(f[0]);b.geometries=
n.toJson({geometryType:l,geometries:c});b.inSR=f[0].spatialReference.wkid?f[0].spatialReference.wkid:n.toJson(f[0].spatialReference.toJson())}e&&(b.distances=e.join(","));g&&(b.outSR=g.wkid?g.wkid:n.toJson(g.toJson()));h&&(b.bufferSR=h.wkid?h.wkid:n.toJson(h.toJson()));return b}});m("extend-esri")&&u.setObject("tasks.BufferParameters",G,k);return G})},"esri/tasks/AreasAndLengthsParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel".split(" "),
function(G,u,r,n,m,k){G=G(null,{declaredClass:"esri.tasks.AreasAndLengthsParameters",polygons:null,lengthUnit:null,areaUnit:null,calculationType:null,toJson:function(){var d=r.map(this.polygons,function(b){return b.toJson()}),a={};a.polygons=n.toJson(d);d=this.polygons[0].spatialReference;a.sr=d.wkid?d.wkid:n.toJson(d.toJson());this.lengthUnit&&(a.lengthUnit=this.lengthUnit);this.areaUnit&&(u.isString(this.areaUnit)?a.areaUnit=n.toJson({areaUnit:this.areaUnit}):a.areaUnit=this.areaUnit);this.calculationType&&
(a.calculationType=this.calculationType);return a}});m("extend-esri")&&u.setObject("tasks.AreasAndLengthsParameters",G,k);return G})},"esri/tasks/LengthsParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel".split(" "),function(G,u,r,n,m,k){G=G(null,{declaredClass:"esri.tasks.LengthsParameters",polylines:null,lengthUnit:null,geodesic:null,calculationType:null,toJson:function(){var d=r.map(this.polylines,function(b){return b.toJson()}),
a={};a.polylines=n.toJson(d);d=this.polylines[0].spatialReference;a.sr=d.wkid?d.wkid:n.toJson(d.toJson());this.lengthUnit&&(a.lengthUnit=this.lengthUnit);this.geodesic&&(a.geodesic=this.geodesic);this.calculationType&&(a.calculationType=this.calculationType);return a}});m("extend-esri")&&u.setObject("tasks.LengthsParameters",G,k);return G})},"esri/tasks/RelationParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(G,u,r,n,m,k,d){G=G(null,{declaredClass:"esri.tasks.RelationParameters",geometries1:null,geometries2:null,relation:null,relationParam:null,toJson:function(){var a=r.map(this.geometries1,function(h){return h.toJson()}),b=r.map(this.geometries2,function(h){return h.toJson()}),e={},g=this.geometries1;g&&0<g.length&&(e.geometries1=n.toJson({geometryType:d.getJsonType(g[0]),geometries:a}),a=this.geometries1[0].spatialReference,e.sr=a.wkid?a.wkid:n.toJson(a.toJson()));(a=this.geometries2)&&0<a.length&&
(e.geometries2=n.toJson({geometryType:d.getJsonType(a[0]),geometries:b}));this.relation&&(e.relation=this.relation);this.relationParam&&(e.relationParam=this.relationParam);return e}});u.mixin(G,{SPATIAL_REL_CROSS:"esriGeometryRelationCross",SPATIAL_REL_DISJOINT:"esriGeometryRelationDisjoint",SPATIAL_REL_IN:"esriGeometryRelationIn",SPATIAL_REL_INTERIORINTERSECTION:"esriGeometryRelationInteriorIntersection",SPATIAL_REL_INTERSECTION:"esriGeometryRelationIntersection",SPATIAL_REL_COINCIDENCE:"esriGeometryRelationLineCoincidence",
SPATIAL_REL_LINETOUCH:"esriGeometryRelationLineTouch",SPATIAL_REL_OVERLAP:"esriGeometryRelationOverlap",SPATIAL_REL_POINTTOUCH:"esriGeometryRelationPointTouch",SPATIAL_REL_TOUCH:"esriGeometryRelationTouch",SPATIAL_REL_WITHIN:"esriGeometryRelationWithin",SPATIAL_REL_RELATION:"esriGeometryRelationRelation"});m("extend-esri")&&u.setObject("tasks.RelationParameters",G,k);return G})},"esri/tasks/DensifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(G,u,r,n,m,k,d){G=G(null,{declaredClass:"esri.tasks.DensifyParameters",geometries:null,geodesic:null,lengthUnit:null,maxSegmentLength:null,toJson:function(){var a=r.map(this.geometries,function(e){return e.toJson()}),b={};this.geometries&&0<this.geometries.length&&(b.geometries=n.toJson({geometryType:d.getJsonType(this.geometries[0]),geometries:a}),b.sr=n.toJson(this.geometries[0].spatialReference.toJson()));this.geodesic&&(b.geodesic=this.geodesic);this.lengthUnit&&(b.lengthUnit=this.lengthUnit);
this.maxSegmentLength&&(b.maxSegmentLength=this.maxSegmentLength);return b}});m("extend-esri")&&u.setObject("tasks.DensifyParameters",G,k);return G})},"esri/tasks/GeneralizeParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(G,u,r,n,m,k,d){G=G(null,{declaredClass:"esri.tasks.GeneralizeParameters",geometries:null,deviationUnit:null,maxDeviation:null,toJson:function(){var a=r.map(this.geometries,
function(e){return e.toJson()}),b={};this.geometries&&0<this.geometries.length&&(b.geometries=n.toJson({geometryType:d.getJsonType(this.geometries[0]),geometries:a}),b.sr=n.toJson(this.geometries[0].spatialReference.toJson()));this.deviationUnit&&(b.deviationUnit=this.deviationUnit);this.maxDeviation&&(b.maxDeviation=this.maxDeviation);return b}});m("extend-esri")&&u.setObject("tasks.GeneralizeParameters",G,k);return G})},"esri/tasks/OffsetParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(G,u,r,n,m,k,d){G=G(null,{declaredClass:"esri.tasks.OffsetParameters",geometries:null,bevelRatio:null,offsetDistance:null,offsetHow:null,offsetUnit:null,toJson:function(){var a=r.map(this.geometries,function(e){return e.toJson()}),b={};this.geometries&&0<this.geometries.length&&(b.geometries=n.toJson({geometryType:d.getJsonType(this.geometries[0]),geometries:a}),b.sr=n.toJson(this.geometries[0].spatialReference.toJson()));this.bevelRatio&&(b.bevelRatio=this.bevelRatio);this.offsetDistance&&
(b.offsetDistance=this.offsetDistance);this.offsetHow&&(b.offsetHow=this.offsetHow);this.offsetUnit&&(b.offsetUnit=this.offsetUnit);return b}});u.mixin(G,{OFFSET_BEVELLED:"esriGeometryOffsetBevelled",OFFSET_MITERED:"esriGeometryOffsetMitered",OFFSET_ROUNDED:"esriGeometryOffsetRounded"});m("extend-esri")&&u.setObject("tasks.OffsetParameters",G,k);return G})},"esri/tasks/DistanceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),
function(G,u,r,n,m,k){G=G(null,{declaredClass:"esri.tasks.DistanceParameters",geometry1:null,geometry2:null,distanceUnit:null,geodesic:null,toJson:function(){var d={},a=this.geometry1;a&&(d.geometry1=r.toJson({geometryType:k.getJsonType(a),geometry:a}));if(a=this.geometry2)d.geometry2=r.toJson({geometryType:k.getJsonType(a),geometry:a});d.sr=r.toJson(this.geometry1.spatialReference.toJson());this.distanceUnit&&(d.distanceUnit=this.distanceUnit);this.geodesic&&(d.geodesic=this.geodesic);return d}});
n("extend-esri")&&u.setObject("tasks.DistanceParameters",G,m);return G})},"esri/tasks/ProjectParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(G,u,r,n,m,k,d,a){G=G(null,{declaredClass:"esri.tasks.ProjectParameters",geometries:null,outSR:null,transformation:null,transformForward:null,toJson:function(){var b=r.map(this.geometries,function(g){return g.toJson()}),e={};e.outSR=this.outSR.wkid||
n.toJson(this.outSR.toJson());e.inSR=this.geometries[0].spatialReference.wkid||n.toJson(this.geometries[0].spatialReference.toJson());e.geometries=n.toJson({geometryType:a.getJsonType(this.geometries[0]),geometries:b});this.transformation&&(e.transformation=this.transformation.wkid||n.toJson(this.transformation));d.isDefined(this.transformForward)&&(e.transformForward=this.transformForward);return e}});m("extend-esri")&&u.setObject("tasks.ProjectParameters",G,k);return G})},"esri/dijit/AttributeInspector":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/sniff dojo/_base/kernel dojo/has dojo/dom-style dojo/dom-construct ../kernel ../lang ../domUtils ../layers/InheritedDomain ../layers/FeatureLayer dojo/i18n!../nls/jsapi dojo/fx dojox/gfx dijit/_Widget dijit/_Templated dijit/Editor dijit/_editor/plugins/LinkDialog dijit/_editor/plugins/TextColor ./_EventedWidget ./editing/AttachmentEditor ./editing/Util ../tasks/query dijit/form/DateTextBox dijit/form/TextBox dijit/form/NumberTextBox dijit/form/FilteringSelect dijit/form/NumberSpinner dijit/form/Button dijit/form/SimpleTextarea dijit/form/ValidationTextBox dijit/form/TimeTextBox dijit/Tooltip dojo/data/ItemFileReadStore dojox/date/islamic dojox/date/islamic/Date dojox/date/islamic/locale dojo/text!./templates/AttributeInspector.html".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z,E,J,D,L,C,N,S,F,T,y,B,I,P,X,Y,aa,Z,fa){var K=G([z,v,w],{declaredClass:"esri.dijit.AttributeInspector",widgetsInTemplate:!0,templateString:fa,onUpdate:function(){},onDelete:function(){},onAttributeChange:function(){},onNext:function(){},onReset:function(){},onCancel:function(){},_navMessage:"( ${idx} ${of} ${numFeatures} )",_currentAttributeFieldName:null,_aiConnects:[],_selection:[],_toolTips:[],_numFeatures:0,_featureIdx:0,_currentLInfo:null,
_currentFeature:null,_rollbackInfo:null,_eventMap:{update:!0,"delete":["feature"],"attribute-change":["feature","fieldName","fieldValue"],next:["feature"],reset:!0,cancel:!0},_defaultRichTextPlugins:"bold italic underline foreColor hiliteColor | justifyLeft justifyCenter justifyRight justifyFull | insertOrderedList insertUnorderedList indent outdent | createLink".split(" "),css:{label:"atiLabel",field:"atiField",textArea:"atiTextAreaField",richText:"atiRichTextField",attachmentEditor:"atiAttachmentEditor",
red:"atiRequiredField"},constructor:function(R,U){u.mixin(this,l.widgets.attributeInspector);R=R||{};R.featureLayer||R.layerInfos||console.error("esri.AttributeInspector: please provide correct parameter in the constructor");this._datePackage=this._getDatePackage(R);this._layerInfos=R.layerInfos||[{featureLayer:R.featureLayer,options:R.options||[]}];this._layerInfos=r.filter(this._layerInfos,function(ba){return!ba.disableAttributeUpdate});this._hideNavButtons=R.hideNavButtons||!1},postCreate:function(){if(r.every(this._layerInfos,
function(U){return U.featureLayer.loaded}))this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature();else{var R=this._layerInfos.length;r.forEach(this._layerInfos,function(U){U=U.featureLayer;if(U.loaded)R--;else var ba=n.connect(U,"onLoad",this,function(Q){n.disconnect(ba);ba=null;R--;R||(this._initLayerInfos(),this._createAttachmentEditor(),this.onFirstFeature())})},this)}},destroy:function(){this._destroyAttributeTable();r.forEach(this._aiConnects,n.disconnect);delete this._aiConnects;
this._attachmentEditor&&(this._attachmentEditor.destroy(),delete this._attachmentEditor);delete this._layerInfos;this._selection=this._currentFeature=this._currentLInfo=this._attributes=this._layerInfos=null;this.inherited(arguments)},refresh:function(){this._updateSelection()},first:function(){this.onFirstFeature()},last:function(){this.onLastFeature()},next:function(){this.onNextFeature()},previous:function(){this.onPreviousFeature()},showFeature:function(R,U){U&&(this._createOnlyFirstTime=!0);
this._updateSelection([R],U);this._updateUI()},onLayerSelectionChange:function(R,U,ba){this._createOnlyFirstTime=!1;this._featureIdx=ba===f.SELECTION_NEW?0:this._featureIdx;this._updateSelection();this._updateUI()},onLayerSelectionClear:function(){!this._selection||0>=this._selection.length||(this._featureIdx=this._numFeatures=0,this._selection=[],this._currentLInfo=this._currentFeature=null,this._updateUI())},onLayerUpdateEnd:function(R,U,ba,Q){},onLayerError:function(R,U,ba,Q){},onLayerEditsError:function(R,
U,ba,Q){},onLayerEditsComplete:function(R,U,ba,Q){Q=Q||[];if(Q.length){var ea=this._selection,la=R.featureLayer.objectIdField;r.forEach(Q,u.hitch(this,function(M){r.some(ea,u.hitch(this,function(W,da){if(W.attributes[la]!==M.objectId)return!1;this._selection.splice(da,1);return!0}))}))}U=U||[];U.length&&(this._selection=J.findFeatures(U,R.featureLayer),this._featureIdx=0);Q=this._numFeatures=(this._selection=J.sortFeaturesById(this._layerInfos,this._selection))?this._selection.length:0;if(U.length){if(U=
Q?this._selection[this._featureIdx]:null)Q=U.getLayer().getEditCapabilities(),Q.canCreate&&!Q.canUpdate||this._showFeature(U);this._updateUI()}ba=ba||[];if(ba.length){var ma=this._rollbackInfo;r.forEach(ba,function(M){var W=J.findFeatures(ba,R.featureLayer)[0];if(!M.success&&W.attributes[R.featureLayer.objectIdField]===M.objectId&&ma){var da=ma.field;M=ma.graphic.attributes[da.name];var ja=r.filter(this._currentLInfo.fieldInfos,function(ia){return ia.fieldName===da.name},this)[0].dijit;W.attributes[da.name]=
M;"esriFieldTypeDate"===da.type&&(M=new Date(M));this._setValue(ja,M)}},this)}this._rollbackInfo=null},onFieldValueChange:function(R,U){var ba=R.field,Q=R.dijit,ea=this._currentFeature,la=this._currentLInfo,ma=ba.name;R=this._isFieldRequired(ba,R);if(""===Q.displayedValue||"dijit.form.ValidationTextBox"!==Q.declaredClass||Q.isValid())if(""!==Q.displayedValue&&Q.displayedValue!==U&&Q.isValid&&!Q.isValid())this._setValue(Q,ea.attributes[ba.name]);else{var M=!("esriFieldTypeInteger"!==ba.type&&"esriFieldTypeSmallInteger"!==
ba.type&&"esriFieldTypeSingle"!==ba.type&&"esriFieldTypeDouble"!==ba.type);if(R&&(null===U||""===U||"undefined"===typeof U||M&&isNaN(U))){ma=ea.attributes[ba.name];if("esriFieldTypeDate"===ba.type&&(ma=new Date(ma),Q instanceof Array)){this._setValue(Q[0],ma);this._setValue(Q[1],ma);return}this._setValue(Q,ma)}else{if(M){if(isNaN(U)||""===U)U=null;M&&null!==U&&(U=Number(U))}"esriFieldTypeDate"===ba.type&&(Q instanceof Array?(U=Q[0].getValue(),Q=Q[1].getValue(),U=U&&Q?new Date(U.getFullYear(),U.getMonth(),
U.getDate(),Q.getHours(),Q.getMinutes(),Q.getSeconds(),Q.getMilliseconds()):U||Q||null):(U=Q.getValue(),ba.domain&&(U=Number(U))),U=U&&U.getTime?U.getTime():U&&U.toGregorian?U.toGregorian().getTime():U);if(this._currentFeature.attributes[ba.name]!==U){if(ma===la.typeIdField){var W=this._findFirst(la.types,"id",U);r.forEach(la.fieldInfos,function(da){(ba=da.field)&&ba.name!==la.typeIdField&&(da=da.dijit,this._setFieldDomain(da,W,ba)&&da&&(this._setValue(da,ea.attributes[ba.name]+""),!1===da.isValid()&&
this._setValue(da,null)))},this)}this.onAttributeChange(ea,ma,U)}}}else this._setValue(Q,ea.attributes[ba.name])},onDeleteBtn:function(R){this._deleteFeature()},onNextFeature:function(R){this._onNextFeature(1)},onPreviousFeature:function(R){this._onNextFeature(-1)},onFirstFeature:function(R){this._onNextFeature(-1*this._featureIdx)},onLastFeature:function(R){this._onNextFeature(this._numFeatures-1-this._featureIdx)},_initLayerInfos:function(){var R=this._layerInfos;this._editorTrackingInfos={};r.forEach(R,
this._initLayerInfo,this)},_initLayerInfo:function(R){var U=R.featureLayer,ba;this._userIds={};var Q=U.id;U.credential&&(this._userIds[Q]=U.credential.userId);R.userId&&(this._userIds[Q]=R.userId);this._connect(U,"onSelectionComplete",u.hitch(this,"onLayerSelectionChange",R));this._connect(U,"onSelectionClear",u.hitch(this,"onLayerSelectionClear",R));this._connect(U,"onEditsComplete",u.hitch(this,"onLayerEditsComplete",R));this._connect(U,"error",u.hitch(this,"onLayerError",R));this._connect(U,"onUpdateEnd",
u.hitch(this,"onLayerUpdateEnd",R));R.showAttachments=U.hasAttachments?g.isDefined(R.showAttachments)?R.showAttachments:!0:!1;R.hideFields=R.hideFields||[];R.htmlFields=R.htmlFields||[];R.isEditable=U.isEditable()?g.isDefined(R.isEditable)?R.isEditable:!0:!1;R.typeIdField=U.typeIdField;R.layerId=U.id;R.types=U.types;U.globalIdField&&((ba=this._findFirst(R.fieldInfos,"fieldName",U.globalIdField))||R.showGlobalID||R.hideFields.push(U.globalIdField));(Q=this._findFirst(R.fieldInfos,"fieldName",U.objectIdField))||
R.showObjectID||R.hideFields.push(U.objectIdField);var ea=this._getFields(R.featureLayer);if(ea){var la=R.fieldInfos||[];la=r.map(la,function(ma){return u.mixin({},ma)});la.length?R.fieldInfos=r.filter(r.map(la,u.hitch(this,function(ma){var M=ma.stringFieldOption||(this._isInFields(ma.fieldName,R.htmlFields)?K.STRING_FIELD_OPTION_RICHTEXT:K.STRING_FIELD_OPTION_TEXTBOX);return u.mixin(ma,{field:this._findFirst(ea,"name",ma.fieldName),stringFieldOption:M})})),"return item.field;"):(ea=r.filter(ea,u.hitch(this,
function(ma){return!this._isInFields(ma.name,R.hideFields)})),R.fieldInfos=r.map(ea,u.hitch(this,function(ma){var M=this._isInFields(ma.name,R.htmlFields)?K.STRING_FIELD_OPTION_RICHTEXT:K.STRING_FIELD_OPTION_TEXTBOX;return{fieldName:ma.name,field:ma,stringFieldOption:M}})));R.showGlobalID&&!ba&&la.push(this._findFirst(ea,"name",U.globalIdField));R.showObjectID&&!Q&&la.push(this._findFirst(ea,"name",U.objectIdField));ba=[];U.editFieldsInfo&&(U.editFieldsInfo.creatorField&&ba.push(U.editFieldsInfo.creatorField),
U.editFieldsInfo.creationDateField&&ba.push(U.editFieldsInfo.creationDateField),U.editFieldsInfo.editorField&&ba.push(U.editFieldsInfo.editorField),U.editFieldsInfo.editDateField&&ba.push(U.editFieldsInfo.editDateField));this._editorTrackingInfos[U.id]=ba}},_createAttachmentEditor:function(){this._attachmentEditor=null;var R=r.filter(this._layerInfos,function(U){return U.showAttachments});R&&R.length&&(this._attachmentEditor=new E({"class":this.css.attachmentEditor},this.attachmentEditor),this._attachmentEditor.startup())},
_setCurrentLInfo:function(R){var U=this._currentLInfo?this._currentLInfo.featureLayer:null,ba=R.featureLayer;if(U&&U.id===ba.id&&!U.ownershipBasedAccessControlForFeatures&&(U=ba.getEditCapabilities(),!U.canCreate||U.canUpdate))return;this._currentLInfo=R;this._createTable()},_updateSelection:function(R,U){this._selection=R||[];r.forEach(this._layerInfos,this._getSelection,this);this._selection=J.sortFeaturesById(this._layerInfos,this._selection);this._numFeatures=this._selection.length;this._showFeature(this._numFeatures?
this._selection[this._featureIdx]:null,U)},_getSelection:function(R){R=R.featureLayer.getSelectedFeatures();this._selection=this._selection.concat(R)},_updateUI:function(){var R=this._numFeatures,U=this._currentLInfo;this.layerName.innerHTML=U&&0!==R?U.featureLayer?U.featureLayer.name:"":this.NLS_noFeaturesSelected;a.set(this.attributeTable,"display",R?"":"none");a.set(this.editButtons,"display",R?"":"none");a.set(this.navButtons,"display",!this._hideNavButtons&&1<R?"":"none");this.navMessage.innerHTML=
g.substitute({idx:this._featureIdx+1,of:this.NLS_of,numFeatures:this._numFeatures},this._navMessage);this._attachmentEditor&&a.set(this._attachmentEditor.domNode,"display",U&&U.showAttachments&&R?"":"none");a.set(this.deleteBtn.domNode,"display",U&&!1===U.showDeleteButton||!this._canDelete?"none":"");this.domNode.parentNode&&0<this.domNode.parentNode.scrollTop&&(this.domNode.parentNode.scrollTop=0)},_onNextFeature:function(R){this._featureIdx+=R;0>this._featureIdx?this._featureIdx=this._numFeatures-
1:this._featureIdx>=this._numFeatures&&(this._featureIdx=0);R=this._selection.length?this._selection[this._featureIdx]:null;this._showFeature(R);this._updateUI();this.onNext(R)},_deleteFeature:function(){this.onDelete(this._currentFeature)},_showFeature:function(R,U){if(R){this._currentFeature=R;U=U?U:R.getLayer();var ba=U.getEditCapabilities({feature:R,userId:this._userIds[U.id]});this._canUpdate=ba.canUpdate;this._canDelete=ba.canDelete;if(ba=this._getLInfoFromFeatureLayer(U)){this._setCurrentLInfo(ba);
var Q=R.attributes,ea=this._findFirst(ba.types,"id",Q[ba.typeIdField]),la=null;r.forEach(ba.fieldInfos,function(ma){la=ma.field;var M=[];ma.dijit&&1<ma.dijit.length?r.forEach(ma.dijit,function(W){M.push(W)}):M.push(ma.dijit);r.forEach(M,u.hitch(this,function(W){if(W){var da=this._setFieldDomain(W,ea,la),ja=Q[la.name];ja=ja&&da&&da.codedValues&&da.codedValues.length?da.codedValues[ja]?da.codedValues[ja].name:ja:ja;g.isDefined(ja)||(ja="");"dijit.form.DateTextBox"===W.declaredClass||"dijit.form.TimeTextBox"===
W.declaredClass?ja=""===ja?null:new Date(ja):"dijit.form.FilteringSelect"===W.declaredClass&&(W._lastValueReported=null,ja=Q[la.name]+"");try{this._setValue(W,ja),"dijit.form.FilteringSelect"===W.declaredClass&&!1===W.isValid()&&this._setValue(W,null)}catch(ia){W.set("displayedValue",this.NLS_errorInvalid,!1)}}}))},this);this._attachmentEditor&&ba.showAttachments&&this._attachmentEditor.showAttachments(this._currentFeature,U);(R=U.getEditSummary(R))?(this.editorTrackingInfoDiv.innerHTML=R,h.show(this.editorTrackingInfoDiv)):
h.hide(this.editorTrackingInfoDiv)}}},_setFieldDomain:function(R,U,ba){if(!R)return null;var Q=ba.domain;U&&U.domains&&U.domains[ba.name]&&!1===U.domains[ba.name]instanceof c&&(Q=U.domains[ba.name]);if(!Q)return null;Q.codedValues&&0<Q.codedValues.length?(R.set("store",this._toStore(r.map(Q.codedValues,function(ea){return{id:ea.code+"",name:ea.name}}))),this._setValue(R,Q.codedValues[0].code+"")):(R.constraints={min:g.isDefined(Q.minValue)?Q.minValue:Number.MIN_VALUE,max:g.isDefined(Q.maxValue)?Q.maxValue:
Number.MAX_VALUE},this._setValue(R,R.constraints.min));return Q},_setValue:function(R,U){R.set&&(R._onChangeActive=!1,R.set("value",U,!0),R._onChangeActive=!0)},_getFields:function(R){var U=R._getOutFields();if(!U)return null;R=R.fields;return"*"==U?R:r.filter(r.map(U,u.hitch(this,"_findFirst",R,"name")),g.isDefined)},_isInFields:function(R,U){return R&&(U||U.length)?r.some(U,function(ba){return ba.toLowerCase()===R.toLowerCase()}):!1},_isFieldNullable:function(R,U){return!(!1===R.nullable||U.field&&
!1===U.field.nullable)},_isFieldRequired:function(R,U){return!1!==R.editable&&!1!==U.isEditable&&!this._isFieldNullable(R,U)},_findFirst:function(R,U,ba){return(R=r.filter(R,function(Q){return Q.hasOwnProperty(U)&&Q[U]===ba}))&&R.length?R[0]:null},_getLInfoFromFeatureLayer:function(R){return this._findFirst(this._layerInfos,"layerId",R?R.id:null)},_createTable:function(){this._destroyAttributeTable();this.attributeTable.innerHTML="";this._attributes=b.create("table",{cellspacing:"0",cellpadding:"0"},
this.attributeTable);var R=b.create("tbody",null,this._attributes),U=this._currentLInfo,ba=this._findFirst(U.types,"id",this._currentFeature.attributes[U.typeIdField]);r.forEach(U.fieldInfos,u.hitch(this,"_createField",ba,R),this);this._createOnlyFirstTime=!1},_createField:function(R,U,ba){var Q=this._currentLInfo,ea=ba.field;if(!this._isInFields(ea.name,Q.hideFields)&&!this._isInFields(ea.name,this._editorTrackingInfos[Q.featureLayer.id])){var la=!1,ma;U=b.create("tr",null,U);var M=b.create("td",
{innerHTML:ba.label||ea.alias||ea.name,"class":this.css.label,"data-fieldname":ea.name},U);this._isFieldRequired(ea,ba)&&b.create("span",{"class":this.css.red,innerHTML:" *"},M);U=b.create("td",null,U);if(ba.customField){b.place(ba.customField.domNode||ba.customField,b.create("div",null,U),"first");var W=ba.customField}else if(!1===Q.isEditable||!1===ea.editable||!1===ba.isEditable||"esriFieldTypeOID"===ea.type||"esriFieldTypeGlobalID"===ea.type||!this._canUpdate&&!this._createOnlyFirstTime)la=!0;
Q=Q.typeIdField&&ea.name.toLowerCase()==Q.typeIdField.toLowerCase();M=!!this._getDomainForField(ea,R);!W&&Q?W=this._createTypeField(ea,ba,U):!W&&M&&(W=this._createDomainField(ea,ba,R,U));if(!W)switch(ea.type){case "esriFieldTypeString":W=this._createStringField(ea,ba,U);break;case "esriFieldTypeDate":W=this._createDateField(ea,ba,U);ba.format&&ba.format.time&&(ma=this._createTimeField(ea,ba,U));break;case "esriFieldTypeInteger":case "esriFieldTypeSmallInteger":W=this._createIntField(ea,ba,U);break;
case "esriFieldTypeSingle":case "esriFieldTypeDouble":W=this._createFltField(ea,ba,U);break;default:W=this._createStringField(ea,ba,U)}ba.tooltip&&ba.tooltip.length&&this._toolTips.push(new P({connectId:[W.id],label:ba.tooltip}));W.onChange=u.hitch(this,"onFieldValueChange",ba);W.set("disabled",la);ma?(ba.dijit=[W,ma],ma.onChange=u.hitch(this,"onFieldValueChange",ba),ma.set("disabled",la)):ba.dijit=W}},_createTypeField:function(R,U,ba){ba=b.create("div",null,ba);var Q=R.domain;return Q&&"range"===
Q.type&&Q.minValue===Q.maxValue?new B({"class":this.css.field,trim:!0,maxLength:R.length,name:R.alias||R.name,required:this._isFieldRequired(R,U)},ba):new S({"class":this.css.field,name:R.alias||R.name,required:this._isFieldRequired(R,U),store:this._toStore(r.map(this._currentLInfo.types,function(ea){return{id:ea.id,name:ea.name}})),searchAttr:"name"},ba)},_getDomainForField:function(R,U){var ba=R.domain;(R=R.name)&&U&&U.domains&&U.domains[R]&&!1===U.domains[R]instanceof c&&(ba=U.domains[R]);return ba||
null},_createDomainField:function(R,U,ba,Q){ba=this._getDomainForField(R,ba);Q=b.create("div",null,Q);return ba.codedValues?new S({"class":this.css.field,name:R.alias||R.name,searchAttr:"name",required:this._isFieldRequired(R,U)},Q):new F({"class":this.css.field},Q)},_createStringField:function(R,U,ba){ba=b.create("div",null,ba);var Q={trim:!0,maxLength:R.length,required:this._isFieldRequired(R,U)};if(U.stringFieldOption===K.STRING_FIELD_OPTION_TEXTAREA)return Q["class"]=this.css.field+" "+this.css.textArea,
new y(Q,ba);if(U.stringFieldOption===K.STRING_FIELD_OPTION_RICHTEXT)return Q["class"]=this.css.field+" "+this.css.richText,Q.height="100%",Q.width="100%",Q.plugins=U.richTextPlugins||this._defaultRichTextPlugins,ba=new x(Q,ba),ba.startup(),ba;var ea=this;Q.validator=function(la,ma){this._maskValidSubsetError=!1;this._hasBeenBlurred=!0;return ea._isFieldNullable(R,U)||!(""===la||null===la)};return new B(Q,ba)},_createTimeField:function(R,U,ba){ba=b.create("div",null,ba);R={"class":this.css.field,trim:!0,
required:this._isFieldRequired(R,U),constraints:{formatLength:"medium"}};this._datePackage&&(R.datePackage=this._datePackage);return new I(R,ba)},_createDateField:function(R,U,ba){ba=b.create("div",null,ba);R={"class":this.css.field,trim:!0,required:this._isFieldRequired(R,U)};this._datePackage&&(R.datePackage=this._datePackage);return new L(R,ba)},_createIntField:function(R,U,ba){ba=b.create("div",null,ba);return new N({"class":this.css.field,constraints:"esriFieldTypeSmallInteger"===R.type?{min:-32768,
max:32767,places:0}:{places:0},trim:!0,invalidMessage:this.NLS_validationInt,required:this._isFieldRequired(R,U)},ba)},_createFltField:function(R,U,ba){ba=b.create("div",null,ba);return new N({"class":this.css.field,constraints:{max:Infinity,min:-Infinity,places:"0,20"},trim:!0,invalidMessage:this.NLS_validationFlt,required:this._isFieldRequired(R,U)},ba)},_toStore:function(R){return new X({data:{identifier:"id",label:"name",items:R}})},_connect:function(R,U,ba){this._aiConnects.push(n.connect(R,
U,ba))},_getDatePackage:function(R){return null===R.datePackage?null:R.datePackage?R.datePackage:"ar"===k.locale?"dojox.date.islamic":null},_destroyAttributeTable:function(){r.forEach(this._layerInfos,function(R){r.forEach(R.fieldInfos,function(U){var ba=U.dijit;if(ba){ba._onChangeHandle=null;if(U.customField)return;ba instanceof Array?r.forEach(ba,u.hitch(this,function(Q){Q.destroyRecursive?Q.destroyRecursive():Q.destroy&&Q.destroy();Q._onChangeHandle=null})):ba.destroyRecursive?ba.destroyRecursive():
ba.destroy&&ba.destroy()}U.dijit=null},this)},this);r.forEach(this._toolTips,function(R){R.destroy()});this._toolTips=[];this._attributes&&b.destroy(this._attributes)}});u.mixin(K,{STRING_FIELD_OPTION_RICHTEXT:"richtext",STRING_FIELD_OPTION_TEXTAREA:"textarea",STRING_FIELD_OPTION_TEXTBOX:"textbox"});d("extend-esri")&&u.setObject("dijit.AttributeInspector",K,e);return K})},"dijit/Editor":function(){define("require dojo/_base/array dojo/_base/declare dojo/Deferred dojo/i18n dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/string dojo/topic ./_Container ./Toolbar ./ToolbarSeparator ./layout/_LayoutWidget ./form/ToggleButton ./_editor/_Plugin ./_editor/plugins/EnterKeyHandling ./_editor/html ./_editor/range ./_editor/RichText ./main dojo/i18n!./_editor/nls/commands".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z,E,J){function D(C){return new x({command:C.name})}function L(C){return new x({buttonClass:w,command:C.name})}r=r("dijit.Editor",E,{plugins:null,extraPlugins:null,constructor:function(){g.isArray(this.plugins)||(this.plugins=["undo","redo","|","cut","copy","paste","|","bold","italic","underline","strikethrough","|","insertOrderedList","insertUnorderedList","indent","outdent","|","justifyLeft","justifyRight","justifyCenter","justifyFull",H]);this._plugins=
[];this._editInterval=1E3*this.editActionInterval;if(h("ie")||h("trident")||h("edge"))this.events.push("onBeforeDeactivate"),this.events.push("onBeforeActivate")},postMixInProperties:function(){this.setValueDeferred=new n;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._steps=this._steps.slice(0);this._undoedSteps=this._undoedSteps.slice(0);g.isArray(this.extraPlugins)&&(this.plugins=this.plugins.concat(this.extraPlugins));this.commands=m.getLocalization("dijit._editor",
"commands",this.lang);h("webkit")&&b.set(this.domNode,"KhtmlUserSelect","none")},startup:function(){this.inherited(arguments);this.toolbar||(this.toolbar=new q({ownerDocument:this.ownerDocument,dir:this.dir,lang:this.lang,"aria-label":this.id}),this.header.appendChild(this.toolbar.domNode));u.forEach(this.plugins,this.addPlugin,this);this.setValueDeferred.resolve(!0);d.add(this.iframe.parentNode,"dijitEditorIFrameContainer");d.add(this.iframe,"dijitEditorIFrame");k.set(this.iframe,"allowTransparency",
!0);this.toolbar.startup();this.onNormalizedDisplayChanged()},destroy:function(){u.forEach(this._plugins,function(C){C&&C.destroy&&C.destroy()});this._plugins=[];this.toolbar.destroyRecursive();delete this.toolbar;this.inherited(arguments)},addPlugin:function(C,N){var S=g.isString(C)?{name:C}:g.isFunction(C)?{ctor:C}:C;if(!S.setEditor){var F={args:S,plugin:null,editor:this};S.name&&(x.registry[S.name]?F.plugin=x.registry[S.name](S):f.publish(J._scopeName+".Editor.getPlugin",F));if(!F.plugin)try{var T=
S.ctor||g.getObject(S.name)||G(S.name);T&&(F.plugin=new T(S))}catch(y){throw Error(this.id+": cannot find plugin ["+S.name+"]");}if(!F.plugin)throw Error(this.id+": cannot find plugin ["+S.name+"]");C=F.plugin}1<arguments.length?this._plugins[N]=C:this._plugins.push(C);C.setEditor(this);g.isFunction(C.setToolbar)&&C.setToolbar(this.toolbar)},resize:function(C){C&&v.prototype.resize.apply(this,arguments)},layout:function(){var C=this._contentBox.h-(this.getHeaderHeight()+this.getFooterHeight()+a.getPadBorderExtents(this.iframe.parentNode).h+
a.getMarginExtents(this.iframe.parentNode).h);this.editingArea.style.height=C+"px";this.iframe&&(this.iframe.style.height="100%");this._layoutMode=!0},_onIEMouseDown:function(C){var N,S=this.document.body,F=S.clientWidth,T=S.clientHeight,y=S.clientLeft,B=S.offsetWidth,I=S.offsetHeight,P=S.offsetLeft;/^rtl$/i.test(S.dir||"")?F<B&&C.x>F&&C.x<B&&(N=!0):C.x<y&&C.x>P&&(N=!0);N||T<I&&C.y>T&&C.y<I&&(N=!0);N||(delete this._cursorToStart,delete this._savedSelection,"BODY"==C.target.tagName&&this.defer("placeCursorAtEnd"),
this.inherited(arguments))},onBeforeActivate:function(){this._restoreSelection()},onBeforeDeactivate:function(C){this.customUndo&&this.endEditing(!0);"BODY"!=C.target.tagName&&this._saveSelection()},customUndo:!0,editActionInterval:3,beginEditing:function(C){this._inEditing||(this._inEditing=!0,this._beginEditing(C));0<this.editActionInterval&&(this._editTimer&&this._editTimer.remove(),this._editTimer=this.defer("endEditing",this._editInterval))},_steps:[],_undoedSteps:[],execCommand:function(C){if(!this.customUndo||
"undo"!=C&&"redo"!=C){this.customUndo&&(this.endEditing(),this._beginEditing());var N=this.inherited(arguments);this.customUndo&&this._endEditing();return N}return this[C]()},_pasteImpl:function(){return this._clipboardCommand("paste")},_cutImpl:function(){return this._clipboardCommand("cut")},_copyImpl:function(){return this._clipboardCommand("copy")},_clipboardCommand:function(C){try{var N=this.document.execCommand(C,!1,null);if(h("webkit")&&!N)throw{};}catch(S){N=c.substitute,alert(N(this.commands.systemShortcut,
[this.commands[C],N(this.commands[h("mac")?"appleKey":"ctrlKey"],[{cut:"X",copy:"C",paste:"V"}[C]])])),N=!1}return N},queryCommandEnabled:function(C){return!this.customUndo||"undo"!=C&&"redo"!=C?this.inherited(arguments):"undo"==C?1<this._steps.length:0<this._undoedSteps.length},_moveToBookmark:function(C){var N=C.mark,S=C.mark;C=C.isCollapsed;var F;if(S)if(9>h("ie")||9===h("ie")&&h("quirks"))if(g.isArray(S))N=[],u.forEach(S,function(B){N.push(z.getNode(B,this.editNode))},this),this.selection.moveToBookmark({mark:N,
isCollapsed:C});else{if(S.startContainer&&S.endContainer&&(F=z.getSelection(this.window))&&F.removeAllRanges){F.removeAllRanges();C=z.create(this.window);var T=z.getNode(S.startContainer,this.editNode);var y=z.getNode(S.endContainer,this.editNode);T&&y&&(C.setStart(T,S.startOffset),C.setEnd(y,S.endOffset),F.addRange(C))}}else(F=z.getSelection(this.window))&&F.removeAllRanges&&(F.removeAllRanges(),C=z.create(this.window),T=z.getNode(S.startContainer,this.editNode),y=z.getNode(S.endContainer,this.editNode),
T&&y&&(C.setStart(T,S.startOffset),C.setEnd(y,S.endOffset),F.addRange(C)))},_changeToStep:function(C,N){this.setValue(N.text);(C=N.bookmark)&&this._moveToBookmark(C)},undo:function(){var C=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var N=this._steps.pop();N&&0<this._steps.length&&(this.focus(),this._changeToStep(N,this._steps[this._steps.length-1]),this._undoedSteps.push(N),this.onDisplayChanged(),delete this._undoRedoActive,C=!0);delete this._undoRedoActive}return C},
redo:function(){var C=!1;if(!this._undoRedoActive){this._undoRedoActive=!0;this.endEditing(!0);var N=this._undoedSteps.pop();N&&0<this._steps.length&&(this.focus(),this._changeToStep(this._steps[this._steps.length-1],N),this._steps.push(N),this.onDisplayChanged(),C=!0);delete this._undoRedoActive}return C},endEditing:function(C){this._editTimer&&(this._editTimer=this._editTimer.remove());this._inEditing&&(this._endEditing(C),this._inEditing=!1)},_getBookmark:function(){var C=this.selection.getBookmark(),
N=[];if(C&&C.mark){var S=C.mark;if(9>h("ie")||9===h("ie")&&h("quirks")){var F=z.getSelection(this.window);if(g.isArray(S))u.forEach(C.mark,function(y){N.push(z.getIndex(y,this.editNode).o)},this),C.mark=N;else if(F){var T;F.rangeCount&&(T=F.getRangeAt(0));C.mark=T?T.cloneRange():this.selection.getBookmark()}}try{C.mark&&C.mark.startContainer&&(N=z.getIndex(C.mark.startContainer,this.editNode).o,C.mark={startContainer:N,startOffset:C.mark.startOffset,endContainer:C.mark.endContainer===C.mark.startContainer?
N:z.getIndex(C.mark.endContainer,this.editNode).o,endOffset:C.mark.endOffset})}catch(y){C.mark=null}}return C},_beginEditing:function(){0===this._steps.length&&this._steps.push({text:A.getChildrenHtml(this.editNode),bookmark:this._getBookmark()})},_endEditing:function(){var C=A.getChildrenHtml(this.editNode);this._undoedSteps=[];this._steps.push({text:C,bookmark:this._getBookmark()})},onKeyDown:function(C){h("ie")||this.iframe||C.keyCode!=e.TAB||this.tabIndent||this._saveSelection();if(this.customUndo){var N=
C.keyCode;if(C.ctrlKey&&!C.shiftKey&&!C.altKey){if(90==N||122==N){C.stopPropagation();C.preventDefault();this.undo();return}if(89==N||121==N){C.stopPropagation();C.preventDefault();this.redo();return}}this.inherited(arguments);switch(N){case e.ENTER:case e.BACKSPACE:case e.DELETE:this.beginEditing();break;case 88:case 86:if(C.ctrlKey&&!C.altKey&&!C.metaKey){this.endEditing();88==C.keyCode?this.beginEditing("cut"):this.beginEditing("paste");this.defer("endEditing",1);break}default:if(!C.ctrlKey&&!C.altKey&&
!C.metaKey&&(C.keyCode<e.F1||C.keyCode>e.F15)){this.beginEditing();break}case e.ALT:this.endEditing();break;case e.UP_ARROW:case e.DOWN_ARROW:case e.LEFT_ARROW:case e.RIGHT_ARROW:case e.HOME:case e.END:case e.PAGE_UP:case e.PAGE_DOWN:this.endEditing(!0);case e.CTRL:case e.SHIFT:case e.TAB:}}else this.inherited(arguments)},_onBlur:function(){this.inherited(arguments);this.endEditing(!0)},_saveSelection:function(){try{this._savedSelection=this._getBookmark()}catch(C){}},_restoreSelection:function(){this._savedSelection&&
(delete this._cursorToStart,this.selection.isCollapsed()&&this._moveToBookmark(this._savedSelection),delete this._savedSelection)},onClick:function(){this.endEditing(!0);this.inherited(arguments)},replaceValue:function(C){this.customUndo?this.isClosed?this.setValue(C):(this.beginEditing(),C||(C="\x26#160;"),this.setValue(C),this.endEditing()):this.inherited(arguments)},_setDisabledAttr:function(C){this.setValueDeferred.then(g.hitch(this,function(){!this.disabled&&C||!this._buttonEnabledPlugins&&C?
u.forEach(this._plugins,function(N){N.set("disabled",!0)}):this.disabled&&!C&&u.forEach(this._plugins,function(N){N.set("disabled",!1)})}));this.inherited(arguments)},_setStateClass:function(){try{this.inherited(arguments),this.document&&this.document.body&&(b.set(this.document.body,"color",b.get(this.iframe,"color")),b.set(this.document.body,"background-color",b.get(this.iframe,"background-color")))}catch(C){}}});g.mixin(x.registry,{undo:D,redo:D,cut:D,copy:D,paste:D,insertOrderedList:D,insertUnorderedList:D,
indent:D,outdent:D,justifyCenter:D,justifyFull:D,justifyLeft:D,justifyRight:D,"delete":D,selectAll:D,removeFormat:D,unlink:D,insertHorizontalRule:D,bold:L,italic:L,underline:L,strikethrough:L,subscript:L,superscript:L,"|":function(){return new x({setEditor:function(C){this.editor=C;this.button=new t({ownerDocument:C.ownerDocument})}})}});return r})},"dijit/Toolbar":function(){define("require dojo/_base/declare dojo/has dojo/keys dojo/ready ./_Widget ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(G,u,r,n,m,k,d,a){r("dijit-legacy-requires")&&m(0,function(){G(["dijit/ToolbarSeparator"])});return u("dijit.Toolbar",[k,a,d],{templateString:'\x3cdiv class\x3d"dijit" role\x3d"toolbar" tabIndex\x3d"${tabIndex}" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e',baseClass:"dijitToolbar",_onLeftArrow:function(){this.focusPrev()},_onRightArrow:function(){this.focusNext()}})})},"dijit/ToolbarSeparator":function(){define(["dojo/_base/declare","dojo/dom","./_Widget","./_TemplatedMixin"],
function(G,u,r,n){return G("dijit.ToolbarSeparator",[r,n],{templateString:'\x3cdiv class\x3d"dijitToolbarSeparator dijitInline" role\x3d"presentation"\x3e\x3c/div\x3e',buildRendering:function(){this.inherited(arguments);u.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),function(G,u,r,
n,m,k,d,a,b){return k("dijit.layout._LayoutWidget",[u,r,n],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);d.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var e=this.getParent&&this.getParent();e&&e.isLayoutContainer||(this.resize(),this.own(m.on("resize",G.hitch(this,"resize"))))}},resize:function(e,g){var h=this.domNode;e&&a.setMarginBox(h,e);g=g||{};G.mixin(g,e||{});
"h"in g&&"w"in g||(g=G.mixin(a.getMarginBox(h),g));e=b.getComputedStyle(h);var c=a.getMarginExtents(h,e),f=a.getBorderExtents(h,e);g=this._borderBox={w:g.w-(c.w+f.w),h:g.h-(c.h+f.h)};c=a.getPadExtents(h,e);this._contentBox={l:b.toPixelValue(h,e.paddingLeft),t:b.toPixelValue(h,e.paddingTop),w:g.w-c.w,h:g.h-c.h};this.layout()},layout:function(){},_setupChild:function(e){d.add(e.domNode,this.baseClass+"-child "+(e.baseClass?this.baseClass+"-"+e.baseClass:""))},addChild:function(e,g){this.inherited(arguments);
this._started&&this._setupChild(e)},removeChild:function(e){d.remove(e.domNode,this.baseClass+"-child"+(e.baseClass?" "+this.baseClass+"-"+e.baseClass:""));this.inherited(arguments)}})})},"dijit/_editor/_Plugin":function(){define(["dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","../Destroyable","../form/Button"],function(G,u,r,n,m){u=u("dijit._editor._Plugin",n,{constructor:function(k){this.params=k||{};r.mixin(this,this.params);this._attrPairNames={}},editor:null,iconClassPrefix:"dijitEditorIcon",
button:null,command:"",useDefaultCommand:!0,buttonClass:m,disabled:!1,getLabel:function(k){return this.editor.commands[k]},_initButton:function(){if(this.command.length){var k=this.getLabel(this.command),d=this.editor,a=this.iconClassPrefix+" "+this.iconClassPrefix+this.command.charAt(0).toUpperCase()+this.command.substr(1);this.button||(k=r.mixin({label:k,ownerDocument:d.ownerDocument,dir:d.dir,lang:d.lang,showLabel:!1,iconClass:a,dropDown:this.dropDown,tabIndex:"-1"},this.params||{}),delete k.name,
this.button=new this.buttonClass(k))}this.get("disabled")&&this.button&&this.button.set("disabled",this.get("disabled"))},destroy:function(){this.dropDown&&this.dropDown.destroyRecursive();this.inherited(arguments)},connect:function(k,d,a){this.own(G.connect(k,d,this,a))},updateState:function(){var k=this.editor,d=this.command;if(k&&k.isLoaded&&d.length){var a=this.get("disabled");if(this.button)try{var b=k._implCommand(d);var e=!a&&(this[b]?this[b](d):k.queryCommandEnabled(d));this.enabled!==e&&
(this.enabled=e,this.button.set("disabled",!e));if(e&&"boolean"==typeof this.button.checked){var g=k.queryCommandState(d);this.checked!==g&&(this.checked=g,this.button.set("checked",k.queryCommandState(d)))}}catch(h){console.log(h)}}},setEditor:function(k){this.editor=k;this._initButton();this.button&&this.useDefaultCommand&&(this.editor.queryCommandAvailable(this.command)?this.own(this.button.on("click",r.hitch(this.editor,"execCommand",this.command,this.commandArg))):this.button.domNode.style.display=
"none");this.own(this.editor.on("NormalizedDisplayChanged",r.hitch(this,"updateState")))},setToolbar:function(k){this.button&&k.addChild(this.button)},set:function(k,d){if("object"===typeof k){for(var a in k)this.set(a,k[a]);return this}a=this._getAttrNames(k);if(this[a.s])var b=this[a.s].apply(this,Array.prototype.slice.call(arguments,1));else this._set(k,d);return b||this},get:function(k){var d=this._getAttrNames(k);return this[d.g]?this[d.g]():this[k]},_setDisabledAttr:function(k){this._set("disabled",
k);this.updateState()},_getAttrNames:function(k){var d=this._attrPairNames;if(d[k])return d[k];var a=k.charAt(0).toUpperCase()+k.substr(1);return d[k]={s:"_set"+a+"Attr",g:"_get"+a+"Attr"}},_set:function(k,d){this[k]=d}});u.registry={};return u})},"dijit/_editor/plugins/EnterKeyHandling":function(){define("dojo/_base/declare dojo/dom-construct dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ../_Plugin ../RichText ../range".split(" "),function(G,u,r,n,m,k,d,a,b,e,g){return G("dijit._editor.plugins.EnterKeyHandling",
b,{blockNodeForEnter:"BR",constructor:function(h){h&&("blockNodeForEnter"in h&&(h.blockNodeForEnter=h.blockNodeForEnter.toUpperCase()),n.mixin(this,h))},setEditor:function(h){if(this.editor!==h)if(this.editor=h,"BR"==this.blockNodeForEnter)this.editor.customUndo=!0,h.onLoadDeferred.then(n.hitch(this,function(f){this.own(m(h.document,"keydown",n.hitch(this,function(l){if(l.keyCode==r.ENTER){var q=n.mixin({},l);q.shiftKey=!0;this.handleEnterKey(q)||(l.stopPropagation(),l.preventDefault())}})));9<=k("ie")&&
10>=k("ie")&&this.own(m(h.document,"paste",n.hitch(this,function(l){setTimeout(n.hitch(this,function(){var q=this.editor.document.selection.createRange();q.move("character",-1);q.select();q.move("character",1);q.select()}),0)})));return f}));else if(this.blockNodeForEnter){var c=n.hitch(this,"handleEnterKey");h.addKeyHandler(13,0,0,c);h.addKeyHandler(13,0,1,c);this.own(this.editor.on("KeyPressed",n.hitch(this,"onKeyPressed")))}},onKeyPressed:function(){if(this._checkListLater){if(this.editor.selection.isCollapsed()){var h=
this.editor.selection.getAncestorElement("LI");if(h){k("mozilla")&&"LI"==h.parentNode.parentNode.nodeName&&(h=h.parentNode.parentNode);var c=h.firstChild;!c||1!=c.nodeType||"UL"!=c.nodeName&&"OL"!=c.nodeName||(h.insertBefore(c.ownerDocument.createTextNode("\u00a0"),c),c=g.create(this.editor.window),c.setStart(h.firstChild,0),h=g.getSelection(this.editor.window,!0),h.removeAllRanges(),h.addRange(c))}else e.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter),(h=this.editor.selection.getAncestorElement(this.blockNodeForEnter))?
(h.innerHTML=this.bogusHtmlContent,9>=k("ie")&&(h=this.editor.document.selection.createRange(),h.move("character",-1),h.select())):console.error("onKeyPressed: Cannot find the new block node")}this._checkListLater=!1}this._pressedEnterInBlock&&(this._pressedEnterInBlock.previousSibling&&this.removeTrailingBr(this._pressedEnterInBlock.previousSibling),delete this._pressedEnterInBlock)},bogusHtmlContent:"\x26#160;",blockNodes:/^(?:P|H1|H2|H3|H4|H5|H6|LI)$/,handleEnterKey:function(h){var c,f=this.editor.document,
l;if(h.shiftKey){h=this.editor.selection.getParentElement();if(c=g.getAncestor(h,this.blockNodes)){if("LI"==c.tagName)return!0;h=g.getSelection(this.editor.window);var q=h.getRangeAt(0);q.collapsed||(q.deleteContents(),h=g.getSelection(this.editor.window),q=h.getRangeAt(0));if(g.atBeginningOfContainer(c,q.startContainer,q.startOffset)){var t=f.createElement("br");q=g.create(this.editor.window);c.insertBefore(t,c.firstChild);q.setStartAfter(t);h.removeAllRanges();h.addRange(q)}else if(g.atEndOfContainer(c,
q.startContainer,q.startOffset))q=g.create(this.editor.window),t=f.createElement("br"),c.appendChild(t),c.appendChild(f.createTextNode("\u00a0")),q.setStart(c.lastChild,0),h.removeAllRanges(),h.addRange(q);else{if((l=q.startContainer)&&3==l.nodeType){var v=l.nodeValue;var w=f.createTextNode(v.substring(0,q.startOffset));var x=f.createTextNode(v.substring(q.startOffset));c=f.createElement("br");""==x.nodeValue&&k("webkit")&&(x=f.createTextNode("\u00a0"));u.place(w,l,"after");u.place(c,w,"after");u.place(x,
c,"after");u.destroy(l);q=g.create(this.editor.window);q.setStart(x,0);h.removeAllRanges();h.addRange(q);return!1}return!0}}else h=g.getSelection(this.editor.window),h.rangeCount?(q=h.getRangeAt(0))&&q.startContainer&&(q.collapsed||(q.deleteContents(),h=g.getSelection(this.editor.window),q=h.getRangeAt(0)),(l=q.startContainer)&&3==l.nodeType?(c=q.startOffset,l.length<c&&(x=this._adjustNodeAndOffset(l,c),l=x.node,c=x.offset),v=l.nodeValue,w=f.createTextNode(v.substring(0,c)),x=f.createTextNode(v.substring(c)),
c=f.createElement("br"),x.length||(x=f.createTextNode("\u00a0")),w.length?u.place(w,l,"after"):w=l,u.place(c,w,"after"),u.place(x,c,"after"),u.destroy(l)):(0<=q.startOffset&&(t=l.childNodes[q.startOffset]),c=f.createElement("br"),x=f.createTextNode("\u00a0"),t?(u.place(c,t,"before"),u.place(x,c,"after")):(l.appendChild(c),l.appendChild(x))),q=g.create(this.editor.window),q.setStart(x,0),q.setEnd(x,x.length),h.removeAllRanges(),h.addRange(q),this.editor.selection.collapse(!0)):e.prototype.execCommand.call(this.editor,
"inserthtml","\x3cbr\x3e");return!1}var H=!0;h=g.getSelection(this.editor.window);q=h.getRangeAt(0);q.collapsed||(q.deleteContents(),h=g.getSelection(this.editor.window),q=h.getRangeAt(0));t=g.getBlockAncestor(q.endContainer,null,this.editor.editNode);var A=t.blockNode;if(this._checkListLater=A&&("LI"==A.nodeName||"LI"==A.parentNode.nodeName))return k("mozilla")&&(this._pressedEnterInBlock=A),/^(\s|&nbsp;|&#160;|\xA0|<span\b[^>]*\bclass=['"]Apple-style-span['"][^>]*>(\s|&nbsp;|&#160;|\xA0)<\/span>)?(<br>)?$/.test(A.innerHTML)&&
(A.innerHTML="",k("webkit")&&(q=g.create(this.editor.window),q.setStart(A,0),h.removeAllRanges(),h.addRange(q)),this._checkListLater=!1),!0;if(!t.blockNode||t.blockNode===this.editor.editNode){try{e.prototype.execCommand.call(this.editor,"formatblock",this.blockNodeForEnter)}catch(z){}t={blockNode:this.editor.selection.getAncestorElement(this.blockNodeForEnter),blockContainer:this.editor.editNode};if(t.blockNode){if(t.blockNode!=this.editor.editNode&&!(t.blockNode.textContent||t.blockNode.innerHTML).replace(/^\s+|\s+$/g,
"").length)return this.removeTrailingBr(t.blockNode),!1}else t.blockNode=this.editor.editNode;h=g.getSelection(this.editor.window);q=h.getRangeAt(0)}A=f.createElement(this.blockNodeForEnter);A.innerHTML=this.bogusHtmlContent;this.removeTrailingBr(t.blockNode);x=q.endOffset;H=q.endContainer;H.length<x&&(x=this._adjustNodeAndOffset(H,x),H=x.node,x=x.offset);if(g.atEndOfContainer(t.blockNode,H,x))t.blockNode===t.blockContainer?t.blockNode.appendChild(A):u.place(A,t.blockNode,"after"),H=!1,q=g.create(this.editor.window),
q.setStart(A,0),h.removeAllRanges(),h.addRange(q),this.editor.height&&a.scrollIntoView(A);else if(g.atBeginningOfContainer(t.blockNode,q.startContainer,q.startOffset))u.place(A,t.blockNode,t.blockNode===t.blockContainer?"first":"before"),A.nextSibling&&this.editor.height&&(q=g.create(this.editor.window),q.setStart(A.nextSibling,0),h.removeAllRanges(),h.addRange(q),a.scrollIntoView(A.nextSibling)),H=!1;else{t.blockNode===t.blockContainer?t.blockNode.appendChild(A):u.place(A,t.blockNode,"after");H=
!1;t.blockNode.style&&A.style&&t.blockNode.style.cssText&&(A.style.cssText=t.blockNode.style.cssText);if((l=q.startContainer)&&3==l.nodeType){x=q.endOffset;l.length<x&&(x=this._adjustNodeAndOffset(l,x),l=x.node,x=x.offset);v=l.nodeValue;w=f.createTextNode(v.substring(0,x));x=f.createTextNode(v.substring(x,v.length));u.place(w,l,"before");u.place(x,l,"after");u.destroy(l);for(q=w.parentNode;q!==t.blockNode;){v=f.createElement(q.tagName);q.style&&v.style&&q.style.cssText&&(v.style.cssText=q.style.cssText);
"FONT"===q.tagName&&(q.color&&(v.color=q.color),q.face&&(v.face=q.face),q.size&&(v.size=q.size));for(;x;)l=x.nextSibling,v.appendChild(x),x=l;u.place(v,q,"after");w=q;x=v;q=q.parentNode}if(1==x.nodeType||3==x.nodeType&&x.nodeValue)A.innerHTML="";for(w=x;x;)l=x.nextSibling,A.appendChild(x),x=l}q=g.create(this.editor.window);f=w;if("BR"!==this.blockNodeForEnter){for(;f;)c=f,f=l=f.firstChild;c&&c.parentNode?(A=c.parentNode,q.setStart(A,0),h.removeAllRanges(),h.addRange(q),this.editor.height&&a.scrollIntoView(A),
k("mozilla")&&(this._pressedEnterInBlock=t.blockNode)):H=!0}else q.setStart(A,0),h.removeAllRanges(),h.addRange(q),this.editor.height&&a.scrollIntoView(A),k("mozilla")&&(this._pressedEnterInBlock=t.blockNode)}return H},_adjustNodeAndOffset:function(h,c){for(;h.length<c&&h.nextSibling&&3==h.nextSibling.nodeType;)c-=h.length,h=h.nextSibling;return{node:h,offset:c}},removeTrailingBr:function(h){if(h=/P|DIV|LI/i.test(h.tagName)?h:this.editor.selection.getParentOfType(h,["P","DIV","LI"]))h.lastChild&&
(1<h.childNodes.length&&3==h.lastChild.nodeType&&/^[\s\xAD]*$/.test(h.lastChild.nodeValue)||"BR"==h.lastChild.tagName)&&u.destroy(h.lastChild),h.childNodes.length||(h.innerHTML=this.bogusHtmlContent)}})})},"dijit/_editor/RichText":function(){define("dojo/_base/array dojo/_base/config dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/query dojo/domReady dojo/sniff dojo/string dojo/topic dojo/_base/unload dojo/_base/url dojo/window ../_Widget ../_CssStateMixin ../selection ./range ./html ../focus ../main".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z,E,J,D,L,C,N){var S=r("dijit._editor.RichText",[z,E],{constructor:function(F){this.contentPreFilters=[];this.contentPostFilters=[];this.contentDomPreFilters=[];this.contentDomPostFilters=[];this.editingAreaStyleSheets=[];this.events=[].concat(this.events);this._keyHandlers={};F&&c.isString(F.value)&&(this.value=F.value);this.onLoadDeferred=new n},baseClass:"dijitEditor",inheritWidth:!1,focusOnLoad:!1,name:"",styleSheets:"",height:"300px",minHeight:"1em",
isClosed:!0,isLoaded:!1,_SEPARATOR:"@@**%%__RICHTEXTBOUNDRY__%%**@@",_NAME_CONTENT_SEP:"@@**%%:%%**@@",onLoadDeferred:null,isTabIndent:!1,disableSpellCheck:!1,postCreate:function(){"textarea"===this.domNode.tagName.toLowerCase()&&console.warn("RichText should not be used with the TEXTAREA tag.  See dijit._editor.RichText docs.");this.contentPreFilters=[c.trim,c.hitch(this,"_preFixUrlAttributes")].concat(this.contentPreFilters);t("mozilla")&&(this.contentPreFilters=[this._normalizeFontStyle].concat(this.contentPreFilters),
this.contentPostFilters=[this._removeMozBogus].concat(this.contentPostFilters));t("webkit")&&(this.contentPreFilters=[this._removeWebkitBogus].concat(this.contentPreFilters),this.contentPostFilters=[this._removeWebkitBogus].concat(this.contentPostFilters));if(t("ie")||t("trident"))this.contentPostFilters=[this._normalizeFontStyle].concat(this.contentPostFilters),this.contentDomPostFilters=[c.hitch(this,"_stripBreakerNodes")].concat(this.contentDomPostFilters);this.contentDomPostFilters=[c.hitch(this,
"_stripTrailingEmptyNodes")].concat(this.contentDomPostFilters);this.inherited(arguments);w.publish(N._scopeName+"._editor.RichText::init",this)},startup:function(){this.inherited(arguments);this.open();this.setupDefaultShortcuts()},setupDefaultShortcuts:function(){var F=c.hitch(this,function(B,I){return function(){return!this.execCommand(B,I)}}),T={b:F("bold"),i:F("italic"),u:F("underline"),a:F("selectall"),s:function(){this.save(!0)},m:function(){this.isTabIndent=!this.isTabIndent},1:F("formatblock",
"h1"),2:F("formatblock","h2"),3:F("formatblock","h3"),4:F("formatblock","h4"),"\\":F("insertunorderedlist")};t("ie")||(T.Z=F("redo"));for(var y in T)this.addKeyHandler(y,!0,!1,T[y])},events:["onKeyDown","onKeyUp"],captureEvents:[],_editorCommandsLocalized:!1,_localizeEditorCommands:function(){if(S._editorCommandsLocalized)this._local2NativeFormatNames=S._local2NativeFormatNames,this._native2LocalFormatNames=S._native2LocalFormatNames;else{S._editorCommandsLocalized=!0;S._local2NativeFormatNames={};
S._native2LocalFormatNames={};this._local2NativeFormatNames=S._local2NativeFormatNames;this._native2LocalFormatNames=S._native2LocalFormatNames;for(var F="div p pre h1 h2 h3 h4 h5 h6 ol ul address".split(" "),T="",y,B=0;y=F[B++];)T="l"!==y.charAt(1)?T+("\x3c"+y+"\x3e\x3cspan\x3econtent\x3c/span\x3e\x3c/"+y+"\x3e\x3cbr/\x3e"):T+("\x3c"+y+"\x3e\x3cli\x3econtent\x3c/li\x3e\x3c/"+y+"\x3e\x3cbr/\x3e");var I=a.create("div",{style:{position:"absolute",top:"0px",zIndex:10,opacity:.01},innerHTML:T});this.ownerDocumentBody.appendChild(I);
F=c.hitch(this,function(){for(var P=I.firstChild;P;)try{this.selection.selectElement(P.firstChild);var X=P.tagName.toLowerCase();this._local2NativeFormatNames[X]=document.queryCommandValue("formatblock");this._native2LocalFormatNames[this._local2NativeFormatNames[X]]=X;P=P.nextSibling.nextSibling}catch(Y){}a.destroy(I)});this.defer(F)}},open:function(F){if(!this.onLoadDeferred||0<=this.onLoadDeferred.fired)this.onLoadDeferred=new n;this.isClosed||this.close();w.publish(N._scopeName+"._editor.RichText::open",
this);1===arguments.length&&F.nodeName&&(this.domNode=F);var T=this.domNode;if(c.isString(this.value)){var y=this.value;T.innerHTML=""}else if(T.nodeName&&"textarea"==T.nodeName.toLowerCase()){var B=this.textarea=T;this.name=B.name;y=B.value;T=this.domNode=this.ownerDocument.createElement("div");T.setAttribute("widgetId",this.id);B.removeAttribute("widgetId");T.cssText=B.cssText;T.className+=" "+B.className;a.place(T,B,"before");var I=c.hitch(this,function(){e.set(B,{display:"block",position:"absolute",
top:"-1000px"});if(t("ie")){var aa=B.style;this.__overflow=aa.overflow;aa.overflow="hidden"}});t("ie")?this.defer(I,10):I();if(B.form){var P=B.value;this.reset=function(){this.getValue()!==P&&this.replaceValue(P)};f(B.form,"submit",c.hitch(this,function(){k.set(B,"disabled",this.disabled);B.value=this.getValue()}))}}else y=L.getChildrenHtml(T),T.innerHTML="";this.value=y;T.nodeName&&"LI"===T.nodeName&&(T.innerHTML=" \x3cbr\x3e");this.header=T.ownerDocument.createElement("div");T.appendChild(this.header);
this.editingArea=T.ownerDocument.createElement("div");T.appendChild(this.editingArea);this.footer=T.ownerDocument.createElement("div");T.appendChild(this.footer);this.name||(this.name=this.id+"_AUTOGEN");if(""!==this.name&&(!u.useXDomain||u.allowXdRichTextSave)){if((y=m.byId(N._scopeName+"._editor.RichText.value"))&&""!==y.value){I=y.value.split(this._SEPARATOR);for(var X=0,Y;Y=I[X++];)if(Y=Y.split(this._NAME_CONTENT_SEP),Y[0]===this.name){this.value=Y[1];I=I.splice(X,1);y.value=I.join(this._SEPARATOR);
break}}S._globalSaveHandler||(S._globalSaveHandler={},x.addOnUnload(function(){for(var aa in S._globalSaveHandler){var Z=S._globalSaveHandler[aa];c.isFunction(Z)&&Z()}}));S._globalSaveHandler[this.id]=c.hitch(this,"_saveContent")}this.isClosed=!1;y=this.editorObject=this.iframe=this.ownerDocument.createElement("iframe");y.id=this.id+"_iframe";y.style.border="none";y.style.width="100%";this._layoutMode?y.style.height="100%":7<=t("ie")?(this.height&&(y.style.height=this.height),this.minHeight&&(y.style.minHeight=
this.minHeight)):y.style.height=this.height?this.height:this.minHeight;y.frameBorder=0;y._loadFunc=c.hitch(this,function(aa){this.window=aa;this.document=aa.document;this.selection=new J.SelectionManager(aa);t("ie")&&this._localizeEditorCommands();this.onLoad(this.get("value"))});I=this._getIframeDocTxt().replace(/\\/g,"\\\\").replace(/'/g,"\\'");I=11>t("ie")?'javascript:document.open();try{parent.window;}catch(e){document.domain\x3d"'+document.domain+"\";}document.write('"+I+"');document.close()":
"javascript: '"+I+"'";this.editingArea.appendChild(y);y.src=I;"LI"===T.nodeName&&(T.lastChild.style.marginTop="-1.2em");d.add(this.domNode,this.baseClass)},_local2NativeFormatNames:{},_native2LocalFormatNames:{},_getIframeDocTxt:function(){var F=e.getComputedStyle(this.domNode);if(this["aria-label"])var T=this["aria-label"];else{var y=l('label[for\x3d"'+this.id+'"]',this.ownerDocument)[0]||m.byId(this["aria-labelledby"],this.ownerDocument);y&&(T=y.textContent||y.innerHTML||"")}y="\x3cdiv id\x3d'dijitEditorBody' role\x3d'textbox' aria-multiline\x3d'true' "+
(T?" aria-label\x3d'"+v.escape(T)+"'":"")+"\x3e\x3c/div\x3e";var B=[F.fontWeight,F.fontSize,F.fontFamily].join(" "),I=F.lineHeight;I=0<=I.indexOf("px")?parseFloat(I)/parseFloat(F.fontSize):0<=I.indexOf("em")?parseFloat(I):"normal";var P="",X=this;this.style.replace(/(^|;)\s*(line-|font-?)[^;]+/ig,function(Y){Y=Y.replace(/^;/ig,"")+";";var aa=Y.split(":")[0];if(aa){aa=c.trim(aa);aa=aa.toLowerCase();var Z,fa="";for(Z=0;Z<aa.length;Z++){var K=aa.charAt(Z);switch(K){case "-":Z++,K=aa.charAt(Z).toUpperCase();
default:fa+=K}}e.set(X.domNode,fa,"")}P+=Y+";"});this.iframe.setAttribute("title",T);return["\x3c!DOCTYPE html\x3e","\x3chtml lang\x3d'"+(this.lang||g.locale.replace(/-.*/,""))+"'"+(this.isLeftToRight()?"":" dir\x3d'rtl'")+"\x3e\n","\x3chead\x3e\n\x3cmeta http-equiv\x3d'Content-Type' content\x3d'text/html'\x3e\n",T?"\x3ctitle\x3e"+v.escape(T)+"\x3c/title\x3e":"","\x3cstyle\x3e\n\tbody,html {\n\t\tbackground:transparent;\n\t\tpadding: 1px 0 0 0;\n\t\tmargin: -1px 0 0 0;\n\t}\n\tbody,html,#dijitEditorBody { outline: none; }html { height: 100%; width: 100%; overflow: hidden; }\n",
this.height?"\tbody,#dijitEditorBody { height: 100%; width: 100%; overflow: auto; }\n":"\tbody,#dijitEditorBody { min-height: "+this.minHeight+"; width: 100%; overflow-x: auto; overflow-y: hidden; }\n","\tbody{\n\t\ttop:0px;\n\t\tleft:0px;\n\t\tright:0px;\n\t\tfont:",B,";\n",this.height||t("opera")?"":"\t\tposition: fixed;\n","\t\tline-height:",I,";\n\t}\n\tp{ margin: 1em 0; }\n\tli \x3e ul:-moz-first-node, li \x3e ol:-moz-first-node{ padding-top: 1.2em; }\n",t("ie")||t("trident")||t("edge")?"":"\tli{ min-height:1.2em; }\n",
"\x3c/style\x3e\n",this._applyEditingAreaStyleSheets(),"\n\x3c/head\x3e\n\x3cbody role\x3d'application'",T?" aria-label\x3d'"+v.escape(T)+"'":"","onload\x3d'try{frameElement \x26\x26 frameElement._loadFunc(window,document)}catch(e){document.domain\x3d\""+document.domain+"\";frameElement._loadFunc(window,document)}' ","style\x3d'"+P+"'\x3e",y,"\x3c/body\x3e\n\x3c/html\x3e"].join("")},_applyEditingAreaStyleSheets:function(){var F=[];this.styleSheets&&(F=this.styleSheets.split(";"),this.styleSheets=
"");F=F.concat(this.editingAreaStyleSheets);this.editingAreaStyleSheets=[];for(var T="",y=0,B,I=A.get(this.ownerDocument);B=F[y++];)B=(new H(I.location,B)).toString(),this.editingAreaStyleSheets.push(B),T+='\x3clink rel\x3d"stylesheet" type\x3d"text/css" href\x3d"'+B+'"/\x3e';return T},addStyleSheet:function(F){var T=F.toString(),y=A.get(this.ownerDocument);if("."===T.charAt(0)||"/"!==T.charAt(0)&&!F.host)T=(new H(y.location,T)).toString();-1<G.indexOf(this.editingAreaStyleSheets,T)||(this.editingAreaStyleSheets.push(T),
this.onLoadDeferred.then(c.hitch(this,function(){if(this.document.createStyleSheet)this.document.createStyleSheet(T);else{var B=this.document.getElementsByTagName("head")[0],I=this.document.createElement("link");I.rel="stylesheet";I.type="text/css";I.href=T;B.appendChild(I)}})))},removeStyleSheet:function(F){var T=F.toString(),y=A.get(this.ownerDocument);if("."===T.charAt(0)||"/"!==T.charAt(0)&&!F.host)T=(new H(y.location,T)).toString();F=G.indexOf(this.editingAreaStyleSheets,T);-1!==F&&(delete this.editingAreaStyleSheets[F],
l('link[href\x3d"'+T+'"]',this.window.document).orphan())},disabled:!1,_mozSettingProps:{styleWithCSS:!1},_setDisabledAttr:function(F){F=!!F;this._set("disabled",F);if(this.isLoaded){var T=t("ie")&&(this.isLoaded||!this.focusOnLoad);T&&(this.editNode.unselectable="on");this.editNode.contentEditable=!F;this.editNode.tabIndex=F?"-1":this.tabIndex;T&&this.defer(function(){this.editNode&&(this.editNode.unselectable="off")});if(t("mozilla")&&!F&&this._mozSettingProps){F=this._mozSettingProps;for(var y in F)if(F.hasOwnProperty(y))try{this.document.execCommand(y,
!1,F[y])}catch(B){}}this._disabledOK=!0}},onLoad:function(F){this.window.__registeredWindow||(this.window.__registeredWindow=!0,this._iframeRegHandle=C.registerIframe(this.iframe));this.editNode=this.document.body.firstChild;var T=this;this.beforeIframeNode=a.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"before");this.afterIframeNode=a.place("\x3cdiv tabIndex\x3d-1\x3e\x3c/div\x3e",this.iframe,"after");this.iframe.onfocus=this.document.onfocus=function(){T.editNode.focus()};this.focusNode=
this.editNode;var y=this.events.concat(this.captureEvents),B=this.iframe?this.document:this.editNode;this.own.apply(this,G.map(y,function(I){var P=I.toLowerCase().replace(/^on/,"");return f(B,P,c.hitch(this,I))},this));this.own(f(B,"mouseup",c.hitch(this,"onClick")));t("ie")&&(this.own(f(this.document,"mousedown",c.hitch(this,"_onIEMouseDown"))),this.editNode.style.zoom=1);t("webkit")&&(this._webkitListener=this.own(f(this.document,"mouseup",c.hitch(this,"onDisplayChanged")))[0],this.own(f(this.document,
"mousedown",c.hitch(this,function(I){I=I.target;!I||I!==this.document.body&&I!==this.document||this.defer("placeCursorAtEnd")}))));if(t("ie"))try{this.document.execCommand("RespectVisibilityInDesign",!0,null)}catch(I){}this.isLoaded=!0;this.set("disabled",this.disabled);y=c.hitch(this,function(){this.setValue(F);this.onLoadDeferred&&!this.onLoadDeferred.isFulfilled()&&this.onLoadDeferred.resolve(!0);this.onDisplayChanged();this.focusOnLoad&&q(c.hitch(this,"defer","focus",this.updateInterval));this.value=
this.getValue(!0)});this.setValueDeferred?this.setValueDeferred.then(y):y()},onKeyDown:function(F){if(F.keyCode===h.SHIFT||F.keyCode===h.ALT||F.keyCode===h.META||F.keyCode===h.CTRL)return!0;F.keyCode===h.TAB&&this.isTabIndent&&(F.stopPropagation(),F.preventDefault(),this.queryCommandEnabled(F.shiftKey?"outdent":"indent")&&this.execCommand(F.shiftKey?"outdent":"indent"));if(F.keyCode==h.TAB&&!this.isTabIndent&&!F.ctrlKey&&!F.altKey)return F.shiftKey?this.beforeIframeNode.focus():this.afterIframeNode.focus(),
!0;9>t("ie")&&F.keyCode===h.BACKSPACE&&"Control"===this.document.selection.type&&(F.stopPropagation(),F.preventDefault(),this.execCommand("delete"));t("ff")&&(F.keyCode===h.PAGE_UP||F.keyCode===h.PAGE_DOWN)&&this.editNode.clientHeight>=this.editNode.scrollHeight&&F.preventDefault();var T=this._keyHandlers[F.keyCode],y=arguments;T&&!F.altKey&&G.some(T,function(B){if(!(B.shift^F.shiftKey||B.ctrl^(F.ctrlKey||F.metaKey)))return B.handler.apply(this,y)||F.preventDefault(),!0},this);this.defer("onKeyPressed",
1);return!0},onKeyUp:function(){},setDisabled:function(F){g.deprecated("dijit.Editor::setDisabled is deprecated",'use dijit.Editor::attr("disabled",boolean) instead',2);this.set("disabled",F)},_setValueAttr:function(F){this.setValue(F)},_setDisableSpellCheckAttr:function(F){this.document?k.set(this.document.body,"spellcheck",!F):this.onLoadDeferred.then(c.hitch(this,function(){k.set(this.document.body,"spellcheck",!F)}));this._set("disableSpellCheck",F)},addKeyHandler:function(F,T,y,B){"string"==
typeof F&&(F=F.toUpperCase().charCodeAt(0));c.isArray(this._keyHandlers[F])||(this._keyHandlers[F]=[]);this._keyHandlers[F].push({shift:y||!1,ctrl:T||!1,handler:B})},onKeyPressed:function(){this.onDisplayChanged()},onClick:function(F){this.onDisplayChanged(F)},_onIEMouseDown:function(){this.focused||this.disabled||this.focus()},_onBlur:function(F){(t("ie")||t("trident"))&&this.defer(function(){C.curNode||this.ownerDocumentBody.focus()});this.inherited(arguments);var T=this.getValue(!0);if(T!==this.value)this.onChange(T);
this._set("value",T)},_onFocus:function(F){this.disabled||(this._disabledOK||this.set("disabled",!1),this.inherited(arguments))},blur:function(){!t("ie")&&this.window.document.documentElement&&this.window.document.documentElement.focus?this.window.document.documentElement.focus():this.ownerDocumentBody.focus&&this.ownerDocumentBody.focus()},focus:function(){this.isLoaded?9>t("ie")?this.iframe.fireEvent("onfocus",document.createEventObject()):this.editNode.focus():this.focusOnLoad=!0},updateInterval:200,
_updateTimer:null,onDisplayChanged:function(){this._updateTimer&&this._updateTimer.remove();this._updateTimer=this.defer("onNormalizedDisplayChanged",this.updateInterval)},onNormalizedDisplayChanged:function(){delete this._updateTimer},onChange:function(){},_normalizeCommand:function(F,T){F=F.toLowerCase();"formatblock"===F?t("safari")&&void 0===T&&(F="heading"):"hilitecolor"!==F||t("mozilla")||(F="backcolor");return F},_implCommand:function(F){return"_"+this._normalizeCommand(F)+"EnabledImpl"},_qcaCache:{},
queryCommandAvailable:function(F){var T=this._qcaCache[F];return void 0!==T?T:this._qcaCache[F]=this._queryCommandAvailable(F)},_queryCommandAvailable:function(F){switch(F.toLowerCase()){case "bold":case "italic":case "underline":case "subscript":case "superscript":case "fontname":case "fontsize":case "forecolor":case "hilitecolor":case "justifycenter":case "justifyfull":case "justifyleft":case "justifyright":case "delete":case "selectall":case "toggledir":case "createlink":case "unlink":case "removeformat":case "inserthorizontalrule":case "insertimage":case "insertorderedlist":case "insertunorderedlist":case "indent":case "outdent":case "formatblock":case "inserthtml":case "undo":case "redo":case "strikethrough":case "tabindent":case "cut":case "copy":case "paste":return!0;
case "blockdirltr":case "blockdirrtl":case "dirltr":case "dirrtl":case "inlinedirltr":case "inlinedirrtl":return t("ie")||t("trident")||t("edge");case "inserttable":case "insertcell":case "insertcol":case "insertrow":case "deletecells":case "deletecols":case "deleterows":case "mergecells":case "splitcell":return!t("webkit");default:return!1}},execCommand:function(F,T){this.focused&&this.focus();F=this._normalizeCommand(F,T);if(void 0!==T){if("heading"===F)throw Error("unimplemented");"formatblock"===
F&&(t("ie")||t("trident"))&&(T="\x3c"+T+"\x3e")}var y="_"+F+"Impl";if(this[y])var B=this[y](T);else if((T=1<arguments.length?T:null)||"createlink"!==F)B=this.document.execCommand(F,!1,T);this.onDisplayChanged();return B},queryCommandEnabled:function(F){if(this.disabled||!this._disabledOK)return!1;F=this._normalizeCommand(F);var T=this._implCommand(F);return this[T]?this[T](F):this._browserQueryCommandEnabled(F)},queryCommandState:function(F){if(this.disabled||!this._disabledOK)return!1;F=this._normalizeCommand(F);
try{return this.document.queryCommandState(F)}catch(T){return!1}},queryCommandValue:function(F){if(this.disabled||!this._disabledOK)return!1;F=this._normalizeCommand(F);if(t("ie")&&"formatblock"===F)F=this._native2LocalFormatNames[this.document.queryCommandValue(F)];else if(t("mozilla")&&"hilitecolor"===F){try{var T=this.document.queryCommandValue("styleWithCSS")}catch(y){T=!1}this.document.execCommand("styleWithCSS",!1,!0);F=this.document.queryCommandValue(F);this.document.execCommand("styleWithCSS",
!1,T)}else F=this.document.queryCommandValue(F);return F},_sCall:function(F,T){return this.selection[F].apply(this.selection,T)},placeCursorAtStart:function(){this.focus();var F=!1;if(t("mozilla"))for(var T=this.editNode.firstChild;T;){if(3===T.nodeType){if(0<T.nodeValue.replace(/^\s+|\s+$/g,"").length){F=!0;this.selection.selectElement(T);break}}else if(1===T.nodeType){F=!0;var y=T.tagName?T.tagName.toLowerCase():"";/br|input|img|base|meta|area|basefont|hr|link/.test(y)?this.selection.selectElement(T):
this.selection.selectElementChildren(T);break}T=T.nextSibling}else F=!0,this.selection.selectElementChildren(this.editNode);F&&this.selection.collapse(!0)},placeCursorAtEnd:function(){this.focus();var F=!1;if(t("mozilla"))for(var T=this.editNode.lastChild;T;){if(3===T.nodeType){if(0<T.nodeValue.replace(/^\s+|\s+$/g,"").length){F=!0;this.selection.selectElement(T);break}}else if(1===T.nodeType){F=!0;this.selection.selectElement(T.lastChild||T);break}T=T.previousSibling}else F=!0,this.selection.selectElementChildren(this.editNode);
F&&this.selection.collapse(!1)},getValue:function(F){return!this.textarea||!this.isClosed&&this.isLoaded?this.isLoaded?this._postFilterContent(null,F):this.value:this.textarea.value},_getValueAttr:function(){return this.getValue(!0)},setValue:function(F){if(this.isLoaded){if(!this.textarea||!this.isClosed&&this.isLoaded){F=this._preFilterContent(F);var T=this.isClosed?this.domNode:this.editNode;T.innerHTML=F;this._preDomFilterContent(T)}else this.textarea.value=F;this.onDisplayChanged();this._set("value",
this.getValue(!0))}else this.onLoadDeferred.then(c.hitch(this,function(){this.setValue(F)}))},replaceValue:function(F){this.isClosed?this.setValue(F):this.window&&this.window.getSelection&&!t("mozilla")?this.setValue(F):this.window&&this.window.getSelection?(F=this._preFilterContent(F),this.execCommand("selectall"),this.execCommand("inserthtml",F),this._preDomFilterContent(this.editNode)):this.document&&this.document.selection&&this.setValue(F);this._set("value",this.getValue(!0))},_preFilterContent:function(F){var T=
F;G.forEach(this.contentPreFilters,function(y){y&&(T=y(T))});return T},_preDomFilterContent:function(F){F=F||this.editNode;G.forEach(this.contentDomPreFilters,function(T){T&&c.isFunction(T)&&T(F)},this)},_postFilterContent:function(F,T){if(c.isString(F))var y=F;else F=F||this.editNode,this.contentDomPostFilters.length&&(T&&(F=c.clone(F)),G.forEach(this.contentDomPostFilters,function(B){F=B(F)})),y=L.getChildrenHtml(F);c.trim(y.replace(/^\xA0\xA0*/,"").replace(/\xA0\xA0*$/,"")).length||(y="");G.forEach(this.contentPostFilters,
function(B){y=B(y)});return y},_saveContent:function(){var F=m.byId(N._scopeName+"._editor.RichText.value");F&&(F.value&&(F.value+=this._SEPARATOR),F.value+=this.name+this._NAME_CONTENT_SEP+this.getValue(!0))},escapeXml:function(F,T){F=F.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");T||(F=F.replace(/'/gm,"\x26#39;"));return F},getNodeHtml:function(F){g.deprecated("dijit.Editor::getNodeHtml is deprecated","use dijit/_editor/html::getNodeHtml instead",
2);return L.getNodeHtml(F)},getNodeChildrenHtml:function(F){g.deprecated("dijit.Editor::getNodeChildrenHtml is deprecated","use dijit/_editor/html::getChildrenHtml instead",2);return L.getChildrenHtml(F)},close:function(F){if(!this.isClosed){arguments.length||(F=!0);F&&this._set("value",this.getValue(!0));this.interval&&clearInterval(this.interval);this._webkitListener&&(this._webkitListener.remove(),delete this._webkitListener);t("ie")&&(this.iframe.onfocus=null);this.iframe._loadFunc=null;this._iframeRegHandle&&
(this._iframeRegHandle.remove(),delete this._iframeRegHandle);if(this.textarea){var T=this.textarea.style;T.position="";T.left=T.top="";t("ie")&&(T.overflow=this.__overflow,this.__overflow=null);this.textarea.value=this.value;a.destroy(this.domNode);this.domNode=this.textarea}else this.domNode.innerHTML=this.value;delete this.iframe;d.remove(this.domNode,this.baseClass);this.isClosed=!0;this.isLoaded=!1;delete this.editNode;delete this.focusNode;this.window&&this.window._frameElement&&(this.window._frameElement=
null);this.editorObject=this.editingArea=this.document=this.window=null}},destroy:function(){this.isClosed||this.close(!1);this._updateTimer&&this._updateTimer.remove();this.inherited(arguments);S._globalSaveHandler&&delete S._globalSaveHandler[this.id]},_removeMozBogus:function(F){return F.replace(/\stype="_moz"/gi,"").replace(/\s_moz_dirty=""/gi,"").replace(/_moz_resizing="(true|false)"/gi,"")},_removeWebkitBogus:function(F){F=F.replace(/\sclass="webkit-block-placeholder"/gi,"");F=F.replace(/\sclass="apple-style-span"/gi,
"");return F=F.replace(/<meta charset="utf-8" \/>/gi,"")},_normalizeFontStyle:function(F){return F.replace(/<(\/)?strong([ >])/gi,"\x3c$1b$2").replace(/<(\/)?em([ >])/gi,"\x3c$1i$2")},_preFixUrlAttributes:function(F){return F.replace(/(?:(<a(?=\s).*?\shref=)("|')(.*?)\2)|(?:(<a\s.*?href=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2").replace(/(?:(<img(?=\s).*?\ssrc=)("|')(.*?)\2)|(?:(<img\s.*?src=)([^"'][^ >]+))/gi,"$1$4$2$3$5$2 _djrealurl\x3d$2$3$5$2")},_browserQueryCommandEnabled:function(F){if(!F)return!1;
if(t("ie")||t("trident")||t("edge"))return this.focused&&!this.disabled;var T=9>t("ie")?this.document.selection.createRange():this.document;try{return T.queryCommandEnabled(F)}catch(y){return!1}},_createlinkEnabledImpl:function(){var F=!0;return F=t("opera")?this.window.getSelection().isCollapsed?!0:this.document.queryCommandEnabled("createlink"):this._browserQueryCommandEnabled("createlink")},_unlinkEnabledImpl:function(){var F=!0;return F=t("mozilla")||t("webkit")||t("ie")||t("trident")||t("edge")?
this.selection.hasAncestorElement("a"):this._browserQueryCommandEnabled("unlink")},_inserttableEnabledImpl:function(){var F=!0;return F=t("mozilla")||t("webkit")?!0:this._browserQueryCommandEnabled("inserttable")},_cutEnabledImpl:function(){var F=!0;t("webkit")?((F=this.window.getSelection())&&(F=F.toString()),F=!!F):F=this._browserQueryCommandEnabled("cut");return F},_copyEnabledImpl:function(){var F=!0;t("webkit")?((F=this.window.getSelection())&&(F=F.toString()),F=!!F):F=this._browserQueryCommandEnabled("copy");
return F},_pasteEnabledImpl:function(){var F=!0;return t("webkit")?!0:F=this._browserQueryCommandEnabled("paste")},_inserthorizontalruleImpl:function(F){return t("ie")?this._inserthtmlImpl("\x3chr\x3e"):this.document.execCommand("inserthorizontalrule",!1,F)},_unlinkImpl:function(F){return this.queryCommandEnabled("unlink")&&(t("mozilla")||t("webkit"))?(F=this.selection.getAncestorElement("a"),this.selection.selectElement(F),this.document.execCommand("unlink",!1,null)):this.document.execCommand("unlink",
!1,F)},_hilitecolorImpl:function(F){if(!this._handleTextColorOrProperties("hilitecolor",F))if(t("mozilla")){this.document.execCommand("styleWithCSS",!1,!0);console.log("Executing color command.");var T=this.document.execCommand("hilitecolor",!1,F);this.document.execCommand("styleWithCSS",!1,!1)}else T=this.document.execCommand("hilitecolor",!1,F);return T},_backcolorImpl:function(F){t("ie")&&(F=F?F:null);var T=this._handleTextColorOrProperties("backcolor",F);T||(T=this.document.execCommand("backcolor",
!1,F));return T},_forecolorImpl:function(F){t("ie")&&(F=F?F:null);var T=!1;(T=this._handleTextColorOrProperties("forecolor",F))||(T=this.document.execCommand("forecolor",!1,F));return T},_inserthtmlImpl:function(F){F=this._preFilterContent(F);var T=!0;if(9>t("ie")){var y=this.document.selection.createRange();if("CONTROL"===this.document.selection.type.toUpperCase()){for(var B=y.item(0);y.length;)y.remove(y.item(0));B.outerHTML=F}else y.pasteHTML(F);y.select()}else if(8>t("trident")){var I=D.getSelection(this.window);
if(I&&I.rangeCount&&I.getRangeAt){y=I.getRangeAt(0);y.deleteContents();var P=a.create("div");P.innerHTML=F;for(B=this.document.createDocumentFragment();F=P.firstChild;)var X=B.appendChild(F);y.insertNode(B);X&&(y=y.cloneRange(),y.setStartAfter(X),y.collapse(!1),I.removeAllRanges(),I.addRange(y))}}else t("mozilla")&&!F.length?this.selection.remove():T=this.document.execCommand("inserthtml",!1,F);return T},_boldImpl:function(F){var T=!1;if(t("ie")||t("trident"))this._adaptIESelection(),T=this._adaptIEFormatAreaAndExec("bold");
T||(T=this.document.execCommand("bold",!1,F));return T},_italicImpl:function(F){var T=!1;if(t("ie")||t("trident"))this._adaptIESelection(),T=this._adaptIEFormatAreaAndExec("italic");T||(T=this.document.execCommand("italic",!1,F));return T},_underlineImpl:function(F){var T=!1;if(t("ie")||t("trident"))this._adaptIESelection(),T=this._adaptIEFormatAreaAndExec("underline");T||(T=this.document.execCommand("underline",!1,F));return T},_strikethroughImpl:function(F){var T=!1;if(t("ie")||t("trident"))this._adaptIESelection(),
T=this._adaptIEFormatAreaAndExec("strikethrough");T||(T=this.document.execCommand("strikethrough",!1,F));return T},_superscriptImpl:function(F){var T=!1;if(t("ie")||t("trident"))this._adaptIESelection(),T=this._adaptIEFormatAreaAndExec("superscript");T||(T=this.document.execCommand("superscript",!1,F));return T},_subscriptImpl:function(F){var T=!1;if(t("ie")||t("trident"))this._adaptIESelection(),T=this._adaptIEFormatAreaAndExec("subscript");T||(T=this.document.execCommand("subscript",!1,F));return T},
_fontnameImpl:function(F){if(t("ie")||t("trident"))var T=this._handleTextColorOrProperties("fontname",F);T||(T=this.document.execCommand("fontname",!1,F));return T},_fontsizeImpl:function(F){if(t("ie")||t("trident"))var T=this._handleTextColorOrProperties("fontsize",F);T||(T=this.document.execCommand("fontsize",!1,F));return T},_insertorderedlistImpl:function(F){var T=!1;if(t("ie")||t("trident")||t("edge"))T=this._adaptIEList("insertorderedlist",F);T||(T=this.document.execCommand("insertorderedlist",
!1,F));return T},_insertunorderedlistImpl:function(F){var T=!1;if(t("ie")||t("trident")||t("edge"))T=this._adaptIEList("insertunorderedlist",F);T||(T=this.document.execCommand("insertunorderedlist",!1,F));return T},getHeaderHeight:function(){return this._getNodeChildrenHeight(this.header)},getFooterHeight:function(){return this._getNodeChildrenHeight(this.footer)},_getNodeChildrenHeight:function(F){var T=0;if(F&&F.childNodes){var y;for(y=0;y<F.childNodes.length;y++){var B=b.position(F.childNodes[y]);
T+=B.h}}return T},_isNodeEmpty:function(F,T){return 1===F.nodeType?0<F.childNodes.length?this._isNodeEmpty(F.childNodes[0],T):!0:3===F.nodeType?""===F.nodeValue.substring(T):!1},_removeStartingRangeFromRange:function(F,T){if(F.nextSibling)T.setStart(F.nextSibling,0);else{for(F=F.parentNode;F&&null==F.nextSibling;)F=F.parentNode;F&&T.setStart(F.nextSibling,0)}return T},_adaptIESelection:function(){var F=D.getSelection(this.window);if(F&&F.rangeCount&&!F.isCollapsed){for(var T=F.getRangeAt(0),y=T.startContainer,
B=T.startOffset;3===y.nodeType&&B>=y.length&&y.nextSibling;)B-=y.length,y=y.nextSibling;for(var I=null;this._isNodeEmpty(y,B)&&y!==I;)I=y,T=this._removeStartingRangeFromRange(y,T),y=T.startContainer,B=0;F.removeAllRanges();F.addRange(T)}},_adaptIEFormatAreaAndExec:function(F){var T=D.getSelection(this.window),y=this.document,B;if(F&&T&&T.isCollapsed){if(this.queryCommandValue(F)){F=this._tagNamesForCommand(F);var I=T.getRangeAt(0);var P=I.startContainer;if(3===P.nodeType){var X=I.endOffset;P.length<
X&&(X=this._adjustNodeAndOffset(Y,X),P=X.node,X=X.offset)}for(;P&&P!==this.editNode;){var Y=P.tagName?P.tagName.toLowerCase():"";if(-1<G.indexOf(F,Y)){var aa=P;break}P=P.parentNode}if(aa&&(Y=I.startContainer,F=y.createElement(aa.tagName),a.place(F,aa,"after"),Y&&3===Y.nodeType)){X=I.endOffset;Y.length<X&&(X=this._adjustNodeAndOffset(Y,X),Y=X.node,X=X.offset);P=Y.nodeValue;I=y.createTextNode(P.substring(0,X));var Z=P.substring(X,P.length);Z&&(B=y.createTextNode(Z));a.place(I,Y,"before");if(B){var fa=
y.createElement("span");fa.className="ieFormatBreakerSpan";a.place(fa,Y,"after");a.place(B,fa,"after");B=fa}a.destroy(Y);X=I.parentNode;for(Y=[];X!==aa;){P=X.tagName;I={tagName:P};Y.push(I);P=y.createElement(P);X.style&&P.style&&X.style.cssText&&(P.style.cssText=X.style.cssText,I.cssText=X.style.cssText);"FONT"===X.tagName&&(X.color&&(P.color=X.color,I.color=X.color),X.face&&(P.face=X.face,I.face=X.face),X.size&&(P.size=X.size,I.size=X.size));X.className&&(P.className=X.className,I.className=X.className);
if(B)for(;B;)I=B.nextSibling,P.appendChild(B),B=I;P.tagName==X.tagName?(fa=y.createElement("span"),fa.className="ieFormatBreakerSpan",a.place(fa,X,"after"),a.place(P,fa,"after")):a.place(P,X,"after");I=X;B=P;X=X.parentNode}if(B){if(1===B.nodeType||3===B.nodeType&&B.nodeValue)F.innerHTML="";for(;B;)I=B.nextSibling,F.appendChild(B),B=I}if(Y.length){I=Y.pop();B=y.createElement(I.tagName);I.cssText&&B.style&&(B.style.cssText=I.cssText);I.className&&(B.className=I.className);"FONT"===I.tagName&&(I.color&&
(B.color=I.color),I.face&&(B.face=I.face),I.size&&(B.size=I.size));for(a.place(B,F,"before");Y.length;)I=Y.pop(),aa=y.createElement(I.tagName),I.cssText&&aa.style&&(aa.style.cssText=I.cssText),I.className&&(aa.className=I.className),"FONT"===I.tagName&&(I.color&&(aa.color=I.color),I.face&&(aa.face=I.face),I.size&&(aa.size=I.size)),B.appendChild(aa),B=aa;aa=y.createTextNode(".");fa.appendChild(aa);B.appendChild(aa)}else fa=y.createElement("span"),fa.className="ieFormatBreakerSpan",aa=y.createTextNode("."),
fa.appendChild(aa),a.place(fa,F,"before");B=D.create(this.window);B.setStart(aa,0);B.setEnd(aa,aa.length);T.removeAllRanges();T.addRange(B);this.selection.collapse(!1);aa.parentNode.innerHTML="";F.firstChild||a.destroy(F);return!0}return!1}I=T.getRangeAt(0);if((Y=I.startContainer)&&3===Y.nodeType)return X=I.startOffset,Y.length<X&&(X=this._adjustNodeAndOffset(Y,X),Y=X.node,X=X.offset),P=Y.nodeValue,I=y.createTextNode(P.substring(0,X)),Z=P.substring(X),""!==Z&&(B=y.createTextNode(P.substring(X))),
fa=y.createElement("span"),aa=y.createTextNode("."),fa.appendChild(aa),I.length?a.place(I,Y,"after"):I=Y,a.place(fa,I,"after"),B&&a.place(B,fa,"after"),a.destroy(Y),B=D.create(this.window),B.setStart(aa,0),B.setEnd(aa,aa.length),T.removeAllRanges(),T.addRange(B),y.execCommand(F),a.place(fa.firstChild,fa,"before"),a.destroy(fa),B.setStart(aa,0),B.setEnd(aa,aa.length),T.removeAllRanges(),T.addRange(B),this.selection.collapse(!1),aa.parentNode.innerHTML="",!0}else return!1},_adaptIEList:function(F){var T=
D.getSelection(this.window);if(T.isCollapsed&&T.rangeCount&&!this.queryCommandValue(F)){var y=T.getRangeAt(0),B=y.startContainer;if(B&&3==B.nodeType&&!y.startOffset)return y="ul","insertorderedlist"===F&&(y="ol"),F=this.document.createElement(y),y=a.create("li",null,F),a.place(F,B,"before"),y.appendChild(B),a.create("br",null,F,"after"),F=D.create(this.window),F.setStart(B,0),F.setEnd(B,B.length),T.removeAllRanges(),T.addRange(F),this.selection.collapse(!0),!0}return!1},_handleTextColorOrProperties:function(F,
T){var y=D.getSelection(this.window),B=this.document,I,P;T=T||null;if(F&&y&&y.isCollapsed&&y.rangeCount){var X=y.getRangeAt(0);if((I=X.startContainer)&&3===I.nodeType){var Y=X.startOffset;I.length<Y&&(X=this._adjustNodeAndOffset(I,Y),I=X.node,Y=X.offset);var aa=I.nodeValue;X=B.createTextNode(aa.substring(0,Y));""!==aa.substring(Y)&&(P=B.createTextNode(aa.substring(Y)));aa=B.createElement("span");Y=B.createTextNode(".");aa.appendChild(Y);B=B.createElement("span");aa.appendChild(B);X.length?a.place(X,
I,"after"):X=I;a.place(aa,X,"after");P&&a.place(P,aa,"after");a.destroy(I);I=D.create(this.window);I.setStart(Y,0);I.setEnd(Y,Y.length);y.removeAllRanges();y.addRange(I);if(t("webkit")){y="color";if("hilitecolor"===F||"backcolor"===F)y="backgroundColor";e.set(aa,y,T);this.selection.remove();a.destroy(B);aa.innerHTML="\x26#160;";this.selection.selectElement(aa);this.focus()}else this.execCommand(F,T),a.place(aa.firstChild,aa,"before"),a.destroy(aa),I.setStart(Y,0),I.setEnd(Y,Y.length),y.removeAllRanges(),
y.addRange(I),this.selection.collapse(!1),Y.parentNode.removeChild(Y);return!0}}return!1},_adjustNodeAndOffset:function(F,T){for(;F.length<T&&F.nextSibling&&3===F.nextSibling.nodeType;)T-=F.length,F=F.nextSibling;return{node:F,offset:T}},_tagNamesForCommand:function(F){return"bold"===F?["b","strong"]:"italic"===F?["i","em"]:"strikethrough"===F?["s","strike"]:"superscript"===F?["sup"]:"subscript"===F?["sub"]:"underline"===F?["u"]:[]},_stripBreakerNodes:function(F){if(this.isLoaded)return l(".ieFormatBreakerSpan",
F).forEach(function(T){for(;T.firstChild;)a.place(T.firstChild,T,"before");a.destroy(T)}),F},_stripTrailingEmptyNodes:function(F){function T(y){return/^(p|div|br)$/i.test(y.nodeName)&&0==y.children.length&&/^[\s\xA0]*$/.test(y.textContent||y.innerText||"")||3===y.nodeType&&/^[\s\xA0]*$/.test(y.nodeValue)}for(;F.lastChild&&T(F.lastChild);)a.destroy(F.lastChild);return F},_setTextDirAttr:function(F){this._set("textDir",F);this.onLoadDeferred.then(c.hitch(this,function(){this.editNode.dir=F}))}});return S})},
"dijit/_editor/range":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/_base/lang"],function(G,u,r){var n={getIndex:function(d,a){for(var b=[],e=[],g=d,h,c;d!=a;){var f=0;for(h=d.parentNode;c=h.childNodes[f++];)if(c===d){--f;break}b.unshift(f);e.unshift(f-h.childNodes.length);d=h}if(0<b.length&&3==g.nodeType){for(c=g.previousSibling;c&&3==c.nodeType;)b[b.length-1]--,c=c.previousSibling;for(c=g.nextSibling;c&&3==c.nodeType;)e[e.length-1]++,c=c.nextSibling}return{o:b,r:e}},getNode:function(d,
a){if(!r.isArray(d)||0==d.length)return a;var b=a;G.every(d,function(e){if(0<=e&&e<b.childNodes.length)b=b.childNodes[e];else return b=null,!1;return!0});return b},getCommonAncestor:function(d,a,b){b=b||d.ownerDocument.body;var e=function(c){for(var f=[];c;)if(f.unshift(c),c!==b)c=c.parentNode;else break;return f};d=e(d);a=e(a);e=Math.min(d.length,a.length);for(var g=d[0],h=1;h<e;h++)if(d[h]===a[h])g=d[h];else break;return g},getAncestor:function(d,a,b){for(b=b||d.ownerDocument.body;d&&d!==b;){var e=
d.nodeName.toUpperCase();if(a.test(e))return d;d=d.parentNode}return null},BlockTagNames:/^(?:P|DIV|H1|H2|H3|H4|H5|H6|ADDRESS|PRE|OL|UL|LI|DT|DE)$/,getBlockAncestor:function(d,a,b){b=b||d.ownerDocument.body;a=a||n.BlockTagNames;for(var e=null,g;d&&d!==b;){var h=d.nodeName.toUpperCase();!e&&a.test(h)&&(e=d);!g&&/^(?:BODY|TD|TH|CAPTION)$/.test(h)&&(g=d);d=d.parentNode}return{blockNode:e,blockContainer:g||d.ownerDocument.body}},atBeginningOfContainer:function(d,a,b){var e=!1,g=0==b;g||3!=a.nodeType||
/^[\s\xA0]+$/.test(a.nodeValue.substr(0,b))&&(g=!0);if(g)for(e=!0;a&&a!==d;){if(a.previousSibling){e=!1;break}a=a.parentNode}return e},atEndOfContainer:function(d,a,b){var e=!1,g=b==(a.length||a.childNodes.length);g||3!=a.nodeType||/^[\s\xA0]+$/.test(a.nodeValue.substr(b))&&(g=!0);if(g)for(e=!0;a&&a!==d;){if(a.nextSibling){e=!1;break}a=a.parentNode}return e},adjacentNoneTextNode:function(d,a){var b=d;d=0-d.length||0;for(a=a?"nextSibling":"previousSibling";b&&3==b.nodeType;)d+=b.length,b=b[a];return[b,
d]},create:function(d){d=d||window;return d.getSelection?d.document.createRange():new k},getSelection:function(d,a){if(d.getSelection)return d.getSelection();d=new m.selection(d);a||d._getCurrentSelection();return d}};if(!window.getSelection)var m=n.ie={cachedSelection:{},selection:function(d){this._ranges=[];this.addRange=function(a,b){this._ranges.push(a);b||a._select();this.rangeCount=this._ranges.length};this.removeAllRanges=function(){this._ranges=[];this.rangeCount=0};this.getRangeAt=function(a){return this._ranges[a]};
this._getCurrentSelection=function(){this.removeAllRanges();var a=d.document.selection.createRange();a="CONTROL"==d.document.selection.type.toUpperCase()?new k(m.decomposeControlRange(a)):new k(m.decomposeTextRange(a));this.addRange(a,!0),this.isCollapsed=a.collapsed}},decomposeControlRange:function(d){var a=d.item(0),b=d.item(d.length-1);d=a.parentNode;var e=b.parentNode;a=n.getIndex(a,d).o[0];b=n.getIndex(b,e).o[0]+1;return[d,a,e,b]},getEndPoint:function(d,a){var b=d.duplicate();b.collapse(!a);
var e="EndTo"+(a?"End":"Start"),g=b.parentElement(),h;if(0<g.childNodes.length)G.every(g.childNodes,function(l,q){if(3!=l.nodeType)if(b.moveToElementText(l),0<b.compareEndPoints(e,d))if(h&&3==h.nodeType){c=h;var t=!0}else return c=g,f=q,!1;else{if(q==g.childNodes.length-1)return c=g,f=g.childNodes.length,!1}else q==g.childNodes.length-1&&(c=l,t=!0);if(t&&c)return c=(l=n.adjacentNoneTextNode(c)[0])?l.nextSibling:g.firstChild,q=n.adjacentNoneTextNode(c),l=q[0],q=q[1],l?(b.moveToElementText(l),b.collapse(!1)):
b.moveToElementText(g),b.setEndPoint(e,d),f=b.text.length-q,!1;h=l;return!0});else{var c=g;var f=0}a||1!=c.nodeType||f!=c.childNodes.length||(a=c.nextSibling)&&3==a.nodeType&&(c=a,f=0);return[c,f]},setEndPoint:function(d,a,b){d=d.duplicate();var e;if(3!=a.nodeType)if(0<b){if(e=a.childNodes[b-1])if(3==e.nodeType)a=e,b=e.length;else if(e.nextSibling&&3==e.nextSibling.nodeType)a=e.nextSibling,b=0;else{d.moveToElementText(e.nextSibling?e:a);var g=e.parentNode;e=g.insertBefore(e.ownerDocument.createTextNode(" "),
e.nextSibling);d.collapse(!1);g.removeChild(e)}}else d.moveToElementText(a),d.collapse(!0);3==a.nodeType&&(e=n.adjacentNoneTextNode(a),g=e[0],e=e[1],g?(d.moveToElementText(g),d.collapse(!1),"inherit"!=g.contentEditable&&e++):(d.moveToElementText(a.parentNode),d.collapse(!0),d.move("character",1),d.move("character",-1)),b+=e,0<b&&d.move("character",b)!=b&&console.error("Error when moving!"));return d},decomposeTextRange:function(d){var a=m.getEndPoint(d),b=a[0],e=a[1],g=a[0];a=a[1];d.htmlText.length&&
(d.htmlText==d.text?a=e+d.text.length:(a=m.getEndPoint(d,!0),g=a[0],a=a[1]));return[b,e,g,a]},setRange:function(d,a,b,e,g,h){a=m.setEndPoint(d,a,b);d.setEndPoint("StartToStart",a);if(!h)var c=m.setEndPoint(d,e,g);d.setEndPoint("EndToEnd",c||a);return d}},k=n.W3CRange=u(null,{constructor:function(){0<arguments.length?(this.setStart(arguments[0][0],arguments[0][1]),this.setEnd(arguments[0][2],arguments[0][3])):(this.startContainer=this.commonAncestorContainer=null,this.startOffset=0,this.endContainer=
null,this.endOffset=0,this.collapsed=!0)},_updateInternal:function(){this.commonAncestorContainer=this.startContainer!==this.endContainer?n.getCommonAncestor(this.startContainer,this.endContainer):this.startContainer;this.collapsed=this.startContainer===this.endContainer&&this.startOffset==this.endOffset},setStart:function(d,a){a=parseInt(a);if(this.startContainer!==d||this.startOffset!=a)delete this._cachedBookmark,this.startContainer=d,this.startOffset=a,this.endContainer?this._updateInternal():
this.setEnd(d,a)},setEnd:function(d,a){a=parseInt(a);if(this.endContainer!==d||this.endOffset!=a)delete this._cachedBookmark,this.endContainer=d,this.endOffset=a,this.startContainer?this._updateInternal():this.setStart(d,a)},setStartAfter:function(d,a){this._setPoint("setStart",d,a,1)},setStartBefore:function(d,a){this._setPoint("setStart",d,a,0)},setEndAfter:function(d,a){this._setPoint("setEnd",d,a,1)},setEndBefore:function(d,a){this._setPoint("setEnd",d,a,0)},_setPoint:function(d,a,b,e){b=n.getIndex(a,
a.parentNode).o;this[d](a.parentNode,b.pop()+e)},_getIERange:function(){var d=(this._body||this.endContainer.ownerDocument.body).createTextRange();m.setRange(d,this.startContainer,this.startOffset,this.endContainer,this.endOffset,this.collapsed);return d},getBookmark:function(){this._getIERange();return this._cachedBookmark},_select:function(){this._getIERange().select()},deleteContents:function(){var d=this.startContainer,a=this._getIERange();3!==d.nodeType||this.startOffset||this.setStartBefore(d);
a.pasteHTML("");this.endContainer=this.startContainer;this.endOffset=this.startOffset;this.collapsed=!0},cloneRange:function(){var d=new k([this.startContainer,this.startOffset,this.endContainer,this.endOffset]);d._body=this._body;return d},detach:function(){this.startContainer=this.commonAncestorContainer=this._body=null;this.startOffset=0;this.endContainer=null;this.endOffset=0;this.collapsed=!0}});r.setObject("dijit.range",n);return n})},"dijit/_editor/html":function(){define(["dojo/_base/array",
"dojo/_base/lang","dojo/sniff"],function(G,u,r){var n={};u.setObject("dijit._editor.html",n);var m=n.escapeXml=function(k,d){k=k.replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;");d||(k=k.replace(/'/gm,"\x26#39;"));return k};n.getNodeHtml=function(k){var d=[];n.getNodeHtmlHelper(k,d);return d.join("")};n.getNodeHtmlHelper=function(k,d){switch(k.nodeType){case 1:var a=k.nodeName.toLowerCase();if(!a||"/"==a.charAt(0))return"";d.push("\x3c",a);var b=
[],e={},g;if(r("dom-attributes-explicit")||r("dom-attributes-specified-flag"))for(var h=0;g=k.attributes[h++];){var c=g.name;"_dj"===c.substr(0,3)||r("dom-attributes-specified-flag")&&!g.specified||c in e||(g=g.value,("src"==c||"href"==c)&&k.getAttribute("_djrealurl")&&(g=k.getAttribute("_djrealurl")),8===r("ie")&&"style"===c&&(g=g.replace("HEIGHT:","height:").replace("WIDTH:","width:")),b.push([c,g]),e[c]=g)}else{var f=(/^input$|^img$/i.test(k.nodeName)?k:k.cloneNode(!1)).outerHTML;e=f.match(/[\w-]+=("[^"]*"|'[^']*'|\S*)/gi);
f=f.substr(0,f.indexOf("\x3e"));G.forEach(e,function(l){if(l){var q=l.indexOf("\x3d");if(0<q&&(l=l.substring(0,q),"_dj"!=l.substr(0,3)))if("src"!=l&&"href"!=l||!k.getAttribute("_djrealurl")){switch(l){case "style":var t=k.style.cssText.toLowerCase();break;case "class":t=k.className;break;case "width":if("img"===a){(q=/width=(\S+)/i.exec(f))&&(t=q[1]);break}case "height":if("img"===a){(q=/height=(\S+)/i.exec(f))&&(t=q[1]);break}default:t=k.getAttribute(l)}null!=t&&b.push([l,t.toString()])}else b.push([l,
k.getAttribute("_djrealurl")])}},this)}b.sort(function(l,q){return l[0]<q[0]?-1:l[0]==q[0]?0:1});for(e=0;g=b[e++];)d.push(" ",g[0],'\x3d"',"string"===typeof g[1]?m(g[1],!0):g[1],'"');switch(a){case "br":case "hr":case "img":case "input":case "base":case "meta":case "area":case "basefont":d.push(" /\x3e");break;case "script":d.push("\x3e",k.innerHTML,"\x3c/",a,"\x3e");break;default:d.push("\x3e"),k.hasChildNodes()&&n.getChildrenHtmlHelper(k,d),d.push("\x3c/",a,"\x3e")}break;case 4:case 3:d.push(m(k.nodeValue,
!0));break;case 8:d.push("\x3c!--",m(k.nodeValue,!0),"--\x3e");break;default:d.push("\x3c!-- Element not recognized - Type: ",k.nodeType," Name: ",k.nodeName,"--\x3e")}};n.getChildrenHtml=function(k){var d=[];n.getChildrenHtmlHelper(k,d);return d.join("")};n.getChildrenHtmlHelper=function(k,d){if(k)for(var a=k.childNodes||k,b=!r("ie")||a!==k,e,g=0;e=a[g++];)b&&e.parentNode!=k||n.getNodeHtmlHelper(e,d)};return n})},"dijit/_editor/plugins/LinkDialog":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/query dojo/string ../_Plugin ../../form/DropDownButton ../range".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c){var f=r("dijit._editor.plugins.LinkDialog",g,{allowUnsafeHtml:!1,linkFilter:[[/</g,"\x26lt;"]],buttonClass:h,useDefaultCommand:!1,urlRegExp:"((https?|ftps?|file)\\://|./|../|/|)(/[a-zA-Z]{1,1}:/|)(((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)*(?:[a-zA-Z](?:[-\\da-zA-Z]{0,80}[\\da-zA-Z])?)\\.?)|(((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])|(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]|(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]|(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])|0[xX]0*[\\da-fA-F]{1,8}|([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}|([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])))(\\:\\d+)?(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]{0,}(?:\\?[^?#\\s/]*)?(?:#.*)?)?)?",
emailRegExp:"\x3c?(mailto\\:)([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)|localhost|^[^-][a-zA-Z0-9_-]*\x3e?",htmlTemplate:'\x3ca href\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" target\x3d"${targetSelect}"\x3e${textInput}\x3c/a\x3e',tag:"a",_hostRxp:/^((([^\[:]+):)?([^@]+)@)?(\[([^\]]+)\]|([^\[:]*))(:([0-9]+))?$/,_userAtRxp:/^([!#-'*+\-\/-9=?A-Z^-~]+[.])*[!#-'*+\-\/-9=?A-Z^-~]+@/i,
linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'true' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_targetSelect'\x3e${target}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cselect id\x3d'${id}_targetSelect' name\x3d'targetSelect' data-dojo-type\x3d'dijit.form.Select'\x3e\x3coption selected\x3d'selected' value\x3d'_self'\x3e${currentWindow}\x3c/option\x3e\x3coption value\x3d'_blank'\x3e${newWindow}\x3c/option\x3e\x3coption value\x3d'_top'\x3e${topWindow}\x3c/option\x3e\x3coption value\x3d'_parent'\x3e${parentWindow}\x3c/option\x3e\x3c/select\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
_initButton:function(){this.inherited(arguments);this.button.loadDropDown=k.hitch(this,"_loadDropDown");this._connectTagEvents()},_loadDropDown:function(q){G("dojo/i18n ../../TooltipDialog ../../registry ../../form/Button ../../form/Select ../../form/ValidationTextBox dojo/i18n!../../nls/common dojo/i18n!../nls/LinkDialog".split(" "),k.hitch(this,function(t,v,w){var x=this;this.tag="insertImage"==this.command?"img":"a";t=k.delegate(t.getLocalization("dijit","common",this.lang),t.getLocalization("dijit._editor",
"LinkDialog",this.lang));var H=this.dropDown=this.button.dropDown=new v({title:t[this.command+"Title"],ownerDocument:this.editor.ownerDocument,dir:this.editor.dir,execute:k.hitch(this,"setValue"),onOpen:function(){x._onOpenDialog();v.prototype.onOpen.apply(this,arguments)},onCancel:function(){setTimeout(k.hitch(x,"_onCloseDialog"),0)}});t.urlRegExp=this.urlRegExp;t.id=w.getUniqueId(this.editor.id);this._uniqueId=t.id;this._setContent(H.title+"\x3cdiv style\x3d'border-bottom: 1px black solid;padding-bottom:2pt;margin-bottom:4pt'\x3e\x3c/div\x3e"+
e.substitute(this.linkDialogTemplate,t));H.startup();this._urlInput=w.byId(this._uniqueId+"_urlInput");this._textInput=w.byId(this._uniqueId+"_textInput");this._setButton=w.byId(this._uniqueId+"_setButton");this.own(w.byId(this._uniqueId+"_cancelButton").on("click",k.hitch(this.dropDown,"onCancel")));this._urlInput&&this.own(this._urlInput.on("change",k.hitch(this,"_checkAndFixInput")));this._textInput&&this.own(this._textInput.on("change",k.hitch(this,"_checkAndFixInput")));this._urlRegExp=new RegExp("^"+
this.urlRegExp+"$","i");this._emailRegExp=new RegExp("^"+this.emailRegExp+"$","i");this._urlInput.isValid=k.hitch(this,function(){var A=this._urlInput.get("value");return this._urlRegExp.test(A)||this._emailRegExp.test(A)});this.own(d(H.domNode,"keydown",k.hitch(this,k.hitch(this,function(A){!A||A.keyCode!=m.ENTER||A.shiftKey||A.metaKey||A.ctrlKey||A.altKey||this._setButton.get("disabled")||(H.onExecute(),H.execute(H.get("value")))}))));q()}))},_checkAndFixInput:function(){var q=this,t=this._urlInput.get("value");
this._delayedCheck&&(clearTimeout(this._delayedCheck),this._delayedCheck=null);this._delayedCheck=setTimeout(function(){var v=t,w=!1,x=!1;v&&1<v.length&&(v=k.trim(v),0!==v.indexOf("mailto:")&&(0<v.indexOf("/")?-1===v.indexOf("://")&&"/"!==v.charAt(0)&&v.indexOf("./")&&0!==v.indexOf("../")&&q._hostRxp.test(v)&&(w=!0):q._userAtRxp.test(v)&&(x=!0)));w&&q._urlInput.set("value","http://"+v);x&&q._urlInput.set("value","mailto:"+v);q._setButton.set("disabled",!q._isValid())},250)},_connectTagEvents:function(){this.editor.onLoadDeferred.then(k.hitch(this,
function(){this.own(d(this.editor.editNode,"mouseup",k.hitch(this,"_onMouseUp")));this.own(d(this.editor.editNode,"dblclick",k.hitch(this,"_onDblClick")))}))},_isValid:function(){return this._urlInput.isValid()&&this._textInput.isValid()},_setContent:function(q){this.dropDown.set({parserScope:"dojo",content:q})},_checkValues:function(q){q&&q.urlInput&&(q.urlInput=q.urlInput.replace(/"/g,"\x26quot;"));!this.allowUnsafeHtml&&q&&q.textInput&&("function"===typeof this.linkFilter?q.textInput=this.linkFilter(q.textInput):
u.forEach(this.linkFilter,function(t){q.textInput=q.textInput.replace(t[0],t[1])}));return q},_createlinkEnabledImpl:function(){return!0},setValue:function(q){this._onCloseDialog();if(9>a("ie")){var t=c.getSelection(this.editor.window).getRangeAt(0).endContainer;3===t.nodeType&&(t=t.parentNode);t&&t.nodeName&&t.nodeName.toLowerCase()!==this.tag&&(t=this.editor.selection.getSelectedElement(this.tag));t&&t.nodeName&&t.nodeName.toLowerCase()===this.tag&&this.editor.queryCommandEnabled("unlink")&&(this.editor.selection.selectElementChildren(t),
this.editor.execCommand("unlink"))}q=this._checkValues(q);this.editor.execCommand("inserthtml",e.substitute(this.htmlTemplate,q));b("a",this.editor.document).forEach(function(v){v.innerHTML||n.has(v,"name")||v.parentNode.removeChild(v)},this)},_onCloseDialog:function(){this.editor.focused&&this.editor.focus()},_getCurrentValues:function(q){if(q&&q.tagName.toLowerCase()===this.tag){var t=q.getAttribute("_djrealurl")||q.getAttribute("href");var v=q.getAttribute("target")||"_self";var w=q.textContent||
q.innerText;this.editor.selection.selectElement(q,!0)}else w=this.editor.selection.getSelectedText();return{urlInput:t||"",textInput:w||"",targetSelect:v||""}},_onOpenDialog:function(){if(a("ie")){var q=c.getSelection(this.editor.window);if(q.rangeCount){var t=q.getRangeAt(0);var v=t.endContainer;3===v.nodeType&&(v=v.parentNode);v&&v.nodeName&&v.nodeName.toLowerCase()!==this.tag&&(v=this.editor.selection.getSelectedElement(this.tag));if(!v||v.nodeName&&v.nodeName.toLowerCase()!==this.tag)(q=this.editor.selection.getAncestorElement(this.tag))&&
q.nodeName&&q.nodeName.toLowerCase()==this.tag?(v=q,this.editor.selection.selectElement(v)):t.startContainer===t.endContainer&&(q=t.startContainer.firstChild)&&q.nodeName&&q.nodeName.toLowerCase()==this.tag&&(v=q,this.editor.selection.selectElement(v))}}else v=this.editor.selection.getAncestorElement(this.tag);this.dropDown.reset();this._setButton.set("disabled",!0);this.dropDown.set("value",this._getCurrentValues(v))},_onDblClick:function(q){if(q&&q.target&&(q=q.target,(q.tagName?q.tagName.toLowerCase():
"")===this.tag&&n.get(q,"href"))){var t=this.editor;this.editor.selection.selectElement(q);t.onDisplayChanged();t._updateTimer&&(t._updateTimer.remove(),delete t._updateTimer);t.onNormalizedDisplayChanged();var v=this.button;setTimeout(function(){v.set("disabled",!1);v.loadAndOpenDropDown().then(function(){v.dropDown.focus&&v.dropDown.focus()})},10)}},_onMouseUp:function(){if(a("ff")){var q=this.editor.selection.getAncestorElement(this.tag);if(q){var t=c.getSelection(this.editor.window).getRangeAt(0);
if(t.collapsed&&q.childNodes.length){var v=t.cloneRange();v.selectNodeContents(q.childNodes[q.childNodes.length-1]);v.setStart(q.childNodes[0],0);1!==t.compareBoundaryPoints(v.START_TO_START,v)?t.setStartBefore(q):-1!==t.compareBoundaryPoints(v.END_TO_START,v)&&t.setStartAfter(q)}}}}}),l=r("dijit._editor.plugins.ImgLinkDialog",[f],{linkDialogTemplate:"\x3ctable role\x3d'presentation'\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_urlInput'\x3e${url}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput dojoType\x3d'dijit.form.ValidationTextBox' regExp\x3d'${urlRegExp}' required\x3d'true' id\x3d'${id}_urlInput' name\x3d'urlInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d'${id}_textInput'\x3e${text}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput data-dojo-type\x3d'dijit.form.ValidationTextBox' required\x3d'false' id\x3d'${id}_textInput' name\x3d'textInput' data-dojo-props\x3d'intermediateChanges:true'/\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3c/td\x3e\x3ctd\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d'2'\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'submit' id\x3d'${id}_setButton'\x3e${set}\x3c/button\x3e\x3cbutton data-dojo-type\x3d'dijit.form.Button' type\x3d'button' id\x3d'${id}_cancelButton'\x3e${buttonCancel}\x3c/button\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",
htmlTemplate:'\x3cimg src\x3d"${urlInput}" _djrealurl\x3d"${urlInput}" alt\x3d"${textInput}" /\x3e',tag:"img",_getCurrentValues:function(q){if(q&&q.tagName.toLowerCase()===this.tag){var t=q.getAttribute("_djrealurl")||q.getAttribute("src");var v=q.getAttribute("alt");this.editor.selection.selectElement(q,!0)}else v=this.editor.selection.getSelectedText();return{urlInput:t||"",textInput:v||""}},_isValid:function(){return this._urlInput.isValid()},_connectTagEvents:function(){this.inherited(arguments);
this.editor.onLoadDeferred.then(k.hitch(this,function(){this.own(d(this.editor.editNode,"mousedown",k.hitch(this,"_selectTag")))}))},_selectTag:function(q){q&&q.target&&(q=q.target,(q.tagName?q.tagName.toLowerCase():"")===this.tag&&this.editor.selection.selectElement(q))},_checkValues:function(q){q&&q.urlInput&&(q.urlInput=q.urlInput.replace(/"/g,"\x26quot;"));q&&q.textInput&&(q.textInput=q.textInput.replace(/"/g,"\x26quot;"));return q},_onDblClick:function(q){if(q&&q.target&&(q=q.target,(q.tagName?
q.tagName.toLowerCase():"")===this.tag&&n.get(q,"src"))){var t=this.editor;this.editor.selection.selectElement(q);t.onDisplayChanged();t._updateTimer&&(t._updateTimer.remove(),delete t._updateTimer);t.onNormalizedDisplayChanged();var v=this.button;setTimeout(function(){v.set("disabled",!1);v.loadAndOpenDropDown().then(function(){v.dropDown.focus&&v.dropDown.focus()})},10)}}});g.registry.createLink=function(q){var t={command:"createLink",allowUnsafeHtml:"allowUnsafeHtml"in q?q.allowUnsafeHtml:!1};
"linkFilter"in q&&(t.linkFilter=q.linkFilter);return new f(t)};g.registry.insertImage=function(){return new l({command:"insertImage"})};f.ImgLinkDialog=l;return f})},"dijit/_editor/plugins/TextColor":function(){define("require dojo/colors dojo/_base/declare dojo/_base/lang ../_Plugin ../../form/DropDownButton".split(" "),function(G,u,r,n,m,k){var d=r("dijit._editor.plugins.TextColor",m,{buttonClass:k,colorPicker:"dijit/ColorPalette",useDefaultCommand:!1,_initButton:function(){this.command=this.name;
this.inherited(arguments);var a=this;this.button.loadDropDown=function(b){function e(g){a.button.dropDown=new g({dir:a.editor.dir,ownerDocument:a.editor.ownerDocument,value:a.value,onChange:function(h){a.editor.execCommand(a.command,h)},onExecute:function(){a.editor.execCommand(a.command,this.get("value"))}});b()}"string"==typeof a.colorPicker?G([a.colorPicker],e):e(a.colorPicker)}},updateState:function(){var a=this.editor,b=this.command;if(a&&a.isLoaded&&b.length){if(this.button){var e=this.get("disabled");
this.button.set("disabled",e);if(e)return;try{var g=a.queryCommandValue(b)||""}catch(h){g=""}}""==g&&(g="#000000");"transparent"==g&&(g="#ffffff");"string"==typeof g?-1<g.indexOf("rgb")&&(g=u.fromRgb(g).toHex()):(g=((g&255)<<16|g&65280|(g&16711680)>>>16).toString(16),g="#000000".slice(0,7-g.length)+g);this.value=g;(a=this.button.dropDown)&&a.get&&g!==a.get("value")&&a.set("value",g,!1)}}});m.registry.foreColor=function(a){return new d(a)};m.registry.hiliteColor=function(a){return new d(a)};return d})},
"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(G,u,r,n){var m={};u.setObject("dojo.colors",m);var k=function(a,b,e){0>e&&++e;1<e&&--e;var g=6*e;return 1>g?a+(b-a)*g:1>2*e?b:2>3*e?a+(b-a)*(2/3-e)*6:a};G.colorFromRgb=r.fromRgb=function(a,b){var e=a.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(e){a=e[2].split(/\s*,\s*/);var g=a.length;e=e[1];if("rgb"==e&&3==g||"rgba"==e&&4==g)return e=a[0],"%"==e.charAt(e.length-1)?(e=n.map(a,
function(f){return 2.56*parseFloat(f)}),4==g&&(e[3]=a[3]),r.fromArray(e,b)):r.fromArray(a,b);if("hsl"==e&&3==g||"hsla"==e&&4==g){e=(parseFloat(a[0])%360+360)%360/360;var h=parseFloat(a[1])/100,c=parseFloat(a[2])/100;h=.5>=c?c*(h+1):c+h-c*h;c=2*c-h;e=[256*k(c,h,e+1/3),256*k(c,h,e),256*k(c,h,e-1/3),1];4==g&&(e[3]=a[3]);return r.fromArray(e,b)}}return null};var d=function(a,b,e){a=Number(a);return isNaN(a)?e:a<b?b:a>e?e:a};r.prototype.sanitize=function(){this.r=Math.round(d(this.r,0,255));this.g=Math.round(d(this.g,
0,255));this.b=Math.round(d(this.b,0,255));this.a=d(this.a,0,1);return this};m.makeGrey=r.makeGrey=function(a,b){return r.fromArray([a,a,a,b])};u.mixin(r.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,
149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,
0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],
lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,
0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,
232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,
250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return r})},"esri/dijit/editing/AttachmentEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/io-query dojo/dom-attr dijit/_Widget dijit/_Templated dijit/ProgressBar ../../kernel ../../lang ../../domUtils dojo/text!./templates/AttachmentEditor.html dojo/i18n!../../nls/jsapi dojo/NodeList-dom".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t){G=G([e,g],{declaredClass:"esri.dijit.editing.AttachmentEditor",widgetsInTemplate:!0,templateString:q,_listHtml:"\x3cspan id\x3d'node_${oid}_${attid}' style\x3d'display: flex;'\x3e\x3ca href\x3d'${href}' target\x3d'_blank'\x3e${name}\x3c/a\x3e",_deleteBtnHtml:"\x3cspan style\x3d'cursor:pointer;color:red;font-weight:bold;padding:0 2px;' class\x3d'deleteAttachment' id\x3d'${attid}');'\x3eX\x3c/span\x3e",_endHtml:"\x3cbr/\x3e\x3c/span\x3e",_aeConnects:[],_layerEditingCapChecked:{},
_layerEditingCap:{},constructor:function(v,w){u.mixin(this,t.widgets.attachmentEditor)},startup:function(){this.inherited(arguments);this._uploadField_connect=r.connect(this._uploadField,"onchange",this,function(){0<this._uploadField.value.length&&this._addAttachment()});this._uploadFieldFocus_connect=r.connect(this._uploadField,"onfocus",u.hitch(this,function(v){l.hide(this._attachmentError)}))},destroy:function(){n.forEach(this._aeConnects,r.disconnect);r.disconnect(this._uploadField_connect);r.disconnect(this._uploadFieldFocus_connect);
this.inherited(arguments)},showAttachments:function(v,w){this._attachmentList.innerHTML=this.NLS_none;this._uploadField.value="";n.forEach(this.domNode.children,function(x,H){l.show(x)});l.hide(this._attachmentError);v&&(this._featureLayer=v.getLayer()||w)&&("esri.layers.FeatureLayer"===this._featureLayer.declaredClass&&this._featureLayer.getEditCapabilities?(this._currentLayerId=this._featureLayer.id,this._layerEditingCapChecked[this._currentLayerId]||(this._layerEditingCap[this._currentLayerId]=
this._featureLayer.getEditCapabilities(),this._layerEditingCapChecked[this._currentLayerId]=!0),this._featureCanUpdate=this._featureLayer.getEditCapabilities({feature:v}).canUpdate,this._oid=v.attributes[this._featureLayer.objectIdField],this._getAttachments(v)):w&&w.getEditCapabilities()||(l.hide(this._uploadForm),n.forEach(this.domNode.children,function(x,H){l.hide(x)})))},_getAttachments:function(v){this._featureLayer&&this._featureLayer.queryAttachmentInfos&&this._featureLayer.queryAttachmentInfos(this._oid,
u.hitch(this,"_onQueryAttachmentInfosComplete"))},_addAttachment:function(){l.hide(this._attachmentError);this._featureLayer&&this._featureLayer.addAttachment?(l.show(this._attachmentProgress),this._featureLayer.addAttachment(this._oid,this._uploadForm,u.hitch(this,"_onAddAttachmentComplete"),u.hitch(this,"_onAddAttachmentError"))):this._tempUpload=this._uploadForm},_chainAttachment:function(v,w){this._tempUpload&&(l.show(this._attachmentProgress),w.addAttachment(v,this._tempUpload,u.hitch(this,"_onAddAttachmentComplete"),
u.hitch(this,"_onAddAttachmentError")));this._tempUpload=null},_deleteAttachment:function(v,w){l.show(this._attachmentProgress);this._featureLayer.deleteAttachments(v,[w],u.hitch(this,"_onDeleteAttachmentComplete"))},_onQueryAttachmentInfosComplete:function(v){var w=this._listHtml+this._deleteBtnHtml+this._endHtml;this._uploadForm.style.display="block";!this._featureCanUpdate&&this._layerEditingCap[this._currentLayerId].canUpdate||!this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate?
(w=this._listHtml+this._endHtml,this._uploadForm.style.display="none"):this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(w=this._listHtml+this._endHtml);var x=this._attachmentList;v=n.map(v,u.hitch(this,function(H){return f.substitute({href:H.url,name:H.name,oid:H.objectId,attid:H.id},w)}));x.innerHTML=v.join("")||this.NLS_none;this._updateConnects()},_onAddAttachmentComplete:function(v){l.hide(this._attachmentProgress.domNode);var w=this._attachmentList,
x=this._uploadField,H=x.value,A=H.lastIndexOf("\\");-1<A&&(H=H.substring(A+1,H.length));H=H.replace(/ /g,"_");A=a.objectToQuery({gdbVersion:this._featureLayer.gdbVersion,token:this._featureLayer._getToken()});var z=this._listHtml+this._deleteBtnHtml+this._endHtml;this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(z=this._listHtml+this._endHtml);v=f.substitute({href:this._featureLayer._url.path+"/"+v.objectId+"/attachments/"+v.attachmentId+
(A?"?"+A:""),name:H,oid:v.objectId,attid:v.attachmentId},z);w.innerHTML=w.innerHTML==this.NLS_none?v:w.innerHTML+v;this._updateConnects();x.value=""},_onAddAttachmentError:function(v){l.hide(this._attachmentProgress.domNode);if(v){var w=this.NLS_error,x=this._attachmentError;f.isDefined(v.code)&&400===v.code&&(w=this.NLS_fileNotSupported);b.set(x,"innerHTML",w);l.show(x)}},_onDeleteAttachmentComplete:function(v){l.hide(this._attachmentProgress.domNode);var w=this._attachmentList;n.every(v,function(x){return x.success})&&
(m.query("#node_"+v[0].objectId+"_"+v[0].attachmentId).orphan(),w.children&&w.children.length||(w.innerHTML=this.NLS_none))},_updateConnects:function(){n.forEach(this._aeConnects,r.disconnect);m.query(".deleteAttachment").forEach(function(v){this._aeConnects.push(r.connect(v,"onclick",u.hitch(this,"_deleteAttachment",this._oid,v.id)))},this)}});k("extend-esri")&&u.setObject("dijit.editing.AttachmentEditor",G,c);return G})},"dijit/ProgressBar":function(){define("require dojo/_base/declare dojo/dom-class dojo/_base/lang dojo/number ./_Widget ./_TemplatedMixin dojo/text!./templates/ProgressBar.html".split(" "),
function(G,u,r,n,m,k,d,a){return u("dijit.ProgressBar",[k,d],{progress:"0",value:"",maximum:100,places:0,indeterminate:!1,label:"",name:"",templateString:a,_indeterminateHighContrastImagePath:G.toUrl("./themes/a11y/indeterminate_progress.gif"),postMixInProperties:function(){this.inherited(arguments);this.params&&"value"in this.params||(this.value=this.indeterminate?Infinity:this.progress)},buildRendering:function(){this.inherited(arguments);this.indeterminateHighContrastImage.setAttribute("src",this._indeterminateHighContrastImagePath.toString());
this.update()},_setDirAttr:function(b){var e="rtl"==b.toLowerCase();r.toggle(this.domNode,"dijitProgressBarRtl",e);r.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&e);this.inherited(arguments)},update:function(b){n.mixin(this,b||{});b=this.internalProgress;var e=this.domNode,g=1;this.indeterminate?e.removeAttribute("aria-valuenow"):(-1!=String(this.progress).indexOf("%")?(g=Math.min(parseFloat(this.progress)/100,1),this.progress=g*this.maximum):(this.progress=Math.min(this.progress,
this.maximum),g=this.maximum?this.progress/this.maximum:0),e.setAttribute("aria-valuenow",this.progress));e.setAttribute("aria-labelledby",this.labelNode.id);e.setAttribute("aria-valuemin",0);e.setAttribute("aria-valuemax",this.maximum);this.labelNode.innerHTML=this.report(g);r.toggle(this.domNode,"dijitProgressBarIndeterminate",this.indeterminate);r.toggle(this.domNode,"dijitProgressBarIndeterminateRtl",this.indeterminate&&!this.isLeftToRight());b.style.width=100*g+"%";this.onChange()},_setValueAttr:function(b){this._set("value",
b);Infinity==b?this.update({indeterminate:!0}):this.update({indeterminate:!1,progress:b})},_setLabelAttr:function(b){this._set("label",b);this.update()},_setIndeterminateAttr:function(b){this._set("indeterminate",b);this.update()},report:function(b){return this.label?this.label:this.indeterminate?"\x26#160;":m.format(b,{type:"percent",places:this.places,locale:this.lang})},onChange:function(){}})})},"esri/dijit/editing/Util":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/has","../../kernel"],
function(G,u,r,n){var m={};m={findFeatures:function(k,d,a){var b=d.objectIdField;d=u.filter(d.graphics,function(e){return u.some(k,function(g){return e.attributes[b]===g.objectId})});if(a)a(d);else return d},getSelection:function(k){var d=[];u.forEach(k,function(a){a=a.getSelectedFeatures();u.forEach(a,function(b){d.push(b)})});return d},sortFeaturesById:function(k,d){var a=u.map(k,function(b){return b.featureLayer});d.sort(function(b,e){var g=b.getLayer(),h=e.getLayer();if(!g)return-1;if(!h)return 1;
var c=u.indexOf(a,g);h=u.indexOf(a,h);c-=h;c||(g=g.objectIdField,c=b.attributes[g]-e.attributes[g]);return c});return d}};r("extend-esri")&&G.setObject("dijit.editing.Util.LayerHelper",m,n);return m})},"dijit/form/DateTextBox":function(){define(["dojo/_base/declare","../Calendar","./_DateTimeTextBox"],function(G,u,r){return G("dijit.form.DateTextBox",r,{baseClass:"dijitTextBox dijitComboBox dijitDateTextBox",popupClass:u,_selector:"date",maxHeight:Infinity,value:new Date("")})})},"dijit/Calendar":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff ./CalendarLite ./_Widget ./_CssStateMixin ./_TemplatedMixin ./form/DropDownButton".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t){var v=n("dijit.Calendar",[c,f,l],{baseClass:"dijitCalendar",cssStateNodes:{decrementMonth:"dijitCalendarArrow",incrementMonth:"dijitCalendarArrow",previousYearLabelNode:"dijitCalendarPreviousYear",nextYearLabelNode:"dijitCalendarNextYear"},setValue:function(w){a.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",w)},_createMonthWidget:function(){return new v._MonthDropDownButton({id:this.id+"_mddb",
tabIndex:-1,onMonthSelect:e.hitch(this,"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},postCreate:function(){this.inherited(arguments);this.own(g(this.domNode,"keydown",e.hitch(this,"_onKeyDown")),g(this.dateRowsNode,"mouseover",e.hitch(this,"_onDayMouseOver")),g(this.dateRowsNode,"mouseout",e.hitch(this,"_onDayMouseOut")),g(this.dateRowsNode,"mousedown",e.hitch(this,"_onDayMouseDown")),g(this.dateRowsNode,"mouseup",e.hitch(this,"_onDayMouseUp")))},_onMonthSelect:function(w){var x=
new this.dateClassObj(this.currentFocus);x.setDate(1);x.setMonth(w);w=this.dateModule.getDaysInMonth(x);var H=this.currentFocus.getDate();x.setDate(Math.min(H,w));this._setCurrentFocusAttr(x)},_onDayMouseOver:function(w){(w=k.contains(w.target,"dijitCalendarDateLabel")?w.target.parentNode:w.target)&&(w.dijitDateValue&&!k.contains(w,"dijitCalendarDisabledDate")||w==this.previousYearLabelNode||w==this.nextYearLabelNode)&&(k.add(w,"dijitCalendarHoveredDate"),this._currentNode=w)},_onDayMouseOut:function(w){!this._currentNode||
w.relatedTarget&&w.relatedTarget.parentNode==this._currentNode||(w="dijitCalendarHoveredDate",k.contains(this._currentNode,"dijitCalendarActiveDate")&&(w+=" dijitCalendarActiveDate"),k.remove(this._currentNode,w),this._currentNode=null)},_onDayMouseDown:function(w){(w=w.target.parentNode)&&w.dijitDateValue&&!k.contains(w,"dijitCalendarDisabledDate")&&(k.add(w,"dijitCalendarActiveDate"),this._currentNode=w)},_onDayMouseUp:function(w){(w=w.target.parentNode)&&w.dijitDateValue&&k.remove(w,"dijitCalendarActiveDate")},
handleKey:function(w){var x=-1,H=this.currentFocus;switch(w.keyCode){case b.RIGHT_ARROW:x=1;case b.LEFT_ARROW:var A="day";this.isLeftToRight()||(x*=-1);break;case b.DOWN_ARROW:x=1;case b.UP_ARROW:A="week";break;case b.PAGE_DOWN:x=1;case b.PAGE_UP:A=w.ctrlKey||w.altKey?"year":"month";break;case b.END:H=this.dateModule.add(H,"month",1),A="day";case b.HOME:H=new this.dateClassObj(H);H.setDate(1);break;default:return!0}A&&(H=this.dateModule.add(H,A,x));this._setCurrentFocusAttr(H);return!1},_onKeyDown:function(w){this.handleKey(w)||
(w.stopPropagation(),w.preventDefault())},onValueSelected:function(){},onChange:function(w){this.onValueSelected(w)},getClassForDate:function(){}});v._MonthDropDownButton=n("dijit.Calendar._MonthDropDownButton",t,{onMonthSelect:function(){},postCreate:function(){this.inherited(arguments);this.dropDown=new v._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect})},_setMonthAttr:function(w){var x=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,w);this.dropDown.set("months",
x);this.containerNode.innerHTML=(6==h("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+this.dropDown.domNode.innerHTML+"\x3c/div\x3e")+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+x[w.getMonth()]+"\x3c/div\x3e"}});v._MonthDropDown=n("dijit.Calendar._MonthDropDown",[f,q,l],{months:[],baseClass:"dijitCalendarMonthMenu dijitMenu",templateString:"\x3cdiv data-dojo-attach-event\x3d'ondijitclick:_onClick'\x3e\x3c/div\x3e",_setMonthsAttr:function(w){this.domNode.innerHTML=
"";G.forEach(w,function(x,H){d.create("div",{className:"dijitCalendarMonthLabel",month:H,innerHTML:x},this.domNode)._cssState="dijitCalendarMonthLabel"},this)},_onClick:function(w){this.onChange(m.get(w.target,"month"))},onChange:function(){}});return v})},"dijit/CalendarLite":function(){define("dojo/_base/array dojo/_base/declare dojo/cldr/supplemental dojo/date dojo/date/locale dojo/date/stamp dojo/dom dojo/dom-class dojo/dom-attr dojo/_base/lang dojo/on dojo/sniff dojo/string ./_WidgetBase ./_TemplatedMixin dojo/text!./templates/Calendar.html ./a11yclick ./hccss".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q){var t=u("dijit.CalendarLite",[f,l],{templateString:q,dowTemplateString:'\x3cth class\x3d"dijitReset dijitCalendarDayLabelTemplate" role\x3d"columnheader" scope\x3d"col"\x3e\x3cspan class\x3d"dijitCalendarDayLabel"\x3e${d}\x3c/span\x3e\x3c/th\x3e',dateTemplateString:'\x3ctd class\x3d"dijitReset" role\x3d"gridcell" data-dojo-attach-point\x3d"dateCells"\x3e\x3cspan class\x3d"dijitCalendarDateLabel" data-dojo-attach-point\x3d"dateLabels"\x3e\x3c/span\x3e\x3c/td\x3e',
weekTemplateString:'\x3ctr class\x3d"dijitReset dijitCalendarWeekTemplate" role\x3d"row"\x3e${d}${d}${d}${d}${d}${d}${d}\x3c/tr\x3e',value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",dayOffset:-1,currentFocus:new Date,_setSummaryAttr:"gridNode",baseClass:"dijitCalendar dijitCalendarLite",_isValidDate:function(v){return v&&!isNaN(v)&&"object"==typeof v&&v.toString()!=this.constructor.prototype.value.toString()},_getValueAttr:function(){var v=this._get("value");if(v&&!isNaN(v)){var w=
new this.dateClassObj(v);w.setHours(0,0,0,0);w.getDate()<v.getDate()&&(w=this.dateModule.add(w,"hour",1));return w}return null},_setValueAttr:function(v,w){"string"==typeof v&&(v=k.fromISOString(v));v=this._patchDate(v);if(this._isValidDate(v)&&!this.isDisabledDate(v,this.lang)){if(this._set("value",v),this.set("currentFocus",v),this._markSelectedDates([v]),this._created&&(w||"undefined"==typeof w))this.onChange(this.get("value"))}else this._set("value",null),this._markSelectedDates([])},_patchDate:function(v){if(v||
0===v)v=new this.dateClassObj(v),v.setHours(1,0,0,0);return v},_setText:function(v,w){for(;v.firstChild;)v.removeChild(v.firstChild);v.appendChild(v.ownerDocument.createTextNode(w))},_populateGrid:function(){var v=new this.dateClassObj(this.currentFocus);v.setDate(1);v=this._patchDate(v);var w=v.getDay(),x=this.dateModule.getDaysInMonth(v),H=this.dateModule.getDaysInMonth(this.dateModule.add(v,"month",-1)),A=new this.dateClassObj,z=0<=this.dayOffset?this.dayOffset:r.getFirstDayOfWeek(this.lang);z>
w&&(z-=7);if(!this.summary){var E=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,v);this.gridNode.setAttribute("summary",E[v.getMonth()])}this._date2cell={};G.forEach(this.dateCells,function(J,D){var L=D+z,C=new this.dateClassObj(v),N="dijitCalendar",S=0;L<w?(L=H-w+L+1,S=-1,N+="Previous"):L>=w+x?(L=L-w-x+1,S=1,N+="Next"):(L=L-w+1,N+="Current");S&&(C=this.dateModule.add(C,"month",S));C.setDate(L);this.dateModule.compare(C,A,"date")||(N="dijitCalendarCurrentDate "+N);this.isDisabledDate(C,
this.lang)?(N="dijitCalendarDisabledDate "+N,J.setAttribute("aria-disabled","true")):(N="dijitCalendarEnabledDate "+N,J.removeAttribute("aria-disabled"),J.setAttribute("aria-selected","false"));(S=this.getClassForDate(C,this.lang))&&(N=S+" "+N);J.className=N+"Month dijitCalendarDateTemplate";N=C.valueOf();this._date2cell[N]=J;J.dijitDateValue=N;N=C.getDateLocalized?C.getDateLocalized(this.lang):C.getDate();this._setText(this.dateLabels[D],N);b.set(J,"aria-label",m.format(C,{selector:"date",formatLength:"long"}))},
this)},_populateControls:function(){var v=new this.dateClassObj(this.currentFocus);v.setDate(1);this.monthWidget.set("month",v);var w=v.getFullYear()-1,x=new this.dateClassObj;G.forEach(["previous","current","next"],function(H){x.setFullYear(w++);this._setText(this[H+"YearLabelNode"],this.dateLocaleModule.format(x,{selector:"year",locale:this.lang}))},this)},goToToday:function(){this.set("value",new this.dateClassObj)},constructor:function(v){this.dateModule=v.datePackage?e.getObject(v.datePackage,
!1):n;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=v.datePackage?e.getObject(v.datePackage+".locale",!1):m},_createMonthWidget:function(){return t._MonthWidget({id:this.id+"_mddb",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},buildRendering:function(){var v=this.dowTemplateString,w=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),x=0<=this.dayOffset?this.dayOffset:r.getFirstDayOfWeek(this.lang);this.dayCellsHtml=c.substitute([v,
v,v,v,v,v,v].join(""),{d:""},function(){return w[x++%7]});v=c.substitute(this.weekTemplateString,{d:this.dateTemplateString});this.dateRowsHtml=[v,v,v,v,v,v].join("");this.dateCells=[];this.dateLabels=[];this.inherited(arguments);d.setSelectable(this.domNode,!1);v=new this.dateClassObj(this.currentFocus);this.monthWidget=this._createMonthWidget();this.set("currentFocus",v,!1)},postCreate:function(){this.inherited(arguments);this._connectControls()},_connectControls:function(){var v=e.hitch(this,function(w,
x,H){this[w].dojoClick=!0;return g(this[w],"click",e.hitch(this,function(){this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,x,H))}))});this.own(v("incrementMonth","month",1),v("decrementMonth","month",-1),v("nextYearLabelNode","year",1),v("previousYearLabelNode","year",-1))},_setCurrentFocusAttr:function(v,w){var x=this.currentFocus,H=this._getNodeByDate(x);v=this._patchDate(v);this._set("currentFocus",v);this._date2cell&&0==this.dateModule.difference(x,v,"month")||(this._populateGrid(),
this._populateControls(),this._markSelectedDates([this.value]));v=this._getNodeByDate(v);v.setAttribute("tabIndex",this.tabIndex);(this.focused||w)&&v.focus();H&&H!=v&&(h("webkit")?H.setAttribute("tabIndex","-1"):H.removeAttribute("tabIndex"))},focus:function(){this._setCurrentFocusAttr(this.currentFocus,!0)},_onDayClick:function(v){v.stopPropagation();v.preventDefault();for(v=v.target;v&&!v.dijitDateValue&&0!==v.dijitDateValue;v=v.parentNode);v&&!a.contains(v,"dijitCalendarDisabledDate")&&this.set("value",
v.dijitDateValue)},_getNodeByDate:function(v){return(v=this._patchDate(v))&&this._date2cell?this._date2cell[v.valueOf()]:null},_markSelectedDates:function(v){function w(x,H){a.toggle(H,"dijitCalendarSelectedDate",x);H.setAttribute("aria-selected",x?"true":"false")}G.forEach(this._selectedCells||[],e.partial(w,!1));this._selectedCells=G.filter(G.map(v,this._getNodeByDate,this),function(x){return x});G.forEach(this._selectedCells,e.partial(w,!0))},onChange:function(){},isDisabledDate:function(){},getClassForDate:function(){}});
t._MonthWidget=u("dijit.CalendarLite._MonthWidget",f,{_setMonthAttr:function(v){var w=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,v),x=6==h("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+G.map(w,function(H){return"\x3cdiv\x3e"+H+"\x3c/div\x3e"}).join("")+"\x3c/div\x3e";this.domNode.innerHTML=x+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+w[v.getMonth()]+"\x3c/div\x3e"}});return t})},"dijit/form/_DateTimeTextBox":function(){define("dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/_base/lang ./RangeBoundTextBox ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(G,u,r,n,m,k,d,a){new Date("X");return n("dijit.form._DateTimeTextBox",[k,d],{templateString:a,hasDownArrow:!0,cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_unboundedConstraints:{},pattern:u.regexp,datePackage:"",postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},compare:function(b,e){var g=this._isInvalidDate(b),h=this._isInvalidDate(e);if(g||h)return g&&h?0:g?-1:1;b=this.format(b,this._unboundedConstraints);e=this.format(e,this._unboundedConstraints);
g=this.parse(b,this._unboundedConstraints);h=this.parse(e,this._unboundedConstraints);return b==e?0:G.compare(g,h,this._selector)},autoWidth:!0,format:function(b,e){return b?this.dateLocaleModule.format(b,e):""},parse:function(b,e){return this.dateLocaleModule.parse(b,e)||(this._isEmpty(b)?null:void 0)},serialize:function(b,e){b.toGregorian&&(b=b.toGregorian());return r.toISOString(b,e)},dropDownDefaultValue:new Date,value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(b){b=
b||{};this.dateModule=b.datePackage?m.getObject(b.datePackage,!1):G;this.dateClassObj=this.dateModule.Date||Date;this.dateClassObj instanceof Date||(this.value=new this.dateClassObj(this.value));this.dateLocaleModule=b.datePackage?m.getObject(b.datePackage+".locale",!1):u;this._set("pattern",this.dateLocaleModule.regexp);this._invalidDate=this.constructor.prototype.value.toString()},buildRendering:function(){this.inherited(arguments);this.hasDownArrow||(this._buttonNode.style.display="none");this.hasDownArrow||
(this._buttonNode=this.domNode,this.baseClass+=" dijitComboBoxOpenOnClick")},_setConstraintsAttr:function(b){b.selector=this._selector;b.fullYear=!0;var e=r.fromISOString;"string"==typeof b.min&&(b.min=e(b.min),this.dateClassObj instanceof Date||(b.min=new this.dateClassObj(b.min)));"string"==typeof b.max&&(b.max=e(b.max),this.dateClassObj instanceof Date||(b.max=new this.dateClassObj(b.max)));this.inherited(arguments);this._unboundedConstraints=m.mixin({},this.constraints,{min:null,max:null})},_isInvalidDate:function(b){return!b||
isNaN(b)||"object"!=typeof b||b.toString()==this._invalidDate},_setValueAttr:function(b,e,g){void 0!==b&&("string"==typeof b&&(b=r.fromISOString(b)),this._isInvalidDate(b)&&(b=null),b instanceof Date&&!(this.dateClassObj instanceof Date)&&(b=new this.dateClassObj(b)));this.inherited(arguments,[b,e,g]);this.value instanceof Date&&(this.filterString="");!1!==e&&this.dropDown&&this.dropDown.set("value",b,!1)},_set:function(b,e){if("value"==b){e instanceof Date&&!(this.dateClassObj instanceof Date)&&
(e=new this.dateClassObj(e));var g=this._get("value");if(g instanceof this.dateClassObj&&0==this.compare(e,g))return}this.inherited(arguments)},_setDropDownDefaultValueAttr:function(b){this._isInvalidDate(b)&&(b=new this.dateClassObj);this._set("dropDownDefaultValue",b)},openDropDown:function(b){this.dropDown&&this.dropDown.destroy();var e=m.isString(this.popupClass)?m.getObject(this.popupClass,!1):this.popupClass,g=this,h=this.get("value");this.dropDown=new e({onChange:function(c){g.set("value",
c,!0)},id:this.id+"_popup",dir:g.dir,lang:g.lang,value:h,textDir:g.textDir,currentFocus:this._isInvalidDate(h)?this.dropDownDefaultValue:h,constraints:g.constraints,filterString:g.filterString,datePackage:g.datePackage,isDisabledDate:function(c){return!g.rangeCheck(c,g.constraints)}});this.inherited(arguments)},_getDisplayedValueAttr:function(){return this.textbox.value},_setDisplayedValueAttr:function(b,e){this._setValueAttr(this.parse(b,this.constraints),e,b)}})})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare",
"dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(G,u,r){return G("dijit.form.RangeBoundTextBox",r,{rangeMessage:"",rangeCheck:function(n,m){return("min"in m?0<=this.compare(n,m.min):!0)&&("max"in m?0>=this.compare(n,m.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var n=this.get("value");if(null==n)return!1;var m=!1;"min"in this.constraints&&(m=this.constraints.min,m=0>this.compare(n,"number"==typeof m&&
0<=m&&0!=n?0:m));!m&&"max"in this.constraints&&(m=this.constraints.max,m=0<this.compare(n,"number"!=typeof m||0<m?m:0));return m},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(n){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(n))},getErrorMessage:function(n){var m=this.get("value");return null==m||""===m||"number"==typeof m&&isNaN(m)||this.isInRange(n)?this.inherited(arguments):this.rangeMessage},
postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=u.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(G,u,r,n){return G("dijit.form.MappedTextBox",n,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(m){return m.toString?
m.toString():""},toString:function(){var m=this.filter(this.get("value"));return null!=m?"string"==typeof m?m:this.serialize(m,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=r.place("\x3cinput type\x3d'hidden'"+(this.name&&!u("msapp")?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},
"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),function(G,u,r,n,m,k){var d=function(b){b=b||{};var e=r.getLocalization("dojo.cldr","number",r.normalizeLocale(b.locale)),g=b.pattern?b.pattern:e[(b.type||"decimal")+"Format"];b="number"==typeof b.places?b.places:"string"===typeof b.places&&0<b.places.length?b.places.replace(/.*,/,""):-1!=g.indexOf(".")?g.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:e.decimal,
places:b}},a=G("dijit.form.NumberTextBoxMixin",null,{pattern:function(b){return"("+(this.focused&&this.editOptions?this._regExpGenerator(u.delegate(b,this.editOptions))+"|":"")+this._regExpGenerator(b)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:m.format,_regExpGenerator:m.regexp,_decimalInfo:d(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},_setConstraintsAttr:function(b){var e="number"==typeof b.places?b.places:0;e&&e++;"number"!=typeof b.max&&
(b.max=9*Math.pow(10,15-e));"number"!=typeof b.min&&(b.min=-9*Math.pow(10,15-e));this.inherited(arguments,[b]);this.focusNode&&this.focusNode.value&&!isNaN(this.value)&&this.set("value",this.value);this._decimalInfo=d(b)},_onFocus:function(b){if(!this.disabled&&!this.readOnly){var e=this.get("value");"number"!=typeof e||isNaN(e)||(e=this.format(e,this.constraints),void 0!==e&&(this.textbox.value=e,"mouse"!==b&&this.textbox.select()));this.inherited(arguments)}},format:function(b,e){var g=String(b);
if("number"!=typeof b)return g;if(isNaN(b))return"";if(!("rangeCheck"in this&&this.rangeCheck(b,e))&&!1!==e.exponent&&/\de[-+]?\d/i.test(g))return g;this.editOptions&&this.focused&&(e=u.mixin({},e,this.editOptions));return this._formatter(b,e)},_parser:m.parse,parse:function(b,e){var g=u.mixin({},e,this.editOptions&&this.focused?this.editOptions:{});if(this.focused&&null!=g.places){var h=g.places;h="number"===typeof h?h:Number(h.split(",").pop());g.places="0,"+h}g=this._parser(b,g);this.editOptions&&
this.focused&&isNaN(g)&&(g=this._parser(b,e));return g},_getDisplayedValueAttr:function(){var b=this.inherited(arguments);return isNaN(b)?this.textbox.value:b},filter:function(b){if(null==b||"string"==typeof b&&""==b)return NaN;"number"!=typeof b||isNaN(b)||0==b||(b=m.round(b,this._decimalInfo.places));return this.inherited(arguments,[b])},serialize:function(b,e){return"number"!=typeof b||isNaN(b)?"":this.inherited(arguments)},_setBlurValue:function(){var b=u.hitch(u.delegate(this,{focused:!0}),"get")("value");
this._setValueAttr(b,!0)},_setValueAttr:function(b,e,g){if(void 0!==b&&void 0===g)if(g=String(b),"number"==typeof b)if(isNaN(b))g="";else{if("rangeCheck"in this&&this.rangeCheck(b,this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(g))g=void 0}else b?b=void 0:(g="",b=NaN);this.inherited(arguments,[b,e,g])},_getValueAttr:function(){var b=this.inherited(arguments);if(isNaN(b)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&(new RegExp("^"+
m._realNumberRegexp(u.delegate(this.constraints))+"$")).test(this.textbox.value))return b=Number(this.textbox.value),isNaN(b)?void 0:b}else return b},isValid:function(b){if(!this.focused||this._isEmpty(this.textbox.value))return this.inherited(arguments);var e=this.get("value");return!isNaN(e)&&this.rangeCheck(e,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var b="number"==typeof this.constraints.min,
e="number"==typeof this.constraints.max,g=this.get("value");if(isNaN(g)||!b&&!e)return this.inherited(arguments);var h=g|0,c=0>g,f=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),l=(this.maxLength||20)-this.textbox.value.length,q=f?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,""):"";h=f?h+"."+q:h+"";l=n.rep("9",l);f=g;c?f=Number(h+l):g=Number(h+l);return!(b&&g<this.constraints.min||e&&f>this.constraints.max)}});G=G("dijit.form.NumberTextBox",[k,a],{baseClass:"dijitTextBox dijitNumberTextBox"});
G.Mixin=a;return G})},"dijit/form/FilteringSelect":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","./MappedTextBox","./ComboBoxMixin"],function(G,u,r,n,m){return G("dijit.form.FilteringSelect",[n,m],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return!!this.item||!this.required&&""==this.get("displayedValue")},_refreshState:function(){this.searchTimer||this.inherited(arguments)},_callbackSetLabel:function(k,d,a,b){d&&d[this.searchAttr]!==
this._lastQuery||!d&&k.length&&this.store.getIdentity(k[0])!=this._lastQuery||(k.length?this.set("item",k[0],b):this.set("value","",b||void 0===b&&!this.focused,this.textbox.value,null))},_openResultList:function(k,d,a){d[this.searchAttr]===this._lastQuery&&(this.inherited(arguments),void 0===this.item&&this.validate(!0))},_getValueAttr:function(){return this.valueNode.value},_getValueField:function(){return"value"},_setValueAttr:function(k,d,a,b){this._onChangeActive||(d=null);if(void 0===b){if(null===
k||""===k)if(k="",!u.isString(a)){this._setDisplayedValueAttr(a||"",d);return}var e=this;this._lastQuery=k;r(this.store.get(k),function(g){e._callbackSetLabel(g?[g]:[],void 0,void 0,d)})}else this.valueNode.value=k,this.inherited(arguments,[k,d,a,b])},_setItemAttr:function(k,d,a){this.inherited(arguments);this._lastDisplayedValue=this.textbox.value},_getDisplayQueryString:function(k){return k.replace(/([\\\*\?])/g,"\\$1")},_setDisplayedValueAttr:function(k,d){null==k&&(k="");if(!this._created){if(!("displayedValue"in
this.params))return;d=!1}if(this.store){this.closeDropDown();var a=u.clone(this.query),b=this._getDisplayQueryString(k);if(this.store._oldAPI)var e=b;else e=this._patternToRegExp(b),e.toString=function(){return b};this._lastQuery=a[this.searchAttr]=e;this._lastDisplayedValue=this.textbox.value=k;this._set("displayedValue",k);var g=this,h={queryOptions:{ignoreCase:this.ignoreCase,deep:!0}};u.mixin(h,this.fetchProperties);this._fetchHandle=this.store.query(a,h);r(this._fetchHandle,function(c){g._fetchHandle=
null;g._callbackSetLabel(c||[],a,h,d)},function(c){g._fetchHandle=null;g._cancelingQuery||console.error("dijit.form.FilteringSelect: "+c.toString())})}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),function(G,u,r,n,m,k,d,a,b){return G("dijit.form.ComboBoxMixin",
[a,k],{dropDownClass:d,hasDownArrow:!0,templateString:b,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(e){this._set("hasDownArrow",e);this._buttonNode.style.display=e?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(e){e.get||n.mixin(e,{_oldAPI:!0,get:function(g){var h=new u;this.fetchItemByIdentity({identity:g,onItem:function(c){h.resolve(c)},onError:function(c){h.reject(c)}});
return h.promise},query:function(g,h){var c=new u(function(){f.abort&&f.abort()});c.total=new u;var f=this.fetch(n.mixin({query:g,onBegin:function(l){c.total.resolve(l)},onComplete:function(l){c.resolve(l)},onError:function(l){c.reject(l)}},h));return m(c)}});this._set("store",e)},postMixInProperties:function(){var e=this.params.store||this.store;e&&this._setStoreAttr(e);this.inherited(arguments);if(!this.params.store&&this.store&&!this.store._oldAPI){var g=this.declaredClass;n.mixin(this.store,{getValue:function(h,
c){r.deprecated(g+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return h[c]},getLabel:function(h){r.deprecated(g+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return h.name},fetch:function(h){r.deprecated(g+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],n.hitch(this,function(c){(new c({objectStore:this})).fetch(h)}))}})}},buildRendering:function(){this.inherited(arguments);
this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(G,u,r,n,m,k,d,a,b,e,g){u=u("dijit.form._AutoCompleterMixin",g,{item:null,autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(h){var c=
0;if("number"==typeof h.selectionStart)c=h.selectionStart;else if(a("ie")){var f=h.ownerDocument.selection.createRange().duplicate();h=h.createTextRange();f.move("character",0);h.move("character",0);try{h.setEndPoint("EndToEnd",f),c=String(h.text).replace(/\r/g,"").length}catch(l){}}return c},_setCaretPos:function(h,c){c=parseInt(c);e.selectInputText(h,c,c)},_setDisabledAttr:function(h){this.inherited(arguments);this.domNode.setAttribute("aria-disabled",h?"true":"false")},_onKey:function(h){if(!(32<=
h.charCode)){var c=h.charCode||h.keyCode;if(c!=n.ALT&&c!=n.CTRL&&c!=n.META&&c!=n.SHIFT){var f=this.dropDown,l=null;this._abortQuery();this.inherited(arguments);if(!(h.altKey||h.ctrlKey||h.metaKey))switch(this._opened&&(l=f.getHighlightedOption()),c){case n.PAGE_DOWN:case n.DOWN_ARROW:case n.PAGE_UP:case n.UP_ARROW:this._opened&&this._announceOption(l);h.stopPropagation();h.preventDefault();break;case n.ENTER:if(l){if(l==f.nextButton){this._nextSearch(1);h.stopPropagation();h.preventDefault();break}else if(l==
f.previousButton){this._nextSearch(-1);h.stopPropagation();h.preventDefault();break}h.stopPropagation();h.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case n.TAB:c=this.get("displayedValue");if(f&&(c==f._messages.previousMessage||c==f._messages.nextMessage))break;l&&this._selectOption(l);case n.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},_autoCompleteText:function(h){var c=this.focusNode;e.selectInputText(c,c.value.length);
var f=this.ignoreCase?"toLowerCase":"substr";0==h[f](0).indexOf(this.focusNode.value[f](0))?(f=this.autoComplete?this._getCaretPos(c):c.value.length,f+1>c.value.length&&(c.value=h,e.selectInputText(c,f))):(c.value=h,e.selectInputText(c))},_openResultList:function(h,c,f){var l=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();h.length||0!=f.start?(this._nextSearch=this.dropDown.onPage=m.hitch(this,function(q){h.nextPage(-1!==q);this.focus()}),this.dropDown.createOptions(h,f,m.hitch(this,
"_getMenuLabelFromItem")),this._showResultList(),"direction"in f?(f.direction?this.dropDown.highlightFirstOption():f.direction||this.dropDown.highlightLastOption(),l&&this._announceOption(this.dropDown.getHighlightedOption())):!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(c[this.searchAttr].toString())||this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)):this.closeDropDown()},_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded",
"true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var h=this.get("displayedValue"),c=this.dropDown;!c||h!=c._messages.previousMessage&&h!=c._messages.nextMessage?"undefined"==typeof this.item?(this.item=null,this.set("displayedValue",h)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,
!0),this._refreshState()):this._setValueAttr(this._lastValueReported,!0);this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(h,c,f){var l="";h&&(f||(f=this.store._oldAPI?this.store.getValue(h,this.searchAttr):h[this.searchAttr]),l=this._getValueField()!=this.searchAttr?this.store.getIdentity(h):f);this.set("value",l,c,f,h)},_announceOption:function(h){if(h){if(h==this.dropDown.nextButton||h==this.dropDown.previousButton){var c=h.innerHTML;this.item=void 0;this.value=""}else{var f=
this.dropDown.items[h.getAttribute("item")];c=(this.store._oldAPI?this.store.getValue(f,this.searchAttr):f[this.searchAttr]).toString();this.set("item",f,!1,c)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",r.get(h,"id"));this._autoCompleteText(c)}},_selectOption:function(h){this.closeDropDown();h&&this._announceOption(h);this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,
!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(h){if(!this.dropDown){var c=this.id+"_popup";this.dropDown=new (m.isString(this.dropDownClass)?m.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:m.hitch(this,this._selectOption),id:c,dir:this.dir,textDir:this.textDir})}this._lastInput=h;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},
postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new b({},this.srcNodeRef),!("value"in this.params))){var h=this.item=this.store.fetchSelectedItem();if(h){var c=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(h,c):h[c]}}},postCreate:function(){var h=k('label[for\x3d"'+this.id+'"]');h.length&&(h[0].id||(h[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",h[0].id));this.inherited(arguments);G.after(this,"onSearch",
m.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(h){h=this.labelFunc(h,this.store);var c=this.labelType;"none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput&&(h=this.doHighlight(h,this._lastInput),c="html");return{html:"html"==c,label:h}},doHighlight:function(h,c){var f=(this.ignoreCase?"i":"")+("all"==this.highlightMatch?"g":""),l=this.queryExpr.indexOf("${0}");c=d.escapeString(c);return this._escapeHtml(h.replace(new RegExp((0==l?"^":"")+"("+c+")"+(l==this.queryExpr.length-
4?"$":""),f),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},_escapeHtml:function(h){return h=String(h).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},labelFunc:function(h,c){return(c._oldAPI?c.getValue(h,this.labelAttr||this.searchAttr):h[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(h,
c,f,l){this._set("item",l||null);null==h&&(h="");this.inherited(arguments)}});a("dojo-bidi")&&u.extend({_setTextDirAttr:function(h){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",h)}});return u})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),function(G,u,r,n,m,k){function d(a){return{id:a.value,value:a.value,name:r.trim(a.innerText||a.textContent||"")}}return G("dijit.form.DataList",
m,{constructor:function(a,b){this.domNode=u.byId(b);r.mixin(this,a);this.id&&k.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:n("option",this.domNode).map(d)}])},destroy:function(){k.remove(this.id)},fetchSelectedItem:function(){var a=n("\x3e option[selected]",this.domNode)[0]||n("\x3e option",this.domNode)[0];return a&&d(a)}})})},"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),
function(G,u,r,n,m,k,d){return G("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(a){this._set("list",a)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(a){return new RegExp("^"+a.replace(/(\\.)|(\*)|(\?)|\W/g,function(b,e,g,h){return g?".*":h?".":e?e:"\\"+b})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&
(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(a){if(!this.disabled&&!this.readOnly){a=a.charOrCode;this._prev_key_backspace=!1;if(a===u.DELETE||a===u.BACKSPACE)this._maskValidSubsetError=this._prev_key_backspace=!0;if(this.store)this.searchTimer=
this.defer("_startSearchFromInput",1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(a){this._abortQuery();var b=this,e=r.clone(this.query),g={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},h=m.substitute(this.queryExpr,[a.replace(/([\\\*\?])/g,"\\$1")]),c=function(){var l=b._fetchHandle=b.store.query(e,g);b.disabled||b.readOnly||f!==b._lastQuery||k(l,function(q){b._fetchHandle=
null;b.disabled||b.readOnly||f!==b._lastQuery||k(l.total,function(t){q.total=t;var v=b.pageSize;if(isNaN(v)||v>q.total)v=q.total;q.nextPage=function(w){g.direction=w=!1!==w;g.count=v;w?(g.start+=q.length,g.start>=q.total&&(g.count=0)):(g.start-=v,0>g.start&&(g.count=Math.max(v+g.start,0),g.start=0));0>=g.count?(q.length=0,b.onSearch(q,e,g)):c()};b.onSearch(q,e,g)})},function(q){b._fetchHandle=null;b._cancelingQuery||console.error(b.declaredClass+" "+q.toString())})};r.mixin(g,this.fetchProperties);
if(this.store._oldAPI)var f=h;else f=this._patternToRegExp(h),f.toString=function(){return h};this._lastQuery=e[this.searchAttr]=f;this._queryDeferHandle=this.defer(c,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var a=this.list;a&&(this.store=d.byId(a))}this.inherited(arguments)}})})},"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),
function(G,u,r,n,m,k,d,a){return G("dijit.form._ComboBoxMenu",[m,k,a,d],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(u.add(this.previousButton,"dijitMenuItemRtl"),u.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var b=this.ownerDocument.createElement("div");b.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");b.setAttribute("role","option");return b},onHover:function(b){u.add(b,"dijitMenuItemHover")},onUnhover:function(b){u.remove(b,
"dijitMenuItemHover")},onSelect:function(b){u.add(b,"dijitMenuItemSelected")},onDeselect:function(b){u.remove(b,"dijitMenuItemSelected")},_page:function(b){var e=0,g=this.domNode.scrollTop,h=r.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();e<h;){var c=this.getHighlightedOption();if(b){if(!c.previousSibling||"none"==c.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!c.nextSibling||"none"==c.nextSibling.style.display)break;this.selectNextNode()}c=
this.domNode.scrollTop;e+=(c-g)*(b?-1:1);g=c}},handleKey:function(b){switch(b.keyCode){case n.DOWN_ARROW:return this.selectNextNode(),!1;case n.PAGE_DOWN:return this._page(!1),!1;case n.UP_ARROW:return this.selectPreviousNode(),!1;case n.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(G,u,r,n,m){var k=u("dijit.form._ComboBoxMenuMixin"+
(n("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=m.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(d){this._set("value",d);this.onChange(d)},onClick:function(d){if(d==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(d==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(d)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(d,a){var b=this._createMenuItem();d=a(d);d.html?b.innerHTML=d.label:b.appendChild(b.ownerDocument.createTextNode(d.label));""==b.innerHTML&&(b.innerHTML="\x26#160;");return b},createOptions:function(d,a,b){this.items=d;this.previousButton.style.display=0==a.start?"none":"";r.set(this.previousButton,"id",this.id+
"_prev");G.forEach(d,function(g,h){g=this._createOption(g,b);g.setAttribute("item",h);r.set(g,"id",this.id+h);this.nextButton.parentNode.insertBefore(g,this.nextButton)},this);var e=!1;d.total&&!d.total.then&&-1!=d.total?a.start+a.count<d.total?e=!0:a.start+a.count>d.total&&a.count==d.length&&(e=!0):a.count==d.length&&(e=!0);this.nextButton.style.display=e?"":"none";r.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var d=this.containerNode;2<d.childNodes.length;)d.removeChild(d.childNodes[d.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});n("dojo-bidi")&&(k=u("dijit.form._ComboBoxMenuMixin",
k,{_createOption:function(){var d=this.inherited(arguments);this.applyTextDir(d);return d}}));return k})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(G,u,r,n){return G("dijit.form._ListMouseMixin",n,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(m,k){this._setSelectedAttr(k,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(k)})},_onMouseDown:function(m,k){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(k,!1)},_onMouseUp:function(m,k){this._isDragging=!1;var d=this.selected,a=this._hoveredNode;d&&k==d?this.defer(function(){this._onClick(m,
d)}):a&&this.defer(function(){this._onClick(m,a)})},_onMouseOut:function(m,k){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(m,k){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=k;this.onHover(k);this._isDragging&&this._setSelectedAttr(k,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(G,u,r){return G("dijit.form._ListBase",null,{selected:null,_listConnect:function(n,m){var k=this;return k.own(u(k.containerNode,u.selector(function(d,a,b){return d.parentNode==b},n),function(d){k[m](d,this)}))},selectFirstNode:function(){for(var n=this.containerNode.firstChild;n&&"none"==n.style.display;)n=n.nextSibling;this._setSelectedAttr(n,!0)},selectLastNode:function(){for(var n=this.containerNode.lastChild;n&&"none"==n.style.display;)n=n.previousSibling;this._setSelectedAttr(n,
!0)},selectNextNode:function(){var n=this.selected;if(n){for(n=n.nextSibling;n&&"none"==n.style.display;)n=n.nextSibling;n?this._setSelectedAttr(n,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var n=this.selected;if(n){for(n=n.previousSibling;n&&"none"==n.style.display;)n=n.previousSibling;n?this._setSelectedAttr(n,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(n,m){if(this.selected!=n){var k=this.selected;if(k)this.onDeselect(k);
n&&(m&&r.scrollIntoView(n),this.onSelect(n));this._set("selected",n)}else if(n)this.onSelect(n)}})})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare","dojo/keys","./_Spinner","./NumberTextBox"],function(G,u,r,n){return G("dijit.form.NumberSpinner",[r,n.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(m,k){var d=this.constraints,a=isNaN(m),b=!isNaN(d.max),e=!isNaN(d.min);a&&0!=k&&(m=0<k?e?d.min:b?d.max:0:b?this.constraints.max:e?d.min:0);k=m+k;if(a||
isNaN(k))return m;b&&k>d.max&&(k=d.max);e&&k<d.min&&(k=d.min);return k},_onKeyDown:function(m){if(!(this.disabled||this.readOnly||m.keyCode!=u.HOME&&m.keyCode!=u.END||m.ctrlKey||m.altKey||m.metaKey||"undefined"==typeof this.get("value"))){var k=this.constraints[m.keyCode==u.HOME?"min":"max"];"number"==typeof k&&this._setValueAttr(k,!1);m.stopPropagation();m.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),
function(G,u,r,n,m,k,d,a,b,e){return G("dijit.form._Spinner",a,{defaultTimeout:500,minimumTimeout:10,timeoutChangeRate:.9,smallDelta:1,largeDelta:10,templateString:b,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},adjust:function(g){return g},_arrowPressed:function(g,h,c){this.disabled||this.readOnly||(this._setValueAttr(this.adjust(this.get("value"),h*c),!1),e.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=
null},_typematicCallback:function(g,h,c){var f=this.smallDelta;h==this.textbox&&(h=c.keyCode,f=h==u.PAGE_UP||h==u.PAGE_DOWN?this.largeDelta:this.smallDelta,h=h==u.UP_ARROW||h==u.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==g?this._arrowReleased(h):this._arrowPressed(h,h==this.upArrowNode?1:-1,f)},_wheelTimer:null,_mouseWheeled:function(g){if(this.focused){g.stopPropagation();g.preventDefault();var h=g.wheelDelta/120;Math.floor(h)!=h&&(h=0<g.wheelDelta?1:-1);g=g.detail?-1*g.detail:h;if(0!==g){var c=
this[0<g?"upArrowNode":"downArrowNode"];this._arrowPressed(c,g,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(c)},50)}}},_setConstraintsAttr:function(g){this.inherited(arguments);this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):
this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(g,h){this.focusNode.setAttribute("aria-valuenow",g);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(k(this.domNode,m.wheel,r.hitch(this,"_mouseWheeled")),d.addListener(this.upArrowNode,this.textbox,{keyCode:u.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),d.addListener(this.downArrowNode,this.textbox,
{keyCode:u.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),d.addListener(this.upArrowNode,this.textbox,{keyCode:u.PAGE_UP,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),d.addListener(this.downArrowNode,this.textbox,{keyCode:u.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,
this.defaultTimeout,this.minimumTimeout))}})})},"dijit/form/SimpleTextarea":function(){define(["dojo/_base/declare","dojo/dom-class","dojo/sniff","./TextBox"],function(G,u,r,n){return G("dijit.form.SimpleTextarea",n,{baseClass:"dijitTextBox dijitTextArea",rows:"3",cols:"20",templateString:"\x3ctextarea ${!nameAttrSetting} data-dojo-attach-point\x3d'focusNode,containerNode,textbox' autocomplete\x3d'off'\x3e\x3c/textarea\x3e",postMixInProperties:function(){!this.value&&this.srcNodeRef&&(this.value=
this.srcNodeRef.value);this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);r("ie")&&this.cols&&u.add(this.textbox,"dijitTextAreaCols")},filter:function(m){m&&(m=m.replace(/\r/g,""));return this.inherited(arguments)},_onInput:function(m){if(this.maxLength){var k=parseInt(this.maxLength),d=this.textbox.value.replace(/\r/g,"");k=d.length-k;if(0<k){var a=this.textbox;if(a.selectionStart){var b=a.selectionStart,e=0;r("opera")&&(e=(this.textbox.value.substring(0,b).match(/\r/g)||
[]).length);this.textbox.value=d.substring(0,b-k-e)+d.substring(b-e);a.setSelectionRange(b-k,b-k)}else this.ownerDocument.selection&&(a.focus(),d=this.ownerDocument.selection.createRange(),d.moveStart("character",-k),d.text="",d.select())}}this.inherited(arguments)}})})},"dijit/form/TimeTextBox":function(){define("dojo/_base/declare dojo/keys dojo/query dojo/_base/lang ../_TimePicker ./_DateTimeTextBox".split(" "),function(G,u,r,n,m,k){return G("dijit.form.TimeTextBox",k,{baseClass:"dijitTextBox dijitComboBox dijitTimeTextBox",
popupClass:m,_selector:"time",value:new Date(""),maxHeight:-1,openDropDown:function(d){this.inherited(arguments);var a=r(".dijitTimePickerItemSelected",this.dropDown.domNode),b=this.dropDown.domNode.parentNode;b.scrollTop=a[0]?a[0].offsetTop-(b.clientHeight-a[0].clientHeight)/2:(b.scrollHeight-b.clientHeight)/2;this.dropDown.on("input",n.hitch(this,function(){this.set("value",this.dropDown.get("value"),!1)}))},_onInput:function(){this.inherited(arguments);var d=this.get("displayedValue");this.filterString=
d&&!this.parse(d,this.constraints)?d.toLowerCase():"";this._opened&&this.closeDropDown();this.openDropDown()}})})},"dijit/_TimePicker":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/sniff dojo/query dojo/mouse dojo/on ./_WidgetBase ./form/_ListMouseMixin".split(" "),function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q){return m("dijit._TimePicker",[l,q],{baseClass:"dijitTimePicker",
pickerMin:"T00:00:00",pickerMax:"T23:59:59",clickableIncrement:"T00:15:00",visibleIncrement:"T01:00:00",value:new Date,_visibleIncrement:2,_clickableIncrement:1,_totalIncrements:10,constraints:{},serialize:n.toISOString,buildRendering:function(){this.inherited(arguments);this.timeMenu=this.containerNode=this.domNode},setValue:function(t){a.deprecated("dijit._TimePicker:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",t)},_setValueAttr:function(t){this._set("value",
t);this._showText()},_setFilterStringAttr:function(t){this._set("filterString",t);this._showText()},isDisabledDate:function(){return!1},_getFilteredNodes:function(t,v,w,x){t=this.ownerDocument.createDocumentFragment();for(v=0;v<this._maxIncrement;v++)(w=this._createOption(v))&&t.appendChild(w);return t},_showText:function(){var t=n.fromISOString;this.domNode.innerHTML="";this._clickableIncrementDate=t(this.clickableIncrement);this._visibleIncrementDate=t(this.visibleIncrement);var v=function(x){return 3600*
x.getHours()+60*x.getMinutes()+x.getSeconds()},w=v(this._clickableIncrementDate);v=v(this._visibleIncrementDate);(this.value||this.currentFocus).getTime();this._refDate=t(this.pickerMin);this._refDate.setFullYear(1970,0,1);this._clickableIncrement=1;this._visibleIncrement=v/w;t=t(this.pickerMax);t.setFullYear(1970,0,1);t=.001*(t.getTime()-this._refDate.getTime());this._maxIncrement=Math.ceil((t+1)/w);w=this._getFilteredNodes();!w.firstChild&&this.filterString?(this.filterString="",this._showText()):
this.domNode.appendChild(w)},constructor:function(){this.constraints={}},postMixInProperties:function(){this.inherited(arguments);this._setConstraintsAttr(this.constraints)},_setConstraintsAttr:function(t){for(var v in{clickableIncrement:1,visibleIncrement:1,pickerMin:1,pickerMax:1})v in t&&(this[v]=t[v]);t.locale||(t.locale=this.lang)},_createOption:function(t){var v=new Date(this._refDate),w=this._clickableIncrementDate;v.setHours(v.getHours()+w.getHours()*t,v.getMinutes()+w.getMinutes()*t,v.getSeconds()+
w.getSeconds()*t);"time"==this.constraints.selector&&v.setFullYear(1970,0,1);var x=r.format(v,this.constraints);if(this.filterString&&0!==x.toLowerCase().indexOf(this.filterString))return null;w=this.ownerDocument.createElement("div");w.className=this.baseClass+"Item";w.date=v;w.idx=t;d.create("div",{"class":this.baseClass+"ItemInner",innerHTML:x},w);x=1>t%this._visibleIncrement&&-1<t%this._visibleIncrement;t=!x&&!(t%this._clickableIncrement);x?w.className+=" "+this.baseClass+"Marker":t&&(w.className+=
" "+this.baseClass+"Tick");this.isDisabledDate(v)&&(w.className+=" "+this.baseClass+"ItemDisabled");this.value&&!u.compare(this.value,v,this.constraints.selector)&&(w.selected=!0,w.className+=" "+this.baseClass+"ItemSelected",this._selectedDiv=w,x?w.className+=" "+this.baseClass+"MarkerSelected":t&&(w.className+=" "+this.baseClass+"TickSelected"),this._highlightOption(w,!0));return w},onOpen:function(){this.inherited(arguments);this.set("selected",this._selectedDiv)},_onOptionSelected:function(t,
v){(t=t.target.date||t.target.parentNode.date)&&!this.isDisabledDate(t)&&(this._set("value",t),this.emit("input"),v&&(this._highlighted_option=null,this.set("value",t),this.onChange(t)))},onChange:function(){},_highlightOption:function(t,v){if(t){if(v)this._highlighted_option&&this._highlightOption(this._highlighted_option,!1),this._highlighted_option=t;else{if(this._highlighted_option!==t)return;this._highlighted_option=null}k.toggle(t,this.baseClass+"ItemHover",v);k.contains(t,this.baseClass+"Marker")?
k.toggle(t,this.baseClass+"MarkerHover",v):k.toggle(t,this.baseClass+"TickHover",v)}},handleKey:function(t){if(t.keyCode==b.DOWN_ARROW)return this.selectNextNode(),this._onOptionSelected({target:this._highlighted_option},!1),t.stopPropagation(),t.preventDefault(),!1;if(t.keyCode==b.UP_ARROW)return this.selectPreviousNode(),this._onOptionSelected({target:this._highlighted_option},!1),t.stopPropagation(),t.preventDefault(),!1;if(t.keyCode==b.ENTER||t.keyCode===b.TAB){if(!this._keyboardSelected&&t.keyCode===
b.TAB)return!0;this._highlighted_option&&this._onOptionSelected({target:this._highlighted_option},!0);return t.keyCode===b.TAB}},onHover:function(t){this._highlightOption(t,!0)},onUnhover:function(t){this._highlightOption(t,!1)},onSelect:function(t){this._highlightOption(t,!0)},onDeselect:function(t){this._highlightOption(t,!1)},onClick:function(t){this._onOptionSelected({target:t},!0)}})})},"dojo/data/ItemFileReadStore":function(){define("../_base/kernel ../_base/lang ../_base/declare ../_base/array ../_base/xhr ../Evented ./util/filter ./util/simpleFetch ../date/stamp".split(" "),
function(G,u,r,n,m,k,d,a,b){r=r("dojo.data.ItemFileReadStore",[k],{constructor:function(e){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=!1;this.url=this._ccUrl=this._jsonFileUrl=e.url;this._jsonData=e.data;this.data=null;this._datatypeMap=e.typeMap||{};this._datatypeMap.Date||(this._datatypeMap.Date={type:Date,deserialize:function(g){return b.fromISOString(g)}});this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._itemsByIdentity=null;this._storeRefPropName=
"_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=!1;this._queuedFetches=[];void 0!==e.urlPreventCache&&(this.urlPreventCache=e.urlPreventCache?!0:!1);void 0!==e.hierarchical&&(this.hierarchical=e.hierarchical?!0:!1);e.clearOnClose&&(this.clearOnClose=!0);"failOk"in e&&(this.failOk=e.failOk?!0:!1)},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:!1,urlPreventCache:!1,failOk:!1,hierarchical:!0,_assertIsItem:function(e){if(!this.isItem(e))throw Error(this.declaredClass+
": Invalid item argument.");},_assertIsAttribute:function(e){if("string"!==typeof e)throw Error(this.declaredClass+": Invalid attribute argument.");},getValue:function(e,g,h){e=this.getValues(e,g);return 0<e.length?e[0]:h},getValues:function(e,g){this._assertIsItem(e);this._assertIsAttribute(g);return(e[g]||[]).slice(0)},getAttributes:function(e){this._assertIsItem(e);var g=[],h;for(h in e)h!==this._storeRefPropName&&h!==this._itemNumPropName&&h!==this._rootItemPropName&&h!==this._reverseRefMap&&
g.push(h);return g},hasAttribute:function(e,g){this._assertIsItem(e);this._assertIsAttribute(g);return g in e},containsValue:function(e,g,h){var c=void 0;"string"===typeof h&&(c=d.patternToRegExp(h,!1));return this._containsValue(e,g,h,c)},_containsValue:function(e,g,h,c){return n.some(this.getValues(e,g),function(f){if(null!==f&&!u.isObject(f)&&c){if(f.toString().match(c))return!0}else if(h===f)return!0})},isItem:function(e){return e&&e[this._storeRefPropName]===this&&this._arrayOfAllItems[e[this._itemNumPropName]]===
e?!0:!1},isItemLoaded:function(e){return this.isItem(e)},loadItem:function(e){this._assertIsItem(e.item)},getFeatures:function(){return this._features},getLabel:function(e){if(this._labelAttr&&this.isItem(e))return this.getValue(e,this._labelAttr)},getLabelAttributes:function(e){return this._labelAttr?[this._labelAttr]:null},filter:function(e,g,h){var c=[];if(e.query){var f=e.queryOptions?e.queryOptions.ignoreCase:!1;var l={};for(w in e.query){var q=e.query[w];"string"===typeof q?l[w]=d.patternToRegExp(q,
f):q instanceof RegExp&&(l[w]=q)}for(f=0;f<g.length;++f){var t=!0,v=g[f];if(null===v)t=!1;else for(w in e.query)q=e.query[w],this._containsValue(v,w,q,l[w])||(t=!1);t&&c.push(v)}}else for(f=0;f<g.length;++f){var w=g[f];null!==w&&c.push(w)}h(c,e)},_fetchItems:function(e,g,h){var c=this;if(this._loadFinished)this.filter(e,this._getItemsArray(e.queryOptions),g);else if(this._jsonFileUrl!==this._ccUrl?(G.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),
this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url),null!=this.data&&(this._jsonData=this.data,this.data=null),this._jsonFileUrl)if(this._loadInProgress)this._queuedFetches.push({args:e,filter:u.hitch(c,"filter"),findCallback:u.hitch(c,g)});else{this._loadInProgress=!0;var f=m.get({url:c._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk});f.addCallback(function(q){try{c._getItemsFromLoadedData(q),
c._loadFinished=!0,c._loadInProgress=!1,c.filter(e,c._getItemsArray(e.queryOptions),g),c._handleQueuedFetches()}catch(t){c._loadFinished=!0,c._loadInProgress=!1,h(t,e)}});f.addErrback(function(q){c._loadInProgress=!1;h(q,e)});var l=null;e.abort&&(l=e.abort);e.abort=function(){var q=f;q&&-1===q.fired&&(q.cancel(),q=null);l&&l.call(e)}}else if(this._jsonData)try{this._loadFinished=!0,this._getItemsFromLoadedData(this._jsonData),this._jsonData=null,c.filter(e,this._getItemsArray(e.queryOptions),g)}catch(q){h(q,
e)}else h(Error(this.declaredClass+": No JSON source data was provided as either URL or a nested Javascript object."),e)},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var e=0;e<this._queuedFetches.length;e++){var g=this._queuedFetches[e],h=g.args,c=g.filter;g=g.findCallback;c?c(h,this._getItemsArray(h.queryOptions),g):this.fetchItemByIdentity(h)}this._queuedFetches=[]}},_getItemsArray:function(e){return e&&e.deep?this._arrayOfAllItems:this._arrayOfTopLevelItems},close:function(e){this.clearOnClose&&
this._loadFinished&&!this._loadInProgress&&(""!=this._jsonFileUrl&&null!=this._jsonFileUrl||""!=this.url&&null!=this.url||null!=this.data||console.debug(this.declaredClass+": WARNING!  Data reload  information has not been provided.  Please set 'url' or 'data' to the appropriate value before the next fetch"),this._arrayOfAllItems=[],this._arrayOfTopLevelItems=[],this._loadFinished=!1,this._itemsByIdentity=null,this._loadInProgress=!1,this._queuedFetches=[])},_getItemsFromLoadedData:function(e){function g(E){return null!==
E&&"object"===typeof E&&(!u.isArray(E)||c)&&!u.isFunction(E)&&(E.constructor==Object||u.isArray(E))&&"undefined"===typeof E._reference&&"undefined"===typeof E._type&&"undefined"===typeof E._value&&f.hierarchical}function h(E){f._arrayOfAllItems.push(E);for(var J in E){var D=E[J];if(D)if(u.isArray(D))for(var L=0;L<D.length;++L){var C=D[L];g(C)&&h(C)}else g(D)&&h(D)}}var c=!1,f=this;this._labelAttr=e.label;var l;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=e.items;for(l=0;l<this._arrayOfTopLevelItems.length;++l){var q=
this._arrayOfTopLevelItems[l];u.isArray(q)&&(c=!0);h(q);q[this._rootItemPropName]=!0}var t={},v;for(l=0;l<this._arrayOfAllItems.length;++l)for(v in q=this._arrayOfAllItems[l],q){if(v!==this._rootItemPropName){var w=q[v];null!==w?u.isArray(w)||(q[v]=[w]):q[v]=[null]}t[v]=v}for(;t[this._storeRefPropName];)this._storeRefPropName+="_";for(;t[this._itemNumPropName];)this._itemNumPropName+="_";for(;t[this._reverseRefMap];)this._reverseRefMap+="_";if(t=e.identifier)for(this._itemsByIdentity={},this._features["dojo.data.api.Identity"]=
t,l=0;l<this._arrayOfAllItems.length;++l)if(q=this._arrayOfAllItems[l],e=q[t],e=e[0],Object.hasOwnProperty.call(this._itemsByIdentity,e)){if(this._jsonFileUrl)throw Error(this.declaredClass+":  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+t+"].  Value collided: ["+e+"]");if(this._jsonData)throw Error(this.declaredClass+":  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+t+"].  Value collided: ["+
e+"]");}else this._itemsByIdentity[e]=q;else this._features["dojo.data.api.Identity"]=Number;for(l=0;l<this._arrayOfAllItems.length;++l)q=this._arrayOfAllItems[l],q[this._storeRefPropName]=this,q[this._itemNumPropName]=l;for(l=0;l<this._arrayOfAllItems.length;++l)for(v in q=this._arrayOfAllItems[l],q)for(e=q[v],t=0;t<e.length;++t)if(w=e[t],null!==w&&"object"==typeof w){if("_type"in w&&"_value"in w){var x=w._type,H=this._datatypeMap[x];if(H)if(u.isFunction(H))e[t]=new H(w._value);else if(u.isFunction(H.deserialize))e[t]=
H.deserialize(w._value);else throw Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");else throw Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+x+"'");}if(w._reference){w=w._reference;if(u.isObject(w))for(x=0;x<this._arrayOfAllItems.length;++x){H=this._arrayOfAllItems[x];var A=!0,z;for(z in w)H[z]!=w[z]&&(A=!1);A&&(e[t]=H)}else e[t]=this._getItemByIdentity(w);
this.referenceIntegrity&&(w=e[t],this.isItem(w)&&this._addReferenceToMap(w,q,v))}else this.isItem(w)&&this.referenceIntegrity&&this._addReferenceToMap(w,q,v)}},_addReferenceToMap:function(e,g,h){},getIdentity:function(e){var g=this._features["dojo.data.api.Identity"];return g===Number?e[this._itemNumPropName]:(e=e[g])?e[0]:null},fetchItemByIdentity:function(e){if(this._loadFinished){var g=this._getItemByIdentity(e.identity);if(e.onItem){var h=e.scope?e.scope:G.global;e.onItem.call(h,g)}}else{var c=
this;this._jsonFileUrl!==this._ccUrl?(G.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=this.data&&null==this._jsonData&&(this._jsonData=this.data,this.data=null);this._jsonFileUrl?this._loadInProgress?this._queuedFetches.push({args:e}):(this._loadInProgress=!0,h=m.get({url:c._jsonFileUrl,
handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk}),h.addCallback(function(f){var l=e.scope?e.scope:G.global;try{c._getItemsFromLoadedData(f),c._loadFinished=!0,c._loadInProgress=!1,g=c._getItemByIdentity(e.identity),e.onItem&&e.onItem.call(l,g),c._handleQueuedFetches()}catch(q){c._loadInProgress=!1,e.onError&&e.onError.call(l,q)}}),h.addErrback(function(f){c._loadInProgress=!1;e.onError&&e.onError.call(e.scope?e.scope:G.global,f)})):this._jsonData&&(c._getItemsFromLoadedData(c._jsonData),
c._jsonData=null,c._loadFinished=!0,g=c._getItemByIdentity(e.identity),e.onItem&&(h=e.scope?e.scope:G.global,e.onItem.call(h,g)))}},_getItemByIdentity:function(e){var g=null;this._itemsByIdentity?Object.hasOwnProperty.call(this._itemsByIdentity,e)&&(g=this._itemsByIdentity[e]):Object.hasOwnProperty.call(this._arrayOfAllItems,e)&&(g=this._arrayOfAllItems[e]);void 0===g&&(g=null);return g},getIdentityAttributes:function(e){e=this._features["dojo.data.api.Identity"];return e===Number?null:[e]},_forceLoad:function(){var e=
this;this._jsonFileUrl!==this._ccUrl?(G.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=this.data&&(this._jsonData=this.data,this.data=null);if(this._jsonFileUrl){var g=m.get({url:this._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,
sync:!0});g.addCallback(function(h){try{if(!0!==e._loadInProgress&&!e._loadFinished)e._getItemsFromLoadedData(h),e._loadFinished=!0;else if(e._loadInProgress)throw Error(this.declaredClass+":  Unable to perform a synchronous load, an async load is in progress.");}catch(c){throw console.log(c),c;}});g.addErrback(function(h){throw h;})}else this._jsonData&&(e._getItemsFromLoadedData(e._jsonData),e._jsonData=null,e._loadFinished=!0)}});u.extend(r,a);return r})},"dojo/data/util/filter":function(){define(["../../_base/lang"],
function(G){var u={};G.setObject("dojo.data.util.filter",u);u.patternToRegExp=function(r,n){for(var m="^",k=null,d=0;d<r.length;d++)switch(k=r.charAt(d),k){case "\\":m+=k;d++;m+=r.charAt(d);break;case "*":m+=".*";break;case "?":m+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":m+="\\";default:m+=k}m+="$";return n?new RegExp(m,"mi"):new RegExp(m,"m")};return u})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang",
"../../_base/kernel","./sorter"],function(G,u,r){var n={};G.setObject("dojo.data.util.simpleFetch",n);n.errorHandler=function(m,k){k.onError&&k.onError.call(k.scope||u.global,m,k)};n.fetchHandler=function(m,k){var d=k.abort||null,a=!1,b=k.start?k.start:0,e=k.count&&Infinity!==k.count?b+k.count:m.length;k.abort=function(){a=!0;d&&d.call(k)};var g=k.scope||u.global;k.store||(k.store=this);k.onBegin&&k.onBegin.call(g,m.length,k);k.sort&&m.sort(r.createSortFunction(k.sort,this));if(k.onItem)for(var h=
b;h<m.length&&h<e;++h){var c=m[h];a||k.onItem.call(g,c,k)}k.onComplete&&!a&&(h=null,k.onItem||(h=m.slice(b,e)),k.onComplete.call(g,h,k))};n.fetch=function(m){m=m||{};m.store||(m.store=this);this._fetchItems(m,G.hitch(this,"fetchHandler"),G.hitch(this,"errorHandler"));return m};return n})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(G){var u={};G.setObject("dojo.data.util.sorter",u);u.basicComparator=function(r,n){var m=-1;null===r&&(r=void 0);null===n&&(n=void 0);if(r==
n)m=0;else if(r>n||null==r)m=1;return m};u.createSortFunction=function(r,n){function m(c,f,l,q){return function(t,v){t=q.getValue(t,c);v=q.getValue(v,c);return f*l(t,v)}}for(var k=[],d,a=n.comparatorMap,b=u.basicComparator,e=0;e<r.length;e++){d=r[e];var g=d.attribute;if(g){d=d.descending?-1:1;var h=b;a&&("string"!==typeof g&&"toString"in g&&(g=g.toString()),h=a[g]||b);k.push(m(g,d,h,n))}}return function(c,f){for(var l=0;l<k.length;){var q=k[l++](c,f);if(0!==q)return q}return 0}};return u})},"dojox/date/islamic":function(){define(["dojox/main",
"dojo/_base/lang","dojo/date","./islamic/Date"],function(G,u,r,n){var m=u.getObject("date.islamic",!0,G);m.getDaysInMonth=function(k){return k.getDaysInIslamicMonth(k.getMonth(),k.getFullYear())};m.compare=function(k,d,a){k instanceof n&&(k=k.toGregorian());d instanceof n&&(d=d.toGregorian());return r.compare.apply(null,arguments)};m.add=function(k,d,a){var b=new n(k);switch(d){case "day":b.setDate(k.getDate()+a);break;case "weekday":var e=k.getDay();if(5>e+a&&0<e+a)b.setDate(k.getDate()+a);else{var g=
d=0;5==e?(e=4,g=0<a?-1:1):6==e&&(e=4,g=0<a?-2:2);e=0<a?5-e-1:-e;var h=a-e,c=parseInt(h/5);0!=h%5&&(d=0<a?2:-2);d=d+7*c+h%5+e;b.setDate(k.getDate()+d+g)}break;case "year":b.setFullYear(k.getFullYear()+a);break;case "week":a*=7;b.setDate(k.getDate()+a);break;case "month":k=k.getMonth();b.setMonth(k+a);break;case "hour":b.setHours(k.getHours()+a);break;case "minute":b._addMinutes(a);break;case "second":b._addSeconds(a);break;case "millisecond":b._addMilliseconds(a)}return b};m.difference=function(k,
d,a){d=d||new n;a=a||"day";var b=d.getFullYear()-k.getFullYear(),e=1;switch(a){case "weekday":b=Math.round(m.difference(k,d,"day"));e=parseInt(m.difference(k,d,"week"));if(0==b%7)b=5*e;else{a=0;var g=k.getDay(),h=d.getDay();e=parseInt(b/7);d=b%7;k=new n(k);k.setDate(k.getDate()+7*e);k=k.getDay();if(0<b)switch(!0){case 5==g:a=-1;break;case 6==g:a=0;break;case 5==h:a=-1;break;case 6==h:a=-2;break;case 5<k+d:a=-2}else if(0>b)switch(!0){case 5==g:a=0;break;case 6==g:a=1;break;case 5==h:a=2;break;case 6==
h:a=1;break;case 0>k+d:a=2}b=b+a-2*e}e=b;break;case "year":e=b;break;case "month":a=d.toGregorian()>k.toGregorian()?d:k;g=d.toGregorian()>k.toGregorian()?k:d;e=a.getMonth();h=g.getMonth();if(0==b)e=a.getMonth()-g.getMonth();else for(e=12-h+e,b=g.getFullYear()+1,a=a.getFullYear(),b;b<a;b++)e+=12;d.toGregorian()<k.toGregorian()&&(e=-e);break;case "week":e=parseInt(m.difference(k,d,"day")/7);break;case "day":e/=24;case "hour":e/=60;case "minute":e/=60;case "second":e/=1E3;case "millisecond":e*=d.toGregorian().getTime()-
k.toGregorian().getTime()}return Math.round(e)};return m})},"dojox/main":function(){define(["dojo/_base/kernel"],function(G){return G.dojox})},"dojox/date/islamic/Date":function(){define(["dojo/_base/lang","dojo/_base/declare","dojo/date"],function(G,u,r){var n=u("dojox.date.islamic.Date",null,{_date:0,_month:0,_year:0,_hours:0,_minutes:0,_seconds:0,_milliseconds:0,_day:0,_GREGORIAN_EPOCH:1721425.5,_ISLAMIC_EPOCH:1948439.5,constructor:function(){var m=arguments.length;m?1==m?(m=arguments[0],"number"==
typeof m&&(m=new Date(m)),m instanceof Date?this.fromGregorian(m):""==m?this._date=new Date(""):(this._year=m._year,this._month=m._month,this._date=m._date,this._hours=m._hours,this._minutes=m._minutes,this._seconds=m._seconds,this._milliseconds=m._milliseconds)):3<=m&&(this._year+=arguments[0],this._month+=arguments[1],this._date+=arguments[2],this._hours+=arguments[3]||0,this._minutes+=arguments[4]||0,this._seconds+=arguments[5]||0,this._milliseconds+=arguments[6]||0):this.fromGregorian(new Date)},
getDate:function(){return this._date},getMonth:function(){return this._month},getFullYear:function(){return this._year},getDay:function(){return this.toGregorian().getDay()},getHours:function(){return this._hours},getMinutes:function(){return this._minutes},getSeconds:function(){return this._seconds},getMilliseconds:function(){return this._milliseconds},setDate:function(m){m=parseInt(m);if(!(0<m&&m<=this.getDaysInIslamicMonth(this._month,this._year))){var k;if(0<m)for(k=this.getDaysInIslamicMonth(this._month,
this._year);m>k;m-=k,k=this.getDaysInIslamicMonth(this._month,this._year))this._month++,12<=this._month&&(this._year++,this._month-=12);else for(k=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:this._year-1);0>=m;k=this.getDaysInIslamicMonth(0<=this._month-1?this._month-1:11,0<=this._month-1?this._year:this._year-1))this._month--,0>this._month&&(this._year--,this._month+=12),m+=k}this._date=m;return this},setFullYear:function(m){this._year=+m},setMonth:function(m){this._year+=
Math.floor(m/12);this._month=0<m?Math.floor(m%12):Math.floor((m%12+12)%12)},setHours:function(){var m=arguments.length,k=0;1<=m&&(k=parseInt(arguments[0]));2<=m&&(this._minutes=parseInt(arguments[1]));3<=m&&(this._seconds=parseInt(arguments[2]));4==m&&(this._milliseconds=parseInt(arguments[3]));for(;24<=k;)this._date++,m=this.getDaysInIslamicMonth(this._month,this._year),this._date>m&&(this._month++,12<=this._month&&(this._year++,this._month-=12),this._date-=m),k-=24;this._hours=k},_addMinutes:function(m){m+=
this._minutes;this.setMinutes(m);this.setHours(this._hours+parseInt(m/60));return this},_addSeconds:function(m){m+=this._seconds;this.setSeconds(m);this._addMinutes(parseInt(m/60));return this},_addMilliseconds:function(m){m+=this._milliseconds;this.setMilliseconds(m);this._addSeconds(parseInt(m/1E3));return this},setMinutes:function(m){this._minutes=m%60;return this},setSeconds:function(m){this._seconds=m%60;return this},setMilliseconds:function(m){this._milliseconds=m%1E3;return this},toString:function(){if(isNaN(this._date))return"Invalidate Date";
var m=new Date;m.setHours(this._hours);m.setMinutes(this._minutes);m.setSeconds(this._seconds);m.setMilliseconds(this._milliseconds);return this._month+" "+this._date+" "+this._year+" "+m.toTimeString()},toGregorian:function(){var m=this._year;m=Math.floor(this._date+Math.ceil(29.5*this._month)+354*(m-1)+Math.floor((3+11*m)/30)+this._ISLAMIC_EPOCH-1-.5)+.5;var k=m-this._GREGORIAN_EPOCH,d=Math.floor(k/146097),a=this._mod(k,146097);k=Math.floor(a/36524);var b=this._mod(a,36524);a=Math.floor(b/1461);
b=this._mod(b,1461);b=Math.floor(b/365);d=400*d+100*k+4*a+b;4!=k&&4!=b&&d++;k=m-(this._GREGORIAN_EPOCH+365*(d-1)+Math.floor((d-1)/4)-Math.floor((d-1)/100)+Math.floor((d-1)/400));a=this._GREGORIAN_EPOCH-1+365*(d-1)+Math.floor((d-1)/4)-Math.floor((d-1)/100)+Math.floor((d-1)/400)+Math.floor(739/12+(r.isLeapYear(new Date(d,3,1))?-1:-2)+1);a=m<a?0:r.isLeapYear(new Date(d,3,1))?1:2;k=Math.floor((12*(k+a)+373)/367);a=this._GREGORIAN_EPOCH-1+365*(d-1)+Math.floor((d-1)/4)-Math.floor((d-1)/100)+Math.floor((d-
1)/400)+Math.floor((367*k-362)/12+(2>=k?0:r.isLeapYear(new Date(d,k-1,1))?-1:-2)+1);return new Date(d,k-1,m-a+1,this._hours,this._minutes,this._seconds,this._milliseconds)},fromGregorian:function(m){m=new Date(m);var k=m.getFullYear(),d=m.getMonth(),a=m.getDate();k=this._GREGORIAN_EPOCH-1+365*(k-1)+Math.floor((k-1)/4)+-Math.floor((k-1)/100)+Math.floor((k-1)/400)+Math.floor((367*(d+1)-362)/12+(2>=d+1?0:r.isLeapYear(m)?-1:-2)+a);k=Math.floor(k)+.5;k-=this._ISLAMIC_EPOCH;d=Math.floor((30*k+10646)/10631);
a=Math.ceil((k-29-this._yearStart(d))/29.5);a=Math.min(a,11);this._date=Math.ceil(k-this._monthStart(d,a))+1;this._month=a;this._year=d;this._hours=m.getHours();this._minutes=m.getMinutes();this._seconds=m.getSeconds();this._milliseconds=m.getMilliseconds();this._day=m.getDay();return this},valueOf:function(){return this.toGregorian().valueOf()},_yearStart:function(m){return 354*(m-1)+Math.floor((3+11*m)/30)},_monthStart:function(m,k){return Math.ceil(29.5*k)+354*(m-1)+Math.floor((3+11*m)/30)},_civilLeapYear:function(m){return 11>
(14+11*m)%30},getDaysInIslamicMonth:function(m,k){var d=0;d=29+(m+1)%2;11==m&&this._civilLeapYear(k)&&d++;return d},_mod:function(m,k){return m-k*Math.floor(m/k)}});n.getDaysInIslamicMonth=function(m){return(new n).getDaysInIslamicMonth(m.getMonth(),m.getFullYear())};return n})},"dojox/date/islamic/locale":function(){define("dojox/main dojo/_base/lang dojo/_base/array dojo/date dojo/i18n dojo/regexp dojo/string ./Date dojo/i18n!dojo/cldr/nls/islamic".split(" "),function(G,u,r,n,m,k,d,a,b){function e(l,
q,t,v,w){return w.replace(/([a-z])\1*/ig,function(x){var H=x.charAt(0);x=x.length;var A=["abbr","wide","narrow"];switch(H){case "G":var z=q.eraAbbr[0];break;case "y":z=String(l.getFullYear());break;case "M":z=l.getMonth();if(3>x){z+=1;var E=!0}else H=["months-format",A[x-3]].join("-"),z=q[H][z];break;case "d":z=l.getDate(!0);E=!0;break;case "E":z=l.getDay();3>x?(z+=1,E=!0):(H=["days-format",A[x-3]].join("-"),z=q[H][z]);break;case "a":z=12>l.getHours()?"am":"pm";z=q["dayPeriods-format-wide-"+z];break;
case "h":case "H":case "K":case "k":E=l.getHours();switch(H){case "h":z=E%12||12;break;case "H":z=E;break;case "K":z=E%12;break;case "k":z=E||24}E=!0;break;case "m":z=l.getMinutes();E=!0;break;case "s":z=l.getSeconds();E=!0;break;case "S":z=Math.round(l.getMilliseconds()*Math.pow(10,x-3));E=!0;break;case "z":if(z=n.getTimezoneName(l.toGregorian()))break;x=4;case "Z":z=l.toGregorian().getTimezoneOffset();z=[0>=z?"+":"-",d.pad(Math.floor(Math.abs(z)/60),2),d.pad(Math.abs(z)%60,2)];4==x&&(z.splice(0,
0,"GMT"),z.splice(3,0,":"));z=z.join("");break;default:throw Error("dojox.date.islamic.locale.formatPattern: invalid pattern char: "+w);}E&&(z=d.pad(z,x));return z})}function g(l,q,t,v){var w=function(A){return A};q=q||w;t=t||w;v=v||w;var x=l.match(/(''|[^'])+/g),H="'"==l.charAt(0);r.forEach(x,function(A,z){A?(x[z]=(H?t:q)(A),H=!H):x[z]=""});return v(x.join(""))}function h(l,q,t,v){v=k.escapeString(v);m.normalizeLocale(t.locale);return v.replace(/([a-z])\1*/ig,function(w){var x=w.charAt(0);var H=
w.length,A="";t.strict?1<H&&(A="0{"+(H-1)+"}"):A="0?";switch(x){case "y":x="\\d+";break;case "M":x=2<H?"\\S+ ?\\S+":A+"[1-9]|1[0-2]";break;case "d":x="[12]\\d|"+A+"[1-9]|3[01]";break;case "E":x="\\S+";break;case "h":x=A+"[1-9]|1[0-2]";break;case "k":x=A+"\\d|1[01]";break;case "H":x=A+"\\d|1\\d|2[0-3]";break;case "K":x=A+"[1-9]|1\\d|2[0-4]";break;case "m":case "s":x=A+"\\d|[0-5]\\d";break;case "S":x="\\d{"+H+"}";break;case "a":H=t.am||q["dayPeriods-format-wide-am"];A=t.pm||q["dayPeriods-format-wide-pm"];
t.strict?x=H+"|"+A:(x=H+"|"+A,H!=H.toLowerCase()&&(x+="|"+H.toLowerCase()),A!=A.toLowerCase()&&(x+="|"+A.toLowerCase()));break;default:x=".*"}l&&l.push(w);return"("+x+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var c=u.getObject("date.islamic.locale",!0,G);c.format=function(l,q){q=q||{};var t=m.normalizeLocale(q.locale),v=q.formatLength||"short",w=c._getIslamicBundle(t),x=[];t=u.hitch(this,e,l,w,t,q.fullYear);if("year"==q.selector)return l.getFullYear();"time"!=q.selector&&(l=q.datePattern||w["dateFormat-"+
v])&&x.push(g(l,t));"date"!=q.selector&&(q=q.timePattern||w["timeFormat-"+v])&&x.push(g(q,t));return x.join(" ")};c.regexp=function(l){return c._parseInfo(l).regexp};c._parseInfo=function(l){l=l||{};var q=m.normalizeLocale(l.locale);q=c._getIslamicBundle(q);var t=l.formatLength||"short",v=l.datePattern||q["dateFormat-"+t];t=l.timePattern||q["timeFormat-"+t];var w=[];return{regexp:g("date"==l.selector?v:"time"==l.selector?t:"undefined"==typeof t?v:v+" "+t,u.hitch(this,h,w,q,l)),tokens:w,bundle:q}};
c.parse=function(l,q){l=l.replace(/[\u200E\u200F\u202A\u202E]/g,"");q||(q={});var t=c._parseInfo(q),v=t.tokens,w=t.bundle;t=t.regexp.replace(/[\u200E\u200F\u202A\u202E]/g,"");l=(new RegExp("^"+t+"$")).exec(l);m.normalizeLocale(q.locale);if(!l)return null;var x=[1389,0,1,0,0,0,0],H="",A=["abbr","wide","narrow"];r.every(l,function(z,E){if(!E)return!0;E=v[E-1];var J=E.length;switch(E.charAt(0)){case "y":x[0]=Number(z);break;case "M":if(2<J){if(E=w["months-format-"+A[J-3]].concat(),q.strict||(z=z.replace(".",
"").toLowerCase(),E=r.map(E,function(L){return L?L.replace(".","").toLowerCase():L})),z=r.indexOf(E,z),-1==z)return!1}else z--;x[1]=Number(z);break;case "D":x[1]=0;case "d":x[2]=Number(z);break;case "a":E=q.am||w["dayPeriods-format-wide-am"];J=q.pm||w["dayPeriods-format-wide-pm"];if(!q.strict){var D=/\./g;z=z.replace(D,"").toLowerCase();E=E.replace(D,"").toLowerCase();J=J.replace(D,"").toLowerCase()}if(q.strict&&z!=E&&z!=J)return!1;H=z==J?"p":z==E?"a":"";break;case "K":24==z&&(z=0);case "h":case "H":case "k":x[3]=
Number(z);break;case "m":x[4]=Number(z);break;case "s":x[5]=Number(z);break;case "S":x[6]=Number(z)}return!0});l=+x[3];"p"===H&&12>l?x[3]=l+12:"a"===H&&12==l&&(x[3]=0);return new a(x[0],x[1],x[2],x[3],x[4],x[5],x[6])};var f=[];c.addCustomFormats=function(l,q){f.push({pkg:l,name:q})};c._getIslamicBundle=function(l){var q={};r.forEach(f,function(t){t=m.getLocalization(t.pkg,t.name,l);q=u.mixin(q,t)},this);return q};c.addCustomFormats("dojo.cldr","islamic");c.getNames=function(l,q,t,v,w){v=c._getIslamicBundle(v);
l=[l,t,q];if("standAlone"==t){t=l.join("-");var x=v[t];1==x[0]&&(x=void 0)}l[1]="format";return(x||v[l.join("-")]).concat()};c.weekDays=c.getNames("days","wide","format");c.months=c.getNames("months","wide","format");return c})},"esri/dijit/editing/Editor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/DeferredList dojo/dom-class dojo/dom-construct dojo/string dijit/_Widget dijit/_Templated ../../domUtils ../../graphicsUtils ../../geometry/Polyline ../../geometry/Polygon ../../graphic ../../undoManager ../../tasks/query ../../layers/FeatureLayer ../../layers/FeatureTemplate ../../toolbars/draw ../../toolbars/edit ../AttributeInspector ./Util ./Add ./Update ./Delete ./Cut ./Union ./toolbars/Drawing ./SelectionHelper ./TemplatePicker ../../kernel ../../config dojo/i18n!../../nls/jsapi dojo/text!./templates/Editor.html dijit/ProgressBar dojo/NodeList-dom".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z,E,J,D,L,C,N,S,F,T,y,B,I,P,X,Y){var aa=G([h,c],{declaredClass:"esri.dijit.editing.Editor",widgetsInTemplate:!0,templateString:Y,onLoad:function(){},constructor:function(Z,fa){Z=Z||{};Z.settings||console.error("Editor: please provide 'settings' parameter in the constructor");Z.settings.layerInfos||console.error("Editor: please provide 'layerInfos' parameter in the constructor");this._settings=Z.settings;this._eConnects=[]},startup:function(){this.inherited(arguments);
this._setDefaultOptions();this._settings.map.setInfoWindowOnClick(!1);var Z=this._settings.layerInfos;this.featureReductionEnabledLayers=[];r.forEach(Z,function(K){K=K.featureLayer;K.isFeatureReductionEnabled()&&(K.disableFeatureReduction(),this.featureReductionEnabledLayers.push(K))},this);if(r.every(Z,function(K){return K.featureLayer.loaded}))this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=!0;else{var fa=Z.length;r.forEach(Z,function(K){K=K.featureLayer;
if(K.loaded)fa--;else var R=n.connect(K,"onLoad",this,function(U){n.disconnect(R);R=null;fa--;fa||(this._initLayers(),this._connectEvents(),this._createWidgets(),this.onLoad(),this.loaded=!0)})},this)}this._reset();this._enableMapClickHandler()},stopEditing:function(Z){this._updateCurrentFeature(u.hitch(this,function(){this._clearSelection(!1);Z&&Z()}))},destroy:function(){this._settings.map.setInfoWindowOnClick(!0);this.drawingToolbar&&this.drawingToolbar.destroy();this.attributeInspector&&this.attributeInspector.destroy();
this.templatePicker&&this.templatePicker.destroy();this._selectionHelper&&this._selectionHelper.destroy();this._drawToolbar&&this._drawToolbar.deactivate();this._reset();this._disableMapClickHandler();r.forEach(this._eConnects,n.disconnect);n.disconnect(this._dtConnect);n.disconnect(this._templatePickerOnSelectionChangeEvent);this._layer=this._currentGraphic=this._activeType=this._activeTemplate=this._drawingTool=this._drawToolbar=this.editToolbar=this.drawingToolbar=this.attributeInspector=this.templatePicker=
this.undoManager=null;this._settings.map.infoWindow&&this._settings.map.infoWindow.clearFeatures&&this._settings.map.infoWindow.clearFeatures();r.forEach(this.featureReductionEnabledLayers,function(Z){Z.enableFeatureReduction()});this.inherited(arguments)},_setDefaultOptions:function(){this._drawToolbar=this._settings.drawToolbar||new z(this._settings.map);this._settings.drawToolbar=this._drawToolbar;this.editToolbar=this._settings.editToolbar||new E(this._settings.map,{textSymbolEditorHolder:this.domNode});
this._settings.editToolbar=this.editToolbar;this._settings.toolbarVisible=this._settings.toolbarVisible||!1;this._settings.toolbarOptions=u.mixin({reshapeVisible:!1,cutVisible:!1,mergeVisible:!1},this._settings.toolbarOptions);this._settings.createOptions=u.mixin({polylineDrawTools:[aa.CREATE_TOOL_POLYLINE],polygonDrawTools:[aa.CREATE_TOOL_POLYGON],editAttributesImmediately:!0},this._settings.createOptions);this._settings.singleSelectionTolerance=this._settings.singleSelectionTolerance||3;this._settings.maxUndoRedoOperations=
this._settings.maxUndoRedoOperations||10;this._settings.editor=this;this._usePopup=this._settings.usePopup=this._settings.map.infoWindow._setPagerCallbacks?!0:!1;this._datePackage=this._settings.datePackage;var Z=P.defaults;this._settings.geometryService=this._settings.geometryService||Z.geometryService;Z.geometryService=Z.geometryService||this._settings.geometryService},_initLayers:function(){this._settings.layers=[];this._settings.userIds={};this._settings.createOnlyLayer={};r.forEach(this._settings.layerInfos,
function(Z){if(Z.featureLayer&&Z.featureLayer.loaded){this._settings.layers.push(Z.featureLayer);var fa=Z.featureLayer.id;Z.featureLayer.credential&&(this._settings.userIds[fa]=Z.featureLayer.credential.userId);Z.userId&&(this._settings.userIds[fa]=Z.userId);var K=Z.featureLayer.getEditCapabilities();this._settings.createOnlyLayer[fa]=K.canCreate&&!K.canUpdate?!0:!1;this._isTextSymbolPointLayer(Z.featureLayer)&&(Z.disableAttributeUpdate=!0)}},this)},_reset:function(){this._hideAttributeInspector();
this.editToolbar.deactivate();this._editVertices=!0;this._drawingTool=this._activeTemplate=this._activeType=this._currentGraphic=this._layer=null;this._attributeChanged=!1},_saveFeatureOnClient:function(Z){var fa=this.templatePicker.getSelected();var K=fa.template?fa.featureLayer.renderer.getSymbol(fa.template.prototype):fa.symbolInfo.symbol;this._tempGraphic=new v(Z,K,null,null);this._tempGraphic.setAttributes(u.mixin({},fa.template.prototype.attributes));K=this._settings.map;K.graphics.add(this._tempGraphic);
Z=this._findCenterPoint(Z);this._createAttributeInspector();K.infoWindow.setTitle(fa.featureLayer?fa.featureLayer.name:X.widgets.attributeInspector.NLS_title);this.attributeInspector.showFeature(this._tempGraphic,fa.featureLayer);this._showInfoWindow(Z,K.getInfoWindowAnchor(Z));if(this._settings.createOnlyLayer[fa.featureLayer.id]||this._settings.invalidTemplate)this._infoWindowHideEvent=n.connect(K.infoWindow,"onHide",this,"_infoWindowHide");n.disconnect(this._templatePickerOnSelectionChangeEvent);
this.templatePicker.clearSelection();this._drawToolbar.deactivate();this._enableMapClickHandler();this.drawingToolbar&&this.drawingToolbar.deactivate();this._templatePickerOnSelectionChangeEvent=n.connect(this.templatePicker,"onSelectionChange",u.hitch(this,"_onCreateFeature"))},_saveAttributesOnClient:function(Z,fa,K){this._tempGraphic.attributes[fa]="number"===typeof K&&isNaN(K)?null:K},_infoWindowHide:function(){this._createFeature(this._tempGraphic.geometry,this._tempGraphic.attributes);n.disconnect(this._infoWindowHideEvent)},
_createFeature:function(Z,fa){this._editClickPoint=this._findCenterPoint(Z);Z.rings?this._simplify(Z,u.hitch(this,function(K){this._drawingTool!==A.TOOL_AUTO_COMPLETE_POLYGON?this._applyEdits([{layer:this._layer,adds:[this._createGraphic(K,fa)]}],u.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})):this._autoComplete(K,u.hitch(this,function(R){R&&R.length&&this._applyEdits([{layer:this._layer,adds:r.map(R,u.hitch(this,
function(U){return this._createGraphic(U,fa)}))}],function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer)})}))})):this._applyEdits([{layer:this._layer,adds:[this._createGraphic(Z,fa)]}],u.hitch(this,function(){this._chainAttachment(this._oEdits[0].adds[0].attributes[this._oEdits[0].layer.objectIdField],this._oEdits[0].layer);this._layer&&this._layer.renderer&&"heatmap"===this._layer.renderer.type&&this._layer.refresh()}))},_chainAttachment:function(Z,
fa){this.attributeInspector&&this.attributeInspector._attachmentEditor&&this.attributeInspector._attachmentEditor._tempUpload&&this.attributeInspector._attachmentEditor._chainAttachment(Z,fa)},_updateCurrentFeature:function(Z){var fa=this._isModified();fa?this._updateFeature(fa,Z):Z&&Z(!1)},_updateFeature:function(Z,fa,K){var R=Z.geometry,U=Z.getLayer();U.hasZ&&!U.enableZDefaults||U.hasM&&!U.allowUpdateWithoutMValues||K&&!this._isModified()?(K=new v,K.setAttributes(Z.attributes),this._applyEdits([{layer:Z.getLayer(),
updates:[K]}],fa)):R.rings?this._simplify(R,u.hitch(this,function(ba){this._applyEdits([{layer:Z.getLayer(),updates:[u.mixin(Z,{geometry:ba})]}],fa)})):this._applyEdits([{layer:Z.getLayer(),updates:[Z]}],fa)},_deleteFeature:function(Z,fa){if(this._settings.invalidTemplate&&Z===this._tempGraphic)this._settings.map.graphics.remove(this._tempGraphic),this._hideAttributeInspector();else{var K=[];Z?K.push({layer:Z.getLayer(),deletes:[Z]}):(K=r.map(r.filter(this._settings.layers,function(R){return 0<R.getSelectedFeatures().length}),
function(R){return{layer:R,deletes:R.getSelectedFeatures()}}))&&K.length||!this._currentGraphic||K.push({layer:this._layer,deletes:[this._currentGraphic]});this._applyEdits(K,fa)}},_stopEditing:function(Z,fa,K,R){f.hide(this.progressBar.domNode);this._settings.createOnlyLayer[Z.id]||this._undoRedoAdd();if(!0===Z._isSelOnly||1===Z.mode||6===Z.mode){if(fa&&fa.length){this.templatePicker.clearSelection();var U=new x;U.objectIds=[fa[0].objectId];this._settings.createOnlyLayer[Z.id]||this._settings.invalidTemplate?
this._settings.map.graphics.remove(this._tempGraphic):this._selectFeatures([Z],U,u.hitch(this,"_onEditFeature"))}}else(U=this._selectionHelper.findMapService(this._settings.map,Z))&&U.refresh(),fa&&fa.length&&(this.templatePicker.clearSelection(),this._settings.createOnlyLayer[Z.id]||this._settings.invalidTemplate?this._settings.map.graphics.remove(this._tempGraphic):D.findFeatures(fa,Z,u.hitch(this,"_onEditFeature")));R&&R.length&&(this._clearSelection(!0),this._undoRedo&&(U=this._selectionHelper.findMapService(Z,
this._settings.map))&&U.refresh());this._undoRedo&&K&&K.length&&((U=this._selectionHelper.findMapService(Z,this._settings.map))&&U.refresh(),this.attributeInspector.refresh(),this._undoRedo=!1);this.drawingToolbar&&this.drawingToolbar._updateUI();this._undoRedo=!1;this._settings.invalidTemplate=!1},_undoRedoAdd:function(){this._settings._isApplyEditsCall=!1;if(this._settings.undoManager){var Z=this._edits&&this._edits.length?this._edits[0]:null;if(Z){var fa=Z.adds||[],K=Z.updates||[],R=Z.deletes||
[],U=Z.preUpdates||[];Z={featureLayer:Z.layer};"CUT"===this._activeTool?fa.length&&K.length&&U.length&&this.undoManager.add(new S(u.mixin(Z,{preUpdatedGraphics:U,addedGraphics:fa,postUpdatedGraphics:K}))):"UNION"===this._activeTool?R.length&&K.length&&U.length&&this.undoManager.add(new F(u.mixin(Z,{preUpdatedGraphics:U,deletedGraphics:R,postUpdatedGraphics:K}))):fa.length?this.undoManager.add(new L(u.mixin(Z,{addedGraphics:fa}))):R.length?this.undoManager.add(new N(u.mixin(Z,{deletedGraphics:R}))):
K.length&&(this._rollbackGraphic||U.length)&&this.undoManager.add(new C(u.mixin(Z,{preUpdatedGraphics:U.length?U:[this._rollbackGraphic],postUpdatedGraphics:K})));this._rollbackGraphic=this._edits=null}}},_activateDrawToolbar:function(Z){this._layer=Z.featureLayer;this._activeType=Z.type;this._drawingTool=(this._activeTemplate=Z.template)?this._activeTemplate.drawingTool:null;this._drawTool=this._toDrawTool(this._drawingTool,Z.featureLayer);n.disconnect(this._dtConnect);var fa=this._layer.fields;
this._settings.invalidTemplate=!1;if(this._activeTemplate&&this._activeTemplate.prototype){var K=u.mixin({},this._activeTemplate.prototype.attributes);fa=fa.filter(function(R){return!1===R.nullable&&!0===R.editable});this._settings.invalidTemplate=fa.some(function(R){R=K[R.name];return null===R||void 0===R})}this._dtConnect=this._settings.createOnlyLayer[Z.featureLayer.id]||this._settings.invalidTemplate?n.connect(this._drawToolbar,"onDrawEnd",this,"_saveFeatureOnClient"):n.connect(this._drawToolbar,
"onDrawEnd",this,"_createFeature");this.editToolbar.deactivate();this._disableMapClickHandler();this.drawingToolbar?this.drawingToolbar.activateEditing(this._drawTool,this._layer):this._drawToolbar.activate(this._drawTool)},_activateEditToolbar:function(Z,fa){var K=Z.getLayer(),R=K?K.geometryType:null,U=this._isTextSymbolPoint(Z),ba=E.MOVE;"esriGeometryPoint"!==R&&!0===this._isNotesFeature(Z)?(ba=ba|E.ROTATE|E.SCALE,this._editVertices=!1):"esriGeometryPoint"!==R&&!0===this._editVertices?(ba=ba|E.ROTATE|
E.SCALE,this._editVertices=!1):U?(ba=ba|E.ROTATE|E.SCALE|E.EDIT_TEXT,this._editVertices=!1):(ba|=E.EDIT_VERTICES,this._editVertices=!0);this._attributeChanged=this._isModified();this._rollbackGraphic=new v(Z.toJson());R=K.getEditCapabilities({feature:Z,userId:this._settings.userIds[K.id]});var Q=r.filter(this._settings.layerInfos,function(ea){return ea.featureLayer.layerId===K.layerId})[0];R.canUpdate&&!Q.disableGeometryUpdate&&R.canUpdateGeometry&&(this.editToolbar.activate(ba,Z),U&&(this.editToolbar._textEditor._addTextBox(Z),
this.editToolbar._textSymbolEditor&&this.editToolbar._textSymbolEditor.hide()));this._settings.map.infoWindow.isShowing||this._updateAttributeDisabled(Z)||(Z=fa&&fa.screenPoint||this._findCenterPoint(Z),this._showInfoWindow(Z,this._settings.map.getInfoWindowAnchor(Z)))},_createGraphic:function(Z,fa){var K=new v(Z,this._activeType&&this._activeType.symbol||this._layer.defaultSymbol,fa);this._activeTemplate||fa?K.attributes=fa||u.mixin({},this._activeTemplate.prototype.attributes):(K.attributes=K.attributes||
[],r.forEach(this._layer.fields,function(R){K.attributes[R.name]=null},this));return K},_connectEvents:function(){var Z=this._settings.layers;r.forEach(Z,function(fa){this._connect(fa,"onEditsComplete",u.hitch(this,"_stopEditing",fa))},this);r.forEach(Z,function(fa){this._connect(fa,"onBeforeApplyEdits",u.hitch(this,function(){f.show(this.progressBar.domNode);this._settings._isApplyEditsCall=!0}))},this);this._connect(this.editToolbar,"onGraphicClick",u.hitch(this,"_activateEditToolbar"));this._connect(this.editToolbar,
"onGraphicFirstMove",u.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onVertexFirstMove",u.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onScaleStart",u.hitch(this,"_hideAttributeInspector"));this._connect(this.editToolbar,"onRotateStart",u.hitch(this,"_hideAttributeInspector"))},_connect:function(Z,fa,K){this._eConnects.push(n.connect(Z,fa,K))},_createWidgets:function(){this._selectionHelper=new y(this._settings);this._createTemplatePicker();this._createAttributeInspector();
this._createDrawingToolbar();this._createUndoRedoManager()},_createTemplatePicker:function(){if(this._settings.templatePicker)this.templatePicker=this._settings.templatePicker,f.hide(this.templatePickerDiv);else{var Z=r.filter(this._settings.layers,function(fa){return fa.getEditCapabilities().canCreate});this.templatePicker=new B({"class":"esriTemplatePicker",featureLayers:Z,showTooltip:!0,maxLabelLength:this._settings.typesCharacterLimit,columns:"auto",rows:"auto"},this.templatePickerDiv);this.templatePicker.startup();
this._settings.templatePicker=this.templatePicker}this._templatePickerOnSelectionChangeEvent=n.connect(this.templatePicker,"onSelectionChange",u.hitch(this,"_onCreateFeature"))},_createAttributeInspector:function(){var Z=this._settings.map;this._settings.attributeInspector?(this._customAttributeInspector=!0,this.attributeInspector=this._settings.attributeInspector):(this._customAttributeInspector=!1,this.attributeInspector=new J({layerInfos:this._settings.layerInfos,hideNavButtons:this._usePopup,
datePackage:this._datePackage},e.create("div")),this.attributeInspector.startup(),Z.infoWindow.setContent(this.attributeInspector.domNode),Z.infoWindow.setTitle(X.widgets.attributeInspector.NLS_title),Z.infoWindow.resize(350,375),m.query(".esriAttributeInspector .atiLayerName").style({display:"none"}));this._connect(this.attributeInspector,"onDelete",u.hitch(this,"_deleteFeature"));this._connect(this.attributeInspector,"onNext",u.hitch(this,function(fa){this._updateCurrentFeature(u.hitch(this,function(){this._attributeChanged=
!1;this._onEditFeature(fa)}))}));this._usePopup&&Z.infoWindow._setPagerCallbacks(this.attributeInspector,u.hitch(this.attributeInspector,"previous"),u.hitch(this.attributeInspector,"next"));this._connect(this.attributeInspector,"onAttributeChange",u.hitch(this,function(fa,K,R){if(this._settings.createOnlyLayer[this._layer.id]||this._settings.invalidTemplate)this._saveAttributesOnClient(fa,K,R);else{var U=fa.getLayer();(U=r.filter(U.fields,function(ba){return ba.name===K})[0])&&""===R&&(R=null);this._rollbackGraphic=
new v(u.clone(fa.toJson()));this.attributeInspector._rollbackInfo={field:U,graphic:this._rollbackGraphic};this._currentGraphic.attributes[K]="number"===typeof R&&isNaN(R)?null:R;this._currentGraphic.setAttributes(this._currentGraphic.attributes);this._updateFeature(this._currentGraphic,null,!0);this._attributeChanged=!1}}))},_createDrawingToolbar:function(){!0===this._settings.toolbarVisible&&(this.drawingToolbar=new T({"class":"esriDrawingToolbar",drawToolbar:this._drawToolbar,editToolbar:this.editToolbar,
settings:this._settings,onDelete:u.hitch(this,"_deleteFeature"),onApplyEdits:u.hitch(this,"_applyEdits"),onShowAttributeInspector:u.hitch(this,"_onEditFeature")},this.drawingToolbarDiv))},_createUndoRedoManager:function(){if(this._settings.enableUndoRedo||this._settings.undoManager)this._settings.enableUndoRedo=!0,this.undoManager=this._settings.undoManager,this.undoManager||(this.undoManager=this._settings.undoManager=new w({maxOperations:this._settings.maxUndoRedoOperations})),this._connect(this.undoManager,
"onUndoComplete",u.hitch(this,this._updateUndoRedoOperations)),this._connect(this.undoManager,"onRedoComplete",u.hitch(this,this._updateUndoRedoOperations)),this._connect(document,"onkeypress",u.hitch(this,function(Z){if(Z.metaKey||Z.ctrlKey)"z"===Z.charOrCode&&this._undo(),"y"===Z.charOrCode&&this._redo()}))},_updateUndoRedoOperations:function(Z){if(Z&&Z.addedIds){var fa;for(fa=0;fa<this.undoManager.length;fa++){var K=this.undoManager.get(fa);K&&Z.layer===K._featureLayer&&K.updateObjectIds(Z.oldIds,
Z.addedIds)}}Z&&"Update Features"===Z.operation.label&&this.attributeInspector.refresh()},_enableMapClickHandler:function(){this._mapClickHandler=n.connect(this._settings.map,"onClick",u.hitch(this,function(Z){this._drawToolbar._geometryType||("SELECT"===this._activeTool?this._activeTool="":this._updateCurrentFeature(u.hitch(this,function(){this._reset();this._updateSelection(Z)})))}))},_disableMapClickHandler:function(){n.disconnect(this._mapClickHandler)},_onCreateFeature:function(){var Z=this.templatePicker.getSelected();
Z?this._updateCurrentFeature(u.hitch(this,function(){this._currentGraphic&&this._clearSelection(!1);this._reset();this._activateDrawToolbar(Z)})):(this._reset(),n.disconnect(this._dtConnect),this._drawToolbar.deactivate(),this._enableMapClickHandler(),this.drawingToolbar&&this.drawingToolbar.deactivate())},_isTextSymbolPoint:function(Z){if("point"===Z.geometry.type||"multipoint"===Z.geometry.type){var fa=Z.getLayer(),K=fa.renderer;Z=Z.symbol||fa._getSymbol(Z);!Z&&(K.hasVisualVariables("sizeInfo",
!1)||K.hasVisualVariables("colorInfo",!1)||K.hasVisualVariables("opacityInfo",!1))&&K.addBreak&&K.infos&&1===K.infos.length&&(Z=K.infos[0].symbol||K.defaultSymbol);if(Z&&"textsymbol"===Z.type)return!0}return!1},_isTextSymbolPointLayer:function(Z){return"esriGeometryPoint"===Z.geometryType&&Z.renderer&&Z.renderer._symbols&&Z.renderer._symbols[0]&&Z.renderer._symbols[0].symbol&&"textsymbol"===Z.renderer._symbols[0].symbol.type?!0:!1},_updateAttributeDisabled:function(Z){Z=Z.getLayer();if(!Z)return!1;
var fa,K=!1;for(fa=0;fa<this._settings.layerInfos.length;fa++){var R=this._settings.layerInfos[fa];if(R.featureLayer==Z){K=R.disableAttributeUpdate;break}}return K},_onEditFeature:function(Z,fa){if(Z=(u.isArray(Z)?Z[0]:Z)||null){this._layer=Z.getLayer();if(!this._customAttributeInspector&&!this._updateAttributeDisabled(Z)){fa=fa||this._editClickPoint||this._findCenterPoint(Z);if(1<this._currentFeatureCount){var K=this._popupFeatures.indexOf(Z);K=g.substitute(X.widgets.popup.NLS_pagingInfo,{index:K+
1,total:this._currentFeatureCount})}else K=this._layer?this._layer.name:X.widgets.attributeInspector.NLS_title;this._settings.map.infoWindow.setTitle(K);if(this.drawingToolbar||!this._settings.map.infoWindow.isShowing)this.attributeInspector.refresh(),this._showInfoWindow(fa,this._settings.map.getInfoWindowAnchor(fa));this._editClickPoint=null}Z!==this._currentGraphic&&(this._editVertices=!0,this._currentGraphic=Z,Z.getDojoShape()&&Z.getDojoShape().moveToFront(),fa=this._layer.hasM,this._layer.hasZ&&
!this._layer.enableZDefaults||fa&&!this._layer.allowUpdateWithoutMValues||this._activateEditToolbar(Z))}},_applyEdits:function(Z,fa){Z=Z||[];if(!(0>=Z.length)){this._edits=this._oEdits=Z;var K=[];r.forEach(Z,function(R){R.layer&&K.push(R.layer.applyEdits(R.adds,R.updates,R.deletes))});0<K.length&&(this._deferredsList=(new a(K)).addCallback(u.hitch(this,function(){f.hide(this.progressBar.domNode);fa&&fa();var R=this._settings.map;R&&R.infoWindow.reposition&&R.infoWindow.isShowing&&R.infoWindow.reposition()})))}},
_undo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.undo())},_redo:function(){this._settings.undoManager&&!this._settings._isApplyEditsCall&&(this.editToolbar.deactivate(),this._undoRedo=!0,this._settings.undoManager.redo())},_simplify:function(Z,fa){t.prototype.isSelfIntersecting(Z)?this._settings.geometryService.simplify([Z],function(K){var R=K&&K.length?K[0]:R;fa&&fa(R)}):fa&&fa(Z)},_autoComplete:function(Z,
fa){var K=this._getLayers("esriGeometryPolygon"),R=new x;R.geometry=Z;R.returnGeometry=!0;this._selectFeatures(K,R,u.hitch(this,function(U){!U||0>=U.length?fa&&fa([Z]):this._settings.geometryService.autoComplete(l.getGeometries(U),this._toPolylines([R.geometry]),function(ba){fa&&fa(ba)})}))},_getLayers:function(Z){return r.filter(this._settings.layers,function(fa){return fa.geometryType===Z})},_selectFeatures:function(Z,fa,K,R){this._selectionHelper.selectFeatures(Z,fa,R||H.SELECTION_NEW,K)},_updateSelection:function(Z){var fa=
Z.mapPoint,K=Z.graphic,R=this._settings.layerInfos,U;this._selectionHelper.selectFeaturesByGeometry(this._settings.layers,fa,H.SELECTION_NEW,u.hitch(this,function(ba){var Q=r.some(ba,u.hitch(this,function(la){return la==K}));if(K&&!Q)if(Q=K.getLayer(),this._isValidLayer(Q)){var ea=new x;ea.objectIds=[K.attributes[Q.objectIdField]];this._selectionHelper.selectFeatures([Q],ea,H.SELECTION_ADD,u.hitch(this,function(la){la&&la.length&&(la=la.concat(ba),U=D.sortFeaturesById(R,la),this._updatePopupButtons(U),
this._onEditFeature(U,fa))}))}else ba&&ba.length?(U=D.sortFeaturesById(R,ba),this._updatePopupButtons(U),this._onEditFeature(U,fa)):this._clearSelection();else ba&&ba.length?(U=D.sortFeaturesById(R,ba),this._updatePopupButtons(U),this._onEditFeature(U,fa)):this._clearSelection()}));K&&this._isTextSymbolPoint(K)&&this._isValidLayer(K.getLayer())&&this.editToolbar.activate(0|E.MOVE|E.ROTATE|E.SCALE|E.EDIT_TEXT,K)},_updatePopupButtons:function(Z){if(this._usePopup&&Z){var fa=Z.length;r.forEach([this._settings.map.infoWindow._prevFeatureButton,
this._settings.map.infoWindow._nextFeatureButton],u.hitch(this,function(R){1<fa?b.remove(R,"hidden"):b.add(R,"hidden")}));var K=1<fa?"block":"none";m.query(".esriAttributeInspector .atiLayerName").style({display:K});this._currentFeatureCount=fa;this._popupFeatures=Z}else this._currentFeatureCount=this._popupFeatures=null},_clearSelection:function(Z){this._currentFeatureCount=0;this._popupFeatures=null;this._selectionHelper.clearSelection(Z||!1);this._reset()},_findCenterPoint:function(Z){Z=Z.geometry||
Z;switch(Z.type){case "point":var fa=Z;break;case "polyline":fa=Z.getPoint(0,Math.ceil(Z.paths[0].length/2));break;case "polygon":fa=Z.rings.length-1,fa=Z.getPoint(fa,Z.rings[fa].length-1)}return this._settings.map.toScreen(fa)},_hideAttributeInspector:function(){!this._customAttributeInspector&&this._settings.map.infoWindow&&this._settings.map.infoWindow.hide()},_toPolylines:function(Z){return r.map(Z,function(fa){var K=new q(fa.spatialReference);r.forEach(fa.rings,function(R){K.addPath(R)});return K})},
_isNotesFeature:function(Z){var fa=Z.getLayer(),K=fa?fa.types||null:null;if(!K)return!1;var R=Z.attributes[fa.typeIdField],U;r.some(K,function(ba){return ba.id===R?(U=ba.templates,!0):!1});return U?(Z=U[0]||null)?this._isShapeTool(Z.drawingTool)?!0:!1:!1:!1},_isValidLayer:function(Z){var fa,K=this._settings.layerInfos;for(fa=0;fa<K.length;fa++){var R=K[fa];if(Z.id==(R.featureLayer?R.featureLayer.id:R.layerId))return!0}return!1},_isShapeTool:function(Z){switch(Z){case A.TOOL_ARROW:return z.ARROW;case A.TOOL_LEFT_ARROW:return z.LEFT_ARROW;
case A.TOOL_RIGHT_ARROW:return z.RIGHT_ARROW;case A.TOOL_UP_ARROW:return z.UP_ARROW;case A.TOOL_DOWN_ARROW:return z.DOWN_ARROW;case A.TOOL_CIRCLE:return z.CIRCLE;case A.TOOL_ELLIPSE:return z.ELLIPSE;case A.TOOL_TRIANGLE:return z.TRIANGLE;case A.TOOL_RECTANGLE:return z.RECTANGLE;default:return null}},_toDrawTool:function(Z,fa){fa=fa.geometryType;switch(Z){case A.TOOL_POINT:return z.POINT;case A.TOOL_ARROW:return z.ARROW;case A.TOOL_LEFT_ARROW:return z.LEFT_ARROW;case A.TOOL_RIGHT_ARROW:return z.RIGHT_ARROW;
case A.TOOL_UP_ARROW:return z.UP_ARROW;case A.TOOL_DOWN_ARROW:return z.DOWN_ARROW;case A.TOOL_CIRCLE:return z.CIRCLE;case A.TOOL_ELLIPSE:return z.ELLIPSE;case A.TOOL_TRIANGLE:return z.TRIANGLE;case A.TOOL_RECTANGLE:return z.RECTANGLE;case A.TOOL_LINE:return z.POLYLINE;case A.TOOL_POLYGON:return z.POLYGON;case A.TOOL_FREEHAND:return"esriGeometryPolyline"===fa?z.FREEHAND_POLYLINE:z.FREEHAND_POLYGON;default:return Z=z.POINT,"esriGeometryPolyline"===fa?(Z=z.POLYLINE,this._settings.createOptions.polylineDrawTools[0]===
aa.CREATE_TOOL_FREEHAND_POLYLINE&&(Z=z.FREEHAND_POLYLINE)):"esriGeometryPolygon"===fa&&(Z=z.POLYGON,this._settings.createOptions.polygonDrawTools[0]===aa.CREATE_TOOL_FREEHAND_POLYGON&&(Z=z.FREEHAND_POLYGON)),Z}},_isModified:function(){var Z=this.editToolbar.getCurrentState();return(Z.isModified||this._attributeChanged)&&Z.graphic?Z.graphic:null},_showInfoWindow:function(Z,fa){this._customAttributeInspector||this._settings.map.infoWindow.show(Z,fa)}});u.mixin(aa,{CREATE_TOOL_POLYLINE:"polyline",CREATE_TOOL_FREEHAND_POLYLINE:"freehandpolyline",
CREATE_TOOL_POLYGON:"polygon",CREATE_TOOL_FREEHAND_POLYGON:"freehandpolygon",CREATE_TOOL_AUTOCOMPLETE:"autocomplete",CREATE_TOOL_RECTANGLE:"rectangle",CREATE_TOOL_TRIANGLE:"triangle",CREATE_TOOL_CIRCLE:"circle",CREATE_TOOL_ELLIPSE:"ellipse",CREATE_TOOL_ARROW:"arrow",CREATE_TOOL_UP_ARROW:"uparrow",CREATE_TOOL_DOWN_ARROW:"downarrow",CREATE_TOOL_RIGHT_ARROW:"rightarrow",CREATE_TOOL_LEFT_ARROW:"leftarrow"});k("extend-esri")&&u.setObject("dijit.editing.Editor",aa,I);return aa})},"esri/undoManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/when ./kernel ./Evented dojo/has!extend-esri?./OperationBase".split(" "),
function(G,u,r,n,m,k){G=G([k],{declaredClass:"esri.UndoManager",maxOperations:10,canUndo:!1,canRedo:!1,position:0,length:0,onUndo:function(){},onRedo:function(){},onUndoComplete:function(){},onRedoComplete:function(){},onAdd:function(){},onChange:function(){},constructor:function(d){d=d||{};d.maxOperations&&(this.maxOperations=d.maxOperations);this._historyStack=[]},add:function(d){if(0<this.maxOperations)for(;this._historyStack.length>=this.maxOperations;)this._historyStack.shift();this._historyStack.splice(this.position,
0,d);this.position++;this.clearRedo();this.onAdd();this._checkAvailability()},undo:function(){if(0===this.position)return null;var d=this.peekUndo();this.position--;d?(d=d.performUndo(),this.onUndo(),this._checkAvailability(),n(d).then(u.hitch(this,this.onUndoComplete))):(this.onUndo(),this._checkAvailability())},redo:function(){if(this.position===this._historyStack.length)return null;var d=this.peekRedo();this.position++;d?(d=d.performRedo(),this.onRedo(),this._checkAvailability(),n(d).then(u.hitch(this,
this.onRedoComplete))):(this.onRedo(),this._checkAvailability())},_checkAvailability:function(){this.length=this._historyStack.length;0===this.length?this.canUndo=this.canRedo=!1:0===this.position?(this.canRedo=!0,this.canUndo=!1):this.position===this.length?(this.canUndo=!0,this.canRedo=!1):this.canRedo=this.canUndo=!0;this.onChange()},clearUndo:function(){this._historyStack.splice(0,this.position);this.position=0;this._checkAvailability()},clearRedo:function(){this._historyStack.splice(this.position,
this._historyStack.length-this.position);this.position=this._historyStack.length;this._checkAvailability()},peekUndo:function(){if(0<this._historyStack.length&&0<this.position)return this.get(this.position-1)},peekRedo:function(){if(0<this._historyStack.length&&this.position<this._historyStack.length)return this.get(this.position)},get:function(d){return this._historyStack[d]},remove:function(d){0<this._historyStack.length&&(this._historyStack.splice(d,1),0<this.position&&d<this.position&&this.position--,
this._checkAvailability())},destroy:function(){this._historyStack=null}});r("extend-esri")&&(m.UndoManager=G);return G})},"esri/dijit/editing/Add":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(G,u,r,n,m,k){u=u(k,{declaredClass:"esri.dijit.editing.Add",type:"edit",label:"Add Features",constructor:function(d){d=d||{};d.featureLayer?(this._featureLayer=d.featureLayer,d.addedGraphics?this._addedGraphics=d.addedGraphics:
console.error("In constructor of 'esri.dijit.editing.Add', no graphics provided")):console.error("In constructor of 'esri.dijit.editing.Add', featureLayer is not provided")},updateObjectIds:function(d,a){this.updateIds(this._featureLayer,this._addedGraphics,d,a)},performUndo:function(){return this._featureLayer.applyEdits(null,null,this._addedGraphics).then(r.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var d=G.map(this._addedGraphics,function(a){return a.attributes[this._featureLayer.objectIdField]},
this);return this._featureLayer.applyEdits(this._addedGraphics,null,null).then(r.hitch(this,function(a,b,e){a=G.map(a,function(g){return g.objectId});return{oldIds:d,addedIds:a,layer:this._featureLayer,operation:this}}))}});n("extend-esri")&&r.setObject("dijit.editing.Add",u,m);return u})},"esri/dijit/editing/EditOperationBase":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/has","../../kernel","../../OperationBase"],function(G,u,r,n,m){u=u(m,{declaredClass:"esri.EditOperationBase",
updateIds:function(k,d,a,b){G.forEach(d,function(e,g){var h=e[k.objectIdField];G.forEach(a,function(c,f){h===c&&(e[k.objectIdField]=b[f])})})}});r("extend-esri")&&(n.EditOperationBase=u);return u})},"esri/OperationBase":function(){define(["dojo/_base/declare","dojo/has","./kernel"],function(G,u,r){G=G(null,{declaredClass:"esri.OperationBase",type:"not implemented",label:"not implemented",constructor:function(n){n=n||{};n.label&&(this.label=n.label)},performUndo:function(){console.log("performUndo has not been implemented")},
performRedo:function(){console.log("performRedo has not been implemented")}});u("extend-esri")&&(r.OperationBase=G);return G})},"esri/dijit/editing/Update":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),function(G,u,r,n,m,k,d){G=u(d,{declaredClass:"esri.dijit.editing.Update",type:"edit",label:"Update Features",constructor:function(a){var b;a=a||{};if(a.featureLayer)if(this._featureLayer=a.featureLayer,
a.preUpdatedGraphics){this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];for(b=0;b<a.preUpdatedGraphics.length;b++)this._preUpdatedGraphicsGeometries.push(a.preUpdatedGraphics[b].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(a.preUpdatedGraphics[b].attributes);if(a.postUpdatedGraphics)for(this._postUpdatedGraphics=a.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],b=0;b<a.postUpdatedGraphics.length;b++)a.postUpdatedGraphics[b].geometry?
this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[b].geometry.toJson()):this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[b].geometry),this._postUpdatedGraphicsAttributes.push(r.clone(a.postUpdatedGraphics[b].attributes));else console.error("In constructor of 'esri.dijit.editing.Update', postUpdatedGraphics not provided")}else console.error("In constructor of 'esri.dijit.editing.Update', preUpdatedGraphics not provided");else console.error("In constructor of 'esri.dijit.editing.Update', featureLayer not provided")},
updateObjectIds:function(a,b){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,b);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,b)},performUndo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._preUpdatedGraphicsGeometries[a]?this._postUpdatedGraphics[a].setGeometry(k.fromJson(this._preUpdatedGraphicsGeometries[a])):this._postUpdatedGraphics[a].setGeometry(this._preUpdatedGraphicsGeometries[a]),this._postUpdatedGraphics[a].setAttributes(this._preUpdatedGraphicsAttributes[a]);
return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(r.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphicsGeometries[a]?this._postUpdatedGraphics[a].setGeometry(k.fromJson(this._postUpdatedGraphicsGeometries[a])):this._postUpdatedGraphics[a].setGeometry(this._postUpdatedGraphicsGeometries[a]),this._postUpdatedGraphics[a].setAttributes(this._postUpdatedGraphicsAttributes[a]);
return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,null).then(r.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});n("extend-esri")&&r.setObject("dijit.editing.Update",G,m);return G})},"esri/dijit/editing/Delete":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ./EditOperationBase".split(" "),function(G,u,r,n,m,k){u=u(k,{declaredClass:"esri.dijit.editing.Delete",type:"edit",label:"Delete Features",constructor:function(d){d=
d||{};d.featureLayer?(this._featureLayer=d.featureLayer,d.deletedGraphics?this._deletedGraphics=d.deletedGraphics:console.error("In constructor of 'esri.dijit.editing.Delete', no graphics provided")):console.error("In constructor of 'esri.dijit.editing.Delete', featureLayer is not provided")},updateObjectIds:function(d,a){this.updateIds(this._featureLayer,this._deletedGraphics,d,a)},performUndo:function(){var d=G.map(this._deletedGraphics,function(a){return a.attributes[this._featureLayer.objectIdField]},
this);return this._featureLayer.applyEdits(this._deletedGraphics,null,null).then(r.hitch(this,function(a,b,e){a=G.map(a,function(g){return g.objectId});return{oldIds:d,addedIds:a,layer:this._featureLayer,operation:this}}))},performRedo:function(){return this._featureLayer.applyEdits(null,null,this._deletedGraphics).then(r.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))}});n("extend-esri")&&r.setObject("dijit.editing.Delete",u,m);return u})},"esri/dijit/editing/Cut":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),
function(G,u,r,n,m,k,d){u=u(d,{declaredClass:"esri.dijit.editing.Cut",type:"edit",label:"Cut Features",constructor:function(a){var b;a=a||{};if(a.featureLayer)if(this._featureLayer=a.featureLayer,a.addedGraphics)if(this._addedGraphics=a.addedGraphics,a.preUpdatedGraphics){this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];for(b=0;b<a.preUpdatedGraphics.length;b++)this._preUpdatedGraphicsGeometries.push(a.preUpdatedGraphics[b].geometry.toJson()),this._preUpdatedGraphicsAttributes.push(a.preUpdatedGraphics[b].attributes);
if(a.postUpdatedGraphics)for(this._postUpdatedGraphics=a.postUpdatedGraphics,this._postUpdatedGraphicsGeometries=[],this._postUpdatedGraphicsAttributes=[],b=0;b<a.postUpdatedGraphics.length;b++)this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[b].geometry.toJson()),this._postUpdatedGraphicsAttributes.push(r.clone(a.postUpdatedGraphics[b].attributes));else console.error("In constructor of 'esri.dijit.editing.Cut', postUpdatedGraphics not provided")}else console.error("In constructor of 'esri.dijit.editing.Cut', preUpdatedGraphics not provided");
else console.error("In constructor of 'esri.dijit.editing.Cut', addedGraphics for cut not provided");else console.error("In constructor of 'esri.dijit.editing.Cut', featureLayer not provided")},updateObjectIds:function(a,b){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,b);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,b);this.updateIds(this._featureLayer,this._addedGraphics,a,b)},performUndo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(k.fromJson(this._preUpdatedGraphicsGeometries[a])),
this._postUpdatedGraphics[a].setAttributes(this._preUpdatedGraphicsAttributes[a]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,this._addedGraphics).then(r.hitch(this,function(){return{layer:this._featureLayer,operation:this}}))},performRedo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(k.fromJson(this._postUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._postUpdatedGraphicsAttributes[a]);
var b=G.map(this._addedGraphics,function(e){return e.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._addedGraphics,this._postUpdatedGraphics,null).then(r.hitch(this,function(e,g,h){e=G.map(e,function(c){return c.objectId});return{oldIds:b,addedIds:e,layer:this._featureLayer,operation:this}}))}});n("extend-esri")&&r.setObject("dijit.editing.Cut",u,m);return u})},"esri/dijit/editing/Union":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/jsonUtils ./EditOperationBase".split(" "),
function(G,u,r,n,m,k,d){u=u(d,{declaredClass:"esri.dijit.editing.Union",type:"edit",label:"Union Features",constructor:function(a){a=a||{};this._featureLayer=a.featureLayer;this._deletedGraphics=a.deletedGraphics;this._preUpdatedGraphics=a.preUpdatedGraphics;this._postUpdatedGraphics=a.postUpdatedGraphics;this._preUpdatedGraphicsGeometries=[];this._preUpdatedGraphicsAttributes=[];this._postUpdatedGraphicsGeometries=[];this._postUpdatedGraphicsAttributes=[];var b;for(b=0;b<a.preUpdatedGraphics.length;b++)this._preUpdatedGraphicsGeometries.push(a.preUpdatedGraphics[b].geometry.toJson()),
this._preUpdatedGraphicsAttributes.push(a.preUpdatedGraphics[b].attributes);for(b=0;b<a.postUpdatedGraphics.length;b++)this._postUpdatedGraphicsGeometries.push(a.postUpdatedGraphics[b].geometry.toJson()),this._postUpdatedGraphicsAttributes.push(r.clone(a.postUpdatedGraphics[b].attributes))},updateObjectIds:function(a,b){this.updateIds(this._featureLayer,this._preUpdatedGraphicsAttributes,a,b);this.updateIds(this._featureLayer,this._postUpdatedGraphicsAttributes,a,b);this.updateIds(this._featureLayer,
this._deletedGraphics,a,b)},performUndo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(k.fromJson(this._preUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._preUpdatedGraphicsAttributes[a]);var b=G.map(this._deletedGraphics,function(e){return e.attributes[this._featureLayer.objectIdField]},this);return this._featureLayer.applyEdits(this._deletedGraphics,this._postUpdatedGraphics,null).then(r.hitch(this,function(e,
g,h){e=G.map(e,function(c){return c.objectId});return{oldIds:b,addedIds:e,layer:this._featureLayer,operation:this}}))},performRedo:function(){var a;for(a=0;a<this._postUpdatedGraphics.length;a++)this._postUpdatedGraphics[a].setGeometry(k.fromJson(this._postUpdatedGraphicsGeometries[a])),this._postUpdatedGraphics[a].setAttributes(this._postUpdatedGraphicsAttributes[a]);return this._featureLayer.applyEdits(null,this._postUpdatedGraphics,this._deletedGraphics).then(r.hitch(this,function(){return{layer:this._featureLayer,
operation:this}}))}});n("extend-esri")&&r.setObject("dijit.editing.Union",u,m);return u})},"esri/dijit/editing/toolbars/Drawing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/_CssStateMixin ../Util ./ToolbarBase ../tools/ButtonToolBase ../tools/Cut ../tools/Union ../tools/Reshape ../tools/Editing ../tools/EditingTools ../tools/Selection ../tools/SelectionTools ../../../kernel".split(" "),function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t){G=G([a,
k],{declaredClass:"esri.dijit.editing.toolbars.Drawing",onShowAttributeInspector:function(){},_activateTool:function(v,w){this._settings.editor._activeTool=v;"EDITING"!==v&&this._settings.templatePicker.clearSelection();"ATTRIBUTES"!==v&&this._settings.editor._hideAttributeInspector();"CLEAR"!==v&&this.inherited(arguments)},_initializeToolbar:function(){r.forEach(this._settings.layers,function(v){this._tbConnects.push(n.connect(v,"onSelectionComplete",this,"_updateUI"))},this)},activateEditing:function(v,
w){this._tools.EDITING._activateTool(v,w.geometryType);this._activeTool=this._tools.EDITING;this._activeTool.setChecked(!0)},_updateUI:function(){this._settings.undoManager&&(this._tools.UNDO.set("disabled",!1===this._settings.undoManager.canUndo),this._tools.REDO.set("disabled",!1===this._settings.undoManager.canRedo));this._selectedFeatures=d.getSelection(this._settings.layers);var v=this._selectedFeatures.length;this._tools.DELETE&&this._tools.DELETE.set("disabled",0>=v);this._tools.CLEAR&&this._tools.CLEAR.set("disabled",
0>=v);this._tools.ATTRIBUTES&&this._tools.ATTRIBUTES.set("disabled",0>=v);this._tools.UNION&&this._tools.UNION.set("disabled",2>v)},_toolFinished:function(v){if("ATTRIBUTES"===v&&this._selectedFeatures&&this._selectedFeatures.length)this.onShowAttributeInspector(this._selectedFeatures[0]);if("SELECT"===v||"CUT"===v||"RESHAPING"===v||"EDITING"===v)this._activeTool.deactivate(),this._activeTool.setChecked(!1),this._activeTool=null;if("DELETE"===v)this.onDelete();this._settings.editor._activeTool=null;
this._updateUI()},_createTools:function(){this._tools.SELECT=new l({settings:this._settings,onClick:u.hitch(this,"_activateTool","SELECT",!0),onFinished:u.hitch(this,"_toolFinished","SELECT")});this.addChild(this._tools.SELECT);this._tools.CLEAR=new b(u.mixin(q.selectClear,{settings:this._settings,onClick:u.hitch(this._settings.editor,"_clearSelection",!1)}));this.addChild(this._tools.CLEAR);this._createSeparator();this._tools.ATTRIBUTES=new b(u.mixin(f.attributes,{settings:this._settings,onClick:u.hitch(this,
"_toolFinished","ATTRIBUTES")}));this.addChild(this._tools.ATTRIBUTES);this._createSeparator();this._tools.EDITING=new c({settings:this._settings,onClick:u.hitch(this,"_activateTool","EDITING",!0),onApplyEdits:u.hitch(this,"onApplyEdits"),onFinished:u.hitch(this,"_toolFinished","EDITING")});this.addChild(this._tools.EDITING);this._tools.DELETE=new b(u.mixin(f.del,{settings:this._settings,onClick:u.hitch(this,"_toolFinished","DELETE")}));this.addChild(this._tools.DELETE);this._settings.toolbarOptions&&
((this._settings.toolbarOptions.cutVisible||this._settings.toolbarOptions.mergeVisible||this._settings.toolbarOptions.reshapeVisible)&&this._createSeparator(),this._settings.toolbarOptions.cutVisible&&(this._tools.CUT=new e({settings:this._settings,onFinished:u.hitch(this,"_toolFinished","CUT"),onClick:u.hitch(this,"_activateTool","CUT",!0),onApplyEdits:u.hitch(this,"onApplyEdits")}),this.addChild(this._tools.CUT)),this._settings.toolbarOptions.mergeVisible&&(this._tools.UNION=new g({settings:this._settings,
onFinished:u.hitch(this,"_toolFinished","UNION"),onApplyEdits:u.hitch(this,"onApplyEdits")}),this.addChild(this._tools.UNION)),this._settings.toolbarOptions.reshapeVisible&&(this._tools.RESHAPING=new h({settings:this._settings,onClick:u.hitch(this,"_activateTool","RESHAPING",!0),onFinished:u.hitch(this,"_toolFinished","RESHAPING"),onApplyEdits:u.hitch(this,"onApplyEdits")}),this.addChild(this._tools.RESHAPING)));this._settings.enableUndoRedo&&(this._createSeparator(),this._tools.UNDO=new b(u.mixin(f.undo,
{settings:this._settings,disabled:!0,onClick:u.hitch(this,function(){this._tools.UNDO.set("disabled",!0);this._tools.REDO.set("disabled",!0);this._settings.editor._undo()})})),this.addChild(this._tools.UNDO),this._tools.REDO=new b(u.mixin(f.redo,{settings:this._settings,disabled:!0,onClick:u.hitch(this,function(){this._tools.UNDO.set("disabled",!0);this._tools.REDO.set("disabled",!0);this._settings.editor._redo()})})),this.addChild(this._tools.REDO))}});m("extend-esri")&&u.setObject("dijit.editing.toolbars.Drawing",
G,t);return G})},"esri/dijit/editing/toolbars/ToolbarBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dijit/Toolbar dijit/ToolbarSeparator ../../../kernel ../../../lang".split(" "),function(G,u,r,n,m,k,d,a,b){G=G([k],{declaredClass:"esri.dijit.editing.toolbars.ToolbarBase",_enabled:!0,graphicsAdded:function(){},drawEnd:function(){},onApplyEdits:function(){},onDelete:function(){},constructor:function(e,g){e&&e.settings&&(this._tools=[],this._tbConnects=
[],this._initialize(e.settings))},postCreate:function(){this._createTools();this.deactivate()},destroy:function(){var e,g=this._tools;for(e in g)g.hasOwnProperty(e)&&b.isDefined(this._tools[e])&&this._tools[e].destroy();r.forEach(this._tbConnects,n.disconnect);this.inherited(arguments)},activate:function(e){this._enabled=!0},deactivate:function(){var e;this._enabled=!1;this._geometryType=this._layer=null;var g=this._tools;for(e in g)g.hasOwnProperty(e)&&(this._tools[e].deactivate(),this._tools[e].setChecked(!1))},
isEnabled:function(){return this._enabled},setActiveSymbol:function(e){this._activeSymbol=e},_getSymbol:function(){},_createTools:function(){},_initialize:function(e){this._settings=e;this._toolbar=e.drawToolbar;this._editToolbar=e.editToolbar;this._initializeToolbar()},_activateTool:function(e,g){this._activeTool&&this._activeTool.deactivate();!0===g&&this._activeTool==this._tools[e]?(this._activeTool.setChecked(!1),this._activeTool=null):(this._activeTool=this._tools[e],this._activeTool.setChecked(!0),
this._activeTool.activate(null))},_createSeparator:function(){this.addChild(new d)}});m("extend-esri")&&u.setObject("dijit.editing.toolbars.ToolbarBase",G,a);return G})},"esri/dijit/editing/tools/ButtonToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/Button ./ToolBase ../../../kernel".split(" "),function(G,u,r,n,m,k){G=G([n,m],{declaredClass:"esri.dijit.editing.tools.ButtonToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},
destroy:function(){n.prototype.destroy.apply(this,arguments);m.prototype.destroy.apply(this,arguments)}});r("extend-esri")&&u.setObject("dijit.editing.tools.ButtonToolBase",G,k);return G})},"esri/dijit/editing/tools/ToolBase":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../../../kernel","dojo/i18n!../../../nls/jsapi"],function(G,u,r,n,m){G=G(null,{declaredClass:"esri.dijit.editing.tools.ToolBase",_enabled:!0,showLabel:!1,constructor:function(k,d){k=k||{};u.mixin(this,k);this.label=
this._label?m.widgets.editor.tools[this._label]:"";this._settings=k.settings;this._toolbar=k.settings.drawToolbar;this._editToolbar=k.settings.editToolbar;this._initializeTool()},onFinished:function(){},onDrawEnd:function(){},onApplyEdits:function(){},postCreate:function(){this.deactivate();this.inherited(arguments)},destroy:function(){},activate:function(k){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this._enabled&&(this._checked=!0,this._layer=k,this._toolbar&&
this._drawType&&this._toolbar.activate(this._drawType))},deactivate:function(){this._toolbar&&this._toolbar.deactivate();this._editToolbar&&this._editToolbar.deactivate();this.setChecked(!1);this._updateUI()},setEnabled:function(k){this._enabled=k;this._updateUI()},setChecked:function(k){this._checked=k},enable:function(k){this._updateUI()},isEnabled:function(){return this._enabled},getToolName:function(){return this._toolName},_initializeTool:function(){},_updateUI:function(){this.disabled=!this._enabled;
this.attr("iconClass",this._enabled?this._enabledIcon:this._disabledIcon)}});r("extend-esri")&&u.setObject("dijit.editing.tools.ToolBase",G,n);return G})},"esri/dijit/editing/tools/Cut":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dojo/DeferredList ../../../graphicsUtils ../../../graphic ../../../tasks/query ../../../layers/FeatureLayer ../../../toolbars/draw ../Cut ./ToggleToolBase ../../../kernel".split(" "),function(G,u,r,n,m,k,d,a,b,e,g,h,
c,f){G=G([c],{declaredClass:"esri.dijit.editing.tools.Cut",id:"btnFeatureCut",_enabledIcon:"toolbarIcon cutIcon",_disabledIcon:"toolbarIcon cutIcon",_drawType:g.POLYLINE,_enabled:!0,_label:"NLS_cutLbl",_cutConnects:[],activate:function(){this._cutConnects.push(n.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd"));this.inherited(arguments)},deactivate:function(){this.inherited(arguments);r.forEach(this._cutConnects,n.disconnect);this._cutConnects=[];this._edits=[]},_onDrawEnd:function(l){var q=this._cutLayers=
r.filter(this._settings.layers,function(v){return"esriGeometryPolygon"===v.geometryType||"esriGeometryPolyline"===v.geometryType&&v.visible&&v._isMapAtVisibleScale()});this._cutConnects=this._cutConnects.concat(r.map(q,u.hitch(this,function(v){return n.connect(v,"onEditsComplete",u.hitch(this,function(w,x,H){if(this._settings.undoRedoManager){var A=this._settings.undoRedoManager;r.forEach(this._edits,u.hitch(this,function(z){A.add(new h({featureLayer:z.layer,addedGraphics:z.adds,preUpdatedGraphics:z.preUpdates,
postUpdatedGraphics:z.updates}))}),this)}this.onFinished()}))})));var t=new b;t.geometry=l;r.forEach(q,function(v,w){this._settings.editor._selectionHelper.selectFeatures([v],t,e.SELECTION_NEW,u.hitch(this,"_cutFeatures",v,t))},this)},_cutFeatures:function(l,q,t){if(t&&t.length){this._edits=[];var v=[];v.push(this._settings.geometryService.cut(d.getGeometries(t),q.geometry,u.hitch(this,"_cutHandler",l,t)));(new k(v)).addCallback(u.hitch(this,function(){this.onApplyEdits(this._edits)}))}},_cutHandler:function(l,
q,t){var v=[],w=[],x=r.map(q,function(z){return new a(u.clone(z.toJson()))}),H,A;r.forEach(t.cutIndexes,function(z,E){H!=z?(H=z,w.push(q[z].setGeometry(t.geometries[E]))):(A=new a(t.geometries[E],null,u.mixin({},q[z].attributes),null),A.attributes[q[0].getLayer().objectIdField]=null,v.push(A))},this);this._edits.push({layer:l,adds:v,updates:w,preUpdates:x})}});m("extend-esri")&&u.setObject("dijit.editing.tools.Cut",G,f);return G})},"esri/dijit/editing/tools/ToggleToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/form/ToggleButton ./ToolBase ../../../kernel".split(" "),
function(G,u,r,n,m,k){G=G([n,m],{declaredClass:"esri.dijit.editing.tools.ToggleToolBase",postCreate:function(){this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){n.prototype.destroy.apply(this,arguments);m.prototype.destroy.apply(this,arguments)},setChecked:function(d){n.prototype.setChecked.apply(this,arguments)}});r("extend-esri")&&u.setObject("dijit.editing.tools.ToggleToolBase",G,k);return G})},"esri/dijit/editing/tools/Union":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../graphicsUtils ../../../graphic ../../../toolbars/draw ../Union ./ButtonToolBase ../../../kernel".split(" "),
function(G,u,r,n,m,k,d,a,b,e){G=G([b],{declaredClass:"esri.dijit.editing.tools.Union",id:"btnFeatureUnion",_enabledIcon:"toolbarIcon unionIcon",_disabledIcon:"toolbarIcon unionIcon",_drawType:d.POLYLINE,_enabled:!0,_label:"NLS_unionLbl",_onClick:function(g){this._settings.editor._activeTool="UNION";g=r.filter(this._settings.layers,function(f){return"esriGeometryPolygon"===f.geometryType&&f.visible&&f._isMapAtVisibleScale()});var h=[],c=0;r.forEach(g,function(f,l){var q=f.getSelectedFeatures();2<=
q.length&&(c++,this._settings.geometryService.union(m.getGeometries(q),u.hitch(this,function(t){var v=q.shift(),w=[],x=[];w.push(new k(v.toJson()));x.push(v.setGeometry(t));h.push({layer:f,updates:x,deletes:q,preUpdates:w});c--;if(0>=c)this.onApplyEdits(h,u.hitch(this,function(){if(this._settings.undoRedoManager){var H=this._settings.undoRedoManager;r.forEach(this._edits,u.hitch(this,function(A){H.add(new a({featureLayer:A.layer,deletedGraphics:A.deletes,preUpdatedGraphics:A.preUpdates,postUpdatedGraphics:A.updates}))}),
this)}this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()}))})))},this)}});n("extend-esri")&&u.setObject("dijit.editing.tools.Union",G,e);return G})},"esri/dijit/editing/tools/Reshape":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has ../../../graphic ../../../layers/FeatureLayer ../../../tasks/query ../../../toolbars/draw ./ToggleToolBase ../../../kernel".split(" "),function(G,u,r,n,m,k,d,a,b,e,g){G=G([e],{declaredClass:"esri.dijit.editing.tools.Reshape",
id:"btnFeatureReshape",_enabledIcon:"toolbarIcon reshapeIcon",_disabledIcon:"toolbarIcon reshapeIcon",_drawType:b.POLYLINE,_enabled:!0,_label:"NLS_reshapeLbl",activate:function(){n.disconnect(this._rConnect);this._rConnect=n.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd");this.inherited(arguments)},deactivate:function(){this.inherited(arguments);n.disconnect(this._rConnect);delete this._rConnect},_onDrawEnd:function(h){var c=this._settings.layers,f=new a;f.geometry=h;h=this._reshapeLayers=r.filter(c,
function(l){return"esriGeometryPolygon"===l.geometryType||"esriGeometryPolyline"});this._settings.editor._selectionHelper.selectFeatures(h,f,d.SELECTION_NEW,u.hitch(this,"_reshape",f))},_reshape:function(h,c){if(1===c.length){var f=[],l=[],q=[],t=c[0],v=t.getLayer();this._settings.geometryService.reshape(t.geometry,h.geometry,u.hitch(this,function(w){"polyline"===w.type&&w.paths&&0===w.paths.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):"polygon"===w.type&&w.rings&&
0===w.rings.length?(this._settings.editor._selectionHelper.clearSelection(!1),this.onFinished()):(q.push(new k(t.toJson())),l.push(t.setGeometry(w)),f.push({layer:v,updates:l,preUpdates:q}),this.onApplyEdits(f,u.hitch(this,function(){this._settings.editor._selectionHelper.clearSelection(!1);this.onFinished()})))}))}}});m("extend-esri")&&u.setObject("dijit.editing.tools.Reshape",G,g);return G})},"esri/dijit/editing/tools/Editing":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../../../layers/FeatureTemplate ./Edit ./EditingTools ./DropDownToolBase ../../../kernel ../../../lang".split(" "),
function(G,u,r,n,m,k,d,a,b,e){G=G([a],{declaredClass:"esri.dijit.editing.tools.Editing",_enabled:!1,deactivate:function(){this._enabled&&(this._enabled=!1,this.inherited(arguments),this._settings.templatePicker.clearSelection())},onItemClicked:function(g,h){this.inherited(arguments);this._activeTool===this._tools.AUTOCOMPLETE&&(this._settings.editor._drawingTool=m.TOOL_AUTO_COMPLETE_POLYGON)},_activateTool:function(g,h){var c;this.enable(h);for(c in this._tools)this._tools.hasOwnProperty(c)&&(this.dropDown.removeChild(this._tools[c]),
!0===this._tools[c]._enabled&&this.dropDown.addChild(this._tools[c]));if(this._geometryType!==h||!1===this._activeTool._enabled)this._activeTool=this._tools[g.toUpperCase()];this._geometryType=h;this._activeTool.activate();this._activeTool.setChecked(!0);this._updateUI()},_initializeTool:function(g){this.inherited(arguments);this._initializeTools()},_initializeTools:function(){var g=this._settings.layers,h=this._settings.editor,c=!1,f=!1,l=!1,q=this._toolTypes=[],t;r.forEach(g,function(v){t=v.geometryType;
c=c||"esriGeometryPoint"===t;f=f||"esriGeometryPolyline"===t;l=l||"esriGeometryPolygon"===t;q=q.concat(r.map(this._getTemplatesFromLayer(v),u.hitch(this,function(w){return h._toDrawTool(w.drawingTool,v)})))},this);g=this._settings.createOptions;c&&this._toolTypes.push("point");f&&(this._toolTypes=this._toolTypes.concat(g.polylineDrawTools));l&&(this._toolTypes=this._toolTypes.concat(g.polygonDrawTools));this._toolTypes=this._toUnique(this._toolTypes.concat(q))},_toUnique:function(g){var h={};return r.filter(g,
function(c){return h[c]?!1:h[c]=!0})},_getTemplatesFromLayer:function(g){var h=g.templates||[];r.forEach(g.types,function(c){h=h.concat(c.templates)});return r.filter(h,e.isDefined)},_createTools:function(){r.forEach(this._toolTypes,this._createTool,this);this.inherited(arguments)},_createTool:function(g){var h=u.mixin(d[g],{settings:this._settings,onClick:u.hitch(this,"onItemClicked",d[g].id)});this._tools[g.toUpperCase()]=new k(h)}});n("extend-esri")&&u.setObject("dijit.editing.tools.Editing",G,
b);return G})},"esri/dijit/editing/tools/Edit":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","./MenuItemBase","../../../kernel"],function(G,u,r,n,m){G=G([n],{declaredClass:"esri.dijit.editing.tools.Edit",enable:function(k){this._enabled=k===this._geomType;this.inherited(arguments)}});r("extend-esri")&&u.setObject("dijit.editing.tools.Edit",G,m);return G})},"esri/dijit/editing/tools/MenuItemBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dijit/MenuItem ./ToolBase ../../../kernel".split(" "),
function(G,u,r,n,m,k){G=G([n,m],{declaredClass:"esri.dijit.editing.tools.MenuItemBase",destroy:function(){n.prototype.destroy.apply(this,arguments);m.prototype.destroy.apply(this,arguments)}});r("extend-esri")&&u.setObject("dijit.editing.tools.MenuItemBase",G,k);return G})},"esri/dijit/editing/tools/EditingTools":function(){define(["dojo/_base/lang","dojo/has","../../../toolbars/draw","../../../kernel"],function(G,u,r,n){r={point:{id:"esriPointTool",_enabledIcon:"toolbarIcon pointIcon",_disabledIcon:"toolbarIcon pointIconDisabled",
_drawType:r.POINT,_geomType:"esriGeometryPoint",_label:"NLS_pointLbl"},polyline:{id:"toolDrawFreehandPolyline",_enabledIcon:"toolbarIcon polylineIcon",_disabledIcon:"toolbarIcon polylineIconDisabled",_drawType:r.POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_polylineLbl"},freehandpolyline:{id:"toolDrawPolyline",_enabledIcon:"toolbarIcon freehandPolylineIcon",_disabledIcon:"toolbarIcon freehandPolylineIcon",_drawType:r.FREEHAND_POLYLINE,_geomType:"esriGeometryPolyline",_label:"NLS_freehandPolylineLbl"},
polygon:{id:"toolDrawPolygon",_enabledIcon:"toolbarIcon polygonIcon",_disabledIcon:"toolbarIcon polygonIconDisabled",_drawType:r.POLYGON,_geomType:"esriGeometryPolygon",_label:"NLS_polygonLbl"},freehandpolygon:{id:"toolDrawFreehandPolygon",_enabledIcon:"toolbarIcon freehandPolygonIcon",_disabledIcon:"toolbarIcon freehandPolygonIconDisabled",_drawType:r.FREEHAND_POLYGON,_label:"NLS_freehandPolygonLbl",_geomType:"esriGeometryPolygon"},autocomplete:{id:"btnFeatureAutoComplete",_enabledIcon:"toolbarIcon autoCompleteIcon",
_disabledIcon:"toolbarIcon autoCompleteIcon",_drawType:r.POLYGON,_label:"NLS_autoCompleteLbl",_geomType:"esriGeometryPolygon"},rectangle:{id:"toolDrawRect",_enabledIcon:"toolbarIcon rectangleIcon",_disabledIcon:"toolbarIcon rectangleIcon",_drawType:r.RECTANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_rectangleLbl"},arrow:{id:"toolDrawArrow",_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:r.ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowLbl"},uparrow:{id:"toolDrawArrowUp",
_enabledIcon:"toolbarIcon arrowUpIcon",_disabledIcon:"toolbarIcon arrowUpIcon",_drawType:r.UP_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowUpLbl"},downarrow:{id:"toolDrawDownArrow",_enabledIcon:"toolbarIcon arrowDownIcon",_disabledIcon:"toolbarIcon arrowDownIcon",_drawType:r.DOWN_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowDownLbl"},leftarrow:{id:"toolDrawLeftArrow",_enabledIcon:"toolbarIcon arrowLeftIcon",_disabledIcon:"toolbarIcon arrowLeftIcon",_drawType:r.LEFT_ARROW,_geomType:"esriGeometryPolygon",
_label:"NLS_arrowLeftLbl"},rightarrow:{id:"toolDrawRightArrow",_enabledIcon:"toolbarIcon arrowIcon",_disabledIcon:"toolbarIcon arrowIcon",_drawType:r.RIGHT_ARROW,_geomType:"esriGeometryPolygon",_label:"NLS_arrowRightLbl"},circle:{id:"toolDrawCircle",_enabledIcon:"toolbarIcon circleIcon",_disabledIcon:"toolbarIcon circleIcon",_drawType:r.CIRCLE,_geomType:"esriGeometryPolygon",_label:"NLS_circleLbl"},ellipse:{id:"toolDrawEllipse",_enabledIcon:"toolbarIcon ellipseIcon",_disabledIcon:"toolbarIcon ellipseIcon",
_drawType:r.ELLIPSE,_geomType:"esriGeometryPolygon",_label:"NLS_ellipseLbl"},triangle:{id:"toolDrawTriangle",_enabledIcon:"toolbarIcon triangleIcon",_disabledIcon:"toolbarIcon triangleIcon",_drawType:r.TRIANGLE,_geomType:"esriGeometryPolygon",_label:"NLS_triangleLbl"},attributes:{id:"btnAttributes",_enabledIcon:"toolbarIcon attributesIcon",_disabledIcon:"toolbarIcon attributesIcon",_enabled:!1,_label:"NLS_attributesLbl"},del:{id:"btnDelete2",_enabledIcon:"toolbarIcon deleteFeatureIcon",_disabledIcon:"toolbarIcon deleteFeatureIcon",
_enabled:!1,_label:"NLS_deleteLbl"},undo:{id:"btnUndo",_enabledIcon:"dijitEditorIcon dijitEditorIconUndo",_disabledIcon:"dijitEditorIcon dijitEditorIconUndo",_enabled:!1,_label:"NLS_undoLbl"},redo:{id:"btnRedo",_enabledIcon:"dijitEditorIcon dijitEditorIconRedo",_disabledIcon:"dijitEditorIcon dijitEditorIconRedo",_enabled:!1,_label:"NLS_redoLbl"}};u("extend-esri")&&G.setObject("dijit.editing.tools.EditingTools",r,n);return r})},"esri/dijit/editing/tools/DropDownToolBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-style dijit/registry dijit/Menu dijit/form/ComboButton ./ToolBase ../../../kernel ../../../lang".split(" "),
function(G,u,r,n,m,k,d,a,b,e){G=G([d,a],{declaredClass:"esri.dijit.editing.tools.DropDownToolBase",_enabled:!1,_checked:!1,postCreate:function(){this._tools=[];this._createTools();this.inherited(arguments);this._setShowLabelAttr&&this._setShowLabelAttr(!1)},destroy:function(){var g,h=this._tools;for(g in h)h.hasOwnProperty(g)&&e.isDefined(h[g])&&h[g].destroy();this.inherited(arguments)},_createTools:function(){var g,h=new k;this.dropDown=h;for(g in this._tools)this._tools.hasOwnProperty(g)&&h.addChild(this._tools[g]);
this._activeTool=h.getChildren()[0];this._updateUI()},activate:function(g){this.inherited(arguments);this._activeTool?this._activeTool.activate():this._activateDefaultTool()},deactivate:function(){this.inherited(arguments);this._activeTool&&this._activeTool.deactivate()},enable:function(g){for(var h in this._tools)this._tools.hasOwnProperty(h)&&this._tools[h].enable(g);this.setEnabled(!0);this.inherited(arguments)},setChecked:function(g){this._checked=g;this._updateUI()},_onDrawEnd:function(g){},
onLayerChange:function(g,h,c){this._activeTool=null;this._activeType=h;this._activeTemplate=c;this._activeLayer=g},onItemClicked:function(g,h){this._activeTool&&this._activeTool.deactivate();this._activeTool=m.byId(g);!1===this._checked?this._onClick():(this._updateUI(),this._activeTool&&(this._activeTool.activate(),this._activeTool.setChecked(!0)))},_onClick:function(g){!1!==this._enabled&&(this._checked=!this._checked,this.inherited(arguments))},_updateUI:function(){this.attr("disabled",!this._enabled);
n.set(this.focusNode,{outline:"none"});n.set(this.titleNode,{padding:"0px",border:"none"});this._checked?n.set(this.titleNode,{backgroundColor:"#D4DFF2",border:"1px solid #316AC5"}):n.set(this.titleNode,{backgroundColor:"",border:""});this._activeTool&&(this.attr("iconClass",this._checked?this._activeTool._enabledIcon:this._activeTool._disabledIcon),this.attr("label",this._activeTool.label))}});r("extend-esri")&&u.setObject("dijit.editing.tools.DropDownToolBase",G,b);return G})},"esri/dijit/editing/tools/Selection":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has ../../../symbols/SimpleMarkerSymbol ../../../symbols/SimpleLineSymbol ../../../symbols/SimpleFillSymbol ./Edit ./SelectionTools ./DropDownToolBase ../../../kernel".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c){G=G([h],{declaredClass:"esri.dijit.editing.tools.Selection",_enabled:!0,activate:function(){this.inherited(arguments);this._sConnect=n.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd")},deactivate:function(){this.inherited(arguments);n.disconnect(this._sConnect);delete this._sConnect},_initializeTool:function(){this._createSymbols();this._initializeLayers();this._toolTypes=["select","selectadd","selectremove"]},_onDrawEnd:function(f){this.inherited(arguments);
this._settings.editor._hideAttributeInspector();var l=this._settings.layers;this._selectMethod=this._activeTool._selectMethod;this._settings.editor._selectionHelper.selectFeaturesByGeometry(l,f,this._selectMethod,u.hitch(this,"onFinished"))},_createSymbols:function(){this._pointSelectionSymbol=new d(d.STYLE_CIRCLE,10,new a(a.STYLE_SOLID,new m([0,0,0]),1),new m([255,0,0,.5]));this._polylineSelectionSymbol=new a(a.STYLE_SOLID,new m([0,200,255]),2);this._polygonSelectionSymbol=new b(b.STYLE_SOLID,new a(a.STYLE_SOLID,
new m([0,0,0]),1),new m([0,200,255,.5]))},_initializeLayers:function(){r.forEach(this._settings.layers,this._setSelectionSymbol,this)},_setSelectionSymbol:function(f){var l=null;switch(f.geometryType){case "esriGeometryPoint":l=this._pointSelectionSymbol;break;case "esriGeometryPolyline":l=this._polylineSelectionSymbol;break;case "esriGeometryPolygon":l=this._polygonSelectionSymbol}f.setSelectionSymbol(f._selectionSymbol||l)},_createTools:function(){r.forEach(this._toolTypes,this._createTool,this);
this.inherited(arguments)},_createTool:function(f){var l=u.mixin(g[f],{settings:this._settings,onClick:u.hitch(this,"onItemClicked",g[f].id)});this._tools[f.toUpperCase()]=new e(l)}});k("extend-esri")&&u.setObject("dijit.editing.tools.Selection",G,c);return G})},"esri/dijit/editing/tools/SelectionTools":function(){define(["dojo/_base/lang","dojo/has","../../../layers/FeatureLayer","../../../toolbars/draw","../../../kernel"],function(G,u,r,n,m){r={select:{id:"btnNewSelection",_enabledIcon:"toolbarIcon newSelectionIcon",
_disabledIcon:"toolbarIcon newSelectionIcon",_drawType:n.EXTENT,_selectMethod:r.SELECTION_NEW,_label:"NLS_selectionNewLbl"},selectadd:{id:"btnAddToSelection",_enabledIcon:"toolbarIcon addToSelectionIcon",_disabledIcon:"toolbarIcon addToSelectionIcon",_drawType:n.EXTENT,_selectMethod:r.SELECTION_ADD,_label:"NLS_selectionAddLbl"},selectremove:{id:"btnSubtractFromSelection",_enabledIcon:"toolbarIcon removeFromSelectionIcon",_disabledIcon:"toolbarIcon removeFromSelectionIcon",_drawType:n.EXTENT,_selectMethod:r.SELECTION_SUBTRACT,
_label:"NLS_selectionRemoveLbl"},selectClear:{id:"btnClearSelection",_enabledIcon:"toolbarIcon clearSelectionIcon",_disabledIcon:"toolbarIcon clearSelectionIcon",_enabled:!1,_label:"NLS_selectionClearLbl"}};u("extend-esri")&&G.setObject("dijit.editing.tools.SelectionTools",r,m);return r})},"esri/dijit/editing/SelectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dojo/DeferredList ../../geometry/Extent ../../geometry/Point ../../geometry/ScreenPoint ../../layers/FeatureLayer ../../tasks/query ../../kernel".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h){G=G(null,{declaredClass:"esri.dijit.editing.SelectionHelper",constructor:function(c){this._settings=c||{};this._sConnects=[];this._mapServiceCount=0;this._map=this._settings.map;this._tolerance=this._settings.singleSelectionTolerance;this._initMapServiceInfos(this._settings.layers)},destroy:function(){for(var c in this._sConnects)this._sConnects.hasOwnProperty(c)&&r.disconnect(this._sConnects[c])},selectFeatures:function(c,f,l,q){l===e.SELECTION_NEW&&(this._resetMapServiceInfos(),
this.getSelection(c));var t=[];n.forEach(c,function(v){if(!0===v.visible&&!0===v._isMapAtVisibleScale()){var w=l;v._isSelOnly&&w===e.SELECTION_NEW&&(w=e.SELECTION_ADD);t.push(v.selectFeatures(f,w))}});(new k(t)).addCallback(u.hitch(this,function(v){var w=[];n.forEach(v,function(x,H){n.forEach(x[1],function(A){(A=c[H]._mode._getFeature(A.attributes[c[H].objectIdField])||null)&&w.push(A)},this)},this);this._mapServiceCount?((v=l===e.SELECTION_SUBTRACT)?(this._resetMapServiceInfos(),this._createLayerDefs(this._getLayerInfosFromSelection(c))):
this._createLayerDefs(this._getLayerInfosFromFeatures(w)),this._updateLayerDefs(this._mapServiceInfos,!1,!(w&&w.length||v),u.hitch(this,q,w))):q(w)}))},selectFeaturesByGeometry:function(c,f,l,q){var t=f;-1!==f.declaredClass.indexOf("Extent")&&f.xmax===f.xmin&&f.ymax===f.ymin&&(t=new a(f.xmax,f.ymax,f.spatialReference));t=-1!==t.declaredClass.indexOf("Point")?this._extentFromPoint(t):t;f=new g;f.geometry=t;this.selectFeatures(c,f,l,q)},clearSelection:function(c){n.forEach(this._nonSelOnlyLayers,function(l){l.clearSelection&&
l.clearSelection()});if(this._mapServiceCount){this._resetMapServiceInfos();var f=this._getLayerInfosFromSelection(this._settings.layers);n.some(f,function(l){return l.oids&&l.oids.length})&&(this._createLayerDefs(f),this._updateLayerDefs(this._mapServiceInfos,!0,c||!1))}},findMapService:function(c){var f=this._map,l=f.layerIds;c=c&&c._url&&c._url.path?c._url.path.toLowerCase():"";var q;for(q in l)if(l.hasOwnProperty(q)){var t=f.getLayer(l[q]);var v=t._url?t._url.path?t._url.path.toLowerCase().replace("mapserver",
"featureserver"):t._url.toLowerCase().replace("mapserver","featureserver"):"";if(c.substr(0,v.length)===v&&"esri.layers.ArcGISDynamicMapServiceLayer"===t.declaredClass)return t}},getSelection:function(c){var f=[];n.forEach(c,function(l){l._isSelOnly&&f.push(this._createLayerInfo(l))},this);n.forEach(f,function(l){var q=this._createMapServiceInfo(this.findMapService(l.layer));q&&(q.layerInfos[l.layer.layerId]=l)},this)},_initMapServiceInfos:function(c){this._nonSelOnlyLayers=[];this._mapServiceInfos=
[];n.forEach(c,function(f){var l=this.findMapService(f);l?(this._mapServiceCount++,this._createMapServiceInfo(l),l&&l.setDisableClientCaching(!0)):this._nonSelOnlyLayers.push(f)},this)},_createMapServiceInfo:function(c){if(!c)return null;var f=this._mapServiceInfos,l=f[c.id];l||(l=f[c.id]={mapService:c,layerInfos:[],layerDefs:u.mixin([],c.layerDefinitions||[]),origLayerDefs:u.mixin([],c.layerDefinitions||[])});return l},_resetMapServiceInfo:function(c){n.forEach(c.layerInfos,this._resetLayerInfo);
c.layerDefs=u.mixin([],c.origLayerDefs||[])},_resetMapServiceInfos:function(){var c=this._mapServiceInfos,f;for(f in c)c.hasOwnProperty(f)&&this._resetMapServiceInfo(c[f])},_createLayerInfo:function(c,f){var l=c.objectIdField;f=f?[]:c.getSelectedFeatures();return{layer:c,selectedFeatures:f||[],oids:n.map(f,function(q){return q.attributes[l]})}},_resetLayerInfo:function(c){c&&(c.selectedFeatures=[],c.oids=[])},_updateLayerDefs:function(c,f,l,q){for(var t in c)if(c.hasOwnProperty(t)){var v=c[t],w=v.mapService,
x=v.layerDefs=f?u.mixin([],v.origLayerDefs||[]):v.layerDefs;x?(l?q&&q():this._sConnects[w.id]=r.connect(w,"onUpdateEnd",u.hitch(this,"_onMapServiceUpdate",v,f,q)),w.setLayerDefinitions(x,l||!1)):q&&q()}},_onMapServiceUpdate:function(c,f,l){r.disconnect(this._sConnects[c.mapService.id]);n.forEach(c.layerInfos,function(q){if(f)q&&q.layer.clearSelection();else{var t=new g;t.objectIds=q?q.oids:[];t.objectIds.length&&q.layer.selectFeatures(t,e.SELECTION_SUBTRACT)}},this);f&&this._resetMapServiceInfo(c);
l&&l()},_createLayerDefs:function(c){n.forEach(c,function(f){var l=f.layer,q=this._createMapServiceInfo(this.findMapService(f.layer));if(q){q=q.layerDefs;var t=l.layerId,v='("'+l.objectIdField+'" NOT IN (',w=f.oids;w&&w.length&&(n.forEach(f.oids,function(x,H){w=!0;H&&(v+=",");v+="'"+x+"'"}),v+="))",q[t]=q.length&&q[t]&&q[t].length?q[t]+(" AND"+v):v)}},this)},_getLayerInfosFromFeatures:function(c){var f=[];n.forEach(c,function(q){var t=q.getLayer();t&&t._isSelOnly&&(f[t.id]||(f[t.id]=this._createLayerInfo(t,
!0)),f[t.id].selectedFeatures.push(q),f[t.id].oids.push(q.attributes[t.objectIdField]))},this);c=[];for(var l in f)f.hasOwnProperty(l)&&c.push(f[l]);return c},_getLayerInfosFromSelection:function(c){var f=[];n.forEach(c,function(l){l._isSelOnly&&f.push(this._createLayerInfo(l,!1))},this);return f},_extentFromPoint:function(c){var f=this._tolerance,l=this._map,q=l.toScreen(c);c=new b(q.x-f,q.y+f);f=new b(q.x+f,q.y-f);c=l.toMap(c);f=l.toMap(f);return new d(c.x,c.y,f.x,f.y,l.spatialReference)}});m("extend-esri")&&
u.setObject("dijit.editing.SelectionHelper",G,h);return G})},"esri/dijit/editing/TemplatePicker":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/html dojo/_base/array dojo/_base/json dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dijit/_Widget dijit/_Templated dojo/data/ItemFileReadStore dojox/grid/DataGrid dojox/gfx ../../layers/FeatureLayer ../../symbols/SimpleMarkerSymbol ../../symbols/PictureMarkerSymbol ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol ./TemplatePickerItem ../../kernel ../../lang ../../request ../_EventedWidget dojo/i18n!../../nls/jsapi dojo/text!./templates/TemplatePicker.html".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z,E,J,D,L,C,N,S,F){var T=G([N,l,q],{declaredClass:"esri.dijit.editing.TemplatePicker",widgetsInTemplate:!0,templateString:F,featureLayers:null,items:null,grouping:!0,showTooltip:!1,maxLabelLength:0,rows:4,_rows:0,columns:3,surfaceWidth:30,surfaceHeight:30,emptyMessage:"",useLegend:!0,legendCache:{},_uniqueId:{id:0},_assumedCellWidth:90,_initialAutoWidth:300,_initialAutoHeight:200,_ieTimer:150,constructor:function(y,B){y=y||{};y.items||y.featureLayers||
console.error("TemplatePicker: please provide 'featureLayers' or 'items' parameter in the constructor");this._dojo14x=4<=d.version.minor;this._itemWidgets={};y.featureLayers&&y.featureLayers.length&&(this._flChanged=1);this._nls=S.widgets.templatePicker;this.emptyMessage=y.emptyMessage||this._nls&&this._nls.creationDisabled||""},postMixInProperties:function(){this.inherited(arguments);this._preprocess()},startup:function(){this.inherited(arguments);if("auto"===this.rows&&"auto"===this.columns){var y=
c.getContentBox(this.domNode);y.w||(this.domNode.style.width=this._initialAutoWidth+"px");if(!y.h||1>=y.h)this.domNode.style.height=this._initialAutoHeight+"px";y=c.getContentBox(this.domNode);this._columns=Math.floor(y.w/this._assumedCellWidth)||1}this._applyGridPatches();this._setGridLayout();r.connect(this.grid,"onRowClick",this,this._rowClicked);this._setGridData();this._toggleTooltip();9>a("ie")&&(this._repaintItems=u.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},
destroy:function(){this.showTooltip=!1;this._toggleTooltip();this._clearLegendInfo();this.featureLayers=this.items=this.grid=this._flItems=this._itItems=this._groupRowIndices=this._selectedCell=this._selectedInfo=this._selectedItem=null;this.inherited(arguments)},getSelected:function(){return this._selectedCell?this._selectedItem:null},clearSelection:function(){var y=this._selectedCell,B=this._selectedInfo;y&&this._rowClicked({cellNode:y,rowIndex:B.selRow,cellIndex:B.selCol})},update:function(y){y=
"auto"===this.rows&&"auto"===this.columns&&y?!0:!1;var B=this.grid;if(y){var I=this.domNode;var P=d.query("#"+I.id+".templatePicker div.item")[0];I=c.getContentBox(I);P=(P=P&&P.parentNode)?n.coords(P).w:this._assumedCellWidth;this._columns=(this._columns=Math.floor((I.w-B.views.views[0].getScrollbarWidth())/P))||1}P=this._rows;this._preprocess();var X=this._rows;this._setGridLayout();this._setGridData();X!==P&&B.set("autoHeight",this._rows,!1);y?(B._resize({w:I.w,h:I.h}),B.viewsHeaderNode.style.display=
"none"):B.update();this._toggleTooltip();var Y=this,aa=this.getSelected();aa&&B.store.fetch({onComplete:function(Z){var fa=(Z=Y._locate(aa,Y._selectedInfo,Z))&&B.views.views[0].getCellNode(Z[0],Z[1]);fa&&Y._rowClicked({cellNode:fa,rowIndex:Z[0],cellIndex:Z[1]},!0)}});9>a("ie")&&setTimeout(this._repaintItems,this._ieTimer);y=this.featureLayers;I=this.items;y&&y.length||I&&I.length||!B||!this.emptyMessage||B.showMessage(this.emptyMessage)},_eventMap:{"selection-change":!0},onSelectionChange:function(){},
_setUseLegendAttr:function(y){var B=this.useLegend;this._started&&B===y||(y?this._flChanged=1:this._clearLegendInfo());this.useLegend=y},_setFeatureLayersAttr:function(y){var B=this.featureLayers;this._started&&B===y||(this._flChanged=1);this.featureLayers=y},_adjustRowsCols:function(y){if("auto"===this.rows&&"auto"===this.columns)this._started||(this._rows=!1,this._columns=null,this._autoWidth=!1);else{var B=0;this._rows=this.rows;this._columns=this.columns;"auto"===this.rows?(this.featureLayers?
this.grouping?(B=y.length,m.forEach(y,function(I){B+=Math.ceil(I.length/this.columns)},this)):(m.forEach(y,function(I){B+=I.length},this),B=Math.ceil(B/this.columns)):B=Math.ceil(y.length/this.columns),this._rows=B):"auto"===this.columns&&(this.featureLayers?this.grouping?B=3:(m.forEach(y,function(I){B+=I.length},this),B=Math.ceil(B/this.rows)):B=Math.ceil(y.length/this.rows),this._columns=B)}},_preprocess:function(){this.items&&(this.grouping=!1);this._autoWidth=!1;if("auto"===this.rows||"auto"===
this.columns)this._autoWidth=!0;if(this.featureLayers)if(this.useLegend&&this._flChanged&&(this._legendIndices=[],this._loadingIndices=[],this._legendSymbols={},this._ignoreLegends(),this._loadingLegends=[],clearTimeout(this._legendTimer),this._legendTimer=null,this._processSelectionLayers(),this._flChanged=0),m.every(this.featureLayers,function(I){return I.loaded})){this.featureLayers=m.filter(this.featureLayers,function(I){return!(I.hasZ&&!I.enableZDefaults)});var y=this._flItems=this._getItemsFromLayers(this.featureLayers);
this._adjustRowsCols(y)}else{var B=this.featureLayers.length;m.forEach(this.featureLayers,function(I){if(I.loaded)B--;else var P=r.connect(I,"onLoad",this,function(){r.disconnect(P);P=null;B--;B||this.update()})},this)}else y=this._itItems=this._getItemsFromItems(this.items),this._adjustRowsCols(y)},_processSelectionLayers:function(){var y,B,I,P,X,Y,aa,Z={};m.forEach(this.featureLayers,function(fa,K){fa.mode===x.MODE_SELECTION&&fa._map&&fa.url&&fa._params.drawMode&&!fa.source&&(B=u.trim(fa._url.path).replace(/\/(MapServer|FeatureServer).*/ig,
"/MapServer").replace(/^https?:\/\//ig,"").toLowerCase(),I=Z[B]=Z[B]||{},P=I.featureLayers=I.featureLayers||{},Y=I.indices=I.indices||[],P[K]=fa,Y.push(K),y=fa._map)});y&&m.forEach(y.layerIds,function(fa){(fa=y.getLayer(fa))&&fa.url&&(fa.getImageUrl||fa.getTileUrl)&&fa.loaded&&10.1<=fa.version&&(B=u.trim(fa._url.path).replace(/(\/MapServer).*/ig,"$1"),X=B.replace(/^https?:\/\//ig,"").toLowerCase(),Z[X]&&!Z[X].mapServiceUrl&&(I=Z[X],I.mapServiceUrl=B,I.mapServiceLayer=fa,this._legendIndices=this._legendIndices.concat(I.indices),
aa=this._fetchLegend({pickerInstance:this,info:I},X),aa.then?(this._loadingIndices=this._loadingIndices.concat(I.indices),this._loadingLegends.push(aa)):this._processLegendResponse(aa,I)))},this)},_fetchLegend:function(y,B){var I=T.prototype,P=I.legendCache[B];P?P.then&&P._contexts.push(y):(P=I.legendCache[B]=C({url:y.info.mapServiceUrl+"/legend",content:{f:"json"},callbackParamName:"callback"}),P._contexts=[y],P.addBoth(function(X){if(!P.canceled){I.legendCache[B]=X;var Y=P._contexts;P._contexts=
null;m.forEach(Y,function(aa){var Z=aa.pickerInstance;aa=aa.info;if(!Z._destroyed){m.forEach(aa.indices,function(K){fa=m.indexOf(Z._loadingIndices,K);-1<fa&&Z._loadingIndices.splice(fa,1)});var fa=m.indexOf(Z._loadingLegends,P);-1<fa&&Z._loadingLegends.splice(fa,1);Z._processLegendResponse(X,aa)}})}}));return P},_clearLegendInfo:function(){clearTimeout(this._legendTimer);this._ignoreLegends();this._legendIndices=this._loadingIndices=this._legendSymbols=this._loadingLegends=this._legendTimer=null},
_ignoreLegends:function(){this._loadingLegends&&m.forEach(this._loadingLegends,function(y){var B=-1;m.some(y._contexts,function(I,P){I.pickerInstance===this&&(B=P);return-1<B},this);-1<B&&y._contexts.splice(B,1)},this)},_processLegendResponse:function(y,B){if(!y||y instanceof Error){var I;m.forEach(B.indices,function(X){I=m.indexOf(this._legendIndices,X);-1<I&&this._legendIndices.splice(I,1)},this)}else m.forEach(B.indices,function(X){var Y=B.featureLayers[X].layerId,aa,Z=B.mapServiceUrl+"/"+Y+"/images/",
fa=B.mapServiceLayer._getToken(),K,R;if(!this._legendSymbols[X]){var U=null;m.some(y.layers,function(Q){Q.layerId==Y&&(U=Q);return!!U});if(U){var ba=this._legendSymbols[X]={};m.forEach(U.legend,function(Q){if((K=Q.values)&&K.length)for(aa=0;aa<K.length;aa++)ba[K[aa]]=Q;else ba.defaultSymbol=Q;(R=Q.url)&&!Q._fixed&&(Q._fixed=1,-1===R.search(/https?:/)&&(Q.url=Z+R),fa&&-1!==Q.url.search(/https?:/)&&(Q.url+=(-1<Q.url.indexOf("?")?"\x26":"?")+"token\x3d"+fa))})}}},this);var P=this;P._started&&!P._legendTimer&&
(P._legendTimer=setTimeout(function(){clearTimeout(P._legendTimer);P._legendTimer=null;P._destroyed||P.update()},0))},_applyGridPatches:function(){var y=this.grid,B=y.adaptWidth,I,P,X;y.adaptWidth=function(){I=this.views.views;for(P=0;X=I[P];P++)f.set(X.headerNode,"display","block");B.apply(this,arguments);for(P=0;X=I[P];P++)f.set(X.headerNode,"display","none")};if(this._dojo14x){if("auto"!==this.rows&&"auto"!==this.columns)var Y=r.connect(y,"_onFetchComplete",this,function(){r.disconnect(Y);this.grid.set("autoHeight",
this._rows)});r.connect(y,"_onDelete",this,this._destroyItems);r.connect(y,"_clearData",this,this._destroyItems);r.connect(y,"destroy",this,this._destroyItems);(y=y.focus)&&y.findAndFocusGridCell&&(y.findAndFocusGridCell=function(){return!1})}},_setGridLayout:function(){var y=function(Y){return function(aa,Z){return this._cellGet(Y,aa,Z)}},B=u.hitch(this,this._cellFormatter),I=[],P=this._columns,X;for(X=0;X<P;X++)I.push({field:"cell"+X,get:u.hitch(this,y(X)),formatter:B});y={cells:[I]};this.grouping&&
(P={field:"groupName",colSpan:P,get:u.hitch(this,this._cellGetGroup),formatter:u.hitch(this,this._cellGroupFormatter)},y.cells.push([P]));P=this.grid;B=v.prototype.rowsPerPage;P.set("rowsPerPage",this._rows>B?this._rows:B);P.set("structure",y)},_setGridData:function(){var y=[];if(this.grouping){this._groupRowIndices=[];var B,I,P=this._columns;m.forEach(this._flItems,function(Y,aa){y.push({});aa=0===aa?0:B+I+1;this._groupRowIndices.push(aa);B=aa;I=Math.ceil(Y.length/P);y=y.concat(this._getStoreItems(Y))},
this)}else this.featureLayers?(m.forEach(this._flItems,function(Y){y=y.concat(Y)}),y=this._getStoreItems(y)):y=this._getStoreItems(this._itItems);var X=new t({data:{items:y}});this.grid.setStore(X)},_toggleTooltip:function(){if(this.showTooltip){if(!this.tooltip){this.tooltip=h.create("div",{"class":"esriMapTooltip"},this.domNode);this.tooltip.style.display="none";this.tooltip.style.position="fixed";var y=this.grid;this._mouseOverConnect=r.connect(y,"onCellMouseOver",this,this._cellMouseOver);this._mouseOutConnect=
r.connect(y,"onCellMouseOut",this,this._cellMouseOut)}}else this.tooltip&&(r.disconnect(this._mouseOverConnect),r.disconnect(this._mouseOutConnect),h.destroy(this.tooltip),this.tooltip=null)},_rowClicked:function(y,B){var I=y.cellNode,P=y.rowIndex;y=y.cellIndex;var X=this._getCellInfo(I,P,y);if(X){var Y=this.grid.store;if(!Y.getValue(X,"loadingCell")&&(this._selectedCell&&g.remove(this._selectedCell,"selectedItem"),I!==this._selectedCell?(g.add(I,"selectedItem"),this._selectedCell=I,this._selectedItem=
{featureLayer:Y.getValue(X,"layer"),type:Y.getValue(X,"type"),template:Y.getValue(X,"template"),symbolInfo:Y.getValue(X,"symbolInfo"),item:this._getItem(X)},this._selectedInfo={selRow:P,selCol:y,index1:Y.getValue(X,"index1"),index2:Y.getValue(X,"index2"),index:Y.getValue(X,"index")}):this._selectedCell=this._selectedInfo=this._selectedItem=null,!B))this.onSelectionChange()}},_locate:function(y,B,I){var P=this.grid.store,X=Array(this._columns),Y,aa=B.index1,Z=B.index2,fa=B.index,K=y.item;m.some(I,
function(R,U){return m.some(X,function(ba,Q){return(ba=P.getValue(R,"cell"+Q))&&(K?fa===P.getValue(ba,"index"):aa===P.getValue(ba,"index1")&&Z===P.getValue(ba,"index2"))?(Y=[U,Q],!0):!1})});return Y},_getCellInfo:function(y,B,I){if(y)return y=this.grid,B=y.getItem(B),y.store.getValue(B,"cell"+I)},_getItem:function(y){var B=this.items;if(B)return B[this.grid.store.getValue(y,"index")]},_cellMouseOver:function(y){var B=this.tooltip,I=y.cellNode,P=this._getCellInfo(I,y.rowIndex,y.cellIndex);if(B&&P){var X=
this.grid.store;y=X.getValue(P,"template");var Y=X.getValue(P,"type"),aa=X.getValue(P,"symbolInfo");X=X.getValue(P,"layer");y=(P=this._getItem(P))&&P.label+(P.description?": "+P.description:"")||y&&y.name+(y.description?": "+y.description:"")||Y&&Y.name||aa&&aa.label+(aa.description?": "+aa.description:"")||(X&&X.name+": ")+"Default";B.style.display="none";B.innerHTML=y;I=n.coords(I.firstChild);f.set(B,{left:I.x+"px",top:I.y+I.h+5+"px"});B.style.display=""}},_cellMouseOut:function(){var y=this.tooltip;
y&&(y.style.display="none")},_destroyItems:function(){var y=this._itemWidgets,B;for(B in y)y[B]&&(y[B].destroy(),delete y[B])},_repaintItems:function(){var y=this._itemWidgets,B;for(B in y){var I=y[B];I&&I._repaint(I._surface)}},_getStoreItems:function(y){var B=this._uniqueId;y=m.map(y,function(R){return u.mixin({surfaceId:"tpick-surface-"+B.id++},R)});for(var I=y.length,P=0,X={},Y=0,aa,Z=[],fa=!0,K=this._columns;P<I;)fa=!0,aa="cell"+Y,X[aa]=y[P],P++,Y++,0===Y%K&&(fa=!1,Z.push(X),X={},Y=0);fa&&I&&
Z.push(X);return Z},_getItemsFromLayers:function(y){var B=[];m.forEach(y,function(I,P){B.push(this._getItemsFromLayer(I,P))},this);return B},_getItemsFromLayer:function(y,B){var I=[];if(this.useLegend&&-1<m.indexOf(this._loadingIndices,B))return[{label:this._nls&&this._nls.loading||"",symbol:null,layer:y,type:null,template:null,index1:B,index2:0,loadingCell:1}];var P=[];P=P.concat(y.templates);m.forEach(y.types,function(Z){var fa=Z.templates;m.forEach(fa,function(K){K._type_=Z});P=P.concat(fa)});
P=m.filter(P,L.isDefined);var X=y.renderer;if(X){var Y=X.declaredClass.replace("esri.renderer.","");if(0<P.length)m.forEach(P,function(Z){var fa=Z.prototype;if(fa){var K;if(K=this._isUnclassedRenderer(X)?X.infos[0].symbol:X.valueExpression?this._createSimpleSymbol(y):X.getSymbol(fa)||this._createSimpleSymbol(y)){var R=null,U;if(!(9>e("ie"))&&Z.thumbnail&&Z.thumbnail.imageData)R=new A(Z.thumbnail);else if(this.useLegend&&-1<m.indexOf(this._legendIndices,B)){if(U=this._legendSymbols&&this._legendSymbols[B])switch(Y){case "SimpleRenderer":R=
U.defaultSymbol;break;case "UniqueValueRenderer":m.some(X.infos,function(ba){ba.symbol===K&&(R=U[ba.value]);return!!R});break;case "ClassBreaksRenderer":m.some(X.infos,function(ba){ba.symbol===K&&(R=U[ba.maxValue]);return!!R})}R&&(fa=k.fromJson(k.toJson(A.defaultProps)),fa.url=R.url,fa.imageData=R.imageData,fa.contentType=R.contentType,fa.width=R.width,fa.height=R.height,L.isDefined(fa.width)&&L.isDefined(fa.height)||(fa.width=15,fa.height=15),R=new A(fa))}I.push({label:this._trimLabel(Z.name),symbol:R||
K,legendOverride:!!R,layer:y,type:Z._type_,template:Z,index1:B,index2:I.length})}else switch(Y){case "HeatmapRenderer":I.push({label:this._trimLabel(Z.name),symbol:new H,legendOverride:!!R,layer:y,type:Z._type_,template:Z,index1:B,index2:I.length})}}delete Z._type_},this);else{var aa=[];"TemporalRenderer"===Y&&(X=X.observationRenderer)&&(Y=X.declaredClass.replace("esri.renderer.",""));switch(Y){case "SimpleRenderer":aa=[{symbol:X.symbol,label:X.label,description:X.description}];break;case "UniqueValueRenderer":case "ClassBreaksRenderer":aa=
X.infos}I=m.map(aa,function(Z,fa){return{label:this._trimLabel(Z.label),description:Z.description,symbolInfo:u.mixin({constructor:function(){}},Z),symbol:Z.symbol,layer:y,index1:B,index2:fa}},this)}}return I},_isUnclassedRenderer:function(y){return!!((y.hasVisualVariables("sizeInfo",!1)||y.hasVisualVariables("colorInfo",!1)||y.hasVisualVariables("opacityInfo",!1))&&y.addBreak&&y.infos&&1===y.infos.length)},_createSimpleSymbol:function(y){switch(y.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":var B=
new H;break;case "esriGeometryPolyline":B=new E;break;case "esriGeometryPolygon":B=new z;break;default:y.hasXYFootprint&&y.hasXYFootprint()&&(B=new z)}return B},_getItemsFromItems:function(y){return m.map(y,function(B,I){B=u.mixin({index:I},B);B.label=this._trimLabel(B.label);return B},this)},_trimLabel:function(y){var B=this.maxLabelLength;B&&y&&y.length>B&&(y=y.substr(0,B)+"...");return y||""},_cellGet:function(y,B,I){return I?this.grid.store.getValue(I,"cell"+y):""},_cellFormatter:function(y){if(y){var B=
this._itemWidgets,I=this.grid.store,P=I.getValue(y,"surfaceId"),X=B[P];X||(X=B[P]=new J({id:P,label:I.getValue(y,"label"),symbol:I.getValue(y,"symbol"),legendOverride:I.getValue(y,"legendOverride"),surfaceWidth:this.surfaceWidth,surfaceHeight:this.surfaceHeight,template:I.getValue(y,"template")}));return X||""}return""},_cellGetGroup:function(y,B){if(!this._groupRowIndices)return"";y=m.indexOf(this._groupRowIndices,y);return B&&-1!==y?(B=this.featureLayers[y])&&(this.groupLabelFunction?this.groupLabelFunction(B):
B.name)||"":""},_cellGroupFormatter:function(y){return y?"\x3cdiv class\x3d'groupLabel'\x3e"+y+"\x3c/div\x3e":""}});a("extend-esri")&&u.setObject("dijit.editing.TemplatePicker",T,D);return T})},"dojox/grid/DataGrid":function(){define("../main dojo/_base/array dojo/_base/lang dojo/_base/json dojo/_base/sniff dojo/_base/declare ./_Grid ./DataSelection dojo/_base/html dojo/has dojo/has!dojo-bidi?./bidi/_BidiMixin".split(" "),function(G,u,r,n,m,k,d,a,b){var e=k("dojox.grid.DataGrid",d,{store:null,query:null,
queryOptions:null,fetchText:"...",sortFields:null,updateDelay:1,items:null,_store_connects:null,_by_idty:null,_by_idx:null,_cache:null,_pages:null,_pending_requests:null,_bop:-1,_eop:-1,_requests:0,rowCount:0,_isLoaded:!1,_isLoading:!1,keepSelection:!1,postCreate:function(){this._pages=[];this._store_connects=[];this._by_idty={};this._by_idx=[];this._cache=[];this._pending_requests={};this._setStore(this.store);this.inherited(arguments)},destroy:function(){this.selection.destroy();this.inherited(arguments)},
createSelection:function(){this.selection=new a(this)},get:function(g,h){if(h&&"_item"==this.field&&!this.fields)return h;if(h&&this.fields){var c=[],f=this.grid.store;u.forEach(this.fields,function(l){c=c.concat(f.getValues(h,l))});return c}return h||"string"!==typeof g?h?this.field?"_item"==this.field?h:this.grid.store.getValue(h,this.field):this.value:this.defaultValue:this.inherited(arguments)},_checkUpdateStatus:function(){if(0<this.updateDelay){var g=!1;this._endUpdateDelay&&(clearTimeout(this._endUpdateDelay),
delete this._endUpdateDelay,g=!0);this.updating||(this.beginUpdate(),g=!0);if(g){var h=this;this._endUpdateDelay=setTimeout(function(){delete h._endUpdateDelay;h.endUpdate()},this.updateDelay)}}},_onSet:function(g,h,c,f){this._checkUpdateStatus();g=this.getItemIndex(g);-1<g&&this.updateRow(g)},_createItem:function(g,h){h=this._hasIdentity?this.store.getIdentity(g):n.toJson(this.query)+":idx:"+h+":sort:"+n.toJson(this.getSortProps());return this._by_idty[h]={idty:h,item:g}},_addItem:function(g,h,c){this._by_idx[h]=
this._createItem(g,h);c||this.updateRow(h)},_onNew:function(g,h){this._checkUpdateStatus();h=this.get("rowCount");this._addingItem=!0;this.updateRowCount(h+1);this._addingItem=!1;this._addItem(g,h);this.showMessage()},_onDelete:function(g){this._checkUpdateStatus();g=this._getItemIndex(g,!0);if(0<=g){this._pages=[];this._eop=this._bop=-1;var h=this._by_idx[g];this._by_idx.splice(g,1);delete this._by_idty[h.idty];this.updateRowCount(this.get("rowCount")-1);0===this.get("rowCount")&&this.showMessage(this.noDataMessage)}this.selection.isSelected(g)&&
(this.selection.deselect(g),this.selection.selected.splice(g,1))},_onRevert:function(){this._refresh()},setStore:function(g,h,c){this._requestsPending(0)||(this._setQuery(h,c),this._setStore(g),this._refresh(!0))},setQuery:function(g,h){this._requestsPending(0)||(this._setQuery(g,h),this._refresh(!0))},setItems:function(g){this.items=g;this._setStore(this.store);this._refresh(!0)},_setQuery:function(g,h){this.query=g;this.queryOptions=h||this.queryOptions},_setStore:function(g){this.store&&this._store_connects&&
u.forEach(this._store_connects,this.disconnect,this);if(this.store=g){g=this.store.getFeatures();var h=[];this._canEdit=!!g["dojo.data.api.Write"]&&!!g["dojo.data.api.Identity"];this._hasIdentity=!!g["dojo.data.api.Identity"];g["dojo.data.api.Notification"]&&!this.items&&(h.push(this.connect(this.store,"onSet","_onSet")),h.push(this.connect(this.store,"onNew","_onNew")),h.push(this.connect(this.store,"onDelete","_onDelete")));this._canEdit&&h.push(this.connect(this.store,"revert","_onRevert"));this._store_connects=
h}},_onFetchBegin:function(g,h){this.scroller&&(this.rowCount!=g&&(h.isRender?(this.scroller.init(g,this.keepRows,this.rowsPerPage),this.rowCount=g,this._setAutoHeightAttr(this.autoHeight,!0),this._skipRowRenormalize=!0,this.prerender(),this._skipRowRenormalize=!1):this.updateRowCount(g)),g?this.showMessage():(this.views.render(),this._resize(),this.showMessage(this.noDataMessage),this.focus.initFocusView()))},_onFetchComplete:function(g,h){this.scroller&&(g&&0<g.length&&(u.forEach(g,function(c,f){this._addItem(c,
h.start+f,!0)},this),this.updateRows(h.start,g.length),h.isRender?(this.setScrollTop(0),this.postrender()):this._lastScrollTop&&this.setScrollTop(this._lastScrollTop),m("ie")&&b.setSelectable(this.domNode,this.selectable)),delete this._lastScrollTop,this._isLoaded||(this._isLoading=!1,this._isLoaded=!0),this._pending_requests[h.start]=!1)},_onFetchError:function(g,h){console.log(g);delete this._lastScrollTop;this._isLoaded||(this._isLoading=!1,this._isLoaded=!0,this.showMessage(this.errorMessage));
this._pending_requests[h.start]=!1;this.onFetchError(g,h)},onFetchError:function(g,h){},_fetch:function(g,h){g=g||0;if(this.store&&!this._pending_requests[g]){this._isLoaded||this._isLoading||(this._isLoading=!0,this.showMessage(this.loadingMessage));this._pending_requests[g]=!0;try{if(this.items){var c=this.items,f=this.store;this.rowsPerPage=c.length;var l={start:g,count:this.rowsPerPage,isRender:h};this._onFetchBegin(c.length,l);var q=0;u.forEach(c,function(v){f.isItemLoaded(v)||q++});if(0===q)this._onFetchComplete(c,
l);else{var t=function(v){q--;0===q&&this._onFetchComplete(c,l)};u.forEach(c,function(v){f.isItemLoaded(v)||f.loadItem({item:v,onItem:t,scope:this})},this)}}else this.store.fetch({start:g,count:this.rowsPerPage,query:this.query,sort:this.getSortProps(),queryOptions:this.queryOptions,isRender:h,onBegin:r.hitch(this,"_onFetchBegin"),onComplete:r.hitch(this,"_onFetchComplete"),onError:r.hitch(this,"_onFetchError")})}catch(v){this._onFetchError(v,{start:g,count:this.rowsPerPage})}}},_clearData:function(){this.updateRowCount(0);
this._by_idty={};this._by_idx=[];this._pages=[];this._bop=this._eop=-1;this._isLoading=this._isLoaded=!1},getItem:function(g){var h=this._by_idx[g];return!h||h&&!h.item?(this._preparePage(g),null):h.item},getItemIndex:function(g){return this._getItemIndex(g,!1)},_getItemIndex:function(g,h){if(!h&&!this.store.isItem(g))return-1;h=this._hasIdentity?this.store.getIdentity(g):null;for(var c=0,f=this._by_idx.length;c<f;c++){var l=this._by_idx[c];if(l&&(h&&l.idty==h||l.item===g))return c}return-1},filter:function(g,
h){this.query=g;h&&this._clearData();this._fetch()},_getItemAttr:function(g,h){return(g=this.getItem(g))?this.store.getValue(g,h):this.fetchText},_render:function(){this.domNode.parentNode&&(this.scroller.init(this.get("rowCount"),this.keepRows,this.rowsPerPage),this.prerender(),this._fetch(0,!0))},_requestsPending:function(g){return this._pending_requests[g]},_rowToPage:function(g){return this.rowsPerPage?Math.floor(g/this.rowsPerPage):g},_pageToRow:function(g){return this.rowsPerPage?this.rowsPerPage*
g:g},_preparePage:function(g){(g<this._bop||g>=this._eop)&&!this._addingItem&&(g=this._rowToPage(g),this._needPage(g),this._bop=g*this.rowsPerPage,this._eop=this._bop+(this.rowsPerPage||this.get("rowCount")))},_needPage:function(g){this._pages[g]||(this._pages[g]=!0,this._requestPage(g))},_requestPage:function(g){g=this._pageToRow(g);0<Math.min(this.rowsPerPage,this.get("rowCount")-g)&&(this._requests++,this._requestsPending(g)||setTimeout(r.hitch(this,"_fetch",g,!1),1))},getCellName:function(g){return g.field},
_refresh:function(g){this._clearData();this._fetch(0,g)},sort:function(){this.edit.apply();this._lastScrollTop=this.scrollTop;this._refresh()},canSort:function(){return!this._isLoading},getSortProps:function(){var g=this.getCell(this.getSortIndex());if(g){var h=g.sortDesc,c=!(0<this.sortInfo);return[{attribute:g.field,descending:"undefined"==typeof h?c:c?!h:h}]}return this.sortFields?this.sortFields:null},styleRowState:function(g){if(this.store&&this.store.getState){for(var h=this.store.getState(g.index),
c="",f=0,l=["inflight","error","inserting"],q;q=l[f];f++)if(h[q]){c=" dojoxGridRow-"+q;break}g.customClasses+=c}},onStyleRow:function(g){this.styleRowState(g);this.inherited(arguments)},canEdit:function(g,h){return this._canEdit},_copyAttr:function(g,h){g=this.getItem(g);return this.store.getValue(g,h)},doStartEdit:function(g,h){this._cache[h]||(this._cache[h]=this._copyAttr(h,g.field));this.onStartEdit(g,h)},doApplyCellEdit:function(g,h,c){this.store.fetchItemByIdentity({identity:this._by_idx[h].idty,
onItem:r.hitch(this,function(f){var l=this.store.getValue(f,c);"number"==typeof l?g=isNaN(g)?g:parseFloat(g):"boolean"==typeof l?g="true"==g?!0:"false"==g?!1:g:l instanceof Date&&(l=new Date(g),g=isNaN(l.getTime())?g:l);this.store.setValue(f,c,g);this.onApplyCellEdit(g,h,c)})})},doCancelEdit:function(g){this._cache[g]&&(this.updateRow(g),delete this._cache[g]);this.onCancelEdit.apply(this,arguments)},doApplyEdit:function(g,h){this.onApplyEdit(g)},removeSelectedRows:function(){if(this._canEdit){this.edit.apply();
var g=r.hitch(this,function(h){h.length&&(u.forEach(h,this.store.deleteItem,this.store),this.selection.clear())});this.allItemsSelected?this.store.fetch({query:this.query,queryOptions:this.queryOptions,onComplete:g}):g(this.selection.getSelected())}}});e.cell_markupFactory=function(g,h,c){var f=r.trim(b.attr(h,"field")||"");f&&(c.field=f);c.field=c.field||c.name;if(f=r.trim(b.attr(h,"fields")||""))c.fields=f.split(",");g&&g(h,c)};e.markupFactory=function(g,h,c,f){return d.markupFactory(g,h,c,r.partial(e.cell_markupFactory,
f))};return e})},"dojox/grid/_Grid":function(){define("dojo/_base/kernel ../main dojo/_base/declare ./_Events ./_Scroller ./_Layout ./_View ./_ViewManager ./_RowManager ./_FocusManager ./_EditManager ./Selection ./_RowSelector ./util dijit/_Widget dijit/_TemplatedMixin dijit/CheckedMenuItem dojo/text!./resources/_Grid.html dojo/string dojo/_base/array dojo/_base/lang dojo/_base/sniff dojox/html/metrics dojo/_base/html dojo/query dojo/dnd/common dojo/i18n!dijit/nls/loading".split(" "),function(G,u,
r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z,E,J){G.isCopyKey||(G.isCopyKey=G.dnd.getCopyKeyState);r=r("dojox.grid._Grid",[l,q,n],{templateString:v,classTag:"dojoxGrid",rowCount:5,keepRows:75,rowsPerPage:25,autoWidth:!1,initialWidth:"",autoHeight:"",rowHeight:0,autoRender:!0,defaultHeight:"15em",height:"",structure:null,elasticView:-1,singleClickEdit:!1,selectionMode:"extended",rowSelector:"",columnReordering:!1,headerMenu:null,placeholderLabel:"GridColumns",selectable:!1,_click:null,loadingMessage:"\x3cspan class\x3d'dojoxGridLoading'\x3e${loadingState}\x3c/span\x3e",
errorMessage:"\x3cspan class\x3d'dojoxGridError'\x3e${errorState}\x3c/span\x3e",noDataMessage:"",escapeHTMLInData:!0,formatterScope:null,editable:!1,summary:"",_setSummaryAttr:"domNode",sortInfo:0,_placeholders:null,_layoutClass:k,buildRendering:function(){this.inherited(arguments);this.domNode.getAttribute("tabIndex")||(this.domNode.tabIndex="0");this.createScroller();this.createLayout();this.createViews();this.createManagers();this.createSelection();this.connect(this.selection,"onSelected","onSelected");
this.connect(this.selection,"onDeselected","onDeselected");this.connect(this.selection,"onChanged","onSelectionChanged");z.initOnFontResize();this.connect(z,"onFontResize","textSizeChanged");f.funnelEvents(this.domNode,this,"doKeyEvent",f.keyEvents);"none"!=this.selectionMode&&this.domNode.setAttribute("aria-multiselectable","single"==this.selectionMode?"false":"true");E.addClass(this.domNode,this.classTag);this.isLeftToRight()||E.addClass(this.domNode,this.classTag+"Rtl");0<this.rowHeight&&E.addClass(this.viewsNode,
this.classTag+"FixedRowHeight")},postMixInProperties:function(){this.inherited(arguments);var D=G.i18n.getLocalization("dijit","loading",this.lang);this.loadingMessage=w.substitute(this.loadingMessage,D);this.errorMessage=w.substitute(this.errorMessage,D);this.srcNodeRef&&this.srcNodeRef.style.height&&(this.height=this.srcNodeRef.style.height);this._setAutoHeightAttr(this.autoHeight,!0);this.lastScrollTop=this.scrollTop=0},postCreate:function(){this._placeholders=[];this._setHeaderMenuAttr(this.headerMenu);
this._setStructureAttr(this.structure);this._click=[];this.inherited(arguments);this.domNode&&this.autoWidth&&this.initialWidth&&(this.domNode.style.width=this.initialWidth);this.domNode&&!this.editable&&E.attr(this.domNode,"aria-readonly","true")},destroy:function(){this.domNode.onReveal=null;this.domNode.onSizeChange=null;delete this._click;this.scroller&&(this.scroller.destroy(),delete this.scroller);this.edit.destroy();delete this.edit;this.views.destroyViews();this.focus&&(this.focus.destroy(),
delete this.focus);this.headerMenu&&this._placeholders.length&&(x.forEach(this._placeholders,function(D){D.unReplace(!0)}),this.headerMenu.unBindDomNode(this.viewsHeaderNode));this.inherited(arguments)},_setAutoHeightAttr:function(D,L){"string"==typeof D&&(D=D&&"false"!=D?"true"==D?!0:window.parseInt(D,10):!1);"number"==typeof D&&(isNaN(D)&&(D=!1),0>D?D=!0:0===D&&(D=!1));this.autoHeight=D;this._autoHeight="boolean"==typeof D?D:"number"==typeof D?D>=this.get("rowCount"):!1;this._started&&!L&&this.render()},
_getRowCountAttr:function(){return this.updating&&this.invalidated&&void 0!=this.invalidated.rowCount?this.invalidated.rowCount:this.rowCount},textSizeChanged:function(){this.render()},sizeChange:function(){this.update()},createManagers:function(){this.rows=new b(this);this.focus=new e(this);this.edit=new g(this)},createSelection:function(){this.selection=new h(this)},createScroller:function(){this.scroller=new m;this.scroller.grid=this;this.scroller.renderRow=H.hitch(this,"renderRow");this.scroller.removeRow=
H.hitch(this,"rowRemoved")},createLayout:function(){this.layout=new this._layoutClass(this);this.connect(this.layout,"moveColumn","onMoveColumn")},onMoveColumn:function(){this.update()},onResizeColumn:function(D){},createViews:function(){this.views=new a(this);this.views.createView=H.hitch(this,"createView")},createView:function(D,L){D=new (H.getObject(D))({grid:this,index:L});this.viewsNode.appendChild(D.domNode);this.viewsHeaderNode.appendChild(D.headerNode);this.views.addView(D);E.attr(this.domNode,
"align",this.isLeftToRight()?"left":"right");return D},buildViews:function(){for(var D=0,L;L=this.layout.structure[D];D++)this.createView(L.type||u._scopeName+".grid._View",D).setStructure(L);this.scroller.setContentNodes(this.views.getContentNodes())},_setStructureAttr:function(D){D&&H.isString(D)&&(G.deprecated("dojox.grid._Grid.set('structure', 'objVar')","use dojox.grid._Grid.set('structure', objVar) instead","2.0"),D=H.getObject(D));this.structure=D;if(!D)if(this.layout.structure)D=this.layout.structure;
else return;this.views.destroyViews();this.focus.focusView=null;D!==this.layout.structure&&this.layout.setStructure(D);this._structureChanged()},setStructure:function(D){G.deprecated("dojox.grid._Grid.setStructure(obj)","use dojox.grid._Grid.set('structure', obj) instead.","2.0");this._setStructureAttr(D)},getColumnTogglingItems:function(){var D=[];var L=x.map(this.layout.cells,function(C){C.menuItems||(C.menuItems=[]);var N=this,S=new t({label:C.name,checked:!C.hidden,_gridCell:C,onChange:function(F){if(N.layout.setColumnVisibility(this._gridCell.index,
F)){var T=this._gridCell.menuItems;1<T.length&&x.forEach(T,function(y){y!==this&&y.setAttribute("checked",F)},this);F=x.filter(N.layout.cells,function(y){1<y.menuItems.length?x.forEach(y.menuItems,"item.set('disabled', false);"):y.menuItems[0].set("disabled",!1);return!y.hidden});1==F.length&&x.forEach(F[0].menuItems,"item.set('disabled', true);")}},destroy:function(){var F=x.indexOf(this._gridCell.menuItems,this);this._gridCell.menuItems.splice(F,1);delete this._gridCell;t.prototype.destroy.apply(this,
arguments)}});C.menuItems.push(S);C.hidden||D.push(S);return S},this);1==D.length&&D[0].set("disabled",!0);return L},_setHeaderMenuAttr:function(D){this._placeholders&&this._placeholders.length&&(x.forEach(this._placeholders,function(L){L.unReplace(!0)}),this._placeholders=[]);this.headerMenu&&this.headerMenu.unBindDomNode(this.viewsHeaderNode);if(this.headerMenu=D)this.headerMenu.bindDomNode(this.viewsHeaderNode),this.headerMenu.getPlaceholders&&(this._placeholders=this.headerMenu.getPlaceholders(this.placeholderLabel))},
setHeaderMenu:function(D){G.deprecated("dojox.grid._Grid.setHeaderMenu(obj)","use dojox.grid._Grid.set('headerMenu', obj) instead.","2.0");this._setHeaderMenuAttr(D)},setupHeaderMenu:function(){this._placeholders&&this._placeholders.length&&x.forEach(this._placeholders,function(D){D._replaced&&D.unReplace(!0);D.replace(this.getColumnTogglingItems())},this)},_fetch:function(D){this.setScrollTop(0)},getItem:function(D){return null},showMessage:function(D){D?(this.messagesNode.innerHTML=D,this.messagesNode.style.display=
""):(this.messagesNode.innerHTML="",this.messagesNode.style.display="none")},_structureChanged:function(){this.buildViews();this.autoRender&&this._started&&this.render()},hasLayout:function(){return this.layout.cells.length},resize:function(D,L){this._pendingChangeSize=D;this._pendingResultSize=L;this.sizeChange()},_getPadBorder:function(){return this._padBorder=this._padBorder||E._getPadBorderExtents(this.domNode)},_getHeaderHeight:function(){var D=this.viewsHeaderNode.style,L="none"==D.display?
0:this.views.measureHeader();D.height=L+"px";this.views.normalizeHeaderNodeHeight();return L},_resize:function(D,L){D=D||this._pendingChangeSize;L=L||this._pendingResultSize;delete this._pendingChangeSize;delete this._pendingResultSize;if(this.domNode){var C=this.domNode.parentNode;if(C&&1==C.nodeType&&this.hasLayout()&&"hidden"!=C.style.visibility&&"none"!=C.style.display){var N=this._getPadBorder(),S=void 0;if(this._autoHeight)this.domNode.style.height="auto";else if("number"==typeof this.autoHeight){var F=
S=this._getHeaderHeight();F+=this.scroller.averageRowHeight*this.autoHeight;this.domNode.style.height=F+"px"}else this.domNode.clientHeight<=N.h&&(C==document.body?this.domNode.style.height=this.defaultHeight:this.height?this.domNode.style.height=this.height:this.fitTo="parent");L&&(D=L);!this._autoHeight&&D?(E.marginBox(this.domNode,D),this.height=this.domNode.style.height,delete this.fitTo):"parent"==this.fitTo&&(F=this._parentContentBoxHeight=0<this._parentContentBoxHeight?this._parentContentBoxHeight:
E._getContentBox(C).h,this.domNode.style.height=Math.max(0,F)+"px");D=x.some(this.views.views,function(T){return T.flexCells});this._autoHeight||0!==(F||E._getContentBox(this.domNode).h)?(this.viewsHeaderNode.style.display="block",D||void 0!==S||(S=this._getHeaderHeight())):this.viewsHeaderNode.style.display="none";D&&(S=void 0);this.adaptWidth();this.adaptHeight(S);this.postresize()}}},adaptWidth:function(){var D=!this.initialWidth&&this.autoWidth,L=D?0:this.domNode.clientWidth||this.domNode.offsetWidth-
this._getPadBorder().w;L=this.views.arrange(1,L);this.views.onEach("adaptWidth");D&&(this.domNode.style.width=L+"px")},adaptHeight:function(D){D=void 0===D?this._getHeaderHeight():D;var L=this._autoHeight?-1:Math.max(this.domNode.clientHeight-D,0)||0;this.views.onEach("setSize",[0,L]);this.views.onEach("adaptHeight");if(!this._autoHeight){var C=0,N=0,S=x.filter(this.views.views,function(F){(F=F.hasHScrollbar())?C++:N++;return!F});0<C&&0<N&&x.forEach(S,function(F){F.adaptHeight(!0)})}!0===this.autoHeight||
-1!=L||"number"==typeof this.autoHeight&&this.autoHeight>=this.get("rowCount")?this.scroller.windowHeight=L:this.scroller.windowHeight=Math.max(this.domNode.clientHeight-D,0)},startup:function(){this._started||(this.inherited(arguments),this.autoRender&&this.render())},render:function(){this.domNode&&this._started&&(this.hasLayout()?(this.update=this.defaultUpdate,this._render()):this.scroller.init(0,this.keepRows,this.rowsPerPage))},_render:function(){this.scroller.init(this.get("rowCount"),this.keepRows,
this.rowsPerPage);this.prerender();this.setScrollTop(0);this.postrender()},prerender:function(){this.keepRows=this._autoHeight?0:this.keepRows;this.scroller.setKeepInfo(this.keepRows);this.views.render();this._resize()},postrender:function(){this.postresize();this.focus.initFocusView();E.setSelectable(this.domNode,this.selectable)},postresize:function(){if(this._autoHeight){var D=Math.max(this.views.measureContent())+"px";this.viewsNode.style.height=D}},renderRow:function(D,L){this.views.renderRow(D,
L,this._skipRowRenormalize)},rowRemoved:function(D){this.views.rowRemoved(D)},invalidated:null,updating:!1,beginUpdate:function(){this.invalidated=[];this.updating=!0},endUpdate:function(){this.updating=!1;var D=this.invalidated,L;if(D.all)this.update();else if(void 0!=D.rowCount)this.updateRowCount(D.rowCount);else for(L in D)this.updateRow(Number(L));this.invalidated=[]},defaultUpdate:function(){this.domNode&&(this.updating?this.invalidated.all=!0:(this.lastScrollTop=this.scrollTop,this.prerender(),
this.scroller.invalidateNodes(),this.setScrollTop(this.lastScrollTop),this.postrender()))},update:function(){this.render()},updateRow:function(D){D=Number(D);this.updating?this.invalidated[D]=!0:(this.views.updateRow(D),this.scroller.rowHeightChanged(D))},updateRows:function(D,L){D=Number(D);L=Number(L);var C;if(this.updating)for(C=0;C<L;C++)this.invalidated[C+D]=!0;else{for(C=0;C<L;C++)this.views.updateRow(C+D,this._skipRowRenormalize);this.scroller.rowHeightChanged(D)}},updateRowCount:function(D){this.updating?
this.invalidated.rowCount=D:(this.rowCount=D,this._setAutoHeightAttr(this.autoHeight,!0),this.layout.cells.length&&this.scroller.updateRowCount(D),this.layout.cells.length&&this.setScrollTop(this.scrollTop),this._resize())},updateRowStyles:function(D){this.views.updateRowStyles(D)},getRowNode:function(D){if(!this.focus.focusView||this.focus.focusView instanceof c)for(var L=0,C;C=this.views.views[L];L++){if(!(C instanceof c))return C.rowNodes[D]}else return this.focus.focusView.rowNodes[D];return null},
rowHeightChanged:function(D){this.views.renormalizeRow(D);this.scroller.rowHeightChanged(D)},fastScroll:!0,delayScroll:!1,scrollRedrawThreshold:A("ie")?100:50,scrollTo:function(D){if(this.fastScroll){var L=Math.abs(this.lastScrollTop-D);this.lastScrollTop=D;if(L>this.scrollRedrawThreshold||this.delayScroll){this.delayScroll=!0;this.scrollTop=D;this.views.setScrollTop(D);this._pendingScroll&&window.clearTimeout(this._pendingScroll);var C=this;this._pendingScroll=window.setTimeout(function(){delete C._pendingScroll;
C.finishScrollJob()},200)}else this.setScrollTop(D)}else this.setScrollTop(D)},finishScrollJob:function(){this.delayScroll=!1;this.setScrollTop(this.scrollTop)},setScrollTop:function(D){this.scroller.scroll(this.views.setScrollTop(D))},scrollToRow:function(D){this.setScrollTop(this.scroller.findScrollTop(D)+1)},styleRowNode:function(D,L){L&&this.rows.styleRowNode(D,L)},_mouseOut:function(D){this.rows.setOverRow(-2)},getCell:function(D){return this.layout.cells[D]},setCellWidth:function(D,L){this.getCell(D).unitWidth=
L},getCellName:function(D){return"Cell "+D.index},canSort:function(D){},sort:function(){},getSortAsc:function(D){D=void 0==D?this.sortInfo:D;return 0<D},getSortIndex:function(D){D=void 0==D?this.sortInfo:D;return Math.abs(D)-1},setSortIndex:function(D,L){var C=D+1;void 0!=L?C*=L?1:-1:this.getSortIndex()==D&&(C=-this.sortInfo);this.setSortInfo(C)},setSortInfo:function(D){this.canSort(D)&&(this.sortInfo=D,this.sort(),this.update())},doKeyEvent:function(D){D.dispatch="do"+D.type;this.onKeyEvent(D)},
_dispatch:function(D,L){return D in this?this[D](L):!1},dispatchKeyEvent:function(D){this._dispatch(D.dispatch,D)},dispatchContentEvent:function(D){this.edit.dispatchEvent(D)||D.sourceView.dispatchContentEvent(D)||this._dispatch(D.dispatch,D)},dispatchHeaderEvent:function(D){D.sourceView.dispatchHeaderEvent(D)||this._dispatch("doheader"+D.type,D)},dokeydown:function(D){this.onKeyDown(D)},doclick:function(D){if(D.cellNode)this.onCellClick(D);else this.onRowClick(D)},dodblclick:function(D){if(D.cellNode)this.onCellDblClick(D);
else this.onRowDblClick(D)},docontextmenu:function(D){if(D.cellNode)this.onCellContextMenu(D);else this.onRowContextMenu(D)},doheaderclick:function(D){if(D.cellNode)this.onHeaderCellClick(D);else this.onHeaderClick(D)},doheaderdblclick:function(D){if(D.cellNode)this.onHeaderCellDblClick(D);else this.onHeaderDblClick(D)},doheadercontextmenu:function(D){if(D.cellNode)this.onHeaderCellContextMenu(D);else this.onHeaderContextMenu(D)},doStartEdit:function(D,L){this.onStartEdit(D,L)},doApplyCellEdit:function(D,
L,C){this.onApplyCellEdit(D,L,C)},doCancelEdit:function(D){this.onCancelEdit(D)},doApplyEdit:function(D){this.onApplyEdit(D)},addRow:function(){this.updateRowCount(this.get("rowCount")+1)},removeSelectedRows:function(){this.allItemsSelected?this.updateRowCount(0):this.updateRowCount(Math.max(0,this.get("rowCount")-this.selection.getSelected().length));this.selection.clear()}});r.markupFactory=function(D,L,C,N){var S=function(F){F=E.attr(F,"width")||"auto";"auto"!=F&&"em"!=F.slice(-2)&&"%"!=F.slice(-1)&&
(F=parseInt(F,10)+"px");return F};D.structure||"table"!=L.nodeName.toLowerCase()||(D.structure=J("\x3e colgroup",L).map(function(F){var T=E.attr(F,"span");T={noscroll:"true"==E.attr(F,"noscroll")?!0:!1,__span:T?parseInt(T,10):1,cells:[]};E.hasAttr(F,"width")&&(T.width=S(F));return T}),D.structure.length||D.structure.push({__span:Infinity,cells:[]}),J("thead \x3e tr",L).forEach(function(F,T){var y=0,B=0,I,P=null;J("\x3e th",F).map(function(X){P?y>=I+P.__span&&(B++,I+=P.__span,P=D.structure[B]):(I=
0,P=D.structure[0]);var Y={name:H.trim(E.attr(X,"name")||X.innerHTML),colSpan:parseInt(E.attr(X,"colspan")||1,10),type:H.trim(E.attr(X,"cellType")||""),id:H.trim(E.attr(X,"id")||"")};y+=Y.colSpan;var aa=E.attr(X,"rowspan");aa&&(Y.rowSpan=aa);E.hasAttr(X,"width")&&(Y.width=S(X));E.hasAttr(X,"relWidth")&&(Y.relWidth=window.parseInt(E.attr(X,"relWidth"),10));E.hasAttr(X,"hidden")&&(Y.hidden="true"==E.attr(X,"hidden")||!0===E.attr(X,"hidden"));N&&N(X,Y);Y.type=Y.type?H.getObject(Y.type):u.grid.cells.Cell;
Y.type&&Y.type.markupFactory&&Y.type.markupFactory(X,Y);P.cells[T]||(P.cells[T]=[]);P.cells[T].push(Y)})}));return new C(D,L)};return r})},"dojox/grid/_Events":function(){define(["dojo/keys","dojo/dom-class","dojo/_base/declare","dojo/_base/event","dojo/_base/sniff"],function(G,u,r,n,m){return r("dojox.grid._Events",null,{cellOverClass:"dojoxGridCellOver",onKeyEvent:function(k){this.dispatchKeyEvent(k)},onContentEvent:function(k){this.dispatchContentEvent(k)},onHeaderEvent:function(k){this.dispatchHeaderEvent(k)},
onStyleRow:function(k){k.customClasses+=(k.odd?" dojoxGridRowOdd":"")+(k.selected?" dojoxGridRowSelected":"")+(k.over?" dojoxGridRowOver":"");this.focus.styleRow(k);this.edit.styleRow(k)},onKeyDown:function(k){if(!k.altKey&&!k.metaKey)switch(k.keyCode){case G.ESCAPE:this.edit.cancel();break;case G.ENTER:if(!this.edit.isEditing()){var d=this.focus.getHeaderIndex();if(0<=d){this.setSortIndex(d);break}else this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(k),k.shiftKey);n.stop(k)}k.shiftKey||
(d=this.edit.isEditing(),this.edit.apply(),d||this.edit.setEditCell(this.focus.cell,this.focus.rowIndex));this.edit.isEditing()||((this.focus.focusView||this.views.views[0]).content.decorateEvent(k),this.onRowClick(k),n.stop(k));break;case G.SPACE:this.edit.isEditing()||(d=this.focus.getHeaderIndex(),0<=d?this.setSortIndex(d):(this.selection.clickSelect(this.focus.rowIndex,dojo.isCopyKey(k),k.shiftKey),this.focus._focusifyCellNode(!0),this.focus.setFocusCell(this.focus.cell,this.focus.rowIndex),n.stop(k)));
break;case G.TAB:this.focus[k.shiftKey?"previousKey":"nextKey"](k);break;case G.LEFT_ARROW:case G.RIGHT_ARROW:if(!this.edit.isEditing()){var a=k.keyCode;n.stop(k);d=this.focus.getHeaderIndex();0<=d&&k.shiftKey&&k.ctrlKey?this.focus.colSizeAdjust(k,d,5*(a==G.LEFT_ARROW?-1:1)):(k=a==G.LEFT_ARROW?1:-1,this.isLeftToRight()&&(k*=-1),this.focus.move(0,k))}break;case G.UP_ARROW:this.edit.isEditing()||0===this.focus.rowIndex||(n.stop(k),this.focus.move(-1,0));break;case G.DOWN_ARROW:this.edit.isEditing()||
this.focus.rowIndex+1==this.rowCount||(n.stop(k),this.focus.move(1,0));break;case G.PAGE_UP:this.edit.isEditing()||0===this.focus.rowIndex||(n.stop(k),this.focus.rowIndex!=this.scroller.firstVisibleRow+1?this.focus.move(this.scroller.firstVisibleRow-this.focus.rowIndex,0):(this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex-1)),this.focus.move(this.scroller.firstVisibleRow-this.scroller.lastVisibleRow+1,0)));break;case G.PAGE_DOWN:this.edit.isEditing()||this.focus.rowIndex+1==this.rowCount||
(n.stop(k),this.focus.rowIndex!=this.scroller.lastVisibleRow-1?this.focus.move(this.scroller.lastVisibleRow-this.focus.rowIndex-1,0):(this.setScrollTop(this.scroller.findScrollTop(this.focus.rowIndex+1)),this.focus.move(this.scroller.lastVisibleRow-this.scroller.firstVisibleRow-1,0)))}},onMouseOver:function(k){-1==k.rowIndex?this.onHeaderCellMouseOver(k):this.onCellMouseOver(k)},onMouseOut:function(k){-1==k.rowIndex?this.onHeaderCellMouseOut(k):this.onCellMouseOut(k)},onMouseDown:function(k){-1==
k.rowIndex?this.onHeaderCellMouseDown(k):this.onCellMouseDown(k)},onMouseOverRow:function(k){this.rows.isOver(k.rowIndex)||(this.rows.setOverRow(k.rowIndex),-1==k.rowIndex?this.onHeaderMouseOver(k):this.onRowMouseOver(k))},onMouseOutRow:function(k){if(this.rows.isOver(-1))this.onHeaderMouseOut(k);else this.rows.isOver(-2)||(this.rows.setOverRow(-2),this.onRowMouseOut(k))},onMouseDownRow:function(k){if(-1!=k.rowIndex)this.onRowMouseDown(k)},onCellMouseOver:function(k){k.cellNode&&u.add(k.cellNode,
this.cellOverClass)},onCellMouseOut:function(k){k.cellNode&&u.remove(k.cellNode,this.cellOverClass)},onCellMouseDown:function(k){},onCellClick:function(k){this._click[0]=this._click[1];this._click[1]=k;this.edit.isEditCell(k.rowIndex,k.cellIndex)||this.focus.setFocusCell(k.cell,k.rowIndex);1<this._click.length&&null==this._click[0]&&this._click.shift();this.onRowClick(k)},onCellDblClick:function(k){var d=1<this._click.length&&m("ie")?this._click[1]:1<this._click.length&&this._click[0].rowIndex!=this._click[1].rowIndex?
this._click[0]:k;this.focus.setFocusCell(d.cell,d.rowIndex);this.edit.setEditCell(d.cell,d.rowIndex);this.onRowDblClick(k)},onCellContextMenu:function(k){this.onRowContextMenu(k)},onCellFocus:function(k,d){this.edit.cellFocus(k,d)},onRowClick:function(k){this.edit.rowClick(k);this.selection.clickSelectEvent(k)},onRowDblClick:function(k){},onRowMouseOver:function(k){},onRowMouseOut:function(k){},onRowMouseDown:function(k){},onRowContextMenu:function(k){n.stop(k)},onHeaderMouseOver:function(k){},onHeaderMouseOut:function(k){},
onHeaderCellMouseOver:function(k){k.cellNode&&u.add(k.cellNode,this.cellOverClass)},onHeaderCellMouseOut:function(k){k.cellNode&&u.remove(k.cellNode,this.cellOverClass)},onHeaderCellMouseDown:function(k){},onHeaderClick:function(k){},onHeaderCellClick:function(k){this.setSortIndex(k.cell.index);this.onHeaderClick(k)},onHeaderDblClick:function(k){},onHeaderCellDblClick:function(k){this.onHeaderDblClick(k)},onHeaderCellContextMenu:function(k){this.onHeaderContextMenu(k)},onHeaderContextMenu:function(k){this.headerMenu||
n.stop(k)},onStartEdit:function(k,d){},onApplyCellEdit:function(k,d,a){},onCancelEdit:function(k){},onApplyEdit:function(k){},onCanSelect:function(k){return!0},onCanDeselect:function(k){return!0},onSelected:function(k){this.updateRowStyles(k)},onDeselected:function(k){this.updateRowStyles(k)},onSelectionChanged:function(){}})})},"dojox/grid/_Scroller":function(){define(["dijit/registry","dojo/_base/declare","dojo/_base/lang","./util","dojo/_base/html"],function(G,u,r,n,m){var k=function(a){a&&dojo.forEach(G.toArray(),
function(b){b.domNode&&m.isDescendant(b.domNode,a,!0)&&b.destroy()})},d=function(a,b){for(var e=[],g=0,h;h=a.childNodes[g];){g++;var c=m.byId(h);(c&&c.tagName?c.tagName.toLowerCase():"")==b&&e.push(h)}return e};return u("dojox.grid._Scroller",null,{constructor:function(a){this.setContentNodes(a);this.pageHeights=[];this.pageNodes=[];this.stack=[]},rowCount:0,defaultRowHeight:32,keepRows:100,contentNode:null,scrollboxNode:null,defaultPageHeight:0,keepPages:10,pageCount:0,windowHeight:0,firstVisibleRow:0,
lastVisibleRow:0,averageRowHeight:0,page:0,pageTop:0,init:function(a,b,e){switch(arguments.length){case 3:this.rowsPerPage=e;case 2:this.keepRows=b;case 1:this.rowCount=a}this.defaultPageHeight=(0<this.grid.rowHeight?this.grid.rowHeight:this.defaultRowHeight)*this.rowsPerPage;this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);this.setKeepInfo(this.keepRows);this.invalidate();this.scrollboxNode&&(this.scrollboxNode.scrollTop=0,this.scroll(0),this.scrollboxNode.onscroll=r.hitch(this,
"onscroll"))},_getPageCount:function(a,b){return a?Math.ceil(a/b)||1:0},destroy:function(){this.invalidateNodes();delete this.contentNodes;delete this.contentNode;delete this.scrollboxNode},setKeepInfo:function(a){this.keepPages=(this.keepRows=a)?Math.max(Math.ceil(this.keepRows/this.rowsPerPage),2):this.keepPages},setContentNodes:function(a){this.colCount=(this.contentNodes=a)?this.contentNodes.length:0;this.pageNodes=[];for(a=0;a<this.colCount;a++)this.pageNodes[a]=[]},getDefaultNodes:function(){return this.pageNodes[0]||
[]},invalidate:function(){this._invalidating=!0;this.invalidateNodes();this.pageHeights=[];this.height=this.pageCount?(this.pageCount-1)*this.defaultPageHeight+this.calcLastPageHeight():0;this.resize();this._invalidating=!1},updateRowCount:function(a){this.invalidateNodes();this.rowCount=a;a=this.pageCount;0===a&&(this.height=1);this.pageCount=this._getPageCount(this.rowCount,this.rowsPerPage);if(this.pageCount<a)for(--a;a>=this.pageCount;a--)this.height-=this.getPageHeight(a),delete this.pageHeights[a];
else this.pageCount>a&&(this.height+=this.defaultPageHeight*(this.pageCount-a-1)+this.calcLastPageHeight());this.resize()},pageExists:function(a){return!!this.getDefaultPageNode(a)},measurePage:function(a){return this.grid.rowHeight?((a+1)*this.rowsPerPage>this.rowCount?this.rowCount-a*this.rowsPerPage:this.rowsPerPage)*this.grid.rowHeight:(a=this.getDefaultPageNode(a))&&a.innerHTML?a.offsetHeight:void 0},positionPage:function(a,b){for(var e=0;e<this.colCount;e++)this.pageNodes[e][a].style.top=b+
"px"},repositionPages:function(a){for(var b=this.getDefaultNodes(),e=0,g=0;g<this.stack.length;g++)e=Math.max(this.stack[g],e);var h=(g=b[a])?this.getPageNodePosition(g)+this.getPageHeight(a):0;for(a+=1;a<=e;a++){if(g=b[a]){if(this.getPageNodePosition(g)==h)break;this.positionPage(a,h)}h+=this.getPageHeight(a)}},installPage:function(a){for(var b=0;b<this.colCount;b++)this.contentNodes[b].appendChild(this.pageNodes[b][a])},preparePage:function(a,b){b=b?this.popPage():null;for(var e=0;e<this.colCount;e++){var g=
this.pageNodes[e],h=null===b?this.createPageNode():this.invalidatePageNode(b,g);h.pageIndex=a;g[a]=h}},renderPage:function(a){var b=[],e;for(e=0;e<this.colCount;e++)b[e]=this.pageNodes[e][a];e=0;for(a*=this.rowsPerPage;e<this.rowsPerPage&&a<this.rowCount;e++,a++)this.renderRow(a,b)},removePage:function(a){var b=0;for(a*=this.rowsPerPage;b<this.rowsPerPage;b++,a++)this.removeRow(a)},destroyPage:function(a){for(var b=0;b<this.colCount;b++){var e=this.invalidatePageNode(a,this.pageNodes[b]);e&&m.destroy(e)}},
pacify:function(a){},pacifying:!1,pacifyTicks:200,setPacifying:function(a){this.pacifying!=a&&(this.pacifying=a,this.pacify(this.pacifying))},startPacify:function(){this.startPacifyTicks=(new Date).getTime()},doPacify:function(){var a=(new Date).getTime()-this.startPacifyTicks>this.pacifyTicks;this.setPacifying(!0);this.startPacify();return a},endPacify:function(){this.setPacifying(!1)},resize:function(){this.scrollboxNode&&(this.windowHeight=this.scrollboxNode.clientHeight);for(var a=0;a<this.colCount;a++)n.setStyleHeightPx(this.contentNodes[a],
Math.max(1,this.height));a=!this._invalidating;if(!a){var b=this.grid.get("autoHeight");"number"==typeof b&&b<=Math.min(this.rowsPerPage,this.rowCount)&&(a=!0)}a&&this.needPage(this.page,this.pageTop);a=this.page<this.pageCount-1?this.rowsPerPage:this.rowCount%this.rowsPerPage||this.rowsPerPage;b=this.getPageHeight(this.page);this.averageRowHeight=0<b&&0<a?b/a:0},calcLastPageHeight:function(){if(!this.pageCount)return 0;var a=(this.rowCount%this.rowsPerPage||this.rowsPerPage)*this.defaultRowHeight;
return this.pageHeights[this.pageCount-1]=a},updateContentHeight:function(a){this.height+=a;this.resize()},updatePageHeight:function(a,b,e){if(this.pageExists(a)){var g=this.getPageHeight(a),h=this.measurePage(a);void 0===h&&(h=g);this.pageHeights[a]=h;if(g!=h){this.updateContentHeight(h-g);var c=this.grid.get("autoHeight");"number"==typeof c&&c>this.rowCount||!0===c&&!b?e?(b=this.grid.viewsNode.style,b.height=parseInt(b.height)+h-g+"px",this.repositionPages(a)):this.grid.sizeChange():this.repositionPages(a)}return h}return 0},
rowHeightChanged:function(a,b){this.updatePageHeight(Math.floor(a/this.rowsPerPage),!1,b)},invalidateNodes:function(){for(;this.stack.length;)this.destroyPage(this.popPage())},createPageNode:function(){var a=document.createElement("div");m.attr(a,"role","presentation");a.style.position="absolute";a.style[this.grid.isLeftToRight()?"left":"right"]="0";return a},getPageHeight:function(a){a=this.pageHeights[a];return void 0!==a?a:this.defaultPageHeight},pushPage:function(a){return this.stack.push(a)},
popPage:function(){return this.stack.shift()},findPage:function(a){for(var b=0,e=0,g=0;b<this.pageCount&&!(g=this.getPageHeight(b),e+g>=a);b++,e+=g);this.page=b;this.pageTop=e},buildPage:function(a,b,e){this.preparePage(a,b);this.positionPage(a,e);this.installPage(a);this.renderPage(a);this.pushPage(a)},needPage:function(a,b){var e=this.getPageHeight(a);this.pageExists(a)?this.positionPage(a,b):(this.buildPage(a,!this.grid._autoHeight&&this.keepPages&&this.stack.length>=this.keepPages,b),e=this.updatePageHeight(a,
!0));return e},onscroll:function(){this.scroll(this.scrollboxNode.scrollTop)},scroll:function(a){this.grid.scrollTop=a;if(this.colCount){this.startPacify();this.findPage(a);for(var b=this.height,e=this.getScrollBottom(a),g=this.page,h=this.pageTop;g<this.pageCount&&(0>e||h<e);g++)h+=this.needPage(g,h);this.firstVisibleRow=this.getFirstVisibleRow(this.page,this.pageTop,a);this.lastVisibleRow=this.getLastVisibleRow(g-1,h,e);b!=this.height&&this.repositionPages(g-1);this.endPacify()}},getScrollBottom:function(a){return 0<=
this.windowHeight?a+this.windowHeight:-1},processNodeEvent:function(a,b){for(var e=a.target;e&&e!=b&&e.parentNode&&e.parentNode.parentNode!=b;)e=e.parentNode;if(!e||!e.parentNode||e.parentNode.parentNode!=b)return!1;a.topRowIndex=e.parentNode.pageIndex*this.rowsPerPage;b=a.topRowIndex;a:{var g=0;for(var h,c=e.parentNode;h=c.childNodes[g++];)if(h==e){--g;break a}g=-1}a.rowIndex=b+g;a.rowTarget=e;return!0},processEvent:function(a){return this.processNodeEvent(a,this.contentNode)},renderRow:function(a,
b){},removeRow:function(a){},getDefaultPageNode:function(a){return this.getDefaultNodes()[a]},positionPageNode:function(a,b){},getPageNodePosition:function(a){return a.offsetTop},invalidatePageNode:function(a,b){var e=b[a];e&&(delete b[a],this.removePage(a,e),k(e),e.innerHTML="");return e},getPageRow:function(a){return a*this.rowsPerPage},getLastPageRow:function(a){return Math.min(this.rowCount,this.getPageRow(a+1))-1},getFirstVisibleRow:function(a,b,e){if(!this.pageExists(a))return 0;var g=this.getPageRow(a),
h=this.getDefaultNodes();a=d(h[a],"div");h=0;for(var c=a.length;h<c&&b<e;h++,g++)b+=a[h].offsetHeight;return g?g-1:g},getLastVisibleRow:function(a,b,e){if(!this.pageExists(a))return 0;var g=this.getDefaultNodes(),h=this.getLastPageRow(a);a=d(g[a],"div");for(g=a.length-1;0<=g&&b>e;g--,h--)b-=a[g].offsetHeight;return h+1},findTopRow:function(a){var b=this.getDefaultNodes();b=d(b[this.page],"div");for(var e=0,g=b.length,h=this.pageTop,c;e<g;e++)if(c=b[e].offsetHeight,h+=c,h>=a)return this.offset=c-(h-
a),e+this.page*this.rowsPerPage;return-1},findScrollTop:function(a){var b=Math.floor(a/this.rowsPerPage),e=0,g;for(g=0;g<b;g++)e+=this.getPageHeight(g);this.pageTop=e;this.page=b;this.needPage(b,this.pageTop);g=this.getDefaultNodes();var h=d(g[b],"div");b=a-this.rowsPerPage*b;g=0;for(a=h.length;g<a&&g<b;g++)e+=h[g].offsetHeight;return e},dummy:0})})},"dojox/grid/util":function(){define(["../main","dojo/_base/lang","dojo/dom","dojo/_base/sniff"],function(G,u,r,n){var m=u.getObject("grid.util",!0,G);
m.na="...";m.rowIndexTag="gridRowIndex";m.gridViewTag="gridView";m.fire=function(k,d,a){function b(l,q){if(null==l)return null;var t=q?"Width":"Height";return l["scroll"+t]>l["client"+t]?l:b(l.parentNode,q)}var e;if(n("webkit")&&"focus"==d){var g=k.domNode?k.domNode:k;if(e=b(g,!1))var h=e.scrollTop;if(g=b(g,!0))var c=g.scrollLeft}var f=k&&d&&k[d];k=f&&(a?f.apply(k,a):k[d]());n("webkit")&&"focus"==d&&(e&&(e.scrollTop=h),g&&(g.scrollLeft=c));return k};m.setStyleHeightPx=function(k,d){if(0<=d){var a=
k.style;d+="px";k&&a.height!=d&&(a.height=d)}};m.mouseEvents="mouseover mouseout mousedown mouseup click dblclick contextmenu".split(" ");m.keyEvents=["keyup","keydown","keypress"];m.funnelEvents=function(k,d,a,b){b=b?b:m.mouseEvents.concat(m.keyEvents);for(var e=0,g=b.length;e<g;e++)d.connect(k,"on"+b[e],a)};m.removeNode=function(k){(k=r.byId(k))&&k.parentNode&&k.parentNode.removeChild(k);return k};m.arrayCompare=function(k,d){for(var a=0,b=k.length;a<b;a++)if(k[a]!=d[a])return!1;return k.length==
d.length};m.arrayInsert=function(k,d,a){k.length<=d?k[d]=a:k.splice(d,0,a)};m.arrayRemove=function(k,d){k.splice(d,1)};m.arraySwap=function(k,d,a){var b=k[d];k[d]=k[a];k[a]=b};return m})},"dojox/grid/_Layout":function(){define("dojo/_base/kernel ../main dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/dom-geometry ./cells ./_RowSelector".split(" "),function(G,u,r,n,m,k){return r("dojox.grid._Layout",null,{constructor:function(d){this.grid=d},cells:[],structure:null,defaultWidth:"6em",moveColumn:function(d,
a,b,e,g){var h=this.structure[d].cells[0],c=this.structure[a].cells[0],f=null,l=f=0;d=0;for(var q;q=h[d];d++)if(q.index==b){f=d;break}f=h.splice(f,1)[0];f.view=this.grid.views.views[a];d=0;for(q=null;q=c[d];d++)if(q.index==e){l=d;break}g||(l+=1);c.splice(l,0,f);if(b=this.grid.getCell(this.grid.getSortIndex()))b._currentlySorted=this.grid.getSortAsc();this.cells=[];for(d=b=0;a=this.structure[d];d++)for(e=0;g=a.cells[e];e++)for(h=0;q=g[h];h++)q.index=b,this.cells.push(q),"_currentlySorted"in q&&(c=
b+1,c*=q._currentlySorted?1:-1,this.grid.sortInfo=c,delete q._currentlySorted),b++;n.forEach(this.cells,function(t){var v=t.markup[2].split(" ");parseInt(v[1].substring(5))!=t.index&&(v[1]='idx\x3d"'+t.index+'"',t.markup[2]=v.join(" "))});this.grid.setupHeaderMenu()},setColumnVisibility:function(d,a){d=this.cells[d];if(d.hidden==a){d.hidden=!a;a=d.view;var b=a.viewWidth;b&&"auto"!=b&&(a._togglingColumn=k.getMarginBox(d.getHeaderNode()).w||0);a.update();return!0}return!1},addCellDef:function(d,a,b){var e=
this,g=function(h){var c=0;1<h.colSpan?c=0:(c=h.width||e._defaultCellProps.width||e.defaultWidth,isNaN(c)||(c+="em"));return c};d={grid:this.grid,subrow:d,layoutIndex:a,index:this.cells.length};if(b&&b instanceof u.grid.cells._Base)return a=m.clone(b),d.unitWidth=g(a._props),a=m.mixin(a,this._defaultCellProps,b._props,d);a=b.type||b.cellType||this._defaultCellProps.type||this._defaultCellProps.cellType||u.grid.cells.Cell;m.isString(a)&&(a=m.getObject(a));d.unitWidth=g(b);return new a(m.mixin({},this._defaultCellProps,
b,d))},addRowDef:function(d,a){for(var b=[],e=0,g=0,h=!0,c=0,f;f=a[c];c++)f=this.addCellDef(d,c,f),b.push(f),this.cells.push(f),h&&f.relWidth?e+=f.relWidth:f.width&&(f=f.width,"string"==typeof f&&"%"==f.slice(-1)?g+=window.parseInt(f,10):"auto"==f&&(h=!1));e&&h&&n.forEach(b,function(l){l.relWidth&&(l.width=l.unitWidth=l.relWidth/e*(100-g)+"%")});return b},addRowsDef:function(d){var a=[];if(m.isArray(d))if(m.isArrayLike(d[0]))for(var b=0,e;d&&(e=d[b]);b++)a.push(this.addRowDef(b,e));else a.push(this.addRowDef(0,
d));return a},addViewDef:function(d){this._defaultCellProps=d.defaultCell||{};d.width&&"auto"==d.width&&delete d.width;return m.mixin({},d,{cells:this.addRowsDef(d.rows||d.cells)})},setStructure:function(d){this.fieldIndex=0;this.cells=[];var a=this.structure=[];if(this.grid.rowSelector){var b={type:u._scopeName+".grid._RowSelector"};if(m.isString(this.grid.rowSelector)){var e=this.grid.rowSelector;"false"==e?b=null:"true"!=e&&(b.width=e)}else this.grid.rowSelector||(b=null);b&&a.push(this.addViewDef(b))}var g=
function(l){return"name"in l||"field"in l||"get"in l};b=function(l){return m.isArray(l)&&(m.isArray(l[0])||g(l[0]))?!0:!1};e=function(l){return null!==l&&m.isObject(l)&&("cells"in l||"rows"in l||"type"in l&&!g(l))};if(m.isArrayLike(d)){for(var h=!1,c=0,f;f=d[c];c++)if(e(f)){h=!0;break}if(h)for(c=0;f=d[c];c++)b(f)?a.push(this.addViewDef({cells:f})):e(f)&&a.push(this.addViewDef(f));else a.push(this.addViewDef({cells:d}))}else e(d)&&a.push(this.addViewDef(d));this.cellCount=this.cells.length;this.grid.setupHeaderMenu()}})})},
"dojox/grid/cells":function(){define(["../main","./cells/_base"],function(G){return G.grid.cells})},"dojox/grid/cells/_base":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/event dojo/_base/connect dojo/_base/array dojo/_base/sniff dojo/dom dojo/dom-attr dojo/dom-construct dijit/_Widget ../util".split(" "),function(G,u,r,n,m,k,d,a,b,e,g,h){var c=u("dojox.grid._DeferredTextWidget",g,{deferred:null,_destroyOnRemove:!0,postCreate:function(){this.deferred&&this.deferred.addBoth(r.hitch(this,
function(v){this.domNode&&(this.domNode.innerHTML=v)}))}}),f=function(){setTimeout(r.hitch.apply(G,arguments),0)},l=u("dojox.grid.cells._Base",null,{styles:"",classes:"",editable:!1,alwaysEditing:!1,formatter:null,defaultValue:"...",value:null,hidden:!1,noresize:!1,draggable:!0,_valueProp:"value",_formatPending:!1,constructor:function(v){this._props=v||{};r.mixin(this,v);void 0===this.draggable&&(this.draggable=!0)},_defaultFormat:function(v,w){var x=this.grid.formatterScope||this,H=this.formatter;
H&&x&&"string"==typeof H&&(H=this.formatter=x[H]);v=v!=this.defaultValue&&H?H.apply(x,w):v;if("undefined"==typeof v)return this.defaultValue;v&&v.addBoth&&(v=new c({deferred:v},e.create("span",{innerHTML:this.defaultValue})));return v&&v.declaredClass&&v.startup?"\x3cdiv class\x3d'dojoxGridStubNode' linkWidget\x3d'"+v.id+"' cellIdx\x3d'"+this.index+"'\x3e"+this.defaultValue+"\x3c/div\x3e":v},format:function(v,w){var x=this.grid.edit.info;(w=this.get?this.get(v,w):this.value||this.defaultValue)&&w.replace&&
this.grid.escapeHTMLInData&&(w=w.replace(/&(?![a-z0-9]{1,8};)/ig,"\x26amp;").replace(/</g,"\x26lt;"));return this.editable&&(this.alwaysEditing||x.rowIndex==v&&x.cell==this)?this.formatEditing(x.value?x.value:w,v):this._defaultFormat(w,[w,v,this])},formatEditing:function(v,w){},getNode:function(v){return this.view.getCellNode(v,this.index)},getHeaderNode:function(){return this.view.getHeaderCellNode(this.index)},getEditNode:function(v){return(this.getNode(v)||0).firstChild||0},canResize:function(){var v=
this.unitWidth;return v&&"auto"!==v},isFlex:function(){var v=this.unitWidth;return v&&r.isString(v)&&("auto"==v||"%"==v.slice(-1))},applyEdit:function(v,w){this.getNode(w)&&this.grid.edit.applyCellEdit(v,this,w)},cancelEdit:function(v){this.grid.doCancelEdit(v)},_onEditBlur:function(v){this.grid.edit.isEditCell(v,this.index)&&this.grid.edit.apply()},registerOnBlur:function(v,w){this.commitOnBlur&&m.connect(v,"onblur",function(x){setTimeout(r.hitch(this,"_onEditBlur",w),250)})},needFormatNode:function(v,
w){this._formatPending=!0;f(this,"_formatNode",v,w)},cancelFormatNode:function(){this._formatPending=!1},_formatNode:function(v,w){this._formatPending&&(this._formatPending=!1,d("ie")||a.setSelectable(this.grid.domNode,!0),this.formatNode(this.getEditNode(w),v,w))},formatNode:function(v,w,x){d("ie")?f(this,"focus",x,v):this.focus(x,v)},dispatchEvent:function(v,w){if(v in this)return this[v](w)},getValue:function(v){return this.getEditNode(v)[this._valueProp]},setValue:function(v,w){(v=this.getEditNode(v))&&
(v[this._valueProp]=w)},focus:function(v,w){v=w||this.getEditNode(v);try{h.fire(v,"focus"),h.fire(v,"select")}catch(x){}},save:function(v){this.value=this.value||this.getValue(v)},restore:function(v){this.setValue(v,this.value)},_finish:function(v){a.setSelectable(this.grid.domNode,!1);this.cancelFormatNode()},apply:function(v){this.applyEdit(this.getValue(v),v);this._finish(v)},cancel:function(v){this.cancelEdit(v);this._finish(v)}});l.markupFactory=function(v,w){var x=r.trim(b.get(v,"formatter")||
"");x&&(w.formatter=r.getObject(x)||x);if(x=r.trim(b.get(v,"get")||""))w.get=r.getObject(x);x=function(H,A,z){var E=r.trim(b.get(v,H)||"");E&&(A[z||H]="false"!=E.toLowerCase())};x("sortDesc",w);x("editable",w);x("alwaysEditing",w);x("noresize",w);x("draggable",w);if(x=r.trim(b.get(v,"loadingText")||b.get(v,"defaultValue")||""))w.defaultValue=x;x=function(H,A,z){var E=r.trim(b.get(v,H)||"")||void 0;E&&(A[z||H]=E)};x("styles",w);x("headerStyles",w);x("cellStyles",w);x("classes",w);x("headerClasses",
w);x("cellClasses",w)};var q=l.Cell=u("dojox.grid.cells.Cell",l,{constructor:function(){this.keyFilter=this.keyFilter},keyFilter:null,formatEditing:function(v,w){this.needFormatNode(v,w);v&&v.replace&&(v=v.replace(/"/g,"\x26quot;"));return'\x3cinput class\x3d"dojoxGridInput" type\x3d"text" value\x3d"'+v+'"\x3e'},formatNode:function(v,w,x){this.inherited(arguments);this.registerOnBlur(v,x)},doKey:function(v){this.keyFilter&&-1==String.fromCharCode(v.charCode).search(this.keyFilter)&&n.stop(v)},_finish:function(v){this.inherited(arguments);
var w=this.getEditNode(v);try{h.fire(w,"blur")}catch(x){}}});q.markupFactory=function(v,w){l.markupFactory(v,w);if(v=r.trim(b.get(v,"keyFilter")||""))w.keyFilter=new RegExp(v)};(l.RowIndex=u("dojox.grid.cells.RowIndex",q,{name:"Row",postscript:function(){this.editable=!1},get:function(v){return v+1}})).markupFactory=function(v,w){q.markupFactory(v,w)};(l.Select=u("dojox.grid.cells.Select",q,{options:null,values:null,returnIndex:-1,constructor:function(v){this.values=this.values||this.options},formatEditing:function(v,
w){this.needFormatNode(v,w);w=['\x3cselect class\x3d"dojoxGridSelect"\x3e'];for(var x=0,H,A;void 0!==(H=this.options[x])&&void 0!==(A=this.values[x]);x++)A=A.replace?A.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):A,H=H.replace?H.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):H,w.push("\x3coption",v==A?" selected":"",' value\x3d"'+A+'"',"\x3e",H,"\x3c/option\x3e");w.push("\x3c/select\x3e");return w.join("")},_defaultFormat:function(v,w){var x=this.inherited(arguments);if(!this.formatter&&this.values&&
this.options){var H=k.indexOf(this.values,x);0<=H&&(x=this.options[H])}return x},getValue:function(v){var w=this.getEditNode(v);if(w)return v=w.selectedIndex,w=w.options[v],-1<this.returnIndex?v:w.value||w.innerHTML}})).markupFactory=function(v,w){q.markupFactory(v,w);var x=r.trim(b.get(v,"options")||"");if(x){var H=x.split(",");H[0]!=x&&(w.options=H)}if(v=r.trim(b.get(v,"values")||""))x=v.split(","),x[0]!=v&&(w.values=x)};var t=l.AlwaysEdit=u("dojox.grid.cells.AlwaysEdit",q,{alwaysEditing:!0,_formatNode:function(v,
w){this.formatNode(this.getEditNode(w),v,w)},applyStaticValue:function(v){var w=this.grid.edit;w.applyCellEdit(this.getValue(v),this,v);w.start(this,v,!0)}});t.markupFactory=function(v,w){q.markupFactory(v,w)};(l.Bool=u("dojox.grid.cells.Bool",t,{_valueProp:"checked",formatEditing:function(v,w){return'\x3cinput class\x3d"dojoxGridInput" type\x3d"checkbox"'+(v?' checked\x3d"checked"':"")+' style\x3d"width: auto" /\x3e'},doclick:function(v){"INPUT"==v.target.tagName&&this.applyStaticValue(v.rowIndex)}})).markupFactory=
function(v,w){t.markupFactory(v,w)};return l})},"dojox/grid/_RowSelector":function(){define(["dojo/_base/declare","./_View"],function(G,u){return G("dojox.grid._RowSelector",u,{defaultWidth:"2em",noscroll:!0,padBorderWidth:2,buildRendering:function(){this.inherited("buildRendering",arguments);this.scrollboxNode.style.overflow="hidden";this.headerNode.style.visibility="hidden"},getWidth:function(){return this.viewWidth||this.defaultWidth},buildRowContent:function(r,n){n.innerHTML='\x3ctable class\x3d"dojoxGridRowbarTable" style\x3d"width:'+
(this.contentWidth||0)+'px;height:1px;" border\x3d"0" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"\x3e\x3ctr\x3e\x3ctd class\x3d"dojoxGridRowbarInner"\x3e\x26nbsp;\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e'},renderHeader:function(){},updateRow:function(){},resize:function(){this.adaptHeight()},adaptWidth:function(){!("contentWidth"in this)&&this.contentNode&&0<this.contentNode.offsetWidth&&(this.contentWidth=this.contentNode.offsetWidth-this.padBorderWidth)},doStyleRowNode:function(r,n){var m=
["dojoxGridRowbar dojoxGridNonNormalizedCell"];this.grid.rows.isOver(r)&&m.push("dojoxGridRowbarOver");this.grid.selection.isSelected(r)&&m.push("dojoxGridRowbarSelected");n.className=m.join(" ")},domouseover:function(r){this.grid.onMouseOverRow(r)},domouseout:function(r){if(!this.isIntraRowEvent(r))this.grid.onMouseOutRow(r)}})})},"dojox/grid/_View":function(){define("dojo dijit/registry ../main dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/connect dojo/_base/sniff dojo/query dojo/_base/window dojo/text!./resources/View.html dojo/dnd/Source dijit/_Widget dijit/_TemplatedMixin dojox/html/metrics ./util dojo/_base/html ./_Builder dojo/dnd/Avatar dojo/dnd/Manager".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x){g=n("dojox.grid._View",[c,f],{defaultWidth:"18em",viewWidth:"",templateString:g,classTag:"dojoxGrid",marginBottom:0,rowPad:2,_togglingColumn:-1,_headerBuilderClass:v._HeaderBuilder,_contentBuilderClass:v._ContentBuilder,postMixInProperties:function(){this.rowNodes={}},postCreate:function(){this.connect(this.scrollboxNode,"onscroll","doscroll");q.funnelEvents(this.contentNode,this,"doContentEvent","mouseover mouseout click dblclick contextmenu mousedown".split(" "));
q.funnelEvents(this.headerNode,this,"doHeaderEvent","dblclick mouseover mouseout mousemove mousedown click contextmenu".split(" "));this.content=new this._contentBuilderClass(this);this.header=new this._headerBuilderClass(this);this.grid.isLeftToRight()||(this.headerNodeContainer.style.width="")},destroy:function(){t.destroy(this.headerNode);delete this.headerNode;for(var z in this.rowNodes)this._cleanupRowWidgets(this.rowNodes[z]),t.destroy(this.rowNodes[z]);this.rowNodes={};this.source&&this.source.destroy();
this.inherited(arguments)},focus:function(){a("ie")||a("webkit")||a("opera")?this.hiddenFocusNode.focus():this.scrollboxNode.focus()},setStructure:function(z){z=this.structure=z;z.width&&!isNaN(z.width)?this.viewWidth=z.width+"em":this.viewWidth=z.width||(z.noscroll?"auto":this.viewWidth);this._onBeforeRow=z.onBeforeRow||function(){};this._onAfterRow=z.onAfterRow||function(){};if(this.noscroll=z.noscroll)this.scrollboxNode.style.overflow="hidden";this.simpleStructure=1==z.cells.length;this.testFlexCells();
this.updateStructure()},_cleanupRowWidgets:function(z){z&&m.forEach(b("[widgetId]",z).map(u.byNode),function(E){E._destroyOnRemove?(E.destroy(),delete E):E.domNode&&E.domNode.parentNode&&E.domNode.parentNode.removeChild(E.domNode)})},onBeforeRow:function(z,E){this._onBeforeRow(z,E);0<=z&&this._cleanupRowWidgets(this.getRowNode(z))},onAfterRow:function(z,E,J){this._onAfterRow(z,E,J);var D=this.grid;m.forEach(b(".dojoxGridStubNode",J),function(L){if(L&&L.parentNode){var C=L.getAttribute("linkWidget"),
N=window.parseInt(t.attr(L,"cellIdx"),10);D.getCell(N);(C=u.byId(C))?(L.parentNode.replaceChild(C.domNode,L),C._started||C.startup(),G.destroy(L)):L.innerHTML=""}},this)},testFlexCells:function(){this.flexCells=!1;for(var z=0,E;E=this.structure.cells[z];z++)for(var J=0,D;D=E[J];J++)D.view=this,this.flexCells=this.flexCells||D.isFlex();return this.flexCells},updateStructure:function(){this.header.update();this.content.update()},getScrollbarWidth:function(){var z=this.hasVScrollbar(),E=t.style(this.scrollboxNode,
"overflow");this.noscroll||!E||"hidden"==E?z=!1:"scroll"==E&&(z=!0);return z?l.getScrollbar().w:0},getColumnsWidth:function(){var z=this.headerContentNode;return z&&z.firstChild?z.firstChild.offsetWidth||t.style(z.firstChild,"width"):0},setColumnsWidth:function(z){this.headerContentNode.firstChild.style.width=z+"px";this.viewWidth&&(this.viewWidth=z+"px")},getWidth:function(){return this.viewWidth||this.getColumnsWidth()+this.getScrollbarWidth()+"px"},getContentWidth:function(){return Math.max(0,
t._getContentBox(this.domNode).w-this.getScrollbarWidth())+"px"},render:function(){this.scrollboxNode.style.height="";this.renderHeader();0<=this._togglingColumn&&(this.setColumnsWidth(this.getColumnsWidth()-this._togglingColumn),this._togglingColumn=-1);var z=this.grid.layout.cells,E=k.hitch(this,function(D,L){!this.grid.isLeftToRight()&&(L=!L);L=L?-1:1;D=this.header.getCellNodeIndex(D)+L;for(var C=z[D];C&&C.getHeaderNode()&&"none"==C.getHeaderNode().style.display;)D+=L,C=z[D];return C?C.getHeaderNode():
null});if(this.grid.columnReordering&&this.simpleStructure){this.source&&this.source.destroy();this.bottomMarker&&t.destroy(this.bottomMarker);this.bottomMarker=t.byId("dojoxGrid_bottomMarker");this.topMarker&&t.destroy(this.topMarker);this.topMarker=t.byId("dojoxGrid_topMarker");this.bottomMarker||(this.bottomMarker=t.create("div",{id:"dojoxGrid_bottomMarker","class":"dojoxGridColPlaceBottom"},e.body()),this._hide(this.bottomMarker),this.topMarker=t.create("div",{id:"dojoxGrid_topMarker","class":"dojoxGridColPlaceTop"},
e.body()),this._hide(this.topMarker));this.arrowDim=t.contentBox(this.bottomMarker);var J=t.contentBox(this.headerContentNode.firstChild.rows[0]).h;this.source=new h(this.headerContentNode.firstChild.rows[0],{horizontal:!0,accept:["gridColumn_"+this.grid.id],viewIndex:this.index,generateText:!1,onMouseDown:k.hitch(this,function(D){this.header.decorateEvent(D);if((this.header.overRightResizeArea(D)||this.header.overLeftResizeArea(D))&&this.header.canResize(D)&&!this.header.moveable)this.header.beginColumnResize(D);
else{if(this.grid.headerMenu)this.grid.headerMenu.onCancel(!0);D.button===(9>a("ie")?1:0)&&h.prototype.onMouseDown.call(this.source,D)}}),onMouseOver:k.hitch(this,function(D){var L=this.source;L._getChildByEvent(D)&&h.prototype.onMouseOver.apply(L,arguments)}),_markTargetAnchor:k.hitch(this,function(D){var L=this.source;if(L.current!=L.targetAnchor||L.before!=D){L.targetAnchor&&E(L.targetAnchor,L.before)&&L._removeItemClass(E(L.targetAnchor,L.before),L.before?"After":"Before");h.prototype._markTargetAnchor.call(L,
D);var C=D?L.targetAnchor:E(L.targetAnchor,L.before);D=0;C||(C=L.targetAnchor,D=t.contentBox(C).w+this.arrowDim.w/2+2);C=t.position(C,!0);D=Math.floor(C.x-this.arrowDim.w/2+D);t.style(this.bottomMarker,"visibility","visible");t.style(this.topMarker,"visibility","visible");t.style(this.bottomMarker,{left:D+"px",top:J+C.y+"px"});t.style(this.topMarker,{left:D+"px",top:C.y-this.arrowDim.h+"px"});L.targetAnchor&&E(L.targetAnchor,L.before)&&L._addItemClass(E(L.targetAnchor,L.before),L.before?"After":"Before")}}),
_unmarkTargetAnchor:k.hitch(this,function(){var D=this.source;D.targetAnchor&&(D.targetAnchor&&E(D.targetAnchor,D.before)&&D._removeItemClass(E(D.targetAnchor,D.before),D.before?"After":"Before"),this._hide(this.bottomMarker),this._hide(this.topMarker),h.prototype._unmarkTargetAnchor.call(D))}),destroy:k.hitch(this,function(){d.disconnect(this._source_conn);d.unsubscribe(this._source_sub);h.prototype.destroy.call(this.source);this.bottomMarker&&(t.destroy(this.bottomMarker),delete this.bottomMarker);
this.topMarker&&(t.destroy(this.topMarker),delete this.topMarker)}),onDndCancel:k.hitch(this,function(){h.prototype.onDndCancel.call(this.source);this._hide(this.bottomMarker);this._hide(this.topMarker)})});this._source_conn=d.connect(this.source,"onDndDrop",this,"_onDndDrop");this._source_sub=d.subscribe("/dnd/drop/before",this,"_onDndDropBefore");this.source.startup()}},_hide:function(z){t.style(z,{top:"-10000px",visibility:"hidden"})},_onDndDropBefore:function(z,E,J){x.manager().target===this.source&&
(this.source._targetNode=this.source.targetAnchor,this.source._beforeTarget=this.source.before,E=this.grid.views.views,z=E[z.viewIndex],E=E[this.index],E!=z&&(z.convertColPctToFixed(),E.convertColPctToFixed()))},_onDndDrop:function(z,E,J){if(x.manager().target!==this.source)x.manager().source===this.source&&(this._removingColumn=!0);else{this._hide(this.bottomMarker);this._hide(this.topMarker);J=function(S){return S?t.attr(S,"idx"):null};var D=t.marginBox(E[0]).w;if(z.viewIndex!==this.index){var L=
this.grid.views.views,C=L[z.viewIndex];L=L[this.index];C.viewWidth&&"auto"!=C.viewWidth&&C.setColumnsWidth(C.getColumnsWidth()-D);L.viewWidth&&"auto"!=L.viewWidth&&L.setColumnsWidth(L.getColumnsWidth())}D=this.source._targetNode;C=this.source._beforeTarget;!this.grid.isLeftToRight()&&(C=!C);L=this.grid.layout;var N=this.index;delete this.source._targetNode;delete this.source._beforeTarget;L.moveColumn(z.viewIndex,N,J(E[0]),J(D),C)}},renderHeader:function(){this.headerContentNode.innerHTML=this.header.generateHtml(this._getHeaderContent);
this.flexCells&&(this.contentWidth=this.getContentWidth(),this.headerContentNode.firstChild.style.width=this.contentWidth);q.fire(this,"onAfterRow",[-1,this.structure.cells,this.headerContentNode])},_getHeaderContent:function(z){var E=z.name||z.grid.getCellName(z);/^\s+$/.test(E)&&(E="\x26nbsp;");var J=['\x3cdiv class\x3d"dojoxGridSortNode'];z.index!=z.grid.getSortIndex()?J.push('"\x3e'):J=J.concat([" ",0<z.grid.sortInfo?"dojoxGridSortUp":"dojoxGridSortDown",'"\x3e\x3cdiv class\x3d"dojoxGridArrowButtonChar"\x3e',
0<z.grid.sortInfo?"\x26#9650;":"\x26#9660;",'\x3c/div\x3e\x3cdiv class\x3d"dojoxGridArrowButtonNode" role\x3d"presentation"\x3e\x3c/div\x3e','\x3cdiv class\x3d"dojoxGridColCaption"\x3e']);J=J.concat([E,"\x3c/div\x3e\x3c/div\x3e"]);return J.join("")},resize:function(){this.adaptHeight();this.adaptWidth()},hasHScrollbar:function(z){var E=this._hasHScroll||!1;if(void 0==this._hasHScroll||z)this.noscroll?this._hasHScroll=!1:(z=t.style(this.scrollboxNode,"overflow"),this._hasHScroll="hidden"==z?!1:"scroll"==
z?!0:this.scrollboxNode.offsetWidth-this.getScrollbarWidth()<this.contentNode.offsetWidth);E!==this._hasHScroll&&this.grid.update();return this._hasHScroll},hasVScrollbar:function(z){var E=this._hasVScroll||!1;if(void 0==this._hasVScroll||z)this.noscroll?this._hasVScroll=!1:(z=t.style(this.scrollboxNode,"overflow"),this._hasVScroll="hidden"==z?!1:"scroll"==z?!0:this.scrollboxNode.scrollHeight>this.scrollboxNode.clientHeight);E!==this._hasVScroll&&this.grid.update();return this._hasVScroll},convertColPctToFixed:function(){var z=
!1;this.grid.initialWidth="";var E=b("th",this.headerContentNode),J=m.map(E,function(D,L){var C=D.style.width;t.attr(D,"vIdx",L);if(C&&"%"==C.slice(-1))z=!0;else if(C&&"px"==C.slice(-2))return window.parseInt(C,10);return t.contentBox(D).w});return z?(m.forEach(this.grid.layout.cells,function(D,L){if(D.view==this&&(D=D.view.getHeaderCellNode(D.index))&&t.hasAttr(D,"vIdx")){var C=window.parseInt(t.attr(D,"vIdx"));this.setColWidth(L,J[C]);t.removeAttr(D,"vIdx")}},this),!0):!1},adaptHeight:function(z){if(!this.grid._autoHeight){var E=
this.domNode.style.height&&parseInt(this.domNode.style.height.replace(/px/,""),10)||this.domNode.clientHeight;if(!z&&(z=this.noscroll))a:{for(var J=0;J<this.grid.views.views.length;++J)if(z=this.grid.views.views[J],z!==this&&z.hasHScrollbar()){z=!0;break a}z=!1}z&&(E-=l.getScrollbar().h);q.setStyleHeightPx(this.scrollboxNode,E)}this.hasVScrollbar(!0)},adaptWidth:function(){this.flexCells&&(this.contentWidth=this.getContentWidth(),this.headerContentNode.firstChild.style.width=this.contentWidth);var z=
this.scrollboxNode.offsetWidth-this.getScrollbarWidth();this._removingColumn?(z=Math.min(z,this.getColumnsWidth())+"px",this._removingColumn=!1):z=Math.max(z,this.getColumnsWidth())+"px";this.contentNode.style.width=z;this.hasHScrollbar(!0)},setSize:function(z,E){var J=this.domNode.style,D=this.headerNode.style;z&&(J.width=z,D.width=z);J.height=0<=E?E+"px":""},renderRow:function(z){var E=this.createRowNode(z);this.buildRow(z,E);return E},createRowNode:function(z){var E=document.createElement("div");
E.className=this.classTag+"Row";this instanceof r.grid._RowSelector?t.attr(E,"role","presentation"):(t.attr(E,"role","row"),"none"!=this.grid.selectionMode&&E.setAttribute("aria-selected","false"));E[q.gridViewTag]=this.id;E[q.rowIndexTag]=z;return this.rowNodes[z]=E},buildRow:function(z,E){this.buildRowContent(z,E);this.styleRow(z,E)},buildRowContent:function(z,E){E.innerHTML=this.content.generateHtml(z,z);this.flexCells&&this.contentWidth&&(E.firstChild.style.width=this.contentWidth);q.fire(this,
"onAfterRow",[z,this.structure.cells,E])},rowRemoved:function(z){0<=z&&this._cleanupRowWidgets(this.getRowNode(z));this.grid.edit.save(this,z);delete this.rowNodes[z]},getRowNode:function(z){return this.rowNodes[z]},getCellNode:function(z,E){if(z=this.getRowNode(z))return this.content.getCellNode(z,E)},getHeaderCellNode:function(z){if(this.headerContentNode)return this.header.getCellNode(this.headerContentNode,z)},styleRow:function(z,E){var J=void 0==E.style.cssText?E.getAttribute("style"):E.style.cssText;
E._style=J;this.styleRowNode(z,E)},styleRowNode:function(z,E){E&&this.doStyleRowNode(z,E)},doStyleRowNode:function(z,E){this.grid.styleRowNode(z,E)},updateRow:function(z){var E=this.getRowNode(z);E&&(E.style.height="",this.buildRow(z,E));return E},updateRowStyles:function(z){this.styleRowNode(z,this.getRowNode(z))},lastTop:0,firstScroll:0,_nativeScroll:!1,doscroll:function(z){if(13<=a("ff")||a("chrome"))this._nativeScroll=!0;z=this.grid.isLeftToRight();if(2>this.firstScroll){if(!z&&1==this.firstScroll||
z&&0===this.firstScroll){var E=t.marginBox(this.headerNodeContainer);a("ie")?this.headerNodeContainer.style.width=E.w+this.getScrollbarWidth()+"px":a("mozilla")&&(this.headerNodeContainer.style.width=E.w-this.getScrollbarWidth()+"px",this.scrollboxNode.scrollLeft=z?this.scrollboxNode.clientWidth-this.scrollboxNode.scrollWidth:this.scrollboxNode.scrollWidth-this.scrollboxNode.clientWidth)}this.firstScroll++}this.headerNode.scrollLeft=this.scrollboxNode.scrollLeft;z=this.scrollboxNode.scrollTop;z!==
this.lastTop&&this.grid.scrollTo(z);this._nativeScroll=!1},setScrollTop:function(z){this.lastTop=z;this._nativeScroll||(this.scrollboxNode.scrollTop=z);return this.scrollboxNode.scrollTop},doContentEvent:function(z){if(this.content.decorateEvent(z))this.grid.onContentEvent(z)},doHeaderEvent:function(z){if(this.header.decorateEvent(z))this.grid.onHeaderEvent(z)},dispatchContentEvent:function(z){return this.content.dispatchEvent(z)},dispatchHeaderEvent:function(z){return this.header.dispatchEvent(z)},
setColWidth:function(z,E){this.grid.setCellWidth(z,E+"px")},update:function(){if(this.domNode){this.content.update();this.grid.update();var z=this.scrollboxNode.scrollLeft;this.scrollboxNode.scrollLeft=z;this.headerNode.scrollLeft=z}}});var H=n("dojox.grid._GridAvatar",w,{construct:function(){var z=e.doc,E=z.createElement("table");E.cellPadding=E.cellSpacing="0";E.className="dojoxGridDndAvatar";E.style.position="absolute";E.style.zIndex=1999;E.style.margin="0px";var J=z.createElement("tbody"),D=z.createElement("tr"),
L=z.createElement("td"),C=z.createElement("td");D.className="dojoxGridDndAvatarItem";C.className="dojoxGridDndAvatarItemImage";C.style.width="16px";var N=this.manager.source;if(N.creator)N=N._normalizedCreator(N.getItem(this.manager.nodes[0].id).data,"avatar").node;else if(N=this.manager.nodes[0].cloneNode(!0),"tr"==N.tagName.toLowerCase()){var S=z.createElement("table");var F=z.createElement("tbody");F.appendChild(N);S.appendChild(F);N=S}else"th"==N.tagName.toLowerCase()&&(S=z.createElement("table"),
F=z.createElement("tbody"),z=z.createElement("tr"),S.cellPadding=S.cellSpacing="0",z.appendChild(N),F.appendChild(z),S.appendChild(F),N=S);N.id="";L.appendChild(N);D.appendChild(C);D.appendChild(L);t.style(D,"opacity",.9);J.appendChild(D);E.appendChild(J);this.node=E;E=x.manager();this.oldOffsetY=E.OFFSET_Y;E.OFFSET_Y=1},destroy:function(){x.manager().OFFSET_Y=this.oldOffsetY;this.inherited(arguments)}}),A=x.manager().makeAvatar;x.manager().makeAvatar=function(){return void 0===this.source.viewIndex||
t.hasClass(e.body(),"dijit_a11y")?A.call(x.manager()):new H(this)};return g})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(G,u,r,n,m,k,d,a,b,e,g,h){r.isAsync||a(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var c=u("dojo.dnd.Source",g,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,
autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(f,l){n.mixin(this,n.mixin({},l));f=this.accept;if(f.length)for(this.accept={},l=0;l<f.length;++l)this.accept[f[l]]=1;this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&m.add(this.node,"dojoDndSource");this.targetState="";this.accept&&m.add(this.node,"dojoDndTarget");this.horizontal&&m.add(this.node,"dojoDndHorizontal");this.topics=
[b.subscribe("/dnd/source/over",n.hitch(this,"onDndSourceOver")),b.subscribe("/dnd/start",n.hitch(this,"onDndStart")),b.subscribe("/dnd/drop",n.hitch(this,"onDndDrop")),b.subscribe("/dnd/cancel",n.hitch(this,"onDndCancel"))]},checkAcceptance:function(f,l){if(this==f)return!this.copyOnly||this.selfAccept;for(var q=0;q<l.length;++q){for(var t=f.getItem(l[q].id).type,v=!1,w=0;w<t.length;++w)if(t[w]in this.accept){v=!0;break}if(!v)return!1}return!0},copyState:function(f,l){if(f)return!0;2>arguments.length&&
(l=this==h.manager().target);if(l){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){c.superclass.destroy.call(this);G.forEach(this.topics,function(f){f.remove()});this.targetAnchor=null},onMouseMove:function(f){if(!this.isDragging||"Disabled"!=this.targetState){c.superclass.onMouseMove.call(this,f);var l=h.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(f.pageX-this._lastX)>this.delay||Math.abs(f.pageY-this._lastY)>this.delay)){var q=
this.getSelectedNodes();q.length&&l.startDrag(this,q,this.copyState(e.getCopyKeyState(f),!0))}this.isDragging&&(q=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=k.position(this.current,!0)),q=this.horizontal?f.pageX-this.targetBox.x<this.targetBox.w/2==k.isBodyLtr(this.current.ownerDocument):f.pageY-this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||q!=this.before)&&(this._markTargetAnchor(q),l.canDrop(!this.current||l.source!=this||!(this.current.id in
this.selection)))}},onMouseDown:function(f){this.mouseDown||!this._legalMouseDown(f)||this.skipForm&&e.isFormElement(f)||(this.mouseDown=!0,this._lastX=f.pageX,this._lastY=f.pageY,c.superclass.onMouseDown.call(this,f))},onMouseUp:function(f){this.mouseDown&&(this.mouseDown=!1,c.superclass.onMouseUp.call(this,f))},onDndSourceOver:function(f){this!==f?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(f=h.manager(),f.canDrop("Disabled"!=this.targetState&&(!this.current||
f.source!=this||!(this.current.id in this.selection))))},onDndStart:function(f,l,q){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==f?q?"Copied":"Moved":"");l=this.accept&&this.checkAcceptance(f,l);this._changeState("Target",l?"":"Disabled");this==f&&h.manager().overSource(this);this.isDragging=!0},onDndDrop:function(f,l,q,t){if(this==t)this.onDrop(f,l,q);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=
!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(f,l,q){if(this!=f)this.onDropExternal(f,l,q);else this.onDropInternal(l,q)},onDropExternal:function(f,l,q){var t=this._normalizedCreator;this._normalizedCreator=this.creator?function(v,w){return t.call(this,f.getItem(v.id).data,w)}:q?function(v){var w=f.getItem(v.id);v=v.cloneNode(!0);v.id=e.getUniqueId();return{node:v,data:w.data,type:w.type}}:function(v){var w=f.getItem(v.id);f.delItem(v.id);
return{node:v,data:w.data,type:w.type}};this.selectNone();q||this.creator||f.selectNone();this.insertNodes(!0,l,this.before,this.current);!q&&this.creator&&f.deleteSelectedNodes();this._normalizedCreator=t},onDropInternal:function(f,l){var q=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(l)this._normalizedCreator=this.creator?function(t,v){return q.call(this,this.getItem(t.id).data,v)}:function(t){var v=this.getItem(t.id);t=t.cloneNode(!0);t.id=e.getUniqueId();return{node:t,
data:v.data,type:v.type}};else{if(!this.current)return;this._normalizedCreator=function(t){var v=this.getItem(t.id);return{node:t,data:v.data,type:v.type}}}this._removeSelection();this.insertNodes(!0,f,this.before,this.current);this._normalizedCreator=q}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){c.superclass.onOverEvent.call(this);h.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){c.superclass.onOutEvent.call(this);
h.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(f){if(this.current!=this.targetAnchor||this.before!=f)this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=f,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,
this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(f){this._changeState("Source",f?"Copied":"Moved")},_legalMouseDown:function(f){if("touchstart"!=f.type&&!d.isLeft(f))return!1;if(!this.withHandles)return!0;for(f=f.target;f&&f!==this.node;f=f.parentNode){if(m.contains(f,"dojoDndHandle"))return!0;if(m.contains(f,"dojoDndItem")||m.contains(f,"dojoDndIgnore"))break}return!1}});return c})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h){var c=u("dojo.dnd.Selector",h,{constructor:function(f,l){l||(l={});this.singular=l.singular;this.autoSync=l.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(b(this.node,e.press,n.hitch(this,"onMouseDown")),b(this.node,e.release,n.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var f=new a,l=g._empty,q;for(q in this.selection)q in l||f.push(m.byId(q));return f},selectNone:function(){return this._removeSelection()._removeAnchor()},
selectAll:function(){this.forInItems(function(f,l){this._addItemClass(m.byId(l),"Selected");this.selection[l]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var f=g._empty,l;for(l in this.selection)if(!(l in f)){var q=m.byId(l);this.delItem(l);k.destroy(q)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(f,l){l=l||r.global;var q=this.selection,t=g._empty,v;for(v in q)v in t||f.call(l,this.getItem(v),v,this)},sync:function(){c.superclass.sync.call(this);
this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var f=[],l=g._empty,q;for(q in this.selection)q in l||this.getItem(q)||f.push(q);G.forEach(f,function(t){delete this.selection[t]},this);return this},insertNodes:function(f,l,q,t){var v=this._normalizedCreator;this._normalizedCreator=function(w,x){w=v.call(this,w,x);f?(this.anchor?this.anchor!=w.node&&(this._removeItemClass(w.node,"Anchor"),this._addItemClass(w.node,"Selected")):(this.anchor=w.node,this._removeItemClass(w.node,"Selected"),
this._addItemClass(this.anchor,"Anchor")),this.selection[w.node.id]=1):(this._removeItemClass(w.node,"Selected"),this._removeItemClass(w.node,"Anchor"));return w};c.superclass.insertNodes.call(this,l,q,t);this._normalizedCreator=v;return this},destroy:function(){c.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(f){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!g.getCopyKeyState(f)&&!f.shiftKey&&this.current.id in this.selection)this.simpleSelection=
!0,d.isLeft(f)&&(f.stopPropagation(),f.preventDefault());else{if(!this.singular&&f.shiftKey){g.getCopyKeyState(f)||this._removeSelection();var l=this.getAllNodes();if(l.length&&(this.anchor||(this.anchor=l[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var q=0,t;q<l.length&&(t=l[q],t!=this.anchor&&t!=this.current);++q);for(++q;q<l.length;++q){t=l[q];if(t==this.anchor||t==this.current)break;this._addItemClass(t,"Selected");this.selection[t.id]=
1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?g.getCopyKeyState(f)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):g.getCopyKeyState(f)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):
(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);f.stopPropagation();f.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&
(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=b(this.node,e.move,n.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var f=g._empty,l;for(l in this.selection)if(!(l in f)){var q=m.byId(l);q&&this._removeItemClass(q,"Selected")}this.selection=
{};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return c})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),function(G,u,r,n,m,k,d,a,b,e,g,h,c,f){u=u("dojo.dnd.Container",b,{skipForm:!1,allowNested:!1,constructor:function(l,q){this.node=k.byId(l);
q||(q={});this.creator=q.creator||null;this.skipForm=q.skipForm;this.parent=q.dropParent&&k.byId(q.dropParent);this.map={};this.current=null;this.containerState="";d.add(this.node,"dojoDndContainer");q&&q._skipStartup||this.startup();this.events=[g(this.node,c.over,n.hitch(this,"onMouseOver")),g(this.node,c.out,n.hitch(this,"onMouseOut")),g(this.node,"dragstart",n.hitch(this,"onSelectStart")),g(this.node,"selectstart",n.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(l){return this.map[l]},
setItem:function(l,q){this.map[l]=q},delItem:function(l){delete this.map[l]},forInItems:function(l,q){q=q||r.global;var t=this.map,v=f._empty,w;for(w in t)w in v||l.call(q,t[w],w,this);return q},clearItems:function(){this.map={}},getAllNodes:function(){return h((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var l={};this.getAllNodes().forEach(function(q){if(q.id){var t=this.getItem(q.id);if(t){l[q.id]=t;return}}else q.id=f.getUniqueId();t=q.getAttribute("dndType");var v=
q.getAttribute("dndData");l[q.id]={data:v||q.innerHTML,type:t?t.split(/\s*,\s*/):["text"]}},this);this.map=l;return this},insertNodes:function(l,q,t){this.parent.firstChild?q?t||(t=this.parent.firstChild):t&&(t=t.nextSibling):t=null;if(t)for(q=0;q<l.length;++q){var v=this._normalizedCreator(l[q]);this.setItem(v.node.id,{data:v.data,type:v.type});t.parentNode.insertBefore(v.node,t)}else for(q=0;q<l.length;++q)v=this._normalizedCreator(l[q]),this.setItem(v.node.id,{data:v.data,type:v.type}),this.parent.appendChild(v.node);
return this},destroy:function(){G.forEach(this.events,function(l){l.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(l,q,t){l._skipStartup=!0;return new t(q,l)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var l=this.parent.getElementsByTagName("tbody");l&&l.length&&(this.parent=l[0])}this.defaultCreator=f._defaultCreator(this.parent);this.sync()},onMouseOver:function(l){for(var q=l.relatedTarget;q&&
q!=this.node;)try{q=q.parentNode}catch(t){q=null}q||(this._changeState("Container","Over"),this.onOverEvent());q=this._getChildByEvent(l);this.current!=q&&(this.current&&this._removeItemClass(this.current,"Over"),q&&this._addItemClass(q,"Over"),this.current=q)},onMouseOut:function(l){for(l=l.relatedTarget;l;){if(l==this.node)return;try{l=l.parentNode}catch(q){l=null}}this.current&&(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(l){this.withHandles||
this.skipForm&&f.isFormElement(l)||(l.stopPropagation(),l.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(l,q){var t="dojoDnd"+l;l=l.toLowerCase()+"State";d.replace(this.node,t+q,t+this[l]);this[l]=q},_addItemClass:function(l,q){d.add(l,"dojoDndItem"+q)},_removeItemClass:function(l,q){d.remove(l,"dojoDndItem"+q)},_getChildByEvent:function(l){if(l=l.target)for(var q=l.parentNode;q;l=q,q=l.parentNode)if((q==this.parent||this.allowNested)&&d.contains(l,"dojoDndItem"))return l;
return null},_normalizedCreator:function(l,q){l=(this.creator||this.defaultCreator).call(this,l,q);n.isArray(l.type)||(l.type=["text"]);l.node.id||(l.node.id=f.getUniqueId());d.add(l.node,"dojoDndItem");return l}});f._createNode=function(l){return l?function(q){return a.create(l,{innerHTML:q})}:f._createSpan};f._createTrTd=function(l){var q=a.create("tr");a.create("td",{innerHTML:l},q);return q};f._createSpan=function(l){return a.create("span",{innerHTML:l})};f._defaultCreatorNodes={ul:"li",ol:"li",
div:"div",p:"div"};f._defaultCreator=function(l){l=l.tagName.toLowerCase();var q="tbody"==l||"thead"==l?f._createTrTd:f._createNode(f._defaultCreatorNodes[l]);return function(t,v){var w=t&&n.isObject(t);if(w&&t.tagName&&t.nodeType&&t.getAttribute){var x=t.getAttribute("dndData")||t.innerHTML;w=(w=t.getAttribute("dndType"))?w.split(/\s*,\s*/):["text"]}else x=w&&t.data?t.data:t,w=w&&t.type?t.type:["text"],t=("avatar"==v?f._createSpan:q)(String(x));t.id||(t.id=f.getUniqueId());return{node:t,data:x,type:w}}};
return u})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(G,u,r,n,m,k,d,a,b,e,g,h,c,f){var l=u("dojo.dnd.Manager",[k],{constructor:function(){this.source=this.avatar=null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:d("touch")?4:16,OFFSET_Y:d("touch")?4:16,overSource:function(q){this.avatar&&
(this.target=q&&"Disabled"!=q.targetState?q:null,this.canDropFlag=!!this.target,this.avatar.update());e.publish("/dnd/source/over",q)},outSource:function(q){this.avatar?this.target==q&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),e.publish("/dnd/source/over",null)):e.publish("/dnd/source/over",null)},startDrag:function(q,t,v){function w(x){x.preventDefault();x.stopPropagation()}c.autoScrollStart(n.doc);this.source=q;this.nodes=t;this.copy=!!v;this.avatar=this.makeAvatar();n.body().appendChild(this.avatar.node);
e.publish("/dnd/start",q,t,this.copy);this.events=[b(n.doc,g.move,r.hitch(this,"onMouseMove")),b(n.doc,g.release,r.hitch(this,"onMouseUp")),b(n.doc,"keydown",r.hitch(this,"onKeyDown")),b(n.doc,"keyup",r.hitch(this,"onKeyUp")),b(n.doc,"dragstart",w),b(n.body(),"selectstart",w)];q="dojoDnd"+(v?"Copy":"Move");m.add(n.body(),q)},canDrop:function(q){q=!(!this.target||!q);this.canDropFlag!=q&&(this.canDropFlag=q,this.avatar.update())},stopDrag:function(){m.remove(n.body(),["dojoDndCopy","dojoDndMove"]);
G.forEach(this.events,function(q){q.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new f(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(q){var t=this.avatar;t&&(c.autoScrollNodes(q),t=t.node.style,t.left=q.pageX+this.OFFSET_X+"px",t.top=q.pageY+this.OFFSET_Y+"px",t=!!this.source.copyState(h.getCopyKeyState(q)),this.copy!=t&&this._setCopyStatus(t));d("touch")&&q.preventDefault()},onMouseUp:function(q){if(this.avatar){if(this.target&&
this.canDropFlag){var t=!!this.source.copyState(h.getCopyKeyState(q));e.publish("/dnd/drop/before",this.source,this.nodes,t,this.target,q);e.publish("/dnd/drop",this.source,this.nodes,t,this.target,q)}else e.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(q){if(this.avatar)switch(q.keyCode){case a.CTRL:q=!!this.source.copyState(!0);this.copy!=q&&this._setCopyStatus(q);break;case a.ESCAPE:e.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(q){this.avatar&&q.keyCode==a.CTRL&&(q=
!!this.source.copyState(!1),this.copy!=q&&this._setCopyStatus(q))},_setCopyStatus:function(q){this.copy=q;this.source._markDndStatus(this.copy);this.updateAvatar();m.replace(n.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});h._manager=null;l.manager=h.manager=function(){h._manager||(h._manager=new l);return h._manager};return l})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),
function(G,u,r,n,m,k,d,a){return G("dojo.dnd.Avatar",null,{constructor:function(b){this.manager=b;this.construct()},construct:function(){var b=k.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),e=this.manager.source,g=k.create("tbody",null,b),h=k.create("tr",null,g),c=k.create("td",null,h),f=Math.min(5,this.manager.nodes.length),l=0;d("highcontrast")&&k.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},c);k.create("span",{innerHTML:e.generateText?
this._generateText():""},c);for(n.set(h,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});l<f;++l){if(e.creator)var q=e._normalizedCreator(e.getItem(this.manager.nodes[l].id).data,"avatar").node;else q=this.manager.nodes[l].cloneNode(!0),"tr"==q.tagName.toLowerCase()&&(h=k.create("table"),k.create("tbody",null,h).appendChild(q),q=h);q.id="";h=k.create("tr",null,g);c=k.create("td",null,h);c.appendChild(q);n.set(h,{"class":"dojoDndAvatarItem",style:{opacity:(9-l)/10}})}this.node=b},destroy:function(){k.destroy(this.node);
this.node=!1},update:function(){m.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(d("highcontrast")){var b=r.byId("a11yIcon"),e="+";this.manager.canDropFlag&&!this.manager.copy?e="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||(e="x"):e="o";b.innerHTML=e}a("tr.dojoDndAvatarHeader td span"+(d("highcontrast")?" span":""),this.node).forEach(function(g){g.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},
"dojox/html/metrics":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/sniff dojo/ready dojo/_base/unload dojo/_base/window dojo/dom-geometry".split(" "),function(G,u,r,n,m,k,d){var a=u.getObject("dojox.html.metrics",!0),b=u.getObject("dojox");a.getFontMeasurements=function(){var l={"1em":0,"1ex":0,"100%":0,"12pt":0,"16px":0,"xx-small":0,"x-small":0,small:0,medium:0,large:0,"x-large":0,"xx-large":0};if(r("ie")){var q=k.doc.documentElement.style.fontSize||"";q||(k.doc.documentElement.style.fontSize=
"100%")}var t=k.doc.createElement("div"),v=t.style;v.position="absolute";v.left="-100px";v.top="0";v.width="30px";v.height="1000em";v.borderWidth="0";v.margin="0";v.padding="0";v.outline="0";v.lineHeight="1";v.overflow="hidden";k.body().appendChild(t);for(var w in l)v.fontSize=w,l[w]=16*Math.round(12*t.offsetHeight/16)/12/1E3;r("ie")&&(k.doc.documentElement.style.fontSize=q);k.body().removeChild(t);t=null;return l};var e=null;a.getCachedFontMeasurements=function(l){if(l||!e)e=a.getFontMeasurements();
return e};var g=null,h={};a.getTextBox=function(l,q,t){if(g)var v=g;else{v=g=k.doc.createElement("div");v.style.whiteSpace="nowrap";var w=k.doc.createElement("div");w.appendChild(v);var x=w.style;x.overflow="scroll";x.position="absolute";x.left="0px";x.top="-10000px";x.width="1px";x.height="1px";x.visibility="hidden";x.borderWidth="0";x.margin="0";x.padding="0";x.outline="0";k.body().appendChild(w)}v.className="";x=v.style;x.borderWidth="0";x.margin="0";x.padding="0";x.outline="0";if(1<arguments.length&&
q)for(var H in q)H in h||(x[H]=q[H]);2<arguments.length&&t&&(v.className=t);v.innerHTML=l;x=d.position(v);x.w=v.parentNode.scrollWidth;return x};var c=16,f=16;a.getScrollbar=function(){return{w:c,h:f}};a._fontResizeNode=null;a.initOnFontResize=function(l){var q=a._fontResizeNode=k.doc.createElement("iframe");l=q.style;l.position="absolute";l.width="5em";l.height="10em";l.top="-10000px";l.display="none";r("ie")?q.onreadystatechange=function(){"complete"==q.contentWindow.document.readyState&&(q.onresize=
q.contentWindow.parent[b._scopeName].html.metrics._fontresize)}:q.onload=function(){q.contentWindow.onresize=q.contentWindow.parent[b._scopeName].html.metrics._fontresize};q.setAttribute("src","javascript:'\x3chtml\x3e\x3chead\x3e\x3cscript\x3eif(\"loadFirebugConsole\" in window){window.loadFirebugConsole();}\x3c/script\x3e\x3c/head\x3e\x3cbody\x3e\x3c/body\x3e\x3c/html\x3e'");k.body().appendChild(q);a.initOnFontResize=function(){}};a.onFontResize=function(){};a._fontresize=function(){a.onFontResize()};
m.addOnUnload(function(){var l=a._fontResizeNode;l&&(r("ie")&&l.onresize?l.onresize=null:l.contentWindow&&l.contentWindow.onresize&&(l.contentWindow.onresize=null),a._fontResizeNode=null)});n(function(){try{var l=k.doc.createElement("div");l.style.cssText="top:0;left:0;width:100px;height:100px;overflow:scroll;position:absolute;visibility:hidden;";k.body().appendChild(l);c=l.offsetWidth-l.clientWidth;f=l.offsetHeight-l.clientHeight;k.body().removeChild(l);delete l}catch(q){}"fontSizeWatch"in G.config&&
G.config.fontSizeWatch&&a.initOnFontResize()});return a})},"dojox/grid/_Builder":function(){define("../main dojo/_base/array dojo/_base/lang dojo/_base/window dojo/_base/event dojo/_base/sniff dojo/_base/connect dojo/dnd/Moveable dojox/html/metrics ./util dojo/_base/html dojo/dom-geometry".split(" "),function(G,u,r,n,m,k,d,a,b,e,g,h){var c=G.grid,f=function(A){return 0<=A.rowIndex?A.rowIndex:u.indexOf(A.parentNode.childNodes,A)},l=function(A,z){return A&&((A.rows||0)[z]||A.childNodes[z])},q=function(A){for(;A&&
"TABLE"!=A.tagName;A=A.parentNode);return A},t=function(A){var z=A.toUpperCase();return function(E){return E.tagName!=z}},v=e.rowIndexTag,w=e.gridViewTag,x=c._Builder=r.extend(function(A){A&&(this.view=A,this.grid=A.grid)},{view:null,_table:'\x3ctable class\x3d"dojoxGridRowTable" border\x3d"0" cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"presentation"',getTableArray:function(){var A=[this._table];this.view.viewWidth&&A.push([' style\x3d"width:',this.view.viewWidth,';"'].join(""));A.push("\x3e");
return A},generateCellMarkup:function(A,z,E,J){var D=[];if(J){var L=A.index!=A.grid.getSortIndex()?"":0<A.grid.sortInfo?'aria-sort\x3d"ascending"':'aria-sort\x3d"descending"';A.id||(A.id=this.grid.id+"Hdr"+A.index);L=['\x3cth tabIndex\x3d"-1" aria-readonly\x3d"true" role\x3d"columnheader"',L,' id\x3d"',A.id,'"']}else L=['\x3ctd tabIndex\x3d"-1" role\x3d"gridcell"',this.grid.editable&&!A.editable?'aria-readonly\x3d"true"':""];A.colSpan&&L.push(' colspan\x3d"',A.colSpan,'"');A.rowSpan&&L.push(' rowspan\x3d"',
A.rowSpan,'"');L.push(' class\x3d"dojoxGridCell ');A.classes&&L.push(A.classes," ");E&&L.push(E," ");D.push(L.join(""));D.push("");L=['" idx\x3d"',A.index,'" style\x3d"'];z&&";"!=z[z.length-1]&&(z+=";");L.push(A.styles,z||"",A.hidden?"display:none;":"");A.unitWidth&&L.push("width:",A.unitWidth,";");D.push(L.join(""));D.push("");L=['"'];A.attrs&&L.push(" ",A.attrs);L.push("\x3e");D.push(L.join(""));D.push("");D.push(J?"\x3c/th\x3e":"\x3c/td\x3e");return D},isCellNode:function(A){return!(!A||A==n.doc||
!g.attr(A,"idx"))},getCellNodeIndex:function(A){return A?Number(g.attr(A,"idx")):-1},getCellNode:function(A,z){for(var E=0,J;(J=l(A.firstChild,E))&&J.cells;E++)for(var D=0,L;L=J.cells[D];D++)if(this.getCellNodeIndex(L)==z)return L;return null},findCellTarget:function(A,z){for(;A&&(!this.isCellNode(A)||A.offsetParent&&w in A.offsetParent.parentNode&&A.offsetParent.parentNode[w]!=this.view.id)&&A!=z;)A=A.parentNode;return A!=z?A:null},baseDecorateEvent:function(A){A.dispatch="do"+A.type;A.grid=this.grid;
A.sourceView=this.view;A.cellNode=this.findCellTarget(A.target,A.rowNode);A.cellIndex=this.getCellNodeIndex(A.cellNode);A.cell=0<=A.cellIndex?this.grid.getCell(A.cellIndex):null},findTarget:function(A,z){for(;A&&A!=this.domNode&&(!(z in A)||w in A&&A[w]!=this.view.id);)A=A.parentNode;return A!=this.domNode?A:null},findRowTarget:function(A){return this.findTarget(A,v)},isIntraNodeEvent:function(A){try{return A.cellNode&&A.relatedTarget&&g.isDescendant(A.relatedTarget,A.cellNode)}catch(z){return!1}},
isIntraRowEvent:function(A){try{var z=A.relatedTarget&&this.findRowTarget(A.relatedTarget);return!z&&-1==A.rowIndex||z&&A.rowIndex==z.gridRowIndex}catch(E){return!1}},dispatchEvent:function(A){return A.dispatch in this?this[A.dispatch](A):!1},domouseover:function(A){A.cellNode&&A.cellNode!=this.lastOverCellNode&&(this.lastOverCellNode=A.cellNode,this.grid.onMouseOver(A));this.grid.onMouseOverRow(A)},domouseout:function(A){if(A.cellNode&&A.cellNode==this.lastOverCellNode&&!this.isIntraNodeEvent(A,
this.lastOverCellNode)&&(this.lastOverCellNode=null,this.grid.onMouseOut(A),!this.isIntraRowEvent(A)))this.grid.onMouseOutRow(A)},domousedown:function(A){if(A.cellNode)this.grid.onMouseDown(A);this.grid.onMouseDownRow(A)},_getTextDirStyle:function(A,z,E){return""}});G=c._ContentBuilder=r.extend(function(A){x.call(this,A)},x.prototype,{update:function(){this.prepareHtml()},prepareHtml:function(){for(var A=this.grid.get,z=this.view.structure.cells,E=0,J;J=z[E];E++)for(var D=0,L;L=J[D];D++)L.get=L.get||
void 0==L.value&&A,L.markup=this.generateCellMarkup(L,L.cellStyles,L.cellClasses,!1),!this.grid.editable&&L.editable&&(this.grid.editable=!0)},generateHtml:function(A,z){A=this.getTableArray();var E=this.view.structure.cells,J=this.grid.getItem(z);e.fire(this.view,"onBeforeRow",[z,E]);for(var D=0,L;L=E[D];D++)if(!L.hidden&&!L.header){A.push(L.invisible?'\x3ctr class\x3d"dojoxGridInvisible"\x3e':"\x3ctr\x3e");for(var C=0,N,S,F;N=L[C];C++){S=N.markup;var T=N.customClasses=[];F=N.customStyles=[];S[5]=
N.format(z,J);S[1]=T.join(" ");S[3]=F.join(";");(T=N.textDir||this.grid.textDir)&&(S[3]+=this._getTextDirStyle(T,N,z));A.push.apply(A,S)}A.push("\x3c/tr\x3e")}A.push("\x3c/table\x3e");return A.join("")},decorateEvent:function(A){A.rowNode=this.findRowTarget(A.target);if(!A.rowNode)return!1;A.rowIndex=A.rowNode[v];this.baseDecorateEvent(A);A.cell=this.grid.getCell(A.cellIndex);return!0}});var H=c._HeaderBuilder=r.extend(function(A){this.moveable=null;x.call(this,A)},x.prototype,{_skipBogusClicks:!1,
overResizeWidth:4,minColWidth:1,update:function(){this.tableMap?this.tableMap.mapRows(this.view.structure.cells):this.tableMap=new c._TableMap(this.view.structure.cells)},generateHtml:function(A,z){var E,J=this.getTableArray(),D=this.view.structure.cells;e.fire(this.view,"onBeforeRow",[-1,D]);for(var L=0,C;C=D[L];L++)if(!C.hidden){J.push(C.invisible?'\x3ctr class\x3d"dojoxGridInvisible"\x3e':"\x3ctr\x3e");for(var N=0,S,F;S=C[N];N++)S.customClasses=[],S.customStyles=[],this.view.simpleStructure&&(S.draggable&&
(S.headerClasses?-1==S.headerClasses.indexOf("dojoDndItem")&&(S.headerClasses+=" dojoDndItem"):S.headerClasses="dojoDndItem"),S.attrs?-1==S.attrs.indexOf("dndType\x3d'gridColumn_")&&(S.attrs+=" dndType\x3d'gridColumn_"+this.grid.id+"'"):S.attrs="dndType\x3d'gridColumn_"+this.grid.id+"'"),F=this.generateCellMarkup(S,S.headerStyles,S.headerClasses,!0),F[5]=void 0!=z?z:A(S),F[3]=S.customStyles.join(";"),(E=S.textDir||this.grid.textDir)&&(F[3]+=this._getTextDirStyle(E,S,z)),F[1]=S.customClasses.join(" "),
J.push(F.join(""));J.push("\x3c/tr\x3e")}J.push("\x3c/table\x3e");return J.join("")},getCellX:function(A){var z=t("th");for(var E=A.target;E&&z(E);E=E.parentNode);(z=E)?(z=h.position(z),A=A.clientX-z.x):A=A.layerX;return A},decorateEvent:function(A){this.baseDecorateEvent(A);A.rowIndex=-1;A.cellX=this.getCellX(A);return!0},prepareResize:function(A,z){do{var E=A.cellIndex;A.cellNode=E?A.cellNode.parentNode.cells[E+z]:null;A.cellIndex=A.cellNode?this.getCellNodeIndex(A.cellNode):-1}while(A.cellNode&&
"none"==A.cellNode.style.display);return!!A.cellNode},canResize:function(A){if(!A.cellNode||1<A.cellNode.colSpan)return!1;A=this.grid.getCell(A.cellIndex);return!A.noresize&&A.canResize()},overLeftResizeArea:function(A){if(g.hasClass(n.body(),"dojoDndMove"))return!1;if(k("ie")){var z=A.target;if(g.hasClass(z,"dojoxGridArrowButtonNode")||g.hasClass(z,"dojoxGridArrowButtonChar")||g.hasClass(z,"dojoxGridColCaption"))return!1}return this.grid.isLeftToRight()?0<A.cellIndex&&0<A.cellX&&A.cellX<this.overResizeWidth&&
this.prepareResize(A,-1):A.cellNode&&0<A.cellX&&A.cellX<this.overResizeWidth},overRightResizeArea:function(A){if(g.hasClass(n.body(),"dojoDndMove"))return!1;if(k("ie")){var z=A.target;if(g.hasClass(z,"dojoxGridArrowButtonNode")||g.hasClass(z,"dojoxGridArrowButtonChar")||g.hasClass(z,"dojoxGridColCaption"))return!1}return this.grid.isLeftToRight()?A.cellNode&&A.cellX>=A.cellNode.offsetWidth-this.overResizeWidth:0<A.cellIndex&&A.cellX>=A.cellNode.offsetWidth-this.overResizeWidth&&this.prepareResize(A,
-1)},domousemove:function(A){if(!this.moveable){var z=this.overRightResizeArea(A)?"dojoxGridColResize":this.overLeftResizeArea(A)?"dojoxGridColResize":"";z&&!this.canResize(A)&&(z="dojoxGridColNoResize");g.toggleClass(A.sourceView.headerNode,"dojoxGridColNoResize","dojoxGridColNoResize"==z);g.toggleClass(A.sourceView.headerNode,"dojoxGridColResize","dojoxGridColResize"==z);z&&m.stop(A)}},domousedown:function(A){this.moveable||((this.overRightResizeArea(A)||this.overLeftResizeArea(A))&&this.canResize(A)?
this.beginColumnResize(A):(this.grid.onMouseDown(A),this.grid.onMouseOverRow(A)))},doclick:function(A){return this._skipBogusClicks?(m.stop(A),!0):!1},colResizeSetup:function(A,z){var E=g.contentBox(A.sourceView.headerNode);if(z){this.lineDiv=document.createElement("div");z=g.position(A.sourceView.headerNode,!0);var J=g.contentBox(A.sourceView.domNode),D=A.pageX;!this.grid.isLeftToRight()&&8>k("ie")&&(D-=b.getScrollbar().w);g.style(this.lineDiv,{top:z.y+"px",left:D+"px",height:J.h+E.h+"px"});g.addClass(this.lineDiv,
"dojoxGridResizeColLine");this.lineDiv._origLeft=D;n.body().appendChild(this.lineDiv)}z=[];J=this.tableMap.findOverlappingNodes(A.cellNode);D=0;for(var L;L=J[D];D++)z.push({node:L,index:this.getCellNodeIndex(L),width:L.offsetWidth});J=A.sourceView;L=this.grid.isLeftToRight()?1:-1;var C=A.grid.views.views;D=[];for(var N=J.idx+L,S;S=C[N];N+=L)D.push({node:S.headerNode,left:window.parseInt(S.headerNode.style.left)});L=J.headerContentNode.firstChild;return{scrollLeft:A.sourceView.headerNode.scrollLeft,
view:J,node:A.cellNode,index:A.cellIndex,w:g.contentBox(A.cellNode).w,vw:E.w,table:L,tw:g.contentBox(L).w,spanners:z,followers:D}},beginColumnResize:function(A){this.moverDiv=document.createElement("div");g.style(this.moverDiv,{position:"absolute",left:0});n.body().appendChild(this.moverDiv);g.addClass(this.grid.domNode,"dojoxGridColumnResizing");var z=this.moveable=new a(this.moverDiv),E=this.colResizeSetup(A,!0);z.onMove=r.hitch(this,"doResizeColumn",E);d.connect(z,"onMoveStop",r.hitch(this,function(){this.endResizeColumn(E);
E.node.releaseCapture&&E.node.releaseCapture();this.moveable.destroy();delete this.moveable;this.moveable=null;g.removeClass(this.grid.domNode,"dojoxGridColumnResizing")}));A.cellNode.setCapture&&A.cellNode.setCapture();z.onMouseDown(A)},doResizeColumn:function(A,z,E){var J=E.l;J={deltaX:J,w:A.w+(this.grid.isLeftToRight()?J:-J),vw:A.vw+J,tw:A.tw+J};this.dragRecord={inDrag:A,mover:z,leftTop:E};J.w>=this.minColWidth&&(z?g.style(this.lineDiv,"left",this.lineDiv._origLeft+J.deltaX+"px"):this.doResizeNow(A,
J))},endResizeColumn:function(A){if(this.dragRecord){var z=this.dragRecord.leftTop;z=this.grid.isLeftToRight()?z.l:-z.l;z+=Math.max(A.w+z,this.minColWidth)-(A.w+z);k("webkit")&&A.spanners.length&&(z+=g._getPadBorderExtents(A.spanners[0].node).w);this.doResizeNow(A,{deltaX:z,w:A.w+z,vw:A.vw+z,tw:A.tw+z});delete this.dragRecord}g.destroy(this.lineDiv);g.destroy(this.moverDiv);g.destroy(this.moverDiv);delete this.moverDiv;this._skipBogusClicks=!0;A.view.update();this._skipBogusClicks=!1;this.grid.onResizeColumn(A.index)},
doResizeNow:function(A,z){A.view.convertColPctToFixed();if(A.view.flexCells&&!A.view.testFlexCells()){var E=q(A.node);E&&(E.style.width="")}var J;for(E=0;J=A.spanners[E];E++){var D=J.width+z.deltaX;0<D&&(J.node.style.width=D+"px",A.view.setColWidth(J.index,D))}if(this.grid.isLeftToRight()||!k("ie"))for(E=0;J=A.followers[E];E++)D=J.left+z.deltaX,J.node.style.left=D+"px";A.node.style.width=z.w+"px";A.view.setColWidth(A.index,z.w);A.view.headerNode.style.width=z.vw+"px";A.view.setColumnsWidth(z.tw);
this.grid.isLeftToRight()||(A.view.headerNode.scrollLeft=A.scrollLeft+z.deltaX)}});c._TableMap=r.extend(function(A){this.mapRows(A)},{map:null,mapRows:function(A){if(A.length){this.map=[];for(var z,E=0;z=A[E];E++)this.map[E]=[];for(E=0;z=A[E];E++)for(var J=0,D=0,L,C;L=z[J];J++){for(;this.map[E][D];)D++;this.map[E][D]={c:J,r:E};C=L.rowSpan||1;L=L.colSpan||1;for(var N=0;N<C;N++)for(var S=0;S<L;S++)this.map[E+N][D+S]=this.map[E][D];D+=L}}},dumpMap:function(){for(var A=0,z;z=this.map[A];A++)for(var E=
0;z[E];E++);},getMapCoords:function(A,z){for(var E=0,J;J=this.map[E];E++)for(var D=0,L;L=J[D];D++)if(L.c==z&&L.r==A)return{j:E,i:D};return{j:-1,i:-1}},getNode:function(A,z,E){return(A=A&&A.rows[z])&&A.cells[E]},_findOverlappingNodes:function(A,z,E){var J=[];z=this.getMapCoords(z,E);E=0;for(var D;D=this.map[E];E++)E!=z.j&&(D=(D=D[z.i])?this.getNode(A,D.r,D.c):null)&&J.push(D);return J},findOverlappingNodes:function(A){return this._findOverlappingNodes(q(A),f(A.parentNode),0<=A.cellIndex?A.cellIndex:
u.indexOf(A.parentNode.cells,A))}});return{_Builder:x,_HeaderBuilder:H,_ContentBuilder:G}})},"dojox/grid/_ViewManager":function(){define(["dojo/_base/declare","dojo/_base/sniff","dojo/dom-class"],function(G,u,r){return G("dojox.grid._ViewManager",null,{constructor:function(n){this.grid=n},defaultWidth:200,views:[],resize:function(){this.onEach("resize")},render:function(){this.onEach("render")},addView:function(n){n.idx=this.views.length;this.views.push(n)},destroyViews:function(){for(var n=0,m;m=
this.views[n];n++)m.destroy();this.views=[]},getContentNodes:function(){for(var n=[],m=0,k;k=this.views[m];m++)n.push(k.contentNode);return n},forEach:function(n){for(var m=0,k;k=this.views[m];m++)n(k,m)},onEach:function(n,m){m=m||[];for(var k=0,d;d=this.views[k];k++)n in d&&d[n].apply(d,m)},normalizeHeaderNodeHeight:function(){for(var n=[],m=0,k;k=this.views[m];m++)k.headerContentNode.firstChild&&n.push(k.headerContentNode);this.normalizeRowNodeHeights(n)},normalizeRowNodeHeights:function(n){var m=
0,k=[];if(this.grid.rowHeight)m=this.grid.rowHeight;else{if(1>=n.length)return;for(var d=0,a;a=n[d];d++)r.contains(a,"dojoxGridNonNormalizedCell")||(k[d]=a.firstChild.offsetHeight,m=Math.max(m,k[d]));m=0<=m?m:0;(u("mozilla")||8<u("ie"))&&m&&m++}for(d=0;a=n[d];d++)k[d]!=m&&(a.firstChild.style.height=m+"px")},resetHeaderNodeHeight:function(){for(var n=0,m;m=this.views[n];n++)if(m=m.headerContentNode.firstChild)m.style.height=""},renormalizeRow:function(n){for(var m=[],k=0,d,a;(d=this.views[k])&&(a=
d.getRowNode(n));k++)a.firstChild.style.height="",m.push(a);this.normalizeRowNodeHeights(m)},getViewWidth:function(n){return this.views[n].getWidth()||this.defaultWidth},measureHeader:function(){this.resetHeaderNodeHeight();this.forEach(function(m){m.headerContentNode.style.height=""});var n=0;this.forEach(function(m){n=Math.max(m.headerNode.offsetHeight,n)});return n},measureContent:function(){var n=0;this.forEach(function(m){n=Math.max(m.domNode.offsetHeight,n)});return n},findClient:function(n){n=
this.grid.elasticView||-1;if(0>n)for(var m=1,k;k=this.views[m];m++)if(k.viewWidth){for(m=1;k=this.views[m];m++)if(!k.viewWidth){n=m;break}break}0>n&&(n=Math.floor(this.views.length/2));return n},arrange:function(n,m){var k,d,a=this.views.length,b=this,e=0>=m?a:this.findClient(),g=function(f,l){var q=f.domNode.style,t=f.headerNode.style;b.grid.isLeftToRight()?(q.left=l+"px",t.left=l+"px"):(q.right=l+"px",4>u("ff")?t.right=l+f.getScrollbarWidth()+"px":t.right=l+"px",u("webkit")||"auto"==t.width||(t.width=
parseInt(t.width,10)-f.getScrollbarWidth()+"px"));q.top="0px";t.top=0};for(k=0;(d=this.views[k])&&k<e;k++){var h=this.getViewWidth(k);d.setSize(h,0);g(d,n);h=d.headerContentNode&&d.headerContentNode.firstChild?d.getColumnsWidth()+d.getScrollbarWidth():d.domNode.offsetWidth;n+=h}k++;for(var c=a-1;(d=this.views[c])&&k<=c;c--)h=this.getViewWidth(c),d.setSize(h,0),h=d.domNode.offsetWidth,m-=h,g(d,m);e<a&&(d=this.views[e],h=Math.max(1,m-n),d.setSize(h+"px",0),g(d,n));return n},renderRow:function(n,m,k){for(var d=
[],a=0,b,e;(b=this.views[a])&&(e=m[a]);a++)b=b.renderRow(n),e.appendChild(b),d.push(b);k||this.normalizeRowNodeHeights(d)},rowRemoved:function(n){this.onEach("rowRemoved",[n])},updateRow:function(n,m){for(var k=0,d;d=this.views[k];k++)d.updateRow(n);m||this.renormalizeRow(n)},updateRowStyles:function(n){this.onEach("updateRowStyles",[n])},setScrollTop:function(n){for(var m=n,k=0,d;d=this.views[k];k++)m=d.setScrollTop(n),u("ie")&&d.headerNode&&d.scrollboxNode&&(d.headerNode.scrollLeft=d.scrollboxNode.scrollLeft);
return m},getFirstScrollingView:function(){for(var n=0,m;m=this.views[n];n++)if(m.hasHScrollbar()||m.hasVScrollbar())return m;return null}})})},"dojox/grid/_RowManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-class"],function(G,u,r){return G("dojox.grid._RowManager",null,{constructor:function(n){this.grid=n},linesToEms:2,overRow:-2,prepareStylingRow:function(n,m){return{index:n,node:m,odd:!!(n&1),selected:!!this.grid.selection.isSelected(n),over:this.isOver(n),customStyles:"",
customClasses:"dojoxGridRow"}},styleRowNode:function(n,m){n=this.prepareStylingRow(n,m);this.grid.onStyleRow(n);this.applyStyles(n)},applyStyles:function(n){n.node.className=n.customClasses;var m=n.node.style.height,k=n.node,d=n.customStyles+";"+(n.node._style||"");void 0==k.style.cssText?k.setAttribute("style",d):k.style.cssText=d;n.node.style.height=m},updateStyles:function(n){this.grid.updateRowStyles(n)},setOverRow:function(n){var m=this.overRow;this.overRow=n;m!=this.overRow&&(u.isString(m)||
0<=m)&&this.updateStyles(m);this.updateStyles(this.overRow)},isOver:function(n){return this.overRow==n&&!r.contains(this.grid.domNode,"dojoxGridColumnResizing")}})})},"dojox/grid/_FocusManager":function(){define("dojo/_base/array dojo/_base/lang dojo/_base/declare dojo/_base/connect dojo/_base/event dojo/_base/sniff dojo/query ./util dojo/_base/html".split(" "),function(G,u,r,n,m,k,d,a,b){return r("dojox.grid._FocusManager",null,{constructor:function(e){this.grid=e;this.cell=null;this.rowIndex=-1;
this._connects=[];this._headerConnects=[];this.headerMenu=this.grid.headerMenu;this._connects.push(n.connect(this.grid.domNode,"onfocus",this,"doFocus"));this._connects.push(n.connect(this.grid.domNode,"onblur",this,"doBlur"));this._connects.push(n.connect(this.grid.domNode,"mousedown",this,"_mouseDown"));this._connects.push(n.connect(this.grid.domNode,"mouseup",this,"_mouseUp"));this._connects.push(n.connect(this.grid.domNode,"oncontextmenu",this,"doContextMenu"));this._connects.push(n.connect(this.grid.lastFocusNode,
"onfocus",this,"doLastNodeFocus"));this._connects.push(n.connect(this.grid.lastFocusNode,"onblur",this,"doLastNodeBlur"));this._connects.push(n.connect(this.grid,"_onFetchComplete",this,"_delayedCellFocus"));this._connects.push(n.connect(this.grid,"postrender",this,"_delayedHeaderFocus"))},destroy:function(){G.forEach(this._connects,n.disconnect);G.forEach(this._headerConnects,n.disconnect);delete this.grid;delete this.cell},_colHeadNode:null,_colHeadFocusIdx:null,_contextMenuBindNode:null,tabbingOut:!1,
focusClass:"dojoxGridCellFocus",focusView:null,initFocusView:function(){this.focusView=this.grid.views.getFirstScrollingView()||this.focusView||this.grid.views.views[0];this._initColumnHeaders()},isFocusCell:function(e,g){return this.cell==e&&this.rowIndex==g},isLastFocusCell:function(){return this.cell?this.rowIndex==this.grid.rowCount-1&&this.cell.index==this.grid.layout.cellCount-1:!1},isFirstFocusCell:function(){return this.cell?0===this.rowIndex&&0===this.cell.index:!1},isNoFocusCell:function(){return 0>
this.rowIndex||!this.cell},isNavHeader:function(){return!!this._colHeadNode},getHeaderIndex:function(){return this._colHeadNode?G.indexOf(this._findHeaderCells(),this._colHeadNode):-1},_focusifyCellNode:function(e){var g=this.cell&&this.cell.getNode(this.rowIndex);if(g&&(b.toggleClass(g,this.focusClass,e),e)){e=this.scrollIntoView();try{if(k("webkit")||!this.grid.edit.isEditing())a.fire(g,"focus"),e&&(this.cell.view.scrollboxNode.scrollLeft=e)}catch(h){}}},_delayedCellFocus:function(){if(!this.isNavHeader()&&
this.grid.focused){var e=this.cell&&this.cell.getNode(this.rowIndex);if(e)try{this.grid.edit.isEditing()||(b.toggleClass(e,this.focusClass,!0),this._colHeadNode&&this.blurHeader(),a.fire(e,"focus"))}catch(g){}}},_delayedHeaderFocus:function(){this.isNavHeader()&&this.focusHeader()},_initColumnHeaders:function(){G.forEach(this._headerConnects,n.disconnect);this._headerConnects=[];for(var e=this._findHeaderCells(),g=0;g<e.length;g++)this._headerConnects.push(n.connect(e[g],"onfocus",this,"doColHeaderFocus")),
this._headerConnects.push(n.connect(e[g],"onblur",this,"doColHeaderBlur"))},_findHeaderCells:function(){for(var e=d("th",this.grid.viewsHeaderNode),g=[],h=0;h<e.length;h++){var c=e[h],f=b.hasAttr(c,"tabIndex"),l=b.attr(c,"tabIndex");f&&0>l&&g.push(c)}return g},_setActiveColHeader:function(e,g,h){this.grid.domNode.setAttribute("aria-activedescendant",e.id);null!=h&&0<=h&&h!=g&&b.toggleClass(this._findHeaderCells()[h],this.focusClass,!1);b.toggleClass(e,this.focusClass,!0);this._colHeadNode=e;this._colHeadFocusIdx=
g;this._scrollHeader(this._colHeadFocusIdx)},scrollIntoView:function(){var e=this.cell?this._scrollInfo(this.cell):null;if(!e||!e.s)return null;var g=this.grid.scroller.findScrollTop(this.rowIndex);e.n&&e.sr&&(e.n.offsetLeft+e.n.offsetWidth>e.sr.l+e.sr.w?e.s.scrollLeft=e.n.offsetLeft+e.n.offsetWidth-e.sr.w:e.n.offsetLeft<e.sr.l&&(e.s.scrollLeft=e.n.offsetLeft));e.r&&e.sr&&(g+e.r.offsetHeight>e.sr.t+e.sr.h?this.grid.setScrollTop(g+e.r.offsetHeight-e.sr.h):g<e.sr.t&&this.grid.setScrollTop(g));return e.s.scrollLeft},
_scrollInfo:function(e,g){if(e){var h=e.view.scrollboxNode,c={w:h.clientWidth,l:h.scrollLeft,t:h.scrollTop,h:h.clientHeight},f=e.view.getRowNode(this.rowIndex);return{c:e,s:h,sr:c,n:g?g:e.getNode(this.rowIndex),r:f}}return null},_scrollHeader:function(e){var g=null;if(this._colHeadNode){var h=this.grid.getCell(e);if(!h)return;g=this._scrollInfo(h,h.getNode(0))}g&&g.s&&g.sr&&g.n&&(g.n.offsetLeft+g.n.offsetWidth>g.sr.l+g.sr.w?g.s.scrollLeft=g.n.offsetLeft+g.n.offsetWidth-g.sr.w:g.n.offsetLeft<g.sr.l?
g.s.scrollLeft=g.n.offsetLeft:7>=k("ie")&&h&&h.view.headerNode&&(h.view.headerNode.scrollLeft=g.s.scrollLeft))},_isHeaderHidden:function(){var e=this.focusView;if(!e)for(var g=0,h;h=this.grid.views.views[g];g++)if(h.headerNode){e=h;break}return e&&"none"==b.getComputedStyle(e.headerNode).display},colSizeAdjust:function(e,g,h){var c=this._findHeaderCells(),f=this.focusView;if(!f||!f.header.tableMap.map)for(var l=0,q;q=this.grid.views.views[l];l++)if(q.header.tableMap.map){f=q;break}l=c[g];!f||g==c.length-
1&&0===g||(f.content.baseDecorateEvent(e),e.cellNode=l,e.cellIndex=f.content.getCellNodeIndex(e.cellNode),e.cell=0<=e.cellIndex?this.grid.getCell(e.cellIndex):null,f.header.canResize(e)&&(g={l:h},e=f.header.colResizeSetup(e,!1),f.header.doResizeColumn(e,null,g),f.update()))},styleRow:function(e){},setFocusIndex:function(e,g){this.setFocusCell(this.grid.getCell(g),e)},setFocusCell:function(e,g){e&&!this.isFocusCell(e,g)&&(this.tabbingOut=!1,this._colHeadNode&&this.blurHeader(),this._colHeadNode=this._colHeadFocusIdx=
null,this.focusGridView(),this._focusifyCellNode(!1),this.cell=e,this.rowIndex=g,this._focusifyCellNode(!0));if(k("opera"))setTimeout(u.hitch(this.grid,"onCellFocus",this.cell,this.rowIndex),1);else this.grid.onCellFocus(this.cell,this.rowIndex)},next:function(){if(this.cell){var e=this.rowIndex,g=this.cell.index+1,h=this.grid.layout.cellCount-1,c=this.grid.rowCount-1;g>h&&(g=0,e++);e>c&&(g=h,e=c);if(this.grid.edit.isEditing()&&(h=this.grid.getCell(g),!this.isLastFocusCell()&&(!h.editable||this.grid.canEdit&&
!this.grid.canEdit(h,e)))){this.cell=h;this.rowIndex=e;this.next();return}this.setFocusIndex(e,g)}},previous:function(){if(this.cell){var e=this.rowIndex||0,g=(this.cell.index||0)-1;0>g&&(g=this.grid.layout.cellCount-1,e--);0>e&&(g=e=0);if(this.grid.edit.isEditing()){var h=this.grid.getCell(g);if(!this.isFirstFocusCell()&&!h.editable){this.cell=h;this.rowIndex=e;this.previous();return}}this.setFocusIndex(e,g)}},move:function(e,g){var h=0>g?-1:1;if(this.isNavHeader()){e=this._findHeaderCells();var c=
currentIdx=G.indexOf(e,this._colHeadNode);for(currentIdx+=g;0<=currentIdx&&currentIdx<e.length&&"none"==e[currentIdx].style.display;)currentIdx+=h;0<=currentIdx&&currentIdx<e.length&&this._setActiveColHeader(e[currentIdx],currentIdx,c)}else if(this.cell){var f=this.grid.scroller;c=this.rowIndex;var l=this.grid.rowCount-1,q=Math.min(l,Math.max(0,c+e));e&&(0<e?q>f.getLastPageRow(f.page)&&this.grid.setScrollTop(this.grid.scrollTop+f.findScrollTop(q)-f.findScrollTop(c)):0>e&&q<=f.getPageRow(f.page)&&
this.grid.setScrollTop(this.grid.scrollTop-f.findScrollTop(c)-f.findScrollTop(q)));f=this.grid.layout.cellCount-1;for(var t=this.cell.index,v=Math.min(f,Math.max(0,t+g)),w=this.grid.getCell(v);0<=v&&v<f&&w&&!0===w.hidden;)v+=h,w=this.grid.getCell(v);w&&!0!==w.hidden||(v=t);h=w.getNode(q);!h&&e?0<=q+e&&q+e<=l&&this.move(0<e?++e:--e,g):h&&"none"!==b.style(h,"display")||!g?(this.setFocusIndex(q,v),e&&this.grid.updateRow(c)):0<=v+g&&v+g<=f&&this.move(e,0<g?++g:--g)}},previousKey:function(e){this.grid.edit.isEditing()?
(m.stop(e),this.previous()):this.isNavHeader()||this._isHeaderHidden()?(this.tabOut(this.grid.domNode),null!=this._colHeadFocusIdx&&(b.toggleClass(this._findHeaderCells()[this._colHeadFocusIdx],this.focusClass,!1),this._colHeadFocusIdx=null),this._focusifyCellNode(!1)):(this.grid.domNode.focus(),m.stop(e))},nextKey:function(e){e.target===this.grid.domNode&&null==this._colHeadFocusIdx?(this.focusHeader(),m.stop(e)):this.isNavHeader()?(this.blurHeader(),this.findAndFocusGridCell()||this.tabOut(this.grid.lastFocusNode),
this._colHeadNode=this._colHeadFocusIdx=null):this.grid.edit.isEditing()?(m.stop(e),this.next()):this.tabOut(this.grid.lastFocusNode)},tabOut:function(e){this.tabbingOut=!0;e.focus()},focusGridView:function(){a.fire(this.focusView,"focus")},focusGrid:function(e){this.focusGridView();this._focusifyCellNode(!0)},findAndFocusGridCell:function(){var e=!0,g=0===this.grid.rowCount;this.isNoFocusCell()&&!g?(g=0,this.grid.getCell(g).hidden&&(g=this.isNavHeader()?this._colHeadFocusIdx:0),this.setFocusIndex(0,
g)):this.cell&&!g?(this.focusView&&!this.focusView.rowNodes[this.rowIndex]&&this.grid.scrollToRow(this.rowIndex),this.focusGrid()):e=!1;this._colHeadNode=this._colHeadFocusIdx=null;return e},focusHeader:function(){var e=this._findHeaderCells(),g=this._colHeadFocusIdx;this._isHeaderHidden()?this.findAndFocusGridCell():this._colHeadFocusIdx||(this.isNoFocusCell()?this._colHeadFocusIdx=0:this._colHeadFocusIdx=this.cell.index);for(this._colHeadNode=e[this._colHeadFocusIdx];this._colHeadNode&&0<=this._colHeadFocusIdx&&
this._colHeadFocusIdx<e.length&&"none"==this._colHeadNode.style.display;)this._colHeadFocusIdx++,this._colHeadNode=e[this._colHeadFocusIdx];this._colHeadNode&&"none"!=this._colHeadNode.style.display?(this.headerMenu&&this._contextMenuBindNode!=this.grid.domNode&&(this.headerMenu.unBindDomNode(this.grid.viewsHeaderNode),this.headerMenu.bindDomNode(this.grid.domNode),this._contextMenuBindNode=this.grid.domNode),this._setActiveColHeader(this._colHeadNode,this._colHeadFocusIdx,g),this._scrollHeader(this._colHeadFocusIdx),
this._focusifyCellNode(!1)):this.findAndFocusGridCell()},blurHeader:function(){b.removeClass(this._colHeadNode,this.focusClass);b.removeAttr(this.grid.domNode,"aria-activedescendant");if(this.headerMenu&&this._contextMenuBindNode==this.grid.domNode){var e=this.grid.viewsHeaderNode;this.headerMenu.unBindDomNode(this.grid.domNode);this.headerMenu.bindDomNode(e);this._contextMenuBindNode=e}},doFocus:function(e){e&&e.target!=e.currentTarget?m.stop(e):this._clickFocus||(this.tabbingOut||this.focusHeader(),
this.tabbingOut=!1,m.stop(e))},doBlur:function(e){m.stop(e)},doContextMenu:function(e){this.headerMenu||m.stop(e)},doLastNodeFocus:function(e){this.tabbingOut?this._focusifyCellNode(!1):0<this.grid.rowCount?(this.isNoFocusCell()&&this.setFocusIndex(0,0),this._focusifyCellNode(!0)):this.focusHeader();this.tabbingOut=!1;m.stop(e)},doLastNodeBlur:function(e){m.stop(e)},doColHeaderFocus:function(e){this._setActiveColHeader(e.target,b.attr(e.target,"idx"),this._colHeadFocusIdx);this._scrollHeader(this.getHeaderIndex());
m.stop(e)},doColHeaderBlur:function(e){b.toggleClass(e.target,this.focusClass,!1)},_mouseDown:function(e){this._clickFocus=dojo.some(this.grid.views.views,function(g){return g.scrollboxNode===e.target})},_mouseUp:function(e){this._clickFocus=!1}})})},"dojox/grid/_EditManager":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/connect dojo/_base/sniff ./util".split(" "),function(G,u,r,n,m,k){return r("dojox.grid._EditManager",null,{constructor:function(d){this.grid=d;
this.connections=m("ie")?[n.connect(document.body,"onfocus",G.hitch(this,"_boomerangFocus"))]:[];this.connections.push(n.connect(this.grid,"onBlur",this,"apply"));this.connections.push(n.connect(this.grid,"prerender",this,"_onPreRender"))},info:{},destroy:function(){u.forEach(this.connections,n.disconnect)},cellFocus:function(d,a){this.grid.singleClickEdit||this.isEditRow(a)?this.setEditCell(d,a):this.apply();(this.isEditing()||d&&d.editable&&d.alwaysEditing)&&this._focusEditor(d,a)},rowClick:function(d){this.isEditing()&&
!this.isEditRow(d.rowIndex)&&this.apply()},styleRow:function(d){d.index==this.info.rowIndex&&(d.customClasses+=" dojoxGridRowEditing")},dispatchEvent:function(d){var a=d.cell;return(a=a&&a.editable?a:0)&&a.dispatchEvent(d.dispatch,d)},isEditing:function(){return void 0!==this.info.rowIndex},isEditCell:function(d,a){return this.info.rowIndex===d&&this.info.cell.index==a},isEditRow:function(d){return this.info.rowIndex===d},setEditCell:function(d,a){!this.isEditCell(a,d.index)&&this.grid.canEdit&&this.grid.canEdit(d,
a)&&this.start(d,a,this.isEditRow(a)||d.editable)},_focusEditor:function(d,a){k.fire(d,"focus",[a])},focusEditor:function(){this.isEditing()&&this._focusEditor(this.info.cell,this.info.rowIndex)},_boomerangWindow:500,_shouldCatchBoomerang:function(){return this._catchBoomerang>(new Date).getTime()},_boomerangFocus:function(){this._shouldCatchBoomerang()&&(this.grid.focus.focusGrid(),this.focusEditor(),this._catchBoomerang=0)},_doCatchBoomerang:function(){m("ie")&&(this._catchBoomerang=(new Date).getTime()+
this._boomerangWindow)},start:function(d,a,b){this._isValidInput()&&(this.grid.beginUpdate(),this.editorApply(),this.isEditing()&&!this.isEditRow(a)&&(this.applyRowEdit(),this.grid.updateRow(a)),b?(this.info={cell:d,rowIndex:a},this.grid.doStartEdit(d,a),this.grid.updateRow(a)):this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._focusEditor(d,a),this._doCatchBoomerang())},_editorDo:function(d){var a=this.info.cell;if(a&&a.editable)a[d](this.info.rowIndex)},editorApply:function(){this._editorDo("apply")},
editorCancel:function(){this._editorDo("cancel")},applyCellEdit:function(d,a,b){this.grid.canEdit(a,b)&&this.grid.doApplyCellEdit(d,b,a.field)},applyRowEdit:function(){this.grid.doApplyEdit(this.info.rowIndex,this.info.cell.field)},apply:function(){this.isEditing()&&this._isValidInput()&&(this.grid.beginUpdate(),this.editorApply(),this.applyRowEdit(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._doCatchBoomerang())},cancel:function(){this.isEditing()&&(this.grid.beginUpdate(),
this.editorCancel(),this.info={},this.grid.endUpdate(),this.grid.focus.focusGrid(),this._doCatchBoomerang())},save:function(d,a){var b=this.info.cell;!this.isEditRow(d)||a&&b.view!=a||!b.editable||b.save(b,this.info.rowIndex)},restore:function(d,a){var b=this.info.cell;this.isEditRow(a)&&b.view==d&&b.editable&&b.restore(this.info.rowIndex)},_isValidInput:function(){var d=(this.info.cell||{}).widget;if(!d||!d.isValid)return!0;d.focused=!0;return d.isValid(!0)},_onPreRender:function(){this.isEditing()&&
(this.info.value=this.info.cell.getValue())}})})},"dojox/grid/Selection":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-attr"],function(G,u,r,n){return G("dojox.grid.Selection",null,{constructor:function(m){this.grid=m;this.selected=[];this.setMode(m.selectionMode)},mode:"extended",selected:null,updating:0,selectedIndex:-1,rangeStartIndex:-1,setMode:function(m){this.selected.length&&this.deselectAll();this.mode="extended"!=m&&"multiple"!=m&&"single"!=m&&"none"!=
m?"extended":m},onCanSelect:function(m){return this.grid.onCanSelect(m)},onCanDeselect:function(m){return this.grid.onCanDeselect(m)},onSelected:function(m){},onDeselected:function(m){},onChanging:function(){},onChanged:function(){},isSelected:function(m){return"none"==this.mode?!1:this.selected[m]},getFirstSelected:function(){if(!this.selected.length||"none"==this.mode)return-1;for(var m=0,k=this.selected.length;m<k;m++)if(this.selected[m])return m;return-1},getNextSelected:function(m){if("none"==
this.mode)return-1;m+=1;for(var k=this.selected.length;m<k;m++)if(this.selected[m])return m;return-1},getSelected:function(){for(var m=[],k=0,d=this.selected.length;k<d;k++)this.selected[k]&&m.push(k);return m},getSelectedCount:function(){for(var m=0,k=0;k<this.selected.length;k++)this.selected[k]&&m++;return m},_beginUpdate:function(){if(0===this.updating)this.onChanging();this.updating++},_endUpdate:function(){this.updating--;if(0===this.updating)this.onChanged()},select:function(m){"none"!=this.mode&&
("multiple"!=this.mode?(this.deselectAll(m),this.addToSelection(m)):this.toggleSelect(m))},addToSelection:function(m){if("none"!=this.mode)if(r.isArray(m))u.forEach(m,this.addToSelection,this);else if(m=Number(m),this.selected[m])this.selectedIndex=m;else if(!1!==this.onCanSelect(m)){this.selectedIndex=m;var k=this.grid.getRowNode(m);k&&n.set(k,"aria-selected","true");this._beginUpdate();this.selected[m]=!0;this.onSelected(m);this._endUpdate()}},deselect:function(m){if("none"!=this.mode)if(r.isArray(m))u.forEach(m,
this.deselect,this);else if(m=Number(m),this.selectedIndex==m&&(this.selectedIndex=-1),this.selected[m]&&!1!==this.onCanDeselect(m)){var k=this.grid.getRowNode(m);k&&n.set(k,"aria-selected","false");this._beginUpdate();delete this.selected[m];this.onDeselected(m);this._endUpdate()}},setSelected:function(m,k){this[k?"addToSelection":"deselect"](m)},toggleSelect:function(m){r.isArray(m)?u.forEach(m,this.toggleSelect,this):this.setSelected(m,!this.selected[m])},_range:function(m,k,d){var a=0<=m?m:k;
m=k;a>m&&(m=a,a=k);for(k=a;k<=m;k++)d(k)},selectRange:function(m,k){this._range(m,k,r.hitch(this,"addToSelection"))},deselectRange:function(m,k){this._range(m,k,r.hitch(this,"deselect"))},insert:function(m){this.selected.splice(m,0,!1);this.selectedIndex>=m&&this.selectedIndex++},remove:function(m){this.selected.splice(m,1);this.selectedIndex>=m&&this.selectedIndex--},deselectAll:function(m){for(var k in this.selected)k!=m&&!0===this.selected[k]&&this.deselect(k)},clickSelect:function(m,k,d){if("none"!=
this.mode){this._beginUpdate();if("extended"!=this.mode)this.select(m);else{if(!d||0>this.rangeStartIndex)this.rangeStartIndex=m;k||this.deselectAll(m);d?this.selectRange(this.rangeStartIndex,m):k?this.toggleSelect(m):this.addToSelection(m)}this._endUpdate()}},clickSelectEvent:function(m){this.clickSelect(m.rowIndex,dojo.isCopyKey(m),m.shiftKey)},clear:function(){this._beginUpdate();this.deselectAll();this._endUpdate()}})})},"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class",
"./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(G,u,r,n){return G("dijit.CheckedMenuItem",r,{baseClass:"dijitMenuItem dijitCheckedMenuItem",templateString:n,checked:!1,_setCheckedAttr:function(m){this.domNode.setAttribute("aria-checked",m?"true":"false");this._set("checked",m)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(m){this.disabled||(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(m)}})})},
"dojox/grid/DataSelection":function(){define(["dojo/_base/declare","./_SelectionPreserver","./Selection"],function(G,u,r){return G("dojox.grid.DataSelection",r,{constructor:function(n){n.keepSelection&&(this.preserver=new u(this))},destroy:function(){this.preserver&&this.preserver.destroy()},getFirstSelected:function(){var n=r.prototype.getFirstSelected.call(this);return-1==n?null:this.grid.getItem(n)},getNextSelected:function(n){n=this.grid.getItemIndex(n);n=r.prototype.getNextSelected.call(this,
n);return-1==n?null:this.grid.getItem(n)},getSelected:function(){for(var n=[],m=0,k=this.selected.length;m<k;m++)this.selected[m]&&n.push(this.grid.getItem(m));return n},addToSelection:function(n){if("none"!=this.mode){var m=null;m="number"==typeof n||"string"==typeof n?n:this.grid.getItemIndex(n);r.prototype.addToSelection.call(this,m)}},deselect:function(n){if("none"!=this.mode){var m=null;m="number"==typeof n||"string"==typeof n?n:this.grid.getItemIndex(n);r.prototype.deselect.call(this,m)}},deselectAll:function(n){var m=
null;n||"number"==typeof n?(m="number"==typeof n||"string"==typeof n?n:this.grid.getItemIndex(n),r.prototype.deselectAll.call(this,m)):this.inherited(arguments)}})})},"dojox/grid/_SelectionPreserver":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array"],function(G,u,r,n){return G("dojox.grid._SelectionPreserver",null,{constructor:function(m){this.selection=m;var k=this.grid=m.grid;this.reset();this._connects=[u.connect(k,"_setStore",this,"reset"),u.connect(k,
"_addItem",this,"_reSelectById"),u.connect(m,"onSelected",r.hitch(this,"_selectById",!0)),u.connect(m,"onDeselected",r.hitch(this,"_selectById",!1)),u.connect(m,"deselectAll",this,"reset")]},destroy:function(){this.reset();n.forEach(this._connects,u.disconnect);delete this._connects},reset:function(){this._selectedById={}},_reSelectById:function(m,k){m&&this.grid._hasIdentity&&(this.selection.selected[k]=this._selectedById[this.grid.store.getIdentity(m)])},_selectById:function(m,k){if("none"!=this.selection.mode&&
this.grid._hasIdentity){var d=k,a=this.grid;if("number"==typeof k||"string"==typeof k)d=(k=a._by_idx[k])&&k.item;d&&(this._selectedById[a.store.getIdentity(d)]=!!m);return d}}})})},"esri/dijit/editing/TemplatePickerItem":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/sniff dojo/dom-style dijit/_Widget dijit/_Templated dojox/gfx ../../symbols/jsonUtils ../../kernel".split(" "),function(G,u,r,n,m,k,d,a,b,e,g){G=G([d,a],{declaredClass:"esri.dijit.editing.TemplatePickerItem",
templateString:"\x3cdiv class\x3d'item' style\x3d'text-align: center;'\x3e\x3cdiv class\x3d'itemSymbol' dojoAttachPoint\x3d'_surfaceNode'\x3e\x3c/div\x3e\x3cdiv class\x3d'itemLabel'\x3e${label}\x3c/div\x3e\x3c/div\x3e",startup:function(){this._started||(this.inherited(arguments),this._surface=this._draw(this._surfaceNode,this.symbol,this.surfaceWidth,this.surfaceHeight,this.template))},_draw:function(h,c,f,l,q){if(c&&"textsymbol"!==c.type){h=b.createSurface(h,f,l);if(9>n("ie")){var t=h.getEventSource();
k.set(t,"position","relative");k.set(t.parentNode,"position","relative")}c=!this.legendOverride&&this._getDrawingToolShape(c,q)||e.getShapeDescriptors(c);try{var v=h.createShape(c.defaultShape).setFill(c.fill).setStroke(c.stroke)}catch(H){h.clear();h.destroy();return}var w=v.getBoundingBox();c=w.width;q=w.height;t=-(w.x+c/2);w=-(w.y+q/2);var x=h.getDimensions();t={dx:t+x.width/2,dy:w+x.height/2};if(c>f||q>l)w=c/f>q/l,f=((w?f:l)-5)/(w?c:q),u.mixin(t,{xx:f,yy:f});v.applyTransform(t);return h}},_getDrawingToolShape:function(h,
c){switch(c?c.drawingTool||null:null){case "esriFeatureEditToolArrow":c={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolLeftArrow":c={type:"path",path:"M -15,1 L -8,8 L -8,5 L 10,5 L 10,-2 L -8,-2 L -8,-5 L -15,1 E"};break;case "esriFeatureEditToolRightArrow":c={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolUpArrow":c={type:"path",path:"M 1,-10 L 8,-3 L 5,-3 L 5,15 L -2,15 L -2,-3 L -5,-3 L 1,-10 E"};
break;case "esriFeatureEditToolDownArrow":c={type:"path",path:"M 1,15 L 8,8 L 5,8 L 5,-10 L -2,-10 L -2,8 L -5,8 L 1,15 E"};break;case "esriFeatureEditToolTriangle":c={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":c={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":c={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":c={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;case "esriFeatureEditToolFreehand":c=
"simplelinesymbol"===h.type||"cartographiclinesymbol"===h.type?{type:"path",path:"m -11, -7c-1.5,-3.75 7.25,-9.25 12.5,-7c5.25,2.25 6.75,9.75 3.75,12.75c-3,3 -3.25,2.5 -9.75,5.25c-6.5,2.75 -7.25,14.25 2,15.25c9.25,1 11.75,-4 13.25,-6.75c1.5,-2.75 3.5,-11.75 12,-6.5"}:{type:"path",path:"M 10,-13 c3.1,0.16667 4.42564,2.09743 2.76923,3.69231c-2.61025,2.87179 -5.61025,5.6718 -6.14358,6.20513c-0.66667,0.93333 -0.46667,1.2 -0.53333,1.93333c-0.00001,0.86666 0.6,1.66667 1.13334,2c1.03077,0.38462 2.8,0.93333 3.38974,1.70769c0.47693,0.42564 0.87693,0.75897 1.41026,1.75897c0.13333,1.06667 -0.46667,2.86667 -1.8,3.8c-0.73333,0.73333 -3.86667,2.66666 -4.86667,3.13333c-0.93333,0.8 -7.4,3.2 -7.6,3.06667c-1.06667,0.46667 -4.73333,1.13334 -5.2,1.26667c-1.6,0.33334 -4.6,0.4 -6.25128,0.05128c-1.41539,-0.18462 -2.34872,-2.31796 -1.41539,-4.45129c0.93333,-1.73333 1.86667,-3.13333 2.64615,-3.85641c1.28718,-1.47692 2.57437,-2.68204 3.88718,-3.54359c0.88718,-1.13845 1.8,-1.33333 2.26666,-2.45641c0.33334,-0.74359 0.37949,-1.7641 0.06667,-2.87692c-0.66666,-1.46666 -1.66666,-1.86666 -2.98975,-2.2c-1.27692,-0.26666 -2.12307,-0.64102 -3.27692,-1.46666c-0.66667,-1.00001 -1.01538,-3.01539 0.73333,-4.06667c1.73333,-1.2 3.6,-1.93333 4.93333,-2.2c1.33333,-0.46667 4.84104,-1.09743 5.84103,-1.23076c1.60001,-0.46667 6.02564,-0.50257 7.29231,-0.56924z"};
break;default:return null}return{defaultShape:c,fill:h.getFill(),stroke:h.getStroke()}},_repaint:function(h){h?(h.getStroke&&h.setStroke&&h.setStroke(h.getStroke()),h.getFill&&h.setFill&&h.setFill(h.getFill()),h.children&&u.isArray(h.children)&&r.forEach(h.children,this._repaint,this)):this._surface=this._draw(this._surfaceNode,this.symbol,this.surfaceWidth,this.surfaceHeight,this.template)},destroy:function(){this._surface&&(this._surface.destroy(),delete this._surface);this.inherited(arguments)}});
n("extend-esri")&&u.setObject("dijit.editing.TemplatePickerItem",G,g);return G})},"esri/dijit/_TouchBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/dom dojo/has ../kernel".split(" "),function(G,u,r,n,m,k){G=G(null,{declaredClass:"esri.dijit._TouchBase",_preventDefault:!0,_swipeThreshold:20,constructor:function(d,a){this.domNode=n.byId(d);this.events=[r.connect(this.domNode,"touchstart",this,this._touchStartHandler),r.connect(this.domNode,"touchmove",this,this._touchMoveHandler),
r.connect(this.domNode,"touchend",this,this._touchEndHandler),r.connect(this.domNode,"onclick",this,this._clickHandler)]},setPreventDefault:function(d){this._preventDefault=d},disableOnClick:function(){r.disconnect(this.events.pop())},_clickHandler:function(d){if(this._moved)d.preventDefault();else this.onclick(d)},_touchStartHandler:function(d){this._moved=!1;this.client_x=d.targetTouches[0].clientX;this.client_y=d.targetTouches[0].clientY;this.down_x=d.targetTouches[0].pageX;this.down_y=d.targetTouches[0].pageY;
d.downX=this.down_x;d.downY=this.down_y;this.onTouchStart(d)},_touchMoveHandler:function(d){this._preventDefault&&d.preventDefault();this._moved=!0;this.up_x=d.targetTouches[0].pageX;this.cur_x=d.targetTouches[0].pageX-this.down_x;this.cur_y=d.targetTouches[0].pageY-this.down_y;d.curX=this.cur_x;d.curY=this.cur_y;this.onTouchMove(d)},_touchEndHandler:function(d){this._moved?(d.curX=this.cur_x,d.curY=this.cur_y,this.down_x-this.up_x>this._swipeThreshold?d.swipeDirection="left":this.up_x-this.down_x>
this._swipeThreshold&&(d.swipeDirection="right")):(d.clientX=this.client_x,d.clientY=this.client_y);this.onTouchEnd(d)},onTouchStart:function(d){},onTouchMove:function(d){},onTouchEnd:function(d){},onclick:function(d){}});m("extend-esri")&&u.setObject("dijit._TouchBase",G,k);return G})},"esri/dijit/BasemapGallery":function(){define("require dojo/_base/declare dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/_base/kernel dojo/_base/sniff dojo/has dojo/query dojo/Deferred dojo/DeferredList dojo/dom dojo/dom-construct dojo/dom-class dijit/_Widget dijit/_Templated ../kernel ../lang ../urlUtils ../request ../geometry/Extent ../SpatialReference ../virtualearth/VETiledLayer ../layers/OpenStreetMapLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/WebTiledLayer ../layers/VectorTileLayer ../layers/TileInfo ../layers/ArcGISImageServiceLayer ../layers/ImageServiceParameters ../layers/ImageParameters ../layers/RasterFunction ../layers/RasterXLayer ./Basemap ./_EventedWidget dojo/text!./templates/BasemapGallery.html".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z,E,J,D,L,C,N,S,F,T,y,B,I,P,X){u=u([P,l,q],{declaredClass:"esri.dijit.BasemapGallery",widgetsInTemplate:!0,templateString:X,loaded:!1,basemaps:[],bingMapsKey:null,flowContainer:null,_hasUI:!1,_supportsVTL:null,_selectedBasemap:null,_selectBasemapInProgress:!1,_eventMap:{load:!0,"selection-change":!0,add:["basemap"],remove:["basemap"],error:["message"]},constructor:function(Y,aa){Y=Y||{};Y.map||console.error("esri.dijit.BasemapGallery: Unable to find the 'map' property in parameters");
this.map=Y.map;this._hasUI=aa?!0:!1;this.bingMapsKey=Y.bingMapsKey&&0<Y.bingMapsKey.length?Y.bingMapsKey:null;this.showArcGISBasemaps=!1!==Y.showArcGISBasemaps;this.basemaps=Y.basemaps||[];this.basemapIds=Y.basemapIds;this.referenceIds=Y.referenceIds;this.basemapsGroup=Y.basemapsGroup;this.arcgisUrl=t.dijit._arcgisUrl;Y.portalUrl&&(this.arcgisUrl=Y.portalUrl+"/sharing/rest");0>this.arcgisUrl.indexOf("://")?this.arcgisUrl=w.getProtocolForWebResource()+"//"+this.arcgisUrl:"https:"===window.location.protocol&&
(this.arcgisUrl=this.arcgisUrl.replace("http:","https:"));this.init()},init:function(){this.inherited(arguments);this._checkVTLSupport().then(m.hitch(this,function(Y){this._supportsVTL=Y}));r.forEach(this.basemaps,function(Y){Y.id&&0!==Y.id.length||(Y.id=this._getUniqueId());r.forEach(Y.layers,function(aa){aa.opacity=0<=aa.opacity?aa.opacity:1;aa.visibility=!0},this)},this);this.basemapIds&&0<this.basemapIds.length&&r.forEach(this.basemapIds,function(Y){this.map.getLayer(Y)._basemapGalleryLayerType=
"basemap"},this);this.referenceIds&&0<this.referenceIds.length&&r.forEach(this.referenceIds,function(Y){Y=this.map.getLayer(Y);Y._basemapGalleryLayerType="reference";Y.attr("data-reference",!0)},this);this.basemapsGroup&&(this.basemapsGroup.owner&&this.basemapsGroup.title||this.basemapsGroup.id)?this._findCustomBasemapsGroup(m.hitch(this,"_handleArcGISBasemapsResponse")):this.showArcGISBasemaps?this._findArcGISBasemapsGroup(m.hitch(this,"_handleArcGISBasemapsResponse")):this._finishStartup()},startup:function(){this.loaded?
this._refreshUI():n.connect(this,"onLoad",m.hitch(this,function(){this._refreshUI()}))},select:function(Y){this._select(Y)},getSelected:function(){return this._selectedBasemap},get:function(Y){var aa;for(aa=0;aa<this.basemaps.length;aa++)if(this.basemaps[aa].id===Y)return this.basemaps[aa];return null},add:function(Y){return Y&&!Y.id?(Y.id=this._getUniqueId(),this.basemaps.push(Y),this._refreshUI(),this.onAdd(Y),!0):Y&&this._isUniqueId(Y.id)?(this.basemaps.push(Y),this._refreshUI(),this.onAdd(Y),
!0):!1},remove:function(Y){var aa;for(aa=0;aa<this.basemaps.length;aa++){var Z=this.basemaps[aa];if(Z.id===Y)return this._selectedBasemap&&this._selectedBasemap.id===Z.id&&(this._selectedBasemap=null),this.basemaps.splice(aa,1),this._refreshUI(),this.onRemove(Z),Z}return null},onLoad:function(){},onSelectionChange:function(){},onAdd:function(Y){},onRemove:function(Y){},onError:function(Y){},_defaultBasemapGalleryGroupQuery:'title:"ArcGIS Online Basemaps" AND owner:esri',_basemapGalleryGroupQuery:null,
_finishStartup:function(){this.loaded=!0;this.onLoad();0===this.map.layerIds.length&&0<this.basemaps.length&&!this._selectBasemapInProgress&&this._select(this.basemaps[0].id)},_findCustomBasemapsGroup:function(Y){this.basemapsGroup&&this.basemapsGroup.id?this._findArcGISBasemaps(this.basemapsGroup.id,Y):(this._basemapGalleryGroupQuery='title:"'+this.basemapsGroup.title+'" AND owner:'+this.basemapsGroup.owner,this._findArcGISBasemapsGroup(Y))},_findArcGISBasemapsGroup:function(Y){if(this._basemapGalleryGroupQuery)this._findArcGISBasemapsGroupContent(Y);
else{var aa=this.arcgisUrl+"/portals/self",Z={f:"json"};Z.culture=k.locale;x({url:aa,content:Z,callbackParamName:"callback",load:m.hitch(this,function(fa,K){fa&&fa.useVectorBasemaps&&fa.vectorBasemapGalleryGroupQuery?this._checkVTLSupport().then(m.hitch(this,function(R){this._basemapGalleryGroupQuery=R?fa.vectorBasemapGalleryGroupQuery:fa&&fa.basemapGalleryGroupQuery?fa.basemapGalleryGroupQuery:this._defaultBasemapGalleryGroupQuery;this._findArcGISBasemapsGroupContent(Y)})):(this._basemapGalleryGroupQuery=
fa&&fa.basemapGalleryGroupQuery?fa.basemapGalleryGroupQuery:this._defaultBasemapGalleryGroupQuery,this._findArcGISBasemapsGroupContent(Y))}),error:m.hitch(this,function(fa,K){this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery})})}},_findArcGISBasemapsGroupContent:function(Y){var aa=m.hitch(this,"_findArcGISBasemaps"),Z=this.arcgisUrl+"/community/groups",fa={};fa.q=this._basemapGalleryGroupQuery;fa.f="json";x({url:Z,content:fa,callbackParamName:"callback",load:m.hitch(this,function(K,
R){if(0<K.results.length)aa(K.results[0].id,Y,K.results[0].sortField,K.results[0].sortOrder);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:m.hitch(this,function(K){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})},_findArcGISBasemaps:function(Y,aa,Z,fa){var K=m.hitch(this,function(R,U,ba,Q){var ea=this.arcgisUrl+"/search",la={};la.q="group:"+R+' AND type:"web map" NOT type:"web mapping application"';la.sortField=ba;la.sortOrder=
"asc"===Q?"desc":"asc";la.num=100;la.f="json";x({url:ea,content:la,callbackParamName:"callback",load:m.hitch(this,function(ma,M){if(0<ma.results.length)U(ma.results);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:m.hitch(this,function(ma,M){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})});Z&&fa?K(Y,aa,Z,fa):x({url:this.arcgisUrl+"/community/groups/"+Y,content:{f:"json"},callbackParamName:"callback",load:m.hitch(this,function(R,
U){R.sortField?K(Y,aa,R.sortField,R.sortOrder):K(Y,aa,"name","desc")}),error:m.hitch(this,function(R,U){K(Y,aa,"name","desc")})})},_handleArcGISBasemapsResponse:function(Y){0<Y.length&&(r.forEach(Y,function(aa,Z){if(this.bingMapsKey||!this.bingMapsKey&&aa.title&&-1===aa.title.indexOf("Bing Maps")){Z={};Z.id=this._getUniqueId();Z.title=aa.title;Z.thumbnailUrl="";if(aa.thumbnail&&aa.thumbnail.length&&(Z.thumbnailUrl=this.arcgisUrl+"/content/items/"+aa.id+"/info/"+aa.thumbnail,t.id)){var fa=t.id.findCredential(w.urlToObject(this.arcgisUrl).path);
fa&&(Z.thumbnailUrl+="?token\x3d"+fa.token)}Z.itemId=aa.id;aa=new I(Z,this);this.basemaps.splice(0,0,aa)}},this),this._finishStartup())},_refreshUI:function(){this._hasUI&&(c.empty(this.flowContainer),r.forEach(this.basemaps,function(Y,aa){Y.id||(Y.id="basemap_"+aa);this.flowContainer.appendChild(this._buildNodeLayout(Y))},this),c.create("br",{style:{clear:"both"}},this.flowContainer),this._markSelected(this._selectedBasemap))},_buildNodeLayout:function(Y){var aa=c.create("div",{id:"galleryNode_"+
Y.id,"class":"esriBasemapGalleryNode"}),Z=c.create("a",{href:"javascript:void(0);"},aa);n.connect(Z,"onclick",m.hitch(this,"_onNodeClick",Y));var fa=Y.title||"";Y.thumbnailUrl?c.create("img",{"class":"esriBasemapGalleryThumbnail",src:Y.thumbnailUrl,title:fa,alt:fa},Z):c.create("img",{"class":"esriBasemapGalleryThumbnail",src:G.toUrl("./images/transparent.gif"),title:fa,alt:fa},Z);Y=c.create("div",{"class":"esriBasemapGalleryLabelContainer"},aa);c.create("span",{innerHTML:fa,alt:fa,title:fa},Y);return aa},
_onNodeClick:function(Y,aa){aa.preventDefault();this._markSelected(Y);this.select(Y.id)},_markSelected:function(Y){Y&&(r.forEach(k.query(".esriBasemapGallerySelectedNode",this.domNode),function(aa){f.remove(aa,"esriBasemapGallerySelectedNode")}),(Y=h.byId("galleryNode_"+Y.id))&&f.add(Y,"esriBasemapGallerySelectedNode"))},_select:function(Y){this._selectBasemapInProgress=!0;var aa=this.get(Y);aa?(aa.layers?this._getServiceInfos(aa):(Y=aa.getLayers(this.arcgisUrl),m.isArray(Y)?this._getServiceInfos(aa):
Y.addCallback(m.hitch(this,function(Z){this._getServiceInfos(aa)}))),this._markSelected(aa)):this._selectBasemapInProgress=!1},_getServiceInfos:function(Y){"https:"===location.protocol&&r.forEach(Y.layers,function(Z){if(this._isAgolService(Z.url)||this._isHostedService(Z.url))Z.url=Z.url.replace("http:","https:")},this);this._selectedBasemap=Y;var aa=[];r.forEach(Y.layers,function(Z){Z.url&&0<Z.url.length&&!Z.isReference&&!Z.type&&(Z.deferredsPos=aa.length,aa.push(this._getServiceInfo(Z.url)))},this);
0<aa.length?(new g(aa)).addCallback(m.hitch(this,function(Z){var fa=null;r.forEach(Y.layers,function(K){if(0===K.deferredsPos||K.deferredsPos){K.serviceInfoResponse=Z[K.deferredsPos][1];var R=K.serviceInfoResponse.fullExtent;R||(R=K.serviceInfoResponse.extent);fa=fa?fa.union(new H(R)):new H(R)}},this);this.map.extent&&5>this._getIntersectionPercent(fa,this.map.extent)&&this.map.setExtent(fa,!0);this._switchBasemapLayers(Y);this._updateReferenceLayer(Y)})):(this._switchBasemapLayers(Y),this._updateReferenceLayer(Y))},
_checkVTLSupport:function(){var Y=new e;d("ie")?Y.resolve(!1):Y.resolve(C.supported());return Y},_switchBasemapLayers:function(Y){var aa=Y.layers,Z=!1,fa,K,R;r.forEach(aa,function(ba){"VectorTileLayer"===ba.type&&(Z=!0)});if(Z&&!0!==this._supportsVTL)this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because layer type is not supported by your current browser version.");else if(0<this.map.layerIds.length&&0===this.map.getNumLevels()&&("OpenStreetMap"===aa[0].type||aa[0].type&&-1<aa[0].type.indexOf("BingMaps")||
"WebTiledLayer"===aa[0].type||"VectorTileLayer"===aa[0].type))this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");else{r.forEach(aa,function(ba){if(!ba.isReference&&ba.type&&-1<ba.type.indexOf("BingMaps")&&!this.bingMapsKey)this.onError("esri.dijit.BasemapGallery: Invalid Bing Maps key.")},this);var U=0;r.forEach(aa,function(ba,Q){if(!ba.isReference){if("OpenStreetMap"===ba.type){if(0<this.map.layerIds.length&&
0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}var ea=new E({id:"layer_osm",opacity:ba.opacity})}else if(ba.type&&-1<ba.type.indexOf("BingMaps")){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}ea=
z.MAP_STYLE_AERIAL_WITH_LABELS;"BingMapsAerial"===ba.type?ea=z.MAP_STYLE_AERIAL:"BingMapsRoad"===ba.type&&(ea=z.MAP_STYLE_ROAD);ea=new z({id:"layer_bing",bingMapsKey:this.bingMapsKey,mapStyle:ea,opacity:ba.opacity})}else if("WebTiledLayer"===ba.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}ea=ba.initialExtent||ba.fullExtent;
ea=new L(ba.templateUrl||ba.url,{visible:ba.visibility,opacity:ba.opacity,copyright:ba.copyright,fullExtent:ba.fullExtent&&new H(ba.fullExtent),initialExtent:ea&&new H(ea),subDomains:ba.subDomains,tileInfo:ba.tileInfo?new N(ba.tileInfo):null,tileServers:ba.tileServers})}else if("VectorTileLayer"===ba.type){ea=new C(ba.styleUrl,{visible:ba.visibility,opacity:ba.opacity});0===Q&&1<aa.length&&this._removeBasemapLayers();var la=this;n.connect(ea,"onLoad",m.hitch(this,function(ma,M,W){var da=la._sameSpatialReference(W.spatialReference,
la.map.spatialReference);if(la.map.spatialReference&&!da)la.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");else{if(0<la.map.getNumLevels()){if(da=la._sameTilingScheme(W.tileInfo,la.map.__tileInfo),!da){la.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}}else if(la.map.loaded){la.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a vector tile layer and cannot be loaded as a dynamic layer.");
return}0===M&&1===aa.length&&la._removeBasemapLayers();W._basemapGalleryLayerType="basemap";la.map.addLayer(W,ma)}},U,Q))}else if(ba.serviceInfoResponse&&ba.serviceInfoResponse.mapName){fa=new A(ba.serviceInfoResponse.spatialReference);K=this._sameSpatialReference(fa,this.map.spatialReference);if(this.map.spatialReference&&!K){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");return}if(!0===ba.serviceInfoResponse.singleFusedMapCache&&
0<this.map.getNumLevels()){if(R=this._sameTilingScheme(ba.serviceInfoResponse.tileInfo,this.map.__tileInfo),!R){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}}else if(!0===ba.serviceInfoResponse.singleFusedMapCache&&-1<ba.serviceInfoResponse.capabilities.toLowerCase().indexOf("tilesonly")&&this.map.loaded&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");
return}ea=(0===this.map.layerIds.length||0<this.map.getNumLevels())&&!0===ba.serviceInfoResponse.singleFusedMapCache?this._loadAsCached(ba):this._loadAsDynamic(ba)}else if(ba.serviceInfoResponse&&ba.serviceInfoResponse.pixelSizeX){fa=new A(ba.serviceInfoResponse.spatialReference);K=this._sameSpatialReference(fa,this.map.spatialReference);if(this.map.spatialReference&&!K){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different spatial reference.");return}if(!0===
ba.serviceInfoResponse.singleFusedMapCache&&0<this.map.getNumLevels()&&(R=this._sameTilingScheme(ba.serviceInfoResponse.tileInfo,this.map.__tileInfo),!R)){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap has a different tiling scheme.");return}ba.serviceInfoResponse.singleFusedMapCache&&"ArcGISImageServiceLayer"!==ba.type?ea="Raster"===ba.serviceInfoResponse.cacheType?new B(ba.url,{serviceInfo:ba.serviceInfoResponse,opacity:ba.opacity,visible:ba.visibility,bandIds:ba.bandIds&&
0<ba.bandIds.length?ba.bandIds:null}):new J(ba.url,{resourceInfo:ba.serviceInfoResponse,opacity:ba.opacity,visible:ba.visibility}):ba.serviceInfoResponse.pixelSizeX?(ea=new F,ea.bandIds=ba.bandIds,ba.renderingRule?ea.renderingRule=new y(ba.renderingRule):!ba.bandIds&&ba.serviceInfoResponse.bandCount&&3<parseInt(ba.serviceInfoResponse.bandCount,10)&&(ea.bandIds=[0,1,2]),ea=new S(ba.url,{resourceInfo:ba.serviceInfoResponse,opacity:ba.opacity,visible:ba.visibility,imageServiceParameters:ea})):(ea=new T,
ea.format="png24",ba.serviceInfoResponse.supportedImageFormatTypes&&-1<ba.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&(ea.format="png32"),ea=new D(ba.url,{resourceInfo:ba.serviceInfoResponse,opacity:ba.opacity,visible:ba.visibility,imageParameters:ea}))}"VectorTileLayer"===ba.type?U++:ea&&(0===Q&&this._removeBasemapLayers(),ea._basemapGalleryLayerType="basemap",this.map.addLayer(ea,U),U++)}},this);this._selectBasemapInProgress=!1;this.onSelectionChange()}},_removeBasemapLayers:function(){var Y=
this.map.layerIds,aa=[];r.forEach(Y,function(Z){Z=this.map.getLayer(Z);"basemap"===Z._basemapGalleryLayerType&&aa.push(Z)},this);0===aa.length&&0<Y.length&&aa.push(this.map.getLayer(Y[0]));0<aa.length&&r.forEach(aa,function(Z){this.map.removeLayer(Z)},this)},_updateReferenceLayer:function(Y){var aa;this._removeReferenceLayer();for(aa=0;aa<Y.layers.length;aa++)!0===Y.layers[aa].isReference&&this._addReferenceLayer(Y.layers[aa])},_removeReferenceLayer:function(){var Y;for(Y=this.map.layerIds.length-
1;0<=Y;Y--){var aa=this.map.getLayer(this.map.layerIds[Y]);"reference"===aa._basemapGalleryLayerType&&this.map.removeLayer(aa)}},_addReferenceLayer:function(Y){"VectorTileLayer"===Y.type?this._handleReferenceServiceInfoResponse(Y):this._getServiceInfo(Y.url,m.hitch(this,"_handleReferenceServiceInfoResponse",Y))},_handleReferenceServiceInfoResponse:function(Y,aa,Z){Y.serviceInfoResponse=aa;if("VectorTileLayer"===Y.type)var fa=new C(Y.styleUrl,{visible:Y.visibility,opacity:Y.opacity});else aa&&aa.mapName?
fa=!0===aa.singleFusedMapCache?this._loadAsCached(Y):this._loadAsDynamic(Y):aa&&aa.pixelSizeX&&(Y.serviceInfoResponse.singleFusedMapCache?fa=new J(Y.url,{resourceInfo:Y.serviceInfoResponse,opacity:Y.opacity,visible:Y.visibility}):Y.serviceInfoResponse.pixelSizeX?(Z=new F,Z.bandIds=Y.bandIds,Y.renderingRule?Z.renderingRule=new y(Y.renderingRule):!Y.bandIds&&aa.bandCount&&3<parseInt(aa.bandCount,10)&&(Z.bandIds=[0,1,2]),fa=new S(Y.url,{resourceInfo:aa,opacity:Y.opacity,visible:Y.visibility,imageServiceParameters:Z})):
(aa=new T,aa.format="png24",Y.serviceInfoResponse.supportedImageFormatTypes&&-1<Y.serviceInfoResponse.supportedImageFormatTypes.indexOf("PNG32")&&(aa.format="png32"),aa.transparent=!0,fa=new D(Y.url,{resourceInfo:Y.serviceInfoResponse,opacity:Y.opacity,visible:Y.visibility,imageParameters:aa})));fa&&(fa._basemapGalleryLayerType="reference",fa.attr("data-reference",!0),this.map.addLayer(fa))},_getServiceInfo:function(Y,aa){return x({url:Y,content:{f:"json"},callbackParamName:"callback",load:function(Z,
fa){aa&&aa(Z,fa)},error:m.hitch(this,function(Z,fa){this.onError("esri.dijit.BasemapGallery: service not accessible.")})})},_loadAsCached:function(Y){var aa=[];Y.displayLevels||(aa=r.map(Y.serviceInfoResponse.tileInfo.lods,function(fa){return fa.level}));var Z=null;Y.exclusionAreas&&Y.exclusionAreas.length&&(Z=[],r.forEach(Y.exclusionAreas,function(fa){Z.push({minZoom:fa.minZoom,maxZoom:fa.maxZoom,minScale:fa.minScale,maxScale:fa.maxScale,geometry:new H(fa.geometry)})}));return new J(Y.url,{resourceInfo:Y.serviceInfoResponse,
opacity:Y.opacity,visible:Y.visibility,exclusionAreas:Z,displayLevels:Y.displayLevels||aa})},_loadAsDynamic:function(Y){var aa=new D(Y.url,{resourceInfo:Y.serviceInfoResponse,opacity:Y.opacity,visible:Y.visibility});Y.visibleLayers&&aa.setVisibleLayers(Y.visibleLayers);return aa},_getIntersectionPercent:function(Y,aa){return(Y=aa.intersects(Y))?(Y=Y.getWidth()*Y.getHeight(),aa=aa.getWidth()*aa.getHeight(),Y/aa*100):0},_getIds:function(){var Y=[];r.forEach(this.basemaps,function(aa){Y.push(aa.id)},
this);return Y},_getUniqueId:function(){for(var Y=","+this._getIds().toString()+",",aa=0;;)if(-1<Y.indexOf(",basemap_"+aa+","))aa++;else return"basemap_"+aa},_isUniqueId:function(Y){return-1===(","+this._getIds().toString()+",").indexOf(","+Y+",")?!0:!1},_isAgolService:function(Y){return Y?-1!==Y.indexOf("/services.arcgisonline.com/")||-1!==Y.indexOf("/server.arcgisonline.com/"):!1},_isHostedService:function(Y){return Y?-1!==Y.indexOf(".arcgis.com/"):!1},_sameSpatialReference:function(Y,aa){return Y&&
aa&&Y.wkt==aa.wkt&&(Y.wkid===aa.wkid||v.isDefined(Y.latestWkid)&&Y.latestWkid===aa.wkid||v.isDefined(aa.latestWkid)&&Y.wkid===aa.latestWkid||v.isDefined(Y.latestWkid)&&Y.latestWkid===aa.latestWkid)||Y&&aa&&Y.isWebMercator()&&aa.isWebMercator()?!0:!1},_sameTilingScheme:function(Y,aa){var Z=this.map;Z=Z.width>Z.height?Z.width:Z.height;var fa=!1,K=!1,R,U;for(R=0;R<Y.lods.length;R++){var ba=Y.lods[R].scale;Y.dpi!==aa.dpi&&(ba=Y.lods[R].scale/Y.dpi);for(U=0;U<aa.lods.length;U++){var Q=aa.lods[U].scale;
Y.dpi!==aa.dpi&&(Q=aa.lods[U].scale/aa.dpi);if(Math.abs(Q-ba)/Q<1/Z)if(fa){K=!0;break}else fa=!0;if(Q<ba)break}if(K)break}return K||fa&&(1===Y.lods.length||1===aa.lods.length)?!0:!1}});a("extend-esri")&&m.setObject("dijit.BasemapGallery",u,t);return u})},"esri/virtualearth/VETiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/_base/config dojo/has dojo/string dojo/_base/Deferred ../kernel ../urlUtils ../SpatialReference ../layers/TileInfo ../layers/TiledMapServiceLayer ../geometry/Extent ../request".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l){G=G(c,{declaredClass:"esri.virtualearth.VETiledLayer",constructor:function(q){try{if(q=u.mixin({bingMapsKey:null,culture:"en-US"},q||{}),this.url=e.getProtocolForWebResource()+"//dev.virtualearth.net/REST/v1",this._url=e.urlToObject(this.url),this.spatialReference=new g({wkid:102100}),this.tileInfo=new h({rows:256,cols:256,dpi:96,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},
{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,
scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,
scale:1128.497176},{level:20,resolution:.1492910708238085,scale:564.248588}]}),this.initialExtent=this.fullExtent=new f(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new g({wkid:102100})),u.mixin(this,q),this.hasAttributionData=this.showAttribution,this._initLayer=u.hitch(this,this._initLayer),this._errorHandler=u.hitch(this,this._errorHandler),this._getTileInfo=u.hitch(this,this._getTileInfo),this.bingMapsKey)this._getTileInfo();else throw Error("BingMapsKey must be provided.");
}catch(t){throw this.onError(t),t;}},_unsetMap:function(q,t){this.inherited("_unsetMap",arguments)},_getTileInfo:function(){if(this.mapStyle){var q=this._url.path+"/Imagery/Metadata/"+this.mapStyle,t=window.location.protocol;if(this.bingMapsKey){var v=this.resourceInfo;!this.loaded&&v?this._initLayer(v):l({url:q,content:u.mixin({},{uriScheme:"https:"===t?"https":"http",key:this.bingMapsKey,ss:!0,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,
error:this._errorHandler})}}},_initLayer:function(q,t){if(200!==q.statusCode)t=Error(),t.code=q.statusCode,t.message=q.statusDescription,t.details=q.errorDetails,t.authenticationResultCode=q.authenticationResultCode,this.onError(t);else try{this.resourceInfo=r.toJson(q);var v=q.resourceSets[0].resources[0],w=v.imageUrl.replace("{","${");this.tileServers=n.map(v.imageUrlSubdomains,function(H){var A=e.getProtocolForWebResource();return d.substitute(w,{subdomain:H}).replace("http:",A)});this._tsLength=
this.tileServers.length;if(this.loaded)this.refresh(),this.onMapStyleChange();else{this.copyright=this.copyright||"\x26copy; 2017 Microsoft Corporation and its data suppliers";this.loaded=!0;this.onLoad(this);var x=this.loadCallback;x&&(delete this.loadCallback,x(this))}}catch(H){this.onError(H)}},getAttributionData:function(){var q=new a,t=r.fromJson(this.resourceInfo),v;this.hasAttributionData&&t&&(v=u.getObject("resourceSets.0.resources.0.imageryProviders",!1,t));v?q.callback({contributors:v}):
(t=Error("Layer does not have attribution data"),t.log=m.isDebug,q.errback(t));return q},getTileUrl:function(q,t,v){return d.substitute(this.tileServers[t%this._tsLength].replace(/\{/g,"${"),{quadkey:this._getQuadKey(q,t,v),culture:this.culture,token:this.bingMapsKey})},_getQuadKey:function(q,t,v){var w="",x;for(x=q;0<x;x--){q="0";var H=1<<x-1;0!=(v&H)&&q++;0!=(t&H)&&(q++,q++);w+=q}return w},setMapStyle:function(q){this.mapStyle=q;this._getTileInfo()},setCulture:function(q){this.culture=q;this._getTileInfo()},
setBingMapsKey:function(q){this.bingMapsKey=q},onMapStyleChange:function(){}});u.mixin(G,{MAP_STYLE_AERIAL:"aerial",MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabelsOnDemand",MAP_STYLE_ROAD:"roadOnDemand"});k("extend-esri")&&u.setObject("virtualearth.VETiledLayer",G,b);return G})},"esri/layers/WebTiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/sniff dojo/string ../config ../kernel ../request ../urlUtils ../SpatialReference ../geometry/Extent ./TiledMapServiceLayer ./TileInfo".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f){function l(q,t){var v=[];if(q&&t&&(t.customLayerParameters||t.customParameters)){var w=u.clone(t.customParameters||{});u.mixin(w,t.customLayerParameters||{});q=e.urlToObject(q);for(var x in q.query)w.hasOwnProperty(x)||v.push(x+"\x3d"+q.query[x]);q=q.path+(v.length?"?"+v.join("\x26"):"")}return q}G=G(c,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(q,t){t||(t={});this.urlTemplate=q=l(q,t.wmtsInfo);var v=new h(-2.0037508342787E7,-2.003750834278E7,
2.003750834278E7,2.0037508342787E7,new g({wkid:102100})),w=new h(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new g({wkid:102100}));this.initialExtent=t.initialExtent||v;this.fullExtent=t.fullExtent||w;this.tileInfo=t.tileInfo?t.tileInfo:new f({dpi:96,rows:256,cols:256,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},
{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,
scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:.597164283559817,scale:2256.994353},{level:19,resolution:.298582141647617,
scale:1128.497176},{level:20,resolution:.14929107082380833,scale:564.248588},{level:21,resolution:.07464553541190416,scale:282.124294},{level:22,resolution:.03732276770595208,scale:141.062147},{level:23,resolution:.01866138385297604,scale:70.5310735}]});this.spatialReference=new g(this.tileInfo.spatialReference.toJson());this.copyright=t.copyright||"";var x=new n(q);v=x.scheme+"://"+x.authority+"/";this.urlPath=q.substring(v.length);this.tileServers=t.tileServers||[];-1===x.authority.indexOf("{subDomain}")&&
this.tileServers.push(v);if(t.subDomains&&0<t.subDomains.length&&1<x.authority.split(".").length){this.subDomains=t.subDomains;var H;r.forEach(t.subDomains,function(E){-1<x.authority.indexOf("${subDomain}")?H=x.scheme+"://"+k.substitute(x.authority,{subDomain:E})+"/":-1<x.authority.indexOf("{subDomain}")&&(H=x.scheme+"://"+x.authority.replace(/\{subDomain\}/gi,E)+"/");this.tileServers.push(H)},this)}this.tileServers=r.map(this.tileServers,function(E){"/"!==E.charAt(E.length-1)&&(E+="/");return E});
this._levelToLevelValue=[];var A=0;r.forEach(this.tileInfo.lods,function(E,J){this._levelToLevelValue[E.level]=E.levelValue||E.level;0===J&&(A=this._levelToLevelValue[E.level])},this);this._wmtsInfo=t.wmtsInfo;var z=u.hitch(this,function(){this.loaded=!0;this.onLoad(this)});m("chrome")?(q=this.getTileUrl(A,0,0),t=d.defaults.io,v="with-credentials"===t.useCors?e.canUseXhr(q,!0):-1,(t=-1<v?t.corsEnabledServers[v]:null)&&t.withCredentials?b({url:q,handleAs:"arraybuffer"}).addBoth(function(){z()}):z()):
z()},getTileUrl:function(q,t,v){q=this._levelToLevelValue[q];var w=this.tileServers[t%this.tileServers.length]+k.substitute(this.urlPath,{level:q,z:q,col:v,x:v,row:t,y:t});w=w.replace(/\{level\}/gi,q).replace(/\{row\}/gi,t).replace(/\{col\}/gi,v).replace(/\{z\}/gi,q).replace(/\{x\}/gi,v).replace(/\{y\}/gi,t);w=this._appendCustomLayerParameters(w);w=this.addTimestampToURL(w);return e.addProxy(w)},_appendCustomLayerParameters:function(q){var t;if(this._wmtsInfo&&(this._wmtsInfo.customLayerParameters||
this._wmtsInfo.customParameters)){var v=u.clone(this._wmtsInfo.customParameters||{});u.mixin(v,this._wmtsInfo.customLayerParameters||{});for(t in v)q+=(-1===q.indexOf("?")?"?":"\x26")+t+"\x3d"+encodeURIComponent(v[t])}return q}});m("extend-esri")&&u.setObject("layers.WebTiledLayer",G,a);return G})},"esri/layers/VectorTileLayer":function(){(function(){var G=function(){try{var r=window.WebGLRenderingContext}catch(b){r=!1}try{for(var n=document.createElement("canvas"),m=["webgl","experimental-webgl",
"webkit-3d","moz-webgl"],k=null,d=0;d<m.length;++d){try{k=n.getContext(m[d])}catch(b){}if(k)break}var a=k}catch(b){a=!1}return r&&a?!0:!1}(),u=["dojo/_base/lang","dojo/has","dojo/Deferred","../sniff","./layer"];G&&u.push("./VectorTileLayerImpl");define(u,function(r,n,m,k,d,a){d=a?a:d.createSubclass({declaredClass:"esri.layers.VectorTileLayer",constructor:function(){var b=new m;b.reject(Error("esri.layers.VectorTileLayer is not supported"));b.promise.otherwise(r.hitch(this,function(e){this._errorHandler(e)}))}});
d.ACCESS_TOKEN=null;d.supported=function(){return G};n("extend-esri")&&r.setObject("layers.VectorTileLayer",d,k);return d})})()},"esri/layers/ArcGISImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config ./DynamicMapServiceLayer ./ImageServiceLayerMixin".split(" "),function(G,u,r,n,m,k,d){G=G([k,d],{declaredClass:"esri.layers.ArcGISImageServiceLayer",constructor:function(a,b){this._initialize(a,b);this.useMapImage=b&&b.useMapImage||!1},refresh:function(a){if(!0===
a)this.inherited(arguments);else{var b=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=b}},setRenderer:function(a,b){this.renderer=a;this.onRendererChange();b||this.refresh(!0)},exportMapImage:function(a,b){var e=m.defaults.map;a=u.mixin({size:e.width+","+e.height},this._params,a?a.toJson(this.normalization):{},{f:"json"});delete a._ts;this._exportMapImage(this._url.path+"/exportImage",a,b)}});r("extend-esri")&&u.setObject("layers.ArcGISImageServiceLayer",
G,n);return G})},"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query dojo/DeferredList ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ../renderers/colorRampUtils ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z,E,J,D,L,C,N,S,F,T){G=G(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_rasterFieldPrefix:"Raster.",_renderingRuleFieldSubPrefix:"ServicePixelValue.",_rasterFunctionServiceInfoProps:"bandCount pixelType hasRasterAttributeTable hasColormap hasHistograms minValues maxValues meanValues stdvValues serviceDataType".split(" "),_pixelTypeRanges:{U1:[0,1],U2:[0,3],U4:[0,15],U8:[0,255],S8:[-128,127],U16:[0,65535],S16:[-32768,32767]},_eventMap:{"rendering-change":!0,
"mosaic-rule-change":!0,"spatial-reference-change":!0,"renderer-change":!0},_cachedVariableStats:{},_cachedVariableHistogram:{},constructor:function(y,B){this.useMapTime=B&&B.hasOwnProperty("useMapTime")?!!B.useMapTime:!0},_initialize:function(y,B){this._url=q.urlToObject(y);this.raster=new E(this._url.path);this._rasterFunctionTemplateInfos={};this._customRenderingRuleId={};this.infoTemplate=B&&B.infoTemplate;this.format=(y=B&&B.imageServiceParameters)&&y.format;this.compressionTolerance=y&&y.compressionTolerance?
y.compressionTolerance:.01;this.interpolation=y?y.interpolation:null;this.compressionQuality=y?y.compressionQuality:null;this.bandIds=y?y.bandIds:null;this.mosaicRule=y?y.mosaicRule:null;this.renderingRule=y?y.renderingRule:null;this.renderer=y?y.renderer:null;this.useMapDimensionValue=B&&B.hasOwnProperty("useMapDimensionValue")?!!B.useMapDimensionValue:!0;this.hasImageFilter=B&&B.hasImageFilter;this.activeMapDimensions=B&&B.activeMapDimensions;this._params=u.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,
format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},y?y.toJson():{});this.pixelFilter=B&&B.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=u.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=u.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=u.hitch(this,this._initLayer);this._queryVisibleRastersHandler=u.hitch(this,this._queryVisibleRastersHandler);
this._visibleRasters=[];this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._renderingRuleAttributeTable={};this._renderingRuleColormap={};this._useRenderingRuleAttributeTable=!1;this._loadCallback=B&&B.loadCallback;y&&y.renderer&&(y.renderer.outputUnit||y.renderer.inputUnit)&&(this.vectorFieldPixelFilter=new D,this.vectorFieldPixelFilter.setUnits(y.renderer.inputUnit,y.renderer.outputUnit));(B=B&&B.resourceInfo)?this._initLayer(B):f({url:this._url.path,content:u.mixin({f:"json"},
this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(y,B){if(null!==y&&void 0!==y){this._findCredential();(this.credential&&this.credential.ssl||y&&y._ssl)&&this._useSSL();B=this.minScale;var I=this.maxScale;u.mixin(this,y);this.minScale=B;this.maxScale=I;this.initialExtent=this.fullExtent=this.extent=new t(y.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=
parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);var P=this.minValues,X=this.maxValues,Y=this.meanValues,aa=this.stdvValues,Z=this.bands=[];B=0;for(I=this.bandCount;B<I;B++)Z[B]={min:P[B],max:X[B],mean:Y[B],stddev:aa[B]};this.timeInfo=(B=this.timeInfo)&&B.timeExtent?new C(B):null;I=this.fields=[];if(P=y.fields)for(B=0;B<P.length;B++)I.push(new N(P[B]));this._updateInfoTemplateFields(this.fields);this.version=y.currentVersion;this.version||(this.version="fields"in y||"objectIdField"in
y||"timeInfo"in y?10:9.3);c.isDefined(y.minScale)&&!this._hasMin&&"Raster"!==y.cacheType&&this.setMinScale(y.minScale);c.isDefined(y.maxScale)&&!this._hasMax&&"Raster"!==y.cacheType&&this.setMaxScale(y.maxScale);B={};y.defaultMosaicMethod?(B.method=y.defaultMosaicMethod,B.operation=y.mosaicOperator,B.sortField=y.sortField,B.sortValue=y.sortValue):B.method=H.METHOD_NONE;this.defaultMosaicRule=new H(B);this.defaultMosaicRule.ascending=!0;this._useRenderingRuleAttributeTable=10<this.version&&"esriImageServiceDataTypeThematic"===
this.serviceDataType;this._setDefaultRenderingRule(!0);this._getRenderingRuleAttributeTableAndColormap();this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&this._setDefaultMultidimensionalDefinition(!0);10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(u.hitch(this,function(fa){fa&&(fa.features&&fa.fields&&(this.rasterAttributeTable=u.clone(fa)),fa.features&&0<fa.features.length&&(this._rasterAttributeTableFeatures=
u.clone(fa.features)),fa.fields&&0<fa.fields.length&&(this._rasterAttributeTableFields=u.clone(fa.fields)),this.renderingRule||!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh())}));this._initVectorPixelFilter();this.bandIds||2!==this.bandCount||this.renderingRule||"esri.layers.ArcGISImageServiceLayer"!==this.declaredClass||this.setBandIds([0,0,0],!0);!(10.3<=this.version&&this.rasterFunctionInfos&&
this.rasterFunctionInfos.length)||this._url.query&&this._url.query.raster||this.getRasterFunctionInfos().then(u.hitch(this,function(fa){if(fa&&fa.length){this.rasterFunctionInfos=fa;var K=[],R;n.forEach(fa,function(U){if(U){var ba=U.functionType;R=R||1===ba||2===ba;K.push(U.name)}},this);this._hasItemLevelRFT=R;this._rasterFunctionNames=K;R&&(this._initVectorPixelFilter(),this.refresh())}}));this.loaded=!0;this._setDefaultFilter();this.onLoad(this);if(y=this._loadCallback)delete this._loadCallback,
y(this)}},_updateInfoTemplateFields:function(y){if(y&&!(1>y.length)&&this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.fieldInfos&&!(1>this.infoTemplate.info.fieldInfos.length)){var B,I;var P=this.infoTemplate.info.fieldInfos;for(B=0;B<y.length;B++){var X=y[B];for(I=0;I<P.length;I++)if(P[I].fieldName.toLowerCase()===X.name.toLowerCase()&&P[I].fieldName!==X.name){P[I].fieldName=X.name;break}}}},getKeyProperties:function(y){var B=this._url.path+"/keyProperties",I=new r(l._dfdCanceller),
P={f:"json"};y&&y.renderingRule&&(P.renderingRule=m.toJson(y.renderingRule.toJson()));10<this.version?(I._pendingDfd=f({url:B,content:P,handleAs:"json",callbackParamName:"callback"}),I._pendingDfd.then(function(X){I.callback(X)},function(X){I.errback(X)})):(y=Error("Layer does not have key properties"),y.log=!!k.isDebug,I.errback(y));return I},getRasterAttributeTable:function(y){var B=this._url.path+"/rasterAttributeTable",I=new r(l._dfdCanceller),P={f:"json"},X=this.hasRasterAttributeTable;y&&y.renderingRule&&
(P.renderingRule=m.toJson(y.renderingRule.toJson()),X=!0);!this.loaded||10<this.version&&X?(I._pendingDfd=f({url:B,content:P,handleAs:"json",callbackParamName:"callback"}),I._pendingDfd.then(function(Y){I.callback(Y)},function(Y){I.errback(Y)})):(y=Error("Layer does not support raster attribute table"),y.log=!!k.isDebug,I.errback(y));return I},getRenderingRuleAttributeTable:function(y){var B=new r(l._dfdCanceller);if(!y||!y.renderingRule)return B.errback(Error("Rendering rule is not specified")),
B;y=y.renderingRule;var I=this._getRenderingRuleId(y);this._renderingRuleAttributeTable&&I&&this._renderingRuleAttributeTable.hasOwnProperty(I)?B.resolve(this._renderingRuleAttributeTable[I]):B=this.getRasterAttributeTable({renderingRule:y}).then(u.hitch(this,function(P){if(P&&P.features&&P.features.length&&P.fields&&P.fields.length){var X={features:u.clone(P.features),fields:u.clone(P.fields)};I&&(this._renderingRuleAttributeTable[I]=X)}return X}));return B},_initVectorPixelFilter:function(){var y;
this._hasItemLevelRFT&&this.renderingRule&&(y=this._getItemLevelRenderingRule(this.renderingRule));if(y=y||this.renderingRule)return this.getRenderingRuleServiceInfo(y).then(u.hitch(this,function(B){!B||!this._isVectorData(B)&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass||c.isDefined(this.pixelFilter)||(this.vectorFieldPixelFilter=this.vectorFieldPixelFilter||new D,this.vectorFieldPixelFilter.isDataUV="esriImageServiceDataTypeVector-UV"===B.serviceDataType,this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,
this.getKeyProperties().then(u.hitch(this,this._setFlowRepresentation)),this._applyVectorResamplingType(B.serviceDataType))}))},_applyVectorResamplingType:function(y){if(y){var B=this.renderingRule;B&&"Resample"===B.functionName&&((B.functionArguments||{}).ResamplingType="esriImageServiceDataTypeVector-UV"===y?7:10,this.setRenderingRule(new A(B.toJson())))}},_getRasterAttributeTableFeatures:function(){var y=new r;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return y.resolve(this._rasterAttributeTableFeatures),
y;if(10<this.version&&this.hasRasterAttributeTable)return y=this.getRasterAttributeTable(),y.then(u.hitch(this,function(B){B&&B.features&&0<B.features.length&&(this._rasterAttributeTableFeatures=u.clone(B.features))})),y;y.resolve(this._rasterAttributeTableFeatures);return y},_getRenderingRuleAttributeTableFeatures:function(y){y=y&&y.renderingRule;return y?this.getRenderingRuleAttributeTable({renderingRule:y}).then(function(B){return B&&B.features}):(y=new r,y.errback(Error("Rendering rule is not specified")),
y)},_getRenderingRuleAttributeTableAndColormap:function(){this.renderingRule&&this.getRenderingRuleServiceInfo(this.renderingRule).then(u.hitch(this,function(y){y.hasRasterAttributeTable&&this.getRenderingRuleAttributeTable({renderingRule:this.renderingRule}).then(u.hitch(this,function(){!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh()}));y.hasColormap&&this.getRenderingRuleColormap({renderingRule:this.renderingRule}).then(u.hitch(this,
function(){this.renderer&&"esri.renderer.ColormapRenderer"===this.renderer.declaredClass&&this.refresh()}))}))},getCustomRasterFields:function(y){var B=y?y.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix;y=10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString";var I={name:this._rasterFieldPrefix+"ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:y},P={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,
length:50,type:y},X={name:this._rasterFieldPrefix+"ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"},Y=this.fields?u.clone(this.fields):[];y=Y.length;Y[y]=P;10.4<=this.version&&"esri.layers.ArcGISImageServiceLayer"===this.declaredClass&&(!this.rasterFunctionInfos||!this.rasterFunctionInfos.length||this._isRenderingRuleAProcessingTemplate({functionName:"none"}))&&(y++,Y[y]=X);if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||
this.fields&&0<this.fields.length)y++,Y[y]=I;!c.isDefined(this.pixelFilter)||"esriImageServiceDataTypeVector-UV"!==this.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.serviceDataType||(I={name:this._rasterFieldPrefix+"Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},P={name:this._rasterFieldPrefix+"Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"},y++,Y[y]=I,y++,Y[y]=P);y=this._rasterAttributeTableFields;(I=this.renderingRule&&
this._getRenderingRuleId(this.renderingRule))&&this._renderingRuleAttributeTable&&this._renderingRuleAttributeTable.hasOwnProperty(I)&&(y=this._renderingRuleAttributeTable[I].fields);y&&0<y.length&&(y=n.filter(y,function(Z){return"esriFieldTypeOID"!==Z.type&&"value"!==Z.name.toLowerCase()}),y=n.map(y,function(Z){var fa=u.clone(Z);fa.name=B+Z.name;return fa}),Y=Y.concat(y));var aa=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;10.4<=this.version&&this.rasterFunctionInfos&&n.forEach(this.rasterFunctionInfos,
function(Z){Z&&Z.name&&"none"!==Z.name.toLowerCase()&&(Z={name:aa+Z.name.replace(/ /gi,"_"),alias:Z.name,domain:null,editable:!1,type:"esriFieldTypeDouble"},Y.push(Z))});return Y},_applyTimeToMultidimensionalCRF:function(y,B){var I=this._isTimeSupportedOnCRF();if(I&&(!y||!y.multidimensionalDefinition))return y;var P=this.timeInfo&&this.timeInfo.startTimeField;if((B=B||this._params.time)&&P&&this._isMultidimensionalCRF()){y=u.clone(y||this.defaultMosaicRule)||new H;y.multidimensionalDefinition=y.multidimensionalDefinition||
[];var X=y.multidimensionalDefinition.filter(function(aa){return aa.dimensionName===P}),Y=B.split(",").map(function(aa){return parseInt(aa,10)});2===Y.length&&Y[0]===Y[1]&&(Y.length=1);0<X.length?I?y.multidimensionalDefinition.forEach(function(aa){aa.dimensionName===P&&(aa.dimensionName=null,aa.isSlice=null,aa.values=null)}):y.multidimensionalDefinition.forEach(function(aa){aa.dimensionName===P&&(aa.isSlice=1===Y.length,aa.values=1===Y.length?Y:[Y])}):I||(y.multidimensionalDefinition.some(function(aa){return null!=
aa.variableName&&null==aa.dimensionName})?y.multidimensionalDefinition.forEach(function(aa){null!=aa.variableName&&null==aa.dimensionName&&(aa.dimensionName=P,aa.isSlice=1===Y.length,aa.values=1===Y.length?Y:[Y])}):y.multidimensionalDefinition.push(new z({variableName:"",dimensionName:P,isSlice:1===Y.length,values:1===Y.length?Y:[Y]})));this._cleanupMultidimensionalDefinition(y)}return y},_prepareGetImageParameters:function(y,B,I,P){P=c.isDefined(P)?P:this._params;if(this.renderer||this._hasItemLevelRFT&&
this.renderingRule){var X=this.getExportImageRenderingRule();P.renderingRule=X?m.toJson(X.toJson()):null}X=this.getExportImageMosaicRule(P);P.mosaicRule=X?m.toJson(X.toJson()):null;X=y.spatialReference.wkid||m.toJson(y.spatialReference.toJson(!1));delete P._ts;u.mixin(P,{bbox:y.xmin+","+y.ymin+","+y.xmax+","+y.ymax,imageSR:X,bboxSR:X,size:B+","+I},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete P.compressionTolerance;P.format&&"LERC"===P.format.toUpperCase()&&(P.compressionTolerance=
this.compressionTolerance);P.token=this._getToken()},getImageUrl:function(y,B,I,P,X){X=c.isDefined(X)?X:this._params;this._prepareGetImageParameters(y,B,I,X);y=u.clone(X);this._cleanupRequestParams(y);B=this._url.path+"/exportImage?";I=q.addProxy(B+b.objectToQuery(u.mixin(y,{f:"image"})));var Y=y.token;I.length>h.defaults.io.postLength||this.useMapImage?this._jsonRequest=f({url:B,content:u.mixin(y,{f:"json"}),callbackParamName:"callback",load:function(aa,Z){aa=aa.href;Y&&(aa+=-1===aa.indexOf("?")?
"?token\x3d"+Y:"\x26token\x3d"+Y);P(q.addProxy(aa))},error:this._errorHandler}):P(I)},onRenderingChange:function(){},onMosaicRuleChange:function(){},onRendererChange:function(){},setInterpolation:function(y,B){this.interpolation=this._params.interpolation=y;B||this.refresh(!0)},setCompressionQuality:function(y,B){this.compressionQuality=this._params.compressionQuality=y;B||this.refresh(!0)},setCompressionTolerance:function(y,B){this.compressionTolerance=y;B||this.refresh(!0)},setBandIds:function(y,
B){var I=!1;this.bandIds!==y&&(I=!0);this.bandIds=y;this._params.bandIds=y?y.join(","):null;if(I&&!B)this.onRenderingChange();B||this.refresh(!0)},setDefaultBandIds:function(y){this.bandIds=this._params.bandIds=null;y||this.refresh(!0)},setDisableClientCaching:function(y){this.disableClientCaching=y},setMosaicRule:function(y,B){var I=!1;this.mosaicRule!==y&&(I=!0);this.mosaicRule=y;this._params.mosaicRule=m.toJson(y.toJson());if(I&&!B)this.onMosaicRuleChange();B||this.refresh(!0)},getRasterFunctionInfos:function(){if(10.3>
this.version||!this.rasterFunctionInfos||!this.rasterFunctionInfos.length)console.log("Layer doesn't support /rasterFunctionInfos resource.");else return f({url:this._url.path+"/rasterFunctionInfos",content:{f:"json"},handleAs:"json",load:function(y){return y&&y.rasterFunctionInfos}})},setRenderingRule:function(y,B){var I=!1;this.renderingRule!==y&&(I=!0);this.renderingRule=y;this._params.renderingRule=y?m.toJson(y.toJson()):null;this._useRenderingRuleAttributeTable?this.getRenderingRuleAttributeTable({renderingRule:y}):
"esri.layers.RasterXLayer"!==this.declaredClass&&this._getRenderingRuleAttributeTableAndColormap();if(I)this.onRenderingChange();this._setDefaultFilter();B||this.refresh(!0)},setImageFormat:function(y,B){this.format=this._params.format=y;this._setDefaultFilter();B||this.refresh(!0)},setInfoTemplate:function(y){this.infoTemplate=y;this._updateInfoTemplateFields(this.fields)},setDefinitionExpression:function(y,B){var I=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?
I=this.defaultMosaicRule.toJson():I.method=H.METHOD_NONE);I.where=y;y=new H(I);this.setMosaicRule(y,B);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},setPixelFilter:function(y){this.pixelFilter=y;this._isDefaultPixelFilter=!1},getPixelData:function(y){return y?(this._useBrowserDecoding()&&(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):
this.pixelData},getExportImageRenderingRule:function(){var y;this._hasItemLevelRFT&&this.renderingRule&&(y=this._getServiceLevelRenderingRule(this.renderingRule));y=y||this.renderingRule;this._isItemLevelRasterFunction(this.renderingRule)&&(y=void 0);return this._combineRenderingRule(this._convertRendererToRenderingRule(this.renderer),y)},getExportImageMosaicRule:function(){var y=this.mosaicRule,B;this._hasItemLevelRFT&&this.renderingRule&&(B=this._getItemLevelRenderingRule(this.renderingRule));B&&
(y=y||this.defaultMosaicRule||new H,y.itemRenderingRule=B);return y=this._applyTimeToMultidimensionalCRF(y)},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getHistograms:function(y){var B=new r(l._dfdCanceller);if(y&&this._cachedVariableHistogram[y])return B.resolve(this._cachedVariableHistogram[y]),B;if(this.hasHistograms){var I={f:"json"};y&&(I.variable=y);B._pendingDfd=f({url:this._url.path+"/histograms",content:I,handleAs:"json",callbackParamName:"callback"});
B._pendingDfd.then(u.hitch(this,function(P){y&&(this._cachedVariableHistogram[y]=P);B.callback(P)}),function(P){B.errback(P)})}else I=Error("Layer does not have histograms."),I.log=!!k.isDebug,B.errback(I);return B},computeHistograms:function(y){var B=new r(l._dfdCanceller);if(10.1<=this.currentVersion){y=y||{};var I=y.geometry||this.fullExtent,P=(y.geometry||this.fullExtent).toJson();I="extent"===I.type?"esriGeometryEnvelope":"esriGeometryPolygon";var X=y.renderingRule||this.renderingRule||this.defaultRenderingRule;
X=X?X.toJson():null;var Y=y.mosaicRule||this.mosaicRule||this.defaultMosaicRule;Y=Y?Y.toJson():null;y=y.pixelSize||{x:this.pixelSizeX,y:this.pixelSizeY};B._pendingDfd=f({url:this._url.path+"/computeHistograms",content:u.mixin({f:"json",geometry:JSON.stringify(P),geometryType:I,renderingRule:JSON.stringify(X),mosaicRule:JSON.stringify(Y),pixelSize:JSON.stringify(y),callbackParamName:"callback"}),handleAs:"json"});B._pendingDfd.then(function(aa){B.callback(aa)},function(aa){B.errback(aa)})}else P=Error("Layer doesn't support computeHistograms."),
P.log=!!k.isDebug,B.errback(P);return B},getRenderingRuleServiceInfo:function(y,B){function I(Y){return Y.name&&Y.arguments&&Y.function&&Y.hasOwnProperty("functionType")}var P=new l._fixDfd(new r(l._dfdCanceller));if(!y)return P.errback(Error("Rendering rule is not specified")),P;if(I(y))"ClipFunction"===y.function.type&&(y=this._handleClipFunctionInRenderingRule(y));else{var X=this._getRenderingRuleId(y);if(X&&this._rasterFunctionTemplateInfos[X])return P.resolve(this._rasterFunctionTemplateInfos[X]),
P}return f({url:this._url.path,content:u.mixin(u.mixin({f:"json",renderingRule:JSON.stringify(y.toJson())},this._url.query)),callbackParamName:"callback",load:u.hitch(this,function(Y){var aa={};n.forEach(this._rasterFunctionServiceInfoProps,function(Z){aa[Z]=Y[Z]});I(y)||(this._rasterFunctionTemplateInfos[X]=aa);return aa}),error:B||this._errorHandler})},queryVisibleRasters:function(y,B,I,P){var X=this._map,Y=l._fixDfd(new r(l._dfdCanceller));this._visibleRasters=[];var aa,Z,fa=!0,K=!0,R=null,U=this.infoTemplate?
this.infoTemplate.info:null,ba=U?u.clone(this.infoTemplate.info.fieldInfos):null;B=B||{};if(U&&this.infoTemplate.info.mediaInfos&&this.infoTemplate.info.mediaInfos.length){var Q=[];n.forEach(this.infoTemplate.info.mediaInfos,function(ja){Q=Q.concat(ja&&ja.value&&ja.value.fields||[])});Q.length&&n.forEach(ba,function(ja){ja&&-1<Q.indexOf(ja.fieldName)&&(ja.visible=!0)})}var ea=function(ja){var ia=U&&U.title&&-1<U.title.toLowerCase().indexOf(ja.toLowerCase());ja=U&&U.description&&-1<U.description.toLowerCase().indexOf(ja.toLowerCase());
return ia||ja};if(ba&&0<ba.length)for(fa=!1,aa=0;aa<ba.length;aa++)if((Z=ba[aa])&&Z.fieldName.toLowerCase()!==this._rasterFieldPrefix.toLowerCase()+"servicepixelvalue"&&(Z.visible||ea(Z.fieldName))){fa=!0;break}this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("returnTopmostRaster")&&(R=this.infoTemplate.info.layerOptions.returnTopmostRaster?1:null);ba&&0<ba.length&&(K=!1,n.some(ba,function(ja){if(ja&&ja.fieldName.toLowerCase()===
this._rasterFieldPrefix.toLowerCase()+"itempixelvalue"&&ja.visible)return K=!0},this),ea(this._rasterFieldPrefix.toLowerCase()+"itempixelvalue")&&(K=!0));var la=(Z=this._removeVisualizationStretchFunction(this.renderingRule))&&Z.functionName,ma=[];if(10.4<=this.version){var M=!1;if(this.rasterFunctionInfos&&ba){var W=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;n.forEach(this.rasterFunctionInfos,function(ja){var ia=W+ja.name.replace(/ /gi,"_");n.some(ba,function(pa){return pa.visible&&
pa.fieldName===ia})&&(M=M||la&&la===ja.name,ma.push(new A({rasterFunction:ja.name})))})}Z&&!M&&ma.push(Z)}aa=new T;aa.geometry=y.geometry;aa.returnGeometry=this._map.spatialReference.equals(this.spatialReference);aa.returnCatalogItems=fa;aa.timeExtent=this.timeInfo?y.timeExtent:null;aa.returnPixelValues=K;aa.maxItemCount=R||y.maxItemCount;this._params.time&&this.mosaicRule?(y=u.clone(this.mosaicRule),y=this._filterOutTimeDimension(y),aa.mosaicRule=y):aa.mosaicRule=this.mosaicRule||null;this._isMultidimensionalCRF()&&
aa.timeExtent&&(aa.mosaicRule=this._applyTimeToMultidimensionalCRF(aa.mosaicRule,aa.timeExtent.toJson().join(",")),this._isTimeSupportedOnCRF()||delete aa.timeExtent);aa.renderingRule=10.4>this.version&&Z||null;aa.renderingRules=ma||null;10.8>this.version&&(aa.returnPixelValues=void 0,aa.maxItemCount=void 0);X&&(X=new v((X.extent.xmax-X.extent.xmin)/X.width,(X.extent.ymax-X.extent.ymin)/X.height,X.extent.spatialReference),aa.pixelSize=X);B.requestParams=aa;var da=this;X=new F(this.url);(Y._pendingDfd=
X.execute(aa)).addCallbacks(function(ja){da._queryVisibleRastersHandler(ja,B,I,P,Y)},function(ja){da._resolve([ja],null,P,Y,!0)});return Y},_queryVisibleRastersHandler:function(y,B,I,P,X){function Y(){var va=this.getCustomRasterFields(B),ya=this._getDomainFields(va),ua=B?B.returnDomainValues:!1,Aa=B&&B.rasterAttributeTableFieldPrefix,Ga,Ba,Ea,Ra,Ta,Za,Ya,cb,O,V;va=(va=this._getRenderingRuleId(this.renderingRule))&&this._rasterFunctionTemplateInfos[va];this.renderingRule&&(this._useRenderingRuleAttributeTable||
va)?(va=this._getRenderingRuleAttributeTableFeatures({renderingRule:this.renderingRule}),this.hasRasterAttributeTable||(V=aa)):va=this._getRasterAttributeTableFeatures();va.then(u.hitch(this,function(ca){for(Ga=0;Ga<da.length;Ga++){ra=da[Ga];ra.setInfoTemplate(this.infoTemplate);ra._layer=this;if(aa){O=aa.replace(/ /gi,"").split(",");Ba=aa;Ea=O;ja&&ja.length>=Ga&&(Ba=ja[Ga].replace(/ /gi,", "),Ea=ja[Ga].split(" "));ra.attributes[this._rasterFieldPrefix+"ItemPixelValue"]=Ea;ra.attributes[this._rasterFieldPrefix+
"ServicePixelValue"]=O;Z&&(ra.attributes[this._rasterFieldPrefix+"ServicePixelValue.Raw"]=Z.replace(/ /gi,"").split(","));if(this.pixelFilter){var ka=new J({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]});n.forEach(Ea,function(na){ka.addData({pixels:[na],statistics:{minValue:na,maxValue:na,noDataValue:null}})});this.pixelFilter({pixelBlock:ka,extent:new t(0,0,0,0,this._map.spatialReference)});if("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===
this.serviceDataType)ra.attributes[this._rasterFieldPrefix+"Magnitude"]=ka.pixels[0][0],ra.attributes[this._rasterFieldPrefix+"Direction"]=ka.pixels[1][0]}n.forEach(ba,function(na){ra.attributes[na.name]=na.value});var ha=0<this.fields.length?V||Ba:V||Z;if(ca&&0<ca.length&&(Ra=n.filter(ca,function(na){if(na&&na.attributes)return na.attributes.hasOwnProperty("Value")?na.attributes.Value==ha:na.attributes.VALUE==ha}),0<Ra.length&&(Ta=u.clone(Ra[0]),Aa&&Ta))){cb={};for(Za in Ta.attributes)Ta.attributes.hasOwnProperty(Za)&&
(Ya=Aa+Za,cb[Ya]=Ta.attributes[Za]);Ta.attributes=cb;ra.attributes=u.mixin(ra.attributes,Ta.attributes)}}ua&&ya&&0<ya.length&&n.forEach(ya,function(na){if(na){var qa=ra.attributes[na.name];c.isDefined(qa)&&(qa=this._getDomainValue(na.domain,qa),c.isDefined(qa)&&(ra.attributes[na.name]=qa))}},this);wa.push(ra);this._visibleRasters.push(ra)}this._resolve([wa,null,!0],null,I,X)}))}var aa=y.value,Z=y.value,fa=0,K=0,R=this,U=this.objectIdField,ba=[];P=B.requestParams.renderingRules;var Q=y.processedValues,
ea=this.renderingRule&&m.toJson(this._removeVisualizationStretchFunction(this.renderingRule).toJson());if(P&&Q&&P.length===Q.length){var la=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;n.forEach(P,function(va,ya){if(va.functionName){var ua={name:la+va.functionName.replace(/ /gi,"_"),value:Q[ya].replace(/ /gi,"").split(",")};ba.push(ua);ea&&ea===m.toJson(va.toJson())&&(aa=Q[ya])}})}P=this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?
this.infoTemplate.info.layerOptions.showNoDataRecords:!0;if(y.catalogItems){var ma=0,M=y.catalogItems.features.length;var W=0;var da=Array(M);var ja=Array(M);var ia=Array(M);if(y.properties&&y.properties.Values){M=y.properties.Values.length;for(fa=0;fa<M;fa++)-1<y.properties.Values[fa].toLowerCase().indexOf("nodata")&&W++;var pa=M-W;for(fa=0;fa<M;fa++){W=!0;if(-1<y.properties.Values[fa].toLowerCase().indexOf("nodata")){var oa=pa++;P||(W=!1,da.length--,ja.length--,ia.length--)}else oa=ma++;W&&(da[oa]=
y.catalogItems.features[fa],ja[oa]=y.properties.Values[fa],ia[oa]=da[oa].attributes[U])}}else{for(fa=0;fa<M;fa++)da[fa]=y.catalogItems.features[fa],ia[fa]=da[fa].attributes[U];ja=null}}this._visibleRasters=[];(y=-1<aa.toLowerCase().indexOf("nodata"))&&!P&&(da=[],ja=[],ia=[]);if(aa&&!da&&!y){U="ObjectId";da=[];var ra=new S(new t(this.fullExtent),null,{ObjectId:0});da.push(ra)}var wa=[];da?!this._map.spatialReference.equals(this.spatialReference)&&ia&&0<ia.length?f({url:this._url.path+"/query",content:{f:"json",
objectIds:ia.join(","),returnGeometry:!0,outSR:m.toJson(R._map.spatialReference.toJson()),outFields:U},handleAs:"json",callbackParamName:"callback",load:function(va){if(0===va.features.length)R._resolve([wa,null,null],null,I,X);else{for(fa=0;fa<va.features.length;fa++)for(K=0;K<da.length;K++)da[K].attributes[U]==va.features[fa].attributes[U]&&(da[K].geometry=new w(va.features[fa].geometry),da[K].geometry.setSpatialReference(R._map.spatialReference));Y.call(R)}},error:function(va){R._resolve([wa,null,
null],null,I,X)}}):Y.call(this):this._resolve([wa,null,null],null,I,X)},getVisibleRasters:function(){var y=this._visibleRasters,B=[],I;for(I in y)y.hasOwnProperty(I)&&B.push(y[I]);return B},_getDomainFields:function(y){if(y){var B=[];n.forEach(y,function(I){if(I.domain){var P={};P.name=I.name;P.domain=I.domain;B.push(P)}});return B}},_getDomainValue:function(y,B){if(y&&y.codedValues){var I;n.some(y.codedValues,function(P){return P.code===B?(I=P.name,!0):!1});return I}},_requestData:function(y,B,I){this._rasterReadPromise&&
this._rasterReadPromise.cancel();y=u.clone(y);var P=y._normalize(!0);this._prepareGetImageParameters(P,B,I);B=u.clone(this._params);this._cleanupRequestParams(B);B.extent=y;B.format=B.format||(10.3<=this.version?"lerc":"jpgpng");"lerc"===B.format.toLowerCase()&&!B.lercVersion&&10.5<=this.version&&(B.lercVersion=2);this._params.time&&this._isMultidimensionalCRF()&&!this._isTimeSupportedOnCRF()&&delete B.time;I=null;this._useBrowserDecoding()&&(I=new L({ctx:this._context}));B={imageServiceParameters:B,
nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,decodeFunc:I?u.hitch(I,"decode"):null};this._rasterReadPromise=this.raster.read(B,this._requestDataHandler,this._requestDataErrorHandler)},_requestDataHandler:function(y){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this.originalPixelData=y,this.hasDataChanged=!0,this._setPixelData(y))},_setPixelData:function(y){y=this._clonePixelData(y);this.pixelFilter&&this.pixelFilter(y);this.pixelData=y;this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||
(this._drawPixelData(),this._rasterReadPromise=null)},_clonePixelData:function(y){if(null===y||void 0===y)return y;var B={};y.extent&&(B.extent=u.clone(y.extent));y=y.pixelBlock;if(null===y||void 0===y)return B;B.pixelBlock=y.clone();return B},_setDefaultFilter:function(){},_getPixelBlockFromCanvas:function(y,B,I){y=y.getImageData(0,0,B,I).data;var P=B*I,X=0,Y=0,aa=new Uint8Array(P),Z=new Uint8Array(P),fa=new Uint8Array(P),K=new Uint8Array(P),R=Infinity,U=Infinity,ba=Infinity,Q=-Infinity,ea=-Infinity,
la=-Infinity;for(X=0;X<P;X++){var ma=y[Y++];var M=y[Y++];var W=y[Y++];R=R<ma?R:ma;Q=Q>ma?Q:ma;U=U<M?U:M;ea=ea>M?ea:M;ba=ba<W?ba:W;la=la>W?la:W;aa[X]=ma;Z[X]=M;fa[X]=W;K[X]=y[Y++]&1}return new J({width:B,height:I,pixels:[aa,Z,fa],pixelType:"U8",mask:K,statistics:[{minValue:R,maxValue:Q},{minValue:U,maxValue:ea},{minValue:ba,maxValue:la}]})},_useBrowserDecoding:function(){return(void 0===this.pixelFilter||null===this.pixelFilter)&&("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||
-1<this.format.toLowerCase().indexOf("png"))},getMultidimensionalInfo:function(){var y=this._url.path+"/multiDimensionalInfo",B=new r(l._dfdCanceller);if(this._multidimensionalInfo)return B.resolve(this._multidimensionalInfo),B;!this.loaded||10.3<=this.version&&this.hasMultidimensions?(B._pendingDfd=f({url:y,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),B._pendingDfd.then(u.hitch(this,function(I){this._multidimensionalInfo=I.multidimensionalInfo;B.callback(I.multidimensionalInfo)}),
function(I){B.errback(I)})):(y=Error("Layer does not support multidimensional info"),y.log=!!k.isDebug,B.errback(y));return B},getStatistics:function(y){var B=new r(l._dfdCanceller);if(y&&this._cachedVariableStats[y])B.resolve(this._cachedVariableStats[y]);else{var I={f:"json"};y&&(I.variable=y);B._pendingDfd=f({url:this._url.path+"/statistics",content:I,handleAs:"json",callbackParamName:"callback"});B._pendingDfd.then(u.hitch(this,function(P){P=P.statistics||P.statitsics;var X=[];P&&P[0]&&null!=
P[0].min?P.forEach(function(Y){X.push([Y.min,Y.max,Y.mean,Y.standardDeviation])}):X=this.minValues&&this.minValues.length?this.minValues.map(function(Y,aa){return[Y,this.maxValues[aa],this.meanValues[aa],this.stdvValues[aa]]}.bind(this)):P;y&&(this._cachedVariableStats[y]=X);B.callback(X)}),function(P){B.errback(P)})}return B},getDefaultMultidimensionalDefinition:function(){var y=new r(l._dfdCanceller);if(this._defaultMultidimensionalDefinition)return y.resolve(u.clone(this._defaultMultidimensionalDefinition)),
y;y._pendingDfd=this.getMultidimensionalInfo();y._pendingDfd.then(u.hitch(this,function(B){B=this._getDefaultMultidimensionalDefinition(B);y.callback(B)}),function(B){y.errback(B)});return y},_getDefaultMultidimensionalDefinition:function(y,B,I){var P,X=[],Y=this.defaultVariable||"",aa=Y.length?y.variables.filter(function(Z){return Z.name===Y})[0].dimensions:y.variables[0].dimensions;I&&(Y=this.defaultVariable||y.variables[0].name);for(P in aa)aa.hasOwnProperty(P)&&(B||"StdTime"!==aa[P].name)&&(y=
aa[P],X.push(new z({variableName:Y,dimensionName:y.name,isSlice:!y.hasRanges,values:[this._getDefaultDimensionValue(y)]})));this._defaultMultidimensionalDefinition=X;return u.clone(X)},_getDefaultDimensionValue:function(y){if(y&&y.values&&y.values.length){var B=Infinity,I;if(y.hasRanges)return y.values[0];if(y.name&&"stdz"===y.name.toLowerCase()){for(I=0;I<y.values.length;I++){var P=y.values[I];var X=Math.abs(P-0);if(X<B){B=X;var Y=P}if(0===X)break}return Y}return y.extent[0]}},_setDefaultMultidimensionalDefinition:function(y){var B,
I={};this.getDefaultMultidimensionalDefinition().then(u.hitch(this,function(P){B=P;0<B.length&&(this.mosaicRule?(I=u.clone(this.mosaicRule),I.multidimensionalDefinition=B):this.defaultMosaicRule?(I=u.clone(this.defaultMosaicRule),I.multidimensionalDefinition=B):I=new H({multidimensionalDefinition:B}),this.setMosaicRule(I,y))}))},_setDefaultRenderingRule:function(y){var B={},I=this.renderingRule;if(!I&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass&&!this.bandIds&&this.rasterFunctionInfos&&
this.rasterFunctionInfos.length&&"none"!==this.rasterFunctionInfos[0].name.toLowerCase())B.rasterFunction=this.rasterFunctionInfos[0].name;else if("esri.layers.ArcGISImageServiceVectorLayer"===this.declaredClass&&10.3<this.version&&(!I||"Resample"!==I.functionName)){var P="esriImageServiceDataTypeVector-UV"===this.serviceDataType?7:10;B.rasterFunction="Resample";B.rasterFunctionArguments={ResamplingType:P,InputCellSize:{x:this.pixelSizeX,y:this.pixelSizeY}};I&&(B.rasterFunctionArguments.Raster=I.toJson())}B.hasOwnProperty("rasterFunction")&&
(this.defaultRenderingRule=new A(B),this.setRenderingRule(this.defaultRenderingRule,y))},_cleanupRequestParams:function(y){if(!y)return y;if(y.time&&y.mosaicRule){var B=new H(m.fromJson(y.mosaicRule));B=this._filterOutTimeDimension(B);y.mosaicRule=m.toJson(B.toJson())}B="displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent renderer".split(" ");for(var I in B)y.hasOwnProperty(B[I])&&delete y[B[I]];return y},_filterOutTimeDimension:function(y){if(this._isMultidimensionalCRF())return y;
if(y&&y.multidimensionalDefinition&&0<y.multidimensionalDefinition.length){var B=n.filter(y.multidimensionalDefinition,function(I){return"StdTime"!==I.dimensionName});y.multidimensionalDefinition=B}return y},_removeVisualizationStretchFunction:function(y){var B=y&&y.functionName;if(!B||"stretch"!==B.toLowerCase())return y;var I=y.functionArguments.Raster;return I&&I.functionName&&n.some(this.rasterFunctionInfos,function(P){return I.functionName===P.name})?I:y},_isMultidimensionalCRF:function(){return 10.71<=
this.version&&this.hasMultidimensions&&this.timeInfo&&!(this.objectIdField&&this.fields&&1<this.fields.length)},_isTimeSupportedOnCRF:function(){return 10.8<=this.version},_cleanupMultidimensionalDefinition:function(y){y&&y.multidimensionalDefinition&&(y.multidimensionalDefinition=y.multidimensionalDefinition.filter(function(B){return!(!B.variableName&&!B.dimensionName)}),0===y.multidimensionalDefinition.length&&(y.multidimensionalDefinition=null))},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===
this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType||"esriImageServiceDataTypeScientific"===this.serviceDataType||this.hasMultidimensions},_isVectorData:function(y){y=(y=y||this)&&y.serviceDataType;return"esriImageServiceDataTypeVector-UV"===y||"esriImageServiceDataTypeVector-MagDir"===y},_isRenderingRuleAProcessingTemplate:function(y){var B=y&&y.functionName;return!B||y.functionArguments?!1:n.some(B&&(this.rasterFunctionInfos||[]),function(I){return I&&I.name&&I.name.toLowerCase()===
B.toLowerCase()})},_getRenderingRuleId:function(y){var B=y&&y.functionName;if(B){if(this._isRenderingRuleAProcessingTemplate(y))return B;var I=this._customRenderingRuleId[B];if(I){if(I!==y){for(var P in this._customRenderingRuleId)if(this._customRenderingRuleId[P]===y)return P;for(I=0;this._customRenderingRuleId[X];)I+=1;var X;this._customRenderingRuleId[B+I]=y}}else this._customRenderingRuleId[B]=y;return B}},_createPixelData:function(y){y=new J({width:2,height:2,pixels:y,pixelType:this.pixelType,
statistics:y});var B=this.fullExtent.getCenter();B=new t(B.x,B.y,B.x+this.pixelSizeX,B.y+this.pixelSizeY,this.spatialReference);return{pixelBlock:y,extent:B}},_convertRendererToRenderingRule:function(y){var B=y&&y.declaredClass;if(!B||"esri.renderer.UniqueValueRenderer"!==B&&"esri.renderer.ClassBreaksRenderer"!==B&&"esri.renderer.StretchRenderer"!==B&&"esri.renderer.ShadedReliefRenderer"!==B&&"esri.renderer.ColormapRenderer"!==B)return null;var I=null;"esri.renderer.StretchRenderer"===B?I=y.toRenderingRule({convertToColormap:10.6>
this.version}):"esri.renderer.ClassBreaksRenderer"===B?I=this._convertClassifyRenderer(y):"esri.renderer.UniqueValueRenderer"===B?I=this._convertUniqueValueRenderer(y):"esri.renderer.ShadedReliefRenderer"===B?I=this._convertShadedReliefRenderer(y):"esri.renderer.ColormapRenderer"===B&&(I=this._convertColormapRenderer(y));return I},_getValueField:function(y){if(y&&y.length){var B,I;n.some(y,function(P){if((I=P.name)&&"value"===I.toLowerCase())return B=I,!0});return B}},_convertColormapRenderer:function(y){var B=
new A;B.functionName="Colormap";B.functionArguments={};y=y.colormapInfos.map(function(I){return[I.value].concat(I.color)});B.functionArguments.Colormap=y;return B},_convertShadedReliefRenderer:function(y){var B=new A;B.functionName="Hillshade";var I="traditional"===y.hillshadeType?0:1,P="none"===y.scalingType?1:3,X={HillshadeType:I,SlopeType:P,ZFactor:y.zFactor};0===I&&(X.Azimuth=y.azimuth,X.Altitude=y.altitude);3===P&&(X.PSPower=y.pixelSizePower,X.PSZFactor=y.pixelSizeFactor);B.functionArguments=
X;B.variableName="Raster";y.colorRamp&&(B.functionName="ShadedRelief",X.Colormap=x.convertColorRampToColormap(y.colorRamp,256));return B},_convertClassifyRenderer:function(y){var B=[],I=[],P=[],X=[],Y;var aa=this.renderingRule&&this._getRenderingRuleId(this.renderingRule);var Z=this.hasRasterAttributeTable;if(aa){Z=this._rasterFunctionTemplateInfos[aa]?this._rasterFunctionTemplateInfos[aa].hasRasterAttributeTable:this.hasRasterAttributeTable;var fa=this._renderingRuleAttributeTable[aa];var K=this._rasterFunctionTemplateInfos[aa]}var R=
fa&&fa.features?fa.features:this._rasterAttributeTableFeatures;var U=this._getValueField(fa&&fa.fields?fa.fields:this._rasterAttributeTableFields);Z&&R?(n.forEach(y.infos,function(ba,Q){var ea,la=ba.symbol.color;la.a&&n.forEach(R,function(ma){ea=ma.attributes[y.attributeField];(ea>=ba.minValue&&ea<ba.maxValue||Q===y.infos.length-1&&ea>=ba.minValue)&&X.push([ma.attributes[U],la.r,la.g,la.b])},this)},this),aa=K&&K.pixelType||this.pixelType,this._adjustColormapToPixelTypeRange(X,aa),aa=new A,aa.functionName=
"Colormap",aa.functionArguments={},aa.functionArguments.Colormap=X,aa.variableName="Raster"):(n.forEach(y.infos,function(ba,Q){Y=ba.symbol&&ba.symbol.color;Y.a?(0===Q?B.push.call(B,ba.minValue,ba.maxValue+1E-4):B.push.call(B,ba.minValue+1E-4,ba.maxValue+1E-4),I.push(Q),X.push([Q,Y.r,Y.g,Y.b])):P.push(ba.minValue,ba.maxValue)}),aa=K&&K.pixelType||this.pixelType,this._adjustColormapToPixelTypeRange(X,aa),aa=new A,aa.functionName="Remap",aa.functionArguments={InputRanges:B,OutputValues:I,NoDataRanges:P},
aa.variableName="Raster",fa=new A,fa.functionName="Colormap",fa.functionArguments={Colormap:X,Raster:aa},aa=fa);return aa},_convertUniqueValueRenderer:function(y){var B=[],I=this.renderingRule&&this._getRenderingRuleId(this.renderingRule);if(I){var P=this._renderingRuleAttributeTable[I];var X=this._rasterFunctionTemplateInfos[I]}var Y=P&&P.features?P.features:this._rasterAttributeTableFeatures;var aa=(I=P&&P.fields?P.fields:this._rasterAttributeTableFields)&&I.length?this._getValueField(I):"Value";
n.forEach(y.infos,function(Z){var fa=Z.symbol.color;fa.a&&(y.attributeField!==aa&&Y?n.forEach(Y,function(K){K.attributes[y.attributeField]==Z.value&&B.push([K.attributes[aa],fa.r,fa.g,fa.b])},this):B.push([Z.value,fa.r,fa.g,fa.b]))},this);this._adjustColormapToPixelTypeRange(B,X&&X.pixelType||this.pixelType);X=new A;X.functionName="Colormap";X.functionArguments={};X.functionArguments.Colormap=B;X.variableName="Raster";return X},_adjustColormapToPixelTypeRange:function(y,B){(B=this._pixelTypeRanges[B])&&
y.push([Math.floor(B[0]-1),0,0,0],[Math.ceil(B[1]+1),0,0,0]);return y},_combineRenderingRule:function(y,B){if(!y||!B)return y||B;var I=function(P){var X=P.Raster;return X=X&&"esri.layers.RasterFunction"===X.declaredClass?I(X.functionArguments):P};y=u.clone(y);"none"!==B.functionName.toLocaleLowerCase()&&(I(y.functionArguments).Raster=B);return y},_isItemLevelRasterFunction:function(y){var B=y&&y.functionName;if(!B||!this._hasItemLevelRFT)return!1;var I=!1;n.some(this.rasterFunctionInfos,function(P){if(P&&
P.name===B){if(1===P.functionType||2===P.functionType)I=!0;return!0}});return I},_getServiceLevelRenderingRule:function(y){if(!this._hasItemLevelRFT||!y)return y;y=new A(y.toJson());var B=y.functionArguments;for(var I;;)if((I=B&&B.Raster)&&I.functionArguments&&I.functionArguments.Raster)B=I,B=B.functionArguments;else{this._isItemLevelRasterFunction(I)&&delete B.Raster;break}return y},_getItemLevelRenderingRule:function(y){if(!this._hasItemLevelRFT||!y)return null;if(this._isItemLevelRasterFunction(y))return y;
y=new A(y.toJson());for(y=y.functionArguments;;)if((y=y&&y.Raster)&&y.functionArguments&&y.functionArguments.Raster)y=y.functionArguments;else{if(this._isItemLevelRasterFunction(y))return y;break}},_resolve:function(y,B,I,P,X){B&&this[B].apply(this,y);I&&I.apply(null,y);P&&l._resDfd(P,y,X)},_toggleTime:function(){var y=this._map;this.timeInfo&&this.useMapTime&&y&&!this.suspended?(this._timeConnect||(this._timeConnect=d.connect(y,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(y.timeExtent)):
(d.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},setUseMapTime:function(y,B){this.useMapTime=y;this._toggleTime();!B&&this._map&&this.refresh(!0)},_setTime:function(y){this._params&&(this._params.time=y?y.toJson().join(","):null)},_onTimeExtentChangeHandler:function(y){this.suspended||(this._setTime(y),this.refresh(!0))},handleSpatialReferenceChange:function(){this.onSpatialReferenceChange()},getColormap:function(y){var B=this._url.path+"/colormap",I=new r(l._dfdCanceller),
P={f:"json"};y&&y.renderingRule&&(P.renderingRule=m.toJson(y.renderingRule.toJson()));this.hasColormap?(I._pendingDfd=f({url:B,content:P,handleAs:"json",callbackParamName:"callback"}),I._pendingDfd.then(function(X){I.callback(X)},function(X){I.errback(X)})):(y=Error("Layer does not support colormap"),y.log=!!k.isDebug,I.errback(y));return I},getRenderingRuleColormap:function(y){var B=new r(l._dfdCanceller);if(!y||!y.renderingRule)return B.errback(Error("Rendering rule is not specified")),B;y=y.renderingRule;
var I=this._getRenderingRuleId(y);this._renderingRuleColormap&&I&&this._renderingRuleColormap.hasOwnProperty(I)?B.resolve(this._renderingRuleColormap[I]):B=this.getColormap({renderingRule:y}).then(u.hitch(this,function(P){P=P&&P.colormap;I&&(this._renderingRuleColormap[I]=P);return P}));return B},_handleClipFunctionInRenderingRule:function(y){y=u.clone(y);var B=y.arguments,I=B.ClippingGeometry&&B.ClippingGeometry.value,P=B.Extent&&B.Extent.value;B.ClippingRaster&&B.ClippingRaster.value||I||P||(B=
this._map.extent.toJson(),y.arguments.Extent.value=B,y.functionArguments.Extent.value=B,y._isTemplate&&(y._templateJson.arguments.Extent.value=B));return y}});a("extend-esri")&&u.setObject("layers.ImageServiceLayerMixin",G,g);return G})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point ./RasterFunction".split(" "),function(G,u,r,n,m,k,d){var a=G(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,
sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],itemRenderingRule:null,constructor:function(b){u.isObject(b)&&(u.mixin(this,b),b.mosaicMethod&&(this.method=b.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),b.mosaicOperation&&(this.operation=b.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),
b.fids&&(this.objectIds=b.fids),b.viewpoint&&(this.viewpoint=new k(b.viewpoint)),b.itemRenderingRule&&(this.itemRenderingRule=new d(b.itemRenderingRule)),this.multidimensionalDefinition=b.multidimensionalDefinition||[])},toJson:function(){var b=null,e=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(e){b=[];for(var g=0;g<e;g++)b.push("esri.layers.DimensionalDefinition"===this.multidimensionalDefinition[g].declaredClass?this.multidimensionalDefinition[g].toJson():this.multidimensionalDefinition[g])}b=
{mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:u.clone(this.lockRasterIds),viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:u.clone(this.objectIds),mosaicOperation:this.operation,multidimensionalDefinition:b,itemRenderingRule:this.itemRenderingRule?this.itemRenderingRule.toJson():null};return m.filter(b,function(h){if(null!==h)return!0})},_getMethodEnum:function(b){if(b){var e=a.METHOD_NONE;switch(b.toLowerCase()){case "byattribute":e=
a.METHOD_ATTRIBUTE;break;case "center":e=a.METHOD_CENTER;break;case "lockraster":e=a.METHOD_LOCKRASTER;break;case "nadir":e=a.METHOD_NADIR;break;case "northwest":e=a.METHOD_NORTHWEST;break;case "seamline":e=a.METHOD_SEAMLINE;break;case "viewpoint":e=a.METHOD_VIEWPOINT}return e}},_getOperatorEnum:function(b){if(b)switch(b.toLowerCase()){case "first":return a.OPERATION_FIRST;case "last":return a.OPERATION_LAST;case "max":return a.OPERATION_MAX;case "min":return a.OPERATION_MIN;case "blend":return a.OPERATION_BLEND;
case "mean":return a.OPERATION_MEAN;case "sum":return a.OPERATION_SUM}}});u.mixin(a,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",
OPERATION_SUM:"MT_SUM"});r("extend-esri")&&u.setObject("layers.MosaicRule",a,n);return a})},"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(G,u,r,n,m){G=G(null,{declaredClass:"esri.layers.DimensionalDefinition",variableName:null,dimensionName:null,values:[],isSlice:!1,constructor:function(k){u.isObject(k)&&u.mixin(this,k)},toJson:function(){var k={variableName:this.variableName,dimensionName:this.dimensionName,
values:u.clone(this.values),isSlice:this.isSlice};return m.filter(k,function(d){return null!==d})}});r("extend-esri")&&u.setObject("layers.DimensionalDefinition",G,n);return G})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec ./rasterFormats/Lerc2Codec".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t){var v,w,x,H,A,z;u=u(e,{declaredClass:"esri.layers.Raster",imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(C){this.imageServiceUrl=C;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(C,N,S){var F=this,T=new n(f._dfdCanceller);if(10>a("ie"))throw"This browser is not supported.";
if(!C.imageServiceParameters)throw"Insufficient parameters to read data";var y=r.clone(C.imageServiceParameters),B=C.pixelType;m.some(this.validPixelTypes,function(Z){return Z===B})||(y.pixelType="F32");m.some(this.validFormats,function(Z){return Z.toLowerCase()===y.format.toLowerCase()})||(y.format="lerc");var I=C.decodeFunc,P;this._prepareGetImageParameters(y);var X=y.width,Y=y.height,aa=y.extent;delete y.width;delete y.height;delete y.extent;T._pendingDfd=g({url:this.imageServiceUrl+"/exportImage",
handleAs:"arraybuffer",content:r.mixin(y,{f:"image"}),load:function(Z){F.decode(Z,{width:X,height:Y,planes:null,pixelType:B,noDataValue:y.noData,format:y.format,decodeFunc:I}).then(function(fa){P={pixelBlock:fa,extent:aa};F._resolve([P,y],"onRasterReadComplete",N,T)},function(fa){F._resolve([fa],null,S,T,!0)})},error:function(Z){F._resolve([Z],null,S,T,!0)}});return T.promise},decode:function(C,N){if(void 0===N||null===N)throw"missing decode options";var S;N.format&&(S=N.format.toUpperCase());"BSQ"!==
S&&"BIP"!==S&&(S=this._getFormat(C));var F=N.decodeFunc;if(void 0===F||null===F)F=this._getFormatDecoderDfd(S);return F(C,N)},onRasterReadComplete:function(){},_prepareGetImageParameters:function(C){if(C.size&&C.bbox){var N=C.size.split(",");C.width=parseFloat(N[0]);C.height=parseFloat(N[1]);C.extent||(N=C.bbox.split(","),C.extent=new h(parseFloat(N[0]),parseFloat(N[1]),parseFloat(N[2]),parseFloat(N[3]),new c(C.bboxSR)))}else{if(!C.width||Math.floor(C.width)!==C.width||!C.height||Math.floor(C.height)!==
C.height)throw"Incorrect Image Dimensions";if(!C.extent||"esri.geometry.Extent"!==C.extent.declaredClass)throw"Incorrect extent";N=C.extent;var S=N.spatialReference.wkid||d.toJson(N.spatialReference.toJson());delete C._ts;r.mixin(C,{bbox:N.xmin+","+N.ymin+","+N.xmax+","+N.ymax,imageSR:S,bboxSR:S,size:C.width+","+C.height},C.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(C,N,S){var F=C.ymax-C.ymin,T=C.xmax-C.xmin;S>=N?C.ymax=C.ymin+T*N/S:C.xmax=C.xmin+F*S/N;return C},
_resolve:function(C,N,S,F,T){N&&this[N].apply(this,C);S&&S.apply(null,C);F&&f._resDfd(F,C,T)},_getFormatDecoderDfd:function(C){var N=null;switch(C){case "LERC":N=this._decodeLerc;break;case "LERC2":N=this._decodeLerc2;break;case "JPEG":N=this._decodeJpeg;break;case "PNG":N=this._decodePng;break;case "BSQ":N=this._decodeBsq;break;case "BIP":N=this._decodeBip;break;case "TIFF":N=this._decodeTiff;break;default:N=function(S,F){throw"The raster format is not supported";}}N=r.hitch(this,N);return function(S,
F){var T=new n;try{if("LERC"===C||!0===A){var y=N(S,F);T.resolve(y)}else z.then(function(){y=N(S,F);T.resolve(y)})}catch(B){T.reject(B)}return T}},_getFormat:function(C){C=new Uint8Array(C,0,10);var N="";if(255===C[0]&&216===C[1])N="JPEG";else if(137===C[0]&&80===C[1]&&78===C[2]&&71===C[3])N="PNG";else if(67===C[0]&&110===C[1]&&116===C[2]&&90===C[3]&&73===C[4]&&109===C[5]&&97===C[6]&&103===C[7]&&101===C[8]&&32===C[9])N="LERC";else if(76===C[0]&&101===C[1]&&114===C[2]&&99===C[3]&&50===C[4]&&32===C[5])N=
"LERC2";else if(-1<String.fromCharCode.apply(null,C).toLowerCase().indexOf("error"))N="ERROR";else if(73===C[0]&&73===C[1]&&42===C[2]&&0===C[3]||77===C[0]&&77===C[1]&&0===C[2]&&42===C[3])N="TIFF";return N},_validateDecodeParams:function(C){if(!C.height||Math.floor(C.height)!==C.height)throw"Height not provided.";if(!C.width||Math.floor(C.width)!==C.width)throw"Width not provided.";},_decodeJpeg:function(C,N){if(!v)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(N);C=(new v).decode(C);
if(!L(C,N))throw"The decoded image dimensions are incorrect.";N=[];var S;for(S=0;S<C.pixels.length;S++){var F=C.pixels[S];N.push(this._calculateBandStatistics(F))}return new l({width:C.width,height:C.height,pixels:C.pixels,pixelType:"U8",mask:C.mask,statistics:N})},_decodePng:function(C,N){if(!w)throw"The png decoder module is not loaded.";this._validateDecodeParams(N);C=new Uint8Array(C);var S=new w(C);C=new Uint8Array(N.width*N.height*4);S.copyToImageData(C,S.decodePixels());var F=S=0;F=new Uint8Array(N.width*
N.height);for(S=0;S<N.width*N.height;S++)F[S]=C[4*S+3];var T=new l({width:N.width,height:N.height,pixels:[],pixelType:"U8",mask:F,statistics:[]});for(S=0;3>S;S++){var y=new Uint8Array(N.width*N.height);for(F=0;F<N.width*N.height;F++)y[F]=C[4*F+S];T.addData({pixels:y,statistics:this._calculateBandStatistics(y)})}return T},_decodeBsq:function(C,N){if(!x)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(N);J=N.noDataValue;N.pixelType=D(N.pixelType);C=x.decodeBSQ(C,{bandCount:N.planes,
width:N.width,height:N.height,pixelType:E,noDataValue:J});var S=[],F,T=null;for(F=0;F<C.pixels.length;F++)T=C.pixels[F],S.push(this._calculateBandStatistics(T));return new l({width:N.width,height:N.height,pixels:C.pixels,pixelType:N.pixelType,mask:C.maskData,statistics:S})},_decodeBip:function(C,N){this._validateDecodeParams(N);J=N.noDataValue;N.pixelType=D(N.pixelType);C=x.decodeBIP(C,{bandCount:N.planes,width:N.width,height:N.height,pixelType:E,noDataValue:J});var S=[],F,T=null;for(F=0;F<C.pixels.length;F++)T=
C.pixels[F],S.push(this._calculateBandStatistics(T));return new l({width:N.width,height:N.height,pixels:C.pixels,pixelType:N.pixelType,mask:C.maskData,statistics:S})},_decodeTiff:function(C,N){this._validateDecodeParams(N);J=N.noDataValue;N.pixelType=D(N.pixelType);C=H.decode(C);N=[];var S,F=null;for(S=0;S<C.pixels.length;S++)F=C.pixels[S],N.push(this._calculateBandStatistics(F,C.maskData));return new l({width:C.width,height:C.height,pixels:C.pixels,pixelType:C.pixelType,mask:C.maskData,statistics:N})},
_decodeLerc:function(C,N){this._validateDecodeParams(N);J=N.noDataValue;N.pixelType=D(N.pixelType);for(var S=0,F,T=0,y,B=C.byteLength-10;T<B;){var I=q.decode(C,{inputOffset:T,encodedMaskData:F,returnMask:0===S?!0:!1,returnEncodedMask:0===S?!0:!1,returnFileInfo:!0,pixelType:E,noDataValue:J});T=I.fileInfo.eofOffset;0===S&&(F=I.encodedMaskData,y=new l({width:N.width,height:N.height,pixels:[],pixelType:N.pixelType,mask:I.maskData,statistics:[]}));S++;if(!L(I,N))throw"The decoded image dimensions are incorrect";
y.addData({pixels:I.pixelData,statistics:{minValue:I.minValue,maxValue:I.maxValue,noDataValue:I.noDataValue}})}return y},_decodeLerc2:function(C,N){this._validateDecodeParams(N);J=N.noDataValue;N.pixelType=D(N.pixelType);for(var S=0,F,T,y=0,B,I=C.byteLength-10,P=[];y<I;){T=t.decode(C,{inputOffset:y,maskData:F,returnFileInfo:!0});y=T.fileInfo.eofOffset;0===S&&(F=T.maskData,B=new l({width:N.width,height:N.height,pixels:[],pixelType:T.fileInfo.pixelType,mask:T.maskData,statistics:[]}));T.fileInfo.mask&&
0<T.fileInfo.mask.numBytes&&P.push(T.maskData);S++;if(!L(T,N))throw"The decoded image dimensions are incorrect";if(1<T.dimCount&&T.pixelData&&T.pixelData.length===T.width*T.height*T.dimCount){T.pixelData=T.pixelData.slice(-T.width*T.height);var X=T.dimStats&&T.dimStats.minValues&&T.dimStats.minValues[T.dimCount-1],Y=T.dimStats&&T.dimStats.maxValues&&T.dimStats.maxValues[T.dimCount-1];null!=X&&null!=Y&&(T.minValue=X,T.maxValue=Y)}B.addData({pixels:T.pixelData,statistics:{minValue:T.minValue,maxValue:T.maxValue,
noDataValue:T.noDataValue}})}if(1<P.length){T=B.width*B.height;B.bandMasks=P;F=new Uint8Array(T);F.set(P[0]);for(N=1;N<P.length;N++)for(C=P[N],S=0;S<T;S++)F[S]&=C[S];B.maskData=F}return B},_calculateBandStatistics:function(C,N){var S=Infinity,F=-Infinity,T=C.length,y,B=0;if(N)for(y=0;y<T;y++)N[y]&&(B=C[y],S=B<S?B:S,F=B>F?B:F);else for(y=0;y<T;y++)B=C[y],S=B<S?B:S,F=B>F?B:F;return{minValue:S,maxValue:F}},_loadRasterFormatModules:function(){A||(z||(z=new n),10>a("ie")?z.isRejected()||z.reject("unsupported browser version"):
G(["./rasterFormats/JpgPlus","./rasterFormats/Png","./rasterFormats/Raw","./rasterFormats/TiffDecoder","./rasterFormats/Zlib"],function(C,N,S,F){v=C;w=N;x=S;H=F;A=!0;z.isResolved()||z.resolve(!0)}))}});var E=null,J=null,D=function(C){if("U1"===C||"U2"===C||"U4"===C||"U8"===C)return J=Math.pow(2,8)-1,E=Uint8Array,"U8";"U16"===C?(J=J||Math.pow(2,16)-1,E=Uint16Array):"U32"===C?(J=J||Math.pow(2,32)-1,E=Uint32Array):"S8"===C?(J=J||0-Math.pow(2,7),E=Int8Array):"S16"===C?(J=J||0-Math.pow(2,15),E=Int16Array):
"S32"===C?(J=J||0-Math.pow(2,31),E=Int32Array):E=Float32Array;return C},L=function(C,N){return C.height!==N.height||C.width!==N.width?!1:!0};a("extend-esri")&&r.setObject("layers.Raster",u,b);return u})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(G,u,r,n){G=G([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],maskIsAlpha:!1,validPixelCount:null,constructor:function(m){if(m){if(!m.width||
Math.floor(m.width)!==m.width)throw"PixelBlock: incorrect width";if(!m.height||Math.floor(m.height)!==m.height)throw"PixelBlock: incorrect height";if(!m.pixels)throw"PixelBlock: pixel data not present";this.width=m.width;this.height=m.height;this.pixels=m.pixels;this.pixelType=m.pixelType||null;this.statistics=m.statistics;this.mask=m.mask||null;this.maskIsAlpha=m.maskIsAlpha||!1;m=m.validPixelCount;null==m&&(m=this.mask?this._getValidPixelCount(this.mask):this.width*this.height);this.validPixelCount=
m}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(m){if(!m.pixels||!m.statistics)throw"Pixel data or statistics are not present";if(m.pixels.length!==this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(m.statistics);this.pixels.push(m.pixels)},getAsRGBA:function(){var m=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(m);
break;default:this._fillFrom8Bit(m)}return new Uint8ClampedArray(m)},getAsRGBAFloat:function(){var m=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(m);return m},clone:function(m){m=m||this;var k=new this.constructor;k.width=m.width;k.height=m.height;k.pixelType=m.pixelType;k.maskIsAlpha=m.maskIsAlpha;m.mask&&(k.mask=new Uint8Array(m.mask));var d,a;if(m.pixels){k.pixels=[];var b=(a=m.pixels.length)&&m.pixels[0].slice;for(d=0;d<a;d++)k.pixels[d]=b?m.pixels[d].slice(0,m.pixels[d].length):
new m.pixels[d].constructor(m.pixels[d])}if(m.statistics)for(k.statistics=[],a=m.statistics.length,d=0;d<a;d++)k.statistics[d]=u.clone(m.statistics[d]);m=m.validPixelCount;null==m&&(m=k.mask?this._getValidPixelCount(k.mask):k.width*k.height);return k},clamp:function(m){if("F64"!==m&&"F32"!==m){switch(m){case "U8":var k=[0,255];break;case "U16":k=[0,65535];break;case "U32":k=[0,4294967295];break;case "S8":k=[-128,127];break;case "S16":k=[-32768,32767];break;case "S32":k=[-2147483648,2147483647];break;
default:k=[-3.4*1E39,3.4*1E39]}var d=k[0];k=k[1];var a=this.pixels,b=this.width*this.height,e=a.length,g,h,c=[];for(g=0;g<e;g++){var f=this._createEmptyBand(m,b);var l=a[g];for(h=0;h<b;h++){var q=l[h];f[h]=q>k?k:q<d?d:q}c.push(f)}this.pixels=c;this.pixelType=m}},calculateStatistics:function(){var m,k=[],d=this.mask;for(m=0;m<this.pixels.length;m++){var a=this.pixels[m];k.push(this._calculateBandStatistics(a,d))}this.statistics=k},_getValidPixelCount:function(m){var k,d=0;for(k=0;k<m.length;k++)m[k]&&
d++;return d},_createEmptyBand:function(m,k){switch(m){case "U8":m=new Uint8Array(k);break;case "U16":m=new Uint16Array(k);break;case "U32":m=new Uint32Array(k);break;case "S8":m=new Int8Array(k);break;case "S16":m=new Int16Array(k);break;case "S32":m=new Int32Array(k);break;case "U32":m=new Uint32Array(k);break;case "F32":m=new Float32Array(k);break;case "F64":m=new Float64Array(k);break;default:m=new Float32Array(k)}return m},_fillFrom8Bit:function(m){var k=this.pixels,d=this.mask;if(!m||!k||!k.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var a,b;var e=a=b=k[0];3<=k.length&&(a=k[1],b=k[2]);k=new Uint32Array(m);var g=this.width*this.height;if(e.length!==g)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(d&&d.length===g)if(this.maskIsAlpha)for(m=0;m<g;m++)d[m]&&(k[m]=d[m]<<24|b[m]<<16|a[m]<<8|e[m]);else for(m=0;m<g;m++)d[m]&&(k[m]=-16777216|b[m]<<16|a[m]<<8|e[m]);else for(m=0;m<g;m++)k[m]=-16777216|b[m]<<16|a[m]<<8|e[m]},_fillFromNon8Bit:function(m){var k=this.pixels,d=this.mask,a=this.statistics;if(!m||
!k||!k.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var b=1,e=0;b=1;a&&0<a.length?(e=a.map(function(f){return f.minValue}).reduce(function(f,l){return Math.min(f,l)}),b=a.map(function(f){return f.maxValue-f.minValue}).reduce(function(f,l){return Math.max(f,l)}),b=255/b):(b=255,"S8"===this.pixelType?(e=-128,b=127):"U16"===this.pixelType?b=65535:"S16"===this.pixelType?(e=-32768,b=32767):"U32"===this.pixelType?b=4294967295:"S32"===this.pixelType?(e=-2147483648,
b=2147483647):"F32"===this.pixelType?(e=-3.4*1E39,b=3.4*1E39):"F64"===this.pixelType&&(e=-Number.MAX_VALUE,b=Number.MAX_VALUE),b=255/(b-e));m=new Uint32Array(m);a=this.width*this.height;var g=k[0];if(g.length!==a)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(3<=k.length){var h=k[1];var c=k[2];if(d&&d.length===a)for(k=0;k<a;k++)d[k]&&(m[k]=-16777216|(c[k]-e)*b<<16|(h[k]-e)*b<<8|(g[k]-e)*b);else for(k=0;k<a;k++)m[k]=-16777216|(c[k]-e)*b<<16|(h[k]-e)*b<<8|(g[k]-e)*
b}else if(d&&d.length===a)for(k=0;k<a;k++)h=(g[k]-e)*b,d[k]&&(m[k]=-16777216|h<<16|h<<8|h);else for(k=0;k<a;k++)h=(g[k]-e)*b,m[k]=-16777216|h<<16|h<<8|h},_fillFrom32Bit:function(m){var k=this.pixels,d=this.mask;if(!m||!k||!k.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var a,b;var e=a=b=k[0];3<=k.length&&(a=k[1],b=k[2]);var g=this.width*this.height;if(e.length!==g)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var h=0;if(d&&
d.length===g)for(k=0;k<g;k++)m[h++]=e[k],m[h++]=a[k],m[h++]=b[k],m[h++]=d[k]&1;else for(k=0;k<g;k++)m[h++]=e[k],m[h++]=a[k],m[h++]=b[k],m[h++]=1},_calculateBandStatistics:function(m,k){var d=Infinity,a=-Infinity,b=m.length,e,g=0;if(k)for(e=0;e<b;e++)k[e]&&(g=m[e],d=g<d?g:d,a=g>a?g:a);else for(e=0;e<b;e++)g=m[e],d=g<d?g:d,a=g>a?g:a;return{minValue:d,maxValue:a}}});r("extend-esri")&&u.setObject("layers.PixelBlock",G,n);return G})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var G=
{defaultNoDataValue:-3.4027999387901484E38,decode:function(r,n){n=n||{};var m=n.inputOffset||0,k=n.encodedMaskData||null===n.encodedMaskData,d={},a=new Uint8Array(r,m,10);d.fileIdentifierString=String.fromCharCode.apply(null,a);if("CntZImage"!=d.fileIdentifierString.trim())throw"Unexpected file identifier string: "+d.fileIdentifierString;m+=10;a=new DataView(r,m,24);d.fileVersion=a.getInt32(0,!0);d.imageType=a.getInt32(4,!0);d.height=a.getUint32(8,!0);d.width=a.getUint32(12,!0);d.maxZError=a.getFloat64(16,
!0);m+=24;if(!k)if(a=new DataView(r,m,16),d.mask={},d.mask.numBlocksY=a.getUint32(0,!0),d.mask.numBlocksX=a.getUint32(4,!0),d.mask.numBytes=a.getUint32(8,!0),d.mask.maxValue=a.getFloat32(12,!0),m+=16,0<d.mask.numBytes){k=new Uint8Array(Math.ceil(d.width*d.height/8));a=new DataView(r,m,d.mask.numBytes);var b=a.getInt16(0,!0),e=2,g=0;do{if(0<b)for(;b--;)k[g++]=a.getUint8(e++);else{var h=a.getUint8(e++);for(b=-b;b--;)k[g++]=h}b=a.getInt16(e,!0);e+=2}while(e<d.mask.numBytes);if(-32768!==b||g<k.length)throw"Unexpected end of mask RLE encoding";
d.mask.bitset=k;m+=d.mask.numBytes}else 0===(d.mask.numBytes|d.mask.numBlocksY|d.mask.maxValue)&&(k=new Uint8Array(Math.ceil(d.width*d.height/8)),d.mask.bitset=k);a=new DataView(r,m,16);d.pixels={};d.pixels.numBlocksY=a.getUint32(0,!0);d.pixels.numBlocksX=a.getUint32(4,!0);d.pixels.numBytes=a.getUint32(8,!0);d.pixels.maxValue=a.getFloat32(12,!0);m+=16;k=d.pixels.numBlocksX;a=d.pixels.numBlocksY;k+=0<d.width%k?1:0;b=a+(0<d.height%a?1:0);d.pixels.blocks=Array(k*b);for(g=e=0;g<b;g++)for(h=0;h<k;h++){var c=
0;a=new DataView(r,m,Math.min(10,r.byteLength-m));var f={};d.pixels.blocks[e++]=f;var l=a.getUint8(0);c++;f.encoding=l&63;if(3<f.encoding)throw"Invalid block encoding ("+f.encoding+")";if(2===f.encoding)m++;else{if(0!==l&&2!==l){l>>=6;f.offsetType=l;if(2===l)f.offset=a.getInt8(1),c++;else if(1===l)f.offset=a.getInt16(1,!0),c+=2;else if(0===l)f.offset=a.getFloat32(1,!0),c+=4;else throw"Invalid block offset type";if(1===f.encoding)if(l=a.getUint8(c),c++,f.bitsPerPixel=l&63,l>>=6,f.numValidPixelsType=
l,2===l)f.numValidPixels=a.getUint8(c),c++;else if(1===l)f.numValidPixels=a.getUint16(c,!0),c+=2;else if(0===l)f.numValidPixels=a.getUint32(c,!0),c+=4;else throw"Invalid valid pixel count type";}m+=c;if(3!=f.encoding)if(0===f.encoding){l=(d.pixels.numBytes-1)/4;if(l!==Math.floor(l))throw"uncompressed block has invalid length";a=new ArrayBuffer(4*l);c=new Uint8Array(a);c.set(new Uint8Array(r,m,4*l));a=new Float32Array(a);f.rawData=a;m+=4*l}else 1===f.encoding&&(l=Math.ceil(f.numValidPixels*f.bitsPerPixel/
8),a=new ArrayBuffer(4*Math.ceil(l/4)),c=new Uint8Array(a),c.set(new Uint8Array(r,m,l)),f.stuffedData=new Uint32Array(a),m+=l)}}d.eofOffset=m;r=null!=n.noDataValue?n.noDataValue:G.defaultNoDataValue;k=n.encodedMaskData;l=n.returnMask;b=0;e=d.pixels.numBlocksX;g=d.pixels.numBlocksY;h=Math.floor(d.width/e);f=Math.floor(d.height/g);c=2*d.maxZError;m=Number.MAX_VALUE;k=k||(d.mask?d.mask.bitset:null);var q;a=new (n.pixelType||Float32Array)(d.width*d.height);l&&k&&(q=new Uint8Array(d.width*d.height));l=
new Float32Array(h*f);for(var t,v,w=0;w<=g;w++){var x=w!==g?f:d.height%g;if(0!==x)for(var H=0;H<=e;H++){var A=H!==e?h:d.width%e;if(0!==A){var z=w*d.width*f+H*h,E=d.width-A,J=d.pixels.blocks[b],D;if(2>J.encoding){if(0===J.encoding)var L=J.rawData;else{var C=D=L=void 0;t=J.stuffedData;v=J.bitsPerPixel;var N=J.numValidPixels,S=J.offset,F=c,T=l,y=d.pixels.maxValue,B=(1<<v)-1,I=0,P=0,X=Math.ceil((y-S)/F);t[t.length-1]<<=8*(4*t.length-Math.ceil(v*N/8));for(C=0;C<N;C++)0===P&&(L=t[I++],P=32),P>=v?(D=L>>>
P-v&B,P-=v):(P=v-P,D=(L&B)<<P&B,L=t[I++],P=32-P,D+=L>>>P),T[C]=D<X?S+D*F:y;L=l}D=0}else var Y=2===J.encoding?0:J.offset;if(k)for(v=0;v<x;v++){if(z&7){var aa=k[z>>3];aa<<=z&7}for(t=0;t<A;t++)z&7||(aa=k[z>>3]),aa&128?(q&&(q[z]=1),C=2>J.encoding?L[D++]:Y,m=m>C?C:m,a[z++]=C):(q&&(q[z]=0),a[z++]=r),aa<<=1;z+=E}else if(2>J.encoding)for(v=0;v<x;v++){for(t=0;t<A;t++)C=L[D++],m=m>C?C:m,a[z++]=C;z+=E}else for(m=m>Y?Y:m,v=0;v<x;v++){for(t=0;t<A;t++)a[z++]=Y;z+=E}if(1===J.encoding&&D!==J.numValidPixels)throw"Block and Mask do not match";
b++}}}Y=q;q={width:d.width,height:d.height,pixelData:a,minValue:m,maxValue:d.pixels.maxValue,noDataValue:r};Y&&(q.maskData=Y);n.returnEncodedMask&&d.mask&&(q.encodedMaskData=d.mask.bitset?d.mask.bitset:null);if(n.returnFileInfo&&(q.fileInfo=u(d),n.computeUsedBitDepths)){n=q.fileInfo;Y=d.pixels.numBlocksX*d.pixels.numBlocksY;aa={};for(L=0;L<Y;L++)D=d.pixels.blocks[L],0===D.encoding?aa.float32=!0:1===D.encoding?aa[D.bitsPerPixel]=!0:aa[0]=!0;d=Object.keys(aa);n.bitDepths=d}return q}},u=function(r){return{fileIdentifierString:r.fileIdentifierString,
fileVersion:r.fileVersion,imageType:r.imageType,height:r.height,width:r.width,maxZError:r.maxZError,eofOffset:r.eofOffset,mask:r.mask?{numBlocksX:r.mask.numBlocksX,numBlocksY:r.mask.numBlocksY,numBytes:r.mask.numBytes,maxValue:r.mask.maxValue}:null,pixels:{numBlocksX:r.pixels.numBlocksX,numBlocksY:r.pixels.numBlocksY,numBytes:r.pixels.numBytes,maxValue:r.pixels.maxValue,noDataValue:this.noDataValue}}};return G})},"esri/layers/rasterFormats/Lerc2Codec":function(){define([],function(){var G={unstuff:function(n,
m,k,d,a,b,e,g){var h=(1<<k)-1,c=0,f,l=0;n[n.length-1]<<=8*(4*n.length-Math.ceil(k*d/8));if(a)for(f=0;f<d;f++){if(0===l){var q=n[c++];l=32}if(l>=k){var t=q>>>l-k&h;l-=k}else l=k-l,t=(q&h)<<l&h,q=n[c++],l=32-l,t+=q>>>l;m[f]=a[t]}else for(a=Math.ceil((g-b)/e),f=0;f<d;f++)0===l&&(q=n[c++],l=32),l>=k?(t=q>>>l-k&h,l-=k):(l=k-l,t=(q&h)<<l&h,q=n[c++],l=32-l,t+=q>>>l),m[f]=t<a?b+t*e:g},unstuffLUT:function(n,m,k,d,a,b){var e=(1<<m)-1,g=0,h=0,c=0,f=c=0,l=[];n[n.length-1]<<=8*(4*n.length-Math.ceil(m*k/8));var q=
Math.ceil((b-d)/a);for(h=0;h<k;h++){if(0===c){var t=n[g++];c=32}c>=m?(f=t>>>c-m&e,c-=m):(c=m-c,f=(t&e)<<c&e,t=n[g++],c=32-c,f+=t>>>c);l[h]=f<q?d+f*a:b}l.unshift(d);return l},unstuff2:function(n,m,k,d,a,b,e,g){var h=(1<<k)-1,c=0,f,l=0,q=0;if(a)for(f=0;f<d;f++){if(0===l){var t=n[c++];l=32;q=0}if(l>=k){var v=t>>>q&h;l-=k;q+=k}else{var w=k-l;v=t>>>q&h;t=n[c++];l=32-w;v|=(t&(1<<w)-1)<<k-w;q=w}m[f]=a[v]}else for(a=Math.ceil((g-b)/e),f=0;f<d;f++)0===l&&(t=n[c++],l=32,q=0),l>=k?(v=t>>>q&h,l-=k,q+=k):(w=k-
l,v=t>>>q&h,t=n[c++],l=32-w,v|=(t&(1<<w)-1)<<k-w,q=w),m[f]=v<a?b+v*e:g;return m},unstuffLUT2:function(n,m,k,d,a,b){var e=(1<<m)-1,g=0,h=0,c=0,f=0,l=0,q=0,t=[],v=Math.ceil((b-d)/a);for(h=0;h<k;h++){if(0===f){var w=n[g++];f=32;q=0}f>=m?(l=w>>>q&e,f-=m,q+=m):(c=m-f,l=w>>>q&e,w=n[g++],f=32-c,l|=(w&(1<<c)-1)<<m-c,q=c);t[h]=l<v?d+l*a:b}t.unshift(d);return t},originalUnstuff:function(n,m,k,d){var a=(1<<k)-1,b=0,e,g=0;n[n.length-1]<<=8*(4*n.length-Math.ceil(k*d/8));for(e=0;e<d;e++){if(0===g){var h=n[b++];
g=32}if(g>=k){var c=h>>>g-k&a;g-=k}else g=k-g,c=(h&a)<<g&a,h=n[b++],g=32-g,c+=h>>>g;m[e]=c}return m},originalUnstuff2:function(n,m,k,d){var a=(1<<k)-1,b=0,e,g=0,h=0;for(e=0;e<d;e++){if(0===g){var c=n[b++];g=32;h=0}if(g>=k){var f=c>>>h&a;g-=k;h+=k}else{var l=k-g;f=c>>>h&a;c=n[b++];g=32-l;f|=(c&(1<<l)-1)<<k-l;h=l}m[e]=f}return m}},u={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(n){for(var m=65535,k=65535,d=n.length,a=Math.floor(d/2),b=0;a;){var e=359<=a?359:a;a-=e;do m+=n[b++]<<8,k+=m+=
n[b++];while(--e);m=(m&65535)+(m>>>16);k=(k&65535)+(k>>>16)}d&1&&(k+=m+=n[b]<<8);return((k&65535)+(k>>>16)<<16|(m&65535)+(m>>>16))>>>0},readHeaderInfo:function(n,m){var k=m.ptr,d=new Uint8Array(n,k,6),a={};a.fileIdentifierString=String.fromCharCode.apply(null,d);if(0!==a.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+a.fileIdentifierString;k+=6;d=new DataView(n,k,8);var b=d.getInt32(0,!0);a.fileVersion=b;k+=4;3<=b&&(a.checksum=d.getUint32(4,
!0),k+=4);d=new DataView(n,k,12);a.height=d.getUint32(0,!0);a.width=d.getUint32(4,!0);k+=8;4<=b?(a.numDims=d.getUint32(8,!0),k+=4):a.numDims=1;d=new DataView(n,k,40);a.numValidPixel=d.getUint32(0,!0);a.microBlockSize=d.getInt32(4,!0);a.blobSize=d.getInt32(8,!0);a.imageType=d.getInt32(12,!0);a.maxZError=d.getFloat64(16,!0);a.zMin=d.getFloat64(24,!0);a.zMax=d.getFloat64(32,!0);k+=40;m.headerInfo=a;m.ptr=k;if(3<=b&&(n=this.computeChecksumFletcher32(new Uint8Array(n,k-(4<=b?52:48),a.blobSize-14)),n!==
a.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(n,m){var k=m.headerInfo,d=this.getDataTypeArray(k.imageType),a=k.numDims*this.getDataTypeSize(k.imageType),b=this.readSubArray(n,m.ptr,d,a);n=this.readSubArray(n,m.ptr+a,d,a);m.ptr+=2*a;a=!0;for(m=0;m<k.numDims;m++)if(b[m]!==n[m]){a=!1;break}k.minValues=b;k.maxValues=n;return a},readSubArray:function(n,m,k,d){if(k===Uint8Array)n=new Uint8Array(n,m,d);else{var a=new ArrayBuffer(d);(new Uint8Array(a)).set(new Uint8Array(n,m,d));
n=new k(a)}return n},readMask:function(n,m){var k=m.ptr,d=m.headerInfo,a=d.width*d.height,b=d.numValidPixel,e=new DataView(n,k,4);d={};d.numBytes=e.getUint32(0,!0);k+=4;if((0===b||a===b)&&0!==d.numBytes)throw"invalid mask";if(0===b)b=new Uint8Array(Math.ceil(a/8)),d.bitset=b,e=new Uint8Array(a),m.pixels.resultMask=e,k+=d.numBytes;else if(0<d.numBytes){b=new Uint8Array(Math.ceil(a/8));e=new DataView(n,k,d.numBytes);n=e.getInt16(0,!0);var g=2,h=0,c=0;do{if(0<n)for(;n--;)b[h++]=e.getUint8(g++);else for(c=
e.getUint8(g++),n=-n;n--;)b[h++]=c;n=e.getInt16(g,!0);g+=2}while(g<d.numBytes);if(-32768!==n||h<b.length)throw"Unexpected end of mask RLE encoding";e=new Uint8Array(a);for(g=g=n=0;g<a;g++)g&7?(n=b[g>>3],n<<=g&7):n=b[g>>3],n&128&&(e[g]=1);m.pixels.resultMask=e;d.bitset=b;k+=d.numBytes}m.ptr=k;m.mask=d;return!0},readDataOneSweep:function(n,m,k,d){var a=m.ptr,b=m.headerInfo,e=b.numDims,g=b.width*b.height;b=b.numValidPixel*u.getDataTypeSize(b.imageType)*e;var h=m.pixels.resultMask;if(k===Uint8Array)n=
new Uint8Array(n,a,b);else{var c=new ArrayBuffer(b);(new Uint8Array(c)).set(new Uint8Array(n,a,b));n=new k(c)}if(n.length===g*e)m.pixels.resultPixels=d?u.swapDimensionOrder(n,g,e,k,!0):n;else{m.pixels.resultPixels=new k(g*e);var f=c=k=0,l=0;if(1<e)if(d)for(c=0;c<g;c++){if(h[c])for(l=c,f=0;f<e;f++,l+=g)m.pixels.resultPixels[l]=n[k++]}else for(c=0;c<g;c++){if(h[c])for(l=c*e,f=0;f<e;f++)m.pixels.resultPixels[l+f]=n[k++]}else for(c=0;c<g;c++)h[c]&&(m.pixels.resultPixels[c]=n[k++])}m.ptr=a+b;return!0},
readHuffmanTree:function(n,m){var k=this.HUFFMAN_LUT_BITS_MAX,d=new DataView(n,m.ptr,16);m.ptr+=16;if(2>d.getInt32(0,!0))throw"unsupported Huffman version";var a=d.getInt32(4,!0),b=d.getInt32(8,!0);d=d.getInt32(12,!0);if(b>=d)return!1;var e=new Uint32Array(d-b);u.decodeBits(n,m,e);var g=[],h;for(h=b;h<d;h++){var c=h-(h<a?0:a);g[c]={first:e[h-b],second:null}}h=n.byteLength-m.ptr;e=new ArrayBuffer(4*Math.ceil(h/4));(new Uint8Array(e)).set(new Uint8Array(n,m.ptr,h));n=new Uint32Array(e);m=0;e=0;var f=
n[0];for(h=b;h<d;h++){c=h-(h<a?0:a);var l=g[c].first;0<l&&(g[c].second=f<<m>>>32-l,32-m>=l?(m+=l,32===m&&(m=0,e++,f=n[e])):(m+=l-32,e++,f=n[e],g[c].second|=f>>>32-m))}var q=f=0,t=new r;for(h=0;h<g.length;h++)void 0!==g[h]&&(f=Math.max(f,g[h].first));q=f>=k?k:f;k=[];var v;for(h=b;h<d;h++)if(c=h-(h<a?0:a),l=g[c].first,0<l)if(b=[l,c],l<=q){c=g[c].second<<q-l;var w=1<<q-l;for(l=0;l<w;l++)k[c|l]=b}else for(c=g[c].second,w=t,--l;0<=l;l--)(v=c>>>l&1)?(w.right||(w.right=new r),w=w.right):(w.left||(w.left=
new r),w=w.left),0!==l||w.val||(w.val=b[1]);return{decodeLut:k,numBitsLUTQick:q,numBitsLUT:f,tree:t,stuffedData:n,srcPtr:e,bitPos:m}},readHuffman:function(n,m,k,d){var a=m.headerInfo.numDims,b=m.headerInfo.height,e=m.headerInfo.width,g=e*b,h=this.readHuffmanTree(n,m);n=h.decodeLut;var c=h.tree,f=h.stuffedData,l=h.srcPtr,q=h.bitPos,t=h.numBitsLUTQick;h=h.numBitsLUT;var v=0===m.headerInfo.imageType?128:0,w=m.pixels.resultMask,x,H,A,z,E,J,D=0;0<q&&(l++,q=0);var L=f[l],C=1===m.encodeMode,N=new k(g*a),
S=N,F;if(2>a||C)for(F=0;F<a;F++)if(1<a&&(S=new k(N.buffer,g*F,g),D=0),m.headerInfo.numValidPixel===e*b)for(A=E=0;A<b;A++)for(z=0;z<e;z++,E++){var T=0;var y=x=L<<q>>>32-t;32-q<t&&(y=x|=f[l+1]>>>64-q-t);if(n[y])T=n[y][1],q+=n[y][0];else for(y=x=L<<q>>>32-h,32-q<h&&(y=x|=f[l+1]>>>64-q-h),y=c,J=0;J<h;J++)if(y=(H=x>>>h-J-1&1)?y.right:y.left,!y.left&&!y.right){T=y.val;q=q+J+1;break}32<=q&&(q-=32,l++,L=f[l]);T-=v;C?(T=0<z?T+D:0<A?T+S[E-e]:T+D,T&=255,D=S[E]=T):S[E]=T}else for(A=E=0;A<b;A++)for(z=0;z<e;z++,
E++){if(w[E]){T=0;y=x=L<<q>>>32-t;32-q<t&&(y=x|=f[l+1]>>>64-q-t);if(n[y])T=n[y][1],q+=n[y][0];else for(y=x=L<<q>>>32-h,32-q<h&&(y=x|=f[l+1]>>>64-q-h),y=c,J=0;J<h;J++)if(y=(H=x>>>h-J-1&1)?y.right:y.left,!y.left&&!y.right){T=y.val;q=q+J+1;break}32<=q&&(q-=32,l++,L=f[l]);T-=v;C?(T=0<z&&w[E-1]?T+D:0<A&&w[E-e]?T+S[E-e]:T+D,T&=255,D=S[E]=T):S[E]=T}}else for(A=E=0;A<b;A++)for(z=0;z<e;z++)if(E=A*e+z,!w||w[E])for(F=0;F<a;F++,E+=g){T=0;y=x=L<<q>>>32-t;32-q<t&&(y=x|=f[l+1]>>>64-q-t);if(n[y])T=n[y][1],q+=n[y][0];
else for(y=x=L<<q>>>32-h,32-q<h&&(y=x|=f[l+1]>>>64-q-h),y=c,J=0;J<h;J++)if(y=(H=x>>>h-J-1&1)?y.right:y.left,!y.left&&!y.right){T=y.val;q=q+J+1;break}32<=q&&(q-=32,l++,L=f[l]);T-=v;S[E]=T}m.ptr=m.ptr+4*(l+1)+(0<q?4:0);m.pixels.resultPixels=N;1<a&&!d&&(m.pixels.resultPixels=u.swapDimensionOrder(N,g,a,k))},decodeBits:function(n,m,k,d,a){var b=m.headerInfo,e=b.fileVersion,g=0,h=new DataView(n,m.ptr,5<=n.byteLength-m.ptr?5:n.byteLength-m.ptr),c=h.getUint8(0);g++;var f=c>>6,l=0===f?4:3-f,q=0<(c&32)?!0:
!1;f=c&31;c=0;if(1===l)c=h.getUint8(g),g++;else if(2===l)c=h.getUint16(g,!0),g+=2;else if(4===l)c=h.getUint32(g,!0),g+=4;else throw"Invalid valid pixel count type";l=2*b.maxZError;a=1<b.numDims?b.maxValues[a]:b.zMax;if(q){m.counter.lut++;q=h.getUint8(g);g++;b=Math.ceil((q-1)*f/8);var t=Math.ceil(b/4);t=new ArrayBuffer(4*t);var v=new Uint8Array(t);m.ptr+=g;v.set(new Uint8Array(n,m.ptr,b));g=new Uint32Array(t);m.ptr+=b;for(h=0;q-1>>>h;)h++;b=Math.ceil(c*h/8);t=Math.ceil(b/4);t=new ArrayBuffer(4*t);
v=new Uint8Array(t);v.set(new Uint8Array(n,m.ptr,b));n=new Uint32Array(t);m.ptr+=b;m=3<=e?G.unstuffLUT2(g,f,q-1,d,l,a):G.unstuffLUT(g,f,q-1,d,l,a);3<=e?G.unstuff2(n,k,h,c,m):G.unstuff(n,k,h,c,m)}else m.counter.bitstuffer++,h=f,m.ptr+=g,0<h&&(b=Math.ceil(c*h/8),t=Math.ceil(b/4),t=new ArrayBuffer(4*t),v=new Uint8Array(t),v.set(new Uint8Array(n,m.ptr,b)),n=new Uint32Array(t),m.ptr+=b,3<=e?null==d?G.originalUnstuff2(n,k,h,c):G.unstuff2(n,k,h,c,!1,d,l,a):null==d?G.originalUnstuff(n,k,h,c):G.unstuff(n,
k,h,c,!1,d,l,a))},readTiles:function(n,m,k,d){var a=m.headerInfo,b=a.width,e=a.height,g=b*e,h=a.microBlockSize,c=a.imageType,f=u.getDataTypeSize(c),l=Math.ceil(b/h),q=Math.ceil(e/h);m.pixels.numBlocksY=q;m.pixels.numBlocksX=l;var t=m.pixels.ptr=0,v=0,w=0,x=0,H=0,A=0,z=0,E=0,J=t=0,D=0,L=0,C=z=0;z=z=0;var N=new k(h*h);e=e%h||h;var S=b%h||h,F=a.numDims,T,y=m.pixels.resultMask,B=m.pixels.resultPixels,I=5<=a.fileVersion?14:15,P=a.zMax;for(w=0;w<q;w++)for(H=w!==q-1?h:e,x=0;x<l;x++)for(A=x!==l-1?h:S,D=w*
b*h+x*h,L=b-A,T=0;T<F;T++){1<F?(C=B,D=w*b*h+x*h,B=new k(m.pixels.resultPixels.buffer,g*T*f,g),P=a.maxValues[T]):C=null;z=n.byteLength-m.ptr;v=new DataView(n,m.ptr,Math.min(10,z));var X={};z=0;E=v.getUint8(0);z++;var Y=5<=a.fileVersion?E&4:0;t=E>>6&255;J=E>>2&I;if(J!==(x*h>>3&I))throw"integrity issue";if(Y&&0===T)throw"integrity issue";E&=3;if(3<E)throw m.ptr+=z,"Invalid block encoding ("+E+")";if(2===E){if(Y)if(y)for(t=0;t<H;t++)for(v=0;v<A;v++)y[D]&&(B[D]=C[D]),D++;else for(t=0;t<H;t++)for(v=0;v<
A;v++)B[D]=C[D],D++;m.counter.constant++;m.ptr+=z}else if(0===E){if(Y)throw"integrity issue";m.counter.uncompressed++;m.ptr+=z;z=H*A*f;C=n.byteLength-m.ptr;z=z<C?z:C;C=new ArrayBuffer(0===z%f?z:z+f-z%f);Y=new Uint8Array(C);Y.set(new Uint8Array(n,m.ptr,z));C=new k(C);z=0;if(y)for(t=0;t<H;t++){for(v=0;v<A;v++)y[D]&&(B[D]=C[z++]),D++;D+=L}else for(t=0;t<H;t++){for(v=0;v<A;v++)B[D++]=C[z++];D+=L}m.ptr+=z*f}else if(t=u.getDataTypeUsed(Y&&6>c?4:c,t),X=u.getOnePixel(X,z,t,v),z+=u.getDataTypeSize(t),3===
E)if(m.ptr+=z,m.counter.constantoffset++,y)for(t=0;t<H;t++){for(v=0;v<A;v++)y[D]&&(B[D]=Y?Math.min(P,C[D]+X):X),D++;D+=L}else for(t=0;t<H;t++){for(v=0;v<A;v++)B[D]=Y?Math.min(P,C[D]+X):X,D++;D+=L}else if(m.ptr+=z,u.decodeBits(n,m,N,X,T),z=0,Y)if(y)for(t=0;t<H;t++){for(v=0;v<A;v++)y[D]&&(B[D]=N[z++]+C[D]),D++;D+=L}else for(t=0;t<H;t++){for(v=0;v<A;v++)B[D]=N[z++]+C[D],D++;D+=L}else if(y)for(t=0;t<H;t++){for(v=0;v<A;v++)y[D]&&(B[D]=N[z++]),D++;D+=L}else for(t=0;t<H;t++){for(v=0;v<A;v++)B[D++]=N[z++];
D+=L}}1<F&&!d&&(m.pixels.resultPixels=u.swapDimensionOrder(m.pixels.resultPixels,g,F,k))},formatFileInfo:function(n){return{fileIdentifierString:n.headerInfo.fileIdentifierString,fileVersion:n.headerInfo.fileVersion,imageType:n.headerInfo.imageType,height:n.headerInfo.height,width:n.headerInfo.width,numValidPixel:n.headerInfo.numValidPixel,microBlockSize:n.headerInfo.microBlockSize,blobSize:n.headerInfo.blobSize,maxZError:n.headerInfo.maxZError,pixelType:u.getPixelType(n.headerInfo.imageType),eofOffset:n.eofOffset,
mask:n.mask?{numBytes:n.mask.numBytes}:null,pixels:{numBlocksX:n.pixels.numBlocksX,numBlocksY:n.pixels.numBlocksY,maxValue:n.headerInfo.zMax,minValue:n.headerInfo.zMin,noDataValue:n.noDataValue}}},constructConstantSurface:function(n,m){var k=n.headerInfo.zMax,d=n.headerInfo.zMin,a=n.headerInfo.maxValues,b=n.headerInfo.numDims,e=n.headerInfo.height*n.headerInfo.width,g=0,h=0,c=0,f=n.pixels.resultMask;n=n.pixels.resultPixels;if(f)if(1<b)if(m)for(g=0;g<b;g++)for(c=g*e,k=a[g],h=0;h<e;h++)f[h]&&(n[c+h]=
k);else for(h=0;h<e;h++){if(f[h])for(c=h*b,g=0;g<b;g++)n[c+b]=a[g]}else for(h=0;h<e;h++)f[h]&&(n[h]=k);else if(1<b&&d!==k)if(m)for(g=0;g<b;g++)for(c=g*e,k=a[g],h=0;h<e;h++)n[c+h]=k;else for(h=0;h<e;h++)for(c=h*b,g=0;g<b;g++)n[c+g]=a[g];else for(h=0;h<e*b;h++)n[h]=k},getDataTypeArray:function(n){switch(n){case 0:n=Int8Array;break;case 1:n=Uint8Array;break;case 2:n=Int16Array;break;case 3:n=Uint16Array;break;case 4:n=Int32Array;break;case 5:n=Uint32Array;break;case 6:n=Float32Array;break;case 7:n=Float64Array;
break;default:n=Float32Array}return n},getPixelType:function(n){switch(n){case 0:n="S8";break;case 1:n="U8";break;case 2:n="S16";break;case 3:n="U16";break;case 4:n="S32";break;case 5:n="U32";break;case 6:n="F32";break;case 7:n="F64";break;default:n="F32"}return n},isValidPixelValue:function(n,m){if(null==m)return!1;switch(n){case 0:n=-128<=m&&127>=m;break;case 1:n=0<=m&&255>=m;break;case 2:n=-32768<=m&&32767>=m;break;case 3:n=0<=m&&65536>=m;break;case 4:n=-2147483648<=m&&2147483647>=m;break;case 5:n=
0<=m&&4294967296>=m;break;case 6:n=-3.4027999387901484E38<=m&&3.4027999387901484E38>=m;break;case 7:n=4.9E-324<=m&&1.7976931348623157E308>=m;break;default:n=!1}return n},getDataTypeSize:function(n){var m=0;switch(n){case 0:case 1:m=1;break;case 2:case 3:m=2;break;case 4:case 5:case 6:m=4;break;case 7:m=8;break;default:m=n}return m},getDataTypeUsed:function(n,m){var k=n;switch(n){case 2:case 4:k=n-m;break;case 3:case 5:k=n-2*m;break;case 6:k=0===m?n:1===m?2:1;break;case 7:k=0===m?n:n-2*m+1;break;default:k=
n}return k},getOnePixel:function(n,m,k,d){n=0;switch(k){case 0:n=d.getInt8(m);break;case 1:n=d.getUint8(m);break;case 2:n=d.getInt16(m,!0);break;case 3:n=d.getUint16(m,!0);break;case 4:n=d.getInt32(m,!0);break;case 5:n=d.getUInt32(m,!0);break;case 6:n=d.getFloat32(m,!0);break;case 7:n=d.getFloat64(m,!0);break;default:throw"the decoder does not understand this pixel type";}return n},swapDimensionOrder:function(n,m,k,d,a){var b=0,e=0,g=0,h=0,c=n;if(1<k)if(c=new d(m*k),a)for(b=0;b<m;b++)for(h=b,g=0;g<
k;g++,h+=m)c[h]=n[e++];else for(b=0;b<m;b++)for(h=b,g=0;g<k;g++,h+=m)c[e++]=n[h];return c}},r=function(n,m,k){this.val=n;this.left=m;this.right=k};return{decode:function(n,m){m=m||{};var k=m.noDataValue,d=0,a={};a.ptr=m.inputOffset||0;a.pixels={};if(u.readHeaderInfo(n,a)){d=a.headerInfo;var b=d.fileVersion,e=u.getDataTypeArray(d.imageType);if(5<b)throw"unsupported lerc version 2."+b;u.readMask(n,a);d.numValidPixel===d.width*d.height||a.pixels.resultMask||(a.pixels.resultMask=m.maskData);var g=d.width*
d.height;a.pixels.resultPixels=new e(g*d.numDims);a.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var h=!m.returnPixelInterleavedDims;if(0!==d.numValidPixel)if(d.zMax===d.zMin)u.constructConstantSurface(a,h);else if(4<=b&&u.checkMinMaxRanges(n,a))u.constructConstantSurface(a,h);else{var c=new DataView(n,a.ptr,2),f=c.getUint8(0);a.ptr++;if(f)u.readDataOneSweep(n,a,e,h);else if(1<b&&1>=d.imageType&&1E-5>Math.abs(d.maxZError-.5)){c=c.getUint8(1);a.ptr++;a.encodeMode=
c;if(2<c||4>b&&1<c)throw"Invalid Huffman flag "+c;c?u.readHuffman(n,a,e,h):u.readTiles(n,a,e,h)}else u.readTiles(n,a,e,h)}a.eofOffset=a.ptr;m.inputOffset?(n=a.headerInfo.blobSize+m.inputOffset-a.ptr,1<=Math.abs(n)&&(a.eofOffset=m.inputOffset+a.headerInfo.blobSize)):(n=a.headerInfo.blobSize-a.ptr,1<=Math.abs(n)&&(a.eofOffset=a.headerInfo.blobSize));n={width:d.width,height:d.height,pixelData:a.pixels.resultPixels,minValue:d.zMin,maxValue:d.zMax,validPixelCount:d.numValidPixel,dimCount:d.numDims,dimStats:{minValues:d.minValues,
maxValues:d.maxValues},maskData:a.pixels.resultMask};if(a.pixels.resultMask&&u.isValidPixelValue(d.imageType,k)){b=a.pixels.resultMask;for(d=0;d<g;d++)b[d]||(n.pixelData[d]=k);n.noDataValue=k}a.noDataValue=k;m.returnFileInfo&&(n.fileInfo=u.formatFileInfo(a));return n}},getBandCount:function(n){for(var m=0,k=0,d={ptr:0,pixels:{}};k<n.byteLength-58;)u.readHeaderInfo(n,d),k+=d.headerInfo.blobSize,m++,d.ptr=k;return m}}})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),
function(G,u,r,n,m,k){G=G(null,{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"],constructor:function(d){u.mixin(this,d);this.isDataUV=d&&d.isDataUV?d.isDataUV:!1;this.computeMagnitudeAndDirection=u.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(d,a){this.inputUnit=d;this.outputUnit=a;this.unitConversionFactor=
1;this._updateUnitConvFactor()},_updateUnitConvFactor:function(){var d=k.indexOf(this.speedUnits,this.inputUnit),a=k.indexOf(this.speedUnits,this.outputUnit);if(this.inputUnit&&this.outputUnit&&0<=d&&0<=a){var b=[1,.277778,.514444,.3048,.44704,0];this.unitConversionFactor=b[d]/b[a]}},computeMagnitudeAndDirection:function(d){if(!m.isDefined(d))throw"Could not compute magnitude and direction. No pixel data is available.";var a=d.pixelBlock;if(!m.isDefined(a)||2!==a.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";
var b=d.extent,e=(b.xmax-b.xmin)/a.width,g=(b.ymax-b.ymin)/a.height,h=b.xmin+e/2;b=b.ymax-g/2;a.statistics[0].minValue=0;a.statistics[0].maxValue=0;var c=180/Math.PI,f=[],l=0,q=0,t=0,v=!m.isDefined(a.mask),w,x,H,A;var z=H=Infinity;var E=A=-Infinity;for(l=0;l<a.height;l++)for(q=0;q<a.width;q++,t++)if(f.push([h+e*q,b-g*l]),v||a.mask[t]){var J=w=a.pixels[0][t];var D=x=a.pixels[1][t];this.isDataUV&&(J=Math.sqrt(w*w+x*x),D=90-c*Math.atan2(x,w));a.pixels[0][t]=J*this.unitConversionFactor;a.pixels[1][t]=
D;J>E&&(E=J);J<z&&(z=J);D>A&&(A=D);D<H&&(H=D)}a.statistics[0].maxValue=E;a.statistics[0].minValue=z;a.statistics[1].maxValue=A;a.statistics[1].minValue=H;d.locations=f;return d}});r("extend-esri")&&u.setObject("layers.pixelFilters.VectorFieldPixelFilter",G,n);return G})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(G,u,r,n){var m;return u(null,{constructor:function(k){this.ctx=k.ctx;this._loadRasterFormatModule()},
decode:function(k,d){if(!d.width||!d.height)throw"Native decoding requires the image format, width and height";var a=new r,b,e=new Uint8Array(k);k=this._getFormat(k);if("error"===k)throw"invalid format";"jpeg"===k&&(b=this._getMask(e,d));var g="",h;for(h=0;h<e.length;h+=65535){var c=e.subarray(h,h+65535>e.length-1?e.length-1:h+65535);g+=String.fromCharCode.apply(null,c)}e="data:image/"+k+";base64,"+window.btoa(g);var f=new Image,l;f.src=e;var q=this;f.onload=function(){q.ctx.clearRect(0,0,d.width,
d.height);q.ctx.drawImage(f,0,0);var t=q.ctx.getImageData(0,0,f.width,f.height);l=t.data;if(b)for(h=0;h<b.length;h++)l[4*h+3]=b[h]?255:0;q.ctx.putImageData(t,0,0);a.resolve(null)};f.onerror=function(){a.reject("cannot load image")};return a},_getFormat:function(k){k=new Uint8Array(k,0,10);var d="error";255===k[0]&&216===k[1]?d="jpeg":137===k[0]&&80===k[1]&&78===k[2]&&71===k[3]&&(d="png");return d},_getMask:function(k,d){try{if(!m)throw"The zlib decoder module is not loaded.";var a=0,b=0,e=Math.round(k.length/
2);1===e%2&&(e+=1);var g=k.length-2;for(a=e;a<g&&(255!==k[a]||217!==k[a+1]);a++);e=a+=2;if(e<k.length-1){var h=(new m(k.subarray(e))).getBytes();var c=new Uint8Array(d.width*d.height);for(a=k=0;a<h.length;a++)for(b=7;0<=b;b--)c[k++]=h[a]>>b&1}}catch(f){}return c},_loadRasterFormatModule:function(){10>n("ie")||G(["./Zlib"],function(k){m=k})}})})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),
function(G,u,r,n,m,k,d,a){G=G(d,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",constructor:function(b){this._url.path+="/identify";this._handler=u.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(b,e,g,h,c){try{var f=new a(b);this._successHandler([f],"onComplete",g,c)}catch(l){this._errorHandler(l,h,c)}},execute:function(b,e,g,h){var c=h.assembly;b=this._encode(u.mixin({},this._url.query,{f:"json"},b.toJson(c&&c[0])));var f=this._handler,
l=this._errorHandler;return m({url:this._url.path,content:b,callbackParamName:"callback",load:function(q,t){f(q,t,e,g,h.dfd)},error:function(q){l(q,g,h.dfd)}})},onComplete:function(){}});k._createWrappers(G);r("extend-esri")&&u.setObject("tasks.ImageServiceIdentifyTask",G,n);return G})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(G,u,r,n,m,k){G=G(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",
constructor:function(d){d.catalogItems&&(this.catalogItems=new k(d.catalogItems));d.location&&(this.location=m.fromJson(d.location));this.catalogItemVisibilities=d.catalogItemVisibilities;this.name=d.name;this.objectId=d.objectId;this.value=d.value;this.processedValues=d.processedValues;this.properties=d.properties}});r("extend-esri")&&u.setObject("tasks.ImageServiceIdentifyResult",G,n);return G})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),
function(G,u,r,n,m,k,d,a){G=G(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,renderingRules:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,maxItemCount:null,returnPixelValues:!0,toJson:function(b){var e=b&&b.geometry||this.geometry;b={geometry:e,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?r.toJson(this.mosaicRule.toJson()):
null,renderingRule:this.renderingRule?r.toJson(this.renderingRule.toJson()):null};e&&(b.geometryType=a.getJsonType(e));e=this.timeExtent;b.time=e?e.toJson().join(","):null;d.isDefined(this.pixelSizeX)&&d.isDefined(this.pixelSizeY)?b.pixelSize=r.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(b.pixelSize=this.pixelSize?r.toJson(this.pixelSize.toJson()):null);this.renderingRules&&(b.renderingRules=r.toJson(n.map(this.renderingRules,function(g){return g.toJson()})));
d.isDefined(this.returnPixelValues)&&(b.returnPixelValues=this.returnPixelValues);d.isDefined(this.maxItemCount)&&(b.maxItemCount=this.maxItemCount);return b}});m("extend-esri")&&u.setObject("tasks.ImageServiceIdentifyParameters",G,k);return G})},"esri/layers/ImageServiceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang".split(" "),function(G,u,r,n,m,k){G=G(null,{declaredClass:"esri.layers.ImageServiceParameters",extent:null,width:null,height:null,
imageSpatialReference:null,format:null,interpolation:null,compressionQuality:null,bandIds:null,timeExtent:null,mosaicRule:null,renderingRule:null,renderer:null,noData:null,compressionTolerance:null,adjustAspectRatio:null,lercVersion:null,toJson:function(d){var a=this.bbox||this.extent;d=(a=a&&d&&a._normalize(!0))?a.spatialReference.wkid||r.toJson(a.spatialReference.toJson()):null;var b=this.imageSpatialReference;a={bbox:a?a.xmin+","+a.ymin+","+a.xmax+","+a.ymax:null,bboxSR:d,size:null!==this.width&&
null!==this.height?this.width+","+this.height:null,imageSR:b?b.wkid||r.toJson(b.toJson()):d,format:this.format,interpolation:this.interpolation,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null,mosaicRule:this.mosaicRule?r.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?r.toJson(this.renderingRule.toJson()):null,renderer:this.renderer?r.toJson(this.renderer.toJson()):null,noData:this.noData,noDataInterpretation:this.noDataInterpretation,
compressionTolerance:this.compressionTolerance,adjustAspectRatio:this.adjustAspectRatio,lercVersion:this.lercVersion};d=this.timeExtent;a.time=d?d.toJson().join(","):null;return k.filter(a,function(e){if(null!==e&&void 0!==e)return!0})}});u.mixin(G,{INTERPOLATION_BILINEAR:"RSP_BilinearInterpolation",INTERPOLATION_CUBICCONVOLUTION:"RSP_CubicConvolution",INTERPOLATION_MAJORITY:"RSP_Majority",INTERPOLATION_NEARESTNEIGHBOR:"RSP_NearestNeighbor",NODATA_MATCH_ALL:"esriNoDataMatchAll",NODATA_MATCH_ANY:"esriNoDataMatchAny"});
n("extend-esri")&&u.setObject("layers.ImageServiceParameters",G,m);return G})},"esri/layers/RasterXLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Deferred dojo/sniff dojo/dom-construct dojo/dom-style dojo/on dojox/gfx/matrix dojo/when dojo/DeferredList ../kernel ../config ../lang ../domUtils ../urlUtils ../graphic ../request ../renderers/ClassBreaksRenderer ../renderers/StretchRenderer ../renderers/UniqueValueRenderer ../renderers/ColormapRenderer ../renderers/ShadedReliefRenderer ../geometry/Extent ../SpatialReference ../geometry/Point ./Field ./TimeInfo ./MosaicRule ./DimensionalDefinition ./PixelBlock ./ImageServiceLayerMixin ./rasterLib/raster/rasterFactory ./rasterLib/raster/rasterProjectionHelper ./rasterLib/renderer/rasterRendererHelper ./rasterLib/tile/RasterTileInfo ./rasterLib/tile/RasterTileManager ./rasterLib/tile/RasterHandler ./layer".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z,E,J,D,L,C,N,S,F,T,y,B,I,P,X,Y,aa,Z){var fa=f.defaults.map.zoomDuration;G=G([Z],{declaredClass:"esri.layers.RasterXLayer",managedSuspension:!0,opacity:1,tileMode:!0,useWebGL:!0,drawMode:!0,_eventMap:{"raster-change":!0,"renderer-change":!0},_lastPopup:[],_rasterFieldPrefix:"Raster.",_cachedVariableStats:{},_cachedVariableHistogram:{},constructor:function(K,R){R=R||{};this.tileMode=null!=R.tileMode?R.tileMode:this.tileMode;this.useWebGL=null!=R.useWebGL?
R.useWebGL:this.useWebGL;this.roaming=null!=R.roaming?R.roaming:this.roaming;this.drawMode=null!=R.drawMode?R.drawMode:this.drawMode;this.bandIds=R.bandIds&&0<R.bandIds.length?R.bandIds:null;this.renderer=R.renderer;this._customModules=R.customModules;this.useMapTime=R.useMapTime;if(R.multidimensionalDefinition&&0<R.multidimensionalDefinition.length){var U=new S;U.multidimensionalDefinition=R.multidimensionalDefinition.map(function(ba){return ba.toJson?ba:new F(ba)});U.method=S.METHOD_NONE;this.mosaicRule=
U}this.infoTemplate=R.infoTemplate;this.drawMode||(this._contextType=R._contextType||R.drawType);this._supportLegacyPropMethods=!1!==R.legacySupport;this._rasterHandler=new aa({customModules:this._customModules});this._workInitPromise=this._rasterHandler.start();this.pixelData=null;this._initialize(K,R);b(this,"load",u.hitch(this,function(){g(this._rasterHandler._connected||this._rasterHandler._connectionPromise,u.hitch(this,function(){this._rasterHandler.setLayer({layerId:this.id,raster:{rasterInfo:this.raster.rasterInfo,
rasterFunction:this.raster.rasterFunction&&this.raster.rasterFunction.toJson()},bandCount:this.raster.rasterInfo.bandCount});this.raster.rasterFunction&&this._rasterHandler.setRasterFunction({layerId:this.id,data:this.raster.rasterFunction.toJson(!0)});this._rasterRenderer&&this._rasterHandler.setRasterRenderer({layerId:this.id,data:this._rasterRenderer.toJson(!0)})}))}));this._animatePan2d=u.hitch(this,this._animatePan2d)},setOpacity:function(K){this.opacity!==K&&(this.opacity=K,this.onOpacityChange(K))},
onOpacityChange:function(){},onRendererChange:function(){},refresh:function(){if(this.loaded&&this._map)if(!this._canDraw()||10>k("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else this._map&&this._extentChangeHandler(this._map.extent)},clear:function(K,R,U,ba){this._canDraw()&&(this.useWebGL||(U?this._context.clearRect(K,R,U,ba):this._context.clearRect(0,0,this._map.width,this._map.height)))},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);
this._toggleTime();q.show(this._div);if("css-transforms"===this._map.navigationMode){var K=this._map.__visibleDelta;this._left=this._tdx=K.x;this._top=this._tdy=K.y;a.set(this._div,c._css.names.transform,c._css.translate(this._left,this._top))}this._displayTimer=this._displayTimer||setTimeout(u.hitch(this,function(){this._extentChangeHandler(this._map.extent,null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._fireUpdateEnd();this._toggleTime();q.hide(this._div);clearTimeout(this._displayTimer);
this._displayTimer=null},redraw:function(){this.useWebGL&&this._glSetting&&(this._glSetting.hasNewTexture=!1);var K=this.tileMode?this.tileManager.originalPixelData:this.originalPixelData;if(this.tileMode?K&&(K.src||K.texture):K)if(this.tileMode)if(this.useWebGL)this._updateAllTilesOnce(K);else{this.tileManager.tiles.forEach(function(U){U&&(U.update=null,U.completed=!1,U.processedPixelBlock=null,U.renderedPixelBlock=null)});K.processedPixelBlock=null;var R=this.raster.rasterFunction?this.raster.rasterFunction.read(K):
{extent:K.extent,pixelBlock:K.src[this.tileManager.identifiers[0]]&&K.src[this.tileManager.identifiers[0]].pixelBlock};K.renderedPixelBlock=null;K=this._rasterRenderer?this._rasterRenderer.draw(R):R;this._drawOneFrame(K)}else this._supportLegacyPropMethods&&this.pixelFilter?this._setPixelData(this.originalPixelData):(K.processedPixelBlock=null,R=this.raster.rasterFunction?this.raster.rasterFunction.read(K):{extent:K.extent,pixelBlock:K.src?K.src[this.tileManager.identifiers[0]]&&K.src[this.tileManager.identifiers[0]].pixelBlock:
K.pixelBlock},K.renderedPixelBlock=null,K=this._rasterRenderer?this._rasterRenderer.draw(R):R,this._drawOneFrame(K))},getCurrentResolution:function(){var K=this._map.extent;return new L((K.xmax-K.xmin)/this._map.width,(K.ymax-K.ymin)/this._map.height,K.spatialReference)},getCustomRasterFields:function(K){var R=K?K.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix,U={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:10.3<=this.version?
"esriFieldTypeDouble":"esriFieldTypeString"};K=this.fields?u.clone(this.fields):[];K.push(U);(U=this.rasterAttributeTable&&this.rasterAttributeTable.fields)&&0<U.length&&(U=n.filter(U,function(ba){return"esriFieldTypeOID"!==ba.type&&"value"!==ba.name.toLowerCase()}),U=n.map(U,function(ba){var Q=u.clone(ba);Q.name=R+ba.name;return Q}),K=K.concat(U));return K},setRenderer:function(K,R){if(this.loaded&&K){if(K.declaredClass&&-1<K.declaredClass.indexOf("esri.layers.rasterLib")){this._rasterRenderer=K;
this._rasterRenderer.bind({layer:this});var U=this.bandIds=K.bandIndex;this.raster&&this.raster.setFetchParameters({bandIds:U});this._params&&(this._params.bandIds=U&&0<U.length?U.join(","):null);this.renderer=this._getCommonRenderer(K)}else U=u.clone(K.toJson?K.toJson():K),"rasterStretch"===U.type&&(U.bandIndex=this.bandIds,U.bandIndex&&1<U.bandIndex.length||!U.bandIndex&&this.raster&&1<this.raster.rasterInfo.bandCount)&&(U.type="rgb"),this._rasterRenderer=P.create(U),this.renderer=K.declaredClass?
K:this._getCommonRenderer(this._rasterRenderer),this._rasterRenderer.bind({layer:this});if(this._map){if(this.loaded&&this._rasterHandler._connected){var ba=this._rasterHandler.setRasterRenderer({layerId:this.id,data:this._rasterRenderer.toJson(!0)});this._updateTilingEffects()}R||(ba?ba.then(u.hitch(this,function(){this.redraw()})):this.redraw());this.onRendererChange()}}},setBandIds:function(K,R){this.bandIds=K;this.raster&&this.raster.setFetchParameters({bandIds:K});this._params&&(this._params.bandIds=
K&&0<K.length?K.join(","):null);this.setRenderer(this.renderer,R)},_setTime:function(K){K=K?K.toJson():null;this._params&&(this._params.time=K);this.raster.setFetchParameters({time:K});this.tileManager&&this.tileManager.tiles&&this.tileManager.resetTiles()},setInfoTemplate:function(K){this.infoTemplate=K;this._updateInfoTemplateFields(this.fields)},setMultiDimensionalDefinition:function(K,R){var U=K&&K.multidimensionalDefinition;if(U&&this.loaded){var ba=U&&U[0].variableName;""===ba&&(ba=this._multidimensionalInfo.variables[0].name,
U.forEach(function(ea){ea.variableName=ba}));if("ImageService"===this.raster.sourceType){var Q=this.raster._getAllDimensionDefinition(U,ba);Q.defChanged&&(K.multidimensionalDefinition=Q.definition,this.setMosaicRule(K,!0))}this.raster.setFetchParameters({multidimensionalDefinition:U});this.tileManager&&this.tileManager.tiles&&this.tileManager.resetTiles();ba&&this._updateRasterInfo(ba);R||this.refresh()}},_updateRasterInfo:function(K){var R=this.raster.rasterInfo,U=this.getHistograms(K);K=this.getStatistics(K);
(new h([U,K])).then(u.hitch(this,function(ba){ba[0][0]&&(R.histograms=ba[0][1].histograms);ba[1][0]&&(R.statistics=ba[1][1]);this.refresh()}))},_updateInfoTemplateFields:function(K){if(K&&!(1>K.length)&&this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.fieldInfos&&!(1>this.infoTemplate.info.fieldInfos.length)){var R,U;var ba=this.infoTemplate.info.fieldInfos;for(R=0;R<K.length;R++){var Q=K[R];for(U=0;U<ba.length;U++)if(ba[U].fieldName.toLowerCase()===Q.name.toLowerCase()&&ba[U].fieldName!==
Q.name){ba[U].fieldName=Q.name;break}}}},getPixelData:function(K){return this.tileMode?K?this.tileManager&&this.tileManager.originalPixelData&&this.tileManager.originalPixelData.src&&this.tileManager.originalPixelData.src[this.tileManager.identifiers[0]]:null:this.inherited(arguments)},fetchPopupFromTiles:function(K){var R=new m;this.identify(K.geometry).then(function(U){var ba=U.pixelValue;this.hasStdTime()&&ba&&ba.length&&null!=ba[0]&&(ba=ba.map(function(la){return this.getStdTimeValue(la)}.bind(this)).join(", "));
if(ba){U={ObjectId:0,"Raster.ServicePixelValue":ba};var Q=this.rasterAttributeTable&&this.rasterAttributeTable.features;if(Q&&0<Q.length&&(Q=n.filter(Q,function(la){if(la&&la.attributes)return la.attributes.hasOwnProperty("Value")?la.attributes.Value==ba:la.attributes.VALUE==ba}),0<Q.length&&(Q=u.clone(Q[0]))))for(var ea in Q.attributes)Q.attributes.hasOwnProperty(ea)&&(U[this._rasterFieldPrefix+ea]=Q.attributes[ea]);ea=new v(new J(this.projectedFullExtent||this.fullExtent),null,U);ea.setInfoTemplate(this.infoTemplate);
ea._layer=this;this._lastPopup=[ea];R.resolve([ea])}else this._lastPopup=[],R.resolve()}.bind(this),function(U){this._lastPopup=[];R.resolve(U)});return R},getPopupFromTiles:function(){return this._lastPopup},identify:function(K,R){return this.raster?this.raster.identify(K):(K=new m,K.reject("layer must be initialized to identify"),K.promise)},_getCommonRenderer:function(K){switch(K.rendererName){case "RGB":case "Stretch":return new H(K.toCommonRendererJson());case "UniqueValue":return new A(K.toCommonRendererJson());
case "ClassBreaks":return new x(K.toCommonRendererJson());case "Colormap":return new z(K.toCommonRendererJson());case "ShadedRelief":return new E(K.toCommonRendererJson())}},_getProjectedFullExtent:function(K){return this.raster.getProjectedFullExtent(K).then(u.hitch(this,function(R){this.projectedFullExtent=R}))},_initialize:function(K,R){R=R||{};this._supportLegacyPropMethods&&this.constructor._onMap&&(this.constructor._onMap["rendering-change"]={method:"onRenderingChange"},this.constructor._onMap["mosaic-rule-change"]=
{method:"onMosaicRuleChange"},this.constructor._onMap["spatial-reference-change"]={method:"onSpatialReferenceChange"});this.raster={};var U=R.raster?R.raster.url:K;U&&-1<U.toLowerCase().indexOf("/imageserver")&&this._supportLegacyPropMethods&&this._addLegacySupport(U,R);var ba=u.hitch(this,function(){this.loaded=!0;this.mosaicRule&&this.mosaicRule.multidimensionalDefinition&&0<this.mosaicRule.multidimensionalDefinition.length&&this.setMultiDimensionalDefinition(this.mosaicRule,!0);this.raster._setRasterHandler(this._rasterHandler);
this.onLoad(this);var Q=this._loadCallback;Q&&(delete this._loadCallback,Q(this))});(K?B.create(u.mixin({url:K},R)):R.raster&&R.raster.open()).then(u.hitch(this,function(Q){if(Q){this.raster=Q;var ea=this._getSourceImageServiceRaster();this.url||(this.url=ea&&ea.url);this.url&&(this._url=t.urlToObject(K));var la=R.minScale,ma=R.maxScale,M=Q.tileInfo&&"Raster"===Q.tileInfo.tileType;null==ma&&(ma=M&&R.zoomFactor?Q.tileInfo.lods[Q.tileInfo.lods.length-1].scale/R.zoomFactor:this.maxScale);null==la&&(la=
M&&R.zoomFactor?Q.tileInfo.lods[0].scale*R.zoomFactor:this.minScale);ea&&"ImageService"===ea.sourceType&&this._supportLegacyPropMethods&&this._addGeneralProperties(K,R);this.initialExtent=this.fullExtent=this.extent=this.raster.rasterInfo.extent;this.spatialReference=this.extent.spatialReference;this.timeInfo=this.raster.rasterInfo.timeInfo?new N(this.raster.rasterInfo.timeInfo):null;this.rasterAttributeTable=this.raster.rasterInfo.vat;this._multidimensionalInfo=this.raster.rasterInfo.multidimensionalInfo;
this.rasterAttributeTable&&(this._rasterAttributeTableFields=this.rasterAttributeTable.fields);this.mosaicRule&&this.raster.setFetchParameters({multidimensionalDefinition:this.mosaicRule.multidimensionalDefinition});this._multidimensionalInfo&&(this._getDefaultMultidimensionalDefinition(this._multidimensionalInfo,!0,!0),this.mosaicRule||(this.mosaicRule=this.defaultMosaicRule,this.raster.setFetchParameters({multidimensionalDefinition:this._defaultMultidimensionalDefinition})),this.raster.defaultMultidimensionalDefinition=
this._defaultMultidimensionalDefinition);null==la||this._hasMin||this.setMinScale(la);null==ma||this._hasMax||this.setMaxScale(ma);this._workInitPromise?this._workInitPromise.then(ba,ba):ba()}else console.error("cannot create rasterx layer as the raster data source cannot be opened")}),this._errorHandler)},_getSourceImageServiceRaster:function(){var K=this.raster&&"Function"===this.raster.sourceType?1===this.raster.getMemberRasters().length?this.raster.getMemberRasters()[0]:null:this.raster;if(K&&
"ImageService"===K.sourceType)return K},_addLegacySupport:function(K,R){this._url=t.urlToObject(K);R=R||{};this.format=(K=R.imageServiceParameters)&&K.format;this.compressionTolerance=K&&K.compressionTolerance?K.compressionTolerance:.01;this.interpolation=K?K.interpolation:null;this.compressionQuality=K?K.compressionQuality:null;this.bandIds=K&&K.bandIds||R&&R.bandIds||null;this.mosaicRule||(this.mosaicRule=K?K.mosaicRule:null);this.renderingRule||(this.renderingRule=K?K.renderingRule:null);this.useMapDimensionValue=
R.hasOwnProperty("useMapDimensionValue")?!!R.useMapDimensionValue:!0;this.hasImageFilter=R.hasImageFilter;this.activeMapDimensions=R.activeMapDimensions;this._params=u.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},K?K.toJson():{});this.pixelFilter=R.pixelFilter;this.originalPixelData=this.pixelData=null;this._queryVisibleRastersHandler=u.hitch(this,this._queryVisibleRastersHandler);
this._useRenderingRuleAttributeTable=!1;this._rasterFunctionTemplateInfos={};this._customRenderingRuleId={};this._setDefaultFilter=function(){};var U={setInterpolation:"interpolation",setCompressionQuality:"compressionQuality",setCompressionTolerance:"compressionTolerance",setBandIds:"bandIds",setDefaultBandIds:"bandIds",setMosaicRule:"mosaicRule",setRenderingRule:"renderingRule",setImageFormat:"format"},ba,Q=new y;Object.keys(U).forEach(u.hitch(this,function(ea){this[ea]=u.hitch(this,function(la,
ma){ba={};ba[U[ea]]=la;this.raster&&(this.raster.setFetchParameters(ba),Q[ea].bind(this)(la,ma))})}));this.setDisableClientCaching=function(ea){Q.setDisableClientCaching.bind(this)(ea);var la=this._getSourceImageServiceRaster();la?la.disableClientCaching=ea:null}.bind(this);this.setDefinitionExpression=Q.setDefinitionExpression.bind(this);this.setUseMapTime=Q.setUseMapTime.bind(this);this._toggleTime=Q._toggleTime.bind(this);this._onTimeExtentChangeHandler=Q._onTimeExtentChangeHandler.bind(this);
this.setPixelFilter=Q.setPixelFilter.bind(this);this.getHistograms=Q.getHistograms.bind(this);this.getRasterFunctionInfos=Q.getRasterFunctionInfos.bind(this);this.getKeyProperties=Q.getKeyProperties.bind(this);this.getRasterAttributeTable=Q.getRasterAttributeTable.bind(this);this.getRenderingRuleServiceInfo=Q.getRenderingRuleServiceInfo.bind(this);this._getRenderingRuleId=Q._getRenderingRuleId.bind(this);this._isRenderingRuleAProcessingTemplate=Q._isRenderingRuleAProcessingTemplate.bind(this);this.handleSpatialReferenceChange=
Q.handleSpatialReferenceChange.bind(this);this.onRenderingChange=this.onRenderingChange||function(){};this.onSpatialReferenceChange=this.onSpatialReferenceChange||function(){};this.onMosaicRuleChange=this.onMosaicRuleChange||function(ea){};this.setRasterRenderer=this.setRenderer;this.getMultidimensionalInfo=Q.getMultidimensionalInfo.bind(this);this.getColormap=Q.getColormap.bind(this);this.getRenderingRuleColormap=Q.getRenderingRuleColormap.bind(this);this.getDefaultMultidimensionalDefinition=Q.getDefaultMultidimensionalDefinition.bind(this);
this._getDefaultMultidimensionalDefinition=Q._getDefaultMultidimensionalDefinition.bind(this);this._getDefaultDimensionValue=Q._getDefaultDimensionValue.bind(this);this.getStatistics=Q.getStatistics.bind(this)},_addGeneralProperties:function(){var K=this._getSourceImageServiceRaster();if(K){var R=["minScale","maxScale","tileInfo"];Object.keys(K.serviceInfo).forEach(function(Q){null==this[Q]&&-1===R.indexOf(Q)&&(this[Q]=K.serviceInfo[Q])}.bind(this));this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=
parseFloat(this.pixelSizeY);this.bands=K.rasterInfo.statistics;var U,ba=[];this.fields=this.fields||[];for(U=0;U<this.fields.length;U++)ba.push(new C(this.fields[U]));this.fields=ba;this.version=this.currentVersion;this.defaultMosaicRule=K.serviceInfo.defaultMosaicRule}},setDefaultRenderer:function(){if(this.loaded&&this._canvas&&!this.pixelFilter){var K=P.createDefaultRenderer(this);if(null!=K){var R=this.mosaicRule&&this.mosaicRule.multidimensionalDefinition&&0<this.mosaicRule.multidimensionalDefinition.length;
if(this._multidimensionalInfo&&R&&"Stretch"===K.rendererName){var U=this.mosaicRule.multidimensionalDefinition[0].variableName;(R=this._multidimensionalInfo.variables.filter(function(ba){return ba.name===U})[0])&&R.histograms&&R.histograms.length&&(K.histograms=R.histograms,6===K.stretchType&&(K.dra=!1));R&&R.statistics&&R.statistics.length&&(K.statistics=R.statistics.map(function(ba){return[ba.min,ba.max,ba.mean,ba.stddev||ba.standardDeviation]}),6!==K.stretchType&&(K.dra=!1))}this.setRenderer(K,
!0)}}},setDefaultInterpolation:function(){if(this.loaded&&this._canvas){var K=this.raster.serviceInfo&&this.raster.serviceInfo.defaultResamplingMethod;if(K)switch(K.toLowerCase()){case "bilinear":this.interpolation="RSP_BilinearInterpolation";break;case "cubic":this.interpolation="RSP_CubicConvolution";break;case "majority":this.interpolation="RSP_Majority";break;case "nearest":this.interpolation="RSP_NearestNeighbor"}else{K=this.raster.dataType&&this.raster.dataType.toLowerCase();var R=!!this.raster.rasterInfo.colormap;
this.raster.rasterInfo.vat||R||"thematic"===K||"StdTime"===K?"RSP_NearestNeighbor":"RSP_BilinearInterpolation"}}},_toggleTime:function(){},_updateTilingEffects:function(){(this._hasTilingEffects=this._rasterRenderer&&this._rasterRenderer.hasTilingEffects()||this.raster&&this.raster.rasterFunction&&this.raster.rasterFunction.hasTilingEffects())&&this._map&&this.tileMode&&this.useWebGL&&this.tileManager&&(this._hasTilingEffects=!1)},_setMap:function(K,R){this.inherited(arguments);K.spatialReference&&
(K.spatialReference.ics||K.spatialReference.icsId)&&(this.roaming=this.useWebGL=this.tileMode=!1);if(this.tileMode){this.virtualTileInfo=new X(null,{refTileInfo:K.tileInfo,spatialReference:K.spatialReference,extent:this.raster.rasterInfo.extent});var U=this.raster.tileInfo&&(-1<["Elevation","Raster"].indexOf(this.raster.tileInfo.tileType)||3===this.raster.rasterInfo.bandCount&&"U8"===this.raster.rasterInfo.pixelType)?this.raster.tileInfo:this.virtualTileInfo;this._tileParams=this._tileParams||{};
this._tileParams.size=U.cols+","+U.rows;this.tileManager=new Y({tileInfo:U,layer:this,mapSR:K.spatialReference})}this._dragOrigin={x:0,y:0};U=this._div=d.create("div",null,R);var ba={width:K.width+"px",height:K.height+"px",position:"absolute"};"css-transforms"===K.navigationMode?this.roaming&&this.tileMode&&this.useWebGL||(ba[c._css.names.transform]=c._css.translate(K.__visibleDelta.x,K.__visibleDelta.y),this._left=K.__visibleDelta.x,this._top=K.__visibleDelta.y):this._left=this._top=0;a.set(U,ba);
this._canvas=d.create("canvas",{width:K.width+"px",height:K.height+"px",style:"position: absolute;"},U);l.isDefined(this.opacity)&&a.set(U,"opacity",this.opacity);this._contextType?(this._context=this._canvas.getContext(this._contextType,null),this.useWebGL=this._context instanceof WebGLRenderingContext):this.useWebGL?(this._context=this._canvas.getContext("webgl",null)||this._canvas.getContext("experimental-webgl",null),this.drawMode=!1):(this._context=this._canvas.getContext("2d"),this.drawMode=
!0);this._context||console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this.useWebGL&&(K.acquireWebGLContext(this),this._glSetting={gl:this._context,branchCount:this.raster.rasterFunction?this.raster.rasterFunction.branchCount:0,pingpong:null,branches:null,drawMesh:this._drawMesh,programUniforms:{}});this.raster.rasterFunction&&(this._updateTilingEffects(),this.raster.setProcessingContext({layer:this}));this.setRenderer(this.renderer,!0);this._rasterRenderer||
this.setDefaultRenderer();this.interpolation||this.setDefaultInterpolation();this._mapWidth=K.width;this._mapHeight=K.height;this._connects=[];this._connects.push(r.connect(K,"onPan",this,this._panHandler));this._connects.push(r.connect(K,"onPanEnd",this,this._panEndHandler));"css-transforms"===K.navigationMode?this._connects.push(r.connect(K,"onScale",this,this._onScaleHandler)):(this._connects.push(r.connect(K,"onZoom",this,this._onZoomHandler)),this._connects.push(r.connect(K,"onZoomEnd",this,
this._onZoomEndHandler)));this._connects.push(r.connect(K,"onResize",this,this._onResizeHandler));this._connects.push(r.connect(K,"onExtentChange",this,this._extentChangeHandler));this._connects.push(r.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(r.connect(this,"onOpacityChange",this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:K.width,height:K.height};this.evaluateSuspension();if(this.suspended&&!K.loaded)var Q=r.connect(K,"onLoad",
this,function(){r.disconnect(Q);Q=null;this.evaluateSuspension()});return U},_unsetMap:function(K,R){this.useWebGL&&K.releaseWebGLContext(this);n.forEach(this._connects,r.disconnect,this);var U=this._div;U&&(R.removeChild(U),d.destroy(U));this._map=this._canvas=this._context=this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},_canDraw:function(){return!!(this._map&&this._canvas&&this._context)},_requestDataErrorHandler:function(K){"CancelError"!==
K.name&&(this.clear(),this.onError(K))},_clonePixelData:function(K){if(null===K||K.texture)return K;var R={};K.extent&&(R.extent=u.clone(K.extent));var U=K.pixelBlock;null!=U&&(R.pixelBlock=U.clone());R.texture=K.texture;return R},_setPixelData:function(K){if(K){K=this._clonePixelData(K);this.pixelFilter&&(this.pixelFilter.filter?(this.pixelFilter.renderTexture=!0,this.pixelFilter.filter(K)):this.pixelFilter(K));this.pixelData=K;if(this._rasterReadPromise&&this._rasterReadPromise.isCanceled())return;
this._drawPixelData()}this._rasterReadPromise=null},_requestData:function(K,R,U){this._rasterReadPromise&&this._rasterReadPromise.cancel();K=u.clone(K)._normalize(!0);this._rasterReadPromise=this.raster.read({extent:K,width:this._map.width,height:this._map.height});this._rasterReadPromise.then(u.hitch(this,function(ba){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this.originalPixelData=ba&&ba.srcData?{extent:ba.extent,src:ba.srcData}:ba,this.useWebGL&&this._glSetting&&(this._glSetting.hasNewTexture=
!0),this._setPixelData(ba))}),u.hitch(this,this._requestDataErrorHandler));return this._rasterReadPromise},_drawPixelData:function(K){a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"});this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};this.drawMode||"css-transforms"!==this._map.navigationMode||(this._tdx=this._left,this._tdy=this._top,this._multiply=null,a.set(this._div,c._css.names.transform,c._css.translate(this._left,this._top)),
a.set(this._canvas,c._css.names.transform,c._css.translate(-this._left,-this._top)),this._dragOrigin={x:0,y:0});this.useWebGL&&this._rasterRenderer&&this._rasterRenderer.draw(this.pixelData);if(this._canDraw()&&this.drawMode&&this.drawMode&&(K=K||this.pixelData)&&K.pixelBlock){var R=this.pixelFilter?this.pixelData:this._rasterRenderer?this._rasterRenderer.draw(K):K;K=R.pixelBlock;var U=this._context,ba=U.createImageData(K.width,K.height);ba.data.set(K.getAsRGBA());R=R.extent;var Q=this._map.extent,
ea=this.getCurrentResolution(),la=0,ma=0;Math.abs(R.xmin-Q.xmin)>ea.x&&(la=Math.round((R.xmin-Q.xmin)/ea.x));Math.abs(Q.ymax-R.ymax)>ea.y&&(ma=Math.round((Q.ymax-R.ymax)/ea.y));"css-transforms"===this._map.navigationMode?(this._tdx=this._left,this._tdy=this._top,this._multiply=null,a.set(this._div,c._css.names.transform,c._css.translate(this._left,this._top)),a.set(this._canvas,c._css.names.transform,c._css.translate(-this._left,-this._top))):(a.set(this._div,{left:"0px",top:"0px",width:this._map.width+
"px",height:this._map.height+"px"}),a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}));this._dragOrigin={x:0,y:0};this.tileMode?this.clear(la,ma,K.width,K.height):this.clear();U.putImageData(ba,la,ma,0,0,K.width,K.height);this._fireUpdateEnd()}},hasStdTime:function(){if(!this.hasMultidimensions||"StdTime"!==this.raster.dataType)return!1;var K=this.mosaicRule&&this.mosaicRule.multidimensionalDefinition,R=K&&K.length?K[0].variableName:this._defaultMultidimensionalDefinition[0].variableName;
return this.raster.rasterInfo.multidimensionalInfo.variables.some(function(U){if(U.name===R)return U.dimensions.some(function(ba){return"StdTime"===ba.name})})},getStdTimeValue:function(K){return(new Date(864E5*(K-25569))).toString()},_animatePan2d:function(){this._oldDelta&&this._delta.x===this._oldDelta.x&&this._delta.y===this._oldDelta.y||(this.tileManager.updateTile(this.tileManager.originalPixelData,!0),this._oldDelta={x:this._delta.x,y:this._delta.y});this._roamingAnimation&&this.tileMode&&
this.useWebGL&&(this._roamingAnimation=requestAnimationFrame(this._animatePan2d))},_cancelAnimation:function(){this._animation&&(cancelAnimationFrame(this._animation),this._animation=null)},_updateAllTilesOnce:function(K,R){return this.tileManager.updateTile(K,!0).then(u.hitch(this,function(U){(this._hasTilingEffects||this.useWebGL||R)&&this._drawOneFrame(U)}))},_drawOneFrame:function(K,R){if(!(this.suspended||!this._map||this.tileMode&&!this._drawTile||(this.tileMode&&this.useWebGL&&this.tileManager.originalPixelData.isEmpty&&
this._context.clear(this._context.COLOR_BUFFER_BIT),this.tileMode&&this.useWebGL&&this.tileManager.xformSetting&&this.tileManager.xformSetting.requireProjection&&!this.tileManager.xformSetting.gridConfig))){if(!this._resetCss||this._levelChange)this._levelChange=!1,this._resetDrawing();if(K&&(K.renderedPixelBlock||K.pixelBlock)&&this._canDraw()&&this.drawMode){R=K.extent;var U=this._map.extent;if(!this._isExtentOutSide(R,U)){var ba=K.pixelBlock||K.renderedPixelBlock,Q=this._context,ea=Q.createImageData(ba.width,
ba.height);ea.data.set((K.renderedPixelBlock||K.pixelBlock).getAsRGBA());K=this.getCurrentResolution();var la=0,ma=0;Math.abs(R.xmin-U.xmin)>K.x&&(la=Math.round((R.xmin-U.xmin)/K.x));Math.abs(U.ymax-R.ymax)>K.y&&(ma=Math.round((U.ymax-R.ymax)/K.y));Q.putImageData(ea,la,ma,0,0,ba.width,ba.height)}}else this._fireUpdateEnd()}},_isExtentOutSide:function(K,R){return K.xmax<=R.xmin||K.xmin>=R.xmax||K.ymax<=R.ymin||K.ymin>=R.ymax},_resetDrawing:function(){this._resetCss=!0;if(!this.useWebGL)if(this._multiply||
this._startRect.width!==this._map.width||this._startRect.height!==this._map.height)this.clear();else{var K=this._context.getImageData(0,0,this._map.width,this._map.height);this.clear();this._context.putImageData(K,this._startRect.left,this._startRect.top)}this._dragOrigin={x:0,y:0};this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"});"css-transforms"===this._map.navigationMode?
(this.roaming&&this.tileMode&&this.useWebGL&&(this._delta=null),this._tdx=this._left,this._tdy=this._top,this._multiply=null,a.set(this._div,c._css.names.transform,c._css.translate(this._left,this._top)),a.set(this._canvas,c._css.names.transform,c._css.translate(-this._left,-this._top))):(a.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),a.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}))},_drawAllFrames:function(){if(!this.suspended&&
this._map&&(!this.tileMode||this._drawTile))if(this._resetCss){var K=this._frames,R=0,U;for(U=0;U<K.length;U++)if(K[U].completed)R++;else if(K[U].tileData.renderedPixelBlock){K[U].completed=!0;var ba=K[U].tileData;break}else if(K[U].tileData._fetched&&!K[U].tileData.src){K[U].completed=!0;break}else if(K[U].tileData.update&&K[U].tileData.update.isFulfilled()&&!K[U].tileData.renderedPixelBlock){K[U].completed=!0;break}else K[U].tileData.fetch&&(!0===K[U].tileData.fetch||K[U].tileData.fetch.isCanceled()||
K[U].tileData.fetch.isRejected())?(K[U].completed=!0,R++):this._isExtentOutSide(K[U].tileData.extent,this._map.extent)&&(K[U].completed=!0,R++);if(ba){R++;var Q=ba.extent,ea=this._map.extent,la=this.getCurrentResolution(),ma=U=0;Math.abs(Q.xmin-ea.xmin)>la.x&&(U=Math.round((Q.xmin-ea.xmin)/la.x));Math.abs(ea.ymax-Q.ymax)>la.y&&(ma=Math.round((ea.ymax-Q.ymax)/la.y));ba.renderedPixelBlock?(Q=ba.renderedPixelBlock,ea=this._context.createImageData(Q.width,Q.height),ea.data.set(ba.renderedPixelBlock.getAsRGBA()),
this._context.putImageData(ea,U,ma,0,0,Q.width,Q.height)):this.clear(U,ma,ba.width,ba.height)}R===K.length?(this._animation=null,this._fireUpdateEnd()):this._animation=requestAnimationFrame(u.hitch(this,this._drawAllFrames))}else this._resetDrawing(),this._animation=requestAnimationFrame(u.hitch(this,this._drawAllFrames))},_fetchTiles:function(K,R){if(!this.suspended&&this.loaded){this._cancelAnimation();var U=this.tileManager,ba=!(U.xformSetting.requireProjection&&U.xformSetting.requirePE)||I.load();
g(ba,u.hitch(this,function(){U.updateExtent(K,this.getCurrentResolution());this._resetCss=!1;U.fetchTiles(R);R&&(this._hasTilingEffects||this.useWebGL?this.useWebGL&&0<U.tiles.length?(U.fillupTiles(),U._validateRawPixelBlocks(U.originalPixelData)?this._updateAllTilesOnce(U.originalPixelData):U.originalPixelData&&U.originalPixelData.src&&U.tiles.some(function(Q){return Q.updateCompleted})&&this._context.clear(this._context.COLOR_BUFFER_BIT),U.tiles.forEach(u.hitch(this,function(Q){Q.update&&!Q.updateCompleted&&
Q.update.then(function(ea){Q.updateCompleted||(Q.updateCompleted=!0);(this._hasTilingEffects||this.useWebGL)&&this._drawOneFrame(ea)}.bind(this))}))):this._hasTilingEffects&&g(U.fetchAllCompleted.isResolved()||U.fetchAllCompleted,u.hitch(this,function(){this._updateAllTilesOnce(U.originalPixelData)})):(this._frames=U.tiles.map(function(Q){return{completed:!1,tileData:Q}}),this._drawAllFrames()))}))}},_redrawTiles:function(){this._fetchTiles(this._map.extent,!0)},_panHandler:function(K,R){this._drawTile=
!1;"css-transforms"===this._map.navigationMode?this.roaming&&this.tileMode&&this.useWebGL?(this._delta=R,!this._roamingAnimation&&this.tileMode&&(this._roamingAnimation=requestAnimationFrame(this._animatePan2d))):(this._left=this._map.__visibleDelta.x+R.x,this._top=this._map.__visibleDelta.y+R.y,a.set(this._div,c._css.names.transform,c._css.translate(this._left,this._top))):a.set(this._div,{left:this._startRect.left+R.x+"px",top:this._startRect.top+R.y+"px"});this.tileMode&&this._fetchTiles(K)},_panEndHandler:function(K,
R){R&&(this._startRect.left+=R.x,this._startRect.top+=R.y);this.oldData=null;this._roamingAnimation&&(cancelAnimationFrame(this._roamingAnimation),this._oldDelta=this._roamingAnimation=null)},_onScaleHandler:function(K,R){var U={},ba=c._css.names;a.set(this._canvas,ba.transition,R?"none":ba.transformName+" "+fa+"ms ease");this._matrix=K;K=this._multiply?e.multiply(K,this._multiply):K;if(this._tdx||this._tdy)K=e.multiply(K,{xx:1,xy:0,yx:0,yy:1,dx:-this._tdx,dy:-this._tdy});U[ba.transform]=c._css.matrix(K);
a.set(this._canvas,U)},_onZoomHandler:function(K,R,U){var ba=this._startRect;K=ba.width*R;R*=ba.height;var Q=ba.left-(K-ba.width)*(U.x-ba.left)/ba.width;U=ba.top-(R-ba.height)*(U.y-ba.top)/ba.height;a.set(this._canvas,{left:Q+"px",top:U+"px",width:K+"px",height:R+"px"});this._endRect={left:Q,top:U,width:K,height:R}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(K,R,U){a.set(this._div,{width:R+"px",height:U+"px"});a.set(this._canvas,{width:R+
"px",height:U+"px"});this._startRect.width=this._canvas.width=R;this._startRect.height=this._canvas.height=U;this.useWebGL&&this._glSetting&&(this._glSetting.pingpong=null,this._glSetting.branches=null)},_extentChangeHandler:function(K,R,U,ba){if(this.loaded&&!this.suspended&&(!R||0!==R.x||0!==R.y||U)){this._drawTile=!0;"css-transforms"===this._map.navigationMode&&(R&&(this._dragOrigin.x+=R.x,this._dragOrigin.y+=R.y),this._left=this._map.__visibleDelta.x,this._top=this._map.__visibleDelta.y,this.roaming&&
this.tileMode&&this.useWebGL||U||a.set(this._div,c._css.names.transform,c._css.translate(this._left,this._top)),U&&(a.set(this._canvas,c._css.names.transition,"none"),this._multiply=this._multiply?e.multiply(this._matrix,this._multiply):this._matrix,this._levelChange=!0));this._fireUpdateStart();var Q=this._map;R=this.raster.rasterFunction?this.raster.getMemberRasters().map(function(la){return la._rasterId}):[this.raster._rasterId];var ea={};this.tileMode?((this.roaming||this.useWebGL)&&this.tileMode||
(R.forEach(function(la,ma){ea[la]={extent:Q.extent,pixelBlock:new T({width:Q.width,height:Q.height,pixels:[],pixelType:"",mask:null,statistics:[]})}}),this.tileManager.originalPixelData={extent:Q.extent,src:ea}),this.projectedFullExtent?this._fetchTiles(K,!0):this._getProjectedFullExtent(Q.spatialReference).then(u.hitch(this,function(){this._fetchTiles(K,!0)}))):this._requestData(Q.extent,Q.width,Q.height)}},_visibilityChangeHandler:function(K){K?q.show(this._div):q.hide(this._div)},_opacityChangeHandler:function(K){a.set(this._div,
"opacity",K)}});k("extend-esri")&&u.setObject("layers.RasterXLayer",G,c);return G})},"esri/layers/rasterLib/raster/rasterFactory":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/sniff dojo/when ../../../kernel ../../../Evented ../../../request ../../../deferredUtils ../../../urlUtils ./ImageServiceRaster ./TileServiceRaster ./TileRaster ./FunctionRaster".split(" "),function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t){G={customDrivers:[],
create:function(v){if(v){if(v.url){var w=c.urlToObject(v.url);var x=w.path;var H=w.query}w=v.serviceInfo;var A=v.rasterFxArgs||{},z=new n,E=r.hitch(this,function(C){console.error(C);this._trycustomDrivers(r.mixin({url:x},v),0,z)});if(x)if(-1===x.toLowerCase().indexOf("imageserver")&&-1===x.toLowerCase().indexOf("mapserver")){var J=new q(r.mixin({},v,{url:x}));v.rasterFx&&(J=new t({rasterFx:v.rasterFx,rasterFxArgs:r.mixin({},A,{raster:J})}));var D=J}else{D=new n;w=w||this._getServiceInfo(x,H);var L=
r.hitch(this,function(C){C.bandCount?J=C.capabilities&&-1<C.capabilities.toLowerCase().indexOf("tileonly")?new l(r.mixin({},{serviceInfo:C},H,v,{url:x})):new f(r.mixin({},{serviceInfo:C},H,v,{url:x})):C.tileInfo&&(J=new l(r.mixin({},{serviceInfo:C},H,this._options,{url:x})));v.rasterFx&&(J=new t({rasterFx:v.rasterFx,rasterFxArgs:r.mixin({},A,{raster:J})}));D.resolve(J)});a(w,L,E)}else D=J=new t({rasterFx:v.rasterFx,rasterFxArgs:r.mixin({},A,{raster:J})});a(D,r.hitch(this,function(C){C?C.open().then(r.hitch(this,
function(N){z.resolve(C)}),E):E(Error("There is no raster to open"))}),E);return z.promise}},register:function(v){this.customDrivers=this.customDrivers||[];0<this.customDrivers.filter(function(w){return w.sourceType===v.prototype.sourceType}).length||this.customDrivers.push(v)},_trycustomDrivers:function(v,w,x){x=x||new n;var H=this.customDrivers[w];if(H){var A=new H(v);A.open().then(r.hitch(this,function(z){x.resolve(A)}),r.hitch(this,function(z){this._trycustomDrivers(v,w+1,x)}))}else x.reject("cannot load layer "+
(v&&v.url||""));return x.promise},_getServiceInfo:function(v,w){w=w||{};var x=w.bandIds;w=w.renderingRule;var H=new n(h._dfdCanceller),A={f:"json"};x&&(A.bandIds=x);w&&(A.renderingRule=w.toJson?JSON.stringify(w.toJson()):JSON.stringify(w));H._pendingDfd=g({url:v,content:A,handleAs:"json",callbackParamName:"callback"});H._pendingDfd.then(function(z){H.callback(z)},function(z){H.errback(z)});return H.promise}};d("extend-esri")&&r.setObject("layers.rasterLib.raster.rasterFactory",G,b);return G})},"esri/layers/rasterLib/raster/ImageServiceRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../WKIDUnitConversion ../../../deferredUtils ../../../urlUtils ../../MosaicRule ../../ImageServiceParameters ../../PixelBlock ./RasterInfo ./BasicRaster ../../rasterFormats/rasterCodec ../tile/RasterTileInfo".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z,E,J,D){G=u([E],{declaredClass:"esri.layers.rasterLib.raster.ImageServiceRaster",sourceType:"ImageService",constructor:function(L){L&&(this._imageServiceParams=L.imageServiceParameters,this._commonReqParams=L._commonReqParams,this._imageServiceParams||(this._imageServiceParams={interpolation:L.interpolation,pixelType:L.pixelType,format:L.format||"lerc",compressionQuality:L.compressionQuality,bandIds:L.bandIds,noDataInterpretation:L.noDataInterpretation,
adjustAspectRatio:L.adjustAspectRatio,mosaicRule:L.mosaicRule,renderingRule:L.interpolation}))},open:function(){var L=new n;if(this.serviceInfo&&this.rasterInfo)return this.loaded=!0,this._findCredential(),this.setFetchParameters(this._imageServiceParams),L.resolve(this),L.promise;var C=this.serviceInfo||this._generateServiceInfo(this._imageServiceParams&&this._imageServiceParams.renderingRule),N=r.hitch(this,function(F){this._fixServiceInfo(F);this.serviceInfo=F;this._findCredential();var T=this._parseRasterInfo(F),
y={};F.defaultMosaicMethod?(y.method=F.defaultMosaicMethod,y.operation=F.mosaicOperator,y.sortField=F.sortField,y.sortValue=F.sortValue):y.method=x.METHOD_NONE;this.serviceInfo.defaultMosaicRule=new x(y);this.serviceInfo.defaultMosaicRule.ascending=!0;F=this._getColormap(this);y=this._getHistograms(this);var B=this._getRasterAttributeTable(this),I=this._getKeyProperties(this),P=this._getMultidimensionalInfo(),X=this._getSlices();(new b([F,y,B,I,P,X])).then(r.hitch(this,function(Y){Y[0][0]&&(T.colormap=
Y[0][1]);Y[1][0]&&(T.histograms=Y[1][1]);Y[2][0]&&(T.vat=Y[2][1]);Y[3][0]&&(T.keyProperties=Y[3][1]);Y[4][0]&&(T.multidimensionalInfo=Y[4][1]);this._slices=Y[5][0]?Y[5][1]:null;T.keyProperties&&T.keyProperties.DataType&&(this.dataType=T.keyProperties.DataType);this.loaded=!0;this.rasterInfo=T;this.setFetchParameters(this._imageServiceParams);L.resolve(this)}))}),S=r.hitch(this,function(F){this.loaded=!0;L.reject(F)});e(C,N,S);return L.promise},setFetchParameters:function(L,C){if(C)this.imageServiceParams=
L;else{var N=this.imageServiceParams;N&&L?Object.keys(L).forEach(function(S){N[S]=L[S]}):this.imageServiceParams=L}this._constructGetImageParams();this._getRasterIdentifier(!0)},read:function(L){if(L.pixelBlock||L.texture){var C=new n;C.resolve(L);return C.promise}if(!1===L.virtual&&this.tileInfo&&!this.tileInfo.virtual)return this.readTile(L);if(this._slices){var N=this._getSliceId();if(null==N)return C=new n,C.resolve(L),C.promise}var S=L.extent,F=S.spatialReference.wkid||d.toJson(S.spatialReference.toJson(!1)),
T=L.timeExtent?L.timeExtent.toJson().join(","):null;C=this.url+"/exportImage";var y={};this._slices&&(y.sliceid=N);this.disableClientCaching&&(y._ts=(new Date).getTime());N=r.mixin({},this._commonReqParams,{bbox:S.xmin+","+S.ymin+","+S.xmax+","+S.ymax,imageSR:F,bboxSR:F,size:L.width+","+L.height,time:T},y);return this._requestPixels({url:C,payload:N,decodeParams:{width:L.width,height:L.height,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:!1},tileOptions:L})},readTile:function(L){var C=
this.tileBoundary&&this.tileBoundary[L.level];if(C&&(C.minRow>L.row||C.maxRow<L.row||C.minCol>L.col||C.maxCol<L.col)){var N=new n;N.resolve(L);return N.promise}if(this._slices&&(N=this._getSliceId(),null==N))return N=new n,N.resolve(L),N.promise;C=this.url+"/tile/"+L.level+"/"+L.row+"/"+L.col;var S={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===L.tileType.toLowerCase()?!0:!1};N=this._slices?"sliceid\x3d"+N+"\x26":"";
N=this.disableClientCaching?"_ts\x3d "+(new Date).getTime():N.replace(/&$/,"");return this._requestPixels({url:C+(0<N.length?"?"+N:""),payload:{},decodeParams:S,tileOptions:L})},toJson:function(){return{url:this.url,tileInfo:this.tileInfo,rasterInfo:this.rasterInfo,serviceInfo:this.serviceInfo,sourceType:this.sourceType,_commonReqParams:this._commonReqParams,_rasterId:this._rasterId}},_getSliceId:function(){var L=r.clone(this._imageServiceParams.multidimensionalDefinition),C=r.clone(this._imageServiceParams.time);
if(null==this._slices||null==C&&(null==L||0===L.length))return 0;var N=L||this.defaultMultidimensionalDefinition,S=N[0].variableName;N=this._getAllDimensionDefinition(N,S).definition;L=null;if(null==N||0===N.length)return null;if(C&&this.serviceInfo.timeInfo){if(null==C[1]||C[1]===C[0])var F=C[0];else{var T=this.serviceInfo.timeInfo.startTimeField;F=this.rasterInfo.multidimensionalInfo.variables.find(function(I){return I.name===S}).dimensions.find(function(I){return I.name===T}).values.filter(function(I){return Array.isArray(I)?
Math.max(I[0],C[0])<Math.min(I[1],C[1]):I>=C[0]&&I<=C[1]}).sort(function(I,P){I=Array.isArray(I)?I[1]:I;P=Array.isArray(P)?I[1]:P;return Math.abs(C[1]-I)-Math.abs(C[1]-P)})[0]||[C[1]]}N.some(function(I){if(I.dimensionName===T)return I.values[0]=F,!0;if(!I.dimensionName)return I.dimensionName=T,I.isSlice=!0,I.values=[F],!0})||N.push({variableName:S,dimensionName:T,isSlice:!0,values:[F]})}for(var y=0;y<this._slices.length;y++){var B=this._slices[y].multidimensionalDefinition;if(B.length===N.length&&
!B.some(function(I){var P=N.filter(function(Y){return I.variableName===Y.variableName&&Y.dimensionName===I.dimensionName})[0];if(!P)return!0;var X=Array.isArray(I.values[0])?I.values[0][0]:I.values[0];P=Array.isArray(P.values[0])?P.values[0][0]:P.values[0];return X!==P})){L=y;break}}return L},_getAllDimensionDefinition:function(L,C){var N=L.map(function(F){return F.dimensionName}),S=!1;this.rasterInfo.multidimensionalInfo.variables.forEach(function(F){F.name!==C||F.dimensions.length===L.length&&N[0]||
(F.dimensions.forEach(function(T){0>N.indexOf(T.name)&&(N[0]?L.push({variableName:C,dimensionName:T.name,values:[T.values[0]]}):(L[0].dimensionName=T.name,L[0].values=[T.values[0]],T[0]=T.name))}),S=!0)},this);return{defChanged:S,definition:L}},_generateServiceInfo:function(L){var C=this.url,N=new n(v._dfdCanceller);N._pendingDfd=c({url:C,content:{f:"json",renderingRule:L?d.toJson(L.toJson()):null},handleAs:"json",callbackParamName:"callback"});N._pendingDfd.then(function(S){N.callback(S)},function(S){N.errback(S)});
return N},_fixServiceInfo:function(L){var C=L.spatialReference.wkid;L.tileInfo&&0===L.extent.xmin&&360===L.extent.xmax&&C&&null==t[C]&&(L.tileInfo.applyGCS360Transform=!0)},_parseRasterInfo:function(L){var C=new z;C.bandCount=L.bandCount;C.extent=new f(L.fullExtent);C.spatialReference=L.spatialReference;C.pixelType=L.pixelType;C.width=Math.floor((L.fullExtent.xmax-L.fullExtent.xmin)/L.pixelSizeX+.5);C.height=Math.floor((L.fullExtent.ymax-L.fullExtent.ymin)/L.pixelSizeY+.5);C.cellSize=new l({x:L.pixelSizeX,
y:L.pixelSizeY,spatialReference:L.spatialReference});var N;if(L.minValues&&0<L.minValues.length&&L.maxValues&&L.stdvValues&&L.meanValues){var S=[];for(N=0;N<L.minValues.length;N++)S.push({min:L.minValues[N],max:L.maxValues[N],mean:L.meanValues[N],stddev:L.stdvValues[N]});L.bandCount!==S.length&&(S=null)}this.dataType=L.serviceDataType?L.serviceDataType.replace("esriImageServiceDataType",""):"Generic";C.statistics=S;L.objectIdField&&L.fields&&(C.catalogInfo={objectIdField:L.objectIdField,fields:L.fields});
C.timeInfo=L.timeInfo;if(L.tileInfo){this.tileInfo=new D(L.tileInfo);this.tileInfo.tileType=L.cacheType||"Map";C.tileInfo=this.tileInfo;var F=C.extent,T=this.tileInfo.origin,y=this.tileInfo.cols,B=this.tileInfo.rows;this.tileBoundary=this.tileInfo.lods.map(function(I){return{minCol:Math.floor((F.xmin-T.x+.1*I.resolution)/y/I.resolution),maxCol:Math.floor((F.xmax-T.x-.1*I.resolution)/y/I.resolution),minRow:Math.floor((T.y-F.ymax+.1*I.resolution)/B/I.resolution),maxRow:Math.floor((T.y-F.ymin-.1*I.resolution)/
B/I.resolution)}})}return C},_getColormap:function(L){L=this.url+"/colormap";var C=new n(v._dfdCanceller),N={f:"json"},S=this.serviceInfo.hasColormap||this.rasterInfo&&this.rasterInfo.hasColormap;10<this.serviceInfo.currentVersion&&S?(C._pendingDfd=c({url:L,content:N,handleAs:"json",callbackParamName:"callback"}),C._pendingDfd.then(function(F){C.callback(F.colormap)},function(F){C.errback(F)})):C.callback(null);return C},_getHistograms:function(L){var C=this.url+"/histograms",N=new n(v._dfdCanceller),
S={f:"json"},F=this.serviceInfo.hasHistograms||this.rasterInfo&&this.rasterInfo.hasHistograms;L&&L.renderingRule&&(S.renderingRule=d.toJson(L.renderingRule.toJson()),F=!0);10<this.serviceInfo.currentVersion&&F?(N._pendingDfd=c({url:C,content:S,handleAs:"json",callbackParamName:"callback"}),N._pendingDfd.then(function(T){N.callback(T.histograms)},function(T){N.errback(T)})):N.callback(null);return N},_getRasterAttributeTable:function(L){var C=this.url+"/rasterAttributeTable",N=new n(v._dfdCanceller),
S={f:"json"},F=this.serviceInfo.hasRasterAttributeTable;L&&L.renderingRule&&(S.renderingRule=d.toJson(L.renderingRule.toJson()),F=!0);10<this.serviceInfo.currentVersion&&F?(N._pendingDfd=c({url:C,content:S,handleAs:"json",callbackParamName:"callback"}),N._pendingDfd.then(function(T){N.callback(T)},function(T){N.errback(T)})):N.callback(null);return N},_getKeyProperties:function(L){var C=this.url+"/keyProperties",N=new n(v._dfdCanceller),S={f:"json"};L&&L.renderingRule&&(S.renderingRule=d.toJson(L.renderingRule.toJson()));
10<this.serviceInfo.currentVersion?(N._pendingDfd=c({url:C,content:S,handleAs:"json",callbackParamName:"callback"}),N._pendingDfd.then(function(F){N.callback(F)},function(F){N.errback(F)})):N.callback(null);return N},_getMultidimensionalInfo:function(){var L=this.url+"/multidimensionalInfo",C=new n(v._dfdCanceller);10.3<=this.serviceInfo.currentVersion&&this.serviceInfo.hasMultidimensions?(C._pendingDfd=c({url:L,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),C._pendingDfd.then(r.hitch(this,
function(N){C.callback(N.multidimensionalInfo)}),function(N){C.errback(N)})):C.callback(null);return C},_getSlices:function(){var L=this.url+"/slices",C=new n(v._dfdCanceller);this.serviceInfo.hasMultidimensions?(C._pendingDfd=c({url:L,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),C._pendingDfd.then(r.hitch(this,function(N){C.callback(N.slices)}),function(N){C.errback(N)})):C.callback(null);return C},_initializationFailed:function(){},_constructGetImageParams:function(){var L=
this.imageServiceParams||{},C=r.mixin({},this._query,{f:"image",interpolation:L.interpolation,pixelType:L.pixelType,format:L.format||"lerc",compressionQuality:L.compressionQuality,bandIds:L.bandIds?L.bandIds.join(","):null,noData:null!=L.noData?L.noData.join(","):null,noDataInterpretation:L.noDataInterpretation,adjustAspectRatio:null==L.adjustAspectRatio?null:L.adjustAspectRatio,mosaicRule:L.mosaicRule?d.toJson(L.mosaicRule.toJson()):null,renderingRule:L.renderingRule?d.toJson(L.renderingRule.toJson()):
null,token:this.credential&&this.credential.token||null});"lerc"===C.format.toLowerCase()?(C.compressionTolerance=L.compressionTolerance,10.5<=this.serviceInfo.currentVersion&&(C.lercVersion=L.lercVersion||2)):"tiff"===C.format.toLowerCase()?C.compression=L.compression:-1<["jpg","jpeg","jpg","jpgpng"].indexOf(C.format.toLowerCase())&&(C.compression=L.compression);this._commonReqParams=C},_getRasterIdentifier:function(L){if(this._rasterId)return this._rasterId;L=this.url.replace("http:","").replace("https:",
"");var C=[],N=this.imageServiceParams||{};C.push(L);C.push(N.interpolation);C.push(N.pixelType);C.push(N.compressionQuality);C.push(N.bandIds?N.bandIds.join(","):"");C.push(N.mosaicRule?d.toJson(N.mosaicRule.toJson()):"");C.push(N.renderingRule?d.toJson(N.renderingRule.toJson()):"");L=C.join("|");return this._rasterId=this._computeSignature(L)},_wrapExtent:function(L){var C=L.spatialReference._getInfo();if(C){var N=C.valid[0];C=C.valid[1];if(L.xmin<N-this.resolution.x||L.xmax>C+this.resolution.y){var S=
new f((L.xmin-N)%(C-N),L.ymin,(L.xmax-C)%(C-N),L.ymax,L.spatialReference);S.xmax<S.xmin&&(S=null)}}return S||L}});a("extend-esri")&&r.setObject("layers.rasterLib.raster.ImageServiceRaster",G,g);return G})},"esri/layers/rasterLib/raster/RasterInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","../../../geometry/Extent","../../../SpatialReference","../tile/RasterTileInfo"],function(G,u,r,n,m){return G(null,{declaredClass:"esri.layers.rasterLib.raster.RasterInfo",bandCount:null,pixelType:null,
extent:null,spatialReference:null,width:null,height:null,colormap:null,attributeTable:null,multiDimensionalInfo:null,statistics:null,histograms:null,catalogInfo:null,keyProperties:null,cellSize:null,format:null,compression:null,compressionQuality:null,packetSize:null,geodataXform:null,constructor:function(k){u.mixin(this,k);this.extent=this.extent?this.extent.toJson?this.extent:new r(this.extent):null;this.spatialReference=this.spatialReference?this.spatialReference.toJson?this.spatialReference:new n(this.spatialReference):
null;this.tileInfo=this.tileInfo?this.tileInfo.toJson?this.tileInfo:new m(this.tileInfo):null},toJson:function(){return{bandCount:this.bandCount,pixelType:this.pixelType,extent:this.extent&&this.extent.toJson?this.extent.toJson():this.extent,spatialReference:this.spatialReference&&this.spatialReference.toJson?this.spatialReference.toJson():this.spatialReference,width:this.width,height:this.height,colormap:this.colormap?u.clone(this.colormap):null,attributeTable:this.attributeTable?u.clone(this.attributeTable):
null,multiDimensionalInfo:this.multiDimensionalInfo?u.clone(this.multiDimensionalInfo):null,statistics:this.statistics?u.clone(this.statistics):null,histograms:this.histograms?u.clone(this.histograms):null,catalogInfo:this.catalogInfo?u.clone(this.catalogInfo):null,keyProperties:this.keyProperties?u.clone(this.keyProperties):null,cellSize:this.cellSize&&this.cellSize.toJson?this.cellSize.toJson():this.cellSize,tileInfo:this.tileInfo&&this.tileInfo.toJson?this.tileInfo.toJson():this.tileInfo,format:this.format,
compression:this.compression,compressionQuality:this.compressionQuality,packetSize:this.packetSize,geodataXform:this.geodataXform?u.clone(this.geodataXform):null}},clone:function(){return new this.constructor(this.toJson())}})})},"esri/layers/rasterLib/tile/RasterTileInfo":function(){define("dojo/_base/declare dojo/_base/lang ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../../lang ../../TileInfo".split(" "),function(G,u,r,n,m,k,d){return G([d],{declaredClass:"esri.layers.rasterLib.tile.RasterTileInfo",
rows:512,cols:512,compressionQuality:95,lercError:.01,spatialReference:null,origin:null,virtual:!0,tileType:"Raster",constructor:function(a,b){if(a||b){var e=b&&b.refTileInfo;a?this.virtual=!1:(this.virtual=!0,u.mixin(this,{rows:b.rows||this.rows,cols:b.cols||this.cols,compressionQuality:b.compressionQuality||95,lercError:b.compressionTolerance||.01,spatialReference:b.spatialReference,origin:b.origin}),this.width=this.cols,this.height=this.rows,this.origin||(e?this.origin=e.origin:b.spatialReference.isWebMercator()||
b.extent&&360<=Math.max(Math.abs(b.extent.xmin),Math.abs(b.extent.xmax))?this.origin={x:-2.0037508342787E7,y:2.0037508342787E7}:-1<[4326,4269].indexOf(b.spatialReference.wkid)||360>Math.max(Math.abs(b.extent.xmin),Math.abs(b.extent.xmax))?this.origin={x:-180,y:90}:this.origin={x:b.extent.xmin,y:b.extent.ymax}))}},toJson:function(){var a=d.prototype.toJson.apply(this);a.tileType=this.tileType;a.virtual=this.virtual;a.lercError=this.lercError;return a},clone:function(){return new this.prototype(this.toJson())}})})},
"esri/layers/rasterLib/raster/BasicRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../MosaicRule ../../ImageServiceParameters ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterHandler ./rasterProjectionHelper ./RasterInfo".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z,E,J){return u([h],{url:null,dataType:null,rasterInfo:null,tileInfo:null,serviceInfo:null,loaded:null,constructor:function(D){if(D){var L=D.url;L&&(L=v.urlToObject(L),this.url=L.path,this._query=L.query);this.dataType=D.dataType;this.serviceInfo=D.serviceInfo;this.rasterInfo=D.rasterInfo;this.tileInfo=D.tileInfo;this.serviceInfo=D.serviceInfo}},open:function(){},read:function(D){},identify:function(D){var L=new n,C=this.rasterInfo.extent;if(E.requirePE(C.spatialReference,
D.spatialReference))E.load().then(r.hitch(this,function(){N=E.project(D,C.spatialReference);L.resolve(N)}),function(){L.reject(Error("cannot project into this spatial reference"))});else{var N=E.project(D,C.spatialReference);L.resolve(N)}return L.then(r.hitch(this,function(S){var F=this.tileInfo,T=F.origin,y=F.lods[F.lods.length-1],B=(S.x-T.x)/F.cols/y.resolution;S=(T.y-S.y)/F.rows/y.resolution;var I=Math.round((S-Math.floor(S))*F.rows)*F.cols+Math.round((B-Math.floor(B))*F.cols);T=new f(T.x+y.resolution*
F.cols*B,T.y-y.resolution*F.rows*(S+1),T.x+y.resolution*F.cols*(B+1),T.y-y.resolution*F.rows*S,C.spatialReference);var P=this.getMemberRasters?this.getMemberRasters()[0]:this;return P.read({level:y.level,row:Math.floor(S),col:Math.floor(B),extent:T,width:F.cols,height:F.rows,virtual:P.tileInfo.virtual,tileType:P.tileInfo.tileType}).then(function(X){return(X=X&&X.pixelBlock)&&X.pixels&&0<X.pixels.length&&(!X.mask||X.mask[I])?{pixelValue:X.pixels.map(function(Y){return Y[I]})}:{pixelValue:null}})}))},
getProjectedFullExtent:function(D,L){var C=new n;if(this.projectedFullExtent&&!L)return C.resolve(this.projectedFullExtent),C.promise;var N=this.rasterInfo.extent;if(E.requirePE(this.rasterInfo.extent.spatialReference,D))E.load().then(r.hitch(this,function(){S=E.project(N,D);this.projectedFullExtent=S=new f(S.toJson());C.resolve(S)}),function(){C.reject(Error("cannot project into this spatial reference"))});else{var S=E.project(N,D);this.projectedFullExtent=S=new f(S.toJson());C.resolve(S)}return C.promise},
setFetchParameters:function(D,L){},_setRasterHandler:function(D){this._rasterHandler=D;this.getMemberRasters&&this.getMemberRasters().forEach(r.hitch(this,function(L){L._rasterHandler=D}))},_findCredential:function(){this.url&&((this._credential=g.id&&g.id.findCredential(this.url))&&this._credential.ssl||this.serviceInfo&&this.serviceInfo._ssl)&&(this.url=this.url.replace(/^http:/i,"https:"))},_initWorker:function(){this._rasterHandler=new z;this._rasterHandler.start().then(function(){this._rasterHandlerInitialized=
!0}.bind(this))},_requestPixels:function(D){var L=D.url,C=D.payload,N=D.decodeParams,S=D.tileOptions,F=new n(t._dfdCanceller);this._rasterHandler||this._initWorker();var T=this._rasterHandler,y={};L={url:L,handleAs:"arraybuffer",content:C};D.headers&&(L.headers=D.headers);F._pendingDfd=c(L).then(r.hitch(this,function(B){(T&&this._rasterHandlerInitialized?T.decode({encodedData:B,decodeParams:N}):A.decode(B,N)).then(function(I){y.pixelBlock=new H(I);y.extent=S.extent;y.level=S.level;y.row=S.row;y.col=
S.col;y.width=S.width;y.height=S.height;t._resDfd(F,[y])},function(I){t._resDfd(F,[I],!0)})}),function(B){t._resDfd(F,[B],!0)});return F},_computeSignature:function(D){if("string"===typeof D){for(var L=new Uint8Array(D.length),C=0;C<D.length;C++)L[C]=D.charCodeAt(C);D=L}C=L=65535;for(var N=D.length,S=Math.floor(N/2),F=0;S;){var T=359<=S?359:S;S-=T;do L+=D[F++]<<8,C+=L+=D[F++];while(--T);L=(L&65535)+(L>>>16);C=(C&65535)+(C>>>16)}N&1&&(C+=L+=D[F]<<8);return((C&65535)+(C>>>16)<<16|(L&65535)+(L>>>16))>>>
0}})})},"esri/layers/rasterFormats/rasterCodec":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred ../PixelBlock ./LercCodec ./Lerc2Codec ./JpgPlus ./Png ./Raw ./TiffDecoder".split(" "),function(G,u,r,n,m,k,d,a,b,e,g){return{validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),supportedFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_isPlatformLittleEndian:function(){var h=new ArrayBuffer(4),c=new Uint8Array(h);(new Uint32Array(h))[0]=
1;return 1===c[0]}(),decode:function(h,c){if(void 0===c||null===c)throw"missing decode options";var f;c.format&&(f=c.format.toUpperCase());"BSQ"!==f&&"BIP"!==f&&(f=this._getFormat(h));var l=c.decodeFunc;if(void 0===l||null===l)l=this._getFormatDecoderDfd(f);return l(h,c)},_getFormatDecoderDfd:function(h){var c=null;switch(h){case "LERC":c=this._decodeLerc;break;case "LERC2":c=this._decodeLerc2;break;case "JPEG":c=this._decodeJpeg;break;case "PNG":c=this._decodePng;break;case "BSQ":c=this._decodeBsq;
break;case "BIP":c=this._decodeBip;break;case "TIFF":c=this._decodeTiff;break;default:c=function(f,l){throw"The raster format is not supported";}}c=r.hitch(this,c);return function(f,l){var q=new n;l.isPoint&&l.width&&(l.width++,l.height++);f=c(f,l);l.isPoint&&l.width&&(this._interpolatePointGrid(f),l.width--,l.height--);q.resolve(f);return q}.bind(this)},_getFormat:function(h){h=new Uint8Array(h,0,10);var c="";if(255===h[0]&&216===h[1])c="JPEG";else if(137===h[0]&&80===h[1]&&78===h[2]&&71===h[3])c=
"PNG";else if(67===h[0]&&110===h[1]&&116===h[2]&&90===h[3]&&73===h[4]&&109===h[5]&&97===h[6]&&103===h[7]&&101===h[8]&&32===h[9])c="LERC";else if(76===h[0]&&101===h[1]&&114===h[2]&&99===h[3]&&50===h[4]&&32===h[5])c="LERC2";else if(-1<String.fromCharCode.apply(null,h).toLowerCase().indexOf("error"))c="ERROR";else if(73===h[0]&&73===h[1]&&42===h[2]&&0===h[3]||77===h[0]&&77===h[1]&&0===h[2]&&42===h[3])c="TIFF";return c},_validateDecodeParams:function(h){if(!h.height||Math.floor(h.height)!==h.height)throw"Height not provided.";
if(!h.width||Math.floor(h.width)!==h.width)throw"Width not provided.";},_decodeJpeg:function(h,c){if(!a)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(c);h=(new a).decode(h);if(!this._verifyResult(h,c))throw"The decoded image dimensions are incorrect.";c=new m({width:h.width,height:h.height,pixels:h.pixels,pixelType:"U8",mask:h.mask,statistics:null});c.calculateStatistics();return c},_decodePng:function(h,c){if(!b)throw"The png decoder module is not loaded.";this._validateDecodeParams(c);
h=new Uint8Array(h);var f=new b(h);h=new Uint8Array(c.width*c.height*4);f.copyToImageData(h,f.decodePixels());var l=f=0;l=new Uint8Array(c.width*c.height);for(f=0;f<c.width*c.height;f++)l[f]=h[4*f+3];var q=new m({width:c.width,height:c.height,pixels:[],pixelType:"U8",mask:l,statistics:[]});for(f=0;3>f;f++){var t=new Uint8Array(c.width*c.height);for(l=0;l<c.width*c.height;l++)t[l]=h[4*l+f];q.addData({pixels:t})}q.calculateStatistics();return q},_decodeBsq:function(h,c){if(!e)throw"The bsq decoder module is not loaded.";
this._validateDecodeParams(c);var f=c.noDataValue;c.pixelType=this._getpixelTypeAndNoData(c.pixelType);h=e.decodeBSQ(h,{bandCount:c.planes,width:c.width,height:c.height,pixelType:c.pixelType,noDataValue:f});c=new m({width:c.width,height:c.height,pixels:h.pixels,pixelType:c.pixelType,mask:h.maskData,statistics:null});c.calculateStatistics();return c},_decodeBip:function(h,c){this._validateDecodeParams(c);var f=c.noDataValue;c.pixelType=this._getpixelTypeAndNoData(c.pixelType);h=e.decodeBIP(h,{bandCount:c.planes,
width:c.width,height:c.height,pixelType:c.pixelType,noDataValue:f});c=new m({width:c.width,height:c.height,pixels:h.pixels,pixelType:c.pixelType,mask:h.maskData,statistics:null});c.calculateStatistics();return c},_decodeTiff:function(h,c){this._validateDecodeParams(c);c.pixelType=this._getpixelTypeAndNoData(c.pixelType);h=g.decode(h);h=new m({width:h.width,height:h.height,pixels:h.pixels,pixelType:h.pixelType,mask:h.maskData,statistics:null});h.calculateStatistics();return h},_decodeLerc:function(h,
c){if(!this._isPlatformLittleEndian)throw"lerc decoder is not supported on big endian platform";this._validateDecodeParams(c);var f=c.noDataValue;c.pixelType=this._getpixelTypeAndNoData(c.pixelType);for(var l=0,q,t=0,v,w=h.byteLength-10;t<w;){var x=k.decode(h,{inputOffset:t,encodedMaskData:q,returnMask:0===l?!0:!1,returnEncodedMask:0===l?!0:!1,returnFileInfo:!0,pixelType:c.pixelType,noDataValue:f});t=x.fileInfo.eofOffset;0===l&&(q=x.encodedMaskData,v=new m({width:c.width,height:c.height,pixels:[],
pixelType:c.pixelType,mask:x.maskData,statistics:[]}));l++;if(!this._verifyResult(x,c))throw"The decoded image dimensions are incorrect";v.addData({pixels:x.pixelData,statistics:{minValue:x.minValue,maxValue:x.maxValue,noDataValue:x.noDataValue}})}return v},_decodeLerc2:function(h,c){if(!this._isPlatformLittleEndian)throw"lerc2 decoder is not supported on big endian platform";this._validateDecodeParams(c);c.pixelType=this._getpixelTypeAndNoData(c.pixelType);for(var f=0,l,q,t,v=0,w,x=h.byteLength-
10,H=[],A,z=0;v<x;){q=d.decode(h,{inputOffset:v,maskData:l,returnFileInfo:!0});v=q.fileInfo.eofOffset;l=q.maskData;0===f&&(t=q.fileInfo.numValidPixel,w=new m({width:c.width,height:c.height,pixels:[],dimCount:q.dimCount||1,pixelType:q.fileInfo.pixelType,mask:l,statistics:[]}));q.fileInfo.mask&&0<q.fileInfo.mask.numBytes&&z++;l&&H.push(l);f++;if(!this._verifyResult(q,c))throw"The decoded image dimensions are incorrect";w.addData({pixels:q.pixelData,statistics:{minValue:q.minValue,maxValue:q.maxValue,
noDataValue:q.noDataValue,dimStats:q.dimStats}})}if(1<z){c=w.width*w.height;w.bandMasks=H;l=new Uint8Array(c);l.set(H[0]);for(t=1;t<H.length;t++)for(A=H[t],h=0;h<c;h++)l[h]&=A[h];for(h=t=0;h<c;h++)t+=A[h];w.mask=l}w.validPixelCount=t;return w},_interpolatePointGrid:function(h,c){var f=h.pixels;if(f&&0!==f.length){var l=f.length,q=h.width,t=h.mask,v=q-1,w=h.height-1,x=[],H,A;if(0===(null==c?1:c)){for(c=0;c<l;c++){var z=f[c];var E=new z.constructor(v*w);for(H=0;H<w;H++){var J=H*q;for(A=0;A<v;A++)E[H*
v+A]=z[J+A]}x.push(E)}if(t){var D=new Uint8Array(v*w);for(H=0;H<w;H++)for(J=H*q,A=0;A<v;A++)D[H*v+A]=t[J+A]}}else{for(c=0;c<l;c++){z=f[c];E=new z.constructor(v*w);for(H=0;H<w;H++)for(J=H*q,A=0;A<v;A++)E[H*v+A]=(z[J+A]+z[J+A+1]+z[J+q+A]+z[J+q+A+1])/4;x.push(E)}if(t)for(D=new Uint8Array(v*w),H=0;H<w;H++)for(J=H*q,A=0;A<v;A++)D[H*v+A]=Math.min.apply(null,[t[J+A],t[J+A+1],t[J+q+A],t[J+q+A+1]])}h.width=v;h.height=w;h.mask=D;h.pixels=x;return h}},_getpixelTypeAndNoData:function(h){return"U1"===h||"U2"===
h||"U4"===h||"U8"===h?"U8":h},_verifyResult:function(h,c){return h.height!==c.height||h.width!==c.width?!1:!0}}})},"esri/layers/rasterFormats/JpgPlus":function(){define(["dojo/_base/declare","./Zlib","./Jpg"],function(G,u,r){return G(null,{constructor:function(){},decode:function(n){var m=new Uint8Array(n);n=new r;n.parse(m);var k=n.numComponents,d=n.getData(n.width,n.height,!0),a=n.width*n.height,b=n.eof,e=0,g=0,h=0;if(b<m.length-1){g=(new u(m.subarray(b))).getBytes();var c=new Uint8Array(a);for(e=
m=0;e<g.length;e++)for(h=7;0<=h;h--)c[m++]=g[e]>>h&1}m=[];if(1===k)m=[d,d,d];else{for(e=0;3>e;e++)k=new Uint8Array(a),m.push(k);for(g=h=0;g<a;g++)for(e=0;3>e;e++)m[e][g]=d[h++]}return{width:n.width,height:n.height,pixels:m,mask:c}}})})},"esri/layers/rasterFormats/Zlib":function(){define([],function(){var G=function(){function u(){this.bufferLength=this.pos=0;this.eof=!1;this.buffer=null}u.prototype={ensureBuffer:function(r){var n=this.buffer,m=n?n.byteLength:0;if(r<m)return n;for(var k=512;k<r;)k<<=
1;r=new Uint8Array(k);for(k=0;k<m;++k)r[k]=n[k];return this.buffer=r},getByte:function(){for(var r=this.pos;this.bufferLength<=r;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},getBytes:function(r){var n=this.pos;if(r){this.ensureBuffer(n+r);for(r=n+r;!this.eof&&this.bufferLength<r;)this.readBlock();var m=this.bufferLength;r>m&&(r=m)}else{for(;!this.eof;)this.readBlock();r=this.bufferLength}this.pos=r;return this.buffer.subarray(n,r)},lookChar:function(){for(var r=this.pos;this.bufferLength<=
r;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var r=this.pos;this.bufferLength<=r;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(r,n,m){for(var k=r+n;this.bufferLength<=k&&!this.eof;)this.readBlock();return new Stream(this.buffer,r,n,m)},skip:function(r){r||(r=1);this.pos+=r},reset:function(){this.pos=0}};return u}();return function(){function u(b){throw Error(b);
}function r(b){var e=0,g=b[e++],h=b[e++];-1!=g&&-1!=h||u("Invalid header in flate stream");8!=(g&15)&&u("Unknown compression method in flate stream");0!=((g<<8)+h)%31&&u("Bad FCHECK in flate stream");h&32&&u("FDICT bit set in flate stream");this.bytes=b;this.bytesPos=e;this.codeBuf=this.codeSize=0;G.call(this)}if(!self||!self.Uint32Array)return null;var n=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),m=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,
131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),k=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),d=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,
459020,524392,524328,59E4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,
459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,
459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,
459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,
459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,
459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,
459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],a=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,
327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];r.prototype=Object.create(G.prototype);r.prototype.getBits=function(b){for(var e=this.codeSize,g=this.codeBuf,h=this.bytes,c=this.bytesPos,f;e<b;)"undefined"==typeof(f=h[c++])&&u("Bad encoding in flate stream"),g|=f<<e,e+=8;this.codeBuf=g>>b;this.codeSize=e-=b;this.bytesPos=c;return g&(1<<b)-1};r.prototype.getCode=function(b){var e=b[0],g=b[1];b=this.codeSize;for(var h=
this.codeBuf,c=this.bytes,f=this.bytesPos;b<g;){var l;"undefined"==typeof(l=c[f++])&&u("Bad encoding in flate stream");h|=l<<b;b+=8}g=e[h&(1<<g)-1];e=g>>16;g&=65535;(0==b||b<e||0==e)&&u("Bad encoding in flate stream");this.codeBuf=h>>e;this.codeSize=b-e;this.bytesPos=f;return g};r.prototype.generateHuffmanTable=function(b){for(var e=b.length,g=0,h=0;h<e;++h)b[h]>g&&(g=b[h]);for(var c=1<<g,f=new Uint32Array(c),l=1,q=0,t=2;l<=g;++l,q<<=1,t<<=1)for(var v=0;v<e;++v)if(b[v]==l){var w=0,x=q;for(h=0;h<l;++h)w=
w<<1|x&1,x>>=1;for(h=w;h<c;h+=t)f[h]=l<<16|v;++q}return[f,g]};r.prototype.readBlock=function(){function b(w,x,H,A,z){for(w=w.getBits(H)+A;0<w--;)x[q++]=z}var e=this.getBits(3);e&1&&(this.eof=!0);e>>=1;if(0==e){var g=this.bytes,h=this.bytesPos,c;"undefined"==typeof(c=g[h++])&&u("Bad block header in flate stream");var f=c;"undefined"==typeof(c=g[h++])&&u("Bad block header in flate stream");f|=c<<8;"undefined"==typeof(c=g[h++])&&u("Bad block header in flate stream");e=c;"undefined"==typeof(c=g[h++])&&
u("Bad block header in flate stream");(e|c<<8)!=(~f&65535)&&u("Bad uncompressed block length in flate stream");this.codeSize=this.codeBuf=0;c=this.bufferLength;e=this.ensureBuffer(c+f);this.bufferLength=f=c+f;for(var l=c;l<f;++l){if("undefined"==typeof(c=g[h++])){this.eof=!0;break}e[l]=c}this.bytesPos=h}else{if(1==e)h=d,c=a;else if(2==e){e=this.getBits(5)+257;c=this.getBits(5)+1;g=this.getBits(4)+4;h=Array(n.length);for(var q=0;q<g;)h[n[q++]]=this.getBits(3);h=this.generateHuffmanTable(h);q=g=0;c=
e+c;for(f=Array(c);q<c;)l=this.getCode(h),16==l?b(this,f,2,3,g):17==l?b(this,f,3,3,g=0):18==l?b(this,f,7,11,g=0):f[q++]=g=l;h=this.generateHuffmanTable(f.slice(0,e));c=this.generateHuffmanTable(f.slice(e,c))}else u("Unknown block type in flate stream");f=(e=this.buffer)?e.length:0;for(l=this.bufferLength;;){var t=this.getCode(h);if(256>t)l+1>=f&&(e=this.ensureBuffer(l+1),f=e.length),e[l++]=t;else{if(256==t){this.bufferLength=l;break}t-=257;t=m[t];var v=t>>16;0<v&&(v=this.getBits(v));g=(t&65535)+v;
t=this.getCode(c);t=k[t];v=t>>16;0<v&&(v=this.getBits(v));t=(t&65535)+v;l+g>=f&&(e=this.ensureBuffer(l+g),f=e.length);for(v=0;v<g;++v,++l)e[l]=e[l-t]}}}};return r}()})},"esri/layers/rasterFormats/Jpg":function(){define([],function(){var G=function(){function u(r){this.message="JPEG error: "+r}u.prototype=Error();u.prototype.name="JpegError";return u.constructor=u}();return function(){function u(){this.decodeTransform=null;this.colorTransform=-1}function r(a,b){for(var e=0,g=[],h,c,f=16;0<f&&!a[f-
1];)f--;g.push({children:[],index:0});var l=g[0],q;for(h=0;h<f;h++){for(c=0;c<a[h];c++){l=g.pop();for(l.children[l.index]=b[e];0<l.index;)l=g.pop();l.index++;for(g.push(l);g.length<=h;)g.push(q={children:[],index:0}),l.children[l.index]=q.children,l=q;e++}h+1<f&&(g.push(q={children:[],index:0}),l.children[l.index]=q.children,l=q)}return g[0].children}function n(a,b,e,g,h,c,f,l,q){function t(){if(0<N)return N--,C>>N&1;C=a[b++];if(255===C){var R=a[b++];if(R)throw new G("unexpected marker "+(C<<8|R).toString(16));
}N=7;return C>>>7}function v(R){for(;;){R=R[t()];if("number"===typeof R)return R;if("object"!==typeof R)throw new G("invalid huffman sequence");}}function w(R){for(var U=0;0<R;)U=U<<1|t(),R--;return U}function x(R){if(1===R)return 1===t()?1:-1;var U=w(R);return U>=1<<R-1?U:U+(-1<<R)+1}function H(R,U){var ba=v(R.huffmanTableDC);ba=0===ba?0:x(ba);R.blockData[U]=R.pred+=ba;for(ba=1;64>ba;){var Q=v(R.huffmanTableAC),ea=Q&15;Q>>=4;if(0===ea){if(15>Q)break;ba+=16}else ba+=Q,R.blockData[U+d[ba]]=x(ea),ba++}}
function A(R,U){var ba=v(R.huffmanTableDC);ba=0===ba?0:x(ba)<<q;R.blockData[U]=R.pred+=ba}function z(R,U){R.blockData[U]|=t()<<q}function E(R,U){if(0<S)S--;else for(var ba=c;ba<=f;){var Q=v(R.huffmanTableAC),ea=Q&15;Q>>=4;if(0===ea){if(15>Q){S=w(Q)+(1<<Q)-1;break}ba+=16}else ba+=Q,R.blockData[U+d[ba]]=x(ea)*(1<<q),ba++}}function J(R,U){for(var ba=c,Q=0,ea;ba<=f;){ea=d[ba];switch(F){case 0:Q=v(R.huffmanTableAC);ea=Q&15;Q>>=4;if(0===ea)15>Q?(S=w(Q)+(1<<Q),F=4):(Q=16,F=1);else{if(1!==ea)throw new G("invalid ACn encoding");
T=x(ea);F=Q?2:3}continue;case 1:case 2:R.blockData[U+ea]?R.blockData[U+ea]+=t()<<q:(Q--,0===Q&&(F=2===F?3:0));break;case 3:R.blockData[U+ea]?R.blockData[U+ea]+=t()<<q:(R.blockData[U+ea]=T<<q,F=0);break;case 4:R.blockData[U+ea]&&(R.blockData[U+ea]+=t()<<q)}ba++}4===F&&(S--,0===S&&(F=0))}var D=e.mcusPerLine,L=b,C=0,N=0,S=0,F=0,T,y=g.length,B,I,P,X;l=e.progressive?0===c?0===l?A:z:0===l?E:J:H;var Y=0;e=1===y?g[0].blocksPerLine*g[0].blocksPerColumn:D*e.mcusPerColumn;for(var aa,Z;Y<e;){var fa=h?Math.min(e-
Y,h):e;for(B=0;B<y;B++)g[B].pred=0;S=0;if(1===y){var K=g[0];for(X=0;X<fa;X++)l(K,64*((K.blocksPerLine+1)*(Y/K.blocksPerLine|0)+Y%K.blocksPerLine)),Y++}else for(X=0;X<fa;X++){for(B=0;B<y;B++)for(K=g[B],aa=K.h,Z=K.v,I=0;I<Z;I++)for(P=0;P<aa;P++)l(K,64*((K.blocksPerLine+1)*((Y/D|0)*K.v+I)+(Y%D*K.h+P)));Y++}N=0;(K=k(a,b))&&K.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+K.invalid),b=K.offset);K=K&&K.marker;if(!K||65280>=K)throw new G("marker was not found");if(65488<=K&&65495>=
K)b+=2;else break}(K=k(a,b))&&K.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+K.invalid),b=K.offset);return b-L}function m(a,b){a=b.blocksPerLine;for(var e=b.blocksPerColumn,g=new Int16Array(64),h=0;h<e;h++)for(var c=0;c<a;c++){var f=void 0,l=void 0,q=void 0,t=void 0,v=void 0,w=void 0,x=void 0,H=void 0,A=v=w=t=l=f=void 0,z=void 0,E=void 0,J=void 0,D=64*((b.blocksPerLine+1)*h+c),L=g,C=b.quantizationTable,N=b.blockData;if(!C)throw new G("missing required Quantization Table.");
for(var S=0;64>S;S+=8)f=N[D+S],H=N[D+S+1],x=N[D+S+2],w=N[D+S+3],v=N[D+S+4],t=N[D+S+5],q=N[D+S+6],l=N[D+S+7],f*=C[S],0===(H|x|w|v|t|q|l)?(f=5793*f+512>>10,L[S]=f,L[S+1]=f,L[S+2]=f,L[S+3]=f,L[S+4]=f,L[S+5]=f,L[S+6]=f,L[S+7]=f):(H*=C[S+1],x*=C[S+2],w*=C[S+3],v*=C[S+4],t*=C[S+5],q*=C[S+6],l*=C[S+7],J=5793*f+128>>8,E=5793*v+128>>8,z=x,A=q,v=2896*(H-l)+128>>8,l=2896*(H+l)+128>>8,w<<=4,t<<=4,J=J+E+1>>1,E=J-E,f=3784*z+1567*A+128>>8,z=1567*z-3784*A+128>>8,A=f,v=v+t+1>>1,t=v-t,l=l+w+1>>1,w=l-w,J=J+A+1>>1,A=
J-A,E=E+z+1>>1,z=E-z,f=2276*v+3406*l+2048>>12,v=3406*v-2276*l+2048>>12,l=f,f=799*w+4017*t+2048>>12,w=4017*w-799*t+2048>>12,t=f,L[S]=J+l,L[S+7]=J-l,L[S+1]=E+t,L[S+6]=E-t,L[S+2]=z+w,L[S+5]=z-w,L[S+3]=A+v,L[S+4]=A-v);for(C=0;8>C;++C)f=L[C],H=L[C+8],x=L[C+16],w=L[C+24],v=L[C+32],t=L[C+40],q=L[C+48],l=L[C+56],0===(H|x|w|v|t|q|l)?(f=5793*f+8192>>14,f=-2040>f?0:2024<=f?255:f+2056>>4,N[D+C]=f,N[D+C+8]=f,N[D+C+16]=f,N[D+C+24]=f,N[D+C+32]=f,N[D+C+40]=f,N[D+C+48]=f,N[D+C+56]=f):(J=5793*f+2048>>12,E=5793*v+2048>>
12,z=x,A=q,v=2896*(H-l)+2048>>12,l=2896*(H+l)+2048>>12,J=(J+E+1>>1)+4112,E=J-E,f=3784*z+1567*A+2048>>12,z=1567*z-3784*A+2048>>12,A=f,v=v+t+1>>1,t=v-t,l=l+w+1>>1,w=l-w,J=J+A+1>>1,A=J-A,E=E+z+1>>1,z=E-z,f=2276*v+3406*l+2048>>12,v=3406*v-2276*l+2048>>12,l=f,f=799*w+4017*t+2048>>12,w=4017*w-799*t+2048>>12,t=f,f=J+l,l=J-l,H=E+t,q=E-t,x=z+w,t=z-w,w=A+v,v=A-v,f=16>f?0:4080<=f?255:f>>4,H=16>H?0:4080<=H?255:H>>4,x=16>x?0:4080<=x?255:x>>4,w=16>w?0:4080<=w?255:w>>4,v=16>v?0:4080<=v?255:v>>4,t=16>t?0:4080<=t?
255:t>>4,q=16>q?0:4080<=q?255:q>>4,l=16>l?0:4080<=l?255:l>>4,N[D+C]=f,N[D+C+8]=H,N[D+C+16]=x,N[D+C+24]=w,N[D+C+32]=v,N[D+C+40]=t,N[D+C+48]=q,N[D+C+56]=l)}return b.blockData}function k(a,b,e){var g=a.length-1;e=e<b?e:b;if(b>=g)return null;var h=a[b]<<8|a[b+1];if(65472<=h&&65534>=h)return{invalid:null,marker:h,offset:b};for(b=a[e]<<8|a[e+1];!(65472<=b&&65534>=b);){if(++e>=g)return null;b=a[e]<<8|a[e+1]}return{invalid:h.toString(16),marker:b,offset:e}}if(!self||!self.Uint8ClampedArray)return null;var d=
new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);u.prototype={parse:function(a){function b(){var C=a[h]<<8|a[h+1];h+=2;return C}function e(){var C=b();C=h+C-2;var N=k(a,C,h);N&&N.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+N.invalid),C=N.offset);C=a.subarray(h,C);h+=C.length;return C}function g(C){for(var N=Math.ceil(C.samplesPerLine/
8/C.maxH),S=Math.ceil(C.scanLines/8/C.maxV),F=0;F<C.components.length;F++){L=C.components[F];var T=Math.ceil(Math.ceil(C.samplesPerLine/8)*L.h/C.maxH),y=Math.ceil(Math.ceil(C.scanLines/8)*L.v/C.maxV);L.blockData=new Int16Array(64*S*L.v*(N*L.h+1));L.blocksPerLine=T;L.blocksPerColumn=y}C.mcusPerLine=N;C.mcusPerColumn=S}var h=0,c=null,f=null,l=[],q=[],t=[],v=b();if(65496!==v)throw new G("SOI not found");for(v=b();65497!==v;){switch(v){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var w=
e();65504===v&&74===w[0]&&70===w[1]&&73===w[2]&&70===w[3]&&0===w[4]&&(c={version:{major:w[5],minor:w[6]},densityUnits:w[7],xDensity:w[8]<<8|w[9],yDensity:w[10]<<8|w[11],thumbWidth:w[12],thumbHeight:w[13],thumbData:w.subarray(14,14+3*w[12]*w[13])});65518===v&&65===w[0]&&100===w[1]&&111===w[2]&&98===w[3]&&101===w[4]&&(f={version:w[5]<<8|w[6],flags0:w[7]<<8|w[8],flags1:w[9]<<8|w[10],transformCode:w[11]});break;case 65499:v=b()+h-2;for(var x;h<v;){var H=a[h++],A=new Uint16Array(64);if(0===H>>4)for(w=
0;64>w;w++)x=d[w],A[x]=a[h++];else if(1===H>>4)for(w=0;64>w;w++)x=d[w],A[x]=b();else throw new G("DQT - invalid table spec");l[H&15]=A}break;case 65472:case 65473:case 65474:if(z)throw new G("Only single frame JPEGs supported");b();var z={};z.extended=65473===v;z.progressive=65474===v;z.precision=a[h++];z.scanLines=b();z.samplesPerLine=b();z.components=[];z.componentIds={};w=a[h++];for(v=A=H=0;v<w;v++){x=a[h];var E=a[h+1]>>4;var J=a[h+1]&15;H<E&&(H=E);A<J&&(A=J);E=z.components.push({h:E,v:J,quantizationId:a[h+
2],quantizationTable:null});z.componentIds[x]=E-1;h+=3}z.maxH=H;z.maxV=A;g(z);break;case 65476:x=b();for(v=2;v<x;){H=a[h++];A=new Uint8Array(16);for(w=E=0;16>w;w++,h++)E+=A[w]=a[h];J=new Uint8Array(E);for(w=0;w<E;w++,h++)J[w]=a[h];v+=17+E;(0===H>>4?t:q)[H&15]=r(A,J)}break;case 65501:b();var D=b();break;case 65498:b();x=a[h++];w=[];for(v=0;v<x;v++){H=z.componentIds[a[h++]];var L=z.components[H];H=a[h++];L.huffmanTableDC=t[H>>4];L.huffmanTableAC=q[H&15];w.push(L)}v=a[h++];x=a[h++];H=a[h++];v=n(a,h,
z,w,D,v,x,H>>4,H&15);h+=v;break;case 65535:255!==a[h]&&h--;break;default:if(255===a[h-3]&&192<=a[h-2]&&254>=a[h-2])h-=3;else throw new G("unknown marker "+v.toString(16));}v=b()}this.width=z.samplesPerLine;this.height=z.scanLines;this.jfif=c;this.eof=h;this.adobe=f;this.components=[];for(v=0;v<z.components.length;v++){L=z.components[v];if(c=l[L.quantizationId])L.quantizationTable=c;this.components.push({output:m(z,L),scaleX:L.h/z.maxH,scaleY:L.v/z.maxV,blocksPerLine:L.blocksPerLine,blocksPerColumn:L.blocksPerColumn})}this.numComponents=
this.components.length},_getLinearizedBlockData:function(a,b){var e=this.width/a,g=this.height/b,h,c,f=0,l=this.components.length,q=a*b*l,t=new Uint8ClampedArray(q),v=new Uint32Array(a);for(c=0;c<l;c++){var w=this.components[c];var x=w.scaleX*e;var H=w.scaleY*g;f=c;var A=w.output;var z=w.blocksPerLine+1<<3;for(h=0;h<a;h++)w=0|h*x,v[h]=(w&4294967288)<<3|w&7;for(x=0;x<b;x++)for(w=0|x*H,w=z*(w&4294967288)|(w&7)<<3,h=0;h<a;h++)t[f]=A[w+v[h]],f+=l}if(b=this.decodeTransform)for(c=0;c<q;)for(a=w=0;w<l;w++,
c++,a+=2)t[c]=(t[c]*b[a]>>8)+b[a+1];return t},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0===this.colorTransform?!1:!0:1===this.colorTransform?!0:!1},_convertYccToRgb:function(a){for(var b,e,g,h=0,c=a.length;h<c;h+=3)b=a[h],e=a[h+1],g=a[h+2],a[h]=b-179.456+1.402*g,a[h+1]=b+135.459-.344*e-.714*g,a[h+2]=b-226.816+1.772*e;return a},_convertYcckToRgb:function(a){for(var b,e,g,h,c=0,f=0,l=a.length;f<l;f+=4)b=a[f],e=a[f+1],g=a[f+2],h=a[f+3],a[c++]=
-122.67195406894+e*(-6.60635669420364E-5*e+4.37130475926232E-4*g-5.4080610064599E-5*b+4.8449797120281E-4*h-.154362151871126)+g*(-9.57964378445773E-4*g+8.17076911346625E-4*b-.00477271405408747*h+1.53380253221734)+b*(9.61250184130688E-4*b-.00266257332283933*h+.48357088451265)+h*(-3.36197177618394E-4*h+.484791561490776),a[c++]=107.268039397724+e*(2.19927104525741E-5*e-6.40992018297945E-4*g+6.59397001245577E-4*b+4.26105652938837E-4*h-.176491792462875)+g*(-7.78269941513683E-4*g+.00130872261408275*b+7.70482631801132E-4*
h-.151051492775562)+b*(.00126935368114843*b-.00265090189010898*h+.25802910206845)+h*(-3.18913117588328E-4*h-.213742400323665),a[c++]=-20.810012546947+e*(-5.70115196973677E-4*e-2.63409051004589E-5*g+.0020741088115012*b-.00288260236853442*h+.814272968359295)+g*(-1.53496057440975E-5*g-1.32689043961446E-4*b+5.60833691242812E-4*h-.195152027534049)+b*(.00174418132927582*b-.00255243321439347*h+.116935020465145)+h*(-3.43531996510555E-4*h+.24165260232407);return a},_convertYcckToCmyk:function(a){for(var b,
e,g,h=0,c=a.length;h<c;h+=4)b=a[h],e=a[h+1],g=a[h+2],a[h]=434.456-b-1.402*g,a[h+1]=119.541-b+.344*e+.714*g,a[h+2]=481.816-b-1.772*e;return a},_convertCmykToRgb:function(a){for(var b,e,g,h,c=0,f=1/255,l=0,q=a.length;l<q;l+=4)b=a[l]*f,e=a[l+1]*f,g=a[l+2]*f,h=a[l+3]*f,a[c++]=255+b*(-4.387332384609988*b+54.48615194189176*e+18.82290502165302*g+212.25662451639585*h-285.2331026137004)+e*(1.7149763477362134*e-5.6096736904047315*g-17.873870861415444*h-5.497006427196366)+g*(-2.5217340131683033*g-21.248923337353073*
h+17.5119270841813)-h*(21.86122147463605*h+189.48180835922747),a[c++]=255+b*(8.841041422036149*b+60.118027045597366*e+6.871425592049007*g+31.159100130055922*h-79.2970844816548)+e*(-15.310361306967817*e+17.575251261109482*g+131.35250912493976*h-190.9453302588951)+g*(4.444339102852739*g+9.8632861493405*h-24.86741582555878)-h*(20.737325471181034*h+187.80453709719578),a[c++]=255+b*(.8842522430003296*b+8.078677503112928*e+30.89978309703729*g-.23883238689178934*h-14.183576799673286)+e*(10.49593273432072*
e+63.02378494754052*g+50.606957656360734*h-112.23884253719248)+g*(.03296041114873217*g+115.60384449646641*h-193.58209356861505)-h*(22.33816807309886*h+180.12613974708367);return a},getData:function(a,b,e){if(4<this.numComponents)throw new G("Unsupported color mode");a=this._getLinearizedBlockData(a,b);if(1===this.numComponents&&e){e=a.length;b=new Uint8ClampedArray(3*e);for(var g=0,h=0;h<e;h++){var c=a[h];b[g++]=c;b[g++]=c;b[g++]=c}return b}if(3===this.numComponents&&this._isColorConversionNeeded())return this._convertYccToRgb(a);
if(4===this.numComponents){if(this._isColorConversionNeeded())return e?this._convertYcckToRgb(a):this._convertYcckToCmyk(a);if(e)return this._convertCmykToRgb(a)}return a}};return u}()})},"esri/layers/rasterFormats/Png":function(){define(["./Zlib"],function(G){return function(){function u(n){var m,k;this.data=n;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(k=null;;){var d=this.readUInt32();var a=n=void 0;n=[];for(a=0;4>a;++a)n.push(String.fromCharCode(this.data[this.pos++]));
n=n.join("");switch(n){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};break;case "PLTE":this.palette=this.read(d);break;case "fcTL":k&&this.animation.frames.push(k);this.pos+=
4;k={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};n=this.readUInt16();d=this.readUInt16()||100;k.delay=1E3*n/d;k.disposeOp=this.data[this.pos++];k.blendOp=this.data[this.pos++];k.data=[];break;case "IDAT":case "fdAT":"fdAT"===n&&(this.pos+=4,d-=4);n=(null!=k?k.data:void 0)||this.imgData;for(a=0;0<=d?a<d:a>d;0<=d?++a:--a)n.push(this.data[this.pos++]);break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=
this.read(d);d=255-this.transparency.indexed.length;if(0<d)for(n=0;0<=d?n<d:n>d;0<=d?++n:--n)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(d)[0];break;case 2:this.transparency.rgb=this.read(d)}break;case "tEXt":a=this.read(d);d=a.indexOf(0);n=String.fromCharCode.apply(String,a.slice(0,d));this.text[n]=String.fromCharCode.apply(String,a.slice(d+1));break;case "IEND":k&&this.animation.frames.push(k);a:{switch(this.colorType){case 0:case 3:case 4:k=1;break a;
case 2:case 6:k=3;break a}k=void 0}this.colors=k;this.hasAlphaChannel=4===(m=this.colorType)||6===m;m=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*m;a:{switch(this.colors){case 1:m="DeviceGray";break a;case 3:m="DeviceRGB";break a}m=void 0}this.colorSpace=m;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=d}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");}}u.load=function(n,m,k){"function"===typeof m&&(k=m);var d=new XMLHttpRequest;
d.open("GET",n,!0);d.responseType="arraybuffer";d.onload=function(){var a=new Uint8Array(d.response||d.mozResponseArrayBuffer);a=new u(a);"function"===typeof(null!=m?m.getContext:void 0)&&a.render(m);return"function"===typeof k?k(a):void 0};return d.send(null)};u.prototype.read=function(n){var m;var k=[];for(m=0;0<=n?m<n:m>n;0<=n?++m:--m)k.push(this.data[this.pos++]);return k};u.prototype.readUInt32=function(){var n=this.data[this.pos++]<<24;var m=this.data[this.pos++]<<16;var k=this.data[this.pos++]<<
8;var d=this.data[this.pos++];return n|m|k|d};u.prototype.readUInt16=function(){var n=this.data[this.pos++]<<8;var m=this.data[this.pos++];return n|m};u.prototype.decodePixels=function(n){var m,k,d,a,b,e,g,h;null==n&&(n=this.imgData);if(0===n.length)return new Uint8Array(0);n=new G(n);n=n.getBytes();var c=this.pixelBitlength/8;var f=c*this.width;var l=new Uint8Array(f*this.height);var q=n.length;for(k=a=b=0;a<q;){switch(n[a++]){case 0:for(d=m=0;m<f;d=m+=1)l[k++]=n[a++];break;case 1:for(d=e=0;e<f;d=
e+=1){m=n[a++];var t=d<c?0:l[k-c];l[k++]=(m+t)%256}break;case 2:for(d=t=0;t<f;d=t+=1){m=n[a++];var v=(d-d%c)/c;e=b&&l[(b-1)*f+v*c+d%c];l[k++]=(e+m)%256}break;case 3:for(d=h=0;h<f;d=h+=1)m=n[a++],v=(d-d%c)/c,t=d<c?0:l[k-c],e=b&&l[(b-1)*f+v*c+d%c],l[k++]=(m+Math.floor((t+e)/2))%256;break;case 4:for(d=h=0;h<f;d=h+=1){m=n[a++];v=(d-d%c)/c;t=d<c?0:l[k-c];0===b?e=g=0:(e=l[(b-1)*f+v*c+d%c],g=v&&l[(b-1)*f+(v-1)*c+d%c]);var w=t+e-g;d=Math.abs(w-t);v=Math.abs(w-e);w=Math.abs(w-g);t=d<=v&&d<=w?t:v<=w?e:g;l[k++]=
(m+t)%256}break;default:throw Error("Invalid filter algorithm: "+n[a-1]);}b++}return l};u.prototype.decodePalette=function(){var n,m,k,d,a;var b=this.palette;var e=this.transparency.indexed||[];var g=new Uint8Array((e.length||0)+b.length);var h=k=n=m=0;for(d=b.length;k<d;h=k+=3)g[m++]=b[h],g[m++]=b[h+1],g[m++]=b[h+2],g[m++]=null!=(a=e[n++])?a:255;return g};u.prototype.copyToImageData=function(n,m){var k,d;var a=this.colors;var b=null;var e=this.hasAlphaChannel;this.palette.length&&(b=null!=(k=this._decodedPalette)?
k:this._decodedPalette=this.decodePalette(),a=4,e=!0);n=n.data||n;var g=n.length;var h=b||m;k=d=0;if(1===a)for(;k<g;)a=b?4*m[k/4]:d,d=h[a++],n[k++]=d,n[k++]=d,n[k++]=d,n[k++]=e?h[a++]:this.transparency.grayscale&&this.transparency.grayscale===d?0:255,d=a;else for(;k<g;)a=b?4*m[k/4]:d,n[k++]=h[a++],n[k++]=h[a++],n[k++]=h[a++],n[k++]=e?h[a++]:this.transparency.rgb&&this.transparency.rgb[1]===h[a-3]&&this.transparency.rgb[3]===h[a-2]&&this.transparency.rgb[5]===h[a-1]?0:255,d=a};u.prototype.decode=function(){var n=
new Uint8Array(this.width*this.height*4);this.copyToImageData(n,this.decodePixels());return n};var r=function(n){(void 0).clearRect(0,0,n.width,n.height);(void 0).putImageData(n,0,0);n=new Image;n.src=(void 0).toDataURL();return n};u.prototype.decodeFrames=function(n){var m,k;if(this.animation){var d=this.animation.frames;var a=[];var b=m=0;for(k=d.length;m<k;b=++m){b=d[b];var e=n.createImageData(b.width,b.height);var g=this.decodePixels(new Uint8Array(b.data));this.copyToImageData(e,g);b.imageData=
e;a.push(b.image=r(e))}return a}};u.prototype.renderFrame=function(n,m){var k=this.animation.frames;var d=k[m];k=k[m-1];0===m&&n.clearRect(0,0,this.width,this.height);1===(null!=k?k.disposeOp:void 0)?n.clearRect(k.xOffset,k.yOffset,k.width,k.height):2===(null!=k?k.disposeOp:void 0)&&n.putImageData(k.imageData,k.xOffset,k.yOffset);0===d.blendOp&&n.clearRect(d.xOffset,d.yOffset,d.width,d.height);return n.drawImage(d.image,d.xOffset,d.yOffset)};u.prototype.animate=function(n){var m,k=this;var d=0;var a=
this.animation;var b=a.numFrames;var e=a.frames;var g=a.numPlays;return(m=function(){var h=d++%b;var c=e[h];k.renderFrame(n,h);if(1<b&&d/b<g)return k.animation._timeout=setTimeout(m,c.delay)})()};u.prototype.stopAnimation=function(){var n;return clearTimeout(null!=(n=this.animation)?n._timeout:void 0)};u.prototype.render=function(n){n._png&&n._png.stopAnimation();n._png=this;n.width=this.width;n.height=this.height;n=n.getContext("2d");if(this.animation)return this.decodeFrames(n),this.animate(n);
var m=n.createImageData(this.width,this.height);this.copyToImageData(m,this.decodePixels());return n.putImageData(m,0,0)};return u}()})},"esri/layers/rasterFormats/Raw":function(){define([],function(){return{decodeBIP:function(G,u){var r=u.pixelType,n=u.bandCount,m=[],k=u.width*u.height,d=this.getBandCount(G,u);n=n||d;var a=G.byteLength-G.byteLength%(k*this._getPixelLength(r)),b=new r(G,0,k*d),e,g,h;for(e=0;e<n;e++){var c=new r(k);for(g=0;g<k;g++)c[g]=b[g*d+e];m.push(c)}a<G.byteLength-1&&(h=this._decodeMask(G.slice(a),
u));return{pixels:m,maskData:h}},decodeBSQ:function(G,u){var r=u.pixelType,n=u.bandCount;if(void 0===n||null===n)n=this.getBandCount(G,u);var m=[],k=u.width*u.height,d=k*n,a=G.byteLength-G.byteLength%(k*this._getPixelLength(r));r=new r(G,0,d);var b;for(d=0;d<n;d++)m.push(r.subarray(d*k,(d+1)*k));a<G.byteLength-1&&(b=this._decodeMask(G.slice(a),u));return{pixels:m,maskData:b}},getBandCount:function(G,u){return Math.floor(G.byteLength/(u.width*u.height*this._getPixelLength(u.pixelType)))},_getPixelLength:function(G){var u=
1;switch(G){case Uint8Array:case Int8Array:case Uint8ClampedArray:u=1;break;case Uint16Array:case Int16Array:u=2;break;case Uint32Array:case Int32Array:case Float32Array:u=4;break;case Float64Array:u=8}return u},_decodeMask:function(G,u){var r=u.width*u.height;if(8*G.byteLength<r)return null;G=new Uint8Array(G,0,Math.ceil(r/8));u=new Uint8Array(u.width*u.height);var n=0,m=0,k=0,d=0;for(k=0;k<G.length-1;k++)for(m=G[k],d=7;0<=d;d--)u[n++]=m>>d&1;for(d=7;n<r-1;)m=G[G.length-1],u[n++]=m>>d&1,d--;return u}}})},
"esri/layers/rasterFormats/TiffDecoder":function(){define(["./Jpg","./Zlib"],function(G,u){var r=function(){var d=new ArrayBuffer(4),a=new Uint8Array(d);d=new Uint32Array(d);a[0]=1;a[1]=2;a[2]=3;a[3]=4;return 67305985===d[0]},n=function(){var d=[];d[254]="NEWSUBFILETYPE";d[255]="SUBFILETYPE";d[256]="IMAGEWIDTH";d[257]="IMAGELENGTH";d[258]="BITSPERSAMPLE";d[259]="COMPRESSION";d[262]="PHOTOMETRICINTERPRETATION";d[263]="THRESHHOLDING";d[264]="CELLWIDTH";d[265]="CELLLENGTH";d[266]="FILLORDER";d[269]=
"DOCUMENTNAME";d[270]="IMAGEDESCRIPTION";d[271]="MAKE";d[272]="MODEL";d[273]="STRIPOFFSETS";d[274]="ORIENTATION";d[277]="SAMPLESPERPIXEL";d[278]="ROWSPERSTRIP";d[279]="STRIPBYTECOUNTS";d[280]="MINSAMPLEVALUE";d[281]="MAXSAMPLEVALUE";d[282]="XRESOLUTION";d[283]="YRESOLUTION";d[284]="PLANARCONFIGURATION";d[285]="PAGENAME";d[286]="XPOSITION";d[287]="YPOSITION";d[288]="FREEOFFSETS";d[289]="FREEBYTECOUNTS";d[290]="GRAYRESPONSEUNIT";d[291]="GRAYRESPONSECURVE";d[292]="T4OPTIONS";d[293]="T6OPTIONS";d[296]=
"RESOLUTIONUNIT";d[297]="PAGENUMBER";d[300]="COLORRESPONSEUNIT";d[301]="TRANSFERFUNCTION";d[305]="SOFTWARE";d[306]="DATETIME";d[315]="ARTIST";d[316]="HOSTCOMPUTER";d[317]="PREDICTOR";d[318]="WHITEPOINT";d[319]="PRIMARYCHROMATICITIES";d[320]="COLORMAP";d[321]="HALFTONEHINTS";d[322]="TILEWIDTH";d[323]="TILELENGTH";d[324]="TILEOFFSETS";d[325]="TILEBYTECOUNTS";d[326]="BADFAXLINES";d[327]="CLEANFAXDATA";d[328]="CONSECUTIVEBADFAXLINES";d[330]="SUBIFD";d[332]="INKSET";d[333]="INKNAMES";d[334]="NUMBEROFINKS";
d[336]="DOTRANGE";d[337]="TARGETPRINTER";d[338]="EXTRASAMPLES";d[339]="SAMPLEFORMAT";d[340]="SMINSAMPLEVALUE";d[341]="SMAXSAMPLEVALUE";d[342]="TRANSFERRANGE";d[347]="JPEGTABLES";d[512]="JPEGPROC";d[513]="JPEGIFOFFSET";d[514]="JPEGIFBYTECOUNT";d[515]="JPEGRESTARTINTERVAL";d[517]="JPEGLOSSLESSPREDICTORS";d[518]="JPEGPOINTTRANSFORM";d[519]="JPEGQTABLES";d[520]="JPEGDCTABLES";d[521]="JPEGACTABLES";d[529]="YCBCRCOEFFICIENTS";d[530]="YCBCRSUBSAMPLING";d[531]="YCBCRPOSITIONING";d[532]="REFERENCEBLACKWHITE";
d[33550]="GEOPIXELSCALE";d[33922]="GEOTIEPOINTS";d[33432]="COPYRIGHT";d[42112]="GDAL_METADATA";d[42113]="GDAL_NODATA";d[50844]="RPCCOEFFICIENT";d[34735]="GEOKEYDIRECTORY";d[34736]="GEODOUBLEPARAMS";d[34737]="GEOASCIIPARAMS";return d}(),m=[0,1,1,2,4,8,1,1,2,4,8,4,8],k=function(d,a){var b="UNKNOWN";3===d?b="F32":1===d?8>=a?b="U8":16>=a?b="U16":32>=a&&(b="U32"):2===d&&(8>=a?b="S8":16>=a?b="S16":32>=a&&(b="S32"));return b};return{decode:function(d){var a=new DataView(d,0,8),b=a.getUint16(0,!1);if(18761===
b)var e=!0;else if(19789===b)e=!1;else throw"unexpected endianess byte";if(42!==a.getUint16(2,e))throw"unexpected tiff identifier";var g=a.getUint32(4,e);var h=e;var c,f;var l=g;for(var q=[];l;){var t=(new DataView(d,l,2)).getUint16(0,h);var v=l+2;l=(new DataView(d,v+12*t,4)).getUint32(0,h);var w={};for(c=0;c<t;c++){var x=new DataView(d,v,12);var H=x.getUint16(0,h);var A=x.getUint16(2,h);var z=x.getUint32(4,h);var E=x.getUint32(8,h);v+=12;if(!(7===A||12<A)){var J=f={fieldTag:H,fieldType:A,fieldValueCount:z,
fieldValueOffset:E},D=void 0,L=void 0,C=d,N=h,S=[],F=f.fieldType,T=f.fieldValueCount,y=f.fieldValueOffset,B=y,I=m[F],P=8*I,X=T*I,Y=T*m[F]*8;if(32>=Y)if(N||(y>>>=32-Y),1===T)S=[y];else for(D=0;D<T;D++)S.push(y<<P*D>>>32-P);else for(B=y;B<y+X;B+=I){switch(F){case 1:L=(new DataView(C,B,1)).getUint8(0);break;case 2:L=(new DataView(C,B,1)).getUint8(0);break;case 3:L=(new DataView(C,B,2)).getUint16(0,N);break;case 4:L=(new DataView(C,B,4)).getUint32(0,N);break;case 5:L=(new DataView(C,B,4)).getUint32(0,
N)/(new DataView(C,B+4,4)).getUint32(0,N);break;case 6:L=(new DataView(C,B,1)).getInt8(0);break;case 8:L=(new DataView(C,B,2)).getInt16(0,N);break;case 9:L=(new DataView(C,B,4)).getInt32(0,N);break;case 10:L=(new DataView(C,B,4)).getInt32(0,N)/(new DataView(C,B+4,4)).getInt32(0,N);break;case 11:L=(new DataView(C,B,4)).getFloat32(0,N);break;case 12:L=(new DataView(C,B,8)).getFloat64(0,N);break;case 7:L=null;break;default:L=null}S.push(L)}if(2===F){var aa="",Z=S;S=[];for(D=0;D<Z.length;D++)0===Z[D]&&
""!==aa?(S.push(aa),aa=""):aa+=String.fromCharCode(Z[D]);""===aa&&0!==S.length||S.push(aa)}J.fieldValues=S;var fa=w,K=n[H];void 0===K&&(K="unknown"+H);fa[K]={type:A,values:f.fieldValues}}}q.push(w)}if(0===q.length)throw"no valid image file directory";var R,U=q[0],ba=void 0===U.GDAL_NODATA||null===U.GDAL_NODATA?null:parseFloat(U.GDAL_NODATA.values[0]);if(U.TILEOFFSETS){var Q=r()===h,ea=U.TILEOFFSETS?U.TILEOFFSETS.values:void 0;if(void 0===ea)var la=void 0;else{var ma=U.TILEBYTECOUNTS.values,M=U.TILEWIDTH.values[0],
W=U.TILELENGTH.values[0],da=U.IMAGEWIDTH.values[0],ja=U.IMAGELENGTH.values[0],ia=da*ja,pa=U.BITSPERSAMPLE.values[0],oa=U.SAMPLESPERPIXEL.values[0],ra=U.SAMPLEFORMAT?U.SAMPLEFORMAT.values[0]:1,wa=k(ra,pa);if(1!==(U.PLANARCONFIGURATION?U.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),"can only handle PLANARCONFIGURATION\x3d1";var va=U.COMPRESSION?U.COMPRESSION.values[0]:1;if(1!==va&&6!==va&&8!==va&&32946!==va)throw console.log("this compression is not supported at this moment"),
"this compression is not supported at this moment";if(3<ra)la=void 0;else{if(3===ra){var ya=new Float32Array(ia*oa);var ua=Float32Array}else 1===ra?8>=pa?(ya=new Uint8Array(ia*oa),ua=Uint8Array):16>=pa?(ya=new Uint16Array(ia*oa),ua=Uint16Array):32>=pa&&(ya=new Uint32Array(ia*oa),ua=Uint32Array):2===ra&&(8>=pa?(ya=new Int8Array(ia*oa),ua=Int8Array):16>=pa?(ya=new Int16Array(ia*oa),ua=Int16Array):32>=pa&&(ya=new Int32Array(ia*oa),ua=Int32Array));var Aa,Ga,Ba,Ea,Ra,Ta=Math.ceil(da/M);if(0===pa%8)for(Aa=
0;Aa<ea.length;Aa++){var Za=Math.floor(Aa/Ta)*W;var Ya=Aa%Ta*M;var cb=(Za*da+Ya)*oa;if("U8"===wa||"S8"===wa||Q)if(8===va||32946===va){var O=new Uint8Array(d,ea[Aa],ma[Aa]);var V=new u(O);var ca=V.getBytes();var ka=new ArrayBuffer(ca.length);O=new Uint8Array(ka);O.set(ca);O.length!==M*W*oa*pa/8&&console.log("tile byte counts is different than expected")}else if(6===va){O=new Uint8Array(d,ea[Aa],ma[Aa]);var ha=new G;ha.parse(O);var na=ha.getData(ha.width,ha.height);ka=new ArrayBuffer(na.length);O=new Uint8Array(ka);
O.set(na)}else 1===va&&(ma[Aa]!==M*W*oa*pa/8&&console.log("tile byte counts is different than expected"),ka=d.slice(ea[Aa],ea[Aa]+ma[Aa]));else{if(8===va||32946===va){O=new Uint8Array(d,ea[Aa],ma[Aa]);V=new u(O);O=V.getBytes();ka=new ArrayBuffer(O.length);var qa=new Uint8Array(ka);O.length!==M*W*oa*pa/8&&console.log("tile byte counts is different than expected")}else 1===va&&(ma[Aa]!==M*W*oa*pa/8&&console.log("tile byte counts is different than expected"),ka=new ArrayBuffer(ma[Aa]),O=new Uint8Array(d,
ea[Aa],ma[Aa]),qa=new Uint8Array(ka));switch(wa){case "U16":case "S16":for(Ba=0;Ba<O.length;Ba+=2)qa[Ba]=O[Ba+1],qa[Ba+1]=O[Ba];break;case "U32":case "S32":case "F32":for(Ba=0;Ba<O.length;Ba+=4)qa[Ba]=O[Ba+3],qa[Ba+1]=O[Ba+2],qa[Ba+2]=O[Ba+1],qa[Ba+3]=O[Ba]}}var sa=new ua(ka);var ta=0;var xa=cb;var za=Math.min(M,da-Ya);var Da=Math.min(W,ja-Za);for(Ea=0;Ea<Da;Ea++)for(xa=cb+Ea*da*oa,ta=Ea*M*oa,Ra=0;Ra<za*oa;Ra++,xa++,ta++)ya[xa]=sa[ta]}var Ca={width:da,height:ja,pixelType:wa};if(1===oa)Ca.pixels=[ya];
else for(Ca.pixels=[],Aa=0;Aa<oa;Aa++){var Ha=new ua(ia);for(Ga=0;Ga<ia;Ga++)Ha[Ga]=ya[Ga*oa+Aa];Ca.pixels.push(Ha)}la=Ca}}}else if(U.STRIPOFFSETS){var Ia=r()===h,Ma=U.STRIPOFFSETS?U.STRIPOFFSETS.values:void 0;if(void 0===Ma)la=void 0;else{var Fa=U.STRIPBYTECOUNTS.values,Qa=U.ROWSPERSTRIP.values,Oa=U.IMAGEWIDTH.values[0],Sa=U.IMAGELENGTH.values[0],Pa=Oa*Sa,Ka=U.BITSPERSAMPLE.values[0],La=U.SAMPLESPERPIXEL.values[0],Wa=U.SAMPLEFORMAT?U.SAMPLEFORMAT.values[0]:1,ab=k(Wa,Ka);if(1!==(U.PLANARCONFIGURATION?
U.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),"can only handle PLANARCONFIGURATION\x3d1";var bb=U.COMPRESSION?U.COMPRESSION.values[0]:1;if(1!==bb&&6!==bb&&8!==bb&&32946!==bb)throw console.log("compressed tiff is not supported at this moment"),"compressed tiff is not supported at this moment";if(3<Wa)la=void 0;else{if(3===Wa){var eb=new Float32Array(Pa*La);var fb=Float32Array}else 1===Wa?8>=Ka?(eb=new Uint8Array(Pa*La),fb=Uint8Array):16>=Ka?(eb=new Uint16Array(Pa*
La),fb=Uint16Array):32>=Ka&&(eb=new Uint32Array(Pa*La),fb=Uint32Array):2===Wa&&(8>=Ka?(eb=new Int8Array(Pa*La),fb=Int8Array):16>=Ka?(eb=new Int16Array(Pa*La),fb=Int16Array):32>=Ka&&(eb=new Int32Array(Oa*Sa*La),fb=Int32Array));var Va,gb,$a,hb=Qa;if(0===Ka%8)for(Va=0;Va<Ma.length;Va++){var Na=Va*Qa*Oa*La;hb=(Va+1)*Qa>Sa?Sa-Va*Qa:Qa;if("U8"===ab||"S8"===ab||Ia)if(8===bb||32946===bb){var Ja=new Uint8Array(d,Ma[Va],Fa[Va]);var Ua=new u(Ja);var Xa=Ua.getBytes();var db=new ArrayBuffer(Xa.length);Ja=new Uint8Array(db);
Ja.set(Xa);Ja.length!==hb*Oa*La*Ka/8&&console.log("strip byte counts is different than expected")}else if(6===bb){Ja=new Uint8Array(d,Ma[Va],Fa[Va]);var jb=new G;jb.parse(Ja);var lb=jb.getData(jb.width,jb.height);db=new ArrayBuffer(lb.length);Ja=new Uint8Array(db);Ja.set(lb)}else 1===bb&&(Fa[Va]!==hb*Oa*La*Ka/8&&console.log("strip byte counts is different than expected"),db=d.slice(Ma[Va],Ma[Va]+Fa[Va]));else{if(6===bb||8===bb||32946===bb){Ja=new Uint8Array(d,Ma[Va],Fa[Va]);Ua=new u(Ja);Ja=Ua.getBytes();
db=new ArrayBuffer(Ja.length);var ib=new Uint8Array(db);Ja.length!==hb*Oa*La*Ka/8&&console.log("strip byte counts is different than expected")}else 1===bb&&(Fa[Va]!==hb*Oa*La*Ka/8&&console.log("strip byte counts is different than expected"),db=new ArrayBuffer(Fa[Va]),Ja=new Uint8Array(d,Ma[Va],Fa[Va]),ib=new Uint8Array(db));switch(ab){case "U16":case "S16":for($a=0;$a<Ja.length;$a+=2)ib[$a]=Ja[$a+1],ib[$a+1]=Ja[$a];break;case "U32":case "S32":case "F32":for($a=0;$a<Ja.length;$a+=4)ib[$a]=Ja[$a+3],
ib[$a+1]=Ja[$a+2],ib[$a+2]=Ja[$a+1],ib[$a+3]=Ja[$a]}}var nb=new fb(db);eb.set(nb,Na)}var kb={width:Oa,height:Sa,pixelType:ab};if(1===La)kb.pixels=[eb];else for(kb.pixels=[],Va=0;Va<La;Va++){var mb=new fb(Pa);for(gb=0;gb<Pa;gb++)mb[gb]=eb[gb*La+Va];kb.pixels.push(mb)}la=kb}}}if(null!==ba){la.maskData=new Uint8Array(la.width*la.height);if(1E24<Math.abs(ba))for(R=0;R<la.width*la.height;R++)la.maskData[R]=1E-6>Math.abs((la.pixels[0][R]-ba)/ba)?0:1;else for(R=0;R<la.width*la.height;R++)la.maskData[R]=
la.pixels[0][R]===ba?0:1;la.noDataValue=ba}return la}}})},"esri/layers/rasterLib/tile/RasterHandler":function(){define("require exports module dojo/Deferred dojo/promise/all ../../PixelBlock ../../vectorTiles/core/workers ../../vectorTiles/core/promiseUtils ../../vectorTiles/core/requireUtils ../../vectorTiles/request ../../rasterLib/function/rasterFunctionHelper ../../rasterLib/renderer/rasterRendererHelper".split(" "),function(G,u,r,n,m,k,d,a,b,e,g,h){function c(f){var l=new n;m(f).then(function(q){l.resolve()});
return l.promise}return function(){function f(l){this.customModules=l&&l.customModules}f.prototype.destroy=function(){this.stop();this.customModules=this.rasterLayer=null};f.prototype.start=function(){this.stop();var l=new n,q=0,t=this.customModules?this.customModules.length+1:1,v=b.getAbsMid("esri/layers/rasterLib/tile/RasterWorker",G,r),w=d.open(v,{client:this}).then(function(x){this._connection=x;q++;q===t&&(this._connected=!0,l.resolve())}.bind(this));this._openDL=[w];this.customModules&&this.customModules.forEach(function(x){w=
d.open(x,{client:this}).then(function(H){q++;q===t&&(this._connected=!0,l.resolve())});this._openDL.push(w);console.log(x)}.bind(this));return this._connectionPromise=l.promise};f.prototype.stop=function(){this._openDL?this._openDL.forEach(function(l){l.isFulfilled()||l.cancel()}.bind(this)):this._connectionPromise&&!this._connectionPromise.isFulfilled()&&this._connectionPromise.cancel();this._connection&&(this._connection.close(),this._connection=null)};f.prototype.decode=function(l){if(!this._connectionPromise.isFulfilled()||
!this._connection)return a.reject(Error("no connection"));var q={id:null};return this._connection.invoke("decode",l,[],q).then(function(t){t.targetWorker=q;return t})};f.prototype.process=function(l){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var q={id:null};l.layerId=this.rasterLayer.layerId;var t=new n;this._connection.invoke("process",l,[],q).then(function(v){v.targetWorker=q;v.src?Object.keys(v.src).forEach(function(w){v.src[w].pixelBlock=
new k(v.src[w].pixelBlock)}):v.src=null;v.pixelBlock&&(v.pixelBlock=new k(v.pixelBlock));t.resolve(v)});return t.promise};f.prototype.render=function(l){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));var q={id:null};l.layerId=this.rasterLayer.layerId;return this._connection.invoke("render",l,[],q).then(function(t){t.targetWorker=q;t.pixelBlock=t.pixelBlock?new k(t.pixelBlock):null;return t})};f.prototype.setLayer=function(l){if(!this._connectionPromise.isFulfilled()||
!this._connection)return a.reject(Error("no connection"));this.rasterLayer=l;l=this._connection.broadcast("setLayer",l,[],{id:null});return c(l)};f.prototype.setRasterFunction=function(l){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));l=this._connection.broadcast("setRasterFunction",l,[],{id:null});return c(l)};f.prototype.setRasterRenderer=function(l){if(!this._connectionPromise.isFulfilled()||!this._connection)return a.reject(Error("no connection"));
l=this._connection.broadcast("setRasterRenderer",l,[],{id:null});return c(l)};return f}()})},"esri/layers/vectorTiles/core/workers":function(){define(["require","exports","./workers/workers"],function(G,u,r){Object.defineProperty(u,"__esModule",{value:!0});for(var n in r)u.hasOwnProperty(n)||(u[n]=r[n])})},"esri/layers/vectorTiles/core/workers/workers":function(){define("require exports dojo/sniff dojo/promise/all ../Logger ../promiseUtils ./Connection ./RemoteClient ./WorkerOwner".split(" "),function(G,
u,r,n,m,k,d,a,b){function e(){if(q)return q;for(var t=g+h,v=[],w=function(H){var A=b.create(H).then(function(z){return l[H]=z});v.push(A)},x=0;x<t;x++)w(x);return q=n(v).then(function(){})}Object.defineProperty(u,"__esModule",{value:!0});u.Connection=d;u.RemoteClient=a;(d=navigator.hardwareConcurrency)||(d=r("safari")&&r("mac")||r("trident")?8:2);var g=r("esri-workers-debug")?1:Math.max(1,Math.ceil(d/2)),h=r("esri-workers-debug")?1:Math.max(1,Math.floor(d/2)),c=m.getLogger("esri.core.workers"),f=
0,l=[];u.initialize=function(){e()};u.open=function(t,v,w){void 0===v&&(v={});if(Array.isArray(t))return new u.Connection(t.map(function(A){return new u.RemoteClient(A,v.client)}));if("string"!==typeof t){c.warn("workers-open:signature-deprecated","DEPRECATED: workers.open() changed signature.");var x=t;t=v;v={client:x,strategy:w?"dedicated":"distributed"}}var H=v.strategy||"distributed";return"local"===H?k.create(function(A){G([t],function(z){A(u.RemoteClient.connect(z))})}).then(function(A){return new u.Connection([new u.RemoteClient(A,
v.client)])}):e().then(function(){if("dedicated"===H){var A=g+f++;f%=h;return l[A].open(t).then(function(z){return new u.Connection([new u.RemoteClient(z,v.client)])})}return k.all(l.map(function(z){return z.open(t)})).then(function(z){return new u.Connection(z.map(function(E){return new u.RemoteClient(E,v.client)}))})})};u.terminate=function(){for(var t=0;t<l.length;t++)l[t]&&l[t].terminate();l.length=0};var q})},"esri/layers/vectorTiles/core/Logger":function(){define(["require","exports","dojo/has"],
function(G,u,r){var n={info:0,warn:1,error:2};G=function(){function m(k){void 0===k&&(k={});this.module=k.module||"";this.writer=k.writer||null;this.level=k.level||null;null!=k.enabled&&(this.enabled=!!k.enabled);m._loggers[this.module]=this;k=this.module.lastIndexOf(".");-1!==k&&(this.parent=m.getLogger(this.module.slice(0,k)))}m.prototype.log=function(k){for(var d=[],a=1;a<arguments.length;a++)d[a-1]=arguments[a];this._isEnabled()&&this._matchLevel(k)&&(a=this._inheritedWriter())&&a.apply(void 0,
[k,this.module].concat(d))};m.prototype.error=function(){for(var k=[],d=0;d<arguments.length;d++)k[d]=arguments[d];this.log.apply(this,["error"].concat(k))};m.prototype.warn=function(){for(var k=[],d=0;d<arguments.length;d++)k[d]=arguments[d];this.log.apply(this,["warn"].concat(k))};m.prototype.info=function(){for(var k=[],d=0;d<arguments.length;d++)k[d]=arguments[d];this.log.apply(this,["info"].concat(k))};m.prototype.getLogger=function(k){return m.getLogger(this.module+"."+k)};m.getLogger=function(k){var d=
m._loggers[k];d||(d=new m({module:k}));return d};m.prototype._parentWithMember=function(k,d){for(var a=this;a&&null==a[k];)a=a.parent;return a?a[k]:d};m.prototype._inheritedWriter=function(){return this._parentWithMember("writer",this._consoleWriter)};m.prototype._consoleWriter=function(k,d){for(var a=[],b=2;b<arguments.length;b++)a[b-2]=arguments[b];console[k].apply(console,["["+d+"]"].concat(a))};m.prototype._matchLevel=function(k){return n[this._parentWithMember("level","error")]<=n[k]};m.prototype._isEnabled=
function(){return this._parentWithMember("enabled",!0)};m._loggers={};return m}();u=G.getLogger("esri");r("dojo-debug-messages")?u.level="info":u.level="warn";return G})},"esri/layers/vectorTiles/core/promiseUtils":function(){define("require exports dojo/Deferred dojo/when dojo/promise/all ./Error".split(" "),function(G,u,r,n,m,k){function d(a){if(a){if("function"!==typeof a.forEach){var b=Object.keys(a),e=b.map(function(f){return a[f]});return d(e).then(function(f){var l={};b.forEach(function(q,
t){return l[q]=f[t]});return l})}var g=new r,h=[],c=a.length;0===c&&g.resolve(h);a.forEach(function(f){var l={promise:f};h.push(l);f.then(function(q){l.value=q}).catch(function(q){l.error=q}).then(function(){--c;0===c&&g.resolve(h)})});return g.promise}}Object.defineProperty(u,"__esModule",{value:!0});u.all=function(a){return m(a)};u.filter=function(a,b){var e=a.slice();return m(a.map(function(g,h){return b(g,h)})).then(function(g){return e.filter(function(h,c){return g[c]})})};u.eachAlways=d;u.create=
function(a,b){var e=new r(b);a(function(g){void 0===g&&(g=null);return n(g).then(e.resolve)},e.reject);return e.promise};u.reject=function(a){var b=new r;b.reject(a);return b.promise};u.resolve=function(a){void 0===a&&(a=null);var b=new r;b.resolve(a);return b.promise};u.after=function(a,b){void 0===b&&(b=null);var e=0,g=new r(function(){e&&(clearTimeout(e),e=0)});e=setTimeout(function(){g.resolve(b)},a);return g.promise};u.timeout=function(a,b,e){var g=0,h=new r(a.cancel);a.then(function(c){h.isFulfilled()||
(h.resolve(c),g&&(clearTimeout(g),g=0))});a.catch(function(c){h.isFulfilled()||(h.reject(c),g&&(clearTimeout(g),g=0))});g=setTimeout(function(){var c=e||new k("promiseUtils:timeout","The wrapped promise did not resolve within "+b+" ms");h.reject(c)},b);return h.promise};u.wrapCallback=function(a){var b=!1,e=new r(function(){return b=!0});a(function(g){b||e.resolve(g)});return e.promise};u.isThenable=function(a){return a&&"function"===typeof a.then};u.when=function(a){return n(a)}})},"esri/layers/vectorTiles/core/Error":function(){define(["require",
"exports","./tsSupport/extendsHelper","./lang","./Message"],function(G,u,r,n,m){G=function(k){function d(a,b,e){var g=k.call(this,a,b,e)||this;return g instanceof d?g:new d(a,b,e)}r(d,k);d.prototype.toJSON=function(){return{name:this.name,message:this.message,details:n.clone(this.details),dojoType:this.dojoType}};d.fromJSON=function(a){var b=new d(a.name,a.message,a.details);null!=a.dojoType&&(b.dojoType=a.dojoType);return b};return d}(m);G.prototype.type="error";return G})},"esri/layers/vectorTiles/core/tsSupport/extendsHelper":function(){define([],
function(){return function(){var G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,r){u.__proto__=r}||function(u,r){for(var n in r)r.hasOwnProperty(n)&&(u[n]=r[n])};return function(u,r){function n(){this.constructor=u}G(u,r);u.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}()})},"esri/layers/vectorTiles/core/lang":function(){define("dojo/_base/kernel dojo/_base/lang dojo/date dojo/number dojo/date/locale dojo/i18n!../nls/common".split(" "),function(G,u,r,n,
m,k){function d(f){return void 0!==f&&null!==f}function a(f){return d(f)?f:""}function b(f,l,q){var t=q.match(/([^\(]+)(\([^\)]+\))?/i),v=u.trim(t[1]);q=l[f];t=JSON.parse((t[2]?u.trim(t[2]):"{}").replace(/^\(/,"{").replace(/\)$/,"}").replace(/([{,])\s*([0-9a-zA-Z_]+)\s*:/gi,'$1"$2":').replace(/"\s*:\s*'/gi,'":"').replace(/'\s*(,|\})/gi,'"$1'));var w=t.utcOffset;if(-1===h.indexOf(v))v=u.getObject(v),u.isFunction(v)&&(q=v(q,f,l,t));else if("number"===typeof q||"string"===typeof q&&q&&!isNaN(Number(q)))switch(q=
Number(q),v){case "NumberFormat":f=u.mixin({},t);l=parseFloat(f.places);if(isNaN(l)||0>l)f.places=Infinity;return n.format(q,f);case "DateString":q=new Date(q);if(t.local||t.systemLocale)return t.systemLocale?q.toLocaleDateString()+(t.hideTime?"":" "+q.toLocaleTimeString()):q.toDateString()+(t.hideTime?"":" "+q.toTimeString());q=q.toUTCString();t.hideTime&&(q=q.replace(/\s+\d\d:\d\d:\d\d\s+(utc|gmt)/i,""));return q;case "DateFormat":return q=new Date(q),d(w)&&(q=r.add(q,"minute",q.getTimezoneOffset()-
w)),m.format(q,t)}return a(q)}function e(f,l){var q;if(l)for(q in f)f.hasOwnProperty(q)&&(void 0===f[q]?delete f[q]:f[q]instanceof Object&&e(f[q],!0));else for(q in f)f.hasOwnProperty(q)&&void 0===f[q]&&delete f[q];return f}function g(f){if(!f||"object"!=typeof f||u.isFunction(f))return f;if(f instanceof Int8Array||f instanceof Uint8Array||f instanceof Uint8ClampedArray||f instanceof Int16Array||f instanceof Int32Array||f instanceof Uint16Array||f instanceof Uint32Array||f instanceof Float32Array||
f instanceof Float64Array||f instanceof Date)return new f.constructor(f);if(f instanceof ArrayBuffer)return f.slice(0,f.byteLength);if("function"===typeof f.clone)f=f.clone();else if("function"===typeof f.map&&"function"===typeof f.forEach)f=f.map(g);else if("function"===typeof f.notifyChange&&"function"===typeof f.watch)f=f.clone();else{var l={},q,t={};for(q in f){var v=f[q];var w=!(q in t)||t[q]!==v;if(!(q in l)||l[q]!==v&&w)l[q]=g?g(v):v}f=l}return f}var h=["NumberFormat","DateString","DateFormat"],
c=/<\/?[^>]+>/g;return{equals:function(f,l){return f===l||"number"===typeof f&&isNaN(f)&&"number"===typeof l&&isNaN(l)||u.isFunction((f||{}).getTime)&&u.isFunction((l||{}).getTime)&&f.getTime()==l.getTime()||u.isFunction((f||{}).equals)&&f.equals(l)||u.isFunction((l||{}).equals)&&l.equals(f)||!1},mixin:u.mixin,valueOf:function(f,l){for(var q in f)if(f[q]==l)return q;return null},stripTags:function(f){if(f){var l=typeof f;if("string"===l)f=f.replace(c,"");else if("object"===l)for(var q in f)(l=f[q])&&
"string"===typeof l&&(l=l.replace(c,"")),f[q]=l}return f},substitute:function(f,l,q){if(d(q))if(u.isObject(q)){var t=q.first;var v=q.dateFormat;var w=q.numberFormat}else t=q;if(l&&"{*}"!==l)return u.replace(l,u.hitch({obj:f},function(H,A){H=A.split(":");return 1<H.length?(A=H[0],H.shift(),b(A,this.obj,H.join(":"))):v&&-1!==(v.properties||[]).indexOf(A)?b(A,this.obj,v.formatter||"DateString"):w&&-1!==(w.properties||[]).indexOf(A)?b(A,this.obj,w.formatter||"NumberFormat"):a(this.obj[A])}));l=[];var x;
l.push('\x3ctable class\x3d"esri-widget__table" summary\x3d"'+k.fieldsSummary+'"\x3e\x3ctbody\x3e');for(x in f)if(q=f[x],v&&-1!==(v.properties||[]).indexOf(x)?q=b(x,f,v.formatter||"DateString"):w&&-1!==(w.properties||[]).indexOf(x)&&(q=b(x,f,w.formatter||"NumberFormat")),l.push("\x3ctr\x3e\x3cth\x3e"+x+"\x3c/th\x3e\x3ctd\x3e"+a(q)+"\x3c/td\x3e\x3c/tr\x3e"),t)break;l.push("\x3c/tbody\x3e\x3c/table\x3e");return l.join("")},filter:function(f,l,q){l=[u.isString(f)?f.split(""):f,q||G.global,u.isString(l)?
new Function("item","index","array",l):l];q={};var t;f=l[0];for(t in f)l[2].call(l[t],f[t],t,f)&&(q[t]=f[t]);return q},startsWith:function(f,l,q){q=q||0;return f.indexOf(l,q)===q},endsWith:function(f,l,q){if("number"!==typeof q||!isFinite(q)||Math.floor(q)!==q||q>f.length)q=f.length;q-=l.length;f=f.indexOf(l,q);return-1!==f&&f===q},isDefined:d,fixJson:e,clone:g}})},"esri/layers/vectorTiles/core/Message":function(){define(["require","exports","dojo/string"],function(G,u,r){return function(){function n(m,
k,d){this instanceof n&&(this.name=m,this.message=k&&r.substitute(k,d,function(a){return null==a?"":a})||"",this.details=d)}n.prototype.toString=function(){return"["+this.name+"]: "+this.message};return n}()})},"esri/layers/vectorTiles/core/workers/Connection":function(){define(["require","exports","../promiseUtils"],function(G,u,r){return function(){function n(m){this._clientIdx=0;this._clients=m}n.prototype.broadcast=function(m,k,d){for(var a=[],b=0,e=this._clients;b<e.length;b++)a.push(e[b].invoke(m,
k,d));return a};n.prototype.close=function(){for(var m=0,k=this._clients;m<k.length;m++)k[m].close();this._clients=[]};n.prototype.invoke=function(m,k,d,a){var b=a&&a.client;if(!this._clients||!this._clients.length)return r.reject(Error("Connection closed"));null!=b&&-1!==this._clients.indexOf(b)||this._clients.some(function(e){return e.isBusy()?!1:(b=e,!0)})||(this._clientIdx=(this._clientIdx+1)%this._clients.length,b=this._clients[this._clientIdx]);m=b.invoke(m,k,d);a&&(a.client=b);return m};n.prototype.openPorts=
function(){return r.all(this._clients.map(function(m){return m.openPort()}))};return n}()})},"esri/layers/vectorTiles/core/workers/RemoteClient":function(){define("require exports dojo/Deferred ../Error ../promiseUtils ./utils".split(" "),function(G,u,r,n,m,k){function d(f,l){f["delete"](l)}var a=k.MessageType.CLOSE,b=k.MessageType.CANCEL,e=k.MessageType.INVOKE,g=k.MessageType.RESPONSE,h=k.MessageType.OPEN_PORT,c=function(){function f(l){this._timer=null;this._cancelledJobIds=new Set;this._invokeMessages=
[];this._invoke=l;this._timer=null;this._process=this._process.bind(this)}f.prototype.push=function(l){l.type===k.MessageType.CANCEL?this._cancelledJobIds.add(l.jobId):(this._invokeMessages.push(l),null===this._timer&&(this._timer=setTimeout(this._process,0)))};f.prototype.clear=function(){this._invokeMessages.length=0;this._cancelledJobIds.clear();this._timer=null};f.prototype._process=function(){this._timer=null;for(var l=0,q=this._invokeMessages;l<q.length;l++){var t=q[l];this._cancelledJobIds.has(t.jobId)||
this._invoke(t)}this._cancelledJobIds.clear();this._invokeMessages.length=0};return f}();return function(){function f(l,q,t){this._outJobs=new Map;this._inJobs=new Map;this._queue=new c(this._onInvoke.bind(this));this._onMessage=this._onMessage.bind(this);this._client=q;this._port=l;this._port.addEventListener("message",this._onMessage);this._port.start();this._channel=t}f.connect=function(l){var q=new MessageChannel;l="function"===typeof l?new l:"default"in l&&"function"===typeof l.default?new l.default:
l;l.remoteClient=new f(q.port1,l,q);return q.port2};f.prototype.close=function(){this._post({type:a});this._close()};f.prototype.isBusy=function(){return 0<this._outJobs.size};f.prototype.invoke=function(l,q,t){var v=this;if(!this._port)return m.reject(new n("remote-client:port-closed","Can't invoke(), port is closed"));var w=k.newJobId(),x=new r(function(){d(v._outJobs,w);v._post({type:b,jobId:w})});this._outJobs.set(w,x);this._post({type:e,jobId:w,methodName:l},q,t);return x.promise};f.prototype.openPort=
function(){var l=this,q=k.newJobId(),t=new r(function(){d(l._outJobs,q);l._post({type:b,jobId:q})});this._outJobs.set(q,t);this._post({type:h,jobId:q});return t.promise};f.prototype._close=function(){this._channel&&(this._channel=null);this._port.removeEventListener("message",this._onMessage);this._port.close();this._outJobs.forEach(function(l){l.cancel()});this._inJobs.clear();this._outJobs.clear();this._queue.clear();this._port=this._client=null};f.prototype._onMessage=function(l){if(l=k.receiveMessage(l))switch(l.type){case g:this._onResponse(l);
break;case e:this._queue.push(l);break;case b:this._onCancel(l);break;case a:this._close();break;case h:this._onOpenPort(l)}};f.prototype._onCancel=function(l){var q=this._inJobs,t=l.jobId,v=q.get(t);this._queue.push(l);v&&(d(q,t),v.cancel())};f.prototype._onInvoke=function(l){var q=this,t=l.methodName,v=l.jobId;l=l.data;var w=this._inJobs,x=this._client,H=x[t];try{if(!H&&t&&-1!==t.indexOf("."))for(var A=t.split("."),z=0;z<A.length-1;z++)x=x[A[z]],H=x[A[z+1]];if("function"!==typeof H)throw new TypeError(t+
" is not a function");var E=H.call(x,l,this)}catch(J){this._post({type:g,jobId:v,error:k.toInvokeError(J)});return}m.isThenable(E)?(w.set(v,E),E.then(function(J){w.has(v)&&(d(w,v),q._post({type:g,jobId:v},J))}).catch(function(J){w.has(v)&&(d(w,v),J&&"cancel"===J.dojoType||q._post({type:g,jobId:v,error:k.toInvokeError(J||{message:"Error encountered at method "+t})}))})):this._post({type:g,jobId:v},E)};f.prototype._onOpenPort=function(l){var q=new MessageChannel;new f(q.port1,this._client);this._post({type:g,
jobId:l.jobId},q.port2,[q.port2])};f.prototype._onResponse=function(l){var q=l.jobId,t=l.error;l=l.data;var v=this._outJobs;if(v.has(q)){var w=v.get(q);d(v,q);t?w.reject(n.fromJSON(JSON.parse(t))):w.resolve(l)}};f.prototype._post=function(l,q,t){return k.postMessage(this._port,l,q,t)};return f}()})},"esri/layers/vectorTiles/core/workers/utils":function(){define(["require","exports","dojo/has"],function(G,u,r){function n(k){return k&&"object"===typeof k&&("result"in k||"transferList"in k)}Object.defineProperty(u,
"__esModule",{value:!0});(function(k){k[k.HANDSHAKE=0]="HANDSHAKE";k[k.CONFIGURE=1]="CONFIGURE";k[k.CONFIGURED=2]="CONFIGURED";k[k.OPEN=3]="OPEN";k[k.OPENED=4]="OPENED";k[k.RESPONSE=5]="RESPONSE";k[k.INVOKE=6]="INVOKE";k[k.CANCEL=7]="CANCEL";k[k.CLOSE=8]="CLOSE";k[k.OPEN_PORT=9]="OPEN_PORT"})(u.MessageType||(u.MessageType={}));var m=0;u.newJobId=function(){return m++};u.isTranferableResult=n;u.toInvokeError=function(k){return k?k.toJSON?JSON.stringify(k):JSON.stringify({name:k.name,message:k.message,
details:k.details,stack:k.stack}):null};u.postMessage=function(k,d,a,b){2===arguments.length||void 0===a&&void 0===b?k.postMessage(d):(r("esri-workers-supports-transfer-arraybuffer")||(b?(b=b.filter(function(e){return!(e instanceof ArrayBuffer)}),b.length||(b=null)):n(a)&&a.transferList&&(a.transferList=a.transferList.filter(function(e){return!(e instanceof ArrayBuffer)}),a.transferList.length||(a.transferList=null))),b?(d.data=a,k.postMessage(d,b)):n(a)?(d.data=a.result,a.transferList?k.postMessage(d,
a.transferList):k.postMessage(d)):(d.data=a,k.postMessage(d)))};u.receiveMessage=function(k){return k?(k=k.data)?"string"===typeof k?JSON.parse(k):k:null:null}})},"esri/layers/vectorTiles/core/workers/WorkerOwner":function(){define("require exports dojo/Deferred ../../kernel ../Error ../Logger ../promiseUtils ./utils ./workerFactory".split(" "),function(G,u,r,n,m,k,d,a,b){var e=k.getLogger("esri.core.workers"),g=a.MessageType.CANCEL,h=a.MessageType.INVOKE,c=a.MessageType.OPEN,f=a.MessageType.OPENED,
l=a.MessageType.RESPONSE;return function(){function q(t,v){this._outJobs=new Map;this._inJobs=new Map;this.worker=t;this.id=v;t.addEventListener("message",this._onMessage.bind(this));t.addEventListener("error",function(w){w.preventDefault();e.error(w)})}q.create=function(t){return b.createWorker().then(function(v){return new q(v,t)})};q.prototype.terminate=function(){this.worker.terminate()};q.prototype.open=function(t){var v=this,w=a.newJobId(),x=new r(function(H){v._outJobs["delete"](w);v._post({type:g,
jobId:w})});this._outJobs.set(w,x);this._post({type:c,jobId:w,modulePath:t});return x.promise};q.prototype._onMessage=function(t){if(t=a.receiveMessage(t))switch(t.type){case f:case l:this._onResponse(t);break;case g:this._onCancel(t);break;case h:this._onInvoke(t)}};q.prototype._onCancel=function(t){(t=this._inJobs.get(t.jobId))&&t.cancel()};q.prototype._onInvoke=function(t){var v=this,w=t.methodName,x=t.jobId;t=t.data;var H=this._inJobs,A=n.workerMessages[w];try{if("function"!==typeof A)throw new TypeError(w+
" is not a function");var z=A.call(null,t)}catch(E){this._post({type:l,jobId:x,error:a.toInvokeError(E)});return}d.isThenable(z)?(H.set(x,z),z.then(function(E){H["delete"](x);v._post({type:l,jobId:x},E)}).catch(function(E){H["delete"](x);E||(E={message:"Error encountered at method"+w});E.dojoType&&"cancel"===E.dojoType||v._post({type:l,jobId:x,error:a.toInvokeError(E)})})):this._post({type:l,jobId:x},z)};q.prototype._onResponse=function(t){var v=t.jobId,w=t.error;t=t.data;var x=this._outJobs.get(v);
x&&(this._outJobs["delete"](v),w?x.reject(m.fromJSON(JSON.parse(w))):x.resolve(t))};q.prototype._post=function(t,v,w){return a.postMessage(this.worker,t,v,w)};return q}()})},"esri/layers/vectorTiles/kernel":function(){define(["require","exports","esri/kernel","./identity/IdentityManager"],function(G,u,r,n){return function(){function m(){}Object.defineProperty(m,"id",{get:function(){return r.id?n:null},enumerable:!0,configurable:!0});m.workerMessages={};return m}()})},"esri/layers/vectorTiles/identity/IdentityManager":function(){define(["require",
"exports","esri/IdentityManager"],function(G,u,r){Object.defineProperty(u,"__esModule",{value:!0});u.findCredential=function(n){return r.findCredential(n)}})},"esri/layers/vectorTiles/core/workers/workerFactory":function(){define("require exports ../tsSupport/assignHelper dojo/_base/kernel ../../config ../../request ../Logger ../promiseUtils ../sniff ../urlUtils ./loaderConfig ./utils ./WorkerFallback".split(" "),function(G,u,r,n,m,k,d,a,b,e,g,h,c){function f(A){return a.create(function(z){function E(D){if(D=
h.receiveMessage(D))switch(D.type){case H:D=A;var L=m.workers.loaderUrl||g.DEFAULT_LOADER_URL;if(null!=m["default"]){var C=r({},m);delete C["default"];C=JSON.parse(JSON.stringify(C))}else C=JSON.parse(JSON.stringify(m));var N=m.workers.loaderConfig;N=g.default({baseUrl:N.baseUrl,locale:n.locale,has:r({"config-deferredInstrumentation":0,"dojo-test-sniff":0,"esri-cors":1,"esri-secure-context":b("esri-secure-context"),"esri-workers-supports-transfer-arraybuffer":b("esri-workers-supports-transfer-arraybuffer"),
"events-keypress-typed":0,"host-webworker":1},N.has),map:r({},N.map),paths:r({},N.paths),packages:N.packages||[]});D.postMessage({type:x,configure:{esriConfig:C,loaderUrl:L,loaderConfig:N}});break;case w:A.removeEventListener("message",E),A.removeEventListener("error",J),z(A)}}function J(D){D.preventDefault();A.removeEventListener("message",E);A.removeEventListener("error",J);t.warn("Failed to create Worker. Fallback to execute module in main thread",D);A=new c;A.addEventListener("message",E);A.addEventListener("error",
J)}A.addEventListener("message",E);A.addEventListener("error",J)})}Object.defineProperty(u,"__esModule",{value:!0});var l=e.normalize(G.toUrl("./worker.js")),q=!e.hasSameOrigin(l,location.href),t=d.getLogger("esri.core.workers"),v=null,w=h.MessageType.CONFIGURED,x=h.MessageType.CONFIGURE,H=h.MessageType.HANDSHAKE;u.createWorker=function(){if(!b("esri-workers"))return f(new c);if(!q){var A=void 0;try{A=new Worker(l)}catch(z){t.warn("Failed to create Worker. Fallback to execute module in main thread",
event),A=new c}return f(A)}v||(v=k(l,{responseType:"text"}));return v.then(function(z){return new Worker(URL.createObjectURL(new Blob([z.data],{type:"text/javascript"})))}).catch(function(z){t.warn("Failed to create Worker. Fallback to execute module in main thread",z);return new c}).then(function(z){return f(z)})}})},"esri/layers/vectorTiles/core/tsSupport/assignHelper":function(){define([],function(){return Object.assign||function(G){for(var u,r=1,n=arguments.length;r<n;r++){u=arguments[r];for(var m in u)Object.prototype.hasOwnProperty.call(u,
m)&&(G[m]=u[m])}return G}})},"esri/layers/vectorTiles/config":function(){define(["require","exports","esri/config"],function(G,u,r){Object.defineProperty(r,"workers",{get:function(){return r.defaults.workers},set:function(n){return r.defaults.workers=n}});return r})},"esri/layers/vectorTiles/request":function(){define(["require","exports","esri/request","dojo/_base/lang","dojo/Deferred"],function(G,u,r,n,m){return function(k,d){k=n.mixin({},{url:k,failOk:!0},d);"array-buffer"===d.responseType?(k.handleAs=
"arraybuffer",delete k.responseType):d.responseType&&(k.handleAs=d.responseType,delete k.responseType);null!==d.query&&(k.content=k.query,delete k.query);if(d.hasOwnProperty("allowImageDataAccess")){var a={allowImageDataAccess:d.allowImageDataAccess};delete k.allowImageDataAccess}var b=new m(function(){e.isFulfilled()||e.cancel()});var e=r(k,a).then(function(g){b.resolve({data:g})}).catch(function(g){g&&null!=g.httpCode&&(g.details=g.details||{},g.details.httpStatus=g.httpCode);b.reject(g)});return b.promise}})},
"esri/layers/vectorTiles/core/sniff":function(){define(["require","exports","dojo/sniff","./global","../views/webgl/context-util"],function(G,u,r,n,m){function k(){var e={available:!1,version:0,majorPerformanceCaveat:!1,supportsHighPrecisionFragment:!1,supportsVertexShaderSamplers:!1,supportsElementIndexUint:!1,supportsStandardDerivatives:!1},g=document.createElement("canvas");if(!g)return e;var h=m.createContext(g,{failIfMajorPerformanceCaveat:!0},"webgl");!h&&(h=m.createContext(g,{},"webgl"))&&
(e.majorPerformanceCaveat=!0);if(!h)return e;g=h.getParameter(h.VERSION);if(!g)return e;if(g=g.match(/^WebGL\s+([\d.]*)/))e.version=parseFloat(g[1]),e.available=.94<=e.version,g=h.getShaderPrecisionFormat(h.FRAGMENT_SHADER,h.HIGH_FLOAT),e.supportsHighPrecisionFragment=g&&0<g.precision,e.supportsVertexShaderSamplers=0<h.getParameter(h.MAX_VERTEX_TEXTURE_IMAGE_UNITS),e.supportsElementIndexUint=null!==h.getExtension("OES_element_index_uint"),e.supportsStandardDerivatives=null!==h.getExtension("OES_standard_derivatives");
return e}function d(){var e={available:!1,version:0},g=document.createElement("canvas");if(!g)return e;g=m.createContext(g,{},"webgl2");if(!g)return e;e.available=!0;g=g.getParameter(g.VERSION);if(!g)return e;if(g=g.match(/^WebGL\s+([\d.]*)/))e.version=parseFloat(g[1]);return e}(function(){var e=navigator.userAgent,g=e.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i);e=e.match(/iPhone/i);g&&r.add("esri-mobile",g);e&&r.add("esri-iPhone",e);r.add("esri-phonegap",!!n.cordova);
r.add("esri-cors",r("esri-phonegap")||"XMLHttpRequest"in n&&"withCredentials"in new XMLHttpRequest);r.add("esri-geolocation",function(){return!!navigator.geolocation});r.add("esri-canvas-svg-support",function(){return!(r("trident")||r("ie"))});r.add("esri-secure-context",function(){if("isSecureContext"in n)return n.isSecureContext;if(n.location&&n.location.origin)return 0===n.location.origin.indexOf("https:")});r.add("esri-wasm","WebAssembly"in n);r("host-webworker")||(r.add("esri-workers","Worker"in
n),r.add("esri-script-sandbox",function(){return"MessageChannel"in n&&"HTMLIFrameElement"in n&&"sandbox"in HTMLIFrameElement.prototype}),r.add("esri-url-encodes-apostrophe",function(){var h=n.document.createElement("a");h.href="?'";return-1<h.href.indexOf("?%27")}),a||(a=k()),r.add("esri-webgl",a.available),r.add("esri-webgl-high-precision-fragment",a.supportsHighPrecisionFragment),r.add("esri-webgl-vertex-shader-samplers",a.supportsVertexShaderSamplers),r.add("esri-webgl-element-index-uint",a.supportsElementIndexUint),
r.add("esri-webgl-standard-derivatives",a.supportsStandardDerivatives),r.add("esri-webgl-major-performance-caveat",a.majorPerformanceCaveat),r.add("esri-featurelayer-webgl-labeling",!0),b||(b=d()),r.add("esri-webgl2",b.available))})();var a=null,b=null;return r})},"esri/layers/vectorTiles/core/global":function(){define(["require","exports"],function(G,u){return function(){if("undefined"!==typeof global)return global;if("undefined"!==typeof window)return window;if("undefined"!==typeof self)return self}()})},
"esri/layers/vectorTiles/views/webgl/context-util":function(){define(["require","exports"],function(G,u){function r(d,a,b){void 0===a&&(a={});switch(b){case "webgl":var e=["webgl","experimental-webgl","webkit-3d","moz-webgl"];break;case "webgl2":e=["webgl2"];break;default:e=["webgl","experimental-webgl","webkit-3d","moz-webgl"]}b=null;for(var g=0;g<e.length;g++){var h=e[g];try{b=d.getContext(h,a)}catch(c){}if(b)break}return b}function n(d,a){(d=d.parentNode)&&(d.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+
a+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}Object.defineProperty(u,"__esModule",{value:!0});u.createContextOrErrorHTML=function(d,a,b){void 0===a&&(a={});if(!window.WebGLRenderingContext)return n(d,m),null;a=r(d,a,b);return a?a:(n(d,k),null)};u.createContext=r;var m='This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e',k='It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e'})},
"esri/layers/vectorTiles/core/urlUtils":function(){define(["require","exports","esri/urlUtils","dojo/_base/url"],function(G,u,r,n){function m(x){return r.normalize(x)}function k(x){return"data:"===x.slice(0,5)}function d(x){return a(x)||v.test(x)}function a(x){return x&&"/"===x[0]&&"/"===x[1]}function b(x){return r.urlToObject(x)}function e(x){if("string"===typeof x)return new n(h(x));x.scheme||(x.scheme=u.appUrl.scheme);return x}function g(x){if(k(x))return null;var H=x.indexOf("://");if(-1===H&&
a(x))H=2;else if(-1!==H)H+=3;else return null;H=x.indexOf("/",H);return-1===H?x:x.slice(0,H)}function h(x,H,A){void 0===H&&(H=u.appBaseUrl);if(a(x))return A&&A.preserveProtocolRelative?x:"http"===u.appUrl.scheme&&u.appUrl.authority===g(x).slice(2)?"http:"+x:"https:"+x;if(v.test(x))return x;"/"===x[0]&&(A=H.indexOf("//"),A=H.indexOf("/",A+2),H=-1===A?H:H.slice(0,A));return f(H,x)}function c(x,H,A){void 0===A&&(A=!1);x=e(x);H=e(H);return A||x.scheme===H.scheme?x.host.toLowerCase()===H.host.toLowerCase()&&
x.port===H.port:!1}function f(){for(var x=[],H=0;H<arguments.length;H++)x[H]=arguments[H];if(x&&x.length){H=[];if(d(x[0])){var A=x[0],z=A.indexOf("//");H.push(A.slice(0,z+1));t.test(x[0])&&(H[0]+="/");x[0]=A.slice(z+2)}else"/"===x[0][0]&&H.push("");x=x.reduce(function(E,J){return J?E.concat(J.split("/")):E},[]);for(A=0;A<x.length;A++)z=x[A],".."===z&&0<H.length?H.pop():!z||"."===z&&0!==H.length||H.push(z);return H.join("/")}}function l(x,H,A){if(!(H&&A&&x&&d(x)))return x;var z=x.indexOf("//"),E=x.indexOf("/",
z+2),J=x.indexOf(":",z+2);E=Math.min(0>E?x.length:E,0>J?x.length:J);if(x.slice(z+2,E).toLowerCase()!==H.toLowerCase())return x;H=x.slice(0,z+2);x=x.slice(E);return""+H+A+x}function q(x,H,A){void 0===H&&(H=u.appBaseUrl);if(!d(x))return x;var z=m(x),E=z.toLowerCase();H=m(H).toLowerCase().replace(/\/+$/,"");if((A=A?m(A).toLowerCase().replace(/\/+$/,""):null)&&0!==H.indexOf(A))return x;for(var J=function(C,N,S){S=C.indexOf(N,S);return-1===S?C.length:S},D=J(E,"/",E.indexOf("//")+2),L=-1;E.slice(0,D+1)===
H.slice(0,D)+"/";){L=D+1;if(D===E.length)break;D=J(E,"/",D+1)}if(-1===L||A&&L<A.length)return x;x=z.slice(L);z=H.slice(L-1).replace(/[^/]+/g,"").length;if(0<z)for(E=0;E<z;E++)x="../"+x;else x="./"+x;return x}Object.defineProperty(u,"__esModule",{value:!0});u.normalize=m;u.canUseXhr=function(x){return r.canUseXhr(x)};u.removeTrailingSlash=function(x){return x.replace(/\/+$/,"")};G=Function("return this")();u.appUrl=new n(G.location);u.appBaseUrl=function(){var x=u.appUrl.path;x=x.substring(0,x.lastIndexOf(x.split("/")[x.split("/").length-
1]));return u.appUrl.scheme+"://"+u.appUrl.host+(null!=u.appUrl.port?":"+u.appUrl.port:"")+x}();var t=/^\s*file:/i,v=/^\s*[a-z][a-z0-9-+.]*:[^0-9]/i;u.isDataProtocol=k;u.isAbsolute=d;u.isProtocolRelative=a;u.urlToObject=b;u.getOrigin=g;u.makeAbsolute=h;u.hasSameOrigin=c;u.join=f;u.removeFile=function(x){var H=0;if(d(x)){var A=x.indexOf("//");-1!==A&&(H=A+2)}A=x.lastIndexOf("/");return A<H?x:x.slice(0,A+1)};u.addProxy=function(x){return r.addProxy(x)};u.makeData=function(x){return x.isBase64?"data:"+
x.mediaType+";base64,"+x.data:"data:"+x.mediaType+","+x.data};var w=/^data:(.*?)(;base64)?,(.*)$/;u.dataComponents=function(x){return(x=x.match(w))?{mediaType:x[1],isBase64:!!x[2],data:x[3]}:null};u.changeDomain=l;u.read=function(x,H){var A=H&&H.url&&H.url.path;x&&A&&(x=h(x,A,{preserveProtocolRelative:!0}));(H=H&&H.portal)&&!H.isPortal&&H.urlKey&&H.customBaseUrl?(A=H.urlKey+"."+H.customBaseUrl,H=c(u.appUrl,u.appUrl.scheme+"://"+A)?l(x,H.portalHostname,A):l(x,A,H.portalHostname)):H=x;return H};u.write=
function(x,H){if(!x)return x;!d(x)&&H&&H.blockedRelativeUrls&&H.blockedRelativeUrls.push(x);var A=h(x);if(H){var z=H.verifyItemRelativeUrls&&H.verifyItemRelativeUrls.rootPath||H.url&&H.url.path;z&&(A=q(A,z,z),A!==x&&H.verifyItemRelativeUrls&&H.verifyItemRelativeUrls.writtenUrls.push(A))}x=A;A=(H=H&&H.portal)&&!H.isPortal&&H.urlKey&&H.customBaseUrl?l(x,H.urlKey+"."+H.customBaseUrl,H.portalHostname):x;return A};u.makeRelative=q;u.removeQueryParameters=function(x){x=b(x);Object.keys(x.query||{});return x.path}})},
"esri/layers/vectorTiles/core/workers/loaderConfig":function(){define(["require","exports","../tsSupport/assignHelper","dojo/has","../urlUtils"],function(G,u,r,n,m){Object.defineProperty(u,"__esModule",{value:!0});u.DEFAULT_LOADER_URL=m.makeAbsolute(m.removeQueryParameters(G.toUrl("./worker-init.js")));u.DEFAULT_CONFIG={baseUrl:function(){var k=m.removeQueryParameters(G.toUrl("dojo/x.js"));return m.makeAbsolute(k.slice(0,k.length-5))}(),packages:[{name:"esri"},{name:"dojo"},{name:"dojox"},{name:"dstore"},
{name:"moment",main:"moment"},{name:"@dojo"},{name:"cldrjs",main:"dist/cldr"},{name:"globalize",main:"dist/globalize"},{name:"maquette",main:"dist/maquette.umd"},{name:"maquette-css-transitions",main:"dist/maquette-css-transitions.umd"},{name:"maquette-jsx",main:"dist/maquette-jsx.umd"},{name:"tslib",main:"tslib"}],map:{globalize:{cldr:"cldrjs/dist/cldr","cldr/event":"cldrjs/dist/cldr/event","cldr/supplemental":"cldrjs/dist/cldr/supplemental","cldr/unresolved":"cldrjs/dist/cldr/unresolved"}}};u.default=
function(k){var d={async:k.async,isDebug:k.isDebug,locale:k.locale,baseUrl:k.baseUrl,has:r({},k.has),map:r({},k.map),packages:k.packages&&k.packages.concat()||[],paths:r({},k.paths)};k.hasOwnProperty("async")||(d.async=!0);k.hasOwnProperty("isDebug")||(d.isDebug=!1);k.baseUrl||(d.baseUrl=u.DEFAULT_CONFIG.baseUrl);u.DEFAULT_CONFIG.packages.forEach(function(g){a:{for(var h=d.packages,c=0;c<h.length;c++)if(h[c].name===g.name)break a;g=r({},g);c=m.removeQueryParameters(G.toUrl(g.name+"/x.js"));c=c.slice(0,
c.length-5);g.location=m.makeAbsolute(c);h.push(g)}});k=d.map=d.map||{};for(var a=0,b=Object.keys(u.DEFAULT_CONFIG.map);a<b.length;a++){var e=b[a];k[e]||(k[e]=u.DEFAULT_CONFIG.map[e])}return d}})},"esri/layers/vectorTiles/core/workers/WorkerFallback":function(){define(["require","exports","dojo/has","../global","./utils"],function(G,u,r,n,m){var k=function(){return function(){var b=this,e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(g){b[g]=
function(){for(var h=[],c=0;c<arguments.length;c++)h[c]=arguments[c];return e[g].apply(e,h)}})}}(),d=n.MutationObserver||n.WebKitMutationObserver,a=function(){if(n.process&&n.process.nextTick)var b=function(h){n.process.nextTick(h)};else if(n.Promise)b=function(h){n.Promise.resolve().then(h)};else if(d){var e=[],g=document.createElement("div");(new d(function(){for(;0<e.length;)e.shift()()})).observe(g,{attributes:!0});b=function(h){e.push(h);g.setAttribute("queueStatus","1")}}return b}();return function(){function b(){this._dispatcher=
new k;this._isInitialized=!1;this._workerPostMessage({type:m.MessageType.HANDSHAKE})}b.prototype.terminate=function(){};Object.defineProperty(b.prototype,"onmessage",{get:function(){return this._onmessageHandler},set:function(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler);(this._onmessageHandler=e)&&this.addEventListener("message",e)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"onerror",{get:function(){return this._onerrorHandler},set:function(e){this._onerrorHandler&&
this.removeEventListener("error",this._onerrorHandler);(this._onerrorHandler=e)&&this.addEventListener("error",e)},enumerable:!0,configurable:!0});b.prototype.postMessage=function(e,g){var h=this;a(function(){h._workerMessageHandler(new MessageEvent("message",{data:e}))})};b.prototype.dispatchEvent=function(e){return this._dispatcher.dispatchEvent(e)};b.prototype.addEventListener=function(e,g,h){this._dispatcher.addEventListener(e,g,h)};b.prototype.removeEventListener=function(e,g,h){this._dispatcher.removeEventListener(e,
g,h)};b.prototype._workerPostMessage=function(e,g){var h=this;a(function(){h.dispatchEvent(new MessageEvent("message",{data:e}))})};b.prototype._workerMessageHandler=function(e){var g=this;if(e=m.receiveMessage(e)){var h=e.jobId;switch(e.type){case m.MessageType.CONFIGURE:this._isInitialized||this._workerPostMessage({type:m.MessageType.CONFIGURED});break;case m.MessageType.OPEN:e=e.modulePath,r("esri-webpack")?G(["esri/core/workers/RemoteClient","esri/views/vectorTiles/WorkerTileHandler","esri/views/2d/layers/features/Pipeline",
"esri/views/3d/layers/PointCloudWorker","esri/views/3d/layers/SceneLayerWorker","esri/layers/graphics/sources/support/CSVSourceWorker","esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker",e],function(c,f,l,q,t,v,w,x){switch(x){case "esri/views/vectorTiles/WorkerTileHandler":break;case "esri/views/2d/layers/features/Pipeline":f=l;break;case "esri/views/3d/layers/PointCloudWorker":f=q;break;case "esri/views/3d/layers/SceneLayerWorker":f=t;break;case "esri/layers/graphics/sources/support/CSVSourceWorker":f=
v;break;case "esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":f=w;break;default:f=x}c=c.connect(f);g._workerPostMessage({type:m.MessageType.OPENED,jobId:h,data:c})}):G(["./RemoteClient",e],function(c,f){c=c.connect(f);g._workerPostMessage({type:m.MessageType.OPENED,jobId:h,data:c})})}}};return b}()})},"esri/layers/vectorTiles/core/requireUtils":function(){define(["require","exports","dojo/Deferred"],function(G,u,r){function n(m,k){if(Array.isArray(k)){var d=new r;m(k,function(){for(var a=
[],b=0;b<arguments.length;b++)a[b]=arguments[b];d.resolve(a)});return d.promise}return n(m,[k]).then(function(a){return a[0]})}Object.defineProperty(u,"__esModule",{value:!0});u.when=n;u.getAbsMid=function(m,k,d){return k.toAbsMid?k.toAbsMid(m):d.id.replace(/\/[^\/]*$/gi,"/")+m}})},"esri/layers/rasterLib/function/rasterFunctionHelper":function(){define(["dojo/_base/declare","dojo/_base/lang","./rasterFunctionRegistry"],function(G,u,r){return{create:function(n,m){if(n){var k=n.renderTexture,d=Object.keys(n);
if(n.read&&!m)return n;n.read&&m&&(n=n.toJson());-1<d.indexOf("name")&&d.indexOf(!1)?(n=u.mixin({},n),m=this._parseV2(n,m)):(n="esri.layers.RasterFunction"===n.declaredClass?n.toJson():u.mixin({},n),m=this._parseV1(n,m));m.branchCount=m.updateBranchStructure();m.renderTexture||(m.renderTexture=!!k);return m}},_parseV1:function(n,m){var k=n.rasterFunction,d=n.rasterFunctionArguments,a=n.renderTexture||n.rasterFunctionArguments.renderTexture||!1,b,e,g,h,c,f,l;(h=d.raster||d.Raster)&&h.rasterFunction&&
(b=this._parseV1(h,m));(h=d.raster2||d.Raster2)&&h.rasterFunction&&(e=this._parseV1(h,m));(h=d.rasters||d.Rasters)&&0<h.length&&(g=h.map(u.hitch(this,function(q){return q&&q.rasterFunction?this._parseV1(q,m):q})));(h=d.dem||d.DEM)&&(h.functionName||h.rasterFunction)&&(c=this._parseV1(h,m));(h=d.fillRaster||d.FillRaster)&&(h.functionName||h.rasterFunction)&&(f=this._parseV1(h,m));h=r.functions[k];if(!h)return console.error("Function is not currently supported: "+k),null;k=new h(d);k.variableName&&
(h=d[k.variableName])&&(h.functionName||h.rasterFunction)&&(l=this._parseV1(h,m));n.outputPixelType&&(k.pixelType=n.outputPixelType);"$$"===b?k.functionArguments.raster=m&&m.raster:null!=b?k.functionArguments.raster=b:k.functionArguments.raster||(k.functionArguments.raster=m&&m.raster);null!=e&&(k.functionArguments.raster2=e);null!=g&&(k.functionArguments.rasters=g.map(function(q){"$$"===q&&(q=m&&m.raster);return q}));null!=c&&(k.functionArguments.dem=c);null!=f&&(k.functionArguments.fillRaster=f);
null!=l&&(k.functionArguments[k.variableName]=l);k.renderTexture=a;return k},_parseV2:function(n,m){if(!n)return null;n=u.clone(n);this._bindV2Args(n,m);var k={};this._convertTov1(n,k);return this._parseV1(k,m)},_bindV2Args:function(n,m){(n||m)&&Object.keys(n).forEach(function(k){n[k]["function"]&&n[k].arguments?this._bindV2Args(n[k].arguments,m):null!=m[n[k].name]&&(n[k].value=m[n[k].name])}.bind(this))},_convertV2Types:function(n){if(!n)return null;"ArgumentArray"===n.type?n.elements&&"RasterStatistics"===
n.elements[0].type&&(n=n.elements):n instanceof Array&&0===n.length&&(n=null);return n},_convertTov1:function(n,m){if((n||m)&&n["function"]){var k=n["function"],d=n.arguments;m.rasterFunction=k.type.replace("Function","");m.outputPixelType="UNKNOWN"===k.pixelType?"Unknown":k.pixelType;m.rasterFunctionArguments={};var a;Object.keys(d).forEach(function(b){d[b]["function"]&&d[b].arguments?(m.rasterFunctionArguments[b]={},this._convertTov1(d[b],m.rasterFunctionArguments[b])):(a=d[b].value,m.rasterFunctionArguments[b]=
"object"!==typeof a||a.functionArguments?a:this._convertV2Types(a))}.bind(this))}}}})},"esri/layers/rasterLib/function/rasterFunctionRegistry":function(){define("dojo/_base/declare dojo/_base/lang ../../rasterLib/function/AspectFunction ../../rasterLib/function/BandArithmeticFunction ../../rasterLib/function/ColormapFunction ../../rasterLib/function/CompositeBandFunction ../../rasterLib/function/ContrastBrightnessFunction ../../rasterLib/function/ConvolutionFunction ../../rasterLib/function/ExtractBandFunction ../../rasterLib/function/HillshadeFunction ../../rasterLib/function/LocalFunction ../../rasterLib/function/MaskFunction ../../rasterLib/function/NDVIFunction ../../rasterLib/function/SlopeFunction ../../rasterLib/function/StretchFunction ../../rasterLib/function/RemapFunction ../../rasterLib/function/IdentityFunction ../../rasterLib/function/ResampleFunction".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v){return function(){function w(z){z.prototype.supportWebGL&&(H[z.prototype.functionName]=z);z.prototype.support2D&&(x[z.prototype.functionName]=z);A[z.prototype.functionName]=z}var x={},H={},A={};w(r);w(n);w(m);w(k);w(d);w(a);w(b);w(e);w(g);w(h);w(c);w(f);w(l);w(q);w(t);w(v);return{cpu:x,gpu:H,functions:A,register:w,getFunction:function(z){return A[z]},support:function(z,E){return!!("gpu"===E?H:"cpu"===E?x:A)[z]}}}()})},"esri/layers/rasterLib/function/AspectFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),
function(G,u,r,n,m,k,d,a){return G([r,d],{declaredClass:"esri.layers.rasterLib.function.AspectFunction",functionName:"Aspect",supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=this.mixinIgnoreCase({raster:null},b)},bind:function(){var b=this.getSourceRasterInfo();if(!b.raster)return Error("The raster input to aspect function is invalid.");this.rasterInfo=u.mixin(b.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:[{min:0,max:360}],histograms:null});
this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(b){this._performance.start();b=a.aspect(b.raster);this._addPerformanceMetric(this._performance.elapsed());return b},readGL:function(b){this._performance.start();this._initializeProgram({fragment:k.aspect,fragmentName:"Aspect"});var e=this._setupTextureData(b.raster),g=this.bindFrameBuffer(),h=this.gl,c=h.drawingBufferWidth;h=h.drawingBufferHeight;var f=e.extent;
this._setUniforms({u_resolution:b&&b.raster&&b.raster.pixelBlock?[1/b.raster.pixelBlock.width,1/b.raster.pixelBlock.height]:[1/c,1/h],u_cellSize:[(f.xmax-f.xmin)/c,(f.ymax-f.ymin)/h]});this._bindTexture(e.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:e.extent,texture:g.texture}}})})},"esri/layers/rasterLib/function/RasterFunctionX":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/config ../raster/RasterInfo ../../../geometry/Extent ../../PixelBlock".split(" "),
function(G,u,r,n,m,k){return G(null,{functionName:null,functionArguments:null,pixelType:"Unknown",rasterInfo:null,constructor:function(d){d&&(this.pixelType=d.outputPixelType||d.OutputPixelType||this.pixelType,this.renderTexture=d.renderTexture,this._initFunction())},mixinIgnoreCase:function(d,a){var b=Object.keys(d),e=Object.keys(a),g,h,c=b.length;for(g=0;g<e.length;g++){var f=a[e[g]];if(null!=f)for(h=0;h<c;h++)if(b[h].toLowerCase()===e[g].toLowerCase()){d[b[h]]=f;break}}return d},bind:function(d){},
setProcessingContext:function(d){if(!d)throw"cannot bind to layer without options";this.useWebGL=!!d.useWebGL;this._tileMode=!!d.tileMode;this._glSetting=d.glSetting;this._rawRasterInfo=d.rawRasterInfo;this._xformSetting=d.xformSetting||this._xformSetting;if(!this.useWebGL||this._glSetting&&this._glSetting.gl){this.gl=this.useWebGL?this._glSetting.gl:null;this._glSetting&&(this._glSetting.pingpong=null,this._glSetting.branches=null);var a=this.functionArguments.raster,b=this.functionArguments.raster2,
e=this.functionArguments.dem,g=this.functionArguments.fillRaster,h=this.functionArguments.rasters;a&&a.functionArguments&&a.setProcessingContext(d);b&&b.functionArguments&&b.setProcessingContext(d);e&&e.functionArguments&&e.setProcessingContext(d);g&&g.functionArguments&&g.setProcessingContext(d);if(h)for(a=0;a<h.length;a++)h[a]&&h[a].functionArguments&&h[a].setProcessingContext(d);this.bind()}},updateBranchStructure:function(){var d=0,a=this.functionArguments;a.raster&&a.raster.read&&a.raster.functionArguments&&
(d+=a.raster.updateBranchStructure());a.raster2&&a.raster2.read&&a.raster2.functionArguments&&(d+=a.raster2.updateBranchStructure(),a.raster2.isBranch=!0,a.raster&&a.raster.read&&(a.raster.isBranch=!0));a.rasters&&(d=a.rasters.length,a.rasters.forEach(function(b){b.read&&b.functionArguments&&(b.isBranch=!0)}));a.dem&&a.dem.read&&a.dem.functionArguments&&(d+=a.dem.updateBranchStructure());return 1===d?0:d},read:function(d){d=this.processRasterArgument(d);return this.useWebGL?this.readGL(d):this.read2D(d)},
hasTilingEffects:function(){return!1},read2D:function(){},readGL:function(){},getSourceRasterInfo:function(){var d,a={};if(this.functionArguments.raster2)a.functionArguments.raster=this._bindRaster(this.functionArguments.raster),a.functionArguments.raster2=this._bindRaster(this.functionArguments.raster2);else if(this.functionArguments.rasters)for(a.rasters=[],d=0;d<this.functionArguments.rasters.length;d++)a.rasters[d]=this._bindRaster(this.functionArguments.rasters[d]);else a.raster=this._bindRaster(this.functionArguments.raster);
return this.sourceRasterInfo=a},processRasterArgument:function(d){var a=this.bind();if(!0!==a)throw a;var b={};if(this.functionArguments.raster2)b.raster=this._readRaster(this.functionArguments.raster,d),b.raster2=this._readRaster(this.functionArguments.raster2,d);else if(this.functionArguments.rasters)for(b.rasters=[],a=0;a<this.functionArguments.rasters.length;a++)b.rasters[a]=this._readRaster(this.functionArguments.rasters[a],d);else b.raster=this._readRaster(this.functionArguments.raster,d);return b},
toJson:function(){var d=this.functionArguments,a=d.raster,b=d.raster2;d=d.rasters;a=a?a.toJson?a.toJson():a:null;b=b?b.toJson?b.toJson():b:null;var e;d&&0<d.length&&(e=d.map(function(g){return g.toJson?g.toJson():g}));d=u.mixin({},this.functionArguments);d.raster=a;d.raster2=b;d.rasters=e;d=this._fixRasterFunctionJson(d);return{rasterFunction:this.functionName,rasterFunctionArguments:d,outputPixelType:this.pixelType}},_initFunction:function(d){},_getIntegerRange:function(d){switch(d){case "U8":var a=
[0,255];break;case "U16":a=[0,65535];break;case "U32":a=[0,4294967295];break;case "S8":a=[-128,127];break;case "S16":a=[-32768,32767];break;case "S32":a=[-2147483648,2147483647]}return a},_calculatePixelType:function(d,a){return d&&"unknown"!==d.toLowerCase()?d:a},_clonePixelData:function(d){if(null==d)return d;var a={};d.extent&&(a.extent=new m(d.extent.xmin,d.extent.ymin,d.extent.xmax,d.extent.ymax,d.extent.spatialReference));d=d.pixelBlock;if(null==d)return a;a.pixelBlock=d.clone?d.clone():k.prototype.clone(d);
return a},_readRaster:function(d,a){if(null==d||"$$"===d)var b=this._clonePixelData(a.src[Object.keys(a.src)[0]]);else d&&d.rasterInfo&&!d.functionArguments?b=this._clonePixelData(a.src[d._rasterId]):isNaN(d)?d.read&&(b=d.functionArguments?d.read(a):this._clonePixelData(a)):(b=a.src?a.src[Object.keys(a.src)[0]]:a,a=b.pixelBlock,a=new Float32Array(a.width*a.height),a.fill(parseFloat(d)),b=this._clonePixelData(b),b.pixelBlock.pixels=[a],b.isConstant=!0);return b},_bindRaster:function(d){if(d&&"$$"!==
d)isNaN(d)?d.rasterInfo?a=d.rasterInfo:d.bind&&d.bind()&&(a=d.rasterInfo):a={};else var a=this._rawRasterInfo;a&&(a=a.clone?a.clone():new n(a),a.bandCount=a.bandCount||3);return a},_getOutputBand:function(d,a){switch(d){case "U8":d=new Uint8Array(a);break;case "U16":d=new Uint16Array(a);break;case "U32":d=new Uint32Array(a);break;case "S8":d=new Int8Array(a);break;case "S16":d=new Int16Array(a);break;case "S32":d=new Int32Array(a);break;case "U32":d=new Uint32Array(a);break;case "F32":d=new Float32Array(a);
break;case "F64":d=new Float64Array(a);break;default:d=new Float32Array(a)}return d},_clampBand:function(d,a,b){if(("F64"===a||"F32"===a)&&!b)return d;var e,g=this._getIntegerRange(a),h=d.length;if(g)for(b=g[1],g=g[0],a=this._getOutputBand(a,h),e=0;e<h;e++){var c=d[e];a[e]=c>b?b:c<g?g:c}else a=d;return a},_performance:{start:function(){return this._start=self.performance&&self.performance.now()||new Date}.bind(this),elapsed:function(){return(self.performance&&self.performance.now()||new Date)-this._start}.bind(this)},
_addPerformanceMetric:function(d){r.isDebug&&(self.rasterFunctionPerformance||(self.rasterFunctionPerformance=[]),self.rasterFunctionPerformance.push(d),50<self.rasterFunctionPerformance.length&&self.rasterFunctionPerformance.shift())},_fixRasterFunctionJson:function(d){for(var a in d)d.hasOwnProperty(a)&&(null==d[a]?delete d[a]:d[a]instanceof Object&&!d[a].sourceType&&this._fixRasterFunctionJson(d[a],!0));return d}})})},"esri/layers/rasterLib/function/pixelShaders":function(){define(["dojo/_base/declare",
"dojo/_base/lang","./pixelShaderScripts"],function(G,u,r){G={shaderType:"fragment",getShader:function(n,m){var k=n.createShader(n.FRAGMENT_SHADER);n.shaderSource(k,m);n.compileShader(k);n.getShaderParameter(k,n.COMPILE_STATUS)||(k=null);return k}};u.mixin(G,r);return G})},"esri/layers/rasterLib/function/pixelShaderScripts":function(){define([],function(){return{aspect:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nfloat pi \x3d 3.141592653589793238;\nfloat dz_dx \x3d 0.0;\nfloat dz_dy \x3d 0.0;\nvec4 va, vb, vc,vd,ve,vf,vg,vh,vi;\nvec2 axy \x3d vec2(-1.0,-1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s)\n{\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t)\n{\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e1.0-u_resolution.s)\n{\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0- u_resolution.t)\n{\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0-u_resolution.s)\x3e\x3dv_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0-u_resolution.t)\x3e\x3dv_texCoord.t)\n{\nva \x3d texture2D(u_image, v_texCoord + u_resolution* axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution* bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution* cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution* dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution* vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution* fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution* gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution* hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution* ixy);\n}\ndz_dx \x3d (vc+2.0*vf+vi - va - 2.0*vd - vg).r/(8.0*u_cellSize[0]);\ndz_dy \x3d -(vg+2.0*vh+vi - va - 2.0*vb - vc).r/(8.0*u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat aspect_rad \x3d 0.0;\nif (dz_dx \x3d\x3d 0.0)\n{\nif (dz_dy \x3e 0.0)\naspect_rad \x3d 0.5 * pi;\nelse if (dz_dy \x3c 0.0)\naspect_rad \x3d 1.5 * pi;\nelse\nalpha \x3d 0.0;//undefined make it nodata\n}\nelse\n{\naspect_rad \x3d 0.5*pi + atan(dz_dy, -dz_dx);\nif (aspect_rad \x3c 0.0)\naspect_rad \x3d 2.0*pi + aspect_rad;\n}\nfloat aspect \x3d aspect_rad * 180.0 / pi;\ngl_FragColor \x3d vec4(aspect, aspect, aspect, alpha);\n}",
bandArithmetic:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_nir;\nuniform int u_bandId_red;\nuniform bool u_scaled;\nuniform int u_bandCount;\nuniform int u_method;\nuniform float u_constants[6];\nvec4 calculateNDVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n} else {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nvec4 calculateSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat savi_denom \x3d nir + red + u_constants[0];\nfloat savi;\nif (savi_denom \x3d\x3d 0.0) {\nsavi \x3d 0.0;\n} else {\nsavi \x3d (nir - red) / savi_denom * (1.0 + u_constants[0]);\n}\nreturn vec4(savi, savi, savi, currentPixel.a);\n}\nvec4 calculateMSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat msavi \x3d 0.5 * (2.0 * (nir + 1.0) - sqrt(pow((2.0 * nir + 1.0), 2.0) - 8.0 * (nir - red)));\nreturn vec4(msavi, msavi, msavi, currentPixel.a);\n}\nvec4 calculateTSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat s \x3d u_constants[0];\nfloat a \x3d u_constants[1];\nfloat x \x3d u_constants[2];\nfloat tsavi_denom \x3d a * nir + red - a * s + x * (1.0 + s * s);\nfloat tsavi;\nif (tsavi_denom \x3d\x3d 0.0) {\ntsavi \x3d 0.0;\n} else {\ntsavi \x3d s * (nir - s * red - a) / tsavi_denom;\n}\nreturn vec4(tsavi, tsavi, tsavi, currentPixel.a);\n}\nvec4 calculatePVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat a \x3d u_constants[0];\nfloat b \x3d u_constants[1];\nfloat pvi \x3d (nir - a * red - b) / sqrt(1.0 + a * 2.0);\nreturn vec4(pvi, pvi, pvi, currentPixel.a);\n}\nvec4 calculateGEMI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat gemi;\nif (red \x3d\x3d 1.0) {\ngemi \x3d 0.0;\n} else {\nfloat eta \x3d (2.0 * (nir * nir - red * red) + 1.5 * nir + 0.5 * red) / (nir + red + 0.5);\nfloat gemi \x3d eta * (1.0 - 0.25*eta) - (red - 0.125) / (1.0 - red);\n}\nreturn vec4(gemi, gemi, gemi, currentPixel.a);\n}\nvec4 calculateVARI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(currentPixel.r);\nfloat green \x3d float(currentPixel.g);\nfloat blue \x3d float(currentPixel.b);\nfloat vari \x3d (green - red) /(green + red - blue);\nreturn vec4(vari, vari, vari, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 pv;\nif (u_method \x3c 4) {\nif (u_method \x3d\x3d 1) {\npv \x3d calculateNDVI();\n} else if (u_method \x3d\x3d 2) {\npv \x3d calculateSAVI();\n} else if (u_method \x3d\x3d 3) {\npv \x3d calculateTSAVI();\n} else if (u_method \x3d\x3d 4) {\npv \x3d calculateMSAVI();\n}\n} else {\nif (u_method \x3d\x3d 5) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 6) {\npv \x3d calculatePVI();\n} else if (u_method \x3d\x3d 7) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 9) {\npv \x3d calculateVARI();\n}\n}\ngl_FragColor \x3d pv;\n}",
colormap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nvec4 colorize() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat clrIndex \x3d currentPixel.r - u_indexedColormapOffset;\nvec4 result;\nif (currentPixel.a \x3d\x3d 0.0 || clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d colorize();\n}",
compositeBand:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 composite() {\nvec4 p0, p1, p2;\np0 \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nif (u_rasterCount \x3d\x3d 1){\nresult \x3d p0;\n}\nelse if (u_rasterCount \x3d\x3d 2){\np1 \x3d texture2D(u_image1, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,0.0,min(p0.a,p1.a));\n}\nelse if (u_rasterCount \x3d\x3d 3){\np1 \x3d texture2D(u_image1, v_texCoord);\np2 \x3d texture2D(u_image2, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,p2.r,min(min(p0.a,p1.a),p2.a));\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d composite();\n}",
constant:"precision mediump float;\nuniform vec4 u_color;\nvoid main() {\ngl_FragColor \x3d u_color;\n}",contrastBrightness:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nuniform float u_scaleFactor;\nvec4 adjustContrastBrightness() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat c \x3d u_contrastOffset;\nfloat b \x3d u_brightnessOffset;\nfloat maxI \x3d 255.0;\nfloat mid \x3d 128.0;\nvec4 v;\nif (c \x3e 0.0 \x26\x26 c \x3c 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n} else if (c \x3c\x3d 0.0 \x26\x26 c \x3e -100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n} else if (c \x3d\x3d 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\nv \x3d (sign(v) + 1.0) / 2.0; //binary contrast with extra mid tone at 0.5\n} else if (c \x3d\x3d -100.0) {\nv \x3d vec4(mid, mid, mid, currentPixel.a); //no contrast\n}\nreturn vec4(v.r / u_scaleFactor, v.g / u_scaleFactor, v.b / u_scaleFactor, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d adjustContrastBrightness();\n}",
convolution:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform float u_kernel[25];\nuniform int u_kernelSize;\nvec4 convolve33(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nvec2 xy11 \x3d vec2(-1.0, -1.0);\nvec2 xy12 \x3d vec2(0.0, -1.0);\nvec2 xy13 \x3d vec2(1.0, -1.0);\nvec2 xy21 \x3d vec2(-1.0, 0.0);\nvec2 xy23 \x3d vec2(1.0, 0.0);\nvec2 xy31 \x3d vec2(-1.0, 1.0);\nvec2 xy32 \x3d vec2(0.0, 1.0);\nvec2 xy33 \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\nxy11[0] \x3d 1.0;\nxy21[0] \x3d 1.0;\nxy31[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\nxy11[1] \x3d 1.0;\nxy12[1] \x3d 1.0;\nxy13[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxy13[0] \x3d -1.0;\nxy23[0] \x3d -1.0;\nxy33[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nxy31[1] \x3d -1.0;\nxy32[1] \x3d -1.0;\nxy33[1] \x3d -1.0;\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * xy11) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * xy12) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * xy13) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * xy21) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(0, 0)) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * xy23) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * xy31) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * xy32) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * xy33) * u_kernel[8];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nvec4 convolve55(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nfloat xdif[5];//https://www.opengl.org/wiki/Data_Type_(GLSL) array constructor ES3.0\nfloat ydif[5];\nfloat a \x3d -2.0;\nfor (int i\x3d0; i\x3c5; i++){\nxdif[i] \x3d a;\nydif[i] \x3d a;\na++;\n}\nif (v_texCoord.s \x3c u_resolution.s *2.0) { //2 pixel\nxdif[0] \x3d 2.0;\nif (v_texCoord.s \x3c u_resolution.s) { //1 pixel\nxdif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.s \x3e 1.0 - u_resolution.s *2.0) {\nxdif[0] \x3d -2.0;\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxdif[1] \x3d -1.0;\n}\n}\nif (v_texCoord.t \x3c u_resolution.t *2.0) {\nydif[0] \x3d 2.0;\nif (v_texCoord.t \x3c u_resolution.t) {\nydif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.t \x3e 1.0 - u_resolution.t*2.0) {\nydif[0] \x3d -2.0;\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nydif[1] \x3d -1.0;\n}\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[0])) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[0])) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[0])) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[0])) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[0])) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[1])) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[1])) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[1])) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[1])) * u_kernel[8] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[1])) * u_kernel[9] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[2])) * u_kernel[10] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[2])) * u_kernel[11] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[2])) * u_kernel[12] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[2])) * u_kernel[13] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[2])) * u_kernel[14] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[3])) * u_kernel[15] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[3])) * u_kernel[16] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[3])) * u_kernel[17] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[3])) * u_kernel[18] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[3])) * u_kernel[19] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[4])) * u_kernel[20] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[4])) * u_kernel[21] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[4])) * u_kernel[22] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[4])) * u_kernel[23] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[4])) * u_kernel[24];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_kernelSize \x3d\x3d 9){\ngl_FragColor \x3d convolve33();\n}\nelse {\ngl_FragColor \x3d convolve55();\n}\n}",
extractBand:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandIDs[3];\nuniform bool u_alterBand;\nvec4 extractBand() {\nvec4 p \x3d texture2D(u_image, v_texCoord);\nif (!u_alterBand){\nreturn p;\n}\nfloat r, g, b;\nif (u_bandIDs[0] \x3d\x3d0){\nr \x3d p.r;\n}\nelse if (u_bandIDs[0] \x3d\x3d1){\nr \x3d p.g;\n}\nelse if (u_bandIDs[0] \x3d\x3d2){\nr \x3d p.b;\n}\nif (u_bandIDs[1] \x3d\x3d0){\ng \x3d p.r;\n}\nelse if (u_bandIDs[1] \x3d\x3d1){\ng \x3d p.g;\n}\nelse if (u_bandIDs[1] \x3d\x3d2){\ng \x3d p.b;\n}\nif (u_bandIDs[2] \x3d\x3d0){\nb \x3d p.r;\n}\nelse if (u_bandIDs[2] \x3d\x3d1){\nb \x3d p.g;\n}\nelse if (u_bandIDs[2] \x3d\x3d2){\nb \x3d p.b;\n}\nreturn vec4(r, g, b, p.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d extractBand();\n}",
hillshade:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform int u_slopeType;\nuniform int u_hillshadeType;\nuniform int u_lightSourceCount;\nuniform float u_sinZcosA;\nuniform float u_sinZsinA;\nuniform float u_cosZ;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform float u_xFactor;\nuniform float u_yFactor;\nuniform bool u_scaled;\nuniform float u_minValue;\nuniform float u_maxValue;\nuniform bool u_applyColorramp;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvec3 rgb2hsv(vec3 c) {\nvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d \x3d q.x - min(q.w, q.y);\nfloat e \x3d 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {\nfloat clrIndex \x3d clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\nvec4 rgb \x3d texture2D(u_image1, vec2(clrIndex, 0.0));\nvec3 hsv \x3d rgb2hsv(rgb.xyz);\nhsv.z \x3d hillshade;\nreturn vec4(hsv2rgb(hsv) * alpha, alpha);\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 va, vb, vc, vd, ve, vf, vg, vh, vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat dzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_xFactor;\nfloat dzy \x3d (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_yFactor; //flip\nfloat s2 \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\nfloat hillshade \x3d 0.0;\nif (u_hillshadeType \x3d\x3d 0){\nfloat cosDelta \x3d u_sinZsinA * dzy - u_sinZcosA * dzx;\nfloat z \x3d (u_cosZ + cosDelta) / s2;\nif (z \x3c 0.0)  z \x3d 0.0;\nhillshade \x3d z;\n}\nelse if (u_hillshadeType \x3d\x3d 1){\nfor (int k \x3d 0; k \x3c 6; k++) {\nfloat cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\nfloat z \x3d (u_cosZs[k] + cosDelta) / s2;\nif (z \x3c 0.0) z \x3d 0.0;\nhillshade \x3d hillshade + z * u_weights[k];\nif (k \x3d\x3d u_lightSourceCount-1) break;\n}\n}\nif (u_applyColorramp) {\nvec4 result \x3d overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);\nif (u_scaled) {\nresult \x3d vec4(result.rgb * 255.0, result.a);\n}\ngl_FragColor \x3d result;\n} else {\nif (u_scaled) {\nhillshade \x3d hillshade * 255.0;\nif (hillshade\x3e 255.0) {\nhillshade \x3d 255.0;\n}\n}\ngl_FragColor \x3d vec4(hillshade, hillshade, hillshade, alpha);\n}\n}",
identity:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandCount;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d  texture2D(u_image, v_texCoord);\ngl_FragColor \x3d vec4( currentPixel.rgb, currentPixel.a); //encode_float(currentPixel.r);\n}",
local:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 polyfill;\nvec4 localOp1() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nvec4 replaceme1;\nreturn result;\n}\nvec4 localOp2() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 result;\nvec4 replaceme2;\nreturn result;\n}\nvec4 localOp3() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 c \x3d texture2D(u_image2, v_texCoord);\nvec4 result;\nvec4 replaceme3;\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d localOp1();\n}",
local0:"precision mediump float;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_operation;\nuniform int u_constant[3];\nuniform vec4 gamma;\nfloat localOperate1(float a, float b, float c){\nfloat result;\nif (u_operation \x3d\x3d 1){\nresult \x3d a + b;\n}\nelse if (u_operation \x3d\x3d 2){\nresult \x3d a - b;\n}\nelse if (u_operation \x3d\x3d3){\nresult \x3d a * b;\n}\nelse if (u_operation \x3d\x3d4){\nresult \x3d sqrt(a);\n}\nelse if (u_operation \x3d\x3d5){\nresult \x3d pow(a, b);\n}\nelse if (u_operation \x3d\x3d6){\nresult \x3d acos(a);\n}\nelse if (u_operation \x3d\x3d7){\nresult \x3d asin(a);\n}\nelse if (u_operation \x3d\x3d8){\nresult \x3d atan(a);\n}\nelse if (u_operation \x3d\x3d9){\nresult \x3d 999.0; //atanh not available\n}\nelse if (u_operation \x3d\x3d10){\nresult \x3d abs(a);\n}\nelse if (u_operation \x3d\x3d13){\nresult \x3d 999.0; //bitwise not available\n}\nelse if (u_operation \x3d\x3d17){\nresult \x3d a !\x3d 0.0 \x26\x26 b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d18){\nresult \x3d a \x3d\x3d0.0? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d19){\nresult \x3d a !\x3d 0.0 || b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d20){\nresult \x3d a !\x3d 0.0 ^^ b !\x3d0.0; //exclusive or\n}\nelse if (u_operation \x3d\x3d21){\nresult \x3d cos(a);\n}\nelse if (u_operation \x3d\x3d23){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d24){\nresult \x3d a \x3d\x3d b ? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d25){\nresult \x3d exp(a);\n}\nelse if (u_operation \x3d\x3d26){\nresult \x3d pow(10.0, a);\n}\nelse if (u_operation \x3d\x3d27){\nresult \x3d exp2(a);\n}\nelse if (u_operation \x3d\x3d28){\nresult \x3d a \x3e b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d29){\nresult \x3d  a \x3e\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d30){\nresult \x3d floor(a); //int\n}\nelse if (u_operation \x3d\x3d31){\nresult \x3d a \x3d\x3d0? 1.0:0.0; //null pass mask\n}\nelse if (u_operation \x3d\x3d32){\nresult \x3d a; //float\n}\nelse if (u_operation \x3d\x3d33){\nresult \x3d a \x3c b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d34){\nresult \x3d a \x3c\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d35){\nresult \x3d log(a);\n}\nelse if (u_operation \x3d\x3d36){\nresult \x3d log2(a) / log2(10.0);\n}\nelse if (u_operation \x3d\x3d37){\nresult \x3d log2(a);\n}\nelse if (u_operation \x3d\x3d44){\nresult \x3d mod(a, b);\n}\nelse if (u_operation \x3d\x3d45){\nresult \x3d -a;\n}\nelse if (u_operation \x3d\x3d46){\nresult \x3d a !\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d48){\nresult \x3d ceil(a);\n}\nelse if (u_operation \x3d\x3d49){\nresult \x3d floor(a);\n}\nelse if (u_operation \x3d\x3d51){\nresult \x3d sin(a);\n}\nelse if (u_operation \x3d\x3d53){\nresult \x3d a * a;\n}\nelse if (u_operation \x3d\x3d56){\nresult \x3d tan(a);\n}\nelse if (u_operation \x3d\x3d57){\nresult \x3d 999.0; //tanh not available\n}\nelse if (u_operation \x3d\x3d59){\nresult \x3d 999.0; //acosh not available\n}\nelse if (u_operation \x3d\x3d60){\nresult \x3d 999.0; //asinh not available\n}\nelse if (u_operation \x3d\x3d61){\nresult \x3d atan(a, b);\n}\nelse if (u_operation \x3d\x3d64){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d65){\nresult \x3d floor(a/b);\n}\nelse if (u_operation \x3d\x3d76){\nresult \x3d a !\x3d0? b:c;\n}\n}\nvoid main() {\nvec4 currentPixel0 \x3d  texture2D(u_image0, v_texCoord);\nfloat graya, reda, greena, bluea;\nif (u_bandCount \x3d\x3d 1) {\ngraya \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngl_FragColor \x3d vec4(graya, graya, graya, currentPixel.a);\n}\nelse if (u_bandCount \x3d\x3d 3) {\nreda \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngreena \x3d stretchOneaue(float(currentPixel.g), u_minCutOff[1], u_maxCutOff[1], u_minOutput[1], u_maxOutput[1], u_factor[1]);\nbluea \x3d stretchOneaue(float(currentPixel.b), u_minCutOff[2], u_maxCutOff[2], u_minOutput[2], u_maxOutput[2], u_factor[2]);\ngl_FragColor \x3d vec4(reda, greena, bluea, currentPixel.a);\n}\n}",
mask:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_includedRanges[6];\nuniform bool u_includedRanges_specified;\nuniform float u_noDataValues[6];\nuniform bool u_noDataValues_specified;\nuniform int u_noDataInterpretation;\nuniform int u_bandCount;\nvec4 mask() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nvec4 processedPixel \x3d currentPixel;\nif (u_includedRanges_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n} else if (u_bandCount \x3d\x3d 3) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1] \x26\x26 currentPixel.g \x3e u_includedRanges[2] \x26\x26 currentPixel.g \x3c u_includedRanges[3] \x26\x26 currentPixel.b \x3e u_includedRanges[4] \x26\x26 currentPixel.b \x3c u_includedRanges[5])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n}\n}\nif (u_noDataValues_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (processedPixel.r \x3d\x3d u_noDataValues[0])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n} else if (u_bandCount \x3d\x3d 3) {\nif (u_noDataInterpretation \x3d\x3d1 \x26\x26 processedPixel.r \x3d\x3d u_noDataValues[0] \x26\x26 processedPixel.g \x3d\x3d u_noDataValues[1] \x26\x26 processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse if (processedPixel.r \x3d\x3d u_noDataValues[0] || processedPixel.g \x3d\x3d u_noDataValues[1] || processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n}\n}\nreturn processedPixel;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d mask();\n}",
ndvi:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_red;\nuniform int u_bandId_nir;\nuniform bool u_scaled;\nuniform int u_bandCount;\nvec4 calculateNDVI(){\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n}\nelse {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateNDVI();\n}",
remap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform float u_breaks[16];\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getRemapIndex(float pixelValue) {\nif (pixelValue \x3c u_breaks[0] || pixelValue \x3e u_breaks[15]) {\nreturn -1.0;\n}\nfor (int i \x3d 0; i \x3c 16; i++) {\nif (pixelValue \x3c u_breaks[i]) {\nreturn float(i - 1);\n}\n}\nif (pixelValue \x3d\x3d u_breaks[15]) {\nreturn 15.0;\n}\nreturn 0.0;\n}\nvec4 colorize(float pv) {\nfloat clrIndex \x3d pv - u_indexedColormapOffset;\nvec4 result;\nif (clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nif (currentPixel.a \x3d\x3d 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nfloat remappedIndex \x3d getRemapIndex(currentPixel.r);\nif (remappedIndex \x3c 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\ngl_FragColor \x3d colorize(remappedIndex);\n}",
resample:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resamplingRatio;\nuniform int u_resamplingType;\nuniform vec2 u_anchor;\nuniform vec2 u_resolution;\nvec4 resample(){\nvec2 pos_nn, pos_ul, pos_ur, pos_ll, pos_lr, pos_offset;\nfloat weight,weight_total, weight_ul, weight_ur, weight_ll, weight_lr;\nvec4 vp;  //v_texCoord is canvas space 0-1\nvec2 originalResolution \x3d vec2(u_resolution.s*u_resamplingRatio.s, u_resolution.t*u_resamplingRatio.t);\nvec2 pos \x3d vec2(u_anchor.s+(v_texCoord.s-u_anchor.s),(u_anchor.t+(v_texCoord.t-u_anchor.t)));\nif (u_resamplingType \x3d\x3d 0)\n{//shift and scaling, y \x3d ax+b so x \x3d (y-b)/a\npos_nn \x3d vec2(floor(pos.s/originalResolution.s+0.5)*originalResolution.s,floor(pos.t/originalResolution.t+0.5)*originalResolution.t);\nif (pos_nn.s \x3c0.0 || pos_nn.s \x3e 1.0 || pos_nn.t \x3c0.0 || pos_nn.t \x3e 1.0){\nvp \x3d vec4(1.0, 0.0, 0.0, 1.0);//vec4(0.0, 1.0, 0.0, vp.a);\n}\nelse {\nvp \x3d texture2D(u_image, vec2(pos_nn.s, pos_nn.t));\n}\n}\nelse if (u_resamplingType \x3d\x3d 1)\n{//shift and scaling, 4 neighbors y \x3d ax+b so x \x3d (y-b)/a\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t);\npos_ur \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t);\npos_ll \x3d vec2(pos_ul.s, pos_ul.t+originalResolution.t);\npos_lr \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t+originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nweight_lr \x3d sqrt(pow(pos_offset.s,2.0) + pow(pos_offset.t,2.0));\nweight_ul \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(originalResolution.t- pos_offset.t,2.0));\nweight_ur \x3d sqrt(pow( pos_offset.s,2.0)+ 1.0- pow(originalResolution.t - pos_offset.t,2.0));\nweight_ll \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(pos_offset.t,2.0));\nvp \x3d (texture2D(u_image, pos_ul) * weight_ul + texture2D(u_image, pos_ur) * weight_ur + texture2D(u_image, pos_ll) * weight_ll + texture2D(u_image, pos_lr) * weight_lr)/(weight_ul+weight_ur+weight_ll+weight_lr);\n}\nelse if (u_resamplingType \x3d\x3d 2)\n{//shift and scaling, 16 neighbors\nweight_total \x3d 0.0;\nvp \x3d vec4(0.0,0.0,0.0,0.0);\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s-originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t-originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nfor (int i\x3d0; i\x3c4; i++){//row\nfor (int j\x3d0; j\x3c4; j++){//col\nweight \x3d sqrt(pow(pos_offset.s-float(j),2.0)+ pow(pos_offset.t-float(i),2.0));\nvp +\x3dtexture2D(u_image, vec2(pos_ul.s+float(i)*originalResolution.s,pos_ul.t+float(j)*originalResolution.t)) * weight;\nweight_total +\x3d weight;\n}\n}\nvp \x3d vp/weight_total;\n}\nreturn vp;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d resample();\n}",
slope:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nuniform float u_zfactor;\nuniform float u_altitude;\nuniform float u_azimuth;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nvec4 calculateSlope() {\nfloat pi \x3d 3.141592653589793238;\nfloat dzx \x3d 0.0;\nfloat dzy \x3d 0.0;\nvec4 va,  vb,  vc,  vd,  ve,  vf,  vg,  vh,  vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0 - u_resolution.s) \x3e\x3d v_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0 - u_resolution.t) \x3e\x3d v_texCoord.t) {\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\n}\ndzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r / (8.0 * u_cellSize[0]);\ndzy \x3d -(vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r / (8.0 * u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat slope \x3d atan(u_zfactor * sqrt(dzx * dzx + dzy * dzy)) * 57.2957795;\nreturn vec4(slope, slope, slope, alpha);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateSlope();\n}",
stretch:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_bandCount;\nuniform vec2 u_sourceDim;\nuniform vec2 u_targetDim;\nuniform int u_state;\nuniform bool u_minMaxTexture;\nuniform bool u_useGamma;\nuniform float u_gamma[4];\nuniform float u_gammaCorrection[4];\nuniform bool u_scaled;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nif (u_bandCount \x3d\x3d 1) {\nfloat alpha \x3d vp_ul.a * vp_ur.a * vp_ll.a * vp_lr.a;\nvec4 vp_nn \x3d texture2D(u_image, coords);\nreturn alpha \x3d\x3d 0.0 ? vp_nn : vec4(vp.rgb, alpha);\n}\nreturn vp;\n}\nvec4 findMin(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r),min(p1.g, p2.g),min(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(max(p1.r, p2.r),max(p1.g, p2.g),max(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMinMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r), max(p1.g, p2.g), 0.0, p1.a);\n}\n}\nvec4 minMax(int state) {\nvec2 pixelFract \x3d fract(v_texCoord * u_sourceDim);\nfloat xshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.s; //take left pixel if \x3e 0.5\nfloat yshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.t; //take bottom pixel if \x3e 0.5\nif (u_sourceDim.s \x3d\x3d 1.0) {\nxshift \x3d 0.0;\n}\nif (u_sourceDim.t \x3d\x3d 1.0) {\nyshift \x3d 0.0;\n}\nvec4 p1 \x3d texture2D(u_image, v_texCoord);\nvec4 p2 \x3d texture2D(u_image, v_texCoord + vec2(xshift, 0.0));\nvec4 p3 \x3d texture2D(u_image, v_texCoord + vec2(0.0, yshift));\nvec4 p4 \x3d texture2D(u_image, v_texCoord + vec2(xshift, yshift));\nvec4 pval;\nif (state \x3d\x3d 2) {\npval \x3d findMinMax(findMinMax(p1, p2), findMinMax(p3, p4));\n} else if (state \x3d\x3d 1) {\npval \x3d findMax(findMax(p1, p2), findMax(p3, p4));\n} else if (state \x3d\x3d 0) {\npval \x3d findMin(findMin(p1, p2), findMin(p3, p4));\n}\nreturn pval;\n}\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool scaled) {\nfloat stretchedVal;\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n} else if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nfloat stretchOneValueGamma(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, float gamma, float gammaCorrection, bool scaled) {\nfloat stretchedVal;\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nif (gamma \x3e 1.0) {\ntempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n}\nstretchedVal \x3d floor(tempf * outRange * pow(relativeVal, 1.0 / gamma)) + minOutput;\n}\nelse if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_state \x3d\x3d 100) {\nvec4 currentPixel \x3d getPixelValue(v_texCoord);\nfloat grayVal,\nredVal,\ngreenVal,\nblueVal;\nfloat min0,\nmax0,\nmin1,\nmax1,\nmin2,\nmax2,\nfactor0,\nfactor1,\nfactor2;\nvec4 minV, maxV;\nif (u_minMaxTexture) {\nif (u_bandCount \x3d\x3d 1) {\nminV \x3d texture2D(u_image1, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d minV.g;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\n} else {\nminV \x3d texture2D(u_image1, v_texCoord);\nmaxV \x3d texture2D(u_image2, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d maxV.r;\nmin1 \x3d minV.g;\nmax1 \x3d maxV.g;\nmin2 \x3d minV.b;\nmax2 \x3d maxV.b;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\nfactor1 \x3d (u_maxOutput[1] - u_minOutput[1]) / (max1 - min1);\nfactor2 \x3d (u_maxOutput[2] - u_minOutput[2]) / (max2 - min2);\n}\n} else {\nmin0 \x3d u_minCutOff[0];\nmax0 \x3d u_maxCutOff[0];\nmin1 \x3d u_minCutOff[1];\nmax1 \x3d u_maxCutOff[1];\nmin2 \x3d u_minCutOff[2];\nmax2 \x3d u_maxCutOff[2];\nfactor0 \x3d u_factor[0];\nfactor1 \x3d u_factor[1];\nfactor2 \x3d u_factor[2];\n}\nif (u_useGamma){\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngreenVal \x3d stretchOneValueGamma(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_gamma[1], u_gammaCorrection[1], u_scaled);\nblueVal \x3d stretchOneValueGamma(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_gamma[1], u_gammaCorrection[2], u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\nelse {\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngreenVal \x3d stretchOneValue(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_scaled);\nblueVal \x3d stretchOneValue(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\n} else {\nvec4 currentPixel \x3d minMax(u_state);\ngl_FragColor \x3d currentPixel;\n}\n}"}})},
"esri/layers/rasterLib/function/RasterFunctionWebGLMixin":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ./pixelShaders ./vertexShaders ./webglHelper ./convolutionKernel".split(" "),function(G,u,r,n,m,k,d){return G(null,{gl:null,rgbaFloatData:null,originalTexture:null,lastTexture:null,renderTexture:!1,constructor:function(a){this._isProgramInitialized=!1;this.gl=a&&a.gl;a&&a.renderTexture&&(this.renderTexture=a.renderTexture);this._xformSetting=a&&a._xformSetting||{requireProjection:!1,
meshSize:[20,20]}},bindFrameBuffer:function(){var a=this.gl;this._setupPingPongTextures();this._setupBranchingTextures();var b=this._glSetting;this.isBranch?(b.branchIndex=(b.branchIndex+1)%b.branchCount,b=b.branches[b.branchIndex]):(b.pingpongIndex=(b.pingpongIndex+1)%b.pingpong.length,b=b.pingpong[b.pingpongIndex]);a.bindFramebuffer(a.FRAMEBUFFER,b.frameBuffer);a.viewport(0,0,a.drawingBufferWidth,a.drawingBufferHeight);return b},_initializeProgram:function(a){if(this.gl)try{var b=this.gl;b.viewport(0,
0,b.drawingBufferWidth,b.drawingBufferHeight);var e=this._glSetting.programUniforms,g="local"===this.functionName?"local"+this.functionArguments.operation:this.functionName,h=e[g];if(h)this._uniforms=h.uniforms,this.rasterProgram=h.program;else{var c=(this._useMesh=this._tileMode&&this._xformSetting.requireProjection)?m.mesh:m.basic,f=m.getShader(b,a.vertex||c),l=n.getShader(b,a.fragment),q=this._loadProgram(f,l),t={rasterProgram:k.getUniforms(b,q)};e[g]={uniforms:t,program:q};this.rasterProgram=
q;this._uniforms=t}b.useProgram(this.rasterProgram);var v=b.getAttribLocation(this.rasterProgram,"a_texCoord"),w=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,w);var x=k.createMesh(this._xformSetting.meshSize);b.bufferData(b.ARRAY_BUFFER,x,b.STATIC_DRAW);b.enableVertexAttribArray(v);b.vertexAttribPointer(v,2,b.FLOAT,!1,0,0);b.disable(b.DEPTH_TEST);b.blendFunc(b.SRC_ALPHA,b.ZERO);b.disable(b.BLEND);b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!1);this._shaderInfo=
{fragment:a.fragmentName}}catch(H){console.error("webgl exception: "+H.message)}else console.error("WebGL is required.")},_setUniform:function(a,b,e){null!=b&&(e&&!this._uniforms[e]&&(this._uniforms[e]=k.getUniforms(this.gl,this[e])),e=e?this._uniforms[e]:this._uniforms.rasterProgram,(a=e[a]||e[a+"[0]"])&&k.setUniform(this.gl,a,b))},_setUniforms:function(a,b){var e=Object.keys(a),g,h=e.length;for(g=0;g<h;g++)this._setUniform(e[g],a[e[g]],b);this.rawInput?this._setUniform("u_flipY",!0,b):this._setUniform("u_flipY",
!1,b);this._tileMode?(this.rawInput?(a=this._xformSetting.offset,e=this._xformSetting.scale):(a=[0,0],e=[1,1]),this._setUniform("u_xformOffset",a,b),this._setUniform("u_xformScale",e,b),this._xformSetting.requireProjection&&(this.rawInput?(this._setupXformTexture(),this._setUniform("u_projection",!0,b),this._setUniform("u_transformGridSize",this._xformSetting.gridConfig.size,b),this._setUniform("u_transformSpacing",this._xformSetting.gridConfig.spacing,b),this._setUniform("u_targetImageSize",new Float32Array([this.gl.drawingBufferWidth,
this.gl.drawingBufferHeight]),b)):this._setUniform("u_projection",!1,b))):(a=[0,0],e=[1,1],this._setUniform("u_xformOffset",a,b),this._setUniform("u_xformScale",e,b));this.rawInput&&this._rawResolution&&("RSP_BilinearInterpolation"===this.interpolation||"RSP_CubicConvolution"===this.interpolation)?(this._setUniform("u_resampling",1),this._setUniform("u_rawResolution",this._rawResolution)):this._setUniform("u_resampling",0)},_setupTextureData:function(a,b){if(a.texture)return a;a.raster&&a.raster.pixelBlock&&
(a=a.raster);this.rawInput=!0;var e=b&&b.notOriginal,g=b&&b.bandIDs;b&&b.reCreate?b=!1:(b=this._tileMode?!this._xformSetting.hasNewTexture:!this._glSetting.hasNewTexture)&&this._originalBandIDs&&(b=g?this._originalBandIDs.join("")===g.join(""):!1);0<this._glSetting.branchCount&&(b=!1);if(b&&this.originalTexture)return{extent:a.extent,texture:this.originalTexture};b=this._createTexture();e||(this.originalTexture=b,this._originalBandIDs=g);e=this.gl;var h=a.pixelBlock;this._rawResolution=h?[1/a.pixelBlock.width,
1/a.pixelBlock.height]:[1/this.gl.drawingBufferWidth,1/this.gl.drawingBufferHeight];var c=0;g&&0<g.length&&h&&(c=Math.max.apply(null,g),h.pixels.length>c&&g&&(h.pixels=g.map(function(l){return h.pixels[l]}),h.statistics&&(h.statistics=g.map(function(l){return h.statistics[l]}))));g=h.width;c=h.height;e.getExtension("OES_texture_float");var f=h.getAsRGBAFloat();e.texImage2D(e.TEXTURE_2D,0,e.RGBA,g,c,0,e.RGBA,e.FLOAT,f);return{extent:a.extent,texture:b}},_setupPingPongTextures:function(){var a=this._glSetting;
if(!a||!a.pingpong){a.pingpong=[];var b=k.createBufferTexture(this.gl,!1);a.pingpong.push(b);b=k.createBufferTexture(this.gl,!1);a.pingpong.push(b);a.pingpongIndex=1}},_setupBranchingTextures:function(){var a=this._glSetting;if(!a||!a.branches){a.branches=[];var b=0,e=a.branchCount;if(0<e){for(b=0;b<e;b++){var g=k.createBufferTexture(this.gl,!1);a.branches.push(g)}a.branchIndex=e-1}}},_setupXformTexture:function(a){for(var b=this._createTexture(),e=this.gl,g=4*this._xformSetting.gridConfig.size[0],
h=this._xformSetting.gridConfig.size[1],c=new Float32Array(g*h*4),f=0,l=0;l<this._xformSetting.gridConfig.coefficients.length;l++)c[f++]=this._xformSetting.gridConfig.coefficients[l],2===l%3&&(c[f++]=1);e.getExtension("OES_texture_float");e.texImage2D(e.TEXTURE_2D,0,e.RGBA,g,h,0,e.RGBA,e.FLOAT,c);this._bindTexture(b,"u_transformGrid",a)},_createTexture:function(a){return k.createTexture(this.gl,a)},_bindTexture:function(a,b,e){b=b||"u_image";e=this._uniforms[e||"rasterProgram"];var g=this._getTextureIndex(b);
if(-1!==g){var h=this.gl;h.uniform1i(e[b].location,g);h.activeTexture(h.TEXTURE0+g);h.bindTexture(h.TEXTURE_2D,a)}},_getTextureIndex:function(a,b){b=this._uniforms[b||"rasterProgram"];if(!b||!b[a]||b[a].info.type!==this.gl.SAMPLER_2D)return-1;if("u_transformGrid"===a)return 0;a="u_image"===a?0:parseInt(a.replace("u_image",""));return this._xformSetting.requireProjection?a+1:a},_drawGL:function(a){var b=this.gl;this.renderTexture?(b.enable(b.BLEND),b.bindFramebuffer(b.FRAMEBUFFER,null)):b.disable(b.BLEND);
a||b.viewport(0,0,b.drawingBufferWidth,b.drawingBufferHeight);a=this._xformSetting.meshSize||[1,1];b.drawArrays(b.TRIANGLES,0,a[0]*a[1]*6);this._drawMesh()},_drawMesh:function(){if(this.renderTexture&&this._glSetting.drawMesh){this.meshProgram=this.meshProgram||this._setupMeshProgram();var a=this.gl;a.useProgram(this.meshProgram);a.bindFramebuffer(a.FRAMEBUFFER,null);var b=a.getAttribLocation(this.meshProgram,"a_texCoord"),e=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,e);e=this._xformSetting.meshSize||
[1,1];var g=k.createMesh(e,!0);a.bufferData(a.ARRAY_BUFFER,g,a.STATIC_DRAW);a.enableVertexAttribArray(b);a.vertexAttribPointer(b,2,a.FLOAT,!1,0,0);a.disable(a.DEPTH_TEST);a.blendFunc(a.ONE,a.ZERO);this._setUniforms({u_color:[0,0,1,1],u_drawMeshLines:!0},"meshProgram");a.drawArrays(a.LINES,0,e[0]*e[1]*10)}},_setupMeshProgram:function(){var a=m.getShader(this.gl,m.mesh),b=n.getShader(this.gl,n.constant);return this._loadProgram(a,b)},_loadProgram:function(a,b){return k.loadProgram(this.gl,a,b)},_getShaderScript:function(a,
b){b=document.getElementById(b);if(!b)return null;a="";for(b=b.firstChild;b;)3==b.nodeType&&(a+=b.textContent),b=b.nextSibling;return a}})})},"esri/layers/rasterLib/function/vertexShaders":function(){define(["dojo/_base/declare","dojo/_base/lang","./vertexShaderScripts"],function(G,u,r){G={shaderType:"vertex",getShader:function(n,m){var k=n.createShader(n.VERTEX_SHADER);n.shaderSource(k,m);n.compileShader(k);n.getShaderParameter(k,n.COMPILE_STATUS)||(k=null);return k}};u.mixin(G,r);return G})},"esri/layers/rasterLib/function/vertexShaderScripts":function(){define([],
function(){return{basic:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform bool u_flipY;\nvoid main() {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}",histogram:"attribute float a_pixelIndex;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nuniform vec2 u_sourceDim;\nuniform vec2 u_halfPixel;\nuniform vec4 u_bandSelection;\nuniform vec4 u_mins;\nuniform vec4 u_factors;\nuniform float u_size;\nuniform int u_bandCount;\nuniform bool u_minMaxTexture;\nvoid main() {\nfloat row \x3d a_pixelIndex/u_sourceDim.s;\nvec2 coord \x3d vec2(fract(row), floor(row)/u_sourceDim.t);\nvec4 pv \x3d texture2D(u_image, coord + u_halfPixel);\nvec4 minVal, maxVal, pvm;\nif (u_minMaxTexture){\nif (u_bandCount \x3d\x3d1){ //min \x3d red, max \x3d green\nvec4 minmax \x3d texture2D(u_image1, vec2(0.5,0.5));\nminVal \x3d vec4(minmax.r, minmax.r, minmax.r, 0.0);\nmaxVal \x3d vec4(minmax.g, minmax.g, minmax.g, 0.0);\n}\nelse if (u_bandCount \x3d\x3d3){ //min \x3d red, max \x3d green\nminVal \x3d texture2D(u_image1, vec2(0.5,0.5));\nmaxVal \x3d texture2D(u_image2, vec2(0.5,0.5));\n}\nvec4 factors \x3d u_size/(maxVal-minVal+vec4(0.0,0.0,0.0,1.0)) * u_factors;\npvm \x3d (pv - minVal) * factors;\n}\nelse {\npvm \x3d (pv - u_mins) * u_factors;\n}\nfloat histVal \x3d min(floor(pvm.r+pvm.g+pvm.b), u_size-1.0);\nhistVal \x3d pv.a \x3d\x3d 1.0? histVal: u_size;\ngl_Position \x3d vec4((histVal+0.1) / (u_size+1.0) * 2.0 - 1.0, 0.5, 0, 1);\ngl_PointSize \x3d 1.0;\n}",
mesh:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform bool u_drawMeshLines;\nuniform bool u_flipY;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nuniform vec2 u_srcImageSize;\nuniform bool u_projection;\nvec2 projectPixelLocation(vec2 coords) {\nvec2 index_image \x3d floor(coords * u_targetImageSize);\nvec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\nif (pos.s \x3c\x3d pos.t) {\nvec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;// + halfPixel;\n}\nvoid main() {\nif (u_projection) {\nv_texCoord \x3d projectPixelLocation(a_texCoord);\n} else {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\n}\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\nif (u_drawMeshLines){\nvec2 adjustedPos \x3d (v_texCoord - u_xformOffset) / u_xformScale;\ngl_Position \x3d vec4( adjustedPos * 2.0 - 1.0, 0.0, 1.0);\n}\nelse {\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}\n}"}})},
"esri/layers/rasterLib/function/webglHelper":function(){define([],function(){var G={getUniforms:function(u,r){var n=u.getProgramParameter(r,u.ACTIVE_UNIFORMS),m,k,d={};for(m=0;m<n;m++)(k=u.getActiveUniform(r,m))&&(d[k.name]={location:u.getUniformLocation(r,k.name),info:k});return d},setUniform:function(u,r,n){var m=r.info,k=r.location,d=m.type;if(null==n)console.log("uniform "+r.info.name+" has null or undefined value");else switch(d){case u.FLOAT:1<m.size?0===n.length?console.log("uniform "+r.info.name+
" has length 0"):u.uniform1fv(k,n):u.uniform1f(k,n);break;case u.FLOAT_VEC2:if(0===n.length){console.log("uniform "+r.info.name+" has length 0");break}u.uniform2fv(k,n);break;case u.FLOAT_VEC3:if(0===n.length){console.log("uniform "+r.info.name+" has length 0");break}u.uniform3fv(k,n);break;case u.FLOAT_VEC4:if(0===n.length){console.log("uniform "+r.info.name+" has length 0");break}u.uniform4fv(k,n);break;case u.INT:case u.BOOL:1<m.size?0===n.length?console.log("uniform "+r.info.name+" has length 0"):
u.uniform1iv(k,n):u.uniform1i(k,n);break;case u.INT_VEC2:case u.BOOL_VEC2:if(0===n.length){console.log("uniform "+r.info.name+" has length 0");break}u.uniform2iv(k,n);break;case u.INT_VEC3:case u.BOOL_VEC3:if(0===n.length){console.log("uniform "+r.info.name+" has length 0");break}u.uniform3iv(k,n);break;case u.INT_VEC4:case u.BOOL_VEC4:0===n.length?console.log("uniform "+r.info.name+" has length 0"):u.uniform4iv(k,n)}},createTexture:function(u,r){var n=u.createTexture();u.bindTexture(u.TEXTURE_2D,
n);u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE);u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE);u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,r?u.LINEAR:u.NEAREST);u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,r?u.LINEAR:u.NEAREST);return n},createBufferTexture:function(u,r,n){r=G.createTexture(u,r);u.getExtension("OES_texture_float");n=n||[u.drawingBufferWidth,u.drawingBufferHeight];u.texImage2D(u.TEXTURE_2D,0,u.RGBA,n[0],n[1],0,u.RGBA,u.FLOAT,null);n=u.createFramebuffer();
u.bindFramebuffer(u.FRAMEBUFFER,n);u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,r,0);return{texture:r,frameBuffer:n}},getShader:function(u,r,n){n=n?u.createShader(u.VERTEX_SHADER):u.createShader(u.FRAGMENT_SHADER);u.shaderSource(n,r);u.compileShader(n);u.getShaderParameter(n,u.COMPILE_STATUS)||(console.log(u.getShaderInfoLog(n)),n=null);return n},loadProgram:function(u,r,n){var m=u.createProgram();u.attachShader(m,r);u.attachShader(m,n);u.linkProgram(m);u.getProgramParameter(m,
u.LINK_STATUS)||(console.warn("failed to load webgl program: "+u.getProgramInfoLog(m)),u.deleteProgram(m),m=null);return m},createMesh:function(u,r){if(!u||1===u[0]&&1===u[1])return new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]);var n=u&&r?new Float32Array(u[0]*u[1]*20):new Float32Array(u[0]*u[1]*12);var m=.9998/u[1],k=.9998/u[0],d,a,b=0;for(d=0;d<u[1];d++)for(a=0;a<u[0];a++){var e=1E-4+m*d;var g=1E-4+k*a;u&&!r?(n[b++]=e,n[b++]=g,n[b++]=e+m,n[b++]=g,n[b++]=e,n[b++]=g+k,n[b++]=e,n[b++]=g+k,n[b++]=e+m,
n[b++]=g,n[b++]=e+m,n[b++]=g+k):(n[b++]=e,n[b++]=g,n[b++]=e,n[b++]=g+k,n[b++]=e,n[b++]=g+k,n[b++]=e+m,n[b++]=g+k,n[b++]=e+m,n[b++]=g+k,n[b++]=e+m,n[b++]=g,n[b++]=e,n[b++]=g,n[b++]=e+m,n[b++]=g,n[b++]=e,n[b++]=g+k,n[b++]=e+m,n[b++]=g)}return n}};return G})},"esri/layers/rasterLib/function/convolutionKernel":function(){define([],function(){var G={Default:[0,0,0,0,1,0,0,0,0],LineDetectionHorizontal:[-1,-1,-1,2,2,2,-1,-1,-1],LineDetectionVertical:[-1,2,-1,-1,2,-1,-1,2,-1],LineDetectionLeftDiagonal:[2,
-1,-1,-1,2,-1,-1,-1,2],LineDetectionRightDiagonal:[-1,-1,2,-1,2,-1,2,-1,-1],GradientNorth:[-1,-2,-1,0,0,0,1,2,1],GradientWest:[-1,0,1,-2,0,2,-1,0,1],GradientEast:[1,0,-1,2,0,-2,1,0,-1],GradientSouth:[1,2,1,0,0,0,-1,-2,-1],GradientNorthEast:[0,-1,-2,1,0,-1,2,1,0],GradientNorthWest:[-2,-1,0,-1,0,1,0,1,2],SmoothArithmeticMean:[.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111],Smoothing3x3:[.0625,.125,.0625,.125,.25,.125,.0625,
.125,.0625],Smoothing5x5:[1,1,1,1,1,1,4,4,4,1,1,4,12,4,1,1,4,4,4,1,1,1,1,1,1],Sharpening3x3:[-1,-1,-1,-1,9,-1,-1,-1,-1],Sharpening5x5:[-1,-3,-4,-3,-1,-3,0,6,0,-3,-4,6,21,6,-4,-3,0,6,0,-3,-1,-3,-4,-3,-1],Laplacian3x3:[0,-1,0,-1,4,-1,0,-1,0],Laplacian5x5:[0,0,-1,0,0,0,-1,-2,-1,0,-1,-2,17,-2,-1,0,-1,-2,-1,0,0,0,-1,0,0],SobelHorizontal:[-1,-2,-1,0,0,0,1,2,1],SobelVertical:[-1,0,1,-2,0,2,-1,0,1],Sharpen:[0,-.25,0,-.25,2,-.25,0,-.25,0],Sharpen2:[-.25,-.25,-.25,-.25,3,-.25,-.25,-.25,-.25],PointSpread:[-.627,
.352,-.627,.352,2.923,.352,-.627,.352,-.627],getKernel:function(u){switch(u){case 0:return G.LineDetectionHorizontal;case 1:return G.LineDetectionVertical;case 2:return G.LineDetectionLeftDiagonal;case 3:return G.LineDetectionRightDiagonal;case 4:return G.GradientNorth;case 5:return G.GradientWest;case 6:return G.GradientEast;case 7:return G.GradientSouth;case 8:return G.GradientNorthEast;case 9:return G.GradientNorthWest;case 10:return G.SmoothArithmeticMean;case 11:return G.Smoothing3x3;case 12:return G.Smoothing5x5;
case 13:return G.Sharpening3x3;case 14:return G.Sharpening5x5;case 15:return G.Laplacian3x3;case 16:return G.Laplacian5x5;case 17:return G.SobelHorizontal;case 18:return G.SobelVertical;case 19:return G.Sharpen;case 20:return G.Sharpen2;case 21:return G.PointSpread;default:return G.Default}}};return G})},"esri/layers/rasterLib/function/surfaceUtils":function(){define(["dojo/_base/lang"],function(G){return{hillshade:function(u,r){if(null!==u&&null!==u.pixelBlock&&null!==u.pixelBlock.pixels){var n=
this._clonePixelBlock(u.pixelBlock),m=r.altitude,k=r.azimuth,d=r.zFactor,a=r.psPower,b=r.psFactor,e=r.hillshadeType,g=r.slopeType,h=r.isGCS;1===e&&(d*=2);r=n.width;var c=n.height,f=n.pixels[0],l=n.mask,q=new Uint8Array(r*c);l&&q.set(l);var t=new Uint8Array(r*c),v=(u.extent.xmax-u.extent.xmin)/r,w=(u.extent.ymax-u.extent.ymin)/c,x=d/(8*v),H=d/(8*w);.001<d&&h&&(x/=111E3,H/=111E3);3===g&&(h?(x=111E3*v,H=111E3*w,x=(d+Math.pow(x,a)*b)/(8*x),H=(d+Math.pow(H,a)*b)/(8*H)):(x=(d+Math.pow(v,a)*b)/(8*v),H=(d+
Math.pow(w,a)*b)/(8*w)));h=(90-m)*Math.PI/180;m=Math.cos(h);var A=(360-k+90)*Math.PI/180;k=Math.sin(h)*Math.cos(A);h=Math.sin(h)*Math.sin(A);d=[];a=[];b=[];v=[315,270,225,360,180,0];var z=[60,60,60,60,60,90];g=[3,5,3,2,1,4];var E=g.reduce(function(y,B){return y+B});w=g.map(function(y){return y/E});if(1===e){var J=v.length;for(g=0;g<J;g++)m=z[g],k=v[g],h=(90-m)*Math.PI/180,m=Math.cos(h),A=(360-k+90)*Math.PI/180,k=Math.sin(h)*Math.cos(A),h=Math.sin(h)*Math.sin(A),d.push(m),a.push(k),b.push(h)}var D=
0;for(g=1;g<c-1;g++)for(z=g*r,v=1;v<r-1;v++)if(l&&!l[z+v])t[z+v]=0;else{A=0;if(l&&(A=l[z-r+v-1]+l[z-r+v]+l[z-r+v+1]+l[z+v-1]+l[z+v+1]+l[z+r+v-1]+l[z+r+v]+l[z+r+v+1],7>A)){t[z+v]=0;q[z+v]=0;continue}if(7===A){var L=l[z-r+v-1]?f[z-r+v-1]:f[z+v];var C=l[z-r+v]?f[z-r+v]:f[z+v];var N=l[z-r+v+1]?f[z-r+v+1]:f[z+v];A=l[z+v-1]?f[z+v-1]:f[z+v];var S=l[z+v+1]?f[z+v+1]:f[z+v];D=l[z+r+v-1]?f[z+r+v-1]:f[z+v];var F=l[z+r+v]?f[z+r+v]:f[z+v];var T=l[z+r+v+1]?f[z+r+v+1]:f[z+v]}else L=f[z-r+v-1],C=f[z-r+v],N=f[z-r+
v+1],A=f[z+v-1],S=f[z+v+1],D=f[z+r+v-1],F=f[z+r+v],T=f[z+r+v+1];A=(N+S+S+T-(L+A+A+D))*x;C=(D+F+F+T-(L+C+C+N))*H;N=Math.sqrt(1+A*A+C*C);D=0;if(0===e)F=h*C-k*A,F=255*(m+F)/N,0>F&&(F=0),D=F;else if(1===e)for(L=0;L<J;L++)F=b[L]*C-a[L]*A,F=255*(d[L]+F)/N,0>F&&(F=0),D+=F*w[L];t[z+v]=D}for(g=0;g<c;g++)t[g*r]=t[g*r+1],t[(g+1)*r-1]=t[(g+1)*r-2];for(g=1;g<r-1;g++)t[g]=t[g+r],t[g+(c-1)*r]=t[g+(c-2)*r];n.pixelType="U8";n.pixels=[t];n.statistics=[{minValue:0,maxValue:255}];l&&(n.mask=q);return{extent:u.extent,
pixelBlock:n}}},slope:function(u,r){if(null!==u&&null!==u.pixelBlock&&null!==u.pixelBlock.pixels){var n=this._clonePixelBlock(u.pixelBlock),m=r.zFactor,k=r.psPower,d=r.psFactor,a=r.slopeType,b=r.isGCS;r=n.width;var e=n.height,g=n.pixels[0],h=n.mask,c=new Uint8Array(r*e);h&&c.set(h);var f=new Float32Array(r*e),l=(u.extent.xmax-u.extent.xmin)/r,q=(u.extent.ymax-u.extent.ymin)/e,t=m/(8*l),v=m/(8*q);1E-4>Math.abs(m-1)&&b&&(t/=111E3,v/=111E3);3===a&&(b?(t=111E3*l,v=111E3*q,t=(m+Math.pow(t,k)*d)/(8*t),
v=(m+Math.pow(v,k)*d)/(8*v)):(t=(m+Math.pow(l,k)*d)/(8*l),v=(m+Math.pow(q,k)*d)/(8*q)));for(m=1;m<e-1;m++)for(d=m*r,k=1;k<r-1;k++)if(h&&!h[d+k])f[d+k]=0;else{q=0;if(h&&(q=h[d-r+k-1]+h[d-r+k]+h[d-r+k+1]+h[d+k-1]+h[d+k+1]+h[d+r+k-1]+h[d+r+k]+h[d+r+k+1],7>q)){f[d+k]=0;c[d+k]=0;continue}if(7===q){q=h[d-r+k-1]?g[d-r+k-1]:g[d+k];b=h[d-r+k]?g[d-r+k]:g[d+k];l=h[d-r+k+1]?g[d-r+k+1]:g[d+k];var w=h[d+k-1]?g[d+k-1]:g[d+k];var x=h[d+k+1]?g[d+k+1]:g[d+k];var H=h[d+r+k-1]?g[d+r+k-1]:g[d+k];var A=h[d+r+k]?g[d+r+
k]:g[d+k];var z=h[d+r+k+1]?g[d+r+k+1]:g[d+k]}else q=g[d-r+k-1],b=g[d-r+k],l=g[d-r+k+1],w=g[d+k-1],x=g[d+k+1],H=g[d+r+k-1],A=g[d+r+k],z=g[d+r+k+1];w=(l+x+x+z-(q+w+w+H))*t;q=(H+A+A+z-(q+b+b+l))*v;q=Math.sqrt(w*w+q*q);f[d+k]=1===a||3===a?57.2957795*Math.atan(q):100*q}for(m=0;m<e;m++)f[m*r]=f[m*r+1],f[(m+1)*r-1]=f[(m+1)*r-2];for(m=1;m<r-1;m++)f[m]=f[m+r],f[m+(e-1)*r]=f[m+(e-2)*r];n.pixelType="F32";n.pixels=[f];n.statistics=[{minValue:0,maxValue:255}];h&&(n.mask=c);return{extent:u.extent,pixelBlock:n}}},
aspect:function(u){if(null!==u&&null!==u.pixelBlock&&null!==u.pixelBlock.pixels){var r=this._clonePixelBlock(u.pixelBlock),n=r.width,m=r.height,k=r.pixels[0],d=r.mask,a=new Uint8Array(n*m);d&&a.set(d);var b=new Float32Array(n*m),e=1/((u.extent.xmax-u.extent.xmin)/n),g=1/((u.extent.ymax-u.extent.ymin)/m),h,c;for(h=1;h<m-1;h++){var f=h*n;for(c=1;c<n-1;c++)if(d&&!d[f+c])b[f+c]=0;else{var l=0;if(d&&(l=d[f-n+c-1]+d[f-n+c]+d[f-n+c+1]+d[f+c-1]+d[f+c+1]+d[f+n+c-1]+d[f+n+c]+d[f+n+c+1],7>l)){b[f+c]=0;a[f+c]=
0;continue}if(7===l){l=d[f-n+c-1]?k[f-n+c-1]:k[f+c];var q=d[f-n+c]?k[f-n+c]:k[f+c];var t=d[f-n+c+1]?k[f-n+c+1]:k[f+c];var v=d[f+c-1]?k[f+c-1]:k[f+c];var w=d[f+c+1]?k[f+c+1]:k[f+c];var x=d[f+n+c-1]?k[f+n+c-1]:k[f+c];var H=d[f+n+c]?k[f+n+c]:k[f+c];var A=d[f+n+c+1]?k[f+n+c+1]:k[f+c]}else l=k[f-n+c-1],q=k[f-n+c],t=k[f-n+c+1],v=k[f+c-1],w=k[f+c+1],x=k[f+n+c-1],H=k[f+n+c],A=k[f+n+c+1];v=(t+w+w+A-(l+v+v+x))*e;l=(x+H+H+A-(l+q+q+t))*g;0===v&&0===l?l=-1:(l=90-57.29578*Math.atan2(l,-v),0>l&&(l+=360),360===l?
l=0:360<l&&(l%=360));b[f+c]=l}}for(h=0;h<m;h++)b[h*n]=b[h*n+1],b[(h+1)*n-1]=b[(h+1)*n-2];for(h=1;h<n-1;h++)b[h]=b[h+n],b[h+(m-1)*n]=b[h+(m-2)*n];r.pixelType="F32";r.pixels=[b];r.statistics={minValue:0,maxValue:360};d&&(r.mask=a);return{extent:u.extent,pixelBlock:r}}},_clonePixelBlock:function(u){return u.clone?u.clone():G.clone(u)}}})},"esri/layers/rasterLib/function/BandArithmeticFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),
function(G,u,r,n,m,k,d){return G([r,k],{declaredClass:"esri.layers.rasterLib.function.BandArithmeticFunction",functionName:"BandArithmetic",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({method:1,bandIndexes:"",raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to band arithmetic function is invalid.");this.rasterInfo=u.mixin(a.raster,{bandCount:8===this.functionArguments.method?a.raster.bandCount:
1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var b=d.calculate(a.pixelBlock,{bandIndexes:this.functionArguments.bandIndexes,method:this.functionArguments.method});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(b.pixelType=this.pixelType);
return{extent:a.extent,pixelBlock:b}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:m.bandArithmetic,fragmentName:"bandArithmetic"});var b=this.functionArguments.bandIndexes.trim().split(" ").map(function(c){return parseInt(c,10)});this._infraredBandID=b[0]-1;this._visibleBandID=b[1]-1;this._alterBand=2<Math.max(this._infraredBandID,this._visibleBandID)?!0:!1;a=this._setupTextureData(a.raster,this._alterBand&&2==b.length?{bandIDs:[this._infraredBandID,this._visibleBandID,
this._infraredBandID]}:{bandIDs:[b[0]-1,b[1]-1,b[2]-1]});var e=this.bindFrameBuffer(),g=this.functionArguments.method,h=2<b.length?b.slice(2):null;this._alterBand?this._setUniforms({u_method:g,u_bandId_nir:0,u_bandId_red:1,u_constants:h}):this._setUniforms({u_method:g,u_bandId_nir:b[0]-1,u_bandId_red:b[1]-1,u_constants:h});this._bindTexture(a.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:e.texture}}})})},"esri/layers/rasterLib/function/rasterIndex":function(){define(["dojo/_base/lang"],
function(G){return{calculate:function(u,r){if(u&&u.pixels&&u.pixels.length){var n=r&&r.bandIndexes;r=r&&r.method;var m=n.trim().split(" ").map(function(a){return parseInt(a,10)}).filter(function(a){return null!=a});u=this._clonePixelBlock(u);var k=u.pixels,d=u.mask;switch(r){case 1:k=this._calculateNDVI(d,k[m[0]-1],k[m[1]-1]);break;case 2:k=this._calculateSAVI(d,k[m[0]-1],k[m[1]-1],m[2]);break;case 3:k=this._calculateTSAVI(d,k[m[0]-1],k[m[1]-1],m[2],m[3],m[4]);break;case 4:k=this._calculateMSAVI(d,
k[m[0]-1],k[m[1]-1]);break;case 5:k=this._calculateGEMI(d,k[m[0]-1],k[m[1]-1]);break;case 6:k=this._calculatePVI(d,k[m[0]-1],k[m[1]-1],m[2],m[3]);break;case 7:k=this._calculateGVITM(d,k[m[0]-1],k[m[1]-1],k[m[2]-1],k[m[3]-1],k[m[4]-1],k[m[5]-1]);break;case 8:k=this._calculateSultan(d,k[m[0]-1],k[m[1]-1],k[m[2]-1],k[m[3]-1],k[m[4]-1],k[m[5]-1]);break;case 9:k=this._calculateVARI(d,k[m[0]-1],k[m[1]-1],k[m[2]-1]);break;case 0:k=this._calculateUserDefined(d,k,n)}u.pixels=k;u.pixelType="F32";u.calculateStatistics();
return u}},_clonePixelBlock:function(u){return u.clone?u.clone():G.clone(u)},_parseUserDefined:function(u,r){u=u.replace(" ","");0===u.indexOf("-")&&(u="0"+u);0===u.indexOf("+")&&(u=u.slice(1,u.length));u=u.split("");var n=[],m=[],k="+-*/()".split(""),d,a="";for(d=0;d<u.length;d++){var b=u[d];k.some(function(e){return e===b})?(""!==a&&m.push(parseFloat(a)),n.push(b),a=""):"b"===b.toLowerCase()?(d++,a=b.concat(u[d]),m.push(r[parseInt(a[1],10)-1]),a=""):(a=a.concat(b),d===u.length-1&&m.push(parseFloat(a)))}return{ops:n,
nums:m}},_op:function(u,r,n,m){if(n.constructor===Number&&m.constructor===Number)return n+m;var k;if(n.constructor===Number){var d=m.length;var a=n;n=new Float32Array(d);for(k=0;k<d;k++)n[k]=a}else if(d=n.length,m.constructor===Number)for(a=m,m=new Float32Array(d),k=0;k<d;k++)m[k]=a;a=new Float32Array(d);if(null==u)if("+"===r)for(k=0;k<d;k++)a[k]=n[k]+m[k];else if("-"===r)for(k=0;k<d;k++)a[k]=n[k]-m[k];else if("*"===r)for(k=0;k<d;k++)a[k]=n[k]*m[k];else{if("/"===r)for(k=0;k<d;k++)a[k]=n[k]/m[k]}else if("+"===
r)for(k=0;k<d;k++)u[k]&&(a[k]=n[k]+m[k]);else if("-"===r)for(k=0;k<d;k++)u[k]&&(a[k]=n[k]-m[k]);else if("*"===r)for(k=0;k<d;k++)u[k]&&(a[k]=n[k]*m[k]);else if("/"===r)for(k=0;k<d;k++)u[k]&&(a[k]=n[k]/m[k]);return a},_shrinkOp:function(u,r){u.splice(r,1);var n=r=0,m=0;do{for(r=m=n=0;r<u.length;r++)if("("===u[r])n=r;else if(")"===u[r]){m=r;break}m===n+1&&u.splice(n,2)}while(m===n+1);return u},_getPriorityOpIndex:function(u,r){if(1===u.length)return{opIndex:0,numIndex:0};var n=r=0,m=0,k=-1,d=0;for(r=
0;r<u.length;r++)if("("===u[r])n=r;else if(")"===u[r]){m=r;break}var a=0===m?u:u.slice(n+1,m);for(r=0;r<a.length;r++)if("*"===a[r]||"/"===a[r]){k=r;break}if(!(-1<k))for(r=0;r<a.length;r++)if("+"===a[r]||"-"===a[r]){k=r;break}0<m&&(k+=n+1);for(r=0;r<k;r++)"("===u[r]&&d++;return{opIndex:k,numIndex:k-d}},_calculateUserDefined:function(u,r,n){r=this._parseUserDefined(n,r);n=r.ops;for(var m=r.nums,k,d,a;0<n.length&&(r=this._getPriorityOpIndex(n,m),k=n[r.opIndex],d=m[r.numIndex],a=m[r.numIndex+1],k=this._op(u,
k,d,a),1!==n.length);)n=this._shrinkOp(n,r.opIndex),m.splice(r.numIndex,2,k);return[k]},_calculateNDVI:function(u,r,n){var m=n.length,k=new Float32Array(m),d;if(null==u)for(d=0;d<m;d++){var a=n[d];var b=r[d];k[d]=(b-a)/(b+a)}else for(d=0;d<m;d++)u[d]&&(a=n[d],b=r[d],k[d]=(b-a)/(b+a));return[k]},_calculateSAVI:function(u,r,n,m){var k=n.length,d=new Float32Array(k),a;if(null==u)for(a=0;a<k;a++){var b=n[a];var e=r[a];d[a]=(e-b)/(e+b+m)*(1+m)}else for(a=0;a<k;a++)u[a]&&(b=n[a],e=r[a],d[a]=(e-b)/(e+b+
m)*(1+m));return[d]},_calculateTSAVI:function(u,r,n,m,k,d){var a=n.length,b=new Float32Array(a),e=-k*m+d*(1+m*m);if(null==u)for(d=0;d<a;d++){var g=n[d];var h=r[d];b[d]=m*(h-m*g-k)/(k*h+g+e)}else for(d=0;d<a;d++)u[d]&&(g=n[d],h=r[d],b[d]=m*(h-m*g-k)/(k*h+g+e));return[b]},_calculateMSAVI:function(u,r,n){var m=n.length,k=new Float32Array(m),d;if(null==u)for(d=0;d<m;d++){var a=n[d];var b=r[d];k[d]=.5*(2*(b+1)-Math.sqrt(Math.pow(2*b+1,2)-8*(b-a)))}else for(d=0;d<m;d++)u[d]&&(k[d]=.5*(2*(b+1)-Math.sqrt(Math.pow(2*
b+1,2)-8*(b-a))));return[k]},_calculateGEMI:function(u,r,n){var m=n.length,k=new Float32Array(m),d;if(null==u)for(d=0;d<m;d++){var a=n[d];var b=r[d];b=(2*(b*b-a*a)+1.5*b+.5*a)/(b+a+.5);k[d]=b*(1-.25*b)-(a-.125)/(1-a)}else for(d=0;d<m;d++)u[d]&&(a=n[d],b=r[d],b=(2*(b*b-a*a)+1.5*b+.5*a)/(b+a+.5),k[d]=b*(1-.25*b)-(a-.125)/(1-a));return[k]},_calculatePVI:function(u,r,n,m,k){var d=n.length,a=new Float32Array(d),b,e=Math.sqrt(1+m*m);if(null==u)for(b=0;b<d;b++){var g=n[b];var h=r[b];a[b]=(h-m*g-k)/e}else for(b=
0;b<d;b++)u[b]&&(g=n[b],h=r[b],a[b]=(h-m*g-k)/e);return[a]},_calculateGVITM:function(u,r,n,m,k,d,a){var b=r.length,e=new Float32Array(b),g;if(null==u)for(g=0;g<b;g++)e[g]=-.2848*r[g]-.2435*n[g]-.5436*m[g]+.7243*k[g]+.084*d[g]-1.18*a[g];else for(g=0;g<b;g++)u[g]&&(e[g]=-.2848*r[g]-.2435*n[g]-.5436*m[g]+.7243*k[g]+.084*d[g]-1.18*a[g]);return[e]},_calculateSultan:function(u,r,n,m,k,d,a){n=r.length;var b=new Float32Array(n),e=new Float32Array(n),g=new Float32Array(n),h;if(null==u)for(h=0;h<n;h++)b[h]=
d[h]/a[h]*100,e[h]=d[h]/r[h]*100,g[h]=m[h]/k[h]*(d[h]/k[h])*100;else for(h=0;h<n;h++)u[h]&&(b[h]=d[h]/a[h]*100,e[h]=d[h]/r[h]*100,g[h]=m[h]/k[h]*(d[h]/k[h])*100);return[b,e,g]},_calculateVARI:function(u,r,n,m){var k=r.length,d=new Float32Array(k),a;if(null==u)for(a=0;a<k;a++){var b=r[a];var e=n[a];var g=m[a];d[a]=(e-b)/(e+b-g)}else for(a=0;a<k;a++)if(u[a])for(a=0;a<k;a++)b=r[a],e=n[a],g=m[a],d[a]=(e-b)/(e+b-g);return[d]}}})},"esri/layers/rasterLib/function/ColormapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(G,u,r,n,m,k,d){return G([n,k],{declaredClass:"esri.layers.rasterLib.function.ColormapFunction",functionName:"Colormap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({colormap:null,colorRampName:null,colorRamp:null,colorMapName:null,raster:null},a);this.invert=a&&a.invert;a=a.colormap||a.Colormap;if(a){if(a.features||a[0].attributes){a=a.features||a;var b=Object.keys(a[0].attributes);var e=b.filter(function(q){return"alpha"===
q.toLowerCase()})[0];var g=b.filter(function(q){return"value"===q.toLowerCase()})[0];var h=b.filter(function(q){return"red"===q.toLowerCase()})[0];var c=b.filter(function(q){return"green"===q.toLowerCase()})[0];var f=b.filter(function(q){return"blue"===q.toLowerCase()})[0];if(!(g&&h&&c&&f))throw"invalid colormap";a=a.map(function(q){return e?[q.attributes[g],q.attributes[h],q.attributes[c],q.attributes[f],q.attributes[e]]:[q.attributes[g],q.attributes[h],q.attributes[c],q.attributes[f]]});var l=1.1>
Math.max.apply(null,a.map(function(q){return q[1]}));b=e&&1.1>Math.max.apply(null,a.map(function(q){return q[4]}));if(l)for(l=0;l<a.length;l++)a[l][1]=Math.round(255*a[l][1]),a[l][2]=Math.round(255*a[l][2]),a[l][3]=Math.round(255*a[l][3]),b&&(a[l][4]=Math.round(255*a[l][4]))}this.functionArguments.colormap=this._sortClr(a)}this._initialize()},bind:function(a){this._initialize();a=this.getSourceRasterInfo(a);if(!a.raster||"F32"===a.raster.pixelType)return Error("The raster input to colormap function is invalid. It must be integer type.");
this.rasterInfo=u.mixin(a.raster,{bandCount:3,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){return this._colorize(a.raster)},readGL:function(a){return this._colorizeGL(a.raster)},_colorize:function(a){this._performance.start();var b=d.colorize(a.pixelBlock,{indexedColormap:this._indexedColormap,indexedColormapOffset:this._indexedColormapOffset,
indexed2DColormap:this._indexed2DColormap,alphaSpecified:this._alphaSpecified});this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,pixelBlock:b}},_binarySearchClr:function(a,b){for(var e=0,g=a.length-1,h=0,c=0;e<g;)if(h=Math.floor((e+g)/2),c=a[h],c[0]<b)e=h;else if(c[0]>b)g=h;else return c.slice(1);return null},_sortClr:function(a,b){var e,g=[];for(e=0;e<a.length;e++)g.push(a[e]);for(e=0;e<g.length-1;e++){var h=g[e];for(a=e+1;a<g.length;a++)h[0]>g[a][0]&&(h=g[a],g[a]=g[e],
g[e]=h)}if(b)for(e=0;e<g.length/2;e++)h=g[e],g[g.length-1-e]=g[e],g[e]=h;return g},_invertColorRamp:function(a){if(!a)return a;var b={type:a.type};"random"===a.type?b=a:"multipart"===a.type?b.colorRamps=a.colorRamps.map(function(e){return{fromColor:e.toColor,toColor:e.fromColor}}).reverse():(b.fromColor=a.toColor,b.toColor=a.fromColor);return b},_initialize:function(){this._indexedColormapOffset=0;if(this.functionArguments.colormap){var a=d.buildIndexedColormap(this.functionArguments.colormap);this._alphaSpecified=
a&&a.alphaSpecified;this._indexedColormap=a&&a.indexedColormap;this._indexedColormapOffset=a&&a.offset;this._indexedColormap||(this._indexed2DColormap=this._getIndexed2DColormap())}else this.functionArguments.colorRamp?this._indexedColormap="multipart"===this.functionArguments.colorRamp.type?this.invert?r.createMultiPartColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):r.createMultiPartColorRamp(this.functionArguments.colorRamp):this.invert?r.createAlgorithmicColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):
r.createAlgorithmicColorRamp(this.functionArguments.colorRamp):this.functionArguments.colormapName&&"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=r.createRandomColorRamp())},_getIndexed2DColormap:function(){var a=this.functionArguments.colormap;if(!a)return null;var b=0;0>a[0][0]&&(b=a[0][0]);var e=[],g=5===a[0].length,h;for(h=0;h<a.length;h++)e[a[h][0]-b]=g?a[h].slice(1):a[h].slice(1).concat([255]);return e},_colorizeGL:function(a){this._performance.start();
this._initializeProgram({fragment:m.colormap,fragmentName:"Colormap"});var b=this._indexedColormap,e=this._indexedColormapOffset;this._clrTexture||(this._clrTexture=this._setupColormapTexture(b));var g=this._clrTexture,h=this.bindFrameBuffer();a=this._setupTextureData(a);this._setUniforms({u_indexedColormapOffset:e,u_indexedColormapMaxIndex:b.length/4-1});this._bindTexture(g,"u_image1");this._bindTexture(a.texture,"u_image");this._drawGL();return{extent:a.extent,texture:h.texture}},_setupColormapTexture:function(a){var b=
this._createTexture(),e=this.gl,g=a.length/4,h=new Float32Array(a.length),c,f=this.renderTexture?255:1;for(c=0;c<a.length;c++)h[c]=a[c]/f;e.getExtension("OES_texture_float");e.texImage2D(e.TEXTURE_2D,0,e.RGBA,g,1,0,e.RGBA,e.FLOAT,h);return b}})})},"esri/renderers/colorRampGenerator":function(){define(["dojo/_base/declare","dojo/_base/lang","../renderers/colorUtils"],function(G,u,r){return{createAlgorithmicColorRamp:function(n,m){if(!n)return null;var k=n.fromColor,d=n.toColor;if(!k||!d)return null;
void 0===k.r&&3<=k.length&&(k={r:k[0],g:k[1],b:k[2]});void 0===d.r&&3<=d.length&&(d={r:d[0],g:d[1],b:d[2]});var a=n.size||256;n=n.algorithm||"cie-lab";if(1===a)var b=[k.r,k.g,k.b,255];else if(2===a)b=[k.r,k.g,k.b,255,d.r,d.g,k.b,255];else if(-1<n.toLowerCase().indexOf("hsv")){b=r.toHSV(k);d=r.toHSV(d);a=a||256;var e=0===b.s,g=0===d.s;k=b.h;n=d.h;e&&!g?k=b.h=n:g&&!e&&(n=d.h=k);e=Math.abs(n-k);180>e?n=(n-k)/(a-1):(e=360-e,n=k>n?e/(a-1):-e/(a-1));e=(d.s-b.s)/(a-1);g=(d.v-b.v)/(a-1);var h=b.s;b=b.v;var c,
f=new Uint8Array(4*a);for(c=0;c<a-1;c++){var l=r.toRGB({h:k,s:h,v:b});f[4*c]=l.r;f[4*c+1]=l.g;f[4*c+2]=l.b;f[4*c+3]=255;k+=n;h+=e;b+=g;360<k?k-=360:0>k&&(k+=360)}l=r.toRGB(d);f[4*(a-1)]=l.r;f[4*(a-1)+1]=l.g;f[4*(a-1)+2]=l.b;f[4*(a-1)+3]=255;b=f}else if(-1<n.toLowerCase().indexOf("lch")){h=r.toLCH(k);d=r.toLCH(d);a=a||256;b=(d.l-h.l)/(a-1);k=(d.c-h.c)/(a-1);n=(d.h-h.h)/(a-1);e=h.l;g=h.c;h=h.h;f=new Uint8Array(4*a);for(c=0;c<a-1;c++)l=r.toRGB({l:e,c:g,h:h}),f[4*c]=l.r,f[4*c+1]=l.g,f[4*c+2]=l.b,f[4*
c+3]=255,e+=b,g+=k,h+=n;l=r.toRGB(d);f[4*(a-1)]=l.r;f[4*(a-1)+1]=l.g;f[4*(a-1)+2]=l.b;f[4*(a-1)+3]=255;b=f}else if(-1<n.toLowerCase().indexOf("lab")){h=r.toLAB(k);d=r.toLAB(d);a=a||256;b=(d.l-h.l)/(a-1);k=(d.a-h.a)/(a-1);n=(d.b-h.b)/(a-1);e=h.l;g=h.a;h=h.b;f=new Uint8Array(4*a);for(c=0;c<a-1;c++)l=r.toRGB({l:e,a:g,b:h}),f[4*c]=l.r,f[4*c+1]=l.g,f[4*c+2]=l.b,f[4*c+3]=255,e+=b,g+=k,h+=n;l=r.toRGB(d);f[4*(a-1)]=l.r;f[4*(a-1)+1]=l.g;f[4*(a-1)+2]=l.b;f[4*(a-1)+3]=255;b=f}if(m&&!1===m.flattened)for(m=b,
b=[],d=0;d<b/4;d++)b[d]=m.slice(4*d,4*d+4);return b},createMultiPartColorRamp:function(n,m){if(!n)return null;m=m&&u.clone(m)||{flattened:!0};var k=n.colorRamps;if(!k||0===k.length)return null;var d=n.size||256;n=Math.max(Math.floor(d/k.length),1);var a=Math.max(n,d-(k.length-1)*n),b=!1!==m.flattened;m.flattened=!0;d=(k.length-1)*n+a;var e=new Uint8Array(4*d);for(d=0;d<k.length;d++){var g={fromColor:k[d].fromColor,toColor:k[d].toColor,size:d===k.length-1?a:n};e instanceof Array?e.concat(this.createAlgorithmicColorRamp(g,
m)):e.set(this.createAlgorithmicColorRamp(g,m),n*d*4)}if(!b)for(m=e,e=[],d=0;d<e/4;d++)e[d]=m.slice(4*d,4*d+4);return e},createRandomColorRamp:function(n){n=n||{};var m=n.size||256,k=!1===n.flattened;var d=k?new Uint8Array(4*m):[];for(n=0;n<m;n++)k?(d[4*n]=Math.round(255*Math.random()),d[4*n+1]=Math.round(255*Math.random()),d[4*n+2]=Math.round(255*Math.random()),d[4*n+3]=255):d[n]=[Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random()),255];return d}}})},"esri/layers/rasterLib/function/rasterUtils":function(){define(["dojo/_base/lang"],
function(G){return{mask:function(u,r){if(u&&u.pixels&&u.pixels.length){u=this._clonePixelBlock(u);var n=r.includedRanges,m=r.noDataInterpretation;r=r.noDataValues;if(null===n&&null===r)return u;var k=u.pixels,d=u.mask,a=u.width*u.height,b=k.length,e;if(null!==r&&r.length!==b)throw"expect "+b+" elements in noDataValues";if(null!==n&&n.length!==2*b)throw"expect "+2*b+" elements in IncludeRanges";if(null==d){d=new Uint8Array(a);for(e=0;e<a;e++)d[e]=1;u.mask=d}if(0===m)for(m=0;m<b;m++){var g=k[m];var h=
null===n?null:n[2*m];var c=null===n?null:n[2*m+1];var f=null===r?null:parseFloat(r[m]);if(null===h||null===c)for(e=0;e<a;e++){if(d[e]){var l=g[e];l===f&&(d[e]=0)}}else if(null===f)for(e=0;e<a;e++)d[e]&&(l=g[e],l<h||l>c)&&(d[e]=0);else for(e=0;e<a;e++)d[e]&&(l=g[e],l<h||l>c||l===f)&&(d[e]=0)}else{var q=new Uint8Array(a);for(e=0;e<a;e++)q[e]=d[e];for(m=0;m<b;m++)if(g=k[m],h=null===n?null:n[2*m],c=null===n?null:n[2*m+1],f=null===r?null:parseFloat(r[m]),null===h||null===c)for(e=0;e<a;e++)q[e]&&(l=g[e],
l!==f&&(q=0));else if(null===f)for(e=0;e<a;e++)q[e]&&(l=g[e],l<=h&&l<=c&&(q=0));else for(e=0;e<a;e++)q[e]&&(l=g[e],l<=h&&l<=c&&l!==f&&(q=0));for(e=0;e<a;e++)d[e]&&q[e]&&(d[e]=0)}return u}},calculateStatisticsHistograms:function(u,r){u=this._clonePixelBlock(u);r=u.pixelType;var n=u.pixels,m=u.mask,k=n.length,d,a,b=[],e;for(d=0;d<k;d++){var g={min:-.5,max:255.5,size:256,counts:new Uint32Array(256)};var h=g.counts;var c=n[d];if("U8"===r)if(m)for(a=0;a<u.width*u.height;a++)m[a]&&h[c[a]]++;else for(a=
0;a<u.width*u.height;a++)h[c[a]]++;else{var f=u.statistics[d].minValue;var l=u.statistics[d].maxValue;g.min=f;g.max=l;l=(l-f)/256;var q=new Uint32Array(257);if(m)for(a=0;a<u.width*u.height;a++)m[a]&&q[Math.floor((c[a]-f)/l)]++;else for(a=0;a<u.width*u.height;a++)q[Math.floor((c[a]-f)/l)]++;for(a=0;255>a;a++)h[a]=q[a];h[255]=q[255]+q[256]}b.push(g);f=u.statistics[d].minValue;l=u.statistics[d].maxValue;for(a=q=e=c=0;a<g.size;a++)c+=h[a],e+=a*h[a];e/=c;for(a=0;a<g.size;a++)q+=h[a]*Math.pow(a-e,2);h=
Math.sqrt(q/(c-1));a=(e+.5)*(g.max-g.min)/g.size+g.min;g=h*(g.max-g.min)/g.size;u.statistics[d]={min:f,minValue:f,max:l,maxValue:l,mean:a,stddev:g}}u.histograms=b;return u},buildIndexedColormap:function(u,r){if(!u)return null;var n=0;0>u[0][0]&&(n=u[0][0]);var m=Math.max(256,u[u.length-1][0]-n);if(65536<m)return null;var k=new Uint8Array(4*m),d=[],a=0,b=5===u[0].length;if(r)for(d=u[a],r=d[0]-n;r<m;r++)k[4*r]=d[1],k[4*r+1]=d[2],k[4*r+2]=d[3],k[4*r+3]=b?d[4]:255,r===d[0]-n&&(d=a===u.length-1?d:u[++a]);
else for(r=0;r<u.length;r++)d=u[r],a=4*(d[0]-n),k[a]=d[1],k[a+1]=d[2],k[a+2]=d[3],k[a+3]=b?d[4]:255;return{indexedColormap:k,offset:n,alphaSpecified:b}},colorize:function(u,r){if(null!==u&&null!==u.pixels){u=this._clonePixelBlock(u);var n=u.pixels,m=u.width*u.height,k=u.mask,d=r.indexedColormap,a=r.indexedColormapOffset,b=d&&d.length-1,e=r.indexed2DColormap;r=r.alphaSpecified;if(3<=n.length)throw"colormap only works on single band image";var g=n[0],h=new Uint8Array(g.length),c=new Uint8Array(g.length),
f=new Uint8Array(g.length),l=0;if(d)if(k)for(n=0;n<m;n++)k[n]&&(l=4*(g[n]-a),l<a||l>b?k[n]=0:(h[n]=d[l],c[n]=d[l+1],f[n]=d[l+2],k[n]=d[l+3]));else{k=new Uint8Array(m);for(n=0;n<m;n++)l=4*(g[n]-a),l<a||l>b?k[n]=0:(h[n]=d[l],c[n]=d[l+1],f[n]=d[l+2],k[n]=d[l+3]);u.mask=k}else if(k)for(n=0;n<m;n++)k[n]&&(d=e[g[n]],h[n]=d[0],c[n]=d[1],f[n]=d[2],k[n]=d[3]);else{k=new Uint8Array(m);for(n=0;n<m;n++)d=e[g[n]],h[n]=d[0],c[n]=d[1],f[n]=d[2],k[n]=d[3];u.mask=k}u.pixels=[h,c,f];u.statistics=null;u.pixelType="U8";
u.maskIsAlpha=r;return u}},convolute:function(u,r){u=this._clonePixelBlock(u);var n=u.pixels,m=u.width,k=u.height,d=m*k,a=n.length,b,e,g,h,c=[],f=[],l=r.normalizedKernel,q=r.kernelRows,t=r.kernelCols;for(r=0;r<a;r++){var v=n[r];var w=new Float32Array(d);w.set(v);for(g=1;g<k-1;g++){var x=g*m;for(h=1;h<m-1;h++){for(b=f=0;b<q;b++)for(e=0;e<t;e++)f+=v[x+h+(b-1)*m+e-1]*l[b*t+e];w[x+h]=f}}c.push(w)}u.pixels=c;return u},contrastBrightnessStretch:function(u,r){if(null!==u&&null!==u.pixels){u=this._clonePixelBlock(u);
var n=u.pixels,m=u.mask,k=u.width*u.height,d=n.length;var a=r&&r.contrastOffset;r=r&&r.brightnessOffset;if("U8"!==u.pixelType)throw"the contrast and brightness function only supports 8 bit unsigned integer data";var b=this._createContrastBrightnessLUT(a,r);if(null==m)for(a=0;a<k;a++)for(r=0;r<d;r++)n[r][a]=b[n[r][a]];else for(a=0;a<k;a++)if(m[a])for(r=0;r<d;r++)n[r][a]=b[n[r][a]];u.pixelType="U8";return u}},isNull:function(u,r){if(null!==u&&null!==u.pixels){u=this._clonePixelBlock(u);r=u.mask;var n=
u.pixels[0],m=n.length,k;if(r){for(k=0;k<m;k++)n[k]=r[k]?0:1;u.mask=null}else if(n.fill)n.fill(0);else for(k=0;k<m;k++)n[k]=0;return u}},setNull:function(u){if(null!==r&&null!==r.pixels){var r=this._clonePixelBlock(u);u=r.mask;var n=r.pixels[0],m=n.length,k;u=u||new Uint8Array(m);for(k=0;k<m;k++)u[k]=n[k]?0:1;r.mask=u;return r}},local:function(u,r){if(!r)return u[0];var n=r.rasterCountNeeded;r=r.functor;var m=this._clonePixelBlock(u[0]);if(null!==m&&null!==m.pixels){var k=m.width*m.height,d;u=(d=
u[1])&&d.pixels[0];var a=d&&d.mask,b=m.mask,e=m.pixels[0];if(2===n)if(!b&&a)b=a;else if(b&&a)for(d=0;d<k;d++)b[d]=b[d]&&a[d]?1:0;m.mask=b;if(1===n)if(null==b)for(d=0;d<k;d++)e[d]=r(e[d]);else for(d=0;d<k;d++)b[d]&&(e[d]=r(e[d]));else if(2===n)if(null==b)for(d=0;d<k;d++)e[d]=r(e[d],u[d]);else for(d=0;d<k;d++)b[d]&&(e[d]=r(e[d],u[d]));m.mask=b;m.calculateStatistics();return m}},remapColor:function(u,r){u=this._clonePixelBlock(u);var n=u.width*u.height,m=r.length,k=Math.floor(m/2),d=r[Math.floor(k)],
a=r[0].value,b=r[r.length-1].value,e=u.pixels[0],g,h,c=!1,f=new Uint8Array(n),l=new Uint8Array(n),q=new Uint8Array(n),t=u.mask,v=4===r[0].mappedColor.length;t&&0!==t.length||(t=new Uint8Array(n),t.fill(v?255:1),u.mask=t);for(h=0;h<n;h++)if(t[h]){var w=e[h];if(w<a||w>b)f[h]=l[h]=q[h]=t[h]=0;else{c=!1;var x=k;var H=d;var A=0;for(g=m-1;1<g-A;){if(w===H.value){c=!0;break}w>H.value?A=x:g=x;x=Math.floor((A+g)/2);H=r[Math.floor(x)]}c||(H=w===r[g].value?r[g]:r[A]);f[h]=H.mappedColor[0];l[h]=H.mappedColor[1];
q[h]=H.mappedColor[2];t[h]=H.mappedColor[3]}}u.pixels=[f,l,q];u.mask=t;u.pixelType="u8";u.maskIsAlpha=v;return u},_clonePixelBlock:function(u){if(u.clone)return u.clone();var r=G.clone(u),n;if(u.pixels&&u.pixels[0]&&0<u.pixels[0].length&&!(r.pixels&&r.pixels[0]&&0<r.pixels[0].length)){r.pixels=[];var m=u.pixels.length;for(n=0;n<m;n++)r.pixels[n]=new u.pixels[n].constructor(u.pixels[n])}if(u.statistics)for(r.statistics=[],m=u.statistics.length,n=0;n<m;n++)r.statistics[n]=G.clone(u.statistics[n]);u.mask&&
(r.mask=new Uint8Array(u.mask));return r},_createContrastBrightnessLUT:function(u,r){if(this._contrastCache&&this._contrastCache.contrastOffset===u&&this._contrastCache.brightnessOffset===r)return this._contrastCache.lut;var n=Math.min(Math.max(u,-100),100),m=Math.min(Math.max(r,-100),100),k,d=new Uint8Array(256);for(k=0;256>k;k++){if(0<n&&100>n)var a=(200*k-25500+510*m)/(2*(100-n))+128;else 0>=n&&-100<n?a=(200*k-25500+510*m)*(100+n)/2E4+128:100===n?(a=200*k-25500+256*(100-n)+510*m,a=0<a?255:0):-100===
n&&(a=128);d[k]=255<a?255:0>a?0:a}this._contrastCache={contrastOffset:u,brightnessOffset:r,lut:d};return d}}})},"esri/layers/rasterLib/function/CompositeBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(G,u,r,n,m,k){return G([r,k],{declaredClass:"esri.layers.rasterLib.function.CompositeBandFunction",functionName:"CompositeBand",supportWebGL:!0,support2D:!0,constructor:function(d){this.functionArguments=
this.mixinIgnoreCase({rasters:null},d)},bind:function(d){d=this.getSourceRasterInfo(d);if(!d.rasters)return Error("The rasters input to composite band function is invalid.");var a=[],b=[],e=d.rasters.length,g;if(d.rasters[0].statistics)for(g=0;g<e;g++)a.push(d.rasters[g].statistics[0]);if(d.rasters[0].histograms)for(g=0;g<e;g++)b.push(d.rasters[g].histograms[0]);this.rasterInfo=u.mixin(d.rasters[0],{bandCount:e,pixelType:this._calculatePixelType(this.pixelType,d.rasters[0].pixelType),statistics:a,
histograms:b});return!0},read2D:function(d){d=d.rasters;if(null!=d&&0!==d.length){var a=this._clonePixelData(d[0]),b=a.pixelBlock,e=[],g=[];for(h=0;h<d.length;h++)e.push(d[h].pixelBlock.pixels[0]),g.push(d[h].pixelBlock.statistics[0]);b.pixels=e;b.stackedStatistics=g;b.planes=d.length;var h;g=b.width*b.height;for(h=0;h<d.length;h++)if(b=d[h].pixelBlock.mask,c&&b)for(e=0;e<g;e++)c[e]&=b[e];else var c=c||b;a.maks=c;return a}},readGL:function(d){this._performance.start();this._initializeProgram({fragment:m.compositeBand,
fragmentName:"CompositeBand"});var a=d.rasters;if(null!=a&&0!==a.length){a=a.length;var b,e=this.bindFrameBuffer();for(b=0;b<a;b++){var g=this._setupTextureData(d.rasters[b],{notOriginal:0<b});var h=0<b?b.toString():"";this._bindTexture(g.texture,"u_image"+h)}this._setUniforms({u_rasterCount:a});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:g.extent,texture:e.texture}}}})})},"esri/layers/rasterLib/function/ContrastBrightnessFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(G,u,r,n,m,k,d){return G([r,k],{declaredClass:"esri.layers.rasterLib.function.ContrastBrightnessFunction",renderTexture:!0,functionName:"ContrastBrightness",supportWebGL:!0,support2D:!0,pixelType:"U8",constructor:function(a){this.functionArguments=this.mixinIgnoreCase({contrastOffset:0,brightnessOffset:0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to contrast and brightness function is invalid.");this.rasterInfo=u.mixin(a.raster,
{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(a){a=a.raster;if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var b=d.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.functionArguments.contrastOffset,brightnessOffset:this.functionArguments.brightnessOffset});"Unknown"!==
this.pixelType&&(b.pixelType=this.pixelType,b.pixels=b.pixels.map(u.hitch(this,function(e){return this._clampBand(e,b.pixelType)})));return{extent:a.extent,pixelBlock:b}}},readGL:function(a){return this._cbGL(a.raster)},_cbGL:function(a){this._performance.start();this._initializeProgram({fragment:m.contrastBrightness,fragmentName:"ContrastBrightness"});a=this._setupTextureData(a);this._setUniforms({u_contrastOffset:Math.min(Math.max(this.functionArguments.contrastOffset,-100),100),u_brightnessOffset:Math.min(Math.max(this.functionArguments.brightnessOffset,
-100),100),u_scaleFactor:this.renderTexture?255:1});this._bindTexture(a.texture,"u_image");var b=this.bindFrameBuffer();this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:b.texture}}})})},"esri/layers/rasterLib/function/ConvolutionFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./convolutionKernel ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(G,u,r,n,m,k,d,a){return G([r,
d],{declaredClass:"esri.layers.rasterLib.function.ConvolutionFunction",functionName:"Convolution",supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=this.mixinIgnoreCase({columns:3,rows:3,type:0,kernel:null,raster:null},b)},bind:function(b){b=this.getSourceRasterInfo(b);if(!b.raster)return Error("The raster input to convolution function is invalid.");this.rasterInfo=u.mixin(b.raster,{bandCount:b.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,b.raster.pixelType),
statistics:b.raster.statistics,histograms:b.raster.histograms});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(b){this._performance.start();b=b.raster;var e=this._analyzeKernel(),g=a.convolute(b.pixelBlock,{normalizedKernel:e.normalizedKernel,kernelCols:this.functionArguments.columns,kernelRows:this.functionArguments.rows});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&
(g.pixelType=this.pixelType);g.pixels=g.pixels.map(u.hitch(this,function(h){return this._clampBand(h,g.pixelType)}));return{extent:b.extent,pixelBlock:g}},readGL:function(b){this._performance.start();this._initializeProgram({fragment:k.convolution,fragmentName:"Convolution"});var e=this._setupTextureData(b.raster),g=this.bindFrameBuffer(),h=this.gl,c=h.drawingBufferWidth;h=h.drawingBufferHeight;var f=this.functionArguments.kernel;this._setUniforms({u_resolution:b&&b.raster&&b.raster.pixelBlock?[1/
b.raster.pixelBlock.width,1/b.raster.pixelBlock.height]:[1/c,1/h],u_kernel:f,u_kernelSize:f.length});this._bindTexture(e.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:e.extent,texture:g.texture}},_analyzeKernel:function(){var b=this.functionArguments.kernel,e=b.reduce(function(c,f){return c+f});0!==e&&1!==e&&(b=b.map(function(c){return c/e}));var g,h=[];for(g=0;g<b.length;g++)h.some(function(c){return c===b[g]})||h.push(b[g]);return{normalizedKernel:b,
distinctValues:h}},_analyzeKernelPattern:function(){var b=this.functionArguments.rows,e=this.functionArguments.columns,g=this.functionArguments.kernel,h=[],c,f;for(c=0;c<b;c++)h.push({weights:g.slice(c*e,(c+1)*e)});var l;for(c=1;c<b;c++){var q=h[c].weights;for(g=0;g<c;g++)if(l=h[g].weights){var t=q[0]/l[0];for(f=1;f<e;f++)q[f]/l[f]!==t&&(t=null);null!==t&&(h[c]={row:g,factor:t})}}return h}})})},"esri/layers/rasterLib/function/ExtractBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),
function(G,u,r,n,m,k){return G([r,k],{declaredClass:"esri.layers.rasterLib.function.ExtractBandFunction",functionName:"ExtractBand",supportWebGL:!0,support2D:!0,constructor:function(d){this.functionArguments=this.mixinIgnoreCase({bandIDs:[],missingBandAction:0,raster:null},d)},bind:function(d){d=this.getSourceRasterInfo(d);if(!d.raster)return Error("The raster input to extract band function is invalid.");var a=[],b=d.raster.statistics,e=[],g=d.raster.histograms,h=this.functionArguments.bandIDs.length||
d.raster.bandCount;this.functionArguments.bandIDs.forEach(u.hitch(this,function(c){if(c>=h-1){if(1===this.functionArguments.missingBandAction)return Error("missing band "+c);c=h-1}if(0>c)return Error("missing band "+c);void 0!==b&&null!==b&&0<b.length&&a.push(b[c]);void 0!==g&&null!==g&&0<g.length&&e.push(g[c])}));this.rasterInfo=u.mixin(d.raster,{bandCount:h,pixelType:this._calculatePixelType(this.pixelType,d.raster.pixelType),statistics:a,histograms:e});return!0},read2D:function(d){d=this._clonePixelData(d.raster);
if(null!==d&&null!==d.pixelBlock&&null!==d.pixelBlock.pixels){this._performance.start();var a=d.pixelBlock,b=a.statistics,e=a.pixels,g=e.length;if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(0===this.functionArguments.bandIDs.length)return d;var h=[],c=[];this.functionArguments.bandIDs.forEach(function(f){if(f>=g-1){if(1===this.functionArguments.missingBandAction)throw"missing band "+f;f=g-1}if(0>f)throw"missing band "+f;h.push(e[f]);void 0!==b&&null!==b&&0<b.length&&
c.push(b[f])});a.pixels=h;a.statistics=c;a.planes=this.functionArguments.bandIDs.length;return d}},readGL:function(d){this._performance.start();if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(3<this.functionArguments.bandIDs.length)throw"this version does not support more than 3 bands yet";this._initializeProgram({fragment:m.extractBand,fragmentName:"ExtractBand"});var a=this.functionArguments.bandIDs;1===a.length&&(a=[a[0],a[0],a[0]]);this._bandIDs=a;this._alterBand=!(0===
this.functionArguments.bandIDs.length||0===a[0]&&1===a[1]&&2===a[2]);var b=!!(this._alterBand&&d.raster&&d.raster.texture);d=this._setupTextureData(d.raster,{bandIDs:a});var e=this.bindFrameBuffer();b?this._setUniforms({u_bandIDs:a,u_alterBand:this._alterBand}):this._setUniforms({u_bandIDs:a,u_alterBand:!1});this._bindTexture(d.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:d.extent,texture:e.texture}}})})},"esri/layers/rasterLib/function/HillshadeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../renderers/colorRampGenerator ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils ./rasterUtils".split(" "),
function(G,u,r,n,m,k,d,a,b,e){return G([r,a],{declaredClass:"esri.layers.rasterLib.function.HillshadeFunction",functionName:"Hillshade",supportWebGL:!0,support2D:!0,renderTexture:!0,constructor:function(g){this.functionArguments=this.mixinIgnoreCase({hillshadeType:0,altitude:45,azimuth:315,zFactor:1,slopeType:1,psPower:.664,psFactor:.024,colorRamp:null,raster:null},g);this._azimuths=[315,270,225,360,180,0];this._altitudes=[60,60,60,60,60,90];this._weights=[3,5,3,2,1,4];var h=this._weights.reduce(function(c,
f){return c+f});this._weights=this._weights.map(function(c){return c/h})},bind:function(g){g=this.getSourceRasterInfo(g);if(!g.raster)return Error("The raster input to hillshade function is invalid.");g.raster.statistics&&(this.srcStatistics=g.raster.statistics);this.rasterInfo=u.mixin(g.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:[{min:0,max:255}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=
"Generic";this._initializeColormap();return!0},read2D:function(g){this._performance.start();g=g.raster;g=b.hillshade(g,{altitude:this.functionArguments.altitude,azimuth:this.functionArguments.azimuth,zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,hillshadeType:this.functionArguments.hillshadeType,slopeType:this.functionArguments.slopeType,isGCS:g.extent.spatialReference.wkid&&null==m[g.extent.spatialReference.wkid]});this._addPerformanceMetric(this._performance.elapsed());
return g},readGL:function(g){this._performance.start();this._initializeProgram({fragment:d.hillshade,fragmentName:"Hillshade"});this.functionArguments.colorRamp&&this._indexedColormap&&!this._clrTexture&&(this._clrTexture=this._setupColormapTexture(this._indexedColormap));var h=this._setupTextureData(g.raster),c=this.bindFrameBuffer(),f=this.gl,l=f.drawingBufferWidth;f=f.drawingBufferHeight;var q=h.extent,t=(q.xmax-q.xmin)/l,v=(q.ymax-q.ymin)/f,w=this.functionArguments.altitude,x=this.functionArguments.azimuth,
H=this.functionArguments.zFactor;1===this.functionArguments.hillshadeType&&(H*=2);var A=H/(8*t),z=H/(8*v);.001<H&&q.spatialReference.wkid&&null==m[q.spatialReference.wkid]&&(A/=111E3,z/=111E3);var E=this.functionArguments.psPower,J=this.functionArguments.psFactor;3===this.functionArguments.slopeType&&((A=q.spatialReference.wkid&&null==m[q.spatialReference.wkid])?(A=111E3*t,z=111E3*v,A=(H+Math.pow(A,E)*J)/(8*A),z=(H+Math.pow(z,E)*J)/(8*z)):(A=(H+Math.pow(t,E)*J)/(8*t),z=(H+Math.pow(v,E)*J)/(8*v)));
var D=(90-w)*Math.PI/180;w=Math.cos(D);var L=(360-x+90)*Math.PI/180;x=Math.sin(D)*Math.cos(L);D=Math.sin(D)*Math.sin(L);E=Array(6);J=Array(6);q=Array(6);var C=this._weights,N;if(1===this.functionArguments.hillshadeType){var S=this._azimuths.length;for(N=0;N<S;N++)w=this._altitudes[N],x=this._azimuths[N],D=(90-w)*Math.PI/180,w=Math.cos(D),L=(360-x+90)*Math.PI/180,x=Math.sin(D)*Math.cos(L),D=Math.sin(D)*Math.sin(L),E[N]=w,J[N]=x,q[N]=D}else E[0]=w,J[0]=x,q[0]=D;E=E.map(function(F){return parseFloat(F)});
J=J.map(function(F){return parseFloat(F)});q=q.map(function(F){return parseFloat(F)});this._setUniforms({u_cellSize:[t,v],u_zfactor:H,u_xFactor:A,u_yFactor:z,u_sinZcosA:x,u_sinZsinA:D,u_cosZ:w,u_sinZcosAs:J,u_sinZsinAs:q,u_cosZs:E,u_weights:C,u_hillshadeType:this.functionArguments.hillshadeType,u_resolution:g&&g.raster&&g.raster.pixelBlock?[1/g.raster.pixelBlock.width,1/g.raster.pixelBlock.height]:[1/l,1/f],u_scaled:!this.renderTexture,u_applyColorramp:this._clrTexture?!0:!1,u_minValue:this.srcStatistics[0].min,
u_maxValue:this.srcStatistics[0].max,u_indexedColormapOffset:this._indexedColormapOffset||0,u_indexedColormapMaxIndex:this._indexedColormap?this._indexedColormap.length/4-1:0});this._clrTexture&&this._bindTexture(this._clrTexture,"u_image1");this._bindTexture(h.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:h.extent,texture:c.texture}},_initializeColormap:function(){this._indexedColormapOffset=0;var g=this._indexedColormap,h=this.functionArguments.colorRamp;
this.functionArguments.colormap?(this._alphaSpecified=(h=e.buildIndexedColormap(this.functionArguments.colormap))&&h.alphaSpecified,this._indexedColormap=h&&h.indexedColormap,this._indexedColormapOffset=h&&h.offset):h?(this._indexedColormap="multipart"===h.type?this.invert?n.createMultiPartColorRamp(this._invertColorRamp(h)):n.createMultiPartColorRamp(h):this.invert?n.createAlgorithmicColorRamp(this._invertColorRamp(h)):n.createAlgorithmicColorRamp(h),h.fromColor&&h.toColor&&"000"===h.fromColor.slice(0,
3).join("")&&"255255255"===h.toColor.slice(0,3).join("")&&(this._clrTexture=this._indexedColormap=null)):this.functionArguments.colormapName?"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=n.createRandomColorRamp()):this._clrTexture=this._indexedColormap=null;if(g&&this._indexedColormap){h=!0;for(var c=0;c<g.length;c++)if(g[c]!==this._indexedColormap[c]){h=!1;break}h||(this._clrTexture=null)}},_setupColormapTexture:function(g){var h=this._createTexture(),c=this.gl,
f=g.length/4,l=new Float32Array(g.length),q;for(q=0;q<g.length;q++)l[q]=g[q]/255;c.getExtension("OES_texture_float");c.texImage2D(c.TEXTURE_2D,0,c.RGBA,f,1,0,c.RGBA,c.FLOAT,l);return h}})})},"esri/layers/rasterLib/function/LocalFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(G,u,r,n,m,k,d){return G([r,k],{declaredClass:"esri.layers.rasterLib.function.LocalFunction",functionName:"Local",
supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({operation:null,rasters:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);var b=0;a.raster?b=a.raster.bandCount:a.rasters&&(b=Math.max.apply(null,a.rasters.map(function(e){return e.bandCount})));if(0===b)return Error("The raster input to local function is invalid. It only takes single band input.");a=a.raster||a.rasters.filter(function(e){return!!e.extent})[0];this.rasterInfo=u.mixin(a,{bandCount:1,
pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){var b=[];b=a.raster?a.raster2?[a.raster,a.raster2]:[a.raster]:a.rasters;a=b.map(function(f){return f.pixelBlock});var e=this.functionArguments.operation;if(null===e)return b[0];this._performance.start();var g=this._getOperations(),h=g.operators[e-1];g=g.functors[e-1];
if(!this.functionArguments.rasters){if(1!==h)throw"no sufficient rasters, require "+h;}else if(999!==h&&this.functionArguments.rasters.length!==h)throw"number of rasters does not meet (short or exceed) the operation requirment, require "+h;var c=31===e?d.isNull(a[0]):50===e?d.setNull(a[0]):d.local(a,{rasterCountNeeded:h,functor:g});"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType,c.pixels=c.pixels.map(u.hitch(this,function(f){return this._clampBand(f,c.pixelType)})));c.statistics||c.calculateStatistics();
return{extent:b[0].extent,pixelBlock:c}},readGL:function(a){this._performance.start();var b=this.functionArguments.operation,e=this._getWebGLOperations(),g=e.operators[b-1],h=m.local;e="result\x3d"+e.functors[b-1]+";";31!==b&&50!==b&&(e+="result \x3d vec4(result.rgb, a.a);");h=h.replace("vec4 replaceme"+g+";",e);e=this.gl.getParameter(this.gl.VERSION);var c="";if(-1<e.toLowerCase().indexOf("webgl 1.0")||-1<e.toLowerCase().indexOf("webgl 0."))c=this._getPolyfill(b);h=h.replace("vec4 polyfill;",c);
1<g&&(h=h.replace("gl_FragColor \x3d localOp1();","gl_FragColor \x3d localOp1();".replace("1",g.toString())));this._initializeProgram({fragment:h,fragmentName:"Local"});b=a.rasters;if(null!=b&&0!==b.length){b=b.length;e=this.bindFrameBuffer();for(g=0;g<b;g++){h=0<g?g.toString():"";var f=this._setupTextureData(a.rasters[g],{reCreate:!0});this._bindTexture(f.texture,"u_image"+h)}this._setUniforms({});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:f.extent,texture:e.texture}}},
_getOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:[function(a,b){return a+b},function(a,b){return a-b},function(a,b){return a*b},function(a){return Math.sqrt(a)},function(a,b){return Math.pow(a,b)},function(a){return Math.acos(a)},function(a){return Math.asin(a)},function(a){return Math.atan(a)},function(a){return Math.atanh(a)},
function(a){return Math.abs(a)},function(a,b){return a&b},function(a,b){return a<<b},function(a){return~a},function(a,b){return a|b},function(a,b){return a>>b},function(a,b){return a^b},function(a,b){return a&&b},function(a){return!a},function(a,b){return a||b},function(a,b){return a!=b},function(a){return Math.cos(a)},function(a,b){return Math.cosh(a)},function(a,b){return a/b},function(a,b){return a==b},function(a){return Math.exp(a)},function(a){return Math.pow(10,a)},function(a){return Math.pow(2,
a)},function(a,b){return a>b?1:0},function(a,b){return a>=b?1:0},function(a,b){return Math.floor(a)},function(a){return!a},function(a){return a},function(a,b){return a<b?1:0},function(a,b){return a<=b?1:0},function(a){return Math.log(a)},function(a,b){return Math.log10(a)},function(a,b){return Math.log2(a)},999,999,999,999,999,999,function(a,b){return a%b},function(a){return-a},function(a,b){return a!=b?1:0},999,function(a,b){return Math.floor(a)},function(a,b){return Math.ceil(a)},function(a,b){return b?
0:a},function(a,b){return Math.sin(a)},function(a,b){return Math.sinh(a)},function(a,b){return a*a},999,999,function(a){return Math.tan(a)},function(a){return Math.tanh(a)},999,function(a){return Math.acosh(a)},function(a){return Math.asinh(a)},function(a,b){return Math.atan2(a,b)},function(a,b){return a/b},function(a,b){return Math.floor(a/b)},999,999,999,999,999,999,999,999,999,999,function(a,b,e){return a?b:e}]}},_polyfill:{sinh:"vec4 sinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp - 1.0/halfexp;\n}",
asinh:"vec4 asinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp - 1.0/halfexp);\n}",cosh:"vec4 cosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp + 1.0/halfexp;\n}",acosh:"vec4 acosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp + 1.0/halfexp);\n}",tanh:"vec4 tanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx - 1.0/expx)/(expx + 1.0/expx);\n}",atanh:"vec4 atanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx + 1.0/expx)/(expx - 1.0/expx);\n}"},_getPolyfill:function(a){var b=
"";switch(a){case 9:b=this._polyfill.atanh;break;case 22:b=this._polyfill.cosh;break;case 52:b=this._polyfill.sinh;break;case 57:b=this._polyfill.tanh;break;case 59:b=this._polyfill.acosh;break;case 60:b=this._polyfill.asinh}return b},_getWebGLOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:["(a + b)","(a - b)",
"(a * b)","sqrt(a)","pow(a, b)","acos(a)","asin(a)","atan(a)","atanh(a)","abs(a)","a","a","a","a","a","a","(a.r\x3d\x3d0.0 || b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","a.r\x3d\x3d0.0?vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","(a.r\x3d\x3d0.0 \x26\x26 b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","(a.r\x3d\x3d0.0 ^^ b.r\x3d\x3d0.0) ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","cos(a)","cosh(a)","a / b","a.r \x3d\x3d b.r? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
"exp(a)","pow(10.0, a)","pow(2.0, a)","a.r \x3e b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3e\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","floor(a)","a.a \x3d\x3d 0.0? vec4(1.0,1.0,1.0,1.0) : vec4(0.0,0.0,0.0,1.0)","a","a.r \x3c b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3c\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","log(a)","log2(a) / log2(10.0)","log2(a)",999,999,999,999,999,999,"mod(a, b)","-a","a.r !\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
999,"floor(a)","ceil(a)","a.r !\x3d 0.0 ? vec4(0.0,0.0,0.0,0.0) : a","sin(a)","sinh(a)","a * a",999,999,"tan(a)","tanh(a)",999,"acosh(a)","asinh(a)","atan(a, b)","a / b","floor(a / b)",999,999,999,999,999,999,999,999,999,999,"a.r!\x3d0 ? b : c"]}}})})},"esri/layers/rasterLib/function/MaskFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(G,u,r,n,m,k,d){return G([r,k],{declaredClass:"esri.layers.rasterLib.function.MaskFunction",
functionName:"Mask",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({includedRanges:null,noDataInterpretation:0,noDataValues:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to mask function is invalid.");this.rasterInfo=u.mixin(a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,a.raster.pixelType),statistics:a.raster.statistics,histograms:a.raster.histograms});
return!0},read2D:function(a){this._performance.start();a=a.raster;var b=d.mask(a.pixelBlock,{includedRanges:this.functionArguments.includedRanges,noDataInterpretation:this.functionArguments.noDataInterpretation,noDataValues:this.functionArguments.noDataValues});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(b.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:b}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:m.mask,fragmentName:"Mask"});
a=this._setupTextureData(a.raster);var b=this.bindFrameBuffer(),e=this.functionArguments.includedRanges,g=this.functionArguments.noDataValues?this.functionArguments.noDataValues.map(function(h){return parseFloat(h,10)}):null;this._setUniforms({u_includedRanges:e,u_includedRanges_specified:e?!0:!1,u_noDataValues:g,u_noDataValues_specified:g?!0:!1,u_noDataInterpretation:this.functionArguments.noDataInterpretation,u_bandCount:Math.min(this.sourceRasterInfo.raster.bandCount,3)});this._bindTexture(a.texture,
"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:b.texture}}})})},"esri/layers/rasterLib/function/NDVIFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),function(G,u,r,n,m,k,d){return G([r,k],{declaredClass:"esri.layers.rasterLib.function.NDVIFunction",functionName:"NDVI",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=
this.mixinIgnoreCase({visibleBandID:1,infraredBandID:2,scaled:!0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!(a.raster&&1<a.raster.bandCount))return Error("The raster input to ndvi function is invalid. It requires more than 1 band.");this.rasterInfo=u.mixin(a.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,this.scaled?"U8":"F32"),statistics:this.scaled?[{min:0,max:200}]:[{min:-1,max:1}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||
{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){this._performance.start();a=a.raster;var b=d.calculate(a.pixelBlock,{bandIndexes:[this.functionArguments.infraredBandID+1,this.functionArguments.visibleBandID+1].join(" "),method:1}),e;if(this.functionArguments.scaled){var g=b.pixels[0];var h=b.mask;var c=g.length;var f=new Uint8Array(c);if(null==h)for(e=0;e<c;e++)f[e]=100*g[e]+100&255;else for(e=0;e<c;e++)h[e]&&(f[e]=100*g[e]+100&255);b.pixels[0]=f;b.pixelType="U8"}this._addPerformanceMetric(this._performance.elapsed());
"Unknown"!==this.pixelType&&(b.pixelType=this.pixelType);return{extent:a.extent,pixelBlock:b}},readGL:function(a){this._performance.start();this._initializeProgram({fragment:m.ndvi,fragmentName:"NDVI"});var b=this.functionArguments.visibleBandID,e=this.functionArguments.infraredBandID,g=this.functionArguments.scaled||!1;this._alterBand=2<Math.max(e,b)?!0:!1;a=this._setupTextureData(a.raster,{bandIDs:this._alterBand?{bandIDs:[e,b,e]}:null});var h=this.bindFrameBuffer();this._alterBand?this._setUniforms({u_bandId_nir:0,
u_bandId_red:1,u_scaled:g}):this._setUniforms({u_bandId_nir:e,u_bandId_red:b,u_scaled:g});this._bindTexture(a.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:h.texture}}})})},"esri/layers/rasterLib/function/SlopeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),function(G,u,r,n,m,k,
d,a){return G([r,d],{declaredClass:"esri.layers.rasterLib.function.SlopeFunction",functionName:"Slope",supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=this.mixinIgnoreCase({zFactor:1,slopeType:1,psPower:.664,psFactor:.024,raster:null},b)},bind:function(b){b=this.getSourceRasterInfo(b);if(!b.raster)return Error("The raster input to slope function is invalid.");this.rasterInfo=u.mixin(b.raster,{bandCount:1,pixelType:this._calculatePixelType(this.outputPixelType,"F32"),statistics:1===
this.slopeType||3===this.slopeType?[{min:0,max:90}]:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(b){this._performance.start();b=b.raster;b=a.slope(b,{zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,slopeType:this.functionArguments.slopeType,isGCS:b.extent.spatialReference.wkid&&null==n[b.extent.spatialReference.wkid]});
this._addPerformanceMetric(this._performance.elapsed());return b},readGL:function(b){this._performance.start();this._initializeProgram({fragment:k.slope,fragmentName:"Slope"});var e=this._setupTextureData(b.raster),g=this.bindFrameBuffer(),h=this.gl,c=h.drawingBufferWidth;h=h.drawingBufferHeight;var f=e.extent;this._setUniforms({u_resolution:b&&b.raster&&b.raster.pixelBlock?[1/b.raster.pixelBlock.width,1/b.raster.pixelBlock.height]:[1/c,1/h],u_cellSize:[(f.xmax-f.xmin)/c,(f.ymax-f.ymin)/h],u_zfactor:this.functionArguments.zFactor});
this._bindTexture(e.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:e.extent,texture:g.texture}}})})},"esri/layers/rasterLib/function/StretchFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./vertexShaders ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(G,u,r,n,m,k,d){return G([r,d],{declaredClass:"esri.layers.rasterLib.function.StretchFunction",functionName:"Stretch",supportWebGL:!0,
support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,raster:null,computeGamma:!1},a);this.functionArguments.statistics=this._convertStats(this.functionArguments.statistics);-1===[0,3,5,6].indexOf(this.functionArguments.stretchType)&&(console.error("The specific stretch type has not been implemented: "+this.functionArguments.stretchType),
this.functionArguments.stretchType=5);this.min=null==this.min?0:this.min;this.max=null==this.max?255:this.max},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input to stretch function is invalid.");a.raster.statistics&&(this.srcStatistics=this._convertStats(a.raster.statistics));a.raster.histograms&&(this.srcHistograms=a.raster.histograms);this.rasterInfo=u.mixin({},a.raster,{bandCount:a.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),
statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(a){a=a.raster;this._stretch(a);return a},hasTilingEffects:function(a){a=a||this.functionArguments;return!!(a.dra||a.raster&&"object"===typeof a.raster&&a.raster.dra)},_convertStats:function(a){return a?a.map(function(b){return b&&null!=b.min?[b.min,b.max,b.mean,b.stddev]:b}):null},_updateStatistisHistograms:function(a){var b=this.functionArguments,
e=b.histograms||this.srcHistograms;if(a&&a.pixelBlock&&a.pixelBlock.pixels){if(0===b.stretchType)this._statistics=b.statistics&&0<b.statistics.length?b.statistics:this.srcStatistics,this._histograms=e;else{var g=a.pixelBlock,h=g.pixels.length,c=6===b.stretchType&&(b.dra||!e)||3===b.stretchType&&b.dra;c&&(g.statistics||g.calculateStatistics(),this._calculateStatisticsHistograms(a));if(b.dra)if(g.statistics||g.calculateStatistics(),c)this._statistics=g.statistics,this._histograms=g.histograms;else for(b=
g.statistics,this._statistics=[],a=0;a<h;a++)this._statistics[a]=[b[a].minValue,b[a].maxValue,0,0];else this._statistics=b.statistics&&0<b.statistics.length?b.statistics:this.srcStatistics,this._histograms=e}this._statistics=this._convertStats(this._statistics);this._gammaCorrection=this._getGammaCorrection()}else this._statistics=b.statistics&&0<b.statistics.length?b.statistics:this.srcStatistics,this._histograms=e,this._gammaCorrection=this._getGammaCorrection(),this._statistics=this._convertStats(this._statistics)},
_getGammaCorrection:function(){var a=this.functionArguments.gamma;if(a){var b=[],e;for(e=0;e<a.length;e++)b[e]=1<a[e]?2<a[e]?6.5+Math.pow(a[e]-2,2.5):6.5+100*Math.pow(2-a[e],4):1;return b}},_stretch:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels&&0!==this.functionArguments.stretchType){this._updateStatistisHistograms(a);var b=a.pixelBlock,e=b.pixels;b=b.width*b.height;var g=e.length,h,c;this._createLUT(a);if(null==this.LUT)return this._filterNoLUT(a);var f=this.LUT,l=this.LUTOffset;
for(h=0;h<g;h++){var q=f[h];for(c=0;c<b;c++){var t=e[h][c];e[h][c]=q[t-l]}}a.pixelBlock.pixelType="U8"}},_calculateStatisticsHistograms:function(a){a=a.pixelBlock;var b=a.pixelType,e=a.pixels,g=a.mask,h=e.length,c,f,l=function(J){this.min=-.5;this.max=255.5;this.size=256;u.mixin(this,J);this.counts=this.counts||new Uint32Array(this.size)},q=[],t,v;for(c=0;c<h;c++){var w=new l;var x=w.counts;var H=e[c];if("U8"===b)if(g)for(f=0;f<a.width*a.height;f++)g[f]&&x[H[f]]++;else for(f=0;f<a.width*a.height;f++)x[H[f]]++;
else{var A=a.statistics[c].minValue;var z=a.statistics[c].maxValue;w.min=A;w.max=z;z=(z-A)/256;var E=new Uint32Array(257);if(g)for(f=0;f<a.width*a.height;f++)g[f]&&E[Math.floor((H[f]-A)/z)]++;else for(f=0;f<a.width*a.height;f++)E[Math.floor((H[f]-A)/z)]++;for(f=0;255>f;f++)x[f]=E[f];x[255]=E[255]+E[256]}q.push(w);H=[];A=a.statistics[c].minValue;z=a.statistics[c].maxValue;for(f=v=t=E=0;f<w.size;f++)E+=x[f],t+=f*x[f];t/=E;for(f=0;f<w.size;f++)v+=x[f]*Math.pow(f-t,2);x=Math.sqrt(v/(E-1));f=(t+.5)*(w.max-
w.min)/w.size+w.min;w=x*(w.max-w.min)/w.size;H.push(A);H.push(z);H.push(f);H.push(w);a.statistics[c]={min:A,minValue:A,max:z,maxValue:z,mean:f,stddev:w}}a.histograms=q},_getCutOffPoints:function(a){var b=this.functionArguments,e=999;a&&a.pixelBlock?e=a.pixelBlock.pixels.length:a&&a.texture&&(e=3);a=Math.min(e,this._statistics.length);var g=[],h=[],c,f;switch(b.stretchType){case 5:for(c=0;c<a;c++)g[c]=this._statistics[c][0],h[c]=this._statistics[c][1];break;case 3:for(c=0;c<a;c++)g[c]=this._statistics[c][2]-
b.numberOfStandardDeviations*this._statistics[c][3],h[c]=this._statistics[c][2]+b.numberOfStandardDeviations*this._statistics[c][3],g[c]<this._statistics[c][0]&&(g[c]=this._statistics[c][0]),h[c]>this._statistics[c][1]&&(h[c]=this._statistics[c][1]);break;case 6:for(c=0;c<a;c++){e=this._histograms[c];var l=new Uint32Array(e.size);var q=e.counts;var t=0;var v=-.5===e.min&&1===(e.max-e.min)/q?.5:0;for(f=0;f<e.size;f++)t+=q[f],l[f]=t;q=b.minPercent*t/100;for(f=0;f<e.size;f++)if(l[f]>q){g[c]=e.min+(e.max-
e.min)/e.size*(f+v);break}q=(1-b.maxPercent/100)*t;for(f=e.size-2;0<=f;f--)if(l[f]<q){h[c]=e.min+(e.max-e.min)/e.size*(f+2-v);break}}break;default:for(c=0;c<e;c++)g[c]=0,h[c]=255}return{minCutOff:g,maxCutOff:h}},_createLUT:function(a){var b=this.functionArguments,e=a.pixelBlock,g=e.pixelType;if("U8"===g||"U16"===g||"S8"===g||"S16"===g){if(this._LUTSignature&&(g=this._computeLutSignature(),g.length===this._LUTSignature.length&&!g.some(function(D,L){return D!==this._LUTSignature[L]}.bind(this))))return;
g=e.pixels.length;var h=[],c=[],f=b.max,l=b.min,q=b.gamma,t=f-l,v=this._getCutOffPoints(a);a=v.minCutOff;v=v.maxCutOff;var w=0,x=256;"S8"===e.pixelType?w=-127:"S16"===e.pixelType&&(w=-32767);if("U16"===e.pixelType||"S16"===e.pixelType)x=65536;for(e=0;e<g;e++)h[e]=v[e]-a[e];var H=this._gammaCorrection;if(b.useGamma)for(e=0;e<g;e++){var A=[];for(b=0;b<x;b++){var z=b+w;var E=(z-a[e])/h[e];var J=1;1<q[e]&&(J-=Math.pow(1/t,E*H[e]));z<v[e]&&z>a[e]?A[b]=Math.floor(J*t*Math.pow(E,1/q[e]))+l:z>v[e]?A[b]=f:
z<a[e]&&(A[b]=l)}c[e]=A}else for(e=0;e<g;e++){A=[];for(b=0;b<x;b++)z=b+w,A[b]=z<a[e]?l:z>v[e]?f:Math.floor((z-a[e])/h[e]*t)+l;c[e]=A}this.LUT=c;this.LUTOffset=w;this._LUTSignature=this._computeLutSignature()}},_computeLutSignature:function(){var a=this.functionArguments,b=[],e,g;b.push(a.stretchType);b.push(a.min);b.push(a.max);b.push(a.numberOfStandardDeviations);if(this._statistics)for(e=0;e<this._statistics.length;e++)for(g=0;g<this._statistics[e].length;g++)b.push(this._statistics[e][g]);b.push(a.dra?
1:0);b.push(a.minPercent);b.push(a.maxPercent);if(a.gamma)for(e=0;e<this._statistics.length;e++)b.push(a.gamma[e]);b.push(a.useGamma?1:0);return b},_filterNoLUT:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var b=this.functionArguments,e=a.pixelBlock,g=e.pixels,h=e.mask;e=e.width*e.height;var c=g.length,f=[],l=[],q=b.max,t=b.min,v=b.gamma,w=q-t;var x=this._getCutOffPoints(a);var H=x.minCutOff,A=x.maxCutOff;for(x=0;x<c;x++)f[x]=A[x]-H[x];if(b.useGamma&&null!==v&&v.length>=
c)for(x=0;x<c;x++)l[x]=1<v[x]?2<v[x]?6.5+Math.pow(v[x]-2,2.5):6.5+100*Math.pow(2-v[x],4):1;if(b.useGamma)if(void 0!==h&&null!==h)for(b=0;b<e;b++){if(h[b])for(x=0;x<c;x++){var z=g[x][b];var E=(z-H[x])/f[x];var J=1;1<v[x]&&(J-=Math.pow(1/w,E*l[x]));z<A[x]&&z>H[x]?g[x][b]=Math.floor(J*w*Math.pow(E,1/v[x]))+t:z>A[x]?g[x][b]=q:z<H[x]&&(g[x][b]=t)}}else for(b=0;b<e;b++)for(x=0;x<c;x++)z=g[x][b],E=(z-H[x])/f[x],J=1,1<v[x]&&(J-=Math.pow(1/w,E*l[x])),z<A[x]&&z>H[x]?g[x][b]=Math.floor(J*w*Math.pow(E,1/v[x]))+
t:z>A[x]?g[x][b]=q:z<H[x]&&(g[x][b]=t);else if(void 0!==h&&null!==h)for(b=0;b<e;b++){if(h[b])for(x=0;x<c;x++)z=g[x][b],z<A[x]&&z>H[x]?g[x][b]=Math.floor((z-H[x])/f[x]*w)+t:z>A[x]?g[x][b]=q:z<H[x]&&(g[x][b]=t)}else for(b=0;b<e;b++)for(x=0;x<c;x++)z=g[x][b],z<A[x]&&z>H[x]?g[x][b]=Math.floor((z-H[x])/f[x]*w)+t:z>A[x]?g[x][b]=q:z<H[x]&&(g[x][b]=t);a.pixelBlock.pixelType="U8";return a}},_computeGammaValues:function(a){var b=this._statistics.length,e,g=[];for(e=0;e<b;e++){var h=this._statistics[e][2];"U8"!==
a&&(h=255*(h-this._statistics[e][0])/(this._statistics[e][1]-this._statistics[e][0]));g.push(this._computeGammaValue(h))}return g},_computeGammaValue:function(a){if(0!==a&&!(255<a||0>a)){var b=0;0<a&&150!=a&&255>a&&(b=150>=a?45*Math.cos(.01047*a):17*Math.sin(.021*a));b=Math.log((a+b)/255);if(0!==b&&(a=Math.log(a/255)/b,!isNaN(a)))return Math.min(9.9,Math.max(.01,a))}},readGL:function(a){return this._stretchGL(a.raster)},_stretchGL:function(a){this._performance.start();var b=this.renderTexture,e,g=
a.pixelBlock&&a.pixelBlock.pixels&&a.pixelBlock.pixels.length||this.sourceRasterInfo.raster.bandCount,h=a.pixelBlock,c=this.gl,f=c.drawingBufferWidth,l=c.drawingBufferHeight;if(!h&&this.functionArguments.dra){var q=new Float32Array(f*l*4),t=new Uint8Array(f*l);var v=new Float32Array(f*l);var w=new Float32Array(f*l);var x=new Float32Array(f*l);c.checkFramebufferStatus(c.FRAMEBUFFER)==c.FRAMEBUFFER_COMPLETE&&c.readPixels(0,0,f,l,c.RGBA,c.FLOAT,q);for(e=0;e<f*l;e++)v[e]=q[4*e],w[e]=q[4*e+1],x[e]=q[4*
e+2],t[e]=q[4*e+3];a.pixelBlock=new n({width:f,height:l,pixels:[v,w,x],mask:t});a.pixelBlock.calculateStatistics()}!h&&this.functionArguments.dra&&this._useGPUStats?(v=new Float32Array(g),w=new Float32Array(g)):(this._updateStatistisHistograms(a),q=this._getCutOffPoints(a),v=new Float32Array(g),w=new Float32Array(g),v.set(q.minCutOff.slice(0,g)),w.set(q.maxCutOff.slice(0,g)));this._initializeProgram({fragment:k.stretch,fragmentName:"Stretch"});q=this._setupTextureData(a);t=this.bindFrameBuffer();
this.renderTexture=!1;this._performance.start();if(!h&&this.functionArguments.dra&&this._useGPUStats){this._setUniforms({u_sourceDim:[f,l],u_bandCount:g});if(1===g)var H=this._readMinMax(q,2);else{H=this._readMinMax(q,0);var A=this._readMinMax(q,1)}if(6===this.functionArguments.stretchType||3===this.functionArguments.stretchType&&this.functionArguments.dra)e=this._readHistogram(H,A,a),v=e.minCutOff||v,w=e.minCutOff||w}x=this.functionArguments.max-this.functionArguments.min;a=new Float32Array(g);for(e=
0;e<g;e++)a[e]=x/(w[e]-v[e]);this._useGPUStats&&this._initializeProgram({fragment:k.stretch,fragmentName:"Stretch"});c.blendFunc(c.SRC_ALPHA,c.ZERO);x=new Float32Array(3);var z=new Float32Array(3);for(e=0;3>e;e++)x[e]=this.functionArguments.min,z[e]=this.functionArguments.max;e=this.functionArguments.useGamma;var E=this.functionArguments.gamma,J=this._gammaCorrection;Array.isArray(E)&&E.length>=g||(e=!1);this._setUniforms({u_sourceDim:[f,l],u_bandCount:g,u_minOutput:x,u_maxOutput:z,u_minCutOff:v,
u_maxCutOff:w,u_factor:a,u_state:100,u_useGamma:e,u_gamma:E,u_scaled:!b,u_gammaCorrection:J,u_minMaxTexture:!h&&this.functionArguments.dra&&this._useGPUStats?!0:!1});this.renderTexture=b;c.viewport(0,0,f,l);this._bindTexture(q.texture,"u_image");!h&&this.functionArguments.dra&&this._useGPUStats&&(b=c.getUniformLocation(this.rasterProgram,"u_image1"),c.uniform1i(b,1),c.activeTexture(c.TEXTURE1),c.bindTexture(c.TEXTURE_2D,H.texture),1<g&&(g=c.getUniformLocation(this.rasterProgram,"u_image2"),c.uniform1i(g,
2),c.activeTexture(c.TEXTURE2),c.bindTexture(c.TEXTURE_2D,A.texture)));this._drawGL();return{extent:q.extent,texture:t.texture}},_readMinMax:function(a,b){var e=this.gl,g=a.width||e.drawingBufferWidth,h=a.height||e.drawingBufferHeight;this._setUniforms({u_state:b});this.renderTexture=!1;var c=a.texture;for(e.activeTexture(e.TEXTURE0);1<g||1<h;){var f=this._createTexture();b=Math.max(Math.ceil(g/2),1);var l=Math.max(Math.ceil(h/2),1);e.getExtension("OES_texture_float");e.texImage2D(e.TEXTURE_2D,0,
e.RGBA,b,l,0,e.RGBA,e.FLOAT,null);a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,f,0);e.viewport(0,0,b,l);e.bindTexture(e.TEXTURE_2D,c);this._setUniforms({u_sourceDim:[g,h]});g=b;h=l;this._drawGL(!0);c=f}a=new Float32Array(g*h*4);e.checkFramebufferStatus(e.FRAMEBUFFER)==e.FRAMEBUFFER_COMPLETE&&e.readPixels(0,0,g,h,e.RGBA,e.FLOAT,a);return{texture:f,minmax:a}},_readHistogram:function(a,b,e){if(a)try{var g=this.gl,h=g.drawingBufferWidth,
c=g.drawingBufferHeight,f,l,q;if(a.texture instanceof WebGLTexture){var t=!0;var v=[1,0,0,1];if(b){var w=a.minmax;var x=b.minmax}else w=[a.minmax[0]],x=[a.minmax[1]]}else for(x=b,w=a,v=new Float32Array(x.length),f=0;f<x.length;f++)v[f]=256/(x[f]-w[f]);var H=new Float32Array(h*c);for(q=0;q<H.length;q++)H[q]=q;if(!this.histogramProgram){var A=m.getShader(g,m.histogram),z=k.getShader(g,k.constant);this.histogramProgram=this._loadProgram(A,z)}g.blendFunc(g.ONE,g.ONE);g.enable(g.BLEND);g.useProgram(this.histogramProgram);
var E=g.getAttribLocation(this.histogramProgram,"a_pixelIndex"),J=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,J);g.bufferData(g.ARRAY_BUFFER,H,g.STATIC_DRAW);g.enableVertexAttribArray(E);g.vertexAttribPointer(E,1,g.FLOAT,!1,0,0);var D=this._setupHistTexture(e),L=this._createTexture();g.getExtension("OES_texture_float");g.texImage2D(g.TEXTURE_2D,0,g.RGBA,257,1,0,g.RGBA,g.FLOAT,null);var C=g.createFramebuffer();g.bindFramebuffer(g.FRAMEBUFFER,C);g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,
g.TEXTURE_2D,L,0);g.viewport(0,0,257,1);var N=g.getUniformLocation(this.histogramProgram,"u_image");g.uniform1i(N,0);g.activeTexture(g.TEXTURE0);g.bindTexture(g.TEXTURE_2D,D);var S=g.getUniformLocation(this.histogramProgram,"u_sourceDim");g.uniform2f(S,h,c);var F=g.getUniformLocation(this.histogramProgram,"u_bandCount");g.uniform1i(F,3);var T=g.getUniformLocation(this.histogramProgram,"u_halfPixel");g.uniform2f(T,.5/h,.5/c);var y=g.getUniformLocation(this.histogramProgram,"u_minMaxTexture");if(t){g.uniform1i(y,
1);var B=g.getUniformLocation(this.histogramProgram,"u_image1");g.uniform1i(B,1);g.activeTexture(g.TEXTURE1);g.bindTexture(g.TEXTURE_2D,a.texture);if(b){var I=g.getUniformLocation(this.histogramProgram,"u_image2");g.uniform1i(I,2);g.activeTexture(g.TEXTURE2);g.bindTexture(g.TEXTURE_2D,b.texture)}}else{var P=g.getUniformLocation(this.histogramProgram,"u_mins");g.uniform4f(P,w[0],w[0],w[0],w[0]);g.uniform1i(y,0)}var X=g.getUniformLocation(this.histogramProgram,"u_color"),Y=g.getUniformLocation(this.histogramProgram,
"u_factors"),aa=g.getUniformLocation(this.histogramProgram,"u_size");g.uniform1f(aa,256);a=[];b=[];g.uniform4fv(X,[1,0,0,1]);g.uniform4fv(Y,[v[0],0,0,1]);g.drawArrays(g.POINTS,0,H.length);var Z=this.sourceRasterInfo.raster.bandCount;1<Z&&(g.uniform4fv(X,[0,1,0,1]),g.uniform4fv(Y,[0,v[0],0,1]),g.drawArrays(g.POINTS,0,H.length),g.uniform4fv(X,[0,0,1,1]),g.uniform4fv(Y,[0,0,v[0],1]),g.drawArrays(g.POINTS,0,H.length));if(g.checkFramebufferStatus(g.FRAMEBUFFER)==g.FRAMEBUFFER_COMPLETE){var fa=new Float32Array(1028);
g.readPixels(0,0,257,1,g.RGBA,g.FLOAT,fa);g=0;var K=-.5===w[0]&&1===(x[0]-w[0])/256?.5:0;for(f=0;f<Z;f++){var R=new Float32Array(257);var U=new Float32Array(257);for(q=g=0;256>q;q++)g+=fa[4*q+f],R[q]=g,U[q]=fa[4*q+f];U[256]=fa[1024+f];R[256]=g+fa[1024+f];var ba=this.functionArguments.minPercent*g/100;if(x){for(l=0;256>l;l++)if(R[l]>ba){a[f]=w[0]+(x[0]-w[0])/256*(l+K);break}ba=(1-this.functionArguments.maxPercent/100)*g;for(l=254;0<=l;l--)if(R[l]<ba){b[f]=w[0]+(x[0]-w[0])/256*(l+2-K);break}}}}return{histogram:fa,
minCutOff:a,maxCutOff:b}}catch(Q){console.debug("webgl filter exception: "+Q.message)}},_setupHistTexture:function(a){if(a instanceof WebGLTexture)return a;var b=this.originalHistTexture=this._createTexture(),e=this.gl;a=a.pixelBlock;var g=a.width,h=a.height;e.getExtension("OES_texture_float");this.rgbaFloatData=a.getAsRGBAFloat();e.texImage2D(e.TEXTURE_2D,0,e.RGBA,g,h,0,e.RGBA,e.FLOAT,this.rgbaFloatData);return b}})})},"esri/layers/rasterLib/function/RemapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(G,u,r,n,m,k,d){return G([n,k],{declaredClass:"esri.layers.rasterLib.function.RemapFunction",functionName:"Remap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({inputRanges:null,outputValues:null,outputColors:null,colorBreaks:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input is not available.");var b=!(!this.functionArguments.outputColors&&!this.functionArguments.colorBreaks);
this.rasterInfo=u.mixin(a.raster,{bandCount:b?3:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=b?"Processed":"Thematic";return!0},read2D:function(a){return this._remap(a.raster)},readGL:function(a){return this._remapGL(a.raster)},_remap:function(a){this._performance.start();var b=d.remapColor(a.pixelBlock,this.functionArguments.colorBreaks);this._addPerformanceMetric(this._performance.elapsed());
return{extent:a.extent,pixelBlock:b}},_remapGL:function(a){this._performance.start();this._initializeProgram({fragment:m.remap,fragmentName:"Remap"});var b=new Uint8Array(64),e=this.functionArguments.colorBreaks;e.forEach(function(f,l){b[4*l]=f.mappedColor[0];b[4*l+1]=f.mappedColor[1];b[4*l+2]=f.mappedColor[2];b[4*l+3]=1>=f.mappedColor[3]?255*f.mappedColor[3]:f.mappedColor[3]});var g=e[e.length-1],h=g.mappedColor;b[60]=h[0];b[61]=h[1];b[62]=h[2];b[63]=1>=h[3]?255*h[3]:h[3];var c=new Float32Array(16);
e.forEach(function(f,l){c[l]=f.value});c[15]=g.value;this._clrTexture||(this._clrTexture=this._setupColormapTexture(b));e=this._clrTexture;g=this.bindFrameBuffer();a=this._setupTextureData(a);this._setUniforms({u_indexedColormapOffset:0,u_indexedColormapMaxIndex:b.length/4-1,u_breaks:c});this._bindTexture(e,"u_image1");this._bindTexture(a.texture,"u_image");this._drawGL();return{extent:a.extent,texture:g.texture}},_setupColormapTexture:function(a){var b=this._createTexture(),e=a.length/4,g=new Float32Array(a.length),
h=this.renderTexture?255:1,c,f=this.gl;for(c=0;c<a.length;c++)g[c]=a[c]/h;f.getExtension("OES_texture_float");f.texImage2D(f.TEXTURE_2D,0,f.RGBA,e,1,0,f.RGBA,f.FLOAT,g);return b}})})},"esri/layers/rasterLib/function/IdentityFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(G,u,r,n,m){return G([n,m],{declaredClass:"esri.layers.rasterLib.function.IdentityFunction",functionName:"Identity",supportWebGL:!0,support2D:!0,
constructor:function(k){this.functionArguments={raster:null}},bind:function(k){k=this.getSourceRasterInfo(k);if(!k.raster)return Error("The raster input to identity function is invalid.");this.rasterInfo=u.mixin(k.raster,{});return!0},read2D:function(k){return k.raster},readGL:function(k){this._initializeProgram({fragment:r.identity,fragmentName:"identity"});k=this._setupTextureData(k.raster);var d=this.bindFrameBuffer();this._bindTexture(k.texture,"u_image");this._drawGL();return{extent:k.extent,
texture:d.texture}}})})},"esri/layers/rasterLib/function/ResampleFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(G,u,r,n,m){return G([n,m],{declaredClass:"esri.layers.rasterLib.function.ResampleFunction",renderTexture:!0,resamplingOrigin:null,resamplingRatio:null,zFactor:1,functionName:"Resample",supportWebGL:!0,support2D:!1,constructor:function(k){this.functionArguments=this.mixinIgnoreCase({resamplingType:0},
k)},bind:function(k){k=this.getSourceRasterInfo(k);if(!k.raster)return Error("The raster input to convolution function is invalid.");this.rasterInfo=u.mixin(k.raster,{bandCount:k.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,k.raster.pixelType),statistics:k.raster.statistics,histograms:k.raster.histograms});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};return!0},readGL:function(k){this._performance.start();this._initializeProgram({fragment:r.resample,fragmentName:"Resample"});
var d=this._setupTextureData(k.raster),a=this.bindFrameBuffer(),b=this.gl,e=b.drawingBufferWidth;b=b.drawingBufferHeight;var g=k.raster;void 0!==g.pixelBlock?(d=d||this._setupTextureData(g),k=g.pixelBlock.width,g=g.pixelBlock.height):(d=d||g,k=e,g=b);this._setUniforms({u_resamplingRatio:this.resamplingRatio||[k/e,g/b],u_anchor:this.resamplingOrigin||[0,1],u_resamplingType:this.functionArguments.resamplingType,u_resolution:[1/e,1/b]});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());
return{extent:d.extent,texture:a.texture}}})})},"esri/layers/rasterLib/renderer/rasterRendererHelper":function(){define("dojo/_base/declare dojo/_base/lang ../../PixelBlock ./RasterColormapRenderer ./RasterUniqueValueRenderer ./RasterRGBRenderer ./RasterStretchColorRampRenderer ./RasterClassBreaksRenderer ./RasterShadedReliefRenderer".split(" "),function(G,u,r,n,m,k,d,a,b){var e=function(){function g(c){h[c.prototype.rendererName]=c}var h={};g(n);g(k);g(d);g(m);g(a);g(b);return h}();return{wellKnownRenderers:e,
isSupported:function(g){if(!g)return!1;var h=!0;e[g.rendererName]||(h=!1);return h},create:function(g){if(!g)return null;if(g.rendererName){var h=g.rendererName;g=g.rendererArguments}else h="uniqueValue rasterStretch rasterShadedRelief rgb rasterColormap classBreaks".split(" ").indexOf(g.type),h="UniqueValue Stretch ShadedRelief RGB Colormap ClassBreaks".split(" ")[h],"rasterStretch"===g.type&&g.bandIndex&&1<g.bandIndex.length&&(h="RGB");return(h=e[h])?new h(g):null},createDefaultRenderer:function(g){if(g&&
g.raster){var h=g.raster.rasterInfo,c=g.raster.dataType;if(h){var f=g.raster.rasterFunction,l=["Stretch","Colormap","ContrastAndBrightness"];if(f&&"U8"===h.pixelType&&-1<l.indexOf(f.functionName))f.renderTexture=!0;else if("Processed"!==c||!(g.useWebGL&&f&&f.renderTexture||!g.useWebGL&&"U8"===h.pixelType)){f&&(h=f.rasterInfo);f=h.bandCount;var q=h.colormap,t=h.vat;l=h.histograms;l&&0===l.length&&(l=null);var v=h.statistics&&h.statistics.map(function(H){return[H.min,H.max,H.mean,H.stddev]});if(1===
f&&q&&0<q.length)var w=this._getDefaultColormapRenderer(t,q);else if(1===f&&t&&t.features&&0<t.features.length)w=new m({});else{q=0;t=!1;c||!g.raster||!g.raster.tileInfo||void 0!==g.raster.tileInfo.tileType&&"Map"!==g.raster.tileInfo.tileType?"U8"===h.pixelType&&"Processed"===c?(q=5,v=v||[[0,255,0,0],[0,255,0,0],[0,255,0,0]],t=!1):"U8"===h.pixelType||"Elevation"===c?(q=5,t=v?!1:!0):"Scientific"===c||"StdTime"===c?(q=5,t=v?!1:!0,w=this._getDefaultScientificColorRamp()):l&&0<l.length?(q=6,t=!1):v?(q=
5,t=!1):(q=6,t=!0):(v=[[0,255,0,0],[0,255,0,0],[0,255,0,0]],q=5,t=!1);v||(q=5,t=!0);var x;3<=f&&!(g.bandIds||g.raster&&g.raster.imageServiceParams&&g.raster.imageServiceParams.bandIds)&&(x=this.getDefaultBandCombination(h));x&&(v=x.map(function(H){return v[H]}));g={stretchType:q,min:0,max:255,dra:t,minPercent:.25,maxPercent:.25,useGamma:!1,computeGamma:!1,statistics:v,histograms:l,numberOfStandardDeviations:2.5,bandIndex:x};1===f||x&&1===x.length?(w&&(g.colorRamp=w,g.invert=!1),w=new d(g)):w=new k(g)}return w}}}},
getDefaultBandCombination:function(g){var h=g.bandCount;if(1===h)return null;if(2===h)return[0];var c=(g=g.keyProperties)&&g.ChangeAnalysisParameters&&g.ChangeAnalysisParameters.AnalysisType;if(c&&("ccdc"===c.toLowerCase()||"landtrendr"===c.toLowerCase()))return[0];g=g&&g.BandProperties;var f;if(g&&g.length===h){var l=this.getWellKnownBandIndexes(g);g=l.red;c=l.green;var q=l.blue;l=l.nir;null!=g&&null!=c&&null!=q?f=[g,c,q]:null!=l&&null!=g&&null!=c&&(f=[l,g,c])}!f&&3<=h&&(f=[0,1,2]);return f},getWellKnownBandIndexes:function(g){for(var h=
{},c=0;c<g.length;c++){var f=g[c],l=f.BandName&&f.BandName.toLowerCase();"red"===l?h.red=c:"green"===l?h.green=c:"blue"===l?h.blue=c:"nearinfrared"===l||"nearinfrared_1"===l||"nir"===l?h.nir=c:f.WavelengthMax&&f.WavelengthMin&&(l=f.WavelengthMin,f=f.WavelengthMax,null==h.blue&&410<=l&&480>=l&&480<=f&&540>=f?h.blue=c:null==h.green&&490<=l&&560>=l&&560<=f&&610>=f?h.green=c:null==h.red&&595<=l&&670>=l&&660<=f&&730>=f?h.red=c:null==h.nir&&700<=l&&860>=l&&800<=f&&950>=f&&(h.nir=c))}return h},_getDefaultColormapRenderer:function(g,
h){if(h||h.length){var c=[],f=this._ratContainsColormap(g);if(f)var l=this._getRATValueClassNameMap(g);h.forEach(function(q){var t=l?l[q[0]]:q[0];c.push({color:[q[1],q[2],q[3]],value:q[0],label:f?null!=t?t:"":q[0]})});return new n({colormapInfos:c})}},_ratContainsColormap:function(g){if(!g||!g.fields)return!1;var h,c,f;return g.fields.some(function(l){l&&l.name&&(l=l.name.toLowerCase(),"red"===l&&(h=!0),"green"===l&&(c=!0),"blue"===l&&(f=!0));return h&&c&&f})},_getRATValueClassNameMap:function(g){if(!g||
!g.fields)return null;var h={},c,f;g.fields.forEach(function(l){if("classname"===l.name.toLowerCase()||"class_name"===l.name.toLowerCase())c=l.name;"value"===l.name.toLowerCase()&&(f=l.name)});g.features.forEach(function(l){l=l.attributes;h[l[f]]=c?l[c]:l[f]});return h},_getDefaultScientificColorRamp:function(){return{type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}].map(function(g){return{fromColor:g.toColor,
toColor:g.fromColor}}).reverse()}}}})},"esri/layers/rasterLib/renderer/RasterColormapRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction"],function(G,u,r,n){return G([r],{declaredClass:"esri.layers.rasterLib.renderer.RasterColormapRenderer",rendererName:"Colormap",renderTexture:!0,constructor:function(m){m&&m.colormapInfos&&(m.colormap=m.colormapInfos.map(function(k){return[k.value].concat(k.color)}));this._function=new n(m);this._function.outputPixelType=
"U8";this._function.renderTexture=!0},draw2D:function(m){this._updateColormapParameters();m=this._clonePixelData(m);return m=this._function._colorize(m)},drawGL:function(m){this._updateColormapParameters();this._function._colorizeGL(m)},toJson:function(){var m=this._function.toJson().rasterFunctionArguments;return{rendererName:this.rendererName,rendererArguments:m}},toCommonRendererJson:function(){return{type:"rasterColormap",colormapInfos:this.colormapInfos||this.colormap.map(function(m){return{value:m[0],
color:m.slice(1),label:m[0]}})}},_updateColormapParameters:function(){var m=this._function.functionArguments;m.colormap=this.colormap;m.colormapName=this.colormapName;m.colorRamp=this.colorRamp;m.colorRampName=this.colorRampName}})})},"esri/layers/rasterLib/renderer/RasterRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","../../../geometry/Extent","../../PixelBlock"],function(G,u,r,n){return G(null,{declaredClass:"esri.layers.rasterLib.renderer.RasterRenderer",raster:null,constructor:function(m){m=
m||{};this.raster=m.raster||m.Raster||this.raster;this.draw=u.hitch(this,this.draw);this.bind=u.hitch(this,this.bind);m=u.clone(m);Object.keys(m).forEach(function(k){null==m[k]&&delete m[k]});u.mixin(this,m)},bind:function(m){if(!m)throw"failed to bind without options";var k=m;m.layer&&(m=m.layer,k={id:m.id,rawRasterInfo:m.raster.rasterInfo,glSetting:m._glSetting,xformSetting:m.tileManager&&m.tileManager.xformSetting,useWebGL:m.useWebGL,resampling:m.tileMode&&m.tileManager&&m.tileManager.xformSetting.requireProjection&&
!m._hasTilingEffects&&"Thematic"!==m.raster.dataType?1:0,tileMode:m.tileMode});this._rawRasterInfo=k.rawRasterInfo;this.useWebGL=k.useWebGL;this._function&&this._function.setProcessingContext(u.mixin({useProcessedData:!0},k));this._processingContext=k},hasTilingEffects:function(){},draw:function(m){return this.useWebGL?this.drawGL(m):this.draw2D(m)},toJson:function(){},_clonePixelData:function(m){if(null==m)return m;var k={};m.extent&&(k.extent=new r(m.extent.xmin,m.extent.ymin,m.extent.xmax,m.extent.ymax,
m.extent.spatialReference));m=m.processedPixelBlock||m.pixelBlock;if(null==m)return k;k.pixelBlock=m.clone?m.clone():n.prototype.clone(m);return k}})})},"esri/layers/rasterLib/renderer/RasterUniqueValueRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../../../renderers/colorRampGenerator"],function(G,u,r,n,m){return G([r],{declaredClass:"esri.layers.rasterLib.renderer.RasterUniqueValueRenderer",rendererName:"UniqueValue",field:"",
alias:"",uniqueValueInfos:null,constructor:function(k){k&&k.colormap&&(this.colormap=k.colormap,this._function=new n(k),this._function.outputPixelType="U8",this._function.renderTexture=!0)},bind:function(k){this.inherited(arguments);if(!this._function){var d=(this.raster&&this.raster.rasterInfo||this._rawRasterInfo).vat;if(!d)throw"uv renderer requires data source to have raster attribute table";var a=this.attributeField||this.field1||this.field,b=this.infos||this.uniqueValueInfos;this.defaultColor=
this.defaultColor||this.defaultSymbol&&this.defaultSymbol.color;var e=d.fields.filter(function(w){return"value"===w.name.toLowerCase()})[0];if(e)var g=e.name;a||((a=d.fields.filter(function(w){return-1<["classname","category"].indexOf(w.name.toLowerCase())})[0])||(a=d.fields.filter(function(w){return"esriFieldTypeString"===w.type})[0]),this.alias=(this.field=a=a&&a.name||g)&&a.alias||g);var h=[],c;if(!b){b=[];var f=d.fields.filter(function(w){return"alpha"===w.name.toLowerCase()})[0];var l=d.fields.filter(function(w){return"red"===
w.name.toLowerCase()})[0];var q=d.fields.filter(function(w){return"green"===w.name.toLowerCase()})[0];var t=d.fields.filter(function(w){return"blue"===w.name.toLowerCase()})[0];for(e=0;e<d.features.length;e++){var v=d.features[e].attributes;(c=b.some(function(w){w.value===v[a]}))||(f&&l&&q&&t?b.push({value:v[a],alias:v[a],color:[v[l.name],v[q.name],v[t.name],v[f.name]]}):l&&q&&t?b.push({value:v[a],alias:v[a],color:[v[l.name],v[q.name],v[t.name]]}):b.push({value:v[a],alias:v[a]}))}if(!(l&&q&&t))for(c=
m.createRandomColorRamp({size:b.length}),e=0;e<b.length;e++)b[e].color=c[e];this.uniqueValueInfos=b}if(b)b.forEach(function(w){h=h.concat(d.features.filter(function(x){return w.value==x.attributes[a]}).map(function(x){return[x.attributes[g]].concat(w.color||w.symbol&&w.symbol.color)}))}),this.defaultColor&&d.features.filter(function(w){h.some(function(x){return x[0]===w.attributes[g]})||h.push([w.attributes[g]].concat(this.defaultColor))});else throw"missing uniqueValueInfos property";this._function=
new n({colormap:h});this.colormap=h;this._function.outputPixelType="U8";this._function.renderTexture=!0;this._function.setProcessingContext(this._processingContext)}},draw2D:function(k){k=this._clonePixelData(k);return k=this._function._colorize(k)},drawGL:function(k){this._function._colorizeGL(k)},toJson:function(k){var d={field:this.field,uniqueValueInfos:this.uniqueValueInfos,defaultColor:this.defaultColor};k&&(d.colormap=this.colormap);return{rendererName:this.rendererName,rendererArguments:d}},
toCommonRendererJson:function(){var k=this.attributeField||this.field1||this.field,d=(this.infos||this.uniqueValueInfos).map(function(a){return{value:a.value,label:a.alias+"",symbol:{color:3===a.color.length?a.color.concat([255]):a.color,type:"esriSFS",style:"esriSFSSolid"}}});return{type:"uniqueValue",field1:k,uniqueValueInfos:d}}})})},"esri/layers/rasterLib/renderer/RasterRGBRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/rasterUtils".split(" "),
function(G,u,r,n,m,k){return G([r],{declaredClass:"esri.layers.rasterLib.renderer.RasterRGBRenderer",rendererName:"RGB",bandIndex:null,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(d){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);
d=u.mixin({},d,{stretchType:this.stretchType});this._stretchFunction=new n(d);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this.bandIndex=d.bandIndex||d.BandIndex;this._function=new m(d);this._function.functionArguments.raster=this._stretchFunction;this._function.renderTexture=!0},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},draw2D:function(d){this._updateStretchParameters();d=this._clonePixelData(d);if("U8"===d.pixelBlock.pixelType&&
!this.contrastOffset&&!this.brightnessOffset)return d;this._stretchFunction._stretch(d);var a=d.pixelBlock,b=this.bandIndex,e=Math.max.apply(null,b);a&&a.pixels.length>e&&b&&(a.pixels=b.map(function(g){return a.pixels[g]}),a.statistics&&(a.statistics=b.map(function(g){return a.statistics[g]})));if(this.contrastOffset||this.brightnessOffset)d.pixelBlock=k.contrastBrightnessStretch(d.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return d},drawGL:function(d){this._updateStretchParameters();
d.pixelBlock&&(d=this._clonePixelData(d));var a=d.pixelBlock,b=this.bandIndex,e=Math.max.apply(null,b),g=this.statistics&&0<this.statistics.length?this.statistics:this._stretchFunction&&this._stretchFunction.srcStatistics,h=this.histograms&&0<this.histograms.length?this.histograms:this._stretchFunction&&this._stretchFunction.srcHistograms,c,f;a&&a.pixels.length>e&&b&&(a.pixels=b.map(function(l){return a.pixels[l]}),a.statistics&&(a.statistics=b.map(function(l){return a.statistics[l]})),g&&0<g.length&&
g.length!==b.length&&(c=b.map(function(l){return g[l]})),h&&0<h.length&&h.length!==b.length&&(f=b.map(function(l){return h[l]})));this._stretchFunction.functionArguments.statistics=c||g;this._stretchFunction.functionArguments.histograms=f||h;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._function.renderTexture=!0,d=this._stretchFunction._stretchGL(d),this._function._cbGL(d)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(d))},toJson:function(){var d=
this._stretchFunction.toJson().rasterFunctionArguments;d.bandIndex=this.bandIndex;d.contrastOffset=this.contrastOffset;d.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:d}},toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||"minMax",min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:u.clone(this.statistics),
dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,gamma:u.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},_updateStretchParameters:function(){var d=this._stretchFunction.functionArguments;d.stretchType=this.stretchType;d.min=this.min;d.max=this.max;d.numberOfStandardDeviations=this.numberOfStandardDeviations;d.statistics=this.statistics;d.histograms=this.histograms;d.dra=this.dra;d.minPercent=this.minPercent;
d.maxPercent=this.maxPercent;d.useGamma=this.useGamma;d.gamma=this.gamma;d.computeGamma=this.computeGamma;this._stretchFunction.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterStretchColorRampRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/ResampleFunction ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),function(G,u,r,n,m,k,d,a){return G([r],
{declaredClass:"esri.layers.rasterLib.renderer.RasterStretchColorRampRenderer",rendererName:"Stretch",bandIndex:[0],colorRamp:null,invert:!1,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(b){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);
b=u.mixin({},b,{stretchType:this.stretchType});Object.keys(b).forEach(function(e){null==b[e]&&delete b[e]});this._function=new k(b);this._stretchFunction=new m(b);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this._clrFunction=new d(b);this._clrFunction.functionArguments.raster=this._stretchFunction;this._clrFunction.renderTexture=!1;this._function.functionArguments.raster=this._clrFunction},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},
draw2D:function(b){this._updateStretchParameters();b=this._clonePixelData(b);if("U8"===b.pixelBlock.pixelType&&!(this.contrastOffset||this.brightnessOffset||this.colorRamp))return b;this._stretchFunction._stretch(b);var e=b.pixelBlock,g=this.bandIndex?this.bandIndex[0]:0;e&&1<e.pixels.length&&e.pixels.length>g&&(e.pixels=[e.pixels[g]],e.statistics&&(e.statistics=[e.statistics[g]]));this.colorRamp&&(b=this._clrFunction._colorize(b));if(this.contrastOffset||this.brightnessOffset)b.pixelBlock=a.contrastBrightnessStretch(b.pixelBlock,
{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return b},drawGL:function(b){this._updateStretchParameters();b.pixelBlock&&(b=this._clonePixelData(b));var e=b.pixelBlock,g=this.bandIndex?this.bandIndex[0]||0:0,h=this.statistics&&0<this.statistics.length?this.statistics:this._stretchFunction&&this._stretchFunction.srcStatistics,c=this.histograms&&0<this.histograms.length?this.histograms:this._stretchFunction&&this._stretchFunction.srcHistograms,f,l;e&&1<e.pixels.length&&
e.pixels.length>g&&(e.pixels=[e.pixels[g]],e.statistics&&(e.statistics=[e.statistics[g]]),h&&h.length>g&&(f=[h[g]]),c&&c.length>g&&(l=[c[g]]));this._stretchFunction.functionArguments.statistics=f||h;this._stretchFunction.functionArguments.histograms=l||c;e=!!this.colorRamp;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!1,this._function.renderTexture=!0,b=this._stretchFunction._stretchGL(b),e&&(b=this._clrFunction._colorizeGL(b)),
this._function._cbGL(b)):e?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!0,b=this._stretchFunction._stretchGL(b),this._clrFunction._colorizeGL(b)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(b))},toJson:function(){var b=this._stretchFunction.toJson().rasterFunctionArguments;b.colorRamp=this.colorRamp||"";this.invert&&(b.invert=!0);b.contrastOffset=this.contrastOffset;b.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,
rendererArguments:b}},toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||"minMax",colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp,min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:u.clone(this.statistics),dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,
gamma:u.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},_updateStretchParameters:function(){var b=this._stretchFunction.functionArguments;b.stretchType=this.stretchType;b.min=this.min;b.max=this.max;b.numberOfStandardDeviations=this.numberOfStandardDeviations;b.statistics=this.statistics;b.histograms=this.histograms;b.dra=this.dra;b.minPercent=this.minPercent;b.maxPercent=this.maxPercent;b.useGamma=this.useGamma;b.gamma=this.gamma;b.computeGamma=this.computeGamma;
this._stretchFunction.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterClassBreaksRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../function/RemapFunction"],function(G,u,r,n,m){return G([r],{declaredClass:"esri.layers.rasterLib.renderer.RasterClassBreaksRenderer",rendererName:"ClassBreaks",renderTexture:!0,constructor:function(k){k=k||{};this._function=new m(k);this._function.outputPixelType="U8";var d=
k.classBreakInfos;k=k.minValue;null!=k&&d&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(k,d))},bind:function(k){this.inherited(arguments);this.isColormapFunction=!1;var d=this.raster&&this.raster.rasterInfo||this._rawRasterInfo,a=d&&d.vat;if(a&&"u8"===d.pixelType.toLowerCase()&&this.classBreakInfos){var b=this.field;if(d=a.fields.filter(function(l){return"value"===l.name.toLowerCase()})[0])var e=d.name;var g=a.features.sort(function(l,q){return parseFloat(l.attributes[b])-
parseFloat(q.attributes[b])})[0].attributes[b];this.isColormapFunction=!0;var h=[],c=this.field,f=this.classBreakInfos;f.forEach(function(l,q){a.features.forEach(function(t){var v=f[q-1]&&f[q-1].classMaxValue||g;t.attributes[c]<=l.classMaxValue&&(t.attributes[c]>v||t.attributes[c]===g)&&(v=l.symbol.color,h.some(function(w){return w[0]===t.attributes[e]})||h.push([t.attributes[e]].concat(v)))})});this._function=new n({colormap:h});this.colormap=h;this._function.outputPixelType="U8";this._function.renderTexture=
!0}this._function&&this._function.setProcessingContext(u.mixin({useProcessedData:!0},this._processingContext))},draw2D:function(k){if(this.isColormapFunction)return this._updateColormapParameters(),k=this._clonePixelData(k),k=this._function._colorize(k);this._updateRemapParameters();return this._function._remap(k)},drawGL:function(k){this.isColormapFunction?(this._updateColormapParameters(),this._function._colorizeGL(k)):(this._function.renderTexture=!0,this._updateRemapParameters(),this._function._remapGL(k))},
toJson:function(){var k=this._function.toJson().rasterFunctionArguments;return{rendererName:this.rendererName,rendererArguments:k}},toCommonRendererJson:function(){var k,d=this.classBreakInfos,a=this.colorBreaks;if(null==d&&a)for(d=[],k=0;k<a.length-1;k++)d.push({classMaxValue:a[k+1].value,symbol:{color:a[k].mappedColor,type:"esriSFS",style:"esriSFSSolid"},label:a[k].value+" - "+a[k+1].value});return{type:"classBreaks",field:"Value",minValue:null!=this.minValue?this.minValue:a[0].value,classBreakInfos:d}},
_updateRemapParameters:function(){var k=this.classBreakInfos,d=this.minValue;null!=d&&k&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(d,k))},_getSortedColorBreaks:function(k,d){d=d.map(function(b){return{maxValue:b.classMaxValue,color:b.symbol.color}}).sort(function(b,e){return b.maxValue-e.maxValue});var a=[{value:k,mappedColor:d[0].color}];for(k=0;k<d.length;k++)a.push({value:d[k].maxValue,mappedColor:k===d.length-1?d[k].color:d[k+1].color});return a},_updateColormapParameters:function(){this._function.functionArguments.colormap=
this.colormap;this._function.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterShadedReliefRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/HillshadeFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),function(G,u,r,n,m,k,d){return G([r],{declaredClass:"esri.layers.rasterLib.renderer.RasterShadedReliefRenderer",rendererName:"ShadedRelief",hillshadeType:null,azimuth:315,
altitude:45,zFactor:1,slopeType:null,psPower:.664,psFactor:.024,raster:null,constructor:function(a){this.hillshadeType="number"===typeof this.hillshadeType?this.hillshadeType:["traditional","multi-directional"].indexOf(this.hillshadeType);a&&a.scalingType&&(this.slopeType="adjusted"===a.scalingType?3:1);a&&a.pixelSizePower&&(this.psPower=a.pixelSizePower);a&&a.pixelSizeFactor&&(this.psFactor=a.pixelSizeFactor);a=u.mixin({},a,{hillshadeType:this.hillshadeType,psPower:this.psPower,psFactor:this.psFactor,
slopeType:this.slopeType});Object.keys(a).forEach(function(b){null==a[b]&&delete a[b]});this._function=new m(a);this._hillshadeFunction=new n(a);this._hillshadeFunction.outputPixelType="U8";this._hillshadeFunction.renderTexture=!1;this._function.functionArguments.raster=this._hillshadeFunction},hasTilingEffects:function(){return this._hillshadeFunction.hasTilingEffects()},draw2D:function(a){this._updateHillshadeParameters();a=this._clonePixelData(a);a=this._hillshadeFunction.read2D({raster:a});if(this.contrastOffset||
this.brightnessOffset)a.pixelBlock=d.contrastBrightnessStretch(a.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return a},drawGL:function(a){this._updateHillshadeParameters();this.contrastOffset||this.brightnessOffset?(this._hillshadeFunction.renderTexture=!1,this._function.renderTexture=!0,a=this._hillshadeFunction.readGL({raster:a}),this._function._cbGL(a)):(this._hillshadeFunction.renderTexture=!0,this._hillshadeFunction.readGL({raster:a}))},toJson:function(){var a=
this._hillshadeFunction.toJson().rasterFunctionArguments;a.colorRamp=this.colorRamp||"";this.invert&&(a.invert=!0);a.contrastOffset=this.contrastOffset;a.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:a}},toCommonRendererJson:function(){return{type:"rasterShadedRelief",hillshadeType:["traditional","multi-directional"][this.hillshadeType]||"traditional",azimuth:this.azimuth,altitude:this.altitude,zFactor:this.zFactor,scalingType:3===this.slopeType?"adjusted":
"none",pixelSizePower:this.psPower,pixelSizeFactor:this.psFactor,colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp}},_updateHillshadeParameters:function(){var a=this._hillshadeFunction.functionArguments;a.hillshadeType=this.hillshadeType;a.azimuth=this.azimuth;a.altitude=this.altitude;a.zFactor=this.zFactor;a.slopeType=this.slopeType;a.psPower=this.psPower;a.psFactor=this.psFactor}})})},"esri/layers/rasterLib/raster/rasterProjectionHelper":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/sniff ../../../kernel ../../../WKIDUnitConversion ../../../geometry/Extent ../../../geometry/projection ../../../geometry/webMercatorUtils ../../../SpatialReference ../../../geometry/Point".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g){G={requirePE:function(c,f){return!(c.equals(f)||c._canProject(f))},load:function(){var c=new r;if(!this._loadPromise)if(a.isSupported())this._loadPromise=a.load();else{var f=new r;f.reject("projection engine is not supported on this version of the browser, please try with a modern browser");this._loadPromise=f.promise}this._loadPromise.isFulfilled()?this._loadPromise.isResolved()?c.resolve():this._loadPromise.isRejected()&&c.resolve():(this._pendingdfds=this._pendingdfds||
[],this._pendingdfds.push(c),this._loadPromise.then(u.hitch(this,function(){this._pendingdfds.forEach(function(l){l.isFulfilled()||l.resolve()})}),u.hitch(this,function(){this._pendingdfds.forEach(function(l){l.isFulfilled()||l.reject()})})));return c.promise},computeError:function(c,f){return[Math.abs((c[0]+c[4]+c[4*f.rows]+c[4*f.rows+4])/4-c[2*f.rows+2]),Math.abs((c[1]+c[5]+c[4*f.rows+1]+c[4*f.rows+5])/4-c[2*f.rows+3])]},getDefaultDatumTransformationForDataset:function(c,f,l){if(!(f&&c.spatialReference&&
this.requirePE(c.spatialReference,f)&&a.isLoaded()))return null;c=new d(c.toJson());f=new e(f.toJson());return l?a.getTransformation(f,c.spatialReference,c):a.getTransformation(c.spatialReference,f,c)},project:function(c,f,l){if(!f||c.spatialReference.equals(f))return c;var q=a.isLoaded()?a:b;"esri.geometry.Extent"===c.declaredClass?c=new d(c.toJson()):"esri.geometry.Point"===c.declaredClass&&(c=new g(c.toJson()));f=new e(f.toJson());(c=q.project(c,f))&&"esri.geometry.Extent"===c.declaredClass?(c=
new d(c.toJson()),l&&(1E-5>Math.abs(c.xmin+180)&&1E-5>Math.abs(c.xmax-180)?(c.xmin=0,c.xmax=360):(0>c.xmin&&(c.xmin+=360,c.xmax+=360),0>c.xmax&&(c.xmax+=360)))):c&&"esri.geometry.Point"===c.declaredClass&&(c=new g(c.toJson()),l&&0>c.x&&(c.x+=360));return c},projectResolution:function(c,f,l){var q=l.xmin+(l.xmax-l.xmin)/2;l=l.ymin+(l.ymax-l.ymin)/2;c=new d(q,l,q+c.x,l+c.y,c.spatialReference);c=this.project(c,f);return new g(c.xmax-c.xmin,c.ymax-c.ymin,f)},getProjectionOffsetGrid:function(c,f,l,q,t,
v,w){null==w&&(w=[32,32]);var x=c.xmin,H=c.ymin,A=c.xmax,z=c.ymax,E=c.spatialReference,J=f.spatialReference,D=a.isLoaded()?a:b,L=t?-t:null,C=w[0]*l.x,N=w[1]*l.y;A={cols:Math.ceil((A-x)/C)+1,rows:Math.ceil((z-H)/N)+1};c=[];for(z=0;z<A.cols;z++){var S=F;var F=[];for(l=0;l<A.rows;l++){var T=new g({x:x+C*z,y:H+N*l,spatialReference:E});T=D.project(T,J,v);if(!T)return null;q&&0>T.x&&(T.x+=360);F.push(T);0<z&&null!=L&&T.x<S[l].x&&(T.x+=t-L,T.x<S[l].x&&(T.x+=t-L));c.push((T.x-f.xmin)/(f.xmax-f.xmin));c.push((T.y-
f.ymin)/(f.ymax-f.ymin))}}f=this.computeError(c,A);q=new Float32Array((A.cols-1)*(A.rows-1)*12);t=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]);v=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(z=0;z<A.cols-1;z++)for(l=0;l<A.rows-1;l++){C=z*A.rows*2+2*l;x=c[C];H=c[C+1];F=c[C+2];E=c[C+3];C+=2*A.rows;J=c[C];D=c[C+1];L=c[C+2];N=c[C+3];S=0;T=12*(l*(A.cols-1)+z);for(C=0;3>C;C++)q[T++]=t[S++]*x+t[S++]*F+t[S++]*L;for(C=S=0;3>C;C++)q[T++]=t[S++]*H+t[S++]*E+t[S++]*N;for(C=S=0;3>C;C++)q[T++]=v[S++]*x+v[S++]*J+v[S++]*
L;for(C=S=0;3>C;C++)q[T++]=v[S++]*H+v[S++]*D+v[S++]*N}return{offsets:c,error:f,coefficients:q,spacing:w,size:[A.cols-1,A.rows-1]}},getHalfWorldWidth:function(c){var f=c&&c.wkid;if(null!=f)return c.isWebMercator()&&(f=3857),null==k[f]?180:h[f]}};n("extend-esri")&&u.setObject("layers.rasterLib.raster.rasterProjectionHelper",G,m);var h={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3832:3339584.723798206,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,
6933:1.7367530445161372E7,8858:7396237.374497803,8859:2465412.4581659334,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53025:7276828.3848298555,53031:1.0384677558821043E7,53034:2.001508679602057E7,53036:7389443.187332862,53037:2463147.729110953,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,
54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54025:7311399.09166516,54031:1.0396310810074743E7,54034:2.0037508342789244E7,54050:808820.9223376509,54053:1920897.3915568967,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54099:1.3524439768288724E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7,102038:4297258.582585486,102299:5013965.117483125};return G})},"esri/geometry/projection":function(){define("require exports dojo/Deferred ./pe ../SpatialReference ./GeographicTransformation".split(" "),
function(G,u,r,n,m,k){function d(h,c,f,l,q){void 0===l&&(l=null);void 0===q&&(q=!1);if(null===l){var t=k.cacheKey(c,f);void 0!==g[t]?l=g[t]:(l=a(c,f,null),null===l&&(l=new k),g[t]=l)}return b._project(h,c,f instanceof m||!1===q?f:new m(f),l,q)}function a(h,c,f){void 0===f&&(f=null);h=b._getTransformation(h,c,f);return null!==h?k.fromGE(h):null}Object.defineProperty(u,"__esModule",{value:!0});var b=null;u.isLoaded=function(){return!!b&&n.isLoaded()};u.isSupported=function(){return n.isSupported()};
var e=null;u.load=function(){if(e)return e.promise;e=new r;var h=n.load();G(["./geometryEngine"],function(c){b=c;h.then(function(){b._enableProjection(n);e.resolve()},function(f){e.reject(f)})});return e.promise};u.project=function(h,c,f){void 0===f&&(f=null);return h instanceof Array?0===h.length?[]:d(h,h[0].spatialReference,c,f):d([h],h.spatialReference,c,f)[0]};var g={};u.projectMany=d;u.getTransformation=a;u.getTransformations=function(h,c,f){void 0===f&&(f=null);h=b._getTransformationBySuitability(h,
c,f);if(null!==h){c=[];for(f=0;f<h.length;f++)c.push(k.fromGE(h[f]));return c}return[]}})},"esri/geometry/pe":function(){define(["require","exports","../core/tsSupport/extendsHelper","dojo/Deferred","../core/sniff"],function(G,u,r,n,m){function k(t){function v(A,z,E){A[z]=E(A[z])}u._pe=t;h.init();c.init();f.init();l.init();q.init();u.PeGCSExtent=function(A){function z(){return null!==A&&A.apply(this,arguments)||this}r(z,A);z.prototype.destroy=function(){u._pe.destroy(this)};return z}(u._pe.PeGCSExtent);
for(var w=0,x=[u._pe.PeDatum,u._pe.PeGeogcs,u._pe.PeGeogtran,u._pe.PeObject,u._pe.PeParameter,u._pe.PePrimem,u._pe.PeProjcs,u._pe.PeSpheroid,u._pe.PeUnit];w<x.length;w++)t=x[w],v(t.prototype,"getName",function(A){return function(){return A.call(this,Array(h.PE_NAME_MAX))}});w=0;for(x=[u._pe.PeGeogtran,u._pe.PeProjcs];w<x.length;w++)t=x[w],v(t.prototype,"getParameters",function(A){return function(){for(var z=Array(h.PE_PARM_MAX),E=A.call(this),J=0;J<z.length;J++){var D=u._pe.getValue(E,"*");z[J]=D?
u._pe.wrapPointer(D,u._pe.PeParameter):null;E+=Int32Array.BYTES_PER_ELEMENT}return z}});v(u._pe.PeHorizon.prototype,"getCoord",function(A){return function(){var z=this.getSize();if(!z)return null;var E=[],J=A.call(this);e(E,z,J);return E}});v(u._pe.PeGTlistExtendedEntry.prototype,"getEntries",function(A){var z=u._pe._pe_getPeGTlistExtendedGTsSize();return function(){var E=null,J=A.call(this);if(!u._pe.compare(J,u._pe.NULL)){E=[J];var D=this.getSteps();if(1<D){J=u._pe.getPointer(J);for(var L=1;L<D;L++)E.push(u._pe.wrapPointer(J+
z*L,u._pe.PeGTlistExtendedGTs))}}return E}});var H=u._pe._pe_getPeHorizonSize();t=function(A){return function(){var z=this._cache;z||(this._cache=z=new Map);if(z.has(A))return z.get(A);var E=null,J=A.call(this);if(!u._pe.compare(J,u._pe.NULL)){E=[J];var D=J.getNump();if(1<D){J=u._pe.getPointer(J);for(var L=1;L<D;L++)E.push(u._pe.wrapPointer(J+H*L,u._pe.PeHorizon))}}z.set(A,E);return E}};v(u._pe.PeProjcs.prototype,"horizonGcsGenerate",t);v(u._pe.PeProjcs.prototype,"horizonPcsGenerate",t);u._pe.PeObject.prototype.toString=
function(A){void 0===A&&(A=h.PE_STR_OPTS_NONE);u._pe.ensureCache.prepare();var z=u._pe.getPointer(this),E=u._pe.ensureInt8(Array(h.PE_BUFFER_MAX));return u._pe.UTF8ToString(u._pe._pe_object_to_string_ext(z,A,E))}}function d(t){if(t){var v=u._pe.getClass(t);v&&(v=u._pe.getCache(v))&&(t=u._pe.getPointer(t))&&delete v[t]}}function a(t,v){var w=[];v=Array(v);for(var x=0;x<t;x++)w.push(u._pe.ensureInt8(v));return w}function b(t){if(Array.isArray(t[0])){var v=[];t.forEach(function(w){v.push(w[0],w[1])})}else v=
t;return v}function e(t,v,w,x){void 0===x&&(x=!1);if(x)for(x=0;x<2*v;x++)t[x]=u._pe.getValue(w+x*Float64Array.BYTES_PER_ELEMENT,"double");else{var H=0===t.length;for(x=0;x<v;x++)H&&(t[x]=Array(2)),t[x][0]=u._pe.getValue(w,"double"),t[x][1]=u._pe.getValue(w+Float64Array.BYTES_PER_ELEMENT,"double"),w+=2*Float64Array.BYTES_PER_ELEMENT}}Object.defineProperty(u,"__esModule",{value:!0});var g;u._pe=null;u.isLoaded=function(){return!!u._pe};u.isSupported=function(){return!!m("esri-wasm")};u.load=function(){if(g)return g.promise;
g=new n;G(["./support/pe-wasm"],function(t){t({locateFile:function(v){return G.toUrl("./support/"+v)},onAbort:function(v){g.reject(Error(v))}}).then(function(v){k(v);g.resolve()})});return g.promise};(function(t){function v(H,A,z){u._pe.ensureCache.prepare();var E=b(z),J=z===E;E=u._pe.ensureFloat64(E);(H=u._pe._pe_geog_to_proj(u._pe.getPointer(H),A,E))&&e(z,A,E,J);return H}function w(H,A,z){return x(H,A,z,0)}function x(H,A,z,E){u._pe.ensureCache.prepare();var J=b(z),D=z===J;J=u._pe.ensureFloat64(J);
(H=u._pe._pe_proj_to_geog_center(u._pe.getPointer(H),A,J,E))&&e(z,A,J,D);return H}t.geogToProj=v;t.projGeog=function(H,A,z,E){switch(E){case h.PE_TRANSFORM_P_TO_G:return w(H,A,z);case h.PE_TRANSFORM_G_TO_P:return v(H,A,z)}return 0};t.projToGeog=w;t.projToGeogCenter=x})(u.PeCSTransformations||(u.PeCSTransformations={}));var h;(function(t){t.init=function(){t.PE_BUFFER_MAX=u._pe.PeDefs.prototype.PE_BUFFER_MAX;t.PE_NAME_MAX=u._pe.PeDefs.prototype.PE_NAME_MAX;t.PE_MGRS_MAX=u._pe.PeDefs.prototype.PE_MGRS_MAX;
t.PE_USNG_MAX=u._pe.PeDefs.prototype.PE_USNG_MAX;t.PE_DD_MAX=u._pe.PeDefs.prototype.PE_DD_MAX;t.PE_DDM_MAX=u._pe.PeDefs.prototype.PE_DDM_MAX;t.PE_DMS_MAX=u._pe.PeDefs.prototype.PE_DMS_MAX;t.PE_UTM_MAX=u._pe.PeDefs.prototype.PE_UTM_MAX;t.PE_PARM_MAX=u._pe.PeDefs.prototype.PE_PARM_MAX;t.PE_TYPE_NONE=u._pe.PeDefs.prototype.PE_TYPE_NONE;t.PE_TYPE_GEOGCS=u._pe.PeDefs.prototype.PE_TYPE_GEOGCS;t.PE_TYPE_PROJCS=u._pe.PeDefs.prototype.PE_TYPE_PROJCS;t.PE_TYPE_GEOGTRAN=u._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;
t.PE_TYPE_COORDSYS=u._pe.PeDefs.prototype.PE_TYPE_COORDSYS;t.PE_TYPE_UNIT=u._pe.PeDefs.prototype.PE_TYPE_UNIT;t.PE_STR_OPTS_NONE=u._pe.PeDefs.prototype.PE_STR_OPTS_NONE;t.PE_STR_AUTH_NONE=u._pe.PeDefs.prototype.PE_STR_AUTH_NONE;t.PE_STR_AUTH_TOP=u._pe.PeDefs.prototype.PE_STR_AUTH_TOP;t.PE_STR_NAME_CANON=u._pe.PeDefs.prototype.PE_STR_NAME_CANON;t.PE_PARM_X0=u._pe.PeDefs.prototype.PE_PARM_X0;t.PE_PARM_ND=u._pe.PeDefs.prototype.PE_PARM_ND;t.PE_TRANSFORM_1_TO_2=u._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;
t.PE_TRANSFORM_2_TO_1=u._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;t.PE_TRANSFORM_P_TO_G=u._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;t.PE_TRANSFORM_G_TO_P=u._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;t.PE_HORIZON_RECT=u._pe.PeDefs.prototype.PE_HORIZON_RECT;t.PE_HORIZON_POLY=u._pe.PeDefs.prototype.PE_HORIZON_POLY;t.PE_HORIZON_LINE=u._pe.PeDefs.prototype.PE_HORIZON_LINE;t.PE_HORIZON_DELTA=u._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(h=u.PeDefs||(u.PeDefs={}));(function(t){function v(A,z){var E=null,J=x[A];
J||(J={},x[A]=J);J.hasOwnProperty(String(z))?E=J[z]:(A=u._pe.PeFactory.prototype.factoryByType(A,z),u._pe.compare(A,u._pe.NULL)||(E=A,J[z]=E));return E=w(E)}function w(A){if(A){var z=A.getType();switch(z){case h.PE_TYPE_GEOGCS:A=u._pe.castObject(A,u._pe.PeGeogcs);break;case h.PE_TYPE_PROJCS:A=u._pe.castObject(A,u._pe.PeProjcs);break;case h.PE_TYPE_GEOGTRAN:A=u._pe.castObject(A,u._pe.PeGeogtran);break;default:z&h.PE_TYPE_UNIT&&(A=u._pe.castObject(A,u._pe.PeUnit))}}return A}var x={},H={};t.initialize=
function(){u._pe.PeFactory.prototype.initialize(null)};t.coordsys=function(A){return v(h.PE_TYPE_COORDSYS,A)};t.factoryByType=v;t.fromString=function(A,z){var E=null,J=H[A];J||(J={},H[A]=J);J.hasOwnProperty(z)?E=J[z]:(A=u._pe.PeFactory.prototype.fromString(A,z),u._pe.compare(A,u._pe.NULL)||(E=A,J[z]=E));return E=w(E)};t.geogcs=function(A){return v(h.PE_TYPE_GEOGCS,A)};t.geogtran=function(A){return v(h.PE_TYPE_GEOGTRAN,A)};t.getCode=function(A){return u._pe.PeFactory.prototype.getCode(A)};t.projcs=
function(A){return v(h.PE_TYPE_PROJCS,A)};t.unit=function(A){return v(h.PE_TYPE_UNIT,A)}})(u.PeFactory||(u.PeFactory={}));u.PeGCSExtent=null;var c;(function(t){var v;t.init=function(){t.PE_GTLIST_OPTS_COMMON=u._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;v=u._pe._pe_getPeGTlistExtendedEntrySize()};t.getGTlist=function(w,x,H,A,z,E){var J=null,D=new u._pe.PeInteger(E);try{var L=u._pe.PeGTlistExtended.prototype.getGTlist(w,x,H,A,z,D);if(E=D.val)if(J=[L],1<E){var C=u._pe.getPointer(L);for(w=1;w<
E;w++)J.push(u._pe.wrapPointer(C+v*w,u._pe.PeGTlistExtendedEntry))}}finally{u._pe.destroy(D)}return J}})(c=u.PeGTlistExtended||(u.PeGTlistExtended={}));(function(t){t.destroy=function(v){if(v&&v.length){for(var w=0;w<v.length;w++){var x=v[w];d(x);x.getEntries().forEach(function(H){d(H);H=H.getGeogtran();d(H);H.getParameters().forEach(d);[H.getGeogcs1(),H.getGeogcs2()].forEach(function(A){d(A);var z=A.getDatum();d(z);d(z.getSpheroid());d(A.getPrimem());d(A.getUnit())})})}u._pe.PeGTlistExtendedEntry.prototype.Delete(v[0])}}})(u.PeGTlistExtendedEntry||
(u.PeGTlistExtendedEntry={}));(function(t){t.geogToGeog=function(v,w,x,H,A){u._pe.ensureCache.prepare();var z=b(x),E=x===z;z=u._pe.ensureFloat64(z);var J=0;H&&(J=u._pe.ensureFloat64(H));(v=u._pe._pe_geog_to_geog(u._pe.getPointer(v),w,z,J,A))&&e(x,w,z,E);return v}})(u.PeGTTransformations||(u.PeGTTransformations={}));(function(t){function v(x,H,A,z,E,J){u._pe.ensureCache.prepare();switch(x){case "dd":var D=u._pe._pe_geog_to_dd;var L=h.PE_DD_MAX;break;case "ddm":D=u._pe._pe_geog_to_ddm;L=h.PE_DDM_MAX;
break;case "dms":D=u._pe._pe_geog_to_dms,L=h.PE_DMS_MAX}x=0;H&&(x=u._pe.getPointer(H));H=b(z);H=u._pe.ensureFloat64(H);L=a(A,L);z=u._pe.ensureInt32(L);if(E=D(x,A,H,E,z))for(D=0;D<A;D++)J[D]=u._pe.UTF8ToString(L[D]);return E}function w(x,H,A,z,E){u._pe.ensureCache.prepare();switch(x){case "dd":var J=u._pe._pe_dd_to_geog;break;case "ddm":J=u._pe._pe_ddm_to_geog;break;case "dms":J=u._pe._pe_dms_to_geog}x=0;H&&(x=u._pe.getPointer(H));H=z.map(function(D){return u._pe.ensureString(D)});z=u._pe.ensureInt32(H);
H=u._pe.ensureFloat64(Array(2*A));(J=J(x,A,z,H))&&e(E,A,H);return J}t.geog_to_dms=function(x,H,A,z,E){return v("dms",x,H,A,z,E)};t.dms_to_geog=function(x,H,A,z){return w("dms",x,H,A,z)};t.geog_to_ddm=function(x,H,A,z,E){return v("ddm",x,H,A,z,E)};t.ddm_to_geog=function(x,H,A,z){return w("ddm",x,H,A,z)};t.geog_to_dd=function(x,H,A,z,E){return v("dd",x,H,A,z,E)};t.dd_to_geog=function(x,H,A,z){return w("dd",x,H,A,z)}})(u.PeNotationDms||(u.PeNotationDms={}));var f;(function(t){t.init=function(){t.PE_MGRS_STYLE_NEW=
u._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;t.PE_MGRS_STYLE_OLD=u._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;t.PE_MGRS_STYLE_AUTO=u._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;t.PE_MGRS_180_ZONE_1_PLUS=u._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;t.PE_MGRS_ADD_SPACES=u._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};t.geog_to_mgrs_extended=function(v,w,x,H,A,z,E){u._pe.ensureCache.prepare();var J=0;v&&(J=u._pe.getPointer(v));v=b(x);x=u._pe.ensureFloat64(v);v=a(w,h.PE_MGRS_MAX);
var D=u._pe.ensureInt32(v);if(H=u._pe._pe_geog_to_mgrs_extended(J,w,x,H,A,z,D))for(A=0;A<w;A++)E[A]=u._pe.UTF8ToString(v[A]);return H};t.mgrs_to_geog_extended=function(v,w,x,H,A){u._pe.ensureCache.prepare();var z=0;v&&(z=u._pe.getPointer(v));v=x.map(function(E){return u._pe.ensureString(E)});x=u._pe.ensureInt32(v);v=u._pe.ensureFloat64(Array(2*w));(H=u._pe._pe_mgrs_to_geog_extended(z,w,x,H,v))&&e(A,w,v);return H}})(f=u.PeNotationMgrs||(u.PeNotationMgrs={}));(function(t){t.geog_to_usng=function(v,
w,x,H,A,z,E){u._pe.ensureCache.prepare();var J=0;v&&(J=u._pe.getPointer(v));v=b(x);x=u._pe.ensureFloat64(v);v=a(w,h.PE_MGRS_MAX);var D=u._pe.ensureInt32(v);if(H=u._pe._pe_geog_to_usng(J,w,x,H,A,z,D))for(A=0;A<w;A++)E[A]=u._pe.UTF8ToString(v[A]);return H};t.usng_to_geog=function(v,w,x,H){u._pe.ensureCache.prepare();var A=0;v&&(A=u._pe.getPointer(v));v=x.map(function(z){return u._pe.ensureString(z)});x=u._pe.ensureInt32(v);v=u._pe.ensureFloat64(Array(2*w));(A=u._pe._pe_usng_to_geog(A,w,x,v))&&e(H,w,
v);return A}})(u.PeNotationUsng||(u.PeNotationUsng={}));var l;(function(t){t.init=function(){t.PE_UTM_OPTS_NONE=u._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;t.PE_UTM_OPTS_ADD_SPACES=u._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;t.PE_UTM_OPTS_NS=u._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};t.geog_to_utm=function(v,w,x,H,A){u._pe.ensureCache.prepare();var z=0;v&&(z=u._pe.getPointer(v));v=b(x);x=u._pe.ensureFloat64(v);v=a(w,h.PE_UTM_MAX);var E=u._pe.ensureInt32(v);if(H=u._pe._pe_geog_to_utm(z,
w,x,H,E))for(z=0;z<w;z++)A[z]=u._pe.UTF8ToString(v[z]);return H};t.utm_to_geog=function(v,w,x,H,A){u._pe.ensureCache.prepare();var z=0;v&&(z=u._pe.getPointer(v));v=x.map(function(E){return u._pe.ensureString(E)});x=u._pe.ensureInt32(v);v=u._pe.ensureFloat64(Array(2*w));(H=u._pe._pe_utm_to_geog(z,w,x,H,v))&&e(A,w,v);return H}})(l=u.PeNotationUtm||(u.PeNotationUtm={}));var q;(function(t){var v=new Map;t.init=function(){t.PE_PCSINFO_OPTION_NONE=u._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;t.PE_PCSINFO_OPTION_DOMAIN=
u._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;t.PE_POLE_OUTSIDE_BOUNDARY=u._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;t.PE_POLE_POINT=u._pe.PePCSInfo.prototype.PE_POLE_POINT};t.generate=function(w,x){void 0===x&&(x=t.PE_PCSINFO_OPTION_DOMAIN);var H;if(v.has(w)){var A=v.get(w);A[x]&&(H=A[x])}H||(H=u._pe.PePCSInfo.prototype.generate(w,x),A||(A=[],v.set(w,A)),A[x]=H);return H}})(q=u.PePCSInfo||(u.PePCSInfo={}));(function(t){t.version_string=function(){return u._pe.PeVersion.prototype.version_string()}})(u.PeVersion||
(u.PeVersion={}));u._init=k})},"esri/core/tsSupport/extendsHelper":function(){define([],function(){return function(){var G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,r){u.__proto__=r}||function(u,r){for(var n in r)r.hasOwnProperty(n)&&(u[n]=r[n])};return function(u,r){function n(){this.constructor=u}G(u,r);u.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}()})},"esri/geometry/GeographicTransformation":function(){define(["require","exports","./GeographicTransformationStep"],
function(G,u,r){return function(){function n(m){this.steps=[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(m&&m.steps){var k=0;for(m=m.steps;k<m.length;k++){var d=m[k];d instanceof r?this.steps.push(d):this.steps.push(new r({wkid:d.wkid,wkt:d.wkt,isInverse:d.isInverse}))}}}n.cacheKey=function(m,k){return[void 0!==m.wkid&&null!==m.wkid?m.wkid.toString():"-1",void 0!==m.wkt&&null!==m.wkt?m.wkt.toString():"",void 0!==k.wkid&&null!==k.wkid?k.wkid.toString():"-1",void 0!==k.wkt&&
null!==k.wkt?k.wkt.toString():""].join()};n.fromGE=function(m){var k=new n,d="",a=0;for(m=m.steps;a<m.length;a++){var b=r.fromGE(m[a]);k.steps.push(b);d+=b.uid.toString()+","}k._cached_projection={};k._gtlistentry=null;k._chain=d;return k};n.prototype.getInverse=function(){var m=new n;m.steps=[];for(var k=this.steps.length-1;0<=k;k--)m.steps.push(this.steps[k].getInverse());return m};n.prototype.getGTListEntry=function(){for(var m="",k=0,d=this.steps;k<d.length;k++)m+=d[k].uid.toString()+",";m!==
this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=m);return this._gtlistentry};n.prototype.assignCachedGe=function(m,k,d){this._cached_projection[n.cacheKey(m,k)]=d};n.prototype.getCachedGeTransformation=function(m,k){for(var d="",a=0,b=this.steps;a<b.length;a++)d+=b[a].uid.toString()+",";d!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=d);m=this._cached_projection[n.cacheKey(m,k)];return void 0===m?null:m};return n}()})},"esri/geometry/GeographicTransformationStep":function(){define(["require",
"exports"],function(G,u){var r=0;return function(){function n(m){void 0===m&&(m=null);this.uid=r++;m?(this._wkt=void 0!==m.wkt?m.wkt:null,this._wkid=void 0!==m.wkid?m.wkid:-1,this._isInverse=void 0!==m.isInverse?!0===m.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}n.fromGE=function(m){var k=new n;k._wkt=m.wkt;k._wkid=m.wkid;k._isInverse=m.isInverse;return k};Object.defineProperty(n.prototype,"wkt",{get:function(){return this._wkt},set:function(m){this._wkt=m;this.uid=r++},enumerable:!0,
configurable:!0});Object.defineProperty(n.prototype,"wkid",{get:function(){return this._wkid},set:function(m){this._wkid=m;this.uid=r++},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"isInverse",{get:function(){return this._isInverse},set:function(m){this._isInverse=m;this.uid=r++},enumerable:!0,configurable:!0});n.prototype.getInverse=function(){var m=new n;m._wkt=this.wkt;m._wkid=this._wkid;m._isInverse=!this.isInverse;return m};return n}()})},"esri/layers/rasterLib/raster/TileServiceRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterTileInfo ./RasterInfo ./BasicRaster".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z){G=u([z],{declaredClass:"esri.layers.rasterLib.raster.TileServiceRaster",constructor:function(E){},open:function(){var E=new n,J=this.serviceInfo||this._getServiceInfo(null),D=r.hitch(this,function(C){this.serviceInfo=C;this.version=C.currentVersion;this.rasterInfo=this._parseRasterInfo(C);this.loaded=!0;this._getRasterIdentifier();E.resolve(this)}),L=r.hitch(this,function(C){this.loaded=!0;this._getRasterIdentifier();E.reject(C)});e(J,D,L);return E.promise},
read:function(E){var J=this.url+"/tile/"+E.level+"/"+E.row+"/"+E.col,D={width:this.tileInfo.cols,height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===this.tileType.toLowerCase()?!0:!1};return this._requestPixels({url:J+(this.disableClientCaching?"?_ts\x3d "+(new Date).getTime():""),payload:{},decodeParams:D,tileOptions:E})},identify:function(E,J){null==J&&(J=this.tileInfo.lods[this.tileInfo.lods.length-1].level);var D=(E.x-this.tileInfo.origin.x)/
this.tileInfo.lods[J].resolution/this.tileInfo.cols;E=(this.tileInfo.origin.y-E.y)/this.tileInfo.lods[J].resolution/this.tileInfo.rows;var L=Math.floor(D),C=Math.floor(E),N=Math.floor((D-L)*this.tileInfo.cols);N=Math.min(N,this.tileInfo.cols-1);var S=Math.floor((E-C)*this.tileInfo.rows);S=Math.min(S,this.tileInfo.rows-1);var F=new n;this.read({level:J,row:C,col:L}).then(function(T){var y=S*T.width+N;T&&T.pixels&&0<T.pixels.length?(T=T.mask?T.mask[y]?T.pixels.map(function(B){return B[y]}):null:T.pixels.map(function(B){return B[y]}),
F.resolve(T)):F.reject("no valid data")},function(T){F.reject(T)});return F.promise},setFetchParameters:function(E,J){},_getRasterIdentifier:function(){this._rasterId||(this._rasterId=this.url.replace("http:","").replace("https:",""));return this._rasterId},_getServiceInfo:function(){var E=this.url,J=new n(t._dfdCanceller);J._pendingDfd=c({url:E,content:{f:"json"},handleAs:"json",callbackParamName:"callback"});J._pendingDfd.then(function(D){J.callback(D)},function(D){J.errback(D)});return J},_parseRasterInfo:function(E){var J=
new A;J.extent=new f(E.fullExtent);J.spatialReference=new q(E.spatialReference);this.tileType=E.cacheType||"Map";switch(this.tileType){case "Map":J.bandCount=3;J.pixelType="U8";this.dataType="Processed";break;case "Elevation":J.bandCount=1;J.pixelType=E.pixelType||"F32";this.dataType="Elevation";break;case "Raster":J.bandCount=null,J.pixelType=null,this.dataType=E.serviceDataType&&E.serviceDataType.replace("esriImageServiceDataType","")||"Generic"}var D=E.tileInfo;J.width=Math.floor((E.fullExtent.xmax-
E.fullExtent.xmin)/D.lods[D.lods.length-1].resolution+.5);J.height=Math.floor((E.fullExtent.ymax-E.fullExtent.ymin)/D.lods[D.lods.length-1].resolution+.5);J.cellSize=new l({x:D.lods[D.lods.length-1].resolution,y:D.lods[D.lods.length-1].resolution,spatialReference:E.spatialReference});this.tileInfo=new H(D);this.tileInfo.tileType=this.tileType;return J}});a("extend-esri")&&r.setObject("layers.rasterLib.raster.TileServiceRaster",G,g);return G})},"esri/layers/rasterLib/raster/TileRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff dojo/DeferredList dojo/when ../../../kernel ../../../Evented ../../../request ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../PixelBlock ../../rasterFormats/rasterCodec ../tile/RasterTileInfo ./RasterInfo ./BasicRaster".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z){G=u([z],{declaredClass:"esri.layers.rasterLib.raster.TileRaster",sourceType:"TileCache",_RECORD_SIZE:8,constructor:function(E){this._cloudBlobStorage=E&&E._cloudBlobStorage},open:function(){var E=new n,J=this.datasetInfo||this._getDatasetInfo(null),D=r.hitch(this,function(C){this.datasetInfo=C;this.rasterInfo=C=this._parseRasterInfo(C);this.tileType="Cache/LERC"===C.format?"Elevation":"Cache/MIXED"===C.format||"Cache/JPEG"===C.format||"Cache/PNG"===
C.format?"Map":"Raster";this.tileInfo=C.tileInfo;this.dataType=["Generic","Elevation","Processed"][["Raster","Elevation","Map"].indexOf(this.tileType)];this._HEADER_SIZE=C.packetSize*C.packetSize*this._RECORD_SIZE+64;this.loaded=!0;this._cloudBlobStorage=this._cloudBlobStorage||-1<this.url.toLowerCase().indexOf("s3.amazonaws.com")||-1<this.url.toLowerCase().indexOf("windows.net")||-1<this.url.toLowerCase().indexOf("googleapis.com");this._getRasterIdentifier();E.resolve(this)}),L=r.hitch(this,function(C){this.loaded=
!0;this._getRasterIdentifier();E.reject(C)});e(J,D,L);return E.promise},read:function(E){var J=new n,D=E.level,L=E.row,C=E.col,N=this._buildCacheFilePath(this.url,D,L,C),S=this._getIndexRecordFromBundle(D,L,C);c({url:N,content:{},headers:{Range:"bytes\x3d0-"+(this._HEADER_SIZE-1).toString()},handleAs:"arraybuffer"}).then(r.hitch(this,function(F,T){if(!J.isCanceled()){console.log("time in ms request "+(new Date-y));var y=new Date;F=new Uint8Array(F);F=this._getTileEndAndContentType(F,S);T={width:this.tileInfo.cols,
height:this.tileInfo.rows,planes:null,pixelType:null,format:null,decodeFunc:null,isPoint:"elevation"===this.tileType.toLowerCase()?!0:!1};this._requestPixels({url:N+(this.disableClientCaching?"?_ts\x3d "+(new Date).getTime():""),payload:{},headers:{Range:"bytes\x3d"+F.position.toString()+"-"+(F.position+F.recordSize).toString()},decodeParams:T,tileOptions:E}).then(function(B){J.isCanceled()||J.resolve(B)},function(B){J.isCanceled()||J.reject(B)})}}));return J.promise},identify:function(){return null},
setFetchParameters:function(E,J){},toJson:function(){return{url:this.url,tileInfo:this.tileInfo.toJson(),rasterInfo:this.rasterInfo.toJson(),datasetInfo:this.datasetInfo,sourceType:this.sourceType,tileType:this.tileType,_rasterId:this._rasterId}},_getDatasetInfo:function(){return c({url:this.url+"/conf.json",handleAs:"json",content:{}})},_parseRasterInfo:function(E){var J=new A;switch(E.pixelType){case 1:var D="U1";break;case 1:D="U2";break;case 2:D="U4";break;case 3:D="U8";break;case 4:D="S8";break;
case 5:D="U16";break;case 6:D="S16";break;case 7:D="U32";break;case 8:D="S32";break;case 9:D="F32";break;default:D="F32"}var L,C=[],N=E.LODInfos;for(L=0;L<N.levels.length;L++)C.push({level:N.levels[L],resolution:N.resolutions[L],scale:96/.0254*N.resolutions[L]});L=new q(E.extent.spatialReference||E.geodataXform.spatialReference);C=new H({rows:E.blockHeight,cols:E.blockWidth,dpi:96,format:E.format,compressionQuality:0,origin:E.origin,spatialReference:L,lods:C});J.pixelType=D;J.bandCount=E.bandCount;
J.spatialReference=L;J.extent=new f({xmin:E.extent.xmin,ymin:E.extent.ymin,xmax:E.extent.xmax,ymax:E.extent.ymax,spatialReference:L});J.cellSize=new l({x:E.pixelSizeX,y:E.pixelSizeY,spatialReference:L});J.width=Math.floor((J.extent.xmax-J.extent.xmin)/J.cellSize.x+.5);J.height=Math.floor((J.extent.ymax-J.extent.ymin)/J.cellSize.y+.5);J.statistics=E.statistics.map(function(S){Object.keys(S).forEach(function(F){isNaN(S[F])&&(S[F]=null)});return S});J.histograms=E.histograms;J.geodataXform=E.geodataXform;
J.packetSize=E.packetSize;J.format=E.format;J.compressionQuality=E.compressionQuality;J.tileInfo=C;return J},_getRasterIdentifier:function(){this._rasterId||(this._rasterId=this.url.replace("http:","").replace("https:",""));return this._rasterId},_buildCacheFilePath:function(E,J,D,L){var C=this.rasterInfo.packetSize;L=Math.floor(L/C)*C;D="R"+this._toHexString4(Math.floor(D/C)*C)+"C"+this._toHexString4(L);C="L";C=10<=J?C+J.toString():C+("0"+J.toString());return this._cloudBlobStorage?E+"/_alllayers/"+
C+"/"+D+".bundle":E+"/"+C+"_"+D+"/bundle"},_getIndexRecordFromBundle:function(E,J,D){E=this.rasterInfo.packetSize;J=J%E*E+D%E;if(0>J)throw"Invalid level / row / col";return J*this._RECORD_SIZE+64},_getTileEndAndContentType:function(E,J){E=E.subarray(J,J+8);J=0;var D;for(D=0;5>D;D++)J|=(E[D]&255)<<8*D;var L=J&0xffffffffff;J=0;for(D=5;8>D;D++)J|=(E[D]&255)<<8*(D-5);return{position:L,recordSize:J&0xffffffffff}},_toHexString4:function(E){E=E.toString(16);if(4!=E.length)for(var J=4-E.length;0<J--;)E="0"+
E;return E}});a("extend-esri")&&r.setObject("layers.rasterLib.raster.TileRaster",G,g);return G})},"esri/layers/rasterLib/raster/FunctionRaster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/_base/json dojo/sniff ../DeferredList2 dojo/when ../../../kernel ../../../Evented ../../../request ../../../deferredUtils ../../../geometry/Extent ../../../geometry/Point ../../../SpatialReference ../../../deferredUtils ../../../urlUtils ../../rasterFormats/rasterCodec ./RasterInfo ./BasicRaster ../../rasterLib/function/rasterFunctionHelper".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z){G=u([A],{declaredClass:"esri.layers.rasterLib.raster.FunctionRaster",rasterFunction:null,sourceType:"Function",constructor:function(E){E&&E.rasterFx&&this._init(E.rasterFx,E.rasterFxArgs)},open:function(){var E=this.getMemberRasters().map(function(D){return D.open()});this.identifiers=this.getMemberRasters().map(function(D){return D._rasterId});var J=new n;(new b(E,null,null,!0)).then(function(D){D.some(function(L){return!L[0]})?J.reject(D):
(this.rasterFunction.bind(),this.rasterInfo=this.rasterFunction.rasterInfo,this.dataType=this.rasterInfo.keyProperties&&this.rasterInfo.keyProperties.DataType||"Generic",this.tileInfo=D[0][1].tileInfo,J.resolve(this))}.bind(this));return J.promise},getProjectedFullExtent:function(E){var J=new n;this.getMemberRasters()[0].getProjectedFullExtent(E).then(r.hitch(this,function(D){this.projectedFullExtent=D;J.resolve(D)}));return J.promise},setProcessingContext:function(E){var J=E;E.layer&&(E=E.layer,
J={id:E.id,rawRasterInfo:E.raster.rasterInfo,glSetting:E._glSetting,xformSetting:E.tileManager&&E.tileManager.xformSetting,useWebGL:E.useWebGL,resampling:E.tileMode&&E.tileManager&&E.tileManager.xformSetting.requireProjection&&!E._hasTilingEffects&&"Thematic"!==E.raster.dataType?1:0,tileMode:E.tileMode});this.rasterFunction.setProcessingContext(J);this._layerOptions=J},alterDefinition:function(E){if(E=E||this.rasterFunction)1===this.memberRasters.length&&!E._bindComplete&&(this.rasterFunction=z.create(E,
{raster:this.memberRasters[0]}))&&(this.rasterFunction.bind(),this.rasterInfo=this.rasterFunction.rasterInfo,this.dataType=this.rasterInfo.keyProperties&&this.rasterInfo.keyProperties.DataType||"Generic",this.rasterFunction.setProcessingContext(this._layerOptions)),this._rasterHandler&&this._rasterHandler._connected&&this.rasterFunction&&this._rasterHandler.setRasterFunction({layerId:this._layerOptions.id,data:this.rasterFunction.toJson(!0)})},setFetchParameters:function(E,J){var D=this.getMemberRasters();
D&&1===D.length&&D[0].setFetchParameters(E,J)},getMemberRasters:function(){this.memberRasters||(this.memberRasters=[],this._getMemberRasters(this.rasterFunction.functionArguments,this.memberRasters));return this.memberRasters},read:function(E){var J=new n(f._dfdCanceller);if(E.src){var D=this.rasterFunction.read(E);J.resolve(D);return J.promise}var L=this.getMemberRasters().map(function(F){return F.read(E)});L=new b(L);var C,N,S=this.identifiers;J._pendingDfd=L;L.then(r.hitch(this,function(F){if(C=
F.some(function(T){return T[0]}))N={},F.forEach(function(T,y){N[S[y]]=T[0]?T[1]:null});D=N?this.rasterFunction.read({extent:E.extent,src:N}):null;D.srcData=N;J.resolve(D)}));return J},_init:function(E,J){if(this.rasterFunction=z.create(E,J))this.rasterFunction._bindComplete=!0;else throw"Cannot initialize a function raster without a raster function";},_getMemberRasters:function(E,J){var D=Object.keys(E),L,C,N;for(L=0;L<D.length;L++)if(N=E[D[L]]){var S=N instanceof Array?N:[N];for(C=0;C<S.length;C++)(N=
S[C])&&("function"===typeof N||"object"===typeof N)&&N.read&&(N.functionArguments?this._getMemberRasters(N.functionArguments,J):N.sourceType&&"Function"!==N.sourceType&&(N._identifier=N._getRasterIdentifier(),J.some(function(F){return F._identifier===N._identifier})||J.push(N)))}return J}});a("extend-esri")&&r.setObject("layers.rasterLib.raster.FunctionRaster",G,g);return G})},"esri/layers/rasterLib/DeferredList2":function(){define(["dojo/DeferredList"],function(G){return function(u,r,n,m,k){this.list=
u;r=new G(u,r,n,m,k);var d=r.resolve.bind(r),a=r.cancel.bind(r);r.cancel=function(){u&&u.forEach(function(b){b.cancel&&b.cancel()});a.apply(this,arguments)}.bind(r);r.resolve=function(){this.isFulfilled()||d.apply(this,arguments)}.bind(r);return r}})},"esri/layers/rasterLib/tile/RasterTileManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/when ../DeferredList2 ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../PixelBlock ./RasterTileInfo ../raster/rasterProjectionHelper".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g){var h=function(c,f){var l;for(l=0;l<c.length;l++)if(f(c[l]))return l;return-1};return G(null,{declaredClass:"esri.layers.rasterLib.tile.RasterTileManager",count:null,fullBoundary:null,tileBoundary:null,tiles:null,resolution:null,virtual:!0,prefetchBufferSize:0,_progressiveGlobal:!1,_MAX_TILES:128,_defaultMatrixResolution:20,constructor:function(c){this.tiles=[];this.xformSetting={};this.mapSpatialReference=c&&c.mapSR;this.layer=c&&c.layer;this.identifiers=this.layer.raster.rasterFunction?
this.layer.raster.getMemberRasters().map(function(f){return f._rasterId}):[this.layer.raster._rasterId];(c=c&&c.tileInfo)&&this.setTileInfo(c)},setTileInfo:function(c){this.tileInfo=c;this.virtual=c.virtual;this.mapResolution=null;this.tiles.length=0;this.xformSetting.requireProjection=!this.virtual&&!this.mapSpatialReference.equals(this.tileInfo.spatialReference);this.xformSetting.requirePE=g.requirePE(this.mapSpatialReference,this.tileInfo.spatialReference);this.xformSetting.meshSize=this.xformSetting.requireProjection?
[this._defaultMatrixResolution,this._defaultMatrixResolution]:[1,1];this.halfWorldWidth=g.getHalfWorldWidth(c.spatialReference)},updateResolution:function(c,f){if(!(this.mapResolution&&c&&this._resolutionEqual(this.mapResolution.x,c.x)&&this._resolutionEqual(this.mapResolution.y,c.y))){this.resetTiles();var l=this.xformSetting.requireProjection;this.mapResolution=this.resolution=c;l&&(this.resolution=g.projectResolution(c,this.tileInfo.spatialReference,this.layer.projectedFullExtent||f));this._resolution=
this.resolution;c=this.resolution;if(!this.tileInfo.virtual){l=.75*Math.min(c.x,c.y)+.25*Math.max(c.x,c.y);if(l>=this.tileInfo.lods[0].resolution){var q=this.tileInfo.lods[0];this.ooe=!0}else{if(l<=this.tileInfo.lods[this.tileInfo.lods.length-1].resolution)q=this.tileInfo.lods[this.tileInfo.lods.length-1];else for(c=0;c<this.tileInfo.lods.length-1;c++)if(q=this.tileInfo.lods[c],f=this.tileInfo.lods[c+1],q.resolution>=l&&f.resolution<=l){q.resolution-l>l-f.resolution&&(q=f);break}this.ooe=!1}this.level=
q&&q.level;c=this.resolution=new a({x:q.resolution,y:q.resolution,spatialReference:this.tileInfo.spatialReference})}l=this.layer.raster.rasterInfo.extent;q=this.tileInfo.origin;f=this.tileInfo.cols;var t=this.tileInfo.rows;this.fullBoundary={rowStart:Math.floor((q.y-l.ymax)/c.y/t),rowEnd:Math.floor((q.y-l.ymin-c.y)/c.y/t),colStart:Math.floor((l.xmin-q.x)/c.x/f),colEnd:Math.floor((l.xmax-q.x-c.x)/c.x/f)};if(l=this.halfWorldWidth){t=Math.ceil(l/c.x/(f/2));var v=this.tileInfo.applyGCS360Transform?360:
l,w=Math.round(f-(v-q.x)/c.x%f);w===f&&(w=0);this.fullBoundary.colRange=t;this.fullBoundary.paddingRight=w;this.fullBoundary.paddingLeft=Math.round((t*f*c.x+q.x-v-(this.tileInfo.applyGCS360Transform?0:q.x+l))/c.x)}this.hasNewData=!0}},getXformGrid:function(){var c=this.mapExtent,f=this.layer._hasTilingEffects?this.extent:this.fullExtent,l=this.layer.getCurrentResolution(),q=JSON.stringify(c.toJson())+JSON.stringify(f.toJson());this._datumTransformationInitialized||(this._datumTransformationInitialized=
!0,this._datumTransformation=g.getDefaultDatumTransformationForDataset(this.layer.raster.rasterInfo.extent,c.spatialReference,!0));this._cachedExtentString&&this._cachedExtentString===q||(this._cachedExtentString=q,this._xformGrid=c=g.getProjectionOffsetGrid(c,f,l,this.tileInfo.applyGCS360Transform,this.halfWorldWidth,this._datumTransformation));c=this._xformGrid;this.xformSetting.meshSize=c&&c.size;return c},getWrapTimes:function(c){var f=g.getHalfWorldWidth(c.spatialReference);if(!f)return 0;var l=
2*f;f=this.tileInfo.applyGCS360Transform?0:-f;return Math.floor((c.xmax-f)/l)-Math.floor((c.xmin-f)/l)},normalizeCoordinate:function(c,f){if(!f)return 0;var l=2*f;if(0<c){for(;c>f;)c-=l;return c}for(;c<-f;)c+=l;return c},resetTiles:function(){this.tiles.forEach(u.hitch(this,function(c){c.fetch&&!c.fetch.isCanceled()&&c.fetch.cancel();c.update&&!c.update.isCanceled()&&c.update.cancel()}));this.tiles.length=0},updateExtent:function(c,f){this.mapExtent=this.extent=c;var l=this.xformSetting.requireProjection;
if(l){this.extent=g.project(c,this.tileInfo.spatialReference,this.tileInfo.applyGCS360Transform);if(!this.extent)return;this.extent.spatialReference=new d(this.extent.spatialReference.toJson())}this.updateResolution(f,c);var q=this.extent,t=this.tileInfo,v=t.cols,w=t.rows;f=this.resolution;var x=q;l=l?this.layer.raster.rasterInfo.extent:this.layer.raster.projectedFullExtent;this.ooe&&(x=this._getIntersect(q,l));var H=Math.floor((x.xmin-t.origin.x)/f.x/v)-this.prefetchBufferSize,A=Math.floor((x.xmax-
t.origin.x)/f.x/v)+this.prefetchBufferSize,z=null;c=this.getWrapTimes(c);var E=this.fullBoundary&&this.fullBoundary.colRange;c&&this.halfWorldWidth&&(A===H&&(z=H),A+=c*E);var J=this.halfWorldWidth&&this.tiles.length&&(c!==this.wrapTimes||z!==this._circlularColId);J&&(this._wrapSwitchCount=this._wrapSwitchCount?this._wrapSwitchCount+1:1);this.wrapTimes=c;this._circlularColId=z;var D=Math.floor((t.origin.y-x.ymax)/f.y/w)-this.prefetchBufferSize;z=Math.floor((t.origin.y-x.ymin)/f.y/w)+this.prefetchBufferSize;
this.tileBoundary={rowStart:D,rowEnd:z,colStart:H,colEnd:A};var L,C;((x=(z-D+1)*(A-H+1)>this._MAX_TILES||!this.virtual&&this._resolution.x>8*this.tileInfo.lods[0].resolution)||2<c||J)&&this.resetTiles();if(!(x||2<c)){J=this.tiles;x=!1;for(L=J.length-1;0<=L;L--){var N=J[L].row;var S=J[L].wrapCol;if(N<D||N>z||S<H||S>A)J[L].fetch&&!J[L].fetch.isCanceled()&&J[L].fetch.cancel(),J[L].update&&!J[L].update.isCanceled()&&J[L].update.cancel(),J.splice(L,1),x=!0}for(L=D;L<=z;L++)for(C=H;C<=A;C++){D=new k(t.origin.x+
f.x*v*C,t.origin.y-f.y*w*(L+1),t.origin.x+f.x*v*(C+1),t.origin.y-f.y*w*L,q.spatialReference);var F=c&&E?0<=C?C%E:E- -C%E:C;N=h(J,function(T){return T.row===L&&T.col===F&&T.wrapCol===C});S=l.xmax>=D.xmax?v:Math.round((l.xmax-D.xmin)/f.x);-1===N&&(J.push({row:L,col:F,wrapCol:C,cellsizeX:f.x,cellsizeY:f.y,width:v,height:w,actualWidth:S,extent:D,normalizedExtent:this._wrapExtent(D,F),pixelBlock:null,virtual:this.virtual,level:this.level,tileType:this.tileInfo.tileType||"Raster"}),x=!0)}x&&this._sortTiles();
f=this.tileInfo.rows*(this.tileBoundary.rowEnd-this.tileBoundary.rowStart+1);this.width=this.tileInfo.cols*(this.tileBoundary.colEnd-this.tileBoundary.colStart+1);this.height=f;this.count=J.length;f=Math.min.apply(null,J.map(function(T){return T.extent.xmin}));t=Math.max.apply(null,J.map(function(T){return T.extent.xmax}));v=Math.min.apply(null,J.map(function(T){return T.extent.ymin}));w=Math.max.apply(null,J.map(function(T){return T.extent.ymax}));f=this.fullExtent=new k(f,v,t,w,q.spatialReference);
if(this.layer.roaming||this.layer.useWebGL)this.layer._hasTilingEffects?(this.xformSetting.offset=[0,0],this.xformSetting.scale=[1,1]):(x&&(this._tilesChanged=!0),this.xformSetting.offset=[(q.xmin-f.xmin)/(f.xmax-f.xmin),-(f.ymin-q.ymin)/(f.ymax-f.ymin)],this.xformSetting.scale=[(q.xmax-q.xmin)/(f.xmax-f.xmin),(q.ymax-q.ymin)/(f.ymax-f.ymin)])}},fetchTiles:function(c){(this._tilesChanged||c)&&this._fetchTiles(c)},_fetchTiles:function(c){this._fetchCounter=0;var f=this.extent;this.fetchAllCompleted=
c?new r:null;(this._tilesChanged||c&&this.layer._hasTilingEffects)&&this.tiles.forEach(u.hitch(this,function(q){q.updateCompleted=!1}));var l={};!this.layer.roaming&&this.layer._hasTilingEffects&&c?(this.identifiers.forEach(function(q,t){l[q]={extent:this.extent,pixelBlock:new b({width:this.layer._map.width,height:this.layer._map.height,pixels:[],pixelType:"",mask:null,statistics:[]})}}.bind(this)),this.originalPixelData={extent:this.extent,src:l,isEmpty:!0}):this._tilesChanged&&(this.identifiers.forEach(function(q,
t){l[q]={extent:this.fullExtent,pixelBlock:new b({width:128,height:128,pixels:[],pixelType:"",mask:null,statistics:[]})}}.bind(this)),this.originalPixelData={extent:this.fullExtent,src:l,isEmpty:!0});this.tiles.forEach(u.hitch(this,function(q){if(q.fetch)q.update||(q.update=this.updateTile(q));else{if(this._isTileOutSide(q,f)){q.updateCompleted=!0;return}this._requestTile(q)}this.layer.roaming&&this.layer.useWebGL?this._fillPixelData(q):q.src&&c&&(this.layer._hasTilingEffects||this.layer.useWebGL)&&
(this._fillPixelData(q),this.layer._hasTilingEffects&&(q.updateCompleted=!0),q.processedPixelBlock=null,q.renderedPixelBlock=null)}));0===this._fetchCounter&&(this._fetched=!0);this._tilesChanged=!1;c&&this._updateFetchStatus()},updateTile:function(c,f){var l=new r;if(!c.src&&!c.fetch)return l.resolve(c),l.promise;n(c.src||c._fetched||c.fetch,u.hitch(this,function(){var q=this.layer.tileMode&&this.layer._rasterHandler&&!(this.layer._hasTilingEffects||this.layer.useWebGL),t=this.layer._drawTile,v=
this._validateRawPixelBlocks(c);this.layer._hasTilingEffects&&!this.layer.useWebGL&&(t=t&&(this._progressiveGlobal||f));if((f||!f&&v)&&(q||t||this.layer.roaming)){if(this.xformSetting.requireProjection&&this.layer.useWebGL&&(this.xformSetting.gridConfig=this.getXformGrid(),null==this.xformSetting.gridConfig))return l.cancel(),l.promise;this._processTile(c,f).then(u.hitch(this,function(w){l.isCanceled()||this._renderTile(w,f).then(u.hitch(this,function(x){this.hasNewData=!1;l.isCanceled()||l.resolve(x)}))}))}else f||
v||(c.updateCompleted=!0),this.layer.useWebGL||this.layer._hasTilingEffects?l.resolve(this.originalPixelData):l.resolve()}));return l.promise},setLayer:function(c){this.layer=c},fillupTiles:function(){this.tiles.forEach(u.hitch(this,function(c){c.update&&c.updateCompleted&&!c.filled&&(c.updateCompleted=!1,this._fillPixelData(c),c.updateCompleted=!0)}))},_validateRawPixelBlocks:function(c){return c&&c.src&&!this.identifiers.some(function(f){return!(c.src[f].pixelBlock&&0!==c.src[f].pixelBlock.validPixelCount&&
c.src[f].pixelBlock.pixels&&0<c.src[f].pixelBlock.pixels.length)})},_wrapExtent:function(c,f){if(c){if(this.tileInfo.applyGCS360Transform){var l=this.normalizeCoordinate(c.xmin,180);0>l&&(l+=360);return new k({xmin:l,ymin:c.ymin,xmax:c.xmax-c.xmin+l,ymax:c.ymax,spatialReference:c.spatialReference})}if(this.halfWorldWidth){l=null!=f?new k({xmin:this.tileInfo.origin.x+this.tileInfo.cols*f*this.resolution.x,ymin:c.ymin,xmax:this.tileInfo.origin.x+this.tileInfo.cols*(f+1)*this.resolution.x,ymax:c.ymax,
spatialReference:c.spatialReference}):new k({xmin:c.xmin,ymin:c.ymin,xmax:c.xmax,ymax:c.ymax,spatialReference:c.spatialReference});f=this.normalizeCoordinate(l.xmin,this.halfWorldWidth);var q=f-l.xmin;.01<Math.abs(q)&&(l.xmin=f,l.xmax+=q)}return l||c}},_getIntersect:function(c,f){return new k(Math.max(c.xmin,f.xmin),Math.max(c.ymin,f.ymin),Math.min(c.xmax,f.xmax),Math.min(c.ymax,f.ymax),c.spatialReference)},_isTileOutSide:function(c,f){var l=!1;if(c.virtual){var q=c.normalizedExtent;if(f=f||(this.xformSetting.requireProjection?
this.layer.raster.rasterInfo.extent:this.layer.raster.projectedFullExtent)){c=q.xmin-this.prefetchBufferSize*this.tileInfo.cols*this.resolution.x;l=q.ymin-this.prefetchBufferSize*this.tileInfo.rows*this.resolution.y;var t=q.xmax+this.prefetchBufferSize*this.tileInfo.cols*this.resolution.x;q=q.ymax+this.prefetchBufferSize*this.tileInfo.rows*this.resolution.y;l=t<=f.xmin||c>=f.xmax||q<=f.ymin||l>=f.ymax}else l=!1}else l=0>c.level||c.row<this.fullBoundary.rowStart||c.row>this.fullBoundary.rowEnd||c.col<
this.fullBoundary.colStart||c.col>this.fullBoundary.colEnd;return l},_resolutionEqual:function(c,f){return c===f||c&&f&&Math.abs(c-f)<Math.abs(f/1E4)?!0:!1},_requestTile:function(c){var f=this.identifiers,l;if(this._isTileOutSide(c)){var q=new r;c.updateCompleted=!0;q.resolve(null);q=q.promise}else q=this.layer.raster.rasterFunction?new m(this.layer.raster.getMemberRasters().map(function(t){return t.read(c)})):new m([this.layer.raster.read(c)]);c.fetch=q;this._fetchCounter++;n(c.src||c._fetched||
q,u.hitch(this,function(t){if(l=t&&t.some(function(w){return w[0]})){var v={};t.forEach(function(w,x){v[f[x]]=w[0]&&w[1]?{extent:w[1].extent,pixelBlock:w[1].pixelBlock,width:w[1].width,height:w[1].height}:null});c.src=v}else c.src=null;this._fetchCounter--;0===this._fetchCounter&&(this._fetched=!0);c._fetched=!0;this._updateFetchStatus()}),u.hitch(this,function(){this._fetchCounter--;0===this._fetchCounter&&(this._fetched=!0);c._fetched=!0;this._updateFetchStatus()}));c.update=this.updateTile(c)},
_updateFetchStatus:function(){this.layer._drawTile&&this.fetchAllCompleted&&!this.fetchAllCompleted.isResolved()&&!this.tiles.some(function(c){return!c._fetched})&&(this.tiles.forEach(u.hitch(this,function(c){this._fillPixelData(c)})),this.fetchAllCompleted.resolve())},_fillPixelData:function(c,f){if(c&&!c.updateCompleted)if(Math.abs(c.cellsizeX-this.resolution.x)>c.cellsizeX/10)c.updateCompleted=!0;else if(!1===this._validateRawPixelBlocks(c))c.updateCompleted=!0;else{var l=c.extent;if(this.layer.roaming||
this.layer.useWebGL&&!this.layer._hasTilingEffects){var q=this.fullExtent;var t=this.tileInfo.cols*(this.tileBoundary.colEnd-this.tileBoundary.colStart+1);var v=this.tileInfo.rows*(this.tileBoundary.rowEnd-this.tileBoundary.rowStart+1);f?this.originalPixelData.renderedPixelBlock||(this.originalPixelData.renderedPixelBlock=new b({width:t,height:v,pixels:[],pixelType:"",mask:null,statistics:[]})):this.identifiers.forEach(u.hitch(this,function(x){this.originalPixelData.src[x].pixelBlock.width=t;this.originalPixelData.src[x].pixelBlock.height=
v}))}else q=this.extent,t=this.layer._map.width,v=this.layer._map.height,f?this.originalPixelData.renderedPixelBlock||(this.originalPixelData.renderedPixelBlock=new b({width:t,height:v,pixels:[],pixelType:"",mask:null,statistics:[]})):this.identifiers.forEach(u.hitch(this,function(x){this.originalPixelData.src[x].pixelBlock.width=t;this.originalPixelData.src[x].pixelBlock.height=v}));if(q.xmax<=l.xmin||q.xmin>=l.xmax||q.ymax<=l.ymin||q.ymin>=l.ymax)return null;var w=this.originalPixelData.isEmpty=
!1;this.identifiers.forEach(u.hitch(this,function(x){c.src&&(this._fillPixelBlock(c.src[x],this.originalPixelData.src[x],{extent:q,width:t,height:v,normalizedExtent:c.normalizedExtent},!1),w=!0)}));c.filled=w;this.hasNewData=!0}},_fillPixelBlock:function(c,f,l,q){var t=c.extent,v=l.extent;q=l.width;var w=l.height;if(c.pixelBlock&&c.pixelBlock.pixels&&c.pixelBlock.pixels[0]){var x=(t.xmax-t.xmin)/c.width,H=Math.max(t.xmin,v.xmin),A=Math.min(t.ymax,v.ymax),z=Math.round((H-t.xmin)/x),E=c.width-Math.round(Math.abs(t.xmax-
Math.min(t.xmax,v.xmax))/x),J=Math.round(Math.abs(t.ymax-A)/x),D=c.height-Math.round((Math.max(t.ymin,v.ymin)-t.ymin)/x),L=this.halfWorldWidth;H=Math.round((H-v.xmin)/x);l=l.normalizedExtent;if(!(this.wrapTimes&&L&&t.xmin<-L)){if(this.wrapTimes&&L){if(this.tileInfo.applyGCS360Transform)360<t.xmin&&(H-=this.fullBoundary.paddingLeft);else if(t.xmin>L){H-=this.fullBoundary.paddingLeft;var C=this.normalizeCoordinate(t.xmin,L);var N=this.normalizeCoordinate(t.xmax,L)}else C=t.xmin,N=t.xmax;this.tileInfo.applyGCS360Transform?
l&&360>l.xmin&&360<l.xmax&&(E-=this.fullBoundary.paddingRight):l&&l.xmin<L&&l.xmax>L?E-=this.fullBoundary.paddingRight:C<L&&N>L&&(E-=this.fullBoundary.paddingRight)}C=Math.round(Math.abs(v.ymax-A)/x);N=c.pixelBlock.pixels.length;f=f.pixelBlock;l=c.width;t=f.mask||new Uint8Array(q*w);var S=c.pixelBlock,F=S.mask,T=0;for(x=0;x<N;x++){A=S.pixels[x];L=f.pixels[x]||new A.constructor(q*w);for(c=J;c<D;c++)for(T=(C+c-J)*q+H,v=z;v<E;v++)L[T+v-z]=A[c*l+v];f.pixels[x]=L}if(F)for(c=J;c<D;c++)for(T=(C+c-J)*q+H,
v=z;v<E;v++)t[T+v-z]=F[c*l+v];else for(c=J;c<D;c++)for(T=(C+c-J)*q+H,v=z;v<E;v++)t[T+v-z]=1;f.pixelType=f.pixelType||S.pixelType;f.mask=t;if(!(f.statistics&&0<f.statistics.length))for(f.statistics=[],c=0;c<S.statistics.length;c++)f.statistics[c]={minValue:S.statistics[c].minValue,maxValue:S.statistics[c].maxValue};else if(S.statistics&&f.statistics)for(c=0;c<f.statistics.length;c++)f.statistics[c].minValue=Math.min(S.statistics[c].minValue,f.statistics[c].minValue),f.statistics[c].maxValue=Math.max(S.statistics[c].maxValue,
f.statistics[c].maxValue)}}},_processTile:function(c,f){var l=new r,q=this.layer._hasTilingEffects,t=this.layer.useWebGL,v=q||t,w=this.layer.raster.rasterFunction&&c&&(q||t||!c.processedPixelBlock);if(f)var x=c;else this._fillPixelData(c),x=v?this.originalPixelData:c;this.xformSetting.hasNewTexture=this.hasNewData;var H;w?(this.identifiers.forEach(function(A){if(0===x.src[A].pixelBlock.pixels.length||0===x.src[A].pixelBlock.pixels[0].length)H=!0}),H?l.resolve({extent:x.extent,processedPixelBlock:x.src[this.identifiers[0]],
pixelBlock:x.src[this.identifiers[0]]}):t?(this.processedPixelData=this.layer.raster.rasterFunction.read(x),l.resolve(this.processedPixelData)):this.layer._rasterHandler?this.layer._rasterHandler.process({extent:x.extent,src:x.src}).then(function(A){q?(this.processedPixelData=A,l.resolve(this.processedPixelData)):(c.processedPixelBlock=A.pixelBlock,l.resolve(c))}):(f=this.layer.raster.rasterFunction.read(c),c.processedPixelBlock=f.pixelBlock,l.resolve(c))):v?l.resolve(x.src[this.identifiers[0]]):
(c.pixelBlock=x.src[this.identifiers[0]]&&x.src[this.identifiers[0]].pixelBlock,l.resolve(c));return l.promise},_renderTile:function(c){var f=new r,l=this.layer._hasTilingEffects,q=this.layer.useWebGL,t=Math.abs((c.extent.xmax-c.extent.xmin)/c.width-this.layer.getCurrentResolution().x)>this.resolution.x/10;t=this.layer.useWebGL&&(t||this._isTileOutSide(c,this.layer._map.extent));this.xformSetting.hasNewTexture=this.hasNewData;this.layer._rasterRenderer&&c&&(c.texture||c.src||c.pixelBlock||c.processedPixelBlock)?
(this.layer._rasterRenderer.interpolation=this.layer.interpolation,q&&!t?(this.layer.raster.rasterFunction&&this.layer.raster.rasterFunction.renderTexture||this.layer._rasterRenderer.draw(c),f.resolve(c)):this.layer._rasterHandler?this.layer._rasterHandler.render({extent:c.extent,pixelBlock:c.processedPixelBlock||c.pixelBlock}).then(function(v){l?(v.renderedPixelBlock=v.pixelBlock,f.resolve(v)):(c.renderedPixelBlock=v.pixelBlock,f.resolve(c))}.bind(this)):(c.renderedPixelBlock=this.layer._rasterRenderer.draw(c).pixelBlock,
f.resolve(c))):(c.renderedPixelBlock=c.processedPixelBlock||c.pixelBlock,f.resolve(c));return f.promise},_sortTiles:function(){this.tiles.sort(function(c,f){return c.row<f.row||c.row==f.row&&c.col<f.col?-1:1})}})})},"esri/dijit/Basemap":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../request ./BasemapLayer".split(" "),function(G,u,r,n,m,k,d){G=G(null,{declaredClass:"esri.dijit.Basemap",id:null,title:"",thumbnailUrl:null,layers:null,itemId:null,basemapGallery:null,
constructor:function(a,b){a=a||{};a.layers||a.itemId||console.error("esri.dijit.Basemap: unable to find the 'layers' property in parameters");this.id=a.id;this.itemId=a.itemId;this.layers=a.layers;this.title=a.title||"";this.thumbnailUrl=a.thumbnailUrl;this.basemapGallery=b},getLayers:function(a){if(this.layers)return this.layers;if(this.itemId)return a=k({url:(a||m.dijit._arcgisUrl)+"/content/items/"+this.itemId+"/data",content:{f:"json"},callbackParamName:"callback",error:r.hitch(this,function(b,
e){if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");else console.error("esri.dijit.Basemap: could not access basemap item.")})}),a.addCallback(r.hitch(this,function(b,e){if(b.baseMap)return this.layers=[],u.forEach(b.baseMap.baseMapLayers,function(g){this.layers.push(new d(g))},this),this.layers;if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");else console.error("esri.dijit.Basemap: could not access basemap item.");
return[]})),a}});n("extend-esri")&&r.setObject("dijit.Basemap",G,m);return G})},"esri/dijit/BasemapLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(G,u,r,n){G=G(null,{declaredClass:"esri.dijit.BasemapLayer",constructor:function(m){m=m||{};m.url||m.type||console.error("esri.dijit.BasemapLayer: unable to find the 'url' or 'type' property in parameters");this.url=m.url;this.type=m.type;this.isReference=!0===m.isReference?!0:!1;this.opacity=m.opacity;this.visibleLayers=
m.visibleLayers;this.displayLevels=m.displayLevels;this.exclusionAreas=m.exclusionAreas;this.bandIds=m.bandIds;this.renderingRule=m.renderingRule;this.templateUrl=m.templateUrl;this.copyright=m.copyright;this.subDomains=m.subDomains;this.fullExtent=m.fullExtent;this.initialExtent=m.initialExtent;this.tileInfo=m.tileInfo;this.tileServers=m.tileServers;this.styleUrl=m.styleUrl}});r("extend-esri")&&u.setObject("dijit.BasemapLayer",G,n);return G})},"esri/dijit/Bookmarks":function(){define("dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/has dojo/keys dojo/on dojo/query dojo/window dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dnd/Avatar dojo/dnd/Source dojo/i18n!../nls/jsapi dijit/a11yclick dijit/_WidgetBase ../kernel ../domUtils ../Evented ../geometry/Extent ./BookmarkItem dijit/_TemplatedMixin dojo/text!./templates/Bookmarks.html".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z,E,J){r=r([v,E,H],{declaredClass:"esri.dijit.Bookmarks",templateString:J,bookmarks:[],bookmarkDomNode:null,bookmarkTable:null,initBookmarks:null,editable:null,map:null,_oldGenerateText:null,_customGenerateText:!1,_LTR:!0,_dndSource:null,_inputBox:null,_label:null,_css:{esriBookmarks:"esriBookmarks",esriBookmarksRTL:"esriBookmarksRTL",esriBookmarkList:"esriBookmarkList",esriBookmarkTable:"esriBookmarkTable",esriBookmarkEditImage:"esriBookmarkEditImage",
esriBookmarkRemoveImage:"esriBookmarkRemoveImage",esriBookmarkLabel:"esriBookmarkLabel",esriBookmarkItem:"esriBookmarkItem",esriBookmarkHighlight:"esriBookmarkHighlight",esriAddBookmark:"esriAddBookmark",esriBookmarkEditBox:"esriBookmarkEditBox"},_clickHandlers:[],_mouseOverHandlers:[],_mouseOutHandlers:[],_removeHandlers:[],_editHandlers:[],_dndHandlers:[],_eventMap:{click:!0,edit:!0,remove:!0},onClick:function(){},onEdit:function(){},onRemove:function(){},constructor:function(D,L){this.initBookmarks=
D.bookmarks;delete D.bookmarks},postCreate:function(){this.srcNodeRef=this.domNode;(this._LTR=this.isLeftToRight())||g.add(this.domNode,this._css.esriBookmarksRTL);this._dndSource=new l(this.bookmarkTable,{creator:this._avatarCreator,singular:!0,checkAcceptance:function(D,L){return this===D?!0:!1}});this._dndSourceNodes=this._dndSource.getAllNodes();this._dndHandlers.push(d(this._dndSource,"DndStart",n.hitch(this,function(D){D===this._dndSource&&(this._oldGenerateText=f.prototype._generateText,f.prototype._generateText=
n.hitch(this,this._generateText),this._customGenerateText=!0,this._inputBox&&this._inputBox.blur())})));this._dndHandlers.push(d(this._dndSource,"DndDrop",n.hitch(this,function(D){D===this._dndSource&&(this._syncBookmarksAfterReorder(),this.emit("reorder",this.bookmarks))})));this._dndHandlers.push(d(this._dndSource,"DndCancel",n.hitch(this,function(){this._customGenerateText&&(f.prototype._generateText=this._oldGenerateText,this._customGenerateText=!1)})));this._addInitialBookmarks()},destroy:function(){this.inherited(arguments);
this.map=null;G.forEach(this._clickHandlers,function(D){u.disconnect(D)});G.forEach(this._mouseOverHandlers,function(D){u.disconnect(D)});G.forEach(this._mouseOutHandlers,function(D){u.disconnect(D)});G.forEach(this._removeHandlers,function(D){u.disconnect(D)});G.forEach(this._editHandlers,function(D){u.disconnect(D)});h.destroy(this.bookmarkDomNode)},addBookmark:function(D){if("esri.dijit.BookmarkItem"===D.declaredClass)var L=D;else L=new A(D.extent),L=new z({name:D.name,extent:L});if(this.editable){var C=
q.widgets.bookmarks;var N=C.NLS_bookmark_edit;C=C.NLS_bookmark_remove;var S=h.create("div",{innerHTML:'\x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d\'esriBookmarkLabel\'\x3e'+D.name+'\x3c/div\x3e\x3cdiv tabindex\x3d"0" role\x3d"button" title\x3d\''+C+"' class\x3d'esriBookmarkRemoveImage'\x3e\x3cbr/\x3e\x3c/div\x3e\x3cdiv tabindex\x3d\"0\" role\x3d\"button\" title\x3d'"+N+"' class\x3d'esriBookmarkEditImage'\x3e\x3cbr/\x3e\x3c/div\x3e"});N=a(".esriBookmarkEditImage",S)[0];C=a(".esriBookmarkRemoveImage",
S)[0];this._removeHandlers.push(u.connect(C,t,this,"_removeBookmark"));this._editHandlers.push(u.connect(N,t,this,"_editBookmarkLabel"))}else S=h.create("div",{innerHTML:"\x3cdiv tabindex\x3d\"0\" class\x3d'esriBookmarkLabel'\x3e"+D.name+"\x3c/div\x3e"});g.add(S,this._css.esriBookmarkItem);"esri.geometry.Extent"!==D.extent.declaredClass&&new A(D.extent);N=a(".esriBookmarkLabel",S)[0];this._clickHandlers.push(u.connect(N,t,n.hitch(this,"_onClickHandler",D)));this._mouseOverHandlers.push(u.connect(S,
"onmouseover",n.hitch(this,function(){g.add(S,this._css.esriBookmarkHighlight)})));this._mouseOutHandlers.push(u.connect(S,"onmouseout",n.hitch(this,function(){g.remove(S,this._css.esriBookmarkHighlight)})));this.bookmarks.push(L);this._dndSource.insertNodes(!1,[S]);this._dndSourceNodes=this._dndSource.getAllNodes();b.scrollIntoView(S);this._syncBookmarksAfterReorder()},removeBookmark:function(D){this._inputBox&&this._inputBox.blur();var L=a(".esriBookmarkLabel",this.bookmarkDomNode);L=G.filter(L,
function(C){return C.innerHTML===D});G.forEach(L,function(C){C.parentNode.parentNode.parentNode.removeChild(C.parentNode.parentNode)});for(L=this.bookmarks.length-1;0<=L;L--)this.bookmarks[L].name===D&&this.bookmarks.splice(L,1);this.onRemove()},hide:function(){x.hide(this.bookmarkDomNode)},show:function(){x.show(this.bookmarkDomNode)},_addInitialBookmarks:function(){if(this.editable){var D=h.create("div",{tabIndex:0,role:"button",innerHTML:"\x3cdiv\x3e"+q.widgets.bookmarks.NLS_add_bookmark+"\x3c/div\x3e"});
g.add(D,this._css.esriBookmarkItem);g.add(D,this._css.esriAddBookmark);this._clickHandlers.push(u.connect(D,t,this,this._newBookmark));this._mouseOverHandlers.push(u.connect(D,"onmouseover",n.hitch(this,function(){g.add(D,this._css.esriBookmarkHighlight)})));this._mouseOutHandlers.push(u.connect(D,"onmouseout",n.hitch(this,function(){g.remove(D,this._css.esriBookmarkHighlight)})));this.domNode.appendChild(D)}this.bookmarks=[];G.forEach(this.initBookmarks,function(L){this.addBookmark(L)},this)},_newBookmark:function(){var D;
var L=this.map;var C=q.widgets.bookmarks.NLS_new_bookmark;var N=L.extent;if(L.spatialReference._isWrappable()){var S=A.prototype._normalizeX(N.xmin,L.spatialReference._getInfo()).x;var F=A.prototype._normalizeX(N.xmax,L.spatialReference._getInfo()).x;if(S>F){var T=(D=L.spatialReference.isWebMercator())?2.0037508342788905E7:180;D=D?-2.0037508342788905E7:-180;Math.abs(S-T)>Math.abs(F-D)?F=T:S=D;L=new A(S,N.ymin,F,N.ymax,L.spatialReference)}else L=new A(S,N.ymin,F,N.ymax,L.spatialReference)}else L=N;
C=new z({name:C,extent:L});this.addBookmark(C);C=a(".esriBookmarkItem",this.bookmarkDomNode);L=C[C.length-1];C={target:{parentNode:null}};C.target.parentNode=L;this._editBookmarkLabel(C)},_removeBookmark:function(D){D.target.parentNode.parentNode.parentNode.removeChild(D.target.parentNode.parentNode);this.removeBookmark(D.target.parentNode.textContent)},_syncBookmarksAfterReorder:function(){var D=[],L=this._dndSource.getAllNodes();G.forEach(L,n.hitch(this,function(C){var N=this._dndSourceNodes.map(function(S,
F){if(S===C)return F}).filter(isFinite)[0];D.push(this.bookmarks[N])}));this.bookmarks=D;this._dndSourceNodes=L},_generateText:function(){return this._dndSource&&this._dndSource.getSelectedNodes()[0]&&this._dndSource.getSelectedNodes()[0].firstChild.firstChild.innerHTML?this._dndSource.getSelectedNodes()[0].firstChild.firstChild.innerHTML:""},_editBookmarkLabel:function(D){this._inputBox&&this._inputBox.blur();var L=q.widgets.bookmarks.NLS_new_bookmark;D=D.target.parentNode;var C=D.firstChild||a(".esriBookmarkLabel",
D)[0],N=c.position(D,!0).y;this._label=C;this._inputBox=h.create("input",{className:"esriBookmarkEditBox",value:C.innerHTML!==L?C.textContent:"",style:{top:N+"px"}},this.domNode);d(this._inputBox,"keyup",n.hitch(this,function(S){switch(S.keyCode){case k.ENTER:this._inputBox.blur()}}));d(this._inputBox,"focus",n.hitch(this,function(){this.map&&"function"===typeof this.map.disableKeyboardNavigation&&this.map.disableKeyboardNavigation()}));d(this._inputBox,"blur",n.hitch(this,function(){this.map&&"function"===
typeof this.map.enableKeyboardNavigation&&this.map.enableKeyboardNavigation();this._finishEdit()}));this._inputBox.focus();this._inputBox.select();L=c.position(D,!0);this._inputBox.style.top=L.y+"px"},_finishEdit:function(){if(this._inputBox){var D=q.widgets.bookmarks.NLS_new_bookmark,L=a(".esriBookmarkLabel",this.bookmarkDomNode),C=this._inputBox.value;C===this._label.innerHTML?(this._inputBox.parentNode.removeChild(this._inputBox),this._inputBox=null):(this._label.textContent=""!==C?C:D,G.forEach(this.bookmarks,
function(N,S){N&&L[S]&&(N.name=L[S].innerHTML)}),this._inputBox.parentNode.removeChild(this._inputBox),this._inputBox=null,this.onEdit())}},_avatarCreator:function(D,L){var C=h.create("div");C.id=dojo.dnd.getUniqueId();g.add(C,"dojoDndItem");"avatar"!==L&&h.place(D,C);return{node:C,data:D,type:"something"}},_onClickHandler:function(D){var L=D.extent;D.extent.declaredClass||(L=new A(D.extent));this.map.setExtent(L);this.onClick()},toJson:function(){var D=[];G.forEach(this.bookmarks,function(L){L&&
D.push(L.toJson())});return D}});m("extend-esri")&&n.setObject("dijit.Bookmarks",r,w);return r})},"esri/dijit/BookmarkItem":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(G,u,r,n){G=G(null,{declaredClass:"esri.dijit.BookmarkItem",constructor:function(m){this.name=m.name;this.extent=m.extent},toJson:function(){var m={},k=this.extent.toJson();m.extent={spatialReference:k.spatialReference,xmax:k.xmax,xmin:k.xmin,ymax:k.ymax,ymin:k.ymin};m.name=this.name;return m}});
r("extend-esri")&&u.setObject("dijit.BookmarkItem",G,n);return G})},"esri/dijit/Directions":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/array dojo/_base/Color dijit/a11yclick dijit/_TemplatedMixin dijit/form/Select dijit/form/ValidationTextBox dijit/form/DateTextBox dijit/form/TimeTextBox dojo/store/Memory dojo/data/ObjectStore dojo/keys dojo/has dojo/on dojo/mouse dojo/dom dojo/dom-geometry dojo/dom-style dojo/dom-class dojo/dom-attr dojo/query dojo/number dojo/i18n!../nls/jsapi dojo/text!./templates/Directions.html ./Search dojo/dom-construct dojo/promise/all dojo/Deferred dojo/dnd/Source dojo/json ../kernel ../urlUtils ../graphic ../units ../TimeExtent ../InfoTemplate ../SpatialReference ../layers/ArcGISDynamicMapServiceLayer ../layers/GraphicsLayer ../geometry/webMercatorUtils ../geometry/geodesicUtils ../arcgis/utils ../geometry/Point ../geometry/Extent ../geometry/Polyline ../geometry/mathUtils ../symbols/SimpleMarkerSymbol ../symbols/PictureMarkerSymbol ../symbols/CartographicLineSymbol ../symbols/TextSymbol ../renderers/UniqueValueRenderer ../symbols/Font ./_EventedWidget ../tasks/FeatureSet ../tasks/RouteTask ../tasks/RouteParameters ../tasks/GeometryService ../tasks/DistanceParameters ../tasks/PrintTask ../tasks/PrintParameters ../tasks/PrintTemplate ../toolbars/edit ../toolbars/draw ../config ../tasks/ProjectParameters dojo/uacss".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z,E,J,D,L,C,N,S,F,T,y,B,I,P,X,Y,aa,Z,fa,K,R,U,ba,Q,ea,la,ma,M,W,da,ja,ia,pa,oa,ra,wa,va,ya,ua,Aa,Ga,Ba,Ea,Ra,Ta,Za){var Ya=I.getProtocolForWebResource(),cb=C.createSubclass({_setSourcesAttr:function(O){O&&(O=O.map(function(V){V.locator&&null==V.locationType&&(V=r.mixin({locationType:"street"},V));return V}));this.inherited(arguments,[O])}});u=u("esri.dijit.Directions",[oa,a],{templateString:L,mapClickActive:!1,barrierToolActive:!1,_eventMap:{activate:!0,
deactivate:!1,load:!0,"directions-start":!0,"directions-finish":["result"],"directions-clear":!0,"segment-select":["graphic"],"segment-highlight":["graphic"],error:["error"],"stops-update":["stops"],"route-item-created":!0,"route-item-updated":!0,"feature-collection-created":!0},_emptyStop:{name:""},constructor:function(O,V){if(!O.map)throw Error('Required "map" parameter is missing. Cannot instantiate Directions Widget.');if(!V)throw Error('Required "srcNodeRef" parameter is missing. Cannot instantiate Directions Widget.');
this._i18n=D;this._css={widgetContainerClass:"esriDirectionsContainer",searchSourceContainerClass:"esriSearchSourceContainer",stopsContainerClass:"esriStopsContainer",stopsTableContainerClass:"esriStopsTableContainer",stopsTableCoverClass:"esriStopsTableCover",reverseStopsClass:"esriStopsReverse",addStopsClass:"esriStopsAdd",stopsClass:"esriStops",stopsRemovableClass:"esriStopsRemovable",stopsButtonContainerClass:"esriStopsButtons",stopsOptionsButtonClass:"esriStopsOptionsButton",stopsAddDestinationClass:"esriStopsAddDestination",
stopsAddDestinationBtnClass:"esriStopsAddDestinationBtn",stopsGetDirectionsContainerClass:"esriStopsGetDirectionsContainer",stopsGetDirectionsClass:"esriStopsGetDirections",stopsClearDirectionsClass:"esriStopsClearDirections",stopsInnerGeocoderClass:"esriInnerGeocoder",stopsOptionsOptionsEnabledClass:"esriStopsOptionsEnabled",stopsOptionsMenuClass:"esriStopsOptionsMenu",stopsFindOptimalOrderClass:"esriFindOptimalOrderOption",stopsUseTrafficClass:"esriUseTrafficOption",stopsReturnToStartClass:"esriReturnToStartOption",
stopsOptionsCheckboxesClass:"esriOptionsCheckboxes",stopsOptionsToggleContainerClass:"esriOptionsToggleContainer",stopsOptionsUnitsContainerClass:"esriOptionsUnitsContainer",stopsOptionsUnitsMiClass:"esriOptionsUnitsMi",stopsOptionsUnitsKmClass:"esriOptionsUnitsKm",stopsOptionsImpedanceContainerClass:"esriOptionsImpedanceContainer",stopsOptionsImpedanceTimeClass:"esriOptionsImpedanceTime",stopsOptionsImpedanceDistanceClass:"esriOptionsImpedanceDistance",stopClass:"esriStop",stopOriginClass:"esriStopOrigin",
stopDestinationClass:"esriStopDestination",stopUnreachedFirstOrLastClass:"esriStopUnreachedFirstOrLast",stopUnreachedClass:"esriStopUnreached",esriStopGeocoderColumnClass:"esriStopGeocoderColumn",esriStopReverseColumnClass:"esriStopReverseColumn",stopDnDHandleClass:"esriStopDnDHandle",stopDnDHandleClassHidden:"esriStopDnDHandleHidden",stopIconColumnClass:"esriStopIconColumn",stopIconClass:"esriStopIcon",stopIconRemoveColumnClass:"esriStopIconRemoveColumn",stopIconRemoveClass:"esriStopIconRemove",
stopIconRemoveClassHidden:"esriStopIconRemoveHidden",resultsContainerClass:"esriResultsContainer",resultsLoadingClass:"esriResultsLoading",resultsPrintClass:"esriResultsPrint",resultsSaveClass:"esriResultsSave",resultsSummaryClass:"esriResultsSummary",routesContainerClass:"esriRoutesContainer",routesClass:"esriRoutes",routesErrorClass:"esriRoutesError",routesInfoClass:"esriRoutesInfo",routeClass:"esriRoute",routeTextColumnClass:"esriRouteTextColumn",routeTextClass:"esriRouteText",routeLengthClass:"esriRouteLength",
routeOriginClass:"esriDMTStopOrigin",routeDestinationClass:"esriDMTStopDestination",routeInfoClass:"esriRouteInfo",routeIconColumnClass:"esriRouteIconColumn",routeIconClass:"esriRouteIcon",infoWindowRouteClass:"esriInfoWindowRoute",routeZoomClass:"esriRouteZoom",esriPrintPageClass:"esriPrintPage",esriPrintBarClass:"esriPrintBar",esriPrintButtonClass:"esriPrintButton",esriCloseButtonClass:"esriCloseButton",esriPrintMainClass:"esriPrintMain",esriPrintHeaderClass:"esriPrintHeader",esriPrintLogoClass:"esriPrintLogo",
esriPrintMapClass:"esriPrintMap",esriPrintNameClass:"esriPrintName",esriPrintNotesClass:"esriPrintNotes",esriPrintLengthClass:"esriPrintLength",esriPrintDirectionsClass:"esriPrintDirections",esriPrintFooterClass:"esriPrintFooter",esriPrintStopLabelClass:"esriPrintStopLabel",clearClass:"esriClear",dndDragBodyClass:"esriDndDragDirection",stopsButtonClass:"esriDirectionsButton",stopsButtonTabClass:"esriDirectionsTabButton",stopsButtonTabLastClass:"esriDirectionsTabLastButton",stopsPressedButtonClass:"esriDirectionsPressedButton",
linkButtonClass:"esriLinkButton",activateButtonClass:"esriActivateButton",lineBarrierButtonClass:"esriLineBarrierButton",travelModesContainerClass:"esriTravelModesContainer"};this.options={map:null,autoSolve:!0,minStops:2,maxStops:20,theme:"simpleDirections",alphabet:"1234567890",directions:null,returnToStart:!1,optimalRoute:!1,routeTaskUrl:Ya+"//route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",printTaskUrl:Ya+"//utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task",
geometryTaskUrl:Ya+"//utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",routeParams:{},stops:["",""],searchOptions:{},stopsInfoTemplate:new aa(D.widgets.directions.stop,"${address}${error}"),waypointInfoTemplate:new aa(D.widgets.directions.maneuver,D.widgets.directions.waypoint),segmentInfoTemplate:new aa(D.widgets.directions.maneuver,'\x3cdiv class\x3d"${maneuverType}"\x3e\x3cdiv class\x3d"'+this._css.routeIconClass+" "+this._css.infoWindowRouteClass+'"\x3e\x3cstrong\x3e${step}.\x3c/strong\x3e ${formattedText}\x3c/div\x3e\x3c/div\x3e'),
textSymbolFont:new pa("11px",pa.STYLE_NORMAL,pa.VARIANT_NORMAL,pa.WEIGHT_NORMAL,"Arial, Helvetica, sans-serif"),textSymbolColor:new k([255,255,255]),textSymbolOffset:{x:0,y:10.875},fromSymbol:(new W({url:G.toUrl("./images/Directions/greenPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),fromSymbolDrag:(new W({url:G.toUrl("./images/Directions/greenPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbol:(new W({url:G.toUrl("./images/Directions/bluePoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbolDrag:(new W({url:G.toUrl("./images/Directions/bluePointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbol:(new W({url:G.toUrl("./images/Directions/redPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbolDrag:(new W({url:G.toUrl("./images/Directions/redPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbol:(new W({url:G.toUrl("./images/Directions/grayPoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbolDrag:(new W({url:G.toUrl("./images/Directions/grayPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),waypointSymbol:new M({color:[255,255,255,255],size:10,type:"esriSMS",style:"esriSMSCircle",outline:{color:[20,89,127,255],width:2.5,type:"esriSLS",style:"esriSLSSolid"}}),maneuverSymbol:new M({color:[255,255,255,255],size:4,type:"esriSMS",style:"esriSMSCircle",outline:{color:[30,99,137,255],width:1,
type:"esriSLS",style:"esriSLSSolid"}}),routeSymbol:(new da).setColor(new k([20,89,127,.75])).setWidth(10).setCap(da.CAP_ROUND).setJoin(da.JOIN_ROUND),segmentSymbol:(new da).setColor(new k([255,255,255,1])).setWidth(6).setCap(da.CAP_ROUND).setJoin(da.JOIN_ROUND),barrierRenderer:new ia({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjIyIiBoZWlnaHQ9IjIyMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z181IiByeD0iMTAwIiByeT0iMTAwIi8+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z182IiByeD0iOTUiIHJ5PSI5NSIvPgo8cmVjdCBmaWxsPSIjZmYwMDAwIiBzdHJva2Utd2lkdGg9IjIwIiB4PSI2NC41IiB5PSIxMDIiIHdpZHRoPSI5NSIgaGVpZ2h0PSIxOCIgaWQ9InN2Z183IiBzdHJva2U9IiNmZmZmZmYiLz4KPC9nPgo8L3N2Zz4\x3d",
contentType:"image/svg+xml",width:18,height:18},uniqueValueInfos:[{value:"2",symbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjg2IiBoZWlnaHQ9IjI1NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZS13aWR0aD0iMTAiIGQ9Im04Ljc0OTk5MiwyNTEuNzQ5OTk3bDEzNC45OTk5OTgsLTI0MS45OTk5OThsMTM0Ljk5OTk5OCwyNDEuOTk5OTk4bC0yNjkuOTk5OTk1LDBsLTAuMDAwMDAxLDB6IiBpZD0ic3ZnXzEiIHN0cm9rZT0iIzAwMCIvPgo8cGF0aCBzdHJva2U9IiNmZmYiIGZpbGw9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMTUiIGQ9Im0yMy41MDAwMDQsMjQyLjUwMDAwNWwxMTkuOTk5OTkyLC0yMTUuOTk5OTk5bDExOS45OTk5OTIsMjE1Ljk5OTk5OWwtMjM5Ljk5OTk4MywwbC0wLjAwMDAwMSwweiIgaWQ9InN2Z18yIi8+Cjx0ZXh0IGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjZmZmZmZmIiBzdHJva2U9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMCIgeD0iMTA5IiB5PSIyMjIuNzUiIGlkPSJzdmdfNSIgZm9udC1zaXplPSIxODAiIGZvbnQtZmFtaWx5PSJHZW9yZ2lhLCBUaW1lcywgJ1RpbWVzIE5ldyBSb21hbicsIHNlcmlmIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHhtbDpzcGFjZT0icHJlc2VydmUiPiE8L3RleHQ+CjwvZz4KPC9zdmc+",
contentType:"image/svg+xml",width:19,height:18}}]}),polylineBarrierRenderer:new ia({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,85,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"}}]}),polygonBarrierRenderer:new ia({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,156],outline:{color:[255,0,0,153],width:2.4,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",
style:"esriSFSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,170,0,156],outline:{color:[255,0,0,153],width:7.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"}}]}),printPage:"",printTemplate:"",focusOnNewStop:!0,dragging:!0,canModifyStops:!0,canModifyWaypoints:!0,directionsLengthUnits:null,directionsLanguage:null,traffic:!1,trafficLayer:null,showPrintPage:!0,showSaveButton:!1,showSegmentPopup:!1,showSegmentHighlight:!0,showReverseStopsButton:!0,showReturnToStartOption:!0,
showOptimalRouteOption:!0,showTravelModesOption:!0,showMilesKilometersOption:!0,showClearButton:!1,showActivateButton:!0,showBarriersButton:!0,loaded:!1,routeLayer:{itemId:null,title:null,isItemOwner:!0,ownerFolder:null},startTime:"now"};this.userOptions=O;this.defaults=r.mixin({},this.options,O,{_waypointName:"DWWP",_userDefinedStopName:"UserDefinedStopName",_solveInProgress:!1,_moveInProgress:!1,_stopSequence:1E3});if(!this.defaults.minStops||2>this.defaults.minStops)this.defaults.minStops=2;if(2<
this.defaults.minStops&&this.defaults.stops&&","===this.defaults.stops.toString())for(O=2;O<this.defaults.minStops;O++)this.defaults.stops.splice(0,0,"");this.domNode=V},postCreate:function(){this.inherited(arguments);this.own(t(this._activateButtonNode,d,r.hitch(this,function(){this.mapClickActive?this.deactivate():this.activate()})));this.own(t(this._lineBarrierButtonNode,d,r.hitch(this,function(){this.barrierToolActive?this.deactivateBarrierTool():this.activateBarrierTool()})));this.own(t(this._addDestinationNode,
d,r.hitch(this,this._addStopButton)));this.own(t(this._optionsButtonNode,d,r.hitch(this,this._toggleOptionsMenu)));this.own(t(this._saveMenuButton,d,r.hitch(this,this._toggleSaveMenu)));this.own(t(this._saveButton,d,r.hitch(this,function(){this._saveButton._enabled&&this._storeRouteUI()})));this.own(t(this._saveAsButton,d,r.hitch(this,function(){r.mixin(this.routeLayer,{itemId:null,title:null,ownerFolder:null});this._storeRouteUI()})));this.own(t(this._findOptimalOrderNode,d,r.hitch(this,this._toggleCheckbox)));
this.own(t(this._returnToStartNode,d,r.hitch(this,this._toggleCheckbox)));this.own(t(this._useTrafficNode,d,r.hitch(this,this._toggleCheckbox)));this.own(t(this._useMilesNode,d,r.hitch(this,this._toggleUnits)));this.own(t(this._useKilometersNode,d,r.hitch(this,this._toggleUnits)));this.own(t(this._getDirectionsButtonNode,d,r.hitch(this,this.getDirections)));this.own(t(this._clearDirectionsButtonNode,d,r.hitch(this,function(){this.clearDirections()})));var O=r.hitch(this,function(){clearTimeout(this._startTimeMenu._hideTimer);
this._startTimeMenu._hideTimer=setTimeout(r.hitch(this,function(){H.set(this._startTimeMenu,"display","none")}),100)});this.own(t(this._startTimeButtonNode,d,r.hitch(this,function(){this._startTimeButtonNode.disabled||"block"===H.get(this._startTimeMenu,"display")?H.set(this._startTimeMenu,"display","none"):(H.set(this._startTimeMenu,"display","block"),this["now"===this.startTime?"_startTimeMenuLeaveNow":"none"===this.startTime?"_startTimeMenuNone":"_startTimeMenuDepartAt"].focus())})));this.own(t(this._startTimeMenuLeaveNow,
"blur",O));this.own(t(this._startTimeMenuDepartAt,"blur",O));this.own(t(this._startTimeMenuNone,"blur",O));this.own(t(this._startTimeMenuLeaveNow,"mousedown",r.hitch(this,function(){this.startTime="now";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(t(this._startTimeMenuDepartAt,"mousedown",r.hitch(this,function(){this.startTime=(new Date).getTime();this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(t(this._startTimeMenuNone,"mousedown",r.hitch(this,function(){this.startTime=
"none";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this._symbolEventPaddingDirections=(new da).setColor(new k([0,255,0,0])).setWidth(20).setCap(da.CAP_ROUND);this._stopLayer=new K({id:"directions_stopLayer_"+this.id,displayOnPan:!0});this._routeLayer=new K({id:"directions_routeLayer_"+this.id,displayOnPan:!0});this._waypointsEventLayer=new K({id:"directions_waypointsEventLayer_"+this.id,displayOnPan:!0});this._barriersLayer=new K({id:"directions_barriersLayer_"+this.id,displayOnPan:!0});
this._polylineBarriersLayer=new K({id:"directions_polylineBarriersLayer_"+this.id,displayOnPan:!0});this._polygonBarriersLayer=new K({id:"directions_polygonBarriersLayer_"+this.id,displayOnPan:!0});this._barriersLayer.setRenderer(this.defaults.barrierRenderer);this._polylineBarriersLayer.setRenderer(this.defaults.polylineBarrierRenderer);this._polygonBarriersLayer.setRenderer(this.defaults.polygonBarrierRenderer);this.map&&(this.map.addLayer(this._routeLayer),this.map.addLayer(this._polygonBarriersLayer),
this.map.addLayer(this._polylineBarriersLayer),this.map.addLayer(this._barriersLayer),this.map.addLayer(this._stopLayer),this._externalTimeExtent=this.map.timeExtent);this._snappingManager=this.map.enableSnapping({layerInfos:[{layer:this._waypointsEventLayer,snapToVertex:!1,snapToPoint:!0,snapToEdge:!0}],tolerance:15});this._setWidgetProperties();var V=new P(null,this.waypointSymbol,{});O=r.hitch(this,function(){this._moveInProgress||this._solveInProgress||!V._isShown()||(this.editToolbar.deactivate(),
this._stopLayer.remove(V),clearTimeout(V._solveTimeout),V._solveTimeout=null,V.attributes.isWaypoint=!0,V._isStopIcon&&this.stopGraphics[V._index]&&(this._stopLayer.add(this.stopGraphics[V._index]),this._stopLayer.add(this.textGraphics[V._index])));V._showTooltip()});this._handle=r.mixin(V,{_isHandle:!0,_tooltip:N.create("div",{className:this.theme+" esriDirectionsRouteTooltip",onmouseover:O},this.map.container),_showTooltip:r.hitch(this,function(ca){V._tooltip.style.display=!ca||ca instanceof MouseEvent?
"none":"inline";ca&&(ca="string"===typeof ca?ca:"\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(ca)+"\x3c/table\x3e",V._tooltip.innerHTML!==ca&&(V._tooltip.innerHTML=ca))}),_isShown:r.hitch(this,function(){return-1<m.indexOf(this._stopLayer.graphics,V)}),_remove:O});this._activate(this.mapClickActive)},startup:function(){this.inherited(arguments);return this._enqueue(this._init)},destroy:function(){this.deactivate();this.map.removeLayer(this._barriersLayer);this.map.removeLayer(this._polylineBarriersLayer);
this.map.removeLayer(this._polygonBarriersLayer);this.map.removeLayer(this._routeLayer);this.map.removeLayer(this._stopLayer);this.map.removeLayer(this._waypointsEventLayer);this._disconnectEvents();N.empty(this.domNode);this.inherited(arguments)},activate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(r.hitch(this,function(){this.set("mapClickActive",!0)}))})},deactivate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(r.hitch(this,function(){this.set("mapClickActive",
!1)}))})},activateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!0)})},deactivateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!1)})},clearDirections:function(){return this._enqueue(function(){this.clearMessages();return this._clearDirections()})},reset:function(){return this._enqueue(this._reset)},modifyStopSequence:function(O,V){return this._enqueue(function(){return this._modifyStopSequence(O,
V)})},onActivate:function(){},onDeactivate:function(){},onActivateBarrierTool:function(){},onDeactivateBarrierTool:function(){},onLoad:function(){this._enableButton(this._getDirectionsButtonNode)},onDirectionsStart:function(){this._clearDisplayBeforeSolve();this.set("solving",!0);this._showLoadingSpinner(!0)},onDirectionsFinish:function(){this._showLoadingSpinner(!1);this.set("solving",!1)},onDirectionsClear:function(){},onSegmentSelect:function(){},onSegmentHighlight:function(){},onStopsUpdate:function(){},
onRouteItemCreated:function(){},onRouteItemUpdated:function(){},onFeatureCollectionCreated:function(){},onError:function(){},removeStops:function(){return this.reset()},removeStop:function(O,V,ca){return this._enqueue(function(){this.clearMessages();return this._removeStop(O,V,ca)})},updateStops:function(O){return this._enqueue(function(){return this._updateStops(O)})},addStops:function(O,V){return this._enqueue(function(){return this._addStops(O,V)}).then(r.hitch(this,this.zoomToFullRoute))},addStop:function(O,
V){return this._enqueue(function(){return this._addStop(O,V)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},updateStop:function(O,V,ca){return this._enqueue(function(){return this._updateStop(O,V,ca)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},setBarriers:function(O){this.routeParams.barriers=O;return this._getDirections().then(r.hitch(this,function(){this.zoomToFullRoute()}))},setPolylineBarriers:function(O){this.routeParams.polylineBarriers=O;return this._getDirections().then(r.hitch(this,
function(){this.zoomToFullRoute()}))},setPolygonBarriers:function(O){this.routeParams.polygonBarriers=O;return this._getDirections().then(r.hitch(this,function(){this.zoomToFullRoute()}))},clearMessages:function(){this.messages=[];this._msgNode&&(this._msgNode.innerHTML="")},getDirections:function(O){return this._enqueue(function(){return this._getDirections().then(r.hitch(this,function(){!0!==O&&this.zoomToFullRoute()}))})},selectSegment:function(O){if(!(!this.directions||!this.directions.features||
0>O||O>=this.directions.features.length))for(var V=E("[data-segment]",this._resultsNode),ca=0;ca<V.length;ca++){var ka=parseInt(z.get(V[ca],"data-segment"),10);if(O===ka&&V[ca]!==this._focusedDirectionsItem){this._focusedDirectionsItem=V[ca];this.centerAtSegmentStart(O);this.onSegmentSelect(this.directions.features[O]);V[ca].focus();break}}},unhighlightSegment:function(O){var V=this._segmentGraphics;if(V&&(!this._focusedDirectionsItem||O)){for(O=0;O<V.length;O++)this._routeLayer.remove(V[O]);this._segmentGraphics=
[]}},highlightSegment:function(O,V){if(!(this._focusedDirectionsItem&&!V||O>=this.directions.features.length)){O=O||0;var ca=r.hitch(this,function(Ha){var Ia=this.map.toMap({x:0,y:0});return this.map.toScreen(Ia.offset(Ha,0)).x}),ka=r.hitch(this,function(Ha){for(var Ia=0,Ma=0;Ma<Ha.length;Ma++)for(var Fa=1;Fa<Ha[Ma].length;Fa++){var Qa=Ha[Ma][Fa-1],Oa=Ha[Ma][Fa];Ia+=ca(Math.sqrt((Qa[0]-Oa[0])*(Qa[0]-Oa[0])+(Qa[1]-Oa[1])*(Qa[1]-Oa[1])))}return Ia}),ha=r.hitch(this,function(Ha){var Ia=this.map.toMap({x:0,
y:0});return this.map.toMap({x:Ha,y:0}).x-Ia.x}),na=function(Ha,Ia,Ma){Ia=Math.max(1,Ia);for(var Fa=Ma?Ha[0].length-1:0,Qa=0,Oa,Sa,Pa,Ka=[[Ha[0][Ma?Fa:0]]];Ma&&0<Fa||!Ma&&Fa<Ha[0].length-1;){Sa=Ha[0][Ma?Fa-1:Fa];Pa=Ha[0][Ma?Fa:Fa+1];if(Oa=ca(Math.sqrt((Sa[0]-Pa[0])*(Sa[0]-Pa[0])+(Sa[1]-Pa[1])*(Sa[1]-Pa[1]))))if(Qa+Oa<Ia)Ma?Ka[0].splice(0,0,Sa):Ka[0].push(Pa),Qa+=Oa;else{Ia=(Ia-Qa)/Oa;Ma?Ka[0].splice(0,0,[Pa[0]-(Pa[0]-Sa[0])*Ia,Pa[1]-(Pa[1]-Sa[1])*Ia]):Ka[0].push([Sa[0]+(Pa[0]-Sa[0])*Ia,Sa[1]+(Pa[1]-
Sa[1])*Ia]);break}Fa+=Ma?-1:1}return 0<Qa+Oa?Ka:Ha};V=this.get("directions").features[O];var qa=new la(V.geometry),sa=40*Math.PI/180;r.mixin(V.attributes,{_index:O});if(O){var ta=na(this.get("directions").features[O-1].geometry.paths,25,!0),xa="esriDMTStop"!==V.attributes.maneuverType?na(qa.paths,25,!1):ta;ta=xa!==ta?[ta[0].concat(xa[0])]:xa;var za=(new la(xa)).getExtent();if(1<xa[0].length&&15<=ca(Math.max(za.getWidth(),za.getHeight()))){na=15*Math.cos(sa/2);ka=15*Math.sin(sa/2);var Da=xa[0].length-
2;sa=xa[0][Da+1];for(za=0;0<=Da&&!za;){var Ca=xa[0][Da];za=ca(Math.sqrt((Ca[0]-sa[0])*(Ca[0]-sa[0])+(Ca[1]-sa[1])*(Ca[1]-sa[1])));Da--}22>za&&(xa=za+(22-za)/3,Da=za+2*(22-za)/3,Da=[Ca[0]+Da/za*(sa[0]-Ca[0]),Ca[1]+Da/za*(sa[1]-Ca[1])],Ca=[sa[0]-xa/za*(sa[0]-Ca[0]),sa[1]-xa/za*(sa[1]-Ca[1])],sa=Da,za=22);na/=za;xa=[sa[0]-(sa[0]-Ca[0])*na,sa[1]-(sa[1]-Ca[1])*na];Ca[1]!==sa[1]?(na=(sa[0]-Ca[0])/(sa[1]-Ca[1]),Ca=ha(ka/Math.sqrt(1+na*na)),ha=na*Ca):(Ca=0,ha=ha(ka));Infinity===Math.abs(Ca)||Infinity===Math.abs(ha)||
isNaN(Ca)||isNaN(ha)||(ta[0].push(sa),ta[0].push([xa[0]-Ca,xa[1]+ha]),ta[0].push([xa[0]+Ca,xa[1]-ha]),ta[0].push(sa))}else ta=na(ta,2*ka(xa),!0);qa.paths=ta}this.unhighlightSegment(this._segmentGraphics&&this._segmentGraphics.length);ha=r.clone(this.routeSymbol).setWidth(this.segmentSymbol.width).setColor(new k([parseInt(.9*this.segmentSymbol.color.r),parseInt(.9*this.segmentSymbol.color.g),parseInt(.9*this.segmentSymbol.color.b)]));this._segmentGraphics=[new P(V.geometry,ha,V.attributes,this.get("segmentInfoTemplate")),
new P(qa,this.routeSymbol,V.attributes,this.get("segmentInfoTemplate")),new P(qa,this.segmentSymbol,V.attributes,this.get("segmentInfoTemplate"))];this.get("showSegmentHighlight")&&(this._routeLayer.add(this._segmentGraphics[0]),this._routeLayer.add(this._segmentGraphics[1]),this._routeLayer.add(this._segmentGraphics[2]));V=r.hitch(this,function(Ha){if(0<Ha&&Ha<this.directions.features.length){Ha=this.directions.features[Ha]._associatedFeaturesWithWaypoints;for(var Ia=0;Ia<Ha.length;Ia++)Ha[Ia]._associatedSnapFeature&&
Ha[Ia]._associatedSnapFeature.getDojoShape()&&Ha[Ia]._associatedSnapFeature.getDojoShape().moveToFront()}});V(O-1);V(O);this.onSegmentHighlight(this.directions.features[O])}},zoomToSegment:function(O){var V=new F;if(this.directions&&this.directions.features){var ca=Math.max(0,Math.min(this.directions.features.length-1,O||0));this.map.setExtent(this.get("directions").features[ca].geometry.getExtent(),!0).promise.always(r.hitch(this,function(){this.highlightSegment(ca);V.resolve()}))}else V.reject(Error("No directions."));
return V.promise},centerAtSegmentStart:function(O){var V=new F;if(this.directions&&this.directions.features){var ca=Math.max(0,Math.min(this.directions.features.length-1,O||0));var ka=this.directions.features[ca];this.map.centerAt(ka.geometry.getPoint(0,0)).promise.always(r.hitch(this,function(){this.highlightSegment(ca,!0);this._showSegmentPopup(ka,ca);V.resolve()}))}else V.reject(Error("No directions."));return V.promise},zoomToFullRoute:function(){var O=new F;this.directions&&this.directions.features?
(this._clearInfoWindow(),this.unhighlightSegment(),this.get("map").setExtent(this.get("directions").extent,!0).promise.always(O.resolve)):O.resolve();return O.promise},setListIcons:function(){var O,V=this._dnd.getAllNodes();for(O=0;O<V.length;O++){var ca=E("."+this._css.stopIconClass,V[O])[0];ca&&(ca.innerHTML=this._getLetter(O));A.remove(V[O],this._css.stopOriginClass+" "+this._css.stopDestinationClass+" "+this._css.stopUnreachedClass+" "+this._css.stopUnreachedFirstOrLastClass);ca=this._getStopSymbol(this.stops[O]);
ca===this.fromSymbol?A.add(V[O],this._css.stopOriginClass):ca===this.toSymbol?A.add(V[O],this._css.stopDestinationClass):ca===this.unreachedSymbol&&A.add(V[O],this._css.stopUnreachedClass)}O=E("[data-reverse-td]",this._dndNode)[0];N.destroy(O);this.get("showReverseStopsButton")&&N.create("td",{"data-reverse-td":"true",rowspan:V.length,className:this._css.esriStopReverseColumnClass,innerHTML:'\x3cdiv role\x3d"button" class\x3d"'+this._css.reverseStopsClass+'" data-reverse-stops\x3d"true" title\x3d"'+
D.widgets.directions.reverseDirections+'"\x3e\x3c/div\x3e',onmouseover:function(ka){ka.stopPropagation()},onmouseout:function(ka){ka.stopPropagation()}},V[0])},addRouteSymbols:function(){if(this.stopGraphics.length){this._moveLayersToFront();for(var O=0;O<this.stopGraphics.length;O++)if(this.stopGraphics[O]&&(!this._handle._isShown()||this._handle._isShown()&&this._handle._index!==O)){this._stopLayer.add(this.stopGraphics[O]);var V=this.stopGraphics[O].getDojoShape();V&&V.moveToFront();this._stopLayer.add(this.textGraphics[O]);
(V=this.textGraphics[O].getDojoShape())&&V.moveToFront()}this._moveInProgress&&!this._handle.attributes.isWaypoint&&this._handle.getDojoShape()&&this._handle.getDojoShape().moveToFront()}},createRouteSymbols:function(){this._clearStopGraphics();for(var O=this.stops,V=function(sa){var ta={},xa;for(xa in sa)sa.hasOwnProperty(xa)&&0===xa.indexOf("Attr_")&&(ta[xa]=sa[xa]);return ta},ca=0;ca<O.length;ca++){var ka=O[ca];if(ka&&ka.feature){var ha=ka.feature.attributes,na=ha?ha.Status:void 0,qa=null;this._isStopAWaypoint(ka)||
(qa=new ja(this._getLetter(ca),this.get("textSymbolFont"),this.get("textSymbolColor")),this.get("textSymbolOffset")&&qa.setOffset(this.get("textSymbolOffset").x,this.get("textSymbolOffset").y));qa=new P(ka.feature.geometry,qa,{address:ka.name},this.get("stopsInfoTemplate"));qa._isStopLabel=!0;qa._index=ca;ka=new P(ka.feature.geometry,this._getStopSymbol(ka),r.mixin({address:ka.name,Status:void 0===na?0:na,CurbApproach:ha&&ha.CurbApproach?ha.CurbApproach:null,TimeWindowStart:ha&&ha.TimeWindowStart?
ha.TimeWindowStart:null,TimeWindowEnd:ha&&ha.TimeWindowEnd?ha.TimeWindowEnd:null,isWaypoint:this._isStopAWaypoint(ka)},V(ha)),this.get(this._isStopAWaypoint(ka)?"waypointInfoTemplate":"stopsInfoTemplate"));ka._isStopIcon=!0;ka._index=ca;this.stopGraphics[ca]=ka;this.textGraphics[ca]=qa}}this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);this._showBarriers();this.addRouteSymbols();this.setListIcons()},setTravelMode:function(O){return this._enqueue(function(){this.clearMessages();
this._travelModeSelector.setValue(O);return this._setTravelMode(O)})},getSupportedTravelModeNames:function(){var O=[],V=this.serviceDescription;if(V&&V.supportedTravelModes&&V.supportedTravelModes.length){V=V.supportedTravelModes;for(var ca=0;ca<V.length;ca++)O.push(V[ca].name)}return O},setDirectionsLengthUnits:function(){var O=1===arguments.length?arguments[0]:this.get("directionsLengthUnits");return this._enqueue(function(){this.clearMessages();return this._setDirectionsLengthUnits(O)})},setDirectionsLanguage:function(){var O=
1===arguments.length?arguments[0]:this.get("directionsLanguage");return this._enqueue(function(){this.clearMessages();return this._setDirectionsLanguage(O)})},useMyCurrentLocation:function(O){this.clearMessages();return this._createLocateButton(this.geocoders[O],!0,!0)},loadRoute:function(O){return this._enqueue(r.hitch(this,function(){return this._loadRoute(O)}))},_getStopsAttr:function(){return this.returnToStart&&this._returnToStartStop?this.stops.concat(this._returnToStartStop):this.stops},_getTravelModeNameAttr:function(){return this.routeParams&&
this.routeParams.travelMode&&this.routeParams.travelMode.name},_reset:function(){var O=this.mapClickActive||this.barrierToolActive;this._clearBarriersGraphics();this._setWidgetProperties();return this._init().then(r.hitch(this,function(){this.mapClickActive=!O;this.set("mapClickActive",O);this._searchSourceSelector&&this._searchSourceSelector.setValue("all")}))},_activate:function(){var O=this.get("mapClickActive"),V=r.hitch(this,function(ca){for(var ka=ca?[this.textGraphics,this.stopGraphics,this.displayedManeuverPointGraphics,
this.displayedRouteGraphics]:[this.displayedRouteGraphics,this.displayedManeuverPointGraphics,this.stopGraphics,this.textGraphics],ha=0;ha<ka.length;ha++)for(var na=ka[ha],qa=0;qa<na.length;qa++){var sa=na[qa].getDojoShape();sa&&sa[ca?"moveToBack":"moveToFront"].call(sa)}});this.drawToolbar&&(this.barrierToolActive=!1,this.drawToolbar.deactivate(),A.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass));this._addStopOnMapClickListener&&this._addStopOnMapClickListener.remove();O?(this.map.activeDirectionsWidget&&
this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this._addStopOnMapClickListener=t(this.map,"click",r.hitch(this,function(ca){this.canModifyStops&&!this._solveInProgress&&(this.map.infoWindow.hide(),this.addStop(new P(ca.mapPoint)))})),this.map.addLayer(this._waypointsEventLayer),this._moveLayersToFront(),A.add(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onActivate()):(this.map.removeLayer(this._waypointsEventLayer),
A.remove(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onDeactivate());V(!O);this.emit("map-click-active",{mapClickActive:this.mapClickActive})},_activateBarrierTool:function(){this.get("barrierToolActive")?(this.map.activeDirectionsWidget&&this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this.drawToolbar.activate(Ra.FREEHAND_POLYLINE),A.add(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),this.onActivateBarrierTool()):
(this.drawToolbar.deactivate(),A.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),this.onDeactivateBarrierTool());this.emit("barrier-tool-active",{barrierToolActive:this.barrierToolActive})},_moveLayersToFront:function(){var O=this.get("map"),V=O.graphicsLayerIds.length-1;O.reorderLayer(this._routeLayer,V);O.reorderLayer(this._polygonBarriersLayer,V);O.reorderLayer(this._polylineBarriersLayer,V);O.reorderLayer(this._barriersLayer,V);O.reorderLayer(this._waypointsEventLayer,V);
O.reorderLayer(this._stopLayer,V)},_destroyGeocoders:function(){for(;this.geocoders&&this.geocoders.length;){if(this.geocoders[0])try{this.geocoders[0].destroy()}catch(O){}this.geocoders.splice(0,1)}this.geocoders=[]},_disconnectEvents:function(){var O=this._clearDirections(!0),V;if(this._watchEvents&&this._watchEvents.length)for(V=0;V<this._watchEvents.length;V++)this._watchEvents[V].unwatch();if(this._onEvents&&this._onEvents.length)for(V=0;V<this._onEvents.length;V++)this._onEvents[V].remove();
if(this._geocoderEvents)for(V=0;V<this._geocoderEvents.length;V++)this._geocoderEvents[V].value.unwatch(),this._geocoderEvents[V].blur.remove(),this._geocoderEvents[V].select.remove(),this._geocoderEvents[V].suggest.remove();this._onEvents=[];this._watchEvents=[];this._geocoderEvents=[];this._disconnectResults();this._destroyGeocoders();this._destroyGlobalGeocoder();this._destroyDnD();return O},_getDirections:function(){var O=new F;this._removeEmptyStops();1<this._getStopCount()+this._getWaypointCount()&&
this.loaded?(this.onDirectionsStart(),this.clearMessages(),this._dnd.sync(),this._sortGeocoders(),this._getCandidates(this.stops).then(r.hitch(this,function(V){this.stops=V;this._setStops();this._configureRoute().always(r.hitch(this,function(ca){O.resolve(ca)}))}),r.hitch(this,function(V){this.set("directions",null);this._clearRouteGraphics();O.reject(V);this.onDirectionsFinish(V)}))):this._clearDirections(!0).always(r.hitch(this,function(){this.createRouteSymbols();O.resolve()}));return O.promise},
_clearDirections:function(){var O=new F;this._handle&&this._handle._remove();this.get("routeParams")&&this.get("routeParams").stops?this.get("routeParams").stops.features.length?(this.get("routeParams").stops.features=[],this.onDirectionsClear(),O.resolve()):arguments.length?O.resolve():this._reset().then(O.resolve,O.reject):O.resolve();this.set("directions",null);this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this._routeLayer.clear();this._waypointsEventLayer.clear();this._stopLayer.clear();
return O.promise},_setTravelMode:function(O){var V=new F,ca=this.serviceDescription,ka=function(){V.resolve(O)};if(ca&&ca.supportedTravelModes&&ca.supportedTravelModes.length){var ha=ca.supportedTravelModes,na=!1;for(ca=0;ca<ha.length;ca++)if(ha[ca].name===O){na=!0;!this.routeParams.travelMode||this.routeParams.travelMode&&this.routeParams.travelMode.name!==O?(this.routeParams.travelMode=ha[ca].impedanceAttributeName?ha[ca]:ha[ca].itemId,this._checkStartTimeUIAvailability(),this._solveAndZoom().always(ka)):
ka();this._travelModeSelector&&this._travelModeSelector.domNode&&(this._travelModeSelector.domNode.title=ha[ca].description);break}na||V.reject(O)}else V.reject(O);return V.promise},_setDirectionsLengthUnits:function(O){this._clearDisplayBeforeSolve();var V=new F;A.remove(this._useMilesNode,this._css.stopsPressedButtonClass);A.remove(this._useKilometersNode,this._css.stopsPressedButtonClass);O===X.KILOMETERS?A.add(this._useKilometersNode,this._css.stopsPressedButtonClass):O===X.MILES&&A.add(this._useMilesNode,
this._css.stopsPressedButtonClass);O===X.KILOMETERS||O===X.METERS||O===X.MILES||O===X.FEET||O===X.YARDS||O===X.NAUTICAL_MILES?(this.directionsLengthUnits=O,V.resolve(O)):V.reject(O);return V.promise},_setDirectionsLanguage:function(O){this._clearDisplayBeforeSolve();var V=new F;O=this._setDirectionsLanguageByLocale(O);this._solveAndZoom().always(function(){V.resolve(O)},V.reject);return V.promise},_showLoadingSpinner:function(O){void 0===O&&(O=this._requestQueueTail&&!this._requestQueueTail.isFulfilled()||
this._moveInProgress);O?(A.add(this._widgetContainer,this._css.resultsLoadingClass),A.add(this._resultsNode,"esriRoutesContainerBusy")):(A.remove(this._widgetContainer,this._css.resultsLoadingClass),A.remove(this._resultsNode,"esriRoutesContainerBusy"))},_enqueue:function(O,V){var ca=new F;this._requestQueueTail||(this._requestQueueTail=new F,this._requestQueueTail.resolve());this._requestQueueTail.promise.always(r.hitch(this,function(){try{r.mixin(this,{_incrementalSolveStopRange:null},V);var ka=
O.call(this);ka&&"object"===typeof ka&&ka.hasOwnProperty("isFulfilled")?ka.then(r.hitch(this,function(ha){ca.resolve(ha);this._showLoadingSpinner()}),r.hitch(this,function(ha){ca.reject(ha);this._showLoadingSpinner()})):(ca.resolve(ka),this._showLoadingSpinner())}catch(ha){ca.reject(ha),this._showLoadingSpinner()}}));this._requestQueueTail=ca;this._showLoadingSpinner();return ca.promise},_createDnD:function(){this._dnd=new T(this._dndNode,{skipForm:!0,withHandles:!0})},_destroyDnD:function(){N.empty(this._dndNode);
this._dnd&&(this._dnd.destroy(),this._dnd=null)},_createDepartAtControls:function(){if(this._departAtTime)this.map&&this._restoreMapTimeExtent(),this._useTrafficItemNode.title=D.widgets.directions.trafficLabelLive,A.remove(this._departAtContainer,"departAtContainerVisible"),this.startTime="now",this._updateStartTimeUI();else{var O=this,V=function(){this._keepDirections||O._clearDisplayBeforeSolve();this._keepDirections=!1},ca=r.hitch(this,function(){this.map&&this.map.disableKeyboardNavigation()}),
ka=r.hitch(this,function(){this.map&&this.map.enableKeyboardNavigation()});this._departAtTime=new h({required:!0,value:new Date,onChange:V,onFocus:ca,onBlur:ka},this._departAtTimeContainer);this._departAtDate=new g({required:!0,value:new Date,onChange:V,onFocus:ca,onBlur:ka,constraints:{min:new Date(864E5)}},this._departAtDateContainer)}},_setStartTime:function(O,V,ca){if(isNaN(ca))this.startTime="now"===ca?ca:"none";else{V=ca instanceof Date?ca:new Date(ca);ca=this.directions&&this.directions.features&&
this.directions.features[0]&&this.directions.features[0].attributes;var ka=6E4*-V.getTimezoneOffset();V=new Date(V-ka+(ca&&ca.arriveTimeUTC?ca.ETA-ca.arriveTimeUTC:ka));this._departAtTime._keepDirections=!O;this._departAtDate._keepDirections=!O;this._departAtTime.setValue(V);this._departAtDate.setValue(V)}this._updateStartTimeUI()},_checkStartTimeUIAvailability:function(){var O=this._getImpedanceAttribute();O=this._isTimeUnits(O?O.units:"")||this.serviceDescription&&10.6<=this.serviceDescription.currentVersion;
this._startTimeButtonNode.disabled=!O;A[O?"remove":"add"].apply(this,[this._startTimeButtonNodeContainer,"esriLinkButtonDisabled"]);A[O?"remove":"add"].apply(this,[this._startTimeDDLArrow,"esriDirectionsDDLArrowDisabled"]);O||this.set("startTime","now")},_usingAGOL:function(O){O||(O=this.routeTaskUrl);return-1<O.search(/^(https?:)*\/\/*[^.]*\.arcgis\.com.*$/i)},_usingRouteAGOL:function(){return-1<this.get("routeTaskUrl").search(/^(https?:)*\/\/route*[^.]*\.arcgis\.com.*$/i)},_setSearchOptions:function(){var O=
{map:this.get("map"),autoNavigate:!1,enableInfoWindow:!1,enableHighlight:!1,enableSourcesMenu:!1};this.searchOptions=r.mixin({maxResults:1,locationToAddressDistance:100},this.defaults.searchOptions,O)},_setDefaultUnits:function(){if(!this.get("directionsLengthUnits")){var O="EN-US"===n.locale.toUpperCase()?X.MILES:X.KILOMETERS;this.defaults.directionsLengthUnits?O=this.defaults.directionsLengthUnits:this.userOptions.routeParams&&this.userOptions.routeParams.directionsLengthUnits&&(O=this.userOptions.routeParams.directionsLengthUnits);
this.set("directionsLengthUnits",O)}this._setDirectionsLengthUnits(this.directionsLengthUnits)},_setTrafficOptions:function(){this._usingRouteAGOL()&&!this.trafficLayer&&(this.trafficLayer=new fa(Ya+"//traffic.arcgis.com/arcgis/rest/services/World/Traffic/MapServer",{opacity:.4}));this.trafficLayer&&this.trafficLayer.url&&this._usingAGOL(this.trafficLayer.url)&&(this._trafficAvailabilityButton.style.display="inline-block");this.set("showTrafficOption",(this.defaults.showTrafficOption||!this.defaults.hasOwnProperty("showTrafficOption"))&&
!!this.trafficLayer);this._optionsMenu()},_updateCanModifyStops:function(O,V){this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!1);V||!this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!0);this._showAddDestination();this._showMapClickActiveButton();this._stopsTableCover.style.display=this.canModifyStops?"none":"inline"},_updateCanAddWaypoints:function(O,V){this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!1);V||this.canModifyStops||
!this.canModifyWaypoints||this.set("mapClickActive",!0);this._showMapClickActiveButton();this._handle._remove()},_updateStartTimeUI:function(){isNaN(this.startTime)?(this._startTimeButtonLabel.innerHTML="now"==this.startTime?this._i18n.widgets.directions.leaveNow:this._i18n.widgets.directions.noStartTime,A.remove(this._startTimeButtonNodeContainer,"departAtButton"),A.remove(this._departAtContainer,"departAtContainerVisible")):(A.add(this._startTimeButtonNodeContainer,"departAtButton"),A.add(this._departAtContainer,
"departAtContainerVisible"),this._startTimeButtonLabel.innerHTML=this._i18n.widgets.directions.departAt)},_setWidgetProperties:function(){this._disconnectEvents();this.set(this.defaults);this.routeLayer=r.clone(this.defaults.routeLayer);this._folderSelector&&(this._outputLayer.setValue(""),this._outputLayer.set("disabled",!0),this._folderSelector.set("disabled",!0));this.set("stops",[]);this._updateCanModifyStops()},_updateStops:function(O){var V=new F;O?this.get("loaded")?this._reset().then(r.hitch(this,
function(){this._addStops(O).then(V.resolve,V.reject)}),V.reject):this._addStops(O).then(V.resolve,V.reject):V.reject();return V.promise},_removeStop:function(O,V,ca,ka){var ha=new F,na=r.hitch(this,function(sa){this.stops.splice(sa,1);var ta=this._dnd.getAllNodes()[sa],xa=this.get("geocoders");this._geocoderEvents[ta.id]&&(this._geocoderEvents[ta.id].blur.remove(),this._geocoderEvents[ta.id].select.remove(),this._geocoderEvents[ta.id].suggest.remove(),this._geocoderEvents[ta.id].value.unwatch());
xa[sa].destroy();xa.splice(sa,1);this.set("geocoders",xa);N.destroy(ta);this._dnd.sync();this._stopsRemovable();this._optionsMenu();this._checkMaxStops();this.setListIcons();this._sortGeocoders()});if(0>O||O>=this.stops.length||void 0===O)O=this.stops.length-1;var qa=!1;for(ka=this.stopGraphics[O]&&this._isStopAWaypoint(this.stops[O])||ka;!qa;)na(O),ka?qa=!0:(O-=0>=O||O<this.stops.length&&this._isStopAWaypoint(this.stops[O])?0:1,qa=!this._isStopAWaypoint(this.stops[O]));for(;this.stops.length-this._getWaypointCount()<
this.minStops;)this._addStop();this._clearStopsStatusAttr();this._setStops();this.createRouteSymbols();ca?(this._clearDisplayBeforeSolve(),this._clearDisplayAfterSolve(),this.createRouteSymbols(),ha.resolve()):this._solveAndZoom(V).then(ha.resolve,ha.reject);return ha.promise},_removeTrafficLayer:function(){this.trafficLayer&&this.map&&this.map.removeLayer(this.trafficLayer);this._trafficLayerAdded=!1},_addStops:function(O,V){var ca=new F,ka=[],ha=this.autoSolve;this.autoSolve=!1;void 0===V&&(V=this._getStopCount());
for(var na=0;na<Math.min(O.length,this.maxStops-this._getStopCount());na++){var qa=new F;this._addStop(O[na],V+na,!0).always(qa.resolve);ka.push(qa)}S(ka).always(r.hitch(this,function(){this.autoSolve=ha;this._getDirections().always(function(){ca.resolve(O)})}));return ca.promise},_addStop:function(O,V,ca){var ka=new F;this._checkMaxStops();this.maxStopsReached?(this._showMessage(D.widgets.directions.error.maximumStops),ka.reject(Error(D.widgets.directions.error.maximumStops))):(void 0===O&&void 0===
V&&(V=this.stops.length),O instanceof P&&O.attributes&&O.attributes.isWaypoint&&(!V||V===this.stops.length||2>this._getStopCount())&&!ca?(this._showMessage(D.widgets.directions.error.waypointShouldBeInBetweenStops),ka.reject(Error(D.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(O).then(r.hitch(this,function(ha){this._isStopAWaypoint(ha)&&ha&&ha.feature&&(ha.feature.attributes=r.mixin({},ha.feature.attributes,{isWaypoint:!0,CurbApproach:3}));this._insertStop(ha,V);this.autoSolve&&
""!==ha.name?this._getDirections().always(function(){ka.resolve(ha,V)}):ka.resolve(ha,V)}),r.hitch(this,function(ha){ka.reject(ha)})));return ka.promise},_removeEmptyStops:function(){for(var O=0,V=this.stops.length-this._getWaypointCount()-this.minStops;O<this.stops.length&&0<V;)this.stops[O]&&this.stops[O].name?O++:(this._removeStop(O,!0,!0,!0),V--,this._moveInProgress&&this._handle._index>=O&&this._handle._isStopIcon&&this._handle._index--)},_setReverseGeocode:function(O,V,ca){if(O.feature.geometry&&
-1<ca){var ka={address:O.name};this.stopGraphics[ca]&&(r.mixin(this.stopGraphics[ca].attributes,ka),this.stopGraphics[ca].setGeometry(V));this.textGraphics[ca]&&(r.mixin(this.textGraphics[ca].attributes,ka),this.textGraphics[ca].setGeometry(V));this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);(ka=this.geocoders[ca])&&ka.inputNode&&(ka.value=O.name,ka.inputNode.value=O.name);r.mixin(O.feature.attributes,this.stops[ca].feature.attributes);this.stops[ca]=O;this.stops[ca].feature.setGeometry(V);
this._setStops();return this._enqueue(function(){return this._getDirections()})}},_insertStop:function(O,V){var ca;if(void 0===V)for(ca=0;ca<this.geocoders.length;ca++){if(!this.geocoders[ca].get("value")){var ka=this.geocoders[ca];break}}else ca=V,this.geocoders[ca]&&!this.geocoders[ca].get("value")&&(ka=this.geocoders[ca]);!ka||void 0!==V&&V!==ca||this._isStopAWaypoint(O)?(void 0===V&&(V=this.geocoders.length),this.stops.splice(V,0,O),this._createGeocoder(O,V)):(this.stops[ca]=O,ka.set("value",
O.name),ka._stopReference=O);this._optionsMenu()},_createGeocoder:function(O,V){var ca=this._dnd.getAllNodes(),ka=!1,ha=!1,na=ca.length;ca[V]?(ha=ca[V],ka=!0):ka=ha=!1;var qa=r.hitch(this,function(za,Da){var Ca=Da?this._css.stopDnDHandleClass:this._css.stopDnDHandleClassHidden,Ha=Da?this._css.stopDnDHandleClassHidden:this._css.stopDnDHandleClass;A.replace(za.children[0],Ca,Ha);2<this.geocoders.length&&(Ca=Da?this._css.stopIconRemoveClass:this._css.stopIconRemoveClassHidden,Ha=Da?this._css.stopIconRemoveClassHidden:
this._css.stopIconRemoveClass,A.replace(za.children[3].children[0],Ca,Ha))}),sa=N.create("tr",{className:this._css.stopClass,style:this._isStopAWaypoint(O)?"display:none;":"",onmouseover:function(){qa(this,!0)},onmouseout:function(){qa(this,!1)}});N.create("td",{className:this._css.stopDnDHandleClassHidden+" dojoDndHandle"},sa);ca=N.create("td",{className:this._css.stopIconColumnClass},sa);N.create("div",{className:this._css.stopIconClass+" dojoDndHandle",innerHTML:this._getLetter(na),"data-center-at":"true"},
ca);na=N.create("td",{className:this._css.esriStopGeocoderColumnClass},sa);na=N.create("div",{},na);ca=N.create("td",{className:this._css.stopIconRemoveColumnClass},sa);N.create("div",{className:this._css.stopIconRemoveClassHidden,role:"button","data-remove":"true"},ca);this._dnd.insertNodes(!1,[sa],ka,ha);ka=r.mixin({},this.get("searchOptions"),{value:O.name,activeSourceIndex:this._globalGeocoder.activeSourceIndex});var ta=new cb(ka,na),xa=r.hitch(this,function(za,Da){this._enqueue(function(){if(Da!==
za&&ta._stopReference&&ta._stopReference.name!==Da){var Ca=m.indexOf(this.stops,ta._stopReference);this.stops[Ca]={name:Da};this._handle._remove();this._removeSomeWaypoints(this._markWPsForRemovalAfterUserChangedStopSequence(Ca));this._setStops();this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this.createRouteSymbols()}})});ta._tr=sa;ta._stopReference=O;ta.startup();this.geocoders.splice(V,0,ta);this._geocoderEvents[sa.id]={blur:ta.on("blur",function(){""!==this.value&&this._stopReference&&
!this._stopReference.feature&&this.search()}),select:ta.on("select-result",r.hitch(this,function(za){var Da=!0;if(za&&(za.results||za.result)){var Ca=this._dnd.getAllNodes();Ca=m.indexOf(Ca,sa);var Ha=ta.value,Ia=za.results&&za.results.results&&za.results.results.length?za.results.results[0]:za.result;Ia?(Ia.name=Ha,this.stops[Ca]=this._toPointGeometry(Ia),this.geocoders[Ca]._stopReference=this.stops[Ca],xa("",Ha)):(this.removeStop(Ca),this.set("directions",null),this._showMessage(D.widgets.directions.error.unknownStop.replace("\x3cname\x3e",
za.target.get("value"))),this._clearRouteGraphics(),Da=!1);Da&&this.getDirections()}})),suggest:ta.on("suggest-results",function(){if(document.activeElement===this.inputNode)for(var za=E("LI[role\x3d'menuitem']",this.suggestionsNode),Da=0;Da<za.length;Da++)z.set(za[Da],"tabindex",-1);else this._hideSuggestionsMenu()}),value:ta.watch("value",function(za,Da,Ca){xa(Da,Ca)})};this._checkMaxStops();this.setListIcons();this._stopsRemovable();this._optionsMenu();this._sortGeocoders()},_blurGeocoders:function(){if(document.activeElement)for(var O=
0;O<this.geocoders.length;O++)if(this.geocoders[O].inputNode===document.activeElement){this.geocoders[O]._hideSuggestionsMenu();this.geocoders[O].inputNode.blur();1<this._getStopCount()+this._getWaypointCount()&&this.getDirections(!0);break}},_decorateEmptyAGOLGeocoderResponse:function(O){O&&", , "===O.name&&(O.name=O.feature&&O.feature.attributes&&O.feature.attributes.Match_addr?O.feature.attributes.Match_addr+("POI"===O.feature.attributes.Addr_type&&O.feature.attributes.City&&-1===O.feature.attributes.Match_addr.indexOf(O.feature.attributes.City)?
", "+O.feature.attributes.City:""):"");return O},_toPointGeometry:function(O){var V=O.feature.geometry;V&&(V.getCentroid?O.feature.geometry=V.getCentroid():V.getExtent&&(V=V.getExtent())&&(O.feature.geometry=V.getCenter()));return O},_removeLocateButtonVisibilityEvents:function(){for(var O=0;O<this.geocoders.length;O++){var V=this.geocoders[O];V._onMouseEnter&&V._onMouseEnter.remove();V._onMouseOut&&V._onMouseOut.remove();V._onKeyPress&&V._onKeyPress.remove();V._locateButton&&(V._locateButton._onMouseEnter&&
V._locateButton._onMouseEnter.remove(),V._locateButton._onMouseOut&&V._locateButton._onMouseOut.remove())}},_setLocateButtonVisibilityEvents:function(){this._removeLocateButtonVisibilityEvents();for(var O=this,V=function(ta){ta instanceof FocusEvent?this._geocoder._lbShown_f=!0:this._geocoder._lbShown_g=!0;O._createLocateButton(this._geocoder,!0)},ca=function(ta){ta instanceof FocusEvent?this._geocoder._lbShown_f=!1:this._geocoder._lbShown_g=!1;clearTimeout(this._destroyTimeout);this._destroyTimeout=
setTimeout(r.hitch(this,function(){this._geocoder._lbShown_lb||this._geocoder._lbShown_f||O._destroyLocateButton(this._locateButton)}),400)},ka=function(){this._geocoder._lbShown_g=!0;clearTimeout(this._destroyTimeout);this._destroyTimeout=setTimeout(r.hitch(this,function(){""===this.value?O._createLocateButton(this._geocoder,!0):O._destroyLocateButton(this._locateButton)}),400)},ha=function(){this._geocoder._lbShown_lb=!0;clearTimeout(this._geocoder._destroyTimeout)},na=function(){this._geocoder._lbShown_lb=
!1;clearTimeout(this._geocoder._destroyTimeout);this._geocoder._destroyTimeout=setTimeout(r.hitch(this,function(){this._geocoder._lbShown_g||this._geocoder._lbShown_f||O._destroyLocateButton(this._geocoder.inputNode._locateButton)}),400)},qa=0;qa<this.geocoders.length;qa++){var sa=this.geocoders[qa];sa&&sa.inputNode&&(sa.inputNode._geocoder=sa,sa._onMouseEnter=t(sa.inputNode,v.enter,V),sa._onMouseOut=t(sa.inputNode,[v.leave,"blur"],ca),sa._onKeyPress=t(sa.inputNode,"keydown",ka),sa.inputNode._locateButton&&
(sa=sa.inputNode._locateButton,sa._onMouseEnter=t(sa.domNode,v.enter,ha),sa._onMouseOut=t(sa.domNode,v.leave,na)))}},_createLocateButton:function(O,V,ca){var ka=new F;O.inputNode._locateButton&&O.inputNode._locateButton._locating?ka.resolve():G(["./LocateButton"],r.hitch(this,function(ha){this._destroyLocateButton(O.inputNode._locateButton);if(O&&!this._solveInProgress){var na=N.create("div",{},O.domNode);A.add(O.domNode,this._css.stopsInnerGeocoderClass);var qa=new ha({map:this.map,highlightLocation:!1,
centerAt:!1,setScale:!1,useTracking:!1},na);qa.startup();O.inputNode._locateButton=qa;qa.domNode._geocoder=O;this._setLocateButtonVisibilityEvents();ha=r.hitch(this,function(){qa._locating=!0;O.set("value","");O.inputNode.placeholder=D.widgets.directions.retrievingMyLocation.toUpperCase()});qa._onBeforeLocate=t(qa._locateNode,d,ha);qa._onLocate=t(qa,"locate",r.hitch(this,function(sa){qa._locating=!1;sa.graphic?(V&&this._destroyLocateButton(O.inputNode._locateButton),this.updateStop(new P(sa.graphic.geometry),
m.indexOf(this.geocoders,O)).then(r.hitch(this,function(){1<this.stopGraphics.length?this.getDirections().always(function(){ka.resolve(sa)}):ka.resolve(sa)}))):(O.set("value",""),O.inputNode.placeholder=D.widgets.directions.myLocationError.toUpperCase(),console.error(sa.error),ka.reject(sa.error))}));ca?(ha(),qa.locate().then(null,ka.reject)):ka.resolve()}else ka.resolve()}));return ka.promise},_destroyLocateButton:function(O){if(O){var V=O.domNode._geocoder;clearTimeout(V._destroyTimeout);O._locating?
V._destroyTimeout=setTimeout(r.hitch(this,function(){V._lbShown_lb||V._lbShown_f||this._destroyLocateButton(O)}),100):(O.clear(),O._onBeforeLocate.remove(),O._onLocate.remove(),O._onMouseEnter&&O._onMouseEnter.remove(),O._onMouseOut&&O._onMouseOut.remove(),O.destroy(),V.inputNode&&(V.inputNode._locateButton=null,V._setPlaceholder(V.activeSourceIndex)))}},_sortStops:function(){this.stops.length&&(this.stops.sort(r.hitch(this,function(O,V){for(var ca,ka,ha=0;ha<this.get("geocoders").length;ha++)this.geocoders[ha]._stopReference===
O?ca=ha:this.geocoders[ha]._stopReference===V&&(ka=ha);return ca>ka?1:ka>ca?-1:0})),this._setStops())},_getCandidate:function(O){var V=new F,ca=typeof O;O?"object"===ca&&O.hasOwnProperty("feature")&&O.hasOwnProperty("name")?(O.feature.attributes&&void 0!==O.feature.attributes.displayName&&!this._isStopAWaypoint(O)&&(O.name=O.feature.attributes.displayName,O.feature.attributes.Name=this._userDefinedStopName),O.name=this._isStopAWaypoint(O)?this._waypointName:String(O.name),"point"!==O.feature.geometry.type&&
(O.feature.geometry=new Q([O.feature.geometry.x,O.feature.geometry.y],this.map.spatialReference)),V.resolve(O)):"object"===ca&&O.hasOwnProperty("address")&&O.hasOwnProperty("location")?(O=this._globalGeocoder._hydrateResult(O),V.resolve(O)):"object"!==ca||!O.hasOwnProperty("name")||null!==O.name&&""!==O.name?O instanceof P&&O.attributes&&(void 0!==O.attributes.Name||O.attributes.isWaypoint)?(ca=this._addStopWrapperToGraphic(O,O.attributes.isWaypoint?this._waypointName:String(O.attributes.Name)),String(O.attributes.Name)&&
(ca.feature.attributes.Name=this._userDefinedStopName),V.resolve(ca)):("object"===ca&&O.hasOwnProperty("name")&&(O=String(O.name)),this._reverseGeocode(O).then(V.resolve,V.reject)):V.resolve(r.clone(this._emptyStop)):V.resolve(r.clone(this._emptyStop));return V.promise},_reverseGeocode:function(O){var V=new F,ca,ka=O.geometry?O.geometry:O;if(this._globalGeocoder){var ha=r.hitch(this,function(ta){var xa=new F,za=500;if(this.map){var Da=this.map.toScreen(ka);Da.x+=ba._calculateClickTolerance([ta]);
this.map.spatialReference.isWebMercator()?(za=Math.abs(this.map.toMap(Da).x-ka.x),xa.resolve(za)):4326===this.map.spatialReference.wkid?(za=Math.abs(R.geographicToWebMercator(this.map.toMap(Da)).x-R.geographicToWebMercator(ka).x),xa.resolve(za)):this._geometryService&&(ta=new ua,ta.distanceUnit=ya.UNIT_METER,ta.geometry1=ka,ta.geometry2=this.map.toMap(Da),this._geometryService.distance(ta,function(Ca){za=Ca;xa.resolve(za)},function(){xa.resolve(za)}))}return xa.promise}),na=[],qa=this._globalGeocoder.sources,
sa=function(){qa[ca].featureLayer&&na.push(ha(qa[ca].featureLayer).then(r.hitch(qa[ca],function(ta){this.searchQueryParams=r.mixin(this.searchQueryParams,{distance:ta})})))};if("all"===this._globalGeocoder.activeSourceIndex)for(ca=0;ca<qa.length;ca++)sa();else ca=this._globalGeocoder.activeSourceIndex,sa();S(na).always(r.hitch(this,function(){this._globalGeocoder.search(ka).then(r.hitch(this,function(ta){var xa=!1;if(ta){var za=null;for(ca=0;ca<this._globalGeocoder.sources.length;ca++)if(ta[ca]&&
ta[ca].length){var Da=ta[ca];break}if(Da.length&&(xa=!0,za=Da[0],this._globalGeocoder.sources[ca].featureLayer))for(ta=Number.POSITIVE_INFINITY,ca=0;ca<Da.length;ca++){Da[ca]=this._toPointGeometry(Da[ca]);var Ca=U.geodesicLengths([new la({paths:[[R.xyToLngLat(ka.x,ka.y),R.xyToLngLat(Da[ca].feature.geometry.x,Da[ca].feature.geometry.y)]],spatialReference:{wkid:this.map.spatialReference.wkid}})],"esriMeters")[0];ta>Ca&&(ta=Ca,za=Da[ca])}(za=this._decorateEmptyAGOLGeocoderResponse(za))&&""!==za.name&&
null!==za.name&&void 0!==za.name?(za.name=String(za.name),isNaN(ka.x)||isNaN(ka.y)||this.map.spatialReference.wkid!==ka.spatialReference.wkid?!za.feature.geometry||isNaN(za.feature.geometry.x)||isNaN(za.feature.geometry.y)?(this._showMessage(D.widgets.directions.error.locator),V.reject(Error(D.widgets.directions.error.locator))):V.resolve(za):(za.feature.geometry=ka,V.resolve(za))):xa=!1}xa||(O instanceof Q?O=new P(O):O instanceof Array&&(O=new P(new Q(O[0],O[1]))),O instanceof P?this._decorateUngeocodedStop(O).then(V.resolve,
V.reject):(this._showMessage(D.widgets.directions.error.unknownStop.replace("\x3cname\x3e",O.toString())),V.reject(Error(D.widgets.directions.error.unknownStop.replace("\x3cname\x3e",O.toString())))))}))}))}else this._showMessage(D.widgets.directions.error.locatorUndefined),V.reject(Error(D.widgets.directions.error.locatorUndefined));return V.promise},_updateStop:function(O,V,ca){var ka=new F;this.stops&&this.stops[V]?O instanceof P&&O.attributes&&O.attributes.isWaypoint&&(!V||V===this.stops.length-
1||2>this._getStopCount())?(this._showMessage(D.widgets.directions.error.waypointShouldBeInBetweenStops),ka.reject(Error(D.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(O).then(r.hitch(this,function(ha){var na=ha.feature;na=na?na.geometry:null;var qa=this.stops[V].feature;qa=qa?qa.geometry:null;na=na&&qa&&(na.x!==qa.x||na.y!==qa.y)||!na&&qa;this.stops[V]=ha;this.geocoders[V]||this._createGeocoder(ha,V);qa=this.geocoders[V];qa._stopReference=ha;qa._tr.style.display=
this._isStopAWaypoint(ha)?"none":"";qa.value=ha.name;qa.inputNode&&(qa.inputNode.value=ha.name);na&&this.autoSolve&&1<this._getStopCount()+this._getWaypointCount()||ca?this._getDirections().then(ka.resolve,ka.reject):(this._setStops(),ka.resolve(ha))}),r.hitch(this,function(ha){ka.reject(ha)})):(this._showMessage(D.widgets.directions.error.couldNotUpdateStop),ka.reject(Error(D.widgets.directions.error.couldNotUpdateStop)));this._optionsMenu();return ka.promise},_renderDirections:function(){var O=
this.get("directions");if(this._resultsNode){var V='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';V+=this._renderDirectionsSummary(O);V+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';V+='\x3cdiv class\x3d"'+this._css.routesClass+'"\x3e';V+=this._renderDirectionsTable(O);V+="\x3cdiv class\x3d'esriPrintFooter'\x3e"+D.widgets.directions.printDisclaimer+"\x3c/div\x3e";V+="\x3c/div\x3e";this._resultsNode&&(this._resultsNode.innerHTML=V);this._disconnectResults();(O=E("[data-segment]",
this._resultsNode))&&O.length&&m.forEach(O,r.hitch(this,function(ca){this._resultEvents.push(t(ca,v.enter,r.hitch(this,function(){if(!this._focusedDirectionsItem){var ka=parseInt(z.get(ca,"data-segment"),10);this.highlightSegment(ka)}})));this._resultEvents.push(t(ca,"focusout",r.hitch(this,function(){this._focusedDirectionsItem=null;this.unhighlightSegment(!0)})));this._resultEvents.push(t(ca,v.leave,this.unhighlightSegment));this._resultEvents.push(t(ca,"click, keydown",r.hitch(this,function(ka){ka&&
("click"===ka.type||"keydown"===ka.type&&ka.keyCode===l.ENTER)&&(this._focusedDirectionsItem!==ca?this.selectSegment(parseInt(z.get(ca,"data-segment"),10)):(ca.blur(),this.map.infoWindow.hide(),this._focusedDirectionsItem=null,this.unhighlightSegment(!0)))})))}))}},_renderDirectionsSummary:function(O){var V="",ca=r.hitch(this,function(){for(var qa={},sa=this._getDirectionsTimeAttribute()||{},ta=this._getTimeNeutralAttribute()||{},xa=0,za=0,Da=this.get("stops"),Ca=Da.length-1;0<=Ca;Ca--)if(null!==
Da[Ca].feature.attributes.ArriveCurbApproach){qa=Da[Ca].feature.attributes;break}for(var Ha in qa)qa.hasOwnProperty(Ha)&&(Ha==="Cumul_"+sa.name&&(xa=qa[Ha]),Ha==="Cumul_"+ta.name&&(za=qa[Ha]));qa="esriTrafficLabelHidden";Da=D.widgets.directions.noTraffic;Ca=O.totalTime-O.totalDriveTime;Ca=(za-this._convertCostValue(Ca,sa.units,ta.units))/(xa-Ca||1);0<Ca&&.8>Ca?(qa="esriTrafficLabelHeavy",Da=D.widgets.directions.heavyTraffic):1===Ca?(qa="esriTrafficLabelNone",Da=D.widgets.directions.noTraffic):1.25<
Ca&&(qa="esriTrafficLabelLight",Da=D.widgets.directions.ligthTraffic);ta=this._formatTime(za,!1,ta.units);return{label:Da,labelClass:qa,ratio:Ca,noTrafficCostStr:1!==Ca&&ta?ta+" "+D.widgets.directions.onAverage+"\x3cbr\x3e":"",trafficCost:xa,noTrafficCost:za,timeAtt:sa}});if(O.totalLength||O.totalTime){ca=ca();var ka=this._getImpedanceAttribute();V+="\x3cdiv class\x3d'"+this._css.resultsSummaryClass+"' data-full-route\x3d'true'\x3e\x3cdiv class\x3d'esriImpedanceCost'\x3e";if(this._isTimeUnits(ka.units))V+=
this._formatTime(ca.trafficCost,!0,ca.timeAtt.units)+"\x3cdiv class\x3d'esriImpedanceCostHrMin'\x3e\x3cdiv class\x3d'esriImpedanceCostHr'\x3e"+D.widgets.directions.time.hr+"\x3c/div\x3e\x3cdiv class\x3d'esriImpedanceCostMin'\x3e"+D.widgets.directions.time.min+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+(ca.noTrafficCost?"\x3cdiv class\x3d'esriTrafficLabel "+ca.labelClass+"'\x3e"+ca.label+"\x3c/div\x3e"+ca.noTrafficCostStr:"")+this._formatDistance(O.totalLength);else{ka=
(ka=D.widgets.directions.units[this.directionsLengthUnits])?ka.name:"";var ha=this.serviceDescription&&10.6<=this.serviceDescription.currentVersion,na=this.directions.features[0].attributes;V+=J.format(O.totalLength,{places:1})+"\x3cdiv class\x3d'esriImpedanceCostDist'\x3e"+ka+"\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+(ca.noTrafficCost&&ha?"\x3cdiv class\x3d'esriTrafficLabel "+ca.labelClass+"'\x3e"+ca.label+"\x3c/div\x3e"+ca.noTrafficCostStr:"")+this._formatTime(O.totalTime)+
" "+("none"!==this.startTime&&ca.noTrafficCost&&ha?D.widgets.directions.atTheMoment+" "+this._toSpatiallyLocalTimeString(na.arriveTimeUTC,na.ETA):"")}V+="\x3c/div\x3e\x3c/div\x3e"}return V},_renderDirectionsTable:function(O){for(var V=0,ca=0,ka=0,ha='\x3ctable summary\x3d"'+O.routeName+'"\x3e\x3ctbody role\x3d"menu"\x3e',na=0;na<O.features.length;na++){var qa=O.features[na].attributes;"esriDMTDepart"===qa.maneuverType&&(ca=ka=0);ka+=qa.length;ca+=qa.time;V+=qa.time;ha+=this._renderDirectionsItemTR(O.features[na],
ka,ca,V)}return ha+"\x3c/tbody\x3e\x3c/table\x3e"},_renderDirectionsItemTR:function(O,V,ca,ka){var ha=this.directions,na=ha?m.indexOf(ha.features,O):-1;ka="";var qa=this._css.routeClass,sa=O._associatedStopWithReturnToStart&&O._associatedStopWithReturnToStart.attributes,ta=O.attributes;if(-1<na){ta&&(ta.step=na+1);ta.maneuverType&&(qa+=" "+ta.maneuverType);sa&&null===sa.ArriveCurbApproach&&null!==sa.DepartCurbApproach?qa+=" "+this._css.routeOriginClass:sa&&null!==sa.ArriveCurbApproach&&null===sa.DepartCurbApproach&&
(qa+=" "+this._css.routeDestinationClass+" "+this._css.routeLastClass);ka+='\x3ctr tabindex\x3d"0" role\x3d"menuitem" class\x3d"'+qa+" "+this._css.routeZoomClass+'" data-segment\x3d"'+na+'"\x3e';ka+='\x3ctd class\x3d"'+this._css.routeIconColumnClass+'"\x3e';ka+='\x3cdiv class\x3d"'+this._css.routeIconClass+'"\x3e';ka+=this._getLetter(O._associatedStop);ka=ka+'\x3c/div\x3e\x3c/td\x3e\x3ctd class\x3d"'+(this._css.routeTextColumnClass+'"\x3e');ka+='\x3cdiv class\x3d"'+this._css.routeInfoClass+'"\x3e';
ka+='\x3cdiv class\x3d"'+this._css.routeTextClass+'"\x3e';O=(ha.strings[na]||[]).slice();if("esriDMTDepart"===ta.maneuverType||"esriDMTStop"===ta.maneuverType)for(ha=0;ha<this.stops.length;ha++)this.stops[ha]&&this.stops[ha].name&&O.push({string:this.stops[ha].name});if(O){qa=ta.text;for(ha=0;ha<O.length;ha++)qa=this._boldText(qa,O[ha].string);ta.formattedText=qa}else ta.formattedText=ta.text;if("esriDMTStop"===ta.maneuverType&&(V||ca)||"esriDMTDepart"===ta.maneuverType&&0===na)V=this._formatDistance(V-
ta.length,!0),ca=this._formatTime(ca-ta.time),na=this._formatTime(ta.time),O=this._formatDistance(ta.length,!0),ta.formattedText+="\x3cdiv class\x3d'esriRouteTextColumnCumulative'\x3e"+V+(V&&ca?" \x26middot; ":"")+ca+(V||ca?"\x3cbr\x3e":"")+(na?D.widgets.directions.serviceTime+":\x26nbsp;"+na:"")+(na&&O?"\x3cbr\x3e":"")+(O?D.widgets.directions.serviceDistance+":\x26nbsp;"+O:"")+"\x3c/div\x3e";ka+="\x3cstrong\x3e"+J.format(ta.step)+".\x3c/strong\x3e "+ta.formattedText;ka+="\x3c/div\x3e";V=this._formatDistance(ta.length,
!0);ca=this._formatTime(ta.time);"esriDMTStop"!==ta.maneuverType&&"esriDMTDepart"!==ta.maneuverType||!this.routeParams.startTime||-22091616E5===ta.ETA?V&&(ka+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e',ka+=V,ca&&(ka+="\x26nbsp;\x26middot;\x3cwbr\x3e\x26nbsp;"+ca),ka+="\x3c/div\x3e"):ka+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e'+this._toSpatiallyLocalTimeString(ta.arriveTimeUTC,ta.ETA)+"\x3c/div\x3e";ka+="\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e"}return ka},_toSpatiallyLocalTimeString:function(O,
V){var ca=new Date(V),ka=new Date(ca.getTime()+6E4*ca.getTimezoneOffset());ka=n.date.locale.format(ka,{selector:"time"});var ha="";O?(V=(V-O)/1E3/60/60,O=Math.floor(V),V=60*(V-O),O=D.widgets.directions.GMT+(0>O?"":"+")+J.format(O,{pattern:"00"})+J.format(V,{pattern:"00"}),ha=ka+" "+O):ha="now"===this.startTime?n.date.locale.format(ca,{selector:"time"}):ka;return ha},_addStopWrapperToGraphic:function(O,V){return{extent:new ea({xmin:O.geometry.x-.25,ymin:O.geometry.y-.25,xmax:O.geometry.x+.25,ymax:O.geometry.y+
.25,spatialReference:O.geometry.spatialReference}),feature:O,name:V}},_clearBarriersGraphics:function(){this._barriersLayer.clear();this._polylineBarriersLayer.clear();this._polygonBarriersLayer.clear()},_showBarriers:function(){this._clearBarriersGraphics();var O=this.routeParams,V=O.polylineBarriers&&O.polylineBarriers.features||[],ca=O.polygonBarriers&&O.polygonBarriers.features||[];m.forEach(O.barriers&&O.barriers.features||[],r.hitch(this,function(ka){this._barriersLayer.add(ka)}));m.forEach(V,
r.hitch(this,function(ka){this._polylineBarriersLayer.add(ka)}));m.forEach(ca,r.hitch(this,function(ka){this._polygonBarriersLayer.add(ka)}));this._barriersLayer.refresh();this._polylineBarriersLayer.refresh();this._polygonBarriersLayer.refresh()},_showRoute:function(O){this._clearDisplayAfterSolve();var V=O.routeResults[0].directions,ca=new F;if(V){this.set("solveResult",O);this.set("directions",V);var ka=O.routeResults[0].stops,ha,na;if(ka&&ka.length){var qa=[];for(ha=0;ha<ka.length;ha++){var sa=
ka[ha];sa.attributes.isWaypoint=sa.attributes.Name===this._waypointName||sa.attributes.isWaypoint;sa=this._addStopWrapperToGraphic(sa,sa.attributes.Name);this.stops[ha]&&this.stops[ha].feature&&this.stops[ha].feature.attributes&&this.stops[ha].feature.attributes.Name===this._userDefinedStopName&&(sa.feature.attributes.Name=this._userDefinedStopName);this._returnToStartStop&&this._returnToStartStop._resultsStopIndex===ha?this._returnToStartStop=sa:qa.push(sa)}if(this.stops.length>qa.length)for(ha=
0;ha<this.stops.length;ha++)this.stops[ha].feature||""!==this.stops[ha].name||qa.splice(ha,0,this._emptyStop);this.stops=qa;for(ha=0;ha<this.stops.length;ha++)this._updateStop(this.stops[ha],ha);this._setStops();this._setMenuNodeValues()}this.set("mergedRouteGraphic",new P(V.mergedGeometry,this.get("routeSymbol")));ka=[];qa=[];for(ha=sa=0;ha<V.featuresWithWaypoints.length;ha++){var ta=V.featuresWithWaypoints[ha];if("esriDMTDepart"===ta.attributes.maneuverType)for(na=0;na<this.stops.length;na++)if(this.stops[na].feature===
ta._associatedStop){sa=na+1;break}ta.setSymbol(this.get("routeSymbol"));this._routeLayer.add(ta);ka.push(ta);(na=ta.getDojoShape())&&na.moveToBack();na=new P(ta.geometry,this._symbolEventPaddingDirections,ta.attributes);na._nextStopIndex=sa-.5;na._isSnapFeature=!0;ta._associatedSnapFeature=na;this._waypointsEventLayer.add(na);"esriDMTDepart"!==ta.attributes.maneuverType&&(na=ta.geometry.getPoint(0,0))&&(na=new P(na,this.maneuverSymbol),na._directionsFeature=ta._associatedFeatureNoWaypoints,qa.push(na),
this._waypointsEventLayer.add(qa[qa.length-1]))}this.set("displayedRouteGraphics",ka);this.set("displayedManeuverPointGraphics",qa);this._renderDirections();for(ha=0;ha<this.stops.length;ha++)if(this._isStopAWaypoint(this.stops[ha])&&this._modifiedWaypointIndex===ha){for(na=0;na<V.featuresWithWaypoints.length;na++)if(ka=V.featuresWithWaypoints[na],ka._associatedStop===this.stops[ha].feature){if("esriDMTStop"===ka.attributes.maneuverType||"esriDMTDepart"===ka.attributes.maneuverType)this.stops[ha].feature.geometry.x=
ka.geometry.paths[0][0][0],this.stops[ha].feature.geometry.y=ka.geometry.paths[0][0][1];break}this._modifiedWaypointIndex=null;break}H.set(this._savePrintBtnContainer,"display","inline-block");this.onDirectionsFinish(O)}else O=O.routeResults[0].route,O.setSymbol(this.routeSymbol),this._routeLayer.add(O),this._incrementalRouteSegment=O;ca.resolve();this._moveLayersToFront();this.createRouteSymbols();return ca.promise},_setGeocodersStopReference:function(){if(this.geocoders)for(var O=0;O<this.geocoders.length;O++)this.geocoders[O]&&
this.stops[O]&&(this.geocoders[O]._stopReference=this.stops[O])},_setStops:function(){this._setGeocodersStopReference();this.createRouteSymbols();this._set("stops",this.stops);this.onStopsUpdate(this.stops)},_getCandidates:function(O){var V=[];if(O&&O.length){for(var ca=0;ca<O.length;ca++)V.push(this._getCandidate(O[ca]));return S(V)}O=new F;O.resolve([]);return O.promise},_clearResultsHTML:function(){this._resultsNode.innerHTML="";H.set(this._savePrintBtnContainer,"display","none")},_showSegmentPopup:function(O){if(O&&
this.get("showSegmentPopup")&&this.get("map").infoWindow){var V=O.geometry.getPoint(0,0);O=new P(V,null,O.attributes,this.get("segmentInfoTemplate"));var ca=this.get("map").infoWindow;ca.setFeatures([O]);ca.show(V)}},_addStopButton:function(){this.addStop().then(r.hitch(this,function(){this.get("focusOnNewStop")&&this.geocoders[this.stops.length-1].focus()}))},_sortGeocoders:function(){var O=this._dnd.getAllNodes();this.geocoders.sort(r.hitch(this,function(ca,ka){return ca.domNode&&ca.domNode.parentNode&&
ca.domNode.parentNode.parentNode&&ka.domNode&&ka.domNode.parentNode&&ka.domNode.parentNode.parentNode?m.indexOf(O,ca.domNode.parentNode.parentNode)>m.indexOf(O,ka.domNode.parentNode.parentNode)?1:-1:0}));this.stops.length===this.geocoders.length&&this._sortStops();for(var V=0;V<this.geocoders.length;V++)this.geocoders[V]&&this.geocoders[V].inputNode&&(this.geocoders[V].inputNode.title=D.widgets.directions.stopNoTitle+(V+1));this._setLocateButtonVisibilityEvents()},_disconnectResults:function(){if(this._resultEvents&&
this._resultEvents.length)for(var O=0;O<this._resultEvents.length;O++)this._resultEvents[O]&&this._resultEvents[O].remove();this._resultEvents=[]},_formatArbitraryCostsForRouteTooltip:function(O){var V="",ca;for(ca in O)if(0===ca.indexOf("Total_")&&O.hasOwnProperty(ca)){var ka=this._getCostAttribute(ca.substr(6));ka&&(V+=this._isTimeUnits(ka.units)?this._formatTime(O[ca],!1,ka.units):this._formatDistance(O[ca],!0,ka.units),V+=V?" \x26middot; ":"")}V&&(V=D.widgets.directions.toNearbyStops+": \x3cb\x3e"+
V.substr(0,V.length-10)+"\x3c/b\x3e");return V},_formatTime:function(O,V,ca){ca||(ca=(this._getDirectionsTimeAttribute()||{}).units);var ka="";ca=Math.round(this._convertCostValue(O,ca,"esriNAUMinutes"));O=Math.floor(ca/60);ca=Math.floor(ca%60);V?ka=J.format(O,{pattern:100>O?"00":"000"})+":"+J.format(ca,{pattern:"00"}):(O&&(ka+=O+" "+D.widgets.directions.time.hr+" "),ka+=O||ca?ca+" "+D.widgets.directions.time.min:"");return ka},_formatDistance:function(O,V,ca){ca||(ca=this.directionsLengthUnits);
var ka=this.directionsLengthUnits,ha=D.widgets.directions.units[ka],na=ka.replace("esri","").toLowerCase();O=this._convertCostValue(O,ca,ka);ha&&(na=V?ha.abbr:ha.name);return O?J.format(O,{locale:"root",places:2})+" "+na:""},_projectToGeographic:function(O){var V=new F;if(!O)return V.reject("Directions:: 'geometry' is not defined.",{geometry:O}),V.promise;if(4326==O.spatialReference.wkid)return V.resolve(O),V.promise;if(!this._geometryService)return V.reject("Directions:: Geometry service is not defined."),
V.promise;var ca=new Za;ca.outSR=new Z(4326);ca.geometries=[O];this._geometryService.project(ca).then(function(ka){V.resolve(ka&&ka[0])},V.reject);return V.promise},_createToolbars:function(){this.editToolbar||(this.editToolbar=new Ea(this.map));this.drawToolbar||(this.drawToolbar=new Ra(this.map),D.toolbars.draw.freehand=D.widgets.directions.lineBarrierFreehand,this.drawToolbar.onDrawComplete=r.hitch(this,function(O){var V=new P(O.geometry,null,{BarrierType:0});this._projectToGeographic(O.geographicGeometry||
O.geometry).then(r.hitch(this,function(ca){1<U.geodesicLengths([ca],X.METERS)[0]&&(this._polylineBarriersLayer.add(V),this.routeParams.polylineBarriers||(this.routeParams.polylineBarriers=new ra),this.routeParams.polylineBarriers.features.push(V),this._clearStopsStatusAttr(),this.getDirections(!0))}))}))},_destroyGlobalGeocoder:function(){this._globalGeocoder&&(this._globalGeocoder.destroy(),this._globalGeocoder=null)},_createGlobalGeocoder:function(){var O=new F;this._globalGeocoder=new cb(this.get("searchOptions"));
t.once(this._globalGeocoder,"load",O.resolve,O.reject);this._globalGeocoder.startup();return O.promise},_init:function(){var O=new F;this.set("loaded",!1);this._enableButton(this._getDirectionsButtonNode,!1);H.set(this._saveAsButton,"display","none");this.clearMessages();if(this.get("map").loaded)this._configure().always(O.resolve);else t.once(this.get("map"),"load",r.hitch(this,function(){this._configure().always(O.resolve)}));return O.promise},_setDefaultStops:function(){var O=new F;this.defaults.stops&&
this.defaults.stops.length?this._updateStops(this.defaults.stops).then(r.hitch(this,function(){this._removeEmptyStops();O.resolve()}),O.reject):O.resolve();return O.promise},_configure:function(){var O=new F;this._handle&&this._handle._remove();this._createDnD();this._createDepartAtControls();this._setSearchOptions();this._createGlobalGeocoder().then(r.hitch(this,function(){this._createToolbars();this._usingAGOL()||(this.printTaskUrl=this.geometryTaskUrl=null);this._createGeometryTask();this._createPrintTask();
this._showActivateButton();this._showBarriersButton();this._createTravelModesDDL();this._createSearchSourceDDL();var V=[this._createRouteTask(),this._setDefaultStops()];S(V).then(r.hitch(this,function(){this._setDefaultUnits();this._setTrafficOptions();this._setMenuNodeValues();this._setupEvents();var ca=this.directionsLanguage||this.userOptions.routeParams&&this.userOptions.routeParams.directionsLanguage||n.locale.toLowerCase();this._setDirectionsLanguageByLocale(ca);this._setupTravelModes().then(r.hitch(this,
function(){this.set("loaded",!0);this.onLoad();O.resolve(!0)}),function(ka){O.reject(ka)})}),function(ca){O.reject(ca)})}),function(V){O.reject(V)});this._naRouteSharing=null;return O.promise},_setDirectionsLanguageByLocale:function(O){var V=this.serviceDescription.directionsSupportedLanguages,ca=function(ha){if(V)for(var na=0;na<V.length;na++)if(V[na].toLowerCase().substr(0,2)===ha)return V[na];return null},ka=ca(O);ka||(O=O.substr(0,2),ka=ca(O));this.directionsLanguage=ka;return this.routeParams.directionsLanguage=
ka},_getStopSymbol:function(O,V){var ca=O&&(O.feature&&O.feature.attributes||O.attributes),ka=this.stopSymbol;ca&&(ka=this._isStopAWaypoint(O)?this.waypointSymbol:void 0===ca.Status||0===ca.Status||6===ca.Status?null===ca.ArriveCurbApproach&&null!==ca.DepartCurbApproach?this.get(V?"fromSymbolDrag":"fromSymbol"):null!==ca.ArriveCurbApproach&&null===ca.DepartCurbApproach?this.get(V?"toSymbolDrag":"toSymbol"):this.get(V?"stopSymbolDrag":"stopSymbol"):this.get(V?"unreachedSymbolDrag":"unreachedSymbol"));
return ka},_addTrafficLayer:function(){this.trafficLayer&&!this._trafficLayerAdded&&this.map&&(this.map.addLayer(this.trafficLayer),this.trafficLayer.show(),this._trafficLayerAdded=!0)},_toggleUnits:function(O){O.target===this._useMilesNode?this.setDirectionsLengthUnits(X.MILES):O.target===this._useKilometersNode&&this.setDirectionsLengthUnits(X.KILOMETERS)},_toggleCheckbox:function(O){var V=z.get(O.target,"checked");O.target===this._findOptimalOrderNode?this.set("optimalRoute",V):O.target===this._useTrafficNode?
this.set("traffic",V):O.target===this._returnToStartNode&&this.set("returnToStart",V)},_isStopLocated:function(O){return O&&O.feature&&O.feature.attributes&&(!O.feature.attributes.Status||6===O.feature.attributes.Status)},_configureRouteOptions:function(){var O=this.get("routeParams"),V;this.get("directionsLengthUnits")?O.directionsLengthUnits=this.get("directionsLengthUnits"):this.set("directionsLengthUnits",O.directionsLengthUnits);O.findBestSequence=this.get("optimalRoute");if(O.findBestSequence)for(O.preserveFirstStop=
this._isStopLocated(this.stops[0]),O.preserveLastStop=!this.returnToStart&&this._isStopLocated(this.stops[this.stops.length-1])||this.returnToStart&&this._isStopLocated(this.stops[0]),V=0;V<this.stops.length;)this._isStopAWaypoint(this.stops[V])?this._removeStop(V,!0,!0):V++;if(!this.returnToStart&&this.stops.length&&this._isStopAWaypoint(this.stops[this.stops.length-1]))for(V=this.stops.length-1;0<V;)this._isStopAWaypoint(this.stops[V])&&this._removeStop(V,!0,!0),V--;if(this._isTimeUnits(this._getImpedanceAttribute().units)||
this.serviceDescription&&10.6<=this.serviceDescription.currentVersion)if(O.useTimeWindows=!0,"now"===this.startTime)O.timeWindowsAreUTC=!0,O.startTimeIsUTC=!0,O.startTime=new Date;else if("none"===this.startTime)O.startTime=null;else{O.timeWindowsAreUTC=!1;O.startTimeIsUTC=!1;var ca=this._departAtTime,ka=6E4*ca.getValue().getTimezoneOffset();ca=new Date(ca.getValue().getTime()+this._departAtDate.getValue().getTime()-ka);ca=new Date(ca.getTime()-6E4*ca.getTimezoneOffset());O.startTime=ca}else O.startTime=
null,O.useTimeWindows=!1;ca=this._getImpedanceAttribute();ka=this._getTimeNeutralAttribute();var ha=this._getDirectionsTimeAttribute();V=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames;ka&&-1===m.indexOf(V,ka.name)&&V.push(ka.name);!this._isTimeUnits(ca.units)&&this.serviceDescription&&10.6<=this.serviceDescription.currentVersion&&ha&&-1===m.indexOf(V,ha.name)&&V.push(ha.name);this.routeParams.accumulateAttributes=V;O.returnStops=!0;ha=[];for(V=0;V<this.stopGraphics.length;V++)if(this.stopGraphics[V]&&
(ha.push(new P(this.stopGraphics[V].toJson())),V)){var na=ha[0].attributes,qa=ha[V].attributes;for(sa in qa)qa.hasOwnProperty(sa)&&!na.hasOwnProperty(sa)&&(na[sa]=null)}if(this.get("returnToStart")&&this.stopGraphics.length&&this._isStopLocated(this.stops[0])){var sa=new P(this.stopGraphics[0].toJson());this._returnToStartStop=this._addStopWrapperToGraphic(sa,sa.attributes.Name);ha.push(sa)}else this._returnToStartStop=null;O.stops.features=ha;if(ka)for(V=0;V<ha.length;V++)ha[V].attributes["Attr_"+
ka.name]=this._convertCostValue(ha[V].attributes["Attr_"+ca.name],ca.units,ka.units);this.set("routeParams",O)},_configureRoute:function(){var O=new F;O.promise.always(r.hitch(this,function(){this._checkMaxStops()}));this.createRouteSymbols();this._configureRouteOptions();if(this.routeParams.returnRoutes&&this._incrementalSolveStopRange){var V=this._incrementalSolveStopRange;V.start<V.end?this.routeParams.stops.features=this.routeParams.stops.features.slice(V.start,V.end+1):V.start>V.end&&(this.routeParams.stops.features=
this.routeParams.stops.features.slice(V.start,this.routeParams.stops.features.length-1).concat(this.routeParams.stops.features.slice(0,V.end+1)))}else this._incrementalSolveStopRange=null;var ca={},ka=this.routeParams.stops.features;for(V=0;V<ka.length;V++){var ha=ka[V].attributes.address;var na=(V===this._handle._index&&!this._handle.attributes.isWaypoint&&this._incrementalSolveStopRange?this._waypointName:ha)+"_"+this._stopSequence++;ka[V].attributes.Name=na;ca[na]=ha;delete ka[V].attributes.address;
delete ka[V].attributes.isWaypoint;delete ka[V].attributes.Status}this._solveInProgress=!0;var qa={_incrementalSolveStopRange:this._incrementalSolveStopRange};this.routeTask.solve(this.routeParams,r.hitch(this,function(sa){this._solveResultProcessing(sa,ca,qa).then(O.resolve,O.reject)}),r.hitch(this,function(sa){r.mixin(this,qa);this._solveInProgress=!1;for(var ta=0;ta<this.stops.length;ta++)this.stops[ta].feature&&(this.stops[ta].feature.attributes=r.mixin(this.stops[ta].feature.attributes,{Status:5}));
this.set("directions",null);this._clearDisplayAfterSolve();this.createRouteSymbols();this._routeTaskError(sa);O.reject(sa)}));return O.promise},_solveResultProcessing:function(O,V,ca){var ka=new F;r.mixin(this,ca);this._solveInProgress=!1;ca=O.routeResults[0];var ha=ca.directions;ca=ca.stops;if(ha){this._solverMessages=O.messages;var na=function(za){for(var Da in V)if(za&&0===ha.routeName.indexOf(Da)||!za&&0<ha.routeName.indexOf(Da))return V[Da];return""};var qa=na(!0);na=na(!1);ha.routeName=(qa!==
this._waypointName?qa:D.widgets.directions.waypoint)+" \u2014 "+(na!==this._waypointName?na:D.widgets.directions.waypoint);for(qa=0;qa<ha.features.length;qa++)if(na=ha.features[qa].attributes,"esriDMTDepart"===na.maneuverType||"esriDMTStop"===na.maneuverType)for(var sa in V)if(V.hasOwnProperty(sa)&&-1<na.text.indexOf(sa)){na.text=na.text.replace(sa,V[sa]);for(var ta=0;ta<ca.length;ta++){var xa=ca[ta].attributes;if(xa.Name===sa){r.mixin(ha.features[qa],{_associatedStop:ca[this.returnToStart&&ta===
ca.length-1?0:ta],_associatedStopWithReturnToStart:ca[ta]});if(!xa.ArriveTime&&!xa.ArriveTimeUTC&&na.ETA&&na.arriveTimeUTC){xa.ArriveTime=na.ETA;xa.ArriveTimeUTC=na.arriveTimeUTC;ta=0;if(0==qa&&"esriDMTDepart"===na.maneuverType||0<qa&&"esriDMTStop"===na.maneuverType)ta=this._convertCostValue(na.time,(this._getDirectionsTimeAttribute()||{}).units,"milliseconds");xa.DepartTime=xa.ArriveTime+ta;xa.DepartTimeUTC=xa.ArriveTimeUTC+ta}break}}}for(qa=0;qa<ca.length;qa++)this._returnToStartStop&&ca[qa].attributes.Name===
this._returnToStartStop.feature.attributes.Name&&(this._returnToStartStop._resultsStopIndex=qa),ca[qa].attributes.Name=V[ca[qa].attributes.Name];this._directionsPostprocessing(ha);this.traffic&&this._updateMapTimeExtent()}this._showRoute(O).always(r.hitch(this,function(){this._incrementalSolveStopRange=null;ka.resolve(O)}));return ka.promise},_directionsPostprocessing:function(O){var V,ca=function(na,qa){var sa=O.features[na]._associatedFeaturesWithWaypoints||[];sa.push(O.featuresWithWaypoints[qa]);
O.features[na]._associatedFeaturesWithWaypoints=sa;O.featuresWithWaypoints[qa]._associatedFeatureNoWaypoints=O.features[na]};var ka=r.hitch(this,function(na){return"\x3cdiv class\x3d'"+this.theme+"'\x3e\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(na._associatedFeatureNoWaypoints)+"\x3c/table\x3e\x3c/div\x3e"});O.featuresWithWaypoints=[];for(V=0;V<O.features.length;V++){var ha=new P(O.features[V].toJson());ha.setInfoTemplate(new aa({title:this._i18n.widgets.directions.maneuver,
content:ka}));O.featuresWithWaypoints.push(ha);O.featuresWithWaypoints[V]._associatedStop=O.features[V]._associatedStop;O.featuresWithWaypoints[V]._associatedStopWithReturnToStart=O.features[V]._associatedStopWithReturnToStart}O.stringsWithWaypoints=r.mixin([],O.strings);O.eventsWithWaypoints=r.mixin([],O.events);for(ka=V=0;V<O.features.length;)O.features[V]._associatedStop&&O.features[V]._associatedStop.attributes.Name===this._waypointName?(O.features.splice(V,V?2:1),O.strings.splice(V,V?2:1),O.events.splice(V,
V?2:1),V&&O.features[V]&&"esriDMTStraight"===O.features[V].attributes.maneuverType?(ha=O.features.splice(V,1)[0],O.strings[V-1]=(O.strings[V-1]||[]).concat(O.strings.splice(V,1)[0]||[]),O.strings[V-1].length||(O.strings[V-1]=void 0),O.events[V-1]=(O.events[V-1]||[]).concat(O.events.splice(V,1)[0]||[]),O.events[V-1].length||(O.events[V-1]=void 0),O.features[V-1].attributes.length+=ha.attributes.length,O.features[V-1].attributes.time+=ha.attributes.time,O.features[V-1].geometry.paths[0]=O.features[V-
1].geometry.paths[0].concat(ha.geometry.paths[0]),ca(V-1,ka++),ca(V-1,ka++),ca(V-1,ka++)):(V&&ca(V-1,ka++),V<O.features.length&&ca(V,ka++))):(ca(V,ka++),V++)},_boldText:function(O,V){try{var ca=new RegExp("[^\x3cstrong\x3e\x26nbsp;]"+V.replace(/(\||\$|\^|\(|\)|\[|\]|\{|\}|\/|\.|\+|\*|\?|\?)/g,"\\$1")+"[^\x26nbsp;\x3c/strong\x3e]","g");O=(" "+O+" ").replace(ca,"\x3cstrong\x3e\x26nbsp;"+V+"\x26nbsp;\x3c/strong\x3e");O=O.trim()}catch(ka){}return O},_clearStopGraphics:function(){if(this.stopGraphics&&
this.stopGraphics.length)for(var O=0;O<this.stopGraphics.length;O++)this._stopLayer.remove(this.stopGraphics[O]),this._stopLayer.remove(this.textGraphics[O]);this.set("stopGraphics",[]);this.set("textGraphics",[])},_updateMapTimeExtent:function(){if(this.map){var O=this.directions&&this.directions.features[0]&&this.directions.features[0].attributes||{},V=(new Date).getTime();V="none"==this.startTime?V:O.arriveTimeUTC||V;this._useTrafficItemNode.title="none"!==this.startTime&&O.arriveTimeUTC?D.widgets.directions.trafficLabelDepartAt+
": "+this._toSpatiallyLocalTimeString(O.arriveTimeUTC,O.ETA):"";this._myTimeExtentUpdate=!0;O=new Date(V);this.map.setTimeExtent(new Y(O,O))}},_restoreMapTimeExtent:function(){this.map&&(this._myTimeExtentUpdate=!0,this.map.setTimeExtent(this._externalTimeExtent))},_clearRouteGraphics:function(){for(var O=this.displayedRouteGraphics,V=this.displayedManeuverPointGraphics,ca=this._routeLayer,ka=this._waypointsEventLayer,ha=0,na=0,qa=this._incrementalSolveStopRange?this._incrementalSolveStopRange:{start:0,
end:this.stops?this.stops.length:-1};O&&na<O.length;){if(O[na]._associatedStop)for(var sa=0;sa<this.stops.length;sa++)if(this.stops[sa].feature===O[na]._associatedStop){ha=sa;break}ha>=qa.start&&ha<qa.end||qa.start>=qa.end&&(ha>=qa.start||ha<qa.end)?(ca.remove(O[na]),O.splice(na,1)):na++}ca.remove(this._incrementalRouteSegment);this.set("displayedRouteGraphics",O?O:[]);V&&V.length&&m.forEach(V,function(ta){ka.remove(ta)});this.set("displayedManeuverPointGraphics",[]);this._waypointsEventLayer.clear();
this.unhighlightSegment(!0)},_clearInfoWindow:function(){var O=this.get("map").infoWindow;O&&(O.hide(),O.clearFeatures())},_clearDisplayBeforeSolve:function(){this._toggleSaveMenu(!1);this._clearInfoWindow();this._clearResultsHTML()},_clearDisplayAfterSolve:function(){this._clearStopGraphics();this._clearRouteGraphics();this._clearBarriersGraphics();this.clearMessages()},_getLetter:function(O){var V=this.alphabet,ca="",ka=function(qa){var sa="";"0123456789"===V||"1234567890"===V?sa=String(qa+1):(qa=
qa||0,qa>=V.length&&(sa=ka(Math.floor(qa/V.length)-1),qa%=V.length),sa+=V[qa]);return sa},ha=O instanceof P?r.hitch(this,function(){for(var qa=this.get("returnToStart")?0:-1,sa=0;sa<this.stops.length;sa++)if(this.stops[sa].feature===O){qa=sa;break}return qa})():O;if(-1<ha&&V&&V.length){V instanceof Array&&(V=V.toString().replace(/,/g,""));ca=-1;for(var na=0;na<=ha;na++)ca+=this._isStopAWaypoint(this.stops[na])?0:1;ca=ka(ca)}return ca},_solveAndZoom:function(O){if(this.autoSolve)return this._getDirections().then(r.hitch(this,
function(){O||this.zoomToFullRoute()}));var V=new F;V.resolve();return V.promise},_setupEvents:function(){this._onEvents.push(t(this.domNode,"[data-blur-on-click]:click",function(){this.blur()}));this._onEvents.push(t(this._dndNode,"[data-reverse-stops]:click, [data-reverse-stops]:keydown",r.hitch(this,function(ha){ha&&("click"===ha.type||"keydown"===ha.type&&ha.keyCode===l.ENTER)&&this.modifyStopSequence()})));this._onEvents.push(t(this._printButton,"click, keydown",r.hitch(this,function(ha){ha&&
("click"===ha.type||"keydown"===ha.type&&ha.keyCode===l.ENTER)&&this._printDirections()})));this._onEvents.push(t(this._resultsNode,"[data-full-route]:click, [data-full-route]:keydown",r.hitch(this,function(ha){ha&&("click"===ha.type||"keydown"===ha.type&&ha.keyCode===l.ENTER)&&this.zoomToFullRoute()})));this._onEvents.push(t(this._dndNode,"[data-remove]:click, [data-remove]:keydown",r.hitch(this,function(ha){if(ha&&("click"===ha.type||"keydown"===ha.type&&ha.keyCode===l.ENTER)){var na=E("[data-remove]",
this._dndNode);ha=m.indexOf(na,ha.target);this.removeStop(ha)}})));this._onEvents.push(t(this._dndNode,"[data-center-at]:click, [data-center-at]:keydown",r.hitch(this,function(ha){if(ha&&("click"===ha.type||"keydown"===ha.type&&ha.keyCode===l.ENTER)){var na=E("[data-center-at]",this._dndNode);ha=m.indexOf(na,ha.target);this.stops[ha]&&this.stops[ha].feature&&this.stops[ha].feature.geometry&&this.map.centerAndZoom(this.stops[ha].feature.geometry)}})));this._onEvents.push(t(this.map,"zoom-end",r.hitch(this,
function(){var ha=this._segmentGraphics;ha&&ha[0]&&void 0!==ha[0].attributes._index&&this.highlightSegment(ha[0].attributes._index,!0)})));this._onEvents.push(t(this._dnd,"Drop",r.hitch(this,function(){this._dnd.sync();this.set("optimalRoute",!1);var ha,na=!1,qa=[],sa=this._dnd.getAllNodes();for(ha=0;ha<this.geocoders.length;ha++){var ta=m.indexOf(sa,this.geocoders[ha]._tr);if(-1<ta&&ha!==ta&&ha!==ta-1){for(;0<ta&&this._isStopAWaypoint(this.stops[ta]);)ta--;na=!0;break}}na&&(qa=this._markWPsForRemovalAfterUserChangedStopSequence(ha,
ta));this._sortGeocoders();this.setListIcons();this._removeSomeWaypoints(qa);this.stops[ta].name&&this.getDirections()})));this._onEvents.push(t(this._dnd,"DndStart",r.hitch(this,function(){var ha=E("body")[0];A.add(ha,this._css.dndDragBodyClass);this._removeLocateButtonVisibilityEvents()})));this._onEvents.push(t(this._dnd,"DndDrop, DndCancel",r.hitch(this,function(){var ha=E("body")[0];A.remove(ha,this._css.dndDragBodyClass);this._setLocateButtonVisibilityEvents()})));var O=this._handle,V=r.hitch(this,
function(ha){var na=r.hitch(this,function(sa,ta,xa,za,Da){var Ca=O._isShown();O.setGeometry(sa);O._tooltip.style.left=ha.screenPoint.x+"px";O._tooltip.style.top=ha.screenPoint.y+"px";!Ca||O._index===xa&&O.attributes.isWaypoint===za||(O._remove(),Ca=!1);O.setSymbol(ta);O._index=xa;O._isStopIcon=O._index===Math.floor(O._index);O.attributes.isWaypoint=za;O._isStopIcon&&(O.attributes.address=this.stopGraphics[xa].attributes.address,O.setInfoTemplate(this.stopGraphics[xa].infoTemplate));if(this.canModifyWaypoints||
O._isStopIcon)Ca||(this._stopLayer.add(O),(sa=O.getDojoShape())&&sa[za?"moveToBack":"moveToFront"].call(sa)),this.editToolbar.activate(Ea.MOVE,O);za=za?O._isStopIcon?D.widgets.directions.dragWaypoint:this.canModifyWaypoints?D.widgets.directions.dragRoute:"":D.widgets.directions.dragStop;O._showTooltip(Da||za)});this.unhighlightSegment();if(this.mapClickActive&&this.dragging&&!this._solveInProgress&&!this._moveInProgress&&!O._solveTimeout)if(clearTimeout(O._removeTimeout),(ha.graphic._isStopIcon||
ha.graphic._isStopLabel)&&!ha.graphic.attributes.isWaypoint&&this.canModifyStops||ha.graphic._isStopIcon&&ha.graphic.attributes.isWaypoint&&this.canModifyWaypoints){var qa=ha.graphic._isStopLabel?this.stopGraphics[ha.graphic._index]:ha.graphic;na(qa.geometry,this._getStopSymbol(this.stops[qa._index],!0),qa._index,!0===qa.attributes.isWaypoint);this._stopLayer.remove(this.stopGraphics[qa._index]);this._stopLayer.remove(this.textGraphics[qa._index])}else if(ha.graphic._isSnapFeature||ha.graphic._isHandle&&
!ha.graphic._isStopIcon)this._snappingManager||(this._snappingManager=this.map.snappingManager),this._snappingManager.getSnappingPoint(ha.screenPoint).then(r.hitch(this,function(sa){if(!this.maxStopsReached&&!this._moveInProgress&&sa){for(var ta=this.displayedManeuverPointGraphics,xa=null,za=0;za<ta.length;za++)if(ta[za].geometry.x===sa.x&&ta[za].geometry.y===sa.y){xa=ta[za]._directionsFeature;ta=m.indexOf(this.directions.features,xa);-1<ta&&this.highlightSegment(ta);break}na(sa,ha.graphic._isHandle?
O.symbol:this.waypointSymbol,ha.graphic._isHandle?O._index:ha.graphic._nextStopIndex,ha.graphic._isHandle?O.attributes.isWaypoint:!0,xa)}}))}),ca=r.hitch(this,function(){clearTimeout(O._removeTimeout);O._removeTimeout=setTimeout(O._remove,100);this.unhighlightSegment()}),ka=r.hitch(this,function(ha){if(this.barrierToolActive){ha=ha.graphic;var na=this.routeParams,qa=na.barriers?m.indexOf(na.barriers.features,ha):-1,sa=na.polygonBarriers?m.indexOf(na.polygonBarriers.features,ha):-1,ta=na.polylineBarriers?
m.indexOf(na.polylineBarriers.features,ha):-1;-1<qa&&na.barriers.features.splice(qa,1);-1<sa&&na.polygonBarriers.features.splice(sa,1);-1<ta&&na.polylineBarriers.features.splice(ta,1);this._barriersLayer.remove(ha);this._polygonBarriersLayer.remove(ha);this._polylineBarriersLayer.remove(ha);this._clearStopsStatusAttr();this.getDirections(!0)}});this._onEvents.push(this._waypointsEventLayer.on("mouse-move",V));this._onEvents.push(this._waypointsEventLayer.on("mouse-out",ca));this._onEvents.push(this._stopLayer.on("mouse-move",
V));this._onEvents.push(this._stopLayer.on("mouse-out",ca));this._onEvents.push(this._barriersLayer.on("click",ka));this._onEvents.push(this._polylineBarriersLayer.on("click",ka));this._onEvents.push(this._polygonBarriersLayer.on("click",ka));this._editToolbarEvents();this._watchEvents.push(this.watch("theme",this._updateThemeWatch));this._watchEvents.push(this.watch("canModifyStops",this._updateCanModifyStops));this._watchEvents.push(this.watch("canModifyWaypoints",this._updateCanAddWaypoints));
this._watchEvents.push(this.watch("showReturnToStartOption",this._optionsMenu));this._watchEvents.push(this.watch("showOptimalRouteOption",this._optionsMenu));this._watchEvents.push(this.watch("returnToStart",this._setMenuNodeValues));this._watchEvents.push(this.watch("optimalRoute",this._setMenuNodeValues));this._watchEvents.push(this.watch("startTime",this._setStartTime));this._watchEvents.push(this.watch("traffic",this._setMenuNodeValues));this._watchEvents.push(this.watch("trafficLayer",this._trafficLayerUpdate));
this._watchEvents.push(this.watch("routeTaskUrl",r.hitch(this,function(){this._createRouteTask();this._setTrafficOptions()})));this._watchEvents.push(this.watch("printTaskUrl",r.hitch(this,function(){this._createPrintTask()})));this._watchEvents.push(this.watch("geometryTaskUrl",r.hitch(this,function(){this._createGeometryTask()})));this._watchEvents.push(this.watch("routeParams",r.hitch(this,function(){this._createRouteParams();this._setDefaultUnits()})));this._watchEvents.push(this.watch("searchOptions",
r.hitch(this,function(){this._setSearchOptions();this._createGlobalGeocoder();var ha=this.get("searchOptions").sources;if(ha)for(var na=0;na<this.geocoders.length;na++)this.geocoders[na].set("sources",ha)})));this._watchEvents.push(this.watch("showReverseStopsButton",this.setListIcons));this._watchEvents.push(this.watch("editToolbar",this._editToolbarEvents));this._watchEvents.push(this.watch("showTravelModesOption",this._showTravelModesOption));this._watchEvents.push(this.watch("showMilesKilometersOption",
this._showMilesKilometersOption));this._watchEvents.push(this.watch("showClearButton",this._showClearButton));this._watchEvents.push(this.watch("directionsLengthUnits",this.setDirectionsLengthUnits));this._watchEvents.push(this.watch("directionsLanguage",this.setDirectionsLanguage));this._watchEvents.push(this.watch("mapClickActive",this._activate));this._watchEvents.push(this.watch("barrierToolActive",this._activateBarrierTool));this._watchEvents.push(this.watch("showActivateButton",this._showActivateButton));
this._watchEvents.push(this.watch("showBarriersButton",this._showBarriersButton));this._watchEvents.push(this.watch("showPrintPage",function(){H.set(this._printButton,"display",this.showPrintPage?"inline-block":"none")}));this._watchEvents.push(this.watch("showSaveButton",function(){H.set(this._saveMenuButton,"display",this.showSaveButton&&this.owningSystemUrl?"inline-block":"none")}))},_editToolbarEvents:function(){var O=r.hitch(this,function(ca){var ka="";if((ca=ca.routeResults?ca.routeResults[0]:
null)&&ca.route){ca=ca.route.attributes;var ha=this.routeParams.travelMode;if(ha){ka+="\x3cb\x3e"+ha.name+"\x3c/b\x3e "+D.widgets.directions.toNearbyStops+": ";var na=void 0!==ca["Total_"+ha.timeAttributeName]?this._formatTime(ca["Total_"+ha.timeAttributeName],!1,(this._getCostAttribute(ha.timeAttributeName)||{}).units):"";ka+=(void 0!==ca["Total_"+ha.distanceAttributeName]?this._formatDistance(ca["Total_"+ha.distanceAttributeName],!0,(this._getCostAttribute(ha.distanceAttributeName)||{}).units):
"")+(na?" \x26middot; "+na:"")}else ka=this._formatArbitraryCostsForRouteTooltip(ca)}this._handle._showTooltip(ka)}),V=r.hitch(this,function(ca,ka){var ha=new F,na=this._handle,qa=this.map.toScreen(na._origPoint).offset(ca.transform.dx+na.symbol.xoffset,ca.transform.dy+na.symbol.yoffset);ca.origMapPoint||(ca.origMapPoint=this.map.toMap(qa));H.set(na._tooltip,"left",qa.x+"px");H.set(na._tooltip,"top",qa.y+"px");clearTimeout(na._solveTimeout);if(this._solveInProgress||!this._requestQueueTail.isFulfilled())na._solveTimeout=
setTimeout(function(){V(ca,ka).always(ha.resolve)},100);else if(na._isStopIcon){qa=ca.graphic._index;var sa=this.stops[qa];(sa=sa?{name:sa.name,extent:sa.extent,feature:new P(sa.feature.toJson())}:null)?(sa.feature.setGeometry(ca.origMapPoint),this._modifiedWaypointIndex=this._isStopAWaypoint(this.stops[qa])?qa:null,this._incrementalSolveStopRange={start:this.returnToStart?(this.stops.length+qa-1)%this.stops.length:Math.max(0,qa-1),end:this.returnToStart?(qa+1)%this.stops.length:Math.min(this.stops.length-
1,qa+1)},this.updateStop(sa,qa,ka).always(r.hitch(this,function(ta){na._solveTimeout=null;ta.routeResults&&O(ta);ha.resolve()}))):ha.resolve()}else ha.resolve();return ha.promise});this._onEvents.push(t(this.editToolbar,"graphic-click",r.hitch(this,function(ca){if(ca.graphic.attributes.isWaypoint)!ca.graphic._isStopIcon||this._moveInProgress||this._solveInProgress||(this._handle._remove(),this._moveInProgress=!0,this.removeStop(ca.graphic._index,!0).always(r.hitch(this,function(){this._moveInProgress=
!1})));else{var ka=this.get("map").infoWindow;ka&&(ka.setFeatures([ca.graphic]),ka.show(ca.graphic.geometry))}})));this._onEvents.push(t(this.editToolbar,"graphic-move-start",r.hitch(this,function(ca){this._blurGeocoders();this._moveInProgress=!0;this._removeEmptyStops();this.routeParams.returnDirections=!1;this.routeParams.returnRoutes=!0;ca=ca.graphic;ca._origPoint=new Q(ca.geometry.toJson());ca._maxDeviation=0;ca._solveHasHappened=!1;this.map.disableMapNavigation()})));this._onEvents.push(t(this.editToolbar,
"graphic-move-stop",r.hitch(this,function(ca){this.map.enableMapNavigation();this.routeParams.returnDirections=!0;this.routeParams.returnRoutes=!1;if(this._handle._isStopIcon)if(this._handle._solveHasHappened)if(this._handle.attributes.isWaypoint)V(ca,!0).always(r.hitch(this,function(){this._moveInProgress=!1;this._handle._isStopIcon=!0;this._handle._remove();this._showLoadingSpinner()}));else{clearTimeout(this._handle._solveTimeout);this._handle._solveTimeout=null;var ka=this.stops[ca.graphic._index],
ha=(ka&&ka.feature&&ka.feature.attributes&&ka.feature.attributes.Name)===this._userDefinedStopName,na=ka&&ka.name;this._reverseGeocode(new P(ca.graphic.toJson())).then(r.hitch(this,function(qa){ha&&(qa.name=na,qa.feature.attributes.Name=this._userDefinedStopName);this._setReverseGeocode(qa,qa.feature.geometry,ca.graphic._index).always(r.hitch(this,function(){this._moveInProgress=!1;this._handle._remove();this._showLoadingSpinner()}))}))}else this._moveInProgress=!1;else this._moveInProgress=!1})));
this._onEvents.push(t(this.editToolbar,"graphic-move",r.hitch(this,function(ca){var ka=this._handle,ha=ca.transform;ha.dx&&ha.dy&&(ca.graphic._maxDeviation=Math.max(ka._maxDeviation,Math.sqrt(ha.dx*ha.dx+ha.dy*ha.dy)));10<ka._maxDeviation&&(ka._solveHasHappened=!0,ca.graphic===ka&&ka.attributes.isWaypoint&&!ka._isStopIcon?(this.set("optimalRoute",!1),ka._index+=.5,ka._isStopIcon=!0,ca.graphic._stopIndex=ka._index,this._incrementalSolveStopRange={start:this.returnToStart?(this.stops.length+ka._index-
1)%this.stops.length:Math.max(0,ka._index-1),end:this.returnToStart?(ka._index+1)%(this.stops.length+1):Math.min(this.stops.length,ka._index+1)},this.addStop({name:this._waypointName,feature:new P(ka.geometry,ka.symbol,{isWaypoint:!0,CurbApproach:3})},ca.graphic._stopIndex)):((ka=ca.graphic.getDojoShape())&&ka.moveToFront(),V(ca)))})))},_isStopAWaypoint:function(O){return O&&O.feature&&O.feature.attributes&&O.feature.attributes.isWaypoint},_getStopCount:function(){var O=0,V;for(V=0;V<this.stops.length;V++)O+=
!this._isStopAWaypoint(this.stops[V])&&this.stops[V].name?1:0;return O},_getWaypointCount:function(){var O=0,V;for(V=0;V<this.stops.length;V++)O+=this._isStopAWaypoint(this.stops[V])?1:0;return O},_decorateUngeocodedStop:function(O){var V=new F,ca=function(ha,na){V.resolve({name:void 0===ha?D.widgets.directions.unlocatedStop:ha.toFixed(6)+" "+na.toFixed(6),feature:O})};if(O.geometry)if(O.geometry.spatialReference&&4326!==O.geometry.spatialReference.wkid)if(this.map&&this.map.spatialReference&&this.map.spatialReference.isWebMercator()){var ka=
R.xyToLngLat(O.geometry.x,O.geometry.y);ca(ka[0],ka[1])}else this._geometryService?(ka=new Za,ka.outSR=new Z(4326),ka.geometries=[O.geometry],this._geometryService.project(ka).then(r.hitch(this,function(ha){ha&&ha.length?ca(ha[0].x,ha[0].y):ca(O.geometry.x,O.geometry.y)}),r.hitch(this,function(){ca()}))):ca(O.geometry.x,O.geometry.y);else ca(O.geometry.x,O.geometry.y);else ca();return V.promise},_trafficLayerUpdate:function(O,V,ca){O=this.get("map");V&&this._trafficLayerAdded&&(O.removeLayer(V),this._trafficLayerAdded=
!1);ca&&this.get("traffic")&&!this._trafficLayerAdded&&(O.addLayer(ca),ca.show(),this._trafficLayerAdded=!0)},_routeTaskError:function(O){var V=D.widgets.directions.error.routeTask,ca=O.details,ka=function(ha){return(res=ha.match(/(\d+)/))?": "+res[0]:"."};ca&&1===ca.length&&("The distance between any inputs must be less than 50 miles (80 kilometers) when walking."===ca[0]?V=D.widgets.directions.error.maxWalkingDistance:"Driving a truck is currently not supported outside of North America and Central America."===
ca[0]?V=D.widgets.directions.error.nonNAmTruckingMode:0===ca[0].indexOf("The number of input locations loaded into Barriers")?V=D.widgets.directions.error.tooManyBarriers+ka(ca[0]):0===ca[0].indexOf("The number of input locations loaded into PolygonBarriers")?V=D.widgets.directions.error.tooManyPolygonBarriers+ka(ca[0]):0===ca[0].indexOf("The number of input locations loaded into PolylineBarriers")&&(V=D.widgets.directions.error.tooManyPolylineBarriers+ka(ca[0])));this._showMessage(V);this.onDirectionsFinish(O)},
_showMessage:function(O,V){var ca="";this.messages.push({msg:O,error:!V});if(this.messages.length){ca+="\x3cul\x3e";for(var ka=0;ka<this.messages.length;ka++)ca+='\x3cli class\x3d"'+(this.messages[ka].error?this._css.routesErrorClass:this._css.routesInfoClass)+'"\x3e'+this.messages[ka].msg+"\x3c/li\x3e";ca+="\x3c/ul\x3e"}this._msgNode&&(this._msgNode.innerHTML=ca);if(!V)this.onError(O)},_isTimeUnits:function(O){return"milliseconds"===O||"esriNAUSeconds"===O||"esriNAUMinutes"===O||"esriNAUHours"===
O||"esriNAUDays"===O},_getImpedanceAttribute:function(){return this._getCostAttribute(this.routeParams&&this.routeParams.travelMode&&this.routeParams.travelMode.impedanceAttributeName||this.routeParams.impedanceAttribute||this.serviceDescription.impedance)},_getDirectionsTimeAttribute:function(){return this._getCostAttribute(this.routeParams&&this.routeParams.travelMode&&this.routeParams.travelMode.timeAttributeName||this.routeParams.directionsTimeAttribute||this.serviceDescription.directionsTimeAttribute)},
_getTimeNeutralAttribute:function(){var O=(this._getDirectionsTimeAttribute()||{}).timeNeutralAttributeName;return this._getCostAttribute(O)},_getCostAttribute:function(O){for(var V=this.serviceDescription&&this.serviceDescription.networkDataset.networkAttributes||[],ca,ka=0;ka<V.length;ka++)if(V[ka].name===O&&"esriNAUTCost"===V[ka].usageType){ca=V[ka];break}return ca},_convertCostValue:function(O,V,ca){var ka=this._isTimeUnits(V),ha=this._isTimeUnits(ca);V=ka?this._toMinutes(O,V):this._toMeters(O,
V);return ka===ha?ha?this._fromMinutes(V,ca):this._fromMeters(V,ca):O},_toMinutes:function(O,V,ca){O=O||0;switch(V){case "milliseconds":O/=Math.pow(6E4,ca?-1:1);break;case "esriNAUSeconds":O/=Math.pow(60,ca?-1:1);break;case "esriNAUHours":O*=Math.pow(60,ca?-1:1);break;case "esriNAUDays":O*=Math.pow(1440,ca?-1:1)}return O},_fromMinutes:function(O,V){return this._toMinutes(O,V,!0)},_toMeters:function(O,V,ca){O=O||0;switch((V||"").replace("esriNAU","esri")){case "esriInches":O*=Math.pow(.0254,ca?-1:
1);break;case "esriFeet":O*=Math.pow(.3048,ca?-1:1);break;case "esriYards":O*=Math.pow(.9144,ca?-1:1);break;case "esriMiles":O*=Math.pow(1609.344,ca?-1:1);break;case "esriNauticalMiles":O*=Math.pow(1851.995396854,ca?-1:1);break;case "esriMillimeters":O/=Math.pow(1E3,ca?-1:1);break;case "esriCentimeters":O/=Math.pow(100,ca?-1:1);break;case "esriKilometers":O*=Math.pow(1E3,ca?-1:1);break;case "esriDecimeters":O/=Math.pow(10,ca?-1:1)}return O},_fromMeters:function(O,V){return this._toMeters(O,V,!0)},
_createRouteTask:function(){var O=new F;this.set("routeTask",new wa(this.get("routeTaskUrl")));this._createRouteParams();this.routeTask.getServiceDescription(this.travelModesServiceUrl,this.doNotFetchTravelModesFromOwningSystem).then(r.hitch(this,function(V){V.networkDataset?(this.set("serviceDescription",V),this.set("maxStops",parseInt(this.userOptions.maxStops||V.serviceLimits&&V.serviceLimits.Route_MaxStops||this.defaults.maxStops)),this.defaults.portalUrl?(this.owningSystemUrl=this.defaults.portalUrl,
O.resolve()):this.routeTask.getOwningSystemUrl().then(r.hitch(this,function(ca){this.owningSystemUrl=ca;O.resolve()}),O.reject)):(this._showMessage(D.widgets.directions.error.cantFindRouteServiceDescription),O.reject(Error(D.widgets.directions.error.cantFindRouteServiceDescription)))}),r.hitch(this,function(){this._showMessage(D.widgets.directions.error.cantFindRouteServiceDescription);O.reject(Error(D.widgets.directions.error.cantFindRouteServiceDescription));this.mapClickActive=!1;this._activate()}));
return O.promise},_createSearchSourceDDL:function(){if(this._globalGeocoder&&this._globalGeocoder.sources&&1<this._globalGeocoder.sources.length){var O=r.hitch(this,function(ka){this._searchSourceSelector.domNode.blur();this._globalGeocoder.set("activeSourceIndex",ka);for(var ha=0;ha<this.geocoders.length;ha++)this.geocoders[ha].set("activeSourceIndex",ka);this._truncateSearchSourceIfNeeded()});if(!this._searchSourceSelector){for(var V=[{value:"all",label:D.widgets.Search.main.all,selected:!0}],ca=
0;ca<this._globalGeocoder.sources.length;ca++)V.push({value:String(ca),label:this._globalGeocoder.sources[ca].name});this._searchSourceSelector=new b({className:"esriSearchSourcesDDL",style:"width:100%;",options:V},this._searchSourceSelectorContainer);this._searchSourceSelector.startup();this._searchSourceSelector.on("change",O);this._searchSourceSelector.domNode.style.width=""}O("all")}else 2>this._globalGeocoder.sources.length&&(this._searchSourceContainerNode.style.display="none")},_createTravelModesDDL:function(){this._travelModeSelector||
(this._travelModeSelector=new b({className:"esriTravelModesDDL",style:"width:100%;"},this._travelModeSelectorContainer),this._travelModeSelector.startup(),this._travelModeSelector._interractive=!0,this._travelModeSelector.on("change",r.hitch(this,function(O){this._travelModeSelector._interractive?this._enqueue(function(){return this._setTravelMode(O).always(r.hitch(this,function(){this._travelModeSelector._interractive=!0}))}):this._travelModeSelector._interractive=!0})))},_setupTravelModes:function(){var O=
this.get("serviceDescription"),V=O.supportedTravelModes,ca=new F;if(V&&V.length&&this._travelModeSelector){for(var ka=V[0].name,ha=[],na=0;na<V.length;na++){for(var qa="AUTOMOBILE"===V[na].type?"Driving":"TRUCK"===V[na].type?"Trucking":"WALK"===V[na].type?"Walking":"Other",sa="",ta=O.networkDataset.networkAttributes,xa=0;xa<ta.length;xa++){var za=ta[xa];if(za.name===V[na].impedanceAttributeName){if("esriNAUCentimeters"===za.units||"esriNAUDecimalDegrees"===za.units||"esriNAUDecimeters"===za.units||
"esriNAUFeet"===za.units||"esriNAUInches"===za.units||"esriNAUKilometers"===za.units||"esriNAUMeters"===za.units||"esriNAUMiles"===za.units||"esriNAUMillimeters"===za.units||"esriNAUNauticalMiles"===za.units||"esriNAUYards"===za.units)sa="Distance";else if("esriNAUDays"===za.units||"esriNAUHours"===za.units||"esriNAUMinutes"===za.units||"esriNAUSeconds"===za.units)sa="Time";break}}ha.push({id:V[na].name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+qa+sa+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName" title\x3d"'+
V[na].description+'"\x3e'+V[na].name+"\x3c/div\x3e"});!O.defaultTravelMode||V[na].id!==O.defaultTravelMode&&V[na].itemId!==O.defaultTravelMode||(ka=V[na].name)}this._showTravelModesOption();this._travelModeSelector.setStore(new f({objectStore:new c({data:ha})}));this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(ka);this._setTravelMode(ka).always(ca.resolve)}else this._checkStartTimeUIAvailability(),this.set("showTravelModesOption",!1),ca.resolve();return ca.promise},_createPrintTask:function(){this._printService=
(this.printTaskUrl=this._usingAGOL()?this.printTaskUrl:this.defaults.printTaskUrl)?new Aa(this.printTaskUrl,{async:!1}):null;var O=new Ba;O.exportOptions={width:670,height:750,dpi:96};O.format="PNG32";O.layout="MAP_ONLY";O.preserveScale=!1;O.showAttribution=!1;var V=new Ga;V.map=this.map;V.outSpatialReference=this.map.spatialReference;V.template=O;this._printParams=V},_createGeometryTask:function(){this._geometryService=null;this._usingAGOL()?this._geometryService=new ya(this.geometryTaskUrl):this.geometryTaskUrl=
(this._geometryService=this.defaults.geometryTaskUrl?new ya(this.defaults.geometryTaskUrl):Ta.defaults.geometryService)?this._geometryService.url:null},_showTravelModesOption:function(){var O=this.get("serviceDescription");H.set(this._travelModeContainerNode,"display",this.showTravelModesOption&&O&&O.supportedTravelModes&&O.supportedTravelModes.length&&!this.doNotFetchTravelModesFromOwningSystem?"block":"none")},_showMilesKilometersOption:function(){H.set(this._agolDistanceUnitsNode,"display",this.showMilesKilometersOption?
"block":"none")},_showClearButton:function(){H.set(this._clearDirectionsButtonNode,"display",this.showClearButton?"inline-block":"none")},_showActivateButton:function(){H.set(this._activateButtonNode,"display",this.showActivateButton?"inline-block":"none");this.showActivateButton||this.deactivate()},_showBarriersButton:function(){H.set(this._lineBarrierButtonNode,"display",this.showBarriersButton?"inline-block":"none");this.showBarriersButton||this.deactivateBarrierTool()},_createRouteParams:function(){var O=
{returnDirections:!0,returnRoutes:!1,outputLines:"esriNAOutputLineTrueShape",preserveFirstStop:!0,preserveLastStop:!0,directionsOutputType:"complete",stops:new ra,ignoreInvalidLocations:!0,doNotLocateOnRestrictedElements:!0,outSpatialReference:this.get("map").spatialReference};this.get("routeParams")||(this.routeParams={});var V=new va;this.routeParams=r.mixin(V,{outputGeometryPrecision:0,outputGeometryPrecisionUnits:"esriMeters",restrictUTurns:"esriNFSBAtDeadEndsOnly"},this.get("routeParams"),O)},
_markWPsForRemovalAfterUserChangedStopSequence:function(O,V){for(var ca=O-1,ka=[];0<=ca&&this._isStopAWaypoint(this.stops[ca]);)ka.push(this.stops[ca]),ca--;for(ca=O+1;ca<this.stops.length&&this._isStopAWaypoint(this.stops[ca]);)ka.push(this.stops[ca]),ca++;if(V>O)for(ca=V+1;ca<this.stops.length&&this._isStopAWaypoint(this.stops[ca]);)ka.push(this.stops[ca]),ca++;else if(void 0!==V)for(ca=V-1;0<=ca&&this._isStopAWaypoint(this.stops[ca]);)ka.push(this.stops[ca]),ca--;else if(this.returnToStart&&0===
O)for(ca=this.stops.length-1;0<=ca&&this._isStopAWaypoint(this.stops[ca]);)ka.push(this.stops[ca]),ca--;return ka},_removeSomeWaypoints:function(O){for(var V=new F,ca=[],ka=0;ka<O.length;ka++){var ha=m.indexOf(this.stops,O[ka]);-1<ha&&ca.push(this._removeStop(ha,!0,!0))}S(ca).always(V.resolve);return V.promise},_modifyStopSequence:function(O,V){var ca=this._dnd.getAllNodes(),ka=new F,ha,na=[];if(ca.length)if(this._removeLocateButtonVisibilityEvents(),arguments.length&&void 0!==O)if(0<=O&&0<=V&&O<
this.stops.length&&V<this.stops.length&&O!==V){ca=this._markWPsForRemovalAfterUserChangedStopSequence(O,V);var qa=this.stops.splice(O,1);this.stops.splice(V,0,qa[0]);for(ha=0;ha<this.stops.length;ha++)na.push(this._updateStop(this.stops[ha],ha));na.push(this._removeSomeWaypoints(ca));S(na).always(r.hitch(this,function(){this._solveAndZoom().always(ka.resolve)}))}else ka.reject("Invalid From and To values.");else{for(ha=0;ha<this.stops.length;)this._isStopAWaypoint(this.stops[ha])?na.push(this._removeStop(ha,
!0,!0)):ha++;S(na).always(r.hitch(this,function(){na=[];this.stops.reverse();for(ha=0;ha<this.stops.length;ha++)na.push(this._updateStop(this.stops[ha],ha));S(na).always(r.hitch(this,function(){this._solveAndZoom().always(ka.resolve)}))}))}else ka.resolve();return ka.promise},_setMenuNodeValues:function(O){"traffic"!==O&&this._clearDisplayBeforeSolve();O=this.get("optimalRoute");this._findOptimalOrderNode&&z.set(this._findOptimalOrderNode,"checked",O);this._returnToStartNode&&(O=this.returnToStart&&
!this.maxStopsReached&&this.stops[0]&&(!this.stops[0].feature||this._isStopLocated(this.stops[0])),z.set(this._returnToStartNode,"checked",O),this.set("returnToStart",O),this.maxStopsReached&&this.returnToStart&&this._showMessage(D.widgets.directions.error.maximumStops));if(!this.returnToStart&&!this._incrementalSolveStopRange&&this.directions)for(this._incrementalSolveStopRange={start:this.stops.length-1,end:this.stops.length},this._clearRouteGraphics(),this._incrementalSolveStopRange=null,O=this.stops.length;0<
O--&&this._isStopAWaypoint(this.stops[O]);)this._removeSomeWaypoints([this.stops[O]]);this._useTrafficNode&&(z.set(this._useTrafficNode,"checked",this.traffic),this.traffic?(this._updateMapTimeExtent(),this._addTrafficLayer()):(this._removeTrafficLayer(),this._restoreMapTimeExtent()));switch(this.get("directionsLengthUnits")){case X.KILOMETERS:z.set(this._useKilometersNode,"checked",!0);z.set(this._useMilesNode,"checked",!1);break;case X.MILES:z.set(this._useKilometersNode,"checked",!1),z.set(this._useMilesNode,
"checked",!0)}H.set(this._printButton,"display",this.showPrintPage?"inline-block":"none");H.set(this._saveMenuButton,"display",this.showSaveButton&&this.owningSystemUrl?"inline-block":"none");this._showMilesKilometersOption();this._showClearButton()},_optionsMenu:function(){this._useTrafficItemNode&&H.set(this._useTrafficItemNode,"display",this.get("showTrafficOption")?"block":"none");this._returnToStartItemNode&&H.set(this._returnToStartItemNode,"display",this.get("showReturnToStartOption")?"block":
"none");this._findOptimalOrderItemNode&&H.set(this._findOptimalOrderItemNode,"display",this.get("showOptimalRouteOption")&&3<this._getStopCount()?"block":"none");this.stops.length>=this.get("minStops")?A.add(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass):(A.remove(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass),this._optionsMenuNode&&"block"===H.get(this._optionsMenuNode,"display")&&this._toggleOptionsMenu())},_stopsRemovable:function(){2<this._dnd.getAllNodes().length-
this._getWaypointCount()?A.add(this._widgetContainer,this._css.stopsRemovableClass):A.remove(this._widgetContainer,this._css.stopsRemovableClass)},_checkMaxStops:function(){this.set("maxStopsReached",this._getStopCount()+this._getWaypointCount()+(this.returnToStart?1:0)>=this.maxStops);this._showAddDestination()},_updateThemeWatch:function(O,V,ca){A.remove(this.domNode,V);A.add(this.domNode,ca)},_toggleOptionsMenu:function(){"block"===H.get(this._optionsMenuNode,"display")?(H.set(this._optionsMenuNode,
"display","none"),A.remove(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=D.widgets.directions.showOptions):(H.set(this._optionsMenuNode,"display","block"),A.add(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=D.widgets.directions.hideOptions)},_toggleSaveMenu:function(O){"block"===H.get(this._saveMenuNode,"display")||!1===O?(H.set(this._saveMenuNode,"display","none"),A.remove(this._saveMenuButton,this._css.stopsPressedButtonClass)):
(this.clearMessages(),H.set(this._saveMenuNode,"display","block"),A.add(this._saveMenuButton,this._css.stopsPressedButtonClass),this._enableSharing().then(r.hitch(this,function(){this._outputLayer.setValue(this.routeLayer.title?this.routeLayer.title:this.directions&&this.directions.routeName);if(this.routeLayer.ownerFolder)for(var V=this._folderSelector.store.objectStore.data,ca=0;ca<V.length;ca++)if(V[ca].folderId===this.routeLayer.ownerFolder){this._folderSelector.getValue()!==V[ca].id&&(this._folderSelector._interractive=
!1,this._folderSelector.setValue(V[ca].id));break}this._enableButton(this._saveButton,this.routeLayer.isItemOwner||!this._userCanCreatePortalItem);this._outputLayer.set("disabled",!1)})))},_showToolbar:function(){A[this.stops.length<this.maxStops&&this.canModifyStops||this.canModifyWaypoints?"add":"remove"].call(N,this._widgetContainer,this._css.addStopsClass)},_showAddDestination:function(){this._showToolbar();this._addDestinationNode.style.display=this.stops.length<this.maxStops&&this.canModifyStops?
"inline":"none"},_showMapClickActiveButton:function(){this._showToolbar();this._activateButtonNode.style.display=this.canModifyStops||this.canModifyWaypoints?"inline-block":"none"},_getAbsoluteUrl:function(O){O=G.toUrl(O);return/^https?:/i.test(O)?O:/^\/\//i.test(O)?Ya+O:/^\//i.test(O)?Ya+"//"+window.location.host+O:O},_getManeuverImage:function(O){return O?"esriDMTStop"===O||"esriDMTDepart"===O?"":this._getAbsoluteUrl("./images/Directions/maneuvers/"+O+".png"):""},_loadPrintDirections:function(O){var V=
this.get("printTemplate"),ca=new F;this.directionsLengthUnits!==this.routeParams.directionsLengthUnits?this.getDirections().then(ca.resolve,ca.reject):ca.resolve();ca.then(r.hitch(this,function(){if(!V&&this.directions){var ka=this._getAbsoluteUrl("./css/Directions.css"),ha=this._getAbsoluteUrl("./css/DirectionsPrint.css"),na=this._getAbsoluteUrl("./images/Directions/print-logo.png");var qa=x.isBodyLtr()?"ltr":"rtl";V="";V+="\x3c!DOCTYPE HTML\x3e";V+='\x3chtml lang\x3d"en" class\x3d"'+this.get("theme")+
'" dir\x3d"'+qa+'"\x3e';V+="\x3chead\x3e";V+='\x3cmeta charset\x3d"utf-8"\x3e';V+='\x3cmeta http-equiv\x3d"X-UA-Compatible" content\x3d"IE\x3dEdge,chrome\x3d1"\x3e';V+="\x3ctitle\x3e"+this.get("directions").routeName+"\x3c/title\x3e";V+='\x3clink rel\x3d"stylesheet" media\x3d"screen" type\x3d"text/css" href\x3d"'+ka+'" /\x3e';V+='\x3clink rel\x3d"stylesheet" media\x3d"print" type\x3d"text/css" href\x3d"'+ha+'" /\x3e';V+="\x3c/head\x3e";V+='\x3cbody class\x3d"'+this._css.esriPrintPageClass+'"\x3e';
V+='\x3cdiv class\x3d"'+this._css.esriPrintBarClass+'"\x3e';V+='\x3cdiv class\x3d"'+this._css.esriCloseButtonClass+'" title\x3d"'+D.common.close+'" onclick\x3d"window.close();"\x3e'+D.common.close+"\x3c/div\x3e";V+='\x3cdiv id\x3d"printButton" class\x3d"'+this._css.esriPrintButtonClass+'" title\x3d"'+D.widgets.directions.print+'" onclick\x3d"window.print();"\x3e'+D.widgets.directions.print+"\x3c/div\x3e";V+="\x3c/div\x3e";V+='\x3cdiv class\x3d"'+this._css.esriPrintMainClass+'"\x3e';V+='\x3cdiv class\x3d"'+
this._css.esriPrintHeaderClass+'"\x3e';V+='\x3cimg class\x3d"'+this._css.esriPrintLogoClass+'" src\x3d"'+na+'" /\x3e';V+='\x3cdiv class\x3d"'+this._css.esriPrintNameClass+'"\x3e'+this.get("directions").routeName+"\x3c/div\x3e";V+=this._renderDirectionsSummary(this.directions);O&&(V+='\x3cdiv id\x3d"divMap" class\x3d"esriPrintMap esriPrintWait"\x3e\x3c/div\x3e',V+='\x3chr class\x3d"esriNoPrint"/\x3e');V+='\x3cdiv id\x3d"print_helper"\x3e\x3c/div\x3e';V+='\x3ctextarea onkeyup\x3d"document.getElementById(\'print_helper\').innerHTML\x3dthis.value;" id\x3d"print_area" class\x3d"'+
this._css.esriPrintNotesClass+'" placeholder\x3d"'+D.widgets.directions.printNotes+'"\x3e\x3c/textarea\x3e';V+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';V+="\x3c/div\x3e";V+='\x3cdiv class\x3d"'+this._css.esriPrintDirectionsClass+'"\x3e';V+=this._renderDirectionsTable(this.directions);V+="\x3c/div\x3e";V+='\x3cdiv class\x3d"'+this._css.esriPrintFooterClass+'"\x3e';V+="\x3cp\x3e"+D.widgets.directions.printDisclaimer+"\x3c/p\x3e";V+="\x3c/div\x3e";V+="\x3c/div\x3e";V+="\x3c/body\x3e";
V+="\x3c/html\x3e"}this._printWindow.document.open("text/html","replace");this._printWindow.document.write(V);this._printWindow.document.close()}))},resize:function(){this._truncateSearchSourceIfNeeded()},_truncateSearchSourceIfNeeded:function(){var O=this._searchSourceSelector,V=O.containerNode.firstChild;O.domNode.clientWidth>this.domNode.clientWidth?H.set(V,"width",this._searchSourceContainerNode.clientWidth-20+"px"):H.set(V,"width","")},_printDirections:function(){if(this.directions){var O=screen.width/
2,V=screen.height/1.5;O="toolbar\x3dno, location\x3dno, directories\x3dno, status\x3dyes, menubar\x3dno, scrollbars\x3dyes, resizable\x3dyes, width\x3d"+O+", height\x3d"+V+", top\x3d"+(screen.height/2-V/2)+", left\x3d"+(screen.width/2-O/2);this.get("printPage")?(window.directions=this.get("directions"),window.open(this.get("printPage"),"directions_widget_print",O,!0)):(this._printWindow=window.open("","directions_widget_print",O,!0),this._loadPrintDirections(!!this._printService),this._printService&&
G(["dojo/_base/window"],r.hitch(this,function(ca){this.zoomToFullRoute().then(r.hitch(this,function(){this._printService.execute(this._printParams,r.hitch(this,function(ka){ca.withDoc(this._printWindow.document,function(){var ha=w.byId("divMap");ha&&(A.remove(ha,"esriPrintWait"),A.add(ha,"esriPageBreak"),N.create("img",{src:ka.url,"class":"esriPrintMapImg"},ha))})}),r.hitch(this,function(ka){ca.withDoc(this._printWindow.document,function(){var ha=w.byId("divMap");ha&&A.remove(ha,"esriPrintWait")});
console.error("Error while calling print service:\n "+ka)}))}))})))}},_enableButton:function(O,V){V=V||void 0===V;A[V?"remove":"add"].apply(this,[O,"esriDisabledDirectionsButton"]);O._enabled=V},_clearStopsStatusAttr:function(){for(var O=0;O<this.stops.length;O++)this.stops[O].feature&&this.stops[O].feature.attributes&&(this.stops[O].feature.attributes.Status=void 0)},_enableSharing:function(){var O=new F;!this._naRouteSharing&&this.owningSystemUrl?G(["../tasks/NARouteSharing"],r.hitch(this,function(V){this._naRouteSharing=
new V(this.owningSystemUrl,this.map.spatialReference);this._folderSelector||(this._folderSelector=new b({className:"esriFoldersDDL",style:"width: 100%;",sortByLabel:!1,disabled:!0,_interractive:!0,onChange:r.hitch(this,function(){this._folderSelector._interractive?this._enableButton(this._saveButton,!this.routeLayer.itemId):this._folderSelector._interractive=!0})},this._folderSelectorContainer),this._folderSelector.startup(),this._outputLayer=new e({style:"width: 100%",required:!0,trim:!0,regExp:'[^\x26|\x3c|\x3e|%|#|?|\\|"|/|+]+',
maxLength:98,disabled:!0,onKeyPress:r.hitch(this,function(){this._enableButton(this._saveButton,!this.routeLayer.itemId||!this._userCanCreatePortalItem)}),onFocus:r.hitch(this,function(){this.map&&this.map.disableKeyboardNavigation()}),onBlur:r.hitch(this,function(){this.map&&this.map.enableKeyboardNavigation()})},this._outputLayerContainer),this._outputLayer.startup());this._naRouteSharing.getFolders().then(r.hitch(this,function(ca){for(var ka=[],ha=0;ha<ca.length;ha++)ka.push({id:ca[ha].url,folderId:ca[ha].id,
label:ca[ha].title});this._folderSelector.setStore(new f({objectStore:new c({data:ka})}));this._naRouteSharing.canCreateItem().then(r.hitch(this,function(na){this._folderSelector.set("disabled",!na);this._userCanCreatePortalItem=na}));this._enableButton(this._saveButton);O.resolve()}),r.hitch(this,function(ca){console.log(ca);this._naRouteSharing=null;this._toggleSaveMenu(!1);O.reject(ca)}))})):this.owningSystemUrl?O.resolve():(O.reject(Error("Owning system is not defined, or the Directions widget is not done initializing.")),
this._naRouteSharing=null);return O.promise},_storeRouteUI:function(){var O=new F;this._outputLayer&&this._outputLayer.isValid()?this._storeRoute(this._outputLayer.getValue(),this._folderSelector.getValue(),this._folderSelector.store.objectStore.get(this._folderSelector.getValue()).folderId).then(O.resolve,O.reject):(this._outputLayer&&this._outputLayer.focus(),O.reject(Error("Need result layer name specified.")));return O.promise},_storeRoute:function(O,V,ca){var ka=new F,ha=this.directions;if(this._savingRoute||
!this._naRouteSharing)return this._saveButton.blur(),ka.reject(Error("Not ready to store route.")),ka.promise;this.clearMessages();ka.then(null,r.hitch(this,function(Na){console.log("ERR",Na);this._showMessage(D.widgets.directions.error.cantSaveRoute)}));ka.promise.always(r.hitch(this,function(){this._enableButton(this._saveButton);H.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":"none");this._showLoadingSpinner();this._savingRoute=!1}));if(ha&&
ha.features&&ha.features.length&&this.stops&&this.stops.length)if(this.owningSystemUrl)if(this.routeParams&&this.routeParams.travelMode)if(O&&V){var na=r.hitch(this,function(Na){return this._naRouteSharing.getAttributeUnits(Na,this.serviceDescription)});var qa=this.routeParams.travelMode.timeAttributeName;var sa=this.routeParams.travelMode.distanceAttributeName,ta=na(qa),xa=na(sa),za=this.routeParams.directionsLengthUnits||this.serviceDescription.directionsLengthUnits,Da=this._naRouteSharing.toMeters,
Ca=this._naRouteSharing.toMinutes,Ha=function(Na,Ja,Ua){var Xa;for(Xa in Na)if(Na.hasOwnProperty(Xa)&&0===Xa.indexOf(Ja)&&-1===m.indexOf(Ua,Xa.substr(Ja.length))){var db=db||{};db[Xa.substr(Ja.length)]=Na[Xa]}return db},Ia=[],Ma=[],Fa=[];if(qa&&ta&&sa&&xa){var Qa=[],Oa=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames||[],Sa=this.serviceDescription.networkDataset.networkAttributes;for(na=0;na<Sa.length;na++)"esriNAUTCost"===Sa[na].usageType&&-1===m.indexOf(Oa,
Sa[na].name)&&Sa[na].name!==qa&&Sa[na].name!==sa&&Qa.push(Sa[na].name);Oa=this.get("stops");var Pa={xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity};for(na=0;na<Oa.length;na++)if(Oa[na].feature&&Oa[na].feature.toJson){Sa=Oa[na].feature.toJson();var Ka=Sa.attributes;var La=Sa.geometry,Wa=this._naRouteSharing.getUTCOffset(Ka.ArriveTime,Ka.ArriveTimeUTC),ab=this._naRouteSharing.getUTCOffset(Ka.DepartTime,Ka.DepartTimeUTC);r.mixin(Pa,{xmin:Pa.xmin>La.x?La.x:Pa.xmin,ymin:Pa.ymin>La.y?La.y:Pa.ymin,
xmax:Pa.xmax<La.x?La.x:Pa.xmax,ymax:Pa.ymax<La.y?La.y:Pa.ymax});Sa.attributes={__OBJECTID:na+1,CurbApproach:Ka.CurbApproach,ArrivalCurbApproach:Ka.ArriveCurbApproach,DepartureCurbApproach:Ka.DepartCurbApproach,Name:Ka.Name===this._waypointName?D.widgets.directions.waypoint:Ka.Name===this._userDefinedStopName?Oa[na].name:Ka.Name,RouteName:ha.routeName,Sequence:Ka.Sequence,Status:Ka.Status,LocationType:Ka.isWaypoint?1:0,TimeWindowStart:Ka.TimeWindowStart,TimeWindowEnd:Ka.TimeWindowEnd,TimeWindowStartUTCOffset:Wa,
TimeWindowEndUTCOffset:Wa,ServiceMinutes:Ca(Ka["Attr_"+qa],ta),ServiceMeters:Da(Ka["Attr_"+sa],xa),ServiceCosts:y.stringify(Ha(Ka,"Attr_",Qa)),CumulativeMinutes:Ca(Ka["Cumul_"+qa],ta),CumulativeMeters:Da(Ka["Cumul_"+sa],xa),CumulativeCosts:y.stringify(Ha(Ka,"Cumul_",Qa)),LateMinutes:Ca(Ka["Violation_"+qa],ta),WaitMinutes:Ca(Ka["Wait_"+qa],ta),ArrivalTime:this._naRouteSharing.toUTCTime(Ka.ArriveTime,Wa),DepartureTime:this._naRouteSharing.toUTCTime(Ka.DepartTime,ab),ArrivalUTCOffset:Wa,DepartureUTCOffset:ab};
Ia.push(Sa)}sa=0;xa=function(Na){try{Na.strings=y.parse(Na.strings)}catch(Ua){fb.strings=void 0}if(Na.strings&&Na.strings.length)for(var Ja=0;Ja<Na.strings.length;Ja++)if("esriDSTGeneral"===Na.strings[Ja].stringType)return Na.strings[Ja].string};Oa=function(Na,Ja){for(var Ua=[],Xa=0;Xa<(Na||[]).length;Xa++)Na[Xa].stringType!==Ja&&Ja||Ua.push(Na[Xa].string);return Ua.length?Ua.toString():void 0};Sa=function(Na){switch(Na){case "esriDMTStop":return"esriDPTManeuverArrive";case "esriDMTDepart":return"esriDPTManeuverDepart";
case "esriDMTDoorPassage":return"esriDPTManeuverDoor";case "esriDMTBearLeft":return"esriDPTManeuverBearLeft";case "esriDMTBearRight":return"esriDPTManeuverBearRight";case "esriDMTElevator":return"esriDPTManeuverElevator";case "esriDMTEscalator":return"esriDPTManeuverEscalator";case "esriDMTFerry":return"esriDPTManeuverFerryOn";case "esriDMTEndOfFerry":return"esriDPTManeuverFerryOff";case "esriDMTForkCenter":return"esriDPTManeuverForkCenter";case "esriDMTForkLeft":return"esriDPTManeuverForkLeft";case "esriDMTForkRight":return"esriDPTManeuverForkRight";
case "esriDMTPedestrianRamp":return"esriDPTManeuverPedestrianRamp";case "esriDMTRampLeft":return"esriDPTManeuverRampLeft";case "esriDMTRampRight":return"esriDPTManeuverRampRight";case "esriDMTRoundabout":return"esriDPTManeuverRoundabout";case "esriDMTTurnLeft":return"esriDPTManeuverTurnLeft";case "esriDMTLeftLeft":return"esriDPTManeuverTurnLeftLeft";case "esriDMTLeftRight":return"esriDPTManeuverTurnLeftRight";case "esriDMTTurnRight":return"esriDPTManeuverTurnRight";case "esriDMTRightLeft":return"esriDPTManeuverTurnRightLeft";
case "esriDMTRightRight":return"esriDPTManeuverTurnRightRight";case "esriDMTSharpLeft":return"esriDPTManeuverSharpLeft";case "esriDMTSharpRight":return"esriDPTManeuverSharpRight";case "esriDMTStraight":return"esriDPTManeuverStraight";case "esriDMTStrairs":return"esriDPTManeuverStairs";case "esriDMTUTurn":return"esriDPTManeuverUTurn"}return"esriDPTUnknown"};for(na=0;na<ha.featuresWithWaypoints.length;na++){var bb=ha.featuresWithWaypoints[na];La=bb.toJson();Wa=La.attributes;ab=La.geometry&&La.geometry.paths&&
La.geometry.paths[0]||[];var eb=La.geometry.hasM||ab[0]&&3===ab[0].length;Ka=this._naRouteSharing.getUTCOffset(Wa.ETA,Wa.arriveTimeUTC);La.attributes={__OBJECTID:na+1,Sequence:++sa,StopID:function(){var Na=void 0,Ja=bb._associatedStopWithReturnToStart&&bb._associatedStopWithReturnToStart.attributes.Sequence;if(Ja)for(var Ua=0;Ua<Ia.length;Ua++)if(Ia[Ua].attributes.Sequence===Ja){Na=Ia[Ua].attributes.__OBJECTID;break}return Na}(),DirectionPointType:Sa(Wa.maneuverType),DisplayText:bb._associatedStopWithReturnToStart&&
bb._associatedStopWithReturnToStart.attributes.isWaypoint?Wa.text.replace(this._waypointName,D.widgets.directions.waypoint):Wa.text,ArrivalTime:this._naRouteSharing.toUTCTime(Wa.ETA,Ka),ArrivalUTCOffset:Ka,Azimuth:void 0,Name:Oa(ha.stringsWithWaypoints[na],"esriDSTStreetName"),AlternateName:Oa(ha.stringsWithWaypoints[na],"esriDSTAltName"),ExitName:Oa(ha.stringsWithWaypoints[na],"esriDSTExit"),IntersectingName:Oa(ha.stringsWithWaypoints[na],"esriDSTCrossStreet"),BranchName:Oa(ha.stringsWithWaypoints[na],
"esriDSTBranch"),TowardName:Oa(ha.stringsWithWaypoints[na],"esriDSTToward"),ShortVoiceInstruction:void 0,VoiceInstruction:void 0,Level:void 0};delete La.symbol;delete La.infoTemplate;ab.length?(La.geometry={x:ab[0][0],y:ab[0][1],spatialReference:La.geometry.spatialReference},eb&&r.mixin(La.geometry,{m:ab[0][2]})):delete La.geometry;Ma.push(La);La=bb.toJson();Wa=La.attributes;ab=La.geometry&&La.geometry.paths&&La.geometry.paths[0]||[];Ka=!0;for(qa=0;qa<ab.length-1;qa++)if(ab[qa][0]!==ab[qa+1][0]||
ab[qa][1]!==ab[qa+1][1]){Ka=!1;break}Ka||(La.attributes={DirectionPointID:na+1,DirectionLineType:"esriDLTSegment",Meters:Da(Wa.length,za),Minutes:Ca(Wa.time,ta),FromLevel:void 0,ToLevel:void 0},La.geometry.hasM=eb,delete La.symbol,delete La.infoTemplate,Fa.push(La));var fb=ha.eventsWithWaypoints[La.attributes.Sequence]||[];for(qa=0;qa<fb.length;qa++)La=fb[qa].toJson(),Wa=La.attributes,Ka=this._naRouteSharing.getUTCOffset(Wa.ETA,Wa.arriveTimeUTC),La.attributes={Sequence:++sa,DirectionPointType:"esriDPTEvent",
DisplayText:xa(Wa),ArrivalTime:this._naRouteSharing.toUTCTime(Wa.ETA,Ka),ArrivalUTCOffset:Ka,Name:Wa.strings},Ma.push(La)}qa=this.routeParams.barriers&&this.routeParams.barriers.features||[];var Va=[];for(na=0;na<qa.length;na++)sa=qa[na].toJson(),xa=sa.attributes,sa.attributes={BarrierType:xa.BarrierType||0,FullEdge:xa.FullEdge||!1,AddedCost:xa["Attr_"+this._getImpedanceAttribute().name]||0,Costs:y.stringify(Ha(xa,"Attr_",Qa)),CurbApproach:xa.CurbApproach||0,Name:xa.Name},Va.push(sa);qa=this.routeParams.polylineBarriers&&
this.routeParams.polylineBarriers.features||[];var gb=[];for(na=0;na<qa.length;na++)sa=qa[na].toJson(),xa=sa.attributes,sa.attributes={BarrierType:xa.BarrierType||0,ScaleFactor:xa["Attr_"+this._getImpedanceAttribute().name]||1,Costs:y.stringify(Ha(xa,"Attr_",Qa)),Name:xa.Name},gb.push(sa);qa=this.routeParams.polygonBarriers&&this.routeParams.polygonBarriers.features||[];var $a=[];for(na=0;na<qa.length;na++)sa=qa[na].toJson(),xa=sa.attributes,sa.attributes={BarrierType:xa.BarrierType||0,ScaleFactor:xa["Attr_"+
this._getImpedanceAttribute().name]||1,Costs:y.stringify(Ha(xa,"Attr_",Qa)),Name:xa.Name},$a.push(sa);var hb={geometry:ha.mergedGeometry,attributes:{RouteName:ha.routeName,TotalMinutes:Ca(ha.totalTime,ta),TotalMeters:Da(ha.totalLength,za),TotalLateMinutes:function(){for(var Na=0,Ja=0;Ja<Ia.length;Ja++)Na+=Ia[Ja].attributes.LateMinutes||0;return Na}(),TotalWaitMinutes:function(){for(var Na=0,Ja=0;Ja<Ia.length;Ja++)Na+=Ia[Ja].attributes.WaitMinutes||0;return Na}(),TotalCosts:Ia[Ia.length-1].attributes.CumulativeCosts,
StartTime:"none"!==this.startTime?Ia[0].attributes.ArrivalTime:null,EndTime:"none"!==this.startTime?Ia[Ia.length-1].attributes.DepartureTime:null,StartUTCOffset:Ia[0].attributes.ArrivalUTCOffset,EndUTCOffset:Ia[Ia.length-1].attributes.DepartureUTCOffset,Messages:y.stringify(this._solverMessages),AnalysisSettings:y.stringify({travelMode:r.hitch(this,function(){var Na=r.clone(this.routeParams.travelMode);"\x26lt;"===Na.name.substr(0,4)&&"\x26gt;"===Na.name.substr(Na.name.length-4,4)&&(Na.name=Na.name.substr(4,
Na.name.length-8));return Na})(),directionsLanguage:this.routeParams.directionsLanguage||this.serviceDescription.directionsLanguage,startTimeIsUTC:this.routeParams.startTimeIsUTC,timeWindowsAreUTC:this.routeParams.timeWindowsAreUTC,findBestSequence:this.routeParams.findBestSequence,preserveFirstStop:this.routeParams.preserveFirstStop,preserveLastStop:this.routeParams.preserveLastStop,accumulateAttributeNames:this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames})}};
this._enableButton(this._saveButton,!1);this._savingRoute=!0;this._showLoadingSpinner(!0);r.hitch(this,function(){var Na=new F;this._printService?this.zoomToFullRoute().then(r.hitch(this,function(){var Ja=this._printParams.template,Ua=Ja.exportOptions;Ja.exportOptions={width:200,height:133,dpi:96};this._printService.execute(this._printParams,function(Xa){Ja.exportOptions=Ua;Na.resolve(Xa.url)},function(Xa){Ja.exportOptions=Ua;console.error("Error while calling print service:\n "+Xa);Na.resolve()})})):
Na.resolve();return Na.promise})().then(r.hitch(this,function(Na){var Ja={folder:V,name:O,stops:Ia,directionPoints:Ma,directionLines:Fa,barriers:Va,polylineBarriers:gb,polygonBarriers:$a,extent:r.mixin(r.clone(ha.extent),{xmin:Pa.xmin>ha.extent.xmin?ha.extent.xmin:Pa.xmin,ymin:Pa.ymin>ha.extent.ymin?ha.extent.ymin:Pa.ymin,xmax:Pa.xmax<ha.extent.xmax?ha.extent.xmax:Pa.xmax,ymax:Pa.ymax<ha.extent.ymax?ha.extent.ymax:Pa.ymax}),routeInfo:hb,thumbnail:Na};this._userCanCreatePortalItem?this._naRouteSharing.store(Ja,
this.routeLayer.itemId,"1.0.0").then(r.hitch(this,function(Ua){if(Ua.success){var Xa=this._naRouteSharing.portal;Xa="//"+(Xa.isPortal?Xa.portalHostname:Xa.urlKey+"."+Xa.customBaseUrl);this._toggleSaveMenu();this._showMessage(D.widgets.directions.routeIsSaved+"\x3cbr/\x3e\x3ca class\x3d'esriLinkButton' target\x3d'_blank' href\x3d'"+Xa+"/home/item.html?id\x3d"+Ua.id+"'\x3e"+D.widgets.directions.share+"\x3c/a\x3e",!0);if(this.routeLayer.itemId)this.onRouteItemUpdated(Ua.id);else this.onRouteItemCreated(Ua.id);
r.mixin(this.routeLayer,{itemId:Ua.id,title:Ja.name,isItemOwner:!0,ownerFolder:ca});ka.resolve(Ua)}else ka.reject(Ua)}),ka.reject):this._naRouteSharing.createFeatureCollection(Ja,"1.0.0").then(r.hitch(this,function(Ua){ka.resolve(Ua);this._toggleSaveMenu();this.onFeatureCollectionCreated(Ua)}),ka.reject)}))}else ka.reject(Error("Cannot deduce the impedance used."))}else ka.reject(Error("Missing required parameter: layerName, folder must be specified."));else ka.reject(Error("Shared route must be built using a Travel Mode."));
else ka.reject(Error("Cannot store route: owning system to store routes is not defined. Please specify Portal or ArcGIS Online Url in constructor."));else ka.reject(Error("No route to share. Build a route first."));return ka.promise},_loadRoute:function(O){var V=new F;V.promise.always(r.hitch(this,function(){this._showLoadingSpinner(!1);H.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":"none");this._enableButton(this._saveButton,this.routeLayer.isItemOwner)}));
this._reset().then(r.hitch(this,function(){this._showLoadingSpinner(!0);this._enableSharing().then(r.hitch(this,function(){var ca=r.clone(this.serviceDescription),ka=r.hitch(this,function(ta){r.mixin(this.routeLayer,{itemId:O,title:ta.title,isItemOwner:ta.isItemOwner,ownerFolder:ta.ownerFolder})}),ha,na,qa,sa;ca.directionsLengthUnits=this.directionsLengthUnits;this._naRouteSharing.load(O,ca).then(r.hitch(this,function(ta){if(ta.routeParameters){r.mixin(this.routeParams,ta.routeParameters);this.routeParams.accumulateAttributes=
ta.routeParameters.accumulateAttributeNames;this.set("optimalRoute",this.routeParams.findBestSequence);this.startTime=this.routeParams.startTime?this.routeParams.startTime:"none";this._setStartTime(void 0,void 0,this.startTime);var xa=ta.routeParameters.travelMode,za=xa?this._getCostAttribute(xa.impedanceAttributeName):void 0;za=za?this._isTimeUnits(za.units)?"Time":"Distance":"";sa=ca.supportedTravelModes&&ca.supportedTravelModes.length?this._travelModeSelector.store.objectStore.data.slice():[];
if(canUseRouteLayerTM=1!==ta.successCode&&za){var Da="AUTOMOBILE"===xa.type?"Driving":"TRUCK"===xa.type?"Trucking":"WALK"===xa.type?"Walking":"Other";xa.name="\x26lt;"+xa.name+"\x26gt;";this.serviceDescription.supportedTravelModes=(ca.supportedTravelModes||[]).concat(xa);sa.push({id:xa.name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+Da+za+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName"\x3e'+xa.name+"\x3c/div\x3e"});this._travelModeSelector.setStore(new f({objectStore:new c({data:sa})}));
this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(xa.name)}else{za=!1;if(xa&&xa.name)for(sa=ca.supportedTravelModes||[],ha=0;ha<sa.length;ha++)if(sa[ha].name===xa.name){za=!0;this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(xa.name);this.routeParams.travelMode=sa[ha].impedanceAttributeName?sa[ha]:sa[ha].itemId;ta.loadMessages.push({message:D.widgets.directions.error.tmFromPortalSameName+" "+xa.name,messageType:"Warning"});break}if(!za)if((xa=ca.defaultTravelMode)&&
sa)for(ha=0;ha<sa.length;ha++){if(sa[ha].id===xa){this.routeParams.travelMode=sa[ha].impedanceAttributeName?sa[ha]:sa[ha].itemId;ta.loadMessages.push({message:D.widgets.directions.error.tmFromPortalDefault+" "+(sa[ha].name?sa[ha].name:sa[ha].itemId),messageType:"Warning"});break}}else this.routeParams.travelMode=null}this._checkStartTimeUIAvailability()}if(ta.solveResult&&ta.solveResult.routeResults){var Ca=Infinity,Ha=-Infinity;xa=ta.solveResult.routeResults[0].stops;var Ia=ta.solveResult.routeResults[0].directions.features;
za={};for(ha=0;ha<xa.length;ha++){var Ma=xa[ha].attributes;if(Ma.isWaypoint)for(na=0;na<Ia.length;na++)Da=Ia[na].attributes,Da._stopSequence===Ma.Sequence&&(Da.text=Da.text.replace(Ma.Name,this._waypointName));qa=Ma.Name+"_"+this._stopSequence++;za[qa]=Ma.isWaypoint?this._waypointName:Ma.Name;Ma.Name=qa;if(Ma.Sequence<Ca&&(null!==Ma.ArriveCurbApproach||null!==Ma.DepartCurbApproach)){var Fa=Ma.Name;Ca=Ma.Sequence}if(Ma.Sequence>Ha&&(null!==Ma.ArriveCurbApproach||null!==Ma.DepartCurbApproach)){var Qa=
Ma.Name;Ha=Ma.Sequence}}qa=Fa+" - "+Qa;ta.solveResult.routeResults[0].routeName=qa;ta.solveResult.routeResults[0].directions.routeName=qa;for(ha=0;ha<Ia.length;ha++)if(Da=Ia[ha].attributes,void 0!==Da._stopSequence)for(na=0;na<xa.length;na++)if(Da._stopSequence===xa[na].attributes.Sequence){qa=xa[na].attributes.Name;Da.text=(Da.text||"").replace(za[qa],qa);delete Da._stopSequence;break}Fa=xa[xa.length-1];xa[0].geometry.x===Fa.geometry.x&&xa[0].geometry.y===Fa.geometry.y&&(this._returnToStartStop=
this._addStopWrapperToGraphic(new P(Fa.geometry,null,Fa.attributes),za[Fa.attributes.Name]),this.set("returnToStart",!0));this._solveResultProcessing(ta.solveResult,za).then(r.hitch(this,function(){this._setStartTime(void 0,void 0,this.startTime);ka(ta);this.zoomToFullRoute();V.resolve(ta)}),V.reject)}else{if(ta.routeParameters){Fa=ta.routeParameters.stops.features;this.stops=[];for(ha=0;ha<Fa.length;ha++)this.stops.push(this._addStopWrapperToGraphic(Fa[ha],Fa[ha].attributes.Name)),this._updateStop(this.stops[ha],
ha);this._setStops();ta.loadMessages.push({message:D.widgets.directions.routeLayerStopsOnly,messageType:"Warning"})}else ta.loadMessages.push({message:D.widgets.directions.routeLayerEmpty,messageType:"Warning"});ka(ta);V.resolve(ta)}for(ha=0;ha<ta.loadMessages.length;ha++)this._showMessage(ta.loadMessages[ha].message)}),r.hitch(this,function(ta){V.reject(ta);this._showMessage("GWM_0003"===ta.messageCode?D.widgets.directions.error.accessDenied+this._naRouteSharing.portal.getPortalUser().username:D.widgets.directions.error.loadError)}))}),
V.reject)}),V.reject);return V.promise}});q("extend-esri")&&r.setObject("dijit.Directions",u,B);return u})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),function(G,u,r,n,m,k,d,a,
b,e,g,h,c,f,l,q,t,v,w){function x(A){return function(z){this._isLoaded?this.inherited(A,arguments):this.loadDropDown(a.hitch(this,A,z))}}var H=u("dijit.form._SelectMenu",c,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(b(this.domNode,"selectstart",function(A){A.preventDefault();A.stopPropagation()}))},focus:function(){var A=!1,z=this.parentWidget.value;a.isArray(z)&&(z=z[z.length-
1]);z&&G.forEach(this.parentWidget._getChildren(),function(E){E.option&&z===E.option.value&&(A=!0,this.focusChild(E,!1))},this);A||this.inherited(arguments)}});m=u("dijit.form.Select"+(e("dojo-bidi")?"_NoBidi":""),[g,h,t],{baseClass:"dijitSelect dijitValidationTextBox",templateString:w,_buttonInputDisabled:e("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){var A=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=A?A:0].value)}this.dropDown=new H({id:this.id+"_menu",parentWidget:this});n.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(A){if(A.value||A.label){var z=a.hitch(this,"_setValueAttr",A);A=new f({option:A,label:("text"===this.labelType?(A.label||"").toString().replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):A.label)||this.emptyLabel,
onClick:z,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:A.disabled||!1});A.focusNode.setAttribute("role","option");return A}return new l({ownerDocument:this.ownerDocument})},_addOptionItem:function(A){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(A))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(A){}},focusChild:function(A){A&&this.set("value",
A.option)},_getFirst:function(){var A=this._getChildren();return A.length?A[0]:null},_getLast:function(){var A=this._getChildren();return A.length?A[A.length-1]:null},childSelector:function(A){return(A=v.byNode(A))&&A.getParent()==this.dropDown},onKeyboardSearch:function(A,z,E,J){A&&this.focusChild(A)},_loadChildren:function(A){if(!0===A)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{G.forEach(this._getChildren(),function(E){E.destroyRecursive()});
var z=new f({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(z)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(A){this.inherited(arguments);r.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",
_setDisabledAttr:function(A){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(A){this._set("required",A);this.focusNode.setAttribute("aria-required",A);this._refreshState()},_setOptionsAttr:function(A){this._isLoaded=!1;this._set("options",A)},_setDisplay:function(A){A=("text"===this.labelType?(A||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):A)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+
this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+A+"\x3c/span\x3e"},validate:function(A){A=this.disabled||this.isValid(A);this._set("state",A?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",A?"false":"true");var z=A?"":this._missingMsg;z&&this.focused&&this._hasBeenBlurred?q.show(z,this.domNode,this.tooltipPosition,!this.isLeftToRight()):q.hide(this.domNode);this._set("message",z);return A},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||
"")},reset:function(){this.inherited(arguments);q.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=k.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(b(this.domNode,"selectstart",function(z){z.preventDefault();z.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var A=this._keyNavCodes;delete A[d.LEFT_ARROW];delete A[d.RIGHT_ARROW]},_setStyleAttr:function(A){this.inherited(arguments);
n.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(A){this._loadChildren(!0);this._isLoaded=!0;A()},destroy:function(A){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(A),delete this.dropDown);q.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){q.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});
e("dojo-bidi")&&(m=u("dijit.form.Select",m,{_setDisplay:function(A){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));m._Menu=H;m.prototype._onContainerKeydown=x("_onContainerKeydown");m.prototype._onContainerKeypress=x("_onContainerKeypress");return m})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c){return m("dijit.form._FormSelectWidget",c,{multiple:!1,options:null,store:null,_setStoreAttr:function(f){this._created&&this._deprecatedSetStore(f)},query:null,_setQueryAttr:function(f){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:f})},queryOptions:null,_setQueryOptionsAttr:function(f){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:f})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(f){var l=this.options||[];if(null==f)return l;if(b.isArrayLike(f))return G.map(f,"return this.getOptions(item);",this);b.isString(f)&&(f={value:f});b.isObject(f)&&(G.some(l,function(q,t){for(var v in f)if(!(v in q)||q[v]!=f[v])return!1;f=t;return!0})||(f=-1));return 0<=f&&f<l.length?l[f]:null},addOption:function(f){G.forEach(b.isArrayLike(f)?f:[f],function(l){l&&b.isObject(l)&&this.options.push(l)},this);this._loadChildren()},removeOption:function(f){f=this.getOptions(b.isArrayLike(f)?
f:[f]);G.forEach(f,function(l){l&&(this.options=G.filter(this.options,function(q){return q.value!==l.value||q.label!==l.label}),this._removeOptionItem(l))},this);this._loadChildren()},updateOption:function(f){G.forEach(b.isArrayLike(f)?f:[f],function(l){var q=this.getOptions({value:l.value}),t;if(q)for(t in l)q[t]=l[t]},this);this._loadChildren()},setStore:function(f,l,q){a.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(f,l,q)},_deprecatedSetStore:function(f,l,q){var t=this.store;q=q||{};if(t!==f){for(var v;v=this._notifyConnections.pop();)v.remove();f.get||(b.mixin(f,{_oldAPI:!0,get:function(w){var x=new u;this.fetchItemByIdentity({identity:w,onItem:function(H){x.resolve(H)},onError:function(H){x.reject(H)}});return x.promise},query:function(w,x){var H=new u(function(){A.abort&&A.abort()});H.total=new u;var A=this.fetch(b.mixin({query:w,onBegin:function(z){H.total.resolve(z)},
onComplete:function(z){H.resolve(z)},onError:function(z){H.reject(z)}},x));return new h(H)}}),f.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[r.after(f,"onNew",b.hitch(this,"_onNewItem"),!0),r.after(f,"onDelete",b.hitch(this,"_onDeleteItem"),!0),r.after(f,"onSet",b.hitch(this,"_onSetItem"),!0)]));this._set("store",f)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);q.query&&this._set("query",q.query);q.queryOptions&&this._set("queryOptions",q.queryOptions);f&&f.query&&(this._loadingStore=!0,this.onLoadDeferred=new u,this._queryRes=f.query(this.query,this.queryOptions),g(this._queryRes,b.hitch(this,function(w){if(this.sortByLabel&&!q.sort&&w.length)if(f.getValue)w.sort(n.createSortFunction([{attribute:f.getLabelAttributes(w[0])[0]}],f));else{var x=this.labelAttr;w.sort(function(H,A){return H[x]>A[x]?1:A[x]>
H[x]?-1:0})}q.onFetch&&(w=q.onFetch.call(this,w,q));G.forEach(w,function(H){this._addOptionForItem(H)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(b.hitch(this,function(H,A,z){A==z?this._onSetItem(H):(-1!=A&&this._onDeleteItem(H),-1!=z&&this._onNewItem(H))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:l);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(w):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),b.hitch(this,function(w){console.error("dijit.form.Select: "+w.toString());this.onLoadDeferred.reject(w)})));return t},_setValueAttr:function(f,l){this._onChangeActive||(l=null);if(this._loadingStore)this._pendingValue=f;else if(null!=f){f=b.isArrayLike(f)?G.map(f,function(v){return b.isObject(v)?v:{value:v}}):b.isObject(f)?[f]:[{value:f}];f=G.filter(this.getOptions(f),function(v){return v&&v.value});var q=this.getOptions()||[];this.multiple||f[0]&&f[0].value||!q.length||(f[0]=
q[0]);G.forEach(q,function(v){v.selected=G.some(f,function(w){return w.value===v.value})});q=G.map(f,function(v){return v.value});if("undefined"!=typeof q&&"undefined"!=typeof q[0]){var t=G.map(f,function(v){return v.label});this._setDisplay(this.multiple?t:t[0]);this.inherited(arguments,[this.multiple?q:q[0],l]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var f=G.map([].concat(this.get("selectedOptions")),function(l){return l&&"label"in l?l.label:l?l.value:null},this);return this.multiple?
f:f[0]},_setDisplayedValueAttr:function(f){this.set("value",this.getOptions("string"==typeof f?{label:f}:f))},_loadChildren:function(){this._loadingStore||(G.forEach(this._getChildren(),function(f){f.destroyRecursive()}),G.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var f=[].concat(this.value);if(f&&f[0]){var l=this;G.forEach(this._getChildren(),function(q){var t=G.some(f,function(v){return q.option&&
v===q.option.value});t&&!l.multiple&&(l.focusedChild=q);d.toggle(q.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),t);q.domNode.setAttribute("aria-selected",t?"true":"false")},this)}},_getValueFromOpts:function(){var f=this.getOptions()||[];if(!this.multiple&&f.length){var l=G.filter(f,function(q){return q.selected})[0];if(l&&l.value)return l.value;f[0].selected=!0;return f[0].value}return this.multiple?G.map(G.filter(f,function(q){return q.selected}),function(q){return q.value})||[]:""},
_onNewItem:function(f,l){l&&l.parent||this._addOptionForItem(f)},_onDeleteItem:function(f){this.removeOption({value:this.store.getIdentity(f)})},_onSetItem:function(f){this.updateOption(this._getOptionObjForItem(f))},_getOptionObjForItem:function(f){var l=this.store,q=this.labelAttr&&this.labelAttr in f?f[this.labelAttr]:l.getLabel(f);return{value:q?l.getIdentity(f):null,label:q,item:f}},_addOptionForItem:function(f){var l=this.store;l.isItemLoaded&&!l.isItemLoaded(f)?l.loadItem({item:f,onItem:function(q){this._addOptionForItem(q)},
scope:this}):(f=this._getOptionObjForItem(f),this.addOption(f))},constructor:function(f){this._oValue=(f||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);k.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?e("\x3e *",this.srcNodeRef).map(function(f){return"separator"===f.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:f.getAttribute("data-"+a._scopeName+"-value")||f.getAttribute("value"),
label:String(f.innerHTML),selected:f.getAttribute("selected")||!1,disabled:f.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);r.after(this,"onChange",b.hitch(this,"_updateSelection"));var f=this.store;f&&(f.getIdentity||f.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(f,this._oValue,
{query:this.query,queryOptions:this.queryOptions}));this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var f;f=this._notifyConnections.pop();)f.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(G,u,r,n,m,k){return G("dijit.MenuSeparator",[r,n,m],{templateString:k,buildRendering:function(){this.inherited(arguments);u.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},
"dojo/data/ObjectStore":function(){define("../_base/lang ../Evented ../_base/declare ../_base/Deferred ../promise/all ../_base/array ../_base/connect ../regexp".split(" "),function(G,u,r,n,m,k,d,a){function b(e){return"*"==e?".*":"?"==e?".":e}return r("dojo.data.ObjectStore",[u],{objectStore:null,constructor:function(e){this._dirtyObjects=[];e.labelAttribute&&(e.labelProperty=e.labelAttribute);G.mixin(this,e)},labelProperty:"label",getValue:function(e,g,h){return"function"===typeof e.get?e.get(g):
g in e?e[g]:h},getValues:function(e,g){e=this.getValue(e,g);return e instanceof Array?e:void 0===e?[]:[e]},getAttributes:function(e){var g=[],h;for(h in e)!e.hasOwnProperty(h)||"_"==h.charAt(0)&&"_"==h.charAt(1)||g.push(h);return g},hasAttribute:function(e,g){return g in e},containsValue:function(e,g,h){return-1<k.indexOf(this.getValues(e,g),h)},isItem:function(e){return"object"==typeof e&&e&&!(e instanceof Date)},isItemLoaded:function(e){return e&&"function"!==typeof e.load},loadItem:function(e){var g;
"function"===typeof e.item.load?n.when(e.item.load(),function(h){g=h;var c=h instanceof Error?e.onError:e.onItem;c&&c.call(e.scope,h)}):e.onItem&&e.onItem.call(e.scope,e.item);return g},close:function(e){return e&&e.abort&&e.abort()},fetch:function(e){function g(v){e.onError&&e.onError.call(c,v,e)}e=G.delegate(e,e&&e.queryOptions);var h=this,c=e.scope||h,f=e.query;if("object"==typeof f){f=G.delegate(f);for(var l in f){var q=f[l];"string"==typeof q&&(f[l]=RegExp("^"+a.escapeString(q,"*?\\").replace(/\\.|\*|\?/g,
b)+"$",e.ignoreCase?"mi":"m"),f[l].toString=function(v){return function(){return v}}(q))}}var t=this.objectStore.query(f,e);n.when(t.total,function(v){n.when(t,function(w){e.onBegin&&e.onBegin.call(c,v||w.length,e);if(e.onItem)for(var x=0;x<w.length;x++)e.onItem.call(c,w[x],e);e.onComplete&&e.onComplete.call(c,e.onItem?null:w,e);return w},g)},g);e.abort=function(){t.cancel&&t.cancel()};t.observe&&(this.observing&&this.observing.cancel(),this.observing=t.observe(function(v,w,x){if(-1==k.indexOf(h._dirtyObjects,
v))if(-1==w)h.onNew(v);else if(-1==x)h.onDelete(v);else for(var H in v)if(H!=h.objectStore.idProperty)h.onSet(v,H,null,v[H])},!0));this.onFetch(t);e.store=this;return e},getFeatures:function(){return{"dojo.data.api.Read":!!this.objectStore.get,"dojo.data.api.Identity":!0,"dojo.data.api.Write":!!this.objectStore.put,"dojo.data.api.Notification":!0}},getLabel:function(e){if(this.isItem(e))return this.getValue(e,this.labelProperty)},getLabelAttributes:function(e){return[this.labelProperty]},getIdentity:function(e){return this.objectStore.getIdentity?
this.objectStore.getIdentity(e):e[this.objectStore.idProperty||"id"]},getIdentityAttributes:function(e){return[this.objectStore.idProperty]},fetchItemByIdentity:function(e){var g;n.when(this.objectStore.get(e.identity),function(h){g=h;e.onItem.call(e.scope,h)},function(h){e.onError.call(e.scope,h)});return g},newItem:function(e,g){if(g){var h=this.getValue(g.parent,g.attribute,[]);h=h.concat([e]);e.__parent=h;this.setValue(g.parent,g.attribute,h)}this._dirtyObjects.push({object:e,save:!0});this.onNew(e);
return e},deleteItem:function(e){this.changing(e,!0);this.onDelete(e)},setValue:function(e,g,h){var c=e[g];this.changing(e);e[g]=h;this.onSet(e,g,c,h)},setValues:function(e,g,h){if(!G.isArray(h))throw Error("setValues expects to be passed an Array object as its value");this.setValue(e,g,h)},unsetAttribute:function(e,g){this.changing(e);var h=e[g];delete e[g];this.onSet(e,g,h,void 0)},changing:function(e,g){e.__isDirty=!0;for(var h=0;h<this._dirtyObjects.length;h++){var c=this._dirtyObjects[h];if(e==
c.object){g&&(c.object=!1,this._saveNotNeeded||(c.save=!0));return}}c=e instanceof Array?[]:{};for(h in e)e.hasOwnProperty(h)&&(c[h]=e[h]);this._dirtyObjects.push({object:!g&&e,old:c,save:!this._saveNotNeeded})},save:function(e){e=e||{};var g=[],h=[],c=this,f=this._dirtyObjects;try{d.connect(e,"onError",function(){if(!1!==e.revertOnError){var H=f;f=h;c.revert();c._dirtyObjects=H}else c._dirtyObjects=f.concat(h)});var l;this.objectStore.transaction&&(l=this.objectStore.transaction());for(var q=0;q<
f.length;q++){var t=f[q],v=t.object,w=t.old;delete v.__isDirty;if(v){var x=this.objectStore.put(v,{overwrite:!!w});g.push(x)}else"undefined"!=typeof w&&(x=this.objectStore.remove(this.getIdentity(w)),g.push(x));h.push(t);f.splice(q--,1)}m(g).then(function(H){e.onComplete&&e.onComplete.call(e.scope,H)},function(H){e.onError&&e.onError.call(e.scope,H)});l&&l.commit()}catch(H){e.onError.call(e.scope,value)}},revert:function(){for(var e=this._dirtyObjects,g=e.length;0<g;){g--;var h=e[g],c=h.object;h=
h.old;if(c&&h){for(var f in h)h.hasOwnProperty(f)&&c[f]!==h[f]&&(this.onSet(c,f,c[f],h[f]),c[f]=h[f]);for(f in c)h.hasOwnProperty(f)||(this.onSet(c,f,c[f]),delete c[f])}else if(h)this.onNew(h);else this.onDelete(c);delete (c||h).__isDirty;e.splice(g,1)}},isDirty:function(e){return e?e.__isDirty:!!this._dirtyObjects.length},onSet:function(){},onNew:function(){},onDelete:function(){},onFetch:function(e){}})})},"esri/dijit/Search":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Evented dojo/Deferred dojo/keys dojo/on dojo/query dojo/uacss dojo/regexp dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-style dojo/dom-construct dojo/date/locale dojo/i18n!../nls/jsapi dojo/text!./Search/templates/Search.html dijit/_WidgetBase dijit/_TemplatedMixin dijit/_FocusMixin dijit/a11yclick dijit/focus ../lang ../InfoTemplate ../kernel ../SpatialReference ../graphic ../promiseList ../symbols/PictureMarkerSymbol ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/TextSymbol ../symbols/Font ../geometry/Point ../geometry/Extent ../geometry/normalizeUtils ../geometry/scaleUtils ../tasks/locator ../tasks/query ../Color ../styles/basic".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z,E,J,D,L,C,N,S,F,T,y,B,I,P,X,Y,aa,Z,fa,K,R,U){function ba(Q,ea){Q&&ea&&(Q._layer=ea,Q._sourceLayer=ea)}u=u([x,H,A,m],{declaredClass:"esri.dijit.Search",templateString:w,reHostedFS:/https?:\/\/services.*\.arcgis\.com/i,constructor:function(Q,ea){this.css={searchGroup:"searchGroup",searchInput:"searchInput",searchInputGroup:"searchInputGroup",searchBtn:"searchBtn",searchSubmit:"searchSubmit",searchIcon:"searchIcon esri-icon-search",searchButtonText:"searchButtonText",
searchToggle:"searchToggle",searchToggleIcon:"searchIcon esri-icon-down-arrow",searchMenu:"searchMenu",searchMenuHeader:"menuHeader",searchClear:"searchClear",searchClearIcon:"searchIcon esri-icon-close searchClose",searchSpinner:"searchIcon esri-icon-loading-indicator searchSpinner",searchSourceName:"sourceName",suggestionsMenu:"suggestionsMenu",sourcesMenu:"sourcesMenu",activeSource:"active",hasValue:"hasValue",hasButtonMode:"hasButtonMode",hasMultipleSources:"hasMultipleSources",showSuggestions:"showSuggestions",
showSources:"showSources",showNoResults:"showNoResults",searchLoading:"searchLoading",latLonHeader:"searchLatLongHeader",searchMoreResults:"moreResults",searchMoreResultsList:"resultsList",searchMoreResultsHeader:"moreHeader",searchMoreResultsItem:"moreItem",searchMoreResultsListHeader:"popupHeader",searchShowMoreResults:"showMoreResults",searchNoResultsMenu:"noResultsMenu",searchNoResultsBody:"noResultsBody",searchNoResultsHeader:"noResultsHeader",searchNoValueIcon:"noValueIcon esri-icon-notice-triangle",
searchNoValueText:"noValueText",searchNoResultsText:"noResultsText",searchExpandContainer:"searchExpandContainer",searchAnimateContainer:"searchAnimate",searchExpanded:"searchExpanded",searchCollapsed:"searchCollapsed",searchClearFloat:"searchClearFloat"};this._allIndex="all";this._objectIdIdentifier="_objectId";this._deferreds=[];this._sourceNames=[];this.defaultSource={locator:new fa("//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"),singleLineFieldName:"SingleLine",outFields:["Addr_type",
"Match_addr","StAddr","City"],name:v.widgets.Search.main.esriLocatorName,localSearchOptions:{minScale:3E5,distance:5E4},placeholder:v.widgets.Search.main.placeholder,highlightSymbol:(new F(G.toUrl("./Search/images/search-pointer.png"),36,36)).setOffset(9,18)};this.options={map:null,theme:"arcgisSearch",visible:!0,value:"",allPlaceholder:"",sources:[this.defaultSource],activeSourceIndex:0,suggestionDelay:350,enableSourcesMenu:!0,enableSuggestionsMenu:!0,enableInfoWindow:!0,showInfoWindowOnSelect:!0,
enableSuggestions:!0,enableButtonMode:!1,autoNavigate:!0,autoSelect:!0,addLayersFromMap:!1,zoomScale:1E3,graphicsLayer:null,enableHighlight:!0,highlightGraphic:null,enableLabel:!1,labelSymbol:(new I).setColor(new R([181,56,46,.9])).setFont(new P("14px",P.STYLE_NORMAL,P.VARIANT_NORMAL,P.WEIGHT_BOLD,"Arial")),labelGraphic:null,infoTemplate:new D(v.widgets.Search.main.searchResult,'\x3cdiv class\x3d"${searchTheme}"\x3e\x3cdiv id\x3d"${searchMoreResultsId}" class\x3d"${searchMoreResults}"\x3e\x3cdiv class\x3d"${searchMoreResultsItem}"\x3e${searchResult}\x3c/div\x3e\x3cdiv\x3e${searchMoreResultsHtml}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'),
searchResults:null,suggestResults:null,selectedResult:null,magicKey:null,selectedFeatureId:null,expanded:!1,maxLength:128,maxResults:6,maxSuggestions:6,locationToAddressDistance:1500,minCharacters:3,enableSearchingAll:!0};Q=r.mixin({},this.options,Q);this.set(Q);this._updateActiveSource();this._i18n=v;this._defaultSR=new C(4326);this.domNode=ea},startup:function(){this.inherited(arguments);this.sources||(this.sources=[]);this._mapLoaded().then(r.hitch(this,this._init))},postCreate:function(){var Q=
this;this.inherited(arguments);this._moreResultsId=this.id+"_more_results";this.own(a(this.submitNode,z,r.hitch(this,this._searchButton)));this.own(a(this.sourcesBtnNode,z,r.hitch(this,this._toggleSourcesMenu)));this.own(a(this.inputNode,z,r.hitch(this,this._inputClick)));this.own(a(this.clearNode,z,r.hitch(this,this._clearButton)));this.own(a(this.formNode,"submit",r.hitch(this,function(ea){ea.preventDefault();this._cancelSuggest();this.search()})));this.own(a(this.inputNode,"keyup",r.hitch(this,
function(ea){this._inputKey(ea)})));this.own(a(this.sourcesBtnNode,"keyup",r.hitch(this,function(ea){this._sourceBtnKey(ea)})));this.own(a(this.suggestionsNode,"li:click, li:keyup",function(ea){Q._suggestionsEvent(ea,this)}));this.own(a(this.sourcesNode,"li:click, li:keyup",function(ea){Q._sourcesEvent(ea,this)}));this.own(a(this.inputNode,"input, paste",r.hitch(this,function(){this._suggestDelay()})));this.map&&this.map.infoWindow&&this.map.infoWindow.domNode&&this.enableInfoWindow&&(this.own(a(this.map.infoWindow.domNode,
"#"+this._moreResultsId+"_show:click",r.hitch(this,function(ea){this._showMoreResultsClick(ea)}))),this.own(a(this.map.infoWindow.domNode,"#"+this._moreResultsId+"_list li a:click",r.hitch(this,function(ea){this._moreResultsClick(ea)}))),this.own(a(this.map.infoWindow.domNode,"#"+this._moreResultsId+" [data-switch-coordinates]:click",r.hitch(this,function(ea){this._switchCoordinatesClick(ea)}))));this.value&&this._checkStatus();this._hideMenus();this._updateVisible();this._insertSources(this.sources);
this._setPlaceholder(this.activeSourceIndex);this._updateButtonMode(this.enableButtonMode);this.toggle(this.expanded)},destroy:function(){this.clear();q.empty(this.domNode);this.inherited(arguments)},clear:function(){this.clearGraphics();c.get(this.inputNode,"value")&&c.set(this.inputNode,"value","");this._changeAttrValue("value","");this.set("searchResults",null);this.set("suggestResults",null);this.set("selectedResult",null);this.set("magicKey",null);this.set("selectedFeatureId",null);f.remove(this.containerNode,
this.css.hasValue);c.set(this.clearNode,"title","");this._hideMenus();this._closePopup();this._hideLoading();this.emit("clear-search")},show:function(){l.set(this.domNode,"display","block")},hide:function(){l.set(this.domNode,"display","none")},expand:function(){this.enableButtonMode&&(f.add(this.containerNode,this.css.searchExpanded),f.remove(this.containerNode,this.css.searchCollapsed),this._hideMenus(),this.set("expanded",!0))},collapse:function(){this.enableButtonMode&&(f.remove(this.containerNode,
this.css.searchExpanded),f.add(this.containerNode,this.css.searchCollapsed),this._hideMenus(),this.set("expanded",!1))},toggle:function(Q){this.enableButtonMode&&("undefined"===typeof Q&&(Q=!this.expanded),Q?this.expand():this.collapse())},search:function(Q){var ea=new k;this._mapLoaded().then(r.hitch(this,function(){this._searchDeferred(Q).then(r.hitch(this,function(la){var ma=la.results;this.set("searchResults",ma);0===la.numResults&&(this._noResults(la.value),this._showNoResultsMenu());this._hideLoading();
this.emit("search-results",la);this._selectFirstResult(ma,la.activeSourceIndex);ea.resolve(ma)}),r.hitch(this,function(la){ea.reject(la)}))}));return ea.promise},suggest:function(Q){var ea=new k;this._mapLoaded().then(r.hitch(this,function(){this._suggestDeferred(Q).then(r.hitch(this,function(la){if(la){var ma=la.results;this.set("suggestResults",ma);this._insertSuggestions(ma,la.value);this.emit("suggest-results",la);ea.resolve(ma)}}),r.hitch(this,function(la){ea.reject(la)}))}));return ea.promise},
select:function(Q){var ea=this._getDefaultSymbol(Q),la=this.labelSymbol,ma=this.sources,M=this.activeSourceIndex,W=this.enableHighlight,da=this.enableLabel,ja=this.autoNavigate,ia=this.showInfoWindowOnSelect,pa=this.enableInfoWindow,oa=this.infoTemplate,ra=Q.feature?new N(Q.feature.toJson()):null,wa=ra?Q.feature._sourceLayer:null;ba(ra,wa);if(M===this._allIndex){var va=this._getSourceIndexOfResult(Q);if(null!==va){var ya=ma[va];M=va}}else ya=ma[M];ya&&(ya.hasOwnProperty("highlightSymbol")&&(ea=ya.highlightSymbol),
ya.hasOwnProperty("labelSymbol")&&(la=ya.labelSymbol),ya.hasOwnProperty("enableHighlight")&&(W=ya.enableHighlight),ya.hasOwnProperty("enableLabel")&&(da=ya.enableLabel),ya.hasOwnProperty("autoNavigate")&&(ja=ya.autoNavigate),ya.hasOwnProperty("showInfoWindowOnSelect")&&(ia=ya.showInfoWindowOnSelect),ya.hasOwnProperty("enableInfoWindow")&&(pa=ya.enableInfoWindow),ya.hasOwnProperty("infoTemplate")?oa=ya.infoTemplate:ya.featureLayer&&ya.featureLayer.infoTemplate&&(oa=ya.featureLayer.infoTemplate));this._hideMenus();
this._hideLoading();if(ra){ma=this.highlightGraphic;var ua=this.graphicsLayer;va=this.labelGraphic;var Aa=r.mixin({},ra.attributes,{searchTheme:this.theme,searchResult:this._searchResultHTML(Q),searchMoreResults:this.css.searchMoreResults,searchMoreResultsItem:this.css.searchMoreResultsItem,searchMoreResultsId:this._moreResultsId,searchMoreResultsHtml:this._moreResultsHTML(Q)}),Ga=null;pa&&(Ga=oa);va?(va.setGeometry(ra.geometry),va.setAttributes(Aa),va.setSymbol(la),la&&"textsymbol"===la.type&&va.symbol.setText(Q.name)):
(va=new N(ra.geometry,la,Aa),ba(va,wa),la&&"textsymbol"===la.type&&va.symbol.setText(Q.name),da&&(ua?ua.add(va):this.map&&this.map.graphics&&this.map.graphics.add(va)));ma?(ma.setGeometry(ra.geometry),ma.setAttributes(Aa),ma.setInfoTemplate(Ga),ma.setSymbol(ea)):(ma=new N(ra.geometry,ea,Aa,Ga),ba(ma,wa),W&&(ua?ua.add(ma):this.map&&this.map.graphics&&this.map.graphics.add(ma)));ma&&ma.symbol&&"textsymbol"===ma.symbol.type&&ma.symbol.setText(Q.name);this.map&&this.map.infoWindow&&pa&&ia&&(this.map.infoWindow.setFeatures([ma]),
ea=this._getPointFromGeometry(ma.geometry),this.map.infoWindow.show(ea));this.map&&ja&&Q&&Q.hasOwnProperty("extent")&&"function"===typeof this.map.setExtent&&this.map.setExtent(Q.extent,!0);this.set("highlightGraphic",ma);this.set("labelGraphic",va)}this.set("selectedResult",Q);this.emit("select-result",{result:Q,source:ya,sourceIndex:M})},focus:function(){E.focus(this.inputNode)},blur:function(){this.inputNode.blur();E.curNode&&E.curNode.blur()},clearGraphics:function(){var Q=this.highlightGraphic,
ea=this.graphicsLayer,la=this.labelGraphic;Q&&(ea?ea.remove(Q):this.map&&this.map.graphics&&this.map.graphics.remove(Q));la&&(ea?ea.remove(la):this.map&&this.map.graphics&&this.map.graphics.remove(la));this.set("labelGraphic",null);this.set("highlightGraphic",null)},_mapLoaded:function(){var Q=new k;if(this.map)if(this.map.loaded)Q.resolve();else a.once(this.map,"load",r.hitch(this,function(){Q.resolve()}));else Q.resolve();return Q.promise},_init:function(){this._getMapLayers().then(r.hitch(this,
function(){this.set("loaded",!0);this.emit("load")}))},_clearButton:function(){this.clear();E.focus(this.inputNode)},_error:function(Q){return Error(this.declaredClass+" "+Q)},_searchDeferred:function(Q){var ea=new k,la=this.value,ma=this.activeSourceIndex;Q&&Q.hasOwnProperty("index")&&(ma=Q.index);this._showLoading();this._hideMenus();this._closePopup();this.clearGraphics();var M={magicKey:this.magicKey,text:la};Q?"string"===typeof Q?(M.text=Q,Q=this._searchQueries(M)):Q="object"===typeof Q&&Q.hasOwnProperty("magicKey")?
this._searchQueries(Q):"object"===typeof Q&&Q.hasOwnProperty("geometry")?this._searchQueries({geometry:Q}):"object"===typeof Q&&Q.hasOwnProperty(this._objectIdIdentifier)?this._searchQueries(Q):"object"===typeof Q&&"point"===Q.type?this._searchQueries({point:Q}):Q instanceof Array&&2===Q.length?this._searchQueries({latlon:Q}):this._searchQueries(M):Q=this._searchQueries(M);Q.always(r.hitch(this,function(W){W=this._formatResults(W,ma,la);ea.resolve(W)}));return ea.promise},_suggestDeferred:function(Q){var ea=
new k;this._deferreds.push(ea);Q||(Q=this.value);var la=this.activeSourceIndex;this._suggestQueries({text:Q}).always(r.hitch(this,function(ma){var M;if(ma)for(var W=0;W<ma.length;W++)ma[W]&&(M=!0);M?(ma=this._formatResults(ma,la,Q),ea.resolve(ma)):ea.resolve()}));return ea.promise},_getDefaultSymbol:function(Q){var ea;this.map&&(ea=this.map.getBasemap());ea||(ea="topo");if(Q&&Q.feature&&Q.feature.geometry)var la=Q.feature.geometry.type;"polyline"===la?la="line":"circle"===la||"extent"===la?la="polygon":
"multipoint"===la&&(la="point");if(la){if(Q=U.getSchemes({theme:"default",basemap:ea,geometryType:la}))var ma=Q.primaryScheme;if(ma){ma.color&&ma.hasOwnProperty("opacity")&&(ma.color.a=ma.opacity);var M=ma;Q=ma.color;ma=ma.size;switch(la){case "point":var W=new T;W.setColor(Q);W.setSize(null!==ma?ma:M.size);la=new y;la.setColor(M.outline.color);la.setWidth(M.outline.width);W.setOutline(la);break;case "line":W=new y;W.setColor(Q);W.setWidth(null!==ma?ma:M.width);break;case "polygon":W=new B,W.setColor(Q),
la=new y,la.setColor(M.outline.color),la.setWidth(M.outline.width),W.setOutline(la)}M=W}}return M},_selectFirstResult:function(Q,ea){if(this.autoSelect&&Q){var la;ea===this._allIndex?la=this._getFirstResult(Q):Q[ea]&&Q[ea][0]&&(la=Q[ea][0]);la&&this.select(la)}},_getSourceIndexOfResult:function(Q){var ea=this.searchResults;if(ea)for(var la in ea)if(ea[la]&&ea[la].length)for(var ma=0;ma<ea[la].length;ma++)if(ea[la][ma]===Q)return parseInt(la,10);return null},_getFirstResult:function(Q){if(Q)for(var ea in Q)if(Q[ea]&&
Q[ea][0])return Q[ea][0];return!1},_onFocus:function(){this.map&&"function"===typeof this.map.disableKeyboardNavigation&&this.map.disableKeyboardNavigation();this.emit("focus");this.inherited(arguments)},_onBlur:function(){this._hideMenus();this.map&&"function"===typeof this.map.enableKeyboardNavigation&&this.map.enableKeyboardNavigation();this.enableButtonMode&&this.loaded&&this.collapse();this.emit("blur");this.inherited(arguments)},_getMapLayers:function(){var Q=new k;if(this.addLayersFromMap&&
this.map){var ea=[],la=this.map.graphicsLayerIds;if(la&&la.length){for(var ma=0;ma<la.length;ma++){var M=this.map.getLayer(la[ma]);M&&ea.push(this._featureLayerLoaded(M))}S(ea).always(r.hitch(this,function(W){for(var da,ja=this.sources,ia=0;ia<W.length;ia++)W[ia]&&W[ia].loaded&&"Feature Layer"===W[ia].type&&(ja.push({featureLayer:W[ia],enableSuggestions:!0}),da=!0);da&&this.set("sources",ja);Q.resolve()}))}else Q.resolve()}else Q.resolve();return Q.promise},_switchCoordinatesClick:function(Q){Q.preventDefault();
if(Q=c.get(Q.target,"data-switch-coordinates"))this._cancelSuggest(),this.set("value",Q),this.search()},_moreResultsClick:function(Q){Q.preventDefault();var ea=Q.target;Q=parseInt(c.get(ea,"data-source-index"),10);ea=parseInt(c.get(ea,"data-index"),10);var la=this.searchResults;la&&la[Q]&&(Q=la[Q][ea])&&this.select(Q)},_showMoreResultsClick:function(Q){Q.preventDefault();if(Q=h.byId(this._moreResultsId)){f.toggle(Q,this.css.searchShowMoreResults);var ea=h.byId(this._moreResultsId+"_show");ea&&(f.contains(Q,
this.css.searchShowMoreResults)?c.set(ea,"textContent",v.widgets.Search.main.hideMoreResults):c.set(ea,"textContent",v.widgets.Search.main.showMoreResults))}},_featureLayerLoaded:function(Q){var ea=new k;if(Q.loaded)ea.resolve(Q);else if(Q.loadError)ea.reject(this._error("Layer failed to load."));else{var la=a.once(Q,"load",r.hitch(this,function(){ma.remove();ea.resolve(Q)}));var ma=a.once(Q,"error",r.hitch(this,function(){la.remove();ea.reject(this._error("Layer could not be loaded."))}))}return ea.promise},
_getObjectSize:function(Q){var ea=0,la;for(la in Q)Q.hasOwnProperty(la)&&ea++;return ea},_sourcesEvent:function(Q,ea){var la=c.get(ea,"data-index"),ma=b("li",this.sourcesNode);ea=n.indexOf(ma,ea);la!==this._allIndex&&(la=parseInt(la,10));"click"===Q.type||Q.keyCode===d.ENTER?(this.set("activeSourceIndex",la),E.focus(this.inputNode),this._hideSourcesMenu()):Q.keyCode===d.UP_ARROW?(Q.stopPropagation(),Q.preventDefault(),Q=ea-1,0>Q?E.focus(this.sourcesBtnNode):E.focus(ma[Q])):Q.keyCode===d.DOWN_ARROW?
(Q.stopPropagation(),Q.preventDefault(),Q=ea+1,Q>=ma.length?E.focus(this.sourcesBtnNode):E.focus(ma[Q])):Q.keyCode===d.ESCAPE&&(this._hideSourcesMenu(),E.focus(this.inputNode))},_suggestionsEvent:function(Q,ea){var la=c.get(ea,"data-source-index"),ma=parseInt(c.get(ea,"data-index"),10),M=b("li",this.suggestionsNode),W=this.sources;ea=n.indexOf(M,ea);la!==this._allIndex&&(la=parseInt(la,10));var da;this._clearQueryTimeout();"click"===Q.type||Q.keyCode===d.ENTER?((M=this.suggestResults)&&M[la]&&M[la][ma]&&
(da=M[la][ma]),da&&(da.index=la,W[la].featureLayer?(la=W[la].featureLayer.objectIdField,da[this._objectIdIdentifier]=da.feature.attributes[la],this.set("value",this._getSuggestionName(da)),this.set("selectedFeatureId",da.feature.attributes[la])):da.magicKey&&da.text&&(this.set("value",da.text),this.set("magicKey",da.magicKey)),this.search(da),E.focus(this.inputNode))):Q.keyCode===d.BACKSPACE||Q.keyCode===d.DELETE?E.focus(this.inputNode):Q.keyCode===d.UP_ARROW?(Q.stopPropagation(),Q.preventDefault(),
da=ea-1,0>da?E.focus(this.inputNode):E.focus(M[da])):Q.keyCode===d.DOWN_ARROW?(Q.stopPropagation(),Q.preventDefault(),da=ea+1,da>=M.length?E.focus(this.inputNode):E.focus(M[da])):Q.keyCode===d.ESCAPE&&(this._hideMenus(),E.focus(this.inputNode))},_getResultName:function(Q){var ea;Q.hasOwnProperty("name")&&null!==Q.name&&(ea=Q.name.toString());ea||(ea=v.widgets.Search.main.untitledResult);return ea},_getSuggestionName:function(Q){var ea;Q.hasOwnProperty("name")&&null!==Q.name&&(ea=Q.name.toString());
Q=Q.text||ea;Q||(Q=v.widgets.Search.main.untitledResult);return Q},_searchResultHTML:function(Q){var ea="";if(Q.feature&&Q.feature.attributes&&Q.feature.attributes.Addr_type&&"LatLong"===Q.feature.attributes.Addr_type){var la=Q.name.split(" ");if(2===la.length){var ma=la[0];var M=la[1]}M&&ma?(Q=parseFloat(ma),M=parseFloat(M),la=M+", "+Q,ea+='\x3cdiv class\x3d"'+this.css.searchMoreResultsItem+'"\x3e',ea+='\x3cdiv class\x3d"'+this.css.latLonHeader+'"\x3e'+v.widgets.Search.main.lonlat+"\x3c/div\x3e",
ea=ea+(Q+", "+M)+'\x3c/div\x3e\x3cdiv class\x3d"'+(this.css.searchMoreResultsItem+'"\x3e'),Q===M||90<Q||-90>Q||180<M||-180>M||(ea+='\x3cdiv class\x3d"'+this.css.latLonHeader+'"\x3e'+v.widgets.Search.main.reverseLonLatHeader+"\x3c/div\x3e",ea+='\x3ca data-switch-coordinates\x3d"'+la+'" tabindex\x3d"0" href\x3d"#"\x3e'+la+"\x3c/a\x3e\x3c/div\x3e")):ea=Q.name}else ea=Q.name;return ea},_moreResultsHTML:function(Q){var ea="",la="",ma=this.searchResults,M=this.sources,W=0;if(ma){la+='\x3cdiv class\x3d"'+
this.css.searchMoreResultsItem+'"\x3e';la+='\x3ca href\x3d"#" id\x3d"'+this._moreResultsId+'_show"\x3e'+v.widgets.Search.main.showMoreResults+"\x3c/a\x3e";la=la+'\x3c/div\x3e\x3cdiv class\x3d"'+(this.css.searchMoreResultsList+'"\x3e');la+='\x3cdiv id\x3d"'+this._moreResultsId+'_list"\x3e';for(var da in ma)if(ma[da]){var ja=ma[da].length;if(ja){var ia=1===ja&&ma[da][0]===Q;if(1<this._getObjectSize(ma)&&!ia){var pa=this._getSourceName(da);la+='\x3cdiv class\x3d"'+this.css.searchMoreResultsListHeader+
'"\x3e'+pa+"\x3c/div\x3e"}if(ja&&!ia){la+="\x3cul\x3e";pa=M[da].maxResults||this.maxResults;for(ia=0;ia<ja&&ia<pa;++ia)if(ma[da][ia]!==Q){var oa=this._getResultName(ma[da][ia]);la+='\x3cli\x3e\x3ca tabindex\x3d"0" data-index\x3d"'+ia+'" data-source-index\x3d"'+da+'" href\x3d"#"\x3e'+oa+"\x3c/a\x3e\x3c/li\x3e";W++}la+="\x3c/ul\x3e"}}}la+="\x3c/div\x3e\x3c/div\x3e"}W&&(ea+=la);return ea},_validField:function(Q,ea){return Q.getField(ea)},_validFields:function(Q,ea){if(Q&&ea&&ea.length){for(var la=0;la<
ea.length;la++)if(!this._validField(Q,ea[la]))return!1;return!0}return!1},_getCodedName:function(Q,ea){if(Q&&Q.length)for(var la=0,ma=Q.length;la<ma;la++){var M=Q[la];if(M.code===ea)return M.name}},_getCodedValue:function(Q,ea,la){if(Q&&Q.length)for(var ma=0,M=Q.length;ma<M;ma++){var W=Q[ma],da=W.name,ja=ea;la||(da=da.toLowerCase(),ja=ja.toLowerCase());if(da===ja)return W.code}return!1},_whereClause:function(Q,ea,la,ma,M){var W=null;if(Q){var da="",ja=this.reHostedFS.test(ea.url);ja&&this._containsNonLatinCharacter(Q)&&
(da="N");if(la&&la.length)for(var ia=0,pa=la.length;ia<pa;ia++){var oa="";oa=Q.replace(/'/g,"''");var ra=la[ia],wa=ea.getField(ra),va=ea.getDomain(ra);va&&"codedValue"===va.type&&(oa=this._getCodedValue(va.codedValues,oa,ma));!1!==oa&&(wa=wa.type,"esriFieldTypeString"===wa||"esriFieldTypeDate"===wa?ma&&"search"===M?oa=ra+" \x3d "+da+"'"+oa+"'":(ra=ja?ra:"UPPER("+ra+")",oa=ja?oa:oa.toUpperCase(),oa=ra+" LIKE "+da+"'"+(ma?oa+"%":"%"+oa+"%")+"'"):"esriFieldTypeOID"===wa||"esriFieldTypeSmallInteger"===
wa||"esriFieldTypeInteger"===wa||"esriFieldTypeSingle"===wa||"esriFieldTypeDouble"===wa?(oa=parseFloat(oa),oa=isNaN(oa)?!1:ra+" \x3d "+oa):oa=ra+" \x3d "+oa,oa&&(W=W?W+" or ":"",W+=oa))}}return W},_suggest:function(Q){Q||(Q={index:this.activeSourceIndex,text:this.value});var ea=new k,la=Q.index,ma=this.sources[la],M=this.enableSuggestions;ma.hasOwnProperty("enableSuggestions")&&(M=ma.enableSuggestions);var W=0;if(Q.hasOwnProperty("text")&&Q.text){var da=r.trim(Q.text);W=Q.text.length}Q=ma.minCharacters||
this.minCharacters;if(M&&da&&W>=Q&&this._supportsPagination(ma)){var ja="";ma.prefix&&(ja+=ma.prefix);ja+=da;ma.suffix&&(ja+=ma.suffix);var ia=this._defaultSR;this.map&&(ia=this.map.spatialReference);M={};ma.locator?(ma.categories&&(M.categories=ma.categories),ma.locator.outSpatialReference=ia,this.map&&ma.localSearchOptions&&ma.localSearchOptions.hasOwnProperty("distance")&&ma.localSearchOptions.hasOwnProperty("minScale")&&(W=this._getScale(),!ma.localSearchOptions.minScale||W&&W<=parseFloat(ma.localSearchOptions.minScale))&&
(M.location=this.map.extent.getCenter(),M.distance=ma.localSearchOptions.distance),M.text=ja,ma.useMapExtent&&this.map&&this.map.extent&&(M.searchExtent=this.map.extent),ma.searchExtent&&(M.searchExtent=ma.searchExtent),M.maxSuggestions=ma.maxSuggestions||this.maxSuggestions,ma.sourceCountry&&(M.countryCode=ma.sourceCountry),ma.countryCode&&(M.countryCode=ma.countryCode),ma.locator.suggestLocations(M).then(r.hitch(this,function(pa){ea.resolve(pa)}),r.hitch(this,function(pa){pa||(pa=this._error("Locator suggestLocations could not be performed."));
ea.reject(pa)}))):ma.featureLayer?this._featureLayerLoaded(ma.featureLayer).then(r.hitch(this,function(){var pa=this._getDisplayField(ma),oa=ma.searchFields||[pa],ra=[];ma.suggestionTemplate?ma.suggestionTemplate.replace(/(?:\$\{([^}]+)\})/g,function(ua,Aa){ra.push(Aa)}):ra=[pa];-1===n.indexOf(ra,ma.featureLayer.objectIdField)&&ra.push(ma.featureLayer.objectIdField);pa=this._validField(ma.featureLayer,pa);var wa=this._validFields(ma.featureLayer,ra),va=this._validFields(ma.featureLayer,oa);if(pa&&
wa&&va){pa=new K;ma.hasOwnProperty("suggestQueryParams")&&r.mixin(pa,ma.suggestQueryParams);pa.outSpatialReference=ia;pa.returnGeometry=!1;pa.num=ma.maxSuggestions||this.maxSuggestions;pa.outFields=ra;ma.useMapExtent&&this.map&&this.map.extent&&(pa.geometry=this.map.extent);ma.searchExtent&&(pa.geometry=ma.searchExtent);if(oa=this._whereClause(ja,ma.featureLayer,oa,ma.exactMatch,"suggest")){pa.where=oa;var ya=!0}ya?ma.featureLayer.queryFeatures(pa,r.hitch(this,function(ua){var Aa;(ua=ua.features)&&
(Aa=this._hydrateResults(ua,la,!0));ea.resolve(Aa)}),r.hitch(this,function(ua){ua||(ua=this._error("FeatureLayer queryFeatures errored with suggestions"));ea.reject(ua)})):ea.resolve()}else ea.reject(this._error("Invalid FeatureLayer field"))})):ea.reject(this._error("Invalid source"))}else ea.resolve();return ea.promise},_supportsPagination:function(Q){var ea;Q.locator?ea=!0:Q.featureLayer&&Q.featureLayer.advancedQueryCapabilities&&Q.featureLayer.advancedQueryCapabilities.supportsPagination&&(ea=
!0);return ea},_suggestQueries:function(Q){var ea=this.sources,la=this.activeSourceIndex,ma=[];if(la===this._allIndex)for(la=0;la<ea.length;la++){var M=Q;M.index=la;M=this._suggest(M);ma.push(M)}else Q.index=la,M=this._suggest(Q),ma.push(M);return S(ma)},_getPointFromGeometry:function(Q){switch(Q.type){case "extent":var ea=Q.getCenter();break;case "multipoint":ea=Q.getPoint(0);break;case "point":ea=Q;break;case "polygon":ea=Q.getCentroid();break;case "polyline":ea=Q.getPoint(0,0)}return ea},_searchQueries:function(Q){Q.hasOwnProperty("index")||
(Q.index=this.activeSourceIndex);var ea=[];if(Q.index===this._allIndex)for(var la=this.sources,ma=0;ma<la.length;ma++){var M=Q;M.index=ma;M=this._search(M);ea.push(M)}else Q=this._search(Q),ea.push(Q);return S(ea)},_searchButton:function(){this.enableButtonMode&&!this.expanded?(this.expand(),E.focus(this.inputNode)):(this._cancelSuggest(),this.search())},_search:function(Q){Q||(Q={text:this.value,magicKey:null,geometry:null,point:null,index:this.activeSourceIndex,latlon:null});this.selectedFeatureId&&
(Q.text=null,Q[this._objectIdIdentifier]=this.selectedFeatureId);var ea,la=new k,ma=Q.index,M=this.sources[ma],W;Q.hasOwnProperty("text")&&Q.text&&(W=r.trim(Q.text));if(M){var da="";M.prefix&&!Q.magicKey&&(da+=M.prefix);da+=W;M.suffix&&!Q.magicKey&&(da+=M.suffix);var ja=this._defaultSR;this.map&&(ja=this.map.spatialReference);if(M.locator)if(Q.hasOwnProperty("text")&&W){var ia={};M.categories&&(ia.categories=M.categories);M.locationType&&(ia.locationType=M.locationType);ja&&(M.locator.outSpatialReference=
ja);if(this.map&&M.localSearchOptions&&M.localSearchOptions.hasOwnProperty("distance")&&M.localSearchOptions.hasOwnProperty("minScale")){var pa=this._getScale();if(!M.localSearchOptions.minScale||pa&&pa<=parseFloat(M.localSearchOptions.minScale))ia.location=this.map.extent.getCenter(),ia.distance=M.localSearchOptions.distance}ia.address={};ia.maxLocations=M.maxResults||this.maxResults;M.useMapExtent&&this.map&&this.map.extent&&(ia.searchExtent=this.map.extent);M.searchExtent&&(ia.searchExtent=M.searchExtent);
M.sourceCountry&&(ia.countryCode=M.sourceCountry);M.countryCode&&(ia.countryCode=M.countryCode);Q.magicKey&&(ia.magicKey=Q.magicKey);M.singleLineFieldName?ia.address[M.singleLineFieldName]=da:ia.address["Single Line Input"]=da;M.outFields&&(ia.outFields=M.outFields);M.locator.addressToLocations(ia).then(r.hitch(this,function(oa){oa=this._hydrateResults(oa,ma,!1);la.resolve(oa)}),r.hitch(this,function(oa){oa||(oa=this._error("Locator addressToLocations could not be performed"));la.reject(oa)}))}else Q.geometry?
(ea=this._getPointFromGeometry(Q.geometry.geometry))?this._reverseGeocodePoint(ma,ea).then(function(oa){la.resolve(oa)},function(oa){la.reject(oa)}):la.reject(this._error("Invalid point to reverse geocode")):Q.point?this._reverseGeocodePoint(ma,Q.point).then(function(oa){la.resolve(oa)},function(oa){la.reject(oa)}):Q.latlon?(ia=new X(Q.latlon,this._defaultSR),this._reverseGeocodePoint(ma,ia).then(function(oa){la.resolve(oa)},function(oa){la.reject(oa)})):Q.hasOwnProperty("text")&&!W?la.resolve([]):
la.reject(this._error("Invalid query type for Locator"));else M.featureLayer?this._featureLayerLoaded(M.featureLayer).then(r.hitch(this,function(){var oa=this._getDisplayField(M),ra=M.searchFields||[oa];oa=this._validField(M.featureLayer,oa);var wa=this._validFields(M.featureLayer,ra);if(oa&&wa){oa=new K;M.hasOwnProperty("searchQueryParams")&&r.mixin(oa,M.searchQueryParams);ja&&(oa.outSpatialReference=ja,wa=this.map&&this.map.getMaxResolution()||1/Z.getUnitValueForSR(ja))&&(oa.maxAllowableOffset=
wa);oa.returnGeometry=!0;M.outFields&&(oa.outFields=M.outFields);if(!Q.hasOwnProperty(this._objectIdIdentifier)){this._supportsPagination(M)&&(oa.num=M.maxResults||this.maxResults);M.useMapExtent&&this.map&&this.map.extent&&(oa.geometry=this.map.extent);M.searchExtent&&(oa.geometry=M.searchExtent);var va=M.exactMatch}Q.hasOwnProperty("text")&&W?(ra=this._whereClause(da,M.featureLayer,ra,va,"search"))?(oa.where=ra,ra=!0):ra=!1:Q.hasOwnProperty(this._objectIdIdentifier)?(oa.objectIds=[Q[this._objectIdIdentifier]],
ra=!0):Q.geometry?(oa.geometry=Q.geometry,ra=!0):Q.point?(oa.geometry=Q.point,ra=!0):Q.latlon?(ea=new X(Q.latlon,this._defaultSR),oa.geometry=ea,ra=!0):(Q.hasOwnProperty("text")&&!W?la.resolve([]):la.reject(this._error("Invalid query type for FeatureLayer")),ra=!1);ra?M.featureLayer.queryFeatures(oa,r.hitch(this,function(ya){ya=ya.features;var ua;ya&&(ua=this._hydrateResults(ya,ma,!1));la.resolve(ua)}),r.hitch(this,function(ya){ya||(ya=this._error("FeatureLayer queryFeatures could not be performed"));
la.reject(ya)})):la.resolve()}else la.reject(this._error("Invalid FeatureLayer field"))})):la.reject(this._error("Invalid source"))}else la.reject(this._error("Source is undefined"));return la.promise},_clearQueryTimeout:function(){this._queryTimer&&clearTimeout(this._queryTimer)},_formatResults:function(Q,ea,la){la={activeSourceIndex:ea,value:la,numResults:0,numErrors:0,errors:null,results:null};var ma={},M={};if(Q)if(ea===this._allIndex)for(ea=0;ea<Q.length;ea++)Q[ea]&&(Q[ea]instanceof Error?(ma[ea]=
Q[ea],la.numErrors++):(M[ea]=Q[ea],la.numResults+=Q[ea].length));else Q[0]&&(Q[0]instanceof Error?(ma[ea]=Q[0],la.numErrors++):(M[ea]=Q[0],la.numResults+=Q[0].length));la.numErrors&&(la.errors=ma);la.numResults&&(la.results=M);return la},_reverseGeocodePoint:function(Q,ea){var la=new k,ma=this.sources[Q];if(ea&&ma){var M=ma.locationToAddressDistance||this.locationToAddressDistance;ma.locator.outSpatialReference=this._defaultSR;this.map&&(ma.locator.outSpatialReference=this.map.spatialReference);ma.locator.locationToAddress(ea,
M,r.hitch(this,function(W){W=this._hydrateResults([W],Q,!1);la.resolve(W)}),r.hitch(this,function(W){W||(W=this._error("Locator locationToAddress could not be performed"));la.reject(W)}))}else la.reject(this._error("No point or source defined for reverse geocoding"));return la.promise},_cancelDeferreds:function(){if(this._deferreds&&this._deferreds.length)for(var Q=0;Q<this._deferreds.length;Q++)this._deferreds[Q].cancel(this.declaredClass+" cancelling request");this._deferreds=[]},_sourceBtnKey:function(Q){if(Q){var ea=
b("li",this.sourcesNode);Q.keyCode===d.UP_ARROW?(Q.stopPropagation(),Q.preventDefault(),this._showSourcesMenu(),(Q=ea.length)&&E.focus(ea[Q-1])):Q.keyCode===d.DOWN_ARROW&&(Q.stopPropagation(),Q.preventDefault(),this._showSourcesMenu(),ea[0]&&E.focus(ea[0]))}},_inputKey:function(Q){if(Q){var ea=b("li",this.suggestionsNode),la=this.suggestResults;if(Q.keyCode===d.TAB||Q.keyCode===d.ESCAPE)this._cancelSuggest(),this._hideMenus();else if(Q.keyCode===d.UP_ARROW)Q.stopPropagation(),Q.preventDefault(),this._cancelSuggest(),
la&&this._showSuggestionsMenu(),(Q=ea.length)&&E.focus(ea[Q-1]);else if(Q.keyCode===d.DOWN_ARROW)Q.stopPropagation(),Q.preventDefault(),this._cancelSuggest(),la&&this._showSuggestionsMenu(),ea[0]&&E.focus(ea[0]);else{if(Q.ctrlKey||Q.metaKey||Q.keyCode===d.copyKey||Q.keyCode===d.LEFT_ARROW||Q.keyCode===d.RIGHT_ARROW||Q.keyCode===d.ENTER)return Q;this._suggestDelay()}}},_cancelSuggest:function(){this._cancelDeferreds();this._clearQueryTimeout()},_suggestDelay:function(){this._cancelSuggest();this._changeValue();
this._queryTimer=setTimeout(r.hitch(this,function(){this.suggest()}),this.suggestionDelay)},_changeValue:function(){this.set("magicKey",null);this.set("selectedFeatureId",null);this._changeAttrValue("value",this.inputNode.value);this._checkStatus()},_inputClick:function(){this._hideSourcesMenu();this._hideNoResultsMenu()},_getSourceName:function(Q){return this._sourceNames[Q]},_loadSources:function(Q){Q=n.filter(Q,function(ea){return!!ea.featureLayer});Q=n.map(Q,function(ea){return this._featureLayerLoaded(ea.featureLayer)},
this);return S(Q)},_createSourceNameMap:function(Q){return this._loadSources(Q).then(r.hitch(this,function(){var ea=n.map(Q,function(la){return la.name||la.featureLayer&&la.featureLayer.name||v.widgets.Search.main.untitledSource});this._preventDuplicateSourceNames(Q,ea);return ea}))},_getDuplicateSourceNameIndexes:function(Q){var ea={},la=[];n.forEach(Q,function(ma,M){ea.hasOwnProperty(ma)?(-1===la.indexOf(ea[ma])&&la.push(ea[ma]),la.push(M)):Q.lastIndexOf(ma)!==M&&(ea[ma]=M)});return la},_preventDuplicateSourceNames:function(Q,
ea){if(ea&&1<ea.length){var la=this._getDuplicateSourceNameIndexes(ea);n.forEach(la,function(ma){ea[ma]+=this._getFieldsString(Q[ma])},this)}},_getFieldsString:function(Q){var ea="",la=Q.featureLayer;if(la){Q=Q.searchFields||[this._getDisplayField(Q)];for(var ma=0;ma<Q.length;ma++){ea=0===ma?ea+": ":ea+", ";var M=Q[ma],W=la.getFieldLabel(M);ea+=W||M}}return ea},_splitResult:function(Q,ea){ea=g.escapeString(ea);return Q.replace(new RegExp("(^|)("+ea+")(|$)","ig"),"$1|$2|$3").split("|")},_insertSuggestions:function(Q,
ea){if(this.enableSuggestionsMenu&&this.suggestionsNode){this._hideSourcesMenu();this._hideNoResultsMenu();var la=this.sources;if(Q){var ma=q.create("div");for(var M in Q)if(Q[M]&&Q[M].length){var W=this._getSourceName(M);1<la.length&&this.activeSourceIndex===this._allIndex&&q.create("div",{className:this.css.searchMenuHeader,textContent:W},ma);W=q.create("ul",{role:"menu"},ma);for(var da=la[M].maxSuggestions||this.maxSuggestions,ja=0;ja<Q[M].length&&ja<da;++ja){var ia=q.create("li",{"data-index":ja,
"data-source-index":M,role:"menuitem",tabindex:0},W),pa=this._getSuggestionName(Q[M][ja]);pa=this._splitResult(pa,ea);for(var oa=pa.length,ra=0;ra<oa;ra++){var wa=pa[ra];wa.toLowerCase()===ea.toLowerCase()?q.create("strong",{textContent:wa},ia):(wa=document.createTextNode(wa),q.place(wa,ia))}}}}ma?(q.place(ma,this.suggestionsNode,"only"),this._showSuggestionsMenu()):(q.empty(this.suggestionsNode),this._hideSuggestionsMenu())}},_insertSources:function(Q){if(this.enableSourcesMenu&&Q&&1<Q.length){var ea,
la=this.activeSourceIndex,ma=q.create("ul",{role:"menu"});if(this.enableSearchingAll){var M="";la===this._allIndex&&(M="active");q.create("li",{"data-index":this._allIndex,role:"menuitem",className:M,tabIndex:0,textContent:v.widgets.Search.main.all},ma)}for(ea=0;ea<Q.length;ea++){M="";ea===la&&(M=this.css.activeSource);var W=this._getSourceName(ea);q.create("li",{"data-index":ea,role:"menuitem",className:M,tabIndex:0,textContent:W},ma)}f.add(this.containerNode,this.css.hasMultipleSources);q.place(ma,
this.sourcesNode,"only")}else f.remove(this.containerNode,this.css.hasMultipleSources),q.empty(this.sourcesNode)},_showLoading:function(){f.add(this.containerNode,this.css.searchLoading)},_hideLoading:function(){f.remove(this.containerNode,this.css.searchLoading)},_checkStatus:function(){this.value?(f.add(this.containerNode,this.css.hasValue),c.set(this.clearNode,"title",v.widgets.Search.main.clearButtonTitle)):this.clear()},_closePopup:function(){this.enableInfoWindow&&this.map&&this.map.infoWindow&&
this.map.infoWindow.hide()},_noResults:function(Q){var ea;Q&&(ea=r.trim(Q));var la=q.create("div",{className:this.css.searchNoResultsBody});Q&&ea?(q.create("div",{className:this.css.searchNoResultsHeader,textContent:v.widgets.Search.main.noResults},la),q.create("div",{className:this.css.searchNoResultsText,textContent:J.substitute({value:'"'+Q+'"'},v.widgets.Search.main.noResultsFound)},la)):(Q=q.create("div",{},la),q.create("span",{"aria-hidden":"true",className:this.css.searchNoValueIcon},Q),q.create("span",
{className:this.css.searchNoValueText,textContent:v.widgets.Search.main.emptyValue},Q));q.place(la,this.noResultsMenuNode,"only")},_hideMenus:function(){this._hideSourcesMenu();this._hideSuggestionsMenu();this._hideNoResultsMenu()},_hideNoResultsMenu:function(){f.remove(this.containerNode,this.css.showNoResults)},_showNoResultsMenu:function(){this._hideSourcesMenu();this._hideSuggestionsMenu();f.add(this.containerNode,this.css.showNoResults)},_hideSourcesMenu:function(){f.remove(this.containerNode,
this.css.showSources)},_hideSuggestionsMenu:function(){f.remove(this.containerNode,this.css.showSuggestions)},_showSourcesMenu:function(){this._hideSuggestionsMenu();this._hideNoResultsMenu();f.add(this.containerNode,this.css.showSources)},_showSuggestionsMenu:function(){this._hideSourcesMenu();this._hideNoResultsMenu();f.add(this.containerNode,this.css.showSuggestions)},_toggleSourcesMenu:function(){this._hideSuggestionsMenu();this._hideNoResultsMenu();f.toggle(this.containerNode,this.css.showSources)},
_getFirstStringField:function(Q){if(Q&&(Q=Q.fields)&&Q.length)for(var ea=0;ea<Q.length;ea++){var la=Q[ea];if("esriFieldTypeString"===la.type)return la.name}return""},_getDisplayField:function(Q){return Q.displayField||Q.featureLayer.displayField||this._getFirstStringField(Q.featureLayer)},_validLocation:function(Q){return Q&&"number"===typeof Q.x&&"number"===typeof Q.y},_validExtent:function(Q){return Q&&"number"===typeof Q.xmin&&"number"===typeof Q.ymin&&"number"===typeof Q.xmax&&"number"===typeof Q.ymax},
_hydrateResult:function(Q,ea,la){var ma={},M=this._defaultSR;ea=this.sources[ea];this.map&&(M=this.map.spatialReference);if(Q.hasOwnProperty("text")&&Q.hasOwnProperty("magicKey"))return Q;if(Q.hasOwnProperty("geometry")){var W=new N(Q.toJson());ma.feature=W;(W=ma.feature.geometry)&&W.setSpatialReference(M)}else if(Q.hasOwnProperty("location")&&this._validLocation(Q.location)){var da=new X(Q.location.x,Q.location.y,M);W={};Q.hasOwnProperty("attributes")&&(W=Q.attributes);Q.hasOwnProperty("address")&&
"object"===typeof Q.address&&r.mixin(W,Q.address);Q.hasOwnProperty("score")&&(W.score=Q.score);ma.feature=new N(da,null,W,null)}!ma.feature&&la&&(W={},Q.hasOwnProperty("attributes")&&(W=Q.attributes),Q.hasOwnProperty("score")&&(W.score=Q.score),ma.feature=new N(null,null,W,null));if(ma.feature){if(Q.hasOwnProperty("extent")&&this._validExtent(Q.extent))ma.extent=new Y(Q.extent),ma.extent.setSpatialReference(M);else if(ma.feature&&ma.feature.geometry)switch(ma.feature.geometry.type){case "extent":ma.extent=
ma.feature.geometry;break;case "multipoint":ma.extent=aa.getDenormalizedExtent(ma.feature.geometry);break;case "polygon":ma.extent=aa.getDenormalizedExtent(ma.feature.geometry);break;case "polyline":ma.extent=aa.getDenormalizedExtent(ma.feature.geometry);break;case "point":this.map?(M=this.zoomScale,ea&&ea.zoomScale&&(M=ea.zoomScale),this._getScale()>M?ma.extent=Z.getExtentForScale(this.map,M).centerAt(ma.feature.geometry):ma.extent=this.map.extent.centerAt(ma.feature.geometry)):ma.extent=new Y({xmin:ma.feature.geometry.x-
.25,ymin:ma.feature.geometry.y-.25,xmax:ma.feature.geometry.x+.25,ymax:ma.feature.geometry.y+.25,spatialReference:this._defaultSR})}else ma.extent=null;ma.name="";ea.featureLayer?ea.suggestionTemplate&&la?ma.name=J.substitute(Q.attributes,ea.suggestionTemplate):ea.searchTemplate?ma.name=J.substitute(Q.attributes,ea.searchTemplate):(W=this._getDisplayField(ea),la=ea.featureLayer.getField(W),M=ea.featureLayer.getDomain(W),W&&Q.hasOwnProperty("attributes")&&Q.attributes.hasOwnProperty(W)&&(Q=Q.attributes[W],
M&&"codedValue"===M.type?ma.name=this._getCodedName(M.codedValues,Q):la&&"esriFieldTypeDate"===la.type&&!isNaN(Q)?ma.name=t.format(new Date(Q)):ma.name=Q)):Q.address&&ea.searchTemplate?ma.name=J.substitute(Q.address,ea.searchTemplate):Q.hasOwnProperty("name")?ma.name=Q.name:Q.hasOwnProperty("attributes")&&"object"===typeof Q.attributes&&Q.attributes.LongLabel?ma.name=Q.attributes.LongLabel:Q.hasOwnProperty("attributes")&&"object"===typeof Q.attributes&&Q.attributes.Match_addr?(ma.name=Q.attributes.Match_addr,
Q.attributes.Addr_type&&"POI"===Q.attributes.Addr_type&&Q.attributes.StAddr&&Q.attributes.City?ma.name+=" - "+Q.attributes.StAddr+", "+Q.attributes.City:Q.attributes.Addr_type&&"POI"===Q.attributes.Addr_type&&Q.attributes.City&&(ma.name+=" - "+Q.attributes.City)):Q.hasOwnProperty("address")&&"string"===typeof Q.address?ma.name=Q.address:Q.hasOwnProperty("address")&&"object"===typeof Q.address&&Q.address.hasOwnProperty("Address")?Q.address.hasOwnProperty("Match_addr")?ma.name=Q.address.Match_addr:
Q.address.hasOwnProperty("Address")&&(ma.name=Q.address.Address):ma.feature&&ma.feature.geometry&&(ma.name=ma.feature.geometry.x+","+ma.feature.geometry.y);ea.featureLayer&&ma.feature&&ba(ma.feature,ea.featureLayer);return ma}},_getScale:function(){var Q;this.map&&"function"===typeof this.map.getScale&&(Q=this.map.getScale());return Q},_hydrateResults:function(Q,ea,la,ma){ma=[];var M=0;if(Q&&Q.length)for(M;M<Q.length;M++){var W=this._hydrateResult(Q[M],ea,la);W&&ma.push(W)}return ma},_containsNonLatinCharacter:function(Q){for(var ea=
0;ea<Q.length;ea++)if(255<Q.charCodeAt(ea))return!0;return!1},_setPlaceholder:function(Q){var ea="",la=this.sources[Q];Q===this._allIndex?ea=this.allPlaceholder||v.widgets.Search.main.allPlaceholder:la&&la.placeholder&&(ea=la.placeholder);var ma=v.widgets.Search.main.all;la&&(ma=this._getSourceName(Q));c.set(this.sourceNameNode,"textContent",ma);c.set(this.inputNode,"placeholder",ea);c.set(this.inputNode,"title",ea)},_updateActiveSource:function(){var Q=this.sources,ea=this.activeSourceIndex,la;Q&&
Q[ea]&&(la=Q[ea]);la?this.set("activeSource",la):this.set("activeSource",null)},_updateVisible:function(){this.visible?this.show():this.hide()},_updateButtonMode:function(Q){Q?(f.toggle(this.containerNode,this.css.searchExpanded,this.expanded),f.toggle(this.containerNode,this.css.searchCollapsed,!this.expanded),f.add(this.containerNode,this.css.hasButtonMode)):(f.remove(this.containerNode,this.css.searchExpanded),f.remove(this.containerNode,this.css.searchCollapsed),f.remove(this.containerNode,this.css.hasButtonMode))},
_setDefaultActiveSourceIndex:function(Q){Q&&1===Q.length||!this.enableSearchingAll?this.set("activeSourceIndex",0):this.set("activeSourceIndex",this._allIndex)},_setEnableSourcesMenuAttr:function(Q){this._set("enableSourcesMenu",Q);this._created&&this._insertSources(this.sources)},_setEnableSearchingAllAttr:function(Q){this._set("enableSearchingAll",Q);this._created&&(this._setDefaultActiveSourceIndex(this.sources),this._hideMenus(),this._insertSources(this.sources))},_setSourcesAttr:function(Q){this._createSourceNameMap(Q).then(r.hitch(this,
function(ea){this._sourceNames=ea;this._created&&(this._setDefaultActiveSourceIndex(Q),this._hideMenus(),this._insertSources(Q))}));this._set("sources",Q)},_setAllPlaceholderAttr:function(Q){this._set("allPlaceholder",Q);this._created&&this._setPlaceholder(this.activeSourceIndex)},_setActiveSourceIndexAttr:function(Q){this._set("activeSourceIndex",Q);this._updateActiveSource();this._created&&(this._setPlaceholder(Q),this._hideMenus(),this._insertSources(this.sources))},_setMaxLengthAttr:function(Q){this._set("maxLength",
Q);this._created&&c.set(this.inputNode,"maxLength",Q)},_setValueAttr:function(Q){this.set("magicKey",null);this.set("selectedFeatureId",null);this._set("value",Q);this._created&&(c.set(this.inputNode,"value",Q),this._checkStatus())},_setVisibleAttr:function(Q){this._set("visible",Q);this._created&&this._updateVisible()},_setEnableButtonModeAttr:function(Q){this._set("enableButtonMode",Q);this._created&&this._updateButtonMode(Q)},_setThemeAttr:function(Q){this._created&&(f.remove(this.domNode,this.theme),
f.add(this.domNode,Q));this._set("theme",Q)}});e("extend-esri")&&r.setObject("dijit.Search",u,L);return u})},"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),function(G,u,r,n,m,k,d,a,b,e,g){G=G(e,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],
"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},constructor:function(h){this._geocodeHandler=u.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=u.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=u.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},outSpatialReference:null,setOutSpatialReference:function(h){this.outSpatialReference=h},_geocodeHandler:function(h,c,f,l,q){try{var t=h.candidates;c=[];var v,
w=t.length,x=h.spatialReference,H;for(v=0;v<w;v++){var A=t[v];if(H=A.location)H.spatialReference=x;c[v]=new g(A)}this._successHandler([c],"onAddressToLocationsComplete",f,q)}catch(z){this._errorHandler(z,l,q)}},_geocodeAddressesHandler:function(h,c,f,l,q){try{var t=h.locations;c=[];var v,w=t.length,x=h.spatialReference,H;for(v=0;v<w;v++){if(H=t[v].location)H.spatialReference=x;c[v]=new g(t[v])}this._successHandler([c],"onAddressesToLocationsComplete",f,q)}catch(A){this._errorHandler(A,l,q)}},addressToLocations:function(h,
c,f,l,q){var t;if(h.address){l=f;f=c;c=h.outFields;q=h.searchExtent;var v=h.countryCode;var w=h.magicKey;var x=h.distance;var H=h.categories;h.location&&this.normalization&&(t=h.location.normalize());var A=h.locationType;var z=h.maxLocations;var E=h.forStorage;h=h.address}q&&(q=q.shiftCentralMeridian());var J=this.outSpatialReference;h=this._encode(u.mixin({},this._url.query,h,{f:"json",outSR:J&&m.toJson(J.toJson()),outFields:c&&c.join(",")||null,searchExtent:q&&m.toJson(q.toJson()),category:H&&H.join(",")||
null,countryCode:v||null,magicKey:w||null,distance:x||null,location:t||null,locationType:A||null,maxLocations:z||null,forStorage:E||null}));var D=this._geocodeHandler,L=this._errorHandler,C=new n(b._dfdCanceller);C._pendingDfd=a({url:this._url.path+"/findAddressCandidates",content:h,callbackParamName:"callback",load:function(N,S){D(N,S,f,l,C)},error:function(N){L(N,l,C)}});return C},suggestLocations:function(h){var c=new n(b._dfdCanceller);h.hasOwnProperty("location")&&this.normalization&&(h.location=
h.location.normalize());h.searchExtent&&(h.searchExtent=h.searchExtent.shiftCentralMeridian());h=this._encode(u.mixin({},this._url.query,{f:"json",text:h.text,maxSuggestions:h.maxSuggestions,searchExtent:h.searchExtent&&m.toJson(h.searchExtent.toJson()),category:h.categories&&h.categories.join(",")||null,countryCode:h.countryCode||null,location:h.location||null,distance:h.distance||null},{f:"json"}));h=a({url:this._url.path+"/suggest",content:h,callbackParamName:"callback"});c._pendingDfd=h;h.then(u.hitch(this,
function(f){f=f.suggestions||[];this.onSuggestLocationsComplete(f);c.resolve(f)}),u.hitch(this,function(f){this._errorHandler(f);c.reject(f)}));return c},addressesToLocations:function(h,c,f){var l=this.outSpatialReference,q=[],t=h.categories,v=h.locationType,w=h.countryCode;r.forEach(h.addresses,function(z,E){q.push({attributes:z})});h=this._encode(u.mixin({},this._url.query,{category:t&&t.join(",")||null,locationType:v||null,sourceCountry:w||null},{addresses:m.toJson({records:q})},{f:"json",outSR:l&&
m.toJson(l.toJson())}));var x=this._geocodeAddressesHandler,H=this._errorHandler,A=new n(b._dfdCanceller);A._pendingDfd=a({url:this._url.path+"/geocodeAddresses",content:h,callbackParamName:"callback",load:function(z,E){x(z,E,c,f,A)},error:function(z){H(z,f,A)}});return A},_reverseGeocodeHandler:function(h,c,f,l,q){try{var t=new g({address:h.address,location:h.location,score:100});this._successHandler([t],"onLocationToAddressComplete",f,q)}catch(v){this._errorHandler(v,l,q)}},locationToAddress:function(h,
c,f,l){h&&this.normalization&&(h=h.normalize());var q=this.outSpatialReference;h=this._encode(u.mixin({},this._url.query,{outSR:q&&m.toJson(q.toJson()),location:h&&m.toJson(h.toJson()),distance:c,f:"json"}));var t=this._reverseGeocodeHandler,v=this._errorHandler,w=new n(b._dfdCanceller);w._pendingDfd=a({url:this._url.path+"/reverseGeocode",content:h,callbackParamName:"callback",load:function(x,H){t(x,H,f,l,w)},error:function(x){v(x,l,w)}});return w},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},
onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}});k("extend-esri")&&u.setObject("tasks.Locator",G,d);return G})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(G,u,r,n,m){G=G(null,{declaredClass:"esri.tasks.AddressCandidate",constructor:function(k){u.mixin(this,k);this.location=new m(this.location)}});r("extend-esri")&&u.setObject("tasks.AddressCandidate",G,n);return G})},
"esri/styles/basic":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/has","../kernel","../Color"],function(G,u,r,n,m){function k(g,h){if(g){var c={};c.color=new m(g.color);c.opacity=g.opacity||1;switch(h){case "point":c.outline={color:new m(g.outline.color),width:g.outline.width};c.size=g.size;break;case "line":c.width=g.width;break;case "polygon":c.outline={color:new m(g.outline.color),width:g.outline.width}}}return c}function d(g){if("esriGeometryPoint"===g||"esriGeometryMultipoint"===
g)g="point";else if("esriGeometryPolyline"===g)g="line";else if("esriGeometryPolygon"===g||"esriGeometryMultiPatch"===g)g="polygon";return g}var a={"default":{name:"default",label:"Default",description:"Default theme for basic visualization of features.",basemapGroups:{light:"streets gray topo terrain national-geographic oceans osm gray-vector streets-vector topo-vector streets-relief-vector streets-navigation-vector".split(" "),dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector"]},
pointSchemes:{light:{primary:{color:[77,77,77,1],outline:{color:[255,255,255,.25],width:1},size:8},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,.25],width:1},size:8},{color:[255,255,255,1],outline:{color:[51,51,51,.25],width:1},size:8}]},dark:{primary:{color:[255,255,255,1],outline:{color:[92,92,92,.25],width:1},size:8},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,.25],width:1},size:8},{color:[26,26,26,1],outline:{color:[178,178,178,.25],width:1},size:8}]}},lineSchemes:{light:{primary:{color:[77,
77,77,1],width:2},secondary:[{color:[226,119,40,1],width:2},{color:[255,255,255,1],width:2}]},dark:{primary:{color:[255,255,255,1],width:2},secondary:[{color:[226,119,40,1],width:2},{color:[26,26,26,1],width:2}]}},polygonSchemes:{light:{primary:{color:[227,139,79,1],outline:{color:[255,255,255,.25],width:1},opacity:.8},secondary:[{color:[128,128,128,1],outline:{color:[255,255,255,.25],width:1},opacity:.8},{color:[255,255,255,1],outline:{color:[128,128,128,.25],width:1},opacity:.8}]},dark:{primary:{color:[227,
139,79,1],outline:{color:[92,92,92,.25],width:1},opacity:.8},secondary:[{color:[178,178,178,1],outline:{color:[92,92,92,.25],width:1},opacity:.8},{color:[26,26,26,1],outline:{color:[128,128,128,.25],width:1},opacity:.8}]}}}},b={};(function(){var g,h,c;for(g in a){var f=a[g];var l=f.basemapGroups;var q=b[g]={basemaps:[].concat(l.light).concat(l.dark),point:{},line:{},polygon:{}};for(h in l){var t=l[h];for(c=0;c<t.length;c++){var v=t[c];f.pointSchemes&&(q.point[v]=f.pointSchemes[h]);f.lineSchemes&&
(q.line[v]=f.lineSchemes[h]);f.polygonSchemes&&(q.polygon[v]=f.polygonSchemes[h])}}}})();var e={getAvailableThemes:function(g){var h=[],c;for(c in a){var f=a[c];var l=b[c];g&&-1===G.indexOf(l.basemaps,g)||h.push({name:f.name,label:f.label,description:f.description,basemaps:l.basemaps.slice(0)})}return h},getSchemes:function(g){var h=g.theme,c=g.basemap,f=d(g.geometryType);g=b[h];var l;(g=(g=g&&g[f])&&g[c])&&(l={primaryScheme:k(g.primary,f),secondarySchemes:G.map(g.secondary,function(q){return k(q,
f)})});return l},cloneScheme:function(g){if(g){var h=u.mixin({},g);h.color&&(h.color=new m(h.color));h.outline&&(h.outline={color:h.outline.color&&new m(h.outline.color),width:h.outline.width})}return h}};r("extend-esri")&&u.setObject("styles.basic",e,n);return e})},"esri/tasks/RouteTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../request ../geometry/normalizeUtils ./Task ./RouteResult ./NAMessage ./NAServiceDescription".split(" "),function(G,
u,r,n,m,k,d,a,b,e,g,h){G=G([b,h],{declaredClass:"esri.tasks.RouteTask",_eventMap:{"solve-complete":["result"]},constructor:function(c){this._url.orig=this._url.path;this._url.path+="/solve";this._handler=u.hitch(this,this._handler);this.registerConnectEvents()},__msigns:[{n:"solve",c:3,a:[{i:0,p:["stops.features","barriers.features","polylineBarriers.features","polygonBarriers.features"]}],e:2}],_handler:function(c,f,l,q,t){try{var v=[],w=[],x=c.directions||[],H=c.routes?c.routes.features:[],A=c.stops?
c.stops.features:[],z=c.barriers?c.barriers.features:[],E=c.polygonBarriers?c.polygonBarriers.features:[],J=c.polylineBarriers?c.polylineBarriers.features:[],D=c.messages,L=r.forEach,C=r.indexOf,N=!0,S,F,T=c.routes&&c.routes.spatialReference||c.stops&&c.stops.spatialReference||c.barriers&&c.barriers.spatialReference||c.polygonBarriers&&c.polygonBarriers.spatialReference||c.polylineBarriers&&c.polylineBarriers.spatialReference;this._chk=c.checksum;L(x,function(I){v.push(S=I.routeName);w[S]={directions:I}});
L(H,function(I){-1===C(v,S=I.attributes.Name)&&(v.push(S),w[S]={});w[S].route=I});L(A,function(I){F=I.attributes;-1===C(v,S=F.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME")&&(v.push(S),w[S]={});"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==S&&(N=!1);void 0===w[S].stops&&(w[S].stops=[]);w[S].stops.push(I)});0<A.length&&!0===N&&(w[v[0]].stops=w["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,delete w["esri.tasks.RouteTask.NULL_ROUTE_NAME"],v.splice(r.indexOf(v,"esri.tasks.RouteTask.NULL_ROUTE_NAME"),1));
var y=[];L(v,function(I,P){w[I].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===I?null:I;w[I].spatialReference=T;y.push(new e(w[I]))});c=function(I){L(I,function(P,X){P.geometry&&(P.geometry.spatialReference=T);I[X]=new k(P)});return I};L(D,function(I,P){D[P]=new g(I)});var B={routeResults:y,barriers:c(z),polygonBarriers:c(E),polylineBarriers:c(J),messages:D};this._successHandler([B],"onSolveComplete",l,t)}catch(I){this._errorHandler(I,q,t)}},solve:function(c,f,l,q){var t=q.assembly;c=this._encode(u.mixin({},
this._url.query,{f:"json"},c.toJson(t&&t[0]),this._chk?{checksum:this._chk}:{}));var v=this._handler,w=this._errorHandler;return d({url:this._url.path,timeout:25E4,content:c,callbackParamName:"callback",load:function(x,H){v(x,H,f,l,q.dfd)},error:function(x){w(x,l,q.dfd)}})},onSolveComplete:function(){}});a._createWrappers(G);n("extend-esri")&&u.setObject("tasks.RouteTask",G,m);return G})},"esri/tasks/RouteResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ./DirectionsFeatureSet".split(" "),
function(G,u,r,n,m,k,d){G=G(null,{declaredClass:"esri.tasks.RouteResult",constructor:function(a){var b=a.spatialReference,e=a.route;if(a.directions){var g=[],h=[],c=[];r.forEach(a.directions.features,function(l,q){h[q]=l.compressedGeometry;g[q]=l.strings;c[q]=l.events});a.directions.strings=g;a.directions.events=c;this.directions=new d(a.directions,h)}this.routeName=a.routeName;e&&(e.geometry&&(e.geometry.spatialReference=b),this.route=new k(e));if(a.stops){var f=this.stops=[];r.forEach(a.stops,function(l,
q){l.geometry&&(l.geometry.spatialReference=b);f[l.attributes.Sequence-1]=new k(l)})}},routeName:null,directions:null,route:null,stops:null});n("extend-esri")&&u.setObject("tasks.RouteResult",G,m);return G})},"esri/tasks/DirectionsFeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/json ../kernel ../geometry/Extent ../geometry/Polyline ../geometry/Point ../graphic ./FeatureSet".split(" "),function(G,u,r,n,m,k,d,a,b,e,g){G=G(g,{declaredClass:"esri.tasks.DirectionsFeatureSet",
constructor:function(h,c){this.routeId=h.routeId;this.routeName=h.routeName;u.mixin(this,h.summary);this.extent=new d(this.envelope);var f=this._fromCompressedGeometry,l=this.features,q=this.extent.spatialReference,t=[];r.forEach(c,function(v,w){l[w].setGeometry(t[w]=v?f(v,q):l[w].geometry)});this.mergedGeometry=this._mergePolylinesToSinglePath(t,q);this.geometryType="esriGeometryPolyline";r.forEach(h.events,function(v,w){r.forEach(v,function(x,H){v[H]=new e(new b(x.point.x,x.point.y,q),null,{ETA:x.ETA,
strings:m.stringify(x.strings),arriveTimeUTC:x.arriveTimeUTC})});h.events[w]=v});delete this.envelope},_fromCompressedGeometry:function(h,c){var f=0,l=0,q=0,t=0,v=[],w=0,x=0,H=0;(h=h.match(/((\+|\-)[^\+\-\|]+|\|)/g))||(h=[]);if(0===parseInt(h[w],32)){w=2;var A=parseInt(h[w],32);w++;var z=parseInt(h[w],32);w++;if(A&1){x=r.indexOf(h,"|")+1;var E=parseInt(h[x],32);x++}if(A&2){H=r.indexOf(h,"|",x)+1;var J=parseInt(h[H],32);H++}}else z=parseInt(h[w],32),w++;for(;w<h.length&&"|"!==h[w];){A=parseInt(h[w],
32)+f;w++;f=A;var D=parseInt(h[w],32)+l;w++;l=D;A=[A/z,D/z];x&&(D=parseInt(h[x],32)+q,x++,q=D,A.push(D/E));H&&(D=parseInt(h[H],32)+t,H++,t=D,A.push(D/J));v.push(A)}f=new a({paths:[v],hasZ:0<x,hasM:0<H});f.setSpatialReference(c);return f},_mergePolylinesToSinglePath:function(h,c){var f=[],l=!1;r.forEach(h,function(v){r.forEach(v.paths,function(w){l=l||v.hasM;f=f.concat(w)})});var q=[],t=[0,0];r.forEach(f,function(v){if(v[0]!==t[0]||v[1]!==t[1])q.push(v),t=v});return new a({paths:[q],spatialReference:c,
hasM:l})}});n("extend-esri")&&u.setObject("tasks.DirectionsFeatureSet",G,k);return G})},"esri/tasks/NAMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(G,u,r,n){G=G(null,{declaredClass:"esri.tasks.NAMessage",constructor:function(m){u.mixin(this,m)}});u.mixin(G,{TYPE_INFORMATIVE:0,TYPE_PROCESS_DEFINITION:1,TYPE_PROCESS_START:2,TYPE_PROCESS_STOP:3,TYPE_WARNING:50,TYPE_ERROR:100,TYPE_EMPTY:101,TYPE_ABORT:200});r("extend-esri")&&u.setObject("tasks.NAMessage",
G,n);return G})},"esri/tasks/NAServiceDescription":function(){define(["dojo/_base/declare","dojo/json","dojo/Deferred","dojo/_base/lang","../request"],function(G,u,r,n,m){return G(null,{declaredClass:"esri.tasks._NAServiceDescription",_sd:null,getServiceDescription:function(k,d){var a=new r;if(this._sd)a.resolve(this._sd);else if(this._url&&this._url.orig){var b=this._url.orig,e=(this._url.path.match(/\/solve$/)||[]).length?"Route":(this._url.path.match(/\/solveClosestFacility$/)||[]).length?"ClosestFacility":
"ServiceAreas",g,h=function(c){m({url:c+("/"===c[c.length-1]?"":"/")+"GetTravelModes/execute",content:{f:"json",serviceName:e},callbackParamName:"callback"}).then(function(f){var l=[],q=null;if(f&&f.results&&f.results.length)for(var t=0;t<f.results.length;t++)if("supportedTravelModes"===f.results[t].paramName){if(f.results[t].value&&f.results[t].value.features)for(var v=0;v<f.results[t].value.features.length;v++)if(f.results[t].value.features[v].attributes){var w=u.parse(f.results[t].value.features[v].attributes.TravelMode);
l.push(w)}}else"defaultTravelMode"===f.results[t].paramName&&(q=f.results[t].value);g.supportedTravelModes=l;g.defaultTravelMode=q;a.resolve(g)},function(f){console.log("Could not read from the routingUtilities service.");a.reject(f)})};m({url:b,content:{f:"json"},callbackParamName:"callback"}).then(function(c){g=c;g.supportedTravelModes||(g.supportedTravelModes=[]);for(c=0;c<g.supportedTravelModes.length;c++)g.supportedTravelModes[c].id||(g.supportedTravelModes[c].id=g.supportedTravelModes[c].itemId);
d?a.resolve(g):k?h(k):10.4<=g.currentVersion?m({url:b+("/"===b[b.length-1]?"":"/")+"retrieveTravelModes",content:{f:"json"},callbackParamName:"callback"}).then(function(f){g.supportedTravelModes=f.supportedTravelModes;g.defaultTravelMode=f.defaultTravelMode;a.resolve(g)},function(f){console.log("Could not get to the NAServer's retrieveTravelModes.");a.reject(f)}):m({url:b.substring(0,b.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).then(function(f){f.owningSystemUrl?
(b=f.owningSystemUrl,m({url:b+("/"===b[b.length-1]?"":"/")+"sharing/rest/portals/self",content:{f:"json"},callbackParamName:"callback"}).then(function(l){l&&l.helperServices&&l.helperServices.routingUtilities&&l.helperServices.routingUtilities.url?h(l.helperServices.routingUtilities.url):(console.log("Portal does not have helperServices.routingUtilities defined."),a.resolve(g))},function(l){console.log("Could not get to the portal's self.");a.reject(l)})):a.resolve(g)},function(f){console.log("Could not get to the NAServer service description.");
a.reject(f)})},function(c){a.reject(c)})}else a.reject("NA Task has no URL specified.");a.then(n.hitch(this,function(c){this._sd=c}),n.hitch(this,function(){this._sd=null}));return a.promise},getOwningSystemUrl:function(){var k=new r;if(this._url&&this._url.orig){var d=this._url.orig;m({url:d.substring(0,d.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).promise.always(function(a){k.resolve(a.owningSystemUrl)})}else k.resolve(void 0);return k.promise}})})},"esri/tasks/RouteParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang ../graphicsUtils ./NATypes".split(" "),
function(G,u,r,n,m,k,d,a){G=G(null,{declaredClass:"esri.tasks.RouteParameters",accumulateAttributes:null,attributeParameterValues:null,barriers:null,directionsLanguage:null,directionsLengthUnits:null,directionsOutputType:null,directionsStyleName:null,directionsTimeAttribute:null,doNotLocateOnRestrictedElements:!0,findBestSequence:null,ignoreInvalidLocations:null,impedanceAttribute:null,outputLines:"esriNAOutputLineTrueShape",outputGeometryPrecision:null,outputGeometryPrecisionUnits:null,outSpatialReference:null,
overrides:null,polygonBarriers:null,polylineBarriers:null,preserveFirstStop:null,preserveLastStop:null,restrictionAttributes:null,restrictUTurns:null,returnBarriers:!1,returnDirections:!1,returnPolygonBarriers:!1,returnPolylineBarriers:!1,returnRoutes:!0,returnStops:!1,returnZ:!0,startTime:null,startTimeIsUTC:null,timeWindowsAreUTC:null,stops:null,useHierarchy:null,useTimeWindows:null,travelMode:null,toJson:function(b){var e={returnDirections:this.returnDirections,returnRoutes:this.returnRoutes,returnZ:this.returnZ,
returnStops:this.returnStops,returnBarriers:this.returnBarriers,returnPolygonBarriers:this.returnPolygonBarriers,returnPolylineBarriers:this.returnPolylineBarriers,attributeParameterValues:this.attributeParameterValues&&r.toJson(this.attributeParameterValues),outSR:this.outSpatialReference?this.outSpatialReference.wkid||r.toJson(this.outSpatialReference.toJson()):null,outputLines:this.outputLines,overrides:this.overrides,findBestSequence:this.findBestSequence,preserveFirstStop:this.preserveFirstStop,
preserveLastStop:this.preserveLastStop,useTimeWindows:this.useTimeWindows,startTime:this.startTime?this.startTime.getTime():null,startTimeIsUTC:this.startTimeIsUTC,timeWindowsAreUTC:this.timeWindowsAreUTC,accumulateAttributeNames:this.accumulateAttributes?this.accumulateAttributes.join(","):null,ignoreInvalidLocations:this.ignoreInvalidLocations,impedanceAttributeName:this.impedanceAttribute,restrictionAttributeNames:this.restrictionAttributes?this.restrictionAttributes.join(","):null,restrictUTurns:this.restrictUTurns,
useHierarchy:this.useHierarchy,directionsLanguage:this.directionsLanguage,outputGeometryPrecision:this.outputGeometryPrecision,outputGeometryPrecisionUnits:this.outputGeometryPrecisionUnits,directionsLengthUnits:a.LengthUnit[this.directionsLengthUnits],directionsTimeAttributeName:this.directionsTimeAttribute,directionsStyleName:this.directionsStyleName,travelMode:"object"===typeof this.travelMode?r.toJson(this.travelMode):this.travelMode},g=this.stops;"esri.tasks.FeatureSet"===g.declaredClass&&0<
g.features.length?e.stops=r.toJson({type:"features",features:d._encodeGraphics(g.features,b&&b["stops.features"]),doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}):"esri.tasks.DataLayer"===g.declaredClass?e.stops=g:"esri.tasks.DataFile"===g.declaredClass&&(e.stops=r.toJson({type:"features",url:g.url,doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}));if(this.directionsOutputType)switch(this.directionsOutputType.toLowerCase()){case "complete":e.directionsOutputType=
"esriDOTComplete";break;case "complete-no-events":e.directionsOutputType="esriDOTCompleteNoEvents";break;case "instructions-only":e.directionsOutputType="esriDOTInstructionsOnly";break;case "standard":e.directionsOutputType="esriDOTStandard";break;case "summary-only":e.directionsOutputType="esriDOTSummaryOnly";break;default:e.directionsOutputType=this.directionsOutputType}g=function(h,c){return h?"esri.tasks.FeatureSet"===h.declaredClass?0<h.features.length?r.toJson({type:"features",features:d._encodeGraphics(h.features,
b&&b[c])}):null:"esri.tasks.DataLayer"===h.declaredClass?h:"esri.tasks.DataFile"===h.declaredClass?r.toJson({type:"features",url:h.url}):r.toJson(h):null};this.barriers&&(e.barriers=g(this.barriers,"barriers.features"));this.polygonBarriers&&(e.polygonBarriers=g(this.polygonBarriers,"polygonBarriers.features"));this.polylineBarriers&&(e.polylineBarriers=g(this.polylineBarriers,"polylineBarriers.features"));return k.filter(e,function(h){if(null!==h)return!0})}});n("extend-esri")&&u.setObject("tasks.RouteParameters",
G,m);return G})},"esri/tasks/NATypes":function(){define(["dojo/_base/lang","dojo/has","../kernel"],function(G,u,r){var n={esriFeet:"esriNAUFeet",esriKilometers:"esriNAUKilometers",esriMeters:"esriNAUMeters",esriMiles:"esriNAUMiles",esriNauticalMiles:"esriNAUNauticalMiles",esriYards:"esriNAUYards"},m={NONE:"esriNAOutputLineNone",STRAIGHT:"esriNAOutputLineStraight",TRUE_SHAPE:"esriNAOutputLineTrueShape",TRUE_SHAPE_WITH_MEASURE:"esriNAOutputLineTrueShapeWithMeasure"},k={ALLOW_BACKTRACK:"esriNFSBAllowBacktrack",
AT_DEAD_ENDS_ONLY:"esriNFSBAtDeadEndsOnly",NO_BACKTRACK:"esriNFSBNoBacktrack",AT_DEAD_ENDS_AND_INTERSECTIONS:"esriNFSBAtDeadEndsAndIntersections"},d={NONE:"esriNAOutputPolygonNone",SIMPLIFIED:"esriNAOutputPolygonSimplified",DETAILED:"esriNAOutputPolygonDetailed"},a={FROM_FACILITY:"esriNATravelDirectionFromFacility",TO_FACILITY:"esriNATravelDirectionToFacility"},b={LengthUnit:n,OutputLine:m,UTurn:k,OutputPolygon:d,TravelDirection:a};u("extend-esri")&&(G.setObject("tasks._NALengthUnit",n,r),G.setObject("tasks.NAOutputLine",
m,r),G.setObject("tasks.NAUTurn",k,r),G.setObject("tasks.NAOutputPolygon",d,r),G.setObject("tasks.NATravelDirection",a,r));return b})},"esri/tasks/PrintTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../lang ../layerUtils ../deferredUtils ../Color ../request ../urlUtils ../geometry/Polygon ../renderers/SimpleRenderer ../symbols/FillSymbol ./Geoprocessor ./PrintTemplate ./Task dojo/dom-attr dojo/dom-construct dojox/gfx/_base dojox/gfx/canvas dojox/json/query dojo/has!extend-esri?./PrintParameters dojo/has!extend-esri?./LegendLayer".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z,E){G=G(w,{declaredClass:"esri.tasks.PrintTask",constructor:function(J,D){this.url=J;this.printGp=new t(this.url);this._handler=u.hitch(this,this._handler);D&&D.async&&(this.async=!0);this._colorEvaluator=E("$..color")},async:!1,_vtlExtent:null,_cimVersion:null,_is11xService:!1,_loadGpServerMetadata:!0,execute:function(J,D,L){if(!this._loadGpServerMetadata)return this._execute(J,D,L);var C=new m(e._dfdCanceller),N=this._url.path,S=N.lastIndexOf("/GPServer/");
0<S&&(N=N.slice(0,S+9));C._pendingDfd=h({url:N,callbackParamName:"callback",content:u.mixin({},this._url.query,{f:"json"})}).then(u.hitch(this,function(F){this._loadGpServerMetadata=!1;this.async="esriExecutionTypeAsynchronous"===F.executionType;this._cimVersion=F.cimVersion;this._is11xService=!!this._cimVersion;C._pendingDfd=this._execute(J);return C._pendingDfd})).then(u.hitch(this,function(F){this._successHandler([F],null,D,C)})).otherwise(function(F){L&&L(F);C.errback(F)});return C},_handler:function(J,
D,L,C,N){try{if(this.async)"esriJobSucceeded"===J.jobStatus?this.printGp.getResultData(J.jobId,"Output_File",u.hitch(this,function(F){S=F.value;this._successHandler([S],"onComplete",L,N)})):this._errorHandler(Error(J.jobStatus),C,N);else{var S=J[0].value;this._successHandler([S],"onComplete",L,N)}}catch(F){this._errorHandler(F,C,N)}},_execute:function(J,D,L){var C=this._handler,N=this._errorHandler,S=J.template||new v;S.hasOwnProperty("showLabels")||(S.showLabels=!0);var F=S.exportOptions,T;F&&(T=
{outputSize:[F.width,F.height],dpi:F.dpi});F=S.layoutOptions;var y=[];if(F){this.legendAll=!1;F.legendLayers?r.forEach(F.legendLayers,function(U){var ba={};ba.id=U.layerId;U.subLayerIds&&(ba.subLayerIds=U.subLayerIds);y.push(ba)}):this.legendAll=!0;if("Miles"===F.scalebarUnit||"Kilometers"===F.scalebarUnit){var B="esriKilometers";var I="esriMiles"}else if("Meters"===F.scalebarUnit||"Feet"===F.scalebarUnit)B="esriMeters",I="esriFeet";var P={esriMiles:"mi",esriKilometers:"km",esriFeet:"ft",esriMeters:"m"};
P={titleText:F.titleText,authorText:F.authorText,copyrightText:F.copyrightText,customTextElements:F.customTextElements,scaleBarOptions:{metricUnit:B,metricLabel:P[B],nonMetricUnit:I,nonMetricLabel:P[I]},legendOptions:{operationalLayers:y}}}B=this._getPrintDefinition(J.map,S);J.outSpatialReference&&(B.mapOptions.spatialReference=J.outSpatialReference.toJson());J.template&&a.isDefined(J.template.showAttribution)&&(B.mapOptions.showAttribution=J.template.showAttribution);u.mixin(B,{exportOptions:T,layoutOptions:P});
this.allLayerslegend&&u.mixin(B.layoutOptions,{legendOptions:{operationalLayers:this.allLayerslegend}});if(B.operationalLayers){T=B.operationalLayers;var X=function(U){return a.fixJson(u.mixin(U,{type:"esriSLS",cap:void 0,join:void 0,meterLimit:void 0}))},Y=/[\u4E00-\u9FFF\u0E00-\u0E7F\u0900-\u097F\u3040-\u309F\u30A0-\u30FF\u31F0-\u31FF]/,aa=/[\u0600-\u06FF]/,Z=function(U){var ba=U.text,Q=(U=U.font)&&U.family&&U.family.toLowerCase();ba&&U&&("arial"===Q||"arial unicode ms"===Q)&&(U.family=Y.test(ba)?
"Arial Unicode MS":"Arial","normal"!==U.style&&aa.test(ba)&&(U.family="Arial Unicode MS"))};for(P=0;P<T.length;P++)if(T[P].featureCollection&&T[P].featureCollection.layers)for(I=0;I<T[P].featureCollection.layers.length;I++){var fa=T[P].featureCollection.layers[I];if(fa.layerDefinition&&fa.layerDefinition.drawingInfo&&fa.layerDefinition.drawingInfo.renderer&&fa.layerDefinition.drawingInfo.renderer.symbol){var K=fa.layerDefinition.drawingInfo.renderer;"esriCLS"===K.symbol.type?K.symbol=X(K.symbol):
"esriTS"===K.symbol.type?Z(K.symbol):K.symbol.outline&&"esriCLS"===K.symbol.outline.type&&(K.symbol.outline=X(K.symbol.outline))}if(fa.featureSet&&fa.featureSet.features)for(F=0;F<fa.featureSet.features.length;F++)K=fa.featureSet.features[F],K.symbol&&("esriCLS"===K.symbol.type?K.symbol=X(K.symbol):"esriTS"===K.symbol.type?Z(K.symbol):K.symbol.outline&&"esriCLS"===K.symbol.outline.type&&(K.symbol.outline=X(K.symbol.outline)))}}S={Web_Map_as_JSON:n.toJson(a.fixJson(B)),Format:S.format,Layout_Template:S.layout};
J.extraParameters&&(S=u.mixin(S,J.extraParameters));var R=new m(e._dfdCanceller);J=function(U,ba){C(U,ba,D,L,R)};B=function(U){N(U,L,R)};R._pendingDfd=this.async?this.printGp.submitJob(S,J,null,B):this.printGp.execute(S,J,B);return R},onComplete:function(){},_createMultipointLayer:function(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}},_createPolygonLayer:function(){return{layerDefinition:{name:"polygonLayer",
geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}},_createPointLayer:function(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}},_createPolylineLayer:function(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",
features:[]}}},_convertSvgSymbol:function(J){if(!(8>=k("ie")||!J.path&&"image/svg+xml"!==J.contentType)){var D=z.createSurface(H.create("div"),1024,1024);var L="image/svg+xml"===J.contentType?D.createObject(z.Image,{src:"data:image/svg+xml;base64,"+J.imageData,width:A.pt2px(J.width),height:A.pt2px(J.height),x:0,y:0}):D.createObject(z.Path,J.path).setFill(J.color).setStroke(J.outline);"pendingRender"in D&&D._render(!0);var C=D.rawNode.getContext("2d"),N=Math.ceil(L.getBoundingBox().width),S=Math.ceil(L.getBoundingBox().height);
L=C.getImageData(L.getBoundingBox().x,L.getBoundingBox().y,N,S);C.canvas.width=N;C.canvas.height=S;C.putImageData(L,0,0);C=C.canvas.toDataURL("image/png");J={type:"esriPMS",imageData:C.substr(22,C.length),angle:J.angle,contentType:"image/png",height:J.size?J.size:A.px2pt(S),width:J.size?N/S*J.size:A.px2pt(N),xoffset:J.xoffset,yoffset:J.yoffset};D.destroy();return J}},_convertSvgRenderer:function(J){"simple"===J.type&&J.symbol&&(J.symbol.path||"image/svg+xml"===J.symbol.contentType)?J.symbol=this._convertSvgSymbol(J.symbol):
"uniqueValue"===J.type?(J.defaultSymbol&&(J.defaultSymbol.path||"image/svg+xml"===J.defaultSymbol.contentType)&&(J.defaultSymbol=this._convertSvgSymbol(J.defaultSymbol)),J.uniqueValueInfos&&r.forEach(J.uniqueValueInfos,function(D){if(D.symbol.path||"image/svg+xml"===D.symbol.contentType)D.symbol=this._convertSvgSymbol(D.symbol)},this)):"classBreaks"===J.type&&(J.defaultSymbol&&(J.defaultSymbol.path||"image/svg+xml"===J.defaultSymbol.contentType)&&(J.defaultSymbol=this._convertSvgSymbol(J.defaultSymbol)),
J.classBreakInfos&&r.forEach(J.classBreakInfos,function(D){if(D.symbol.path||"image/svg+xml"===D.symbol.contentType)D.symbol=this._convertSvgSymbol(D.symbol)},this))},_createFeatureCollection:function(J,D,L,C){var N=this._createPolygonLayer(),S=this._createPolylineLayer(),F=this._createPointLayer(),T=this._createMultipointLayer(),y=this._createPointLayer();y.layerDefinition.name="textLayer";delete y.layerDefinition.drawingInfo;if("esri.layers.FeatureLayer"===J.declaredClass||"esri.layers.StreamLayer"===
J.declaredClass)N.layerDefinition.name=S.layerDefinition.name=F.layerDefinition.name=T.layerDefinition.name=u.getObject("arcgisProps.title",!1,J)||J.name||J.id;var B=J.renderer&&"esri.renderer.SimpleRenderer"===J.renderer.declaredClass;if(!J.renderer||J.renderer.valueExpression||u.isFunction(J.renderer.attributeField))delete N.layerDefinition.drawingInfo,delete S.layerDefinition.drawingInfo,delete F.layerDefinition.drawingInfo,delete T.layerDefinition.drawingInfo;else{var I=J.renderer.toJson({useLegacyRotationProperties:!0});
if("temporal"===I.type){I={latestObservationRenderer:I.latestObservationRenderer,trackLinesRenderer:I.trackRenderer,observationAger:I.observationAger,renderer:I.observationRenderer};var P={};J._trackIdField&&(P.trackIdField=J._trackIdField);J._startTimeField&&(P.startTimeField=J._startTimeField);J._endTimeField&&(P.endTimeField=J._endTimeField);N.layerDefinition.drawingInfo=I;N.layerDefinition.timeInfo=P;S.layerDefinition.drawingInfo=I;S.layerDefinition.timeInfo=P;F.layerDefinition.drawingInfo=I;
F.layerDefinition.timeInfo=P;T.layerDefinition.drawingInfo=I;T.layerDefinition.timeInfo=P}else N.layerDefinition.drawingInfo.renderer=I,S.layerDefinition.drawingInfo.renderer=I,F.layerDefinition.drawingInfo.renderer=I,T.layerDefinition.drawingInfo.renderer=I}I=J.fields;I||!J.renderer||J.renderer.valueExpression||u.isFunction(J.renderer.attributeField)||("esri.renderer.ClassBreaksRenderer"===J.renderer.declaredClass?(I=[{name:J.renderer.attributeField,type:"esriFieldTypeDouble"}],J.renderer.normalizationField&&
I.push({name:J.renderer.normalizationField,type:"esriFieldTypeDouble"})):"esri.renderer.UniqueValueRenderer"===J.renderer.declaredClass&&(I=[{name:J.renderer.attributeField,type:"esriFieldTypeString"}],J.renderer.attributeField2&&I.push({name:J.renderer.attributeField2,type:"esriFieldTypeString"}),J.renderer.attributeField3&&I.push({name:J.renderer.attributeField3,type:"esriFieldTypeString"})));I&&(N.layerDefinition.fields=I,S.layerDefinition.fields=I,F.layerDefinition.fields=I,T.layerDefinition.fields=
I);I=J.graphics;J.isFeatureReductionActive&&J.isFeatureReductionActive()&&(I=J.getSingleGraphics());P=I.length;var X;for(X=0;X<P;X++){var Y=I[X];if(!1!==Y.visible&&Y.geometry){var aa=Y.toJson();aa.symbol&&aa.symbol.outline&&aa.symbol.outline.color&&aa.symbol.outline.color[3]&&!this._is11xService&&(aa.symbol.outline.color[3]=255);if(J.renderer&&!aa.symbol&&(u.isFunction(J.renderer.attributeField)||J.renderer.valueExpression||this._isFeatureCollectionRequired(J.renderer,J)||"esri.renderer.DotDensityRenderer"===
J.renderer.declaredClass||L)){L=L||J.renderer;var Z=null;try{Z=L.getSymbol(Y)}catch(fa){}if(!Z)continue;aa.symbol=Z.toJson();this._isFeatureCollectionRequired(L,J)&&this._applyVisualVariables(aa.symbol,{renderer:L,graphic:Y,symbol:Z,mapResolution:D&&D.getResolutionInMeters(),mapScale:D&&D.getScale()})}aa.symbol&&(aa.symbol.path||"image/svg+xml"===aa.symbol.contentType?aa.symbol=this._convertSvgSymbol(aa.symbol):aa.symbol.text&&delete aa.attributes);switch(Y.geometry.type){case "polygon":N.featureSet.features.push(aa);
break;case "polyline":S.featureSet.features.push(aa);break;case "point":aa.symbol&&aa.symbol.text?y.featureSet.features.push(aa):F.featureSet.features.push(aa);break;case "multipoint":T.featureSet.features.push(aa);break;case "extent":aa.geometry=f.fromExtent(Y.geometry).toJson(),N.featureSet.features.push(aa)}}}D=[];0<N.featureSet.features.length&&D.push(N);0<S.featureSet.features.length&&D.push(S);0<T.featureSet.features.length&&D.push(T);0<F.featureSet.features.length&&D.push(F);0<y.featureSet.features.length&&
D.push(y);if(!D.length)return null;r.forEach(D,function(fa){var K=r.every(fa.featureSet.features,function(R){return R.symbol});if(B||K)C&&C.forceFeatureAttributes||r.forEach(fa.featureSet.features,function(R){delete R.attributes}),C.forceFeatureAttributes||delete fa.layerDefinition.fields;K&&delete fa.layerDefinition.drawingInfo});r.forEach(D,function(fa){fa.layerDefinition.drawingInfo&&fa.layerDefinition.drawingInfo.renderer&&this._convertSvgRenderer(fa.layerDefinition.drawingInfo.renderer)},this);
return{id:J.id,opacity:J.opacity,minScale:J.minScale||0,maxScale:J.maxScale||0,featureCollection:{layers:D}}},_getPrintDefinition:function(J,D){var L={operationalLayers:this._createOperationalLayers(J,D)},C=this._vtlExtent||J.extent,N=J.spatialReference;this._vtlExtent=null;J.spatialReference._isWrappable()&&(C=C._normalize(!0),N=C.spatialReference);C={mapOptions:{showAttribution:J.showAttribution,extent:C.toJson(),spatialReference:N.toJson()}};D.preserveScale&&u.mixin(C.mapOptions,{scale:D.outScale||
J.getScale()});J.timeExtent&&u.mixin(C.mapOptions,{time:[J.timeExtent.startTime.getTime(),J.timeExtent.endTime.getTime()]});J={};u.mixin(J,C,L);return J},_createOperationalLayers:function(J,D){var L,C=[],N=0;D.preserveScale&&(N=D.outScale||J.getScale());this.allLayerslegend=this.legendAll?[]:null;this._vtlExtent=null;var S=r.map(J.layerIds,J.getLayer,J);J._mapImageLyr&&S.push(J._mapImageLyr);for(L=0;L<S.length;L++){var F=S[L];if(F.loaded&&F.visible&&(!N||F.isVisibleAtScale(N))){var T=F.declaredClass;
var y={id:F.id,title:u.getObject("arcgisProps.title",!1,F)||F.id,opacity:F.opacity,minScale:F.minScale||0,maxScale:F.maxScale||0};y=u.mixin(y,this._getUrlAndToken(F));F.getNode()&&x.get(F.getNode(),"data-reference")&&(y._isRefLayer=!0);switch(T){case "esri.layers.ArcGISDynamicMapServiceLayer":var B=[];T=!!F._params.layers;if(F._params.dynamicLayers)T=D.outScale?F._getDynLayerObjs(D.outScale):n.fromJson(F._params.dynamicLayers),r.forEach(T,function(aa){B.push({id:aa.id,name:aa.name,layerDefinition:aa});
delete aa.id;delete aa.name;delete aa.maxScale;delete aa.minScale}),0===B.length&&(y.visibleLayers=[-1]);else if(F.supportsDynamicLayers){if(T||F.layerDefinitions||F.layerTimeOptions){var I=F.createDynamicLayerInfosFromLayerInfos(),P=null;T&&(P=F.visibleLayers);P=b._getVisibleLayers(I,P);var X=b._getLayersForScale(D.outScale||J.getScale(),I);r.forEach(I,function(aa){if(!aa.subLayerIds){var Z=aa.id;-1<r.indexOf(P,Z)&&-1<r.indexOf(X,Z)&&(aa={source:aa.source.toJson()},F.layerDefinitions&&F.layerDefinitions[Z]&&
(aa.definitionExpression=F.layerDefinitions[Z]),F.layerTimeOptions&&F.layerTimeOptions[Z]&&(aa.layerTimeOptions=F.layerTimeOptions[Z].toJson()),B.push({id:Z,layerDefinition:aa}))}});0===B.length&&(y.visibleLayers=[-1])}}else r.forEach(F.layerInfos,function(aa){var Z={id:aa.id,layerDefinition:{}};F.layerDefinitions&&F.layerDefinitions[aa.id]&&(Z.layerDefinition.definitionExpression=F.layerDefinitions[aa.id]);F.layerTimeOptions&&F.layerTimeOptions[aa.id]&&(Z.layerDefinition.layerTimeOptions=F.layerTimeOptions[aa.id].toJson());
(Z.layerDefinition.definitionExpression||Z.layerDefinition.layerTimeOptions)&&B.push(Z)}),T&&(y.visibleLayers=F.visibleLayers.length?F.visibleLayers:[-1]);B.length&&(y.layers=B);C.push(y);this.allLayerslegend&&this.allLayerslegend.push({id:F.id,subLayerIds:F.visibleLayers});break;case "esri.layers.ArcGISImageServiceLayer":y=u.mixin(y,{url:F.url,bandIds:F.bandIds,compressionQuality:F.compressionQuality,format:F.format,interpolation:F.interpolation});F.mosaicRule&&u.mixin(y,{mosaicRule:F.mosaicRule.toJson()});
if(F.renderingRule||F.renderer)this._is11xService?(F.renderingRule&&(y.renderingRule=F.renderingRule.toJson()),F.renderer&&(y.layerDefinition=y.layerDefinition||{},y.layerDefinition.drawingInfo=y.layerDefinition.drawingInfo||{},y.layerDefinition.drawingInfo.renderer=F.renderer.toJson())):(T=F.getExportImageRenderingRule())&&u.mixin(y,{renderingRule:T.toJson()});C.push(y);this.allLayerslegend&&this.allLayerslegend.push({id:F.id});break;case "esri.layers.RasterXLayer":this._is11xService&&(y=u.mixin(y,
{url:F.url,bandIds:F.bandIds,interpolation:F.interpolation}),F.renderer&&(y.layerDefinition=y.layerDefinition||{},y.layerDefinition.drawingInfo=y.layerDefinition.drawingInfo||{},y.layerDefinition.drawingInfo.renderer=F.renderer.toJson()),C.push(y),this.allLayerslegend&&this.allLayerslegend.push({id:F.id}));break;case "esri.layers.WMSLayer":y=u.mixin(y,{url:F.url,title:F.title,type:"wms",version:F.version,transparentBackground:F.imageTransparency,visibleLayers:F.visibleLayers});C.push(y);this.allLayerslegend&&
this.allLayerslegend.push({id:F.id,subLayerIds:F.visibleLayers});break;case "esri.virtualearth.VETiledLayer":T=F.mapStyle;"roadOnDemand"===T?T="Road":"aerialWithLabelsOnDemand"===T&&(T="Hybrid");y=u.mixin(y,{visibility:F.visible,type:"BingMaps"+T,culture:F.culture,key:F.bingMapsKey});C.push(y);break;case "esri.layers.OpenStreetMapLayer":y=u.mixin(y,{credits:F.copyright,type:"OpenStreetMap",url:c.getAbsoluteUrl(F.tileServers[0])});C.push(y);break;case "esri.layers.WMTSLayer":y=u.mixin(y,{url:F.url,
type:"wmts",layer:F._identifier,style:F._style,format:F.format,tileMatrixSet:F._tileMatrixSetId});C.push(y);break;case "esri.layers.MapImageLayer":T=F.getImages();r.forEach(T,function(aa,Z){aa.visible&&aa.href&&(y={id:F.id+"_image"+Z,type:"image",title:F.id,minScale:F.minScale||0,maxScale:F.maxScale||0,opacity:F.opacity*aa.opacity,extent:aa.extent.toJson()},"data:image/png;base64,"===aa.href.substr(0,22)?y.imageData=aa.href.substr(22):y.url=aa.href,C.push(y))});break;case "esri.layers.VectorTileLayer":delete y.url;
delete y.token;if(this._is11xService&&F.currentStyleInfo.serviceUrl&&F.currentStyleInfo.styleUrl&&(T=d.id&&d.id.findCredential(F.currentStyleInfo.styleUrl),I=d.id&&d.id.findCredential(F.currentStyleInfo.serviceUrl),!T&&!I||"2.1.0"!==this._cimVersion)){y.type="VectorTileLayer";y.styleUrl=F.currentStyleInfo.styleUrl;T&&(y.token=T.token);I&&I.token!==y.token&&(y.additionalTokens=[{url:F.currentStyleInfo.serviceUrl,token:I.token}]);C.push(y);break}y.type="image";T=this._vtlExtent||J.extent.offset(0,0);
var Y=D.exportOptions&&D.exportOptions.dpi||96;I={format:"png",pixelRatio:Y/96};"MAP_ONLY"!==D.layout||!D.preserveScale||D.outScale&&D.outScale!==J.getScale()||96!==Y||!D.exportOptions||D.exportOptions.width%2===J.width%2&&D.exportOptions.height%2===J.height%2||(I.area={x:0,y:0,width:J.width,height:J.height},D.exportOptions.width%2!==J.width%2&&--I.area.width,D.exportOptions.height%2!==J.height%2&&--I.area.height,this._vtlExtent||(Y=J.toMap({x:I.area.width,y:I.area.height}),T.update(T.xmin,Y.y,Y.x,
T.ymax,T.spatialReference),this._vtlExtent=T));y.extent=T._normalize(!0).toJson();T=F.takeScreenshot(I);T.isResolved()?T.then(function(aa){"data:image/png;base64,"===aa.dataURL.substr(0,22)&&(y.imageData=aa.dataURL.substr(22))}):console.error("PrintTask: VectorTileLayer.takeScreenshot() returned an unresolved Promise");y.imageData&&C.push(y);break;case "esri.layers.WebTiledLayer":T=F.url.replace(/\$\{/g,"{");y=u.mixin(y,{type:"WebTiledLayer",urlTemplate:T,credits:F.copyright});F.subDomains&&0<F.subDomains.length&&
(y.subDomains=F.subDomains);F._wmtsInfo&&(y.wmtsInfo=F._wmtsInfo);delete y.url;C.push(y);break;default:if(F.getTileUrl||F.getImageUrl)y=u.mixin(y,{url:F.url}),C.push(y)}}}S=r.map(J.graphicsLayerIds,J.getLayer,J);for(L=0;L<S.length;L++)F=S[L],F.isFeatureReductionActive&&F.isFeatureReductionActive()&&(F.getSingleGraphics().length?S.splice(++L,0,F.getFeatureReductionLayer()):S[L]=F.getFeatureReductionLayer());for(L=0;L<S.length;L++)if(F=S[L],F.loaded&&F.visible&&(!N||F.isVisibleAtScale(N)))switch(T=
F.declaredClass,T){case "esri.layers.CSVLayer":if(this._is11xService){y={id:F.id,url:F.url,title:F.title,opacity:F.opacity,minScale:F.minScale||0,maxScale:F.maxScale||0,type:"CSV",locationInfo:{latitudeFieldName:F.latitudeFieldName,longitudeFieldName:F.longitudeFieldName},layerDefinition:{drawingInfo:{renderer:F.renderer&&F.renderer.toJson({useLegacyRotationProperties:!0})}}};C.push(y);break}case "esri.layers.FeatureLayer":case "esri.layers.LabelLayer":case "esri.layers.StreamLayer":if("esri.layers.LabelLayer"===
T&&!D.showLabels||F.renderer&&"esri.renderer.HeatmapRenderer"===F.renderer.declaredClass)continue;T=null;F.url&&F.renderer&&("esri.renderer.ScaleDependentRenderer"===F.renderer.declaredClass?"scale"===F.renderer.rangeType?T=F.renderer.getRendererInfoByScale(J.getScale())&&F.renderer.getRendererInfoByScale(J.getScale()).renderer:"zoom"===F.renderer.rangeType&&(T=F.renderer.getRendererInfoByZoom(J.getZoom())&&F.renderer.getRendererInfoByZoom(J.getZoom()).renderer):T=F.renderer);I=T&&"esri.layers.CSVLayer"!==
F.declaredClass&&!this._isFeatureCollectionRequired(T,F)&&!T.valueExpression;Y=F.isFeatureReductionActive&&F.isFeatureReductionActive();if(T&&!Y&&"esri.renderer.DotDensityRenderer"!==T.declaredClass&&"esri.layers.StreamLayer"!==F.declaredClass&&(this._is11xService||I)&&("esri.renderer.SimpleRenderer"===T.declaredClass||"esri.renderer.TemporalRenderer"===T.declaredClass||null==T.attributeField||u.isString(T.attributeField)&&F._getField(T.attributeField,!0)))if(y={id:F.id,title:u.getObject("arcgisProps.title",
!1,F)||F.id,opacity:F.opacity,minScale:F.minScale||0,maxScale:F.maxScale||0,layerDefinition:{drawingInfo:{renderer:T.toJson({useLegacyRotationProperties:!0})}}},y=u.mixin(y,this._getUrlAndToken(F)),"esri.renderer.TemporalRenderer"===T.declaredClass&&(I=y.layerDefinition.drawingInfo,I.latestObservationRenderer=I.renderer.latestObservationRenderer,I.trackLinesRenderer=I.renderer.trackRenderer,I.observationAger=I.renderer.observationAger,I.renderer=I.renderer.observationRenderer,F._trackIdField&&(y.layerDefinition.timeInfo=
{trackIdField:F._trackIdField})),this._convertSvgRenderer(y.layerDefinition.drawingInfo.renderer),this._is11xService||1>F.opacity||"esri.renderer.TemporalRenderer"===T.declaredClass||this._updateLayerOpacity(y))if(F._params.source&&(T=F._params.source.toJson(),u.mixin(y.layerDefinition,{source:T})),F.getDefinitionExpression()&&u.mixin(y.layerDefinition,{definitionExpression:F.getDefinitionExpression()}),2!==F.mode)0<F.getSelectedFeatures().length&&(T=r.map(F.getSelectedFeatures(),function(aa){return aa.attributes[F.objectIdField]}),
0<T.length&&F.getSelectionSymbol()&&u.mixin(y,{selectionObjectIds:T,selectionSymbol:F.getSelectionSymbol().toJson()}));else{T=r.map(F.getSelectedFeatures(),function(aa){return aa.attributes[F.objectIdField]});if(0===T.length||!F._params.drawMode)break;u.mixin(y.layerDefinition,{objectIds:T});T=null;F.getSelectionSymbol()&&(T=new l(F.getSelectionSymbol()));u.mixin(y.layerDefinition.drawingInfo,{renderer:T&&T.toJson()})}else y=this._createFeatureCollection(F,J,null,D);else y=T&&(T.valueExpression||
this._isFeatureCollectionRequired(T,F)||"esri.renderer.DotDensityRenderer"===T.declaredClass)?this._createFeatureCollection(F,J,T,D):this._createFeatureCollection(F,J,null,D);if(!y)continue;C.push(y);this.allLayerslegend&&this.allLayerslegend.push({id:F.id});break;case "esri.layers._GraphicsLayer":case "esri.layers.GraphicsLayer":case "esri.layers.WFSLayer":y=this._createFeatureCollection(F,J,null,D);if(!y)continue;C.push(y);this.allLayerslegend&&this.allLayerslegend.push({id:F.id});break;case "esri.layers.ArcGISImageServiceVectorLayer":y=
{id:F.id,title:u.getObject("arcgisProps.title",!1,F)||F.id,opacity:F.opacity,minScale:F.minScale||0,maxScale:F.maxScale||0,visibility:F.visible,symbolTileSize:F.symbolTileSize,layerDefinition:{drawingInfo:{renderer:F.renderer.toJson({useLegacyRotationProperties:!0})}}},y=u.mixin(y,this._getUrlAndToken(F)),F.mosaicRule&&u.mixin(y,{mosaicRule:F.mosaicRule.toJson()}),C.push(y),this.allLayerslegend&&this.allLayerslegend.push({id:F.id})}N&&r.forEach(C,function(aa){aa.minScale=0;aa.maxScale=0});J.graphics&&
0<J.graphics.graphics.length&&(y=this._createFeatureCollection(J.graphics,J,null,D))&&C.push(y);J._labels&&D.showLabels&&(y=this._createFeatureCollection(J._labels,J,null,D))&&C.push(y);r.forEach(C,function(aa,Z,fa){aa._isRefLayer&&(delete aa._isRefLayer,fa.splice(Z,1),fa.push(aa))});return C},_getUrlAndToken:function(J){return{token:J._getToken(),url:J._url?J._url.path:null}},_updateLayerOpacity:function(J){var D=this._colorEvaluator(J);D=r.filter(D,function(S){return u.isArray(S)&&4===S.length});
var L=!0;if(D.length){var C=D[0][3],N;for(N=1;N<D.length;N++)if(C!==D[N][3]){L=!1;break}if(L)for(J.opacity=C/255,N=0;N<D.length;N++)D[N][3]=255}return L},_isFeatureCollectionRequired:function(J,D){if(D&&D.isFeatureReductionActive&&D.isFeatureReductionActive())return!0;var L=!1;if(D=this._getVariable(J,"rotationInfo",!1))L=(L=D.field)&&u.isFunction(L)||D.valueExpression;return J.hasVisualVariables("sizeInfo")||J.hasVisualVariables("colorInfo")||J.hasVisualVariables("opacityInfo")||L},_getVariable:function(J,
D,L){if(J)var C=(J=J.getVisualVariablesForType(D,L))&&J[0];return C},_applyVisualVariables:function(J,D){var L=D.renderer,C=D.graphic,N=D.symbol,S=D.mapResolution,F=D.mapScale,T=N.type;if("textsymbol"!==T&&"shieldlabelsymbol"!==T){var y=this._getVariable(L,"sizeInfo",!1),B=this._getVariable(L,"colorInfo",!1),I=this._getVariable(L,"opacityInfo",!1);D=this._getVariable(L,"rotationInfo",!1);N instanceof q&&(y=this._getVariable(L,"sizeInfo","outline")||y);S=y?L.getSize(C,{sizeInfo:y,shape:"simplemarkersymbol"===
T?N.style:null,resolution:S,scale:F}):C.size;null!=S&&("simplemarkersymbol"===T?J.size=A.px2pt(S):"picturemarkersymbol"===T?(F=N.width/N.height*S,J.width=A.px2pt(F),J.height=A.px2pt(S),0!==N.xoffset&&(J.xoffset=A.px2pt(N.xoffset/N.width*F)),0!==N.yoffset&&(J.yoffset=A.px2pt(N.yoffset/N.height*S))):"simplelinesymbol"===T?J.width=A.px2pt(S):J.outline&&(J.outline.width=A.px2pt(S)));B&&(!(N=L.getColor(C,{colorInfo:B}))||"simplemarkersymbol"!==T&&"simplelinesymbol"!==T&&"simplefillsymbol"!==T||(J.color=
g.toJsonColor(N)));I&&(N=L.getOpacity(C,{opacityInfo:I}),null!=N&&J.color&&(J.color[3]=Math.round(255*N)));D&&(L=L.getRotationAngle(C,{rotationInfo:D}))&&(J.angle=-L)}}});k("extend-esri")&&u.setObject("tasks.PrintTask",G,d);return G})},"esri/tasks/Geoprocessor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has dojo/io-query ../kernel ../request ../deferredUtils ../geometry/normalizeUtils ./Task ./FeatureSet ./JobInfo ./GPMessage ./LinearUnit ./DataFile ./RasterData ./Date ./ParameterValue ./GPResultImageLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/MapImage".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z){G=G(h,{declaredClass:"esri.tasks.Geoprocessor",_eventMap:{"execute-complete":["results","messages"],"get-result-data-complete":["result"],"get-result-image-complete":["mapImage"],"get-result-image-layer-complete":["layer"],"job-cancel":["jobInfo"],"job-complete":["jobInfo"],"status-update":["jobInfo"]},constructor:function(E){this._jobUpdateHandler=u.hitch(this,this._jobUpdateHandler);this._getJobStatus=u.hitch(this,this._getJobStatus);this._getResultDataHandler=
u.hitch(this,this._getResultDataHandler);this._getResultImageHandler=u.hitch(this,this._getResultImageHandler);this._executeHandler=u.hitch(this,this._executeHandler);this._updateTimers=[];this.registerConnectEvents()},updateDelay:1E3,processSpatialReference:null,outputSpatialReference:null,outSpatialReference:null,setUpdateDelay:function(E){this.updateDelay=E},setProcessSpatialReference:function(E){this.processSpatialReference=E},setOutputSpatialReference:function(E){this._setOutSR(E)},setOutSpatialReference:function(E){this._setOutSR(E)},
__msigns:[{n:"execute",c:3,a:[{i:0,p:["*"]}],e:2,f:1},{n:"submitJob",c:4,a:[{i:0,p:["*"]}],e:3}],_setOutSR:function(E){this.outSpatialReference=this.outputSpatialReference=E},_getOutSR:function(){return this.outSpatialReference||this.outputSpatialReference},_gpEncode:function(E,J,D){for(var L in E){var C=E[L];u.isArray(C)?E[L]=m.toJson(r.map(C,function(N){return this._gpEncode({item:N},!0).item},this)):C instanceof Date&&(E[L]=C.getTime())}return this._encode(E,J,D)},_decode:function(E){var J=E.dataType,
D=new x(E);if(-1!==r.indexOf(["GPBoolean","GPDouble","GPLong","GPString"],J))return D;if("GPLinearUnit"===J)D.value=new q(D.value);else if("GPFeatureRecordSetLayer"===J||"GPRecordSet"===J)D.value=new c(D.value);else if("GPDataFile"===J)D.value=new t(D.value);else if("GPDate"===J)E=D.value,u.isString(E)?D.value=new w({date:E}):D.value=new Date(E);else if("GPRasterData"===J||"GPRasterDataLayer"===J)E=E.value.mapImage,D.value=E?new z(E):new v(D.value);else if(-1!==J.indexOf("GPMultiValue:")){var L=J.split(":")[1];
E=D.value;D.value=r.map(E,function(C){return this._decode({paramName:"_name",dataType:L,value:C}).value},this)}else console.log(this.declaredClass+" : GP Data type not handled. : "+D.dataType),D=null;return D},submitJob:function(E,J,D,L,C){var N=this._getOutSR(),S=C.assembly;E=this._gpEncode(u.mixin({},this._url.query,{f:"json","env:outSR":N?N.wkid||m.toJson(N.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||m.toJson(this.processSpatialReference.toJson()):
null},E),null,S&&S[0]);var F=this._jobUpdateHandler,T=this._errorHandler;return b({url:this._url.path+"/submitJob",content:E,callbackParamName:"callback",load:function(y,B){F(y,B,!1,J,D,C.dfd)},error:function(y){T(y,L,C.dfd)}})},_jobUpdateHandler:function(E,J,D,L,C,N){var S=E.jobId;J=new f(E);this._successHandler([J],"onStatusUpdate",C,D&&N);if(!D)switch(clearTimeout(this._updateTimers[S]),this._updateTimers[S]=null,N&&N.progress(J),E.jobStatus){case f.STATUS_SUBMITTED:case f.STATUS_EXECUTING:case f.STATUS_WAITING:case f.STATUS_NEW:var F=
this._getJobStatus;this._updateTimers[S]=setTimeout(function(){F(S,D,L,C,N)},this.updateDelay);break;default:this._successHandler([J],"onJobComplete",L,N)}},_getJobStatus:function(E,J,D,L,C){var N=this._jobUpdateHandler;b({url:this._url.path+"/jobs/"+E,content:u.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(S,F){N(S,F,J,D,L,C)},error:this._errorHandler})},_getResultDataHandler:function(E,J,D,L,C){try{var N=this._decode(E);this._successHandler([N],"onGetResultDataComplete",
D,C)}catch(S){this._errorHandler(S,L,C)}},getResultData:function(E,J,D,L){var C=this._getResultDataHandler,N=this._errorHandler,S=new n(e._dfdCanceller);S._pendingDfd=b({url:this._url.path+"/jobs/"+E+"/results/"+J,content:u.mixin({},this._url.query,{f:"json",returnType:"data"}),callbackParamName:"callback",load:function(F,T){C(F,T,D,L,S)},error:function(F){N(F,L,S)}});return S},checkJobStatus:function(E,J,D){var L=this._jobUpdateHandler,C=this._errorHandler,N=new n(e._dfdCanceller);N._pendingDfd=
b({url:this._url.path+"/jobs/"+E,content:u.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(S,F){L(S,F,!0,null,J,N)},error:function(S){C(S,D,N)}});return N},cancelJob:function(E,J,D){var L=this._errorHandler,C=new n(e._dfdCanceller);C._pendingDfd=b({url:this._url.path+"/jobs/"+E+"/cancel",content:u.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:u.hitch(this,function(N,S){this._successHandler([N],"onJobCancel",J,C)}),error:function(N){L(N,D,C)}});
return C},execute:function(E,J,D,L){var C=this._getOutSR(),N=L.assembly;E=this._gpEncode(u.mixin({},this._url.query,{f:"json","env:outSR":C?C.wkid||m.toJson(C.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||m.toJson(this.processSpatialReference.toJson()):null},E),null,N&&N[0]);var S=this._executeHandler,F=this._errorHandler;return b({url:this._url.path+"/execute",content:E,callbackParamName:"callback",load:function(T,y){S(T,y,J,D,L.dfd)},error:function(T){F(T,
D,L.dfd)}})},_executeHandler:function(E,J,D,L,C){try{var N=E.results,S,F=E.messages;var T=0;for(S=N.length;T<S;T++)N[T]=this._decode(N[T]);T=0;for(S=F.length;T<S;T++)F[T]=new l(F[T]);this._successHandler([N,F],"onExecuteComplete",D,C)}catch(y){this._errorHandler(y,L,C)}},_getResultImageHandler:function(E,J,D,L,C){try{var N=this._decode(E);this._successHandler([N],"onGetResultImageComplete",D,C)}catch(S){this._errorHandler(S,L,C)}},getResultImage:function(E,J,D,L,C){var N=this._getResultImageHandler,
S=this._errorHandler;D=this._gpEncode(u.mixin({},this._url.query,{f:"json"},D.toJson()));var F=new n(e._dfdCanceller);F._pendingDfd=b({url:this._url.path+"/jobs/"+E+"/results/"+J,content:D,callbackParamName:"callback",load:function(T,y){N(T,y,L,C,F)},error:function(T){S(T,C,F)}});return F},cancelJobStatusUpdates:function(E){clearTimeout(this._updateTimers[E]);this._updateTimers[E]=null},getResultImageLayer:function(E,J,D,L){if(null==J){var C=this._url.path.indexOf("/GPServer/");E=this._url.path.substring(0,
C)+"/MapServer/jobs/"+E}else E=this._url.path+"/jobs/"+E+"/results/"+J;this._url.query&&(E+="?"+d.objectToQuery(this._url.query));J=null==J?new A(E,{imageParameters:D}):new H(E,{imageParameters:D},!0);this.onGetResultImageLayerComplete(J);L&&L(J);return J},onStatusUpdate:function(){},onJobComplete:function(){},onExecuteComplete:function(){},onGetResultDataComplete:function(){},onGetResultImageComplete:function(){},onGetResultImageLayerComplete:function(){},onJobCancel:function(){}});g._createWrappers(G);
k("extend-esri")&&u.setObject("tasks.Geoprocessor",G,a);return G})},"esri/tasks/JobInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./GPMessage"],function(G,u,r,n,m){G=G(null,{declaredClass:"esri.tasks.JobInfo",constructor:function(k){this.messages=[];u.mixin(this,k);k=this.messages;var d,a=k.length;for(d=0;d<a;d++)k[d]=new m(k[d])},jobId:"",jobStatus:""});u.mixin(G,{STATUS_CANCELLED:"esriJobCancelled",STATUS_CANCELLING:"esriJobCancelling",STATUS_DELETED:"esriJobDeleted",
STATUS_DELETING:"esriJobDeleting",STATUS_EXECUTING:"esriJobExecuting",STATUS_FAILED:"esriJobFailed",STATUS_NEW:"esriJobNew",STATUS_SUBMITTED:"esriJobSubmitted",STATUS_SUCCEEDED:"esriJobSucceeded",STATUS_TIMED_OUT:"esriJobTimedOut",STATUS_WAITING:"esriJobWaiting"});r("extend-esri")&&u.setObject("tasks.JobInfo",G,n);return G})},"esri/tasks/GPMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(G,u,r,n){G=G(null,{declaredClass:"esri.tasks.GPMessage",constructor:function(m){u.mixin(this,
m)}});u.mixin(G,{TYPE_INFORMATIVE:"esriJobMessageTypeInformative",TYPE_PROCESS_DEFINITION:"esriJobMessageTypeProcessDefinition",TYPE_PROCESS_START:"esriJobMessageTypeProcessStart",TYPE_PROCESS_STOP:"esriJobMessageTypeProcessStop",TYPE_WARNING:"esriJobMessageTypeWarning",TYPE_ERROR:"esriJobMessageTypeError",TYPE_EMPTY:"esriJobMessageTypeEmpty",TYPE_ABORT:"esriJobMessageTypeAbort"});r("extend-esri")&&u.setObject("tasks.GPMessage",G,n);return G})},"esri/tasks/LinearUnit":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(G,u,r,n){G=G(null,{declaredClass:"esri.tasks.LinearUnit",constructor:function(m){m&&u.mixin(this,m)},distance:0,units:null,toJson:function(){var m={};this.distance&&(m.distance=this.distance);this.units&&(m.units=this.units);return m}});r("extend-esri")&&u.setObject("tasks.LinearUnit",G,n);return G})},"esri/tasks/DataFile":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(G,u,r,n){G=G(null,{declaredClass:"esri.tasks.DataFile",
constructor:function(m){m&&u.mixin(this,m)},url:null,itemID:null,toJson:function(){var m={};this.url&&(m.url=this.url);this.itemID&&(m.itemID=this.itemID);return m}});r("extend-esri")&&u.setObject("tasks.DataFile",G,n);return G})},"esri/tasks/RasterData":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(G,u,r,n){G=G(null,{declaredClass:"esri.tasks.RasterData",constructor:function(m){m&&u.mixin(this,m)},url:null,format:null,itemID:null,toJson:function(){var m=
{};this.url&&(m.url=this.url);this.format&&(m.format=this.format);this.itemID&&(m.itemID=this.itemID);return m}});r("extend-esri")&&u.setObject("tasks.RasterData",G,n);return G})},"esri/tasks/Date":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/date/locale","dojo/has","../kernel"],function(G,u,r,n,m){G=G(null,{declaredClass:"esri.tasks.Date",constructor:function(k){k&&(k.format&&(this.format=k.format),this.date=r.parse(k.date,{selector:"date",datePattern:this.format}))},date:new Date,
format:"EEE MMM dd HH:mm:ss zzz yyyy",toJson:function(){return{date:r.format(this.date,{selector:"date",datePattern:this.format}),format:this.format}}});n("extend-esri")&&u.setObject("tasks.Date",G,m);return G})},"esri/tasks/ParameterValue":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(G,u,r,n){G=G(null,{declaredClass:"esri.tasks.ParameterValue",constructor:function(m){u.mixin(this,m)}});r("extend-esri")&&u.setObject("tasks.ParameterValue",G,n);return G})},
"esri/tasks/GPResultImageLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has dojo/io-query ../kernel ../layers/ArcGISDynamicMapServiceLayer".split(" "),function(G,u,r,n,m,k,d){G=G(d,{declaredClass:"esri.tasks._GPResultImageLayer",constructor:function(a,b){b&&b.imageParameters&&b.imageParameters.extent&&(this.initialExtent=this.fullExtent=b.imageParameters.extent,this.spatialReference=this.initialExtent.spatialReference);this.getImageUrl=u.hitch(this,this.getImageUrl);
this.loaded=!0;this.onLoad(this)},getImageUrl:function(a,b,e,g){var h=a.spatialReference.wkid;g(this._url.path+"?"+m.objectToQuery(u.mixin(this._params,{f:"image",bbox:r.toJson(a.toJson()),bboxSR:h,imageSR:h,size:b+","+e})))}});n("extend-esri")&&u.setObject("tasks._GPResultImageLayer",G,k);return G})},"esri/tasks/PrintTemplate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(G,u,r,n){G=G(null,{declaredClass:"esri.tasks.PrintTemplate",label:null,exportOptions:{width:800,
height:1100,dpi:96},layoutOptions:null,format:"PNG32",layout:"MAP_ONLY",outScale:0,preserveScale:!0,forceFeatureAttributes:!1,showAttribution:null,showLabels:!0});r("extend-esri")&&u.setObject("tasks.PrintTemplate",G,n);return G})},"dojox/gfx/canvas":function(){define("./_base dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/window dojo/dom-geometry dojo/dom ./shape ./path ./arc ./matrix ./decompose ./bezierutils".split(" "),function(G,u,r,n,m,k,d,a,b,e,g,h,c){function f(B,I,P,X,Y,aa,
Z,fa,K,R){var U=I.length,ba=0;if(R){var Q=R.l/Y;ba=R.i}else Q=I[0]/Y;for(;aa<Z;){if(aa+Q>Z){var ea={l:(aa+Q-Z)*Y,i:ba};Q=Z-aa}ba%2||(B.beginPath(),B.arc(P,X,Y,aa,aa+Q,fa),K&&B.stroke());aa+=Q;++ba;Q=I[ba%U]/Y}return ea}function l(B,I,P,X){var Y=0,aa=0,Z=0;if(X){var fa=X.l;Z=X.i}else fa=I[0];for(;1>aa;)aa=c.tAtLength(B,fa),1==aa&&(Y=c.computeLength(B),Y={l:fa-Y,i:Z}),B=c.splitBezierAtT(B,aa),Z%2||P.push(B[0]),B=B[1],++Z,fa=I[Z%I.length];return Y}function q(B,I,P,X){var Y=[I.last.x,I.last.y].concat(P),
aa=!(B instanceof Array);P=4===P.length?"quadraticCurveTo":"bezierCurveTo";var Z=[];I=l(Y,I.canvasDash,Z,X);for(X=0;X<Z.length;++X)Y=Z[X],aa?(B.moveTo(Y[0],Y[1]),B[P].apply(B,Y.slice(2))):(B.push("moveTo",[Y[0],Y[1]]),B.push(P,Y.slice(2)));return I}function t(B,I,P,X,Y,aa,Z){var fa=0,K=0,R=0,U=c.distance(P,X,Y,aa),ba=0;I=I.canvasDash;var Q=P,ea=X,la=!(B instanceof Array);Z?(R=Z.l,ba=Z.i):R+=I[0];for(;.01<Math.abs(1-K);){R>U&&(fa={l:R-U,i:ba},R=U);K=R/U;Z=P+(Y-P)*K;var ma=X+(aa-X)*K;ba++%2||(la?(B.moveTo(Q,
ea),B.lineTo(Z,ma)):(B.push("moveTo",[Q,ea]),B.push("lineTo",[Z,ma])));Q=Z;ea=ma;R+=I[ba%I.length]}return fa}var v=G.canvas={},w=null,x=g.multiplyPoint,H=Math.PI,A=2*H,z=H/2;h=u.extend;if(m.global.CanvasRenderingContext2D){m=m.doc.createElement("canvas").getContext("2d");var E="function"==typeof m.setLineDash,J="function"==typeof m.fillText}var D={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],
longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};v.Shape=n("dojox.gfx.canvas.Shape",a.Shape,{_render:function(B){B.save();this._renderTransform(B);this._renderClip(B);this._renderShape(B);this._renderFill(B,!0);this._renderStroke(B,!0);B.restore()},_renderClip:function(B){this.canvasClip&&(this.canvasClip.render(B),B.clip())},_renderTransform:function(B){if("canvasTransform"in this){var I=this.canvasTransform;B.translate(I.dx,I.dy);B.rotate(I.angle2);B.scale(I.sx,I.sy);B.rotate(I.angle1)}},_renderShape:function(B){},
_renderFill:function(B,I){if("canvasFill"in this){var P=this.fillStyle;if("canvasFillImage"in this){var X=P.width,Y=P.height,aa=this.canvasFillImage.width,Z=this.canvasFillImage.height,fa=Math.min(X==aa?1:X/aa,Y==Z?1:Y/Z),K=(X-fa*aa)/2,R=(Y-fa*Z)/2;w.width=X;w.height=Y;var U=w.getContext("2d");U.clearRect(0,0,X,Y);U.drawImage(this.canvasFillImage,0,0,aa,Z,K,R,fa*aa,fa*Z);this.canvasFill=B.createPattern(w,"repeat");delete this.canvasFillImage}B.fillStyle=this.canvasFill;I&&("pattern"!==P.type||0===
P.x&&0===P.y||B.translate(P.x,P.y),B.fill())}else B.fillStyle="rgba(0,0,0,0.0)"},_renderStroke:function(B,I){var P=this.strokeStyle;P?(B.strokeStyle=P.color.toString(),B.lineWidth=P.width,B.lineCap=P.cap,"number"==typeof P.join?(B.lineJoin="miter",B.miterLimit=P.join):B.lineJoin=P.join,this.canvasDash?E?(B.setLineDash(this.canvasDash),I&&B.stroke()):this._renderDashedStroke(B,I):I&&B.stroke()):I||(B.strokeStyle="rgba(0,0,0,0.0)")},_renderDashedStroke:function(B,I){},getEventSource:function(){return null},
on:function(){},connect:function(){},disconnect:function(){},canvasClip:null,setClip:function(B){this.inherited(arguments);var I=B?"width"in B?"rect":"cx"in B?"ellipse":"points"in B?"polyline":"d"in B?"path":null:null;if(B&&!I)return this;this.canvasClip=B?L(I,B):null;this.parent&&this.parent._makeDirty();return this}});var L=function(B,I){switch(B){case "ellipse":return{canvasEllipse:F({shape:I}),render:function(P){return v.Ellipse.prototype._renderShape.call(this,P)}};case "rect":return{shape:u.delegate(I,
{r:0}),render:function(P){return v.Rect.prototype._renderShape.call(this,P)}};case "path":return{canvasPath:C(I),render:function(P){this.canvasPath._renderShape(P)}};case "polyline":return{canvasPolyline:I.points,render:function(P){return v.Polyline.prototype._renderShape.call(this,P)}}}return null},C=function(B){var I=new dojox.gfx.canvas.Path;I.canvasPath=[];I._setPath(B.d);return I},N=function(B,I,P){var X=B.prototype[I];B.prototype[I]=P?function(){this.parent&&this.parent._makeDirty();X.apply(this,
arguments);P.call(this);return this}:function(){this.parent&&this.parent._makeDirty();return X.apply(this,arguments)}};N(v.Shape,"setTransform",function(){this.matrix?this.canvasTransform=G.decompose(this.matrix):delete this.canvasTransform});N(v.Shape,"setFill",function(){var B=this.fillStyle;if(B){if("object"==typeof B&&"type"in B){var I=this.surface.rawNode.getContext("2d");switch(B.type){case "linear":case "radial":var P="linear"==B.type?I.createLinearGradient(B.x1,B.y1,B.x2,B.y2):I.createRadialGradient(B.cx,
B.cy,0,B.cx,B.cy,B.r);r.forEach(B.colors,function(X){P.addColorStop(X.offset,G.normalizeColor(X.color).toString())});break;case "pattern":w||(w=document.createElement("canvas")),I=new Image,this.surface.downloadImage(I,B.src),this.canvasFillImage=I}}else P=B.toString();this.canvasFill=P}else delete this.canvasFill});N(v.Shape,"setStroke",function(){var B=this.strokeStyle;if(B){var I=this.strokeStyle.style.toLowerCase();I in D&&(I=D[I]);if(I instanceof Array){this.canvasDash=I=I.slice();var P;for(P=
0;P<I.length;++P)I[P]*=B.width;if("butt"!=B.cap){for(P=0;P<I.length;P+=2)I[P]-=B.width,1>I[P]&&(I[P]=1);for(P=1;P<I.length;P+=2)I[P]+=B.width}}else delete this.canvasDash}else delete this.canvasDash;this._needsDash=!E&&!!this.canvasDash});N(v.Shape,"setShape");v.Group=n("dojox.gfx.canvas.Group",v.Shape,{constructor:function(){a.Container._init.call(this)},_render:function(B){B.save();this._renderTransform(B);this._renderClip(B);for(var I=0;I<this.children.length;++I)this.children[I]._render(B);B.restore()},
destroy:function(){a.Container.clear.call(this,!0);v.Shape.prototype.destroy.apply(this,arguments)}});v.Rect=n("dojox.gfx.canvas.Rect",[v.Shape,a.Rect],{_renderShape:function(B){var I=this.shape,P=Math.min(I.r,I.height/2,I.width/2),X=I.x,Y=X+I.width,aa=I.y;I=aa+I.height;var Z=X+P,fa=Y-P,K=aa+P,R=I-P;B.beginPath();B.moveTo(Z,aa);P?(B.arc(fa,K,P,-z,0,!1),B.arc(fa,R,P,0,z,!1),B.arc(Z,R,P,z,H,!1),B.arc(Z,K,P,H,H+z,!1)):(B.lineTo(fa,aa),B.lineTo(Y,R),B.lineTo(Z,I),B.lineTo(X,K));B.closePath()},_renderDashedStroke:function(B,
I){var P=this.shape,X=Math.min(P.r,P.height/2,P.width/2),Y=P.x,aa=Y+P.width,Z=P.y,fa=Z+P.height,K=Y+X,R=aa-X,U=Z+X,ba=fa-X;X?(B.beginPath(),P=t(B,this,K,Z,R,Z),I&&B.stroke(),P=f(B,this.canvasDash,R,U,X,-z,0,!1,I,P),B.beginPath(),P=t(B,this,aa,U,aa,ba,P),I&&B.stroke(),P=f(B,this.canvasDash,R,ba,X,0,z,!1,I,P),B.beginPath(),P=t(B,this,R,fa,K,fa,P),I&&B.stroke(),P=f(B,this.canvasDash,K,ba,X,z,H,!1,I,P),B.beginPath(),P=t(B,this,Y,ba,Y,U,P),I&&B.stroke(),f(B,this.canvasDash,K,U,X,H,H+z,!1,I,P)):(B.beginPath(),
P=t(B,this,K,Z,R,Z),P=t(B,this,R,Z,aa,ba,P),P=t(B,this,aa,ba,K,fa,P),t(B,this,K,fa,Y,U,P),I&&B.stroke())}});var S=[];(function(){var B=e.curvePI4;S.push(B.s,B.c1,B.c2,B.e);for(var I=45;360>I;I+=45){var P=g.rotateg(I);S.push(x(P,B.c1),x(P,B.c2),x(P,B.e))}})();var F=function(B){var I=[],P=B.shape,X=g.normalize([g.translate(P.cx,P.cy),g.scale(P.rx,P.ry)]);var Y=x(X,S[0]);I.push([Y.x,Y.y]);for(P=1;P<S.length;P+=3){var aa=x(X,S[P]);var Z=x(X,S[P+1]);Y=x(X,S[P+2]);I.push([aa.x,aa.y,Z.x,Z.y,Y.x,Y.y])}if(B._needsDash){Y=
[];aa=I[0];for(P=1;P<I.length;++P)Z=[],l(aa.concat(I[P]),B.canvasDash,Z),aa=[I[P][4],I[P][5]],Y.push(Z);B._dashedPoints=Y}return I};v.Ellipse=n("dojox.gfx.canvas.Ellipse",[v.Shape,a.Ellipse],{setShape:function(){this.inherited(arguments);this.canvasEllipse=F(this);return this},setStroke:function(){this.inherited(arguments);E||(this.canvasEllipse=F(this));return this},_renderShape:function(B){var I=this.canvasEllipse,P;B.beginPath();B.moveTo.apply(B,I[0]);for(P=1;P<I.length;++P)B.bezierCurveTo.apply(B,
I[P]);B.closePath()},_renderDashedStroke:function(B,I){var P=this._dashedPoints;B.beginPath();for(var X=0;X<P.length;++X)for(var Y=P[X],aa=0;aa<Y.length;++aa){var Z=Y[aa];B.moveTo(Z[0],Z[1]);B.bezierCurveTo(Z[2],Z[3],Z[4],Z[5],Z[6],Z[7])}I&&B.stroke()}});v.Circle=n("dojox.gfx.canvas.Circle",[v.Shape,a.Circle],{_renderShape:function(B){var I=this.shape;B.beginPath();B.arc(I.cx,I.cy,I.r,0,A,1)},_renderDashedStroke:function(B,I){var P=this.shape,X=0,Y=this.canvasDash.length;for(i=0;X<A;){var aa=this.canvasDash[i%
Y]/P.r;i%2||(B.beginPath(),B.arc(P.cx,P.cy,P.r,X,X+aa,0),I&&B.stroke());X+=aa;++i}}});v.Line=n("dojox.gfx.canvas.Line",[v.Shape,a.Line],{_renderShape:function(B){var I=this.shape;B.beginPath();B.moveTo(I.x1,I.y1);B.lineTo(I.x2,I.y2)},_renderDashedStroke:function(B,I){var P=this.shape;B.beginPath();t(B,this,P.x1,P.y1,P.x2,P.y2);I&&B.stroke()}});v.Polyline=n("dojox.gfx.canvas.Polyline",[v.Shape,a.Polyline],{setShape:function(){this.inherited(arguments);var B=this.shape.points,I=B[0],P;this.bbox=null;
this._normalizePoints();if(B.length)if("number"==typeof I)I=B;else for(I=[],P=0;P<B.length;++P){var X=B[P];I.push(X.x,X.y)}else I=[];this.canvasPolyline=I;return this},_renderShape:function(B){var I=this.canvasPolyline;if(I.length){B.beginPath();B.moveTo(I[0],I[1]);for(var P=2;P<I.length;P+=2)B.lineTo(I[P],I[P+1])}},_renderDashedStroke:function(B,I){var P=this.canvasPolyline,X=0;B.beginPath();for(var Y=0;Y<P.length;Y+=2)X=t(B,this,P[Y],P[Y+1],P[Y+2],P[Y+3],X);I&&B.stroke()}});v.Image=n("dojox.gfx.canvas.Image",
[v.Shape,a.Image],{setShape:function(){this.inherited(arguments);var B=new Image;this.surface.downloadImage(B,this.shape.src);this.canvasImage=B;return this},_renderShape:function(B){var I=this.shape;B.drawImage(this.canvasImage,I.x,I.y,I.width,I.height)}});v.Text=n("dojox.gfx.canvas.Text",[v.Shape,a.Text],{_setFont:function(){this.fontStyle?this.canvasFont=G.makeFontString(this.fontStyle):delete this.canvasFont},getTextWidth:function(){var B=this.shape,I=0;if(B.text){var P=this.surface.rawNode.getContext("2d");
P.save();this._renderTransform(P);this._renderFill(P,!1);this._renderStroke(P,!1);this.canvasFont&&(P.font=this.canvasFont);I=P.measureText(B.text).width;P.restore()}return I},_render:function(B){B.save();this._renderTransform(B);this._renderFill(B,!1);this._renderStroke(B,!1);this._renderShape(B);B.restore()},_renderShape:function(B){var I=this.shape;I.text&&(B.textAlign="middle"===I.align?"center":I.align,this.canvasFont&&(B.font=this.canvasFont),this.canvasFill&&B.fillText(I.text,I.x,I.y),this.strokeStyle&&
(B.beginPath(),B.strokeText(I.text,I.x,I.y),B.closePath()))}});N(v.Text,"setFont");J||v.Text.extend({getTextWidth:function(){return 0},getBoundingBox:function(){return null},_renderShape:function(){}});var T={M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"};
v.Path=n("dojox.gfx.canvas.Path",[v.Shape,b.Path],{constructor:function(){this.lastControl={}},setShape:function(){this.canvasPath=[];this._dashedPath=[];return this.inherited(arguments)},setStroke:function(){this.inherited(arguments);E||(this.segmented=!1,this._confirmSegmented());return this},_setPath:function(){this._dashResidue=null;this.inherited(arguments)},_updateWithSegment:function(B){var I=u.clone(this.last);this[T[B.action]](this.canvasPath,B.action,B.args,this._needsDash?this._dashedPath:
null);this.last=I;this.inherited(arguments)},_renderShape:function(B){var I=this.canvasPath;B.beginPath();for(var P=0;P<I.length;P+=2)B[I[P]].apply(B,I[P+1])},_renderDashedStroke:E?function(){}:function(B,I){var P=this._dashedPath;B.beginPath();for(var X=0;X<P.length;X+=2)B[P[X]].apply(B,P[X+1]);I&&B.stroke()},_moveToA:function(B,I,P,X){B.push("moveTo",[P[0],P[1]]);X&&X.push("moveTo",[P[0],P[1]]);for(I=2;I<P.length;I+=2)B.push("lineTo",[P[I],P[I+1]]),X&&(this._dashResidue=t(X,this,P[I-2],P[I-1],P[I],
P[I+1],this._dashResidue));this.last.x=P[P.length-2];this.last.y=P[P.length-1];this.lastControl={}},_moveToR:function(B,I,P,X){I="x"in this.last?[this.last.x+=P[0],this.last.y+=P[1]]:[this.last.x=P[0],this.last.y=P[1]];B.push("moveTo",I);X&&X.push("moveTo",I);for(I=2;I<P.length;I+=2)B.push("lineTo",[this.last.x+=P[I],this.last.y+=P[I+1]]),X&&(this._dashResidue=t(X,this,X[X.length-1][0],X[X.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_lineToA:function(B,I,P,X){for(I=
0;I<P.length;I+=2)X&&(this._dashResidue=t(X,this,this.last.x,this.last.y,P[I],P[I+1],this._dashResidue)),B.push("lineTo",[P[I],P[I+1]]);this.last.x=P[P.length-2];this.last.y=P[P.length-1];this.lastControl={}},_lineToR:function(B,I,P,X){for(I=0;I<P.length;I+=2)B.push("lineTo",[this.last.x+=P[I],this.last.y+=P[I+1]]),X&&(this._dashResidue=t(X,this,X[X.length-1][0],X[X.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_hLineToA:function(B,I,P,X){for(I=0;I<P.length;++I)B.push("lineTo",
[P[I],this.last.y]),X&&(this._dashResidue=t(X,this,X[X.length-1][0],X[X.length-1][1],P[I],this.last.y,this._dashResidue));this.last.x=P[P.length-1];this.lastControl={}},_hLineToR:function(B,I,P,X){for(I=0;I<P.length;++I)B.push("lineTo",[this.last.x+=P[I],this.last.y]),X&&(this._dashResidue=t(X,this,X[X.length-1][0],X[X.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_vLineToA:function(B,I,P,X){for(I=0;I<P.length;++I)B.push("lineTo",[this.last.x,P[I]]),X&&(this._dashResidue=
t(X,this,X[X.length-1][0],X[X.length-1][1],this.last.x,P[I],this._dashResidue));this.last.y=P[P.length-1];this.lastControl={}},_vLineToR:function(B,I,P,X){for(I=0;I<P.length;++I)B.push("lineTo",[this.last.x,this.last.y+=P[I]]),X&&(this._dashResidue=t(X,this,X[X.length-1][0],X[X.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_curveToA:function(B,I,P,X){for(I=0;I<P.length;I+=6)B.push("bezierCurveTo",P.slice(I,I+6)),X&&(this._dashResidue=q(X,this,B[B.length-1],this._dashResidue));
this.last.x=P[P.length-2];this.last.y=P[P.length-1];this.lastControl.x=P[P.length-4];this.lastControl.y=P[P.length-3];this.lastControl.type="C"},_curveToR:function(B,I,P,X){for(I=0;I<P.length;I+=6)B.push("bezierCurveTo",[this.last.x+P[I],this.last.y+P[I+1],this.lastControl.x=this.last.x+P[I+2],this.lastControl.y=this.last.y+P[I+3],this.last.x+P[I+4],this.last.y+P[I+5]]),X&&(this._dashResidue=q(X,this,B[B.length-1],this._dashResidue)),this.last.x+=P[I+4],this.last.y+=P[I+5];this.lastControl.type="C"},
_smoothCurveToA:function(B,I,P,X){for(I=0;I<P.length;I+=4){var Y="C"==this.lastControl.type;B.push("bezierCurveTo",[Y?2*this.last.x-this.lastControl.x:this.last.x,Y?2*this.last.y-this.lastControl.y:this.last.y,P[I],P[I+1],P[I+2],P[I+3]]);X&&(this._dashResidue=q(X,this,B[B.length-1],this._dashResidue));this.lastControl.x=P[I];this.lastControl.y=P[I+1];this.lastControl.type="C"}this.last.x=P[P.length-2];this.last.y=P[P.length-1]},_smoothCurveToR:function(B,I,P,X){for(I=0;I<P.length;I+=4){var Y="C"==
this.lastControl.type;B.push("bezierCurveTo",[Y?2*this.last.x-this.lastControl.x:this.last.x,Y?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+P[I],this.last.y+P[I+1],this.last.x+P[I+2],this.last.y+P[I+3]]);X&&(this._dashResidue=q(X,this,B[B.length-1],this._dashResidue));this.lastControl.x=this.last.x+P[I];this.lastControl.y=this.last.y+P[I+1];this.lastControl.type="C";this.last.x+=P[I+2];this.last.y+=P[I+3]}},_qCurveToA:function(B,I,P,X){for(I=0;I<P.length;I+=4)B.push("quadraticCurveTo",
P.slice(I,I+4));X&&(this._dashResidue=q(X,this,B[B.length-1],this._dashResidue));this.last.x=P[P.length-2];this.last.y=P[P.length-1];this.lastControl.x=P[P.length-4];this.lastControl.y=P[P.length-3];this.lastControl.type="Q"},_qCurveToR:function(B,I,P,X){for(I=0;I<P.length;I+=4)B.push("quadraticCurveTo",[this.lastControl.x=this.last.x+P[I],this.lastControl.y=this.last.y+P[I+1],this.last.x+P[I+2],this.last.y+P[I+3]]),X&&(this._dashResidue=q(X,this,B[B.length-1],this._dashResidue)),this.last.x+=P[I+
2],this.last.y+=P[I+3];this.lastControl.type="Q"},_qSmoothCurveToA:function(B,I,P,X){for(I=0;I<P.length;I+=2){var Y="Q"==this.lastControl.type;B.push("quadraticCurveTo",[this.lastControl.x=Y?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=Y?2*this.last.y-this.lastControl.y:this.last.y,P[I],P[I+1]]);X&&(this._dashResidue=q(X,this,B[B.length-1],this._dashResidue));this.lastControl.type="Q"}this.last.x=P[P.length-2];this.last.y=P[P.length-1]},_qSmoothCurveToR:function(B,I,P,X){for(I=
0;I<P.length;I+=2){var Y="Q"==this.lastControl.type;B.push("quadraticCurveTo",[this.lastControl.x=Y?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=Y?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+P[I],this.last.y+P[I+1]]);X&&(this._dashResidue=q(X,this,B[B.length-1],this._dashResidue));this.lastControl.type="Q";this.last.x+=P[I];this.last.y+=P[I+1]}},_arcTo:function(B,I,P,X){I="a"==I;for(var Y=0;Y<P.length;Y+=7){var aa=P[Y+5],Z=P[Y+6];I&&(aa+=this.last.x,Z+=this.last.y);
var fa=e.arcAsBezier(this.last,P[Y],P[Y+1],P[Y+2],P[Y+3]?1:0,P[Y+4]?1:0,aa,Z);r.forEach(fa,function(K){B.push("bezierCurveTo",K)});X&&(this._dashResidue=q(X,this,p,this._dashResidue));this.last.x=aa;this.last.y=Z}this.lastControl={}},_closePath:function(B,I,P,X){B.push("closePath",[]);X&&(this._dashResidue=t(X,this,this.last.x,this.last.y,X[1][0],X[1][1],this._dashResidue));this.lastControl={}}});r.forEach("moveTo lineTo hLineTo vLineTo curveTo smoothCurveTo qCurveTo qSmoothCurveTo arcTo closePath".split(" "),
function(B){N(v.Path,B)});v.TextPath=n("dojox.gfx.canvas.TextPath",[v.Shape,b.TextPath],{_renderShape:function(B){},_setText:function(){},_setFont:function(){}});v.Surface=n("dojox.gfx.canvas.Surface",a.Surface,{constructor:function(){a.Container._init.call(this);this.pendingImageCount=0;this.makeDirty()},destroy:function(){a.Container.clear.call(this,!0);this.inherited(arguments)},setDimensions:function(B,I){this.width=G.normalizedLength(B);this.height=G.normalizedLength(I);if(!this.rawNode)return this;
B=!1;this.rawNode.width!=this.width&&(this.rawNode.width=this.width,B=!0);this.rawNode.height!=this.height&&(this.rawNode.height=this.height,B=!0);B&&this.makeDirty();return this},getDimensions:function(){return this.rawNode?{width:this.rawNode.width,height:this.rawNode.height}:null},_render:function(B){!this.rawNode||!B&&this.pendingImageCount||(B=this.rawNode.getContext("2d"),B.clearRect(0,0,this.rawNode.width,this.rawNode.height),this.render(B),"pendingRender"in this&&(clearTimeout(this.pendingRender),
delete this.pendingRender))},render:function(B){B.save();for(var I=0;I<this.children.length;++I)this.children[I]._render(B);B.restore()},makeDirty:function(){this.pendingImagesCount||"pendingRender"in this||this._batch||(this.pendingRender=setTimeout(u.hitch(this,this._render),0))},downloadImage:function(B,I){var P=u.hitch(this,this.onImageLoad);!this.pendingImageCount++&&"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender);B.onload=P;B.onerror=P;B.onabort=P;B.src=
I},onImageLoad:function(){--this.pendingImageCount||(this.onImagesLoaded(),this._render())},onImagesLoaded:function(){},getEventSource:function(){return null},connect:function(){},disconnect:function(){},on:function(){}});v.createSurface=function(B,I,P){if(!I&&!P){var X=k.position(B);I=I||X.w;P=P||X.h}"number"==typeof I&&(I+="px");"number"==typeof P&&(P+="px");X=new v.Surface;B=d.byId(B);var Y=B.ownerDocument.createElement("canvas");Y.width=G.normalizedLength(I);Y.height=G.normalizedLength(P);B.appendChild(Y);
X.rawNode=Y;X._parent=B;return X.surface=X};var y=a.Container;n={openBatch:function(){++this._batch;return this},closeBatch:function(){this._batch=0<this._batch?--this._batch:0;this._makeDirty();return this},_makeDirty:function(){this._batch||this.surface.makeDirty()},add:function(B){this._makeDirty();return y.add.apply(this,arguments)},remove:function(B,I){this._makeDirty();return y.remove.apply(this,arguments)},clear:function(){this._makeDirty();return y.clear.apply(this,arguments)},getBoundingBox:y.getBoundingBox,
_moveChildToFront:function(B){this._makeDirty();return y._moveChildToFront.apply(this,arguments)},_moveChildToBack:function(B){this._makeDirty();return y._moveChildToBack.apply(this,arguments)}};b={createObject:function(B,I){B=new B;B.surface=this.surface;B.setShape(I);this.add(B);return B}};h(v.Group,n);h(v.Group,a.Creator);h(v.Group,b);h(v.Surface,n);h(v.Surface,a.Creator);h(v.Surface,b);v.fixTarget=function(B,I){return!0};return v})},"dojox/gfx/shape":function(){define("./_base dojo/_base/lang dojo/_base/declare dojo/_base/kernel dojo/_base/sniff dojo/on dojo/_base/array dojo/dom-construct dojo/_base/Color ./matrix".split(" "),
function(G,u,r,n,m,k,d,a,b,e){function g(c,f){for(var l=c.length-1;f<l;)c[f]=c[++f];c.length=l}var h=G.shape={};h.Shape=r("dojox.gfx.shape.Shape",null,{constructor:function(){this.parentMatrix=this.parent=this.bbox=this.strokeStyle=this.fillStyle=this.matrix=this.shape=this.rawNode=null;if(m("gfxRegistry")){var c=h.register(this);this.getUID=function(){return c}}},destroy:function(){m("gfxRegistry")&&h.dispose(this);this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=
null},getNode:function(){return this.rawNode},getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var c=this.getBoundingBox();if(!c)return null;var f=this._getRealMatrix();return[e.multiplyPoint(f,c.x,c.y),e.multiplyPoint(f,c.x+c.width,c.y),e.multiplyPoint(f,c.x+
c.width,c.y+c.height),e.multiplyPoint(f,c.x,c.y+c.height)]},getEventSource:function(){return this.rawNode},setClip:function(c){this.clip=c},getClip:function(){return this.clip},setShape:function(c){this.shape=G.makeParameters(this.shape,c);this.bbox=null;return this},setFill:function(c){if(!c)return this.fillStyle=null,this;var f=null;if("object"==typeof c&&"type"in c)switch(c.type){case "linear":f=G.makeParameters(G.defaultLinearGradient,c);break;case "radial":f=G.makeParameters(G.defaultRadialGradient,
c);break;case "pattern":f=G.makeParameters(G.defaultPattern,c)}else f=G.normalizeColor(c);this.fillStyle=f;return this},setStroke:function(c){if(!c)return this.strokeStyle=null,this;if("string"==typeof c||u.isArray(c)||c instanceof b)c={color:c};c=this.strokeStyle=G.makeParameters(G.defaultStroke,c);c.color=G.normalizeColor(c.color);return this},setTransform:function(c){this.matrix=e.clone(c?e.normalize(c):e.identity);return this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var c=
this.getParent();c&&(c._moveChildToFront(this),this._moveToFront());return this},moveToBack:function(){var c=this.getParent();c&&(c._moveChildToBack(this),this._moveToBack());return this},_moveToFront:function(){},_moveToBack:function(){},applyRightTransform:function(c){return c?this.setTransform([this.matrix,c]):this},applyLeftTransform:function(c){return c?this.setTransform([c,this.matrix]):this},applyTransform:function(c){return c?this.setTransform([this.matrix,c]):this},removeShape:function(c){this.parent&&
this.parent.remove(this,c);return this},_setParent:function(c,f){this.parent=c;return this._updateParentMatrix(f)},_updateParentMatrix:function(c){this.parentMatrix=c?e.clone(c):null;return this._applyTransform()},_getRealMatrix:function(){for(var c=this.matrix,f=this.parent;f;)f.matrix&&(c=e.multiply(f.matrix,c)),f=f.parent;return c}});h._eventsProcessing={on:function(c,f){return k(this.getEventSource(),c,h.fixCallback(this,G.fixTarget,f))},connect:function(c,f,l){"on"==c.substring(0,2)&&(c=c.substring(2));
return this.on(c,l?u.hitch(f,l):f)},disconnect:function(c){return c.remove()}};h.fixCallback=function(c,f,l,q){q||(q=l,l=null);if(u.isString(q)){l=l||n.global;if(!l[q])throw['dojox.gfx.shape.fixCallback: scope["',q,'"] is null (scope\x3d"',l,'")'].join("");return function(t){return f(t,c)?l[q].apply(l,arguments||[]):void 0}}return l?function(t){return f(t,c)?q.apply(l,arguments||[]):void 0}:function(t){return f(t,c)?q.apply(l,arguments):void 0}};u.extend(h.Shape,h._eventsProcessing);h.Container={_init:function(){this.children=
[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},add:function(c){var f=c.getParent();f&&f.remove(c,!0);this.children.push(c);return c._setParent(this,this._getRealMatrix())},remove:function(c,f){for(var l=0;l<this.children.length;++l)if(this.children[l]==c){f||(c.parent=null,c.parentMatrix=null);g(this.children,l);break}return this},clear:function(c){for(var f,l=0;l<this.children.length;++l)f=this.children[l],f.parent=null,f.parentMatrix=null,c&&f.destroy();this.children=
[];return this},getBoundingBox:function(){if(this.children){var c=null;d.forEach(this.children,function(f){var l=f.getBoundingBox();l&&((f=f.getTransform())&&(l=e.multiplyRectangle(f,l)),c?(c.x=Math.min(c.x,l.x),c.y=Math.min(c.y,l.y),c.endX=Math.max(c.endX,l.x+l.width),c.endY=Math.max(c.endY,l.y+l.height)):c={x:l.x,y:l.y,endX:l.x+l.width,endY:l.y+l.height})});c&&(c.width=c.endX-c.x,c.height=c.endY-c.y);return c}return null},_moveChildToFront:function(c){for(var f=0;f<this.children.length;++f)if(this.children[f]==
c){g(this.children,f);this.children.push(c);break}return this},_moveChildToBack:function(c){for(var f=0;f<this.children.length;++f)if(this.children[f]==c){g(this.children,f);this.children.unshift(c);break}return this}};h.Surface=r("dojox.gfx.shape.Surface",null,{constructor:function(){this._parent=this.rawNode=null;this._nodes=[];this._events=[]},destroy:function(){d.forEach(this._nodes,a.destroy);this._nodes=[];d.forEach(this._events,function(c){c&&c.remove()});this._events=[];this.rawNode=null;
if(m("ie"))for(;this._parent.lastChild;)a.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(c){},whenLoaded:function(c,f){var l=u.hitch(c,f);if(this.isLoaded)l(this);else k.once(this,"load",function(q){l(q)})}});u.extend(h.Surface,h._eventsProcessing);h.Rect=r("dojox.gfx.shape.Rect",h.Shape,{constructor:function(c){this.shape=G.getDefault("Rect");this.rawNode=
c},getBoundingBox:function(){return this.shape}});h.Ellipse=r("dojox.gfx.shape.Ellipse",h.Shape,{constructor:function(c){this.shape=G.getDefault("Ellipse");this.rawNode=c},getBoundingBox:function(){if(!this.bbox){var c=this.shape;this.bbox={x:c.cx-c.rx,y:c.cy-c.ry,width:2*c.rx,height:2*c.ry}}return this.bbox}});h.Circle=r("dojox.gfx.shape.Circle",h.Shape,{constructor:function(c){this.shape=G.getDefault("Circle");this.rawNode=c},getBoundingBox:function(){if(!this.bbox){var c=this.shape;this.bbox={x:c.cx-
c.r,y:c.cy-c.r,width:2*c.r,height:2*c.r}}return this.bbox}});h.Line=r("dojox.gfx.shape.Line",h.Shape,{constructor:function(c){this.shape=G.getDefault("Line");this.rawNode=c},getBoundingBox:function(){if(!this.bbox){var c=this.shape;this.bbox={x:Math.min(c.x1,c.x2),y:Math.min(c.y1,c.y2),width:Math.abs(c.x2-c.x1),height:Math.abs(c.y2-c.y1)}}return this.bbox}});h.Polyline=r("dojox.gfx.shape.Polyline",h.Shape,{constructor:function(c){this.shape=G.getDefault("Polyline");this.rawNode=c},setShape:function(c,
f){c&&c instanceof Array?(this.inherited(arguments,[{points:c}]),f&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[c]);return this},_normalizePoints:function(){var c=this.shape.points,f=c&&c.length;if(f&&"number"==typeof c[0]){for(var l=[],q=0;q<f;q+=2)l.push({x:c[q],y:c[q+1]});this.shape.points=l}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var c=this.shape.points,f=c.length,l=c[0],q=l.x,t=l.y,v=l.x,w=l.y,x=1;x<f;++x)l=
c[x],q>l.x&&(q=l.x),v<l.x&&(v=l.x),t>l.y&&(t=l.y),w<l.y&&(w=l.y);this.bbox={x:q,y:t,width:v-q,height:w-t}}return this.bbox}});h.Image=r("dojox.gfx.shape.Image",h.Shape,{constructor:function(c){this.shape=G.getDefault("Image");this.rawNode=c},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}});h.Text=r(h.Shape,{constructor:function(c){this.fontStyle=null;this.shape=G.getDefault("Text");this.rawNode=c},getFont:function(){return this.fontStyle},
setFont:function(c){this.fontStyle="string"==typeof c?G.splitFontString(c):G.makeParameters(G.defaultFont,c);this._setFont();return this},getBoundingBox:function(){var c=null;this.getShape().text&&(c=G._base._computeTextBoundingBox(this));return c}});h.Creator={createShape:function(c){switch(c.type){case G.defaultPath.type:return this.createPath(c);case G.defaultRect.type:return this.createRect(c);case G.defaultCircle.type:return this.createCircle(c);case G.defaultEllipse.type:return this.createEllipse(c);
case G.defaultLine.type:return this.createLine(c);case G.defaultPolyline.type:return this.createPolyline(c);case G.defaultImage.type:return this.createImage(c);case G.defaultText.type:return this.createText(c);case G.defaultTextPath.type:return this.createTextPath(c)}return null},createGroup:function(){return this.createObject(G.Group)},createRect:function(c){return this.createObject(G.Rect,c)},createEllipse:function(c){return this.createObject(G.Ellipse,c)},createCircle:function(c){return this.createObject(G.Circle,
c)},createLine:function(c){return this.createObject(G.Line,c)},createPolyline:function(c){return this.createObject(G.Polyline,c)},createImage:function(c){return this.createObject(G.Image,c)},createText:function(c){return this.createObject(G.Text,c)},createPath:function(c){return this.createObject(G.Path,c)},createTextPath:function(c){return this.createObject(G.TextPath,{}).setText(c)},createObject:function(c,f){return null}};return h})},"dojox/gfx/path":function(){define(["./_base","dojo/_base/lang",
"dojo/_base/declare","./matrix","./shape"],function(G,u,r,n,m){m=r("dojox.gfx.path.Path",m.Shape,{constructor:function(k){this.shape=u.clone(G.defaultPath);this.segments=[];this.tbbox=null;this.absolute=!0;this.last={};this.rawNode=k;this.segmented=!1},setAbsoluteMode:function(k){this._confirmSegmented();this.absolute="string"==typeof k?"absolute"==k:k;return this},getAbsoluteMode:function(){this._confirmSegmented();return this.absolute},getBoundingBox:function(){this._confirmSegmented();return this.bbox&&
"l"in this.bbox?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null},_getRealBBox:function(){this._confirmSegmented();if(this.tbbox)return this.tbbox;var k=this.bbox,d=this._getRealMatrix();this.bbox=null;for(var a=0,b=this.segments.length;a<b;++a)this._updateWithSegment(this.segments[a],d);d=this.bbox;this.bbox=k;return this.tbbox=d?[{x:d.l,y:d.t},{x:d.r,y:d.t},{x:d.r,y:d.b},{x:d.l,y:d.b}]:null},getLastPosition:function(){this._confirmSegmented();return"x"in
this.last?this.last:null},_applyTransform:function(){this.tbbox=null;return this.inherited(arguments)},_updateBBox:function(k,d,a){a&&(d=n.multiplyPoint(a,k,d),k=d.x,d=d.y);this.bbox&&"l"in this.bbox?(this.bbox.l>k&&(this.bbox.l=k),this.bbox.r<k&&(this.bbox.r=k),this.bbox.t>d&&(this.bbox.t=d),this.bbox.b<d&&(this.bbox.b=d)):this.bbox={l:k,b:d,r:k,t:d}},_updateWithSegment:function(k,d){var a=k.args,b=a.length,e;switch(k.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(e=0;e<b;e+=2)this._updateBBox(a[e],
a[e+1],d);this.last.x=a[b-2];this.last.y=a[b-1];this.absolute=!0;break;case "H":for(e=0;e<b;++e)this._updateBBox(a[e],this.last.y,d);this.last.x=a[b-1];this.absolute=!0;break;case "V":for(e=0;e<b;++e)this._updateBBox(this.last.x,a[e],d);this.last.y=a[b-1];this.absolute=!0;break;case "m":e=0;"x"in this.last||(this._updateBBox(this.last.x=a[0],this.last.y=a[1],d),e=2);for(;e<b;e+=2)this._updateBBox(this.last.x+=a[e],this.last.y+=a[e+1],d);this.absolute=!1;break;case "l":case "t":for(e=0;e<b;e+=2)this._updateBBox(this.last.x+=
a[e],this.last.y+=a[e+1],d);this.absolute=!1;break;case "h":for(e=0;e<b;++e)this._updateBBox(this.last.x+=a[e],this.last.y,d);this.absolute=!1;break;case "v":for(e=0;e<b;++e)this._updateBBox(this.last.x,this.last.y+=a[e],d);this.absolute=!1;break;case "c":for(e=0;e<b;e+=6)this._updateBBox(this.last.x+a[e],this.last.y+a[e+1],d),this._updateBBox(this.last.x+a[e+2],this.last.y+a[e+3],d),this._updateBBox(this.last.x+=a[e+4],this.last.y+=a[e+5],d);this.absolute=!1;break;case "s":case "q":for(e=0;e<b;e+=
4)this._updateBBox(this.last.x+a[e],this.last.y+a[e+1],d),this._updateBBox(this.last.x+=a[e+2],this.last.y+=a[e+3],d);this.absolute=!1;break;case "A":for(e=0;e<b;e+=7)this._updateBBox(a[e+5],a[e+6],d);this.last.x=a[b-2];this.last.y=a[b-1];this.absolute=!0;break;case "a":for(e=0;e<b;e+=7)this._updateBBox(this.last.x+=a[e+5],this.last.y+=a[e+6],d);this.absolute=!1}k=[k.action];for(e=0;e<b;++e)k.push(G.formatNumber(a[e],!0));if("string"==typeof this.shape.path)this.shape.path+=k.join("");else for(e=
0,b=k.length;e<b;++e)this.shape.path.push(k[e])},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(k,d){this.tbbox=null;var a=this._validSegments[k.toLowerCase()];"number"==typeof a&&(a?d.length>=a&&(k={action:k,args:d.slice(0,d.length-d.length%a)},this.segments.push(k),this._updateWithSegment(k)):(k={action:k,args:[]},this.segments.push(k),this._updateWithSegment(k)))},_collectArgs:function(k,d){for(var a=0;a<d.length;++a){var b=d[a];"boolean"==typeof b?k.push(b?1:0):
"number"==typeof b?k.push(b):b instanceof Array?this._collectArgs(k,b):"x"in b&&"y"in b&&k.push(b.x,b.y)}},moveTo:function(){this._confirmSegmented();var k=[];this._collectArgs(k,arguments);this._pushSegment(this.absolute?"M":"m",k);return this},lineTo:function(){this._confirmSegmented();var k=[];this._collectArgs(k,arguments);this._pushSegment(this.absolute?"L":"l",k);return this},hLineTo:function(){this._confirmSegmented();var k=[];this._collectArgs(k,arguments);this._pushSegment(this.absolute?
"H":"h",k);return this},vLineTo:function(){this._confirmSegmented();var k=[];this._collectArgs(k,arguments);this._pushSegment(this.absolute?"V":"v",k);return this},curveTo:function(){this._confirmSegmented();var k=[];this._collectArgs(k,arguments);this._pushSegment(this.absolute?"C":"c",k);return this},smoothCurveTo:function(){this._confirmSegmented();var k=[];this._collectArgs(k,arguments);this._pushSegment(this.absolute?"S":"s",k);return this},qCurveTo:function(){this._confirmSegmented();var k=
[];this._collectArgs(k,arguments);this._pushSegment(this.absolute?"Q":"q",k);return this},qSmoothCurveTo:function(){this._confirmSegmented();var k=[];this._collectArgs(k,arguments);this._pushSegment(this.absolute?"T":"t",k);return this},arcTo:function(){this._confirmSegmented();var k=[];this._collectArgs(k,arguments);this._pushSegment(this.absolute?"A":"a",k);return this},closePath:function(){this._confirmSegmented();this._pushSegment("Z",[]);return this},_confirmSegmented:function(){if(!this.segmented){var k=
this.shape.path;this.shape.path=[];this._setPath(k);this.shape.path=this.shape.path.join("");this.segmented=!0}},_setPath:function(k){k=u.isArray(k)?k:k.match(G.pathSvgRegExp);this.segments=[];this.absolute=!0;this.bbox={};this.last={};if(k){for(var d="",a=[],b=k.length,e=0;e<b;++e){var g=k[e],h=parseFloat(g);isNaN(h)?(d&&this._pushSegment(d,a),a=[],d=g):a.push(h)}this._pushSegment(d,a)}},setShape:function(k){this.inherited(arguments,["string"==typeof k?{path:k}:k]);this.segmented=!1;this.segments=
[];G.lazyPathSegmentation||this._confirmSegmented();return this},_2PI:2*Math.PI});r=r("dojox.gfx.path.TextPath",m,{constructor:function(k){"text"in this||(this.text=u.clone(G.defaultTextPath));"fontStyle"in this||(this.fontStyle=u.clone(G.defaultFont))},getText:function(){return this.text},setText:function(k){this.text=G.makeParameters(this.text,"string"==typeof k?{text:k}:k);this._setText();return this},getFont:function(){return this.fontStyle},setFont:function(k){this.fontStyle="string"==typeof k?
G.splitFontString(k):G.makeParameters(G.defaultFont,k);this._setFont();return this}});return G.path={Path:m,TextPath:r}})},"dojox/gfx/arc":function(){define(["./_base","dojo/_base/lang","./matrix"],function(G,u,r){function n(e){var g=Math.cos(e);e=Math.sin(e);var h={x:g+4/3*(1-g),y:e-4/3*g*(1-g)/e};return{s:{x:g,y:-e},c1:{x:h.x,y:-h.y},c2:h,e:{x:g,y:e}}}var m=2*Math.PI,k=Math.PI/4,d=Math.PI/8,a=k+d,b=n(d);return G.arc={unitArcAsBezier:n,curvePI4:b,arcAsBezier:function(e,g,h,c,f,l,q,t){f=!!f;l=!!l;
var v=r._degToRad(c);c=g*g;var w=h*h,x=r.multiplyPoint(r.rotate(-v),{x:(e.x-q)/2,y:(e.y-t)/2}),H=x.x*x.x,A=x.y*x.y;c=Math.sqrt((c*w-c*A-w*H)/(c*A+w*H));isNaN(c)&&(c=0);c={x:c*g*x.y/h,y:-c*h*x.x/g};f==l&&(c={x:-c.x,y:-c.y});c=r.multiplyPoint([r.translate((e.x+q)/2,(e.y+t)/2),r.rotate(v)],c);g=r.normalize([r.translate(c.x,c.y),r.rotate(v),r.scale(g,h)]);c=r.invert(g);e=r.multiplyPoint(c,e);t=r.multiplyPoint(c,q,t);q=Math.atan2(e.y,e.x);c=q-Math.atan2(t.y,t.x);l&&(c=-c);0>c?c+=m:c>m&&(c-=m);h=d;t=b;
h=l?h:-h;e=[];for(f=c;0<f;f-=k)f<a&&(h=f/2,t=n(h),h=l?h:-h,f=0),x=r.normalize([g,r.rotate(q+h)]),l?(c=r.multiplyPoint(x,t.c1),v=r.multiplyPoint(x,t.c2),x=r.multiplyPoint(x,t.e)):(c=r.multiplyPoint(x,t.c2),v=r.multiplyPoint(x,t.c1),x=r.multiplyPoint(x,t.s)),e.push([c.x,c.y,v.x,v.y,x.x,x.y]),q+=2*h;return e}}})},"dojox/gfx/decompose":function(){define(["./_base","dojo/_base/lang","./matrix"],function(G,u,r){function n(b,e){return Math.abs(b-e)<=1E-6*(Math.abs(b)+Math.abs(e))}function m(b,e,g,h){if(!isFinite(b))return g;
if(!isFinite(g))return b;e=Math.abs(e);h=Math.abs(h);return(e*b+h*g)/(e+h)}function k(b){b=r.normalize(b);var e=-b.xx-b.yy,g=b.xx*b.yy-b.xy*b.yx,h=Math.sqrt(e*e-4*g);e=-(e+(0>e?-h:h))/2;g/=e;h=b.xy/(e-b.xx);var c=1,f=b.xy/(g-b.xx),l=1;n(e,g)&&(h=1,f=c=0,l=1);isFinite(h)||(h=1,c=(e-b.xx)/b.xy,isFinite(c)||(h=(e-b.yy)/b.yx,c=1,isFinite(h)||(h=1,c=b.yx/(e-b.yy))));isFinite(f)||(f=1,l=(g-b.xx)/b.xy,isFinite(l)||(f=(g-b.yy)/b.yx,l=1,isFinite(f)||(f=1,l=b.yx/(g-b.yy))));b=Math.sqrt(h*h+c*c);var q=Math.sqrt(f*
f+l*l);isFinite(h/=b)||(h=0);isFinite(c/=b)||(c=0);isFinite(f/=q)||(f=0);isFinite(l/=q)||(l=0);return{value1:e,value2:g,vector1:{x:h,y:c},vector2:{x:f,y:l}}}function d(b,e){var g=0>b.xx*b.yy||0<b.xy*b.yx?-1:1,h=e.angle1=(Math.atan2(b.yx,b.yy)+Math.atan2(-g*b.xy,g*b.xx))/2;g=Math.cos(h);h=Math.sin(h);e.sx=m(b.xx/g,g,-b.xy/h,h);e.sy=m(b.yy/g,g,b.yx/h,h);return e}function a(b,e){var g=0>b.xx*b.yy||0<b.xy*b.yx?-1:1,h=e.angle2=(Math.atan2(g*b.yx,g*b.xx)+Math.atan2(-b.xy,b.yy))/2;g=Math.cos(h);h=Math.sin(h);
e.sx=m(b.xx/g,g,b.yx/h,h);e.sy=m(b.yy/g,g,-b.xy/h,h);return e}return G.decompose=function(b){var e=r.normalize(b);b={dx:e.dx,dy:e.dy,sx:1,sy:1,angle1:0,angle2:0};if(n(e.xy,0)&&n(e.yx,0))return u.mixin(b,{sx:e.xx,sy:e.yy});if(n(e.xx*e.yx,-e.xy*e.yy))return d(e,b);if(n(e.xx*e.xy,-e.yx*e.yy))return a(e,b);var g=new r.Matrix2D(e);var h=u.mixin(g,{dx:0,dy:0,xy:g.yx,yx:g.xy});g=k([e,h]);h=k([h,e]);g=new r.Matrix2D({xx:g.vector1.x,xy:g.vector2.x,yx:g.vector1.y,yy:g.vector2.y});h=new r.Matrix2D({xx:h.vector1.x,
xy:h.vector1.y,yx:h.vector2.x,yy:h.vector2.y});e=new r.Matrix2D([r.invert(g),e,r.invert(h)]);d(h,b);e.xx*=b.sx;e.yy*=b.sy;a(g,b);e.xx*=b.sx;e.yy*=b.sy;return u.mixin(b,{sx:e.xx,sy:e.yy})}})},"dojox/gfx/bezierutils":function(){define(["./_base"],function(G){G=G.bezierutils={};G.tAtLength=function(d,a){var b=0,e=6==d.length,g=0,h=0,c=e?n:k,f=function(l,q){for(var t=0,v=0;v<l.length-2;v+=2)t+=r(l[v],l[v+1],l[v+2],l[v+3]);v=e?r(d[0],d[1],d[4],d[5]):r(d[0],d[1],d[6],d[7]);t-v>q||g+t>a+q?(++h,l=c(l,.5),
f(l[0],q),Math.abs(g-a)<=q||f(l[1],q)):(g+=t,b+=1/(1<<h))};a&&f(d,.5);return b};var u=G.computeLength=function(d){for(var a=6==d.length,b=0,e=0;e<d.length-2;e+=2)b+=r(d[e],d[e+1],d[e+2],d[e+3]);e=a?r(d[0],d[1],d[4],d[5]):r(d[0],d[1],d[6],d[7]);return.1<b-e?(d=a?n(d,.5):m(d,.5),b=u(d[0],a),b+=u(d[1],a)):b},r=G.distance=function(d,a,b,e){return Math.sqrt((b-d)*(b-d)+(e-a)*(e-a))},n=function(d,a){var b=1-a,e=b*b,g=a*a,h=d[0],c=d[1],f=d[2],l=d[3],q=d[4];d=d[5];var t=e*h+2*b*a*f+g*q;e=e*c+2*b*a*l+g*d;
return[[h,c,b*h+a*f,b*c+a*l,t,e],[t,e,b*f+a*q,b*l+a*d,q,d]]},m=function(d,a){var b=1-a,e=b*b,g=e*b,h=a*a,c=h*a,f=d[0],l=d[1],q=d[2],t=d[3],v=d[4],w=d[5],x=d[6];d=d[7];var H=g*f+3*e*a*q+3*b*h*v+c*x;g=g*l+3*e*a*t+3*b*h*w+c*d;return[[f,l,b*f+a*q,b*l+a*t,e*f+2*b*a*q+h*v,e*l+2*b*a*t+h*w,H,g],[H,g,e*q+2*b*a*v+h*x,e*t+2*b*a*w+h*d,b*v+a*x,b*w+a*d,x,d]]},k=G.splitBezierAtT=function(d,a){return 6==d.length?n(d,a):m(d,a)};return G})},"dojox/json/query":function(){define(["dojo/_base/kernel","dojo/_base/lang",
"dojox","dojo/_base/array"],function(G,u,r){u.getObject("json",!0,r);r.json._slice=function(n,m,k,d){var a=n.length,b=[];k=k||a;m=0>m?Math.max(0,m+a):Math.min(a,m);for(k=0>k?Math.max(0,k+a):Math.min(a,k);m<k;m+=d)b.push(n[m]);return b};r.json._find=function(n,m){function k(b){m&&(!0!==m||b instanceof Array?b[m]&&d.push(b[m]):d.push(b));for(var e in b){var g=b[e];m?g&&"object"==typeof g&&k(g):d.push(g)}}var d=[];if(m instanceof Array){if(1==m.length)return n[m[0]];for(var a=0;a<m.length;a++)d.push(n[m[a]])}else k(n);
return d};r.json._distinctFilter=function(n,m){for(var k=[],d={},a=0,b=n.length;a<b;++a){var e=n[a];m(e,a,n)&&("object"==typeof e&&e?e.__included||(e.__included=!0,k.push(e)):d[e+typeof e]||(d[e+typeof e]=!0,k.push(e)))}a=0;for(b=k.length;a<b;++a)k[a]&&delete k[a].__included;return k};return r.json.query=function(n,m){function k(h,c,f,l,q,t,v,w){return a[w].match(/[\*\?]/)||"~"==v?"/^"+a[w].substring(1,a[w].length-1).replace(/\\([btnfr\\"'])|([^\w\*\?])/g,"\\$1$2").replace(/([\*\?])/g,"[\\w\\W]$1")+
("~"==v?"$/i":"$/")+".test("+c+")":h}var d=0,a=[];n=n.replace(/"(\\.|[^"\\])*"|'(\\.|[^'\\])*'|[\[\]]/g,function(h){d+="["==h?1:"]"==h?-1:0;return"]"==h&&0<d?"`]":'"'==h.charAt(0)||"'"==h.charAt(0)?"`"+(a.push(h)-1):h});var b="";n.replace(/(\]|\)|push|pop|shift|splice|sort|reverse)\s*\(/,function(){throw Error("Unsafe function call");});n=n.replace(/([^<>=]=)([^=])/g,"$1\x3d$2").replace(/@|(\.\s*)?[a-zA-Z\$_]+(\s*:)?/g,function(h){return"."==h.charAt(0)?h:"@"==h?"$obj":(h.match(/:|^(\$|Math|true|false|null)$/)?
"":"$obj.")+h}).replace(/\.?\.?\[(`\]|[^\]])*\]|\?.*|\.\.([\w\$_]+)|\.\*/g,function(h,c,f){return(c=h.match(/^\.?\.?(\[\s*\^?\?|\^?\?|\[\s*==)(.*?)\]?$/))?(f="",h.match(/^\./)&&(b="dojox.json._find("+b,f=",true)"),b=(c[1].match(/=/)?"dojo.map":c[1].match(/\^/)?"dojox.json._distinctFilter":"dojo.filter")+"("+b,f+",function($obj){return "+c[2]+"})"):(c=h.match(/^\[\s*([\/\\].*)\]/))?".concat().sort(function(a,b){"+c[1].replace(/\s*,?\s*([\/\\])\s*([^,\\\/]+)/g,function(l,q,t){return"var av\x3d "+t.replace(/\$obj/,
"a")+",bv\x3d "+t.replace(/\$obj/,"b")+";if(av\x3ebv||bv\x3d\x3dnull){return "+("/"==q?1:-1)+";}\nif(bv\x3eav||av\x3d\x3dnull){return "+("/"==q?-1:1)+";}\n"})+"return 0;})":(c=h.match(/^\[(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)\]/))?(b="dojox.json._slice("+b,","+(c[1]||0)+","+(c[2]||0)+","+(c[3]||1)+")"):h.match(/^\.\.|\.\*|\[\s*\*\s*\]|,/)?(b="dojox.json._find("+b,("."==h.charAt(1)?",'"+f+"'":h.match(/,/)?","+h:"")+")"):h}).replace(/(\$obj\s*((\.\s*[\w_$]+\s*)|(\[\s*`([0-9]+)\s*`\]))*)(==|~)\s*`([0-9]+)/g,
k).replace(/`([0-9]+)\s*(==|~)\s*(\$obj\s*((\.\s*[\w_$]+)|(\[\s*`([0-9]+)\s*`\]))*)/g,function(h,c,f,l,q,t,v,w){return k(h,l,q,t,v,w,f,c)});n=b+("$"==n.charAt(0)?"":"$")+n.replace(/`([0-9]+|\])/g,function(h,c){return"]"==c?"]":a[c]});for(var e=eval("1\x26\x26function($,$1,$2,$3,$4,$5,$6,$7,$8,$9){var $obj\x3d$;return "+n+"}"),g=0;g<arguments.length-1;g++)arguments[g]=arguments[g+1];return m?e.apply(this,arguments):e}})},"esri/tasks/PrintParameters":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/has","../kernel"],function(G,u,r,n){G=G(null,{declaredClass:"esri.tasks.PrintParameters",map:null,template:null,outSpatialReference:null,extraParameters:null});r("extend-esri")&&u.setObject("tasks.PrintParameters",G,n);return G})},"esri/dijit/Gallery":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-construct dojo/dom-class dojo/dom-geometry ../kernel ./_TouchBase ../Evented".split(" "),function(G,
u,r,n,m,k,d,a,b,e,g,h,c,f){G=G(f,{declaredClass:"esri.dijit.Gallery",container:null,_items:[],_currentIndex:0,_left:0,_offset:10,_slideDiv:null,_thumbnailStyle:"default",_focusedIndex:null,_selectedIndex:-1,_slideStep:1,_showTitle:!0,_eventMap:{select:["item"],focus:["item"]},constructor:function(l,q){this.container=a.byId(q);this._touchBase=c(this.container,null);this._slideDiv=b.create("div",{"class":"slideContainer"},this.container,"first");this.events=[r.connect(this._touchBase,"onTouchStart",
this,this._onTouchStartHandler),r.connect(this._touchBase,"onTouchMove",this,this._onTouchMoveHandler),r.connect(this._touchBase,"onTouchEnd",this,this._onTouchEndHandler),r.connect(this._touchBase,"onclick",this,this._onClickHandler)];this._resizeHandle=r.connect(window,"onorientationchange",u.hitch(this,this._onResizeHandler));this._items=l.items;l.thumbnailStyle&&"small"==l.thumbnailStyle?(this._thumbnailStyle="small",this._offset=4,this._slideStep=3,this._thumbnailWidth=100):(this._thumbnailStyle=
"default",this._offset=10,this._slideStep=1,this._thumbnailWidth=200);0==l.showTitle&&(this._showTitle=!1);this.container.setAttribute(document.all?"className":"class","esriMobileGallery");var t;for(l=0;l<this._items.length;l++){q=b.create("div",{"class":"thumbnailcontainer"},this._slideDiv);var v=b.create("img",{"class":"thumbnail",src:this._items[l].thumbnailUrl},q);v._index=l;v._item=this._items[l];var w=b.create("div",{"class":"title",innerHTML:this._items[l].title},q);var x=b.create("div",{"class":"title"},
q);"small"==this._thumbnailStyle&&(e.add(q,"small"),e.add(v,"small"),e.add(w,"small"),e.add(x,"small"),e.add(this._slideDiv,"small"));this._showTitle||(w.style.display="none");q=g.getContentBox(q).h;t||(t=q);q>t&&(t=q)}for(l=0;l<this._slideDiv.childNodes.length;l++)g.getContentBox(this._slideDiv.childNodes[l],{h:t});this._thumbnailWidth=g.getContentBox(this._slideDiv.childNodes[0]).w;this._slideDiv.style.width=this._items.length*(this._thumbnailWidth+this._offset)+"px";window.orientation&&(90==window.orientation||
-90==window.orientation)&&e.add(this.container,"galleryLandscape");this._calculateSlideStep()},startup:function(){this._focusedIndex=0;this.onFocus(this._items[this._focusedIndex])},destroy:function(){n.forEach(this.events,r.disconnect);r.disconnect(this._resizeHandle);this._touchBase=null;m.query("img",this.container).forEach(function(l){l._index=null;l._item=null;b.destroy(l);l=null});this._items=null;b.destroy(this._slideDiv);b.destroy(this.container);this.container=this._slideDiv=null},setFocus:function(l){var q;
if(l){var t=0;for(q=this._items.length;t<q;t++)this._items[t]==l&&(this._setFocus(t),this.onFocus(this._items[this._focusedIndex]))}},select:function(l){var q;if(l){var t=0;for(q=this._items.length;t<q;t++)if(this._items[t]==l){if(-1!=this._selectedIndex)this.onUnSelect(this._items[this._selectedIndex]);this._select(t);this.onSelect(this._items[this._selectedIndex]);break}}},getFocusedItem:function(){return this._items[this._focusedIndex]},getSelectedItem:function(){return this._items[this._selectedIndex]},
next:function(){this._next();this._startTransition();this.onFocus(this._items[this._currentIndex])},previous:function(){this._previous();this._startTransition();this.onFocus(this._items[this._currentIndex])},getTitleNode:function(l){var q;if(l){var t=0;for(q=this._items.length;t<q;t++)if(this._items[t]==l)return this._slideDiv.childNodes[t].childNodes[1]}},getInfoNode:function(l){var q;if(l){var t=0;for(q=this._items.length;t<q;t++)if(this._items[t]==l)return this._slideDiv.childNodes[t].childNodes[2]}},
showTitle:function(l){var q;if(l){var t=0;for(q=this._items.length;t<q;t++)if(this._items[t]==l){this._slideDiv.childNodes[t].childNodes[1].style.display="block";break}}},hideTitle:function(l){var q;if(l){var t=0;for(q=this._items.length;t<q;t++)if(this._items[t]==l){this._slideDiv.childNodes[t].childNodes[1].style.display="none";break}}},onFocus:function(l){},onSelect:function(l){},onUnSelect:function(l){},_onClickHandler:function(l){if(l.target instanceof HTMLImageElement){l=l.target._index;if(-1!=
this._selectedIndex)this.onUnSelect(this._items[this._selectedIndex]);this._select(l);this.onSelect(this._items[this._selectedIndex])}},_onTouchStartHandler:function(l){this._moveDirection=null;this._left=this._currentIndex*(-this._thumbnailWidth-this._offset);this._slideDiv.style.WebkitTransitionDuration="0s"},_onTouchMoveHandler:function(l){this._moveDirection||(this._moveDirection=Math.abs(l.curY)>Math.abs(l.curX)?"vertical":"horizontal");"vertical"==this._moveDirection?0==!this._touchBase._preventDefault&&
(this._touchBase._preventDefault=!1):"horizontal"==this._moveDirection&&(this._touchBase._preventDefault||(this._touchBase._preventDefault=!0),this._slideDiv.style.webkitTransform="translate3d("+(this._left+l.curX)+"px, 0, 0)")},_onTouchEndHandler:function(l){var q=this._currentIndex;this._slideDiv.style.WebkitTransitionDuration="0.5s";"left"==l.swipeDirection?this._next():"right"==l.swipeDirection&&this._previous();this._left=this._currentIndex*(-this._thumbnailWidth-this._offset);this._slideDiv.style.webkitTransform=
"translate3d("+this._left+"px, 0, 0)";if(q!=this._currentIndex)this.onFocus(this._items[this._currentIndex])},_onResizeHandler:function(l){switch(window.orientation){case 0:e.remove(this.container,"galleryLandscape");break;case 90:case -90:e.add(this.container,"galleryLandscape")}this._calculateSlideStep()},_startTransition:function(){this._slideDiv.style.WebkitTransitionDuration="0.5s";this._left=this._currentIndex*(-this._thumbnailWidth-this._offset);this._slideDiv.style.webkitTransform="translate3d("+
this._left+"px, 0, 0)"},_markUnSelected:function(l){e.remove(l,"selected");e.remove(l.parentNode,"selected");e.remove(l.parentNode.childNodes[1],"selected");e.remove(l.parentNode.childNodes[2],"selected")},_markSelected:function(l){e.add(l,"selected");e.add(l.parentNode,"selected");e.add(l.parentNode.childNodes[1],"selected");e.add(l.parentNode.childNodes[2],"selected")},_next:function(){this._currentIndex+this._slideStep<this._items.length&&(this._focusedIndex=this._currentIndex+=this._slideStep)},
_previous:function(){0<=this._currentIndex-this._slideStep&&(this._currentIndex-=this._slideStep);this._focusedIndex=this._currentIndex},_setFocus:function(l){this._focusedIndex=l;this._currentIndex=Math.floor(l/this._slideStep)*this._slideStep;this._startTransition()},_select:function(l){-1!=this._selectedIndex&&this._markUnSelected(this._slideDiv.childNodes[this._selectedIndex].childNodes[0]);this._selectedIndex=l;this._markSelected(this._slideDiv.childNodes[this._selectedIndex].childNodes[0])},
_calculateSlideStep:function(){var l=g.getContentBox(this.container),q=Math.floor((l.w+this._offset)/(this._thumbnailWidth+this._offset));1<=q?(l=l.w-(this._thumbnailWidth+this._offset)*q,this._slideDiv.style.marginLeft=0<l?Math.floor(l/2)+"px":"0px",this._slideStep=q):this._slideStep=1;-1!=this._selectedIndex?this._setFocus(this._selectedIndex):this._setFocus(this._focusedIndex)}});k("extend-esri")&&u.setObject("dijit.Gallery",G,h);return G})},"esri/dijit/Gauge":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/number dojo/has dojo/text!./templates/Gauge.html dijit/_WidgetBase dijit/_TemplatedMixin dojox/widget/AnalogGauge dojox/widget/gauge/AnalogArcIndicator ../kernel".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f){G=G([e,g],{declaredClass:"esri.dijit.Gauge",templateString:b,widgetsInTemplate:!1,constructor:function(l,q){this.caption="\x26nbsp;";this.color="#000";this.dataFormat="value";this.maxDataValue=100;this.title="\x26nbsp;";this.unitLabel="";this.fromWebmap=!1;this.feature=null;this.dataLabel="\x26nbsp;";u.mixin(this,l);this._majorTicks="";this.value=0;this.numberFormat=this.numberFormat||{places:0};this.fromWebmap&&(this.dataField=this.field,this.dataFormat=this.valueLabel,
this.dataLabelField=this.displayField,this.maxDataValue=this.target,this.unitLabel="");"percentage"==this.dataFormat&&(this.unitLabel="%",this._majorTicks={offset:90,interval:25,length:3,color:"black"});this.watch("caption",this._updateCaption);this.watch("dataLabel",this._updateDataLabel);this.watch("title",this._updateTitle);this.watch("value",this._updateValue);this.watch("feature",this._updateFeature)},startup:function(){this.inherited(arguments);var l=new c({interactionMode:"indicator",noChange:!0,
value:this.maxDataValue,width:20,offset:65,color:[204,204,204,1],title:"value",hideValue:!0,duration:100}),q=new c({interactionMode:"indicator",noChange:!1,value:this.value,width:20,offset:65,color:this.color,title:"value",hideValue:!0,onDragMove:"",duration:100});this.gaugeWidget=new h({background:[204,204,204,0],width:parseInt(this.gaugeNode.style.width),height:parseInt(this.gaugeNode.style.height)+10,cx:parseInt(this.gaugeNode.style.width)/2,cy:parseInt(this.gaugeNode.style.height),style:"position: absolute;",
radius:parseInt(this.gaugeNode.style.width)/2,useTooltip:!1,ranges:[{low:0,high:this.maxDataValue,color:"rgba(255,0,0,0)"}],majorTicks:this._majorTicks,indicators:[l,q]},n.create("div",null,this.gaugeNode));this.gaugeWidget.startup();this.gaugeWidget._handleMouseDownIndicator=function(){};this.valueNode=n.create("div",{innerHTML:"0"+this.unitLabel,style:{bottom:parseInt(this.gaugeNode.style.height)-(this.gaugeWidget.cy-20)+"px",color:"#000","font-family":"arial","font-size":"1em",left:"-1000px",position:"absolute"}},
this.gaugeWidget.domNode);l=m.getContentBox(this.valueNode);k.set(this.valueNode,"left",this.gaugeWidget.cx+"px");k.set(this.valueNode,"marginLeft",-l.w/2+"px");this.gaugeWidget.cx&&k.set(this.valueNode,"marginBottom",-l.h/2+"px");this.layer&&this._connectMouseOver()},destroy:function(){this._mouseOverHandler&&r.disconnect(this._mouseOverHandler);this.gaugeWidget.destroy();n.empty(this.domNode)},_connectMouseOver:function(){this._mouseOverHandler=r.connect(this.layer,"onMouseOver",u.hitch(this,function(l){this.set("feature",
l)}))},_formatValue:function(l){"percentage"===this.dataFormat&&(l=Math.round(l/this.maxDataValue*100));return d.format(l,this.numberFormat)},_updateCaption:function(l,q,t){this.captionNode.innerHTML=t},_updateTitle:function(l,q,t){this.titleNode.innerHTML=t},_updateValue:function(l,q,t){l=this._formatValue(t);this.valueNode.innerHTML=l+this.unitLabel;"percentage"===this.dataFormat?this.gaugeWidget.indicators[1].update(parseInt(l)):this.gaugeWidget.indicators[1].update(parseInt(t))},_updateDataLabel:function(l,
q,t){this.dataLabelNode.innerHTML=t},_updateFeature:function(l,q,t){!t||t.hasOwnPropety&&!t.hasOwnProperty("graphic")&&"esri.Graphic"==!t.declaredClass?console.log("Gauge Dijit:  a graphic is required to update the gauge."):(this.feature=t.graphic||t,this.set("value",this.feature.attributes[this.dataField]||0),this.set("dataLabel",this.feature.attributes[this.dataLabelField]||this.noDataLabel))}});a("extend-esri")&&u.setObject("dijit.Gauge",G,f);return G})},"dojox/widget/AnalogGauge":function(){define(["dojo",
"dijit","dojox","dojo/require!dojox/widget/gauge/_Gauge,dojox/gauges/AnalogGauge"],function(G,u,r){G.provide("dojox.widget.AnalogGauge");G.require("dojox.widget.gauge._Gauge");G.require("dojox.gauges.AnalogGauge");r.widget.AnalogGauge=r.gauges.AnalogGauge;r.widget.gauge.AnalogLineIndicator=r.gauges.AnalogLineIndicator})},"dojox/widget/gauge/_Gauge":function(){define(["dojo","dijit","dojox","dojo/require!dojox/gauges/_Gauge"],function(G,u,r){G.provide("dojox.widget.gauge._Gauge");G.require("dojox.gauges._Gauge");
r.widget.gauge._Gauge=r.gauges._Gauge;r.widget.gauge.Range=r.gauges.Range;r.widget.gauge._indicator=r.gauges._indicator})},"dojox/gauges/_Gauge":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/array dojo/_base/event dojo/_base/connect dojo/dom-construct dijit/_Widget dojox/gfx ./Range dojo/fx/easing".split(" "),function(G,u,r,n,m,k,d,a,b,e,g){G.deprecated("dojox.gauges","Use the new extensible dojox.dgauges framework instead","2.0");var h=0;return u("dojox.gauges._Gauge",
[b],{width:0,height:0,background:null,image:null,useRangeStyles:0,useTooltip:!0,majorTicks:null,minorTicks:null,_defaultIndicator:null,defaultColors:[[0,84,170,1],[68,119,187,1],[102,153,204,1],[153,187,238,1],[153,204,255,1],[204,238,255,1],[221,238,255,1]],min:null,max:null,surface:null,hideValues:!1,gaugeContent:void 0,_backgroundDefault:{color:"#E0E0E0"},_rangeData:null,_indicatorData:null,_drag:null,_img:null,_overOverlay:!1,_lastHover:"",startup:function(){null===this.image&&(this.image={});
this.connect(this.gaugeContent,"onmousedown",this.handleMouseDown);this.connect(this.gaugeContent,"onmousemove",this.handleMouseMove);this.connect(this.gaugeContent,"onmouseover",this.handleMouseOver);this.connect(this.gaugeContent,"onmouseout",this.handleMouseOut);this.connect(this.gaugeContent,"touchstart",this.handleTouchStart);this.connect(this.gaugeContent,"touchend",this.handleTouchEnd);this.connect(this.gaugeContent,"touchmove",this.handleTouchMove);r.isArray(this.ranges)||(this.ranges=[]);
r.isArray(this.indicators)||(this.indicators=[]);var c=[],f=[],l;if(this.hasChildren()){var q=this.getChildren();for(l=0;l<q.length;l++)if(/.*Indicator/.test(q[l].declaredClass))f.push(q[l]);else switch(q[l].declaredClass){case g.prototype.declaredClass:c.push(q[l])}this.ranges=this.ranges.concat(c);this.indicators=this.indicators.concat(f)}this.background||(this.background=this._backgroundDefault);this.background=this.background.color||this.background;this.surface||this.createSurface();this.addRanges(this.ranges);
this.minorTicks&&this.minorTicks.interval&&this.setMinorTicks(this.minorTicks);this.majorTicks&&this.majorTicks.interval&&this.setMajorTicks(this.majorTicks);for(l=0;l<this.indicators.length;l++)this.addIndicator(this.indicators[l]);this.inherited(arguments)},hasChildren:function(){return 0<this.getChildren().length},buildRendering:function(){var c=this.domNode=this.srcNodeRef?this.srcNodeRef:a.create("div");this.gaugeContent=a.create("div",{className:"dojoxGaugeContent"});this.containerNode=a.create("div");
for(this.mouseNode=a.create("div");c.hasChildNodes();)this.containerNode.appendChild(c.firstChild);a.place(this.gaugeContent,c);a.place(this.containerNode,c);a.place(this.mouseNode,c)},_setTicks:function(c,f,l){var q;if(c&&r.isArray(c._ticks))for(q=0;q<c._ticks.length;q++)this._removeScaleTick(c._ticks[q]);c={length:f.length,offset:f.offset,noChange:!0};f.color&&(c.color=f.color);f.font&&(c.font=f.font);f.labelPlacement&&(c.direction=f.labelPlacement);f._ticks=[];for(q=this.min;q<=this.max;q+=f.interval)if(q!=
this.max||!this._isScaleCircular()){c.value=q;if(l){var t=this._getNumberModule();c.label=t?f.fixedPrecision&&f.precision?t.format(q,{places:f.precision}):t.format(q):f.fixedPrecision&&f.precision?q.toFixed(f.precision):q.toString()}f._ticks.push(this._addScaleTick(c,l))}return f},_isScaleCircular:function(){return!1},setMinorTicks:function(c){this.minorTicks=this._setTicks(this.minorTicks,c,!1)},setMajorTicks:function(c){this.majorTicks=this._setTicks(this.majorTicks,c,!0)},postCreate:function(){this.hideValues&&
n.style(this.containerNode,"display","none");n.style(this.mouseNode,"width","0");n.style(this.mouseNode,"height","0");n.style(this.mouseNode,"position","absolute");n.style(this.mouseNode,"z-index","100");this.useTooltip&&require(["dijit/Tooltip"],dojo.hitch(this,function(c){c.show("test",this.mouseNode,!this.isLeftToRight());c.hide(this.mouseNode)}))},_getNumberModule:function(){if(0==h)try{h=require("dojo/number")}catch(c){h=null}return h},createSurface:function(){this.gaugeContent.style.width=this.width+
"px";this.gaugeContent.style.height=this.height+"px";this.surface=e.createSurface(this.gaugeContent,this.width,this.height);this._backgroundGroup=this.surface.createGroup();this._rangeGroup=this.surface.createGroup();this._minorTicksGroup=this.surface.createGroup();this._majorTicksGroup=this.surface.createGroup();this._overlayGroup=this.surface.createGroup();this._indicatorsGroup=this.surface.createGroup();this._foregroundGroup=this.surface.createGroup();this._background=this._backgroundGroup.createRect({x:0,
y:0,width:this.width,height:this.height});this._background.setFill(this.background);if(this.image.url){var c=this._backgroundGroup;this.image.overlay&&(c=this._overlayGroup);this._img=c.createImage({width:this.image.width||this.width,height:this.image.height||this.height,src:this.image.url});(this.image.x||this.image.y)&&this._img.setTransform({dx:this.image.x||0,dy:this.image.y||0})}},draw:function(){var c;if(this.surface){this.drawBackground(this._backgroundGroup);if(this._rangeData)for(c=0;c<this._rangeData.length;c++)this.drawRange(this._rangeGroup,
this._rangeData[c]);if(this._minorTicksData)for(c=0;c<this._minorTicksData.length;c++)this._minorTicksData[c].draw(this._minorTicksGroup);if(this._majorTicksData)for(c=0;c<this._majorTicksData.length;c++)this._majorTicksData[c].draw(this._majorTicksGroup);if(this._indicatorData)for(c=0;c<this._indicatorData.length;c++)this._indicatorData[c].draw(this._indicatorsGroup);this.drawForeground(this._foregroundGroup)}},drawBackground:function(c){},drawForeground:function(c){},setBackground:function(c){c||
(c=this._backgroundDefault);this.background=c.color||c;this._background.setFill(this.background)},addRange:function(c){this.addRanges([c])},addRanges:function(c){this._rangeData||(this._rangeData=[]);for(var f,l=0;l<c.length;l++){f=c[l];if(null===this.min||f.low<this.min)this.min=f.low;if(null===this.max||f.high>this.max)this.max=f.high;if(!f.color){var q=this._rangeData.length%this.defaultColors.length;e.svg&&0<this.useRangeStyles?(q=this._rangeData.length%this.useRangeStyles+1,f.color={style:"dojoxGaugeRange"+
q}):(q=this._rangeData.length%this.defaultColors.length,f.color=this.defaultColors[q])}this._rangeData[this._rangeData.length]=f}this.draw()},_addScaleTick:function(c,f){c.declaredClass||(c=new this._defaultIndicator(c));c._gauge=this;f?(this._majorTicksData||(this._majorTicksData=[]),this._majorTicksData[this._majorTicksData.length]=c,c.draw(this._majorTicksGroup)):(this._minorTicksData||(this._minorTicksData=[]),this._minorTicksData[this._minorTicksData.length]=c,c.draw(this._minorTicksGroup));
return c},_removeScaleTick:function(c){var f;if(this._majorTicksData)for(f=0;f<this._majorTicksData.length;f++)if(this._majorTicksData[f]===c){this._majorTicksData.splice(f,1);c.remove();return}if(this._minorTicksData)for(f=0;f<this._minorTicksData.length;f++)if(this._minorTicksData[f]===c){this._minorTicksData.splice(f,1);c.remove();break}},addIndicator:function(c){c.declaredClass||(c=new this._defaultIndicator(c));c._gauge=this;c.hideValue||this.containerNode.appendChild(c.domNode);this._indicatorData||
(this._indicatorData=[]);this._indicatorData[this._indicatorData.length]=c;c.draw(this._indicatorsGroup);return c},removeIndicator:function(c){for(var f=0;f<this._indicatorData.length;f++)if(this._indicatorData[f]===c){this._indicatorData.splice(f,1);c.remove();break}},moveIndicatorToFront:function(c){c.shape&&c.shape.moveToFront()},drawText:function(c,f,l,q,t,v,w){c=c.createText({x:l,y:q,text:f,align:t});c.setFill(v?v:"black");w&&c.setFont(w);return c},removeText:function(c){c.parent&&c.parent.remove(c)},
updateTooltip:function(c,f){this.useTooltip&&require(["dijit/Tooltip"],dojo.hitch(this,function(l){this._lastHover!=c&&(""!==c?(l.hide(this.mouseNode),l.show(c,this.mouseNode,!this.isLeftToRight())):l.hide(this.mouseNode),this._lastHover=c)}))},handleMouseOver:function(c){if(this.image&&this.image.overlay&&c.target==this._img.getEventSource()){this._overOverlay=!0;var f=this.getRangeUnderMouse(c);if(f&&f.hover)var l=f.hover;this.useTooltip&&!this._drag&&(l?this.updateTooltip(l,c):this.updateTooltip("",
c))}},handleMouseOut:function(c){this._overOverlay=!1;this._hideTooltip()},handleMouseMove:function(c){if(this.useTooltip&&(c&&(n.style(this.mouseNode,"left",c.pageX+1+"px"),n.style(this.mouseNode,"top",c.pageY+1+"px")),this._overOverlay)){var f=this.getRangeUnderMouse(c);f&&f.hover?this.updateTooltip(f.hover,c):this.updateTooltip("",c)}},handleMouseDown:function(c){var f=this._getInteractiveIndicator();f&&this._handleMouseDownIndicator(f,c)},_handleDragInteractionMouseMove:function(c){this._drag&&
(this._dragIndicator(this,c),k.stop(c))},_handleDragInteractionMouseUp:function(c){this._drag=null;for(var f=0;f<this._mouseListeners.length;f++)d.disconnect(this._mouseListeners[f]);this._mouseListeners=[];k.stop(c)},_handleMouseDownIndicator:function(c,f){c.noChange||(this._mouseListeners||(this._mouseListeners=[]),this._drag=c,this._mouseListeners.push(d.connect(document,"onmouseup",this,this._handleDragInteractionMouseUp)),this._mouseListeners.push(d.connect(document,"onmousemove",this,this._handleDragInteractionMouseMove)),
this._mouseListeners.push(d.connect(document,"ondragstart",this,k.stop)),this._mouseListeners.push(d.connect(document,"onselectstart",this,k.stop)),this._dragIndicator(this,f),k.stop(f))},_handleMouseOverIndicator:function(c,f){this.useTooltip&&!this._drag&&(c.hover?require(["dijit/Tooltip"],dojo.hitch(this,function(l){n.style(this.mouseNode,"left",f.pageX+1+"px");n.style(this.mouseNode,"top",f.pageY+1+"px");l.show(c.hover,this.mouseNode,!this.isLeftToRight())})):this.updateTooltip("",f));c.onDragMove&&
!c.noChange&&(this.gaugeContent.style.cursor="pointer")},_handleMouseOutIndicator:function(c,f){this._hideTooltip();this.gaugeContent.style.cursor="pointer"},_hideTooltip:function(){this.useTooltip&&this.mouseNode&&require(["dijit/Tooltip"],dojo.hitch(this,function(c){c.hide(this.mouseNode)}))},_handleMouseOutRange:function(c,f){this._hideTooltip()},_handleMouseOverRange:function(c,f){this.useTooltip&&!this._drag&&(c.hover?(n.style(this.mouseNode,"left",f.pageX+1+"px"),n.style(this.mouseNode,"top",
f.pageY+1+"px"),require(["dijit/Tooltip"],dojo.hitch(this,function(l){l.show(c.hover,this.mouseNode,!this.isLeftToRight())}))):this.updateTooltip("",f))},handleTouchStartIndicator:function(c,f){c.noChange||(this._drag=c,k.stop(f))},handleTouchStart:function(c){this._drag=this._getInteractiveIndicator();this.handleTouchMove(c)},handleTouchEnd:function(c){this._drag&&(this._drag=null,k.stop(c))},handleTouchMove:function(c){if(this._drag&&!this._drag.noChange){var f=c.touches[0];this._dragIndicatorAt(this,
f.pageX,f.pageY);k.stop(c)}},_getInteractiveIndicator:function(){for(var c=0;c<this._indicatorData.length;c++){var f=this._indicatorData[c];if("gauge"==f.interactionMode&&!f.noChange)return f}return null}})})},"dojox/gauges/Range":function(){define(["dojo/_base/declare","dijit/_Widget"],function(G,u){return G("dojox.gauges.Range",[u],{low:0,high:0,hover:"",color:null,size:0,startup:function(){this.color=this.color?this.color.color||this.color:"black"}})})},"dojo/fx/easing":function(){define(["../_base/lang"],
function(G){var u={linear:function(r){return r},quadIn:function(r){return Math.pow(r,2)},quadOut:function(r){return r*(r-2)*-1},quadInOut:function(r){r*=2;return 1>r?Math.pow(r,2)/2:-1*(--r*(r-2)-1)/2},cubicIn:function(r){return Math.pow(r,3)},cubicOut:function(r){return Math.pow(r-1,3)+1},cubicInOut:function(r){r*=2;return 1>r?Math.pow(r,3)/2:(Math.pow(r-2,3)+2)/2},quartIn:function(r){return Math.pow(r,4)},quartOut:function(r){return-1*(Math.pow(r-1,4)-1)},quartInOut:function(r){r*=2;return 1>r?
Math.pow(r,4)/2:-.5*(Math.pow(r-2,4)-2)},quintIn:function(r){return Math.pow(r,5)},quintOut:function(r){return Math.pow(r-1,5)+1},quintInOut:function(r){r*=2;return 1>r?Math.pow(r,5)/2:(Math.pow(r-2,5)+2)/2},sineIn:function(r){return-1*Math.cos(Math.PI/2*r)+1},sineOut:function(r){return Math.sin(Math.PI/2*r)},sineInOut:function(r){return-1*(Math.cos(Math.PI*r)-1)/2},expoIn:function(r){return 0==r?0:Math.pow(2,10*(r-1))},expoOut:function(r){return 1==r?1:-1*Math.pow(2,-10*r)+1},expoInOut:function(r){if(0==
r)return 0;if(1==r)return 1;r*=2;if(1>r)return Math.pow(2,10*(r-1))/2;--r;return(-1*Math.pow(2,-10*r)+2)/2},circIn:function(r){return-1*(Math.sqrt(1-Math.pow(r,2))-1)},circOut:function(r){return Math.sqrt(1-Math.pow(r-1,2))},circInOut:function(r){r*=2;return 1>r?-.5*(Math.sqrt(1-Math.pow(r,2))-1):.5*(Math.sqrt(1-Math.pow(r-2,2))+1)},backIn:function(r){return Math.pow(r,2)*(2.70158*r-1.70158)},backOut:function(r){--r;return Math.pow(r,2)*(2.70158*r+1.70158)+1},backInOut:function(r){r*=2;if(1>r)return Math.pow(r,
2)*(3.5949095*r-2.5949095)/2;r-=2;return(Math.pow(r,2)*(3.5949095*r+2.5949095)+2)/2},elasticIn:function(r){if(0==r||1==r)return r;--r;return-1*Math.pow(2,10*r)*Math.sin(2*(r-.075)*Math.PI/.3)},elasticOut:function(r){return 0==r||1==r?r:Math.pow(2,-10*r)*Math.sin(2*(r-.075)*Math.PI/.3)+1},elasticInOut:function(r){if(0==r)return 0;r*=2;if(2==r)return 1;var n=.3*1.5,m=n/4;if(1>r)return--r,-.5*Math.pow(2,10*r)*Math.sin(2*(r-m)*Math.PI/n);--r;return.5*Math.pow(2,-10*r)*Math.sin(2*(r-m)*Math.PI/n)+1},bounceIn:function(r){return 1-
u.bounceOut(1-r)},bounceOut:function(r){return r<1/2.75?7.5625*Math.pow(r,2):r<2/2.75?7.5625*Math.pow(r-1.5/2.75,2)+.75:r<2.5/2.75?7.5625*Math.pow(r-2.25/2.75,2)+.9375:7.5625*Math.pow(r-2.625/2.75,2)+.984375},bounceInOut:function(r){return.5>r?u.bounceIn(2*r)/2:u.bounceOut(2*r-1)/2+.5}};G.setObject("dojo.fx.easing",u);return u})},"dojox/gauges/AnalogGauge":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/html dojo/_base/event dojox/gfx ./_Gauge ./AnalogLineIndicator dojo/dom-geometry".split(" "),
function(G,u,r,n,m,k,d,a,b,e){return u("dojox.gauges.AnalogGauge",a,{startAngle:-90,endAngle:90,cx:0,cy:0,radius:0,orientation:"clockwise",_defaultIndicator:b,startup:function(){this.getChildren&&r.forEach(this.getChildren(),function(g){g.startup()});this.startAngle=Number(this.startAngle);this.endAngle=Number(this.endAngle);this.cx=Number(this.cx);this.cx||(this.cx=this.width/2);this.cy=Number(this.cy);this.cy||(this.cy=this.height/2);this.radius=Number(this.radius);this.radius||(this.radius=Math.min(this.cx,
this.cy)-25);this.inherited(arguments)},_getAngle:function(g){var h=Number(g);null==g||isNaN(h)||h<=this.min?h=this._mod360(this.startAngle):h>=this.max?h=this._mod360(this.endAngle):(g=this._mod360(this.startAngle),h-=this.min,"clockwise"!=this.orientation&&(h=-h),h=this._mod360(g+this._getAngleRange()*h/Math.abs(this.min-this.max)));return h},_getValueForAngle:function(g){var h=this._mod360(this.startAngle),c=this._mod360(this.endAngle);if(this._angleInRange(g))return c=Math.abs(this.max-this.min),
g=this._mod360("clockwise"==this.orientation?g-h:-g+h),this.min+c*g/this._getAngleRange();h=this._mod360(h-g);var f=360-h;g=this._mod360(c-g);return Math.min(h,f)<Math.min(g,360-g)?this.min:this.max},_getAngleRange:function(){var g=this._mod360(this.startAngle),h=this._mod360(this.endAngle);return g==h?360:"clockwise"==this.orientation?h<g?360-(g-h):h-g:h<g?g-h:360-(h-g)},_angleInRange:function(g){var h=this._mod360(this.startAngle),c=this._mod360(this.endAngle);if(h==c)return!0;g=this._mod360(g);
return"clockwise"==this.orientation?h<c?g>=h&&g<=c:!(g>c&&g<h):h<c?!(g>h&&g<c):g>=c&&g<=h},_isScaleCircular:function(){return this._mod360(this.startAngle)==this._mod360(this.endAngle)},_mod360:function(g){for(;360<g;)g-=360;for(;0>g;)g+=360;return g},_getRadians:function(g){return g*Math.PI/180},_getDegrees:function(g){return 180*g/Math.PI},drawRange:function(g,h){h.shape&&(h.shape.parent.remove(h.shape),h.shape=null);if(h.low==this.min&&h.high==this.max&&this._mod360(this.endAngle)==this._mod360(this.startAngle))g=
g.createCircle({cx:this.cx,cy:this.cy,r:this.radius});else{var c=this._getRadians(this._getAngle(h.low));var f=this._getRadians(this._getAngle(h.high));if("cclockwise"==this.orientation){var l=f;f=c;c=l}l=this.cx+this.radius*Math.sin(c);var q=this.cy-this.radius*Math.cos(c),t=this.cx+this.radius*Math.sin(f),v=this.cy-this.radius*Math.cos(f),w=0;(c<=f?f-c:2*Math.PI-c+f)>Math.PI&&(w=1);g=g.createPath();h.size?g.moveTo(this.cx+(this.radius-h.size)*Math.sin(c),this.cy-(this.radius-h.size)*Math.cos(c)):
g.moveTo(this.cx,this.cy);g.lineTo(l,q);g.arcTo(this.radius,this.radius,0,w,1,t,v);h.size&&(g.lineTo(this.cx+(this.radius-h.size)*Math.sin(f),this.cy-(this.radius-h.size)*Math.cos(f)),g.arcTo(this.radius-h.size,this.radius-h.size,0,w,0,this.cx+(this.radius-h.size)*Math.sin(c),this.cy-(this.radius-h.size)*Math.cos(c)));g.closePath()}n.isArray(h.color)||n.isString(h.color)?(g.setStroke({color:h.color}),g.setFill(h.color)):h.color.type?(c=this._getRadians(this._getAngle(h.low)),f=this._getRadians(this._getAngle(h.high)),
h.color.x1=this.cx+this.radius*Math.sin(c)/2,h.color.x2=this.cx+this.radius*Math.sin(f)/2,h.color.y1=this.cy-this.radius*Math.cos(c)/2,h.color.y2=this.cy-this.radius*Math.cos(f)/2,g.setFill(h.color),g.setStroke({color:h.color.colors[0].color})):d.svg&&(g.setStroke({color:"green"}),g.setFill("green"),g.getEventSource().setAttribute("class",h.color.style));g.connect("onmouseover",n.hitch(this,this._handleMouseOverRange,h));g.connect("onmouseout",n.hitch(this,this._handleMouseOutRange,h));h.shape=g},
getRangeUnderMouse:function(g){var h=null,c=e.getContentBox(this.gaugeContent),f=g.clientX-c.x;g=g.clientY-c.y;if(Math.sqrt((g-this.cy)*(g-this.cy)+(f-this.cx)*(f-this.cx))<this.radius&&(f=this._getDegrees(Math.atan2(g-this.cy,f-this.cx)+Math.PI/2),f=this._getValueForAngle(f),this._rangeData))for(g=0;g<this._rangeData.length&&!h;g++)Number(this._rangeData[g].low)<=f&&Number(this._rangeData[g].high)>=f&&(h=this._rangeData[g]);return h},_dragIndicator:function(g,h){this._dragIndicatorAt(g,h.pageX,h.pageY);
k.stop(h)},_dragIndicatorAt:function(g,h,c){var f=e.position(g.gaugeContent,!0);h=g._getDegrees(Math.atan2(c-f.y-g.cy,h-f.x-g.cx)+Math.PI/2);h=g._getValueForAngle(h);h=Math.min(Math.max(h,g.min),g.max);g._drag.value=g._drag.currentValue=h;g._drag.onDragMove(g._drag);g._drag.draw(this._indicatorsGroup,!0);g._drag.valueChanged()}})})},"dojox/gauges/AnalogLineIndicator":function(){define(["dojo/_base/declare","./AnalogIndicatorBase"],function(G,u){return G("dojox.gauges.AnalogLineIndicator",[u],{_getShapes:function(r){var n=
this.length;"inside"==this.direction&&(n=-n);return[r.createLine({x1:0,y1:-this.offset,x2:0,y2:-n-this.offset}).setStroke({color:this.color,width:this.width})]}})})},"dojox/gauges/AnalogIndicatorBase":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/connect dojo/_base/fx dojox/gfx ./_Indicator".split(" "),function(G,u,r,n,m,k){return u("dojox.gauges.AnalogIndicatorBase",[k],{draw:function(d,a){if(this.shape)this._move(a);else{this.text&&(this.text.parent.remove(this.text),this.text=
null);a=this._gauge._getAngle(Math.min(Math.max(this.value,this._gauge.min),this._gauge.max));this.color=this.color||"#000000";this.length=this.length||this._gauge.radius;this.width=this.width||1;this.offset=this.offset||0;this.highlight=this.highlight||"#D0D0D0";var b=this._getShapes(d,this._gauge,this);if(b){if(1<b.length){this.shape=d.createGroup();for(var e=0;e<b.length;e++)this.shape.add(b[e])}else this.shape=b[0];this.shape.setTransform([{dx:this._gauge.cx,dy:this._gauge.cy},m.matrix.rotateg(a)]);
this.shape.connect("onmouseover",this,this.handleMouseOver);this.shape.connect("onmouseout",this,this.handleMouseOut);this.shape.connect("onmousedown",this,this.handleMouseDown);this.shape.connect("touchstart",this,this.handleTouchStart)}this.label&&((b=this.direction)||(b="outside"),e="inside"==b?-this.length+this.offset-5:this.length+this.offset+5,a=this._gauge._getRadians(90-a),this._layoutLabel(d,this.label+"",this._gauge.cx,this._gauge.cy,e,a,b));this.currentValue=this.value}},_layoutLabel:function(d,
a,b,e,g,h,c){var f=this.font?this.font:m.defaultFont,l=m._base._getTextBox(a,{font:m.makeFontString(m.makeParameters(m.defaultFont,f))}).w;f=m.normalizedLength(f.size);var q=b+Math.cos(h)*g-l/2,t=e-Math.sin(h)*g-f/2,v=[];var w=q;var x=-Math.tan(h)*w+e+Math.tan(h)*b;x>=t&&x<=t+f&&v.push({x:w,y:x});w=q+l;x=-Math.tan(h)*w+e+Math.tan(h)*b;x>=t&&x<=t+f&&v.push({x:w,y:x});w=t;x=-1/Math.tan(h)*w+b+1/Math.tan(h)*e;x>=q&&x<=q+l&&v.push({x:x,y:w});w=t+f;x=-1/Math.tan(h)*w+b+1/Math.tan(h)*e;x>=q&&x<=q+l&&v.push({x:x,
y:w});if("inside"==c)for(c=0;c<v.length;c++){if(w=v[c],w=this._distance(w.x,w.y,b,e)-g,0<=w){q=b+Math.cos(h)*(g-w)-l/2;t=e-Math.sin(h)*(g-w)-f/2;break}}else for(c=0;c<v.length;c++)if(w=v[c],w=this._distance(w.x,w.y,b,e)-g,0>=w){q=b+Math.cos(h)*(g-w)-l/2;t=e-Math.sin(h)*(g-w)-f/2;break}this.text=this._gauge.drawText(d,a,q+l/2,t+f,"middle",this.color,this.font)},_distance:function(d,a,b,e){return Math.sqrt((b-d)*(b-d)+(e-a)*(e-a))},_move:function(d){var a=Math.min(Math.max(this.value,this._gauge.min),
this._gauge.max),b=this.currentValue;d?(d=this._gauge._getAngle(a),this.shape.setTransform([{dx:this._gauge.cx,dy:this._gauge.cy},m.matrix.rotateg(d)]),this.currentValue=a):b!=a&&(a=new n.Animation({curve:[b,a],duration:this.duration,easing:this.easing}),r.connect(a,"onAnimate",G.hitch(this,function(e){this.shape.setTransform([{dx:this._gauge.cx,dy:this._gauge.cy},m.matrix.rotateg(this._gauge._getAngle(e))]);this.currentValue=e})),a.play())}})})},"dojox/gauges/_Indicator":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/fx dojo/_base/html dojo/_base/connect dijit/_Widget dojo/dom-construct dojo/dom-class".split(" "),
function(G,u,r,n,m,k,d,a){return u("dojox.gauges._Indicator",[k],{value:0,type:"",color:"black",strokeColor:"",label:"",font:{family:"sans-serif",size:"12px"},length:0,width:0,offset:0,hover:"",front:!1,easing:r._defaultEasing,duration:1E3,hideValue:!1,noChange:!1,interactionMode:"indicator",_gauge:null,title:"",startup:function(){this.onDragMove&&(this.onDragMove=G.hitch(this.onDragMove));""===this.strokeColor&&(this.strokeColor=void 0)},postCreate:function(){""===this.title&&n.style(this.domNode,
"display","none");G.isString(this.easing)&&(this.easing=G.getObject(this.easing))},buildRendering:function(){var b=this.domNode=this.srcNodeRef?this.srcNodeRef:d.create("div");a.add(b,"dojoxGaugeIndicatorDiv");var e=d.create("label");this.title&&(e.innerHTML=this.title+":");d.place(e,b);this.valueNode=d.create("input",{className:"dojoxGaugeIndicatorInput",size:5,value:this.value});d.place(this.valueNode,b);m.connect(this.valueNode,"onchange",this,this._update)},_update:function(){this._updateValue(!0)},
_updateValue:function(b){var e=this.valueNode.value;""===e?this.value=null:(this.value=Number(e),this.hover=this.title+": "+e);this._gauge&&(this.draw(this._gauge._indicatorsGroup,b||void 0==b?!1:!0),this.valueNode.value=this.value,("Target"==this.title||this.front)&&this._gauge.moveIndicator&&this._gauge.moveIndicatorToFront(this),this.valueChanged())},valueChanged:function(){},update:function(b,e){this.noChange||(this.valueNode.value=b,this._updateValue(e))},handleMouseOver:function(b){this._gauge._handleMouseOverIndicator(this,
b)},handleMouseOut:function(b){this._gauge._handleMouseOutIndicator(this,b);this._gauge.gaugeContent.style.cursor=""},handleMouseDown:function(b){this._gauge._handleMouseDownIndicator(this,b)},handleTouchStart:function(b){this._gauge.handleTouchStartIndicator(this,b)},onDragMove:function(){this.value=Math.floor(this.value);this.valueNode.value=this.value;this.hover=this.title+": "+this.value},draw:function(b){},remove:function(){this.shape&&this.shape.parent.remove(this.shape);this.shape=null;this.text&&
this.text.parent.remove(this.text);this.text=null}})})},"dojox/widget/gauge/AnalogArcIndicator":function(){define(["dojo","dijit","dojox","dojo/require!dojox/gauges/AnalogArcIndicator"],function(G,u,r){G.provide("dojox.widget.gauge.AnalogArcIndicator");G.require("dojox.gauges.AnalogArcIndicator");r.widget.gauge.AnalogArcIndicator=r.gauges.AnalogArcIndicator})},"dojox/gauges/AnalogArcIndicator":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/_base/fx","./AnalogIndicatorBase"],
function(G,u,r,n,m){return G("dojox.gauges.AnalogArcIndicator",[m],{_createArc:function(k){if(this.shape){var d=this._gauge._mod360(this._gauge.startAngle),a=this._gauge._getRadians(this._gauge._getAngle(k)),b=this._gauge._getRadians(d);"cclockwise"==this._gauge.orientation&&(d=a,a=b,b=d);d=0;(b<=a?a-b:2*Math.PI+a-b)>Math.PI&&(d=1);var e=Math.cos(a);a=Math.sin(a);var g=Math.cos(b);b=Math.sin(b);var h=this.offset+this.width,c=["M"];c.push(this._gauge.cx+this.offset*b);c.push(this._gauge.cy-this.offset*
g);c.push("A",this.offset,this.offset,0,d,1);c.push(this._gauge.cx+this.offset*a);c.push(this._gauge.cy-this.offset*e);c.push("L");c.push(this._gauge.cx+h*a);c.push(this._gauge.cy-h*e);c.push("A",h,h,0,d,0);c.push(this._gauge.cx+h*b);c.push(this._gauge.cy-h*g);c.push("z");this.shape.setShape(c.join(" "));this.currentValue=k}},draw:function(k,d){var a=this.value;a<this._gauge.min&&(a=this._gauge.min);a>this._gauge.max&&(a=this._gauge.max);if(this.shape)d?this._createArc(a):(k=new n.Animation({curve:[this.currentValue,
a],duration:this.duration,easing:this.easing}),r.connect(k,"onAnimate",u.hitch(this,this._createArc)),k.play());else{d=this.color?this.color:"black";var b={color:this.strokeColor?this.strokeColor:d,width:1};this.color.type&&!this.strokeColor&&(b.color=this.color.colors[0].color);this.shape=k.createPath().setStroke(b).setFill(d);this._createArc(a);this.shape.connect("onmouseover",this,this.handleMouseOver);this.shape.connect("onmouseout",this,this.handleMouseOut);this.shape.connect("onmousedown",this,
this.handleMouseDown);this.shape.connect("touchstart",this,this.handleTouchStart)}}})})},"esri/dijit/Geocoder":function(){define("require dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/_base/event dojo/dom-attr dojo/dom-class dojo/dom-style dojo/dom-construct dojo/keys dojo/on dojo/query dojo/i18n!../nls/jsapi dojo/text!./templates/Geocoder.html dojo/uacss dojo/_base/kernel dijit/a11yclick dijit/_TemplatedMixin dijit/focus dijit/_FocusMixin ../kernel ../urlUtils ../SpatialReference ../graphic ../symbols/PictureMarkerSymbol ./_EventedWidget ../geometry/Point ../geometry/Extent ../tasks/locator ../tasks/query ../tasks/QueryTask ../geometry/scaleUtils".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z,E,J,D,L,C,N,S,F,T){u=u("esri.dijit.Geocoder",[D,v,x],{templateString:f,reHostedFS:/https?:\/\/services.*\.arcgis\.com/i,_eventMap:{select:["result"],"find-results":["results"],"auto-complete":["results"],"geocoder-select":["geocoder"],clear:!0,"enter-key-select":!0,load:!0},constructor:function(y,B){q.deprecated("esri.dijit.Geocoder","Use esri.dijit.Search instead","4.0");this._css={GeocoderContainerClass:"esriGeocoderContainer",GeocoderClass:"esriGeocoder",
GeocoderMultipleClass:"esriGeocoderMultiple",GeocoderIconClass:"esriGeocoderIcon",GeocoderActiveClass:"esriGeocoderActive",GeocoderResultsOpenClass:"esriGeocoderResultsOpen",GeocoderMenuOpenClass:"esriGeocoderMenuOpen",loadingClass:"esriGeocoderLoading",resultsContainerClass:"esriGeocoderResults",resultsItemClass:"esriGeocoderResult",resultsItemEvenClass:"esriGeocoderResultEven",resultsItemOddClass:"esriGeocoderResultOdd",resultsItemFirstClass:"esriGeocoderResultFirst",resultsItemLastClass:"esriGeocoderResultLast",
resultsPartialMatchClass:"esriGeocoderResultPartial",searchButtonClass:"esriGeocoderSearch",clearButtonClass:"esriGeocoderReset",hasValueClass:"esriGeocoderHasValue",geocoderMenuClass:"esriGeocoderMenu",geocoderMenuHeaderClass:"esriGeocoderMenuHeader",geocoderMenuCloseClass:"esriGeocoderMenuClose",activeMenuClass:"esriGeocoderMenuActive",geocoderMenuArrowClass:"esriGeocoderMenuArrow",geocoderSelectedClass:"esriGeocoderSelected",geocoderSelectedCheckClass:"esriGeocoderSelectedCheck",GeocoderClearClass:"esriGeocoderClearFloat"};
this.options={autoComplete:!1,arcgisGeocoder:!0,value:"",theme:"simpleGeocoder",activeGeocoderIndex:0,maxLocations:6,minCharacters:3,searchDelay:300,geocoderMenu:!0,autoNavigate:!0,showResults:!0,map:null,activeGeocoder:null,geocoders:null,zoomScale:1E4,highlightLocation:!1,symbol:new J(G.toUrl("./images/sdk_gps_location.png"),28,28),graphicsLayer:null};y=r.mixin({},this.options,y);this.set("autoComplete",y.autoComplete);this.set("arcgisGeocoder",y.arcgisGeocoder);this.set("value",y.value);this.set("theme",
y.theme);this.set("activeGeocoderIndex",y.activeGeocoderIndex);this.set("maxLocations",y.maxLocations);this.set("minCharacters",y.minCharacters);this.set("searchDelay",y.searchDelay);this.set("geocoderMenu",y.geocoderMenu);this.set("autoNavigate",y.autoNavigate);this.set("showResults",y.showResults);this.set("map",y.map);this.set("activeGeocoder",y.activeGeocoder);this.set("geocoders",y.geocoders);this.set("zoomScale",y.zoomScale);this.set("highlightLocation",y.highlightLocation);this.set("symbol",
y.symbol);this.set("graphicsLayer",y.graphicsLayer);this.set("results",[]);this._i18n=c;this._deferreds=[];this._defaultSR=new z(4326);this.watch("value",this._updateValue);this.watch("theme",this._updateTheme);this.watch("activeGeocoder",this._setActiveGeocoder);this.watch("activeGeocoderIndex",this._setActiveGeocoderIndex);this.watch("geocoders",this._updateGeocoder);this.watch("arcgisGeocoder",this._updateGeocoder);this.watch("geocoderMenu",this._updateGeocoder);this.watch("map",this._setupEvents);
this.domNode=B},startup:function(){this.inherited(arguments);if(this._geocoders.length)if(this.domNode)if(this.get("map"))if(this.get("map").loaded)this._init();else g.once(this.get("map"),"load",r.hitch(this,function(){this._init()}));else this._init();else console.log("Geocoder:: domNode is undefined."),this.destroy();else console.log("Geocoder:: No geocoders defined."),this.destroy()},postCreate:function(){this.inherited(arguments);this.own(g(this.submitNode,t,r.hitch(this,this._findThenSelect)));
this.own(g(this.geocoderMenuArrowNode,t,r.hitch(this,this._toggleGeolocatorMenu)));this.own(g(this.inputNode,t,r.hitch(this,this._inputClick)));this.own(g(this.clearNode,t,r.hitch(this,this.clear)));this.own(g(this.geocoderMenuCloseNode,t,r.hitch(this,this._hideGeolocatorMenu)));this._updateGeocoder();this._setupEvents();this.get("value")&&this._checkStatus();this._hideMenus()},destroy:function(){this._removeEvents();b.empty(this.domNode);this.inherited(arguments)},clear:function(){this.onClear();
var y=this.get("highlightGraphic"),B=this.get("graphicsLayer");y&&(B?B.remove(y):this.get("map").graphics.remove(y),this.set("highlightGraphic",null));k.set(this.inputNode,"value","");this.set("value","");this.set("results",[]);d.remove(this.containerNode,this._css.hasValueClass);k.set(this.clearNode,"title","");this._hideMenus();this._hideLoading()},show:function(){a.set(this.domNode,"display","block")},hide:function(){a.set(this.domNode,"display","none")},find:function(y){var B=new n;if(y)if("string"===
typeof y)this._findQuery(y).then(function(P){B.resolve(P)});else if("object"===typeof y&&y.hasOwnProperty("geometry")){switch(y.geometry.type){case "extent":var I=y.geometry.getCenter();break;case "multipoint":I=y.geometry.getExtent().getCenter();break;case "point":I=y.geometry;break;case "polygon":I=y.geometry.getExtent().getCenter();break;case "polyline":I=y.geometry.getExtent().getCenter()}I&&this._reverseGeocodePoint(I,y.geometry).then(function(P){P.results[0]&&(y.hasOwnProperty("attributes")&&
P.results[0].feature.setAttributes(r.mixin(P.results[0].feature.attributes,y.attributes)),y.hasOwnProperty("infoTemplate")&&P.results[0].feature.setInfoTemplate(y.infoTemplate),y.hasOwnProperty("symbol")&&P.results[0].feature.setSymbol(y.symbol));B.resolve(P)},function(P){B.reject(P)})}else"object"===typeof y&&"point"===y.type?this._reverseGeocodePoint(y).then(function(P){B.resolve(P)},function(P){B.reject(P)}):y instanceof Array&&2===y.length?(I=new L(y,new z({wkid:4326})),this._reverseGeocodePoint(I).then(function(P){B.resolve(P)},
function(P){B.reject(P)})):B.reject("Geocoder:: Invalid find type");else this._findQuery(this.get("value")).then(function(P){B.resolve(P)});return B.promise},focus:function(){w.focus(this.inputNode);var y=this.get("map");y&&y.disableKeyboardNavigation()},blur:function(){w.curNode&&w.curNode.blur();this.inputNode.blur();this._hideMenus();var y=this.get("map");y&&y.enableKeyboardNavigation()},select:function(y){this.onSelect(y);this._hideMenus();this._hideLoading();this.get("autoNavigate")&&y&&y.hasOwnProperty("extent")&&
this.get("map")&&this.get("map").setExtent(y.extent);if(y.feature){var B=this.get("highlightGraphic"),I=this.get("graphicsLayer"),P=this.get("symbol")||y.feature.symbol;B?(B.setGeometry(y.feature.geometry),B.setAttributes(y.feature.attributes),B.setInfoTemplate(y.feature.infoTemplate),B.setSymbol(P)):(B=y.feature,this.get("highlightLocation")&&(B.setSymbol(P),I?I.add(B):this.get("map").graphics.add(B)));this.set("highlightGraphic",B)}},onSelect:function(){},onFindResults:function(){},onAutoComplete:function(){},
onGeocoderSelect:function(){},onClear:function(){},onEnterKeySelect:function(){},onLoad:function(){},_onFocus:function(){this.focus();this.inherited(arguments)},_onBlur:function(){this.blur();this.inherited(arguments)},_autoComplete:function(){var y=this.get("activeGeocoder"),B=this.reHostedFS.test(y.url);("query"!==y.type||B)&&this._query({delay:this.get("searchDelay"),autoComplete:!0,search:this.get("value")}).then(r.hitch(this,function(I){this.onAutoComplete(I);this.get("showResults")&&this._showResults(I)}))},
_init:function(){this.set("loaded",!0);this.onLoad()},_containsNonLatinCharacter:function(y){for(var B=0;B<y.length;B++)if(255<y.charCodeAt(B))return!0;return!1},_findQuery:function(y){var B=new n;this._query({delay:0,search:y}).then(r.hitch(this,function(I){this.onFindResults(I);B.resolve(I)}),r.hitch(this,function(I){this.onFindResults(I);B.reject(I)}));return B.promise},_reverseGeocodePoint:function(y,B){var I=new n;if(y&&this.get("activeGeocoder")){var P=B||y;B=this.get("activeGeocoder").distance||
1500;this._task.outSpatialReference=this._defaultSR;this.get("map")&&(this._task.outSpatialReference=this.get("map").spatialReference);this._task.locationToAddress(y,B,r.hitch(this,function(X){X={results:[this._hydrateResult(X)],geometry:P};this.onFindResults(X);I.resolve(X)}),r.hitch(this,function(X){I.reject(X)}))}else I.reject("Geocoder:: no point or active geocoder defined");return I.promise},_setEsriGeocoder:function(){this.get("arcgisGeocoder")?("object"===typeof this.get("arcgisGeocoder")?
this._arcgisGeocoder=this.get("arcgisGeocoder"):this._arcgisGeocoder={},this._arcgisGeocoder.hasOwnProperty("suggest")||(this._arcgisGeocoder.suggest=!0),this._arcgisGeocoder.hasOwnProperty("singleLineFieldName")||(this._arcgisGeocoder.singleLineFieldName="SingleLine"),this._arcgisGeocoder.url||(this._arcgisGeocoder.url=A.getProtocolForWebResource()+"//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"),this._arcgisGeocoder.name||(this._arcgisGeocoder.name=c.widgets.Geocoder.esriGeocoderName),
this._arcgisGeocoder.hasOwnProperty("localSearchOptions")||(this._arcgisGeocoder.localSearchOptions={minScale:3E5,distance:5E4}),this.set("arcgisGeocoder",this._arcgisGeocoder)):this.set("arcgisGeocoder",!1)},_setActiveGeocoder:function(){this.set("activeGeocoder",this._geocoders[this.get("activeGeocoderIndex")]);this._task="query"===this.activeGeocoder.type?new F(this.get("activeGeocoder").url):new N(this.get("activeGeocoder").url);this._updatePlaceholder()},_setGeocoderList:function(){var y=[];
this.get("arcgisGeocoder")&&(y=y.concat([this._arcgisGeocoder]));this.get("geocoders")&&this.get("geocoders").length&&(y=y.concat(this.get("geocoders")));this._geocoders=y},_updateGeocoder:function(){this.set("activeGeocoderIndex",0);this._setEsriGeocoder();this._setGeocoderList();this._setActiveGeocoder();this._insertGeocoderMenuItems()},_updatePlaceholder:function(){this._placeholder="";this.get("activeGeocoder")&&this.get("activeGeocoder").placeholder&&(this._placeholder=this.get("activeGeocoder").placeholder);
k.set(this.inputNode,"placeholder",this._placeholder);k.set(this.submitNode,"title",this._placeholder)},_updateValue:function(y,B,I){this._ignoreUpdateValue||(k.set(this.inputNode,"value",I),this._checkStatus())},_updateTheme:function(y,B,I){d.remove(this.domNode,B);d.add(this.domNode,I)},_setActiveGeocoderIndex:function(y,B,I){this.set("activeGeocoderIndex",I);this._setActiveGeocoder();this._hideMenus();this._insertGeocoderMenuItems();y={attr:this.get("activeGeocoder"),oldVal:B,newVal:I};this.onGeocoderSelect(y)},
_clearQueryTimeout:function(){this._queryTimer&&clearTimeout(this._queryTimer)},_query:function(y){y||(y={delay:0});y.search||(y.search=this.get("value"));var B=new n;this._deferreds.push(B);y.delay?(this._clearQueryTimeout(),this._queryTimer=setTimeout(r.hitch(this,function(){this._performTask(B,y)}),y.delay)):this._performTask(B,y);return B.promise},_performTask:function(y,B){if(B.search){this._hideGeolocatorMenu();this._showLoading();var I="";this.get("activeGeocoder").prefix&&(I+=this.get("activeGeocoder").prefix);
I+=B.search;this.get("activeGeocoder").suffix&&(I+=this.get("activeGeocoder").suffix);var P=this.get("activeGeocoder").outFields;P&&(P instanceof Array||(P=[P]));var X=this.get("maxLocations")||6,Y=this.get("activeGeocoder").searchExtent,aa=this._defaultSR;this.get("map")&&(aa=this.get("map").spatialReference);if("query"===this.get("activeGeocoder").type){var Z=new S;Z.outSpatialReference=aa;Z.returnGeometry=!0;Z.num=X;Y&&(Z.geometry=Y);X=this.get("activeGeocoder").exactMatch;Y=this.get("activeGeocoder").field;
aa="";this.reHostedFS.test(this.get("activeGeocoder").url)&&this._containsNonLatinCharacter(I)&&(aa="N");Z.where=X?Y+" \x3d "+aa+"'"+I+"'":"UPPER("+Y+") LIKE "+aa+"'%"+I.toUpperCase()+"%'";P&&(Z.outFields=P);this._task.execute(Z,r.hitch(this,function(fa){this._receivedResults(fa.features,y,B)}),r.hitch(this,function(fa){this._receivedResults([],y,B)}))}else Z={},this.get("activeGeocoder").categories&&(Z.categories=this.get("activeGeocoder").categories),this._task.outSpatialReference=aa,this.get("map")&&
this.get("activeGeocoder").localSearchOptions&&this.get("activeGeocoder").localSearchOptions.hasOwnProperty("distance")&&this.get("activeGeocoder").localSearchOptions.hasOwnProperty("minScale")&&(aa=this.get("map").getScale(),!this.get("activeGeocoder").localSearchOptions.minScale||aa&&aa<=parseFloat(this.get("activeGeocoder").localSearchOptions.minScale))&&(Z.location=this.get("map").extent.getCenter(),Z.distance=this.get("activeGeocoder").localSearchOptions.distance),this.get("activeGeocoder").suggest&&
B.autoComplete?(Z.text=I,Y&&(Z.searchExtent=Y),this._task.suggestLocations(Z).then(r.hitch(this,function(fa){this._receivedResults(fa,y,B)}),r.hitch(this,function(fa){this._receivedResults(fa,y,B)}))):(Z.address={},Z.maxLocations=X,Y&&(Z.searchExtent=Y),this.get("activeGeocoder").sourceCountry&&(Z.countryCode=this.get("activeGeocoder").sourceCountry),B.magicKey&&(Z.magicKey=B.magicKey),this.get("activeGeocoder").singleLineFieldName?Z.address[this.get("activeGeocoder").singleLineFieldName]=I:Z.address["Single Line Input"]=
I,P&&(Z.outFields=P),this._task.addressToLocations(Z,r.hitch(this,function(fa){this._receivedResults(fa,y,B)}),r.hitch(this,function(fa){this._receivedResults(fa,y,B)})))}else this._hideLoading(),y.reject("Geocoder:: no search to perform")},_showResults:function(){this._hideGeolocatorMenu();var y="";if(this.get("results")&&this.get("results").length&&this.resultsNode){var B=this.get("value"),I=new RegExp("("+B+")","gi");y+='\x3cul role\x3d"presentation"\x3e';for(B=0;B<this.get("results").length&&
5>B;++B){var P=this.get("results")[B].text||this.get("results")[B].name,X=this._css.resultsItemClass+" ";X=0===B%2?X+this._css.resultsItemOddClass:X+this._css.resultsItemEvenClass;0===B?X+=" "+this._css.resultsItemFirstClass:B===this.get("results").length-1&&(X+=" "+this._css.resultsItemLastClass);y+='\x3cli title\x3d"'+P+'" data-text\x3d"'+P+'" data-item\x3d"true" data-index\x3d"'+B+'" role\x3d"menuitem" tabindex\x3d"0" class\x3d"'+X+'"\x3e'+P.replace(I,'\x3cstrong class\x3d"'+this._css.resultsPartialMatchClass+
'"\x3e$1\x3c/strong\x3e')+"\x3c/li\x3e"}y+="\x3c/ul\x3e";this.resultsNode&&(this.resultsNode.innerHTML=y);this._autoCompleteEvent();this._showResultsMenu()}else this.resultsNode&&(this.resultsNode.innerHTML=y),this._hideResultsMenu()},_receivedResults:function(y,B){this._hideLoading();y=this._hydrateResults(y);this.set("results",y);y={results:y,value:this.get("value")};B.resolve(y)},_showLoading:function(){d.add(this.containerNode,this._css.loadingClass)},_hideLoading:function(){d.remove(this.containerNode,
this._css.loadingClass)},_showGeolocatorMenu:function(){d.add(this.containerNode,this._css.activeMenuClass);d.add(this.domNode,this._css.GeocoderMenuOpenClass);a.set(this.geocoderMenuNode,"display","block");k.set(this.geocoderMenuInsertNode,"aria-hidden","false");k.set(this.geocoderMenuArrowNode,"aria-expanded","true")},_hideGeolocatorMenu:function(){d.remove(this.containerNode,this._css.activeMenuClass);d.remove(this.domNode,this._css.GeocoderMenuOpenClass);a.set(this.geocoderMenuNode,"display",
"none");k.set(this.geocoderMenuInsertNode,"aria-hidden","true");k.set(this.geocoderMenuArrowNode,"aria-expanded","false")},_toggleGeolocatorMenu:function(){this._hideResultsMenu();"block"===a.get(this.geocoderMenuNode,"display")?this._hideGeolocatorMenu():this._showGeolocatorMenu()},_showResultsMenu:function(){d.add(this.containerNode,this._css.GeocoderActiveClass);d.add(this.domNode,this._css.GeocoderResultsOpenClass);a.set(this.resultsNode,"display","block");k.set(this.resultsNode,"aria-hidden",
"false")},_hideResultsMenu:function(){a.set(this.resultsNode,"display","none");d.remove(this.containerNode,this._css.GeocoderActiveClass);d.remove(this.domNode,this._css.GeocoderResultsOpenClass);k.set(this.resultsNode,"aria-hidden","true")},_hideMenus:function(){this._hideGeolocatorMenu();this._hideResultsMenu()},_insertGeocoderMenuItems:function(){if(this.get("geocoderMenu")&&this._geocoders&&1<this._geocoders.length){var y="",B;var I='\x3cul role\x3d"presentation"\x3e';for(B=0;B<this._geocoders.length;B++){y=
this._css.resultsItemClass+" ";y=0===B%2?y+this._css.resultsItemOddClass:y+this._css.resultsItemEvenClass;B===this.get("activeGeocoderIndex")&&(y+=" "+this._css.geocoderSelectedClass);0===B?y+=" "+this._css.resultsItemFirstClass:B===this._geocoders.length-1&&(y+=" "+this._css.resultsItemLastClass);var P=this._geocoders[B].name||c.widgets.Geocoder.main.untitledGeocoder;I+='\x3cli data-index\x3d"'+B+'" data-item\x3d"true" role\x3d"menuitem" tabindex\x3d"0" class\x3d"'+y+'"\x3e';I+='\x3cdiv class\x3d"'+
this._css.geocoderSelectedCheckClass+'"\x3e\x3c/div\x3e';I+=P;I+='\x3cdiv class\x3d"'+this._css.GeocoderClearClass+'"\x3e\x3c/div\x3e';I+="\x3c/li\x3e"}this.geocoderMenuInsertNode.innerHTML=I+"\x3c/ul\x3e";this._geocoderMenuEvent();a.set(this.geocoderMenuNode,"display","none");a.set(this.geocoderMenuArrowNode,"display","block");d.add(this.containerNode,this._css.GeocoderMultipleClass)}else this.geocoderMenuInsertNode.innerHTML="",a.set(this.geocoderMenuNode,"display","none"),a.set(this.geocoderMenuArrowNode,
"display","none"),d.remove(this.containerNode,this._css.GeocoderMultipleClass)},_checkStatus:function(){this.get("value")?(d.add(this.containerNode,this._css.hasValueClass),k.set(this.clearNode,"title",c.widgets.Geocoder.main.clearButtonTitle)):this.clear()},_autoCompleteEvent:function(){var y=h('[data-item\x3d"true"]',this.resultsNode);this._acEvent&&this._acEvent.remove();this._acEvent=g(y,"click, keydown",r.hitch(this,function(B){this._clearQueryTimeout();var I=parseInt(k.get(B.currentTarget,"data-index"),
10),P=k.get(B.currentTarget,"data-text");"click"===B.type||"keydown"===B.type&&B.keyCode===e.ENTER?(k.set(this.inputNode,"value",P),this.set("value",P),this.get("results")&&this.get("results")[I]&&(B=this.get("results")[I],B.name?this.select(B):this._query({delay:0,search:B.text,magicKey:B.magicKey||null}).then(r.hitch(this,function(X){this.select(X.results[0])})))):"keydown"!==B.type||B.keyCode!==e.BACKSPACE&&B.keyCode!==e.DELETE?"keydown"===B.type&&B.keyCode===e.UP_ARROW?(m.stop(B),B=I-1,0>B?this.inputNode.focus():
y[B].focus()):"keydown"===B.type&&B.keyCode===e.DOWN_ARROW?(m.stop(B),B=I+1,B>=y.length?this.inputNode.focus():y[B].focus()):B.keyCode===e.ESCAPE&&this._hideMenus():(m.stop(B),this.inputNode.focus(),B=this.inputNode.value.slice(0,-1),k.set(this.inputNode,"value",B),this.set("value",B))}))},_geocoderMenuEvent:function(){var y=h('[data-item\x3d"true"]',this.geocoderMenuInsertNode);this._gmEvent&&this._gmEvent.remove();this._gmEvent=g(y,"click, keydown",r.hitch(this,function(B){var I=parseInt(k.get(B.currentTarget,
"data-index"),10);"click"===B.type||"keydown"===B.type&&B.keyCode===e.ENTER?(this._setActiveGeocoderIndex(null,null,I),this._hideGeolocatorMenu()):"keydown"===B.type&&B.keyCode===e.UP_ARROW?(m.stop(B),B=I-1,0>B?this.geocoderMenuArrowNode.focus():y[B].focus()):"keydown"===B.type&&B.keyCode===e.DOWN_ARROW?(m.stop(B),B=I+1,B>=y.length?this.geocoderMenuArrowNode.focus():y[B].focus()):B.keyCode===e.ESCAPE&&this._hideGeolocatorMenu()}))},_removeEvents:function(){var y;if(this._events&&this._events.length)for(y=
0;y<this._events.length;y++)this._events[y].remove();this._acEvent&&this._acEvent.remove();this._gmEvent&&this._gmEvent.remove();this._events=[]},_setupEvents:function(){this._removeEvents();var y=g(document,"click",r.hitch(this,function(B){this._hideResultsMenu(B)}));this._events.push(y);y=g(this.inputNode,"keyup",r.hitch(this,function(B){this._inputKeyUp(B)}));this._events.push(y);y=g(this.inputNode,"keydown",r.hitch(this,function(B){this._inputKeyDown(B)}));this._events.push(y);y=g(this.geocoderMenuArrowNode,
"keydown",this._geocoderMenuButtonKeyDown());this._events.push(y);this.get("map")&&(y=g(this.get("map"),"mouse-down",r.hitch(this,function(){this.blur()})),this._events.push(y));this._geocoderMenuEvent();this._autoCompleteEvent()},_findThenSelect:function(){this.find().then(r.hitch(this,function(y){y.results&&y.results.length&&(this.select(y.results[0]),this.onEnterKeySelect())}))},_inputKeyUp:function(y){if(y){this._clearQueryTimeout();var B=this.inputNode.value;this._ignoreUpdateValue=!0;this.set("value",
B);this._ignoreUpdateValue=!1;var I=0;B&&(I=B.length);if(y.ctrlKey||y.metaKey||y.altKey||y.keyCode===e.copyKey||y.keyCode===e.ALT||y.keyCode===e.CTRL||y.keyCode===e.META||y.keyCode===e.SHIFT||y.keyCode===e.UP_ARROW||y.keyCode===e.DOWN_ARROW||y.keyCode===e.LEFT_ARROW||y.keyCode===e.RIGHT_ARROW)return y;y&&y.keyCode===e.ENTER?(this._cancelDeferreds(),this._findThenSelect()):y&&y.keyCode===e.ESCAPE?(this._cancelDeferreds(),this._hideMenus()):y&&y.keyCode===e.TAB?(this._cancelDeferreds(),this._hideMenus()):
this.get("autoComplete")&&I>=this.get("minCharacters")?this._autoComplete():this._hideMenus();this._checkStatus()}},_cancelDeferreds:function(){if(this._deferreds.length){for(var y=0;y<this._deferreds.length;y++)this._deferreds[y].cancel("Geocoder:: stop query");this._deferreds=[]}},_inputKeyDown:function(y){var B=h('[data-item\x3d"true"]',this.resultsNode);y&&y.keyCode===e.TAB?(this._cancelDeferreds(),this._hideMenus()):y&&y.keyCode===e.UP_ARROW?(m.stop(y),(y=B.length)&&B[y-1].focus()):y&&y.keyCode===
e.DOWN_ARROW&&(m.stop(y),B[0]&&B[0].focus())},_geocoderMenuButtonKeyDown:function(y){var B=h('[data-item\x3d"true"]',this.geocoderMenuInsertNode);y&&y.keyCode===e.UP_ARROW?(m.stop(y),this._showGeolocatorMenu(),(y=B.length)&&B[y-1].focus()):y&&y.keyCode===e.DOWN_ARROW&&(m.stop(y),this._showGeolocatorMenu(),B[0]&&B[0].focus())},_inputClick:function(){this._hideGeolocatorMenu()},_hydrateResult:function(y){var B={},I=this._defaultSR,P;this.get("map")&&(I=this.get("map").spatialReference);if(y.hasOwnProperty("text")&&
y.hasOwnProperty("magicKey"))return y;if(y.hasOwnProperty("feature"))B.feature=new E(y.feature),(P=B.feature.geometry)&&P.setSpatialReference(I);else if(y.hasOwnProperty("geometry")){var X=y.symbol||null;P=y.attributes||{};B.feature=new E(y.geometry,X,P,y.infoTemplate||null);(P=B.feature.geometry)&&P.setSpatialReference(I)}else y.hasOwnProperty("location")?(X=new L(y.location.x,y.location.y,I),P={},y.hasOwnProperty("attributes")&&(P=y.attributes),y.hasOwnProperty("score")&&(P.score=y.score),B.feature=
new E(X,null,P,null)):B.feature=null;if(y.hasOwnProperty("extent"))B.extent=new C(y.extent),B.extent.setSpatialReference(new z(I));else if(B.feature&&B.feature.geometry)switch(B.feature.geometry.type){case "extent":B.extent=B.feature.geometry;break;case "multipoint":B.extent=B.feature.geometry.getExtent();break;case "polygon":B.extent=B.feature.geometry.getExtent();break;case "polyline":B.extent=B.feature.geometry.getExtent();break;case "point":this.get("map")?this.get("map").getScale()>this.get("zoomScale")?
B.extent=T.getExtentForScale(this.get("map"),this.get("zoomScale")).centerAt(B.feature.geometry):B.extent=this.get("map").extent.centerAt(B.feature.geometry):B.extent=new C({xmin:B.feature.geometry.x-.25,ymin:B.feature.geometry.y-.25,xmax:B.feature.geometry.x+.25,ymax:B.feature.geometry.y+.25,spatialReference:{wkid:4326}})}else B.extent=null;y.hasOwnProperty("name")?B.name=y.name:"query"===this.activeGeocoder.type&&this.activeGeocoder.field&&y.hasOwnProperty("attributes")&&y.attributes.hasOwnProperty(this.activeGeocoder.field)?
B.name=y.attributes[this.activeGeocoder.field]:y.hasOwnProperty("Match_addr")&&"string"===typeof y.Match_addr?B.name=y.Match_addr:y.hasOwnProperty("address")&&"object"===typeof y.address&&y.address.hasOwnProperty("Match_addr")?B.name=y.address.Match_addr:y.hasOwnProperty("address")&&"string"===typeof y.address?B.name=y.address:y.hasOwnProperty("address")&&"object"===typeof y.address&&y.address.hasOwnProperty("Address")?B.name=y.address.Address:B.name=B.feature&&B.feature.geometry?B.feature.geometry.x+
","+B.feature.geometry.y:"";return B},_hydrateResults:function(y){var B=[],I=0;if(y&&y.length)for(I;I<y.length;I++){var P=this._hydrateResult(y[I]);B.push(P)}return B}});l("extend-esri")&&r.setObject("dijit.Geocoder",u,H);return u})},"esri/dijit/InfoView":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry ../kernel ./_TouchBase".split(" "),function(G,u,r,n,m,k,
d,a,b,e,g,h,c){G=G(null,{declaredClass:"esri.dijit.InfoView",_items:[],_top:null,_sections:[],_isDecelerate:!1,constructor:function(f,l){this.container=a.byId(l);this._touchBase=c(this.container,null);this._slideDiv=e.create("div",null,this.container,"first");this.events=[];this._items=f.items;f.sections&&(this._sections=f.sections);b.add(this.container,"esriMobileInfoView");if(0===this._sections.length)e.create("div",{},this._slideDiv);else for(f=0;f<this._sections.length;f++)l=e.create("div",{"class":"esriMobileInfoViewSection"},
this._slideDiv),e.create("div",{innerHTML:this._sections[f].title},l);for(f=0;f<this._items.length;f++){l=0;this._items[f].section&&(l=this._items[f].section);switch(this._items[f].type){case "div":var q=e.create("div",{"class":"esriMobileInfoViewItem",style:this._items[f].style},this._slideDiv.childNodes[l]);q=e.create("div",{innerHTML:this._items[f].text},q)}this._items[f].className&&b.add(q,this._items[f].className);q._index=f;q._item=this._items[f];this._items[f]._node=q}this.startTouchY=0},startup:function(){this.onCreate(this._items);
this._animateTo(0)},destroy:function(){r.forEach(this.events,n.disconnect);this._touchBase=null;m.query("img",this.container).forEach(function(f){f._index=null;f._item=null;e.destroy(f);f=null});this._items=null;e.destroy(this._slideDiv);e.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},setPreventDefault:function(f){this._touchBase.setPreventDefault(f)},enableTouchScroll:function(){this._touchBase.setPreventDefault(!0);this.events.push(n.connect(this._touchBase,
"onTouchStart",this,this._onTouchStartHandler));this.events.push(n.connect(this._touchBase,"onTouchMove",this,this._onTouchMoveHandler));this.events.push(n.connect(this._touchBase,"onTouchEnd",this,this._onTouchEndHandler));this._slideDiv.style.webkitTransform="translate3d(0,"+this._top+"px, 0)"},disableTouchScroll:function(){n.disconnect(this.events.pop());n.disconnect(this.events.pop());n.disconnect(this.events.pop());this._touchBase.setPreventDefault(!1);this._slideDiv.style.webkitTransform="translate3d(0, 0px, 0)"},
animateTo:function(){this._slideDiv.style.WebkitTransitionDuration="0s";this._animateTo(0)},onSelect:function(f){},onUnSelect:function(f){},onCreate:function(f){},onClick:function(f){},onSwipeLeft:function(){},onSwipeRight:function(){},_onTouchStartHandler:function(f){this._slideDiv.style.WebkitTransitionDuration="0s";this._moveDirection=null;this._startTime=new Date;this.startTouchY=f.touches[0].clientY;this.contentStartOffsetY=this.contentOffsetY},_onTouchMoveHandler:function(f){this._moveDirection||
(this._moveDirection=Math.abs(f.curY)>Math.abs(f.curX)?"vertical":"horizontal");"horizontal"!==this._moveDirection&&"vertical"===this._moveDirection&&this._animateTo(f.touches[0].clientY-this.startTouchY+this.contentStartOffsetY)},_onTouchEndHandler:function(f){this._endTime=new Date;this._deltaMovement=f.curY;if("vertical"===this._moveDirection)this._shouldStartMomentum()?this._doMomentum():this._snapToBounds();else if("horizontal"===this._moveDirection)if("left"===f.swipeDirection)this.onSwipeLeft();
else if("right"===f.swipeDirection)this.onSwipeRight()},_shouldStartMomentum:function(){this._diff=this._endTime-this._startTime;this._velocity=this._deltaMovement/this._diff;return.2<Math.abs(this._velocity)&&200>this._diff?!0:!1},_doMomentum:function(){var f=g.getContentBox(this.container);var l=0>this._velocity?.001:-.001;var q=-(this._velocity*this._velocity)/(2*l);var t=-this._velocity/l;l=3*.6;var v=1-l,w=0,x=0;if(f.h>this._slideDiv.scrollHeight)this.contentOffsetY=0,x=300;else if(0<this.contentOffsetY+
q){f=0;for(q=Math.floor(t/20);f<q;f++)if(w=(20*v*f^3)+(20*l*f^2)+0*f,w=0>this._velocity?-w:w,0<this.contentOffsetY+w){x=20*f;break}0===x&&(x=300);this.contentOffsetY=0}else if(Math.abs(this.contentOffsetY+q)+f.h>this._slideDiv.scrollHeight)for(this.contentOffsetY=f.h-this._slideDiv.scrollHeight,f=0,q=Math.floor(t/20);f<q;f++){if(w=(20*v*f^3)+(20*l*f^2)+0*f,w=0>this._velocity?-w:w,Math.abs(this.contentOffsetY+w)>this._slideDiv.scrollHeight){x=20*f;break}}else x=t,this.contentOffsetY+=q;this._slideDiv.style.webkitTransition=
"-webkit-transform "+x+"ms cubic-bezier(0, 0.3, 0.6, 1)";this._animateTo(this.contentOffsetY)},_snapToBounds:function(){var f=g.getContentBox(this.container);f.h>this._slideDiv.scrollHeight?this.contentOffsetY=0:0<this.contentOffsetY?this.contentOffsetY=0:Math.abs(this.contentOffsetY)+f.h>this._slideDiv.scrollHeight&&(this.contentOffsetY=f.h-this._slideDiv.scrollHeight);this._slideDiv.style.WebkitTransitionDuration="0.5s";this._animateTo(this.contentOffsetY)},_animateTo:function(f){this.contentOffsetY=
f;this._slideDiv.style.webkitTransform="translate3d(0, "+f+"px, 0)"},_stopMomentum:function(){if(this._isDecelerating()){var f=document.defaultView.getComputedStyle(this._slideDiv,null);f=new WebKitCSSMatrix(f.webkitTransform);this._slideDiv.style.webkitTransition="";this.animateTo(f.m42)}},_isDecelerating:function(){return this.isDecelerate?!0:!1},_toggleNode:function(f,l){"ON"===l.toggleState?(l.toggleState="OFF",l.src&&(f.src=l.src.toString()),this.onUnSelect(l)):(l.toggleState="ON",l.srcAlt&&
(f.src=l.srcAlt),this.onSelect(l))}});k("extend-esri")&&u.setObject("dijit.InfoView",G,h);return G})},"esri/dijit/InfoWindow":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated dijit/_Container ../kernel ../domUtils ../InfoWindowBase ./_EventedWidget dojo/text!./templates/InfoWindow.html".split(" "),function(G,u,r,n,m,k,d,a,b,e,g,h,
c,f,l,q,t,v,w){var x=G([v,h,c,f,t],{declaredClass:"esri.dijit.InfoWindow",isContainer:!0,templateString:w,anchor:"upperright",fixedAnchor:null,coords:null,isShowing:!0,isContentShowing:!0,isTitleBarShowing:!0,width:250,height:150,title:"Info Window",setMap:function(H){this.inherited(arguments);e.place(this.domNode,H.root)},startup:function(){if(!this._started){this.inherited(arguments);this._ANCHORS=[x.ANCHOR_UPPERRIGHT,x.ANCHOR_LOWERRIGHT,x.ANCHOR_LOWERLEFT,x.ANCHOR_UPPERLEFT];if(7>k("ie")){var H=
"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+g.getComputedStyle(this._sprite).backgroundImage.replace(/url\("/i,"").replace(/"\)/,"")+"')",A=e.create("div",null,n.body());g.set(A,{width:"1px",height:"1px",display:"none",backgroundImage:"none",filter:H});var z=setTimeout(function(){e.destroy(A);clearTimeout(z);z=A=null},100);m.query(".sprite",this.domNode).forEach(function(E){E.style.backgroundImage="none";E.style.filter=H})}this.resize(this.width,
this.height);this.hide()}},destroy:function(){this._destroyed||(this.__unregisterMapListeners(),this.destroyDijits(this._title),this.destroyDijits(this._content),this._title.innerHTML=this._content.innerHTML="",this.inherited(arguments))},resize:function(H,A){if(H&&A){var z=g.set;z(this._topleft,{height:A+"px",marginLeft:H+"px"});z(this._topright,{width:H+"px",height:A+"px"});z(this._user,"width",H-8+"px");z(this._hide,"marginLeft",H-22+"px");z(this._title,"width",H-25+"px");z(this._content,"height",
A-37+"px");z(this._bottomleft,{marginLeft:H+"px",marginTop:A+"px"});z(this._bottomright,{width:H-5+"px",marginTop:A+"px"});this.width=H;this.height=A;this.coords&&this._adjustPosition(this.coords,this.anchor);this.onResize(H,A)}},_adjustPosition:function(H,A){var z=g.set;z(this._infowindow,{left:Math.round(H.x)+"px",top:Math.round(H.y)+"px"});A===x.ANCHOR_UPPERLEFT?z(this._window,{left:null,right:this.width+18+"px",top:null,bottom:this.height+50+"px"}):A===x.ANCHOR_UPPERRIGHT?z(this._window,{left:"6px",
right:null,top:null,bottom:this.height+50+"px"}):A===x.ANCHOR_LOWERRIGHT?z(this._window,{left:"6px",right:null,top:"43px",bottom:null}):A===x.ANCHOR_LOWERLEFT&&z(this._window,{left:null,right:this.width+18+"px",top:"43px",bottom:null})},_getAnchor:function(H){var A=this.map;return A&&H?(H.y<A.height/2?"lower":"upper")+(H.x<A.width/2?"right":"left"):"upperright"},show:function(H,A,z){if(H){H.spatialReference?(this.mapCoords=H,H=this.coords=this.map.toScreen(H,!0)):(this.mapCoords=null,this.coords=
H);var E=this.map._getFrameWidth();if(-1!==E&&(H.x%=E,0>H.x&&(H.x+=E),this.map.width>E))for(var J=(this.map.width-E)/2;H.x<J;)H.x+=E;A&&-1!==r.indexOf(this._ANCHORS,A)||(A=this._getAnchor(H));b.remove(this._pointer,this.anchor);A=this.anchor=this.fixedAnchor||A;this._adjustPosition(H,A);b.add(this._pointer,A);q.show(this.domNode);this.isShowing=!0;if(!z)this.onShow()}},hide:function(H,A){q.hide(this.domNode);this.isShowing=!1;if(!A)this.onHide()},showTitleBar:function(){q.show(this._titlebar);q.show(this._border);
this.isTitleBarShowing=!0},hideTitleBar:function(){q.hide(this._titlebar);q.hide(this._border);this.isTitleBarShowing=!1},showContent:function(){q.show(this._content);q.show(this._border);this.isContentShowing=!0},hideContent:function(){q.hide(this._content);q.hide(this._border);this.isContentShowing=!1},move:function(H,A){A?H=this.coords.offset(H.x,H.y):(this.coords=H,this.mapCoords&&(this.mapCoords=this.map.toMap(H)));g.set(this._infowindow,{left:Math.round(H.x)+"px",top:Math.round(H.y)+"px"})},
setFixedAnchor:function(H){H&&-1===r.indexOf(this._ANCHORS,H)||(this.fixedAnchor=H,this.isShowing&&this.show(this.mapCoords||this.coords,H),this.onAnchorChange(H))},setTitle:function(H){this.destroyDijits(this._title);this.__setValue("_title",H);return this},setContent:function(H){this.destroyDijits(this._content);this.__setValue("_content",H);return this},onShow:function(){this.__registerMapListeners();this.startupDijits(this._title);this.startupDijits(this._content)},onHide:function(){this.__unregisterMapListeners()},
onResize:function(){},onAnchorChange:function(){}});u.mixin(x,{ANCHOR_UPPERRIGHT:"upperright",ANCHOR_LOWERRIGHT:"lowerright",ANCHOR_LOWERLEFT:"lowerleft",ANCHOR_UPPERLEFT:"upperleft"});k("extend-esri")&&u.setObject("dijit.InfoWindow",x,l);return x})},"esri/dijit/InfoWindowLite":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/html dojo/has dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dijit/registry ../kernel ../domUtils ../InfoWindowBase".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l){var q=G([l],{declaredClass:"esri.dijit.InfoWindowLite",constructor:function(t,v){u.mixin(this,t);t=this.domNode=d.byId(v);t.id=this.id||h.getUniqueId(this.declaredClass);a.add(t,"simpleInfoWindow");this._title=b.create("div",{"class":"title"},t);this._content=b.create("div",{"class":"content"},t);this._close=b.create("div",{"class":"close"},t)},domNode:null,anchor:"upperright",fixedAnchor:null,coords:null,isShowing:!0,width:250,height:150,title:"Info Window",
_bufferWidth:10,_bufferHeight:10,startup:function(){this._anchors=[q.ANCHOR_UPPERRIGHT,q.ANCHOR_LOWERRIGHT,q.ANCHOR_LOWERLEFT,q.ANCHOR_UPPERLEFT];this.resize(this.width,this.height);this.hide();this._closeConnect=r.connect(this._close,"onclick",this,this.hide)},destroy:function(){this.isShowing&&this.hide();this.destroyDijits(this._title);this.destroyDijits(this._content);r.disconnect(this._closeConnect);b.destroy(this.domNode);this.domNode=this._title=this._content=this._anchors=this._closeConnect=
null},setTitle:function(t){t?a.remove(this._title,"empty"):a.add(this._title,"empty");this.destroyDijits(this._title);this.__setValue("_title",t);return this},setContent:function(t){t?a.remove(this._title,"empty"):a.add(this._title,"empty");this.destroyDijits(this._content);this.__setValue("_content",t);return this},setFixedAnchor:function(t){t&&-1===n.indexOf(this._anchors,t)||(this.fixedAnchor=t,this.isShowing&&this.show(this.mapCoords||this.coords,t),this.onAnchorChange(t))},show:function(t,v,
w){if(t&&(t.spatialReference?(this.mapCoords=t,t=this.coords=this.map.toScreen(t,!0)):(this.mapCoords=null,this.coords=t),v&&-1!==n.indexOf(this._anchors,v)||(v=this._getAnchor(t)),v=this.anchor=this.fixedAnchor||v,f.show(this.domNode),this._adjustContentArea(),this._adjustPosition(t,v),this.isShowing=!0,!w))this.onShow()},hide:function(t,v){f.hide(this.domNode);this.isShowing=!1;if(!v)this.onHide()},move:function(t,v){v?t=this.coords.offset(t.x,t.y):(this.coords=t,this.mapCoords&&(this.mapCoords=
this.map.toMap(t)));this._adjustPosition(t,this.anchor)},resize:function(t,v){this.width=t;this.height=v;g.set(this.domNode,{width:t+"px",height:v+"px"});g.set(this._close,{left:t-2+"px",top:"-12px"});this._adjustContentArea();this.coords&&this._adjustPosition(this.coords,this.anchor);this.onResize(t,v)},onShow:function(){this.__registerMapListeners();this.startupDijits(this._title);this.startupDijits(this._content)},onHide:function(){this.__unregisterMapListeners()},onResize:function(){},onAnchorChange:function(){},
setMap:function(t){this.inherited(arguments);b.place(this.domNode,t.root)},_adjustContentArea:function(){var t=e.getContentBox(this.domNode),v=m.coords(this._title),w=m.coords(this._content),x=e.getContentBox(this._content);g.set(this._content,{height:t.h-v.h-(w.h-x.h)+"px"})},_getAnchor:function(t){var v=this.map;return v&&t?(t.y<v.height/2?"lower":"upper")+(t.x<v.width/2?"right":"left"):"upperright"},_adjustPosition:function(t,v){var w=Math.round(t.x);t=Math.round(t.y);var x=this._bufferWidth,H=
this._bufferHeight,A=m.coords(this.domNode);switch(v){case q.ANCHOR_UPPERLEFT:w-=A.w+x;t-=A.h+H;break;case q.ANCHOR_UPPERRIGHT:w+=x;t-=A.h+H;break;case q.ANCHOR_LOWERRIGHT:w+=x;t+=H;break;case q.ANCHOR_LOWERLEFT:w-=A.w+x,t+=H}g.set(this.domNode,{left:w+"px",top:t+"px"})}});u.mixin(q,{ANCHOR_UPPERRIGHT:"upperright",ANCHOR_LOWERRIGHT:"lowerright",ANCHOR_LOWERLEFT:"lowerleft",ANCHOR_UPPERLEFT:"upperleft"});k("extend-esri")&&u.setObject("dijit.InfoWindowLite",q,c);return q})},"esri/dijit/Legend":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/debounce dojo/has dojo/sniff dojo/Deferred dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dojo/dom-class dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/utils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/utils ../symbols/jsonUtils ../renderers/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z,E,J,D,L,C,N,S,F,T,y,B,I,P,X,Y,aa,Z,fa,K,R,U){var ba=L.getClassValuesForRelationship(),Q={defaultShape:{type:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15"},stroke:{width:1,color:"#555555"}},ea={HH:315,HL:45,LL:135,LH:225},la=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,ma=u([R,v],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,transparencyRampColor:new d([64,
64,64]),defaultText:"Aa",sizeRampLightColor:new d([255,255,255]),sizeRampDarkColor:new d([128,128,128]),gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",gt:"\x3e"},_ieTimer:100,_isRightToLeft:!1,_align:null,_legendAlign:null,_preserveCacheOnDestroy:!1,_layerConnects:null,_mapConnects:null,constructor:function(M,W){r.mixin(this,U.widgets.legend);this._i18n=U.widgets.legend;M=M||{};M.map?W?(this.map=M.map,this.layerInfos=M.layerInfos,this._respectCurrentMapScale=!1===M.respectCurrentMapScale?
!1:!0,this._respectVisibility=!1===M.respectVisibility?!1:!0,this._preserveCacheOnDestroy=M.preserveCacheOnDestroy?!0:!1,this.arrangement=M.arrangement===ma.ALIGN_RIGHT?ma.ALIGN_RIGHT:ma.ALIGN_LEFT,this.arrangement===ma.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===M.autoUpdate?!1:!0,this._surfaceItems=[],this.hideLayersInLegend={},this.refresh=a(this.refresh,0)):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},
postMixInProperties:function(){this.inherited(arguments);var M=["ar","he"],W;for(W=0;W<M.length;W+=1){var da=M[W];G.locale&&-1!==G.locale.indexOf(da)&&(-1!==G.locale.indexOf("-")?-1!==G.locale.indexOf(da+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0)}this._isRightToLeft?(this._align=this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},
startup:function(){this.inherited(arguments);this._surfaceItems=[];this._initialize();9>b("ie")&&(this._repaintItems=r.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();this._removeCachedLegendResponses();this._removeHoverHandlers();this.inherited(arguments)},_removeCachedLegendResponses:function(){this._preserveCacheOnDestroy||n.forEach(this.layers,function(M){delete M.legendResponse})},refresh:function(M){if(this.domNode){M?(this.layerInfos=
M,this.layers=[],n.forEach(this.layerInfos,function(W){this._isSupportedLayerType(W.layer)&&(W.title&&(W.layer._titleForLegend=W.title),W.layer._hideDefaultSymbol=!1===W.defaultSymbol?!0:!1,W.hideLayers?(this.hideLayersInLegend[W.layer.id]=W.hideLayers,this._addSubLayersToHide(W)):this.hideLayersInLegend[W.layer.id]=[],W.hoverLabel&&(W.layer._hoverLabel=W.hoverLabel),W.hoverLabels&&(W.layer._hoverLabels=W.hoverLabels),this.layers.push(W.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=
null);for(M=this.domNode.children.length-1;0<=M;M--)l.destroy(this.domNode.children[M]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&(this.layers=[],n.forEach(this.layerInfos,function(da){this._isSupportedLayerType(da.layer)&&(da.title&&(da.layer._titleForLegend=da.title),da.layer._hideDefaultSymbol=!1===da.defaultSymbol?!0:!1,da.hideLayers?(this.hideLayersInLegend[da.layer.id]=da.hideLayers,this._addSubLayersToHide(da)):
this.hideLayersInLegend[da.layer.id]=[],da.hoverLabel&&(da.layer._hoverLabel=da.hoverLabel),da.hoverLabels&&(da.layer._hoverLabels=da.hoverLabels),this.layers.push(da.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=!0;this.layers=[];var M=[],W=[];n.forEach(this.map.layerIds,function(da){da=this.map.getLayer(da);this._isSupportedLayerType(da)&&(da.arcgisProps&&da.arcgisProps.title&&(da._titleForLegend=da.arcgisProps.title),this.layers.push(da));if("esri.layers.KMLLayer"===
da.declaredClass){var ja=da.getLayers();n.forEach(ja,function(ia){M.push(ia.id)},this)}"esri.layers.GeoRSSLayer"===da.declaredClass&&(ja=da.getFeatureLayers(),n.forEach(ja,function(ia){W.push(ia.id)},this))},this);n.forEach(this.map.graphicsLayerIds,function(da){var ja=this.map.getLayer(da);-1===n.indexOf(M,da)&&-1===n.indexOf(W,da)&&this._isSupportedLayerType(ja)&&this._isLayerDrawingEnabled(ja)&&(ja.arcgisProps&&ja.arcgisProps.title&&(ja._titleForLegend=ja.arcgisProps.title),this.layers.push(ja))},
this)}this._createLegend()},_isLayerDrawingEnabled:function(M){return M&&(M._params&&M._params.drawMode||M.isFeatureReductionActive&&M.isFeatureReductionActive())},_activate:function(){this._deactivate();if(this.autoUpdate){this._mapConnects=[];this._layerConnects={};var M=this._mapConnects;this._respectCurrentMapScale&&M.push(m.connect(this.map,"onZoomEnd",this,"_refreshLayers"));this.useAllMapLayers&&(M.push(m.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers")),M.push(m.connect(this.map,
"onLayerRemove",this,"_updateAllMapLayers")),M.push(m.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")));n.forEach(this.layers,function(W){var da=[m.connect(W,"onFeatureReductionRendererChange",this,"_refreshLayers"),m.connect(W,"onFeatureReductionChange",this,"_refreshLayers"),m.connect(W,"onVisibilityChange",this,"_refreshLayers"),m.connect(W,"onOpacityChange",this,"_refreshLayers"),m.connect(W,"onScaleRangeChange",this,"_refreshLayers")];"esri.layers.ArcGISDynamicMapServiceLayer"===
W.declaredClass&&W.supportsDynamicLayers&&da.push(m.connect(W,"_onDynamicLayersChange",r.hitch(this,"_updateDynamicLayers",W)));if("esri.layers.ArcGISImageServiceLayer"===W.declaredClass||"esri.layers.RasterXLayer"===W.declaredClass)da.push(m.connect(W,"onRenderingChange",r.partial(this._updateImageServiceLayers,this,W))),da.push(m.connect(W,"onRendererChange",r.partial(this._updateImageServiceLayers,this,W)));("esri.layers.ArcGISImageServiceVectorLayer"===W.declaredClass||W.setWebGLEnabled)&&da.push(m.connect(W,
"onRendererChange",r.hitch(this,"_refreshLayers")));this._layerConnects[W.id]=da},this)}},_deactivate:function(){n.forEach(this._mapConnects,function(M){m.disconnect(M)});n.forEach(this.layers,function(M){var W=this._layerConnects;W&&n.forEach(W[M.id],function(da){m.disconnect(da)})},this);this._mapConnects=this._layerConnects=null},_updateDynamicLayers:function(M){delete M.legendResponse;this._refreshLayers()},_updateImageServiceLayers:function(M,W){delete W.legendResponse;M._refreshLayers()},_refreshLayers:function(){this.refresh()},
_updateAllMapLayers:function(){this.layers=[];n.forEach(this.map.layerIds,function(M){M=this.map.getLayer(M);this._isSupportedLayerType(M)&&this.layers.push(M)},this);n.forEach(this.map.graphicsLayerIds,function(M){M=this.map.getLayer(M);this._isSupportedLayerType(M)&&this._isLayerDrawingEnabled(M)&&this.layers.push(M)},this);this.refresh()},_createLegend:function(){var M=!1,W=!1;q.set(this.domNode,"position","relative");l.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+
"..."},this.domNode);var da=[];n.forEach(this.layers,function(ia){if("esri.layers.KMLLayer"===ia.declaredClass||"esri.layers.GeoRSSLayer"===ia.declaredClass)if(ia.loaded){if("esri.layers.KMLLayer"===ia.declaredClass)var pa=ia.getLayers();else"esri.layers.GeoRSSLayer"===ia.declaredClass&&(pa=ia.getFeatureLayers(),this.hideLayersInLegend[ia.id]&&(pa=n.filter(pa,function(ra){return-1===n.indexOf(this.hideLayersInLegend[ia.id],ra.id)},this)));n.forEach(pa,function(ra){"esri.layers.FeatureLayer"===ra.declaredClass&&
ia._titleForLegend&&(ra._titleForLegend=ia._titleForLegend+" - ","esriGeometryPoint"===ra.geometryType?ra._titleForLegend+=this.NLS_points:"esriGeometryPolyline"===ra.geometryType?ra._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"===ra.geometryType&&(ra._titleForLegend+=this.NLS_areas),da.push(ra))},this)}else m.connect(ia,"onLoad",r.hitch(this,function(){this.refresh(this.layerInfos)}));else if("esri.layers.WMSLayer"===ia.declaredClass)if(!ia.loaded)m.connect(ia,"onLoad",r.hitch(this,function(){this.refresh(this.layerInfos)}));
else{if((!this._respectVisibility||this._respectVisibility&&ia.visible)&&0<ia.layerInfos.length&&n.some(ia.layerInfos,function(ra){return ra.legendURL})){var oa=!1;n.forEach(ia.layerInfos,function(ra){if(ra.legendURL&&-1<n.indexOf(ia.visibleLayers,ra.name)){oa||(l.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(ia._titleForLegend||ia.name||ia.id)+"\x3c/span\x3e"},this.domNode),oa=!0);var wa;ra=ra.legendURL;if(ia.customParameters||ia.customLayerParameters){var va=r.clone(ia.customParameters||
{});r.mixin(va,ia.customLayerParameters||{});for(wa in va)ra+=(-1===ra.indexOf("?")?"?":"\x26")+wa+"\x3d"+va[wa]}l.create("div",{innerHTML:"\x3cimg src\x3d'"+ra+"'/\x3e"},this.domNode);M=!0}},this)}}else"esri.layers.WFSLayer"!==ia.declaredClass||ia.renderer?da.push(ia):(pa=l.create("div",{id:this.id+"_"+ia.id,"class":"esriLegendService"}),l.create("span",{innerHTML:this._getServiceTitle(ia),"class":"esriLegendServiceLabel"},l.create("td",{align:this._align},l.create("tr",{},l.create("tbody",{},l.create("table",
{width:"95%"},pa))))),l.place(pa,this.id,"first"),pa=l.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},pa),pa=l.create("tbody",{},pa),"esriGeometryComplex"===ia.geometryType?(this._buildRow_Renderer(ia,ia._pointSymbol,null,this.NLS_points,null,pa),this._buildRow_Renderer(ia,ia._lineSymbol,null,this.NLS_lines,null,pa),this._buildRow_Renderer(ia,ia._polygonSymbol,null,this.NLS_areas,null,pa)):"esriGeometryPoint"===ia.geometryType?this._buildRow_Renderer(ia,ia._pointSymbol,
null,"",null,pa):"esriGeometryPolyline"===ia.geometryType?this._buildRow_Renderer(ia,ia._lineSymbol,null,"",null,pa):"esriGeometryPolygon"===ia.geometryType&&this._buildRow_Renderer(ia,ia._polygonSymbol,null,"",null,pa),W=!0)},this);var ja=[];n.forEach(da,function(ia){if(!ia.loaded)var pa=m.connect(ia,"onLoad",this,function(ra){m.disconnect(pa);pa=null;this.refresh()});else if((!this._respectVisibility||this._respectVisibility&&ia.visible)&&(ia.layerInfos||ia.renderer||"esri.layers.ArcGISImageServiceLayer"===
ia.declaredClass||"esri.layers.RasterXLayer"===ia.declaredClass)){var oa=l.create("div",{id:this.id+"_"+ia.id,style:{display:"none"},"class":"esriLegendService"});l.create("span",{innerHTML:this._getServiceTitle(ia),"class":"esriLegendServiceLabel"},l.create("td",{align:this._align},l.create("tr",{},l.create("tbody",{},l.create("table",{width:"95%"},oa)))));l.place(oa,this.id,"first");ia.legendResponse||ia.renderer&&"esri.renderer.StretchRenderer"!==ia.renderer.declaredClass||ia.renderer&&"esri.renderer.StretchRenderer"===
ia.renderer.declaredClass&&1===ia.bandCount?this._createLegendForLayer(ia):this.isHostedTileService(ia)?this._getLayerInfos(ia).then(r.hitch(this,function(ra){this._createLegendForLayer(ra)}),r.hitch(this,function(ra){ja.push(this._legendRequest(ra))})):"esri.layers.RasterXLayer"===ia.declaredClass&&-1<ia.capabilities.toLowerCase().indexOf("tilesonly")?this._createLegendForTileOnlyService(ia):ja.push(this._legendRequest(ia))}},this);0!==ja.length||M||W?(new h(ja)).addCallback(r.hitch(this,function(ia){M||
W?f.byId(this.id+"_msg").innerHTML="":f.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()})):(f.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate())},_createLegendForTileOnlyService:function(M){function W(va,ya){var ua=["red","green","blue"],Aa=[[255,0,0],[0,255,0],[0,0,255]];(ya&&ya.length>=pa?da(ya):da()).forEach(function(Ga,Ba){var Ea=new X(X.STYLE_SQUARE,20,new Y(Y.STYLE_SOLID,new d([0,0,0]),1),new d(Aa[Ba]));va._buildRow_Renderer(M,Ea,null,ua[Ba]+": "+Ga,null,ia)},
va)}function da(va){var ya=(M.bandIds&&M.bandIds.length?M.bandIds:[0,1,2]).map(function(ua){return va&&va[ua]&&va[ua].BandName||"Band_"+(ua+1)});3>ya.length?ya.push(ya[1]):3<ya.length&&ya.splice(3);return ya}var ja=l.create("div",{id:this.id+"_"+M.id+"_clientLegend","class":"esriLegendServiceLabel"},f.byId(this.id+"_"+M.id));l.create("td",{align:this._align},l.create("tr",{},l.create("tbody",{},l.create("table",{width:"95%","class":"esriLegendLayerLabel"},ja))));ja=l.create("table",{cellpadding:0,
cellspacing:0,width:"95%","class":"esriLegendLayer"},ja);var ia=l.create("tbody",{},ja),pa=M.bandCount;if(1<pa&&(!M.bandIds||0===M.bandIds.length||1<M.bandIds.length))M.getKeyProperties().then(r.hitch(this,function(va){W(this,va.BandProperties)}),r.hitch(this,function(va){W(this)}));else{ja={colorRamp:{type:"algorithmic",fromColor:[0,0,0],toColor:[255,255,255]}};var oa=M.renderer;if(oa&&oa.statistics&&oa.statistics.length){var ra=null!=oa.statistics[0].min?oa.statistics[0].min:oa.statistics[0][0];
var wa=null!=oa.statistics[0].max?oa.statistics[0].max:oa.statistics[0][1]}else ra=M.serviceInfo.minValues.length?M.serviceInfo.minValues[0]:0,wa=M.serviceInfo.maxValues.length?M.serviceInfo.maxValues[0]:255;this._createStretchLegend(ia,oa||ja,ra,wa)}q.set(f.byId(this.id+"_"+M.id),"display","block");q.set(f.byId(this.id+"_msg"),"display","none")},_createLegendForLayer:function(M){if(M.legendResponse||M.renderer||this.isHostedTileService(M)){var W=!1;if(M.legendResponse||this.isHostedTileService(M)){var da=
M.dynamicLayerInfos||M.layerInfos;if(da&&da.length)n.forEach(da,function(ja,ia){this.hideLayersInLegend[M.id]&&-1!==n.indexOf(this.hideLayersInLegend[M.id],ja.id)||(ja=this._buildLegendItems(M,ja,ia),W=W||ja)},this);else if("esri.layers.ArcGISImageServiceLayer"===M.declaredClass||"esri.layers.RasterXLayer"===M.declaredClass)W=this._buildLegendItems(M,{id:0,name:null,title:M.name,subLayerIds:null,parentLayerId:-1},0)}else M.renderer&&(da=M.url?M.url.substring(M.url.lastIndexOf("/")+1,M.url.length):
"fc_"+M.id,W=this._buildLegendItems(M,{id:da,name:null,subLayerIds:null,parentLayerId:-1},0));W&&(q.set(f.byId(this.id+"_"+M.id),"display","block"),q.set(f.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(M){if(M.loaded)return 10.01<=M.version?this._legendRequestServer(M):this._legendRequestTools(M);m.connect(M,"onLoad",r.hitch(this,"_legendRequest"))},_legendRequestServer:function(M){var W=M.url,da=W.indexOf("?");W=-1<da?W.substring(0,da)+"/legend"+W.substring(da):W+"/legend";(da=
M._getToken())&&(W+="?token\x3d"+da);var ja=r.hitch(this,"_processLegendResponse"),ia={f:"json"};M._params.dynamicLayers&&(ia.dynamicLayers=c.stringify(this._createDynamicLayers(M)),"[{}]"===ia.dynamicLayers&&(ia.dynamicLayers="[]"));M._params.bandIds&&(ia.bandIds=M._params.bandIds);M._params.renderingRule?ia.renderingRule=M._params.renderingRule:M.rasterFunctionInfos&&0<M.rasterFunctionInfos.length&&n.forEach(M.rasterFunctionInfos,function(pa){pa&&pa.name&&"none"===pa.name.toLowerCase()&&(ia.renderingRule=
c.stringify({rasterFunction:pa.name}))});(da=M._params.mosaicRule&&JSON.parse(M._params.mosaicRule))&&da.multidimensionalDefinition&&da.multidimensionalDefinition.length&&(ia.variable=da.multidimensionalDefinition[0].variableName);return E({url:W,content:ia,callbackParamName:"callback",load:function(pa,oa){ja(M,pa,oa)},error:z.defaults.io.errorHandler})},_legendRequestTools:function(M){var W=M.url.toLowerCase().indexOf("/rest/");W=M.url.substring(0,W)+M.url.substring(W+5,M.url.length);W=this._legendUrl+
"?soapUrl\x3d"+window.escape(W);if(!b("ie")||8<b("ie"))W+="\x26returnbytes\x3dtrue";var da=r.hitch(this,"_processLegendResponse");return E({url:W,content:{f:"json"},callbackParamName:"callback",load:function(ja,ia){da(M,ja,ia)},error:z.defaults.io.errorHandler})},_processLegendResponse:function(M,W){W&&W.layers?(M.legendResponse=W,f.byId(this.id+"_"+M.id)&&l.empty(f.byId(this.id+"_"+M.id)),l.create("span",{innerHTML:this._getServiceTitle(M),"class":"esriLegendServiceLabel"},l.create("td",{align:this._align},
l.create("tr",{},l.create("tbody",{},l.create("table",{width:"95%"},f.byId(this.id+"_"+M.id)))))),this._createLegendForLayer(M)):console.log("Legend could not get generated for "+M.url+": "+k.toJson(W))},_buildLegendItems:function(M,W,da){var ja=!1,ia=f.byId(this.id+"_"+M.id),pa=W.parentLayerId;if(W.subLayerIds)M=l.create("div",{id:this.id+"_"+M.id+"_"+W.id+"_group",style:{display:"none"},"class":-1==pa?0<da?"esriLegendGroupLayer":"":this._legendAlign},-1==pa?ia:f.byId(this.id+"_"+M.id+"_"+pa+"_group")),
l.create("td",{innerHTML:H.encode(W.name),align:this._align},l.create("tr",{},l.create("tbody",{},l.create("table",{width:"95%","class":"esriLegendLayerLabel"},M))));else{if(this._respectVisibility&&M.visibleLayers)if(da=M.dynamicLayerInfos||M.layerInfos)if(M._params&&M._params.layers){if(-1===n.indexOf(M.visibleLayers,W.id))return ja}else{if(da=this._getReallyVisibleLayers(da,M.visibleLayers),-1===n.indexOf(da,W.id))return ja}else if(-1===n.indexOf(M.visibleLayers,W.id))return ja;ia=l.create("div",
{id:this.id+"_"+M.id+"_"+W.id,style:{display:"none"},"class":-1<pa?this._legendAlign:""},-1==pa?ia:f.byId(this.id+"_"+M.id+"_"+pa+"_group"));l.create("td",{innerHTML:H.encode(W.name)||"",align:this._align},l.create("tr",{},l.create("tbody",{},l.create("table",{width:"95%","class":"esriLegendLayerLabel"},ia))));da=M.dynamicLayerInfos||M.layerInfos;pa=!1;da&&da.length&&(pa=n.some(da,function(oa){return!!oa.drawingInfo}));if(M.legendResponse)ja=ja||this._buildLegendItems_Tools(M,W,ia);else if(M.renderer||
pa)ja=ja||this._buildLegendItems_Renderer(M,W,ia)}return ja},_getReallyVisibleLayers:function(M,W){if(!M||!W||!W.length)return[];var da=[],ja=[],ia;for(ia=0;ia<M.length;ia++)if(M[ia].subLayerIds){if(-1===n.indexOf(W,M[ia].id)||-1<n.indexOf(ja,M[ia].id))ja=ja.concat(M[ia].subLayerIds)}else-1<n.indexOf(W,M[ia].id)&&-1===n.indexOf(ja,M[ia].id)&&da.push(M[ia].id);return da},_buildLegendItems_Tools:function(M,W,da){var ja=W.parentLayerId,ia=this.map.getScale(),pa=!1,oa=function(Ba,Ea){var Ra,Ta;for(Ra=
0;Ra<Ba.length;Ra++)if(Ea.dynamicLayerInfos)for(Ta=0;Ta<Ea.dynamicLayerInfos[Ta].length;Ta++){if(Ea.dynamicLayerInfos[Ta].mapLayerId==Ba[Ra].layerId)return Ba[Ra]}else if(Ea.id==Ba[Ra].layerId)return Ba[Ra];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(M,W,ia)){var ra=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===M.declaredClass||"esri.layers.ArcGISMapServiceLayer"===M.declaredClass)){var wa=this._getEffectiveScale(M,
W);if(wa.minScale&&wa.minScale<ia||wa.maxScale&&wa.maxScale>ia)ra=!1}if(ra){oa=oa(M.legendResponse.layers,W);var va=oa.legendType,ya=oa.legend;ia=oa.legendGroups;if(ya){"esri.layers.ArcGISImageServiceLayer"===M.declaredClass&&"esri.layers.RasterXLayer"===M.declaredClass||this._sanitizeLegendResponse(M,oa,W);da=l.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},da);var ua=l.create("tbody",{},da),Aa={};ia&&0<ia.length&&(da.setAttribute("cellspacing","10"),ia.forEach(function(Ba){if(Ba.heading){var Ea=
l.create("tr",{},ua);Ea=l.create("td",{},Ea);l.create("div",{innerHTML:H.encode(Ba.heading)},Ea)}Ea=l.create("tr",{},ua);Ea=l.create("td",{},Ea);Ea=l.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},Ea);Ea=l.create("tbody",{},Ea);Aa[Ba.id]=Ea}));(M._hoverLabel||M._hoverLabels)&&this._createHoverAction(da,M,W);var Ga=[];n.forEach(ya,function(Ba){if(!(10.1<=M.version&&!Ba.values&&1<ya.length)||!M._hideDefaultSymbol&&"\x3call other values\x3e"!==Ba.label){var Ea=Ba.label;
if(Ba.url&&0===Ba.url.indexOf("http")||Ba.imageData&&0<Ba.imageData.length)pa=!0,Ea&&-1!==n.indexOf(Ga,Ea)||(Ga.push(Ea),this._buildRow_Tools(Ba,Aa[Ba.groupId]||ua,M,W.id,va))}},this)}}}pa&&(q.set(f.byId(this.id+"_"+M.id+"_"+W.id),"display","block"),-1<ja&&(q.set(f.byId(this.id+"_"+M.id+"_"+ja+"_group"),"display","block"),this._findParentGroup(M.id,M,ja)));return pa},_getLayerInfos:function(M){var W=new g,da=M.dynamicLayerInfos||M.layerInfos;if(da&&da.length)if(n.some(da,function(pa){return!!pa.drawingInfo}))W.resolve(M);
else{var ja=M.url,ia=ja.indexOf("?");ja=-1===ia?ja+"/layers":ja.substring(0,ia)+"/layers"+ja.substring(ia,ja.length);E({url:ja,content:{f:"json"},callbackParamName:"callback",load:function(pa,oa){pa.layers?(n.forEach(da,function(ra){var wa=n.filter(pa.layers,function(va){return ra.source?va.id===ra.source.mapLayerId:va.id===ra.id});wa&&wa[0]&&wa[0].drawingInfo&&(ra.drawingInfo=wa[0].drawingInfo,ra.fields=wa[0].fields)}),W.resolve(M)):W.reject(M)},error:function(pa){W.reject(M)}})}return W},_sanitizeLegendResponse:function(M,
W,da){var ja=W.legend;if(10.1<=M.version&&1<ja.length&&!W._sanitized){M=r.getObject("layerDefinition.drawingInfo.renderer",!1,da);var ia,pa;M||(M=r.getObject("drawingInfo.renderer",!1,da));n.some(ja,function(oa){if(oa.values)return!0})&&n.some(ja,function(oa,ra){oa.values||(pa=ra,ia=oa);return!!ia});M?"uniqueValue"===M.type?ia&&(ja.splice(pa,1),ja.push(ia)):"classBreaks"===M.type&&(ia&&ja.splice(pa,1),ja.reverse(),ia&&ja.push(ia)):ia&&(ja.splice(pa,1),ja.push(ia));W._sanitized=!0}},_buildRow_Tools:function(M,
W,da,ja,ia){var pa=l.create("tr",{},W);if(this.alignRight){W=l.create("td",{align:this._isRightToLeft?"left":"right"},pa);var oa=l.create("td",{align:this._isRightToLeft?"left":"right",width:35},pa)}else oa=l.create("td",{width:35,align:"center"},pa),W=l.create("td",{},pa);pa=M.url;(!b("ie")||9<=b("ie")||9>b("ie")&&("esri.layers.ArcGISImageServiceLayer"===da.declaredClass||"esri.layers.RasterXLayer"===da.declaredClass))&&M.imageData&&0<M.imageData.length?pa="data:image/png;base64,"+M.imageData:0!==
M.url.indexOf("http")&&(pa=da.url+"/"+ja+"/images/"+M.url,(ja=da._getToken())&&(pa+="?token\x3d"+ja));ja=l.create("img",{src:pa,border:0,style:"opacity:"+da.opacity},oa);M=l.create("td",{innerHTML:H.encode(M.label),align:this._align},l.create("tr",{},l.create("tbody",{},l.create("table",{width:"95%",dir:"ltr"},W))));ia&&"Stretched"===ia&&10.3<=da.version&&("esri.layers.ArcGISImageServiceLayer"===da.declaredClass||"esri.layers.RasterXLayer"===da.declaredClass)&&(M.style.verticalAlign="top",M.style.lineHeight=
"1",ja.style.marginBottom="-1px",ja.style.display="block",W.style.verticalAlign="top");9>b("ie")&&(ja.style.filter="alpha(opacity\x3d"+100*da.opacity+")")},_getVariable:function(M,W,da){if(M)var ja=(M=M.getVisualVariablesForType(W,da))&&M[0];return ja},_getVariables:function(M,W,da){M=[this._getVariable(M,"colorInfo",!1),this._getVariable(M,"opacityInfo",!1),this._getVariable(M,"sizeInfo",!1)];return W?n.filter(M,function(ja){return!(!ja||ja.field!==W||ja.normalizationField!=da)}):M},_getFieldAlias:function(M,
W,da){var ja=W.infoTemplate||(W.infoTemplates&&da&&W.infoTemplates[da.id]?W.infoTemplates[da.id].infoTemplate:null);ja=ja&&ja.getFieldInfo&&ja.getFieldInfo(M);M=r.isFunction(M)?null:this.getField(W,M,da);W=ja||M;da="";W&&(da=ja&&ja.label||M&&M.alias||W.name||W.fieldName);return da},_getDomainName:function(M,W,da,ja){if(M&&!r.isFunction(M))var ia=(da=(M=this.getField(da,M,ja))&&da.getDomain?da.getDomain(M.name):null)&&da.codedValues?da.getName(W):null;return ia},_getRampTitle:function(M,W,da){var ja=
M.field,ia=M.normalizationField,pa=!1,oa=!1,ra=!1;ja=r.isFunction(ja)?null:ja;ia=r.isFunction(ia)?null:ia;if(M.legendOptions&&M.legendOptions.title)var wa=M.legendOptions.title;else if(M.valueExpressionTitle)wa=M.valueExpressionTitle;else{if(W.renderer&&W.renderer.authoringInfo&&W.renderer.authoringInfo.visualVariables){var va=W.renderer.authoringInfo.visualVariables;for(M=0;M<va.length;M++){var ya=va[M];if("colorInfo"===ya.type&&"ratio"===ya.style){pa=!0;break}else if("colorInfo"===ya.type&&"percent"===
ya.style){oa=!0;break}else if("colorInfo"===ya.type&&"percentTotal"===ya.style){ra=!0;break}}}(pa=ra&&"showRatioPercentTotal"||oa&&"showRatioPercent"||pa&&"showRatio"||ia&&"showNormField"||ja&&"showField"||null)&&(wa=J.substitute({field:ja&&this._getFieldAlias(ja,W,da),normField:ia&&this._getFieldAlias(ia,W,da)},"showField"===pa?"${field}":this._i18n[pa]))}return wa},_getRendererTitle:function(M,W,da){if(M){if("esri.renderer.ClassBreaksRenderer"===M.declaredClass){var ja=M.attributeField;var ia=M.normalizationField;
var pa="percent-of-total"===M.normalizationType}ja=r.isFunction(ja)?null:ja;ia=r.isFunction(ia)?null:ia;if(M.legendOptions&&M.legendOptions.title)var oa=M.legendOptions.title;else M.valueExpressionTitle?oa=M.valueExpressionTitle:(M=ia&&"showNormField"||(pa?"showNormPct":null)||ja&&"showField"||null)&&(oa=J.substitute({field:ja&&this._getFieldAlias(ja,W,da),normField:ia&&this._getFieldAlias(ia,W,da)},"showField"===M?"${field}":this._i18n[M]))}return oa},_buildLegendItems_Renderer:function(M,W,da){function ja(){q.set(f.byId(Da.id+
"_"+M.id+"_"+W.id),"display","block");-1<ia&&(q.set(f.byId(Da.id+"_"+M.id+"_"+ia+"_group"),"display","block"),this._findParentGroup(M.id,ia))}var ia=W.parentLayerId,pa=this.map,oa=pa.getScale(),ra=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(M,W,oa)){var wa,va,ya;var ua="esri.layers.ArcGISImageServiceVectorLayer"===M.declaredClass?M.renderer.renderer:W&&W.drawingInfo?K.fromJson(r.clone(W.drawingInfo.renderer)):M.isFeatureReductionActive&&M.isFeatureReductionActive()?M.getFeatureReductionRenderer():
M.renderer;if("esri.renderer.ScaleDependentRenderer"===ua.declaredClass&&(ua=(pa="zoom"===ua.rangeType?ua.getRendererInfoByZoom(pa.getZoom()):ua.getRendererInfoByScale(oa))&&pa.renderer,!ua))return!1;pa=ua&&ua.authoringInfo&&"relationship"===ua.authoringInfo.type;if("esri.renderer.StretchRenderer"!==ua.declaredClass&&"esri.renderer.ShadedReliefRenderer"!==ua.declaredClass){oa=this._getVariables(ua);var Aa=n.filter(oa,function(Fa){return!!Fa}).length,Ga=oa[0],Ba=oa[1],Ea=oa[2],Ra,Ta=!1;if(Ga){var Za=
this._getMedianColor(ua,Ga);Ga.field&&(wa=r.isFunction(Ga.field)?null:this.getField(M,Ga.field,W));var Ya=!(Ga.legendOptions&&!1===Ga.legendOptions.showLegend)}if(Ba){Ba.field&&(ya=r.isFunction(Ba.field)?null:this.getField(M,Ba.field,W));var cb=!(Ba.legendOptions&&!1===Ba.legendOptions.showLegend)}Ea&&(Ea.field&&(va=r.isFunction(Ea.field)?null:this.getField(M,Ea.field,W)),Ta=(Ra=!(Ea.legendOptions&&!1===Ea.legendOptions.showLegend))&&la.test(Ea.valueExpression))}if("esri.renderer.HeatmapRenderer"===
ua.declaredClass){var O=ra=!0;this._showHeatRamp(M,W,ua,da)}else if("esri.renderer.DotDensityRenderer"===ua.declaredClass)O=ra=!0,this._showDotDensityLegend(M,W,ua,da);else if("esri.renderer.TemporalRenderer"===ua.declaredClass){O=ra=!0;oa=l.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},da);var V=l.create("tbody",{},oa);(M._hoverLabel||M._hoverLabels)&&this._createHoverAction(oa,M,W);ua.latestObservationRenderer&&"esri.renderer.SimpleRenderer"===ua.latestObservationRenderer.declaredClass&&
this._buildRow_Renderer(M,ua.latestObservationRenderer.symbol,Za,H.encode(ua.latestObservationRenderer.label)||this.NLS_currentObservations,null,V);ua.observationRenderer&&"esri.renderer.SimpleRenderer"===ua.observationRenderer.declaredClass&&this._buildRow_Renderer(M,ua.observationRenderer.symbol,Za,H.encode(ua.observationRenderer.label)||this.NLS_previousObservations,null,V)}else if("esri.renderer.UniqueValueRenderer"===ua.declaredClass){if(ua.infos&&0<ua.infos.length){O=ra=!0;if(ua.legendOptions&&
ua.legendOptions.title||ua.valueExpressionTitle)oa=l.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},da),V=l.create("tbody",{},oa),Aa=ua.legendOptions&&ua.legendOptions.title?ua.legendOptions.title:ua.valueExpressionTitle,this._buildRow_Renderer(M,null,Za,H.encode(Aa),null,V);oa=l.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},da);V=l.create("tbody",{},oa);(M._hoverLabel||M._hoverLabels)&&this._createHoverAction(oa,M,W);ua.attributeField&&
Ea&&this._addSubHeader(V,this._getFieldAlias(ua.attributeField,M,W));if(pa){var ca=ua.authoringInfo;var ka=ca.focus;Aa=ca.numClasses;var ha=ca.field1.field;oa=ca.field2.field;if(Aa&&ha&&oa){var na=ca.field1.normalizationField;ca=ca.field2.normalizationField;var qa=na&&this._i18n.showNormField||ha&&"${field}",sa=ca&&this._i18n.showNormField||oa&&"${field}";ha=J.substitute({field:this._getFieldAlias(ha,M,W),normField:na&&this._getFieldAlias(na,M,W)},qa);oa=J.substitute({field:this._getFieldAlias(oa,
M,W),normField:ca&&this._getFieldAlias(ca,M,W)},sa);na={shapeDescriptor:Q,rotation:this._getRotationAngleForFocus(ka)||0};this._buildRow_Renderer(M,null,null,H.encode(ha),null,V,null,na);na.rotation+=90;this._buildRow_Renderer(M,null,null,H.encode(oa),null,V,null,na);this._drawRelationshipLegend(da,{numClasses:Aa,focus:ka,uvInfos:ua.infos})}}else{var ta=[];n.forEach(ua.infos,function(Fa){var Qa=null;this._isLayerEditable(M)&&M.types&&(Qa=this._getTemplateFromTypes(M.types,Fa.value));var Oa=Fa.label;
null==Oa&&(Oa=this._getDomainName(ua.attributeField,Fa.value,M,W)||Fa.value);-1===n.indexOf(ta,Oa)&&(ta.push(Oa),Fa=Fa.symbol,Fa=this._applyScaleDrivenSymbolSize(Fa,ua,Ea,Ta),this._buildRow_Renderer(M,Fa,Za,H.encode(Oa),Qa,V))},this)}}ka=!pa&&this._displayDefaultSymbol(M,ua,da,Ea,Ta)}else if("esri.renderer.ClassBreaksRenderer"===ua.declaredClass){if(ua.infos&&0<ua.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===M.declaredClass){O=ra=!0;var xa=this._isUnclassedRenderer(ua);if(!Ga&&1===
ua.infos.length)var za=(za=ua.infos[0])&&za.symbol;xa||(oa=l.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},da),V=l.create("tbody",{},oa),Aa=this._getRendererTitle(ua,M,W),this._buildRow_Renderer(M,null,Za,H.encode(Aa),null,V));oa=l.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},da);V=l.create("tbody",{},oa);(M._hoverLabel||M._hoverLabels)&&this._createHoverAction(oa,M,W);xa&&Ea&&Ra&&!Ta||(pa=ua.infos.slice(0).reverse(),n.forEach(pa,
function(Fa){var Qa=Fa.label;null!=Qa||xa||(Qa=Fa.minValue+" - "+Fa.maxValue);Fa=Fa.symbol;Fa=this._applyScaleDrivenSymbolSize(Fa,ua,Ea,Ta);this._buildRow_Renderer(M,Fa,Za,H.encode(Qa),null,V)},this));"esri.layers.ArcGISImageServiceVectorLayer"!==M.declaredClass||M.renderer.style!==B.STYLE_SCALAR&&M.renderer.style!==B.STYLE_SINGLE_ARROW||(this._buildRow_Renderer(M,ua.defaultSymbol,null,"",null,V),M._hideDefaultSymbol=!0)}xa||(ka=this._displayDefaultSymbol(M,ua,da,Ea,Ta))}else if("esri.renderer.StretchRenderer"===
ua.declaredClass){O=ra=!0;oa=l.create("table",{cellpadding:0,cellspacing:0,width:"95%",class:"esriLegendLayer"},da);V=l.create("tbody",{},oa);var Da=this,Ca,Ha,Ia=function(){ua.statistics.length?(Ca=ua.statistics[0][1],Ha=ua.statistics[0][0]):(Ha=Ma?Ma.minValues[0]:M.minValues[0],Ca=Ma?Ma.maxValues[0]:M.maxValues[0]);"esri.layers.RasterXLayer"===M.declaredClass&&M.hasStdTime()&&(Ha=M.getStdTimeValue(Ha),Ca=M.getStdTimeValue(Ca));Da._createStretchLegend(V,ua,Ha,Ca)};if(M.renderingRule)M.getRenderingRuleServiceInfo(M.renderingRule).then(function(Fa){var Qa=
Fa&&Fa.minValues&&0<Fa.minValues.length&&Fa.maxValues&&0<Fa.maxValues.length;Fa&&1<Fa.bandCount||!Qa?Da._legendRequest(M).then(function(Oa){Da._processLegendResponse(M,Oa)}):Ia()});else{var Ma=M.serviceInfo;if("esri.layers.RasterXLayer"===M.declaredClass&&(Ma=M.raster.serviceInfo,M.hasMultidimensions&&(!ua.statistics||!ua.statistics.length)))return da=M.mosaicRule&&M.mosaicRule.multidimensionalDefinition,M.getStatistics(da&&da.length?da[0].variableName:M._defaultMultidimensionalDefinition[0].variableName).then(r.hitch(this,
function(Fa){this._createStretchLegend(V,ua,Fa[0][0],Fa[0][1]);ja()})),ra;Ia()}}else"esri.renderer.ShadedReliefRenderer"===ua.declaredClass?(O=ra=!0,oa=l.create("table",{cellpadding:0,cellspacing:0,width:"95%",class:"esriLegendLayer"},da),V=l.create("tbody",{},oa),this._createStretchLegend(V,ua,0,255)):"esri.renderer.SimpleRenderer"===ua.declaredClass?(O=ra=!0,oa=l.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},da),V=l.create("tbody",{},oa),(M._hoverLabel||M._hoverLabels)&&
this._createHoverAction(oa,M,W),za=null,this._isLayerEditable(M)&&M.templates&&0<M.templates.length&&(za=M.templates[0]),pa=1<Aa?null:wa&&Ya||ya&&cb||va&&Ra,this._buildRow_Renderer(M,ua.symbol,Za,H.encode(pa?this._getRampTitle(1<Aa?null:Ga||Ba||Ea,M,W):ua.label),za,V),za=Ga?null:ua.symbol,pa&&(wa=ya=va=null)):"esri.renderer.ColormapRenderer"===ua.declaredClass&&(ua.colormapInfos&&ua.colormapInfos.length&&(O=ra=!0),oa=l.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},
da),V=l.create("tbody",{},oa),ua.colormapInfos.forEach(function(Fa){var Qa=new aa(aa.STYLE_SOLID,null,new d(Fa.color));this._buildRow_Renderer(M,Qa,null,Fa.label,null,V)},this),M._hideDefaultSymbol=!0);O&&(Ga&&Ya&&(Ga.field||Ga.valueExpression)&&this._showGradientRamp(M,W,ua,null,da,Ga,wa,null,Ea&&Ra?!0:!1),Ea&&Ra&&(Ea.field||Ea.valueExpression&&!Ta)&&(O=Ga&&Ya||"esri.renderer.UniqueValueRenderer"===ua.declaredClass?!1:!0,this._showSizeLegend(M,W,ua,Ea,Za,da,va,null,O)),Ba&&cb&&(Ba.field||Ba.valueExpression)&&
this._showGradientRamp(M,W,ua,za&&!za.url&&za.color?za.color:this.transparencyRampColor,da,Ba,ya,null,!1));ka||xa&&!Ya&&!Ra&&!cb||(ka=this._displayDefaultSymbol(M,ua,da,Ea,Ta));ra=ra||ka}Da=this;ra&&ja();return ra},_createStretchLegend:function(M,W,da,ja){var ia=l.create("tr",{},M);var pa=l.create("td",{rowspan:2,"class":"esriStretchLegend"},ia);W=l.toDom(this._addColorRamp(W.colorRamp));l.place(W,pa);l.create("td",{},ia).innerHTML=this._i18n.high+": "+("string"===typeof ja?ja:Math.round(ja*Math.pow(10,
3))/Math.pow(10,3));M=l.create("tr",{},M);l.create("td",{},M).innerHTML=this._i18n.low+": "+("string"===typeof da?da:Math.round(da*Math.pow(10,3))/Math.pow(10,3))},_addColorRamp:function(M){M||(M={algorithm:"hsv",fromColor:[0,0,0,1],toColor:[255,255,255,1]});var W=this._generateColorRampDivs(M);M.label="\x3cdiv class\x3d'esriStretchLegendGradientLabel'\x3e"+W+"\x3c/div\x3e";return M.label},_generateColorRampDivs:function(M){if(M){var W="";if("multipart"===M.type){var da=100/M.colorRamps.length;var ja=
M.colorRamps;Object.keys(ja).reverse().forEach(function(ia){W+=this._generateSingleGradientDiv(ja[ia].fromColor,ja[ia].toColor,da)},this)}else W=this._generateSingleGradientDiv(M.fromColor,M.toColor,100);return W}},_generateSingleGradientDiv:function(M,W,da){if(M&&W){var ja="";M=M.toRgb?M.toRgb():M;W=W.toRgb?W.toRgb():W;var ia="(0deg, rgb("+M.slice(0,3).join()+"), rgb("+W.slice(0,3).join()+"));";n.forEach(["-webkit-linear-gradient","-o-linear-gradient","-moz-linear-gradient","linear-gradient"],function(pa){ja+=
"background: "+pa+ia});return"\x3cdiv class\x3d'esriStretchLegendSingleGradient' style\x3d'height:"+da+"%;"+ja+"'\x3e\x3c/div\x3e"}},_isLayerEditable:function(M){return"function"===typeof M.isEditable&&M.isEditable()},_isUnclassedRenderer:function(M,W){var da=M.infos;da=da?da.length:0;if("esri.renderer.ClassBreaksRenderer"===M.declaredClass&&1===da){da=M.attributeField;var ja=M.normalizationField;M=W?da===W:!!this._getVariables(M,da,ja).length}else M=M.authoringInfo&&M.authoringInfo.type,M=2===da&&
"univariateColorSize"===M;return M},_displayDefaultSymbol:function(M,W,da,ja,ia){var pa=W.defaultSymbol;if(!M._hideDefaultSymbol&&pa){var oa=!0;da=l.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},da);da=l.create("tbody",{},da);pa=this._applyScaleDrivenSymbolSize(pa,W,ja,ia);this._buildRow_Renderer(M,pa,null,H.encode(W.defaultLabel)||"others",null,da)}return oa},_applyScaleDrivenSymbolSize:function(M,W,da,ja){ja&&(M=fa.fromJson(M.toJson()),this._applySize(M,W,da,
null));return M},_showGradientRamp:function(M,W,da,ja,ia,pa,oa,ra,wa){wa=l.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(wa?"":" esriLegendSubFragment")},ia);ia=l.create("tbody",{},wa);(M._hoverLabel||M._hoverLabels||ra)&&this._createHoverAction(wa,M,W,ra);(oa||pa.valueExpression||pa.legendOptions&&pa.legendOptions.title)&&this._addSubHeader(ia,this._getRampTitle(pa,M,W));oa=pa.field;var va;oa&&(va=r.isFunction(oa)?null:this.getField(M,oa,W));if(pa=(W=this._getRampStops(da,
pa,ja,va&&"esriFieldTypeDate"===va.type))?W.length:0)pa=10<pa,this._drawGradientRamp(ia,W,!pa,M,this._getRampBorderColor(da),!!ja,pa)},_getMedianColor:function(M,W){if(W.colors){var da=W.minDataValue;var ja=W.maxDataValue}else W.stops&&(da=W.stops[0].value,ja=W.stops[W.stops.length-1].value);return M.getColor(da+(ja-da)/2,{colorInfo:W})},_getRampStops:function(M,W,da,ja){var ia,pa,oa=!1;if(W.colors||W.opacityValues){var ra=W.maxDataValue-W.minDataValue;var wa=n.map([0,.25,.5,.75,1],function(Aa){ia=
W.minDataValue+Aa*ra;return Number(ia.toFixed(6))});this._checkPrecision(0,4,wa)}else W.stops&&(wa=n.map(W.stops,function(Aa){return Aa.value}),ja||n.some(wa,function(Aa){return 2<D.getDigits(Aa).fractional})&&(wa=D.round(wa)),(oa=n.some(W.stops,function(Aa){return!!Aa.label}))&&(pa=n.map(W.stops,function(Aa){return Aa.label})));var va=wa[0],ya,ua;ra=wa[wa.length-1]-va;return n.map(wa,function(Aa,Ga){da?(ya=new d(da.toRgba()),ua=M.getOpacity(Aa,{opacityInfo:W}),null!=ua&&(ya.a=ua)):ya=M.getColor(Aa,
{colorInfo:W});var Ba="";if(oa)Ba=pa[Ga];else{Ba=ja?L.formatDate(Aa,L.timelineDateFormatOptions):D.format(Aa);var Ea="";0===Ga?Ea=this._specialChars.lt+" ":Ga===wa.length-1&&(Ea=this._specialChars.gt+" ");Ba=Ea+Ba}return{value:Aa,color:ya,offset:1-(Aa-va)/ra,label:Ba}},this).reverse()},_checkPrecision:function(M,W,da){var ja=M+(W-M)/2,ia=da[M],pa=da[ja],oa=da[W],ra=Math.floor(ia),wa=Math.floor(pa),va=Math.floor(oa);ra===ia&&va===oa&&wa!==pa&&ra!==wa&&va!==wa&&(da[ja]=wa);M+1!==ja&&this._checkPrecision(M,
ja,da);ja+1!==W&&this._checkPrecision(ja,W,da)},_getRampBorderColor:function(M){if("esri.renderer.SimpleRenderer"===M.declaredClass)var W=M.symbol;else if("esri.renderer.UniqueValueRenderer"===M.declaredClass||"esri.renderer.ClassBreaksRenderer"===M.declaredClass)W=M.infos[0].symbol;return(M=W&&-1===W.type.indexOf("linesymbol")?W.getStroke():null)&&M.color},_drawGradientRamp:function(M,W,da,ja,ia,pa,oa){var ra=l.create("tr",{},M),wa=W.length-1,va;var ya=0;if(this.alignRight){M=l.create("td",{align:this._isRightToLeft?
"left":"right"},ra);var ua=l.create("td",{align:this._isRightToLeft?"left":"right",width:this.gradientWidth},ra)}else ua=l.create("td",{width:this.gradientWidth,align:"center"},ra),M=l.create("td",{},ra);ra=ia&&0<ia.a&&!(240<=ia.r&&240<=ia.g&&240<=ia.b);var Aa=l.create("div",{"class":ra?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+"px;"},ua);ua=l.create("div",{"class":"esriLegendColorRamp"+(pa?" esriLegendTransparencyRamp":"")},Aa);pa=q.get(ua,"width");
ra&&(ia=9>b("ie")?ia.toHex():"rgba("+ia.toRgba().join(",")+")",q.set(ua,"border",this.colorRampBorder+" "+ia));da?(ia=this.gradientHeight*wa,q.set(ua,"height",ia+"px")):ia=q.get(ua,"height");q.set(Aa,"height",ia+"px");ra=w.createSurface(ua,pa,ia);9>b("ie")&&(ya=ra.getEventSource(),q.set(ya,"position","relative"),q.set(ya.parentNode,"position","relative"),ya=1);try{da&&n.forEach(W,function(Ea,Ra){Ea.offset=Ra/wa});var Ga=ra.createRect({x:-ya,y:-ya,width:pa+ya,height:ia+ya});Ga.setFill({type:"linear",
x1:0,y1:0,x2:0,y2:ia,colors:W}).setStroke(null);ra.createRect({width:pa,height:ia}).setFill(new d([255,255,255,1-ja.opacity])).setStroke(null);this._surfaceItems.push(ra)}catch(Ea){ra.clear(),ra.destroy()}n.forEach(W,function(Ea,Ra){Ea.label&&(va="top:"+100*Ea.offset+"%;",Ea="",0===Ra&&(Ea+=" esriLegendColorRampTickFirst"),Ra===W.length-1&&(Ea+=" esriLegendColorRampTickLast"),l.create("div",{"class":"esriLegendColorRampTick"+Ea,innerHTML:"\x26nbsp;",style:va},Aa))});var Ba=l.create("div",{"class":"esriLegendColorRampLabels",
style:{height:ia+this.gradientHeight+"px"}},M);da?n.forEach(W,function(Ea){l.create("div",{"class":"esriLegendColorRampLabel",innerHTML:H.encode(Ea.label)||"\x26nbsp;"},Ba)}):(l.create("div",{"class":"esriLegendColorRampLabel",innerHTML:oa?H.encode(W[0].label)||"\x26nbsp;":this._i18n.high},Ba),l.create("div",{"class":"esriLegendColorRampLabel",innerHTML:oa?H.encode(W[W.length-1].label)||"\x26nbsp;":this._i18n.low,style:"top: "+(ia+this.gradientHeight-2*this.gradientHeight)+"px;"},Ba))},_showHeatRamp:function(M,
W,da,ja,ia){var pa=da.field;var oa=l.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},ja);ja=l.create("tbody",{},oa);(M._hoverLabel||M._hoverLabels||ia)&&this._createHoverAction(oa,M,W,ia);(pa=pa&&this.getField(M,pa,W))&&this._addSubHeader(ja,this._getFieldAlias(pa.name,M,W));W=this._getHeatmapStops(da);W.length&&this._drawGradientRamp(ja,W,!1,M)},_getHeatmapStops:function(M){var W=M.colorStops;M=M.colors;if(W&&W[0]){var da=W.length-1;if(M=W[0]&&null!=W[0].ratio)(M=
W[da])&&1!==M.ratio&&(W=W.slice(0),W.push({ratio:1,color:M.color}),da++);else{var ja=W[0].value;var ia=W[da].value-ja;W=n.map(W,function(oa){return{color:oa.color,ratio:(oa.value-ja)/ia}})}}else if(M&&M[0]){da=M.length-1;var pa=1/(M.length-1);W=n.map(M,function(oa,ra){return{color:oa,ratio:ra*pa}})}W=n.map(W,function(oa,ra){var wa="";0===ra?wa="Low":ra===da&&(wa="High");return{color:oa.color,label:wa,offset:1-oa.ratio}});return W.reverse()},_showDotDensityLegend:function(M,W,da,ja){var ia=da.legendOptions,
pa,oa=this.dotDensitySwatchSize,ra=Math.round(oa/2);if(ia){var wa=ia.backgroundColor;var va=ia.outline;var ya=ia.valueUnit;var ua=ia.dotCoverage}ua=(ua||this.dotCoverage)/100;var Aa=Math.round(oa*oa/Math.pow(da.dotSize,2)*ua);ja=l.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},ja);var Ga=l.create("tbody",{},ja);(M._hoverLabel||M._hoverLabels)&&this._createHoverAction(ja,M,W);this._addSubHeader(Ga,J.substitute({value:da.dotValue,unit:ya||""},this.NLS_dotValue));
n.forEach(da.fields,function(Ba){Ba=r.mixin({},Ba);Ba.numPoints=Aa;pa=new P(da._generateImageSrc(oa,oa,[Ba],{x:0,y:0},{x:oa,y:oa},wa),va||da.outline,oa,oa);Ba=this.getField(M,Ba.name,W)||Ba;this._buildRow_Renderer(M,pa,null,H.encode(this._getFieldAlias(Ba.name,M,W)),null,Ga,{type:"path",path:"M "+-ra+","+-ra+" L "+ra+","+-ra+" L "+ra+","+ra+" L "+-ra+","+ra+" L "+-ra+","+-ra+" E"})},this)},_showSizeLegend:function(M,W,da,ja,ia,pa,oa,ra,wa){var va=ja.legendOptions;va=va&&va.customValues;ia=this._getSizeSymbol(da,
ia);if((!ja.valueUnit||"unknown"===ja.valueUnit)&&ia&&(va||null!=ja.minSize&&null!=ja.maxSize&&null!=ja.minDataValue&&null!=ja.maxDataValue||ja.stops&&!(1>=ja.stops.length))){wa=l.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(wa?"":" esriLegendSubFragment")},pa);pa=l.create("tbody",{},wa);(M._hoverLabel||M._hoverLabels||ra)&&this._createHoverAction(wa,M,W,ra);(oa||ja.valueExpression||ja.legendOptions&&ja.legendOptions.title)&&this._addSubHeader(pa,this._getRampTitle(ja,
M,W));oa=(wa=(ra=ja.field)&&!r.isFunction(ra))&&"cluster_count"===ra.toLowerCase();W=(W=wa?M.isFeatureReductionActive&&M.isFeatureReductionActive()?M.getFeatureReductionField(ra):this.getField(M,ra,W):null)&&"esriFieldTypeDate"===W.type;va=va||this._getDataValues(da,ia,ja,W,oa);var ya=va.length-1;for(ra=ya;0<=ra;ra--){wa=va[ra];ia=fa.fromJson(ia.toJson());this._applySize(ia,da,ja,wa);wa=W?L.formatDate(wa,L.timelineDateFormatOptions):D.format(wa);var ua="";ra===ya?ua=this._specialChars.gt+" ":0===
ra&&(ua=oa&&1===va[ra]?"":this._specialChars.lt+" ");ua="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+H.encode(ua+wa)+"\x3c/span\x3e";this._buildRow_Renderer(M,ia,null,ua,null,pa)}}},_getSizeSymbol:function(M,W){if("esri.renderer.SimpleRenderer"===M.declaredClass)var da=M.symbol;else if("esri.renderer.VectorFieldRenderer"===M.declaredClass)da=M.defaultSymbol;else if("esri.renderer.UniqueValueRenderer"===M.declaredClass||"esri.renderer.ClassBreaksRenderer"===M.declaredClass){da=M.infos[0].symbol;
var ja=1<M.infos.length}if(da=da&&-1!==da.type.indexOf("fillsymbol")?null:da)if(da=fa.fromJson(da.toJson()),W||ja)-1!==da.type.indexOf("linesymbol")?da.setColor(new d(this.sizeRampDarkColor)):(da.setColor(new d(this.sizeRampLightColor)),da.setOutline&&(M=new Y,M.setColor(new d(this.sizeRampDarkColor)),M.setWidth(1.5),da.setOutline(M)));return da},_getDataValues:function(M,W,da,ja,ia){if(ia){var pa;n.some([5,3,2],function(oa){oa=this._getDataValuesByCount(M,W,da,ja,oa);this._hasFractionalValues(oa)||
(pa=oa);return!!pa},this);return pa}return(ia=M.authoringInfo)&&"univariateColorSize"===ia.type&&"above-and-below"===ia.univariateTheme&&da.stops?this._getDataValuesFromStops(da,ja):this._getDataValuesByCount(M,W,da,ja,5)},_getDataValuesFromStops:function(M,W){M=n.map(M.stops,function(da){return da.value});return W?M:D.round(M)},_getDataValuesByCount:function(M,W,da,ja,ia,pa){ia=null==ia?5:ia;pa=null==pa?20:pa;var oa=M.getSizeRangeAtScale(da,this.map.getScale());ia=this._interpolateSizeRange(oa,ia);
var ra=this._getDataRange(da),wa=n.map(ia,function(ya){return this._getDataValueFromSize(ya,ra,oa)},this);if(!ja){var va;wa=D.round(wa);for(ja=1;ja<wa.length-1;ja++)if(va=this._roundDataValue(M,W,da,wa[ja],wa[ja-1],pa))wa[ja]=va[0],ia[ja]=va[1]}return wa},_hasFractionalValues:function(M){return n.some(M,function(W){return W!==Math.floor(W)})},_getDataRange:function(M){var W=M.stops;return W?{min:W[0].value,max:W[W.length-1].value}:{min:M.minDataValue,max:M.maxDataValue}},_interpolateSizeRange:function(M,
W){var da=M.minSize;M=(M.maxSize-da)/(W-1);var ja,ia=[];for(ja=0;ja<W;ja++)ia.push(da+M*ja);return ia},_getDataValueFromSize:function(M,W,da){var ja=da.minSize;da=da.maxSize;var ia=W.min;W=W.max;return M<=ja?ia:M>=da?W:(M-ja)/(da-ja)*(W-ia)+ia},_roundDataValue:function(M,W,da,ja,ia,pa){var oa=this._getSize(W,M,da,ja);ia=this._getSize(W,M,da,ia);var ra=D.getDigits(ja),wa=ra.integer;ra=ra.fractional;var va;if(0<ja&&1>ja){var ya=Math.pow(10,ra);ja*=ya;wa=D.getDigits(ja).integer}for(--wa;0<=wa;wa--){var ua=
Math.pow(10,wa);ra=Math.floor(ja/ua)*ua;ua*=Math.ceil(ja/ua);null!=ya&&(ra/=ya,ua/=ya);var Aa=(ra+ua)/2;Aa=D.round([ra,Aa,ua],{indexes:[1]})[1];var Ga=this._getSize(W,M,da,ra);var Ba=this._getSize(W,M,da,ua);var Ea=this._getSize(W,M,da,Aa);var Ra=D.getPctChange(oa,Ga,ia,null);var Ta=D.getPctChange(oa,Ba,ia,null);var Za=D.getPctChange(oa,Ea,ia,null);var Ya=Ra.prev<=pa;var cb=Ta.prev<=pa;Ya&&cb&&(Ra.prev<=Ta.prev?(Ya=!0,cb=!1):(cb=!0,Ya=!1));Ya?va=[ra,Ga]:cb?va=[ua,Ba]:Za.prev<=pa&&(va=[Aa,Ea]);if(va)break}return va},
_applySize:function(M,W,da,ja){var ia=M.type;W=this._getSize(M,W,da,ja);switch(ia){case "simplemarkersymbol":M.setSize(W);break;case "picturemarkersymbol":ia=M.width;da=M.height;M.setHeight(W);M.setWidth(ia/da*W);break;case "simplelinesymbol":case "cartographiclinesymbol":M.setWidth(W);break;case "textsymbol":M.font&&M.font.setSize(W)}},_getSize:function(M,W,da,ja){return W.getSize(ja,{sizeInfo:da,scale:this.map.getScale(),shape:-1!==M.type.indexOf("markersymbol")?M.style:null})},_buildRow_Renderer:function(M,
W,da,ja,ia,pa,oa,ra){var wa=!!ra,va=l.create("tr",{},pa);if(this.alignRight){if(pa=l.create("td",{align:this._isRightToLeft?"left":"right"},va),W||wa)var ya=l.create("td",{align:this._isRightToLeft?"left":"right",width:35},va)}else{if(W||wa)ya=l.create("td",{width:35,align:"center"},va);pa=l.create("td",{},va)}var ua=va=30;if(W)if("simplemarkersymbol"===W.type)va=Math.min(Math.max(va,W.size+12),125),ua=Math.min(Math.max(ua,W.size+12),125);else if("picturemarkersymbol"===W.type)va=Math.min(Math.max(va,
W.width),125),ua=Math.min(W.height||ua,125);else if("textsymbol"===W.type){if(!W.text){var Aa=W.text;var Ga=!0;W.setText(this.defaultText)}va=Math.min(Math.max(va,W.getWidth()+12),125);ua=Math.min(Math.max(ua,W.getHeight()+12),125);Ga&&W.setText(Aa)}if(W||wa)var Ba=l.create("div",{style:"width:"+va+"px;height:"+ua+"px;"},ya);J.isDefined(ja)&&"number"===typeof ja&&(ja=""+ja);l.create("td",{innerHTML:ja||"",align:this._align},l.create("tr",{},l.create("tbody",{},l.create("table",{width:"95%"},pa))));
if(W||wa)M=this._drawSymbol(Ba,W,da,va,ua,ia,M,oa,ra),this._surfaceItems.push(M)},_addSubHeader:function(M,W){M=l.create("tr",{},M);M=l.create("td",{align:this._align,colspan:2},M);l.create("td",{innerHTML:H.encode(W)||"",align:this._align},l.create("tr",{},l.create("tbody",{},l.create("table",{width:"95%"},M))))},_drawSymbol:function(M,W,da,ja,ia,pa,oa,ra,wa){var va=W&&fa.fromJson(W.toJson()),ya=oa.opacity;W=!!wa;if(va)if(da&&va.setColor(new d(da.toRgba())),"simplelinesymbol"===va.type||"cartographiclinesymbol"===
va.type||"textsymbol"===va.type){if(!va.color)return;da=va.color.toRgba();da[3]*=ya;va.color.setColor(da)}else"simplemarkersymbol"===va.type||"simplefillsymbol"===va.type?(va.color&&(da=va.color.toRgba(),da[3]*=ya,va.color.setColor(da)),va.outline&&va.outline.color&&(da=va.outline.color.toRgba(),da[3]*=ya,va.outline.color.setColor(da))):"picturemarkersymbol"===va.type&&(M.style.opacity=ya,M.style.filter="alpha(opacity\x3d("+100*ya+"))");M=w.createSurface(M,ja,ia);9>b("ie")&&(da=M.getEventSource(),
q.set(da,"position","relative"),q.set(da.parentNode,"position","relative"));pa=W?wa.shapeDescriptor:this._getDrawingToolShape(va,pa)||fa.getShapeDescriptors(va);ya=(da=pa.defaultShape)&&"text"===da.type;try{ya&&!da.text&&(da.text=this.defaultText);var ua=M.createShape(ra||da).setFill(pa.fill).setStroke(pa.stroke);ya&&ua.setFont(pa.font)}catch(Ba){M.clear();M.destroy();return}var Aa=ua.getBoundingBox();ra=Aa.width;pa=Aa.height;ya=-(Aa.x+ra/2);var Ga=-(Aa.y+pa/2);da=M.getDimensions();ya={dx:ya+da.width/
2,dy:Ga+da.height/2};if(va&&"simplemarkersymbol"===va.type&&"path"===va.style)ja=oa._getScaleMatrix(Aa,va.size),ua.applyTransform(x.scaleAt(ja.xx,ja.yy,{x:da.width/2,y:da.height/2}));else if(ra>ja||pa>ia)oa=ra/ja>pa/ia,ja=((oa?ja:ia)-5)/(oa?ra:pa),r.mixin(ya,{xx:ja,yy:ja});ua.applyTransform(ya);W&&ua.applyTransform(x.rotategAt(wa.rotation,ra/2,pa/2));return M},_getDrawingToolShape:function(M,W){switch(W?W.drawingTool||null:null){case "esriFeatureEditToolArrow":W={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 Z"};
break;case "esriFeatureEditToolTriangle":W={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 Z"};break;case "esriFeatureEditToolRectangle":W={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"};break;case "esriFeatureEditToolCircle":W={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":W={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:W,fill:M.getFill(),stroke:M.getStroke()}},_drawRelationshipLegend:function(M,W){var da=W.focus,
ja=W.numClasses,ia=ba[ja],pa=!!da,oa=Math.sqrt(Math.pow(75,2)+Math.pow(75,2)),ra={};W.uvInfos.forEach(function(ua){ra[ua.value]={label:ua.label,fill:this._getSymbolColor(ua.symbol)}},this);W=[];for(var wa=0;wa<ja;wa++){for(var va=[],ya=0;ya<ja;ya++)va.push(ra[ia[wa][ya]].fill);W.push(va)}ia=this._getRelationshipCornerLabels(da,ra);M=this._drawRampLayout(M,ia,oa,pa);M=w.createSurface(M,oa,oa);pa||(M.rawNode.style.margin="-15px -15px -18px -15px");W=Z.create2DColorRamp({surface:M,colors:W,numClasses:ja,
size:75});ja=(oa-75)/2;oa=(oa-75)/2;W.applyTransform(x.translate(ja,oa));pa&&W.applyTransform(x.rotategAt(this._getRotationAngleForFocus(da),37.5,37.5));W=M.createGroup();ia={width:1,color:"#555555"};wa=M.defNode;this._createArrowMarker(wa,"start");this._createArrowMarker(wa,"end");wa=W.createLine({x1:-10,y1:60,x2:-10,y2:15}).setStroke(ia);ia=W.createLine({x1:15,y1:85,x2:60,y2:85}).setStroke(ia);this._setLineArrow(wa.rawNode,"left",da);this._setLineArrow(ia.rawNode,"right",da);W.applyTransform(x.translate(ja,
oa));pa&&W.applyTransform(x.rotategAt(-45,37.5,37.5));this._surfaceItems.push(M)},_drawRampLayout:function(M,W,da,ja){var ia=l.create("div",{style:{padding:"10px"}},M);M=da+"px";da+="px";ja?(ja=l.create("div",{style:{display:"flex"}},ia),l.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:M,textAlign:"right"},innerHTML:W.left},ja),ia=l.create("div",{style:{display:"flex",flexDirection:"column",textAlign:"center"}},ja),l.create("div",{class:"esriLegendRelationshipLabel",
style:{alignSelf:"center",maxWidth:M},innerHTML:W.right},ja),ja=l.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:M},innerHTML:W.top},ia),ja=l.create("div",{style:{height:da,width:da}},ia),ia=l.create("div",{class:"esriLegendRelationshipLabel",style:{alignSelf:"center",maxWidth:M},innerHTML:W.bottom},ia)):(ia=l.create("div",{style:{display:"table",color:"#555555"}},ia),ja=l.create("div",{style:{display:"table-row"}},ia),da=l.create("div",{style:{display:"table-row"}},
ia),ia=l.create("div",{style:{display:"table-row"}},ia),l.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:M,textAlign:"right",verticalAlign:"bottom"},innerHTML:W.left},ja),l.create("div",{style:{display:"table-cell"}},ja),l.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:M,textAlign:"left",verticalAlign:"bottom"},innerHTML:W.top},ja),l.create("div",{style:{display:"table-cell"}},da),ja=l.create("div",{style:{display:"table-cell"}},
da),l.create("div",{style:{display:"table-cell"}},da),l.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:M,textAlign:"right",verticalAlign:"top"},innerHTML:W.bottom},ia),l.create("div",{style:{display:"table-cell"}},ia),l.create("div",{class:"esriLegendRelationshipLabel",style:{display:"table-cell",maxWidth:M,textAlign:"left",verticalAlign:"top"},innerHTML:W.right},ia));return ja},_getSymbolColor:function(M){if(M)return"simplelinesymbol"===M.type||"simplemarkersymbol"===
M.type&&(M.style===X.STYLE_X||M.style===X.STYLE_CROSS)?(M=M.getStroke())&&M.color:M.getFill()},_getRotationAngleForFocus:function(M){var W=ea[M];M&&null==W&&(W=ea.HH);return W},_setLineArrow:function(M,W,da){var ja=this.id+"_arrowStart",ia=this.id+"_arrowEnd";W="left"===W;switch(da){case "HL":M.setAttribute(W?"marker-start":"marker-end","url(#"+(W?ia:ja)+")");break;case "LL":M.setAttribute("marker-start","url(#"+ia+")");break;case "LH":M.setAttribute(W?"marker-end":"marker-start","url(#"+(W?ja:ia)+
")");break;default:M.setAttribute("marker-end","url(#"+ja+")")}},_createArrowMarker:function(M,W){var da="start"===W,ja=this.id+(da?"_arrowStart":"_arrowEnd");W=da?"0,0 5,5 0,10":"5,0 0,5 5,10";var ia=da?5:0;da=document.createElementNS("http://www.w3.org/2000/svg","marker");da.setAttribute("id",ja);da.setAttribute("markerWidth","10");da.setAttribute("markerHeight","10");da.setAttribute("refX",ia);da.setAttribute("refY","5");da.setAttribute("markerUnits","strokeWidth");da.setAttribute("orient","auto");
ja=document.createElementNS("http://www.w3.org/2000/svg","polyline");ja.setAttribute("points",W);ja.setAttribute("fill","none");ja.setAttribute("stroke","#555555");ja.setAttribute("stroke-width","1");da.appendChild(ja);M.appendChild(da)},_getRelationshipCornerLabels:function(M,W){var da=W.HH.label,ja=W.LL.label,ia=W.HL.label;W=W.LH.label;switch(M){case "HH":return{top:da,bottom:ja,left:ia,right:W};case "HL":return{top:ia,bottom:W,left:ja,right:da};case "LL":return{top:ja,bottom:da,left:W,right:ia};
case "LH":return{top:W,bottom:ia,left:da,right:ja};default:return{top:da,bottom:ja,left:ia,right:W}}},_repaintItems:function(){n.forEach(this._surfaceItems,function(M){this._repaint(M)},this)},_repaint:function(M){if(M){M.getStroke&&M.setStroke&&M.setStroke(M.getStroke());try{M.getFill&&M.setFill&&M.setFill(M.getFill())}catch(W){}M.children&&r.isArray(M.children)&&n.forEach(M.children,this._repaint,this)}},_createHoverAction:function(M,W,da,ja){if(ja=W._hoverLabel||W._hoverLabels&&W._hoverLabels[da.id]||
ja)ja=H.encode(ja),W.mouseMoveHandler=W.mouseMoveHandler||{},W.mouseMoveHandler[da.id]=m.connect(M,"onmousemove",r.hitch(this,function(ia,pa){this.mouseX=pa.clientX;this.mouseY=pa.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,q.set(f.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(r.hitch(this,function(oa,ra,wa){if(oa==this.mouseX&&ra==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=!0,f.byId(this.id+"_hoverLabel")){var va=f.byId(this.id+"_hoverLabel");va.innerHTML=
"\x3cspan\x3e"+wa+"\x3c/span\x3e";q.set(va,"top",ra+"px");q.set(va,"left",oa+15+"px");q.set(va,"display","")}else l.create("div",{innerHTML:"\x3cspan\x3e"+wa+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:ra+"px",left:oa+15+"px"}},document.body)},pa.clientX,pa.clientY,ia),500)},ja)),W.mouseOutHandler=W.mouseOutHandler||{},W.mouseOutHandler[da.id]=m.connect(M,"onmouseout",r.hitch(this,function(ia){this.mouseY=this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=
!1,q.set(f.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var M;n.forEach(this.layers,function(W){if(W.mouseMoveHandler)for(M in W.mouseMoveHandler)m.disconnect(W.mouseMoveHandler[M]);if(W.mouseOutHandler)for(M in W.mouseOutHandler)m.disconnect(W.mouseOutHandler[M])})},_createDynamicLayers:function(M){var W=[],da;n.forEach(M.dynamicLayerInfos||M.layerInfos,function(ja){da={id:ja.id};da.source=ja.source&&ja.source.toJson();var ia;M.layerDefinitions&&M.layerDefinitions[ja.id]&&
(ia=M.layerDefinitions[ja.id]);ia&&(da.definitionExpression=ia);var pa;M.layerDrawingOptions&&M.layerDrawingOptions[ja.id]&&(pa=M.layerDrawingOptions[ja.id]);pa&&(da.drawingInfo=pa.toJson());da.minScale=ja.minScale||0;da.maxScale=ja.maxScale||0;W.push(da)});return W},_getTemplateFromTypes:function(M,W){var da;for(da=0;da<M.length;da++)if(M[da].id==W&&M[da].templates&&0<M[da].templates.length)return M[da].templates[0];return null},_findParentGroup:function(M,W,da){var ja,ia=W.dynamicLayerInfos||W.layerInfos;
for(ja=0;ja<ia.length;ja++)if(da==ia[ja].id){-1<ia[ja].parentLayerId&&(q.set(f.byId(this.id+"_"+M+"_"+ia[ja].parentLayerId+"_group"),"display","block"),this._findParentGroup(M,W,ia[ja].parentLayerId));break}},_addSubLayersToHide:function(M){function W(da,ja){var ia=M.layer.dynamicLayerInfos||M.layer.layerInfos,pa,oa;for(pa=0;pa<ia.length;pa++)if(ia[pa].id===da&&ia[pa].subLayerIds)for(oa=0;oa<ia[pa].subLayerIds.length;oa++){var ra=ia[pa].subLayerIds[oa];-1===n.indexOf(ja,ra)&&(ja.push(ra),W(ra,ja))}}
M.layer.layerInfos&&n.forEach(this.hideLayersInLegend[M.layer.id],function(da){W(da,this.hideLayersInLegend[M.layer.id])},this)},_isLayerInScale:function(M,W,da){var ja,ia=!0;if(M.legendResponse&&M.legendResponse.layers)for(ja=0;ja<M.legendResponse.layers.length;ja++){var pa=M.legendResponse.layers[ja];if(W.id==pa.layerId){if(!M.minScale&&0!==M.minScale||!M.maxScale&&0!==M.maxScale){if(0==pa.minScale&&M.tileInfo)var oa=M.tileInfo.lods[0].scale;if(0==pa.maxScale&&M.tileInfo)var ra=M.tileInfo.lods[M.tileInfo.lods.length-
1].scale}else oa=Math.min(M.minScale,pa.minScale)||M.minScale||pa.minScale,ra=Math.max(M.maxScale,pa.maxScale);if(0<oa&&oa<da||ra>da)ia=!1;break}}else if(M.minScale||M.maxScale)if(M.minScale&&M.minScale<da||M.maxScale&&M.maxScale>da)ia=!1;return ia},_getServiceTitle:function(M){var W=M._titleForLegend;W||(W=M.url,M.url?-1<M.url.indexOf("/MapServer")?(W=M.url.substring(0,M.url.indexOf("/MapServer")),W=W.substring(W.lastIndexOf("/")+1,W.length)):-1<M.url.indexOf("/ImageServer")?(W=M.url.substring(0,
M.url.indexOf("/ImageServer")),W=W.substring(W.lastIndexOf("/")+1,W.length)):-1<M.url.indexOf("/FeatureServer")&&(W=M.url.substring(0,M.url.indexOf("/FeatureServer")),W=W.substring(W.lastIndexOf("/")+1,W.length)):W="",M.name&&(W=0<W.length?W+(" - "+M.name):M.name));"esri.layers.ArcGISImageServiceVectorLayer"===M.declaredClass&&M.vectorFieldPixelFilter&&(M=M.vectorFieldPixelFilter.outputUnit?this["NLS_"+M.vectorFieldPixelFilter.outputUnit]:this["NLS_"+M.vectorFieldPixelFilter.inputUnit],J.isDefined(M)&&
(W+=" ("+M+")"));return H.encode(W)},_getEffectiveScale:function(M,W){var da=W.minScale,ja=W.maxScale;if(J.isDefined(W.parentLayerId)){M=M.layerInfos;W=W.parentLayerId;var ia;for(ia=M.length-1;0<=ia;ia--)if(M[ia].id==W)if(0==da&&0<M[ia].minScale?da=M[ia].minScale:0<da&&0==M[ia].minScale||0<da&&0<M[ia].minScale&&(da=Math.min(da,M[ia].minScale)),ja=Math.max(ja||0,M[ia].maxScale||0),-1<M[ia].parentLayerId)W=M[ia].parentLayerId;else break}return{minScale:da,maxScale:ja}},_isSupportedLayerType:function(M){return!(!M||
!("esri.layers.ArcGISDynamicMapServiceLayer"===M.declaredClass||"esri.layers.ArcGISImageServiceLayer"===M.declaredClass&&10.2<=M.version||"esri.layers.RasterXLayer"===M.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===M.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===M.declaredClass||"esri.layers.FeatureLayer"===M.declaredClass||"esri.layers.StreamLayer"===M.declaredClass||"esri.layers.KMLLayer"===M.declaredClass||"esri.layers.GeoRSSLayer"===M.declaredClass||"esri.layers.WMSLayer"===
M.declaredClass||"esri.layers.WFSLayer"===M.declaredClass||"esri.layers.CSVLayer"===M.declaredClass))},isHostedTileService:function(M){var W=/(https?:)?\/\/services.*\.arcgis\.com/i;return!("esri.layers.ArcGISTiledMapServiceLayer"!==M.declaredClass||!W.test(M.url))},getField:function(M,W,da){if(M.getField)return M.getField(W);if(da&&da.fields){var ja;n.forEach(da.fields,function(ia){ia.name===W&&(ja=ia)});return ja}return null}});r.mixin(ma,{ALIGN_LEFT:0,ALIGN_RIGHT:1});b("extend-esri")&&r.setObject("dijit.Legend",
ma,A);return ma})},"dojo/debounce":function(){define([],function(){return function(G,u){var r;return function(){r&&clearTimeout(r);var n=this,m=arguments;r=setTimeout(function(){G.apply(n,m)},u)}}})},"esri/numberUtils":function(){define(["dojo/has","dojo/number","dojo/i18n!dojo/cldr/nls/number","./kernel"],function(G,u,r,n){var m=function(d,a){return d-a},k={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(d){var a=String(d),b=a.match(k._reNumber);d={integer:0,fractional:0};b&&b[1]?(d.integer=
b[1].split("").length,d.fractional=b[3]?b[3].split("").length:0):-1<a.toLowerCase().indexOf("e")&&(b=a.split("e"),a=b[0],b=b[1],a&&b&&(a=Number(a),b=Number(b),(d=0<b)||(b=Math.abs(b)),a=k.getDigits(a),d?(a.integer+=b,a.fractional=b>a.fractional?0:a.fractional-b):(a.fractional+=b,a.integer=b>a.integer?1:a.integer-b),d=a));return d},getFixedNumbers:function(d,a){var b=Number(d.toFixed(a));b<d?d=b+1/Math.pow(10,a):(d=b,b-=1/Math.pow(10,a));b=Number(b.toFixed(a));d=Number(d.toFixed(a));return[b,d]},getPctChange:function(d,
a,b,e){var g={prev:null,next:null};if(null!=b){var h=d-b;g.prev=Math.floor(Math.abs(100*(a-b-h)/h))}null!=e&&(h=e-d,g.next=Math.floor(Math.abs(100*(e-a-h)/h)));return g},round:function(d,a){d=d.slice(0);var b,e,g=a&&null!=a.tolerance?a.tolerance:2,h=a&&a.indexes,c=a&&null!=a.strictBounds?a.strictBounds:!1;if(h)h.sort(m);else for(h=[],b=0;b<d.length;b++)h.push(b);for(b=0;b<h.length;b++){var f=h[b];a=d[f];var l=0===f?null:d[f-1];var q=f===d.length-1?null:d[f+1];var t=k.getDigits(a);if(t=t.fractional){var v=
0;for(e=!1;v<=t&&!e;){var w=k.getFixedNumbers(a,v);w=c&&0===b?w[1]:w[0];e=k.hasMinimalChange(a,w,l,q,g);v++}e&&(d[f]=w)}}return d},hasMinimalChange:function(d,a,b,e,g){d=k.getPctChange(d,a,b,e);a=null==d.prev||d.prev<=g;b=null==d.next||d.next<=g;return a&&b||d.prev+d.next<=2*g},_reAllZeros:new RegExp("\\"+r.decimal+"0+$","g"),_reSomeZeros:/(\d)0*$/g,format:function(d,a){a=a||{places:20,round:-1};(d=u.format(d,a))&&(d=d.replace(k._reSomeZeros,"$1").replace(k._reAllZeros,""));return d}};G("extend-esri")&&
(n.numberUtils=k);return k})},"esri/renderers/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/has dojo/date/locale ../kernel ../numberUtils ../Color dojo/i18n!dojo/cldr/nls/gregorian".split(" "),function(G,u,r,n,m,k,d,a){function b(t){return t&&u.map(t,function(v){return new d(v)})}function e(t,v,w){var x="";0===v?x=h.lt+" ":v===w&&(x=h.gt+" ");return x+t}var g={},h={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%"},c={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,
year:6},f={millisecond:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",dateOptions:{formatLength:"long"}},month:{selector:"date",dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},l={formatLength:"short",
fullYear:!0},q={formatLength:"short"};G.mixin(g,{timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(t,v){var w=[];null==t||t instanceof Date||(t=new Date(t));v=v||{};v=G.mixin({},v);var x=v.selector?v.selector.toLowerCase():null,H=!x||-1<x.indexOf("time");x=!x||-1<x.indexOf("date");H&&(v.timeOptions=v.timeOptions||q,v.timeOptions&&(v.timeOptions=G.mixin({},v.timeOptions),v.timeOptions.selector=v.timeOptions.selector||"time",w.push(v.timeOptions)));
x&&(v.dateOptions=v.dateOptions||l,v.dateOptions&&(v.dateOptions=G.mixin({},v.dateOptions),v.dateOptions.selector=v.dateOptions.selector||"date",w.push(v.dateOptions)));w&&w.length?(w=u.map(w,function(A){return n.format(t,A)}),v=1==w.length?w[0]:a["dateTimeFormat-medium"].replace(/'/g,"").replace(/\{(\d+)\}/g,function(A,z){return w[z]})):v=n.format(t);return v},createColorStops:function(t){var v=t.values,w=t.colors,x=t.labelIndexes,H=t.isDate,A=t.dateFormatOptions;t=[];return t=u.map(v,function(z,
E){var J=null;if(!x||-1<u.indexOf(x,E)){var D;(D=H?g.formatDate(z,A):k.format(z))&&(J=e(D,E,v.length-1))}return{value:z,color:w[E],label:J}})},updateColorStops:function(t){var v=t.stops,w=t.changes,x=t.isDate,H=t.dateFormatOptions,A=[],z=u.map(v,function(J){return J.value});u.forEach(w,function(J){A.push(J.index);z[J.index]=J.value});var E=k.round(z,{indexes:A});u.forEach(v,function(J,D){J.value=z[D];if(null!=J.label){var L,C=null;(L=x?g.formatDate(E[D],H):k.format(E[D]))&&(C=e(L,D,v.length-1));J.label=
C}})},createClassBreakLabel:function(t){var v=t.minValue,w=t.maxValue,x=t.isFirstBreak?"":h.gt+" ";t="percent-of-total"===t.normalizationType?h.pct:"";v=null==v?"":k.format(v);w=null==w?"":k.format(w);return x+v+t+" \u2013 "+w+t},setLabelsForClassBreaks:function(t){var v=t.classBreaks,w=t.classificationMethod,x=t.normalizationType,H=[];v&&v.length&&("standard-deviation"===w?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):t.round?
(H.push(v[0].minValue),u.forEach(v,function(A){H.push(A.maxValue)}),H=k.round(H),u.forEach(v,function(A,z){A.label=g.createClassBreakLabel({minValue:0===z?H[0]:H[z],maxValue:H[z+1],isFirstBreak:0===z,normalizationType:x})})):u.forEach(v,function(A,z){A.label=g.createClassBreakLabel({minValue:A.minValue,maxValue:A.maxValue,isFirstBreak:0===z,normalizationType:x})}))},updateClassBreak:function(t){var v=t.classBreaks,w=t.normalizationType,x=t.change,H=x.index;x=x.value;var A=-1,z=-1,E=v.length;"standard-deviation"===
t.classificationMethod?console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method."):(0===H?A=H:H===E?z=H-1:(z=H-1,A=H),-1<A&&A<E&&(t=v[A],t.minValue=x,t.label=g.createClassBreakLabel({minValue:t.minValue,maxValue:t.maxValue,isFirstBreak:0===A,normalizationType:w})),-1<z&&z<E&&(t=v[z],t.maxValue=x,t.label=g.createClassBreakLabel({minValue:t.minValue,maxValue:t.maxValue,isFirstBreak:0===z,normalizationType:w})))},calculateDateFormatInterval:function(t){var v,
w,x=t.length,H=Infinity;t=u.map(t,function(N){return new Date(N)});for(v=0;v<x-1;v++){var A=t[v];var z=[];var E=Infinity;var J="";for(w=v+1;w<x;w++){var D=t[w];D=A.getFullYear()!==D.getFullYear()&&"year"||A.getMonth()!==D.getMonth()&&"month"||A.getDate()!==D.getDate()&&"day"||A.getHours()!==D.getHours()&&"hour"||A.getMinutes()!==D.getMinutes()&&"minute"||A.getSeconds()!==D.getSeconds()&&"second"||"millisecond";var L=c[D];L<E&&(E=L,J=D);z.push(D)}if(E<H){H=E;var C=J}}return C},createUniqueValueLabel:function(t){var v=
t.value,w=t.fieldInfo,x=t.domain;t=t.dateFormatInterval;var H=String(v);(x=x&&x.codedValues?x.getName(v):null)?H=x:"number"===typeof v&&(H=w&&"esriFieldTypeDate"===w.type?g.formatDate(v,t&&f[t]):k.format(v));return H},cloneColorInfo:function(t){if(t){var v=G.mixin({},t);v.colors=b(v.colors);v.stops=v.stops&&u.map(v.stops,function(w){w=G.mixin({},w);w.color&&(w.color=new d(w.color));return w});v.legendOptions&&(v.legendOptions=G.mixin({},v.legendOptions))}return v},cloneOpacityInfo:function(t){if(t){var v=
G.mixin({},t);if(t=v.opacityValues)v.opacityValues=t.slice(0);if(t=v.stops)v.stops=u.map(t,function(w){return G.mixin({},w)});if(t=v.legendOptions)v.legendOptions=G.mixin({},t)}return v},cloneSizeInfo:function(t){if(t){var v=G.mixin({},t);v.stops&&(v.stops=u.map(v.stops,function(w){return G.mixin({},w)}));(t=v.minSize)&&"object"===typeof t&&(v.minSize=g.cloneSizeInfo(t));(t=v.maxSize)&&"object"===typeof t&&(v.maxSize=g.cloneSizeInfo(t));if(t=v.legendOptions)if(v.legendOptions=G.mixin({},t),t=t.customValues)v.legendOptions.customValues=
t.slice(0)}return v},getClassCodesForRelationship:function(){return G.clone({2:["L","H"],3:["L","M","H"],4:["L","M1","M2","H"]})},getClassValuesForRelationship:function(){return G.clone({2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]})}});r("extend-esri")&&G.setObject("renderer.utils",g,m);return g})},"esri/dijit/Measurement":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/debounce dojo/sniff dojo/dom-style dojo/dom-construct dojox/gfx dijit/_Widget dijit/registry dijit/Menu dijit/MenuItem ../symbols/PictureMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/jsonUtils ../geometry/geodesicUtils ../geometry/webMercatorUtils ../geometry/Point ../geometry/Polyline ../geometry/Polygon ../graphic ../tasks/AreasAndLengthsParameters ../tasks/LengthsParameters ../tasks/GeometryService ../kernel ../config ../domUtils ../numberUtils ../lang ../units ../WKIDUnitConversion ../SpatialReference dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ./_EventedWidget dojo/text!./templates/Measurement.html dojo/i18n!../nls/jsapi dijit/form/ToggleButton dijit/form/DropDownButton dijit/layout/ContentPane".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z,E,J,D,L,C,N,S,F,T,y,B,I,P,X,Y,aa,Z,fa){u=u([aa,h,X,Y],{declaredClass:"esri.dijit.Measurement",widgetsInTemplate:!0,templateString:Z,_map:null,_geometryService:null,_interpolatedMap:null,_mouseImgURL:null,_defaultPinURL:null,_measureGraphics:[],_measureGraphic:null,_locationGraphic:null,_tempGraphic:null,_polylineGraphics:null,_polygonGraphic:null,_pointSymbol:null,_useDefaultPointSymbol:!0,_defaultLineSymbol:null,_lineSymbol:null,_areaLineSymbol:null,
_defaultFillSymbol:null,_fillSymbol:null,_borderlessFillSymbol:null,_defaultCustomPointSymbolHeight:25,_defaultCustomPointSymbolWidth:25,_userGeometry:null,_currentGeometry:null,_inputPoints:[],_unitDictionary:[],_densificationRatio:.07848050723825097,numberPattern:"#,###,###,##0.0",result:null,_defaultDistanceUnit:null,_defaultAreaUnit:null,_defaultLocationUnit:null,currentDistanceUnit:null,currentAreaUnit:null,currentLocationUnit:null,_unitStrings:{},_locationUnitStrings:[],_locationUnitStringsLong:[],
_distanceUnitStrings:[],_distanceUnitStringsLong:[],_areaUnitStrings:[],_areaUnitStringsLong:[],_calculatingMsg:null,_gsErrorMsg:null,_NLS_Lat:null,_NLS_Lon:null,_mouseMoveMapHandler:null,_mouseClickMapHandler:null,_doubleClickMapHandler:null,_mouseDragMapHandler:null,_clickMapHandler:null,_mapExtentChangeHandler:null,_geometryAreaHandler:null,_snappingCallback:null,_calcTimer:null,_buttonDijits:{},previousTool:null,activeTool:null,markerLongitude:null,markerLatitude:null,mouseLongitude:null,mouseLatitude:null,
_eventMap:{"measure-start":["toolName","unitName"],measure:["toolName","geometry","values","unitName","segmentLength"],"measure-end":["toolName","geometry","values","unitName"],"tool-change":["toolName","unitName","previousToolName"],"unit-change":["unitName","toolName"]},constructor:function(K,R){if(K&&K.map){this._map=K.map;if(this._map.loaded)this._map.cs=this._checkCS(this._map.spatialReference),this._interpolatedMap=!("Web Mercator"===this._map.cs||"PCS"===this._map.cs);else var U=m.connect(this._map,
"onLoad",this,function(){m.disconnect(U);U=null;this._map.cs=this._checkCS(this._map.spatialReference);this._interpolatedMap=!("Web Mercator"===this._map.cs||"PCS"===this._map.cs)});this._geometryService=S.defaults.geometryService;this._mouseImgURL=G.toUrl("./images/cursor16x24.png");this._defaultPinURL=G.toUrl("./images/esriGreenPin16x26.png");this._defaultLineSymbol=new t(t.STYLE_SOLID,new k([0,128,255]),3);this._defaultFillSymbol=new v(t.STYLE_SOLID,this._defaultLineSymbol,new k([0,0,0,.5]));K.pointSymbol?
(this._pointSymbol=K.pointSymbol,this._useDefaultPointSymbol=!1):(this._pointSymbol=new q(this._defaultPinURL,16,26),this._pointSymbol.setOffset(0,12));this._fillSymbol=R=K.fillSymbol||this._defaultFillSymbol;this._areaLineSymbol=R.outline||this._defaultLineSymbol;this._borderlessFillSymbol=w.fromJson(R.toJson());this._borderlessFillSymbol.setOutline(null);this._lineSymbol=K.lineSymbol?K.lineSymbol:this._defaultLineSymbol;this._defaultDistanceUnit=K.defaultLengthUnit?K.defaultLengthUnit:B.MILES;this._defaultAreaUnit=
K.defaultAreaUnit?K.defaultAreaUnit:B.ACRES;this._defaultLocationUnit=K.defaultLocationUnit?K.defaultLocationUnit:B.DECIMAL_DEGREES;this._snappingCallback=r.hitch(this,this._snappingCallback);K.geometry&&(this._userGeometry=K.geometry);this._calcTimer=null;this.advancedLocationUnits=K.advancedLocationUnits||!1;this._NLS_Lon=fa.widgets.measurement.NLS_longitude;this._NLS_Lat=fa.widgets.measurement.NLS_latitude;this._gsErrorMsg=fa.widgets.measurement.NLS_geometry_service_error;this._calculatingMsg=
fa.widgets.measurement.NLS_calculating;this._geometryServiceLength=d(this._geometryServiceLength,250)}else console.log("Unable to find the required 'map' property in widget parameters")},startup:function(){this._setupDictionaries();e.create("img",{src:this._mouseImgURL,style:"vertical-align: middle"},this.mouseCell);this._useDefaultPointSymbol?e.create("img",{src:this._defaultPinURL,style:"vertical-align: middle"},this.pinCell):this._drawPointGraphics(this.pinCell);if(this._userGeometry)if(this._map.loaded)this._measureCustomGeometry(this._userGeometry),
this._userGeometry=null;else var K=m.connect(this._map,"onLoad",this,function(){m.disconnect(K);K=null;this._measureCustomGeometry(this._userGeometry);this._userGeometry=null})},destroy:function(){this._resetToolState();this.clearResult();this.inherited(arguments);this._map=this._geometryService=this._measureGraphics=this._measureGraphic=this._tempGraphic=null},setTool:function(K,R){this.previousTool=this.activeTool||null;this._polylineGraphics=[];this._resetToolState();this._polygonGraphic&&(this._map.graphics.remove(this._polygonGraphic),
this._polygonGraphic=null);var U=c.byNode(this._buttonDijits[K].domNode).checked;b.set(this._unitDropDown.domNode,"visibility","visible");c.byNode(this._buttonDijits.area.domNode).set("checked",!1);c.byNode(this._buttonDijits.distance.domNode).set("checked",!1);c.byNode(this._buttonDijits.location.domNode).set("checked",!1);if(!0===R||!1===R)U=R;c.byNode(this._buttonDijits[K].domNode).set("checked",U);this._toggleLocationResultsTable(!1,!0);U?(this.activeTool=K,(this._dblClickZoom=this._map.isDoubleClickZoom)&&
this._map.disableDoubleClickZoom(),"area"===K?this._setupAreaTool():"distance"===K?this._setupDistanceTool():"location"===K&&this._setupLocationTool(),this._map.snappingManager&&(this._map.snappingManager._startSelectionLayerQuery(),this._map.snappingManager._setUpSnapping())):(this.activeTool=null,b.set(this._unitDropDown.domNode,"visibility","hidden"));if(this.activeTool!==this.previousTool)this.onToolChange(this.activeTool,this.getUnit(),this.previousTool)},measure:function(K){K&&this._measureCustomGeometry(K)},
clearResult:function(){var K=this._map,R;this.result=0;this.resultValue.setContent("\x26nbsp");for(R=0;R<this._measureGraphics.length;R++)K.graphics.remove(this._measureGraphics[R]);this._measureGraphic=this._locationGraphic=this._currentGeometry=null;this._measureGraphics=[];K.graphics.remove(this._tempGraphic);m.disconnect(this._mouseMoveMapHandler);this._mouseMoveMapHandler=null},show:function(){F.show(this.domNode)},hide:function(){F.hide(this.domNode)},showTool:function(K){b.set(this._buttonDijits[K].domNode,
"display","inline-block")},hideTool:function(K){b.set(this._buttonDijits[K].domNode,"display","none")},getTool:function(){if(this.activeTool)return{toolName:this.activeTool,unitName:this.getUnit()}},getUnit:function(){if("unit"!==this._unitDropDown.label)return this._unitDropDown.label},_setupLocationTool:function(){this._map.navigationManager.setImmediateClick(!0);this._measureGraphics=[];this._map.graphics.remove(this._locationGraphic);this._createLocationUnitList();"PCS"===this._map.cs&&(this._projectMapExtent(this._map.extent),
this._mapExtentChangeHandler=m.connect(this._map,"onExtentChange",r.hitch(this,this._projectMapExtent)));this._clickMapHandler=m.connect(this._map,"onClick",this,"_locationClickHandler");if("esriDegreeMinuteSeconds"===this.currentLocationUnit||"esriDecimalDegrees"===this.currentLocationUnit)this._mouseMoveMapHandler=m.connect(this._map,"onMouseMove",this,"_locationMoveHandler")},_locationButtonToggle:function(){this.clearResult();this.setTool("location")},_measureCustomPoint:function(K){this.setTool("location",
!0);"Web Mercator"===this._map.cs&&K.spatialReference!==this._map.spatialReference&&(K=H.geographicToWebMercator(K));this._measureGraphic=new J;this._measureGraphic.setSymbol(this._pointSymbol);this._measureGraphic.setGeometry(K);this._measureGraphics.push(this._measureGraphic);this._map.graphics.add(this._measureGraphic);this._currentGeometry=K;this._calculateLocation(K,!0)},_calculateLocation:function(K,R){var U=!("esriDegreeMinuteSeconds"===this.currentLocationUnit||"esriDecimalDegrees"===this.currentLocationUnit);
U&&this._mouseMoveMapHandler&&(m.disconnect(this._mouseMoveMapHandler),this._mouseMoveMapHandler=null);K=r.clone(K);if(R){if("Web Mercator"!==this.map.cs&&this.map.spatialReference&&4326!==this.map.spatialReference.wkid){this._projectLocation(K,U);return}this._updateMarkerLocation(K.x,K.y)}K=this._getGCSLocation(K);this._advancedLocationDisplayHandler(K,U,R)},_projectLocation:function(K,R){this._geometryService.project([K],new P({wkid:4326}),r.hitch(this,function(U){this._advancedLocationDisplayHandler(U[0],
R,!0)}),r.hitch(this,function(U){console.log(this._gsErrorMsg,U)}))},_advancedLocationDisplayHandler:function(K,R,U){R?this._updateGeocoordinateStringLocation({coordinates:[[K.x,K.y]],sr:{wkid:4326},conversionType:this._unitStrings[this.currentLocationUnit]},K):(R=this._calculateXY(K.x,K.y),U?(this._updateClickLocation(R[0],R[1]),this.onMeasureEnd(this.activeTool,K,[R[0],R[1]],this.getUnit())):this._updateMouseLocation(R[0],R[1]))},_updateMarkerLocation:function(K,R){this.markerLocationX=K;this.markerLocationY=
R},_updateMouseLocation:function(K,R){this.mouseLongitude.innerHTML=K;this.mouseLatitude.innerHTML=R},_updateClickLocation:function(K,R){this._updateMouseLocation(K,R);this.markerLongitude.innerHTML=K;this.markerLatitude.innerHTML=R},_updateGeocoordinateStringLocation:function(K,R){this.resultValue.setContent("\x26nbsp");this._geometryService.toGeoCoordinateString(K,r.hitch(this,function(U){clearTimeout(this._calcTimer);U?(this.resultValue.setContent(U[0]),this.onMeasureEnd(this.activeTool,R,U,this.getUnit())):
(this.resultValue.setContent(this._gsErrorMsg),this.onMeasureEnd(this.activeTool,null,null,this.getUnit()))}));clearTimeout(this._calcTimer);this._calcTimer=setTimeout(r.hitch(this,function(){this.resultValue.setContent(this._calculatingMsg)},1E3))},_switchLocationUnit:function(K){c.byNode(this._unitDropDown.domNode).set("label",this._unitStrings[K]);this.currentLocationUnit=K;m.disconnect(this._mouseMoveMapHandler);this._mouseMoveMapHandler=null;this.onUnitChange(this._unitStrings[K],this.activeTool);
if("esriDegreeMinuteSeconds"===K||"esriDecimalDegrees"===K)this._mouseMoveMapHandler=m.connect(this._map,"onMouseMove",this,"_locationMoveHandler"),this._toggleLocationResultsTable(!0,!1),this._locationGraphic&&this._calculateLocation(this._locationGraphic.geometry,!0);else if(this._toggleLocationResultsTable(!1,!1),null!==this.resultValue&&(null!==this.markerLocationX||null!==this.markerLocationY)&&this._locationGraphic){var R=this._getGCSLocation(this._locationGraphic.geometry);this._updateGeocoordinateStringLocation({coordinates:[[R.x,
R.y]],sr:{wkid:4326},conversionType:this._unitStrings[K]},this._locationGraphic.geometry)}},_toggleLocationResultsTable:function(K,R){R&&(this.resultValue.setContent("\x26nbsp"),this.markerLongitude.innerHTML="---",this.markerLatitude.innerHTML="---",this.mouseLongitude.innerHTML="---",this.mouseLatitude.innerHTML="---");K?(F.show(this.resultTable.domNode),F.hide(this.resultValueContainer.domNode)):(F.hide(this.resultTable.domNode),F.show(this.resultValueContainer.domNode),m.disconnect(this._mouseMoveMapHandler));
"PCS"===this._map.cs&&F.hide(this._mouseRow)},_setupDistanceTool:function(){this._map.navigationManager.setImmediateClick(!0);"PCS"===this._map.cs&&(this._projectMapExtent(this._map.extent),this._mapExtentChangeHandler=m.connect(this._map,"onExtentChange",this,"_projectMapExtent"));this._inputPoints=[];this._createDistanceUnitList();this._mouseClickMapHandler=m.connect(this._map,"onClick",this,"_measureDistanceMouseClickHandler");this._doubleClickMapHandler=m.connect(this._map,"onDblClick",this,"_measureDistanceDblClickHandler")},
_distanceButtonToggle:function(){this.clearResult();this.setTool("distance")},_measureCustomDistance:function(K){if(1<K.paths[0].length){this.setTool("distance",!0);this._inputPoints=[];n.forEach(K.paths[0],r.hitch(this,function(U,ba){this._inputPoints.push(U);var Q=new J(new A(U[0],U[1],K.spatialReference),this._pointSymbol);this._measureGraphics.push(Q);this._map.graphics.add(Q);0!==ba&&(this.result+=this._geodesicDistance(U,K.paths[0][ba-1]))}));this._measureGraphic=new J;this._measureGraphic.setSymbol(this._lineSymbol);
this._measureGraphics.push(this._measureGraphic);var R=this._densifyGeometry(K);this._measureGraphic.setGeometry(R);this._map.graphics.add(this._measureGraphic);this._inputPoints=[];R=this._outputResult(this.result,this.getUnit());this._currentGeometry=K;this.onMeasureEnd(this.activeTool,K,R,this.getUnit())}},_showDistance:function(K){K&&this._outputResult(K,c.byNode(this._unitDropDown.domNode).label)},_setupAreaTool:function(){this._map.navigationManager.setImmediateClick(!0);this._inputPoints=[];
this._createAreaUnitList();this._tempGraphic=new J;this._tempGraphic._isSnapTarget=!1;this._tempGraphic.setSymbol(this._areaLineSymbol);this._tempGraphic.setGeometry(new z(this._map.spatialReference));this._map.graphics.add(this._tempGraphic);"PCS"===this._map.cs&&(this._geometryAreaHandler=m.connect(this._geometryService,"onAreasAndLengthsComplete",this,"_outputArea"));this._mouseClickMapHandler=m.connect(this._map,"onClick",this,"_measureAreaMouseClickHandler");this._doubleClickMapHandler=m.connect(this._map,
"onDblClick",this,"_measureAreaDblClickHandler")},_areaButtonToggle:function(){this.clearResult();this.setTool("area")},_generatePolygonFromPaths:function(){var K=[];n.forEach(this._polylineGraphics,r.hitch(this,function(ba){n.forEach(ba.geometry.paths,r.hitch(this,function(Q){n.forEach(Q,r.hitch(this,function(ea){K.push(ea)}))}))}));K.push(K[0]);var R=new E(this._map.spatialReference);R.addRing(K);R=this._densifyGeometry(R);var U=new J;U.setGeometry(R);U.setSymbol(this._borderlessFillSymbol);this._measureGraphic=
U;this._measureGraphics.push(U);return U},_getArea:function(K){var R=[],U=new D;U.areaUnit=C.UNIT_SQUARE_METERS;U.calculationType="geodesic";E.prototype.isSelfIntersecting(K)?this._geometryService.simplify([K],r.hitch(this,function(ba){n.forEach(ba,r.hitch(this,function(ea){"PCS"===this._map.cs?(U.polygons=ba,this._geometryService.areasAndLengths(U)):("Web Mercator"===this._map.cs&&(ea=H.webMercatorToGeographic(ea)),R.push(ea))}));var Q=x.geodesicAreas(R,B.SQUARE_METERS);this._showArea(Q[0])})):("Web Mercator"===
this._map.cs&&(K=H.webMercatorToGeographic(K)),R.push(K),"PCS"===this._map.cs?(U.polygons=R,this._geometryService.areasAndLengths(U)):(K=x.geodesicAreas(R,B.SQUARE_METERS),this._showArea(Math.abs(K[0]))))},_outputArea:function(K){this._showArea(Math.abs(K.areas[0]))},_showArea:function(K){if(K)if(this.result=K,K=c.byNode(this._unitDropDown.domNode).label,K=this._outputResult(this.result,K),this._mouseMoveMapHandler)this.onMeasure(this.activeTool,this._currentGeometry,K,this.getUnit(),null);else this.onMeasureEnd(this.activeTool,
this._currentGeometry,K,this.getUnit())},_measureCustomArea:function(K){this.setTool("area",!0);this._inputPoints=[];var R=this._densifyGeometry(K);this._currentGeometry=K;this._measureGraphic=new J;this._measureGraphic.setGeometry(R);this._measureGraphic.setSymbol(this._fillSymbol);this._measureGraphics.push(this._measureGraphic);this._map.graphics.add(this._measureGraphic);this._getArea(K);this._inputPoints=[]},_resetToolState:function(){var K=this._map;K.navigationManager.setImmediateClick(!1);
this._dblClickZoom&&K.enableDoubleClickZoom();this._inputPoints=[];m.disconnect(this._mouseClickMapHandler);m.disconnect(this._mouseMoveMapHandler);m.disconnect(this._doubleClickMapHandler);m.disconnect(this._mouseDragMapHandler);m.disconnect(this._clickMapHandler);m.disconnect(this._mapExtentChangeHandler);m.disconnect(this._geometryAreaHandler);this._mouseClickMapHandler=this._mouseMoveMapHandler=this._doubleClickMapHandler=this._mouseDragMapHandler=this._clickMapHandler=this._mapExtentChangeHandler=
this._geometryAreaHandler=null;K.snappingManager&&K.snappingManager._snappingGraphic&&K.graphics.remove(K.snappingManager._snappingGraphic);this._map.snappingManager&&(this._map.snappingManager._stopSelectionLayerQuery(),this._map.snappingManager._killOffSnapping());this._unitDropDown._opened&&this._unitDropDown.closeDropDown()},_measureCustomGeometry:function(K){this.clearResult();switch(K.type){case "point":this._measureCustomPoint(K);break;case "polyline":this._measureCustomDistance(K);break;case "polygon":this._measureCustomArea(K)}},
_densifyGeometry:function(K){var R=this._map.cs,U=x.getSpheroidInfo(K.spatialReference).radius*this._densificationRatio;"Web Mercator"===R?(K=H.webMercatorToGeographic(K),U=x.geodesicDensify(K,U),U=H.geographicToWebMercator(U)):U="PCS"===R?K:x.geodesicDensify(K,U);return U},_geodesicDistance:function(K,R){var U=new z(this._map.spatialReference);"PCS"===this._map.cs&&(K=this._getGCSLocation(K),R=this._getGCSLocation(R));U.addPath([K,R]);"Web Mercator"===this._map.cs&&(U=H.webMercatorToGeographic(U));
return x.geodesicLengths([U],B.METERS)[0]},_calculateXY:function(K,R){var U=fa.widgets.measurement,ba=this._map.getScale();if(this.getUnit()===U.NLS_decimal_degrees){var Q=500<=ba?6:500>ba&&50<=ba?7:50>ba&&5<=ba?8:9;var ea=K.toFixed(Q);this._map.spatialReference._isWrappable()||(ea=this._roundX(ea));ea=T.format(ea);Q=T.format(this._roundY(R.toFixed(Q)))}else if(this.getUnit()===U.NLS_deg_min_sec){var la=U=!1;Q=9E4<=ba?0:9E4>ba&&9E3<=ba?1:9E3>ba&&900<=ba?2:900>ba&&90<ba?3:4;0>K&&(U=!0,K=Math.abs(K));
0>R&&(la=!0,R=Math.abs(R));R=this._roundY(R);this._map.spatialReference._isWrappable()||(K=this._roundX(K));var ma=Math.floor(R)+"\u00b0";ea=Math.floor(K)+"\u00b0";var M=Math.floor(this._getDegreeMinutes(R))+"'";ba=Math.floor(this._getDegreeMinutes(K))+"'";R=T.format(this._getDegreeSeconds(R).toFixed(Q))+'"';K=T.format(this._getDegreeSeconds(K).toFixed(Q))+'"';Q=ma+M+R;ea=ea+ba+K;U&&(ea="-"+ea);la&&(Q="-"+Q)}return[ea,Q]},_getDegreeMinutes:function(K){return 60*(K-Math.floor(K))},_getDegreeSeconds:function(K){return 60*
(60*(K-Math.floor(K))-Math.floor(60*(K-Math.floor(K))))},_roundY:function(K){90<K?K=90:-90>K&&(K=-90);return K},_roundX:function(K){180<K?K=180:-180>K&&(K=-180);return K},_getGCSLocation:function(K){K=r.clone(K);var R=this._map,U=R.extent,ba=R._newExtent;"Web Mercator"===R.cs?K=H.webMercatorToGeographic(K):"PCS"===R.cs?ba&&(K=new A((K.x-U.xmin)*Math.abs((ba.xmax-ba.xmin)/(U.xmax-U.xmin))+ba.xmin,(K.y-U.ymin)*Math.abs((ba.ymax-ba.ymin)/(U.ymax-U.ymin))+ba.ymin,R.spatialReference)):K=K.normalize();
return K},_projectMapExtent:function(K){K=new J(K);var R=new P({wkid:4326});this._geometryService.project([K.geometry],R,r.hitch(this,function(U){if(!this._mouseMoveMapHandler&&"location"===this.activeTool){if("esriDegreeMinuteSeconds"===this.currentLocationUnit||"esriDecimalDegrees"===this.currentLocationUnit)this._mouseMoveMapHandler=m.connect(this._map,"onMouseMove",r.hitch(this,this._locationMoveHandler));this._mouseMoveMapHandler=m.connect(this._map,"onMouseMove",r.hitch(this,this._locationMoveHandler))}this._map._newExtent=
U[0]}))},_checkCS:function(K){if(K.wkid)return 3857===K.wkid||102100===K.wkid||102113===K.wkid?"Web Mercator":y.isDefined(I[K.wkid])?"PCS":"GCS";if(K.wkt)return-1!==K.wkt.indexOf("WGS_1984_Web_Mercator")?"Web Mercator":0===K.wkt.indexOf("PROJCS")?"PCS":"GCS"},_switchUnit:function(K){"distance"===this.activeTool?this.currentDistanceUnit=K:"area"===this.activeTool?this.currentAreaUnit=K:"location"===this.activeTool&&(this.currentLocationUnit=K);c.byNode(this._unitDropDown.domNode).set("label",this._unitStrings[K]);
if(null!==this.result){var R=this._outputResult(this.result,this._unitStrings[K]);this.onUnitChange(this._unitStrings[K],this.activeTool);if(null!==this._currentGeometry||null!==this._measureGraphic)if(K=this._currentGeometry||this._measureGraphic.geometry,this._mouseMoveMapHandler)this.onMeasure(this.activeTool,K,R,this.getUnit(),null);else this.onMeasureEnd(this.activeTool,K,R,this.getUnit())}},_setupDictionaries:function(){var K=fa.widgets.measurement;this._unitDictionary[K.NLS_length_meters]=
1;this._unitDictionary[K.NLS_length_kilometers]=1E3;this._unitDictionary[K.NLS_length_feet]=.3048;this._unitDictionary[K.NLS_length_miles]=1609.344;this._unitDictionary[K.NLS_length_yards]=.9144;this._unitDictionary[K.NLS_length_nautical_miles]=1852;this._unitDictionary[K.NLS_length_miles_us]=1609.347218694438;this._unitDictionary[K.NLS_length_feet_us]=.3048006096012192;this._unitDictionary[K.NLS_length_yards_us]=.9144018288036576;this._unitDictionary[K.NLS_area_sq_meters]=1;this._unitDictionary[K.NLS_area_sq_kilometers]=
1E6;this._unitDictionary[K.NLS_area_sq_feet]=.09290304;this._unitDictionary[K.NLS_area_acres]=4046.8564224;this._unitDictionary[K.NLS_area_sq_miles]=2589988.110336;this._unitDictionary[K.NLS_area_hectares]=1E4;this._unitDictionary[K.NLS_area_sq_yards]=.83612736;this._unitDictionary[K.NLS_area_acres_us]=4046.872609874252;this._unitDictionary[K.NLS_area_sq_miles_us]=2589998.470319522;this._unitDictionary[K.NLS_area_sq_feet_us]=.09290341161327487;this._unitDictionary[K.NLS_area_sq_yards_us]=.8361307045194736;
this._unitStrings={esriMiles:K.NLS_length_miles,esriKilometers:K.NLS_length_kilometers,esriFeet:K.NLS_length_feet,esriFeetUS:K.NLS_length_feet_us,esriMeters:K.NLS_length_meters,esriYards:K.NLS_length_yards,esriNauticalMiles:K.NLS_length_nautical_miles,esriMilesUS:K.NLS_length_miles_us,esriYardsUS:K.NLS_length_yards_us,esriAcres:K.NLS_area_acres,esriSquareMiles:K.NLS_area_sq_miles,esriSquareKilometers:K.NLS_area_sq_kilometers,esriHectares:K.NLS_area_hectares,esriSquareYards:K.NLS_area_sq_yards,esriSquareFeet:K.NLS_area_sq_feet,
esriSquareFeetUS:K.NLS_area_sq_feet_us,esriSquareMeters:K.NLS_area_sq_meters,esriAcresUS:K.NLS_area_acres_us,esriSquareMilesUS:K.NLS_area_sq_miles_us,esriSquareYardsUS:K.NLS_area_sq_yards_us,esriDecimalDegrees:K.NLS_decimal_degrees,esriDegreeMinuteSeconds:K.NLS_deg_min_sec,esriMGRS:K.NLS_MGRS,esriUSNG:K.NLS_USNG,esriUTM:K.NLS_UTM,esriGARS:K.NLS_GARS,esriGeoRef:K.NLS_GeoRef,esriDDM:K.NLS_DDM,esriDD:K.NLS_DD};this._locationUnitStrings=[K.NLS_decimal_degrees,K.NLS_deg_min_sec,K.NLS_MGRS,K.NLS_USNG,K.NLS_UTM,
K.NLS_GeoRef,K.NLS_GARS];this._locationUnitStringsLong="esriDecimalDegrees esriDegreeMinuteSeconds esriMGRS esriUSNG esriUTM esriGeoRef esriGARS".split(" ");this._distanceUnitStrings=[K.NLS_length_miles,K.NLS_length_kilometers,K.NLS_length_feet,K.NLS_length_feet_us,K.NLS_length_meters,K.NLS_length_yards,K.NLS_length_nautical_miles];this._distanceUnitStringsLong="esriMiles esriKilometers esriFeet esriFeetUS esriMeters esriYards esriNauticalMiles".split(" ");this._areaUnitStrings=[K.NLS_area_acres,
K.NLS_area_sq_miles,K.NLS_area_sq_kilometers,K.NLS_area_hectares,K.NLS_area_sq_yards,K.NLS_area_sq_feet,K.NLS_area_sq_feet_us,K.NLS_area_sq_meters];this._areaUnitStringsLong="esriAcres esriSquareMiles esriSquareKilometers esriHectares esriSquareYards esriSquareFeet esriSquareFeetUS esriSquareMeters".split(" ");this._buttonDijits={area:this._areaButton,distance:this._distanceButton,location:this._locationButton};c.byNode(this._distanceButton.domNode).setLabel(K.NLS_distance);c.byNode(this._areaButton.domNode).setLabel(K.NLS_area);
c.byNode(this._locationButton.domNode).setLabel(K.NLS_location);c.byNode(this.resultLabel.domNode).setContent(K.NLS_resultLabel)},onToolChange:function(){},onUnitChange:function(){},onMeasureStart:function(){},onMeasure:function(){},onMeasureEnd:function(){},_measureAreaMouseClickHandler:function(K){if(this._map.snappingManager)var R=this._map.snappingManager._snappingPoint;R=R||K.mapPoint;this._inputPoints.push(R);this._currentStartPt=R;if(1===this._inputPoints.length){this._tempGraphic.setGeometry(new z(this._map.spatialReference));
for(K=0;K<this._measureGraphics.length;K++)this._map.graphics.remove(this._measureGraphics[K]);this._measureGraphics=[];this.result=0;this._outputResult(this.result,fa.widgets.measurement.NLS_area_sq_meters);this._mouseMoveMapHandler=m.connect(this._map,"onMouseMove",this,"_measureAreaMouseMoveHandler");this.onMeasureStart(this.activeTool,this.getUnit())}this._measureGraphic=new J;this._measureGraphic.setSymbol(this._areaLineSymbol);this._measureGraphics.push(this._measureGraphic);if(1<this._inputPoints.length){K=
new z(this._map.spatialReference);K.addPath([this._inputPoints[this._inputPoints.length-2],R]);var U=new z(this._map.spatialReference);U.addPath([this._inputPoints[0],R]);R=this._densifyGeometry(K);U=this._densifyGeometry(U);this._tempGraphic.setGeometry(U);this._measureGraphic.setGeometry(R);this._map.graphics.add(this._measureGraphic);R=new J;R.setGeometry(K);this._polylineGraphics.push(R);if(2<this._inputPoints.length){R=new E(this._map.spatialReference);U=[];for(K=0;K<this._inputPoints.length;K++)U.push([this._inputPoints[K].x,
this._inputPoints[K].y]);U.push([this._inputPoints[0].x,this._inputPoints[0].y]);R.addRing(U);this._currentGeometry=R;this._polygonGraphic?(this._map.graphics.remove(this._polygonGraphic),this._polylineGraphics.push(this._tempGraphic),this._polygonGraphic=this._generatePolygonFromPaths(),this._map.graphics.add(this._polygonGraphic),this._measureGraphic=this._polygonGraphic,this._polylineGraphics.pop()):(this._polygonGraphic=this._generatePolygonFromPaths(),this._map.graphics.add(this._polygonGraphic));
this._getArea(R)}}else this._polygonGraphic&&(this._map.graphics.remove(this._polygonGraphic),this._polygonGraphic=null)},_measureAreaMouseMoveHandler:function(K){if(0<this._inputPoints.length){var R=new z(this._map.spatialReference);if(this._map.snappingManager)var U=this._map.snappingManager._snappingPoint;var ba=U||K.mapPoint;R.addPath([this._currentStartPt,ba]);K=this._densifyGeometry(R);this._tempGraphic.setGeometry(K)}1<this._inputPoints.length&&(K=new z(this._map.spatialReference),K.addPath([ba,
this._inputPoints[0]]),ba=this._densifyGeometry(K),this._tempGraphic.setGeometry(this._tempGraphic.geometry.addPath(ba.paths[0])))},_measureAreaDblClickHandler:function(K){m.disconnect(this._mouseMoveMapHandler);this._mouseMoveMapHandler=null;"touch"===this._map.navigationManager.eventModel&&a("ios")&&this._measureAreaMouseClickHandler(K);K=new E(this._map.spatialReference);var R=[],U;for(U=0;U<this._inputPoints.length;U++)R.push([this._inputPoints[U].x,this._inputPoints[U].y]);R.push([this._inputPoints[0].x,
this._inputPoints[0].y]);K.addRing(R);this._inputPoints=[];this._currentGeometry=K;this._polygonGraphic&&(this._map.graphics.remove(this._polygonGraphic),this._polylineGraphics.push(this._tempGraphic),this._polygonGraphic=this._generatePolygonFromPaths(),this._map.graphics.add(this._polygonGraphic));this._getArea(K);this._polylineGraphics=[]},_measureDistanceMouseClickHandler:function(K){if(this._map.snappingManager)var R=this._map.snappingManager._snappingPoint;K=R||K.mapPoint;this._inputPoints.push(K);
this._currentStartPt=K;if(1===this._inputPoints.length){for(R=0;R<this._measureGraphics.length;R++)this._map.graphics.remove(this._measureGraphics[R]);this._map.graphics.remove(this._tempGraphic);this._measureGraphics=[];this.result=0;this._outputResult(this.result,fa.widgets.measurement.NLS_length_meters);this._tempGraphic=new J;this._tempGraphic._isSnapTarget=!1;this._tempGraphic.setSymbol(this._lineSymbol);this._map.graphics.add(this._tempGraphic);this._mouseMoveMapHandler=m.connect(this._map,
"onMouseMove",this,"_measureDistanceMouseMoveHandler");this.onMeasureStart(this.activeTool,this.getUnit())}this._tempGraphic.setGeometry(new z(this._map.spatialReference));R=new J;R.setSymbol(this._pointSymbol);R.setGeometry(K);this._measureGraphics.push(R);this._map.graphics.add(R);if(1<this._inputPoints.length){this._measureGraphic=new J;this._measureGraphic.setSymbol(this._lineSymbol);this._measureGraphics.push(this._measureGraphic);R=new z(this._map.spatialReference);R.addPath([this._inputPoints[this._inputPoints.length-
2],K]);var U=this._densifyGeometry(R);this._measureGraphic.setGeometry(U);this._map.graphics.add(this._measureGraphic);"PCS"===this._map.cs?this._geometryServiceLength(R,!1):(U=this._geodesicDistance(this._inputPoints[this._inputPoints.length-2],K),R=this._outputResult(U,this.getUnit()),this.result+=U,this._showDistance(this.result),U=this._outputResult(this.result,this.getUnit()),this.onMeasure(this.activeTool,K,U,this.getUnit(),R))}else R.setSymbol(this._pointSymbol)},_measureDistanceMouseMoveHandler:function(K){if(0<
this._inputPoints.length){var R=new z(this._map.spatialReference);if(this._map.snappingManager)var U=this._map.snappingManager._snappingPoint;K=U||K.mapPoint;R.addPath([this._currentStartPt,K]);R=this._densifyGeometry(R);this._tempGraphic.setGeometry(R);"PCS"!==this._map.cs&&(U=this._geodesicDistance(this._currentStartPt,K),R=this._outputResult(U,this.getUnit()),U+=this.result,this._showDistance(U),U=this._outputResult(U,this.getUnit()),this.onMeasure(this.activeTool,K,U,this.getUnit(),R))}},_measureDistanceDblClickHandler:function(K){m.disconnect(this._mouseMoveMapHandler);
this._mouseMoveMapHandler=null;"touch"===this._map.navigationManager.eventModel&&a("ios")&&this._measureDistanceMouseClickHandler(K);K=new z(this._map.spatialReference);K.addPath(this._inputPoints);this._currentGeometry=K;var R=this._densifyGeometry(K);this._measureGraphic.geometry=R;"PCS"===this._map.cs?this._geometryServiceLength(K,!0):(this._inputPoints=[],this.onMeasureEnd(this.activeTool,K,this._outputResult(this.result,this.getUnit()),this.getUnit()))},_geometryServiceLength:function(K,R){var U=
new L;U.polylines=[K];U.lengthUnit=9001;U.calculationType="geodesic";this._geometryService.lengths(U,r.hitch(this,function(ba){ba=ba.lengths[0];if(R)this.result=ba,this._showDistance(this.result),this._inputPoints=[],this.onMeasureEnd(this.activeTool,K,this._outputResult(this.result,this.getUnit()),this.getUnit());else{var Q=this._outputResult(ba,this.getUnit());this.result+=ba;this._showDistance(this.result);this.onMeasure(this.activeTool,K,this._outputResult(this.result,this.getUnit()),this.getUnit(),
Q)}}))},_locationClickHandler:function(K){if(this._map.snappingManager)var R=this._map.snappingManager._snappingPoint;K=R||K.mapPoint;this._locationButtonToggle();this._locationGraphic=new J;this._locationGraphic.setGeometry(K);this._locationGraphic.setSymbol(this._pointSymbol);this._map.graphics.add(this._locationGraphic);this._measureGraphics.push(this._locationGraphic);this._calculateLocation(K,!0)},_locationMoveHandler:function(K){if(this._map.snappingManager)var R=this._map.snappingManager._snappingPoint;
this._calculateLocation(R||K.mapPoint,!1)},_outputResult:function(K,R){K/=this._unitDictionary[R];0===K?this.resultValue.setContent("\x26nbsp"):1E6<K?this.resultValue.setContent(T.format(K.toPrecision(9),{pattern:this.numberPattern})+" "+R):10>K?this.resultValue.setContent(T.format(K.toFixed(2),{pattern:this.numberPattern+"0"})+" "+R):this.resultValue.setContent(T.format(K.toFixed(2),{pattern:this.numberPattern})+" "+R);return K},_createDistanceUnitList:function(){var K=new f({style:"display: none;"});
n.forEach(this._distanceUnitStrings,r.hitch(this,function(U,ba){U=new l({label:U,onClick:r.hitch(this,function(){this._switchUnit(this._distanceUnitStringsLong[ba])})});U.set("class","unitDropDown");K.addChild(U)}));c.byNode(this._unitDropDown.domNode).set("dropDown",K);if(this.currentDistanceUnit){var R=this._unitStrings[this.currentDistanceUnit];c.byNode(this._unitDropDown.domNode).set("label",R)}else R=this._unitStrings[this._defaultDistanceUnit],c.byNode(this._unitDropDown.domNode).set("label",
R),this.currentDistanceUnit=this._defaultDistanceUnit},_createAreaUnitList:function(){var K=new f({style:"display: none;"});n.forEach(this._areaUnitStrings,r.hitch(this,function(U,ba){U=new l({label:U,onClick:r.hitch(this,function(){this._switchUnit(this._areaUnitStringsLong[ba])})});U.set("class","unitDropDown");K.addChild(U)}));c.byNode(this._unitDropDown.domNode).set("dropDown",K);if(this.currentAreaUnit){var R=this._unitStrings[this.currentAreaUnit];c.byNode(this._unitDropDown.domNode).set("label",
R)}else R=this._unitStrings[this._defaultAreaUnit],c.byNode(this._unitDropDown.domNode).set("label",R),this.currentAreaUnit=this._defaultAreaUnit},_createLocationUnitList:function(){var K=this._locationUnitStrings;var R=new f({style:"display: none;"});if(null===this._geometryService||!1===this.advancedLocationUnits)K=K.slice(0,2);n.forEach(K,r.hitch(this,function(U,ba){U=new l({label:U,onClick:r.hitch(this,function(){this._switchLocationUnit(this._locationUnitStringsLong[ba])})});U.set("class","unitDropDown");
R.addChild(U)}));c.byNode(this._unitDropDown.domNode).set("dropDown",R);this.currentLocationUnit||(this.currentLocationUnit=this._defaultLocationUnit);K=this._unitStrings[this.currentLocationUnit];c.byNode(this._unitDropDown.domNode).set("label",K);"esriDegreeMinuteSeconds"!==this.currentLocationUnit&&"esriDecimalDegrees"!==this.currentLocationUnit||this._toggleLocationResultsTable(!0,!1)},_drawPointGraphics:function(K){var R=this._pointSymbol,U=this._defaultCustomPointSymbolWidth,ba=this._defaultCustomPointSymbolHeight;
K=e.create("div",{"class":"esriLocationResultSymbol"},K);K=g.createSurface(K,U,ba);if(9>a("ie")){var Q=K.getEventSource();b.set(Q,"position","relative");b.set(Q.parentNode,"position","relative")}R=R.getShapeDescriptors();try{var ea=K.createShape(R.defaultShape).setFill(R.fill).setStroke(R.stroke)}catch(M){K.clear();K.destroy();return}var la=ea.getBoundingBox();R=la.width;Q=la.height;var ma=-(la.x+R/2);la=-(la.y+Q/2);K=K.getDimensions();K={dx:ma+K.width/2,dy:la+K.height/2};if(R>U||Q>ba)ma=R/U>Q/ba,
U=((ma?U:ba)-5)/(ma?R:Q),r.mixin(K,{xx:U,yy:U});ea.applyTransform(K)}});a("extend-esri")&&r.setObject("dijit.Measurement",u,N);return u})},"esri/dijit/NavigationBar":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct ./_TouchBase ../kernel".split(" "),function(G,u,r,n,m,k,d,a,b,e,g,h){G=G(null,{declaredClass:"esri.dijit.NavigationBar",_items:[],constructor:function(c,f){this.container=
a.byId(f);this._touchBase=g(this.container,null);this._slideDiv=e.create("div",{},this.container,"first");this.events=[r.connect(this._touchBase,"onclick",this,this._onClickHandler)];this._items=c.items;b.add(this.container,"esriMobileNavigationBar");f=e.create("div",{},this._slideDiv);for(c=0;c<this._items.length;c++){switch(this._items[c].type){case "img":var l=e.create("div",{"class":"esriMobileNavigationItem"},f);var q=e.create("img",{src:this._items[c].src.toString(),style:{width:"100%",height:"100%"}},
l);break;case "span":l=e.create("div",{"class":"esriMobileNavigationItem"},f);q=e.create("span",{innerHTML:this._items[c].text},l);break;case "div":l=e.create("div",{"class":"esriMobileNavigationInfoPanel"},f),q=e.create("div",{innerHTML:this._items[c].text},l)}b.add(l,this._items[c].position);this._items[c].className&&b.add(q,this._items[c].className);q._index=c;q._item=this._items[c];this._items[c]._node=q}},startup:function(){this.onCreate(this._items)},destroy:function(){n.forEach(this.events,
r.disconnect);this._touchBase=null;m.query("img",this.container).forEach(function(c){c._index=null;c._item=null;e.destroy(c);c=null});this._items=null;e.destroy(this._slideDiv);e.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},select:function(c){this._markSelected(c._node,c)},onSelect:function(c){},onUnSelect:function(c){},onCreate:function(c){},_onClickHandler:function(c){if("img"===c.target.tagName.toLowerCase()){var f=c.target,l=f._item;m.query("img",
this.container).forEach(function(q){q!==f&&q._item.toggleGroup===l.toggleGroup&&this._markUnSelected(q,q._item)},this);this._toggleNode(f,l)}},_toggleNode:function(c,f){"ON"===f.toggleState?(f.toggleState="OFF",f.src&&(c.src=f.src.toString()),this.onUnSelect(f)):(f.toggleState="ON",f.srcAlt&&(c.src=f.srcAlt),this.onSelect(f))},_markSelected:function(c,f){f.toggleState="ON";f.srcAlt&&(c.src=f.srcAlt);this.onSelect(f)},_markUnSelected:function(c,f){"ON"===f.toggleState&&(f.toggleState="OFF",f.src&&
(c.src=f.src.toString()),this.onUnSelect(f))}});k("extend-esri")&&u.setObject("dijit.NavigationBar",G,h);return G})},"esri/dijit/OverviewMap":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/html dojo/has dojo/dom-class dojo/dom-style dojo/dnd/Moveable dijit/_Widget dijit/_Templated ../map ../geometry/Point ../geometry/ScreenPoint ../layers/TiledMapServiceLayer ../layers/DynamicMapServiceLayer ../layers/VectorTileLayer ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/ArcGISImageServiceLayer ../layers/RasterXLayer ../layers/OpenStreetMapLayer ../virtualearth/VETiledLayer ../kernel ../config ../domUtils dojo/text!./templates/OverviewMap.html dojo/i18n!../nls/jsapi".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z,E,J,D,L){G=G([b,e],{declaredClass:"esri.dijit.OverviewMap",widgetsInTemplate:!0,templateString:D,constructor:function(C,N){u.mixin(this,L.widgets.overviewMap);C=C||{};if(C.map){var S={};N&&(this._detached=!0,S=n.coords(N,!0));this.map=C.map;this.baseLayer=C.baseLayer;this.width=C.width||S.w||this.map.width/4;this.height=C.height||S.h||this.map.height/4;this.attachTo=C.attachTo||"top-right";this.expandFactor=C.expandFactor||2;this.color=C.color||
"#000000";this.opacity=C.opacity||.5;this.maximizeButton=!!C.maximizeButton;this.visible=!!C.visible;if(this.map.loaded)this._initialSetup();else var F=r.connect(this.map,"onLoad",this,function(){r.disconnect(F);F=null;this._initialSetup()});this._detached&&(this.visible=!0);this._maximized=!1}else console.error("esri.dijit.OverviewMap: "+this.NLS_noMap)},startup:function(){this.inherited(arguments);(!this.domNode.parentNode||9>m("ie")&&"DIV"!==this.domNode.parentNode.nodeName)&&this.map.container.appendChild(this.domNode);
this._detached?(d.set(this._body,"display","block"),d.set(this._controllerDiv,"display","none"),d.set(this._maximizerDiv,"display","none"),this.map.loaded?this._initialize():r.connect(this.map,"onLoad",this,this._initialize)):("bottom"===this.attachTo.split("-")[0]&&this.domNode.insertBefore(this._maximizerDiv,this._controllerDiv),this.maximizeButton||k.add(this._maximizerDiv,"ovwDisabledButton"),k.add(this.domNode,{"top-left":"ovwTL","top-right":"ovwTR","bottom-left":"ovwBL","bottom-right":"ovwBR"}[this.attachTo]),
k.add(this._controllerDiv,"ovwShow"),k.add(this._maximizerDiv,"ovwMaximize"),this.visible&&this.map.loaded&&(this.visible=!1,this.show()));d.set(this._focusDiv,"opacity",this.opacity)},destroy:function(){this._deactivate();this.overviewMap&&this.overviewMap.destroy();this.overviewMap=this.baseLayer=null;this.inherited(arguments)},resize:function(C){!C||0>=C.w||0>=C.h||this._resize(C.w,C.h)},show:function(){if(!this.visible){var C=this._controllerDiv;C.title=this.NLS_hide;k.remove(C,"ovwShow");k.add(C,
"ovwHide");J.show(this._body);J.show(this._maximizerDiv);this._initialize();this.visible=!0}},hide:function(){if(this.visible){var C=this._controllerDiv;C.title=this.NLS_show;k.remove(C,"ovwHide");k.add(C,"ovwShow");this._maximized&&this._maximizeHandler();J.hide(this._body);J.hide(this._maximizerDiv);this._deactivate();this.visible=!1}},_initialSetup:function(){if(this._mainMapLayer=this.map.getLayer(this.map.layerIds[0])){var C=this.baseLayer||this._mainMapLayer,N=this.map.spatialReference,S=C.spatialReference;
if(S.wkid!==N.wkid&&S.wkt!==N.wkt)console.error("esri.dijit.OverviewMap: "+this.NLS_invalidSR);else{N=C.declaredClass;if(C instanceof f)if(-1!==N.indexOf("VETiledLayer"))this.baseLayer=new A({resourceInfo:C.getResourceInfo(),culture:C.culture,mapStyle:C.mapStyle,bingMapsKey:C.bingMapsKey});else if(-1!==N.indexOf("OpenStreetMapLayer"))this.baseLayer=new H({tileServers:C.tileServers});else if(-1!==N.indexOf("WebTiledLayer")){N=C.initialExtent;S=C.fullExtent;var F=C.tileInfo;this.baseLayer=new C.constructor(C.urlTemplate,
{initialExtent:N&&new N.constructor(N.toJson()),fullExtent:S&&new S.constructor(S.toJson()),tileInfo:F&&new F.constructor(F.toJson()),tileServers:C.tileServers&&C.tileServers.slice(0)})}else this.baseLayer=new t(C.url,{resourceInfo:C.getResourceInfo()});else if(C instanceof l)-1!==N.indexOf("ArcGISImageServiceLayer")?this.baseLayer=new w(C.url):(this.baseLayer=new v(C.url),this.baseLayer.setImageFormat("png24"));else if(C instanceof x)this.baseLayer=new x(C.url);else if(C instanceof q)this.baseLayer=
new t("https://services.arcgisonline.com/arcgis/rest/services/World_Street_Map/MapServer",{});else{console.error("esri.dijit.OverviewMap: "+this.NLS_invalidType);return}!this._detached&&this.visible&&this._controllerDiv&&(C=function(){this.visible=!1;this.show()},this.baseLayer.loaded?C.call(this):r.connect(this.baseLayer,"onLoad",this,C))}}else console.error("esri.dijit.OverviewMap: "+this.NLS_noLayer)},_visibilityHandler:function(){this.visible?this.hide():this.show()},_maximizeHandler:function(){var C=
this._maximizerDiv;this._maximized?(C.title=this.NLS_maximize,k.remove(C,"ovwRestore"),k.add(C,"ovwMaximize"),this._resize(this.width,this.height)):(C.title=this.NLS_restore,k.remove(C,"ovwMaximize"),k.add(C,"ovwRestore"),this._resize(this.map.width,this.map.height));this._maximized=!this._maximized},_resize:function(C,N){d.set(this._body,{width:C+"px",height:N+"px"});C=E.defaults.map.panDuration;N=this.overviewMap;E.defaults.map.panDuration=0;N&&(N.resize(!0),N.centerAt(this._focusExtent.getCenter()));
E.defaults.map.panDuration=C},_initialize:function(){if(this.overviewMap)this._activate();else{var C;var N=9>m("ie")?this._body.firstChild:this._body.firstElementChild;this.overviewMap=C=new g(N,{slider:!1,showAttribution:!1,logo:!1,lods:this._overviewLods,wrapAround180:this.map.wrapAround180});r.connect(C,"onLoad",this,function(){this._map_resize_override=u.hitch(C,this._map_resize_override);C.disableMapNavigation();this._activate()});C.addLayer(this.baseLayer)}},_activate:function(){var C=this.map,
N=this.overviewMap;this._moveableHandle=new a(this._focusDiv);this._soeConnect=r.connect(C,"onExtentChange",this,this._syncOverviewMap);this._ufoConnect=r.connect(C,"onPan",this,this._updateFocus);this._oecConnect=r.connect(N,"onExtentChange",this,this._ovwExtentChangeHandler);this._opaConnect=r.connect(N,"onPan",this,this._ovwPanHandler);this._ozsConnect=r.connect(N,"onZoomStart",this,function(){J.hide(this._focusDiv)});this._ozeConnect=r.connect(N,"onZoomEnd",this,function(){J.show(this._focusDiv)});
this._omsConnect=r.connect(this._moveableHandle,"onMoveStop",this,this._moveStopHandler);this._syncOverviewMap(C.extent,null,null,null)},_deactivate:function(){r.disconnect(this._soeConnect);r.disconnect(this._ufoConnect);r.disconnect(this._oecConnect);r.disconnect(this._opaConnect);r.disconnect(this._ozsConnect);r.disconnect(this._ozeConnect);r.disconnect(this._omsConnect);this._moveableHandle&&(this._moveableHandle.destroy(),this._moveableHandle=null)},_syncOverviewMap:function(C,N,S,F){this._suspendPanHandling?
this._suspendPanHandling=!1:(this._focusExtent=C,this.overviewMap.setExtent(C.expand(this.expandFactor),!0))},_updateFocus:function(C){this._suspendPanHandling||(this._focusExtent=C,this._drawFocusDiv(C))},_drawFocusDiv:function(C,N){var S=this.overviewMap,F=S.toScreen(new h(C.xmin,C.ymax,S.spatialReference));S=S.toScreen(new h(C.xmax,C.ymin,S.spatialReference));C=S.x-F.x;S=S.y-F.y;var T=!0;C>this.overviewMap.width&&S>this.overviewMap.height&&(T=!1);d.set(this._focusDiv,{left:F.x+(N?N.x:0)+"px",top:F.y+
(N?N.y:0)+"px",width:C+"px",height:S+"px",display:T?"block":"none"})},_moveStopHandler:function(C){var N=this._moveableHandle.node.style;C=this._focusExtent;var S=this.overviewMap;N=S.toMap(new c(parseInt(N.left,10),parseInt(N.top,10)));var F=new h(C.xmin,C.ymax,S.spatialReference);this._focusExtent=C.offset(N.x-F.x,N.y-F.y);this._maximized?this._maximizeHandler():S.centerAt(this._focusExtent.getCenter());this._suspendPanHandling=!0;this.map.setExtent(this._focusExtent)},_ovwExtentChangeHandler:function(){this._drawFocusDiv(this._focusExtent)},
_ovwPanHandler:function(C,N){this._drawFocusDiv(this._focusExtent,N)}});m("extend-esri")&&u.setObject("dijit.OverviewMap",G,z);return G})},"esri/dijit/PopupMobile":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style ../InfoWindowBase ../PopupBase ./InfoView ./NavigationBar ../kernel ../domUtils dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A){G=u([q,t],{declaredClass:"esri.dijit.PopupMobile",offsetX:3,offsetY:3,zoomFactor:4,marginLeft:10,marginTop:10,highlight:!0,popupNavigationBar:null,popupInfoView:null,location:null,xIcon:G.toUrl("./images/whitex.png"),dArrowIcon:G.toUrl("./images/whitedown.png"),lArrowIcon:G.toUrl("./images/whitel.png"),rArrowIcon:G.toUrl("./images/whiter.png"),constructor:function(z,E){this.initialize();r.mixin(this,z);this.domNode=e.byId(E);this._nls=r.mixin({},
A.widgets.popup);z=this.domNode;h.add(z,"esriPopupMobile");g.set(z,"innerHTML","\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'titlePane'\x3e\x3cdiv class\x3d'spinner hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'title'\x3e\x3c/div\x3e\x3cdiv style\x3d'text-align:center'\x3e\x3cdiv class\x3d'titleButton prev hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'footer' style\x3d'display:inline-block;width:60px;height:15px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton next hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton close'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton arrow hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer top hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer bottom hidden'\x3e\x3c/div\x3e");
E=d.query(".titlePane",z)[0];this._arrowButton=d.query(".arrow",E)[0];this._pointerTop=d.query(".top",z)[0];this._pointerBottom=d.query(".bottom",z)[0];this._title=d.query(".title",E)[0];this._footer=d.query(".footer",E)[0];this._prev=d.query(".prev",E)[0];this._next=d.query(".next",E)[0];this._spinner=d.query(".spinner",E)[0];this._eventConnections=[n.connect(d.query(".close",E)[0],"onclick",this,this.hide),n.connect(this._arrowButton,"onclick",this,this._toggleView),n.connect(this._prev,"onclick",
this,function(){this.selectPrevious();this._updateUI()}),n.connect(this._next,"onclick",this,function(){this.selectNext();this._updateUI()})];this._initPopupNavigationBar();this._initPopupInfoView();H.hide(z);this.isShowing=!1},setMap:function(z){this.inherited(arguments);c.place(this.domNode,z.root);this.highlight&&this.enableHighlight(z)},unsetMap:function(){this.disableHighlight(this.map);this.inherited(arguments)},setTitle:function(z,E){this.destroyDijits(this._title);this.place(z,this._title);
this.destroyDijits(this._footer);this.place(E,this._footer);this.isShowing&&(this.startupDijits(this._title),this.startupDijits(this._footer))},setContent:function(z){this.destroyDijits(this._contentPane);this.place(z,this._contentPane);this.startupDijits(this._contentPane)},show:function(z){if(z){var E=this.map;z.spatialReference?(this.location=z,z=E.toScreen(z)):this.location=E.toMap(z);this._maximized?this.restore():this._setPosition(z);this.isShowing||(H.show(this.domNode),this.isShowing=!0,this.onShow())}else H.show(this.domNode),
this.isShowing=!0},hide:function(){this.isShowing&&(H.hide(this.domNode),this.isShowing=!1,this.onHide())},onShow:function(){this._followMap();this.startupDijits(this._title);this.showHighlight()},onHide:function(){this._unfollowMap();this.hideHighlight()},destroy:function(){this.map&&this.unsetMap();this.cleanup();this.isShowing&&this.hide();this.destroyDijits(this._title);this.destroyDijits(this._footer);m.forEach(this._eventConnections,n.disconnect);c.destroy(this.domNode)},selectNext:function(){this.select(this.selectedIndex+
1)},selectPrevious:function(){this.select(this.selectedIndex-1)},setFeatures:function(){this.inherited(arguments);this._updateUI()},onSetFeatures:function(){},onClearFeatures:function(){this.setTitle("\x26nbsp;","\x26nbsp;");h.add(this._arrowButton,"hidden");this._updateUI();this.hideHighlight()},onSelectionChange:function(){var z=this.selectedIndex;this._updateUI();0<=z&&(this.setContent(this.features[z].getContent()),this.updateHighlight(this.map,this.features[z]),this.isShowing&&this.showHighlight())},
onDfdComplete:function(){this._updateUI()},_followMap:function(){this._unfollowMap();var z=this.map;this._handles=[n.connect(z,"onPanStart",this,this._onPanStart),n.connect(z,"onPan",this,this._onPan),n.connect(z,"onZoomStart",this,this._onZoomStart),n.connect(z,"onExtentChange",this,this._onExtentChange)]},_unfollowMap:function(){var z=this._handles;z&&(m.forEach(z,n.disconnect),this._handles=null)},_onPanStart:function(){var z=this.domNode.style;this._panOrigin={left:z.left,top:z.top,right:z.right,
bottom:z.bottom}},_onPan:function(z,E){var J=this._panOrigin;z=E.x;E=E.y;var D=J.left,L=J.top,C=J.right;J=J.bottom;D&&(D=parseFloat(D)+z+"px");L&&(L=parseFloat(L)+E+"px");C&&(C=parseFloat(C)-z+"px");J&&(J=parseFloat(J)-E+"px");l.set(this.domNode,{left:D,top:L,right:C,bottom:J})},_onZoomStart:function(){H.hide(this.domNode)},_onExtentChange:function(z,E,J){J&&(H.show(this.domNode),this.show(this._targetLocation||this.location),this._targetLocation=null)},_setPosition:function(z){var E=z.x;z=z.y;var J=
f.getContentBox(this.map.container),D=J.w;J=J.h;var L=0,C=z+10,N=118,S=D-18;18<E&&E<S?(L=E-130,0>L?L=0:L>D-260&&(L=D-260)):18>=E?L=E-18:E>=S&&(L=D-260+(E-S));118<E&&E<D-130?N=118:118>=E?18<E?N=E-12:18>=E&&(N=6):E>=D-130&&(E<S?N=118+E-(D-130):E>=S&&(N=118+S-(D-130)));z<=J/2?(l.set(this.domNode,{left:L+"px",top:C+"px",bottom:null}),l.set(this._pointerTop,{left:N+"px"}),h.add(this._pointerBottom,"hidden"),h.remove(this._pointerTop,"hidden")):(l.set(this.domNode,{left:L+"px",top:C-64+"px",bottom:null}),
l.set(this._pointerBottom,{left:N+"px"}),h.add(this._pointerTop,"hidden"),h.remove(this._pointerBottom,"hidden"))},_showPointer:function(z){m.forEach(["topLeft","topRight","bottomRight","bottomLeft"],function(E){E===z?d.query(".pointer."+E,this.domNode).removeClass("hidden"):d.query(".pointer."+E,this.domNode).addClass("hidden")},this)},_toggleView:function(){this.popupNavigationBar||this._initPopupNavigationBar();this.popupInfoView||this._initPopupInfoView();this.hide();H.show(this.popupNavigationBar.container);
H.show(this.popupInfoView.container);0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())},_handleNavigationBar:function(z){this.popupInfoView.animateTo(0);switch(z.name){case "CloseButton":H.hide(this.popupNavigationBar.container);H.hide(this.popupInfoView.container);this.hide();break;case "ToggleButton":H.hide(this.popupNavigationBar.container);H.hide(this.popupInfoView.container);this.show(this.location);break;case "PreviousButton":this.selectPrevious();this._updateUI();
break;case "NextButton":this.selectNext(),this._updateUI()}},_initPopupNavigationBar:function(){var z={};z.items=[{name:"CloseButton",type:"img",src:this.xIcon,srcAlt:this.xIcon,position:"left"},{name:"Title",type:"span",text:"",position:"center"},{name:"ToggleButton",type:"img",src:this.dArrowIcon,srcAlt:this.dArrowIcon,position:"right",toggleGroup:"toggle"},{name:"PreviousButton",type:"img",src:this.lArrowIcon,srcAlt:this.lArrowIcon,position:"right2",toggleGroup:"previous"},{name:"NextButton",type:"img",
src:this.rArrowIcon,srcAlt:this.rArrowIcon,position:"right1",toggleGroup:"next"}];this.popupNavigationBar=new w(z,c.create("div",{},k.body()));n.connect(this.popupNavigationBar,"onCreate",this,function(E){this._prevFeatureButton=E[3]._node;this._nextFeatureButton=E[4]._node});n.connect(this.popupNavigationBar,"onSelect",this,this._handleNavigationBar);n.connect(this.popupNavigationBar,"onUnSelect",this,this._handleNavigationBar);this.popupNavigationBar.startup();H.hide(this.popupNavigationBar.container)},
_initPopupInfoView:function(){this.popupInfoView=new v({items:[{name:"Navigator",type:"div",text:""},{name:"content",type:"div",text:""},{name:"attachment",type:"div",text:""}]},c.create("div",{},k.body()));h.add(this.popupInfoView.container,"esriMobilePopupInfoView");this.popupInfoView.enableTouchScroll();n.connect(this.popupInfoView,"onCreate",this,function(z){this._contentPane=z[1]._node;0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())});n.connect(this.popupInfoView,
"onSwipeLeft",this,function(){});n.connect(this.popupInfoView,"onSwipeRight",this,function(){});this.popupInfoView.startup()},_updateUI:function(){var z="\x26nbsp;",E="\x26nbsp;",J=this.selectedIndex,D=this.features,L=this.deferreds,C=this._prevFeatureButton.parentNode,N=this._nextFeatureButton.parentNode,S=this._spinner,F=this._nls;D&&1<=D.length?(z=D[J].getTitle(),E=J+1+" of "+D.length,h.remove(this._arrowButton,"hidden"),0===J?(h.add(C,"hidden"),h.add(this._prev,"hidden")):(h.remove(C,"hidden"),
h.remove(this._prev,"hidden")),J===D.length-1?(h.add(N,"hidden"),h.add(this._next,"hidden")):(h.remove(N,"hidden"),h.remove(this._next,"hidden"))):(h.add(this._arrowButton,"hidden"),h.add(C,"hidden"),h.add(N,"hidden"),h.add(this._prev,"hidden"),h.add(this._next,"hidden"));this.setTitle(z,E);this.popupNavigationBar.getItems()[1]._node.innerHTML=E;L&&L.length?(h.remove(S,"hidden"),this.setTitle(F.NLS_searching+"...","\x26nbsp;")):(h.add(S,"hidden"),D&&D.length||this.setTitle("No Information","\x26nbsp;"))}});
a("extend-esri")&&r.setObject("dijit.PopupMobile",G,x);return G})},"esri/dijit/Print":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dojo/dom dojo/dom-class dojo/dom-construct dijit/Menu dijit/MenuItem dijit/form/Button dijit/form/ComboButton ../tasks/PrintTask ../tasks/PrintParameters ../kernel ../domUtils ../Evented dojo/i18n!../nls/jsapi".split(" "),function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v){G=G([t],{declaredClass:"esri.dijit.Print",_eventMap:{"print-complete":["result"],
error:!0,"print-start":!0},onPrintComplete:function(){},onError:function(){},onPrintStart:function(){},constructor:function(w,x){w=w||{};this.url=w.url;this.async=w.async;this.map=w.map;this.templates=w.templates;this.extraParams=w.extraParameters;w=v.widgets.print;this._printText=w.NLS_print;this._printingText=w.NLS_printing;this._printoutText=w.NLS_printout;this.templates||(this.templates=[{label:this._printText,format:"PNG32",layout:"MAP_ONLY",exportOptions:{width:800,height:1100,dpi:96}}]);this.printDomNode=
a.create("div");d.add(this.printDomNode,"esriPrint");x=k.byId(x);x.appendChild(this.printDomNode)},startup:function(){this._createPrintButton()},destroy:function(){this.map=null;a.destroy(this.printDomNode)},hide:function(){q.hide(this.printDomNode)},show:function(){q.show(this.printDomNode)},printMap:function(w){this.onPrintStart();this._printButton.setAttribute("label",this._printingText);this._printButton.setAttribute("disabled",!0);var x=this.map,H=new c(this.url,{async:this.async}),A=new f;A.map=
x;A.template=w;A.extraParameters=this.extraParams;H.execute(A,u.hitch(this,this._printComplete),u.hitch(this,this._printError))},_createPrintButton:function(){var w=this.templates;if(1===w.length)this._printButton=new g({label:this._printText,onClick:u.hitch(this,function(){this.printMap(w[0])})}),this.printDomNode.appendChild(this._printButton.domNode);else{this._printButton=new h({label:this._printText,onClick:u.hitch(this,function(){this.printMap(w[0])})});this.printDomNode.appendChild(this._printButton.domNode);
var x=new b({style:"display: none;"});n.forEach(w,function(H){var A=new e({label:H.label,onClick:u.hitch(this,function(){this.printMap(H)})});x.addChild(A)},this);this._printButton.setAttribute("dropDown",x)}d.add(this._printButton.domNode,"esriPrintButton")},_printComplete:function(w){this.onPrintComplete(w);this._printButton.domNode.style.display="none";w=a.create("a",{href:w.url,target:"_blank",innerHTML:this._printoutText});r.connect(w,"onclick",u.hitch(this,this._hyperlinkClick));this._removeAllChildren(this.printDomNode);
d.add(w,"esriPrintout");this.printDomNode.appendChild(w)},_printError:function(w){this._removeAllChildren(this.printDomNode);this._createPrintButton();console.error(w);this.onError(w)},_hyperlinkClick:function(){this._removeAllChildren(this.printDomNode);this._createPrintButton()},_removeAllChildren:function(w){for(;w.hasChildNodes();)w.removeChild(w.lastChild)}});m("extend-esri")&&u.setObject("dijit.Print",G,l);return G})},"esri/dijit/Scalebar":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/query ../kernel ../lang ../domUtils ../units ../SpatialReference ../WKIDUnitConversion ../geometry/Point ../geometry/ScreenPoint ../geometry/Polyline ../geometry/geodesicUtils ../geometry/webMercatorUtils ../geometry/screenUtils ../geometry/normalizeUtils dojo/i18n!../nls/jsapi".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z,E){G=G(null,{declaredClass:"esri.dijit.Scalebar",map:null,mapUnit:null,scalebarUnit:null,unitsDictionary:[],domNode:null,screenPt1:null,screenPt2:null,localStrings:E.widgets.scalebar,constructor:function(J,D){this.metricScalebar=k.create("div",{innerHTML:"\x3cdiv class\x3d'esriScaleLabelDiv'\x3e\x3cdiv class\x3d'esriScalebarLabel esriScalebarLineLabel esriScalebarSecondNumber'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriScalebarLine esriScalebarMetricLine'\x3e\x3c/div\x3e"});
this.englishScalebar=k.create("div",{innerHTML:"\x3cdiv class\x3d'esriScalebarLine esriScalebarEnglishLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriScaleLabelDiv'\x3e\x3cdiv class\x3d'esriScalebarLabel esriScalebarLineLabel esriScalebarSecondNumber'\x3e\x3c/div\x3e\x3c/div\x3e"});this.domNode=k.create("div");J=J||{};if(J.map){if(J.scalebarUnit){if("english"!==J.scalebarUnit&&"metric"!==J.scalebarUnit&&"dual"!==J.scalebarUnit){console.error("scalebar unit only accepts english or metric or dual");return}this.scalebarUnit=
J.scalebarUnit}else this.scalebarUnit="english";if(J.scalebarStyle){if("ruler"!==J.scalebarStyle&&"line"!==J.scalebarStyle){console.error("scalebar style must be ruler or line");return}this.scalebarStyle=J.scalebarStyle}else this.scalebarStyle="ruler";this.background=J.background;switch(this.scalebarUnit){case "english":"ruler"===this.scalebarStyle&&(this.englishScalebar.innerHTML="\x3cdiv class\x3d'esriScalebarRuler'\x3e\x3cdiv class\x3d'esriScalebarRulerBlock upper_firstpiece'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriScalebarRulerBlock upper_secondpiece'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriScalebarRulerBlock lower_firstpiece'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriScalebarRulerBlock lower_secondpiece'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'scaleLabelDiv'\x3e\x3cdiv class\x3d'esriScalebarLabel' style\x3d'left: -3%'\x3e0\x3c/div\x3e\x3cdiv class\x3d'esriScalebarLabel esriScalebarFirstNumber'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriScalebarLabel esriScalebarSecondNumber'\x3e\x3c/div\x3e\x3c/div\x3e");
this.domNode.appendChild(this.englishScalebar);break;case "metric":"ruler"===this.scalebarStyle&&(this.metricScalebar.innerHTML="\x3cdiv class\x3d'esriScalebarRuler'\x3e\x3cdiv class\x3d'esriScalebarRulerBlock upper_firstpiece'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriScalebarRulerBlock upper_secondpiece'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriScalebarRulerBlock lower_firstpiece'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriScalebarRulerBlock lower_secondpiece'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'scaleLabelDiv'\x3e\x3cdiv class\x3d'esriScalebarLabel' style\x3d'left: -3%'\x3e0\x3c/div\x3e\x3cdiv class\x3d'esriScalebarLabel esriScalebarFirstNumber'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriScalebarLabel esriScalebarSecondNumber'\x3e\x3c/div\x3e\x3c/div\x3e");
this.domNode.appendChild(this.metricScalebar);break;case "dual":this.domNode.appendChild(this.metricScalebar),this.domNode.appendChild(this.englishScalebar)}this.map=J.map;D?D.appendChild(this.domNode):(this.map.container.appendChild(this.domNode),J.attachTo?m.add(this.domNode,"scalebar_"+J.attachTo):m.add(this.domNode,"scalebar_bottom-left"));m.add(this.domNode,"esriScalebar");if(this.map.loaded)this._getDistance(),this._checkBingMaps();else var L=n.connect(this.map,"onLoad",this,function(){n.disconnect(L);
L=null;this._getDistance();this._checkBingMaps()});this._mapOnPan=n.connect(this.map,"onPan",this,this._getDistance);this._mapOnExtentChange=n.connect(this.map,"onExtentChange",this,this._getDistance);r.forEach(this.map.layerIds,function(C,N){"esri.virtualearth.VETiledLayer"===this.map.getLayer(C).declaredClass&&n.connect(this.map.getLayer(C),"onVisibilityChange",u.hitch(this,function(S){this._checkBingMaps()}))},this);this._mapOnLayerAdd=n.connect(this.map,"onLayerAdd",u.hitch(this,function(C){"esri.virtualearth.VETiledLayer"===
C.declaredClass&&n.connect(C,"onVisibilityChange",u.hitch(this,function(N){this._checkBingMaps()}));this._checkBingMaps()}));this._mapOnLayerRemove=n.connect(this.map,"onLayerRemove",u.hitch(this,this._checkBingMaps))}else console.error("scalebar: unable to find the 'map' property in parameters")},hide:function(){this._hidden=!0;c.hide(this.domNode)},show:function(){this._hidden=!1;c.show(this.domNode)},destroy:function(){n.disconnect(this._mapOnPan);n.disconnect(this._mapOnExtentChange);n.disconnect(this._mapOnLayerAdd);
n.disconnect(this._mapOnLayerRemove);this.hide();this.map=null;k.destroy(this.domNode)},_checkBingMaps:function(){m.contains(this.domNode,"scalebar_bottom-left")&&(a.set(this.domNode,"left","25px"),r.forEach(this.map.layerIds,function(J,D){"esri.virtualearth.VETiledLayer"===this.map.getLayer(J).declaredClass&&this.map.getLayer(J).visible&&(J="95px",this.map._mapParams.nav&&(J="115px"),a.set(this.domNode,"left",J))},this))},_getDistance:function(J){J=this.map._clip?this.map._getAvailExtent():J||this.map.extent;
var D=d.position(this.domNode,!0).y-this.map.position.y;D=D>this.map.height?this.map.height:D;D=0>D?0:D;var L=new v(0,D);D=new v(this.map.width,D);this.mapUnit="esriDecimalDegrees";var C=A.toMapPoint(J,this.map.width,this.map.height,L),N=A.toMapPoint(J,this.map.width,this.map.height,D);L=new t(J.xmin,(J.ymin+J.ymax)/2,this.map.spatialReference);D=new t(J.xmax,(J.ymin+J.ymax)/2,this.map.spatialReference);this.map._clip&&(N=this.map.spatialReference._getInfo(),C=new t(N.valid[0],0,this.map.spatialReference),
N=new t(N.valid[1],0,this.map.spatialReference));if(3857===this.map.spatialReference.wkid||102100===this.map.spatialReference.wkid||102113===this.map.spatialReference.wkid||this.map.spatialReference.wkt&&-1!=this.map.spatialReference.wkt.indexOf("WGS_1984_Web_Mercator"))C=H.webMercatorToGeographic(C,!0),N=H.webMercatorToGeographic(N,!0),L=H.webMercatorToGeographic(L,!0),D=H.webMercatorToGeographic(D,!0);else if(h.isDefined(q[this.map.spatialReference.wkid])||this.map.spatialReference.wkt&&0===this.map.spatialReference.wkt.indexOf("PROJCS")){this.mapUnit=
"linearUnit";J=Math.abs(J.xmax-J.xmin);if(h.isDefined(q[this.map.spatialReference.wkid]))var S=q.values[q[this.map.spatialReference.wkid]];else{S=this.map.spatialReference.wkt;var F=S.lastIndexOf(",")+1;var T=S.lastIndexOf("]]");S=parseFloat(S.substring(F,T))}J*=S;F=J/1609;S=J/1E3;J/=1E3}"esriDecimalDegrees"===this.mapUnit&&(S=x.isSupported(this.map.spatialReference)?this.map.spatialReference.wkid:4326,J=new w(new l({wkid:S})),J.addPath([C,N]),C=z._straightLineDensify(J,10),J=x.geodesicLengths([C],
f.KILOMETERS)[0],C=new w(new l({wkid:S})),C.addPath([L,D]),L=z._straightLineDensify(C,10),x.geodesicLengths([L],f.KILOMETERS),F=J/1.609,S=J);"english"===this.scalebarUnit?this._getScaleBarLength(F,"mi"):"metric"===this.scalebarUnit?this._getScaleBarLength(S,"km"):"dual"===this.scalebarUnit&&(this._getScaleBarLength(F,"mi"),this._getScaleBarLength(S,"km"))},_getScaleBarLength:function(J,D){var L=this.map._getFrameWidth();J=50*J/(this.map._clip&&0<L?L:this.map.width);L=0;var C=D;.1>J&&("mi"===D?(J*=
5280,C="ft"):"km"===D&&(J*=1E3,C="m"));for(;1<=J;)J/=10,L++;if(.5<J){var N=1;var S=.5}else.3<J?(N=.5,S=.3):.2<J?(N=.3,S=.2):.15<J?(N=.2,S=.15):.1<=J&&(N=.15,S=.1);D=N/J>=J/S?S:N;this._drawScaleBar(D/J*50,Math.pow(10,L)*D,C)},_drawScaleBar:function(J,D,L){var C=2*Math.round(J);if("mi"===L||"ft"===L){this.englishScalebar.style.width=C+"px";J=e(".esriScalebarFirstNumber",this.englishScalebar);var N=e(".esriScalebarSecondNumber",this.englishScalebar);var S=e(".esriScalebarMetricLineBackground",this.englishScalebar)}else this.metricScalebar.style.width=
C+"px",J=e(".esriScalebarFirstNumber",this.metricScalebar),N=e(".esriScalebarSecondNumber",this.metricScalebar),S=e(".esriScalebarMetricLineBackground",this.metricScalebar);r.forEach(S,function(F,T){F.style.width=C-2+"px"},this);r.forEach(J,function(F,T){F.innerHTML=D},this);r.forEach(N,function(F,T){F.innerHTML="esriUnknown"!==this.mapUnit?2*D+this.localStrings[L]:2*D+"Unknown Unit"},this)}});b("extend-esri")&&u.setObject("dijit.Scalebar",G,g);return G})},"esri/dijit/TimeSlider":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/kernel dojo/has dojo/dom-class dojo/dom-construct dojo/dom-style dojo/dom-geometry dijit/_Widget dijit/_Templated dijit/form/HorizontalSlider dijit/form/HorizontalRule dijit/form/HorizontalRuleLabels dojox/timing/_base dojox/form/RangeSlider dojo/text!dojox/form/resources/HorizontalRangeSlider.html ../kernel ../lang ../TimeExtent ./_EventedWidget dojo/text!./templates/TimeSlider.html dojo/i18n!../nls/jsapi".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H,A,z){b=G([H,e,g],{declaredClass:"esri.dijit.TimeSlider",widgetsInTemplate:!0,templateString:A,intermediateChanges:!1,_slideDuration:1E3,_defaultCount:10,_eventMap:{"time-extent-change":!0,play:!0,pause:!0,next:!0,previous:!0},constructor:function(E,J){u.mixin(this,z.widgets.timeSlider);this._iconClass="tsButton tsPlayButton";this.loop=this.playing=!1;this.thumbCount=1;this.thumbMovingRate=1E3;this._createTimeInstants=!1;this._options=u.mixin({excludeDataAtTrailingThumb:!1,
excludeDataAtLeadingThumb:!1},E.options||{})},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments);this._timer=new l.Timer;this._timer.setInterval(this.thumbMovingRate);this._timer.onTick=u.hitch(this,"_bumpSlider",1);this._createSlider()},destroy:function(){this._timer.stop();this.timeStops=this._timer=null;this._slider.destroy();this._slider=null;this._hTicks&&(this._hTicks.destroyRecursive(),this._hTicks=null);this._hLabels&&(this._hLabels.destroyRecursive(),
this._hLabels=null);this.inherited(arguments)},onTimeExtentChange:function(){},onPlay:function(){},onPause:function(){},onNext:function(){},onPrevious:function(){},_onHorizontalChange:function(){var E=this._sliderToTimeExtent();this.onTimeExtentChange(E)},_onPlay:function(){this.playing=!this.playing;this._updateUI();this.playing?(this._timer.start(),this.onPlay(this._sliderToTimeExtent())):(this._timer.stop(),this.onPause(this._sliderToTimeExtent()));var E=this._getSliderValue();this._offset=u.isArray(E)?
E[1]-E[0]:0},_onNext:function(){this.playing||(this._bumpSlider(1),this.onNext(this._sliderToTimeExtent()))},_onPrev:function(){this.playing||(this._bumpSlider(-1),this.onPrevious(this._sliderToTimeExtent()))},createTimeStopsByCount:function(E,J){E&&E.startTime&&E.endTime?(J=J||this._defaultCount,this.createTimeStopsByTimeInterval(E,Math.ceil((E.endTime-E.startTime)/(J-1)),"esriTimeUnitsMilliseconds")):console.log(this.NLS_invalidTimeExtent)},createTimeStopsByTimeInterval:function(E,J,D,L){if(E&&
E.startTime&&E.endTime){this.fullTimeExtent=new x(E.startTime,E.endTime);L&&!0===L.resetStartTime&&this._resetStartTime(this.fullTimeExtent,D);this._timeIntervalUnits=D;L=this.fullTimeExtent.startTime;for(var C=[];L<=E.endTime;)C.push(L),L=E._getOffsettedDate(L,J,D);0<C.length&&C[C.length-1]<E.endTime&&C.push(L);this.setTimeStops(C)}else console.log(this.NLS_invalidTimeExtent)},getCurrentTimeExtent:function(){return this._sliderToTimeExtent()},setTimeStops:function(E){this.timeStops=E||[];this._numTicks=
this._numStops=this.timeStops.length;!1===w.isDefined(this.fullTimeExtent)&&(this.fullTimeExtent=new x(E[0],E[E.length-1]))},setLoop:function(E){this.loop=E},setThumbCount:function(E){this.thumbCount=E;this.singleThumbAsTimeInstant(this._createTimeInstants);this._slider&&this._createSlider()},setThumbIndexes:function(E){this.thumbIndexes=u.clone(E)||[0,1];this._initializeThumbs()},setThumbMovingRate:function(E){this.thumbMovingRate=E;this._timer&&this._timer.setInterval(this.thumbMovingRate)},setLabels:function(E){this.labels=
E;this._slider&&this._createSlider()},setTickCount:function(E){this._numTicks=E;this._slider&&this._createSlider()},singleThumbAsTimeInstant:function(E){this._createTimeInstants=E&&1===this.thumbCount},next:function(){this._onNext()},pause:function(){this.playing=!1;this._updateUI();this._timer.stop()},play:function(){!0!==this.playing&&(this.playing=!1,this._onPlay())},previous:function(){this._onPrev()},_setIntermediateChangesAttr:function(E){this.intermediateChanges=!!E;this._slider&&this._slider.set("intermediateChanges",
!!E)},_updateUI:function(){k.remove(this.playPauseBtn.iconNode,this._iconClass);this._iconClass=this.playing?"tsButton tsPauseButton":"tsButton tsPlayButton";k.add(this.playPauseBtn.iconNode,this._iconClass);this.previousBtn.set("disabled",this.playing);this.nextBtn.set("disabled",this.playing)},_createSlider:function(){this._slider&&(this._slider.destroy(),this._slider=null);for(var E=this.domNode;E.parentNode&&!E.dir;)E=E.parentNode;E={onChange:u.hitch(this,"_onHorizontalChange"),showButtons:!1,
discreteValues:this._numStops,slideDuration:this._slideDuration,"class":"ts",dir:"ltr",intermediateChanges:this.intermediateChanges};this._ts=d.create("div",{},n.query(".tsTmp",this.domNode)[0],"first");this._timeSliderTicks=d.create("div",{},this._ts,"first");this._timeSliderLabels=d.create("div",{},this._ts);2===this.thumbCount?this._createRangeSlider(E):this._createSingleSlider(E);this.thumbIndexes=this.thumbIndexes||[0,1];this._createHorizRule();this._createLabels();!0===this._createTimeInstants&&
n.query(".dijitSliderProgressBarH, .dijitSliderLeftBumper, .dijitSliderRightBumper",this._ts).forEach(function(J){a.set(J,{background:"none"})});this._initializeThumbs();r.disconnect(this._onChangeConnect);this._onChangeConnect=r.connect(this._slider,"onChange",u.hitch(this,"_updateThumbIndexes"))},_createRangeSlider:function(E){this._isRangeSlider=!0;this._slider=new (G([h,q],{templateString:t}))(E,this._ts)},_createSingleSlider:function(E){this._isRangeSlider=!1;this._slider=new h(E,this._ts)},
_createHorizRule:function(){this._hTicks&&(this._hTicks.destroyRecursive(),this._hTicks=null);2>this._numTicks||(this._hTicks=new c({container:"topDecoration",ruleStyle:"","class":"tsTicks",count:this._numTicks},this._timeSliderTicks))},_createLabels:function(){this._hLabels&&(this._hLabels.destroyRecursive(),this._hLabels=null);this.labels&&0<this.labels.length&&(this._hLabels=new f({labels:this.labels,labelStyle:"","class":"tsLabels"},this._timeSliderLabels))},_initializeThumbs:function(){if(this._slider){this._offset=
this._toSliderValue(this.thumbIndexes[1])||0;var E=this._toSliderValue(this.thumbIndexes[0]);E=E>this._slider.maximum||E<this._slider.minimum?this._slider.minimum:E;if(!0===this._isRangeSlider){var J=this._toSliderValue(this.thumbIndexes[1]);J=J>this._slider.maximum||J<this._slider.minimum?this._slider.maximum:J;this._setSliderValue([E,J<E?E:J])}else this._setSliderValue(E);this._onHorizontalChange()}},_bumpSlider:function(E){var J=this._getSliderValue(),D=J,L=D,C=E;u.isArray(J)&&(L=J[0],D=J[1],C=
[{change:E,useMaxValue:!0},{change:E,useMaxValue:!1}]);1E-10>Math.abs(L-this._slider.minimum)&&0>E||1E-10>Math.abs(D-this._slider.maximum)&&0<E?this._timer.isRunning&&(this.loop?(this._timer.stop(),this._setSliderValue(this._getSliderMinValue()),E=this._sliderToTimeExtent(),this.onTimeExtentChange(E),this._timer.start(),this.playing=!0):this.pause()):this._slider._bumpValue(C)},_updateThumbIndexes:function(){var E=this._getSliderValue();u.isArray(E)?(this.thumbIndexes[0]=this._toSliderIndex(E[0]),
this.thumbIndexes[1]=this._toSliderIndex(E[1])):this.thumbIndexes[0]=this._toSliderIndex(E)},_sliderToTimeExtent:function(){if(this.timeStops&&0!==this.timeStops.length){var E=new x,J=this._getSliderValue();if(u.isArray(J)){if(J[0]>J[1]){var D=J[0];var L=J[1]}else L=J[0],D=J[1];E.startTime=new Date(this.timeStops[this._toSliderIndex(L)]);E.endTime=new Date(this.timeStops[this._toSliderIndex(D)]);this._adjustTimeExtent(E)}else E.startTime=!0===this._createTimeInstants?new Date(this.timeStops[this._toSliderIndex(J)]):
new Date(this.fullTimeExtent.startTime),E.endTime=!0===this._createTimeInstants?E.startTime:new Date(this.timeStops[this._toSliderIndex(J)]);return E}},_adjustTimeExtent:function(E){if((!1!==this._options.excludeDataAtTrailingThumb||!1!==this._options.excludeDataAtLeadingThumb)&&E.startTime.getTime()!==E.endTime.getTime()){if(this._options.excludeDataAtTrailingThumb){var J=E.startTime;J.setUTCSeconds(J.getUTCSeconds()+1)}this._options.excludeDataAtLeadingThumb&&(E=E.endTime,E.setUTCSeconds(E.getUTCSeconds()-
1))}},_resetStartTime:function(E,J){switch(J){case "esriTimeUnitsSeconds":E.startTime.setUTCMilliseconds(0);break;case "esriTimeUnitsMinutes":E.startTime.setUTCSeconds(0,0,0);break;case "esriTimeUnitsHours":E.startTime.setUTCMinutes(0,0,0);break;case "esriTimeUnitsDays":E.startTime.setUTCHours(0,0,0,0);break;case "esriTimeUnitsWeeks":E.startTime.setUTCDate(E.startTime.getUTCDate()-E.startTime.getUTCDay());break;case "esriTimeUnitsMonths":E.startTime.setUTCDate(1);E.startTime.setUTCHours(0,0,0,0);
break;case "esriTimeUnitsDecades":E.startTime.setUTCFullYear(E.startTime.getUTCFullYear()-E.startTime.getUTCFullYear()%10);break;case "esriTimeUnitsCenturies":E.startTime.setUTCFullYear(E.startTime.getUTCFullYear()-E.startTime.getUTCFullYear()%100)}},_getSliderMinValue:function(){return this._isRangeSlider?[this._slider.minimum,this._slider.minimum+this._offset]:this._slider.minimum},_toSliderIndex:function(E){E=Math.floor((E-this._slider.minimum)*this._numStops/(this._slider.maximum-this._slider.minimum));
0>E&&(E=0);E>=this._numStops&&(E=this._numStops-1);return E},_toSliderValue:function(E){return E*(this._slider.maximum-this._slider.minimum)/(this._numStops-1)+this._slider.minimum},_getSliderValue:function(){return this._slider.get("value")},_setSliderValue:function(E){this._slider._setValueAttr(E,!1,!1)}});m("extend-esri")&&u.setObject("dijit.TimeSlider",b,v);return b})},"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l,q,t,v,w,x,H){var A=u("dijit.form._SliderMover",g,{onMouseMove:function(z){var E=this.widget,J=E._abspos;J||(J=E._abspos=m.position(E.sliderBarContainer,!0),E._setPixelValue_=a.hitch(E,"_setPixelValue"),E._isReversed_=E._isReversed());z=z[E._mousePixelCoord]-J[E._startingPixelCoord];E._setPixelValue_(E._isReversed_?J[E._pixelCount]-z:z,J[E._pixelCount],!1)},destroy:function(z){g.prototype.destroy.apply(this,arguments);var E=this.widget;E._abspos=null;E._setValueAttr(E.value,
!0)}});r=u("dijit.form.HorizontalSlider",[w,x],{templateString:H,value:0,showButtons:!0,minimum:0,maximum:100,discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:l.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",
_onKeyUp:function(z){this.disabled||this.readOnly||z.altKey||z.ctrlKey||z.metaKey||this._setValueAttr(this.value,!0)},_onKeyDown:function(z){if(!(this.disabled||this.readOnly||z.altKey||z.ctrlKey||z.metaKey)){switch(z.keyCode){case d.HOME:this._setValueAttr(this.minimum,!1);break;case d.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?d.RIGHT_ARROW:d.LEFT_ARROW:case !1===this._descending?d.DOWN_ARROW:d.UP_ARROW:case !1===this._descending?d.PAGE_DOWN:d.PAGE_UP:this.increment(z);
break;case this._descending||this.isLeftToRight()?d.LEFT_ARROW:d.RIGHT_ARROW:case !1===this._descending?d.UP_ARROW:d.DOWN_ARROW:case !1===this._descending?d.PAGE_UP:d.PAGE_DOWN:this.decrement(z);break;default:return}z.stopPropagation();z.preventDefault()}},_onHandleClick:function(z){this.disabled||this.readOnly||(b("ie")||q.focus(this.sliderHandle),z.stopPropagation(),z.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(z){if(!this.disabled&&!this.readOnly&&
this.clickSelect){q.focus(this.sliderHandle);z.stopPropagation();z.preventDefault();var E=m.position(this.sliderBarContainer,!0),J=z[this._mousePixelCoord]-E[this._startingPixelCoord];this._setPixelValue(this._isReversed()?E[this._pixelCount]-J:J,E[this._pixelCount],!0);this._movable.onMouseDown(z)}},_setPixelValue:function(z,E,J){if(!this.disabled&&!this.readOnly){var D=this.discreteValues;if(1>=D||Infinity==D)D=E;D--;this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*Math.round(z/
(E/D))/D+this.minimum,this.maximum),this.minimum),J)}},_setValueAttr:function(z,E){this._set("value",z);this.valueNode.value=z;this.focusNode.setAttribute("aria-valuenow",z);this.inherited(arguments);var J=this.maximum>this.minimum?(z-this.minimum)/(this.maximum-this.minimum):0,D=!1===this._descending?this.remainingBar:this.progressBar,L=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(E&&0<this.slideDuration&&
D.style[this._progressPixelSize]){var C=this,N={},S=parseFloat(D.style[this._progressPixelSize]),F=this.slideDuration*(J-S/100);0!=F&&(0>F&&(F=0-F),N[this._progressPixelSize]={start:S,end:100*J,units:"%"},this._inProgressAnim=n.animateProperty({node:D,duration:F,onAnimate:function(T){L.style[C._progressPixelSize]=100-parseFloat(T[C._progressPixelSize])+"%"},onEnd:function(){delete C._inProgressAnim},properties:N}),this._inProgressAnim.play())}else D.style[this._progressPixelSize]=100*J+"%",L.style[this._progressPixelSize]=
100*(1-J)+"%"},_bumpValue:function(z,E){if(!(this.disabled||this.readOnly||this.maximum<=this.minimum)){var J=k.getComputedStyle(this.sliderBarContainer),D=m.getContentBox(this.sliderBarContainer,J);J=this.discreteValues;if(1>=J||Infinity==J)J=D[this._pixelCount];J--;z=Math.round((this.value-this.minimum)*J/(this.maximum-this.minimum))+z;0>z&&(z=0);z>J&&(z=J);z=z*(this.maximum-this.minimum)/J+this.minimum;this._setValueAttr(z,E)}},_onClkBumper:function(z){this.disabled||this.readOnly||!this.clickSelect||
this._setValueAttr(z,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===this._descending?this.minimum:this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(z){this._bumpValue(z.keyCode==d.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(z){this._bumpValue(z.keyCode==d.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(z){this.focused&&(z.stopPropagation(),z.preventDefault(),this._bumpValue(0>z.wheelDelta?-1:1,!0))},
startup:function(){this._started||(G.forEach(this.getChildren(),function(z){this[z.container]!=this.containerNode&&this[z.container].appendChild(z.domNode)},this),this.inherited(arguments))},_typematicCallback:function(z,E,J){if(-1==z)this._setValueAttr(this.value,!0);else this[E==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](J)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display=
"");var z=h('label[for\x3d"'+this.id+'"]');z.length&&(z[0].id||(z[0].id=this.id+"_label"),this.focusNode.setAttribute("aria-labelledby",z[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(t.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),t.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(f(this.domNode,
c.wheel,a.hitch(this,"_mouseWheeled")));var z=u(A,{widget:this});this._movable=new e(this.sliderHandle,{mover:z});this._layoutHackIE7()},destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});r._Mover=A;return r})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),function(G,u,r,n,m,k){n=G("dojo.dnd.move.constrainedMoveable",
k,{constraints:function(){},within:!1,constructor:function(d,a){a||(a={});this.constraints=a.constraints;this.within=a.within},onFirstMove:function(d){var a=this.constraintBox=this.constraints.call(this,d);a.r=a.l+a.w;a.b=a.t+a.h;this.within&&(d=u.getMarginSize(d.node),a.r-=d.w,a.b-=d.h)},onMove:function(d,a){var b=this.constraintBox,e=d.node.style;this.onMoving(d,a);a.l=a.l<b.l?b.l:b.r<a.l?b.r:a.l;a.t=a.t<b.t?b.t:b.b<a.t?b.b:a.t;e.left=a.l+"px";e.top=a.t+"px";this.onMoved(d,a)}});m=G("dojo.dnd.move.boxConstrainedMoveable",
n,{box:{},constructor:function(d,a){var b=a&&a.box;this.constraints=function(){return b}}});G=G("dojo.dnd.move.parentConstrainedMoveable",n,{area:"content",constructor:function(d,a){var b=a&&a.area;this.constraints=function(){var e=this.node.parentNode,g=r.getComputedStyle(e),h=u.getMarginBox(e,g);if("margin"==b)return h;var c=u.getMarginExtents(e,g);h.l+=c.l;h.t+=c.t;h.w-=c.w;h.h-=c.h;if("border"==b)return h;c=u.getBorderExtents(e,g);h.l+=c.l;h.t+=c.t;h.w-=c.w;h.h-=c.h;if("padding"==b)return h;c=
u.getPadExtents(e,g);h.l+=c.l;h.t+=c.t;h.w-=c.w;h.h-=c.h;return h}}});return{constrainedMoveable:n,boxConstrainedMoveable:m,parentConstrainedMoveable:G}})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(G,u,r){return G("dijit.form.HorizontalRule",[u,r],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',
_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(n){return this._positionPrefix+n+this._positionSuffix+this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);if(1==this.count)var n=this._genHTML(50,0);else{var m,k=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){n=this._genHTML(0,0);for(m=1;m<this.count-1;m++)n+=this._genHTML(k*m,m);n+=this._genHTML(100,this.count-1)}else{n=this._genHTML(100,0);for(m=1;m<this.count-1;m++)n+=
this._genHTML(100-k*m,m);n+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=n}})})},"dijit/form/HorizontalRuleLabels":function(){define("dojo/_base/declare dojo/has dojo/number dojo/query dojo/_base/lang ./HorizontalRule".split(" "),function(G,u,r,n,m,k){G=G("dijit.form.HorizontalRuleLabels",k,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH dijitRuleLabelsContainer dijitRuleLabelsContainerH"\x3e\x3c/div\x3e',labelStyle:"",labels:[],numericMargin:0,minimum:0,maximum:1,
constraints:{pattern:"#%"},_positionPrefix:'\x3cdiv class\x3d"dijitRuleLabelContainer dijitRuleLabelContainerH" style\x3d"left:',_labelPrefix:'"\x3e\x3cdiv class\x3d"dijitRuleLabel dijitRuleLabelH"\x3e',_suffix:"\x3c/div\x3e\x3c/div\x3e",_calcPosition:function(d){return d},_genHTML:function(d,a){a=this.labels[a];return this._positionPrefix+this._calcPosition(d)+this._positionSuffix+this.labelStyle+this._genDirectionHTML(a)+this._labelPrefix+a+this._suffix},_genDirectionHTML:function(d){return""},
getLabels:function(){var d=this.labels;!d.length&&this.srcNodeRef&&(d=n("\x3e li",this.srcNodeRef).map(function(g){return String(g.innerHTML)}));if(!d.length&&1<this.count){d=[];for(var a=this.minimum,b=(this.maximum-a)/(this.count-1),e=0;e<this.count;e++)d.push(e<this.numericMargin||e>=this.count-this.numericMargin?"":r.format(a,this.constraints)),a+=b}return d},postMixInProperties:function(){this.inherited(arguments);this.labels=this.getLabels();this.count=this.labels.length}});u("dojo-bidi")&&
G.extend({_setTextDirAttr:function(d){this.textDir!=d&&(this._set("textDir",d),n(".dijitRuleLabelContainer",this.domNode).forEach(m.hitch(this,function(a){a.style.direction=this.getTextDir(a.innerText||a.textContent||"")})))},_genDirectionHTML:function(d){return this.textDir?"direction:"+this.getTextDir(d)+";":""}});return G})},"dojox/timing/_base":function(){define(["dojo/_base/kernel","dojo/_base/lang"],function(G){G.experimental("dojox.timing");G.getObject("timing",!0,dojox);dojox.timing.Timer=
function(u){this.timer=null;this.isRunning=!1;this.interval=u;this.onStop=this.onStart=null};G.extend(dojox.timing.Timer,{onTick:function(){},setInterval:function(u){this.isRunning&&window.clearInterval(this.timer);this.interval=u;this.isRunning&&(this.timer=window.setInterval(G.hitch(this,"onTick"),this.interval))},start:function(){if("function"==typeof this.onStart)this.onStart();this.isRunning=!0;this.timer=window.setInterval(G.hitch(this,"onTick"),this.interval)},stop:function(){if("function"==
typeof this.onStop)this.onStop();this.isRunning=!1;window.clearInterval(this.timer)}});return dojox.timing})},"dojox/form/RangeSlider":function(){define(["dojo/_base/kernel","./_RangeSliderMixin","./HorizontalRangeSlider","./VerticalRangeSlider"],function(G,u){G.deprecated("Call require() for HorizontalRangeSlider / VerticalRangeSlider, explicitly rather than 'dojox.form.RangeSlider' itself","","2.0");return u})},"dojox/form/_RangeSliderMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/fx dojo/_base/event dojo/_base/sniff dojo/dom-style dojo/dom-geometry dojo/keys dijit dojo/dnd/Mover dojo/dnd/Moveable dijit/form/_FormValueWidget dijit/focus dojo/fx dojox/fx".split(" "),
function(G,u,r,n,m,k,d,a,b,e,g,h,c,f,l){var q=function(w,x){return w-x};e=G("dojox.form._RangeSliderMixin",null,{_setTabIndexAttr:["sliderHandle","sliderHandleMax"],value:[0,100],postMixInProperties:function(){this.inherited(arguments);this.value=r.map(this.value,function(w){return parseInt(w,10)})},postCreate:function(){this.inherited(arguments);this.value.sort(q);var w=this,x=G(t,{constructor:function(){this.widget=w}});this._movableMax=new h(this.sliderHandleMax,{mover:x});this.sliderHandle.setAttribute("aria-valuemin",
this.minimum);this.sliderHandle.setAttribute("aria-valuemax",this.maximum);this.sliderHandleMax.setAttribute("aria-valuemin",this.minimum);this.sliderHandleMax.setAttribute("aria-valuemax",this.maximum);x=G(v,{constructor:function(){this.widget=w}});this._movableBar=new h(this.progressBar,{mover:x});this.focusNode.removeAttribute("aria-valuemin");this.focusNode.removeAttribute("aria-valuemax");this.focusNode.removeAttribute("aria-valuenow")},destroy:function(){this.inherited(arguments);this._movableMax.destroy();
this._movableBar.destroy()},_onKeyPress:function(w){if(!(this.disabled||this.readOnly||w.altKey||w.ctrlKey)){var x=w.target===this.sliderHandleMax,H=w.target===this.progressBar,A=u.delegate(b,this.isLeftToRight()?{PREV_ARROW:b.LEFT_ARROW,NEXT_ARROW:b.RIGHT_ARROW}:{PREV_ARROW:b.RIGHT_ARROW,NEXT_ARROW:b.LEFT_ARROW}),z=0,E=!1;switch(w.keyCode){case A.HOME:this._setValueAttr(this.minimum,!0,x);m.stop(w);return;case A.END:this._setValueAttr(this.maximum,!0,x);m.stop(w);return;case A.PREV_ARROW:case A.DOWN_ARROW:E=
!0;case A.NEXT_ARROW:case A.UP_ARROW:z=1;break;case A.PAGE_DOWN:E=!0;case A.PAGE_UP:z=this.pageIncrement;break;default:this.inherited(arguments);return}E&&(z=-z);z&&(H?this._bumpValue([{change:z,useMaxValue:!1},{change:z,useMaxValue:!0}]):this._bumpValue(z,x),m.stop(w))}},_onHandleClickMax:function(w){this.disabled||this.readOnly||(k("ie")||f.focus(this.sliderHandleMax),m.stop(w))},_onClkIncBumper:function(){this._setValueAttr(!1===this._descending?this.minimum:this.maximum,!0,!0)},_bumpValue:function(w,
x){w=u.isArray(w)?[this._getBumpValue(w[0].change,w[0].useMaxValue),this._getBumpValue(w[1].change,w[1].useMaxValue)]:this._getBumpValue(w,x);this._setValueAttr(w,!0,x)},_getBumpValue:function(w,x){var H=x?1:0;x=d.getComputedStyle(this.sliderBarContainer);var A=a.getContentBox(this.sliderBarContainer,x);x=this.discreteValues;H=this.value[H];if(1>=x||Infinity==x)x=A[this._pixelCount];x--;w=this.maximum>this.minimum?(H-this.minimum)*x/(this.maximum-this.minimum)+w:0;0>w&&(w=0);w>x&&(w=x);return w*(this.maximum-
this.minimum)/x+this.minimum},_onBarClick:function(w){this.disabled||this.readOnly||(k("ie")||f.focus(this.progressBar),m.stop(w))},_onRemainingBarClick:function(w){if(!this.disabled&&!this.readOnly){k("ie")||f.focus(this.progressBar);var x=a.position(this.sliderBarContainer,!0),H=a.position(this.progressBar,!0),A=w[this._mousePixelCoord],z=H[this._startingPixelCoord];H=z+H[this._pixelCount];z=this._isReversed()?A<=z:A>=H;A=this._isReversed()?x[this._pixelCount]-A+x[this._startingPixelCoord]:A-x[this._startingPixelCoord];
this._setPixelValue(A,x[this._pixelCount],!0,z);m.stop(w)}},_setPixelValue:function(w,x,H,A){this.disabled||this.readOnly||(w=this._getValueByPixelValue(w,x),this._setValueAttr(w,H,A))},_getValueByPixelValue:function(w,x){var H=this.discreteValues;if(1>=H||Infinity==H)H=x;H--;return(this.maximum-this.minimum)*Math.round((0>w?0:x<w?x:w)/(x/H))/H+this.minimum},_setValueAttr:function(w,x,H){var A=u.clone(this.value);u.isArray(w)?A=w:A[H?1:0]=w;this._lastValueReported="";this.valueNode.value=w=A;A.sort(q);
this.sliderHandle.setAttribute("aria-valuenow",A[0]);this.sliderHandleMax.setAttribute("aria-valuenow",A[1]);c.prototype._setValueAttr.apply(this,arguments);this._printSliderBar(x,H)},_printSliderBar:function(w,x){x=this.maximum>this.minimum?(this.value[0]-this.minimum)/(this.maximum-this.minimum):0;var H=this.maximum>this.minimum?(this.value[1]-this.minimum)/(this.maximum-this.minimum):0,A=x;x>H&&(x=H,H=A);var z=this._isReversed()?100*(1-x):100*x,E=this._isReversed()?100*(1-H):100*H,J=this._isReversed()?
100*(1-H):100*x;if(w&&0<this.slideDuration&&this.progressBar.style[this._progressPixelSize]){if(parseFloat(this.progressBar.style[this._handleOffsetCoord]),w=this.slideDuration/10,0!==w){0>w&&(w=0-w);var D={},L={};A={};D[this._handleOffsetCoord]={start:this.sliderHandle.parentNode.style[this._handleOffsetCoord],end:z,units:"%"};L[this._handleOffsetCoord]={start:this.sliderHandleMax.parentNode.style[this._handleOffsetCoord],end:E,units:"%"};A[this._handleOffsetCoord]={start:this.progressBar.style[this._handleOffsetCoord],
end:J,units:"%"};A[this._progressPixelSize]={start:this.progressBar.style[this._progressPixelSize],end:100*(H-x),units:"%"};x=n.animateProperty({node:this.sliderHandle.parentNode,duration:w,properties:D});H=n.animateProperty({node:this.sliderHandleMax.parentNode,duration:w,properties:L});w=n.animateProperty({node:this.progressBar,duration:w,properties:A});l.combine([x,H,w]).play()}}else this.sliderHandle.parentNode.style[this._handleOffsetCoord]=z+"%",this.sliderHandleMax.parentNode.style[this._handleOffsetCoord]=
E+"%",this.progressBar.style[this._handleOffsetCoord]=J+"%",this.progressBar.style[this._progressPixelSize]=100*(H-x)+"%"}});var t=G("dijit.form._SliderMoverMax",g,{onMouseMove:function(w){var x=this.widget,H=x._abspos;H||(H=x._abspos=a.position(x.sliderBarContainer,!0),x._setPixelValue_=u.hitch(x,"_setPixelValue"),x._isReversed_=x._isReversed());w=w[x._mousePixelCoord]-H[x._startingPixelCoord];x._setPixelValue_(x._isReversed_?H[x._pixelCount]-w:w,H[x._pixelCount],!1,!0)},destroy:function(w){g.prototype.destroy.apply(this,
arguments);var x=this.widget;x._abspos=null;x._setValueAttr(x.value,!0)}}),v=G("dijit.form._SliderBarMover",g,{onMouseMove:function(w){var x=this.widget;if(!x.disabled&&!x.readOnly){var H=x._abspos,A=x._bar,z=x._mouseOffset;H||(H=x._abspos=a.position(x.sliderBarContainer,!0),x._setPixelValue_=u.hitch(x,"_setPixelValue"),x._getValueByPixelValue_=u.hitch(x,"_getValueByPixelValue"),x._isReversed_=x._isReversed());A||(A=x._bar=a.position(x.progressBar,!0));z||(z=x._mouseOffset=w[x._mousePixelCoord]-A[x._startingPixelCoord]);
w=w[x._mousePixelCoord]-H[x._startingPixelCoord]-z;pixelValues=[w,w+A[x._pixelCount]];pixelValues.sort(q);0>=pixelValues[0]&&(pixelValues[0]=0,pixelValues[1]=A[x._pixelCount]);pixelValues[1]>=H[x._pixelCount]&&(pixelValues[1]=H[x._pixelCount],pixelValues[0]=H[x._pixelCount]-A[x._pixelCount]);H=[x._getValueByPixelValue(x._isReversed_?H[x._pixelCount]-pixelValues[0]:pixelValues[0],H[x._pixelCount]),x._getValueByPixelValue(x._isReversed_?H[x._pixelCount]-pixelValues[1]:pixelValues[1],H[x._pixelCount])];
x._setValueAttr(H,!1,!1)}},destroy:function(){g.prototype.destroy.apply(this,arguments);var w=this.widget;w._abspos=null;w._bar=null;w._mouseOffset=null;w._setValueAttr(w.value,!0)}});return e})},"dojox/fx":function(){define(["./fx/_base"],function(G){return G})},"dojox/fx/_base":function(){define("dojo/_base/array dojo/_base/lang dojo/_base/fx dojo/fx dojo/dom dojo/dom-style dojo/dom-geometry dojo/_base/connect dojo/_base/html".split(" "),function(G,u,r,n,m,k,d,a,b){G=u.getObject("dojox.fx",!0);
u.mixin(G,{anim:r.anim,animateProperty:r.animateProperty,fadeTo:r._fade,fadeIn:r.fadeIn,fadeOut:r.fadeOut,combine:n.combine,chain:n.chain,slideTo:n.slideTo,wipeIn:n.wipeIn,wipeOut:n.wipeOut});G.sizeTo=function(e){var g=e.node=m.byId(e.node),h=e.method||"chain";e.duration||(e.duration=500);"chain"==h&&(e.duration=Math.floor(e.duration/2));var c,f,l,q,t,v=null,w=function(x){return function(){var H=k.getComputedStyle(x),A=H.position,z=H.width,E=H.height;c="absolute"==A?x.offsetTop:parseInt(H.top)||0;
l="absolute"==A?x.offsetLeft:parseInt(H.left)||0;t="auto"==z?0:parseInt(z);v="auto"==E?0:parseInt(E);q=l-Math.floor((e.width-t)/2);f=c-Math.floor((e.height-v)/2);"absolute"!=A&&"relative"!=A&&(H=k.coords(x,!0),c=H.y,l=H.x,x.style.position="absolute",x.style.top=c+"px",x.style.left=l+"px")}}(g);g=r.animateProperty(u.mixin({properties:{height:function(){w();return{end:e.height||0,start:v}},top:function(){return{start:c,end:f}}}},e));h=r.animateProperty(u.mixin({properties:{width:function(){return{start:t,
end:e.width||0}},left:function(){return{start:l,end:q}}}},e));return n["combine"==e.method?"combine":"chain"]([g,h])};G.slideBy=function(e){var g,h,c=function(f){return function(){var l=k.getComputedStyle(f),q=l.position;g="absolute"==q?f.offsetTop:parseInt(l.top)||0;h="absolute"==q?f.offsetLeft:parseInt(l.left)||0;"absolute"!=q&&"relative"!=q&&(l=d.coords(f,!0),g=l.y,h=l.x,f.style.position="absolute",f.style.top=g+"px",f.style.left=h+"px")}}(e.node=m.byId(e.node));c();e=r.animateProperty(u.mixin({properties:{top:g+
(e.top||0),left:h+(e.left||0)}},e));a.connect(e,"beforeBegin",e,c);return e};G.crossFade=function(e){var g=e.nodes[0]=m.byId(e.nodes[0]),h=b.style(g,"opacity"),c=e.nodes[1]=m.byId(e.nodes[1]);b.style(c,"opacity");return n.combine([r[0==h?"fadeIn":"fadeOut"](u.mixin({node:g},e)),r[0==h?"fadeOut":"fadeIn"](u.mixin({node:c},e))])};G.highlight=function(e){var g=e.node=m.byId(e.node);e.duration=e.duration||400;var h=e.color||"#ffff99",c=b.style(g,"backgroundColor");"rgba(0, 0, 0, 0)"==c&&(c="transparent");
e=r.animateProperty(u.mixin({properties:{backgroundColor:{start:h,end:c}}},e));"transparent"==c&&a.connect(e,"onEnd",e,function(){g.style.backgroundColor=c});return e};G.wipeTo=function(e){e.node=m.byId(e.node);var g=e.node,h=g.style,c=e.width?"width":"height",f={};f[c]={start:function(){h.overflow="hidden";if("hidden"==h.visibility||"none"==h.display)return h[c]="1px",h.display="",h.visibility="",1;var l=b.style(g,c);return Math.max(l,1)},end:e[c]};return r.animateProperty(u.mixin({properties:f},
e))};return G})},"dojox/form/HorizontalRangeSlider":function(){define(["dojo/_base/declare","dojox/form/_RangeSliderMixin","dojo/text!./resources/HorizontalRangeSlider.html","dijit/form/HorizontalSlider"],function(G,u,r,n){return G("dojox.form.HorizontalRangeSlider",[n,u],{templateString:r})})},"dojox/form/VerticalRangeSlider":function(){define(["dojo/_base/declare","dojox/form/_RangeSliderMixin","dojo/text!./resources/VerticalRangeSlider.html","dijit/form/VerticalSlider"],function(G,u,r,n){return G("dojox.form.VerticalRangeSlider",
[n,u],{templateString:r})})},"dijit/form/VerticalSlider":function(){define(["dojo/_base/declare","./HorizontalSlider","dojo/text!./templates/VerticalSlider.html"],function(G,u,r){return G("dijit.form.VerticalSlider",u,{templateString:r,_mousePixelCoord:"pageY",_pixelCount:"h",_startingPixelCoord:"y",_handleOffsetCoord:"top",_progressPixelSize:"height",_descending:!0,_isReversed:function(){return this._descending}})})},"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',
"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/ProgressBar.html":'\x3cdiv class\x3d"dijitProgressBar dijitProgressBarEmpty" role\x3d"progressbar"\r\n\t\x3e\x3cdiv  data-dojo-attach-point\x3d"internalProgress" class\x3d"dijitProgressBarFull"\r\n\t\t\x3e\x3cdiv class\x3d"dijitProgressBarTile" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\x3e\x3cspan style\x3d"visibility:hidden"\x3e\x26#160;\x3c/span\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv data-dojo-attach-point\x3d"labelNode" class\x3d"dijitProgressBarLabel" id\x3d"${id}_label"\x3e\x3c/div\r\n\t\x3e\x3cspan data-dojo-attach-point\x3d"indeterminateHighContrastImage"\r\n\t\t   class\x3d"dijitInline dijitProgressBarIndeterminateHighContrastImage"\x3e\x3c/span\r\n\x3e\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/AttachmentEditor.html":"\x3cdiv class\x3d\"attachmentEditor\"\x3e\r\n    \x3cbr /\x3e\r\n    \x3cdiv\x3e\r\n        \x3cb\x3e${NLS_attachments}\x3c/b\x3e\r\n        \x3chr /\x3e\r\n        \x3cdiv dojoAttachPoint\x3d\"_attachmentError\" style\x3d'color:red;display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e\r\n        \x3cspan dojoAttachPoint\x3d'_attachmentList' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-type\x3d\"dijit/ProgressBar\" dojoAttachPoint\x3d\"_attachmentProgress\" indeterminate\x3d\"true\" style\x3d'display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e        \r\n        \x3cform dojoAttachPoint\x3d'_uploadForm'\x3e ${NLS_add}:\x26nbsp;\x26nbsp;\x3cinput type\x3d'file' name\x3d'attachment' dojoAttachPoint\x3d'_uploadField' /\x3e \x3c/form\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e",
"url:dijit/templates/Calendar.html":'\x3cdiv class\x3d"dijitCalendarContainer dijitInline" role\x3d"presentation" aria-labelledby\x3d"${id}_mddb ${id}_year"\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarMonthContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarDecrementArrow\' data-dojo-attach-point\x3d"decrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarDecrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"decreaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e-\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarIncrementArrow\' data-dojo-attach-point\x3d"incrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarIncrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"increaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e+\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"monthNode" class\x3d"dijitInline"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"grid" data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\x3cthead\x3e\r\n\t\t\t\x3ctr role\x3d"row"\x3e\r\n\t\t\t\t${!dayCellsHtml}\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/thead\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"dateRowsNode" data-dojo-attach-event\x3d"ondijitclick: _onDayClick" class\x3d"dijitReset dijitCalendarBodyContainer"\x3e\r\n\t\t\t\t${!dateRowsHtml}\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarYearContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dijitCalendarYearLabel"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"previousYearLabelNode" class\x3d"dijitInline dijitCalendarPreviousYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"currentYearLabelNode" class\x3d"dijitInline dijitCalendarSelectedYear" role\x3d"button" id\x3d"${id}_year"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"nextYearLabelNode" class\x3d"dijitInline dijitCalendarNextYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:esri/dijit/templates/AttributeInspector.html":'\x3cdiv class\x3d"esriAttributeInspector"\x3e\r\n    \x3cdiv class\x3d"atiLayerName" dojoAttachPoint\x3d"layerName"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiAttributes" dojoAttachPoint\x3d"attributeTable"\x3e\x3c/div\x3e\r\n    \x3cdiv dojoAttachPoint\x3d"attachmentEditor"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiEditorTrackingInfo" dojoAttachPoint\x3d"editorTrackingInfoDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"atiButtons" dojoAttachPoint\x3d"editButtons"\x3e\r\n        \x3cbutton  dojoType\x3d"dijit.form.Button" class\x3d"atiButton atiDeleteButton"  dojoAttachPoint\x3d"deleteBtn" dojoAttachEvent\x3d"onClick: onDeleteBtn" showLabel\x3d"true" type\x3d"button"\x3e${NLS_deleteFeature}\x3c/button\x3e\r\n        \x3cdiv class\x3d"atiNavButtons" dojoAttachPoint\x3d"navButtons"\x3e\r\n            \x3cdiv class\x3d"atiNavMessage" dojoAttachPoint\x3d"navMessage"\x3e\x3c/div\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiFirstIcon" dojoAttachPoint\x3d"firstFeatureButton" dojoAttachEvent\x3d"onClick: onFirstFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_first}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiPrevIcon" dojoAttachPoint\x3d"prevFeatureButton" dojoAttachEvent\x3d"onClick: onPreviousFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiNextIcon" dojoAttachPoint\x3d"nextFeatureButton" dojoAttachEvent\x3d"onClick: onNextFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\r\n            \x3cbutton  dojoType\x3d"dijit.form.Button" iconClass\x3d"atiButton atiLastIcon" dojoAttachPoint\x3d"lastFeatureButton" dojoAttachEvent\x3d"onClick: onLastFeature" showLabel\x3d"false" type\x3d"button"\x3e${NLS_last}\x3c/button\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dojox/grid/resources/View.html":'\x3cdiv class\x3d"dojoxGridView" role\x3d"presentation"\x3e\r\n\t\x3cdiv class\x3d"dojoxGridHeader" dojoAttachPoint\x3d"headerNode" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv dojoAttachPoint\x3d"headerNodeContainer" style\x3d"width:9000em" role\x3d"presentation"\x3e\r\n\t\t\t\x3cdiv dojoAttachPoint\x3d"headerContentNode" role\x3d"row"\x3e\x3c/div\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cinput type\x3d"checkbox" class\x3d"dojoxGridHiddenFocus" dojoAttachPoint\x3d"hiddenFocusNode" aria-hidden\x3d"true" /\x3e\r\n\t\x3cinput type\x3d"checkbox" class\x3d"dojoxGridHiddenFocus" aria-hidden\x3d"true" /\x3e\r\n\t\x3cdiv class\x3d"dojoxGridScrollbox" dojoAttachPoint\x3d"scrollboxNode" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dojoxGridContent" dojoAttachPoint\x3d"contentNode" hidefocus\x3d"hidefocus" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dojox/grid/resources/_Grid.html":'\x3cdiv hidefocus\x3d"hidefocus" role\x3d"grid" dojoAttachEvent\x3d"onmouseout:_mouseOut"\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterHeader" dojoAttachPoint\x3d"viewsHeaderNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterView" dojoAttachPoint\x3d"viewsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n\t\x3cdiv class\x3d"dojoxGridMasterMessages" style\x3d"display: none;" dojoAttachPoint\x3d"messagesNode"\x3e\x3c/div\x3e\r\n\t\x3cspan dojoAttachPoint\x3d"lastFocusNode" tabindex\x3d"0"\x3e\x3c/span\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/editing/templates/TemplatePicker.html":'\x3cdiv class\x3d"templatePicker"\x3e\r\n\r\n  \x3ctable dojoType\x3d"dojox.grid.DataGrid" noDataMessage\x3d"${emptyMessage}" selectionMode\x3d"none" autoHeight\x3d"${_rows}" autoWidth\x3d"${_autoWidth}"\r\n         query\x3d"{ query: \'*\' }" dojoAttachPoint\x3d"grid" class\x3d"grid"\x3e\r\n  \x3c/table\x3e\r\n  \r\n\x3c/div\x3e',"url:esri/dijit/editing/templates/Editor.html":'\x3cdiv class\x3d"esriEditor"\x3e\r\n    \x3cdiv class\x3d"esriTemplatePicker" dojoAttachPoint\x3d"templatePickerDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"esriDrawingToolbar" dojoAttachPoint\x3d"drawingToolbarDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"progressBar" dojoAttachPoint\x3d"progressBar" indeterminate\x3d"true" dojoType\x3d"dijit.ProgressBar" /\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/BasemapGallery.html":'\x3cdiv class\x3d"esriBasemapGallery"\x3e\r\n  \x3cdiv dojoAttachPoint\x3d"flowContainer"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:esri/dijit/templates/Bookmarks.html":'\x3cdiv class\x3d"${_css.esriBookmarks}"\x3e\r\n  \x3cdiv class\x3d"${_css.esriBookmarkList}" dojoAttachPoint\x3d"bookmarkDomNode"\x3e\r\n      \x3cdiv class\x3d"${_css.esriBookmarkTable}" dojoAttachPoint\x3d"bookmarkTable"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:esri/dijit/templates/Directions.html":'\x3cdiv class\x3d"${options.theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_widgetContainer" class\x3d"${_css.widgetContainerClass}" role\x3d"presentation"\x3e\r\n        \x3cdiv class\x3d"${_css.stopsContainerClass}" role\x3d"presentation"\x3e\r\n            \x3cdiv id\x3d"search-source-container" class\x3d"${_css.searchSourceContainerClass}" data-dojo-attach-point\x3d"_searchSourceContainerNode"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_searchSourceSelectorContainer"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsTableContainerClass}"\x3e\r\n                \x3ctable class\x3d"${_css.stopsClass}" data-dojo-attach-point\x3d"_dndNode"\x3e\x3c/table\x3e\r\n                \x3cdiv class\x3d"${_css.stopsTableCoverClass}" data-dojo-attach-point\x3d"_stopsTableCover"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsButtonContainerClass}"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsAddDestinationClass}"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_activateButtonNode" title\x3d"${_i18n.widgets.directions.activate}" class\x3d"${_css.activateButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsPressedButtonClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_lineBarrierButtonNode" title\x3d"${_i18n.widgets.directions.lineBarrier}" class\x3d"${_css.lineBarrierButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"${_css.linkButtonClass} ${_css.stopsAddDestinationBtnClass}" data-dojo-attach-point\x3d"_addDestinationNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.addDestination}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.travelModesContainerClass}" data-dojo-attach-point\x3d"_travelModeContainerNode"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_travelModeSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} startTimeMenuButton" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_startTimeButtonNodeContainer"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_startTimeButtonNode"\x3e\r\n                        \x3cspan data-dojo-attach-point\x3d"_startTimeButtonLabel"\x3e${_i18n.widgets.directions.leaveNow}\x3c/span\x3e\r\n                        \x3cdiv data-dojo-attach-point\x3d"_startTimeDDLArrow" class\x3d"esriDirectionsDDLArrow"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"startTimeMenu" data-dojo-attach-point\x3d"_startTimeMenu"\x3e\r\n                        \x3cul role\x3d"menu"\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuLeaveNow" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio" aria-checked\x3d"true"\x3e${_i18n.widgets.directions.leaveNow}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuDepartAt" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.departAt}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuNone" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.noStartTime}\x3c/li\x3e\r\n                        \x3c/ul\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsOptionsButtonClass}" data-dojo-attach-point\x3d"_optionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.showOptions}\x3c/div\x3e\r\n            \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3cdiv class\x3d"departAtContainer" data-dojo-attach-point\x3d"_departAtContainer"\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtTime" data-dojo-attach-point\x3d"_departAtTimeContainer"\x3e\x3c/div\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtDate" data-dojo-attach-point\x3d"_departAtDateContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass}" data-dojo-attach-point\x3d"_optionsMenuNode"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsCheckboxesClass}"\x3e\r\n                    \x3cul\x3e\r\n                        \x3cli class\x3d"${_css.stopsFindOptimalOrderClass}" data-dojo-attach-point\x3d"_findOptimalOrderItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_findOptimalOrderNode" type\x3d"checkbox" id\x3d"${id}_find_optimal_order" /\x3e\x3clabel for\x3d"${id}_find_optimal_order"\x3e${_i18n.widgets.directions.findOptimalOrder}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsReturnToStartClass}" data-dojo-attach-point\x3d"_returnToStartItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_returnToStartNode" type\x3d"checkbox" id\x3d"${id}_stopsReturnToStart" /\x3e\x3clabel for\x3d"${id}_stopsReturnToStart"\x3e${_i18n.widgets.directions.returnToStart}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsUseTrafficClass}" data-dojo-attach-point\x3d"_useTrafficItemNode" title\x3d"${_i18n.widgets.directions.trafficLabelLive}"\x3e\r\n                            \x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_useTrafficNode" type\x3d"checkbox" id\x3d"${id}_stopsUseTraffic" /\x3e\x3clabel for\x3d"${id}_stopsUseTraffic"\x3e${_i18n.widgets.directions.useTraffic}\x3c/label\x3e\r\n                            \x3ca data-dojo-attach-point\x3d"_trafficAvailabilityButton" style\x3d"display: none;" href\x3d"http://www.arcgis.com/home/item.html?id\x3db7a893e8e1e04311bd925ea25cb8d7c7" target\x3d"_blank"\x3e\x3cdiv class\x3d"esriTrafficAvailabilityButton" title\x3d"${_i18n.widgets.directions.seeTrafficAvailability}"\x3e\x3c/div\x3e\x3c/a\x3e\r\n                        \x3c/li\x3e\r\n                    \x3c/ul\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsToggleContainerClass}"\x3e\r\n                    \x3cdiv class\x3d"${_css.stopsOptionsUnitsContainerClass}"  data-dojo-attach-point\x3d"_agolDistanceUnitsNode"\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsMiClass} ${_css.stopsButtonClass}" data-dojo-attach-point\x3d"_useMilesNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriMiles.abbr}\x3c/div\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsKmClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabLastClass} ${_css.stopsPressedButtonClass}" data-dojo-attach-point\x3d"_useKilometersNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriKilometers.abbr}\x3c/div\x3e\r\n                        \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsGetDirectionsContainerClass}"\x3e\r\n                \x3cdiv class\x3d"getDirectionsBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} ${_css.stopsGetDirectionsClass} esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_getDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.getDirections}\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsClearDirectionsClass}" data-dojo-attach-point\x3d"_clearDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.clearDirections}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"savePrintBtnContainer" data-dojo-attach-point\x3d"_savePrintBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsSaveClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_saveMenuButton" title\x3d"${_i18n.widgets.directions.saveTitle}" \x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsPrintClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_printButton" title\x3d"${_i18n.widgets.directions.print}" \x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass} esriSaveContainer" data-dojo-attach-point\x3d"_saveMenuNode"\x3e\r\n                \x3cdiv class\x3d"esriLayerNameLabel"\x3e${_i18n.widgets.directions.layerName}\x3c/div\x3e\r\n                \x3cinput type\x3d"text" data-dojo-attach-point\x3d"_outputLayerContainer"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_folderSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} esriSaveButton esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_saveButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.save}\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"esriLinkButton esriSaveAsButton" data-dojo-attach-point\x3d"_saveAsButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.saveAs}\x3c/div\x3e\r\n            \x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n    \t\x3cdiv data-dojo-attach-point\x3d"_msgNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" role\x3d"presentation"\x3e\r\n        \t\x3cdiv class\x3d"${_css.routesContainerClass}" data-dojo-attach-point\x3d"_resultsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/Search/templates/Search.html":'\x3cdiv role\x3d"presentation" class\x3d"${theme}"\x3e\r\n  \x3cdiv role\x3d"presentation" class\x3d"${css.searchGroup}" data-dojo-attach-point\x3d"containerNode"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"expandNode" class\x3d"${css.searchExpandContainer}"\x3e\r\n      \x3cdiv class\x3d"${css.searchAnimateContainer}"\x3e\r\n        \x3cdiv role\x3d"button" title\x3d"${_i18n.widgets.Search.main.searchIn}" id\x3d"${id}_menu_button" class\x3d"${css.searchBtn} ${css.searchToggle}" tabindex\x3d"0" data-dojo-attach-point\x3d"sourcesBtnNode"\x3e\r\n          \x3cspan aria-hidden\x3d"true" role\x3d"presentation" class\x3d"${css.searchToggleIcon}"\x3e\x3c/span\x3e\x3cspan class\x3d"${css.searchSourceName}" data-dojo-attach-point\x3d"sourceNameNode"\x3e\x3c/span\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"${css.searchInputGroup}"\x3e\r\n          \x3cform data-dojo-attach-point\x3d"formNode"\x3e\r\n            \x3cinput maxlength\x3d"${maxLength}" autocomplete\x3d"off" type\x3d"text" tabindex\x3d"0" class\x3d"${css.searchInput}" value\x3d"${value}" aria-haspopup\x3d"true" id\x3d"${id}_input" data-dojo-attach-point\x3d"inputNode" role\x3d"textbox"\x3e\r\n          \x3c/form\x3e\r\n          \x3cdiv role\x3d"button" class\x3d"${css.searchClear}" tabindex\x3d"0" data-dojo-attach-point\x3d"clearNode"\x3e\x3cspan aria-hidden\x3d"true" class\x3d"${css.searchClearIcon}"\x3e\x3c/span\x3e\x3cspan aria-hidden\x3d"true" class\x3d"${css.searchSpinner}"\x3e\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"suggestionsNode" class\x3d"${css.searchMenu} ${css.suggestionsMenu}"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv role\x3d"button" title\x3d"${_i18n.widgets.Search.main.searchButtonTitle}" class\x3d"${css.searchBtn} ${css.searchSubmit}" tabindex\x3d"0" data-dojo-attach-point\x3d"submitNode"\x3e\r\n      \x3cspan aria-hidden\x3d"true" role\x3d"presentation" class\x3d"${css.searchIcon}"\x3e\x3c/span\x3e\r\n      \x3cspan class\x3d"${css.searchButtonText}"\x3e${_i18n.widgets.Search.main.searchButtonTitle}\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"sourcesNode" class\x3d"${css.searchMenu} ${css.sourcesMenu}"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"noResultsMenuNode" class\x3d"${css.searchMenu} ${css.searchNoResultsMenu}"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"${css.searchClearFloat}"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/Gauge.html":'\x3cdiv class\x3d"gaugeContainer"\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"titleNode" class\x3d"gaugeTitle"\x3e${title}\x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"dataLabelWrapperNode"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"dataLabelNode"\x3e${dataLabel}\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"gaugeNode" style\x3d"margin: -10px auto 10px auto; width: 240px; height: 120px;"\x3e\x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"captionNode" class\x3d"gaugeCaption"\x3e${caption}\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/templates/Geocoder.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv class\x3d"${_css.GeocoderContainerClass}" role\x3d"presentation"\x3e\r\n    \t\x3cdiv class\x3d"${_css.GeocoderClass}" data-dojo-attach-point\x3d"containerNode" role\x3d"presentation"\x3e\r\n    \t\t\x3cdiv title\x3d"${_i18n.widgets.Geocoder.main.searchButtonTitle}" tabindex\x3d"0" class\x3d"${_css.searchButtonClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"submitNode" role\x3d"button"\x3e\x3c/div\x3e\r\n    \t\t\x3cdiv aria-haspopup\x3d"true" id\x3d"${id}_menu_button" title\x3d"${_i18n.widgets.Geocoder.main.geocoderMenuButtonTitle}" tabindex\x3d"0" class\x3d"${_css.geocoderMenuArrowClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"geocoderMenuArrowNode" role\x3d"button" aria-expanded\x3d"false"\x3e\x3c/div\x3e\r\n    \t\t\x3cinput aria-haspopup\x3d"true" id\x3d"${id}_input" tabindex\x3d"0" placeholder\x3d"" value\x3d"${value}" autocomplete\x3d"off" type\x3d"text" data-dojo-attach-point\x3d"inputNode" role\x3d"textbox"\x3e\r\n    \t\t\x3cdiv tabindex\x3d"0" class\x3d"${_css.clearButtonClass} ${_css.GeocoderIconClass}" data-dojo-attach-point\x3d"clearNode" role\x3d"button"\x3e\x3c/div\x3e\r\n    \t\t\x3cdiv class\x3d"${_css.GeocoderClearClass}" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" data-dojo-attach-point\x3d"resultsNode" aria-labelledby\x3d"${id}_input" role\x3d"menu" aria-hidden\x3d"true"\x3e\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.geocoderMenuClass}" data-dojo-attach-point\x3d"geocoderMenuNode" role\x3d"presentation"\x3e\r\n    \t\t\x3cdiv class\x3d"${_css.geocoderMenuHeaderClass}"\x3e\r\n    \t\t\t${_i18n.widgets.Geocoder.main.geocoderMenuHeader}\r\n    \t\t\t\x3cdiv role\x3d"button" data-dojo-attach-point\x3d"geocoderMenuCloseNode" title\x3d"${_i18n.widgets.Geocoder.main.geocoderMenuCloseTitle}" tabindex\x3d"0" class\x3d"${_css.geocoderMenuCloseClass}"\x3e\x3c/div\x3e\r\n    \t\t\t\x3cdiv class\x3d"${_css.GeocoderClearClass}" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\t\x3c/div\x3e\r\n    \t\t\x3cdiv data-dojo-attach-point\x3d"geocoderMenuInsertNode" aria-labelledby\x3d"${id}_menu_button" role\x3d"menu" aria-hidden\x3d"true"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/InfoWindow.html":'\x3cdiv id\x3d"${id}.infowindow" class\x3d"infowindow" dojoAttachPoint\x3d"_infowindow"\r\n  \x3e\x3cdiv style\x3d"position:relative;"\r\n    \x3e\x3cdiv class\x3d"window" dojoAttachPoint\x3d"_window"\r\n      \x3e\x3cdiv class\x3d"top"\r\n        \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_topleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n    \t\t\x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_topright"\r\n    \t\t\t\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\r\n    \t\t\t\x3e\x3cdiv class\x3d"user" dojoAttachPoint\x3d"_user"\r\n    \t\t\t  \x3e\x3cdiv class\x3d"titlebar" dojoAttachPoint\x3d"_titlebar"\r\n    \t\t\t    \x3e\x3ca class\x3d"hide" dojoAttachPoint\x3d"_hide" dojoAttachEvent\x3d"onclick:hide"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/a\r\n              \x3e\x3cdiv class\x3d"title" dojoAttachPoint\x3d"_title"\x3e${title}\x3c/div\r\n    \t\t\t  \x3e\x3c/div\r\n            \x3e\x3cdiv class\x3d"border" dojoAttachPoint\x3d"_border"\x3e\x3c/div\r\n    \t\t\t  \x3e\x3cdiv class\x3d"layout content" dojoAttachPoint\x3d"_content, containerNode"\r\n    \t\t\t  \x3e\x3c/div\r\n    \t\t\t\x3e\x3c/div\r\n    \t\t\x3e\x3c/div\r\n        \x3e\x3cdiv class\x3d"bottom"\r\n          \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_bottomleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n\t\t      \x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_bottomright"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n        \x3e\x3c/div\r\n      \x3e\x3c/div\r\n    \x3e\x3c/div\r\n    \x3e\x3cdiv class\x3d"pointer" dojoAttachPoint\x3d"_pointer"\x3e\x3cdiv dojoAttachPoint\x3d"_sprite" class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n  \x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:esri/dijit/templates/Measurement.html":"\x3cdiv class\x3d\"esriMeasurement\"\x3e\r\n  \x3cdiv dojoType\x3d'dijit.layout.ContentPane' class\x3d'esriMeasurementButtonContainer'\x3e\r\n    \x3cdiv dojoType\x3d'dijit.form.ToggleButton' baseClass\x3d'esriButton' dojoAttachPoint\x3d'_areaButton' iconClass\x3d'areaIcon' showLabel\x3d'false' dojoAttachEvent\x3d'onClick:_areaButtonToggle'\x3e\x3c/div\x3e\r\n    \x3cdiv dojoType\x3d'dijit.form.ToggleButton' baseClass\x3d'esriButton' dojoAttachPoint\x3d'_distanceButton' iconClass\x3d'distanceIcon' showLabel\x3d'false' dojoAttachEvent\x3d'onClick:_distanceButtonToggle'\x3e\x3c/div\x3e\r\n    \x3cdiv dojoType\x3d'dijit.form.ToggleButton' baseClass\x3d'esriButton' dojoAttachPoint\x3d'_locationButton' iconClass\x3d'locationIcon' showLabel\x3d'false' dojoAttachEvent\x3d'onClick:_locationButtonToggle'\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d\"esriMeasurementSeparator\"\x3e|\x3c/div\x3e\r\n    \x3cbutton dojoType\x3d'dijit.form.DropDownButton' baseClass\x3d'esriToggleButton' dojoAttachPoint\x3d'_unitDropDown' label\x3d'unit' value\x3d'unit' style\x3d'visibility:hidden;'\x3e\x3c/button\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv dojoType\x3d'dijit.layout.ContentPane' dojoAttachPoint\x3d'resultLabel' class\x3d'resultLabel esriMeasurementResultLabel'\x3e\x3c/div\x3e\r\n  \x3cdiv dojoType\x3d'dijit.layout.ContentPane' dojoAttachPoint\x3d'resultValueContainer' align\x3d'leading' class\x3d\"esriMeasurementResultValue\"\x3e\r\n    \x3cdiv dojoType\x3d'dijit.layout.ContentPane' dojoAttachPoint\x3d'resultValue' class\x3d'result'\x3e\x26nbsp;\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv dojoType\x3d'dijit.layout.ContentPane' dojoAttachPoint\x3d'resultTable' align\x3d'leading' class\x3d\"resultTable esriMeasurementTableContainer\" style\x3d\"display:none;\"\x3e\r\n    \x3ctable class\x3d\"esriMeasurementResultTable\"\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd class\x3d\"esriMeasurementTableHeader\" colspan\x3d\"2\"\x3e${_NLS_Lat}\x3c/td\x3e\x3ctd class\x3d\"esriMeasurementTableHeader\"\x3e${_NLS_Lon}\x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d\"esriMeasurementTableRow\" dojoAttachPoint\x3d\"_mouseRow\"\x3e\r\n        \x3ctd dojoAttachPoint\x3d\"mouseCell\"\x3e\x3c/td\x3e\r\n        \x3ctd class\x3d\"esriMeasurementTableCell\"\x3e\r\n          \x3cspan dojoAttachPoint\x3d\"mouseLatitude\" dir\x3d'ltr'\x3e\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d\"esriMeasurementTableCell\"\x3e\r\n          \x3cspan dojoAttachPoint\x3d\"mouseLongitude\" dir\x3d'ltr'\x3e\x3c/span\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr class\x3d\"esriMeasurementTableRow\"\x3e\r\n        \x3ctd dojoAttachPoint\x3d\"pinCell\"\x3e\x3c/td\x3e\r\n        \x3ctd class\x3d\"esriMeasurementTableCell\"\x3e\r\n          \x3cspan dojoAttachPoint\x3d\"markerLatitude\" dir\x3d'ltr'\x3e\x3c/span\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd class\x3d\"esriMeasurementTableCell\"\x3e\r\n          \x3cspan dojoAttachPoint\x3d\"markerLongitude\" dir\x3d'ltr'\x3e\x3c/span\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e",
"url:esri/dijit/templates/OverviewMap.html":'\x3cdiv class\x3d"esriOverviewMap"\x3e\r\n  \x3cdiv class\x3d"ovwContainer" dojoattachpoint\x3d"_body" style\x3d"width: ${width}px; height: ${height}px;"\x3e\r\n    \x3cdiv id\x3d"${id}-map" style\x3d"width: 100%; height: 100%;"\x3e\r\n      \x3cdiv class\x3d"ovwHighlight" dojoattachpoint\x3d"_focusDiv" title\x3d"${NLS_drag}" style\x3d"border: 1px solid ${color}; background-color: ${color};"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"ovwButton ovwController" title\x3d"${NLS_show}" dojoattachpoint\x3d"_controllerDiv" dojoattachevent\x3d"onclick: _visibilityHandler"\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"ovwButton ovwMaximizer" title\x3d"${NLS_maximize}" dojoattachpoint\x3d"_maximizerDiv" dojoattachevent\x3d"onclick: _maximizeHandler"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:dojox/form/resources/HorizontalRangeSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH dojoxRangeSlider" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" dojoAttachEvent\x3d"onkeypress:_onKeyPress,onkeyup:_onKeyUp" role\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd dojoAttachPoint\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" tabIndex\x3d"-1" style\x3d"display:none" dojoAttachPoint\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" dojoAttachEvent\x3d"onmousedown:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput dojoAttachPoint\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv role\x3d"presentation" class\x3d"dojoxRangeSliderBarContainer" dojoAttachPoint\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" dojoAttachPoint\x3d"sliderHandle,focusNode" tabIndex\x3d"${tabIndex}" dojoAttachEvent\x3d"onmousedown:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" dojoAttachPoint\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" dojoAttachEvent\x3d"onmousedown:_onBarClick"\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" dojoAttachPoint\x3d"sliderHandleMax" tabIndex\x3d"${tabIndex}" dojoAttachEvent\x3d"onmousedown:_onHandleClickMax" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" dojoAttachPoint\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" dojoAttachEvent\x3d"onmousedown:_onRemainingBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" dojoAttachEvent\x3d"onmousedown:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" tabIndex\x3d"-1" style\x3d"display:none" dojoAttachPoint\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd dojoAttachPoint\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:dojox/form/resources/VerticalRangeSlider.html":'\x3ctable class\x3d"dijitReset dijitSlider dijitSliderV dojoxRangeSlider" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerV"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconV" tabIndex\x3d"-1" style\x3d"display:none" dojoAttachPoint\x3d"decrementButton" dojoAttachEvent\x3d"onclick: increment"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3ccenter\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperV dijitSliderTopBumper" dojoAttachEvent\x3d"onclick:_onClkIncBumper"\x3e\x3c/div\x3e\x3c/center\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd dojoAttachPoint\x3d"leftDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationL dijitSliderDecorationV" style\x3d"text-align:center;height:100%;"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" style\x3d"height:100%;"\r\n\t\t\t\x3e\x3cinput dojoAttachPoint\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3ccenter role\x3d"presentation" style\x3d"position:relative;height:100%;" dojoAttachPoint\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" dojoAttachPoint\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarV dijitSliderRemainingBar dijitSliderRemainingBarV" dojoAttachEvent\x3d"onmousedown:_onRemainingBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableV" style\x3d"vertical-align:top;" role\x3d"slider"\r\n\t\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderImageHandle dijitSliderImageHandleV" dojoAttachPoint\x3d"sliderHandle,focusNode" tabIndex\x3d"${tabIndex}" dojoAttachEvent\x3d"onkeypress:_onKeyPress,onmousedown:_onHandleClick"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3cdiv role\x3d"presentation" dojoAttachPoint\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarV dijitSliderProgressBar dijitSliderProgressBarV" dojoAttachEvent\x3d"onkeypress:_onKeyPress,onmousedown:_onBarClick"\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableV" style\x3d"vertical-align:top;" role\x3d"slider"\r\n\t\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderImageHandle dijitSliderImageHandleV" dojoAttachPoint\x3d"sliderHandleMax" tabIndex\x3d"${tabIndex}" dojoAttachEvent\x3d"onkeypress:_onKeyPress,onmousedown:_onHandleClickMax"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\x3e\x3c/center\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd dojoAttachPoint\x3d"containerNode,rightDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationR dijitSliderDecorationV" style\x3d"text-align:center;height:100%;"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3ccenter\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperV dijitSliderBottomBumper" dojoAttachEvent\x3d"onclick:_onClkDecBumper"\x3e\x3c/div\x3e\x3c/center\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerV"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconV" tabIndex\x3d"-1" style\x3d"display:none" dojoAttachPoint\x3d"incrementButton" dojoAttachEvent\x3d"onclick: decrement"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/VerticalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderV" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown,onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerV"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconV" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3ccenter\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperV dijitSliderTopBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\x3e\x3c/center\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"leftDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationL dijitSliderDecorationV"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderDecorationC" style\x3d"height:100%;"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3ccenter class\x3d"dijitReset dijitSliderBarContainerV" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarV dijitSliderRemainingBar dijitSliderRemainingBarV" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c!--#5629--\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarV dijitSliderProgressBar dijitSliderProgressBarV" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableV" style\x3d"vertical-align:top;"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleV" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\x3e\x3c/center\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,rightDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationR dijitSliderDecorationV"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3ccenter\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperV dijitSliderBottomBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\x3e\x3c/center\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerV"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconV" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:esri/dijit/templates/TimeSlider.html":'   \x3cdiv class\x3d"esriTimeSlider"\x3e\r\n   \x3ctable width\x3d"100%" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0"\x3e\r\n   \x3ctr\x3e\r\n   \x3ctd align\x3d"right" valign\x3d"middle"\x3e\x3cbutton dojoType\x3d"dijit.form.Button" showLabel\x3d"false" iconClass\x3d"tsButton tsPlayButton" dojoAttachEvent\x3d"onClick:_onPlay" dojoAttachPoint\x3d"playPauseBtn" type\x3d"button"\x3e${NLS_play}\x3c/button\x3e\x3c/td\x3e\r\n   \x3ctd align\x3d"center" valign\x3d"middle" width\x3d"80%" class\x3d"tsTmp"\x3e\x3c/td\x3e\r\n   \x3ctd align\x3d"left" valign\x3d"middle" width\x3d"30"\x3e\x3cbutton dojoType\x3d"dijit.form.Button" showLabel\x3d"false" iconClass\x3d"tsButton tsPrevButton" dojoAttachEvent\x3d"onClick:_onPrev" dojoAttachPoint\x3d"previousBtn" type\x3d"button"\x3e${NLS_previous}\x3c/button\x3e\x3c/td\x3e\r\n   \x3ctd align\x3d"left" valign\x3d"middle"\x3e\x3cbutton dojoType\x3d"dijit.form.Button" showLabel\x3d"false" iconClass\x3d"tsButton tsNextButton" dojoAttachEvent\x3d"onClick:_onNext" dojoAttachPoint\x3d"nextBtn" type\x3d"button"\x3e${NLS_next}\x3c/button\x3e\x3c/td\x3e\r\n   \x3c/tr\x3e    \r\n   \x3c/table\x3e\r\n   \x3c/div\x3e',
"*now":function(G){G(['dojo/i18n!*preload*esri/nls/widgets*["ar","bs","ca","cs","da","de","de-ch","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","fr-ch","he","hr","hu","id","it","it-ch","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},"*noref":1}});
define("esri/widgets","./layers/FeatureLayer ./toolbars/_toolbar ./toolbars/draw ./toolbars/edit ./tasks/geometry ./dijit/AttributeInspector ./dijit/editing/AttachmentEditor ./dijit/editing/Editor ./dijit/editing/TemplatePicker ./dijit/editing/Util ./dijit/editing/SelectionHelper ./dijit/_TouchBase ./dijit/BasemapGallery ./dijit/Bookmarks ./dijit/Directions ./dijit/Gallery ./dijit/Gauge ./dijit/Geocoder ./dijit/InfoView ./dijit/InfoWindow ./dijit/InfoWindowLite ./dijit/Legend ./dijit/Measurement ./dijit/NavigationBar ./dijit/OverviewMap ./dijit/Popup ./dijit/PopupMobile ./dijit/Print ./dijit/Scalebar ./dijit/TimeSlider".split(" "),function(){return{}});