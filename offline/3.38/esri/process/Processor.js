// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/process/Processor","../sniff ../kernel dojo/_base/declare dojo/Deferred dojo/_base/lang dojo/_base/array dojo/Evented ../workers/RequestClient ../layers/GraphicsLayer".split(" "),function(k,m,f,q,c,e,n,p,l){f=f([n],{declaredClass:"esri.process.Processor",layers:null,results:null,passFeatures:!0,drawFeatures:!0,requireWorkerSupport:!0,fetchWithWorker:!1,workerCallback:null,workerClient:null,_started:null,_handlers:null,constructor:function(a){a=a||{};c.mixin(this,a);k("esri-workers")||
!1===this.requireWorkerSupport&&!1===a.requireWorkerSupport?(this._handlers={},this._notifyProcessStart=c.hitch(this,this._notifyProcessStart),this._sendFeaturesFromTask=c.hitch(this,this._sendFeaturesFromTask),this._sendFeaturesFromLayer=c.hitch(this,this._sendFeaturesFromLayer),!1!==a.autostart&&this.start()):(console.log("Browser doesn't support workers \x26 worker support is required for this processor"),this.addLayer=this.setMap=this.start=this.runProcess=function(){},this._disabled=!0)},addLayer:function(a,
d){var b=a._task,h=this._handlers[a.id]=[],g="complete";!1===this.drawFeatures&&(a.suspendGraphics(!0),a.clearNodes());this.fetchWithWorker?(this.workerClient||(this.workerClient=p.getClient(this.workerCallback)),b.requestOptions={workerOptions:{worker:this.workerClient}},this.passFeatures&&h.push(b.on(g,c.partial(this._notifyProcessStart,a)))):this.passFeatures?(g=this.drawFeatures?"graphic-draw":"graphic-add",h.push(a.on(g,c.partial(this._sendFeaturesFromLayer,a)))):h.push(b.on(g,c.partial(this._sendFeaturesFromTask,
a)));!0!==d&&a.graphics&&this.runProcess(a.graphics,a.id)},removeLayer:function(a){e.forEach(this._handlers[a.id],function(d){d.remove()});delete this._handlers[a.id]},setMap:function(a){if(this.map)if(a!=this.map)this.unsetMap();else return;var d=this;e.forEach(this.layers,d.removeLayer);e.forEach(a.graphicsLayerIds,function(b){d.addLayer(a.getLayer(b))});this._handlers.map=[a.on("layer-add",function(b){b=b.layer;b.isInstanceOf(l)&&d.addLayer(b)}),a.on("layer-remove",function(b){b=b.layer;b.isInstanceOf(l)&&
d.removeLayer(b)})];this.map=a},unsetMap:function(){this.map&&(e.forEach(this._handlers.map,function(a){a.remove()}),delete this._handlers.map,e.forEach(this.layers,this.removeLayer),this.map=null)},start:function(){this.map?this.setMap(this.map):this.layers&&(c.isArray(this.layers)||(this.layers=[this.layers]),e.forEach(this.layers,this.addLayer));this._started=!0;this.emit("start",{processor:this});console.log("processor started")},stop:function(){this._started=!1;for(var a in this._handlers)this._handlers.hasOwnProperty(a)&&
(this._handlers[a].remove(),delete this._handlers[a]);this.emit("stop",{processor:this});console.log("processor stopped")},runProcess:function(a,d){},_sendFeaturesFromTask:function(){},_sendFeaturesFromLayer:function(){},_notifyProcessStart:function(){}});k("extend-esri")&&c.setObject("process.Processor",f,m);return f});