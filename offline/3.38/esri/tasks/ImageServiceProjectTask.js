// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/tasks/ImageServiceProjectTask","dojo/_base/declare dojo/_base/lang dojo/has dojo/_base/Deferred dojo/_base/array ../kernel ../request ../deferredUtils ./Task ../urlUtils ../geometry/jsonUtils".split(" "),function(k,l,q,r,t,u,v,w,x,y,m){k=k(x,{constructor:function(a){this._handler=l.hitch(this,this._handler)},execute:function(a,b,c){var d=new r(w._dfdCanceller),e=this._url||this._getImageServiceUrl(a);if(e){var f=this._encode(l.mixin({},e.query,{f:"json"},a.toJson())),g=this._handler,
h=this._errorHandler,n=m.getJsonType(a.geometries[0]),z=a.outSR;d._pendingDfd=v({url:e.path+"/project",content:f,callbackParamName:"callback",load:function(p){g(p,n,z,b,c,d)},error:function(p){h(p,c,d)}})}else d.reject("Input arguments do not contain image service URL.");return d},_handler:function(a,b,c,d,e,f){try{var g=this._decodeGeometries(a,b,c);this._successHandler([g],"onComplete",d,f)}catch(h){this._errorHandler(h,e,f)}},_encodeGeometries:function(a){var b=[],c,d=a.length;for(c=0;c<d;c++)b.push(a[c].toJson());
return{geometryType:m.getJsonType(a[0]),geometries:b}},_decodeGeometries:function(a,b,c){var d=m.getGeometryType(b),e=[],f={spatialReference:c},g=l.mixin;t.forEach(a.geometries,function(h,n){e[n]=new d(g(h,f))});return e},onComplete:function(){},_getImageServiceUrl:function(a){if(a&&a.geometries&&a.geometries.length&&a.outSR)if(a.geometries[0].spatialReference||a.geometries[0].spatialReference.url||a.outSR.url)if(a.geometries[0].spatialReference.url&&a.outSR.url&&a.geometries[0].spatialReference.url!==
a.outSR.url)this.onError(Error("Input and output spatial reference must be from one image service"));else var b=a.geometries[0].spatialReference&&a.geometries[0].spatialReference.url?a.geometries[0].spatialReference.url:a.outSR.url;else this.onError(Error("Spatial reference doesn't contain Image Service URL"));b&&(b=y.urlToObject(b));return b}});q("extend-esri")&&l.setObject("tasks.ImageServiceProjectTask",k,u);return k});