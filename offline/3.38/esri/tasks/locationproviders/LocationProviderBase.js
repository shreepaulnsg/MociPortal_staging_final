// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/tasks/locationproviders/LocationProviderBase","../../declare dojo/_base/lang dojo/promise/all dojo/Deferred dojo/when dojo/Evented ../../SpatialReference ../../geometry/jsonUtils ../../graphic ../../arcgis/csv".split(" "),function(D,z,E,A,F,G,H,B,I,J){return D("esri.tasks.locationproviders.LocationProviderBase",G,{geometryType:null,loaded:!1,constructor:function(b){z.mixin(this,b);setTimeout(z.hitch(this,this._init),0)},locate:function(b,d){function g(a){F(n).then(function(){for(var h=
[],p=a.concat(e).concat(c),t=0;t<b.length;t++){for(var w=b[t],C=!1,y=0;y<p.length;y++)if(p[y]===w){C=!0;break}C||(w&&w.setGeometry&&w.setGeometry(),h.push(w))}h={features:p,failed:h};q.emit("locate-complete",h);u.resolve(h)})}function x(a){for(var h={features:a},p=0;p<a.length;p++){var t=a[p];t.setGeometry(t.geometry)}q.emit("locate-progress",h);u.progress(h)}function f(a){a={error:a};q.emit("error",a);u.progress(a)}var u=new A,q=this,k=null,c=[],v=[],e=[];d=d||{};for(var r=0;r<b.length;r++){var l=
b[r];if(l&&l instanceof I){var m=l.geometry;m&&d.useExistingGeometries&&B.getJsonType(m)===this.geometryType?(k||(k=m.spatialReference),!m.spatialReference||d.outSpatialReference&&!m.spatialReference.equals(d.outSpatialReference)?e.push(l):c.push(l)):v.push(l)}}var n;e.length&&(n=this._project(e,d.outSpatialReference,k||new H(4326)).then(function(){x(e)}));c.length&&x(c);this.loaded?this._locate(v,d).then(g,f,x):f("not loaded");return u.promise},_init:function(){this.geometryType&&(this.loaded=!0,
this.emit("load"))},_project:function(b,d,g){function x(r,l){var m=new A;J._projectFeatureSet({featureSet:{geometryType:u.geometryType,features:r}},l,d,function(n){for(n=0;n<r.length;n++){var a=r[n];a&&a.geometry&&!a.geometry.toJson&&(a.geometry=B.fromJson(a.geometry))}m.resolve()});return m.promise}for(var f=[],u=this,q=0;q<b.length;q++){var k=b[q],c=k&&k.geometry;if(c&&(c.spatialReference||c.setSpatialReference(g),!d.equals(c.spatialReference))){for(var v,e=0;e<f.length;e++)v=f[e].sref.equals(c.spatialReference)&&
f[e].features;v?v.push(k):f.push({sref:c.spatialReference,features:[k]})}}b=[];for(g=0;g<f.length;g++)b.push(x(f[g].features,f[g].sref));return E(b)}})});