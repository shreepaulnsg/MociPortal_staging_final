// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/tasks/FeatureSet","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/Polygon ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(x,B,C,E,F,G,D,A,H,I,e,J){x=x(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(a,b){if(a){B.mixin(this,a);var q=this.features=this.features||[],k=a.spatialReference;k=this.spatialReference=e.createInstance(A.simpleConstructor,k);var r=e.getGeometryType(a.geometryType);
this.geometryType=a.geometryType;a.fields&&(this.fields=a.fields);a=e.supportsLazyUnquantization(this.geometryType);var l=e.unquantizeFunction(this.geometryType,this.transform),g=!!(b&&a&&l),y=r&&(g?r.accessorConstructor:r.simpleConstructor);C.forEach(q,function(m,u){var d=e.createInstance(D.simpleConstructor),h=m.geometry;if(r&&h){var p=d.geometry=e.createInstance(y,g?null:h);p.setSpatialReference(h.spatialReference?e.createInstance(A.simpleConstructor,h.spatialReference):k);g&&p.setupLazyUnquantization(l,
h)}d.symbol=m.symbol?J.fromJson(m.symbol):null;d.attributes=m.attributes;q[u]=d});g||this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(a){var b={};this.displayFieldName&&(b.displayFieldName=this.displayFieldName);this.fields&&(b.fields=this.fields);this.spatialReference?b.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(b.spatialReference=this.features[0].geometry.spatialReference.toJson());
this.features[0]&&(this.features[0].geometry&&(b.geometryType=e.getJsonType(this.features[0].geometry)),b.features=H._encodeGraphics(this.features,a));b.geometryType=b.geometryType||this.geometryType;b.exceededTransferLimit=this.exceededTransferLimit;b.transform=this.transform;return G.fixJson(b)},_hydrate:function(){e.unquantize(this.features,this.geometryType,this.transform);this.transform=null},quantize:function(a){if(!this.geometryType)return this.transform=null,this;var b=a.translate[0],q=a.translate[1],
k=a.scale[0],r=a.scale[1],l=this.features,g=function(d,h,p){var c,n=[];var v=0;for(c=d.length;v<c;v++){var f=d[v];if(0<v){var w=h(f[0]);f=p(f[1]);if(w!==t||f!==z){n.push([w-t,f-z]);var t=w;var z=f}}else t=h(f[0]),z=p(f[1]),n.push([t,z])}return 0<n.length?n:null},y=function(d,h,p){if("esriGeometryPoint"===d)return function(c){c.x=h(c.x);c.y=p(c.y);return c};if("esriGeometryPolyline"===d||"esriGeometryPolygon"===d)return function(c){var n;var v=c.rings||c.paths;var f=[];var w=0;for(n=v.length;w<n;w++){var t=
v[w];(t=g(t,h,p))&&f.push(t)}return 0<f.length?(c.rings?c.rings=f:c.paths=f,c):null};if("esriGeometryMultipoint"===d)return function(c){var n=g(c.points,h,p);return 0<n.length?(c.points=n,c):null};if("esriGeometryEnvelope"===d)return function(c){return c}}(this.geometryType,function(d){return Math.round((d-b)/k)},function(d){return Math.round((q-d)/r)}),m;var u=0;for(m=l.length;u<m;u++)l[u].geometry&&(y(l[u].geometry)||l[u].setGeometry(null));this.transform=a;return this}});x.createGraphics=function(a){var b=
a.geometryType,q=e.createInstance(A.simpleConstructor,a.spatialReference),k=e.getGeometryType(b).accessorConstructor,r=e.unquantizeFunction(b,a.transform);return C.map(a.features,function(l,g){g=e.createInstance(D.simpleConstructor);var y=l.geometry;if(y){var m=g.geometry=e.createInstance(k);m.setSpatialReference(q);m.setupLazyUnquantization(r,y)}g.attributes=l.attributes;return g})};x.createPolygon=function(a,b,q){if(a){var k=e.createInstance(I.accessorConstructor);k.setSpatialReference(b);b=e.unquantizeFunction("esriGeometryPolygon",
q);k.setupLazyUnquantization(b,a)}return k};E("extend-esri")&&B.setObject("tasks.FeatureSet",x,F);return x});