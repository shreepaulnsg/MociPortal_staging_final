// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/FeatureTable/templates/Grid.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"${css.borderContainer}" data-dojo-attach-point\x3d "_gridBorderContainerNode" data-dojo-type\x3d"dijit/layout/BorderContainer" gutters\x3d"false"\x3e\r\n    \x3cdiv class\x3d"${css.contentPane} ${css.menu}" data-dojo-attach-point\x3d "_gridHeaderNode" data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-props\x3d"region: \'top\'"\x3e\r\n      \x3cdiv class\x3d"${css.menuItem} ${css.loadingIndicator} ${css.hidden}" data-dojo-attach-point\x3d "_gridLoadingIndicatorNode"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"${css.menuItem} ${css.menuOptions}" data-dojo-attach-point\x3d "_menuNode" \x3e\r\n        \x3cdiv data-dojo-attach-point\x3d "_gridMenuNode"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"${css.menuItem} ${css.title}" data-dojo-attach-point\x3d "_gridTitleNode"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"${css.contentPane}" data-dojo-attach-point\x3d "_gridContentPaneNode" data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-props\x3d"region: \'center\'"\x3e\r\n      \x3cdiv class\x3d"${css.grid}" data-dojo-attach-point\x3d"_gridNode"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("esri/dijit/FeatureTable/Grid","../../kernel ../../arcadeProfiles/popupProfile ./dataUtils ./dialogUtils dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/aspect dojo/has dojo/keys dojo/on dojo/string dojo/dom-class dojo/dom-construct dojo/Deferred dojox/html/entities dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_WidgetBase dijit/a11yclick dijit/focus dijit/Menu dijit/MenuItem dijit/Tooltip dijit/form/Button dijit/form/DateTextBox dijit/form/DropDownButton dijit/form/NumberTextBox dijit/form/Select dijit/form/SimpleTextarea dijit/form/TimeTextBox dijit/form/ValidationTextBox dijit/layout/BorderContainer dijit/layout/ContentPane dgrid/OnDemandGrid dgrid/Selection dgrid/selector dgrid/Keyboard dgrid/editor dgrid/extensions/Pagination dgrid/extensions/DijitRegistry dgrid/extensions/ColumnHider dgrid/extensions/ColumnResizer dojo/i18n!../../nls/jsapi dojo/text!./templates/Grid.html".split(" "),
function(S,T,k,M,N,g,r,O,U,C,w,G,D,y,V,E,H,W,X,z,Y,P,F,Z,oa,Q,pa,I,J,R,aa,K,qa,ra,ba,ca,da,ea,fa,ha,ia,ja,ka,la,ma){H=N([X,H,W],{declaredClass:"esri.dijit.FeatureTable.Grid",baseClass:"esri-feature-table-grid",templateString:ma,map:null,layer:null,layerInfo:null,idProperty:"id",sort:null,defaultSort:null,filterIds:null,where:null,batchCount:50,editable:!1,editOn:"dblclick, keypress",css:null,showAttachments:!1,showRelatedRecords:!1,showCyclicalRelationships:!1,showStatistics:!1,showFieldDetails:!1,
showGridHeader:!0,showGridMenu:!0,showFilterMenuItems:!0,showDefaultSortMenuItem:!0,showFeatureCount:!0,showDataTypes:!1,showColumnHeaderTooltips:!1,showColumnHeaderTooltipsWithDescription:!1,showColumnHider:!1,syncSelection:!1,menuFunctions:null,columnMenuFunctions:null,gridOptions:null,dateOptions:null,visibleLayerIds:null,showExpressionFields:!1,loaded:!1,store:null,columns:null,fieldInfos:null,customFieldInfos:null,expressionInfos:null,expressionCache:{},noDataMessage:"",featureCount:0,selectedFeatureCount:0,
selectedRows:null,selectedRowIds:null,optionsMenu:null,optionsMenuAnchor:null,columnMenu:null,rollbackInfos:null,attachmentInfos:null,relatedRecordInfos:null,relatedRecordCounts:null,_i18nStrings:la.widgets.FeatureTable,_numericFieldTypes:["esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeSmallInteger","number"],_unsupportedFieldTypes:["esriFieldTypeRaster","esriFieldTypeBlob","esriFieldTypeGeometry","esriFieldTypeXML"],_activeEditors:[],_relationshipColumnLimit:5,_nullConstant:"ft_null",
_watchers:null,_tableTitle:null,_previousSelectedRowIds:null,_loading:0,_lastClickedCell:null,postMixInProperties:function(){this.inherited(arguments);this.set({sort:{},columns:[],fieldInfos:[],selectedRows:[],selectedRowIds:[],rollbackInfos:{},attachmentInfos:{},relatedRecordInfos:{},relatedRecordCounts:{},_watchers:[],_previousSelectedRowIds:[]})},startup:function(){this.inherited(arguments);this.showExpressionFields&&this.expressionInfos&&(this.expressionCache=k.compileExpressions(this.expressionInfos));
this.dGrid=this._generateBaseGrid();this._cleanUpGrid();this.dGrid.startup();this.dGrid.resize();this.updateHeaderText();this._generateOptionsMenu();this.showGridHeader||this.hideHeader();this.showGridMenu||this.hideOptionsMenu();this._addGridListeners()},destroy:function(){this.inherited(arguments);this.optionsMenu&&this.optionsMenu.destroy();this.columnMenu&&this.columnMenu.destroyRecursive();r.forEach(this._watchers,function(a){a.remove()})},resize:function(){this._gridBorderContainerNode&&this._gridBorderContainerNode.resize();
this._gridHeaderNode&&this._gridHeaderNode.resize();this._gridContentPaneNode&&this._gridContentPaneNode.resize();this.dGrid&&this.dGrid.resize()},setHeaderTitle:function(a){this._gridTitleNode&&(this._gridTitleNode.innerHTML=a)},showHeader:function(){D.remove(this._gridHeaderNode.domNode,this.css.hidden);this.resize()},hideHeader:function(){D.add(this._gridHeaderNode.domNode,this.css.hidden);this.resize()},showLoadingIndicator:function(){this._gridLoadingIndicatorNode&&0===this._loading&&D.remove(this._gridLoadingIndicatorNode,
this.css.hidden);this._loading++},hideLoadingIndicator:function(){this._loading--;this._gridLoadingIndicatorNode&&!this._loading&&D.add(this._gridLoadingIndicatorNode,this.css.hidden)},showOptionsMenu:function(){this._menuNode&&D.remove(this._menuNode,this.css.hidden)},hideOptionsMenu:function(){this._menuNode&&D.add(this._menuNode,this.css.hidden)},updateNoDataMessage:function(a){this.dGrid.set("noDataMessage",a)},showColumnHiderMenu:function(){this.gridOptions.columnHider&&this.dGrid._toggleColumnHiderMenu()},
refresh:function(){this.dGrid&&this.dGrid.refresh();0===this.featureCount&&this.hideLoadingIndicator();this._updateSelection().then(g.hitch(this,this.updateHeaderText))},getRowById:function(a){return this.dGrid.row(a)||{}},getRowDataById:function(a){return(a=this.getRowById(a))&&a.data?a.data:{}},emptyStore:function(){this.updateNoDataMessage("");this.updateStore(null)},updateStore:function(a){this.set("store",a);this.dGrid.set("store",a)},updateSort:function(a){this.set("sort",a[0]);this.dGrid.set("sort",
a)},updateSelectionMode:function(a){this.dGrid.set("selectionMode",a)},getColumns:function(){return this.dGrid.columns},styleColumn:function(a,b){return this.dGrid.styleColumn(a,b)},clearSelection:function(){this.dGrid.clearSelection();this._updateSelection().then(g.hitch(this,this.updateHeaderText));this.emit("clear-selection")},centerOnSelection:function(){var a=this.map,b=this.selectedRowIds;if(a&&b&&0!==b.length)return k.queryLayerForFeatures({layer:this.layer,ids:b}).then(g.hitch(function(c){(c=
c.features)&&0<c.length&&a.setExtent(k.calculateExtentFromFeatures(c))}))},selectRows:function(a,b,c){var d=this.dGrid,e=[];this._closeCellEditors();this.clearSelection();if(a instanceof Array){r.forEach(a,function(l){d._select(l);e.push(this.getRowById(l))},this);var f=a[0]}else d._select(a),f=a,e=[this.getRowById(a)];this._updateSelection().then(g.hitch(this,function(){this.updateHeaderText();c||this.emit("row-select",{rows:e,grid:this.dGrid});b&&this._scrollToRow(f)}))},_generateBaseGrid:function(){var a=
this.gridOptions||{},b=[ia,ba,ca,fa,da,ea];a.pagination&&b.push(ha);a.columnHider&&b.push(ja);a.columnResizer&&b.push(ka);return new (N(b))({columns:this.columns,sort:[this.defaultSort],noDataMessage:this.noDataMessage,selectionMode:a.selectionMode,allowSelectAll:a.allowSelectAll,allowTextSelection:a.allowTextSelection,cellNavigation:a.cellNavigation,keepScrollPosition:a.keepScrollPosition,pageSizeOptions:a.pageSizeOptions,queryRowsOverlap:a.queryRowsOverlap,minRowsPerPage:this.batchCount,maxRowsPerPage:this.batchCount,
pagingDelay:this.pagingDelay,query:g.hitch(this,this._getQueryForGrid)},this._gridNode)},_getQueryForGrid:function(a){return!this.filterIds||-1!==r.indexOf(this.filterIds,a[this.idProperty])},_cleanUpGrid:function(){var a=this.dGrid,b=O.before(a,"removeRow",g.hitch(this,function(d){r.forEach(this.columns.length,function(e,f){e=a.cell(d,f).element;(e=e.contents||e)&&e.widget&&e.widget.destroyRecursive()})})),c=O.after(a,"renderHeader",function(){a._sortListener.remove()});this._watchers.push(b,c)},
_setUpColumns:function(a){a=this._generateFieldInfos(a);var b=this._generateColumns(a);this.set({columns:b,fieldInfos:a});this.dGrid.set("columns",b);return{fieldInfos:a,columns:b}},_generateFieldInfos:function(a){if(a&&0!==a.length&&this.layerInfo){a=this._orderFieldsForDisplay(a);var b=this.layer,c=this.layerInfo,d=[],e=this.customFieldInfos;r.forEach(a,function(f){var l=f.name,h=f.length||null,p=k.findFirst(b.fields,"name",l)||{},m=k.findFirst(e,"name",l)||k.findFirst(e,"fieldName",l);if(k.isExpressionField(l)){p=
k.getExpressionInfo(this.expressionInfos,l);var n=T.isAsync(this.expressionCache[p.name]);d.push({name:p.name,expression:!0,hasFeatureSetOperations:n,length:h,hidden:!m.visible,alias:f.alias,type:f.type,editable:f.editable,nullable:f.nullable,domain:!1,typeId:!1,subtypeField:!1,subtypeDomain:!1,format:m.format||null,dateOptions:null,description:f.description})}else{var q=this.idProperty,B=this.outFields,t=this.hiddenFields;n=m&&(m.label||m.alias)||p.alias;var A=b.getDomain&&b.getDomain(l)?b.getDomain(l):
!1;var u=!(!c.typeIdField||l!==c.typeIdField);var v=!(!c.subtypeField||l!==c.subtypeField);var x=c.types&&r.some(c.types,function(L){if(L.domains&&L.domains[l]&&L.domains[l].name)return!0});B=!this._getFieldVisibility({field:f,hiddenFields:t,customFieldInfo:m,outFields:B});t=c.editable&&c.editCapabilities.canUpdate;var na=m&&("undefined"!==typeof m.editable&&!1!==p.editable||"undefined"!==typeof m.isEditable&&!1!==p.isEditable);q=t&&l!==q&&p&&"undefined"!==p.editable?na?!!m.editable||!!m.isEditable:
!!p.editable:!1;d.push({name:l,alias:n,length:h,type:f.type,hidden:B,editable:q,nullable:!!p.nullable,domain:A,typeId:u,subtypeField:v,subtypeDomain:x,format:m&&m.format?m.format:null,dateOptions:m&&(m.dateOptions||m.format&&m.format.dateFormat)||null,stringOptions:m&&m.stringOptions?m.stringOptions:null,description:f.description})}},this);r.every(d,function(f){return f.hidden})&&(k.findFirst(d,"name",this.idProperty).hidden=!1);this.showRelatedRecords&&(a=this._generateRelatedRecordFieldInfos({relationships:b.relationships}),
d=d.concat(a));this.showAttachments&&d.push({alias:this._i18nStrings.photosAndFiles,name:"esriAttachments",type:"esriAttachments",editable:c.editable});return d}},_destroyColumns:function(){this.dGrid&&this.dGrid._destroyColumns()},_getFieldVisibility:function(a){var b=a.field,c=a.outFields,d=a.customFieldInfo;a=-1!==r.indexOf(a.hiddenFields,b.name);d=!(!d||!1!==d.visible);c="*"!==c[0]&&-1===r.indexOf(c,b.name);b="esriFieldTypeOID"===b.type||"esriFieldTypeGlobalID"===b.type;return!(a||b&&(d||c)||
d||c)},_applyEdits:function(a){var b=a.row,c=a.rollbackInfo;this.showLoadingIndicator();c&&this._updateRollbackInfos(c);this.emit("data-change",{row:b,rollbackInfo:c});return k.applyEditsFromRow({layer:this.layer,idProperty:this.idProperty,row:b}).then(g.hitch(this,function(d){var e=d.updates||[];e&&e.length&&r.forEach(e,function(f){f.success||(f.error?this.emit("error",{message:f.error}):this.emit("error",{message:this._i18nStrings.errorUpdateFailed}),c?(b=this.getRowDataById(c.rowId),b[c.fieldName]=
c.oldValue,this.dGrid.updateDirty(c.rowId,c.fieldName,c.oldValue),this.refresh()):this.emit("error",{message:this._i18nStrings.errorRollback}))},this);this.hideLoadingIndicator();this.emit("edits-complete",d)})).otherwise(g.hitch(this,function(){c&&(b=this.getRowDataById(c.rowId),b[c.fieldName]=c.oldValue,this.dGrid.updateDirty(c.rowId,c.fieldName,c.oldValue),this.refresh());this.hideLoadingIndicator();this.emit("error",{message:this._i18nStrings.errorUpdateFailed})}))},_updateRollbackInfos:function(a){if(a){var b=
a.rowId;this.rollbackInfos[b]||(this.rollbackInfos[b]=[]);this.rollbackInfos[b].push(a)}},_updateSelection:function(){var a=this.dGrid.selection,b=new V,c=[],d=[],e;for(e in a)if(a.hasOwnProperty(e)){var f=parseInt(e,10);d.push(f);f=this.dGrid.row(f);(f=f.data)&&c.push(f)}a={selectedRows:c,selectedRowIds:d,selectedFeatureCount:d.length};this.set(a);b.resolve(a);return b},_scrollToRow:function(a){var b=this.store,c=this.dGrid,d=c.row(a),e=this.sort;if(d&&b)if(d.element)d.element.scrollIntoView();else if(a=
b.data[a]||d.data)b=e&&e.attribute===this.idProperty&&e.descending?b.data.length-r.indexOf(b.data,a):r.indexOf(b.data,a),c.scrollTo({x:0,y:c.rowHeight*b-c.rowHeight}),d.element?d.element.scrollIntoView():setTimeout(function(){d.element&&d.element.scrollIntoView()},200)},_generateColumns:function(a){a=g.clone(a)||[];var b=[];r.forEach(a,function(c){c.expression?b.push(this._generateExpressionColumn(c)):"esriAttachments"===c.type?b.push(this._generateAttachmentsColumn(c)):"esriRelatedRecords"===c.type?
b.push(this._generateRelatedRecordsColumn(c)):"esriFieldTypeDate"===c.type?this.dateOptions.timeEnabled||c.dateOptions&&c.dateOptions.timeEnabled?b.push(this._generateDateTimeColumn(c)):b.push(this._generateDateColumn(c)):!c.subtypeDomain||c.typeId||c.subtypeField?c.domain?b.push(this._generateDomainColumn(c)):c.typeId?b.push(this._generateTypeColumn(c,"types","id")):c.subtypeField?b.push(this._generateTypeColumn(c,"subtypes","code")):-1<r.indexOf(this._numericFieldTypes,c.type)?b.push(this._generateNumberColumn(c)):
-1===r.indexOf(this._unsupportedFieldTypes,c.type)&&b.push(this._generateStringColumn(c)):b.push(this._generateSubtypeDomainColumn(c))},this);return b},_orderFieldsForDisplay:function(a){var b=this.outFields,c=this.idProperty,d=[];if(b&&"*"===b[0])d=g.clone(a);else{if(!k.isValueEmpty(c)&&-1===r.indexOf(b,c)){var e=k.findFirst(a,"name",c);e&&d.push(e)}r.forEach(b,function(f){var l=k.findFirst(a,"name",f);l&&f!==c&&-1===r.indexOf(d,l)&&d.push(l)},this);r.forEach(a,function(f){-1===r.indexOf(d,f)&&d.push(g.clone(f))})}return d},
_generateDateColumn:function(a){var b=a.dateOptions||this.dateOptions;return{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,className:this.css.dateValue,get:g.hitch(this,function(c){return k.isValueEmpty(c[a.name])?null:k.formatDateForLocale({dateOptions:b,timestamp:new Date(c[a.name]),fieldInfo:a})}),renderCell:g.hitch(this,function(c,d,e){d=y.create("div",{innerHTML:k.isValueEmpty(d)?"":d},e);this._setUpDateCell({row:c,cellNode:e,fieldInfo:a,container:d})}),renderHeaderCell:g.hitch(this,
function(){return this._getColumnHeaderCellContent({fieldInfo:a})})}},_generateDateTimeColumn:function(a){return{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,className:this.css.dateValue,get:g.hitch(this,function(b){return k.isValueEmpty(b[a.name])?null:k.formatDateForLocale({dateOptions:a.dateOptions||this.dateOptions,timestamp:new Date(b[a.name]),fieldInfo:a})}),renderCell:g.hitch(this,function(b,c,d){c=y.create("div",{innerHTML:k.isValueEmpty(c)?"":c},d);this._setUpDateTimeCell({row:b,
cellNode:d,fieldInfo:a,container:c})}),renderHeaderCell:g.hitch(this,function(){return this._getColumnHeaderCellContent({fieldInfo:a})})}},_generateDomainColumn:function(a){return{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,get:function(b){return k.getDomainValueFromRow({fieldInfo:a,row:b})},renderHeaderCell:g.hitch(this,function(){return this._getColumnHeaderCellContent({fieldInfo:a})}),renderCell:g.hitch(this,function(b,c,d){var e=y.create("div");if(a.domain.codedValues)c=this._formatStringCellContent({fieldInfo:a,
value:c}),c=String(c),c=E.encode(c),this._setUpCodedValueDomainCell({row:b,cellNode:d,fieldInfo:a,container:e});else if("range"===a.domain.type)c=this._formatNumberCellContent({fieldInfo:a,value:c}),this._setUpRangeDomainCell({row:b,cellNode:d,fieldInfo:a,container:e});else{this.emit("error",{message:this._i18nStrings.errorDomainType});return}e.innerHTML=c;y.place(e,d)})}},_generateTypeColumn:function(a,b,c){return{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,get:g.hitch(this,function(d){var e=
k.getTypeValueFromRow({layerInfo:this.layerInfo,fieldInfo:a,row:d,typesProperty:b,typeIdProperty:c});return k.isValueEmpty(e)?d[a.name]:e}),renderCell:g.hitch(this,function(d,e,f){e=this._formatStringCellContent({fieldInfo:a,value:e});e=y.create("div",{innerHTML:e},f);this._setUpTypeCell({row:d,cellNode:f,fieldInfo:a,container:e,typesProperty:b,typeIdProperty:c})}),renderHeaderCell:g.hitch(this,function(){return this._getColumnHeaderCellContent({fieldInfo:a})})}},_generateSubtypeDomainColumn:function(a){return{label:a.alias,
field:a.name,type:a.type,hidden:a.hidden,editOn:this.editOn,editor:"text",get:g.hitch(this,function(b){return k.getSubtypeDomainValue({layerInfo:this.layerInfo,fieldInfo:a,row:b})}),renderHeaderCell:g.hitch(this,function(){return this._getColumnHeaderCellContent({fieldInfo:a})}),renderCell:g.hitch(this,function(b,c,d){c=this._formatStringCellContent({fieldInfo:a,value:c});c=y.create("div",{innerHTML:c},d);this._setUpSubtypeDomainCell({row:b,cellNode:d,fieldInfo:a,container:c})})}},_generateNumberColumn:function(a){return{label:a.alias,
field:a.name,type:a.type,hidden:a.hidden,renderHeaderCell:g.hitch(this,function(){return this._getColumnHeaderCellContent({fieldInfo:a})}),renderCell:g.hitch(this,function(b,c,d){c=this._formatNumberCellContent({fieldInfo:a,value:c});c=y.create("div",{innerHTML:c},d);this._setUpNumberCell({row:b,cellNode:d,fieldInfo:a,container:c})})}},_generateStringColumn:function(a){return{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,renderHeaderCell:g.hitch(this,function(){return this._getColumnHeaderCellContent({fieldInfo:a})}),
renderCell:g.hitch(this,function(b,c,d){c=this._formatStringCellContent({fieldInfo:a,value:c});c=y.create("div",{innerHTML:c},d);this._setUpStringCell({row:b,cellNode:d,fieldInfo:a,container:c})})}},_generateAttachmentsColumn:function(a){var b=this.layerInfo||{};return{label:a.alias,field:a.name,type:"esriAttachments",sortable:!1,get:g.hitch(this,function(c){c=this.attachmentInfos[c[this.idProperty]];var d=b.queryAttachmentsSupported?0:null;return c&&c.attachments?c.attachments.length:d}),renderCell:g.hitch(this,
function(c,d,e){this._generateAttachmentsCell({row:c,fieldInfo:a,cellValue:d,cellNode:e})}),renderHeaderCell:g.hitch(this,function(){return this._getColumnHeaderCellContent({fieldInfo:a,cssClass:this.css.attachmentsTitle})})}},_generateRelatedRecordsColumn:function(a){return{label:a.alias,field:a.name,type:"esriRelatedRecords",hidden:a.hidden,sortable:!1,get:g.hitch(this,function(b){return this._getRelatedRecordsCount({featureId:b[this.idProperty],relationshipId:a.relationship.id})}),renderCell:g.hitch(this,
function(b,c,d){this._generateRelatedRecordsCell({row:b,fieldInfo:a,cellValue:c,cellNode:d})}),renderHeaderCell:g.hitch(this,function(){return this._getColumnHeaderCellContent({fieldInfo:a,cssClass:this.css.relatedRecordsTitle})})}},_generateExpressionColumn:function(a){return{label:a.alias,field:a.name,type:"esriExpressions",sortable:!1,get:g.hitch(this,function(b){return a.hasFeatureSetOperations?null:this._getExpressionValueForField(a.name,b)}),renderCell:g.hitch(this,function(b,c,d){this._generateExpressionCell({row:b,
fieldInfo:a,cellValue:c,cellNode:d})}),renderHeaderCell:g.hitch(this,function(){return this._getColumnHeaderCellContent({fieldInfo:a,cssClass:this.css.expressionsTitle})})}},_closeCellEditors:function(){r.forEach(this._activeEditors,function(a){a.widget.onBlur()});this.set("_activeEditors",[])},_getColumnHeaderCellContent:function(a){var b=a.fieldInfo,c=a.cssClass||null;a=this.css;var d=y.create("div",{className:a.columnHeader});var e=c?a.columnHeaderTitle+" "+c:a.columnHeaderTitle;!b.editable&&this.editable&&
this.layerInfo.editable&&y.create("span",{className:a.lockedIconContainer+" "+a.lockedIcon},d);c=E.encode(b.alias||b.name);y.create("div",{innerHTML:c,className:e},d);y.create("div",{className:a.columnHeaderClear},d);if(this.showColumnHeaderTooltips||this.showColumnHeaderTooltipsWithDescription)this.showColumnHeaderTooltipsWithDescription&&this.layer.supportsFieldDescription&&b.description&&b.description.value&&(c+=" - "+E.encode(b.description.value)),this.own(new Z({connectId:[d],label:"\x3cdiv class\x3d"+
a.columnHeaderTooltip+"\x3e"+c+"\x3c/div\x3e"}));c="esriExpressions"===b.type||"esriRelatedRecords"===b.type||"esriAttachments"===b.type;this.showDataTypes&&!c&&(y.create("div",{innerHTML:b.type.replace("esriFieldType",""),className:a.columnHeaderType},d),y.create("div",{className:a.columnHeaderClear},d));return d},_setUpNumberCell:function(a){var b=a.row,c=a.cellNode,d=a.fieldInfo,e=a.container,f=this.idProperty,l=k.isIntegerFieldType(d.type)?0:"0,20",h,p;this.editOn===z&&w(c,"pointerdown",g.hitch(this,
function(m){m.preventDefault()}));w(c,this.editOn,g.hitch(this,function(){var m=k.isFeatureEditable({layer:this.layer,layerInfo:this.layerInfo,attributes:b});this.editable&&d.editable&&!1!==m&&!k.findFirst(this._activeEditors,"cellNode",c)&&(this._lastClickedCell!==c&&this._closeCellEditors(),this.editOn===z&&this._lastClickedCell!==c?this._lastClickedCell=c:(e.innerHTML="",h=new I({value:b[d.name],required:!d.nullable,constraints:{places:l}}),h.placeAt(e),h.focus(),h.textbox.select(),this.emit("editor-show",
{cell:c,editor:h,grid:this}),h.on("blur",g.hitch(this,function(){e.innerHTML=this._formatNumberCellContent({fieldInfo:d,value:b[d.name]});c.focus();this.emit("editor-hide",{cell:c,editor:h,grid:this});this._activeEditors.pop()})),h.on("keydown",function(n){n.keyCode===C.ENTER&&h.isValid()&&h.focusNode.blur()}),h.on("change",g.hitch(this,function(n){p={fieldName:d.name,oldValue:b[d.name],rowId:b[f],row:b};if(""===n||isNaN(n))n=null;h.isValid()?(b[d.name]=n,e.innerHTML=this._formatNumberCellContent({fieldInfo:d,
value:n}),this._applyEdits({row:b,rollbackInfo:p})):e.innerHTML=this._formatNumberCellContent({fieldInfo:d,value:b[d.name]});h.destroy()})),this._activeEditors.push({cellNode:c,id:b[f],widget:h})))}))},_setUpDateCell:function(a){var b=a.row,c=a.cellNode,d=a.fieldInfo,e=a.container,f=this.idProperty,l,h;this.editOn===z&&w(c,"pointerdown",g.hitch(this,function(p){p.preventDefault()}));w(c,this.editOn,g.hitch(this,function(){var p=k.isFeatureEditable({layer:this.layer,layerInfo:this.layerInfo,attributes:b});
if(this.editable&&d.editable&&!1!==p)if(this._lastClickedCell!==c&&this._closeCellEditors(),this.editOn===z&&this._lastClickedCell!==c)this._lastClickedCell=c;else{e.innerHTML="";h=d.dateOptions&&d.dateOptions.datePattern?d.dateOptions.datePattern:this.dateOptions.datePattern;l=k.isValueEmpty(b[d.name])?null:new Date(b[d.name]);var m=new Q({value:l,constraints:{datePattern:h}});m.placeAt(e);m.focus();m.textbox.select();this.emit("editor-show",{cell:c,editor:m,grid:this});m.on("blur",g.hitch(this,
function(){e.innerHTML=k.isValueEmpty(b[d.name])?null:k.formatDateForLocale({dateOptions:this.dateOptions,timestamp:b[d.name],fieldInfo:d});c.focus();this.emit("editor-hide",{cell:c,editor:m,grid:this});this._activeEditors.pop()}));m.on("keydown",function(n){n.keyCode===C.ENTER&&m.isValid()&&m.focusNode.blur()});m.on("change",g.hitch(this,function(n){if(m.isValid()){var q={fieldName:d.name,oldValue:b[d.name],rowId:b[f],row:b};b[d.name]=k.isValueEmpty(n)?null:n.getTime();e.innerHTML=k.isValueEmpty(b[d.name])?
null:k.formatDateForLocale({dateOptions:this.dateOptions,timestamp:b[d.name],fieldInfo:d});this._applyEdits({row:b,rollbackInfo:q})}else e.innerHTML=k.isValueEmpty(b[d.name])?null:k.formatDateForLocale({dateOptions:this.dateOptions,timestamp:b[d.name],fieldInfo:d})}));this._activeEditors.push({cellNode:c,id:b[f],widget:m})}}))},_setUpDateTimeCell:function(a){var b=a.row,c=a.cellNode,d=a.fieldInfo,e=a.container,f=this.idProperty,l,h,p;w(c,this.editOn,g.hitch(this,function(){var m=k.isFeatureEditable({layer:this.layer,
layerInfo:this.layerInfo,attributes:b});if(this.editable&&d.editable&&!1!==m)if(this._lastClickedCell!==c&&this._closeCellEditors(),this.editOn===z&&this._lastClickedCell!==c)this._lastClickedCell=c;else{this._closeCellEditors();e.innerHTML="";h=d.dateOptions&&d.dateOptions.datePattern?d.dateOptions.datePattern:this.dateOptions.datePattern;p=d.dateOptions&&d.dateOptions.timePattern?d.dateOptions.timePattern:this.dateOptions.timePattern;l=k.isValueEmpty(b[d.name])?null:new Date(b[d.name]);var n=new Q({value:l,
constraints:{datePattern:h}}),q=new aa({value:l,constraints:{timePattern:p}});n.placeAt(e);q.placeAt(e);n.focus();n.textbox.select();this.emit("editor-show",{cell:c,editor:[n,q],grid:this});n.on("change",g.hitch(this,function(t){n.isValid()&&(null===t||""===t?q.setValue(null):(t=q.getValue(),null===t&&(t=new Date(0,0),q.setValue(t))))}));q.on("change",g.hitch(this,function(t){q.isValid()&&(null===t||""===t?n.setValue(null):(t=n.getValue(),null===t&&(t=new Date(0,0),n.setValue(t))))}));var B=Y.watch("activeStack",
g.hitch(this,function(t,A,u){t=-1!==r.indexOf(A,n.id)||-1!==r.indexOf(A,q.id);u=-1===r.indexOf(u,n.id)&&-1===r.indexOf(u,q.id);if(t&&u){B.remove();this.emit("editor-hide",{cell:c,editor:[n,q],grid:this});t=n.getValue();A=q.getValue();u=b[d.name];if(q.isValid()&&n.isValid()){t&&A?(t=k.getCombinedDateTime(t,A).getTime(),e.innerHTML=k.formatDateForLocale({dateOptions:this.dateOptions,timestamp:new Date(t),fieldInfo:d})):(t=null,e.innerHTML="");if(b[d.name]===t)return;b[d.name]=t;this._applyEdits({row:b,
rollbackInfo:{fieldName:d.name,oldValue:u,rowId:b[f],row:b}})}else e.innerHTML=null===u?"":k.formatDateForLocale({dateOptions:this.dateOptions,timestamp:b[d.name],fieldInfo:d});n.destroy();q.destroy()}}))}}))},_setUpCodedValueDomainCell:function(a){var b=a.row,c=a.cellNode,d=a.fieldInfo;this.editOn===z&&w(c,"pointerdown",g.hitch(this,function(e){e.preventDefault()}));w(c,this.editOn,g.hitch(this,function(){var e=k.isFeatureEditable({layer:this.layer,layerInfo:this.layerInfo,attributes:b});if(this.editable&&
d.editable&&!1!==e&&!k.findFirst(this._activeEditors,"cellNode",c))if(this._lastClickedCell!==c&&this._closeCellEditors(),this.editOn===z&&this._lastClickedCell!==c)this._lastClickedCell=c;else{var f=d.name;e=d.domain.codedValues;var l=a.container,h=b[this.idProperty],p=[];l.innerHTML="";r.forEach(e,function(n){p.push({label:E.encode(String(n.name)),value:String(n.code),selected:b[f]===n.code})});k.isValueEmpty(b[f])?p.push({label:this._i18nStrings.empty,value:this._nullConstant,selected:!0,disabled:!d.nullable}):
d.nullable&&p.push({label:this._i18nStrings.empty,value:this._nullConstant});var m=new J({options:p,"class":this.css.select,style:{width:"100%"}});m.placeAt(l);m.focus();this.emit("editor-show",{cell:c,editor:m,grid:this});m.on("blur",g.hitch(this,function(){var n=k.getDomainValueFromRow({fieldInfo:d,row:b});n=this._formatStringCellContent({fieldInfo:d,value:n});n=String(n);l.innerHTML=E.encode(n);this.emit("editor-hide",{cell:c,editor:m,grid:this});this._activeEditors.pop()}));m.on("keydown",function(n){n.keyCode===
C.ENTER&&m.focusNode.blur()});m.on("change",g.hitch(this,function(n){var q={fieldName:f,oldValue:b[f],rowId:h,row:b};n===this._nullConstant?n=null:k.isNumericFieldType(d.type)&&(n=Number(n));b[f]=n;m.onBlur();this._applyEdits({row:b,rollbackInfo:q});m.destroy();m=null}));this._activeEditors.push({cellNode:c,id:h,widget:m})}}))},_setUpRangeDomainCell:function(a){var b=a.row,c=a.cellNode,d=a.fieldInfo,e=a.container,f=d.domain.minValue,l=d.domain.maxValue,h=this.idProperty,p=k.isIntegerFieldType(d.type)?
0:"0,20",m;this.editOn===z&&w(c,"pointerdown",g.hitch(this,function(n){n.preventDefault()}));w(c,this.editOn,g.hitch(this,function(){var n=k.isFeatureEditable({layer:this.layer,layerInfo:this.layerInfo,attributes:b});if(this.editable&&d.editable&&!1!==n&&!k.findFirst(this._activeEditors,"cellNode",c))if(this._lastClickedCell!==c&&this._closeCellEditors(),this.editOn===z&&this._lastClickedCell!==c)this._lastClickedCell=c;else{e.innerHTML="";var q=new I({value:b[d.name],required:!d.nullable,constraints:{min:f,
max:l,places:p}});q.placeAt(e);q.focus();q.textbox.select();this.emit("editor-show",{cell:c,editor:q,grid:this});q.on("blur",g.hitch(this,function(){e.innerHTML=this._formatNumberCellContent({fieldInfo:d,value:b[d.name]});this.emit("editor-hide",{cell:c,editor:q,grid:this});this._activeEditors.pop()}));q.on("keydown",function(B){B.keyCode===C.ENTER&&q.isValid()&&q.focusNode.blur()});q.on("change",g.hitch(this,function(B){m={fieldName:d.name,oldValue:b[d.name],rowId:b[h],row:b};q.isValid()&&(b[d.name]=
B,this._applyEdits({row:b,rollbackInfo:m}));q.onBlur();q.destroy();q=null}));this._activeEditors.push({cellNode:c,id:b[h],widget:q})}}))},_setUpTypeCell:function(a){var b=a.row,c=a.cellNode,d=a.fieldInfo,e=a.container,f=a.typesProperty,l=a.typeIdProperty,h=this.idProperty,p=this.layerInfo,m=p[f],n;this.editOn===z&&w(c,"pointerdown",g.hitch(this,function(q){q.preventDefault()}));w(c,this.editOn,g.hitch(this,function(){var q=k.isFeatureEditable({layer:this.layer,layerInfo:this.layerInfo,attributes:b});
if(this.editable&&d.editable&&!1!==q&&!k.findFirst(this._activeEditors,"cellNode",c))if(this._lastClickedCell!==c&&this._closeCellEditors(),this.editOn===z&&this._lastClickedCell!==c)this._lastClickedCell=c;else{e.innerHTML="";q=k.isValueEmpty(k.getTypeValueFromRow({layerInfo:this.layerInfo,fieldInfo:d,row:b,typesProperty:f,typeIdProperty:l}));var B=d.name,t=b[B],A=[];r.forEach(m,function(v){A.push({label:v.name,value:String(v[l]),selected:t===v[l]})});k.isValueEmpty(t)?A.push({label:this._i18nStrings.empty,
value:this._nullConstant,selected:!0,disabled:!0}):q&&A.push({label:String(t),value:String(t),selected:!0,disabled:!0});var u=new J({options:A,"class":this.css.select,style:{width:"100%"}});u.placeAt(e);u.focus();this.emit("editor-show",{cell:c,editor:u,grid:this});u.on("blur",g.hitch(this,function(){var v=k.getTypeValueFromRow({layerInfo:p,fieldInfo:d,row:b,typesProperty:f,typeIdProperty:l});e.innerHTML=this._formatStringCellContent({fieldInfo:d,value:v||t});this.emit("editor-hide",{cell:c,editor:u,
grid:this.grid});this._activeEditors.pop()}));u.on("keydown",function(v){v.keyCode===C.ENTER&&u.focusNode.blur()});u.on("change",g.hitch(this,function(v){n={fieldName:B,oldValue:t,rowId:b[h],row:b};v===this._nullConstant?v=null:k.isNumericFieldType(d.type)&&(v=Number(v));b[B]=v;u.onBlur();this._applyEdits({row:b,rollbackInfo:n});u.destroy();u=null}));this._activeEditors.push({cellNode:c,id:b[h],widget:u})}}))},_setUpSubtypeDomainCell:function(a){var b=a.cellNode;this.editOn===z&&w(b,"pointerdown",
g.hitch(this,function(c){c.preventDefault()}));w(b,this.editOn,g.hitch(this,function(){var c=this.layerInfo,d=a.fieldInfo,e=a.row,f=k.isFeatureEditable({layer:this.layer,layerInfo:c,attributes:e});if(this.editable&&d.editable&&!1!==f&&!k.findFirst(this._activeEditors,"cellNode",b))if(this._lastClickedCell!==b&&this._closeCellEditors(),this.editOn===z&&this._lastClickedCell!==b)this._lastClickedCell=b;else{var l=e[this.idProperty],h=d.name;c=k.findFirst(c.types,"id",e[c.typeIdField]);var p=a.container,
m={},n;p.innerHTML="";c&&c.domains&&(n=c.domains[h]);if(n&&"inherited"===n.type||!n&&d.domain)n=d.domain;if(n&&n.codedValues){var q=n.codedValues,B=k.findFirst(q,"code",e[h]),t=!1,A=[];r.forEach(q,function(x){A.push({label:x.name,value:String(x.code),selected:e[h]===x.code});x.code===B&&(t=!0)});k.isValueEmpty(e[h])&&d.nullable?A.push({label:this._i18nStrings.empty,value:this._nullConstant,selected:!0}):k.isValueEmpty(e[h])&&!d.nullable?A.push({label:this._i18nStrings.empty,value:this._nullConstant,
selected:!0,disabled:!0}):d.nullable&&A.push({label:this._i18nStrings.empty,value:this._nullConstant});t||B||null===e[h]||A.push({label:e[h].toString(),value:"N/A",selected:!0,disabled:!0});var u=new J({options:A,"class":this.css.select,style:{width:"100%"}});u.placeAt(p);u.focus();this.emit("editor-show",{cell:b,editor:u,grid:this});u.on("blur",g.hitch(this,function(){var x=k.findFirst(q,"code",e[h]);p.innerHTML=x?this._formatStringCellContent({fieldInfo:d,value:x.name}):this._formatStringCellContent({fieldInfo:d,
value:e[h]});this.emit("editor-hide",{cell:b,editor:u,grid:this});this._activeEditors.pop()}));u.on("keydown",function(x){x.keyCode===C.ENTER&&u.focusNode.blur()});u.on("change",g.hitch(this,function(x){m={fieldName:h,oldValue:e[h],rowId:l,row:e};x===this._nullConstant?x=null:k.isNumericFieldType(d.type)&&(x=Number(x));e[h]=x;u.onBlur();this._applyEdits({row:e,rollbackInfo:m});u.destroy();u=null}));this._activeEditors.push({cellNode:b,id:l,widget:u})}else{var v=new I({value:e[h],required:!d.nullable});
n&&"range"===n.type&&(v.constraints={min:n.minValue,max:n.maxValue,places:k.isIntegerFieldType(d.type)?0:"0,20"});v.placeAt(p);v.focus();v.textbox.select();this.emit("editor-show",{cell:b,editor:v,grid:this});v.on("blur",g.hitch(this,function(){p.innerHTML=e[h];this.emit("editor-hide",{cell:b,editor:v,grid:this});this._activeEditors.pop()}));v.on("keydown",function(x){x.keyCode===C.ENTER&&v.isValid()&&v.focusNode.blur()});v.on("change",g.hitch(this,function(x){m={fieldName:h,oldValue:e[h],rowId:l,
row:e};if(""===x||isNaN(x))x=null;v.isValid()&&(e[h]=x,this._applyEdits({row:e,rollbackInfo:m}));v.onBlur();v.destroy();v=null}));this._activeEditors.push({cellNode:b,id:l,widget:v})}}}))},_setUpStringCell:function(a){var b=a.row,c=a.cellNode,d=a.fieldInfo,e=a.container,f=this.idProperty;this.editOn===z&&w(c,"pointerdown",g.hitch(this,function(l){l.preventDefault()}));w(c,this.editOn,g.hitch(this,function(){var l=k.isFeatureEditable({layer:this.layer,layerInfo:this.layerInfo,attributes:b});if(this.editable&&
d.editable&&!1!==l&&!k.findFirst(this._activeEditors,"cellNode",c))if(this._lastClickedCell!==c&&this._closeCellEditors(),this.editOn===z&&this._lastClickedCell!==c)this._lastClickedCell=c;else{e.innerHTML="";l=d.stringOptions;var h=l&&l.input&&"textarea"===l.input?new R({value:b[d.name],required:!d.nullable,maxLength:d.length?d.length:null,trim:!0}):new K({value:b[d.name],required:!d.nullable,maxLength:d.length?d.length:null});h.placeAt(e);h.focus();h.textbox.select();this.emit("editor-show",{cell:c,
editor:h,grid:this});h.on("blur",g.hitch(this,function(){e.innerHTML=this._formatStringCellContent({fieldInfo:d,value:b[d.name]});c.focus();this.emit("editor-hide",{cell:c,editor:h,grid:this});this._activeEditors.pop()}));h.on("keydown",function(p){p.keyCode===C.ENTER&&h instanceof K&&h.isValid()&&h.focusNode.blur()});h.on("change",g.hitch(this,function(p){var m={fieldName:d.name,oldValue:b[d.name],rowId:b[f],row:b};""===p&&(p=null);h instanceof K&&h.isValid()?(b[d.name]=p,this._applyEdits({row:b,
rollbackInfo:m})):h instanceof R&&(!k.isValueEmpty(p)||k.isValueEmpty(p)&&d.nullable)&&(b[d.name]=p,this._applyEdits({row:b,rollbackInfo:m}));e.innerHTML=this._formatStringCellContent({fieldInfo:d,value:b[d.name]});h.destroy();h=null}));this._activeEditors.push({cellNode:c,id:b[f],widget:h})}}))},_formatStringCellContent:function(a){var b=a.value;a=a.fieldInfo?a.fieldInfo.format:null;return k.isValueEmpty(b)?"":a?a.embeddedHTML||!1===a.link?b:a.template?G.substitute(a.template,{value:b}):b:k.generateLinkFromString(b)},
_formatNumberCellContent:function(a){var b=a.fieldInfo?a.fieldInfo.format:null;a=a.value;if(k.isValueEmpty(a))return"";a=k.formatNumberForLocale(a,b);b&&b.template&&(a=G.substitute(b.template,{value:a}));this.isLeftToRight()||(a='\x3cspan dir\x3d"ltr"\x3e'+a+"\x3c/span\x3e");return a},_generateAttachmentsCell:function(a){if(this.layerInfo){var b=a.row,c=a.cellValue,d=a.cellNode,e=a.fieldInfo;a=this.layerInfo;var f=this.css,l=this._i18nStrings;var h=k.isValueEmpty(c)?"":G.substitute(l.parenValue,{value:c});
var p=y.create("div",{innerHTML:h,className:f.attachmentsCell},d);y.create("span",{innerHTML:0<c||!a.queryAttachmentsSupported?" "+l.show:this.editable&&a.editable?" "+l.add:"",className:f.attachmentsLink},p);w(p,z,g.hitch(this,function(){this._showAttachmentsHandler({row:b,fieldInfo:e,cellValue:c,cellNode:d,textContainer:p})}))}},_generateRelatedRecordsCell:function(a){var b=a.row,c=a.cellValue,d=a.cellNode,e=a.fieldInfo;a=this.css;var f=this._i18nStrings;var l=k.isValueEmpty(c)?"":G.substitute(f.parenValue,
{value:c})+" ";l=y.create("div",{innerHTML:l,className:a.relatedRecordsCell},d);y.create("span",{innerHTML:0<c?f.show:"",className:a.relatedRecordsLink},l);w(d,z,g.hitch(this,function(h){0<c&&(h=this.dGrid.cell(h).column,this._showRelatedRecordsHandler({row:b,fieldInfo:e,column:h,count:c}))}))},_generateExpressionCell:function(a){var b=a.row,c=a.cellValue,d=a.fieldInfo,e=y.create("div",{className:this.css.expressionsCell},a.cellNode);if(d.hasFeatureSetOperations)var f=y.create("span",{innerHTML:this._i18nStrings.show,
className:this.css.expressionsLink},e),l=w(e,z,g.hitch(this,function(){var h=y.create("div",{className:this.css.cellLoadingIndicator});y.place(h,f,"replace");(h=this._getExpressionValueForField(d.name,b))&&h.then?h.then(g.hitch(this,function(p){e.innerHTML=this._formatExpressionCellContent(d,p)})).otherwise(g.hitch(this,function(p){e.innerHTML=this._i18nStrings.dataError})):e.innerHTML="";l.remove()}));else e.innerHTML=this._formatExpressionCellContent(d,c)},updateHeaderText:function(a){var b=a?a.count:
null,c=a?a.selectedCount:null,d=a?a.title:null;a=a?a.showFilterCount:!0;d=k.isValueEmpty(d)?this._tableTitle||this.layer.name||this._i18nStrings.untitled:d;b=k.isValueEmpty(b)?this.featureCount:b;c=k.isValueEmpty(c)?this.selectedFeatureCount:c;this.filterIds&&0<this.filterIds.length&&a&&(b=this.filterIds.length);this.showFeatureCount?this.setHeaderTitle(G.substitute(this._i18nStrings.gridHeader,{gridTitle:d,featureCount:b,featureSelectedCount:c})):this.setHeaderTitle(d)},_generateOptionsMenu:function(){var a=
this.css,b=this._i18nStrings;a=y.create("div",{className:a.menuItem+" "+a.button+" "+a.menuIcon,title:b.options,"aria-label":b.options,tabIndex:0},this._gridMenuNode);w(a,[z,"keydown"],g.hitch(this,function(c){"Tab"!==c.key&&this._showOptionsMenu(c)}));this.optionsMenuAnchor=a},_showOptionsMenu:function(a){var b=this.optionsMenuAnchor,c=this.css;this.optionsMenu&&(this.optionsMenu.destroy(),this.optionsMenu=null);var d=b.getBoundingClientRect();var e=d.top+d.height;var f=this.isLeftToRight()?d.left+
d.width:d.right-d.width;var l=new P({className:c.optionsMenu});d=this._generateOptionsMenuItems();r.forEach(d,function(h){h=new F({label:h.label,baseClass:c.menuItem,onClick:g.hitch(this,h.callback)});l.addChild(h)},this);l._openMyself({target:a.target,delegatedTarget:b,iframe:null,coords:{x:f,y:e}});this.optionsMenu=l},_generateOptionsMenuItems:function(){var a=[];this.showDefaultSortMenuItem&&a.push({label:this._i18nStrings.defaultSort,callback:this._sortFieldDefaultCallback});this.showFilterMenuItems?
a.push({label:this._i18nStrings.showSelected,callback:this._showSelectedRecordsCallback},{label:this._i18nStrings.clearSelection,callback:this._clearFilterCallback}):a.push({label:this._i18nStrings.clearSelection,callback:this.clearSelection});this.gridOptions.columnHider&&a.push({label:this._i18nStrings.toggleColumns,callback:this.showColumnToggleMenu});this.map&&this.syncSelection&&a.push({label:this._i18nStrings.centerOnSelection,callback:this.centerOnSelection});this.menuFunctions&&0<this.menuFunctions.length&&
r.forEach(this.menuFunctions,function(b){a.push({label:b.label,callback:b.callback})},this);return a},_sortFieldDefaultCallback:function(){var a=this.defaultSort.attribute,b=this.defaultSort.descending;this.set("sort",{field:a,descending:b});this.emit("sort",{field:a,descending:b,orderByFields:[k.getOrderByString(a,b)]})},_showSelectedRecordsCallback:function(){0!==this.selectedRowIds.length&&this.emit("show-selected-records",{ids:this.selectedRowIds})},_clearFilterCallback:function(){this.emit("clear-selection");
this.emit("clear-filter")},showColumnToggleMenu:function(){this.dGrid._toggleColumnHiderMenu()},_generateColumnMenu:function(a){var b=this.dGrid.cell(a),c=b?b.column:null;if(c){var d=this.columnMenu,e=this.css,f=this.columnMenuFunctions;c=c.id;var l=this.dGrid.columns[c],h=k.findFirst(this.fieldInfos,"name",l.field);d&&this.set("columnMenu",null);if(!1!==l.sortable){var p=new P({className:e.columnMenu});this._generateSortMenuItems({menu:p,columnId:c});this._generateStatisticsMenuItem({menu:p,fieldInfo:h,
columnId:c});this._generateFieldDetailsMenuItem({menu:p,fieldInfo:h,column:l});f&&0<f.length&&r.forEach(f,function(m){p.addChild(new F({label:m.label,iconClass:m.iconClass||"",baseClass:m.baseClass||"",onClick:g.hitch(this,m.callback,h)}))});p.startup();this._showColumnMenu({menu:p,cell:b,evt:a,fieldInfo:h,previousMenu:d});this.set("columnMenu",p)}}},_showColumnMenu:function(a){var b=a.menu,c=a.cell,d=a.evt,e=a.previousMenu;var f=c.element.getBoundingClientRect();a=f.top+f.height;f=this.isLeftToRight()?
f.right-f.width:f.right;b._openMyself({target:d.target,delegatedTarget:c,iframe:null,coords:{x:f,y:a}});w(b,"close",function(){e&&(e.destroyRecursive(),e=null)})},_generateSortMenuItems:function(a){var b=a.menu;a=a.columnId;var c=this.css;b.addChild(new F({label:this._i18nStrings.sortAsc,iconClass:c.sortAscendingIcon,baseClass:c.menuItem,onClick:g.hitch(this,this._sortFieldAscendingHandler,a)}));b.addChild(new F({label:this._i18nStrings.sortDesc,iconClass:c.sortDescendingIcon,baseClass:c.menuItem,
onClick:g.hitch(this,this._sortFieldDescendingHandler,a)}))},_sortFieldAscendingHandler:function(a){var b=this.dGrid.columns[a];this.emit("sort",{column:b,id:a,field:b.field,descending:!1,orderByFields:[k.getOrderByString(b.field,!1)]})},_sortFieldDescendingHandler:function(a){var b=this.dGrid.columns[a];this.emit("sort",{column:b,id:a,field:b.field,descending:!0,orderByFields:[k.getOrderByString(b.field,!0)]})},_generateStatisticsMenuItem:function(a){var b=a.menu,c=a.fieldInfo,d=this.css,e=this.layer,
f=!!this.layerInfo.isFeatureCollection;e=e.advancedQueryCapabilities.supportsStatistics||e.supportsStatistics;!this.showStatistics||!e||!c||c.domain&&c.domain.codedValues||c.subtypeDomain||c.typeId||c.subtypeField||f||k.isNumericFieldType(c.type)&&b.addChild(new F({label:this._i18nStrings.statistics,iconClass:d.statisticsIcon,baseClass:d.menuItem,onClick:g.hitch(this,this._showStatisticsHandler,a)}))},_generateFieldDetailsMenuItem:function(a){if(this.showFieldDetails){var b=a.menu,c=a.fieldInfo,d=
parseInt(a.column.id,10);a=this.css;"esriFieldTypeOID"!==c.type&&"esriFieldTypeGlobalID"!==c.type&&-1===r.indexOf(this._unsupportedFieldTypes,c.type)&&b.addChild(new F({label:this._i18nStrings.showDetailedView,iconClass:a.propertiesIcon,baseClass:a.menuItem,onClick:g.hitch(this,function(){this.emit("show-detailed-field-view",{columnId:d,fieldInfo:c})})}))}},_fetchAttachments:function(a){return k.queryLayerForAttachments({layer:this.layer,ids:a||null})},_showAttachmentsHandler:function(a){var b=a.row,
c=a.fieldInfo,d=a.cellValue,e=a.cellNode,f=this.layerInfo,l=b[this.idProperty];if(0!==d||f.editCapabilities.canCreate){a=M.generateAttachmentsDialog({layer:this.layer,featureId:l,attachments:this.attachmentInfos[l]?this.attachmentInfos[l].attachments:[],editable:this.editable&&f.editable,css:this.css});var h=a.featureAttachments;var p=h.attachments;this.own(h.on("add-complete",g.hitch(this,function(m){this.attachmentInfos[l]||(this.attachmentInfos[l]={attachments:[]});this.attachmentInfos[l].attachments=
m.attachments;f.queryAttachmentsSupported&&(d+=1);e.innerHTML="";this._generateAttachmentsCell({row:b,fieldInfo:c,cellValue:d,cellNode:e});this.emit("add-attachment-complete",m)})),h.on("delete-complete",g.hitch(this,function(m){this.attachmentInfos[l]||(this.attachmentInfos[l]={attachments:[]});this.attachmentInfos[l].attachments=m.attachments;f.queryAttachmentsSupported&&--d;e.innerHTML="";this._generateAttachmentsCell({row:b,fieldInfo:c,cellValue:d,cellNode:e});this.emit("delete-attachment-complete",
m)})));this.emit("show-attachments",{featureId:l,attachments:p,dialog:a.dialog})}},_updateAttachmentInfos:function(a){return g.mixin(this.attachmentInfos,a)},_fetchRelatedRecords:function(a){return k.queryLayerForRelatedRecords({layer:this.layer,ids:a.ids||null,relationship:a.relationship,outFields:a.outFields||["*"]})},_showRelatedRecordsHandler:function(a){var b=a.row,c=this.idProperty,d=b[c],e=a.fieldInfo.relationship;a=a.count;var f=this.columns,l=this.layer,h=l.getField(e.keyField),p=(h=h?h.name:
null)?b[h]:null,m;var n=r.filter(f,function(q){return!q.hidden});c=[k.findFirst(n,"field",l.displayField),k.findFirst(n,"field",h),k.findFirst(n,"type","esriFieldTypeString"),k.findFirstNumberColumn(f,c),k.findFirst(n,"type","esriFieldTypeDate")];r.some(c,function(q){if(this._validateRelatedColumnDisplay(q))return m=r.indexOf(f,q),!0},this);k.isValueEmpty(m)&&(m=0);this.emit("show-related-records",{row:b,featureId:d,keyField:h,keyFieldValue:p,columnId:m,relationship:e,count:a})},_setUpRelatedRecordInfos:function(a){var b=
a.records,c=this.relatedRecordInfos;r.forEach(a.relationships,function(d,e){c[d.id]=b[e]});return c},_updateRelatedRecordInfos:function(a){this.relatedRecordInfos=k.mergeDictionaries(this.relatedRecordInfos,a)},_updateRelatedRecordCounts:function(a){var b=this.relatedRecordCounts,c={};r.forEach(this.layer.relationships,function(d){var e=a[d.id];if(e){e=e.relatedRecordGroups;var f=d.id;c[f]={};r.forEach(e,function(l){c[f][l.objectId]={count:l.count}})}});this.relatedRecordCounts=k.mergeDictionaries(b,
c)},_getRelatedRecordsById:function(a){var b=a.featureId;a=a.relationshipId;return this.relatedRecordInfos[a]?this.relatedRecordInfos[a][b]:[]},_getRelatedRecordsCount:function(a){var b=a.featureId;a=a.relationshipId;return this.layerInfo.supportsAdvancedQueryRelated?(b=this.relatedRecordCounts[a]?this.relatedRecordCounts[a][b]:{})?b.count:0:(b=this._getRelatedRecordsById({featureId:b,relationshipId:a}))&&b.features?b.features.length:0},_generateRelatedRecordFieldInfos:function(a){var b=[],c=this.visibleLayerIds,
d=!1,e,f;r.some(a.relationships,function(l,h){h===this._relationshipColumnLimit&&(d=!0);f=k.isCyclicalRelationship(l);(e=c?c[c.length-1]===l.relatedTableId:!1)&&f&&!this.showCyclicalRelationships||b.push({alias:l.name,name:l.name,type:"esriRelatedRecords",hidden:d,relatedIndex:h,relationship:l})},this);return b},_validateRelatedColumnDisplay:function(a){return!(!a||a.hidden||-1===r.indexOf(this.columns,a)||"esriFieldTypeOID"===a.type||"esriFieldTypeGlobalID"===a.type)},_getExpressionValueForField:function(a,
b){var c=b[this.idProperty];a=this.expressionCache[a];b=this.layerInfo.isFeatureCollection?k.findFirst(this.layer.graphics,"attributes",b):this.store.data[c];return k.getExpressionValue(b,a)},_formatExpressionCellContent:function(a,b){if(k.isValueEmpty(b))return"";"number"==a.type?b=this._formatNumberCellContent({fieldInfo:a,value:b}):(b=String(b),b=E.encode(b),b=this._formatStringCellContent({fieldInfo:a,value:b}),b=b.replace(/(\n)/ig,"\x3cspan class\x3d'charNewLine'\x3e$1\x3c/span\x3e"));return b},
_showStatisticsHandler:function(a){var b=a.columnId,c=a.fieldInfo,d;a=this.where||this.layer.getDefinitionExpression?this.layer.getDefinitionExpression():"1\x3d1";k.getFieldStatistics({grid:this.dGrid,layer:this.layer,fieldInfo:c,idProperty:this.idProperty,filterIds:this.filterIds,where:a,columnId:b}).then(g.hitch(this,function(e){d=M.generateStatisticsDialog({data:e,fieldInfo:c,css:this.css});this.emit("show-statistics",d)}))},_addGridListeners:function(){this._setUpRowSelectListener();this._setUpRowDeselectListener();
this._setUpDataChangeListener();this._setUpRefreshListener();this._setUpColumnClickListener();this._setUpColumnStateChangeListener();this._setUpColumnResizeListener();this._setUpErrorListener();this._setUpSortListener();this._setUpFilterListener();this._setUpEditorShowListener();this._setUpEditorHideListener();this.own(this._setUpStoreLoadListener(),this._setUpLayerClickListener(),this._setUpLayerSelectionCompleteListener(),this._setUpLayerSelectionClearListener(),this._setUpLayerUpdateEndListener(),
this._setUpLayerRefreshTickListener(),this._setUpLayerFeaturesUpdatesListener())},_setUpStoreLoadListener:function(){var a=this.watch("store",g.hitch(this,function(b,c,d){null===c&&d&&(this.set("loaded",!0),this.emit("load",{loaded:!0}),a.remove())}));return a},_setUpRowSelectListener:function(){return this.dGrid.on("dgrid-select",g.hitch(this,function(a){this._updateSelection().then(g.hitch(this,function(){this.updateHeaderText();this.emit("row-select",a)}))}))},_setUpRowDeselectListener:function(){return this.dGrid.on("dgrid-deselect",
g.hitch(this,function(a){this._previousSelectedRowIds=this.selectedRowIds;this._updateSelection().then(g.hitch(this,function(){this.updateHeaderText();this.emit("row-deselect",a)}))}))},_setUpDataChangeListener:function(){return this.dGrid.on("dgrid-datachange",g.hitch(this,function(a){var b=a.cell.column.field,c=k.findFirst(this.fieldInfos,"name",b),d=a.cell.row.data,e=d[this.idProperty],f=a.value;a=a.oldValue;var l=k.isIntegerFieldType(c.type);c=k.isFloatFieldType(c.type);var h={oldValue:a,fieldName:b,
rowId:e,row:d};""===f&&(f=null);l&&null!==f&&(f=parseInt(f,10));c&&null!==f&&(f=parseFloat(f));f&&f.getTime&&f.getTime()?d[b]=f.getTime():d[b]=f;this.showLoadingIndicator();this._updateSelection().then(g.hitch(this,function(){this.updateHeaderText();this._applyEdits({row:d,rollbackInfo:h})}));this.emit("data-change",{row:d,rollbackInfo:h})}))},_setUpRefreshListener:function(){return this.dGrid.on("dgrid-refresh-complete",g.hitch(this,function(a){this._lastClickedCell=null;this.dGrid.columns[0]&&this.emit("refresh",
a)}))},_setUpColumnClickListener:function(){return this.dGrid.on(".dgrid-header .dgrid-cell:click",g.hitch(this,this._generateColumnMenu))},_setUpColumnStateChangeListener:function(){return this.dGrid.on("dgrid-columnstatechange",g.hitch(this,function(a){this.emit("column-state-change",a)}))},_setUpColumnResizeListener:function(){return this.dGrid.on("dgrid-columnresize",g.hitch(this,function(a){this.emit("column-resize",a)}))},_setUpErrorListener:function(){return this.dGrid.on("dgrid-error",g.hitch(this,
function(a){this.emit("error",a)}))},_setUpSortListener:function(){return this.dGrid.on("dgrid-sort",g.hitch(this,function(a){this.emit("sort",a)}))},_setUpFilterListener:function(){return this.dGrid.on("dgrid-filter",g.hitch(this,function(a){this.emit("filter",a)}))},_setUpEditorShowListener:function(){return this.dGrid.on("dgrid-editor-show",g.hitch(this,function(a){this.emit("editor-show",a)}))},_setUpEditorHideListener:function(){return this.dGrid.on("dgrid-editor-hide",g.hitch(this,function(a){this.emit("editor-hide",
a)}))},_setUpLayerClickListener:function(){return w(this.layer,"click",g.hitch(this,function(a){this.emit("layer-click",a)}))},_setUpLayerSelectionCompleteListener:function(){return w(this.layer,"selection-complete",g.hitch(this,function(a){this.emit("layer-selection-complete",a)}))},_setUpLayerSelectionClearListener:function(){return w(this.layer,"selection-clear",g.hitch(this,function(a){this.emit("layer-selection-clear",a)}))},_setUpLayerUpdateEndListener:function(){return w(this.layer,"update-end",
g.hitch(this,function(a){this.emit("layer-update-end",a)}))},_setUpLayerRefreshTickListener:function(){return w(this.layer,"refresh-tick",g.hitch(this,function(a){this.layer.isFeatureUpdatesCheckActive()||this.emit("layer-refresh-tick",a)}))},_setUpLayerFeaturesUpdatesListener:function(){return w(this.layer,"feature-updates-result",g.hitch(this,function(a){(a.hasUpdates||this.layer.hasDefinitionExpressionWithCurrentTimestamp())&&this.emit("layer-refresh-tick",a)}))}});U("extend-esri")&&g.setObject("dijit.Grid",
H,S);return H});