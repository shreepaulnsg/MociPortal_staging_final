// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/dataDrilling/DataDrillingExportUtil","dojo/_base/lang esri/dijit/geoenrichment/when dojo/dom-construct esri/dijit/geoenrichment/ReportPlayer/ReportPlayer esri/dijit/geoenrichment/ReportPlayer/PlayerResizeModes esri/dijit/geoenrichment/ReportPlayer/PlayerThemes esri/dijit/geoenrichment/ReportPlayer/DataProviderGE esri/dijit/geoenrichment/ReportPlayer/PlayerCommands ../reportContainerGrid/utils/PageQueryUtil ../supportClasses/templateJsonUtils/BlankTemplateJsonUtil ../supportClasses/templateJsonUtils/fieldInfo/FieldInfoBuilder esri/dijit/geoenrichment/utils/DeviceUtil esri/dijit/geoenrichment/utils/WaitingUtil".split(" "),
function(u,k,q,v,w,x,y,l,n,z,A,r,B){var g={reportPlayerClass:v,dataProviderClass:y,initPlayer:function(){var a=q.create("div",{"class":"esriGEAbsoluteStretched esriGEOffscreen"},document.body),e=new g.dataProviderClass;e.registerCommand(l.PRINT);e.registerCommand(l.IMAGE);e=(new g.reportPlayerClass({theme:x.DARK,dataProvider:e,resizeMode:w.FIT_WINDOW,isDataDrillingPlayer:!0})).placeAt(a);e.__playerDiv=a;return e},destroyPlayer:function(a){a.destroy();q.destroy(a.__playerDiv)}},b={},p=!1;b.setReportPlayerClass=
function(a){g.reportPlayerClass=a};b.setDataProviderClass=function(a){g.dataProviderClass=a};b.canPrintDataDrilling=function(a){return r.isMobileDevice()?!1:!!n.getParentReportPlayer(a).dataProvider.getCommandById(l.PRINT)};b.canExportDataDrilling=function(a){return r.isMobileDevice()?!1:(a=n.getParentReportPlayer(a).dataProvider.getCommandById(l.IMAGE))&&a.isBrowserSupported()};b.printDataDrilling=function(a){b._createTemporaryPlayerAndExport(a,!0)};b.exportDataDrilling=function(a){b._createTemporaryPlayerAndExport(a,
!1)};b._createTemporaryPlayerAndExport=function(a,e){if(!p){p=!0;var t,h=n.getParentReportPlayer(a.parentWidget),C=h.getReportData();h=h.dataProvider.reportDataToSingleAreaReportData(C,{currentFeatureIndex:a.currentFeatureIndex||0,reportTitle:h.getReportTitle(),templateJson:function(){var d=a.getSection().toJson(),c=a.getDataDrillingPanelDimensions(d);c=z.createBlankTemplate({elementWidth:c.w,elementHeight:c.h,layout:{numRows:1,numColumns:1}});c.theme=u.clone(a.theme);delete c.theme.document.backgroundImage;
t=a.getSection().getVisualState();d=A.createFieldInfoFromSection(d);var m=c.sectionsTables[0];m.rows[0].fieldInfos[m.columns[0].field]=d;return c}()});var f=g.initPlayer();f.onWaitingShown=function(d){B.showProgressPromise(a.dataDrillingViewDiv,d)};f.onCommandSettingsShown=function(d){b.unitTesting_onCommandSettingsShown()};k(f.setReportData(h,{waitUntilAllContentIsReady:!0,disableAnimation:!0}),function(){var d={pages:[{cells:[t]}]},c=f.getCurrentReportContainer().getLayoutCells()[0].content;c.getPreviewValueFunction=
a.getPreviewValueFunction;return k(c.refresh()).then(function(){return k(f.onWaitingShown(f.getCurrentReportContainer().setVisualState(d)),function(){return k(f[e?"executePrint":"executeExport"](),function(m){g.destroyPlayer(f);b.unitTesting_onExportCommandFinished(m)})})})})["finally"](function(){p=!1})}};b.unitTesting_onCommandSettingsShown=function(){};b.unitTesting_onExportCommandFinished=function(a){};return b});