// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/conversion/portalToEditorUtils/parsers/infographic/SimpleInfographicParser","dojo/_base/lang esri/dijit/geoenrichment/utils/JsonXmlConverter ../../../ConversionUtil esri/dijit/geoenrichment/ReportPlayer/core/infographics/utils/InfographicJsonUtil esri/dijit/geoenrichment/ReportPlayer/core/sections/SectionTypes esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/templateJsonUtils/fieldInfo/FieldInfoBuilder ../../../../supportClasses/tableJson/TableJsonResizeUtil dojo/i18n!esri/nls/jsapi".split(" "),
function(C,x,l,D,m,E,y,n){n=n.geoenrichment.dijit.ReportPlayer.ReportPlayer;return{portalToEditor:function(c,d){function p(b){return d.parsers.getParser("section").parseTable(b,d)}var z=c.tags.slice(),q,r=[],t,u;(function(){1.1<=d.revisionVersion?z.forEach(function(b){switch(b.attributes.type){case m.INFOGRAPHIC_HEADER:q=b.tags[0];break;case m.INFOGRAPHIC_VARIABLE:r.push(b);break;case m.INFOGRAPHIC_BACKGROUND:t=b.tags;break;case m.INFOGRAPHIC_FOREGROUND:u=b.tags}}):r=z.filter(function(b){return"infographicHeader"===
b.attributes.type?(q=b,!1):!0})})();var v={type:c.attributes.type,isDefault:c.attributes.isDefault,style:{width:l.ptToPx(c.attributes.width),height:l.ptToPx(c.attributes.height),padding:c.attributes.padding?l.ptToPx(c.attributes.padding):void 0,backgroundColor:c.attributes.backgroundColor},preserveTextSize:c.attributes.preserveTextSizeWhenResizing,background:t?t.map(p):null,header:q&&p(q),variableTables:null,foreground:u?u.map(p):null,dataDrilling:null};v.variableTables=r.map(function(b){function A(a){if(a&&
a.isMissing){a.alias=e.description&&e.description.text;if(!a.alias&&d.variableProvider.isPlayerOnly){var f=d.variableProvider.toCalculator(a.templateName);a.alias=f&&f.variable.alias}a.alias=a.alias?a.alias+" ("+n.missingVariable+")":n.missingVariable}}var e={style:l.ptToPxObj({left:b.attributes.left,top:b.attributes.top,width:b.attributes.width,height:b.attributes.height})},w;b.tags.forEach(function(a){if("dataDrillingPanels"===a.name)w=a;else{var f=a.attributes.type,k=p(a),g=k.rows[0],h=k.columns[0].field;
a={isContrastColor:a.attributes.isContrastColor,isHighlighted:a.attributes.isHighlighted,style:C.mixin({width:k.columns[0].style.width,height:g.style.height,left:k.style.left,top:k.style.top},g.style.fields[h])};delete a.style.overrideStyle;"shape"===f&&(a.shapeJson=g.fieldInfos[h].shapeJson,1.6>d.revisionVersion&&(a.style.width-=3,a.style.height-=3,a.shapeJson.style.width-=3,a.shapeJson.style.height-=3));"image"===f?a.imageJson=g.fieldInfos[h].imageJson:"variable"===f?a.fieldInfo=g.fieldInfos[h]||
E.createFieldInfoFromMissingVariable():"description"===f&&(a.text=g[h],a.fieldInfo=g.fieldInfos[h]);e[f]=a}});A(e.variable.fieldInfo);e.description&&A(e.description.fieldInfo);if(w&&(b=(b=x.queryTopJson(w,"dataDrillingPanel")[0])&&x.queryTopJson(b,"section")[0])){b=d.parsers.getParser("section").parseSection(b,d);if(1.9>d.revisionVersion&&1===b.stack.length&&"table"===b.stack[0].id){var B=b.stack[0];y.resizeTableJsonToFitWidth(B,700);y.resizeTableJsonToFitHeight(B,600)}D.setDataDrilling(v,e.variable.fieldInfo.templateName,
{sectionJson:b})}return e});return v}}});