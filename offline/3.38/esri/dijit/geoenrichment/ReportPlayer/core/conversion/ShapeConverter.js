// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/conversion/ShapeConverter",["dojo/_base/lang","esri/dijit/geoenrichment/utils/JsonXmlConverter","../annotations/shape/ShapeBarFlowDirections","../annotations/shape/ShapeScaleAnchorPositions"],function(r,u,z,A){function e(a){return"string"===typeof a?Number(a.replace("px","")):Number(a)}function m(a){return a?e(a):void 0}function n(a){return"number"===typeof a?a:void 0}var q={},v=/path|ellipse|circle|polygon|rect|line/,B=["fill","fill-opacity","stroke",
"stroke-opacity"],C=["display"];q.svgJsonToShapeObject=function(a,h){function k(f){if(!f)return!1;if(!h.ignoreHiddenElements)return!0;if("none"===f.display)return!1;var d=f.fill&&"none"!==f.fill&&(void 0===f["fill-opacity"]||0!==f["fill-opacity"]);f=f.stroke&&"none"!==f.stroke&&(void 0===f["stroke-opacity"]||0!==f["stroke-opacity"]);return void 0===d&&void 0===f?!0:d||f}h=h||{};if(h.ignoreHiddenElements){a=r.clone(a);var l=function(f,d){d=r.mixin({},d);f.attributes=f.attributes||{};B.forEach(function(g){var p=
f.attributes[g];void 0===p&&(p=f.attributes[g]=d[g]);d[g]=p});C.forEach(function(g){var p=d[g]||f.attributes[g];f.attributes[g]=p;d[g]=p});f.tags&&f.tags.forEach(function(g){l(g,d)})};l(a)}var c={name:h.name||"",g:[],style:{},backgroundStyle:{}},b=a.attributes;if(b.viewBox){var t=b.viewBox.split(" ");c.viewBox={xmin:e(t[0])||0,ymin:e(t[1])||0,width:e(t[2]),height:e(t[3])}}else if(b.width&&b.height)c.viewBox={xmin:0,ymin:0,width:e(b.width),height:e(b.height)};else return c;b.width&&(c.style.width=
e(b.width));b.height&&(c.style.height=e(b.height));b.zoom&&(c.style.zoom=e(b.zoom));c.preserveAspectRatio=b.preserveAspectRatio;c.showAsBar=b.showAsBar;c.showAsBar&&(c.useRange=b.useRange,c.rangeMin=m(b.rangeMin),c.rangeMax=m(b.rangeMax),c.bar_singleIcon=b.barSingleIcon,c.bar_wholeIcons=b.barWholeIcons,c.bar_flowDirection=b.barFlowDirection&&z.toSupportedValue(b.barFlowDirection),c.bar_spaceBetween=m(b.barSpaceBetween));c.scaleByValue=b.scaleByValue;c.scaleByValue&&(c.useRange=b.useRange,c.rangeMin=
m(b.rangeMin),c.rangeMax=m(b.rangeMax),c.scale_minScale=m(b.minScale),c.scale_anchorPosition=b.scaleAnchorPosition&&A.toSupportedValue(b.scaleAnchorPosition));b.showBackground&&(c.showBackground=!0,c.backgroundStyle.fillColor=b.backgroundFill,c.backgroundStyle.fillAlpha=m(b.backgroundFillOpacity),c.backgroundStyle.borderColor=b.backgroundStroke,c.backgroundStyle.borderWidth=m(b.backgroundStrokeWidth),c.backgroundStyle.borderAlpha=m(b.backgroundStrokeOpacity),c.backgroundStyle.borderDashArray=b.backgroundStrokeDashArray);
u.queryJson(a,v).forEach(function(f){var d=f.attributes;if(k(d)){switch(f.name){case "path":var g={d:d.d};break;case "ellipse":g={cx:e(d.cx),cy:e(d.cy),rx:e(d.rx),ry:e(d.ry)};break;case "circle":g={cx:e(d.cx),cy:e(d.cy),r:e(d.r)};break;case "polygon":g={points:d.points};break;case "rect":g={x:e(d.x),y:e(d.y),width:e(d.width),height:e(d.height)};break;case "line":g={x1:e(d.x1),y1:e(d.y1),x2:e(d.x2),y2:e(d.y2)}}g&&(g.name=f.name,d["fill-opacity"]&&(g["fill-opacity"]=e(d["fill-opacity"])),c.g.push(g))}});
return c};q.shapeJsonToSvgJson=function(a){var h,k,l;a.showAsBar&&(h={showAsBar:!0,useRange:a.useRange||void 0,rangeMin:n(a.rangeMin),rangeMax:n(a.rangeMax),barSingleIcon:a.bar_singleIcon||void 0,barWholeIcons:a.bar_wholeIcons||void 0,barFlowDirection:a.bar_flowDirection||void 0,barSpaceBetween:n(a.bar_spaceBetween)});a.scaleByValue&&(k={scaleByValue:!0,useRange:a.useRange||void 0,rangeMin:n(a.rangeMin),rangeMax:n(a.rangeMax),minScale:n(a.scale_minScale),scaleAnchorPosition:a.scale_anchorPosition||
void 0});a.showBackground&&(l={showBackground:!0,backgroundFill:a.backgroundStyle.fillColor||void 0,backgroundFillOpacity:n(a.backgroundStyle.fillAlpha),backgroundStroke:a.backgroundStyle.borderColor||void 0,backgroundStrokeWidth:n(a.backgroundStyle.borderWidth),backgroundStrokeOpacity:n(a.backgroundStyle.borderAlpha),backgroundStrokeDashArray:a.backgroundStyle.borderDashArray||void 0});return{name:"svg",attributes:r.mixin({width:a.style.width||void 0,height:a.style.height||void 0,viewBox:a.viewBox.xmin+
" "+a.viewBox.ymin+" "+a.viewBox.width+" "+a.viewBox.height,preserveAspectRatio:a.preserveAspectRatio,zoom:a.style.zoom||void 0},h,k,l),tags:[{name:"g",tags:a.g.map(function(c){var b=r.mixin({},c);delete b.name;return{name:c.name,attributes:b}})}]}};var w={borderColor:"stroke",fillColor:"fill",borderAlpha:"stroke-opacity",fillAlpha:"fill-opacity",borderWidth:"stroke-width",borderDashArray:"stroke-dasharray",strokeMiterLimit:"stroke-miterlimit"},D={"stroke-opacity":1,"fill-opacity":1,"stroke-width":1},
x={},y;for(y in w)x[w[y]]=y;q.applyStylesToSvgJson=function(a,h){u.queryJson(a,v).forEach(function(k){k.attributes=k.attributes||{};for(var l in h){var c=w[l];c&&(k.attributes[c]=h[l])}})};q.getStylesFromSvgJson=function(a){var h={};a=u.queryJson(a,v)[0];if(!a||!a.attributes)return h;for(var k in x){var l=a.attributes[k];void 0!==l&&(h[x[k]]=D[k]?Number(l):l)}return h};return q});