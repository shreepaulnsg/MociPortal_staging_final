// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/conversion/portalToEditorUtils/metadata/MetadataFromDataBuilder",["esri/dijit/geoenrichment/utils/JsonXmlConverter","./map/RendererToMetadataConverter"],function(x,h){var t={},y={STORE_ID:1,AREA_ID:1,StdGeographyName:1,StdGeographyID:1,StdGeographyLevel:1};t.recoverMetadataFromAreaData=function(f,u){f=f[0];var k={name:"DataCollection",tags:[{name:"Calculators",tags:[]}]},v={},d;for(d in f){var l=f[d].data,m=f[d].comparisonLevels,e=u.map[d],n=!!e;
e=n&&"object"===typeof e&&e.webMapJson||null;var g=u.locator[d];g={name:n?"Maps":g?"Locator":"DataCollections",attributes:{Name:d},tags:[]};k.tags[0].tags.push(g);var p=[];if(n)for(var c in l){if(!y[c]){var q={name:"Map",attributes:{Name:c},tags:[{name:"Layers",tags:[]}]};e&&e.operationalLayers.forEach(function(a){if(a.isLocatorLayer){var b={name:"LocatorResultsLayer",attributes:{CalculatorName:a.calculatorName},tags:[h.convertRendererJson(a.featureCollection.layers[0].layerDefinition.drawingInfo.renderer)]};
v[a.calculatorName]=a.featureCollection.layers[0].title;q.tags[0].tags.push(b)}a.isComparisonLayer&&(b=a.featureCollection.layers[0].layerDefinition.drawingInfo,a={name:"ComparisonResultsLayer",attributes:{CalculatorName:a.calculatorName},tags:[h.convertRendererJson(b.renderer)]},b.labelingInfo&&a.tags.push(h.convertLabelingInfo(b.labelingInfo)),q.tags[0].tags.push(a))});p.push(q)}}else for(c in l)p.push({name:"Field",attributes:{Name:c,Alias:c,MapTo:"DC."+c,Type:"number"===typeof l[c]?"Double":"String"}});
g.tags.push({name:"Fields",tags:p});if(m&&m.length){var r=[],w={};m.forEach(function(a){a.StdGeographyLevel&&!w[a.StdGeographyLevel]&&(w[a.StdGeographyLevel]=1,r.push(a.StdGeographyLevel))});r.length&&g.tags.push({name:"ComparisonLevels",tags:r.map(function(a){return{name:"ComparisonLevel",attributes:{Name:a}}})})}}k.tags[0].tags.forEach(function(a){if("Locator"===a.name){var b=v[a.attributes.Name];b&&(a.attributes.LayerName=b)}});return x.parseJson(k)};return t});