// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/conversion/portalToEditorUtils/parsers/ChartConverterPtoE","dojo/_base/lang esri/dijit/geoenrichment/utils/ColorUtil esri/dijit/geoenrichment/utils/ImageUtil esri/dijit/geoenrichment/utils/JsonXmlConverter ../../ConversionUtil esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/ChartJsonUtil esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/ChartTypes esri/dijit/geoenrichment/ReportPlayer/core/charts/legends/ChartLegendTypes esri/dijit/geoenrichment/ReportPlayer/core/charts/legends/ChartLegendPlacements esri/dijit/geoenrichment/ReportPlayer/core/charts/legends/ChartLegendSymbols esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/ChartDataLabelsTypes esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/ChartBarThickness esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/ChartSorting esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/ChartLineStyles esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/ChartLineMarkers esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/plots/supportClasses/GaugeLabelPlacements esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/plots/supportClasses/WaffleLabelPlacements esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/plots/supportClasses/WaffleDirections esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/plots/supportClasses/WaffleFlowStyles ./_FieldInfoBuilder dojo/i18n!esri/nls/jsapi".split(" "),
function(y,U,V,n,l,L,z,M,N,W,X,H,Y,x,I,Z,aa,ba,ca,J,E){function e(b,m){b=Number(b);return isNaN(b)?void 0:m?m(b):b}function F(b,m){return e(b,1.7<=m.revisionVersion?l.ptToPx:null)}function p(b){return l.ptToPxObj(l.parseStyleString(b))}function da(b,m){return n.queryTopJson(b,"series")[0].tags.map(function(d){if(!d.tags)return null;d.attributes=d.attributes||{};var f={_originalAttrs:d.attributes,label:d.attributes.Text||"",color:g(d.attributes.color),points:d.tags.map(function(c,h){c.attributes=c.attributes||
{};var k=(b.attributes.type===z.GAUGE||b.attributes.type===z.WAFFLE)&&h===d.tags.length-1;if((h=(h=(h=c.tags&&c.tags[0])&&h.attributes&&h.attributes.f)&&J.getCalculatorOrScriptFieldInfo(h,m))||k){k&&(h=null);h&&h.isMissing&&(k=c.attributes.Text,!k&&m.variableProvider.isPlayerOnly&&(k=(k=m.variableProvider.toCalculator(h.templateName))&&k.variable.alias),h.alias=k?k+" ("+E.missingVariable+")":E.missingVariable);k=(k=c.attributes.CaptionField)&&J.getCalculatorOrScriptFieldInfo(k,m);var t=n.queryJson(c,
"pointIcon")[0];t=t&&m.parsers.getParser("field").parseField(t.tags[0],t,m);return L.createChartPoint(h,c.attributes.Text||"",g(c.attributes.color),t,k)}}).filter(function(c){return!!c})};if(z.isLineLike(b.attributes.type)){f.lineStyle=x.isSupported(d.attributes.lineStyle)?d.attributes.lineStyle:void 0;f.lineMarker=I.isSupported(d.attributes.lineMarker)?d.attributes.lineMarker:void 0;f.lineMarkerColor=g(d.attributes.lineMarkerColor);f.lineMarkerSize=e(d.attributes.lineMarkerSize,l.ptToPx);f.lineMarkerFillColor=
g(d.attributes.lineMarkerFillColor);f.fillColor=g(d.attributes.fillColor);var a=n.queryJson(d,"multiFeatureLineStyles")[0];a&&(f.multiFeatureLineStyles=[],a.tags.forEach(function(c){var h={};c.attributes&&(h.color=g(c.attributes.color),h.lineStyle=x.isSupported(c.attributes.lineStyle)?c.attributes.lineStyle:void 0,h.lineMarker=I.isSupported(c.attributes.lineMarker)?c.attributes.lineMarker:void 0,h.lineMarkerColor=g(c.attributes.lineMarkerColor),h.lineMarkerSize=e(c.attributes.lineMarkerSize,l.ptToPx),
h.lineMarkerFillColor=g(c.attributes.lineMarkerFillColor),h.lineThickness=e(c.attributes.lineThickness,l.ptToPx),h.fillColor=g(c.attributes.fillColor));f.multiFeatureLineStyles.push(h)}))}return f}).filter(function(d){return d&&d.points&&!!d.points.length})}function O(b,m,d){var f={gridLines:b.gridlines,gridLinesCentered:b.gridlinesCentered,gridLinesOpacity:e(b.gridlinesOpacity),gridLinesColor:g(b.gridlinesColor),gridLinesThickness:F(b.gridlinesThickness,d),gridLinesStyle:x.isSupported(b.gridlinesStyle)?
b.gridlinesStyle:void 0,gridStripes:b.gridStripes,gridStripesColor:g(b.gridStripesColor),gridStripesColorAlt:g(b.gridStripesColorAlt)};m&&y.mixin(f,{hideBaseLine:void 0!==b.baseLine?!b.baseLine:b.hideBaseLine,baseLineColor:g(b.baseLineColor),baseLineOpacity:e(b.baseLineOpacity),baseLineThickness:F(b.baseLineThickness,d),baseLineStyle:x.isSupported(b.baseLineStyle)?b.baseLineStyle:void 0,baseLineValue:e(b.baseLineValue)});return f}function ea(b){var m=X.toSupportedValue(b.dataLabels),d=b.dataLabelsShowLabelUnder;
var f=b.CustomPercentFormat||b.CustomValueFormat;"string"!==typeof f?f=0:(f=f.replace("%",""),f="0"===f?0:f.replace("0.","").length);return{dataLabels:m,dataLabelsShowLabelUnder:d,dataLabelsDecimals:f,dataLabelsStyle:p(b.dataLabelsStyle),dataLabelsLabelStyle:b.dataLabelsLabelStyle?p(b.dataLabelsLabelStyle):p(b.dataLabelsStyle),dataLabelsAltColor:g(b.dataLabelsAltColor),dataLabelsEnableAltColor:b.dataLabelsEnableAltColor,dataLabelsInside:b.dataLabelsInside,dataLabelsStackedInColumns:b.dataLabelsStackedInColumns,
dataLabelsHorizontalAlign:b.dataLabelsHorizontalAlign,dataLabelsVerticalAlign:b.dataLabelsVerticalAlign,dataLabelsShowValuePercentSymbol:b.dataLabelsShowValuePercentSymbol,dataLabelsShowValueCurrencySymbol:b.dataLabelsShowValueCurrencySymbol,dataLabelsAngle:e(b.dataLabelsAngle),dataLabelsMaxWidth:e(b.dataLabelsMaxWidth,l.ptToPx)}}function P(b,m){b=n.queryTopJson(b,"templateValueFields")[0];if(!b)return null;b=n.queryTopJson(b,"d");if(!b||!b.length)return null;var d={};b.forEach(function(f){var a=
J.getCalculatorOrScriptFieldInfo(f.attributes.f,m);(d[f.attributes.templateField]=d[f.attributes.templateField]||{})[f.attributes.pointField]=a});return d}function fa(b){return(b=n.queryTopJson(b,"BackImage")[0])&&b.tags&&b.tags[0].text?V.base64DataToDataURL(b.tags[0].text):null}function ha(b,m){return 2.1>m.revisionVersion?{lineOpacity:e(void 0!==b.lineOpacity?b.lineOpacity:b.lineAreaOpacity),lineMarkersFillOpacity:e(void 0!==b.lineMarkersFillOpacity?b.lineMarkersFillOpacity:b.lineAreaOpacity),lineAreaOpacity:e(b.lineAreaOpacity)}:
{lineOpacity:e(b.lineOpacity),lineMarkersFillOpacity:e(b.lineMarkersFillOpacity),lineAreaOpacity:e(b.lineAreaOpacity)}}function g(b){b&&"string"===typeof b&&(b=6===b.length&&-1===b.indexOf("#")?"#"+b:U.toCSSColor(b));return b}E=E.geoenrichment.dijit.ReportPlayer.ReportPlayer;return{portalToEditor:function(b,m,d){if(!z.isSupported(b.attributes.type))throw Error("Chart type is not supported.");var f=da(b,d);if(!f.length)return null;var a=b.attributes,c=n.queryTopJson(b,"chartTitle")[0],h=n.queryTopJson(b,
"legend")[0],k=n.queryTopJson(b,"xAxis")[0],t=n.queryTopJson(b,"yAxis")[0],B=n.queryTopJson(b,"chartIcons")[0],C=n.queryTopJson(b,"floatingIcons")[0],D=n.queryTopJson(b,"floatingTexts")[0],Q=n.queryTopJson(b,"trigger")[0]||n.queryTopJson(b,"trigger2")[0],R=n.queryTopJson(b,"filter")[0],w=n.queryTopJson(b,"tooltip")[0],q=n.queryTopJson(b,"comparisonInfo")[0],A=n.queryTopJson(b,"dataDrillingPanels")[0];c.attributes=c.attributes||{};var u=k&&k.attributes,r=t&&t.attributes,S=u,T=r;d.report.isGraphicReport&&
1.3>d.revisionVersion&&(S=r,T=u);k=k&&k.tags&&k.tags[0].attributes&&k.tags[0].attributes;t=t&&t.tags&&t.tags[0].attributes&&t.tags[0].attributes;var ia=fa(b),K=ha(a,d);c={isChart:!0,type:a._type||a.type,isMultiFeatureChart:!!a.isMultiFeatureChart,seriesItems:f,visualProperties:y.mixin({width:l.ptToPx(a.width),height:l.ptToPx(a.height),marginTop:e(a.marginTop,l.ptToPx),marginRight:e(a.marginRight,l.ptToPx),marginBottom:e(a.marginBottom,l.ptToPx),marginLeft:e(a.marginLeft,l.ptToPx),backgroundColor:g(a.backColor),
backgroundColorOpacity:e(a.backgroundColorOpacity),plotAreaOutlineColor:g(a.plotAreaOutlineColor),plotAreaOutlineOpacity:e(a.plotAreaOutlineOpacity),plotAreaOutlineThickness:e(a.plotAreaOutlineThickness,l.ptToPx),plotAreaOutlineStyle:x.isSupported(a.plotAreaOutlineStyle)?a.plotAreaOutlineStyle:void 0,panelBackgroundColor:g(a.panelBackgroundColor),backgroundImageData:ia,noTableView:!!a.noTableView,title:{text:c.attributes.text,align:c.attributes.align&&c.attributes.align.toLowerCase(),style:p(c.attributes.style),
verticalShift:e(c.attributes.verticalShift,l.ptToPx)},xAxis:u&&y.mixin({show:"None"!==u.placement,hideLine:void 0!==u.line?!u.line:u.hideLine,showTicks:u.ticks,ticksInside:u.ticksInside||void 0,hideLabels:u.hideLabels||void 0,placement:"OtherSide"===u.placement?"OtherSide":void 0,title:k&&k.text,titleStyle:k&&p(k.style),style:p(u.style),labelsAngle:e(u.labelsAngle),lineColor:g(u.lineColor)},O(S,!1,d)),yAxis:r&&y.mixin({show:"None"!==r.placement,hideLine:void 0!==r.line?!r.line:r.hideLine,showTicks:r.ticks,
ticksInside:r.ticksInside,hideLabels:r.hideLabels||void 0,placement:"OtherSide"===r.placement?"OtherSide":void 0,title:t&&t.text,titleStyle:t&&p(t.style),style:p(r.style),labelsAngle:e(r.labelsAngle),lineColor:g(r.lineColor),showPercentSymbol:r.showPercentSymbol,showCurrencySymbol:r.showCurrencySymbol,showSymbolForAllLabels:r.showSymbolForAllLabels,showValuesAsWeightsInSeries:r.showValuesAsWeightsInSeries,nonZeroInclusive:r.nonZeroInclusive},O(T,!0,d)),isStacked:a.isStacked,showValuesAsWeightInStack:a.showValuesAsWeightInStack,
columnBarGap:e(a.columnBarGap,l.ptToPx),columnBarOpacity:e(a.columnBarOpacity),renderColumnBarsInOppositeDirections:a.renderColumnBarsInOppositeDirections,showColumnBarBackground:a.showColumnBarBackground,columnBarBackgroundColor:g(a.columnBarBackgroundColor),columnBarBackgroundOpacity:e(a.columnBarBackgroundOpacity),fillOpacity:e(a.fillOpacity),outlineOpacity:e(void 0!==a.columnBarLineOpacity?a.columnBarLineOpacity:a.outlineOpacity),outlineColor:g(void 0!==a.columnBarLineColor?a.columnBarLineColor:
a.outlineColor),outlineThickness:e(void 0!==a.columnBarLineThickness?a.columnBarLineThickness:a.outlineThickness,l.ptToPx),outlineStyle:void 0!==a.columnBarLineStyle?x.isSupported(a.columnBarLineStyle)?a.columnBarLineStyle:void 0:x.isSupported(a.outlineStyle)?a.outlineStyle:void 0,lineOpacity:K.lineOpacity,fillLineMarkers:void 0!==a.fillLineMarkers?a.fillLineMarkers:a.fillLineArea,lineMarkersFillOpacity:K.lineMarkersFillOpacity,fillLineArea:a.fillLineArea,lineAreaOpacity:K.lineAreaOpacity,donutHolePercent:e(a.donutHolePercent),
donutGap:e(a.donutGap),donutArcPercent:e(a.donutArcPercent),gaugeHolePercent:e(a.gaugeHolePercent),gaugeRangeMin:e(a.gaugeRangeMin),gaugeRangeMax:e(a.gaugeRangeMax),gaugeGap:e(a.gaugeGap),gaugeStartAngle:e(a.gaugeStartAngle),gaugeArcPercent:e(a.gaugeArcPercent),gaugeLabelStyle:p(a.gaugeLabelStyle),gaugeLabelPlacement:a.gaugeLabelPlacement?Z.toSupportedValue(a.gaugeLabelPlacement):void 0,gaugeShowArrow:a.gaugeShowArrow||void 0,gaugeArrowLineColor:g(a.gaugeArrowLineColor),gaugeArrowFillColor:g(a.gaugeArrowFillColor),
gaugeConditionalStylingOthers:void 0!==a.gaugeConditionalStylingIgnoreOthers?a.gaugeConditionalStylingIgnoreOthers:a.gaugeConditionalStylingOthers||void 0,gaugeConditionalStylingLabel:a.gaugeConditionalStylingLabel||void 0,gaugeShowFromToLabels:a.gaugeShowFromToLabels||void 0,gaugeFromLabelStyle:p(a.gaugeFromLabelStyle),gaugeToLabelStyle:p(a.gaugeToLabelStyle),waffleDirection:a.waffleDirection?ba.toSupportedValue(a.waffleDirection):void 0,waffleFlowStyle:ca.isSupported(a.waffleFlowStyle)?a.waffleFlowStyle:
void 0,waffleShowWholePictures:a.waffleShowWholePictures||void 0,waffleStretchIconsToFill:a.waffleStretchIconsToFill||void 0,waffleRangeMin:e(a.waffleRangeMin),waffleRangeMax:e(a.waffleRangeMax),waffleLabelPlacement:a.waffleLabelPlacement?aa.toSupportedValue(a.waffleLabelPlacement):void 0,waffleLabelOffset:e(a.waffleLabelOffset,l.ptToPx),waffleHideValue:a.waffleHideValue||void 0,waffleHideLabel:a.waffleHideLabel||void 0,waffleShowLabelAbove:a.waffleShowLabelAbove||void 0,waffleValueStyle:p(a.waffleValueStyle),
waffleLabelStyle:p(a.waffleLabelStyle),waffleColumnSpace:e(a.waffleColumnSpace,l.ptToPx),waffleRowSpace:e(a.waffleRowSpace,l.ptToPx),waffleConditionalStylingOthers:void 0!==a.waffleConditionalStylingIgnoreOthers?a.waffleConditionalStylingIgnoreOthers:a.waffleConditionalStylingOthers||void 0,waffleConditionalStylingValue:a.waffleConditionalStylingValue||void 0,waffleConditionalStylingLabel:a.waffleConditionalStylingLabel||void 0,waffleNumIcons:e(a.waffleNumIcons),waffleNumRows:e(a.waffleNumRows),waffleNumColumns:e(a.waffleNumColumns),
ringBackgroundColor:g(a.ringBackgroundColor),ringBackgroundOpacity:e(a.ringBackgroundOpacity),columnBarShowWholePictures:void 0!==a.showWholePictures?a.showWholePictures:a.columnBarShowWholePictures,showAxisIcons:a.showAxisIcons,showChartIcons:a.showChartIcons,sorting:!a.noSorting&&Y.isSupported(a.sorting)?a.sorting:void 0,noSorting:!!a.noSorting},ea(a))};var G=e(f[0]._originalAttrs.thickness);z.isColumnBarLike(a.type)?c.visualProperties.columnThickness=1<G?H.LARGE:1>G?H.SMALL:H.MEDIUM:z.isLineLike(a.type)&&
(c.visualProperties.lineThickness=F(G,d),f.forEach(function(v){v._originalAttrs.thickness!==G&&(v.lineThickness=e(v._originalAttrs.thickness,l.ptToPx))}));f.forEach(function(v){delete v._originalAttrs});h&&(f=h&&h.attributes||{},c.visualProperties.legend={type:M.toSupportedValue(f.type)},c.visualProperties.legend.type===M.MIN_MAX?y.mixin(c.visualProperties.legend,{minMax:{placement:N.toSupportedValue(f.placement),placementOffset:e(f.placementOffset),titleStyle:p(f.titleStyle),minVariableLabelStyle:p(f.minVariableLabelStyle),
maxVariableLabelStyle:p(f.maxVariableLabelStyle)}}):y.mixin(c.visualProperties.legend,{series:{placement:N.toSupportedValue(f.placement),placementOffset:e(f.placementOffset),hasBorder:f.hasBorder,labelParts:f.labelParts,style:p(f.style),symbol:W.isSupported(f.symbol)?f.symbol:void 0,hideOthers:f.hideOthers||void 0,showComparison:f.showComparison||void 0}}));1.2>d.revisionVersion&&(void 0!==c.visualProperties.donutGap&&(c.visualProperties.donutGap/=2*Math.PI),void 0!==c.visualProperties.gaugeGap&&
(c.visualProperties.gaugeGap/=2*Math.PI));(B=B&&B.tags)&&B.length&&(c.visualProperties.chartIcons=B.map(function(v){return v.tags&&v.tags[0]?d.parsers.getParser("field").parseField(v.tags[0],v,d):null}));(C=C&&C.tags)&&C.length&&(c.visualProperties.floatingIcons=C.map(function(v){return d.parsers.getParser("section").parseTable(v.tags[0],d)}));(D=D&&D.tags)&&D.length&&(c.visualProperties.floatingTexts=D.map(function(v){return d.parsers.getParser("section").parseTable(v.tags[0],d)}));Q&&(c.visualProperties.conditionalStyling=
d.parsers.getParser("field").parseFieldTrigger(Q));c.visualProperties.noFilter=!!a.noFilter;R&&!c.visualProperties.noFilter&&(c.visualProperties.filter=d.parsers.getParser("filter").getFilter(R));w&&(a=w.attributes||{},c.visualProperties.tooltip={title:!!a.title,value:!!a.value,weight:!!a.weight,min:!!a.min,max:!!a.max,avg:!!a.avg,conditional:!!a.conditional,fieldInfo:null,style:p(a.style),linkStyle:p(a.linkStyle)},a=n.queryTopJson(w,"template")[0],c.visualProperties.tooltip.fieldInfo=a&&d.parsers.getParser("field").parseRichTextTag(a,
d),c.visualProperties.tooltip.templateValues=P(w,d));A&&(A=(w=n.queryTopJson(A,"dataDrillingPanel")[0])&&n.queryTopJson(w,"section")[0])&&(c.dataDrillingPanelInfo={sectionJson:d.parsers.getParser("section").parseSection(A,d),templateValues:P(w,d),showOnClick:w.attributes&&w.attributes.showOnClick});q&&(q=q.attributes,w=q.name,A=d.templateJson.metadata.comparisonCalculatorsHash[w])&&(c.comparisonInfo={calculatorName:w,chartType:q.chartType,color:g(q.color),lineThickness:F(q.lineThickness,d),lineStyle:x.isSupported(q.lineStyle)?
q.lineStyle:void 0,lineMarker:I.isSupported(q.lineMarker)?q.lineMarker:void 0,lineMarkerColor:g(q.lineMarkerColor),lineMarkerSize:e(q.lineMarkerSize,l.ptToPx),lineMarkerFillColor:g(q.lineMarkerFillColor),levels:A.levels,defaultLevel:q.defaultLevel});q={};m.attributes&&m.attributes.style&&y.mixin(q,l.parseStyleString(m.attributes.style));l.ptToPxObj(q);L.provideDefaultValueForMissing(c,{font:q});d.postProcessChartJson(b,c);return c}}});