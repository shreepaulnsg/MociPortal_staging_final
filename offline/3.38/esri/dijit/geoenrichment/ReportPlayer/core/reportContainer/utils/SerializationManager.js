// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/reportContainer/utils/SerializationManager","dojo/_base/declare dojo/_base/lang dojo/dom-style ./QueryUtil ../../supportClasses/DocumentOptions esri/dijit/geoenrichment/utils/DomUtil esri/dijit/geoenrichment/ReportPlayer/core/sections/SectionTypes esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/ReportTemplateTypes".split(" "),function(p,f,g,q,r,t,n,u){return p(null,{_reportContainer:null,_pendingJsonObj:null,constructor:function(a){this._reportContainer=
a},notifyShown:function(){if(this._canApplyJson()&&this._pendingJsonObj&&this._pendingJsonObj.sections&&this._pendingJsonObj.sections.length){var a=this._pendingJsonObj;this._pendingJsonObj=null;g.set(this._reportContainer.domNode,"visibility","visible");this.fromJson(a);!this._pendingJsonObj&&this._reportContainer.onPendingDataApplied()}},_canApplyJson:function(){return t.isNodeInLayout(this._reportContainer.domNode)},fromJson:function(a){a=a||{sections:[]};if(this._canApplyJson()){this._pendingJsonObj=
null;g.set(this._reportContainer.domNode,"visibility","visible");this._reportContainer.clear();this._reportContainer.documentOptions=f.mixin(r.getDefaultDocumentOptions(),a.documentOptions);g.set(this._reportContainer.stackContainer,"backgroundColor",this._reportContainer.documentOptions.backgroundColor||this._reportContainer.viewModel.getDocumentDefaultStyles(this._reportContainer.theme).backgroundColor);this._reportContainer.updateLayout();var b=this._reportContainer.viewModel.dynamicReportInfo;
if(b&&1<b.analysisAreas.length){var e={documentOptions:a.documentOptions,sections:[]};if(b.reportObject.type===u.MULTICOLUMN)a.sections.forEach(function(d){if(function(l){return l.type===n.DETAILS&&l.stack&&l.stack.some(function(h){return"table"===h.id&&(!h.attributes||!h.attributes.dynamicColumns&&!h.attributes.dynamicRows)})}(d))for(var k=0;k<b.analysisAreas.length;k++)0!==k&&(d=f.clone(d)),d.currentFeatureIndex=k,e.sections.push(d);else e.sections.push(d)});else{a=a.sections;for(var c=0;c<b.analysisAreas.length;c++)0!==
c&&(a=f.clone(a)),a.forEach(function(d){d.currentFeatureIndex=c}),e.sections=e.sections.concat(a)}a=e}var m=this;a.sections.forEach(function(d){m.addSectionFromJson(d)})}else this._pendingJsonObj=a,g.set(this._reportContainer.domNode,"visibility","hidden")},addSectionFromJson:function(a,b,e,c){var m=this._isPageBreakSection(a)?"pageBreak":a.type===n.EMPTY?"empty":"custom";return this._reportContainer.addSection(m,{json:a},b,e,c)},_isPageBreakSection:function(a){return a.stack&&1===a.stack.length&&
"pageBreak"===a.stack[0].id},toJson:function(a){var b={};b.documentOptions=f.clone(this._reportContainer.documentOptions||{});b.sections=[];var e=this;q.getReportElements(this._reportContainer).forEach(function(c){c=e._reportContainer.getElementSection(c);!c||!a&&c.isEmpty()||b.sections.push(c.toJson())});return b}})});