// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/infographics/locator/ExportToExcelUtil",["esri/dijit/geoenrichment/when","esri/dijit/geoenrichment/promise/all","../../../dataProvider/commands/mapToImage/MapToImageUtil","esri/dijit/geoenrichment/utils/FileUtil","dojo/i18n!esri/nls/jsapi"],function(m,n,p,l,h){h=h.geoenrichment.dijit.ReportPlayer.LocatorTableInfographic;var g={},q={convert:function(a){return a.columns.map(function(b,c){var f,e=[];a.rows.forEach(function(d,k){d={value:d[b.field]||
"",alignment:{horizontal:d.style.fields[b.field].horizontalAlign||"center"}};0===k?f=d:e.push(d)});return{header:f,values:e}})}};g.prepareExportParameters=function(a){var b=h.locatorExportTitle,c={documentName:l.validateName((a.areaName?a.areaName+", ":"")+(a.layerName||b)),shortName:l.validateName((a.areaShortName?a.areaShortName+", ":"")+(a.layerName||b)),sheets:[{name:a.layerName||b,columns:q.convert(a.sectionJson.stack[0]),floatingImages:[]}],sourceInfos:[]};a.layerID&&c.sourceInfos.push({layerID:a.layerID,
numFeatures:c.sheets[0].columns[0].values.length-1});return m(a.exportMaps&&g._exportMaps(c,a.mapInfos),function(){return c})};g._exportMaps=function(a,b){var c={},f=0;return n(b.map(function(e,d){c[d]=Math.round(f/18);f+=e.node.clientHeight+50;return p.mapInfoToDataUrl(e,{saveImagesAsDataUrl:!0}).then(function(k){a.sheets[0].floatingImages.push({fromColumnIndex:a.sheets[0].columns.length+2,fromRowIndex:1+c[d],width:e.node.clientWidth,height:e.node.clientHeight,dataUrl:k})})}))};return g});