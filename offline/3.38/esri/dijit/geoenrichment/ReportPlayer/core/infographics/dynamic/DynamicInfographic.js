// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/geoenrichment/ReportPlayer/core/templates/DynamicInfographic.html":'\x3cdiv data-dojo-attach-point\x3d"viewDiv" class\x3d"esriGE_dynamicInfographic"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"noDataPlaceHolder" class\x3d"esriGENoDataPlaceHolder"\x3e\r\n        \x3cdiv class\x3d"esriGENoDataPlaceHolderLabel"\x3e${nls.noInfographicData}\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"infographicDiv"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"errorDiv" class\x3d"esriGEReportPlayerPanelErrorMessage"\x3e${nls.dynamicInfographicError}\x3c/div\x3e\r\n\x3c/div\x3e'}});
define("esri/dijit/geoenrichment/ReportPlayer/core/infographics/dynamic/DynamicInfographic","dojo/_base/declare dojo/_base/lang esri/dijit/geoenrichment/when dojo/dom-style dojo/query dojo/on dijit/_WidgetBase dijit/_TemplatedMixin esri/dijit/geoenrichment/ReportPlayer/config esri/dijit/geoenrichment/infographicUtils/theme ./_Infographic ../InfographicTypes esri/dijit/geoenrichment/ReportPlayer/dataProvider/supportClasses/ge/LocalGEInfographic esri/dijit/geoenrichment/utils/DelayUtil esri/dijit/geoenrichment/utils/DomUtil esri/dijit/geoenrichment/utils/InvokeUtil esri/dijit/geoenrichment/utils/MouseUtil esri/dijit/geoenrichment/utils/ObjectUtil ../utils/InfographicJsonUtil ../extentions/BaseSelectComparisonExt dojo/text!../../templates/DynamicInfographic.html dojo/i18n!esri/nls/jsapi ../../../_devConfig".split(" "),
function(n,u,k,f,q,p,y,z,A,B,v,e,C,D,l,E,F,w,r,G,H,t,I){t=t.geoenrichment.dijit.ReportPlayer.Infographics;var g={};g[e.ONE_VAR]=230;g[e.AGE_PYRAMID]=0;g[e.RELATED_VARS]=320;g[e.TAPESTRY]=300;g[e.PRIZM5]=300;n=n([y,z],{templateString:H,nls:t,viewModel:null,theme:null,currentFeatureIndex:null,_infographic:null,_stdPolygonsController:null,_thisAreasHighlightController:null,_initPromise:null,buildRendering:function(){G.init();this.inherited(arguments)},postCreate:function(){this.inherited(arguments);
this._showError(!1);this._showEmptyView(!1)},_currentInfographicJson:null,getRenderPromise:function(){return this._initPromise},updateInfographic:function(a){if(this.viewDiv)return this._destroyCurrentInfographic(),this._currentInfographicJson=a,this.viewModel.dynamicReportInfo&&this._currentInfographicJson.calcData&&e.supportsComparison(this._currentInfographicJson.type)&&(this._stdPolygonsController=this.viewModel.getStdPolygonsController(this._currentInfographicJson.calcData.calculatorName,this.currentFeatureIndex),
this._currentInfographicJson.type===e.ONE_VAR&&(this._thisAreasHighlightController=this.viewModel.getThisAreasHighlightController())),this._enrichInfographicJsonWithProps(a),this.domNode.style.opacity="0.001",this._initPromise=k(this._createInfographicWidgetFromJson(a),function(){this.domNode&&(this._applyTheme(a),this.domNode.style.opacity="")}.bind(this))},_enrichInfographicJsonWithProps:function(a){r.setLevels(a,a.levels)},_createInfographicWidgetFromJson:function(a){var b=this,c=this.viewModel.getInfographicDefaultStyles(this.theme);
B.set(this.viewDiv,c&&c.agePyramid&&c.agePyramid.theme||"light");if(this.viewModel.dynamicReportInfo){this.viewModel.dynamicReportInfo.isFixedDataMode||this.viewModel.dynamicReportInfo.geClient.hasCapability("ComparisonLevelsInCalculators")||(a.calcData=null);this._infographic=(new v({documentStyleProvider:this.viewModel.getDocumentDefaultStyles(this.theme),infographicStyleProvider:c,chartStyleProvider:this.viewModel.getChartDefaultStyles(this.theme),widgetParams:this._getWidgetCreationParams(a),
returnGeometry:!1,autoTitle:!1,subtitle:!1,levels:r.getSubLevels(a),highestLevel:r.getHighestLevel(a),onExpandedStateChanged:function(){b._doResize()},onSelectedFeatureChanged:function(){b._syncWithShownFeatures()}})).placeAt(this.infographicDiv);c=a.title;var h=a.calcData.variables,d=new C(a,this.viewModel.dynamicReportInfo.fieldData.areaData,this.currentFeatureIndex);this._infographic.setGeoenrichment(d);this._infographic.set("expanded",a.type===e.TAPESTRY||1<d.getData().features.length);this._infographic.set("countryID",
this.viewModel.dynamicReportInfo.countryID);this._infographic.set("type",a.type);this._infographic.set("variables",h);this._infographic.set("title",c);this._infographic.startup();a.title=a.title||c;return k(this._infographic.getRenderPromise(),function(){return b._doResize().then(function(){b._syncWithShownFeatures()})})}try{return this._createDummyInfographic(a)}catch(m){console.log(m),this._showError(!0)}},_getWidgetCreationParams:function(a){var b={infographicJson:a};switch(a.type){case e.AGE_PYRAMID:b.showVerticalAxis=
a.showVerticalAxis}return b},_createDummyInfographic:function(a){},_syncWithShownFeatures:function(){if(this._stdPolygonsController&&this._infographic&&this._infographic._widget){this._stdPolygonsController.setAttributeFields(this._infographic.dataProvider.getAttributeFields());var a=this._infographic.dataProvider.getAllGeographyAttributes({ignoreFilters:!0});if(this._currentInfographicJson.type===e.ONE_VAR)var b=this._infographic.dataProvider.getAllGeographyAttributes();else{b=[];var c=this._infographic._widget.select&&
this._infographic._widget.select.getSelectedAttributes();c&&b.push(c)}this._stdPolygonsController.setShownFeatureAttributes(b);this._stdPolygonsController.setAllFeatureAttributes(a);this._currentInfographicJson.type===e.ONE_VAR&&(this._registerStdPolygonsHighlight(a),this._registerThisAreaHighlight())}},_registerStdPolygonsHighlight:function(a){var b=this;this._stdPolygonsController.registerInfographic({highlightInfographicForAttributes:function(c){b._isCreated()&&(c=b._infographic._widget.setTableRowHighlighted(c))&&
(b.viewDiv.scrollTop=c.offsetTop+200-b.viewDiv.clientHeight)}}).then(function(){if(b._isCreated()){var c;p(b._infographic._widget.table,"mouseover, mousemove",function(){var h=b._infographic._widget.getOverRow();if(h&&h!==c){var d=(c=h)&&h.cells[0].innerHTML,m;d&&a.some(function(x){if(x.StdGeographyName===d)return m=x,!0});m&&(b._stdPolygonsController.highlightGraphicForAttributes(m),b._infographic._widget.setTableRowHighlighted(m))}});p(b._infographic._widget.table,"mouseout",function(){b._stdPolygonsController.highlightGraphicForAttributes(null);
b._infographic._widget.setTableRowHighlighted(null);c=null})}})},_registerThisAreaHighlight:function(){var a=this;this._thisAreasHighlightController.registerTable({highlightTableForAreaIndex:function(b){if(a._isCreated())if(a.currentFeatureIndex===b){if(b=a._infographic._widget.setThisAreaTableRowHighlighted())a.viewDiv.scrollTop=b.offsetTop+200-a.viewDiv.clientHeight}else a._infographic._widget.setTableRowHighlighted(null)}}).then(function(){if(a._isCreated()){var b;p(a._infographic._widget.table,
"mouseover, mousemove",function(){var c=a._infographic._widget.getOverRow();c&&c!==b&&(b=c,a._infographic._widget.isThisAreaRow(b)&&(a._thisAreasHighlightController.highlightGraphicForAreaIndex(a.currentFeatureIndex),a._infographic._widget.setThisAreaTableRowHighlighted()))});p(a._infographic._widget.table,"mouseout",function(){a._thisAreasHighlightController.highlightGraphicForAreaIndex(null);a._infographic._widget.setTableRowHighlighted(null);b=null})}})},_applyTheme:function(a){this._infographic&&
(f.set(this._infographic.domNode,"backgroundColor",a.style&&a.style.backgroundColor||"transparent"),f.set(this._infographic.domNode,"fontFamily","inherit"))},_destroyCurrentInfographic:function(){this._showError(!1);this._infographic&&this._infographic.destroy();this._infographic=null},_filterRangesStats:null,_filterRanges:null,getFilterRanges:function(){return k(this._initPromise,function(){return(this._filterRangesStats=this._infographic.dataProvider.collectFilterRangesStats({excludeThisAreas:!0}))&&
this._filterRangesStats.filterRanges}.bind(this))},setFilterRanges:function(a){this._filterRanges=a;return k(this._initPromise,function(){this._infographic.dataProvider.setFilterRanges(a,{ignoreThisAreas:this._currentInfographicJson.type===e.ONE_VAR});this._infographic._widget.select?(this._infographic._widget.select.setFeatures(this._infographic.dataProvider.getData().features),this._infographic._widget.select.setDefaultValue({emitEvent:!0})):(this._infographic._widget.setDataProvider(this._infographic.dataProvider),
this._doResize());this._syncWithShownFeatures();this._showEmptyView(!this.getNumAreasShown());this.onContentUpdated()}.bind(this))},getNumAreasTotal:function(){return this._filterRangesStats&&this._filterRangesStats.numAreasTotal||0},getNumAreasShown:function(){if(this._currentInfographicJson.type===e.ONE_VAR)return this._infographic.dataProvider.getAllGeographyAttributes().length;if(this._infographic._widget.select)return this._infographic._widget.select.getNumFeatures&&this._infographic._widget.select.getNumFeatures()||
0},_showEmptyView:function(a){l[a?"hide":"show"](this.infographicDiv);l[a?"show":"hide"](this.noDataPlaceHolder);a&&this._syncEmptyViewPlaceholder()},_syncEmptyViewPlaceholder:function(){this.noDataPlaceHolder&&f.set(this.noDataPlaceHolder,"paddingTop",(this.height-f.get(this.noDataPlaceHolder,"height"))/2+"px")},notifyShown:function(){},width:null,height:null,_infographicResizedAtLeastOnce:!1,_hasScroll:!1,resize:function(a,b,c){if(void 0!==a){if((!c||!c.force)&&w.compareEqual(this.width,a,2)&&w.compareEqual(this.height,
b,2))return;this.width=a;this.height=b}return E.invoke(this,"_doResize",A.isPlayerOnServer?0:50)},_doResize:function(){var a=this;if(this._infographic&&this._infographic.domNode&&l.isNodeInLayout(this.domNode)&&this._currentInfographicJson){this._syncJsonDimensions();var b=this._currentInfographicJson.type,c=Math.max(function(){if(b===e.ONE_VAR){var d=q(".OneVarMultiComparison_Table",a.domNode)[0];d=d?f.get(d,"height")+120:0;return Math.max(d,g[b])}return b===e.TAPESTRY?(d=(d=q(".Tapestry_Main_Table",
a.domNode)[0])?f.get(d,"height")+60:0,Math.max(d,g[b])):b===e.PRIZM5?(d=(d=q(".Prizm5_Main_Table",a.domNode)[0])?f.get(d,"height")+60:0,Math.max(d,g[b])):b!==e.RELATED_VARS||a._infographic.expanded?g[b]:200}(),this.height);this._hasScroll=c>this.height;var h=this.width-(this._hasScroll?l.getScrollbarSize().w+3:0);f.set(this._infographic.domNode,{width:h+"px",height:c+"px"});f.set(this.viewDiv,{height:this.height+"px",overflowY:"auto"});this._infographic.resize();this._adjustErrorMessage();return D.delay()}},
hasScroll:function(){return this._hasScroll},changeScroll:function(a,b){this.domNode.scrollLeft+=a;this.domNode.scrollTop+=b},_syncJsonDimensions:function(){this._currentInfographicJson.style=this._currentInfographicJson.style||{};this._currentInfographicJson.style.width=this.width;this._currentInfographicJson.style.height=this.height},getPreferredHeight:function(){return this._infographic&&f.get(this._infographic.domNode,"height")},collapseContent:function(){this._infographic&&this._infographic.collapseContent()},
getVisualState:function(){return{type:this._currentInfographicJson.type,selectedFeatureId:this._infographic&&this._infographic.getSelectedFeatureID(),filterRanges:this._filterRanges?u.clone(this._filterRanges):null}},setVisualState:function(a){if(a){var b=this;return k(this._initPromise,function(){if(b._infographic)return k(a.filterRanges&&b.setFilterRanges(a.filterRanges),function(){return a.selectedFeatureId&&b._infographic.setSelectedFeatureID(a.selectedFeatureId)})})}},isMouseOver:function(){return F.isMouseOver(this.domNode)||
this._infographic&&this._infographic._widget&&this._infographic._widget.select&&this._infographic._widget.select.isMouseOver()},_showError:function(a){I.emulateErrors.contentErrors&&(a=!0);l[a?"show":"hide"](this.errorDiv);l[a?"hide":"show"](this.infographicDiv)},_adjustErrorMessage:function(){f.set(this.errorDiv,"paddingTop",f.get(this.domNode,"height")/2-20+"px")},toJson:function(){return u.clone(this._currentInfographicJson)},onContentUpdated:function(){},onShowWaiting:function(a){},_isCreated:function(){return this.domNode&&
this._infographic&&this._infographic.domNode},destroy:function(){this._stdPolygonsController&&this._stdPolygonsController.setShownFeatureAttributes([]);this._destroyCurrentInfographic();this.inherited(arguments)}});n.Infographic=v;return n});