// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/annotations/shape/ShapeContainer","dojo/_base/declare dojo/_base/lang dojo/sniff dojo/dom-class dojo/dom-construct ../../grid/valueField/ValueField esri/dijit/geoenrichment/utils/MathUtil esri/dijit/geoenrichment/utils/ObjectUtil ../utils/AnnotationsUtil ./ShapeThemeUtil ./_ShapeElementRenderer dojo/i18n!esri/nls/jsapi".split(" "),function(n,g,p,q,l,r,t,h,u,m,v,B){function w(a){return 1===a.length&&x.test(a[0].d)}function y(a){return 1===a.length&&
z.test(a[0].d)}var x=/(M\s?0 32\s?h\s?64)|(M\s?0 32\s?L\s?64 32)/,z=/M0 0\s?v\s?64\s?h\s?64\s?V0\s?H\s?0\s?z/;return n(r,{isShape:!0,viewModel:null,theme:null,currentFeatureIndex:null,json:null,alignParams:null,applyThemeStyle:!0,getPreviewValueFunction:null,parentWidget:null,_g:!1,_viewBox:!1,_shapeStyle:null,_preserveAspectRatio:void 0,_isPlaceholder:!1,_angle:0,_shapeThemeStyle:null,_needSaveShapeThemeStyle:!0,_backgroundThemeStyle:null,_needSaveBackgroundThemeStyle:!0,_showAsBar:!1,_bar_singleIcon:!1,
_bar_wholeIcons:!1,_bar_flowDirection:null,_bar_spaceBetween:null,_scaleByValue:!1,_scale_minScale:null,_scale_anchorPosition:null,_useRange:!1,_rangeMin:null,_rangeMax:null,_showBackground:!1,_backgroundStyle:null,_supportNonScalingStroke:!1,_displayViewBox:null,_displayG:null,postCreate:function(){this.content=l.create("div",{"class":"shapeContainer_content"});this.fieldStyle=this.fieldStyle||{};this.fieldStyle.width=this.json.style.width;this.fieldStyle.height=this.json.style.height;this._g=this.json.g;
this._viewBox=this.json.viewBox;this._shapeStyle=this.json.style||{};this._preserveAspectRatio=this.json.preserveAspectRatio;this._isPlaceholder=this.json.isPlaceholder;this._angle=this.json.style.angle||0;this._processThemeStyle();this._showAsBar=this.json.showAsBar;this._bar_singleIcon=this.json.bar_singleIcon;this._bar_wholeIcons=this.json.bar_wholeIcons;this._bar_flowDirection=this.json.bar_flowDirection;this._bar_spaceBetween=this.json.bar_spaceBetween;this._scaleByValue=this.json.scaleByValue;
this._scale_minScale=this.json.scale_minScale;this._scale_anchorPosition=this.json.scale_anchorPosition;this._useRange=this.json.useRange;this._rangeMin=this.json.rangeMin;this._rangeMax=this.json.rangeMax;this._backgroundStyle=this.json.backgroundStyle||{};this._showBackground=this.json.showBackground;(this._showAsBar||this._scaleByValue)&&this._processBackgroundThemeStyle();this.inherited(arguments);q.add(this.domNode,"esriGEShapeContainer");this.setPosition(this.json.style.left||0,this.json.style.top||
0);this._applyRotation();this._lastAlignParams={horizontalAlign:this.alignParams&&this.alignParams.horizontalAlign||this.json.style.horizontalAlign||"center",verticalAlign:this.alignParams&&this.alignParams.verticalAlign||this.json.style.verticalAlign||"middle"}},_processThemeStyle:function(){this.applyThemeStyle&&(this._shapeThemeStyle=m.getThemeStylesFromShapeJson(this.json,this.parentWidget.parentGrid),this._needSaveShapeThemeStyle=!!this.json.themeStyle)},_processBackgroundThemeStyle:function(){this.applyThemeStyle&&
(this._backgroundThemeStyle=m.getBackgroundThemeStylesFromShapeJson(this.json,this.parentWidget.parentGrid),this._needSaveBackgroundThemeStyle=!!this.json.backgroundThemeStyle)},getShapeStyle:function(){return this._getShapeStyle()},_getShapeStyle:function(a,b){var c={};h.copyOwnJsonProperties(this._shapeThemeStyle,c);a&&a.color&&h.copyOwnJsonProperties({fillColor:a.color,borderColor:a.color},c);h.copyOwnJsonProperties(this._getOwnShapeStyleForRendering(b),c);return c},getBackgroundStyle:function(){var a=
{};h.copyOwnJsonProperties(this._backgroundThemeStyle,a);h.copyOwnJsonProperties(this._getOwnBackgroundStyleForRendering(),a);return a},setAngle:function(a){this._angle=t.angleTo180_180Range(Number(a)||0);this._applyRotation()},_applyRotation:function(){this._angle=0<this._angle||0>this._angle?this._angle:0;var a=p("webkit")?"webkitTransform":"transform";this.content.style[a]=0!==this._angle?"rotate("+this._angle+"deg)":""},_lastAlignParams:null,resize:function(a,b){a&&(this.setWidth(a.w),this.setHeight(a.h));
this._updateShapeNode();this._lastAlignParams=b||this._lastAlignParams;u.alignAnnotationContainer(this,this._lastAlignParams,this._calcGeometry().content)},_left:0,_top:0,getLeft:function(){return this._left},getTop:function(){return this._top},setPosition:function(a,b){void 0!==a&&(this._left=a||0,this.domNode.style.left=this._left+"px");void 0!==b&&(this._top=b||0,this.domNode.style.top=this._top+"px")},_svgNode:null,getSvgNode:function(){return this._svgNode},_updateShapeNode:function(){var a=
this;this._displayViewBox=this._displayG=null;if("none"===this._preserveAspectRatio){var b=y(this._g),c=!b&&w(this._g);if(b||c){c=this.getWidth();var e=this.getHeight(),d=c/64,k=e/64;this._displayG=[g.mixin({},this._g[0])];this._displayG[0].d=b?"M0 0v"+e+"h"+c+"V0H0z":"M0 "+e/2+"h"+c;this._displayViewBox=g.mixin({},this._viewBox);this._displayViewBox.xmin*=d;this._displayViewBox.ymin*=k;this._displayViewBox.width*=d;this._displayViewBox.height*=k}}b=this._displayViewBox||this._viewBox;c=this.getWidth();
e=this.getHeight();d=this._calcGeometry();this.content.innerHTML="";this.content.style.width=d.content.w+"px";this.content.style.height=d.content.h+"px";if(this._isPlaceholder)l.create("div",{"class":"shapeContainer_svgPlaceholder"},this.content);else{var f=this.getPreviewValueFunction&&this.getPreviewValueFunction();c={content:this.content,preserveAspectRatio:this._preserveAspectRatio,supportNonScalingStroke:this._supportNonScalingStroke,viewBox:b,width:c,height:e,shapeW:d.shape.w,shapeH:d.shape.h,
borderWidth:this._getMaxBorderWidth(),g:this._displayG||this._g,value:f?f.normalizedValue:.6,shapeStyle:this._getShapeStyle(f&&f.conditionalStyling),shapeStyleBuilder:function(A){return a._getShapeStyle(f&&f.conditionalStyling,A)},bgStyle:this._showBackground&&this.getBackgroundStyle(),bar:this._showAsBar&&{singleIcon:this._bar_singleIcon,wholeIcons:this._bar_wholeIcons,flowDirection:this._bar_flowDirection,spaceBetween:this._bar_spaceBetween,showBackground:this._showBackground},scale:this._scaleByValue&&
{minScale:this._scale_minScale,anchorPosition:this._scale_anchorPosition,showBackground:this._showBackground}};v.renderElements(c);this._svgNode=c._svgNode}},_calcGeometry:function(){var a=this._displayViewBox||this._viewBox,b=this.getWidth(),c=this.getHeight(),e=a.width/a.height,d=Math.min(b,c*e);"none"===this._preserveAspectRatio?(a=b,e=c):(a=d,e=d/e);d=this._showAsBar&&!this._bar_singleIcon;return{shape:{w:a,h:e},content:{w:d?b:a,h:d?c:e}}},_getOwnShapeStyleForRendering:function(a){return this._fixBorderStyle(this._shapeStyle,
a)},_getOwnBackgroundStyleForRendering:function(){return this._fixBorderStyle(this._backgroundStyle)},_fixBorderStyle:function(a,b){b=this._getBorderStrokeMultiplier(a,b);return 1!==b?g.mixin({},a,{borderWidth:a.borderWidth*b}):a},_getBorderStrokeMultiplier:function(a,b){if(0<a.borderWidth&&0<a.borderAlpha&&!this._supportNonScalingStroke){a=this._displayViewBox||this._viewBox;var c=b||this._calcGeometry().shape;b=c.w;c=c.h;var e=function(d,k){d/=k;return 1>d?1/d:d};return e(b,a.width)>e(c,a.height)?
a.width/b:a.height/c}return 1},_getMaxBorderWidth:function(){return Math.max(0<this._shapeStyle.borderAlpha&&this._shapeStyle.borderWidth||0,0<this._backgroundStyle.borderAlpha&&this._backgroundStyle.borderWidth||0)},toJson:function(){var a={id:"shape",g:this._g,viewBox:this._viewBox,preserveAspectRatio:this._preserveAspectRatio,isPlaceholder:this._isPlaceholder,style:g.mixin({},this._shapeStyle,{left:this._left,top:this._top,width:this.getWidth(),height:this.getHeight(),angle:this._angle}),themeStyle:this._needSaveShapeThemeStyle?
this._shapeThemeStyle:void 0,showAsBar:this._showAsBar,bar_singleIcon:this._bar_singleIcon,bar_wholeIcons:this._bar_wholeIcons,bar_flowDirection:this._bar_flowDirection,bar_spaceBetween:this._bar_spaceBetween,scaleByValue:this._scaleByValue,scale_minScale:this._scale_minScale,scale_anchorPosition:this._scale_anchorPosition,useRange:this._useRange,rangeMin:this._rangeMin,rangeMax:this._rangeMax,showBackground:this._showBackground,backgroundStyle:this._backgroundStyle,backgroundThemeStyle:this._needSaveBackgroundThemeStyle?
this._backgroundThemeStyle:void 0};return g.clone(a)}})});