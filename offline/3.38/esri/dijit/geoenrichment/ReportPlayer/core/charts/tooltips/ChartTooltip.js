// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/charts/tooltips/ChartTooltip","dojo/_base/declare dojo/_base/lang dojo/string dojo/dom-construct ./ZoomSupportTooltip ./_BuilderUtil ./_ColumnBarChartTooltipBuilder ./_GaugeChartTooltipBuilder ./_WaffleChartTooltipBuilder ./_LineChartTooltipBuilder ./_PieDonutRingChartTooltipBuilder ../utils/ChartTypes ../../supportClasses/conditionalStyling/ConditionalStyleLegendBuilder ../../dataDrilling/DataDrillingVisualizer ../../supportClasses/WidgetQueryUtil dojo/i18n!esri/nls/jsapi".split(" "),
function(m,q,r,g,t,n,u,v,w,x,y,f,z,A,B,h){function p(a,b,d){a._hide();var e=new A({viewModel:b.viewModel,theme:b.theme,parentWidget:b.chartContainer,getPreviewValueFunction:n.buldPreviewValueFunction(b,{type:"dataDrilling"}),domNode:d,closeZoomedDDWhenClickedOutside:!0,closeZoomedDDOnEsc:!0,onClose:function(){e.play(!1,!0)}});e.play(!0,!0,null,b.dataDrillingPanelInfo.sectionJson)}h=h.geoenrichment.dijit.ReportPlayer.ChartTooltip;var k={lastShownInfo:null,setInfo:function(a){(k.lastShownInfo=a)&&setTimeout(function(){k.lastShownInfo===
a&&(k.lastShownInfo=null)},6E4)}};m=m(t,{tooltipClass:"esriGEChartContainer_chartTooltip_masterTooltip",_chartType:null,constructor:function(){var a=this,b=this.text;this.text=function(d,e){var c=d.run&&d.run.data&&d.run.data[d.index];c=c.tooltip&&"object"===typeof c.tooltip?a._renderTooltip(c.tooltip):void 0;return c||b(d,e)}},_needSetRectFromShape:function(){return f.isPictureLike(this._chartType)},setChartType:function(a){this._chartType=a},_renderTooltip:function(a){a=q.mixin({},a,a.getContext());
var b=!a.viewModel.dynamicReportInfo,d=b&&!a.viewModel.isGraphicStyle(),e=!B.isDataDrillingView(a.chartContainer);(a.viewModel.enableDataDrilling||b)&&e||delete a.dataDrillingPanelInfo;var c=g.create("div",{"class":"esriGEChartContainer_chartTooltip"},document.body);if(d)this._buildVariableNamePreview(a,c);else if(a.richTextFieldInfo||a.showTitle||a.showValue||a.showMin||a.showMax||a.showAvg||a.showWeight||a.showConditional||a.dataDrillingPanelInfo)this._buildTooltip(a,c,b,e);else if(b)g.create("div",
{"class":"chartTooltip_row esriGERowHigh",innerHTML:h.noTooltipAvailable},c);else return{node:null};k.setInfo(a.dataDrillingPanelInfo&&a.dataDrillingPanelInfo.showOnClick&&!b?{tooltip:this,info:a,root:c}:null);document.body.removeChild(c);return{node:c,style:a.tooltipStyle}},_buildTooltip:function(a,b,d,e){var c=this;this._chartType===f.PIE||this._chartType===f.DONUT||this._chartType===f.RING?y.buildPieDonutRingChartTooltip(a,b):this._chartType===f.GAUGE?v.buildGaugeChartTooltip(a,b):this._chartType===
f.WAFFLE?w.buildWaffleChartTooltip(a,b):f.isColumnBarLike(this._chartType)?u.buildColumnChartTooltip(a,b):f.isLineLike(this._chartType)&&x.buildLineChartTooltip(a,b);a.conditionalStyling&&a.showConditional&&g.place(z.createLegendNode(a.conditionalStyling,a.conditionalStats,"chart",a.isBenchmarked?a.unbenchmarkedValue:a.value,a.formatFunc),b);if(a.dataDrillingPanelInfo||d&&e){var l=g.create("div",{"class":"chartTooltip_row esriGERowHigh esriGECenter",style:"margin-top:20px;"},b);(e=d&&!a.dataDrillingPanelInfo)||
g.create("div",{"class":"dijitInline esriGESpaceAfterMedium",innerHTML:r.substitute('\x3csvg xmlns\x3d"http://www.w3.org/2000/svg" width\x3d"16" height\x3d"16" viewBox\x3d"0 0 32 32"\x3e\x3cpath fill\x3d"${fill}" d\x3d"M30 28v1H3V4h1v24h2v-9h6v9h2V6h6v22h2V13h6v15h2z"/\x3e\x3c/svg\x3e',{fill:a.tooltipLinkStyle.color})},l);l=g.create("div",{"class":"dijitInline esriGELink",innerHTML:d?a.dataDrillingPanelInfo?h.drillForMoreDataEdit:h.addDataDrilling:h.drillForMoreData},l);e||(l.style.color=a.tooltipLinkStyle.color);
l.addEventListener("click",function(){d?(c._hide(),a.chartContainer.onShowDataDrillingPreview(a)):p(c,a,b)})}},_buildVariableNamePreview:function(a,b){b=g.create("div",{"class":"chartTooltip_row esriGERowHigh"},b);n.addValue((a.fieldInfo.script?a.fieldInfo.script.alias:a.fieldInfo.alias)||"",b)}});m.tryShowDataDrillingForShownTooltip=function(){var a=k.lastShownInfo;a&&p(a.tooltip,a.info,a.root)};return m});