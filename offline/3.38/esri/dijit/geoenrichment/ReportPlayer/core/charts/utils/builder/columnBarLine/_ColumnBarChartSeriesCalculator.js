// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/builder/columnBarLine/_ColumnBarChartSeriesCalculator","dojo/_base/lang ../../ChartTypes ../../ChartSorting ../../ChartLineStyles ../../ThemeCalculator ../utils/TooltipInfoBuilder ./_ComparisonUtil ./_AxisBuilder ./_PointLabelUtil ./_StatsBuilder esri/dijit/geoenrichment/utils/ColorUtil".split(" "),function(P,Q,F,G,x,R,S,H,y,T,I){var U={calcLineStyle:function(a,l){return{color:I.getColorWithAlpha(l.outlineColor||a,l.outlineOpacity),width:l.outlineThickness,
style:G.toGFXValue(l.outlineStyle||G.SOLID)}}};return{calcSeriesColumnBar:function(a){var l=a.chart,f=a.visualProperties,p=a.seriesItems,J=1===p.length,m=a.seriesItemsWithComparison||p,h=a.chartType,B=a.comparisonInfo,z=a.themeSettings,q=a.viewModel,C=1===m.length&&a.sorting,V=1<m.length&&f.renderColumnBarsInOppositeDirections,D=[],K=new T({visualProperties:f,seriesItems:m,viewModel:q,currentFeatureIndex:a.currentFeatureIndex,isMultiFeatureChart:a.isMultiFeatureChart,excludedSeriesHash:a.excludedSeriesHash,
comparisonFeatureAttributes:a.comparisonFeatureAttributes,chartType:h});y.createPointToLabelMap(l);var E={};m.forEach(function(d,u){if(d.points.length){var v={name:d.label,data:[],isComparisonSeries:d.isComparisonSeries,params:{plot:d.isComparisonSeries&&S.getComparisonPlotName(h,B)||void 0}},c=K.getStatisticsForSeriesAt(u);x.provideMissingIconsForPoints(d.points,h);var L=[];d.points.forEach(function(b,e){var r=c.values[e],A=r.value,g=A||0,t=c.conditional&&c.conditional.styles[e];var k=(k=t&&t.backgroundColor)||
x.calcColorForPoint({point:b,seriesItem:d,pointIndex:e,seriesIndex:u,numSeries:J?1:m.length,chartType:h,themeSettings:z,isComparisonSeries:d.isComparisonSeries,comparisonInfo:B,isMultiFeature:a.isMultiFeatureChart});var w=U.calcLineStyle(k,f),M=k;k=1>f.columnBarOpacity?I.getColorWithAlpha(k,f.columnBarOpacity):k;if(b.hidden){var n=k;k=M="transparent"}if(b.hidden){var W=w.color;w.color="transparent"}t=e+1;g={x:t,y:g*function(){if(V){var N=!a.isMultiFeatureChart&&Q.isBarLike(h);return u>=m.length/2?
N?1:-1:N?-1:1}return 1}(),originalValue:A,isUnavailableData:isNaN(A),valueProp:"y",unsortedIndex:e,originalIndex:b.originalIndex||e,seriesIndex:u,name:y.getPointLabel(b,q),valuesSumsInSeries:c.absSumInSeries,point:b,fill:k,icon:x.calcIconForPoint(b,M,h),bgIcon:x.calcBackgroundIconForPoint(b,h,z,f),stroke:{color:w.color,width:w.width,style:w.style},unhiddenFillColor:n,unhiddenLineColor:W,isBenchmarked:r.isBenchmarked,unbenchmarkedValue:r.ownValue};f.isStacked&&(n=f.showValuesAsWeightInStack?c.stackValuesAsWeighedPercents:
c.stackValues,g.stackValues=n&&n[e]);f.showValuesAsWeightInStack?g.y=c.weightsInStack?100*c.weightsInStack[e]:0:f.yAxis.showValuesAsWeightsInSeries&&(g.y/=c.absSumInSeries/100);n=y.getPointLabel(m[0].points[e]||b,q);b=R.getTooltipInfo({yValue:A,pointLabel:n,seriesLabel:d.label,isSinglePointInSeries:1===d.points.length,minInSeriesValue:c.minInSeries,maxInSeriesValue:c.maxInSeries,sumInSeriesValue:c.sumInSeries,absSumInSeriesValue:c.absSumInSeries,avgInSeriesValue:c.avgInSeries,weightInStack:c.weightsInStack&&
c.weightsInStack[e],minInAreasValue:c.minInSeries,maxInAreasValue:c.maxInSeries,sumInAreasValue:c.sumInSeries,absSumInAreasValue:c.absSumInSeries,avgInAreasValue:c.avgInSeries,visualProperties:f,chartType:h,isMultiFeature:a.isMultiFeatureChart,conditionalStyling:f.conditionalStyling,conditionalStats:c.conditional&&c.conditional.stats,fieldInfo:b.fieldInfo,isThisAreaSpecific:B&&!a.isMultiFeatureChart?!d.isComparisonSeries:void 0,isThisAreaSingleSeries:J,decimals:b.value&&b.value.decimals,fill:g.fill,
stroke:0<g.stroke.width?g.stroke.color:void 0,isBenchmarked:r.isBenchmarked,unbenchmarkedValue:r.ownValue,chartContainer:a.chartContainer,viewModel:q,theme:a.theme,themeSettings:z,dataDrillingPanelInfo:a.dataDrillingPanelInfo,pointName:a.isMultiFeatureChart?d.label:n,seriesName:b.originalSeriesName||d.label,areaName:b.areaName,featureIndex:r.featureIndex,isComparisonPoint:b.isComparisonPoint,comparisonFeatureAttribute:b.comparisonFeatureAttribute});var O=E[t]=E[t]||[];a.excludedSeriesHash[d.label]||
(O.push(b),L.push(b));b.getGroup=function(){return a.isMultiFeatureChart?L:O};g.tooltip=b;v.data.push(g)});C&&C!==F.NONE&&(v.data.sort(function(b,e){return(b.y-e.y)*(C===F.DESC?-1:1)}),v.data.forEach(function(b,e){b.x=e+1}));v.data.forEach(function(b){y.updatePointIndexToLabelMap(l,b.x,u,b.point,q)});D.push(v)}},this);p=K.getTotalStats();H.prettifyYAxis(p.minYValue,p.maxYValue,l,f,h,z,q,D);a.plotStats&&(P.mixin(a.plotStats,p),a.plotStats.pointIndexToTooltipsHash=E);return D},prettifyColumnBarYAxis:function(a){H.prettifyYAxis(a.totalStat.minYValue,
a.totalStat.maxYValue,a.chart,a.visualProperties,a.chartType,a.themeSettings,a.viewModel,a.chartSeries,!0,a.chartSize);a.chart.dirty=!0}}});