// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/builder/utils/ChartDataUtil",["../../../../supportClasses/templateJsonUtils/fieldInfo/FieldInfoRenderer","esri/dijit/geoenrichment/utils/ObjectUtil","../../ChartTypes","esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/conditionalStyling/ConditionalStyleUtil","esri/dijit/geoenrichment/ReportPlayer/countryConfig"],function(p,q,r,x,y){function t(a){return u||(a&&a.yAxis&&a.yAxis.nonZeroInclusive?z:A)}var k={formatNumber:function(a,
b,e,g){a=a||0;b={places:b.dataLabelsDecimals||0,preserveTrailingZeroes:!0};if(g)return q.formatNumberAsCurrency(a,y.getCurrencyFormat(),b);a=q.formatNumber(a,b);e&&(a+="%");return a},undefinedToDefault:function(a,b){return void 0===a?b:a}},u,A=[1E3,1100,1200,150,70,900,110,300,80,200,1700],z=[1E3,1100,1250,1200,1050,990,1010,1110,1260,1210,1060,995],v=[1,.7,1.2,.5,1.1,1.3,.3,2,.4],w=[.91,.92,.9,1.2,1.2,1.3];k.CHART_DATA_SMOOTH=[1145,1134,1159,1275,1404,1408,1337,1149,1074,1040,1065,1078,964,798,531,
360,254,258];k.getPointValue=function(a){var b=a.point,e=a.index,g=a.seriesIndex,f=a.chartType,c=a.visualProperties,h=a.viewModel,l=a.currentFeatureIndex,d=a.chartData,m=a.isComparisonSeries,n=a.comparisonFeatureAttribute;a=a.numPoints;if(b.value&&(b.value.value||h.dynamicReportInfo))return b.value.value;if(h.dynamicReportInfo)d=m?n&&n[b.fieldInfo.name]||0:p.getFieldDataValue(b.fieldInfo,{fieldData:h.dynamicReportInfo.fieldData,featureIndex:l}),d=q.parseNumber(d),isNaN(d)&&console.log("Can't render chart value for field \x3d\x3e "+
(b.fieldInfo?b.fieldInfo.name:"missing field"));else if(b=b.fieldInfo&&b.fieldInfo.statefulName&&b.fieldInfo.statefulName.charAt(0),d=d||t(c),d=d[e%d.length],f===r.GAUGE&&"p"!==b&&c.gaugeRangeMax)a=c.gaugeRangeMin||0,d=.425123*(c.gaugeRangeMax-a)+a;else if(f===r.WAFFLE)"p"===b||"number"!==typeof c.waffleRangeMin&&"number"!==typeof c.waffleRangeMax?a&&(d="p"===b?90.85/a:d/a):(e=c.waffleRangeMin,c=c.waffleRangeMax,"number"===typeof e&&"number"!==typeof c?c=0===e?1E3:e*((1<a?a:2)+1):"number"!==typeof e&&
"number"===typeof c&&(e=0),d=.9085*(c-e)/(a||1)+e);else if(d*=v[g%v.length]*(0===g?1:w[e%w.length]),!c.conditionalStyling){a=d;if("p"===b||c.dataLabelsShowValuePercentSymbol||c.yAxis&&c.yAxis.showPercentSymbol||c.yAxis&&c.yAxis.showValuesAsWeightsInSeries)a=Number((a/24.5123).toFixed(c.dataLabelsDecimals||1));"i"===b&&(a=Number((a/7).toFixed(c.dataLabelsDecimals||1)));d=a}return d};k.getCaptionValue=function(a,b){return a.captionFieldInfo?b.dynamicReportInfo?p.getFieldDataValue(a.captionFieldInfo,
{fieldData:b.dynamicReportInfo.fieldData}):p.renderFieldInfoInTableCell(a.captionFieldInfo).formattedValue:""};k.allowNegativeValuesInPreview=function(a,b){return r.supportsNegativeValues(a)&&!b.isStacked&&!b.renderColumnBarsInOppositeDirections};k.getChartData=function(a){function b(){f=Infinity;c=-Infinity;g.forEach(function(d){f=Math.min(f,d);c=Math.max(c,d)})}function e(d,m,n){var B=c-f,C=f;f=isFinite(d)?d:Math.min(0,f);c=isFinite(m)?m:c>=f?c:2*f;n&&(d=.1*(c-f),f+=d,c-=d);var D=(c-f)/B;g=g.map(function(E){return(E-
C)*D+f})}var g=a.chartData;g=(g||t(a.visualProperties)).slice();g.length=Math.min(g.length,a.numPoints);var f,c;if(a.filterRangesStats)return b(),e(a.filterRangesStats.min,a.filterRangesStats.max,!0),g;if(a.conditionalStats){b();var h=a.conditionalStats.min,l=a.conditionalStats.max;a.conditionalStats.canFallBelowMin&&(h=0===h?-10:0>h?1.2*h:.8*h);a.conditionalStats.canFallAboveMax&&(l=0===l?10:0>l?.8*l:1.2*l);e(h,l,!1)}return g};k.setPreviewChartData_dev=function(a){u=a};k.getConditionalStylesForStatsPointValues=
function(a,b){a=a.map(function(e){return"object"===typeof e?e.isBenchmarked?e.ownValue:e.value:e});return x.getConditionalStylesOrFileNamesForGroup(b.conditionalStyling,a)};return k});