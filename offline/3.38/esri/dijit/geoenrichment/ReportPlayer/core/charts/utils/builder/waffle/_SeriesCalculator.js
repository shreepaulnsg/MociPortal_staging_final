// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/builder/waffle/_SeriesCalculator","../../ThemeCalculator ../../ChartTypes ../../ChartJsonUtil ../../../../supportClasses/conditionalStyling/ConditionalStyleUtil ../../../../supportClasses/templateJsonUtils/fieldInfo/FieldInfoBuilder ../utils/ChartDataUtil ../utils/TooltipInfoBuilder".split(" "),function(x,n,G,H,I,p,J){return{calcSeries:function(e){var g=n.WAFFLE,y=e.themeSettings,z=e.viewModel,c=e.visualProperties,A=e.currentFeatureIndex,
B=[],q=e.seriesItems[0],C={name:"data",data:[]},l=[],r=0,D=0,t=1E6,u=-1E6,b=q.points;1===b.length&&(b=b.slice(),b.push(G.getWaffleOthersPoint()));if(n.isConditionalStylingSupported(g)&&c.conditionalStyling){var E=H.getStatistics(c.conditionalStyling);var K=E&&p.getChartData({conditionalStats:E,numPoints:b.length})}var L=b.every(function(a){return!a.fieldInfo||I.isFieldInfoInPercentState(a.fieldInfo)}),v=0>c.waffleRangeMin;b.forEach(function(a,d){d<b.length-1?(a=p.getPointValue({point:a,index:d,seriesIndex:0,
maxValue:!1,chartType:g,visualProperties:c,viewModel:z,currentFeatureIndex:A,chartData:K,numPoints:b.length}),v=v||0>a):(a=l.reduce(function(h,k){return h+k},0),a=c.waffleRangeMax?Math.max(0,c.waffleRangeMax-a):L?Math.max(0,100-a):0);a=(l[d]=a)||0;r+=a;D+=Math.abs(a);t=Math.min(t,a);u=Math.max(u,a)});var M=r/b.length,m=n.isConditionalStylingSupported(g)&&c.conditionalStyling?p.getConditionalStylesForStatsPointValues(l,c):null;b.forEach(function(a,d){var h=d===b.length-1,k=l[d],F=k||0;if(m){var f=
(f=m.styles[d])&&f.backgroundColor;h&&!c.waffleConditionalStylingOthers&&(f=void 0)}f=f||x.calcColorForPoint({point:a,seriesItem:q,pointIndex:d,isOthersPoint:h,seriesIndex:0,numSeries:1,chartType:g,themeSettings:y});var w=F;h||c.waffleRangeMin&&(w=Math.max(0,w-c.waffleRangeMin));C.data.push({originalValue:k,x:1,y:w,isUnavailableData:isNaN(k),valueProp:"y",unsortedIndex:d,name:a.label,point:a,fill:f,icon:x.calcIconForPoint(a,f,g),fieldInfo:a.fieldInfo||b[0].fieldInfo,seriesIndex:0,isOthersPoint:h,
tooltip:J.getTooltipInfo({yValue:F,pointLabel:a.label,seriesLabel:null,minInSeriesValue:t,maxInSeriesValue:u,sumInSeriesValue:r,absSumInSeriesValue:D,avgInSeriesValue:M,visualProperties:c,chartType:g,conditionalStyling:c.conditionalStyling,conditionalStats:m&&m.stats,fieldInfo:a.fieldInfo||b[0].fieldInfo,decimals:a.value&&a.value.decimals,hasNegativeValues:v,fill:f,chartContainer:e.chartContainer,viewModel:z,theme:e.theme,themeSettings:y,dataDrillingPanelInfo:e.dataDrillingPanelInfo,pointName:a.label,
seriesName:q.label,areaName:null,featureIndex:A,isComparisonPoint:!1,comparisonFeatureAttribute:null}),stroke:{width:0}})});B.push(C);return B}}});