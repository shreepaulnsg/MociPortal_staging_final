// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/ChartFilterUtil",["dojo/_base/lang","esri/dijit/geoenrichment/utils/ObjectUtil","./ChartTypes","./builder/utils/ChartDataUtil"],function(w,y,z,u){var x={collectStatsForVariables:function(e,g,n,m,k){var l=0,f={min:Infinity,max:-Infinity,decimals:0,dataArray:[]};g.forEach(function(b,c){b.points.forEach(function(a,h){a=u.getPointValue({point:a,viewModel:m,currentFeatureIndex:k,index:h,seriesIndex:c,chartType:e,visualProperties:n,numPoints:b.points.length});
f.min=Math.min(f.min,a);f.max=Math.max(f.max,a);f.decimals=Math.max(f.decimals,y.getPlaces(a));f.dataArray.push(a);l++})});return{filterRanges:[f],numVariablesTotal:l}},filterSeriesItems:function(e,g,n,m,k,l,f){return f?x._filterAreas(e,g,m,k):x._filterVariables(e,g,n,m,k,l)},_filterAreas:function(e,g,n,m){var k=0,l={};n.forEach(function(b){l[b.fieldName]=b});if(z.isLineLike(e))e=g.filter(function(b,c){return!b.points.some(function(a){var h=u.getPointValue({point:a,viewModel:m,currentFeatureIndex:c});
a=l[a.fieldInfo.name];return h<a.min||h>a.max})}),k=e.length,e.length||(e.__firstSeriesItem=g[0]);else{var f={};g.forEach(function(b){b.points.forEach(function(c,a){if(!f[a]){var h=u.getPointValue({point:c,viewModel:m,currentFeatureIndex:a});c=l[c.fieldInfo.name];if(h<c.min||h>c.max)f[a]=!0}})});e=g.map(function(b){b=w.mixin({},b);b.__firstPoint=b.points[0];b.points=b.points.filter(function(c,a){return!f[a]});k=b.points.length;return b})}return{seriesItems:e,numShownElements:k}},_filterVariables:function(e,
g,n,m,k,l){var f=0,b=m[0];var c=[];var a=1<g.length;g.forEach(function(d,r){var q=w.mixin({},d);q.points=[];d.points.forEach(function(p,t){p.originalIndex=t;t=u.getPointValue({point:p,viewModel:k,currentFeatureIndex:l,index:t,seriesIndex:r,chartType:e,visualProperties:n,numPoints:d.points.length});t<b.min||t>b.max?a&&(p=w.mixin({},p),p.hidden=!0,q.points.push(p)):q.points.push(p)});a?c.push(q):q.points.length&&c.push(q)});if(a){var h=0;c.forEach(function(d){h=Math.max(h,d.points.length)});for(var v=
0;v<h;v++)c.every(function(d){d=d.points[v];return!d||d.hidden})&&c.forEach(function(d){if(d=d.points[v])d._toRemove=!0});c=c.filter(function(d){d.points=d.points.filter(function(r){return!r._toRemove});return d.points.length})}c.forEach(function(d){d.points.forEach(function(r){r.hidden||f++})});return{seriesItems:c,numShownElements:f}},getFirstSeriesPoint:function(e){return e.__firstPoint},getFirstSeriesItem:function(e){return e.__firstSeriesItem}};return x});