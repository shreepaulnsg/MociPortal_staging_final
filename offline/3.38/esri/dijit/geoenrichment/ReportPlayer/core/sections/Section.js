// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/geoenrichment/ReportPlayer/core/templates/Section.html":'\x3cdiv class\x3d"esriGEReportPlayer_section"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"stackNode" class\x3d"section_stackNode esriGEAbsoluteStretched"\x3e\x3c/div\x3e\r\n\x3c/div\x3e'}});
define("esri/dijit/geoenrichment/ReportPlayer/core/sections/Section","require dojo/_base/declare dojo/_base/lang esri/dijit/geoenrichment/promise/all esri/dijit/geoenrichment/when dojo/dom-construct dojo/dom-class dojo/dom-style dijit/_WidgetBase dijit/_TemplatedMixin ./_SectionQueryElementsMixin esri/dijit/geoenrichment/ReportPlayer/config ../supportClasses/tableJson/TableJsonUtil ../supportClasses/ViewModes ../supportClasses/templateJsonUtils/fieldInfo/FieldInfoBuilder ./supportClasses/SectionLayoutManager esri/dijit/geoenrichment/utils/DomUtil esri/dijit/geoenrichment/utils/MouseUtil esri/dijit/geoenrichment/ReportPlayer/core/sections/SectionTypes dojo/text!../templates/Section.html dojo/i18n!esri/nls/jsapi".split(" "),function(w,
x,n,u,y,g,l,m,z,A,B,C,r,v,p,D,t,E,k,F,f){f=f.geoenrichment.dijit.ReportPlayer.Sections;return x([z,A,B],{templateString:F,nls:f,isSection:!0,json:null,viewModel:null,theme:null,currentFeatureIndex:null,currentFeatureAttributes:null,getPreviewValueFunction:null,elementUsageType:null,initialWidth:null,initialHeight:null,hasFixedLayout:!1,disableContentCrop:!1,parentWidget:null,parentElementInPageInfo:null,viewPortContainer:null,parentGridCell:null,infographicValueController:null,infographicBenchmarkController:null,
calculationStatesGroup:null,noContentOffset:!1,tableClass:null,tableParams:null,initialViewMode:null,initialSpecificViewMode:null,isDataDrillingView:!1,dynamicSettingsToolbarRoot:null,_stackElements:null,_layoutManager:null,_dynamicSettingsBuilder:null,_dynamicSettingsBuilderBeingLoadedFlag:!1,_backgroundColor:void 0,_cropContent:!1,_opacity:1,_topSpacer:null,_bottomSpacer:null,postCreate:function(){this.inherited(arguments);this._showError(!1);this._layoutManager=new D(this);this._stackElements=
[];this.infographicValueController&&this.infographicValueController.addSection(this);this.infographicBenchmarkController&&this.infographicBenchmarkController.setSection(this);(this.initialViewMode||this.initialSpecificViewMode)&&this._tryApplyNewViewMode(this.initialViewMode,this.initialSpecificViewMode);this.fromJson(this.json);this.json=null},_createStack:function(a){this._destroyStack();if(a){this._topSpacer=!this.viewModel.isGraphicStyle()&&g.create("div",{"class":"stackNodeSpacer"},this.stackNode);
var b=this;a.stack.forEach(function(c,d){switch(c.id){case "table":b._createGrid(c);break;case "img":b._createImage(c);break;case "map":b._createElementInTable(c,"map");break;case "hr":b._createHorizontalLine(c,d);break;case "pageBreak":b._createPageBreak(c)}});this._bottomSpacer=!this.viewModel.isGraphicStyle()&&g.create("div",{"class":"stackNodeSpacer"},this.stackNode);this._updateSpacersForHorizontalLines()}},_addEmptyLine:function(){this.hasFixedLayout&&g.create("div",{"class":"stackNodeEmptyLine"},
this.stackNode)},_createGrid:function(a,b,c,d){var e=this;a.style=a.style||{};a.attributes=a.attributes||{};a.columns=a.columns||[];a.rows=a.rows||[];var h=b&&(b.domNode||b);c=h?c||"after":void 0;h=h||this.stackNode;var G="function"===typeof this.tableClass?this.tableClass(a):this.tableClass;d=this.viewModel.layoutBuilder.createElement("grid",n.mixin({"class":G||"",viewModel:this.viewModel,theme:this.theme,columns:a.columns,rows:a.rows,parentWidget:this,viewPortContainer:this.viewPortContainer,fixedViewMode:a.attributes.viewMode,
currentFeatureIndex:this.currentFeatureIndex,currentFeatureAttributes:this.currentFeatureAttributes,getPreviewValueFunction:this.infographicValueController?function(q){q=q||{};q.sectionPreviewValueFunction=e.getPreviewValueFunction;return e.infographicValueController.getValueInfo(e,q)}:this.getPreviewValueFunction,infographicBenchmarkController:this.infographicBenchmarkController,presetFilter:a.presetFilter,presetSorting:a.presetSorting,__isImageTable:a.__isImageTable,__isMapTable:a.__isMapTable,
allowSorting:r.isMultiDataTable(a)},this._getGridCreateParams(a,d),this.tableParams),h);g.place(d.domNode,h,c);d.setMaxWidth(this.hasFixedLayout?this.getWidth():1E5);d.setSettings(n.mixin({style:{width:a.style.width,left:a.style.left,top:a.style.top,spaceAfter:a.style.spaceAfter,alternatingStyle:a.style.alternatingStyle,opacity:a.style.opacity,fixedCellsOpacity:a.style.fixedCellsOpacity},attributes:n.mixin({fixedColumns:a.attributes.fixedColumns,dynamicColumns:a.attributes.dynamicColumns,fixedRows:a.attributes.fixedRows,
dynamicRows:a.attributes.dynamicRows},this._getAdditionalTableAttributes(a)),scaleToFitWidth:a.scaleToFitWidth,scaleToFitHeight:a.scaleToFitHeight,noChartView:a.noChartView,viewMode:this._viewMode,specificViewMode:this._specificViewMode},this._getAdditionalTableSettings(a)));d.stackId="table";b?(c=this._stackElements.indexOf(b)+("after"===c?1:0),-1!==c&&this._stackElements.splice(c,0,b)):this._stackElements.push(d);a.isContextFloatingElement&&(l.add(d.domNode,"esriGENonInteractable"),d.__isContextFloatingElement=
!0);return d},_getGridCreateParams:function(a,b){return null},_getAdditionalTableAttributes:function(a){},_getAdditionalTableSettings:function(a){},_createImage:function(a){return this._createElementInTable(a,"image")},_createElementInTable:function(a,b,c){a.style=a.style||{};var d=function(){if("chart"===b)return{x:0,y:0,w:a.visualProperties.width,h:a.visualProperties.height};if("infographic"===b)return{x:0,y:0,w:a.style.width,h:a.style.height};a=n.mixin({},a);a.style=n.clone(a.style);var h=c&&c.defaultSize||
100;a.style.width=a.style.width||h;a.style.height=a.style.height||h;h={x:a.style.left||0,y:a.style.top||0,w:a.style.width,h:a.style.height};a.style.left=0;a.style.top=0;return h}();switch(b){case "image":var e=p.createFieldInfoFromImage(a);break;case "map":e=p.createFieldInfoFromMap(a);break;case "shape":e=p.createFieldInfoFromShape(a);break;case "chart":e=p.createFieldInfoFromChart(a);break;case "infographic":e=p.createFieldInfoFromInfographic(a)}d=r.createSingleCellTable({left:d.x,top:d.y,width:d.w,
height:d.h,fieldInfo:e,cellStyle:{horizontalAlign:this.viewModel.isGraphicStyle()?a.style.horizontalAlign||"center":"left",verticalAlign:this.viewModel.isGraphicStyle()?a.style.verticalAlign||"middle":"top",backgroundColor:"transparent"}});0===a.style.opacity&&(d.style.opacity=0);"image"===b?d.__isImageTable=!0:"map"===b&&(d.__isMapTable=!0);d=this._createElementInTable_createGrid(a,d);"image"===b?t.addClass(d.domNode,"isImageTable"):"map"===b&&t.addClass(d.domNode,"isMapTable");a.isContextFloatingElement&&
(l.add(d.domNode,"esriGENonInteractable"),d.__isContextFloatingElement=!0);return d},_createElementInTable_createGrid:function(a,b){return this._createGrid(b)},isImageTable:function(a){return a&&a.__isImageTable},isMapTable:function(a){return a&&a.__isMapTable},_createHorizontalLine:function(a,b){a.style=a.style||{};var c=g.create("div",{"class":"templateHorizontalLine"},this.stackNode);0===b?(l.add(c,"templateHorizontalLineTop"),this._stackElements.unshift(c),c._isTopLine=!0):(l.add(c,"templateHorizontalLineBottom"),
this._stackElements.push(c),c._isTopLine=!1);c.stackId="hr";a.style.backgroundColor&&(c.style.backgroundColor=a.style.backgroundColor);"number"===typeof a.style.height&&(c.style.height=Math.round(Math.max(1,a.style.height))+"px")},_updateSpacersForHorizontalLines:function(){if(!this.viewModel.isGraphicStyle()){var a=this._queryElementsById("hr");this._topSpacer.style.height="0px";this._bottomSpacer.style.height="0px";var b=this;a.forEach(function(c){(c._isTopLine?b._topSpacer:b._bottomSpacer).style.height=
m.get(c,"height")+"px"})}},_createPageBreak:function(a){a=g.create("div",{"class":"esriGEReportPlayer_pageBreak"},this.stackNode);a.stackId="pageBreak";g.create("div",{"class":"pageBreakLine dijitInline"},a);g.create("div",{"class":"pageBreakLabel dijitInline",innerHTML:f.pageBreak},a);g.create("div",{"class":"pageBreakLine dijitInline"},a);this._stackElements.push(a)},_destroyStack:function(){for(;this._stackElements.length;)this._removeElement(this._stackElements[0]);this.stackNode&&(this.stackNode.innerHTML=
"");this._addEmptyLine()},removeElement:function(a){a&&this._removeElement(a)},_removeElement:function(a){if(a){a.destroy?a.destroy():g.destroy(a);var b=this._stackElements.indexOf(a);-1!==b&&this._stackElements.splice(b,1);"hr"===a.stackId&&this._updateSpacersForHorizontalLines()}},getWidth:function(){return this._layoutManager.getWidth()},setWidth:function(a,b){this._layoutManager.setWidth(a,b)},getHeight:function(a){return this._layoutManager.getHeight(a)},getResizedHeight:function(){return this._layoutManager.getResizedHeight()},
setHeight:function(a,b){this._layoutManager.setHeight(a,b)},getPreferredHeight:function(){return this._layoutManager.getPreferredHeight()},collapseContent:function(){var a=this.getInfographicWithTable();a&&a.infographic.collapseContent()},calculateFloatingContentBox:function(){return this._layoutManager.getFloatingContentBox()},scaleFloatingContentProportionally:function(a){this._layoutManager.scaleFloatingContentProportionally(a)},fitContentNicely:function(a,b){this._layoutManager.fitContentNicely(a,
b)},setChartCalculationState:function(a){this.onCalculationStateChanged(a)},onCalculationStateChanged:function(a){},getStyle:function(){return{backgroundColor:this._backgroundColor,cropContent:this._cropContent,opacity:this._opacity}},setStyle:function(a){a=n.mixin(this.getStyle(),a);this._backgroundColor=a.backgroundColor;this._cropContent=a.cropContent;this.domNode.style.backgroundColor=this._backgroundColor||"";this.domNode.style.overflow=this._cropContent&&!this.disableContentCrop?"hidden":"";
"number"===typeof a.opacity&&(this._opacity=Math.max(0,Math.min(1,a.opacity)),this.domNode.style.opacity=1===this._opacity?"":this._opacity,l[0===this._opacity?"add":"remove"](this.domNode,"esriGENonInteractable"))},getSettings:function(){var a=this._queryElementsById("hr"),b=a[0]&&a[0]._isTopLine?a[0]:null;a=a.filter(function(d){return!d._isTopLine})[0];var c={type:this._sectionType,hasTopLine:!!b,hasBottomLine:!!a};b&&(c.topLineHeight=m.get(b,"height"),c.topLineColor=m.get(b,"backgroundColor"));
a&&(c.bottomLineHeight=m.get(a,"height"),c.bottomLineColor=m.get(a,"backgroundColor"));return c},setSettings:function(a){var b=this;this._queryElementsById("hr").map(function(c){b._removeElement(c)});a.hasTopLine&&this._createHorizontalLine({style:{height:a.topLineHeight,backgroundColor:a.topLineColor}},0);a.hasBottomLine&&this._createHorizontalLine({style:{height:a.bottomLineHeight,backgroundColor:a.bottomLineColor}})},_notifyContentChanged:function(){this._layoutManager.updateHeightAfterContentChange()},
_viewMode:null,_specificViewMode:null,_viewModeKey:null,getViewMode:function(){return this._viewMode},setViewMode:function(a,b){this._tryApplyNewViewMode(a,b)&&this._stackElements.forEach(function(c){this._syncElementViewMode(c)},this)},_tryApplyNewViewMode:function(a,b){a=a||this._viewMode;b=b||this._specificViewMode;var c=a+(b?JSON.stringify(b):"");if(this._viewModeKey===c)return!1;this._viewModeKey=c;this._viewMode=a;this._specificViewMode=b;l[this._viewMode===v.EDIT?"add":"remove"](this.domNode,
"esriGEReportPlayer_sectionEditMode");l[this._viewMode===v.EDIT?"remove":"add"](this.domNode,"esriGEReportPlayer_sectionPreviewMode");return!0},_syncElementViewMode:function(a){a.setViewMode&&a.setViewMode(this._viewMode,this._specificViewMode)},notifyShown:function(){var a=this;this._stackElements.forEach(function(b){b.notifyShown&&b.notifyShown()});this._panelScale&&this.notifyPanelScaleChanged(this._panelScale);this.viewModel.dynamicReportInfo&&!C.isPlayerOnServer&&(this._dynamicSettingsBuilder?
this._dynamicSettingsBuilder.notifyShown():this._dynamicSettingsBuilderBeingLoadedFlag||(this._dynamicSettingsBuilderBeingLoadedFlag=!0,w(["./dynamicSettings/SectionDynamicSettingsBuilder"],function(b){a._dynamicSettingsBuilder=new b(a,{onButtonsCreated:function(){a.onDynamicSettingsButtonsCreated()}});a.own(a._dynamicSettingsBuilder);a._panelScale&&a._dynamicSettingsBuilder.setPanelScale(a._panelScale);a._dynamicSettingsBuilderBeingLoadedFlag=!1})))},_panelScale:null,getPanelScale:function(){return this._panelScale||
1},notifyPanelScaleChanged:function(a){this._panelScale=a;this._dynamicSettingsBuilder&&this._dynamicSettingsBuilder.setPanelScale(a);var b=this.getMapImages()[0];b&&b.notifyPanelScaleChanged&&b.notifyPanelScaleChanged(a);(b=this.getInfographic())&&b.notifyPanelScaleChanged&&b.notifyPanelScaleChanged(a)},_sectionType:null,getSectionType:function(){return this._sectionType},isEmpty:function(){return!1},isDataSection:function(){var a=this.getSectionType();return!this.hasPageBreak()&&this.hasNonEmptyTables()&&
(a===k.DETAILS||a===k.DETAILS_HEADER||a===k.GROUP)},isSingleElementSection:function(){return 1===this._stackElements.length},isMultiDataSection:function(){return this.isSingleElementSection()&&this.getTrueTables()[0]&&this.getTrueTables()[0].isMultiDataTable()},isPageHeader:function(){return this.getSectionType()===k.PAGE_HEADER},isPageFooter:function(){return this.getSectionType()===k.PAGE_FOOTER},getSectionName:function(){if(this.hasPageBreak())return"";switch(this._sectionType){case k.PAGE_HEADER:return f.pageHeader;
case k.DETAILS_HEADER:return this.hasLocatorHeaderTables()?f.locatorHeaderTable:f.detailsHeader;case k.DETAILS:return this.hasLocatorTables()?f.locatorTable:this.hasSummarizeTables()?f.summarizeTable:f.details;case k.GROUP:return this.hasLocatorFooterTables()?f.locatorFooterTable:f.group;case k.REPORT_FOOTER:return f.reportFooter;case k.PAGE_FOOTER:return f.pageFooter}return""},getRenderPromise:function(){return u(this.getTables().map(function(a){return a.getRenderPromise()}))},getVisualState:function(){return{type:"section",
currentFeatureIndex:this.currentFeatureIndex,stackElements:this._getVisualStateElements().map(function(a){return a.getVisualState&&a.getVisualState()})}},setVisualState:function(a){var b=this;if(a){if("number"===typeof a.currentFeatureIndex&&a.currentFeatureIndex!==(this.currentFeatureIndex||0)){var c=this.toJson();c.currentFeatureIndex=a.currentFeatureIndex;this.fromJson(c)}return y(this.getRenderPromise(),function(){if(a.stackElements){var d=[];b._getVisualStateElements().forEach(function(e,h){e.setVisualState&&
d.push(e.setVisualState(a.stackElements[h]))});return u(d).then(function(){b._dynamicSettingsBuilder&&b._dynamicSettingsBuilder.setVisualState(a)})}})}},_getVisualStateElements:function(){return this._stackElements.filter(function(a){return!a.__isContextFloatingElement})},refresh:function(){this.updateContentFromJson(this.toJson());return this.getRenderPromise()},updateContentFromJson:function(a){this.fromJson(a);this._notifyContentChanged()},fromJson:function(a){var b=this.initialWidth||a.style&&
a.style.width,c=this.initialHeight||a.style&&a.style.height;b&&this.setWidth(b);c&&this.setHeight(c);this.initialHeight=this.initialWidth=null;this._showError(!1);this._sectionType=a.type;"number"===typeof a.currentFeatureIndex&&(this.currentFeatureIndex=a.currentFeatureIndex,this.viewModel.dynamicReportInfo&&(this.currentFeatureIndex=Math.min(this.viewModel.dynamicReportInfo.analysisAreas.length-1,this.currentFeatureIndex)));this.setStyle(a.style);this._createStack(a)},toJson:function(a){var b=this,
c={type:this._sectionType,style:this.getStyle(),stack:[]};"number"===typeof this.currentFeatureIndex&&(c.currentFeatureIndex=this.currentFeatureIndex);a&&a.saveSize&&(c.style.width=this.getWidth(),c.style.height=this.getHeight());this._stackElements.forEach(function(d){switch(d.stackId){case "table":var e=b._tableToJson(d);break;case "hr":e={id:"hr",style:{height:m.get(d,"height"),backgroundColor:m.get(d,"backgroundColor")}};break;case "pageBreak":e={id:"pageBreak"}}e&&c.stack.push(e)});return c},
_tableToJson:function(a){if(this.isImageTable(a)||this.isMapTable(a)){a=a.toJson();var b=r.getTableJsonFirstFieldInfo(a);if(b=b.imageJson||b.mapJson)b.style.left=a.style.left,b.style.top=a.style.top,"number"===typeof a.style.opacity&&("number"!==typeof b.style.opacity&&(b.style.opacity=1),b.style.opacity*=a.style.opacity),a=b}else a=a.toJson();return a},isMouseOver:function(a,b){return E.isMouseOver(this.domNode,{event:a})||(!b||!b.noDynamic)&&this._dynamicSettingsBuilder&&this._dynamicSettingsBuilder.isMouseOver(a)||
this._checkTableCellsMouseOver(a)},_checkTableCellsMouseOver:function(a){return this.getTables().some(function(b){return b.getCells().some(function(c){return c.content&&c.content.isMouseOver&&c.content.isMouseOver(a)})})},_showError:function(a){this.errorDiv&&g.destroy(this.errorDiv);this.errorDiv=null;t[a?"hide":"show"](this.stackNode);a&&(this.errorDiv=g.create("div",{"class":"esriGEAbsoluteStretched section_errorDiv",innerHTML:f.mapLoadError},this.domNode))},onDynamicSettingsButtonsCreated:function(){},
destroy:function(){this._destroyStack();this.inherited(arguments)}})});