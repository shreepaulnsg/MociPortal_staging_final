// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/geoenrichment/ReportPlayer/core/templates/sectionDynamicSettings/RefineFilters.html":'\x3cdiv class\x3d"esriGEReportPlayer_sectionDynamicRefineFilters"\x3e\r\n    \x3cdiv class\x3d"esriGERow20" data-dojo-attach-point\x3d"refineResultsTitleBlock"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"refineResultsTitle" class\x3d"dijitInline"\x3e\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"titleInfoIcon" class\x3d"dijitInline esriGESpaceBeforeBig esriGEInfoIcon"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"esriGESpaceBeforeBig"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"textFilterBlock" class\x3d"sectionDynamicRefineFilters_row"\x3e\r\n            \x3cdiv class\x3d"esriGERowHigh"\x3e${nls.byKeywords}\x3c/div\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"textFilterDiv" class\x3d"esriGERowHigh"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"filtersBlock"\x3e\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"methodBlock"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriGERowHigh" data-dojo-attach-point\x3d"customBlock"\x3e\x3c/div\x3e\r\n        \x3cdiv class\x3d"esriGERowHigh"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"resetButton" class\x3d"dijitInline esriGELink"\x3e${nls.resetFilters}\x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("esri/dijit/geoenrichment/ReportPlayer/core/sections/dynamicSettings/RefineFilters","dojo/_base/declare dojo/on dojo/string dojo/dom-construct dijit/_WidgetBase dijit/_TemplatedMixin dijit/form/TextBox esri/dijit/geoenrichment/NumericalSlider ./MethodFilter esri/dijit/geoenrichment/utils/DomUtil esri/dijit/geoenrichment/utils/InvokeUtil esri/dijit/geoenrichment/utils/MouseUtil esri/dijit/geoenrichment/utils/TooltipUtil ./supportClasses/FilterUtil dojo/text!../../templates/sectionDynamicSettings/RefineFilters.html dojo/i18n!esri/nls/jsapi".split(" "),
function(f,h,n,k,p,q,r,t,u,e,v,w,x,l,y,g){g=g.geoenrichment.dijit.ReportPlayer.SectionDynamicSettingsBuilder;f=f([p,q],{templateString:y,nls:g,hasTitle:!1,hasTextFilter:!1,hasRangeFilters:!1,hasMethodFilter:!1,textFilterPlaceHolder:null,selectRangePlaceholder:null,_originalFilterRanges:null,_filters:null,textFilter:null,methodFilter:null,_filterWidgets:null,postCreate:function(){var a=this;this.inherited(arguments);this._buildKeywordFilter();this._buildMethodFilter();h(this.resetButton,"click",function(){a._resetFilters()});
e[this.hasTitle?"show":"hide"](this.refineResultsTitleBlock);e[this.hasTextFilter?"show":"hide"](this.textFilterBlock);e[this.hasRangeFilters?"show":"hide"](this.filtersBlock);e[this.hasMethodFilter?"show":"hide"](this.methodBlock);e.hide(this.customBlock);this.setTitleInfo(null)},_buildKeywordFilter:function(){this.textFilter=(new r({"class":"sectionDynamicRefineFilters_textFilter",trim:!0,placeHolder:this.textFilterPlaceHolder||g.keywordsPlaceholder})).placeAt(this.textFilterDiv);h(this.textFilter.textbox,
"keyup",this._emitEvent.bind(this));this.own(this.textFilter)},_buildMethodFilter:function(){var a=this;this.methodFilter=(new u({selectRangePlaceholder:this.selectRangePlaceholder,onFilterChanged:function(b){a._applyFilterToRanges(b);a.onFilterChanged(a.getVisualState())}})).placeAt(this.methodBlock);this.own(this.methodFilter)},_buildFiltersFromOriginals:function(){this._filters=this._originalFilterRanges?this._originalFilterRanges.map(function(a){return{label:a.alias,fieldName:a.fieldName,minValue:a.min,
maxValue:a.max,lowerValue:a.min,upperValue:a.max,decimals:a.decimals,dataArray:a.dataArray}}):[]},_buildRangeFilters:function(){var a=this;this._destroyFilterWidgets();this._filterWidgets=[];this._filters.forEach(function(b){var d=k.create("div",{"class":"esriGERowHigh sectionDynamicRefineFilters_row "+(b.label?"":"noLabel")},a.filtersBlock),c=(new t({label:b.label,minValue:b.minValue,maxValue:b.maxValue,lowerValue:b.lowerValue,upperValue:b.upperValue,decimals:b.decimals,timeIntervalLength:250,onChange:function(m){b.lowerValue=
c.round(m.lowerValue);b.upperValue=c.round(m.upperValue);a._emitEvent()}})).placeAt(d);c.startup();setTimeout(function(){b.dataArray&&c.domNode&&c.setStatistics(b.dataArray)},100);a._filterWidgets.push(c)})},addToCustomBlock:function(a){e.show(this.customBlock);a.forEach(function(b){k.place(b,this.customBlock)},this)},setTitle:function(a,b,d){this.refineResultsTitle.innerHTML=n.substitute(a,{numTotal:b||0,numShown:d||0})},setTitleInfo:function(a){x.setTooltipToNode(this.titleInfoIcon,a);e[a?"show":
"hide"](this.titleInfoIcon)},setFilterRanges:function(a){this._originalFilterRanges=a||[];this._buildFiltersFromOriginals();this._buildRangeFilters()},setFilter:function(a){this.methodFilter.setRanges(this._filters);this.methodFilter.setFilter(a);a&&this._applyFilterToRanges(a)},_applyFilterToRanges:function(a){var b=this._filters.map(function(d){var c=l.filterData(d.dataArray,1===this._filters.length||a.fieldName===d.fieldName?a:{method:l.NONE});return{fieldName:d.fieldName,min:c[0],max:c[c.length-
1]}},this);this.setVisualState({filterRanges:b,hasPresetFilter:!!a})},_resetFilters:function(a){this.domNode&&(this.textFilter.set("value",""),this._buildFiltersFromOriginals(),this._buildRangeFilters(),!a&&this._doEmitEvent())},_emitEvent:function(){v.invoke(this,"_doEmitEvent",100)},_doEmitEvent:function(){this.methodFilter&&this.methodFilter.setFilter(null);this.onFilterChanged(this.getVisualState())},onFilterChanged:function(a){},hasFiltersOn:function(){return this.domNode?!!(this.textFilter.get("value")||
this._filters&&this._filters.some(function(a){return a.lowerValue>a.minValue||a.upperValue<a.maxValue})):!1},getVisualState:function(){return{type:"refineFilters",searchText:this.textFilter.get("value"),filterRanges:this._filters&&this._filters.map(function(a){return{fieldName:a.fieldName,min:a.lowerValue,max:a.upperValue}}),hasFiltersOn:this.hasFiltersOn()}},setVisualState:function(a){a?(a.filterRanges&&(a.filterRanges.forEach(function(b){var d=this._filters.filter(function(c){return c.fieldName===
b.fieldName})[0];d.lowerValue=b.min;d.upperValue=b.max},this),this._buildRangeFilters(),a.hasPresetFilter||this.methodFilter.setFilter(null)),this.textFilter.set("value",a.searchText||"")):this._resetFilters(!0)},isMouseOver:function(a){return w.isMouseOver(this.domNode)||this.methodFilter&&this.methodFilter.isMouseOver()},_destroyFilterWidgets:function(){this._filterWidgets&&(this._filterWidgets.forEach(function(a){a.destroy()}),this._filterWidgets.length=0);this.filtersBlock.innerHTML=""},destroy:function(){this._destroyFilterWidgets();
this.inherited(arguments)}});f.hasFiltersOn=function(a){return!1};return f});