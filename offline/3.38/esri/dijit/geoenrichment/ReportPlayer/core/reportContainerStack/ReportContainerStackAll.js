// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/geoenrichment/ReportPlayer/core/templates/ReportContainerStackAll.html":'\x3cdiv class\x3d"esriGEReportPlayer_reportContainerStackAll"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"waitingNode"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"emptyPlaceholder" class\x3d"reportContainerStackAll_emptyPlaceholder"\x3e${nls.infographicEmpty}\x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"fillerContainer" class\x3d"reportContainerStackAll_zoomFillerContainer"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"scalableContainer" class\x3d"reportContainerStackAll_zoomScalableContainer"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"groupLabelsContainerFiller" class\x3d"reportContainerStackAll_groupLabelsContainerFiller"\x3e\x3c/div\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"innerContainersDiv" class\x3d"reportContainerStackAll_innerContainersDiv"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"groupLabelsContainer" class\x3d"reportContainerStackAll_groupLabelsContainer"\x3e\x3c/div\x3e\r\n\x3c/div\x3e'}});
define("esri/dijit/geoenrichment/ReportPlayer/core/reportContainerStack/ReportContainerStackAll","dojo/_base/declare dojo/_base/lang esri/dijit/geoenrichment/promise/all esri/dijit/geoenrichment/when dojo/on dojo/query dojo/dom-class dojo/dom-construct dijit/_WidgetBase dijit/_TemplatedMixin ./_ScrollSupport ./_ZoomSupport ./_HiddenContentSupport ./utils/MobileGesturesUtil ./utils/ComparisonSectionProcessor ../supportClasses/DocumentOptions ./supportClasses/BenchmarkController ./supportClasses/AreaToolbarBuilder ../../dataProvider/supportClasses/areas/AnalysisAreaUtil esri/dijit/geoenrichment/utils/DeviceUtil esri/dijit/geoenrichment/utils/DomUtil esri/dijit/geoenrichment/utils/InvokeUtil esri/dijit/geoenrichment/utils/WaitingUtil esri/dijit/geoenrichment/utils/async/AsyncQueue dojo/text!../templates/ReportContainerStackAll.html dojo/i18n!esri/nls/jsapi".split(" "),
function(t,g,u,v,w,l,x,y,z,A,B,C,D,E,F,G,H,m,I,J,e,K,L,M,N,n){n=n.geoenrichment.dijit.ReportPlayer.ReportContainerStackAll;var h={_reportID:null,_settings:null,_globalSettings:{},getSettings:function(a){var b=a.dynamicReportInfo.reportObject;a=a.dynamicReportInfo.templateJson.documentOptions;this._reportID===b.reportID&&this._settings||(this._settings=g.mixin({},this._globalSettings),this._settings.scale=a.defaultComparisonZoom||void 0);this._reportID=b.reportID;return g.clone(this._settings)},saveSettings:function(a,
b){this._reportID=a.dynamicReportInfo.reportObject.reportID;this._settings=b;this._globalSettings.splitPanels=!!b.splitPanels;this._globalSettings.hideBackgroundImage=!!b.hideBackgroundImage},_benchmarkIndex:0,getBenchmarkIndex:function(){return this._benchmarkIndex},saveBenchmarkIndex:function(a){this._benchmarkIndex=a}};return t([z,A,B,C,D],{templateString:N,nls:n,isReportContainerStackAll:!0,viewModel:null,theme:null,parentWidget:null,renderOptions:null,documentOptions:null,comparisonSettings:null,
_reportContainers:null,_pendingJsons:null,_benchmarkController:null,_hiddenAreas:null,postCreate:function(){var a=this;this.inherited(arguments);this.renderOptions=g.mixin({center:!1,minTop:0,minRight:0,minBottom:0,minLeft:0},this.renderOptions);this.documentOptions={};this._reportContainers={};this._pendingJsons=[];this._hiddenAreas={};this.comparisonSettings&&h.saveSettings(this.viewModel,this.comparisonSettings);this._benchmarkController=new H({areaIndex:h.getBenchmarkIndex(),onChanged:function(){h.saveBenchmarkIndex(a._benchmarkController.getAreaIndex());
a._updateInnerContainers({keepZoom:!0})}});this.own(this._benchmarkController);this.viewModel.registerBenchmarkController(this._benchmarkController);e.hide(this.waitingNode);this._updateEmptyState();J.isMobileDevice()&&E.enableMobileGestures(this);w(this.domNode,"scroll",function(){a._updateLabelsPosition()})},resize:function(a,b){this.domNode.style.width=a?a+"px":"auto";this.domNode.style.height=b?b+"px":"auto"},setMaxWidth:function(a){this.domNode.style.maxWidth=a+"px"},setMaxHeight:function(a){this.domNode.style.maxHeight=
a+"px"},_maxPanelWidth:null,getCurrentPageDim:function(){return{w:this._maxPanelWidth,h:1E6}},_calcMaxPanelSize:function(){this._maxPanelWidth=0;var a=this.getInnerContainers({noHidden:!0});a.length&&(a.forEach(function(b){this._maxPanelWidth+=b.getCurrentPageDim().w},this),this._maxPanelWidth+=30*(a.length-1))},notifyShown:function(){this._isFromJSONBeingCollectedFlag||this._isFromJSONBeingAppliedFlag||(this._pendingJsons.length?this._canApplyJson()&&(this._fromJSONFinal(),this.onPendingDataApplied()):
this.getInnerContainers().forEach(function(a){a.notifyShown()}))},_isFromJSONBeingCollectedFlag:!1,_isFromJSONBeingAppliedFlag:!1,fromJson:function(a,b){this._isFromJSONBeingCollectedFlag=!b.isFinalArea;a._index=b.analysisAreaIndex;this._pendingJsons.push(a);return b.isFinalArea&&this._canApplyJson()&&this._fromJSONFinal()},_canApplyJson:function(){return e.isNodeInLayout(this.domNode)},_fromJSONFinal:function(){var a=this;this._isFromJSONBeingAppliedFlag=!0;this._pendingJsons.sort(function(b,c){return b._index-
c._index});return M.executeFunctions(this._pendingJsons.map(function(b){return function(){a._createInnerContainer(b,b._index)}}),100).then(function(){a._pendingJsons.length=0;return a._refresh().then(function(){a._isFromJSONBeingAppliedFlag=!1})})},_createInnerContainer:function(a,b){var c=y.create("div",{"class":"innerContainerRoot"},this.innerContainersDiv),d=this.viewModel.layoutBuilder.createElement("reportContainerStack",{viewModel:this.viewModel,theme:this.theme,parentWidget:this,currentFeatureIndex:b,
isVertical:!0,isScalable:!1,canShowEmptyState:!1,sectionJsonsProcessor:F.getProcessor(this),hideBackgroundImage:this.getComparisonSettings().hideBackgroundImage},c);d.__root=c;this._reportContainers[b]=d;a=d.fromJson(a);this._refresh();return a},_isBeingUpdatedPromise:!1,_pendingUpdateParams:null,_updateInnerContainers:function(a){a=a||{};var b=this;if(this._isBeingUpdatedPromise)return this._pendingUpdateParams=a,this._isBeingUpdatedPromise;this._pendingUpdateParams=null;return this._isBeingUpdatedPromise=
this._showWaiting(u(this.getInnerContainers().map(function(c){return c.refresh(a)})).then(function(){b._doRefresh({keepZoom:a.keepZoom})}).then(function(){a.rebuildStack&&e.isNodeInLayout(b.domNode)&&b.notifyShown();b._isBeingUpdatedPromise=null;if(b._pendingUpdateParams)return b._updateInnerContainers(b._pendingUpdateParams);b.emitZoomChangedEvent()}))},_refresh:function(){this.domNode.style.opacity="0.001";return K.invoke(this,"_doRefresh").then(function(){this.domNode.style.opacity=""}.bind(this))},
_doRefresh:function(a){a=a||{};this.getInnerContainers().forEach(function(b){b.__root.parentNode===this.innerContainersDiv&&this.innerContainersDiv.removeChild(b.__root)},this);this.getInnerContainers({noHidden:!0}).forEach(function(b,c){this.innerContainersDiv.appendChild(b.__root)},this);this._calcMaxPanelSize();this._updateEmptyState();this._updateGroupLabels();!a.keepZoom&&this.setBestZoom();this._syncFillerContainer();this._syncBenchmarkForVisibleAreas()},_updateGroupLabels:function(){var a=
this;this.groupLabelsContainer.innerHTML="";var b=I.groupAreas({analysisAreas:this.viewModel.dynamicReportInfo.analysisAreas,combinedAreasInfo:this.viewModel.dynamicReportInfo.combinedAreasInfo,filter:function(c){return!a._hiddenAreas[c.index]}});m.sanitize(a);b.groupInfos.forEach(function(c){m.buildGroupToolbar(c,{reportContainer:a,elementSize:a.getInnerContainers()[0].getCurrentPageDim().w,groupLabelsContainer:a.groupLabelsContainer,gap:30,showGroupLabels:!b.isOnlyAreasInOnlyGroup,numVisibleAreas:a.getVisibleAreas().length,
benchmarkController:a._benchmarkController,onRemoveArea:function(d){a._benchmarkController.getAreaIndex()===d.index&&a._benchmarkController.setAreaIndex(-1);var f={};f[d.index]=!1;a.setAreasVisibilityState(f,{append:!0,canSwitchToSingleView:!0})}})});this._updateLabelsPosition()},_updateEmptyState:function(){var a=this.getInnerContainers({noHidden:!0});a=!a.length||a.some(function(b){return b.isEmpty()});e[a?"show":"hide"](this.emptyPlaceholder);e[a?"hide":"show"](this.groupLabelsContainer);this.fillerContainer.style.opacity=
a?"0.001":""},_syncFillerContainer:function(){this.inherited(arguments);this._updateLabelsPosition();this.documentOptions={pagesize:G.combineCustomSizeString(this.scalableContainer.clientWidth,this.scalableContainer.clientHeight,"px"),orientation:"landscape",left:10,right:10,top:0,bottom:0}},_updateLabelsPosition:function(){this.groupLabelsContainer.style.top=this.domNode.scrollTop+"px";this.groupLabelsContainer.style.display="none";this.groupLabelsContainer.style.width=this.domNode.scrollWidth-26+
"px";this.groupLabelsContainer.style.display="";l(".innerContainerRoot_groupLabelContainer",this.groupLabelsContainer).forEach(function(a){a._unscaledWidth=a._unscaledWidth||a.clientWidth;a.style.width=a._unscaledWidth*this.getZoomInfo().scale+"px"},this);l(".innerContainerRoot_areaLabelContainer",this.groupLabelsContainer).forEach(function(a){a._unscaledWidth=a._unscaledWidth||a.clientWidth;a.style.width=a._unscaledWidth*this.getZoomInfo().scale+"px";x[a.clientWidth<a.children[0].children[0].clientWidth+
150?"add":"remove"](a,"isCompactView")},this);this.groupLabelsContainerFiller.style.height=this.groupLabelsContainer.clientHeight/this.getZoomInfo().scale+"px"},getAreasVisibilityState:function(){var a={};this.viewModel.dynamicReportInfo.analysisAreas.forEach(function(b){a[b.index]=!b.hidden&&!this._hiddenAreas[b.index]},this);return a},setAreasVisibilityState:function(a,b){function c(){return d.viewModel.dynamicReportInfo.analysisAreas.map(function(k){return!k.hidden&&!d._hiddenAreas[k.index]})}
b=b||{};var d=this,f=c();a=a||{};var p={},q;for(q in a)p[q]=!a[q];b.append?g.mixin(this._hiddenAreas,p):this._hiddenAreas=p;this._doRefresh();c().forEach(function(k,r){k&&k!==f[r]&&d._reportContainers[r].refresh()});if(b.canSwitchToSingleView&&1>=this.getInnerContainers({noHidden:!0}).length)this.onSwitchToSingleAreaView();else this._syncBenchmarkForVisibleAreas()},_syncBenchmarkForVisibleAreas:function(){var a=1<this.getVisibleAreas().length;!(0<=this._benchmarkController.getAreaIndex())||this.getAreasVisibilityState()[this._benchmarkController.getAreaIndex()]&&
a||this._benchmarkController.setAreaIndex(-1)},getComparisonSettings:function(){return h.getSettings(this.viewModel)},setComparisonSettings:function(a){var b=g.mixin({splitPanels:!1},this.getComparisonSettings());h.saveSettings(this.viewModel,a);this._benchmarkController.setNoTextLimit(a.splitPanels);return this._updateInnerContainers({rebuildStack:!0,hideBackgroundImage:this.getComparisonSettings().hideBackgroundImage,keepZoom:b.splitPanels===a.splitPanels})},getInnerContainers:function(a){var b=
a&&a.noHidden;a=Object.keys(this._reportContainers);a.sort();var c=[];a.forEach(function(d){b&&this._hiddenAreas[d]||c.push(this._reportContainers[d])},this);return c},getSections:function(){var a=[];this.getInnerContainers().forEach(function(b){a=a.concat(b.infographicPage.getSections())});return a},_sectionToInfographicPage:function(a){var b;this.getInnerContainers().some(function(c){if(-1!==c.infographicPage.getSections().indexOf(a))return b=c.infographicPage,!0});return b},getNumberOfPages:function(){return 1},
getVisibleAreas:function(){return this.viewModel.dynamicReportInfo.analysisAreas.filter(function(a){return!a.hidden&&!this._hiddenAreas[a.index]},this)},getVisualState:function(){return{type:"reportContainerStackAll",comparisonSettings:this.getComparisonSettings(),hiddenAreas:g.clone(this._hiddenAreas),innerContainers:this.getInnerContainers().map(function(a){return a.getVisualState()}),benchmarkAreaIndex:this._benchmarkController.getAreaIndex()}},setVisualState:function(a){var b=this;if(a&&a.innerContainers)return this._hiddenAreas=
a.hiddenAreas||{},this._benchmarkController.setAreaIndex(a.benchmarkAreaIndex),v(this.setComparisonSettings(a.comparisonSettings),function(){var c=b.getInnerContainers();a.innerContainers.forEach(function(d,f){c[f]&&c[f].setVisualState(d)})})},_isPrinted:!1,setPrinted:function(a){a=(this._isPrinted=a)?this.viewModel.getDocumentDefaultStyles().color:"";this.groupLabelsContainer.style.color=a;for(var b=l(".innerContainerRoot_groupLabelUnderline",this.domNode),c=0;c<b.length;c++)b[c].style.borderLeftColor=
a,b[c].style.borderTopColor=a,b[c].style.borderRightColor=a},_showWaiting:function(a){var b=this;this.fillerContainer.style.opacity="0.001";this.groupLabelsContainer.style.opacity="0.001";this.waitingNode.style.position="absolute";this.waitingNode.style.height=this.domNode.clientHeight+"px";this.waitingNode.style.width=this.domNode.clientWidth+"px";this.waitingNode.style.left=this.domNode.scrollLeft+"px";this.waitingNode.style.top=this.domNode.scrollTop+"px";e.show(this.waitingNode);return L.showProgressPromise(this.waitingNode,
a,{progressClass:"esriGEReportPlayerProgress"}).then(function(){e.hide(b.waitingNode);b.fillerContainer.style.opacity="";b.groupLabelsContainer.style.opacity=""})},onPendingDataApplied:function(){},onSwitchToSingleAreaView:function(){},destroy:function(){m.sanitize(this);this.getInnerContainers().forEach(function(a){a.destroy()});this._reportContainers=null;this.inherited(arguments)}})});