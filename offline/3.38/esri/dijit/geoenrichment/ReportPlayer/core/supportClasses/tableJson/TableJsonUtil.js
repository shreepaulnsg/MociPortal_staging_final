// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/tableJson/TableJsonUtil",["dojo/_base/lang","../templateJsonUtils/fieldInfo/FieldInfoBuilder","../templateJsonUtils/fieldInfo/FieldLibrary","../../grid/coreUtils/GridDataUtil","esri/dijit/geoenrichment/ReportPlayer/core/sections/SectionTypes"],function(l,v,w,x,q){var g={createTable:function(a){var b=a.numColumns,e=a.numRows,c=a.width,d=a.widths,n=a.style,h=a.attributes&&a.attributes.fixedColumns,y=a.attributes&&a.attributes.dynamicColumns;
if(c)if(d)d=d.map(function(r){return c*Number(r.replace("%",""))/100});else{var k=c/b;d=[];for(var f=0;f<b;f++)d.push(k)}if(d)c||isNaN(Number(d[0]))||(c=0,d.forEach(function(r){c+=r}));else for(k=Number(100/b).toFixed(3)+"%",d=[],f=0;f<b;f++)d.push(k);k=[];for(f=0;f<b;f++)k.push({field:"field"+f,style:{width:d[f]}});d=[];for(var t=!0,z=a.height?a.height/e:a.rowHeight||15.07,m=0;m<e;m++){var p={style:{height:z,fields:{}},fieldInfos:{}};for(f=0;f<b;f++){var u="field"+f;!1!==a.useDefaultTheme&&(p.style.fields[u]=
l.mixin({horizontalAlign:0===f?"left":"right",overrideStyle:0===m?1<e?!1!==a.useDefaultHeaderTheme?"TableHeader":"Default":void 0:t?"AlternatingRow":"Default"},a.cellParams));y&&f>=h&&0===m&&(p.fieldInfos[u]=v.createFieldInfoFromSpecialFieldName("AREA_DESC"));a.processTableCell&&a.processTableCell(p,u,m,f,a)}d.push(p);t=!t}return{id:"table",attributes:l.mixin({},a.attributes),style:l.mixin({width:c||772.33},n),columns:k,rows:d}},createSingleCellTable:function(a){a=a||{};var b=g.createTable({numColumns:1,
numRows:1,attributes:a.attributes,useDefaultTheme:!1});g.modifyTableJson(b,0,0,a);return b},modifyTableJson:function(a,b,e,c){b=a.rows[b];e=a.columns[e];var d=e.field;c.text&&(b[d]=c.text);c.fieldInfo&&(b.fieldInfos[d]=c.fieldInfo);c.cellStyle&&(b.style.fields[d]=c.cellStyle);c.columnSpan&&(b.columnSpans=b.columnSpans||{},b.columnSpans[d]=c.columnSpan);c.rowSpan&&(b.rowSpans=b.rowSpans||{},b.rowSpans[d]=c.rowSpan);b.themeStyle=c.themeStyle;c.width&&(a.style.width=c.width,e.style.width=c.width);c.height&&
(b.style.height=c.height);void 0!==c.left&&(a.style.left=c.left);void 0!==c.top&&(a.style.top=c.top)},getTableWidth:function(a){return a.style.width},getTableHeight:function(a){var b=0;a.rows.forEach(function(e){b+=e.style?e.style.height:0});return b},calcTableBox:function(a){return{x:a.style.left||0,y:a.style.top||0,w:g.getTableWidth(a),h:g.getTableHeight(a)}},createDetailsSection:function(a){return{type:q.DETAILS,stack:[g.createTable(a)]}},createDetailsSectionForFieldInfos:function(a,b){return{type:q.DETAILS,
stack:[function(){var e=g.createTable(l.mixin({numColumns:2,numRows:a.length+1},b));e.rows.forEach(function(c,d){0===d?c.field0=a[0].hasVariable?a[0].fieldCategory:"":(d=a[d-1],c.field0=d.script?d.script.alias:d.hasVariable?d.alias:w.getFieldLabel(d.name)||"",c.fieldInfos.field1=d)});g.provideSpaceAfter(e);return e}()]}},createDetailsSectionForFieldInfoGroups:function(a,b){return{type:q.DETAILS,stack:[function(){var e=g.createTable(l.mixin({numColumns:a.length+1,numRows:a[0].length+1},b));e.rows.forEach(function(c,
d){e.columns.forEach(function(n,h){0!==h&&(0===d?c[n.field]=a[h-1][0].fieldCategory||"":(h=a[h-1][d-1],c.field0=c.field0||(h.script?h.script.alias:h.alias),c.fieldInfos[n.field]=h))})});g.provideSpaceAfter(e);return e}()]}},provideSpaceAfter:function(a,b){a.style.spaceAfter=Math.max(b||0,90-15.07*a.rows.length)},applyDefaultStyling:function(a){var b=!0;a.rows.forEach(function(e,c){a.columns.forEach(function(d){e.style.fields[d.field].overrideStyle=0===c?"TableHeader":b?"AlternatingRow":void 0});b=
!b})},setTableHeaderStyle:function(a){if(a.style)for(var b in a.style.fields)(a.style.fields[b]=a.style.fields[b]||{}).overrideStyle="TableHeader"},DEFAULT_ROW_HEIGHT:15.07,isEmptyTable:function(a){return!a.columns||!a.columns.length||!a.rows||!a.rows.length},isSingleCelledTable:function(a){return 1===a.columns.length&&1===a.rows.length},isMultiDataTable:function(a){return 1<a.columns.length||2<a.rows.length},getTableSubtype:function(a){if(!g.isSingleCelledTable(a))return null;a=g.getFirstFieldInfo(a);
return x.isTextLikeCell(a)?"isTextLike":a.isImage?a.triggerJson?"isImage.hasConditionalStyling":"isImage":a.isShape?"isShape":null},getFirstFieldInfo:function(a){return a.rows[0].fieldInfos&&a.rows[0].fieldInfos[a.columns[0].field]},tableJsonHasInfographic:function(a){return!!g.getTableJsonInfographic(a)},getTableJsonInfographic:function(a){var b;a.rows.some(function(e){if(e.fieldInfos)for(var c in e.fieldInfos){var d=e.fieldInfos[c];if(d&&d.isInfographic)return b=d.infographicJson,!0}});return b},
getTableJsonFirstFieldInfo:function(a){return a.rows[0].fieldInfos[a.columns[0].field]},tableJsonHasChart:function(a){return a.rows.some(function(b){if(b.fieldInfos)for(var e in b.fieldInfos){var c=b.fieldInfos[e];if(c&&c.isChart)return!0}})}};return g});