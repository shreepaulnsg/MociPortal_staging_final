// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/templateJsonUtils/query/TemplateJsonQueryUtil",["./_SectionJsonCollector","../../../infographics/InfographicTypes"],function(l,k){var e={},d={process:function(a,c,b,f,g){var h=f;f=function(m,n,p){m&&h.apply(this,arguments)};g={processLevel:c,objJson:b,processFunc:f,ignoreComparisonCalculators:g&&g.ignoreComparisonCalculators};a!==c||"field"===a&&"field"===c?"document"===a?d._processTemplateJson(b,g):"section"===a?d._processSectionJson(b,
g):"table"===a?d._processTableJson(b,g,null):"tableRow"===a?d._processTableDataObj(b,g,null):"field"===a&&d._processFieldInfo(b,g,null):f(b)},_processTemplateJson:function(a,c){a.sectionsTables?a.sectionsTables.forEach(function(b){d._processTableJson(b,c)}):l.collectSectionJsons(a,{saveParentInfo:!1,processFieldInfoFunc:function(b){"field"===c.processLevel&&c.processFunc(b)}}).forEach(function(b){d._processSectionJson(b,c)})},_processSectionJson:function(a,c){"section"===c.processLevel&&c.processFunc(a);
a.stack&&a.stack.forEach(function(b){"sectionElement"===c.processLevel&&c.processFunc(b);"table"===b.id&&d._processTableJson(b,c)})},_processTableJson:function(a,c,b){"table"===c.processLevel&&c.processFunc(a);a.rows.forEach(function(f){"tableRow"===c.processLevel&&c.processFunc(f,b);d._processTableDataObj(f,c,b)});a.backgroundSectionJson&&d._processSectionJson(a.backgroundSectionJson,c);a.foregroundSectionJson&&d._processSectionJson(a.foregroundSectionJson,c);a.backgroundFloatingTablesSectionJson&&
d._processSectionJson(a.backgroundFloatingTablesSectionJson,c);a.foregroundFloatingTablesSectionJson&&d._processSectionJson(a.foregroundFloatingTablesSectionJson,c)},_processTableDataObj:function(a,c,b){if(a.fieldInfos)for(var f in a.fieldInfos)d._processFieldInfo(a.fieldInfos[f],c,b,"tableCell")},_processFieldInfo:function(a,c,b,f){if(a){"field"!==c.processLevel||c.skipVariables&&(a.hasVariable||a.script)||c.processFunc(a,b,f);a.triggerJson&&a.triggerJson.fieldInfo&&a.templateName!==a.triggerJson.fieldInfo.templateName&&
d._processFieldInfo(a.triggerJson.fieldInfo,c,a,"trigger");a.dataDrillingPanelInfo&&d._processSectionJson(a.dataDrillingPanelInfo.sectionJson,c);a.tooltipInfo&&a.tooltipInfo.fieldInfo&&d._processFieldInfo(a.tooltipInfo.fieldInfo,c,a,"fieldTooltip");a.linkFieldInfo&&d._processFieldInfo(a.linkFieldInfo,c,a,"linkFieldInfo");if(a.isRichText){for(var g in a.richTextJson.fieldInfos)b=a.richTextJson.fieldInfos[g],d._processFieldInfo(b,c,a,"richTextPart");for(g in a.richTextJson.linkFieldInfos)b=a.richTextJson.linkFieldInfos[g],
d._processFieldInfo(b,c,a,"richTextPart")}a.isInfographic&&d._processInfographicFieldInfo(a,c);a.isChart&&d._processChartFieldInfo(a,c);a.isReportSection&&a.sectionJson&&d._processSectionJson(a.sectionJson,c)}},_processInfographicFieldInfo:function(a,c){var b=a.infographicJson;switch(b.type){case k.STATIC:b.header&&d._processTableJson(b.header,c,a);b.variableTables&&b.variableTables.forEach(function(h){h.variable&&d._processFieldInfo(h.variable.fieldInfo,c,a,"staticInfographicVariable");h.description&&
h.description.fieldInfo&&d._processFieldInfo(h.description.fieldInfo,c,a,"staticInfographicDescription")});if(b.dataDrilling)for(var f in b.dataDrilling){var g=b.dataDrilling[f];g&&g.sectionJson&&d._processSectionJson(g.sectionJson,c)}break;case k.AGE_PYRAMID:case k.TAPESTRY:case k.PRIZM5:case k.RELATED_VARS:case k.ONE_VAR:!c.ignoreComparisonCalculators&&b.fieldInfos&&b.fieldInfos.forEach(function(h){d._processFieldInfo(h,c,a,"dynamicInfographicVariable")});break;case k.AREA_DETAILS:b.titleSectionJson&&
d._processSectionJson(b.titleSectionJson,c,a);b.attributesSectionJson&&d._processSectionJson(b.attributesSectionJson,c,a);b.notesSectionJson&&d._processSectionJson(b.notesSectionJson,c,a);break;case k.LOCATOR_TABLE:b.titleSectionJson&&d._processSectionJson(b.titleSectionJson,c);d._processSectionJson(b.headerSectionJson,c);d._processSectionJson(b.dataSectionJson,c);b.summarySectionJson&&d._processSectionJson(b.summarySectionJson,c);b.summaryFooterSectionJson&&d._processSectionJson(b.summaryFooterSectionJson,
c);b.summarizeFractionField&&"object"===typeof b.summarizeFractionField&&d._processFieldInfo(b.summarizeFractionField,c,a,"locatorFractionFieldInfo");break;case k.COMPARISON_TABLE:b.titleSectionJson&&d._processSectionJson(b.titleSectionJson,c),c.ignoreComparisonCalculators||d._processSectionJson(b.dataSectionJson,c)}},_processChartFieldInfo:function(a,c){var b=a.chartJson.visualProperties;b.chartIcons&&b.chartIcons.forEach(function(f){d._processFieldInfo(f,c,a,"chartIcon")});b.floatingIcons&&b.floatingIcons.forEach(function(f){d._processTableJson(f,
c,a,"floatingIcon")});b.floatingTexts&&b.floatingTexts.forEach(function(f){d._processTableJson(f,c,a,"floatingText")});c.ignoreComparisonCalculators&&a.chartJson.comparisonInfo&&(c=Object.assign({},c),c.skipVariables=!0);b.tooltip&&b.tooltip.fieldInfo&&d._processFieldInfo(b.tooltip.fieldInfo,c,a,"chartTooltip");a.chartJson.dataDrillingPanelInfo&&d._processSectionJson(a.chartJson.dataDrillingPanelInfo.sectionJson,c);a.chartJson.seriesItems.forEach(function(f){f.points.forEach(function(g){d._processFieldInfo(g.fieldInfo,
c,a,"chartPointField");g.iconFieldInfo&&d._processFieldInfo(g.iconFieldInfo,c,a,"chartPointIcon");g.captionFieldInfo&&d._processFieldInfo(g.captionFieldInfo,c,a,"chartPointCaption")})})}};e.DOCUMENT="document";e.SECTION="section";e.TABLE="table";e.SECTION_ELEMENT="sectionElement";e.TABLE_ROW="tableRow";e.FIELD="field";e.process=d.process;e.processTemplateFieldInfos=function(a,c,b){d.process("document","field",a,c,b)};e.processSectionFieldInfos=function(a,c,b){d.process("section","field",a,c,b)};e.processSectionElements=
function(a,c){d.process("document","sectionElement",a,c)};e.processTableFieldInfos=function(a,c,b){d.process("table","field",a,c,b)};e.processChartFieldInfos=function(a,c){a.seriesItems.forEach(function(g){g.points.forEach(function(h){h.fieldInfo&&c(h.fieldInfo,"series")})});var b=a.visualProperties.tooltip;if(b&&b.fieldInfo&&b.fieldInfo.isRichText){for(var f in b.fieldInfo.richTextJson.fieldInfos)c(b.fieldInfo.richTextJson.fieldInfos[f],"tooltip");for(f in b.fieldInfo.richTextJson.linkFieldInfos)c(b.fieldInfo.richTextJson.linkFieldInfos[f],
"tooltip")}a.dataDrillingPanelInfo&&e.processSectionFieldInfos(a.dataDrillingPanelInfo.sectionJson,function(g){c(g,"dataDrilling")})};e.processDataDrillingPanelInfos=function(a,c){e.processTemplateFieldInfos(a,function(b){if(b.isInfographic&&b.infographicJson.dataDrilling)for(var f in b.infographicJson.dataDrilling){var g=b.infographicJson.dataDrilling[f];g&&c(g)}else b.isChart&&b.chartJson.dataDrillingPanelInfo?c(b.chartJson.dataDrillingPanelInfo):b.dataDrillingPanelInfo&&c(b.dataDrillingPanelInfo)})};
e.hasMultiFeatureChart=function(a){var c=!1;e.processTemplateFieldInfos(a,function(b){b.isChart&&(c=c||b.chartJson&&!!b.chartJson.isMultiFeatureChart)});return c};e.hasComparisonInfographicTable=function(a){var c=!1;e.processTemplateFieldInfos(a,function(b){b.isInfographic&&(c=c||b.infographicJson&&b.infographicJson.type===k.COMPARISON_TABLE)});return c};e.isGraphicReport=function(a){return!!a.sectionsTables};e.hasDynamicColumns=function(a){return e._checkTableAttributes(a,function(c){return 0<c.dynamicColumns})};
e.hasDynamicRows=function(a){return e._checkTableAttributes(a,function(c){return 0<c.dynamicRows})};e._checkTableAttributes=function(a,c){var b;e.isGraphicReport(a)?e.processTemplateFieldInfos(a,function(f){f.isReportSection&&f.sectionJson&&f.sectionJson.stack&&f.sectionJson.stack.some(function(g){if("table"===g.id&&g.attributes&&c(g.attributes))return b=!0})}):b=e.collectSectionJsons(a).some(function(f){return f.stack&&f.stack.some(function(g){return"table"===g.id&&g.attributes&&c(g.attributes)})});
return b};e.hasMultiFeatureSections=function(a){return e.isGraphicReport(a)?e.hasMultiFeatureChart(a)||e.hasDynamicColumns(a)||e.hasComparisonInfographicTable(a):!1};e.calcNumberOfMaps=function(a,c){var b=0;e.collectSectionJsons(a).forEach(function(f){b+=e.calcNumberOfMapsInSectionJson(f,c)});return b};e.calcNumberOfMapsInSectionJson=function(a,c){var b=0;a.stack&&a.stack.forEach(function(f){"map"===f.id&&(c&&c(f),b++)});e.processSectionFieldInfos(a,function(f){f.isMap&&(c&&c(f.mapJson),b++)});return b};
e.calcNumberOfMapsInTableJson=function(a,c){var b=0;e.processTableFieldInfos(a,function(f){f.isReportSection&&(b+=e.calcNumberOfMapsInSectionJson(f.sectionJson,c))});return b};e.collectSectionJsons=l.collectSectionJsons;e.getParentBox=l.getParentBox;e.setParentBox=l.setParentBox;e.getParentStyle=l.getParentStyle;return e});