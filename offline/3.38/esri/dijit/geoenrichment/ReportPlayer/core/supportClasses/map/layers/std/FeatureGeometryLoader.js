// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/map/layers/std/FeatureGeometryLoader","esri/dijit/geoenrichment/Deferred esri/dijit/geoenrichment/ReportPlayer/dataProvider/supportClasses/tasks/EnrichAreasTask esri/dijit/geoenrichment/ReportPlayer/dataProvider/supportClasses/GEUtil esri/dijit/geoenrichment/utils/ArrayUtil esri/dijit/geoenrichment/utils/CacheUtil esri/dijit/geoenrichment/utils/InvokeUtil".split(" "),function(m,n,p,q,k,r){return{_countryKey:null,_countryId:null,_hierarchy:null,
_pendingInfos:{},canLoad:function(){return p.canMakeRequests()},getFeatureGeometry:function(a){var b=a.countryID+";"+a.hierarchy;this._countryKey!==b&&(k.set("FeatureGeometryLoader",{}),this._countryKey=b,this._pendingInfos={},this._countryId=a.countryID,this._hierarchy=a.hierarchy);b=k.get("FeatureGeometryLoader");var c=this._getKey(a.levelId,a.featureId,a.outSR);b[c]||(b[c]=this._addToPendingGeographies(a.levelId,a.featureId,a.outSR));return b[c]},_addToPendingGeographies:function(a,b,c){var e=
this._getKey(a,b,c),d=new m;a={levelId:a,featureId:b,outSR:c,dfd:d};this._pendingInfos[e]&&d.promise.then(this._pendingInfos[e].dfd.resolve,this._pendingInfos[e].dfd.reject);this._pendingInfos[e]=a;r.invoke(this,"_doEnrichPendingGeographies",100);return d.promise},_doEnrichPendingGeographies:function(){function a(g){var l="default"===g?null:{wkid:Number(g)};q.splitArrayToBunches(c[g],50).forEach(function(t){(new n).createFeaturesForGeographies(t,{countryID:b._countryId,hierarchy:b._hierarchy,generalizationLevel:5,
outSR:l}).then(function(u){u.forEach(function(h){var v=b._getKey(h.attributes.StdGeographyLevel,h.attributes.StdGeographyID,l);w[v].dfd.resolve(h.geometry)})})})}var b=this,c={},e;for(e in this._pendingInfos){var d=this._pendingInfos[e],f=d.outSR&&d.outSR.wkid||"default";(c[f]=c[f]||[]).push({levelId:d.levelId,id:d.featureId})}var w=this._pendingInfos;this._pendingInfos={};for(f in c)a(f)},_getKey:function(a,b,c){return a+";"+b+";"+(c&&c.wkid)}}});