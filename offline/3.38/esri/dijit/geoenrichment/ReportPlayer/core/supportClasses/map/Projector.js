// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/map/Projector",["dojo/_base/declare","esri/dijit/geoenrichment/Deferred","esri/dijit/geoenrichment/when","esri/dijit/geoenrichment/promise/all","esri/dijit/geoenrichment/utils/ProjectionUtil"],function(e,r,t,u,k){function l(a,d){return k.projectGeometries(a,d)}e=e(null,{_pendingInfos:null,_isBusy:!1,constructor:function(){this._pendingInfos=[]},addForProjection:function(a,d){if(this._isBusy)throw Error("Can't interrupt the current projection process.");
a=a&&a.geometry||a;var f=new r;this._pendingInfos.push({geom:a,mapOrSR:d,dfd:f,index:this._pendingInfos.length});return f.promise},project:function(){function a(c){var b=g[c];return t(l(b.geoms,b.mapOrSR),function(v){v.forEach(function(m,h){h=b.indexMap[h];n[h]=m;f[h].resolve(m)})})}var d=this;if(this._isBusy)throw Error("Can't interrupt the current projection process.");this._isBusy=!0;var f=[],g={};this._pendingInfos.forEach(function(c){f.push(c.dfd);var b=c.geom.type+";"+c.geom.spatialReference.wkid+
";"+k.getSpatialReference(c.mapOrSR).wkid;b=g[b]=g[b]||{geoms:[],indexMap:{},mapOrSR:c.mapOrSR};b.geoms.push(c.geom);b.indexMap[b.geoms.length-1]=c.index});this._pendingInfos.length=0;var p=[],n=[],q;for(q in g)p.push(a(q));return u(p).then(function(){d._isBusy=!1;return n})}});e.needProject=function(a,d){a=a&&a.geometry||a;return a.spatialReference&&a.spatialReference.wkid!==k.getSpatialReference(d).wkid};e.projectGeometries=l;return e});