// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/templateJsonUtils/fieldInfo/_FieldInfoPreviewRenderer","dojo/string ./utils ./FieldInfoPreviewSampleUtil ./FieldInfoPreviewAttributeUtil ../../conditionalStyling/ConditionalStyleUtil esri/dijit/geoenrichment/utils/DateUtil ../../../grid/coreUtils/sorting/GridSortUtil ../../../grid/coreUtils/GridDataUtil esri/dijit/geoenrichment/ReportPlayer/countryConfig ../../../sections/dynamicSettings/supportClasses/FilterUtil ./_FieldInfoDataRenderer dojo/i18n!esri/nls/jsapi ../../../../_devConfig".split(" "),
function(r,z,A,B,k,C,D,t,p,u,v,n,E){n=n.geoenrichment.dijit.ReportPlayer.FieldInfoPreview;var F={percent:[10,15,20,25,33,46,72,90,95],percentSmall:[2,3,4,5,6,7],index:[80,99,105,111,113,118,121,130],number:[1150,2013,5006,10135,20456,36813],numberSmall:[10,5,3,7,15]},G=/^MEDAGE|^AVGHHSZ|^UNEMPRT|ECYHSZAVG|ECYPTAMED/,w={percent:{MP19013a_B:72,MP19014a_B:70,EMP_TO_POP:25,NOHS:10,HSG:20,SC:30,BGPD:40,X9074_A:326},percentSmall:{UNEMPRT_CY:5},index:{},number:{MEDHINC_CY:55650,TOTPOP_CY:20456,TOTHH_CY:8546,
MEDDI_CY:38290,S01_BUS:11256,S01_EMP:60382,PCI_CY:30382,MEDNW_CY:88548,MEDVAL_CY:352430,X3004_A:5682,ACSMEDCRNT:1227,X5001_A:1762,X1003_A:4073,X4100_A:543,X8001_A:4538,X1130_A:3465,X7001_A:1568,X9008_A:246,X9073_A:158,X9045_A:42,POPGRWCYCY:1.05,POPGRWCYFY:1.12,ECYPTAPOP:20456,ECYHNIMED:55650},numberSmall:{AVGHHSZ_CY:2,MEDAGE_CY:36,ECYHSZAVG:2,ECYPTAMED:36},string:{TSEGNAME:"Bright Young Professionals",TLIFECODE:"L8",TLIFENAME:"Middle Ground",TSEGCODE:"8A",CONAME:"Coffee",NAICS:"1234",SIC:"5678",ADDR:"380 New York St, Redlands, CA",
STATE:"CA",STATE_NAME:"California",ZIP:"92373",ZIP4:"92373",CITY:"Redlands",STREET:"New York st.",DIRECTION:"SW",FRNCOD:"24"}},H={"Employee/ Population Ratio":"EMP_TO_POP","No High School Diploma":"NOHS","High School Graduate":"HSG","Some College":"SC","Bachelors/Grad/Prof Degree":"BGPD","Tickets to Movies/Museums/Parks: Average":"X9074_A"},x={};return{getValuePreview:function(a,b){return t.isVariableLikeFieldCell(a)?this._getVariableOrScriptPreview(a,b):this._getNonVariablePreview(a,b)},_getVariableOrScriptPreview:function(a,
b){function c(d){return{formattedValue:d,value:d,formatFunction:null,isUnavailableData:!1}}function e(d){d=0<a.decimals?Number((1.12345678*d).toFixed(a.decimals)):Math.round(d);if(a.unitPrefix)switch(a.unitPrefix){case "kilo":1E3>d&&(d*=1E3);break;case "mega":1E9>d&&(d*=1E6);break;case "giga":1E9>d&&(d*=1E9)}else a.isCompact&&1E3>d&&(d*=1E3);return{formattedValue:v.formatNumericValue(d,a),value:d,formatFunction:function(h){return v.formatNumericValue(h,a)},isUnavailableData:!1}}var g=this._getSampleCacheType(a);
if(E.preview.bigValues&&"number"===g)return e(1E12);if(b=this._getValueFromPreviewFunction(a,b))return"string"===typeof b.value?c(b.value):e(b.value);b=A.findNonEmptySample(a);if("string"===typeof b)return c(b);if("number"===typeof b)return e(b);var l=a.type||a.script&&("String"===a.script.type?"esriFieldTypeString":"esriFieldTypeDouble")||a.isSiteAttribute&&a.attribute.type;b=a.isSiteAttribute&&B.getAttributePreviewValue(a.attribute);if("esriFieldTypeDate"===l)return g=new Date,b&&g.setTime(b),c(C.formatDateShort(g));
if("esriFieldTypeString"===l)return c(w.string[a.isDataLayerAttribute?a.attribute.name:a.variableID]||b||n.sampleTextValue);if("number"===typeof b)return e(b);b=x[g]=x[g]||{};l=a.name+";"+a.decimals;var f=b[l];if(!f){f=w[g];var m=a.variableID?a.variableID:a.script&&H[a.script.alias];f=f[m];f||(g=F[g],f=g[Math.round((g.length-1)*Math.random())]);f=b[l]=f}return e(f)},_getSampleCacheType:function(a){var b=a.statefulName?"p"===a.statefulName.charAt(0):a.showPercent,c=a.statefulName&&"i"===a.statefulName.charAt(0);
a=a.hasVariable&&G.test(a.variableID);return b?a?"percentSmall":"percent":c?"index":a?"numberSmall":"number"},_getValueFromPreviewFunction:function(a,b){if(b=b.getPreviewValueFunction&&b.getPreviewValueFunction({fieldInfo:a})){var c=this._getSampleCacheType(a);c=0===c.indexOf("percent")?"percent":"number";b=b.fields&&b.fields[a.name]||b;return{value:b[c]||b.value,propName:c}}return null},_getNonVariablePreview:function(a,b){var c=void 0;if(b.getPreviewValueFunction){var e=b.getPreviewValueFunction({fieldInfo:a});
e&&(e=e.fields&&e.fields[a.name]||e,c=e.formattedValue||e.value)}void 0===c&&("headers.AREA_DESC"===a.name&&-1<b.currentFeatureIndex?(a=1+2*b.currentFeatureIndex,c=1===a?p.getSingleUnits()?"1 "+p.getSingleUnits():r.substitute(n.fieldPreviewAreaDescWithRadiusSingular,{radius:a}):p.getPluralUnits()?a+" "+p.getPluralUnits():r.substitute(n.fieldPreviewAreaDescWithRadiusPlural,{radius:a})):c=z.fields.getPreview(a.name,b.isGraphicReport,b.isMultiFeature)||a.alias);return{formattedValue:c,value:c,formatFunction:null,
isUnavailableData:!1}},getConditionalStylePreview:function(a,b){var c=a.triggerJson,e=b.cell;if(c&&void 0!==b.rowIndex){if(a=this._getValueFromPreviewFunction(a,b))return{style:k.getConditionalStyle(a.value,c),value:a.value};a=function(){var h=e.parentGrid.getCells().filter(function(q){return(q=t.getConditionalFormatting(q))&&q.groupId===c.groupId}),y=h.indexOf(e);return{index:y,numElements:h.length,value:1E3-10*y}};var g=c.calcMethod;if("aboveAverage"===g||"belowAverage"===g){b=c.cases.filter(function(h){return h.isDefault})[0];
var l=c.cases.filter(function(h){return!h.isDefault})[0],f=a(),m;"aboveAverage"===g?m=f.index<Math.floor(f.numElements/2):"belowAverage"===g&&(m=f.index>=Math.ceil(f.numElements/2));return m?{fileName:k.getConditionalFileName("first-non-default",c),style:k.styleFromSetters(l.setters),value:d}:{style:b?k.styleFromSetters(b.setters):{},value:f.value}}if("indexDescOrder"===g){f=a();var d=function(h){return 0<=h?h:f.numElements+h};return{fileName:k.getConditionalFileName(f.index,c,d),style:k.getConditionalStyle(f.index,
c,d),value:f.value,stats:{min:null,max:null,numElements:f.numElements}}}if(b=c.cases[b.rowIndex%c.cases.length])return m=k.styleFromSetters(b.setters),b.compareInfos&&(1===b.compareInfos.length?(d=Number(b.compareInfos[0].value),b=b.compareInfos[0].operator,"\x3e"===b?d++:"\x3c"===b&&d--):2===b.compareInfos.length&&(d=(Number(b.compareInfos[1].value)+Number(b.compareInfos[0].value))/2)),{style:m,value:d,stats:{min:0,max:100}}}return null},getRangeFilterPreview:function(a){if(a.presetFilter&&u.isRangeType(a.presetFilter.method)){if(a.presetFilter.columnIndex!==
a.columnIndex)return null;var b=u.getRangeStatistics(a.presetFilter.ranges),c=b.min;b=b.max;isFinite(c)||isFinite(b)?isFinite(b)?isFinite(c)||(c=0===b?0:0<b?b/2:2*b):b=0!==c?Math.abs(2*c):100:(c=0,b=100);var e=(b-c)/a.numRows;return{value:c+e*a.rowIndex,_min:c,_max:b,_step:e}}},getSortingPreview:function(a){var b=a.presetFilter&&this.getRangeFilterPreview(a);if(!a.presetSorting.order||a.presetSorting.field!==a.columnField)return b;var c=100,e=0,g=e+a.numRows*c;b&&(e=b._min,g=b._max,c=b._step);return{value:a.presetSorting.order===
D.ORDER_ASC?e+a.rowIndex*c:g-a.rowIndex*c}}}});