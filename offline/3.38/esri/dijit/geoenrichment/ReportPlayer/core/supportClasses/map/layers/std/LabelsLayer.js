// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/map/layers/std/LabelsLayer","dojo/_base/Color dojo/_base/declare dojo/_base/lang esri/layers/GraphicsLayer esri/renderers/SimpleRenderer esri/symbols/TextSymbol esri/graphic esri/geometry/Polygon esri/geometry/Point esri/dijit/geoenrichment/utils/InvokeUtil".split(" "),function(C,g,D,E,F,t,G,H,u,I){function v(a){return J[a]||"#005500"}function w(a){return{fontSize:13,fontFamily:"Arial",isBold:!1,isItalic:!1,isUnderlined:!1,color:v(a)}}
function x(a){var e=(new t).setColor(new C(a.color));e.font.setSize(a.fontSize+"px");e.font.setFamily(a.fontFamily);e.font.setStyle(a.isItalic?"italic":"normal");e.font.setWeight(a.isBold?"bold":"normal");e.font.setDecoration(a.isUnderlined?"underline":"none");return e}var J={"US.States":"#000000","US.Counties":"#40B25F","US.ZIP5":"#B8482C","US.Tracts":"#C6C346","US.BlockGroups":"#717A32","US.CBSA":"#32A6A1","US.DMA":"#9F2D28","US.Places":"#66665E","US.CD":"#DD6D27","US.CSD":"#3C3534","CAN.PR":"#787365",
"CAN.FED":"#4DA10C","CAN.CD":"#AC7A17","CAN.CSD":"#3A5731","CAN.CMACA":"#83211A","CAN.CT":"#B1A618","CAN.FSA":"#504F49","CAN.DA":"#5F7C16"};g=g(E,{isLabelsLayer:!0,labelField:"name",_graphics:null,_sourceLayer:null,_handle:null,setLabelField:function(a){this.labelField=a},setSourceGraphicsLayer:function(a){this._handle&&this._handle.remove();if(this._sourceLayer=a)this._handle=this._sourceLayer.on("graphic-add, graphic-remove, graphics-clear",function(){this.createLabels(null)}.bind(this))},createLabels:function(a){this._graphics=
a;return I.invoke(this,"_doCreateLabels",100)},_doCreateLabels:function(){this.clear();this._collectLabels(this._graphics||this._sourceLayer.graphics).forEach(function(a){this.add(new G(a.point,a.symbol,a.g.attributes))},this);this.redraw()},_collectLabels:function(a){function e(b){var c=p.renderer.getSymbol(b);c=new t(c.toJson());c.setVerticalAlignment("baseline");c.setHorizontalAlignment("center");c.setText(b.attributes[p.labelField]||"");return c}function K(b){return!q.some(function(c){c=c.rect;
if(!(c.X2<b.X1||c.X1>b.X2||c.Y2<b.Y1||c.Y1>b.Y2))return!0})}var p=this,q=[];a.forEach(function(b){function c(y,d,h){var f=d.getExtent();d=p.getMap();if(h){h=new u(f.xmin,f.ymin,f.spatialReference);var n=new u(f.xmax,f.ymax,f.spatialReference);h=d.toScreen(h);n=d.toScreen(n);var L=Math.abs(n.y-h.y);if(Math.abs(n.x-h.x)<4*k||L<4*l)return}f=f.getCenter();d=d.toScreen(f);d={X1:d.x-k/2,Y1:d.y-l/2,X2:d.x+k/2,Y2:d.y+l/2};K(d)&&(m=m||e(y),q.push({symbol:m,point:f,rect:d,g:y}),z=!0)}var z;if(b.attributes.__hasCachedLabelDimensions){var k=
b.attributes.__w;var l=b.attributes.__h}else{var m=e(b);k=m.getWidth();l=m.getHeight();b.attributes.__w=k;b.attributes.__h=l;b.attributes.__hasCachedLabelDimensions=!0}if(b.geometry.rings&&1<b.geometry.rings.length){for(var r=0;r<b.geometry.rings.length;r++){var A=b.geometry.rings[r];if(b.geometry.isClockwise(A)){var B=new H(b.geometry.spatialReference);B.addRing(A);c(b,B,!0)}}z||c(b,b.geometry,!1)}else c(b,b.geometry,!1)});return q},clearCache:function(a){a.forEach(function(e){e.attributes.__hasCachedLabelDimensions=
!1})},setVisualSettings:function(a){a=D.mixin(w(),a);this.setRenderer(new F(x(a)))},_setMap:function(){this.visibleAtMapScale=!0;return this.inherited(arguments)},_isMapAtVisibleScale:function(){return this.visibleAtMapScale},emitAvailabilityChanged:function(a){this.visibleAtMapScale=a;this.onScaleVisibilityChange()}});g.getLevelColor=v;g.getDefaultVisualSettings=w;g.labelPropertiesToSymbol=x;g.symbolToLabelProperties=function(a){return{color:a.color.toCss(!0),fontSize:a.font.size,fontFamily:a.font.family,
isItalic:"italic"===a.font.style,isBold:"bold"===a.font.weight,isUnderlined:"underline"===a.font.decoration}};return g});