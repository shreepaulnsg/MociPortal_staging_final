// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/grid/coreUtils/chart/GridChartUtil",["dojo/string","../../../charts/utils/ChartTypes","../GridDataUtil","dojo/i18n!esri/nls/jsapi"],function(r,m,u,q){function v(a,b,c){a=a.queryCells({rowIndex:b.index,columnIndex:c.index})[0];return a.appliedConditionalStyle&&a.appliedConditionalStyle.backgroundColor}q=q.geoenrichment.dijit.ReportPlayer.Grid;var f={getSupportedChartTypes:function(a){return f._canViewTableAsChart(a)&&[m.COLUMN,m.BAR,m.LINE,m.VERTICAL_LINE,
m.PIE,m.DONUT,m.RING]},getTableRowsColumnsInfos:function(a){var b=a.columns[0].field,c=f._hasBigTitleCell(a)?1:0,k=a.rows[c];if(!k)return null;var d=[],g=[];a.columns.forEach(function(h,e){0!==e&&g.push({label:k[h.field]||r.substitute(q.columnN,[e+1]),id:e+""})});a.rows.forEach(function(h,e){e>c&&d.push({label:h[b]||e+1+"",id:e+""})});return{rowInfos:d,columnInfos:g}},_canViewTableAsChart:function(a){return a.noChartView||2>a.columns.length||2>a.rows.length?!1:a.getCells().length===a.rows.length*
a.columns.length||f._hasBigTitleCell(a)&&a.getCells().length-1===(a.rows.length-1)*a.columns.length?!0:!1},getChartTitle:function(a){return a.getCells()[0].get("value")},_hasBigTitleCell:function(a){var b=a.getCells()[0];return u.getColumnSpan(b)===a.columns.length&&!u.getRowSpan(b)},createChartSeriesItems:function(a,b){return b.seriesInRows?f._buildSeriesInRows(a,b):f._buildSeriesInColumns(a,b)},_buildSeriesInColumns:function(a,b){var c=[],k=a.columns[0].field,d=f._hasBigTitleCell(a)?1:0;a.columns.forEach(function(g,
h){if(0!==h){var e={label:"",points:[]};c.push(e);a.rows.forEach(function(l,p){if(!(p<d))if(p===d)e.label=l[g.field]||r.substitute(q.columnN,[h+1]),e._cIndex=h;else{var t=u.getRenderedValue(a,l,g),n=l.fieldInfos[g.field];e.points.push({label:l[k]||r.substitute(q.rowN,[p+1]),color:n&&n.triggerJson&&v(a,l,g),value:{value:t.numericValue||0,formattedValue:t.formattedValue,decimals:n&&n.decimals},_rIndex:p})}})}});m.isSingleSeries(b.chartType)&&0<=b.sourceId&&(c=(b=c[b.sourceId])?[b]:[]);f._resolveSeriesNames(c,
!1);return c},_buildSeriesInRows:function(a,b){var c=[],k=f._hasBigTitleCell(a)?1:0,d=a.rows[k];a.rows.forEach(function(g,h){if(!(h<k)&&h!==k){var e={label:"",points:[]};c.push(e);a.columns.forEach(function(l,p){if(0===p)e.label=g[l.field]||r.substitute(q.rowN,[h+1]),e._rIndex=h;else{var t=u.getRenderedValue(a,g,l),n=g.fieldInfos[l.field];e.points.push({label:d[l.field]||p+1+"",color:n&&n.triggerJson&&v(a,g,l),value:{value:t.numericValue||0,formattedValue:t.formattedValue,decimals:n&&n.decimals},
_cIndex:p})}})}});m.isSingleSeries(b.chartType)&&0<=b.sourceId&&(c=(b=c[b.sourceId])?[b]:[]);f._resolveSeriesNames(c,!0);return c},_resolveSeriesNames:function(a,b){f._resolveItems(a,b);a.forEach(function(c){f._resolveItems(c.points,!b)})},_resolveItems:function(a,b){var c={};a.forEach(function(d){(c[d.label]=c[d.label]||[]).push(d)});for(var k in c)1<c[k].length&&c[k].forEach(function(d){d.label+=" ("+r.substitute(q[b?"rowN":"columnN"],[d[b?"_rIndex":"_cIndex"]+1])+")"});a.forEach(function(d){delete d[b?
"_rIndex":"_cIndex"]})}};return f});