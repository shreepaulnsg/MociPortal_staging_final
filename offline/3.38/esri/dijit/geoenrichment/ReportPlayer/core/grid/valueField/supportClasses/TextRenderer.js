// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/grid/valueField/supportClasses/TextRenderer","dojo/_base/lang dojo/when dojo/dom-construct dojo/dom-style esri/dijit/geoenrichment/utils/DomUtil esri/dijit/geoenrichment/utils/MathUtil esri/dijit/geoenrichment/utils/RegExpUtil esri/dijit/geoenrichment/utils/UrlUtil ../../coreUtils/GridDataUtil ../../../supportClasses/conditionalStyling/ConditionalStyleUtil ./BenchmarkUtil".split(" "),function(x,y,t,l,m,z,u,A,B,C,D){return{renderText:function(a,b,
c){a.valueLabel&&void 0!==b&&this._applyNewText(a,b,c);a.valueLabel&&(a.valueLabel.__hasTrimmedText=!1);c&&(a.trimTextIfOverflows=!1);if(a.trimTextIfOverflows&&a.valueLabel&&this._getLabelInnerHTML(a)&&!u.isRichText(this._getLabelInnerHTML(a))&&(b=this.getFullText(a),b!==this._getLabelInnerHTML(a)&&this._setLabelInnerHTML(a,b),a.valueLabel.__untrimmedText=b,a.domNode.clientWidth)){b=b.trim();c=this._measureValueField(a,b);var e=c.parentH;if(!(a.valueLabel.clientHeight<=e)){var g=Math.floor(c.parentW/
c.charWidth),k=b.length;b=b.substr(0,Math.max(1,Math.floor(e/c.lineHeight))*g);k>b.length&&(b=b.substr(0,b.length-3),this._setLabelInnerHTML(a,b+"..."),a.valueLabel.__hasTrimmedText=!0);if(a.valueLabel.clientHeight>e)for(;!(!b||a.valueLabel.clientHeight<=e||this._getLabelInnerHTML(a).length<=g);)b=b.substr(0,b.length-1),this._setLabelInnerHTML(a,b+"..."),a.valueLabel.__hasTrimmedText=!0}}},_measureValueField:function(a,b){var c=m.getNodeFontSize(a.domNode);c=m.getTextBox(b,{style:"font-family:"+l.get(a.valueLabel,
"fontFamily")+";font-size:"+c+"px;"});return{parentW:a.domNode.clientWidth-l.get(a.valueLabel,"paddingLeft")-l.get(a.valueLabel,"paddingRight"),parentH:a.domNode.clientHeight-l.get(a.valueLabel,"paddingTop")-l.get(a.valueLabel,"paddingBottom"),lineHeight:c.h,charWidth:c.w/b.length,textBox:c}},getFullText:function(a){return a.valueLabel&&(a.valueLabel.__untrimmedText||this._getLabelInnerHTML(a))},hasOverflowText:function(a){return a.valueLabel&&a.valueLabel.__hasTrimmedText||a.valueLabel.clientHeight>
a.domNode.clientHeight},_applyNewText:function(a,b,c){delete a.valueLabel.__untrimmedText;c?this._applyTextForBenchmark(a,b,c):this._getLabelInnerHTML(a)!==b&&this._setLabelInnerHTML(a,b)},_applyTextForBenchmark:function(a,b,c){function e(f){var d=B.getFieldInfo(a);d&&d.triggerJson&&(d=C.getConditionalStyle(c.ownValue,d.triggerJson))&&d.color&&(f=f||{},f.color=f.color||d.color);return D.createBenchmarkedValue(x.mixin({text:b,fontSize:E,isGreater:c.isGreater,formattedValue:c.formattedValue,color:a.fieldStyle.color,
nowrap:!0,noTextLimit:c.noTextLimit},f))}var g=this,k=a.parentGrid,E=m.getNodeFontSize(a.domNode);a.__benchmarkLabel&&t.destroy(a.__benchmarkLabel);delete a.__benchmarkLabel;if(k.infographicBenchmarkController)if(k.infographicBenchmarkController.isVariableInShape){var v=k.infographicBenchmarkController.getIconTable();y(v.getRenderPromise(),function(){function f(p){return m.getNodesBox(p.getBoundingClientRect?[p]:p)}g._setLabelInnerHTML(a,e());var d=g._getInnerHTMLNode(a),n=f(d.children[0]),h=v.getFirstCell().content;
if((h=f(h.getSvgNode?h.getSvgNode().children:h.content))&&!z.isRectInRect(n,h)){g._setLabelInnerHTML(a,b);n=f(d);d=t.create("div",null,a.domNode);d.style.position="absolute";d.style.fontSize="0px";d.innerHTML=e({text:"",color:k.infographicBenchmarkController.getOutsideShapeTextColor()});a.__benchmarkLabel=d;var F=f(d),q=f(a.domNode),w=q.w/m.noTransformPosition(a.domNode).w;d.style.left=(h.x+h.w-q.x)/w+5+"px";d.style.top=(n.y+(n.h-F.h)/2-q.y)/w+"px"}})}else if(this._setLabelInnerHTML(a,e()),"center"===
a.fieldStyle.horizontalAlign){var r=g._getInnerHTMLNode(a);a.domNode.style.marginLeft=Math.min(0,(a.getWidth()-r.children[0].clientWidth)/2)+"px"}else"right"===a.fieldStyle.horizontalAlign&&(r=g._getInnerHTMLNode(a),a.domNode.style.marginLeft=Math.min(0,a.getWidth()-r.children[0].clientWidth)+"px");else this._setLabelInnerHTML(a,e())},_getLabelInnerHTML:function(a){return this._getInnerHTMLNode(a).innerHTML},_setLabelInnerHTML:function(a,b){b=String(b);var c=a.valueLabel;if(a.autoDetectUrl){var e=
this.getFullText(a)||b;u.isUrl(e)?(a=this._getInnerHTMLNode(a),"A"===a.nodeName?(a.innerHTML=b,a.hasAttribute("href")&&a.removeAttribute("href"),a.setAttribute("href",e)):c.innerHTML="\x3ca href\x3d'"+A.toHttpsUrl(e)+"' target\x3d'_blank'\x3e"+b+"\x3c/a\x3e"):c.innerHTML=b}else c.innerHTML=b},_getInnerHTMLNode:function(a){var b=a.valueLabel;return a.autoDetectUrl&&b.childNodes&&1===b.childNodes.length&&b.childNodes[0]&&"A"===b.childNodes[0].nodeName?b.childNodes[0]:b}}});