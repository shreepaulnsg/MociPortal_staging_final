// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/grid/coreUtils/GridQueryUtil",["dojo/dom-geometry","./GridDataUtil","esri/dijit/geoenrichment/utils/ArrayUtil","esri/dijit/geoenrichment/utils/DomUtil","esri/dijit/geoenrichment/utils/MouseUtil"],function(p,q,r,t,u){var h={querySingleCell:function(b,a){a.fieldCell&&(a={rowId:a.fieldCell.row.id,columnId:a.fieldCell.column.id});var d;b.getCells().some(function(f){if(f.parentGrid&&f.column&&f.row&&!(f.column.id!==a.columnId&&f.column.index!==a.columnIndex&&
f.column.field!==a.columnField||f.row.id!==a.rowId&&f.row.index!==a.rowIndex))return d=f,!0});if(d)return d;if(a.considerSpans){var c=h.queryColumn(b,a),e=h.queryData(b,a);if(!c||!e)return null;var g=c.index,k=e.index;b.rows.some(function(f){return b.columns.some(function(l){var m=l.index,v=l.index+(f.columnSpans&&f.columnSpans[l.field]||0),n=f.index;l=f.index+(f.rowSpans&&f.rowSpans[l.field]||0);if(m<=g&&v>=g&&n<=k&&l>=k)return d=h.querySingleCell(b,{columnIndex:m,rowIndex:n}),!0})})}return d},queryColumn:function(b,
a){var d;b.columns.some(function(c){if(c.id===a.columnId||c.index===a.columnIndex||c.field===a.columnField)return d=c,!0});return d},queryData:function(b,a){var d;b.rows.some(function(c){if(c.id===a.rowId||c.index===a.rowIndex)return d=c,!0});return d},queryCells:function(b,a){if(a.fieldCell){var d=[],c=a.rowSpan||1,e=a.columnSpan||1;if(a=h.querySingleCell(b,a))for(var g=a.row.index;g<a.row.index+c;g++)for(var k=a.column.index;k<a.column.index+e;k++){var f=h.querySingleCell(b,{rowIndex:g,columnIndex:k});
f&&d.push(f)}return d}return this.queryCellsInArray(b.getCells(),a)},queryCellsInArray:function(b,a){var d=[];if(!Object.keys(a).length)return d;b.forEach(function(c,e){void 0!==a.cellIndex&&e!==a.cellIndex||void 0!==a.cellIndexes&&-1===a.cellIndexes.indexOf(e)||void 0!==a.columnId&&c.column.id!==a.columnId||void 0!==a.columnIds&&-1===a.columnIds.indexOf(c.column.id)||void 0!==a.columnIndex&&c.column.index!==a.columnIndex||void 0!==a.columnIndexes&&-1===a.columnIndexes.indexOf(c.column.index)||void 0!==
a.columnField&&c.column.field!==a.columnField||void 0!==a.columnFields&&-1===a.columnFields.indexOf(c.column.field)||void 0!==a.rowId&&c.row.id!==a.rowId||void 0!==a.rowIds&&-1===a.rowIds.indexOf(c.row.id)||void 0!==a.rowIndex&&c.row.index!==a.rowIndex||void 0!==a.rowIndexes&&-1===a.rowIndexes.indexOf(c.row.index)||d.push(c)});return d},isDynamicFieldCell:function(b,a){return b._dynamicBindings&&b._dynamicBindings[a.column.field]},getDynamicallyBoundColumns:function(b,a){return b._dynamicBindings&&
b._dynamicBindings[a.field]},getDynamicallyBoundFieldCells:function(b,a){if(a.column){var d=b._dynamicBindings&&b._dynamicBindings[a.column.field];if(!d)return null;var c=[];d.forEach(function(e){(e=e&&h.querySingleCell(b,{columnId:e.id,rowId:a.row.id}))&&c.push(e)});return c}},getAllBoundCells:function(b,a,d){var c=[],e={};a&&a.forEach(function(g){if((!d||d(g))&&!e[g.uniqueId]){e[g.uniqueId]=!0;var k=h.getDynamicallyBoundFieldCells(b,g);k?k.forEach(function(f){c.push(f);e[f.uniqueId]=!0}):c.push(g)}});
return r.removeDuplicates(c,"uniqueId")},trimDynamicBindings:function(b,a){var d=[],c={};a&&a.forEach(function(e){var g=h.getDynamicallyBoundFieldCells(b,e);g&&g.length?(c[g[0].uniqueId]||d.push(g[0]),g.forEach(function(k){c[k.uniqueId]=!0})):d.push(e)});return d},collectFieldInfos:function(b,a){var d=[];a=a||{};var c=a.fieldCells||b.getCells();a.trimDynamicBinding&&c&&(c=h.trimDynamicBindings(b,c));c&&c.forEach(function(e){(e=q.getFieldInfo(e))&&d.push(e)});return d},cellHasFloatingTableParent:function(b){function a(d){return d.isSection&&
d.isDataDrillingView?!1:d.isFloatingTable?!0:d.parentWidget?a(d.parentWidget):!1}return b&&b.parentGrid?a(b.parentGrid):!1},isMouseOver:function(b){return u.isMouseOverBox(h.getBBox(b))},getOverFieldCell:function(b,a){a=a||{};var d=a.cellFilter||function(){return!0},c;b.getForegroundFloatingCells({topFirst:!0}).some(function(e){if(d(e)&&e.isMouseOver())return c=e,!0});c||b.getCells().some(function(e){if(d(e)&&e.isMouseOver())return c=e,!0});c||b.getBackgroundFloatingCells({topFirst:!0}).some(function(e){if(d(e)&&
e.isMouseOver())return c=e,!0});return c},getBBox:function(b,a){var d=b.isSingleCelledTable()&&b.getFirstCell().getAngle();return"number"===typeof d&&0!==d?b.getFirstCell().getBBox(a):a&&a.noTransformation?t.noTransformPosition(b.domNode):p.position(b.domNode)}};return h});