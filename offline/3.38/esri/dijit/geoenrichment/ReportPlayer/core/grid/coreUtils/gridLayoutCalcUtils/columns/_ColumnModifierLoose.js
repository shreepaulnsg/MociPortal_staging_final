// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/grid/coreUtils/gridLayoutCalcUtils/columns/_ColumnModifierLoose","dojo/_base/lang dojox/uuid/generateRandomUuid ../GridLayoutCalculatorQueryUtil ../GridElementBoxCalculator ./ColumnDataUtil ../../GridQueryUtil".split(" "),function(p,q,r,t,l,u){var m={collectColumnBoxes:function(a,b){for(var c=[],g=0;g<a.rows.length;){var f=a.rows[g],d=this._createEmptyBox();f=r.getRowSpannedData(a,f,b.field)||[f];d.elements=this._getSpannedDataElements(a,b,f);this._measureBox(d);
var h=c[c.length-1];h&&(h.nextSibling=d,d.prevSibling=h);c.push(d);g+=f.length}return c},_createEmptyBox:function(){return{id:q(),box:null,elements:[],overlappingBoxes:[],overlappingBoxesCache:{},prevSibling:null,nextSibling:null}},_getSpannedDataElements:function(a,b,c){var g=[];c.forEach(function(f){f={data:f,dataIndex:f.index,field:b.field,box:t.calcDataBox(a,f,b.field)};g.push(f)});return g},_measureBox:function(a){var b=0;a.elements.forEach(function(c){b+=c.box.h});a.box={x:a.elements[0].box.x,
y:a.elements[0].box.y,w:a.elements[0].box.w,h:b}},mergeBoxesForRightColumn:function(a){var b=this._createEmptyBox();a.forEach(function(c){c.elements.forEach(function(g){b.elements.push({data:g.data,field:null,box:p.clone(g.box)})})});this._measureBox(b);b.box.w=1E6;return[b]},getBoxAtDataIndex:function(a,b){return a.filter(function(c){return c.elements[0].dataIndex===b})[0]}},v={buildInfluenceTree:function(a,b,c){function g(f,d){(d?b:a).forEach(function(h){var e;if(e=!h.overlappingBoxesCache[f.id]){e=
f.box;var k=h.box;e=!(e.y+.5>=k.y+k.h||e.y+e.h<=k.y+.5)}e&&(f.overlappingBoxes.push(h),f.overlappingBoxesCache[h.id]=!0)});f.overlappingBoxes.forEach(function(h){g(h,!d)})}c=m.getBoxAtDataIndex(a,c.index);g(c,!0);return c}},x={applyForce:function(a,b,c){function g(d,h){var e=d.elements[0];e.field&&l.setFieldWidth(a,e.data,e.field,l.getFieldWidth(a,e.data,e.field)+(h?-1:1)*f,!0);d.overlappingBoxes.forEach(function(k){g(k,!h)})}var f=this._checkDelta(a,b,c);g(b,!1)},_checkDelta:function(a,b,c){function g(e,
k){0!==d&&(k?0>d||(d=Math.min(d,e.box.w-f),e.prevSibling&&(d=Math.min(d,e.prevSibling.box.x+e.prevSibling.box.w-f-e.box.x)),e.nextSibling&&(d=Math.min(d,e.nextSibling.box.x+e.nextSibling.box.w-f-e.box.x))):0<d||(d=Math.max(d,-(e.box.w-f)),e.prevSibling&&(d=Math.max(d,-(e.box.x+e.box.w-(e.prevSibling.box.x+f)))),e.nextSibling&&(d=Math.max(d,-(e.box.x+e.box.w-(e.nextSibling.box.x+f))))),e.overlappingBoxes.forEach(function(w){g(w,!k)}))}var f=a.layoutDefaults.columnMinWidth;c=Math.max(c,f);var d=c-b.box.w;
if(0<d&&b.elements[0].field===a.columns[a.columns.length-1].field){var h=0;a.columns.forEach(function(e){h+=l.getFieldWidth(a,b.elements[0].data,e.field)});d=Math.min(d,l.getAllowedWidth(a)-h)}g(b,!1);return d}},n={_getInluencedStartBox:function(a,b,c){var g=a.columns[c.index+1];c=m.collectColumnBoxes(a,c);a=g?m.collectColumnBoxes(a,g):m.mergeBoxesForRightColumn(c);return v.buildInfluenceTree(c,a,b)},getAffectedCells:function(a,b,c){function g(d){if(d.elements[0].data){var h=u.querySingleCell(a,{rowIndex:d.elements[0].data.index,
columnField:d.elements[0].field,considerSpans:!0});h&&f.push(h)}d.overlappingBoxes.forEach(g)}var f=[];b=this._getInluencedStartBox(a,b,c);g(b);return f},adjustColumnCell:function(a,b,c,g){b=this._getInluencedStartBox(a,b,c);x.applyForce(a,b,g)}};return{adjustColumnWidth:function(a,b,c,g){n.adjustColumnCell(a,b,c,g)},getAffectedCells:function(a,b,c){return n.getAffectedCells(a,b,c)}}});