// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/grid/coreUtils/tooltip/GridCellTooltipBuilder","dojo/_base/declare ../GridDataUtil ../../../supportClasses/conditionalStyling/ConditionalStyleLegendBuilder ../../../supportClasses/templateJsonUtils/fieldInfo/FieldInfoNameUtil ../../../supportClasses/templateJsonUtils/fieldInfo/FieldInfoRenderer ../../../supportClasses/WidgetQueryUtil ../../valueField/supportClasses/TextRenderer ./_ScriptExpressionBuilder esri/dijit/geoenrichment/utils/ObjectUtil esri/dijit/geoenrichment/utils/TooltipUtil esri/dijit/geoenrichment/ReportPlayer/config dojo/i18n!esri/nls/jsapi".split(" "),
function(u,e,v,q,w,x,y,z,n,A,r,m){m=m.geoenrichment.dijit.ReportPlayer.Grid;var B=u(null,{_cell:null,_content:"",constructor:function(a){this._cell=a},getContent:function(){return this._content?"\x3cdiv class\x3d'esriGEAdjustableGridValueField_cellTooltipContent'\x3e"+this._content+"\x3c/div\x3e":null},addValue:function(a){this._content+="\x3cdiv class\x3d'esriGERowHigh esriGEAdjustableGridValueField_cellTooltipContentValue'\x3e"+a+"\x3c/div\x3e"},addImageValue:function(a){var b=e.getNumericCellValue(a);
isNaN(b)||"number"!==typeof b||(a=a.numberFormatFunction?a.numberFormatFunction(b):n.formatNumber(b),this._content+="\x3cdiv class\x3d'esriGERowHigh esriGEAdjustableGridValueField_cellTooltipContentValue'\x3e"+a+"\x3c/div\x3e")},addAlias:function(a){this._content+="\x3cdiv class\x3d'esriGERowHigh'\x3e\x3cb\x3e"+m.variable+"\x3c/b\x3e "+a+"\x3c/div\x3e"},buildRichText:function(a){var b=this._cell.parentGrid.viewModel.dynamicReportInfo;a=w.renderFieldInfoInTableCell(a,{previewValues:!0,fieldData:b&&
b.fieldData,isGraphicReport:!0,currentFeatureIndex:this._cell.parentGrid.currentFeatureIndex});this._content+="\x3cdiv class\x3d'esriGERowHigh'\x3e"+a.formattedValue+"\x3c/div\x3e"},addExpression:function(a,b){if(a=z.buildTooltipExpression(a,b))this._content+="\x3cdiv class\x3d'esriGERowHigh'\x3e"+m.variableIsBasedOnExpression+"\x3c/div\x3e",this._content+="\x3cdiv class\x3d'esriGERowHigh'\x3e"+a+"\x3c/div\x3e"},addConditionalStyleLegend:function(a){var b=e.getNumericCellValue(a),f=e.getCellGroupStyleStats(a),
g=e.getConditionalFormatting(a),c=e.getFieldInfo(a).isImage;this._content+=v.createLegendNode(g,f,c?"image":"text",b,a.numberFormatFunction).outerHTML},addTextBlock:function(a){this._content+="\x3cdiv class\x3d'esriGERowHigh'\x3e"+a+"\x3c/div\x3e"},addSeparator:function(){this._content+="\x3cdiv class\x3d'esriGERowHigh esriGEAdjustableGridValueField_cellTooltipContentSeparator'\x3e\x3c/div\x3e"}}),C=/<\w/,D={value:!1,alias:!0,expression:!1,conditional:!1},d={setDynamicTooltipToCell:function(a,b,f){if((a.hasOverflowText()||
e.isVariableLikeFieldCell(a)||e.isImageTriggerCell(a))&&d.isTooltipVisible(a)){var g=d.getTooltipInfo(a),c=d.getSourceFieldInfo(a);c=c&&!(!c.script&&!c.expressionText)&&g.expression;g=!!g.fieldInfo;g=c||g;a.own(A.setTooltipToNode(a.domNode,function(){return d.renderCellTooltip(a,b,f)},{notRestricted:c,stayOnHover:g,classes:"esriGEAdjustableGridValueField_cellTooltip"+(g?"":" esriGENonInteractable"),style:d.getTooltipStyleFunc(a)}))}},getTooltipInfo:function(a){var b=d.getSourceFieldInfo(a);return b&&
b.tooltipInfo?b.tooltipInfo:(a=x.getReportContainerGrid(a))&&a.tooltipInfo&&a.tooltipInfo.table||D},isTooltipVisible:function(a){var b=d.getSourceFieldInfo(a);if(b&&b.dataDrillingPanelInfo)return!1;a=d.getTooltipInfo(a);return a.value||a.alias||a.expression||a.conditional||a.fieldInfo},getSourceFieldInfo:function(a){var b=e.getFieldInfo(a);a=e.getConditionalFormatting(a);return b&&b.isImage?a&&a.fieldInfo:b},getTooltipStyleFunc:function(a){return function(){return d.getTooltipStyle(a)}},getTooltipStyle:function(a){if(!a.parentGrid)return null;
var b={},f=a.parentGrid.viewModel.getTheme(a.parentGrid.theme).table.tooltip;n.copyOwnJsonProperties(f,b);n.copyOwnJsonProperties(d.getTooltipInfo(a).style,b);return b},renderCellTooltip:function(a,b,f){f=f||{};var g=f.getExpression||function(E){return r.modules.complexCellTooltips&&E.expressionText},c=y.getFullText(a),l=e.getFieldInfo(a),F=l&&l.isImage,G=e.isVariableLikeFieldCell(l),H=e.getConditionalFormatting(a),t=d.getSourceFieldInfo(a),I=l&&l.isRichText||c&&C.test(c),h=new B(a),k=d.getTooltipInfo(a);
G?(k.value&&c&&h.addValue(c),k.alias&&h.addAlias(q.getFieldInfoAlias(l))):F?(k.value&&h.addImageValue(a),k.alias&&h.addAlias(q.getFieldInfoAlias(t))):c&&!I&&k.value&&c&&h.addValue(c);k.fieldInfo&&h.buildRichText(k.fieldInfo);if(k.expression){var p=g(t);p&&h.addExpression(p,b)}k.conditional&&H&&r.modules.complexCellTooltips&&(p&&h.addSeparator(),f.conditionalLegendDesc&&h.addTextBlock(f.conditionalLegendDesc),h.addConditionalStyleLegend(a));return h.getContent()}};return d});