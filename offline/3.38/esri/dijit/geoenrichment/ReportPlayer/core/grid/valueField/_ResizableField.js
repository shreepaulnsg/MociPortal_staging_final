// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/grid/valueField/_ResizableField","dojo/_base/declare dojo/aspect dojo/on dojo/string dojo/dom-class dojo/dom-construct dojo/dom-style ./supportClasses/ResizeColumnRowTooltipVisualizer ./supportClasses/ResizeEngine esri/dijit/geoenrichment/utils/PageUnitsConverter esri/dijit/geoenrichment/utils/DomUtil esri/dijit/geoenrichment/utils/MouseUtil esri/dijit/geoenrichment/utils/TooltipUtil dojo/i18n!esri/nls/jsapi".split(" "),function(r,t,m,u,f,n,v,h,k,
p,e,w,q,g){g=g.geoenrichment.dijit.ReportPlayer.ValueField;return r(null,{resizable:!0,hasAllSidesSizers:!1,showSizeLabel:!1,showSizeLabelsInAllRelatedCells:!1,showColumnRowSizeTooltip:!1,showSizersOnFocus:!1,createSizersOnDemand:!0,resizeSnapNode:null,resizeRestrictNode:null,allowHorizontalResizing:!0,allowVerticalResizing:!0,sizeLabel:null,_tooltipHandles:null,postCreate:function(){this._tooltipHandles=[];this.inherited(arguments);this.resizable&&this._addCreateSizersTrigger()},_isBeingResized:!1,
_isBeingResizedDelayed:!1,_sizers:null,isBeingResized:function(){return this.resizable&&this._sizers?this._isBeingResized||this._sizers.some(function(a){return w.isMouseOver(a)})||!this.hasAllSidesSizers&&this._sizers.some(function(a){return 0<v.get(a,"opacity")}):!1},wasResizedRecently:function(){return this.isBeingResized()||this._isBeingResizedDelayed},_addCreateSizersTrigger:function(){var a=this;this.createSizersOnDemand||this._updateSizers();m(this.domNode,"mouseover",function(){a._updateSizers()})},
_createSizers:function(){var a=this;this.resizable&&!this._sizers&&(this._sizers=(this.hasAllSidesSizers?k.ALL_DIRECTIONS:[this.allowHorizontalResizing?"e":null,this.allowVerticalResizing?"s":null].filter(function(c){return!!c})).map(function(c){var d=n.create("div",null,a.domNode);a.hasAllSidesSizers?f.add(d,(a.showSizersOnFocus?"valueField_allSidesSizer_showOnFocus":"valueField_allSidesSizer")+" "+c+"_fieldSizer"):"e"===c?(f.add(d,"valueField_widthSizer"),a._tooltipHandles.push(q.setTooltipToNode(d,
g.dragToChangeWidth))):(f.add(d,"valueField_heightSizer"),a._tooltipHandles.push(q.setTooltipToNode(d,g.dragToChangeHeight)));d._dir=c;return d}),this._addResizeHandlers())},unitTesting_getSizerByDirection:function(a){this._updateSizers();return this._sizers.filter(function(c){return c._dir===a})[0]},_addResizeHandlers:function(){var a=this;this._sizers.forEach(function(c){m(c,"mousedown",function(d){d.preventDefault();d.stopPropagation();a._setIsBeingResized(!0);a.stopEdit&&a.stopEdit();k.trackSizer({dir:c._dir,
w:a.getWidth(),h:a.getHeight(),angle:a.getAngle(),supportsCtrlShift:a.hasAllSidesSizers,getThisBox:function(){return e.noTransformPosition(a.domNode)},getThisFullBox:function(){return a.getBBox({noTransformation:!0})},getSnapNodeBoxes:function(){if(!a.hasAllSidesSizers)return null;var b=a._getResizeSnapElements()||[];b=b.map(function(l){return{box:l.getBBox({noTransformation:!0}),tolerance:3}});a.resizeSnapNode&&b.push({box:e.noTransformPosition(a.resizeSnapNode),tolerance:7});return b.length?b:null},
getRestrictNodeBox:function(){return a.hasAllSidesSizers?a.resizeRestrictNode&&e.noTransformPosition(a.resizeRestrictNode):null},onPreChange:function(){a._onManualSizePreChange()},onSizeChanged:function(){a._onManualSizeChange(c._dir);a.onManualSizeChange();a._updateSizers()},onWidthChanged:function(b){a.onManualWidthChange(b)},onHeightChanged:function(b){a.onManualHeightChange(b)},setWidth:function(b){a.parentGrid&&a.parentGrid.layoutDefaults.columnMinWidth&&(b=Math.max(b,a.parentGrid.layoutDefaults.columnMinWidth));
a.setWidth(b)},setHeight:function(b){a.parentGrid&&a.parentGrid.layoutDefaults.rowMinHeight&&(b=Math.max(b,a.parentGrid.layoutDefaults.rowMinHeight));a.setHeight(b)},applyShift:function(b,l){a.onNeedShiftPositionFromResizing(b,l)},onEnd:function(){a._setIsBeingResized(!1)},onSnapped:function(b){a.onResizeSnapped(b)}})})});this.hasAllSidesSizers&&this.own(t.after(this,"onSizeChanged",function(){(e.isNodeInLayout(a._sizers[0])||e.isNodeInLayout(a._sizers[1]))&&a._updateSizers()}))},_getResizeSnapElements:function(){},
_setIsBeingResized:function(a){a?(this._isBeingResizedDelayed=this._isBeingResized=!0,f.add(this.domNode,"isBeingResized"),this.parentGrid&&f.add(this.parentGrid.domNode,"isBeingResized")):(this._isBeingResized&&this._onManualSizeChangeEnd(),this._isBeingResized=!1,f.remove(this.domNode,"isBeingResized"),this.parentGrid&&f.remove(this.parentGrid.domNode,"isBeingResized"),e.stealFocus(),setTimeout(function(){this._isBeingResizedDelayed=!1}.bind(this),100));this._tooltipHandles.forEach(function(c){a?
c.suspend():c.resume()})},updateSizers:function(){this._updateSizers()},_updateSizers:function(){function a(){var d=c.getAngle();c._sizers.forEach(function(b){k.positionSizer({sizer:b,dir:b._dir,w:c.getWidth(),h:c.getHeight(),angle:d})})}this._createSizers();if(this._sizers&&this.hasAllSidesSizers){var c=this;5<this.domNode.clientHeight?a():setTimeout(a,100)}},_onManualSizePreChange:function(){this.onManualSizePreChange()},_onManualSizeChange:function(a){this.inherited(arguments);this.showSizeLabel&&
this._showAndUpdateSizeLabel();this.showSizeLabelsInAllRelatedCells&&this._showAndUpdateRelatedCellsSizeLabels();this.showColumnRowSizeTooltip&&("e"===a?h.showColumnTooltip(this):"s"===a&&h.showRowTooltip(this))},_onManualSizeChangeEnd:function(){e.hide(this.sizeLabel);this.showSizeLabelsInAllRelatedCells&&this._hideRelatedCellsSizeLabels();this.showColumnRowSizeTooltip&&h.removeTooltip();this.onManualSizeChangeEnd()},tryUpdateSizeLabel:function(){e.isNodeInLayout(this.sizeLabel)&&(this.showSizeLabel&&
this._showAndUpdateSizeLabel(),this.showSizeLabelsInAllRelatedCells&&this._showAndUpdateRelatedCellsSizeLabels())},_showAndUpdateSizeLabel:function(){if(this.domNode){this.sizeLabel=this.sizeLabel||n.create("div",{"class":"elementSizeLabel"},this.domNode);e.show(this.sizeLabel);var a=this.domNode.clientWidth,c=this.domNode.clientHeight,d=p.convert(a,"px",this.viewModel.getUnits()),b=p.convert(c,"px",this.viewModel.getUnits());this.sizeLabel.innerHTML=u.substitute(this.viewModel.provideUnits(g.elementSizeFormat),
{width:this.viewModel.roundForUnits(d),height:this.viewModel.roundForUnits(b)});d=this.sizeLabel.clientHeight;this.sizeLabel.style.left=Math.round((a-this.sizeLabel.clientWidth)/2)+"px";this.sizeLabel.style.top=Math.round(20<c?(c-d)/2:-d-5)+"px"}},_showAndUpdateRelatedCellsSizeLabels:function(){this._getRelatedCells().forEach(function(a){a._showAndUpdateSizeLabel()})},_hideRelatedCellsSizeLabels:function(){this._getRelatedCells().forEach(function(a){e.hide(a.sizeLabel)})},_getRelatedCells:function(){return this.parentGrid?
this.parentGrid.getCells().filter(function(a){return a!==this},this):[]},onManualSizePreChange:function(){},onManualSizeChangeEnd:function(){},onManualSizeChange:function(){},onManualWidthChange:function(a){},onManualHeightChange:function(a){},onNeedShiftPositionFromResizing:function(a,c){},onResizeSnapped:function(a){}})});