// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/_SerializationSupport","require dojo/_base/declare dojo/_base/lang esri/dijit/geoenrichment/Deferred esri/dijit/geoenrichment/when ./supportClasses/areas/AnalysisAreaJsonUtil ./supportClasses/areas/AnalysisAreaUtil ../core/infographics/InfographicTypes ../core/supportClasses/templateJsonUtils/query/TemplateJsonQueryUtil esri/dijit/geoenrichment/ReportPlayer/countryConfig esri/dijit/geoenrichment/utils/PortalUtil esri/dijit/geoenrichment/utils/UrlUtil esri/dijit/geoenrichment/ReportPlayer/config esri/dijit/geoenrichment/ReportPlayer/_devConfig".split(" "),
function(w,x,y,z,l,f,A,m,B,n,C,p,D,E){function q(){var a=new z;w("./supportClasses/attachments/AttachmentsStoreSerializer ./supportClasses/GEUtil ../core/supportClasses/templateJsonUtils/TemplateJsonSerializer ../core/supportClasses/templateJsonUtils/TemplateJsonAnalyzer ../core/infographics/utils/InfographicJsonUtil ../core/conversion/portalToEditorUtils/variables/PlayerVariableProvider ../core/infographics/InfographicTypes ./commands/mapToImage/MapToURLUtil esri/dijit/geoenrichment/utils/ProjectionUtil".split(" "),
function(b,c,e,d,g,F,G,H,I){h=b;r=c;k=e;t=F;m=G;u=H;v=I;a.resolve()});return a.promise}var h,r,k,t,u,v;return x(null,{reportDataToJson:function(a,b){var c=this;b=b||{};var e=!1;B.processTemplateFieldInfos(a.templateJson,function(d){d.isInfographic&&d.infographicJson.type===m.ATTACHMENTS&&(e=!0)});return q().then(function(){return l(a.attachmentsStore&&h.getAttachmentsStoreJson(a.attachmentsStore,{numAreas:a.analysisAreas.length,saveImages:e}),function(d){var g=y.mixin({},a.config);!1!==b.forceFixedDataMode&&
delete g.geoenrichmentUrl;d={jsapiVersion:D.jsapiVersion,isMultiFeature:a.isMultiFeature,reportTitle:a.reportTitle,templateJson:k.serialize(a.templateJson),reportObject:c._prepareReportObjectJson(a.reportObject),fieldData:a.fieldData,analysisAreas:f.areasToJson(a.analysisAreas),combinedAreasInfo:a.combinedAreasInfo&&f.combinedAreasInfoToJson(a.combinedAreasInfo),reverseAnalysisAreasOnMap:a.reverseAnalysisAreasOnMap,attachmentsStore:d,templateVariableProvider:a.templateVariableProvider&&a.templateVariableProvider.toJson(),
config:g,countryConfig:n.toJson(),mapImageInfos:b.mapImageInfos,loadedMapPortalItems:b.loadedMapPortalItems,customLogo:a.customLogo};E.logData&&(console.log("_SerializationSupport.js \x3d\x3e reportDataJson"),console.log(d));return d})})},_prepareReportObjectJson:function(a){var b={},c;for(c in a)a[c]&&"object"!==typeof a[c]&&(b[c]=a[c]);return b},reportDataFromJson:function(a){return q().then(function(){var b=a.fieldData;b.featureData&&(b.areaData=b.featureData.map(function(e){return{mainCalculator:{data:e}}}),
delete b.featureData);var c={isMultiFeature:a.isMultiFeature,reportTitle:a.reportTitle,templateJson:k.deserialize(a.templateJson),reportObject:a.reportObject,fieldData:b,analysisAreas:f.areasFromJson(a.analysisAreas),combinedAreasInfo:a.combinedAreasInfo&&f.combinedAreasInfoFromJson(a.combinedAreasInfo)||{},reverseAnalysisAreasOnMap:a.reverseAnalysisAreasOnMap,attachmentsStore:a.attachmentsStore&&h.getAttachmentsStoreFromJson(a.attachmentsStore),templateVariableProvider:a.templateVariableProvider&&
new t(a.templateVariableProvider),config:a.config||{},mapImageInfos:a.mapImageInfos,loadedMapPortalItems:a.loadedMapPortalItems,customLogo:a.customLogo};A.populateCombinedAreasInfo(c.combinedAreasInfo,c.analysisAreas);r.setGeoenrichmentUrl(null);b=!1;c.config.portalUrl&&p.setArcgisUrl(p.getPortalUrl(c.config.portalUrl));c.config.geometryServiceUrl?v.setGeometryServiceUrl(c.config.geometryServiceUrl):b=!0;c.config.printMapTaskUrl?u.setPrintMapTaskUrl(c.config.printMapTaskUrl):b=!0;n.fromJson(a.countryConfig);
return l(b&&C.tryConfigureServicesFromAGOLPublic()).then(function(){return c})})}})});