// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/commands/CreateImageCommand","require dojo/_base/declare esri/dijit/geoenrichment/Deferred esri/dijit/geoenrichment/when dojo/sniff ./CreateHTMLCommand ../../PlayerCommands ./supportClasses/ProgressSteps ./createHTML/CommandMode esri/dijit/geoenrichment/ReportPlayer/config dojo/i18n!esri/nls/jsapi".split(" "),function(t,u,v,k,m,w,x,g,y,z,h){function A(){var d=new v;t(["./imageUtils/ImageSaveUtil","./imageUtils/NodeToCanvasUtil","./imageUtils/ImagePrintUtil",
"./createHTML/CSSFilesLoader"],function(b,a,e,c){n=b;p=a;q=e;r=c;d.resolve()});return d.promise}h=h.geoenrichment.dijit.ReportPlayer.ReportPlayer;var n,p,q,r;return u(w,{id:x.IMAGE,label:h.createImageCommandLabel,errorMessage:h.createImageError,_saveFiles:!1,_stopPrintableContainer:!1,_mode:y.SVG,_mergePageIndexes:!1,_convertUrlImages:!0,_hideUrlImages:!0,execute:function(d,b){var a=this,e=this.inherited(arguments);return A().then(function(){return k(e,function(c){function B(f){return!b.skipErrorNotification&&
a._handleError(f)}if(c&&c.svgStrings){var C=c.svgStrings.length,D=function(f){a._stepFinished(g.RENDER_IMAGE,f+1,C)};c.svgStrings=a._preProcessSVGStrings(c.svgStrings);return k(r.loadCssFontFiles(),function(){return q.printImages({svgStrings:c.svgStrings,nodeToCanvasFunc:a._nodeToCanvasFunc.bind(a),onRenderImage:D,scale:3}).then(function(f){return n.saveImages(f,{fileName:b.fileName,reportTitle:d.getReportTitle(),analysisAreas:d.getAnalysisAreas(),numPages:a._printableContainer.getNumberOfPages(),
confirmSaveFile:a._confirmSaveFile,skipSavingFile:b.skipSavingFile||z.createImageCommand.skipSavingFile,saveImageFunc:c.additionalFiles&&c.additionalFiles.length&&function(l){return a._saveMultipleFiles([l],c.additionalFiles,b.fileName)},saveMultipleImagesFunc:a._saveMultipleFiles&&function(l){return a._saveMultipleFiles(l,c.additionalFiles,b.fileName)}})}).otherwise(B).always(function(f){return k(a._printableContainer&&a._printableContainer.stop(),function(){return f})})})}})}.bind(this))},_saveMultipleFiles:null,
_stepFinished:function(d,b,a){if(this._currentProgressBack){var e=0;switch(d){case g.REPLACE_MAPS:e=10;break;case g.PREPARE_DOM:e=20;break;case g.RENDER_PAGE:e=20+40*b/a;break;case g.UNSET_LAYOUT:e=70;break;case g.RENDER_IMAGE:e=70+30*b/a}this._currentProgressBack(e/100)}},_preProcessSVGStrings:function(d){return d},_nodeToCanvasFunc:function(d,b,a){return p.svgNodeToCanvasFunc(d.children[0],b,a)},isBrowserSupported:function(){return!(m("ie")||m("trident"))}})});