// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/commands/CreatePDFCommand","require dojo/_base/declare esri/dijit/geoenrichment/Deferred esri/dijit/geoenrichment/when ./CreateHTMLCommand ../../PlayerCommands ./supportClasses/ProgressSteps ./createHTML/CommandMode ../supportClasses/GEUtil esri/dijit/geoenrichment/ReportPlayer/config dojo/i18n!esri/nls/jsapi ../../_devConfig".split(" "),function(x,y,z,m,A,B,g,C,n,p,h,D){function E(){var e=new z;x(["esri/dijit/geoenrichment/utils/FileUtil",
"esri/dijit/geoenrichment/utils/MaskUtil","esri/dijit/geoenrichment/utils/requests/FileContent","./supportClasses/LayoutXMLBuilder"],function(b,k,a,l){q=b;r=k;t=a;u=l;e.resolve()});return e.promise}h=h.geoenrichment.dijit.ReportPlayer.ReportPlayer;var q,r,t,u;return y(A,{id:B.PDF,label:h.createPDFCommandLabel,errorMessage:h.createPDFError,_saveFiles:!1,_stopPrintableContainer:!1,_mode:C.SVG,_requestSizeLimit:9E6,_replaceImagesWithItemResources:!0,_replaceMapsWithJson:!0,execute:function(e,b,k){var a=
this,l=this.inherited(arguments);return E().then(function(){var v=function(c){if(!b.skipErrorNotification)return a._handleError(c)};return m(l,function(c){if(c&&c.svgStrings){var f=u.buildLayoutXML(c);D.createPDFCommand.removeUnicodeChars&&(f=r.removeXMLMasks(f,"X"));if(b.returnLayoutXMLOnly)return f;var w={report:e.getReportTitle(),format:"pdf",f:"bin"};f=t.fromFileData("report.xml",f);delete f.filename;w["report.xml"]=f;return n.formatReport(w).then(function(d){if(d&&d.data)return!b.skipCreditConsumption&&
!p.createPDFCommand.skipCreditConsumption&&b.creditsTaskIDs&&b.creditsTaskIDs.forEach(function(F){n.consumeCredits(F)}),a._stepFinished(g.FORMAT_REPORT),d={name:b.fileName||e.getReportTitle()+".pdf",data:d.data},b.skipSavingFile||p.createPDFCommand.skipSavingFile||(a._saveMultipleFiles&&c.additionalFiles&&c.additionalFiles.length?a._saveMultipleFiles(d,c.additionalFiles):q.saveAs(d.data,d.name)),d;v()})}}).otherwise(v).always(function(c){return m(a._printableContainer&&a._printableContainer.stop(),
function(){return c})})}.bind(this))},_saveMultipleFiles:null,_stepFinished:function(e,b,k){if(this._currentProgressBack){var a=0;switch(e){case g.REPLACE_MAPS:a=10;break;case g.PREPARE_DOM:a=20;break;case g.RENDER_PAGE:a=20+60*b/k;break;case g.UNSET_LAYOUT:a=90;break;case g.FORMAT_REPORT:a=100}this._currentProgressBack(a/100)}}})});