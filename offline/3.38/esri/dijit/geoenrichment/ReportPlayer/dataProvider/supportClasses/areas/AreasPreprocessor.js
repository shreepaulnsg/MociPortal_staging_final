// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/supportClasses/areas/AreasPreprocessor","dojo/_base/lang esri/dijit/geoenrichment/when esri/dijit/geoenrichment/promise/all dojo/string esri/graphic esri/symbols/jsonUtils ./FeatureNameUtil ../tasks/EnrichAreasTask esri/dijit/geoenrichment/utils/GeometryUtil esri/dijit/geoenrichment/ReportPlayer/config dojo/i18n!esri/nls/jsapi".split(" "),function(n,m,p,x,y,q,z,r,t,l,u){var v={preprocessAreas:function(c,a){a=a||{};c.analysisAreas=c.analysisAreas.filter(function(b){return b.feature&&
b.feature.geometry&&"polygon"===b.feature.geometry.type||b.geographies&&b.geographies.length||b.buffer});-1!==a.analysisAreasLimit&&(a.analysisAreasLimit=a.analysisAreasLimit||20,c.analysisAreas.length=Math.min(c.analysisAreas.length,a.analysisAreasLimit));v.provideAreasIndexes(c);c.analysisAreas.forEach(function(b){b.feature&&!b.feature.attributes&&(b.feature.attributes={})});c.analysisAreas.forEach(function(b){b.name=b.name||b.shortName;if(!b.name&&b.feature){var d=z.guessFeatureName(b.feature);
d&&(b.name=b.shortName=d)}});return m(A.generalize(c.analysisAreas),function(){return p([B.provideGeographyFeatures(c),C.provideBufferFeatures(c)])})},provideAreasIndexes:function(c){var a=c.combinedAreasInfo.groups,b=a&&a.length;c.analysisAreas.forEach(function(d,e){d.index=e;a&&(a.forEach(function(h,f){-1!==h.indexes.indexOf(e)&&(d.isGrouped=!0,d.groupIndex=f)}),"number"!==typeof d.groupIndex&&(d.isGrouped=!1,d.groupIndex=b++))})},removeGroupInfo:function(c){c.forEach(function(a){delete a.isGrouped;
delete a.groupIndex})}},A={generalize:function(c){var a=[],b=[];c.forEach(function(d,e){!d.feature||d.geographies&&d.geographies.length||(a.push(d.feature),b.push(e))});return m(function(d){function e(g){var k=0;g.geometry.rings.forEach(function(D){k+=D.length});return k}var h=t.needGeneralizeGeometry(d,l.generalization.factor,l.generalization.maxVerticesInAllFeatures,l.generalization.numVerticesPerFeature);if(h){var f=!0;var w=[];d=d.map(function(g){w.push(e(g));return new y(g.geometry,g.symbol,
g.attributes)});var E=t.generalizeGeometry(d,h,l.generalization.numVerticesPerFeature,!0)}return m(E,function(){f&&(console.log("Generalize features:"),d.forEach(function(g,k){console.log("#"+k+" "+w[k]+" \x3d\x3e "+e(g))}));return d})}(a),function(d){b.forEach(function(e){c[e].feature=d.shift()})})}},B={provideGeographyFeatures:function(c){return p(c.analysisAreas.map(function(a){if(!a.feature&&a.geographies&&a.geographies.length)return(new r).createFeatureForGeographies(a.geographies,{countryID:c.countryID,
hierarchy:c.hierarchy}).then(function(b){a.feature=b;a.name=a.name||a.feature.attributes.StdGeographyName;a.description=a.description||u.geoenrichment.dijit.ReportPlayer.ReportPlayer.geography;a.address=a.address||a.name;a.geographies[0].attributes&&n.mixin(a.feature.attributes,a.geographies[0].attributes);if(b=a.geographies[0].symbol)b=b.toJson?b:q.fromJson(b),a.feature.setSymbol(b)})}))}},C={provideBufferFeatures:function(c){var a=this,b=c.analysisAreas.filter(function(e){return!e.feature&&e.buffer}),
d=b.map(function(e){return e.buffer});return(new r).createFeaturesForBuffers(d,{countryID:c.countryID}).then(function(e){e.forEach(function(h,f){f=b[f];f.feature=h;a._applyBufferParamsToArea(f)})})},_applyBufferParamsToArea:function(c){var a=c.buffer;if(!c.name){var b=u.geoenrichment.dijit.bufferTitle.pointRing;b[a.units]&&(c.name=x.substitute(b[a.units],{radius:a.radius}))}c.description=c.description||"Ring";a.attributes&&n.mixin(c.feature.attributes,a.attributes);if(a=a.symbol)a=a.toJson?a:q.fromJson(a),
c.feature.setSymbol(a)}};return v});