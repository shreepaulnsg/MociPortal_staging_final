// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/supportClasses/ge/_GEFilterSupport",["dojo/_base/declare","esri/tasks/FeatureSet","esri/dijit/geoenrichment/infographicUtils/formatVariable","esri/dijit/geoenrichment/utils/ObjectUtil"],function(g,h,k,l){return g(null,{_filterRanges:null,_alwaysAllowThisAreasWhenFiltering:!1,getData:function(a){this.data||(this.data=this._createFeatureSet());return a&&a.ignoreFilters?this.data:this._filterRanges&&this._filterRanges.length&&this.data?this._filterData(this.data):
this.data},_createFeatureSet:function(){},_filterData:function(a){var c=new h;c.fields=a.fields;c.fieldAliases=a.fieldAliases;c.features=a.features.filter(function(d){return this._alwaysAllowThisAreasWhenFiltering&&d.attributes.isThisArea?!0:!this._filterRanges.some(function(b){var e=d.attributes[b.fieldName];return e<b.min||e>b.max})},this);return c},_excludeMap:{StdGeographyName:1,StdGeographyID:1,StdGeographyLevel:1,isThisArea:1},getAttributeFields:function(){var a=this.getData({ignoreFilters:!0});
if(!a)return[];a=a.fields;for(var c=[],d=0;d<a.length;d++){var b=a[d];!this._excludeMap[b.name]&&this._filterAttributeField(b)&&c.push({name:b.name,label:b.alias,decimals:0<=b.decimals?b.decimals:void 0,type:b.type,formatFunction:function(e){return function(f){return-1===e.decimals?l.formatNumber(f):k(e,f)}}(b)})}return c},_filterAttributeField:function(a){return this.variables&&this.variables.length?"HouseholdsByIncome.*"===this.variables[0]?0===a.name.indexOf("HIN"):"HouseholdIncomeCurrentYear.*"===
this.variables[0]?0===a.name.indexOf("EHYHNI"):"Age.*"===this.variables[0]?0===a.name.indexOf("FEM")||0===a.name.indexOf("MAL")||0===a.name.indexOf("ECYP"):-1!==this.variables[0].indexOf("AVGHHSZ")?-1!==a.name.indexOf("AVGHHSZ"):"RaceAndEthnicity.*"===this.variables[0]?-1!==a.name.indexOf("_CY_"):!0:!0},getAllGeographyAttributes:function(a){a=this.getData(a);if(!a)return[];a=a.features;for(var c=[],d=0;d<a.length;d++){var b=a[d].attributes;b.isThisArea||c.push(b)}return c},setFilterRanges:function(a,
c){this._filterRanges=a;this._alwaysAllowThisAreasWhenFiltering=c&&c.ignoreThisAreas},collectFilterRangesStats:function(a){if(!this.getData())return null;a=a||{};var c=a.additionalAttributes||[];c=c.concat(a.excludeThisAreas?this.getAllGeographyAttributes({ignoreFilters:!0}):this.getData({ignoreFilters:!0}).features.map(function(b){return b.attributes}));var d=[];this.getAttributeFields().forEach(function(b){if("esriFieldTypeString"!==b.type){var e={fieldName:b.name,alias:b.label,min:Infinity,max:-Infinity,
decimals:b.decimals,dataArray:[]};d.push(e);c.forEach(function(f){f=f[b.name];e.min=Math.min(e.min,f);e.max=Math.max(e.max,f);e.dataArray.push(f)})}});return{filterRanges:d,numAreasTotal:c.length}}})});