// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/toolbar/AreasSelect","dojo/_base/declare dojo/_base/lang dojo/dom-class dojo/dom-construct esri/dijit/geoenrichment/TriStateItem esri/dijit/geoenrichment/ToggleButton esri/dijit/geoenrichment/lists/FlowListDefaultItemRenderer ../PlayerViewModes ./Select ./ComparisonSettings ../dataProvider/supportClasses/areas/AnalysisAreaUtil esri/dijit/geoenrichment/utils/DeviceUtil esri/dijit/geoenrichment/utils/PopupUtil esri/dijit/geoenrichment/utils/TooltipUtil dojo/i18n!esri/nls/jsapi".split(" "),
function(r,u,n,g,v,w,x,m,y,z,A,t,B,p,q){q=q.geoenrichment.dijit.ReportPlayer.PlayerToolbar;var C=r(x,{canRemoveAreas:!1,canMoveAreas:!1,wrapInCards:!1,nls:null,createPresentation:function(a,c,d,f){var k=this,b=this.inherited(arguments);if(a.isSeparator)return b;b.innerHTML="";if("all"===a.value){b.style.cursor="pointer";var h=g.create("div",{"class":"dijitInline esriGEReportPlayerToolbar_checkboxRoot"},b);(new w(h,{mode:"toggle"})).set("checked",this.isCompareAll());g.create("div",{"class":"dijitInline",
innerHTML:a.label},b);b.addEventListener("click",function(){if(k.isCompareAll())k.onStopComparison();else k.onCompareAreasSideBySide()});p.setTooltipToNode(b,this.isCompareAll()?this.nls.compareAreasSideBySideTooltipOff:this.nls.compareAreasSideBySideTooltipOn,{position:["before","after"]});return b}if("addAreas"===a.value)return b.style.cursor="pointer",g.create("div",{"class":"dijitInline esriGESpaceAfterBig esriGEReportPlayerToolbar_addMoreAreasIcon"},b),g.create("div",{"class":"dijitInline",innerHTML:a.label},
b),b.addEventListener("click",function(){k.onAddMoreAreas()}),b;if(a.isAdditional)return b.style.cursor="pointer",a.buttonInfo.imageClass&&g.create("div",{"class":"dijitInline esriGESpaceAfterBig "+a.buttonInfo.imageClass},b),g.create("div",{"class":"dijitInline",innerHTML:a.label},b),b.addEventListener("click",function(e){a.buttonInfo.callback(e);k.onClosePopup()}),a.buttonInfo.tooltip&&(h=g.create("div",{"class":"dijitInline esriGESpaceBeforeBig esriGEInfoIcon"},b),p.setTooltipToNode(h,a.buttonInfo.tooltip,
a.buttonInfo.tooltipParams)),a.buttonInfo.onCreated&&a.buttonInfo.onCreated(b),b;if(a.canSelect){h=g.create("div",{"class":"dijitInline esriGEReportPlayerToolbar_checkboxRoot"},b);var l=new v(h);l.autoToggle=!1;l.set("checked",a.selected);b.addEventListener("click",function(){a.selected=!a.selected;l.set("checked",a.selected);a.isGroup?a.children.forEach(function(e){e.selected=a.selected}):a.parent&&(a.parent.selected=a.parent.children.some(function(e){return e.selected}));k.onVisibilityChanged()})}this.canRemoveAreas&&
a.isHost&&(h=g.create("div",{"class":"esriGEFloatEnd esriGESpaceBeforeBig esriGEReportPlayerToolbar_removeAreaButton"},b),h.addEventListener("click",function(e){e.stopPropagation();k.onRemoveAreas(a.isArea?[a.analysisArea]:a.analysisAreas)}),p.setTooltipToNode(h,a.isGroup?this.nls.removeAreasFromInfographic:this.nls.removeAreaFromInfographic));this.canMoveAreas&&a.isHost&&this.isCompareAll()&&(h=g.create("div",{"class":"esriGEFloatEnd upDownArrowsBlock"},b),0<a.hostIndex&&g.create("div",{"class":"dijitInline upArrow"},
h).addEventListener("click",function(e){e.stopPropagation();k.onMoveUp(a)}),a.hostIndex<this.getNumHostItems()-1&&g.create("div",{"class":"dijitInline downArrow"},h).addEventListener("click",function(e){e.stopPropagation();k.onMoveDown(a)}));h=g.create("div",{"class":"dijitInline",innerHTML:a.label},b);a.parent&&(h.style.paddingLeft="20px");this.wrapInCards&&(a.isArea&&!a.parent?n.add(b,"areaCard_only"):a.isGroup?n.add(b,"areaCard_groupTop"):a.isArea&&n.add(b,a.parent.children.indexOf(a)===a.parent.children.length-
1?"areaCard_groupBottom":"areaCard_groupMiddle"));this.selectPresentation(b,c,a);return b},isCompareAll:function(){return!1},getNumHostItems:function(){return 0},onAddMoreAreas:function(){},onRemoveAreas:function(a){},onVisibilityChanged:function(){},onMoveUp:function(a){},onMoveDown:function(a){},onCompareAreasSideBySide:function(){},onStopComparison:function(){},onClosePopup:function(){}});return r(y,{"class":"dijitInline esriGEOnDemandSelectNoBackground",listClass:"esriGEOnDemandSelectVeryTallList800 esriGEOnDemandSelectSpacedOut esriGEReportPlayerToolbar_areasSelectList",
player:null,canAddMoreAreas:!1,areasSelectButtons:null,comparisonSettingsBlock:null,comparisonSettings:null,_nls:null,buildRendering:function(){var a=this;this.inherited(arguments);this._nls=u.mixin({},q,this.player.nlsMap);this.itemRenderer=new C({nls:this._nls,onAddMoreAreas:function(){a.onAddMoreAreas();a.closePopup()},onRemoveAreas:function(c){var d=2>=a._getNumHostItems();a.onRemoveAreas(c,d);d&&a.closePopup()},isCompareAll:function(){return a.player.viewMode===m.PANELS_IN_STACK_ALL},getNumHostItems:function(){return a._getNumHostItems()},
onVisibilityChanged:function(){var c={};a.get("options").forEach(function(d){d.isArea&&(c[d.analysisArea.index]=d.selected)});a.refresh();a.player.getCurrentReportContainer().setAreasVisibilityState(c,{append:!0})},onMoveUp:function(c){},onMoveDown:function(c){},onCompareAreasSideBySide:function(){a.onCompareAreasSideBySide();a.closePopup()},onStopComparison:function(){var c=-1;a.get("options").some(function(d){if(d.analysisArea&&!d.analysisArea.hidden)return c=d.analysisArea.index,!0});a.onStopComparison(c);
a.closePopup()},onClosePopup:function(){a.closePopup()}})},_buildAdditionalPopupListProperties:function(){var a=this;return{selectionValidator:function(c){return a.player.viewMode!==m.PANELS_IN_STACK_ALL&&!!c&&!c.isSeparator&&!1!==c.enabled}}},buildAreaOptions:function(a){var c=A.groupAreas(a),d=1<c.groupInfos.length&&!c.isOnlyAreasInOnlyGroup;this.itemRenderer.wrapInCards=d;this.itemRenderer.canRemoveAreas=d&&!t.isMobileDevice();this.itemRenderer.canMoveAreas=!1;var f=[],k=0;c.groupInfos.forEach(function(b,
h){if(b.isRealGroup){var l={isGroup:!0,isHost:!0,hostIndex:k++,label:b.label,value:"group_"+h,enabled:!1,analysisAreas:b.areas,children:[]};f.push(l)}b.areas.forEach(function(e){e={isArea:!0,label:e.shortName||e.name||"",value:e.index,analysisArea:e,parent:l,isHost:!l};e.isHost&&(e.hostIndex=k++);f.push(e);l&&l.children.push(e)})});c={isSeparator:!0};f.push(c);this.player.viewMode!==m.PANELS_IN_SLIDES&&(!t.isMobileDevice()&&1<a.analysisAreas.filter(function(b){return!b.hidden}).length&&f.push({label:this._nls.compareAreasSideBySide,
value:"all"}),this.canAddMoreAreas&&f.push({label:this._nls.addMoreAreas,value:"addAreas"}));this.areasSelectButtons&&this.areasSelectButtons.forEach(function(b){b.isVisible&&!b.isVisible()||f.push({label:b.label,value:b.id,isAdditional:!0,buttonInfo:b})});f[f.length-1]===c&&f.pop();this._updateTreeSelection(f);this.set("options",f);this._updateComparisonSettings()},_getNumHostItems:function(){var a=0;this.get("options").some(function(c){c.isHost&&a++});return a},onPopupListPreBuild:function(){this._updateTreeSelection()},
_updateTreeSelection:function(a){if(this.player.viewMode===m.PANELS_IN_STACK_ALL){var c=this.player.getCurrentReportContainer().getAreasVisibilityState();a=a||this.get("options");a.forEach(function(d){if(d.isGroup||d.isArea)d.canSelect=!0,d.isGroup?(d.children.forEach(function(f){f.selected=c[f.analysisArea.index]}),d.selected=d.children.some(function(f){return f.selected})):d.selected=c[d.analysisArea.index]})}},_updateComparisonSettings:function(){var a=this;this.comparisonSettings&&this.comparisonSettings.destroy();
this.comparisonSettings=null;this.comparisonSettingsBlock&&g.destroy(this.comparisonSettingsBlock);this.comparisonSettingsBlock=null;this.player.viewMode===m.PANELS_IN_STACK_ALL&&(this.comparisonSettingsBlock=g.create("div",{"class":"dijitInline esriGEClickable"},this.domNode.parentNode),g.create("div",{"class":"dijitInline esriGESpaceBeforeBig esriGEIcon16 esriGEReportPlayerToolbar_comparisonSettingsIcon"},this.comparisonSettingsBlock),B.makePopup(function(){a.comparisonSettings||(a.comparisonSettings=
new z({player:a.player,onChange:function(){a.player.getCurrentReportContainer().setComparisonSettings(a.comparisonSettings.getSettings())}}));a.comparisonSettings.setSettings(a.player.getCurrentReportContainer().getComparisonSettings());return a.comparisonSettings},this,this.comparisonSettingsBlock))},onAddMoreAreas:function(){},onRemoveAreas:function(a,c){},onCompareAreasSideBySide:function(){},onStopComparison:function(a){},destroy:function(){this.comparisonSettings&&this.comparisonSettings.destroy();
this.inherited(arguments)}})});