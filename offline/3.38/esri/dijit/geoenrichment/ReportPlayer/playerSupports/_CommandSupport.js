// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/playerSupports/_CommandSupport","dojo/_base/declare dojo/_base/lang esri/dijit/geoenrichment/Deferred esri/dijit/geoenrichment/when esri/dijit/geoenrichment/ReportPlayer/PlayerCommands esri/dijit/geoenrichment/ReportPlayer/config esri/dijit/geoenrichment/utils/DeviceUtil".split(" "),function(r,q,n,k,l,t,u){return r(null,{_initCommands:function(){u.isMobileDevice()||!t.modules.exportCommands?this.playerToolbar.notifyCommandButtonsAdded():k(this.dataProvider.getCommands&&
this.dataProvider.getCommands(),function(a){this._createCommandButtons(a);this.playerToolbar&&this.playerToolbar.notifyCommandButtonsAdded()}.bind(this))},_lastNonPrintCommandId:null,_executeExportCallback:null,_executePrintCallback:null,_createCommandButtons:function(a){function b(e){var f=new n,g=new n;c.onCommandSettingsShown(f.promise);c._saveVisualState();k(c._getPrintableContainer({commandId:e,showDialog:!0}),function(p){if(p){var m=p.getSelectedCommandId();m&&m!==l.PRINT&&(c._lastNonPrintCommandId=
m);k(c._executeCommand(m,{printableContainer:p}),g.resolve,g.reject)}else k(c._applySavedVisualState(),function(){c.onCommandCanceled();g.resolve()})}).always(f.resolve);return g.promise}var c=this;if(a&&a.length){var d,h=a.filter(function(e){return e.id===l.PRINT?(d=e,!1):!0});h.length&&(this._executeExportCallback=function(){return b(c._lastNonPrintCommandId||h[0].id)},this._createCommandButton(h[0],this._executeExportCallback));d&&(this._executePrintCallback=function(){return b(d.id)},this._createCommandButton(d,
this._executePrintCallback))}},executeExport:function(){return this._executeExportCallback&&this._executeExportCallback()},executePrint:function(){return this._executePrintCallback&&this._executePrintCallback()},_createCommandButton:function(a,b){return this.playerToolbar&&this.playerToolbar.createCommandButton(a,b)},getCommandExportDialogSettings:function(){return this._getPrintDialogSettings()},executeCommand:function(a,b){b=b||{};this._saveVisualState();var c=this._viewModel.dynamicReportInfo.fieldData;
!this.isPlayerOnServer||a!==l.PDF&&a!==l.IMAGE||(b.exportSettings=q.mixin({},c.reportInfo&&c.reportInfo.exportSettings,b.exportSettings));var d=this;return k(this._getPrintableContainer({commandId:a,showDialog:!1,exportSettings:b.exportSettings}),function(h){return d._executeCommand(a,q.mixin({printableContainer:h},b))})},_executeCommand:function(a,b){function c(){k(d.dataProvider.executeCommand&&d.dataProvider.executeCommand(a,d,b,function(g){d.onCommandProgress(g)}),e.resolve,e.reject)}var d=this,
h=this._viewModel.dynamicReportInfo.fieldData;a!==l.PDF&&a!==l.DYNAMIC_HTML||!h.runReportTaskIDs||(b.creditsTaskIDs=h.runReportTaskIDs);var e=new n;this.isPlayerOnServer?c():setTimeout(c);var f=e.promise.then(function(g){return k(d._applySavedVisualState(),function(){return g})});this.onCommandStart(f,a);this._showWaiting(f,"executeCommand");f.always(function(){d.onCommandEnd(f)});return f},_visualStateMemo:null,_saveVisualState:function(){this._visualStateMemo=this.getVisualState()},_applySavedVisualState:function(){var a=
this;return this.setVisualState(this._visualStateMemo).then(function(){a._visualStateMemo=null})},onCommandSettingsShown:function(a){},onCommandCanceled:function(){},onCommandStart:function(a,b){},onCommandProgress:function(a){},onCommandEnd:function(a){}})});