// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/printing/_PrintSettingsSupport","require dojo/_base/declare dojo/_base/lang esri/dijit/geoenrichment/promise/all esri/dijit/geoenrichment/Deferred esri/dijit/geoenrichment/when esri/dijit/geoenrichment/utils/DelayUtil esri/dijit/geoenrichment/ReportPlayer/config esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/DocumentOptions ../PlayerCommands ../PlayerViewModes ./HeaderFooterSettingsBuilder ./PageSizeUtil".split(" "),function(p,q,l,r,m,k,t,u,
v,n,w,x,y){return q(null,{_checkPrintSettings:function(a){function d(f){f=l.mixin({},a.exportSettings);delete f.pageSettings;return l.mixin({commandId:a.commandId,noAutoScale:!b._checkNeedAutoScale(),pageSettings:l.mixin({},b.getCurrentReportContainer().documentOptions,a.exportSettings&&a.exportSettings.pageSettings),addHeader:!1,addDataSource:!1,addFooter:!1,reportTitle:void 0,reportSubtitle:void 0,allowDataDrilling:!0,allowFallbackMaps:!0,canSplitPages:!1,splitPages:!1},f)}function e(){var f=new m;
a.onShowWaiting(f.promise);k(b._getPrintDialogSettings(a.commandId),function(g){return b._loadDialogClass().then(function(h){h=new h;h.onPrint=function(z){k(b._applyPrintSettings(l.mixin(d(g),z)),c.resolve,c.reject)};h.onCancel=function(){c.resolve("cancel")};h.show(g)}).always(f.resolve)})}var b=this,c=new m;a.showDialog?e():k(b._applyPrintSettings(d()),c.resolve,c.reject);return c.promise},_loadDialogClass:function(){var a=new m,d=this._player.printConfig.printDialogClass;"string"===typeof d?p([d],
function(e){a.resolve(e)}):a.resolve(d);return a.promise},getPrintDialogSettings:function(){return this._getPrintDialogSettings()},_getPrintDialogSettings:function(a){var d=this;return k(this._player.dataProvider.getCommands(),function(e){var b={canAutoScale:d._checkNeedAutoScale(),pageSettings:{pagesize:d.getCurrentReportContainer().documentOptions.pagesize,orientation:d.getCurrentReportContainer().documentOptions.orientation},reportTitle:d._player.getReportTitle(),reportSubtitle:d._player.printConfig.subtitle,
supportedPageSizes:y.getSupportedPageSizes().map(function(c){return{label:c.label,id:c.value}}),canSplitPages:d._player.viewMode===w.PANELS_IN_STACK_ALL};a&&(b.commandId=a);b.exportCommands=a?a===n.PRINT?null:e.filter(function(c){return c.id!==n.PRINT}):e;b.exportCommands&&(b.exportCommands=b.exportCommands.map(function(c){return{label:c.label,id:c.id}}));return b})},_checkNeedAutoScale:function(){return this.getAllReportContainers().some(function(a){return a.hasHiddenContent()})},_applyPrintSettings:function(a){function d(){return r(e.getAllReportContainers().map(function(g){return g.resizePanelsToShowContent()})).then(function(){return u.isPlayerOnServer?
null:t.delay(500)})}var e=this;this._commandId=a.commandId||this._commandId;this._allowDataDrilling=a.allowDataDrilling;this._allowFallbackMaps=a.allowFallbackMaps;this._splitPages=a.splitPages;this._needAutoScale=this._checkNeedAutoScale();var b=a.commandId===n.DYNAMIC_HTML||this._needAutoScale&&a.noAutoScale,c;b||(c=l.clone(this._player.getReportData().templateJson));var f=this._player._showAllContainers();this._pageSettingsRollBackFunc=function(){f&&f.undo();f=null;if(!b)return e._player.getReportData().templateJson=
c,e._player.refresh()};return k(!b&&d(),function(){e._pageSettings=a.pageSettings;var g=v.getPageBox(a.pageSettings);e._pageFitParams={w:g.w,h:g.h,hAlign:"center",vAlign:"top"};return k(x.createHeaderFooterParams(e._player,e._viewModel,a),function(h){e._headerFooterParams=h})})}})});