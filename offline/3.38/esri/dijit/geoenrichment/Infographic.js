// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/Infographic","require module esri/declare dojo/_base/lang dojo/_base/array dojo/dom-class dojo/dom-construct dojo/on esri/dijit/geoenrichment/Deferred esri/tasks/geoenrichment/GeoenrichmentTask esri/tasks/geoenrichment/RingBuffer ../_EventedWidget ./Geoenrichment ./config ./_Invoke ./infographicUtils/DataProvider ./infographicUtils/utils".split(" "),function(h,q,m,c,r,k,t,u,n,v,w,x,y,f,z,A,B){function C(a,b){var d=new n,p=new v(f.server);p.token=f.token;var l=b[0].split(".");
p.getDataCollections(null,l[0]).then(function(e){if("OneVar"===a)if("*"===l[1])d.resolve(e[0].variables[0].alias);else{e=e[0].variables;for(var g=0;g<e.length;g++)if(e[g].id==l[1]){d.resolve(e[g].alias);return}d.reject(Error("Variable was not found within the data collection: "+e[0]))}else d.resolve(e[0].metadata.title)},function(e){d.reject(e)});return d.promise}var D=m(A,{_data:null,constructor:function(a,b){this._data=a;c.mixin(this.metadata,b)},getData:function(){return this._data}});return m("esri.dijit.geoenrichment.Infographic",
[x,z],{countryID:null,levels:f.levels,highestLevel:f.highestLevel,title:null,subtitle:"\x3cdiv\x3e${address}\x3c/div\x3e\x3cdiv\x3e${name}\x3c/div\x3e",type:null,variables:null,studyArea:null,studyAreaOptions:null,outSR:null,expanded:!0,returnGeometry:!1,dataProvider:null,autoTitle:!0,_data:null,_ge:null,_widget:null,_autoTitle:null,_autoTitlePromise:null,_eventHandlers:null,_eventMap:{resize:["size"],"data-request":!0,"data-ready":["provider"],"data-load":!0,"data-error":["error"]},_createWidgetDfd:null,
constructor:function(){this.studyAreaOptions=new w;this._createWidgetDfd=new n},postMixInProperties:function(){this.type&&(this.invoke("_updateAutoTitle"),this._updateReport())},buildRendering:function(){this.inherited(arguments);this.domNode=t.create("div");this.expanded||k.add(this.domNode,"Collapsed")},setGeoenrichment:function(a){this._provideGeoenrichment(a)},_provideGeoenrichment:function(a){if(!this._ge||a)a=a||new y,this._removeEventHandlers(),this.dataProvider=this._ge=a,this._eventHandlers=
[a.on("start",c.hitch(this,this._onDataRequest)),a.on("data",c.hitch(this,this._onDataReady)),a.on("end",c.hitch(this,this._onDataLoad)),a.on("error",c.hitch(this,this._onDataError))]},_removeEventHandlers:function(){this._eventHandlers&&r.forEach(this._eventHandlers,function(a){a.remove()})},_setReturnGeometryAttr:function(a){this._provideGeoenrichment();this._set("returnGeometry",a);this._ge.returnGeometry=a},_setTitleAttr:function(a){this._set("title",a);this._widget&&(this._widget.title=a)},_setSubtitleAttr:function(a){this._provideGeoenrichment();
this._set("subtitle",a);this._ge.setReturnAddress&&this._ge.setReturnAddress(/\$\{address\}/.test(a));this._widget&&(this._widget.subtitle=a)},_setTypeAttr:function(a){this._set("type",a);this._widget&&(this._widget.setDataProvider(null),this._destroyReportWidget());this.invoke("_updateAutoTitle");this._updateReport()},_setCountryIDAttr:function(a){this._provideGeoenrichment();this._set("countryID",a);this._ge.country=a},_setVariablesAttr:function(a){var b=!0;if(c.isArray(a))for(var d=0;d<a.length;d++){if(0>=
a[d].indexOf(".")){b=!1;break}}else null!=a&&(b=!1);if(!b)throw Error("Invalid value for variables");this._provideGeoenrichment();this._set("variables",a);this._ge.setVariables(a);this.invoke("_updateAutoTitle")},_setStudyAreaAttr:function(a){this._provideGeoenrichment();this._set("studyArea",a);this._ge.setStudyArea(a)},_setOutSRAttr:function(a){this._set("outSR",a);this._ge.outSR=a},_setStudyAreaOptionsAttr:function(a){this._provideGeoenrichment();this._set("studyAreaOptions",a);this._ge.setBuffer&&
this._ge.setBuffer(a)},_setExpandedAttr:function(a){this.expanded!=a&&(this._destroyReportWidget(),this._set("expanded",a),a?k.remove(this.domNode,"Collapsed"):k.add(this.domNode,"Collapsed"),this._updateReport())},_setCacheLimitAttr:function(a){this._provideGeoenrichment();this._ge.setCacheLimit&&this._ge.setCacheLimit(a)},setData:function(a,b){this.set("dataProvider",new D(a,b))},_setDataProviderAttr:function(a){this.dataProvider!==a&&(this._set("dataProvider",a),this._ge&&(this._ge.stop(),this._ge=
null),this._widget&&this._widget.setDataProvider(a))},_updateReport:function(){this._updateLevels();this.invoke("_requireReport")},_updateLevels:function(){this._provideGeoenrichment();B.supportsComparison(this.type,this.expanded)?this._ge.setGeoLevels(this.levels,this.highestLevel):this._ge.setGeoLevels(null,null)},_requireReport:function(){this.type&&h([this._getAbsMid("./infographicPanels/"+this.type)],c.hitch(this,this._createReportWidget,this.type))},_getAbsMid:function(a){return h.toAbsMid?
h.toAbsMid(a):q.id.replace(/\/[^\/]*$/ig,"/")+a},getRenderPromise:function(){return this._createWidgetDfd&&this._createWidgetDfd.promise},_createReportWidget:function(a,b){if(!this._destroyed&&this.type==a)if(this._ge&&this._ge.isBusy())u.once(this._ge,"end",c.hitch(this,this._createReportWidget,this.type,b));else this._autoTitlePromise?this._autoTitlePromise.then(c.hitch(this,this._createReportWidget,this.type,b)):this.type&&(a=this._widget=new b(this.domNode),a.title="string"==typeof this.title?
this.title:this._autoTitle,a.subtitle=this.subtitle,a.expanded=this.expanded,a.on("resize",c.hitch(this,this._onResize)),isNaN(this._lastSelectedComparison)||a.setState({selectedComparison:this._lastSelectedComparison}),a.setDataProvider(this.dataProvider),this._createWidgetDfd&&this._createWidgetDfd.resolve(),this._createWidgetDfd=null)},_updateAutoTitle:function(){if("string"!=typeof this.title&&this.autoTitle&&this.type&&this.variables){var a=this;this._autoTitlePromise=C(this.type,this.variables);
this._autoTitlePromise.then(function(b){a._autoTitle=b},function(b){a._onDataError(b)});this._autoTitlePromise.otherwise(function(b){console.error(b)})["finally"](function(){a._autoTitlePromise=null})}},resize:function(){this._widget&&this._widget.resize()},_onResize:function(a){this.onResize(a)},onResize:function(a){},_onDataRequest:function(){this.onDataRequest()},onDataRequest:function(){},_onDataReady:function(){this.onDataReady(this._ge)},onDataReady:function(a){},_onDataLoad:function(){this.onDataLoad()},
onDataLoad:function(){},_onDataError:function(a){this.onDataError(a)},onDataError:function(a){},destroy:function(){this._destroyReportWidget();this._ge&&this._ge.stop();this._removeEventHandlers();this.inherited(arguments)},_destroyReportWidget:function(){this._widget&&(this._lastSelectedComparison=this._widget.getState("selectedComparison"),this._widget.destroy(),this._widget=null)}})});