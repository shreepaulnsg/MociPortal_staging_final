// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/DataBrowser/_GeoenrichmentVariables","dojo/_base/declare dojo/_base/lang dojo/_base/array esri/dijit/geoenrichment/promise/all ../../../tasks/geoenrichment/GeoenrichmentTask ../config dojo/i18n!../../../nls/jsapi ./DeferredStore".split(" "),function(l,f,e,m,n,h,g,p){g=g.geoenrichment.dijit.VariableStore;return l(null,{globalCountryID:"_",countries:null,variableFields:null,_currentCountryID:null,_getCountriesPromise:null,_resolveCountryIDPromise:null,constructor:function(){this.countries=
new p({idProperty:"value",resolver:f.hitch(this,this._getCountries)});this.countries.syncQuery=function(a,b){a=a&&a.allowHierarchies?{}:function(d){return 3>d.value.length};return this.queryEngine(a,b)(this.data)};this.categories.resolver=this.dataCollections.resolver=f.hitch(this,this._resolveCountryID)},synchronize:function(a){return void 0===a?this._resolveCountryIDPromise:this._resolveCountryID({countryID:a})},getCurrentCountryID:function(){return this._currentCountryID},_getCountries:function(a){if(!this._getCountriesPromise){var b=
this;this._getCountriesPromise=this._getGeoenrichmentTask().getAvailableCountries().then(function(d){var c=[{value:b.globalCountryID,label:g.global}];e.forEach(d,f.hitch(b,b._collectCountryValues,c));b.countries.setData(c)})}return this._getCountriesPromise},_collectCountryValues:function(a,b){a.push({value:b.id,label:b.name});var d=b.hierarchies;!d||2>d.length||(b.defaultDatasetID.toUpperCase(),e.some(d,function(c){e.some(c.datasets,function(k){return k.toUpperCase()==k})&&(c.isDefault=!0);return c.isDefault}),
e.forEach(d,function(c){a.push({value:b.id+"/"+c.ID,label:b.name+" ("+c.ID+")",countryID:b.id,countryName:b.name,hierarchyID:c.ID,isDefault:c.isDefault})}))},_resolveCountryID:function(a){a=a||{};if("object"==typeof a){a=a.countryID||this.globalCountryID;if(a!=this._currentCountryID){this._currentCountryID=a;var b=this;this._clearAllStores();this._resolveCountryIDPromise=this._getDataCollections(a==this.globalCountryID?null:a).then(function(d){b._processDataCollections(d)});this.favorites&&this.favorites.synchronize&&
(this._resolveCountryIDPromise=m([this._resolveCountryIDPromise,this.favorites.synchronize(a)]))}return this._resolveCountryIDPromise}},_getDataCollections:function(a){return this._getGeoenrichmentTask().getDataCollections(a,null,this.variableFields||"*")},_getGeoenrichmentTask:function(){var a=new n(h.server+"?langCode\x3d"+this.langCode);a.token=h.token;return a}})});