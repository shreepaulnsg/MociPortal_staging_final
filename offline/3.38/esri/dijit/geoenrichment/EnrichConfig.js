// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/EnrichConfig","esri/declare dojo/_base/lang dojo/dom-class esri/tasks/geoenrichment/EnrichParameters esri/tasks/geoenrichment/RingBuffer ./_Wizard ./EnrichOptionsPage ./DataBrowser dojo/i18n!esri/nls/jsapi".split(" "),function(m,f,n,p,q,r,t,u,h){return m("esri.dijit.geoenrichment.EnrichConfig",[r],{enrichParams:null,geomType:null,fields:null,fieldsMap:null,allowNewColumns:!0,allowFieldTypeMismatch:!1,studyAreaCount:null,showBackButton:!0,title:h.geoenrichment.dijit.EnrichConfig.title,
_nextButton:null,_dataCollections:null,_eventMap:{back:!0,finish:["params","fieldsMap","dataCollections"]},selectedIDs:null,constructor:function(){this.selectedIDs=[]},startup:function(){this.inherited(arguments);this.enrichParams||(this.enrichParams=new p);this.enrichParams.studyAreaOptions=new q;n.add(this.domNode,"EnrichConfig");var b=this.pages.d=new u({countryID:this.enrichParams.countryID,countryBox:!0,multiSelect:!0,okButton:h.geoenrichment.dijit.WizardButtons.next,title:this.title});b.on("back,cancel",
f.hitch(this,this._onBack));b.on("ok",f.hitch(this,this._applyVariables));this._loadDataBrowser()},_onDataCollectionSelect:function(){var b=!1,c=this.pages.d.get("selection"),a;for(a in c)if(c[a]){b=!0;break}this._nextButton.disabled=!b},_loadDataBrowser:function(){this.pages.d.set("selection",this.selectedIDs);this.loadPage("d")},_applyVariables:function(){this._dataCollections=this.pages.d.variables.dataCollections.data;this.pages.o||(this.pages.o=new t({buffer:this.enrichParams.studyAreaOptions,
geomType:this.geomType,fields:this.fields,allowNewColumns:this.allowNewColumns,allowFieldTypeMismatch:this.allowFieldTypeMismatch,studyAreaCount:this.studyAreaCount,onBack:f.hitch(this,function(){this.fieldsMap=this.pages.o.get("fieldsMap");this._loadDataBrowser()}),onFinish:f.hitch(this,this._finish)}));this.pages.o.set("dataCollections",this._dataCollections);for(var b=this.fieldsMap||{},c={},a=this.selectedIDs=this.pages.d.get("selection"),e=0;e<a.length;e++){var d=a[e];c[d]=b[d]||""}this.fieldsMap=
c;this.pages.o.set("fieldsMap",c);this.loadPage("o")},_onBack:function(){this.onBack()},onBack:function(){},_finish:function(){this.enrichParams.countryID=this.pages.d.get("countryID");this.enrichParams.studyAreaOptions=this.pages.o.get("buffer");var b=this.fieldsMap=this.pages.o.get("fieldsMap"),c=[];this.enrichParams.variables=[];for(var a,e=0;e<this._dataCollections.length;e++){var d=this._dataCollections[e],k=!0,g=[];for(a=0;a<d.variables.length;a++){var l=d.id+"."+d.variables[a].id;f.isString(b[l])?
g.push(l):k=!1}if(k)this.enrichParams.variables.push(d.id+".*"),c.push(d);else if(0<g.length){for(a=0;a<g.length;a++)this.enrichParams.variables.push(g[a]);c.push(d)}}this.onFinish(this.enrichParams,b,c)},onFinish:function(b,c,a){}})});