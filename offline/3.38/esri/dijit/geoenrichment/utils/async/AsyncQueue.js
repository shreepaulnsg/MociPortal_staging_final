// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/async/AsyncQueue","dojo/_base/declare dojo/_base/lang esri/dijit/geoenrichment/Deferred esri/dijit/geoenrichment/when dijit/Destroyable ../DelayUtil".split(" "),function(p,q,m,g,r,n){var l=p(r,{_lastPromise:null,_isFinished:!1,_isDestroyed:!1,_lastDfd:null,_lastResult:null,constructor:function(b){q.mixin(this,b)},add:function(b,c){c=c||{};var a=this;if(!this._isDestroyed){this._lastDfd||(this.onStarted(),this._lastDfd=new m);this._isFinished=!1;var f=function(){var d=
function(){if(!a._isDestroyed)try{return"function"===typeof b?b():b}catch(h){return(new m).reject(h)}},k=0<=c.delayBefore?function(){return n.delay(d,c.delayBefore)}:d;return(0<=c.delayAfter?function(){return g(k(),function(h){return n.delay(function(){return h},c.delayAfter)})}:k)()};!this._lastPromise||this._lastPromise.isFulfilled()?this._lastPromise=g(f()):this._lastPromise=g(this._lastPromise).then(f);var e=this._lastPromise;g(e,function(d){e!==a._lastPromise||a._isDestroyed||a._isFinished||
e&&!e.isFulfilled()||(a._isFinished=!0,a._lastDfd.resolve(d),a._lastResult=d,a._lastDfd=null,a.onFinished(d))},this._lastDfd.reject);return this.getPromise()}},getPromise:function(){return this._isDestroyed?null:this._lastDfd&&this._lastDfd.promise||this._lastResult},isFinished:function(){return this._isFinished},isDestroyed:function(){return this._isDestroyed},destroy:function(){this._isDestroyed=!0},onStarted:function(){},onFinished:function(b){}});l.executeFunctions=function(b,c,a){a=a||{};var f=
new l,e=[];b.forEach(function(d,k){f.add(function(){return g(d(),function(h){e.push(h);return h})},{delayBefore:0===k?void 0:c})});a.onQueueReady&&a.onQueueReady(f);return g(f.getPromise(),function(d){return a.collectResults?e:d})};l.processArrayInBatches=function(b,c){function a(){if(b.length){for(var e=[],d=0;d<c.batchSize&&b.length;d++)e.push(b.shift());c.processBatch?c.callback(e):e.forEach(c.callback);setTimeout(a,c.timeout||0)}else f.resolve()}b=b.slice();var f=new m;a();return f.promise};return l});