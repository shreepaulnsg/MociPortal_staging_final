// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/ImageUtil",["esri/dijit/geoenrichment/Deferred","esri/dijit/geoenrichment/when","./UrlUtil"],function(n,p,q){var f={base64DataToDataURL:function(a,b){if(/^data:image/.test(a))return a;b||(b=atob(a.substr(0,16)),b=f.getImageContentType(b));return"data:"+(b||"image/png")+";base64,"+a},getImageContentType:function(a){if("\u00ff\u00d8\u00ff"===a.substr(0,3)&&"JFIF"===a.substr(6,4))return"image/jpeg";if("\u0089PNG\r\n\u001a\n"===a.substr(0,8))return"image/png";if("GIF89a"===
a.substr(0,6)||"GIF87a"===a.substr(0,6))return"image/gif"},base64DataFromDataURL:function(a){0==a.indexOf("data:")&&(a=a.substr(a.indexOf(",")+1));return a},getBase64DataIndex:function(a){a=0==a.indexOf("data:")?a.indexOf(";base64,"):-1;return 0<a?a+8:0},getContentType:function(a){var b=f.getBase64DataIndex(a);return b?a.substring(5,b-8):null},checkBase64FileSize:function(a,b){return f.getBase64FileSize(a)<=b},getBase64FileSize:function(a){return.75*a.length},imageToDataURL:function(a,b){b=b||{};
var c=document.createElement("canvas"),d=c.getContext("2d");c.width=b.width||a.width;c.height=b.height||a.height;var e=b.opacity;null!=e&&!isNaN(e)&&0<=e&&1>e&&(d.globalAlpha=+e,b.format="image/png");(e=b.pos)?d.drawImage(a,e.x||0,e.y||0):d.drawImage(a,0,0,c.width,c.height);return c.toDataURL(b.format)},imageFromUrl:function(a,b){var c=new n,d=new Image;0!==a.indexOf("data:")&&b&&b.crossOrigin&&d.setAttribute("crossOrigin",b.crossOrigin);d.onload=function(){if(d.width&&d.height)c.resolve(d);else{var e=
Error("Error of reading an image from URL.");b&&b.ignoreError?c.resolve(null):c.reject(e)}d.onload=d.onerror=null};d.onerror=function(e){b&&b.ignoreError?c.resolve(null):c.reject(e);d.onload=d.onerror=null};a=require.toUrl(a);/^http:/i.test(a)&&/^https/i.test(window.location.protocol)&&(a=q.toHttpsUrl(a));d.src=a;return c.promise},scaleImage:function(a,b){if("string"===typeof a){var c=f.base64DataToDataURL(a),d=f.getContentType(c);c=f.imageFromUrl(c)}return p(c||a).then(function(e){var g=1,h=e.width,
k=e.height;if(b.factor)g=b.factor;else if(b.maxDim)g=b.maxDim/Math.max(h,k);else if(b.imageDim){var l=b.imageDim.w,m=b.imageDim.h;b.imageDim.preserveRatio?(g=Math.min(l/h,m/k),b.imageDim.reduceOnly&&1<g&&(g=1)):b.imageDim.reduceOnly?(h=Math.min(h,l),k=Math.min(k,m)):(h=l,k=m)}return f.imageToDataURL(e,{width:h*g,height:k*g,format:b.format||d,opacity:b.opacity})})},getImageViewType:function(a,b){return 1E3<=b?(a/=b,.025>=Math.abs(a-2)?"360":2<a?"pano":null):null}};return f});