// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/FileUtil",["esri/dijit/geoenrichment/Deferred","esri/dijit/geoenrichment/when","./DataUtil","./ImageUtil"],function(f,n,m,p){function l(){return new f.reject(Error("Saving not supported."))}var g=l,q=/[\\/:*?"<>|]/g,c={savingSupported:function(){return void 0!==window.Blob},saveTextFile:function(a,d,b,e){return c.savingSupported()?c.saveAs(new Blob([a],{type:b||"text/plain"}),d||"text.txt",e):l()},saveImageFile:function(a,d){if(c.savingSupported()){if("string"===
typeof a){var b=p.base64DataFromDataURL(a);b=m.binaryStringToByteArray(atob(b)).buffer}else a instanceof ArrayBuffer&&(b=a);return c.saveAs(b?m.arrayBuffersToBlob([b],"image/png"):a,d)}l()},_queue:[],_isSavePendingFlag:!1,_saveTimeoutH:null,saveAs:function(a,d,b){return b&&b.addDownloadIntervals?(b=new f,c._queue.push({blob:a,name:d||"download",dfd:b}),c._trySaveAsNext(),b.promise):g(a,c.validateName(d||"download"))},_trySaveAsNext:function(){if(c._queue.length&&!c._isSavePendingFlag){var a=c._queue.shift();
c._isSavePendingFlag=!0;n(g(a.blob,c.validateName(a.name))).then(a.dfd.resolve,a.dfd.reject).always(function(){setTimeout(function(){c._isSavePendingFlag=!1;c._trySaveAsNext()},100)})}},validateName:function(a){return String(a).trim().replace(q,"")}};if(!c.savingSupported())return c;if(window.navigator&&window.navigator.msSaveOrOpenBlob)return g=function(a,d){var b=new f;window.navigator.msSaveOrOpenBlob(a,d)?b.resolve():b.reject(Error("Failed to save or open downloaded file."));return b.promise},
c;var h=window.URL||window.webkitURL;if("download"in window.document.createElement("a")){var r=function(a){if(void 0!==window.MouseEvent)var d=new MouseEvent("click",{bubbles:!0,cancelable:!1});else d=document.createEvent("MouseEvent"),d.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null);a.dispatchEvent(d)};g=function(a,d){var b=new f,e=h.createObjectURL(a),k=window.document.createElement("a");k.href=e;k.download=d;r(k);setTimeout(function(){h.revokeObjectURL(e);k=null;b.resolve();
b=null},1E3);return b.promise};return c}g=function(a,d){var b=new f;a=new File([a],d,{type:a.type});var e=h.createObjectURL(a);window.open(e,"_blank");setTimeout(function(){h.revokeObjectURL(e);b.resolve()},1E3);return b.promise};return c});