// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/TooltipUtil","dojo/_base/declare dojo/_base/lang dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/on dojo/mouse dojo/sniff dijit/Tooltip dijit/place dojox/gfx ./DeviceUtil ./DnDUtil ./DomUtil ./MouseUtil esri/dijit/geoenrichment/ReportPlayer/config dojo/domReady!".split(" "),function(J,K,x,p,q,L,m,z,C,D,M,N,A,O,u,y,B){function E(){}var k={},P=J(D._MasterTooltip,{_customClasses:null,_customStyle:null,_orientKey:null,addCustomClasses:function(a){a&&
(x.add(this.domNode,a),this._customClasses=a)},setCustomStyle:function(a){this._customStyle=a},show:function(a,d,c,e,b,h,f){if(!this.aroundNode||this.aroundNode!==d||this.containerNode.innerHTML!=a)if("playing"==this.fadeOut.status())this._onDeck=arguments;else{"string"===typeof a?this.containerNode.innerHTML=a:(this.containerNode.innerHTML="",p.place(a.domNode||a,this.containerNode));b&&this.set("textDir",b);this.containerNode.align=e?"right":"left";var g=M.around(this.domNode,d,c&&c.length?c:D.defaultPosition,
!e,K.hitch(this,"orient")),l=g.aroundNodePos;"M"==g.corner.charAt(0)&&"M"==g.aroundCorner.charAt(0)?(this.connectorNode.style.top=l.y+(l.h-this.connectorNode.offsetHeight>>1)-g.y+"px",this.connectorNode.style.left=""):"M"==g.corner.charAt(1)&&"M"==g.aroundCorner.charAt(1)?this.connectorNode.style.left=l.x+(l.w-this.connectorNode.offsetWidth>>1)-g.x+"px":(this.connectorNode.style.left="",this.connectorNode.style.top="");this._drawBackground();this.domNode.style.opacity="0";this.fadeIn.play();this.isShowingNow=
!0;this.aroundNode=d;this.onMouseEnter=h||E;this.onMouseLeave=f||E}},orient:function(a,d,c,e,b){this.connectorNode.style.top="";var h=e.h;e=e.w;a.className="dijitTooltip "+{"MR-ML":"dijitTooltipRight","ML-MR":"dijitTooltipLeft","TM-BM":"dijitTooltipAbove","BM-TM":"dijitTooltipBelow","BL-TL":"dijitTooltipBelow dijitTooltipABLeft","TL-BL":"dijitTooltipAbove dijitTooltipABLeft","BR-TR":"dijitTooltipBelow dijitTooltipABRight","TR-BR":"dijitTooltipAbove dijitTooltipABRight","BR-BL":"dijitTooltipRight",
"BL-BR":"dijitTooltipLeft"}[this._orientKey=d+"-"+c];this.addCustomClasses(this._customClasses);this.domNode.style.width="auto";var f=q.position(this.domNode);f.w=Math.ceil(f.w);if(C("ie")||C("trident"))f.w+=2;q.setMarginBox(this.domNode,{w:Math.min(Math.max(e,1),f.w)});"B"==c.charAt(0)&&"B"==d.charAt(0)?(a=q.position(a),d=this.connectorNode.offsetHeight,a.h>h?(this.connectorNode.style.top=h-(b.h+d>>1)+"px",this.connectorNode.style.bottom=""):(this.connectorNode.style.bottom=Math.min(Math.max(b.h/
2-d/2,0),a.h-d)+"px",this.connectorNode.style.top="")):(this.connectorNode.style.top="",this.connectorNode.style.bottom="");this._drawBackground();return Math.max(0,f.w-e)},_surface:null,_surfaceContainer:null,_drawBackground:function(){if(this._orientKey){var a=this.domNode.clientWidth,d=this.domNode.clientHeight,c=q.position(this.domNode),e=q.position(this.connectorNode),b=q.position(this.containerNode);e.x-=c.x;e.y-=c.y;b.x-=c.x;b.y-=c.y;b.x+=1;b.y+=1;b.w-=2;b.h-=2;this._surface&&this._surface.destroy();
this._surfaceContainer&&p.destroy(this._surfaceContainer);c=this._surfaceContainer=p.create("div",{"class":"esriGEAbsoluteStretched"},this.domNode,"first");c.style.pointerEvents="none";a=this._surface=N.createSurface(c,a,d);d=[{x:b.x,y:b.y},{x:b.x+b.w,y:b.y},{x:b.x+b.w,y:b.y+b.h},{x:b.x,y:b.y+b.h},{x:b.x,y:b.y}];c=e.x+e.w/2;e=e.y+e.h/2;switch(this._orientKey){case "BL-TL":case "BM-TM":case "BR-TR":b=[{x:c-5,y:b.y},{x:c,y:e},{x:c+5,y:b.y}];d.splice.apply(d,[1,0].concat(b));break;case "ML-MR":case "BL-BR":b=
[{x:b.x+b.w,y:e-5},{x:c,y:e},{x:b.x+b.w,y:e+5}];d.splice.apply(d,[2,0].concat(b));break;case "TM-BM":case "TL-BL":case "TR-BR":b=[{x:c+5,y:b.y+b.h},{x:c,y:e},{x:c-5,y:b.y+b.h}];d.splice.apply(d,[3,0].concat(b));break;case "MR-ML":case "BR-BL":b=[{x:b.x,y:e+5},{x:c,y:e},{x:b.x,y:e-5}],d.splice.apply(d,[4,0].concat(b))}b=a.createPolyline(d);e="function"===typeof this._customStyle?this._customStyle():this._customStyle;b.setFill(e&&e.backgroundColor||"white").setStroke({color:"#d3d3d3",width:1,join:"round"});
e&&e.color&&(this.containerNode.style.color=e.color)}}}),F={show:function(a,d,c,e,b){"string"===typeof c&&(c=[c]);c=c&&c.map(function(f){return{after:"after-centered",before:"before-centered"}[f]||f});var h=new P;b&&h.setCustomStyle(b);h.addCustomClasses(e);h.show(a,d,c);return h}};k.setTooltipToNode=function(a,d,c){function e(){!b&&k.showTooltipForNode(a,d,c)}c=c||{};if(a&&!B.isPlayerOnServer&&(k.hideTooltipForNode(a),a.__setTooltipToNodeMouseEnterHandle&&a.__setTooltipToNodeMouseEnterHandle.remove(),
d)){var b=!1;A.isMobileDevice()?a.__setTooltipToNodeMouseEnterHandle=O.addNoDragClickHandler(a,e):a.__setTooltipToNodeMouseEnterHandle=m(a,z.enter,e);c.showTooltip&&e();return{remove:function(){d=null;k.hideTooltipForNode(a)},suspend:function(){k.hideTooltipForNode(a);b=!0},resume:function(){b=!1},refresh:function(){a._shownTooltip&&e()}}}};k.showTooltipForNode=function(a,d,c){function e(){k.hideTooltipForNode(a);var g=Array.isArray(c.classes)?c.classes.join(" "):c.classes;g=(g||"")+" esriGETooltip";
c.notRestricted&&(g+=" notRestricted");a._shownTooltip=h=F.show(b,a,c.position||["after","before"],g,c.style)}c=c||{};if(a&&!B.isPlayerOnServer){a.title="";k.hideTooltipForNode(a);var b="function"==typeof d?d():d;if(b){"string"===typeof b&&c.textAlign&&(b="\x3cdiv class\x3d'"+("start"===c.textAlign?"esriGEStart":"end"===c.textAlign?"esriGEEnd":"")+"'\x3e"+b+"\x3c/div\x3e");x.add(a,"esriGESimpleTextTooltip");var h;e();var f=k.hideTooltipForNode.bind(k,a);d=function(g,l){var r=setInterval(g,l);h.own({remove:function(){clearInterval(r)}})};
A.isMobileDevice()?h.own(m(document.body,"touchstart",function(g){!y.isMouseOver(a,{event:g})&&f()})):h.own(m.once(a,z.leave,function(){!c.stayOnHover&&f()}));c.ignoreNodeRemoval||d(function(){!u.isNodeInLayout(a)&&f()},300);A.isMobileDevice()||(d(function(){c.stayOnHover&&y.isMouseOver(h.domNode)||y.isMouseOver(a)||f()},300),h.own(m(a,"click",function(g){c.hideOnClick?f():!a._shownTooltip&&e()})),c.stayOnHover&&h.own(m(h.domNode,z.leave,f)));return a._shownTooltip}}};k.hideTooltipForNode=function(a){a&&
a._shownTooltip&&(x.remove(a,"esriGESimpleTextTooltip"),a._shownTooltip.destroy(),delete a._shownTooltip)};var t,v;k.autoTooltip=function(a){B.isPlayerOnServer||m(a,".TrimWithEllipses:mouseover",function(){if(this!==t&&this.offsetWidth<this.scrollWidth){var d=function(){t=null;v&&(v.tooltip.destroy(),v.mouseOutH.remove(),v.mouseMoveH.remove(),v=null)};d();t=this;v={tooltip:F.show(t.textContent,t,["above","below"]),mouseOutH:m.once(t,"mouseout, mousedown, touchstart",d),mouseMoveH:m(document.body,
"mousemove",function(){y.isMouseOver(t)||d()})}}})};k.showClosableTooltip=function(a){var d="rtl"===document.dir&&"after"!==a.position||"rtl"!==document.dir&&"after"===a.position,c=Q(a.message,a.tooltipClass,a.position,d);return R(c,a.node,a.timeout,d,a.onClosed)};k.removeClosableTooltip=function(a){a&&a._removeFunc&&a._removeFunc()};var Q=function(a,d,c,e){function b(){var r=p.create("div",{"class":"esriGEClosableTooltipTip"},f);x.add(r,e?"esriGEClosableTooltipTipRight":"esriGEClosableTooltipTipLeft")}
function h(){g=p.create("div",{"class":"esriGEClosableTooltipBody"},f);p.create("div",{innerHTML:a,"class":"esriGEClosableTooltipLabel"},g);l=p.create("div",{"class":"esriGEClosableTooltipCloseButton"},g)}var f=p.create("div",{"class":"esriGEClosableTooltip esriGENonSelectable"+(d?" "+d:"")},document.body),g,l;"after"!==c?(h(),b()):(b(),h());f.style.position="fixed";return{tooltip:f,body:g,closeButton:l}},R=function(a,d,c,e,b){function h(){var n=q.position(d),w=n.x+";"+n.y+";"+n.w+";"+n.h;w!==f&&
(f=w,w=q.getMarginBox(a.tooltip),L.set(a.tooltip,{left:(e?n.x+n.w:n.x-w.w)+"px",top:n.y+n.h/2-w.h/2+"px"}))}var f;h();var g,l,r=function(){g&&clearTimeout(g);G&&clearInterval(G);H&&clearInterval(H);I&&I.remove();a.tooltip.parentNode&&a.tooltip.parentNode.removeChild(a.tooltip)};var G=setInterval(function(){u.isNodeInLayout(d)&&d.parentNode||(l=!1,r());u.isNodeVisible(d)&&u.isNodeOnscreen(d)?(l=!0,u.show(a.tooltip)):(l=!1,u.hide(a.tooltip))},0);var H=setInterval(function(){l&&h()},0);c&&(g=setTimeout(r,
c));var I=m(a.closeButton,"click",function(){r();b&&b()});a.tooltip._removeFunc=r;return a.tooltip};k.showTooltipForNode(document.body,"Normal \x3cb\x3eBold\x3c/b\x3e \x3ci\x3eItalic\x3c/i\x3e",{});k.hideTooltipForNode(document.body);return k});