// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/GeometryUtil","dojo/_base/lang esri/dijit/geoenrichment/Deferred esri/geometry/Polygon esri/workers/WorkerClient ./PolygonUtil ./GeometryUtil_base".split(" "),function(q,r,t,u,v,w){function x(b,a,d){var k=new r,f=new u("./mutableWorker",function(){f.importScripts(["../dijit/geoenrichment/utils/GeometryUtil_worker","../dijit/geoenrichment/utils/GeometryUtil_base"]).then(function(){f.postMessage({rings:b,maxAllowableOffset:d}).then(function(l){var c=l.rings;a.forEach(function(e){for(var h=
e.source.length=0;h<e.count;h++)e.source.push(c.shift())});k.resolve();f.terminate()})})},!0);return k.promise}var m=q.mixin({},w);m.calculateMaxAllowableOffset=function(b,a,d){"number"!==typeof a&&(a=1);a*=b.extent.getWidth()/b.width;d&&(a*=Math.min(d.getWidth()/b.extent.getWidth(),d.getHeight()/b.extent.getHeight()));return a};m.getNumberOfPoints=v.getNumberOfPoints;m.needGeneralizeGeometry=function(b,a,d,k){if(!b||!a)return!1;k=k||(d?d/10:500);d=d||5E3;Array.isArray(b)||(b=[b]);var f=0>a,l=0,c=
Math.abs(a)/100,e=0,h=0,p;b.forEach(function(g){g=g.geometry||g;if(!g.rings||!g.getExtent)return!1;var n=g.getExtent();if(n=n.getWidth()*n.getHeight())n=Math.sqrt(n),g=m.getNumberOfPoints(g),e+=g,h=Math.max(h,g),f&&(l=Math.max(l,n*c)),p||(p=f?e>d:g*a>4*n)});return p&&h>k?l||a:0};m.generalizeGeometry=function(b,a,d,k){if(!b||!a||0>a)return!1;d=d||500;Array.isArray(b)||(b=[b]);var f=[],l=[];b.map(function(c){var e=c.geometry||c;if(e!=c&&e.rings){c.geometry=new t;c.geometry.setSpatialReference(e.spatialReference);
var h=c.geometry.rings}h&&e.rings.forEach(function(p){h.push(p.slice())});m.getNumberOfPoints(e)>d&&(c=h||e.rings,f=f.concat(c),l.push({source:c,count:c.length}))});if(k&&window.Worker)return x(f,l,a);f.forEach(function(c){(new m.RingInfo(c)).generalize(a,.8)})};return m});