// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/htmlToSvg/supportClasses/drawing/_TextDrawer",["dojo/_base/lang","../ElementBuilder","../text/TextMeasurer","../text/TextStyleBuilder"],function(E,y,F,G){function H(d,b){for(var c=[],a,k=0===b.style.whiteSpace.indexOf("pre"),g=b.style.textAlign,l=0;l<d.length;l++){var f=d[l];if(k||"justify"!==g||f.text.trim()){k&&"justify"===g&&a&&(f.text.trim()?a.text.trim()||(a=null):a.text.trim()&&(a=null));if(a){var r=z.test(f.text),q=a._isRtl===r;if(A(a,f)&&q){q=f.box.x+
f.box.w/2>a.box.x+a.box.w/2;var t=a.box.x-(f.box.x+f.box.w),B=f.box.x-(a.box.x+a.box.w),I=r&&!q&&Math.abs(t)<=C;if(!r&&q&&Math.abs(B)<=C||I){a.text+=f.text;a.box.h=Math.max(a.box.y+a.box.h,f.box.y+f.box.h)-Math.min(a.box.y,f.box.y);a.box.y=Math.min(a.box.y,f.box.y);a._isRtl?(a.box.x-=f.box.w+t,a.box.w+=f.box.w+t):a.box.w+=f.box.w+B;a._boxes.push(f);continue}}}a={_isRtl:z.test(f.text),text:f.text,box:E.mixin({},f.box),_boxes:[f]};c.push(a)}else a=null}k||"justify"!==g||u(c).forEach(function(e,m,v){if(!(2>
e.boxes.length||m===v.length-1)){e.boxes.sort(function(h,w){h.box.x-w.box.x});var n=0;e.boxes.forEach(function(h){n+=h.box.w});var x=(b.style.cw-n)/(e.boxes.length-1),p=b.style.getPaddings().l+b.style.getBorder().l.width;e.boxes.forEach(function(h){h.box.x=p;p+=h.box.w+x})}});k&&"left"===g&&u(c).forEach(function(e,m,v){!e.isNewLine&&D(e)});k&&"justify"===g&&u(c).forEach(function(e,m,v){if(2>e.boxes.length||e.isLastLine)e.isLastLine&&D(e);else{e.boxes.sort(function(h,w){h.box.x-w.box.x});m=0;e.isNewLine&&
!e.boxes[0].text.trim()&&(m=e.boxes[0].box.w,e.boxes.shift());e.boxes=e.boxes.filter(function(h){return!h.text.trim()&&2>h._boxes.length?!1:!0});var n=0;e.boxes.forEach(function(h){n+=h.box.w});var x=(b.style.cw-m-n)/(e.boxes.length-1),p=m+b.style.getPaddings().l+b.style.getBorder().l.width;e.boxes.forEach(function(h){h.box.x=p;p+=h.box.w+x})}});return c}function A(d,b){d=d.box.y+d.box.h/2;return d>b.box.y&&d<b.box.y+b.box.h}function u(d){var b=[],c;d.forEach(function(k,g){if(c&&A(c.boxes[0],k))c.boxes.push(k);
else{var l=b.length&&b[b.length-1];l=l&&l.boxes[l.boxes.length-1];c={boxes:[k],isNewLine:0===g||l&&l.text.indexOf("\n")===l.text.length-1,isLastLine:!1};b.push(c)}});for(d=1;d<b.length;d++){var a=b[d-1];b[d].isNewLine&&(a.isLastLine=!0)}b.length&&(b[b.length-1].isLastLine=!0);return b}function D(d){var b=d.boxes[0],c=d.boxes[1],a=b._boxes[0];c=b._boxes[1]||c&&c._boxes[0];!a.text.trim()&&c&&c.text.trim()&&(b._boxes.shift(),b.text=b.text.replace(a.text,""),b.box.w-=a.box.w,d.boxes.forEach(function(k,
g){0<g&&(k.box.x-=a.box.w)}))}var C=.1,z=/^[^A-Za-z\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u0300-\u0590\u0800-\u1fff\u2c00-\ufb1c\ufdfe-\ufe6f\ufefd-\uffff]*[\u0591-\u07ff\ufb1d-\ufdfd\ufe70-\ufefc]/;return{drawText:function(d,b,c,a){d=F.getBoxes(d,b,c);if(!d||!d.boxes.length)return null;var k=[];H(d.boxes,c).forEach(function(g){if(g.text.trim()){var l={fill:c.style.color,x:c.box.x+g.box.x,y:c.box.y+g.box.y+(c.style.fontSize-(.5+.0375*(c.style.fontSize-10))),style:G.buildTextStyleString(c,c.isLink?
{"text-decoration":"underline"}:void 0),opacity:c.style.opacity*c.style.colorOpacity,transform:c.style.transform,clipParams:a,"text-anchor":"start"};g=y.buildElement("text",l,g.text.replace("\n",""));c.isLink&&(g=y.buildElement("a",{"xlink:href":c.href,target:c.target},g));k.push(g)}});return k}}});