// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/htmlToSvg/supportClasses/NodeProcessor",["esri/dijit/geoenrichment/promise/all","./drawing/SVGDrawer","./Clipper","./VisualsCollector"],function(w,n,u,x){return{processNode:function(b,c){var k={numIterations:0,lines:[],globalBoostIndex:0,promises:[]};this._processNode(b,null,null,null,0,c,k);return w(k.promises).then(function(){var h=[];k.lines.forEach(function(d){var e=d.subLines;delete d.subLines;h.push(d);e&&e.forEach(function(g){h.push(g)})});h.sort(function(d,
e){return d.stackIndex-e.stackIndex});return h})},_processNode:function(b,c,k,h,d,e,g){function l(f,r){if(f)if(Array.isArray(f))f.forEach(function(m){l(m)});else{r=r||1;if(f&&f.then){var y=g.lines.length;g.lines.push({text:"",stackIndex:++d,subLines:null});g.promises.push(f.then(function(m){var t=g.lines[y];if(Array.isArray(m)){t.text=m[0];m.shift();var z=t.stackIndex;t.subLines=m.map(function(A){return{text:A,stackIndex:++z}})}else t.text=m}))}else g.lines.push({text:f,stackIndex:++d});p+=r;d+=r-
1}}var p=0;if("#comment"===b.nodeName)return p;var a=x.getNodeVisuals(b,h);if(!a)return p;a.style.isRelAbs&&(g.globalBoostIndex+=1E6,d=g.globalBoostIndex);if("svg"===b.nodeName)return l(n.drawSVG(b,a,c)),p;if("IMG"===b.nodeName)return l(n.drawImage(b,a,c,e.fitScale),100),p;h=function(){var f=a.style;return f.getBorder().radius||"auto"===f.getBackground().size||f.getBackground().repeatX||f.getBackground().repeatY?u.addClipping(a,e.definitions):c};a.style.getBackground().image&&"none"!==a.style.getBackground().image&&
l(n.drawBackgroundImage(a,h()),100);l(n.drawRect(a,c));l(n.drawBorder(a,c),4);if(b.childNodes.length){if("hidden"===a.style.overflow){var v=e.clipFunc&&e.clipFunc(b);c=(k||e.useClipping||v)&&u.addClipping(a,e.definitions,c)||c}k=0;for(h=b.childNodes.length;k<h;k++){var q=b.childNodes[k];"#text"===q.nodeName?l(n.drawText(q,b,a,c)):(q=this._processNode(q,c,v,a,d,e,g),d+=q)}}return p}}});