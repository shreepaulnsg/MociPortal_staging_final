// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/htmlToSvg/supportClasses/drawing/_ImageDrawer","esri/dijit/geoenrichment/when ../ElementBuilder esri/dijit/geoenrichment/ReportPlayer/dataProvider/commands/mapToImage/LegendToLayerUtil esri/dijit/geoenrichment/utils/DataUtil esri/dijit/geoenrichment/utils/ImageInfoUtil esri/dijit/geoenrichment/utils/ImageUtil esri/dijit/geoenrichment/utils/FitUtil esri/dijit/geoenrichment/utils/ObjectUtil".split(" "),function(u,x,A,y,z,B,C,D){var t={drawBackgroundImage:function(b,
a){if(b.style.getBackground().image&&-1!==b.style.getBackground().image.indexOf("url")){var g=b.style.getBackground().image.replace("url(","").replace(")","").replace(/"/g,"");return t._drawImage(g,b,a,!1)}},drawImage:function(b,a,g,h){return b._webMapJsonInfo?t._drawMap(b._webMapJsonInfo,a,h):0===b.src.indexOf("data:application/json")?t._drawMap({url:b.src},a,h):t._drawImage(b.src,a,g,!0)},_drawImage:function(b,a,g,h){return u(this._preProcessImage(b,a,h),function(c){function n(E,F){return x.buildElement("image",
{"xlink:href":b,x:a.box.x+a.style.getBorder().l.width+E,y:a.box.y+a.style.getBorder().t.width+F,width:p,height:q,opacity:a.style.opacity,clipParams:g,preserveAspectRatio:G,transform:a.style.transform})}var f=c&&c.w||a.style.getBackground().sizePx,k=c&&c.h||f,l=a.style.getBackground().positionXPx,d=a.style.getBackground().positionYPx,m=-1!==a.style.getBackground().positionX.indexOf("%"),r=-1!==a.style.getBackground().positionY.indexOf("%");m&&(l=Number(a.style.getBackground().positionX.replace("%",
"")));r&&(d=Number(a.style.getBackground().positionY.replace("%","")));var v=a.style.getBackground().repeatX,w=a.style.getBackground().repeatY,e=c=0;f&&(c=m?(a.style.cw-f)*l/100:l,e=r?(a.style.ch-k)*d/100:d);var G=f||"contain"===a.style.getBackground().size?void 0:(m?0===l?"xMin":100===l?"xMax":"xMid":"xMid")+(r?0===d?"YMin":100===d?"YMax":"YMid":"YMid")+" slice";var p=f||a.style.cw,q=k||a.style.ch;if(0>=p||0>=q)return null;if(v||w){f=[];if(0>=c)k=c;else for(k=c;0<k;)k-=p;d=k;for(l=0;d<a.style.cw;)d+=
p,l++;if(0>=e)d=e;else for(d=e;0<d;)d-=q;r=d;for(m=0;r<a.style.ch;)r+=q,m++;if(v&&!w)for(c=0;c<l;c++)f.push(n(k+c*p,e));else if(!v&&w)for(e=0;e<m;e++)f.push(n(c,d+e*q));else for(c=0;c<l;c++)for(e=0;e<m;e++)f.push(n(k+c*p,d+e*q));return f}return[n(c,e)]})},_preProcessImage:function(b,a,g){if(g||"cover"===a.style.getBackground().size)return null;if("auto"===a.style.getBackground().size)return u(z.getImageInfo(b),function(c){return{w:c.width,h:c.height}}).otherwise(function(){return null});var h=a.style.getBackground().sizePx;
return a.style.getBackground().repeatX||a.style.getBackground().repeatY||h?u(z.getImageInfo(b),function(c){var n=c.width/c.height;return C.fitBox({w:c.width,h:c.height},{w:h||a.style.cw,h:h?h/n:a.style.ch})}).otherwise(function(){return null}):null},_drawMap:function(b,a,g){return[x.buildElement("map",{id:b.id,"xlink:href":this._correctJsonUrlForScale(b.url,g),x:a.box.x+a.style.getBorder().l.width,y:a.box.y+a.style.getBorder().t.width,width:a.style.cw,height:a.style.ch,preserveAspectRatio:"xMinYMin slice"})]},
_correctJsonUrlForScale:function(b,a){a=a||1;if(D.compareEqual(a,1,2))return b;b=y.base64ToJson(B.base64DataFromDataURL(b));b.mapOptions.scale/=a;A.correctLegendPositionByScale(b,a);return"data:application/json;base64,"+y.base64FromJson(b)}};return t});