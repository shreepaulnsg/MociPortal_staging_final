// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/infographicPanels/AgePyramid","esri/declare dojo/_base/lang dojo/dom-class dojo/dom-construct dojo/number dojox/charting/Chart dojox/charting/axis2d/Default dojox/charting/plot2d/Bars dojox/charting/plot2d/Lines dojox/charting/action2d/Tooltip dojox/charting/action2d/Highlight dojox/charting/SimpleTheme ../BaseSelectComparison ../infographicUtils/theme dojo/i18n!esri/nls/jsapi".split(" "),function(y,g,q,l,r,z,v,A,B,C,w,D,E,x,m){m=m.geoenrichment.dijit.AgePyramid;return y("esri.dijit.geoenrichment.AgePyramid",
E,{baseClass:"Infographics_AgePyramid",showVerticalAxis:!1,tooltipClass:C,chart:null,_currentTheme:null,_themeChangeHandle:null,createUI:function(a){this.inherited(arguments);a.contentClass.push("AgePyramid_ContentPane");this.chartDiv=a.addContent("div",{"class":"AgePyramid_Chart"})},createUIExpanded:function(a){this.inherited(arguments);var b=a.addContent("div",{"class":"AgePyramid_MinMax"});l.create("div",{innerHTML:m.maxLabel},b);this.max=l.create("div",{"class":"AgePyramid_Text"},b);l.create("div",
{"class":"AgePyramid_MinLabel",innerHTML:m.minLabel},b);this.min=l.create("div",{"class":"AgePyramid_Text"},b);b=a.addContent("div",{"class":"AgePyramid_Comparison"});l.create("div",{"class":"AgePyramid_ComparisonLabel",innerHTML:m.compLabel},b);this._createComboBox(b)},createUICollapsed:function(a){this.inherited(arguments);this._menLabel=l.create("div",{"class":"MenLabel",innerHTML:m.menLabel},this.chartDiv);this._womenLabel=l.create("div",{"class":"WomenLabel",innerHTML:m.womenLabel},this.chartDiv)},
updateUI:function(){this.inherited(arguments);this._themeChangeHandle||(this._themeChangeHandle=x.on("change",g.hitch(this,this._onThemeChange)));this._currentTheme?this._doUpdateUI():x.load("AgePyramid").then(g.hitch(this,this._onThemeLoad))},_onThemeChange:function(){this._currentTheme=null;this._destroyChart();this.updateUI()},_onThemeLoad:function(a){this._currentTheme=a;this._currentTheme.theme=new D(a.theme);this._doUpdateUI()},_doUpdateUI:function(){this._ensureChart();var a=this.getDataFields();
this.maleIndices=[];this.femaleIndices=[];for(var b=a.length/2,c=Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY,f,n,d=!0,h=!0,k=0;k<a.length;k++){var u=k<b;u?this.maleIndices.push(a[k]):this.femaleIndices.push(a[k]);var t=this.getValueByIndex(0,a[k]);t>c?(c=t,f=this.getFieldByIndex(a[k]).alias,d=u):t<e&&(e=t,n=this.getFieldByIndex(a[k]).alias,h=u)}a=this._setSeriesData(this.chart.getSeries("male_bars"),0,this.maleIndices,-1);b=this._setSeriesData(this.chart.getSeries("female_bars"),0,this.femaleIndices,
1);this.expanded?(e=this._getComparisonRow(),c=this._setSeriesData(this.chart.getSeries("male_lines"),e,this.maleIndices,-1),e=this._setSeriesData(this.chart.getSeries("female_lines"),e,this.femaleIndices,1)):(this.chart.getSeries("male_lines").update([]),this.chart.getSeries("female_lines").update([]),e=c=Number.NEGATIVE_INFINITY);a=Math.max(10,a,b,c,e);this.extreme=20<=a?50:10<a?20:10;this.chart.removeAxis("y");this.chart.addAxis("y",{type:v,min:-this.extreme,max:this.extreme,majorTickStep:10>=
this.extreme?2:5,minorTicks:!this.expanded,labelFunc:g.hitch(this,this._getAxisLabel)});this.chart.removeAxis("x");if(this.showVerticalAxis){var F=/\d+$/i;this.chart.addAxis("x",{type:v,min:.5,max:this.maleIndices.length+1,majorTickStep:1E3,majorTicks:!1,minorTicks:!0,minorTickStep:2,vertical:!0,labelFunc:g.hitch(this,function(p,G,H){return(p=(p=(p=this.data.fields[this.maleIndices[G-1]])&&p.name.match(F))&&p[0])||" "})})}this.chart.render();this.expanded&&(d?q.replace(this.max,"AgePyramid_TextMale",
"AgePyramid_TextFemale"):q.replace(this.max,"AgePyramid_TextFemale","AgePyramid_TextMale"),h?q.replace(this.min,"AgePyramid_TextMale","AgePyramid_TextFemale"):q.replace(this.min,"AgePyramid_TextFemale","AgePyramid_TextMale"),this.max.innerHTML=f,this.min.innerHTML=n)},_getAxisLabel:function(a,b,c){b=Math.abs(b);return b!=this.extreme?r.format(b,{places:0}):r.format(b/100,{places:0,type:"percent"})},_setSeriesData:function(a,b,c,e){var f=[],n=0,d;for(d=0;d<c.length;d++){var h=this.getValueByIndex(b,
c[d]);f.push(h);n+=h}b=Number.NEGATIVE_INFINITY;for(d=0;d<c.length;d++)h=f[d]/n*100,f[d]=h*e,h>b&&(b=h);if("lines"===a.plot)for(d=0;d<f.length;d++)f[d]={x:f[d],y:d+1};a.update(f);return b},_ensureChart:function(){if(!this.chart){var a=this._currentTheme,b=this.chart=new z(this.chartDiv);b.setTheme(a.theme);b.addPlot("lines",{type:this._getLinesPlot(),markers:!0});b.addPlot("bars",{type:this._getBarsPlot(),gap:this.expanded?1.5:1});b.addSeries("male_bars",[],g.mixin({plot:"bars"},a.male));b.addSeries("female_bars",
[],g.mixin({plot:"bars"},a.female));b.addSeries("male_lines",[],g.mixin({plot:"lines"},a.line));b.addSeries("female_lines",[],g.mixin({plot:"lines"},a.line));var c={text:g.hitch(this,this._getTooltip)};new this.tooltipClass(b,"bars",c);new this.tooltipClass(b,"lines",c);new w(b,"bars",{duration:1});new w(b,"lines",{duration:1,highlight:a.highlight})}},_getLinesPlot:function(){return B},_getBarsPlot:function(){return A},_getTooltip:function(a){var b=this._currentTheme;switch(a.run.name){case "male_bars":var c=
this.maleIndices[a.index];var e=0;break;case "female_bars":c=this.femaleIndices[a.index];e=0;break;case "male_lines":c=this.maleIndices[a.index];e=this._getComparisonRow();break;case "female_lines":c=this.femaleIndices[a.index];e=this._getComparisonRow();break;default:return""}var f=this.getFeatureTitle(e),n=this.getFieldByIndex(c).alias;c=r.format(this.getValueByIndex(e,c),{places:0});a=r.format(Math.abs("lines"===a.plot.name?a.x:a.y)/100,{places:1,type:"percent"});return"\x3cdiv class\x3d'AgePyramid_Tooltip_Content'\x3e\x3cspan style\x3d'font:"+
b.font+"; color:"+(b.tooltip&&b.tooltip.color||b.color)+";'\x3e\x3cb\x3e"+f+"\x3c/b \x3e \x3cbr / \x3e "+n+"\x3cbr/\x3e"+c+" ("+a+")\x3c/span\x3e\x3c/div\x3e"},resize:function(){this.inherited(arguments);this.chart&&this.chart.resize()},destroy:function(){this._destroyChart();this._themeChangeHandle&&(this._themeChangeHandle.remove(),this._themeChangeHandle=null);this.inherited(arguments)},_destroyChart:function(){this.chart&&(this.chart.destroy(),this.chart=null)}})});