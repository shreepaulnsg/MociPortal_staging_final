// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/infographicPanels/Prizm5","dojo/_base/declare dojo/on dojo/dom-class dojo/dom-construct dojox/html/entities ../BaseWidget ../infographicUtils/dom ../infographicUtils/formatVariable ./supportClasses/Prizm5Data ../utils/ObjectUtil dojo/i18n!esri/nls/jsapi".split(" "),function(t,q,l,f,u,v,r,w,x,y,n){n=n.geoenrichment.dijit.Prizm5;return t(v,{baseClass:"Infographics_Prizm5",_mainTable:null,_detailsTable:null,_noSegmentsDiv:null,_openRowIndex:-1,createUIExpanded:function(a){this.inherited(arguments);
this._createUI(a)},createUICollapsed:function(a){this.inherited(arguments);this._createUI(a)},_createUI:function(a){this._mainTable=a.addContent("table",{"class":"Prizm5_Main_Table"});r.createCols(this._mainTable,[.25,.4,.35])},updateUIExpanded:function(){this.inherited(arguments);this._updateUI()},updateUICollapsed:function(){this.inherited(arguments);this._updateUI()},_updateUI:function(){var a=this;this._toMainView();for(var c=this._get3DominantSegementsInfo(),m=this._mainTable;m.rows.length;)m.deleteRow(-1);
c.length?c.forEach(function(d,k){function g(){b=e.insertCell(-1)}var b;var e=m.insertRow(-1);e._info=d;q(e,"click",function(){a._toDetailViewForRow(e,k)});l.add(e,"Prizm5_LifeStyle");g();l.add(b,"Prizm5_LifeStyle_Image");var h=f.create("div",null,b);h.style.backgroundImage="url("+d.imageUrl+")";h.style.borderColor=d.color;f.create("span",{"class":"Prizm5_LifeStyle_Image_Code",innerHTML:d.code},h).style.borderColor=d.color;g();l.add(b,"Prizm5_Main_Name");b.innerHTML="\x3cspan class\x3d'Prizm5_Main_Label'\x3e"+
d.alias+"\x3c/span\x3e\x3cbr\x3e\x3cspan class\x3d'Prizm5_Main_Value'\x3e"+y.formatNumber(d.value)+" "+n.hhLabel+"\x3c/span\x3e";g();l.add(b,"Prizm5_Main_Pct");b.innerHTML="\x3cspan class\x3d'Prizm5_Main_Pct_Value'\x3e"+w({units:"pct",decimals:1},d.percentValue)+"\x3c/span\x3e\x3cbr\x3e\x3cspan class\x3d'Prizm5_Main_Pct_Label'\x3e"+n.prtHhLabel+"\x3c/span\x3e";g();l.add(b,"Prizm5_Main_Arrow");f.create("div",null,b)}):this._showNoSegementsInfo()},_get3DominantSegementsInfo:function(){for(var a=[],
c=this._getDataManager(),m=this.getValueByName(0,c.getTotalFieldName(this.data.features[0].attributes),!0),d=0;d<c.getNumClassifiedSegments();d++){var k=c.getFieldNameByIndex(d,this.data.features[0].attributes),g=this.getValueByName(0,k,!0);if(g){var b=c.getSegmentInfoByIndex(d);a.push({index:d,code:b.code,alias:b.alias,fieldName:k,value:g,percentValue:g/m*100,color:b.color,fields:b.fields,imageUrl:b.imageUrl})}}a.sort(function(e,h){return h.value-e.value});a.length=Math.min(a.length,3);return a},
_toDetailViewForRow:function(a,c){this._openRowIndex===c?(this._openRowIndex=-1,this._toMainView()):(this._openRowIndex=c,this._toDetailView(a,a._info))},_toMainView:function(){for(var a=0;a<this._mainTable.rows.length;a++)l.remove(this._mainTable.rows[a],"clicked");this._detailsTableRow&&(f.destroy(this._detailsTableRow),this._detailsTableRow=this._detailsTable=null);this._noSegmentsDiv&&f.destroy(this._noSegmentsDiv);this._noSegmentsDiv=null},_toDetailView:function(a,c){this._toMainView();l.add(a,
"clicked");this._createDetailsTable(a);this._createDetailedViewExpanded(c)},_createDetailsTable:function(a){this._detailsTableRow=f.create("tr",null,a,"after");a=f.create("td",{colSpan:"4"},this._detailsTableRow);this._detailsTable=f.create("table",{"class":"Prizm5_Details_Table"},a);r.createCols(this._detailsTable,[.5,.5])},_createDetailedViewExpanded:function(a){function c(b,e,h){var p={};b&&(p["class"]=b);e&&(p.innerHTML=u.encode(e));return f.create("div",p,h||k)}var m=this._detailsTable;a.fields.forEach(function(b,
e){0===e%2&&(d=m.insertRow(-1));e=b.label;b=b.value;k=d.insertCell(-1);l.add(k,"Prizm5_Details_FieldCell");var h=c("Prizm5_Details_FieldCellContent");c("Prizm5_Details_Label",e,h);c("Prizm5_Details_SubLabel",b,h)});var d=m.insertRow(-1);var k=d.insertCell(-1);k.colSpan=2;c("Prizm5_Details_LinkIcon dijitInline");var g=c("Wizard_Link Prizm5_Details_Link dijitInline",n.viewFullSegmentProfile);q(g,"click",function(){window.open(this._getDataManager().getUrl(a.index),"_blank")}.bind(this))},isDetailedViewOpen:function(){return 0<=
this._openRowIndex},getOpenDetailedViewRowIndex:function(){return this._openRowIndex},openDetailedViewAt:function(a){this._toDetailViewForRow(this._mainTable.rows[a],a)},collapseContent:function(){this._openRowIndex=-1;this._toMainView()},_showNoSegementsInfo:function(){this._noSegmentsDiv=f.create("div",{"class":"esriGEAbsoluteStretched esriGEContentVerticalAlignMiddle Prizm5_noSegmentsDiv",innerHTML:n.noSegmentsFound},this._mainTable,"after")},_getDataManager:function(){return x.getDataManagerByAttributes(this.data.features[0].attributes)}})});