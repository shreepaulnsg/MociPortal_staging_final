// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/infographicPanels/InterestingFacts",["esri/declare","../BaseWidget"],function(r,t){return r("esri.dijit.geoenrichment.InterestingFacts",[t],{_chartNode:null,_varNode:null,_table:null,_selectedFact:0,_lastSelectedTag:null,createUIExpanded:function(f){this.inherited(arguments);this._chartNode=f.addContent("div",{"class":"InterestingFacts_Chart"});this._varNode=f.addFooter("div",{"class":"OneVarMultiComparison_TextColumnHeader"});this._table=f.addFooter("table",{"class":"OneVarMultiComparison_Table"})},
updateUIExpanded:function(){var f=this;this.inherited(arguments);this._updateTable();var d=this._chartNode;d.innerHTML="";for(var k=d.clientWidth,l=d.clientHeight,m=Number.NEGATIVE_INFINITY,g=Number.POSITIVE_INFINITY,n=[],p=0;30>p;p++){var h="FACT"+(p+1).toString();if(!f.getValueByName(0,h+"ALIAS"))break;var a=f.getValueByName(0,h+"DIFF");if(0<a)var b="#66F45B";else a=-a,b="#43D3FF";a>m&&(m=a);a<g&&(g=a);n.push({text:f.getValueByName(0,h+"TAG"),absDiff:a,color:b})}d3.layout.cloud().size([k,l]).words(n.map(function(e,
q){e.size=Math.ceil(8+30*(e.absDiff-g)/(m-g));e.tagIndex=q;return e})).padding(5).rotate(function(){return 0}).font("Verdana").fontSize(function(e){return e.size}).on("end",function(e){function q(c){f._selectedFact=c;u.classed("selected",function(v){return v.tagIndex===c})}var u=d3.select(d).selectAll("div").data(e).enter().append("div").style("font-size",function(c){return c.size+"px"}).style("color",function(c){return c.color}).style("left",function(c){return c.x+c.x0+k/2+"px"}).style("top",function(c){return c.y+
c.y0+l/2+"px"}).style("margin",function(c){return c.padding+"px"}).text(function(c){return c.text}).on("click",function(c){q(c.tagIndex);f._updateTable()});q(0)}).start()},_updateTable:function(){var f=this.metadata.name,d=(this._selectedFact+1).toString(),k="FACT"+d+"VALUE";d3.select(this._varNode).text(this.getValueByName(0,"FACT"+d+"ALIAS"));d=this.data.features;var l=-Infinity,m=Infinity,g,n;d.forEach(function(a){var b=a.attributes[k];b<m&&(m=b,g=a);b>l&&(l=b,n=a)});var p=d3.scale.linear().domain([0,
1.4*l]).nice().range([0,100]),h=[{width:"50%",cl:"OneVarMultiComparison_TextColumn"},{width:"20%",cl:"OneVarMultiComparison_ValueColumn"},{cl:"OneVarMultiComparison_ChartColumn"}];d=d3.select(this._table).selectAll("tr").data(d);d.enter().append("tr").classed("OneVarMultiComparison_Row",!0).classed("AlternatingRow",function(a,b){return 1===b%2});d.exit().remove();d=d.selectAll("td").data(function(a){var b=a.attributes;return[{v:b[f],f:a},{v:b[k],f:a},{v:b[k],f:a}]});d.enter().append("td");d.each(function(a,
b){var e=d3.select(this);h[b].width&&(e=e.style("width",h[b].width));e=e.classed(h[b].cl,!0);2>b?e.text(a.v):(b=e.selectAll("div").data([1]),b.enter().append("div").style("height","9px"),b.transition().style("background-color",function(){return a.f===g?"#43D3FF":a.f===n?"#66F45B":"#b5b5b5"}).style("width",p(a.v)+"%"))})}})});