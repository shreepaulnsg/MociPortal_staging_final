// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/templates/MultidimensionalFilter.html":'\x3cdiv data-dojo-attach-point\x3d"_multidimensionalFilterContainer" class\x3d"esriMultidimensionalFilterContainer"\x3e\r\n    \x3ctable class\x3d"esriMultidimensionalFilterTable"\x3e\r\n        \x3ctbody\x3e\r\n        \x3ccol class\x3d"esriMultidimensionalFilterCol1"/\x3e\r\n        \x3ccol class\x3d"esriMultidimensionalFilterCol2"/\x3e\r\n        \x3ccol class\x3d"esriMultidimensionalFilterCol3"/\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd colspan\x3d"3"\x3e\r\n                \x3clabel class\x3d"esriMultidimensionalFilterHeadingLabel" data-dojo-attach-point\x3d"VariableFilterLabel"\x3e${_i18n.widgets.multidimensionalFilter.variableFilter}\r\n                \x3c/label\x3e\r\n            \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd colspan\x3d"3" data-dojo-attach-point\x3d"VariableListRow"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"variableList" data-dojo-type\x3d"dijit/form/FilteringSelect" class\x3d"esriMultidimensionalFilterVariableList dijitSelect"\x3e\r\n                \x3c/div\x3e\r\n            \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n            \x3ctd colspan\x3d"3" class\x3d"esriMultidimensionalFilterDimensionHeadingLabelTd"\x3e\r\n                \x3clabel class\x3d"esriMultidimensionalFilterDimensionHeadingLabel" data-dojo-attach-point\x3d"VariableFilterLabel"\x3e${_i18n.widgets.multidimensionalFilter.filterByDimensionalValues}\r\n                \x3c/label\x3e\r\n            \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n        \x3cdiv class\x3d"esriMultidimensionalFilterDimensionFilterGrid" data-dojo-attach-point\x3d"dimensionFilterGrid"\x3e\r\n        \x3c/div\x3e\r\n      \x3cdiv data-dojo-type\x3d"dijit/form/Button" data-dojo-attach-event\x3d"onClick: _onClickApplyMultidimensionalFilter" data-dojo-attach-point\x3d"applyButton"\x3e${_i18n.widgets.multidimensionalFilter.applyLabelTitle}\r\n      \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:esri/dijit/templates/NumericDimensionItem.html":'\x3ctable class\x3d"esriMultidimensionalFilterItemTable"\x3e\r\n  \x3ctbody\x3e\r\n  \x3ccol class\x3d"esriMultidimensionalFilterCol1"/\x3e\r\n  \x3ccol class\x3d"esriMultidimensionalFilterCol2"/\x3e\r\n  \x3ccol class\x3d"esriMultidimensionalFilterCol3"/\x3e\r\n  \x3ctr\x3e\r\n    \x3ctd colspan\x3d"2"\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"dimensionCheckbox" name\x3d"dimensionCheckbox" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-attach-event\x3d"onChange:_onDimensionCheckboxChange" checked/\x3e \x3clabel for\x3d"${dimension}" class\x3d"esriMultidimensionalFilterDimensionText" data-dojo-attach-point\x3d"dimensionAlias"\x3e${dimensionAlias}\x3c/label\x3e \r\n      \x3cspan data-dojo-attach-point\x3d"dimensionUnit"\x3e\x3c/span\x3e\r\n      \x3cdiv class\x3d"esriMultidimensionalFilterInfoDiv" id\x3d"${dimension}${id}Info"\x3e\r\n        \x3cdiv data-dojo-type\x3d"dijit/Tooltip" data-dojo-props\x3d"connectId:\'${dimension}${id}Info\',position:[\'after\']"\x3e\r\n          \x3cdiv class\x3d"esriMultidimensionalFilterInfoTooltip"\x3e\r\n            \x3cb\x3e${dimensionAlias}\x3c/b\x3e \r\n            \x3cspan data-dojo-attach-point\x3d"tooltipUnit"\x3e\x3c/span\x3e\r\n            \x3cbr/\x3e   \x3cspan class\x3d"esriMultidimensionalFilterTooltipLeftText"\x3e${_i18n.widgets.multidimensionalFilter.tooltipNumberFromValueText}\x3c/span\x3e \x3cspan data-dojo-attach-point\x3d"tooltipFromValue"\x3e\x3c/span\x3e\r\n            \x3cbr/\x3e   \x3cspan class\x3d"esriMultidimensionalFilterTooltipLeftText"\x3e${_i18n.widgets.multidimensionalFilter.tooltipNumberToValueText}\x3c/span\x3e \x3cspan data-dojo-attach-point\x3d"tooltipToValue"\x3e\x3c/span\x3e\r\n            \x3cbr/\x3e   \x3cspan class\x3d"esriMultidimensionalFilterTooltipLeftText"\x3e${_i18n.widgets.multidimensionalFilter.tooltipCountText}\x3c/span\x3e \x3cspan data-dojo-attach-point\x3d"tooltipValueCount"\x3e\x3c/span\x3e\r\n            \x3cspan data-dojo-attach-point\x3d"disabledDimText" class\x3d"esriMultidimensionalFilterTooltipDisabledDimensionText"\x3e\x3c/span\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/td\x3e\r\n    \x3ctd\x3e\x3cspan data-dojo-attach-point\x3d"rangeSpan"\x3e\x3cinput data-dojo-attach-point\x3d"rangeCheckbox" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-attach-event\x3d"onChange:_onRangeCheckboxChange"/\x3e \x3clabel for\x3d"${dimension}RangeCheckbox" class\x3d"rangeText"\x3e${_i18n.widgets.multidimensionalFilter.rangeText}\x3c/label\x3e\r\n        \x3cdiv class\x3d"esriMultidimensionalFilterRangeInfoDiv" id\x3d"${dimension}${id}hasRangesInfo" data-dojo-attach-point\x3d"hasRangesInfo"\x3e\r\n          \x3cdiv data-dojo-type\x3d"dijit/Tooltip" data-dojo-props\x3d"connectId:\'${dimension}${id}hasRangesInfo\',position:[\'after\']"\x3e\r\n            \x3cdiv class\x3d"esriMultidimensionalFilterInfoTooltip"\x3e\r\n              ${_i18n.widgets.multidimensionalFilter.hasRangesInfoText1}\x3cbr/\x3e\r\n              ${_i18n.widgets.multidimensionalFilter.hasRangesInfoText2}\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/span\x3e\r\n    \x3c/td\x3e\r\n  \x3c/tr\x3e\r\n  \x3ctr data-dojo-attach-point\x3d"minRow"\x3e\r\n    \x3ctd\x3e\x3cspan data-dojo-attach-point\x3d"minValueText"\x3e${_i18n.widgets.multidimensionalFilter.sliceNumberText}\x3c/span\x3e\x3c/td\x3e\r\n    \x3ctd colspan\x3d"2"\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"minNumberSelector"\x3e\x3c/span\x3e\r\n    \x3c/td\x3e\r\n  \x3c/tr\x3e\r\n  \x3ctr data-dojo-attach-point\x3d"maxRow" class\x3d"esriDomHide"\x3e\r\n    \x3ctd\x3e${toText}\x3c/td\x3e\r\n    \x3ctd colspan\x3d"2"\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"maxNumberSelector"\x3e\x3c/span\x3e\r\n    \x3c/td\x3e\r\n  \x3c/tr\x3e\r\n\x3c/tbody\x3e\r\n\x3c/table\x3e',
"url:esri/dijit/templates/TimeDimensionItem.html":'\x3ctable class\x3d"esriMultidimensionalFilterItemTable"\x3e\r\n  \x3ctbody\x3e\r\n  \x3ccol class\x3d"esriMultidimensionalFilterCol1"/\x3e\r\n  \x3ccol class\x3d"esriMultidimensionalFilterCol2"/\x3e\r\n  \x3ccol class\x3d"esriMultidimensionalFilterCol3"/\x3e\r\n  \x3ctr\x3e\r\n    \x3ctd colspan\x3d"2"\x3e\r\n      \x3cinput data-dojo-attach-point\x3d"dimensionCheckbox" name\x3d"dimensionCheckbox" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-attach-event\x3d"onChange:_onDimensionCheckboxChange" checked/\x3e \x3clabel for\x3d"${dimension}" class\x3d"esriMultidimensionalFilterDimensionText" data-dojo-attach-point\x3d"dimensionAlias"\x3e${dimensionAlias}\x3c/label\x3e \r\n      \x3cspan data-dojo-attach-point\x3d"dimensionUnit"\x3e\x3c/span\x3e\r\n      \x3cdiv class\x3d"esriMultidimensionalFilterInfoDiv" id\x3d"${dimension}${id}Info"\x3e\r\n        \x3cdiv data-dojo-type\x3d"dijit/Tooltip" data-dojo-props\x3d"connectId:\'${dimension}${id}Info\',position:[\'after\']"\x3e\r\n          \x3cdiv class\x3d"esriMultidimensionalFilterInfoTooltip"\x3e\r\n            \x3cb\x3e${dimensionAlias}\x3c/b\x3e\r\n            \x3cspan data-dojo-attach-point\x3d"tooltipUnit"\x3e\x3c/span\x3e\r\n            \x3cbr/\x3e   \x3cspan class\x3d"esriMultidimensionalFilterTooltipLeftText"\x3e${_i18n.widgets.multidimensionalFilter.tooltipDateFromValueText}\x3c/span\x3e \x3cspan data-dojo-attach-point\x3d"tooltipFromValue"\x3e\x3c/span\x3e\r\n            \x3cbr/\x3e   \x3cspan class\x3d"esriMultidimensionalFilterTooltipLeftText"\x3e${_i18n.widgets.multidimensionalFilter.tooltipDateToValueText}\x3c/span\x3e \x3cspan data-dojo-attach-point\x3d"tooltipToValue"\x3e\x3c/span\x3e\r\n            \x3cbr/\x3e   \x3cspan class\x3d"esriMultidimensionalFilterTooltipLeftText"\x3e${_i18n.widgets.multidimensionalFilter.tooltipCountText}\x3c/span\x3e \x3cspan data-dojo-attach-point\x3d"tooltipValueCount"\x3e\x3c/span\x3e\r\n            \x3cspan data-dojo-attach-point\x3d"disabledDimText" class\x3d"esriMultidimensionalFilterTooltipDisabledDimensionText"\x3e\x3c/span\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/td\x3e\r\n    \x3ctd\x3e\x3cspan data-dojo-attach-point\x3d"rangeSpan"\x3e\x3cinput data-dojo-attach-point\x3d"rangeCheckbox" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-attach-event\x3d"onChange:_onRangeCheckboxChange"/\x3e \x3clabel for\x3d"${dimension}RangeCheckbox" class\x3d"rangeText"\x3e${_i18n.widgets.multidimensionalFilter.rangeText}\x3c/label\x3e\r\n        \x3cdiv class\x3d"esriMultidimensionalFilterRangeInfoDiv" id\x3d"${dimension}${id}hasRangesInfo" data-dojo-attach-point\x3d"hasRangesInfo"\x3e\r\n          \x3cdiv data-dojo-type\x3d"dijit/Tooltip" data-dojo-props\x3d"connectId:\'${dimension}${id}hasRangesInfo\',position:[\'after\']"\x3e\r\n            \x3cdiv class\x3d"esriMultidimensionalFilterInfoTooltip"\x3e\r\n              ${_i18n.widgets.multidimensionalFilter.hasRangesInfoText1}\x3cbr/\x3e\r\n              ${_i18n.widgets.multidimensionalFilter.hasRangesInfoText2}\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/span\x3e\r\n    \x3c/td\x3e\r\n  \x3c/tr\x3e\r\n  \x3ctr data-dojo-attach-point\x3d"minRow"\x3e\r\n    \x3ctd\x3e\x3cspan data-dojo-attach-point\x3d"minDateText"\x3e${_i18n.widgets.multidimensionalFilter.sliceTimeText}\x3c/span\x3e\x3c/td\x3e\r\n    \x3ctd colspan\x3d"2"\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"minDateSelector"\x3e\x3c/span\x3e\r\n    \x3c/td\x3e\r\n  \x3c/tr\x3e\r\n  \x3ctr data-dojo-attach-point\x3d"maxRow" class\x3d"esriDomHide"\x3e\r\n    \x3ctd\x3e${toText}\x3c/td\x3e\r\n    \x3ctd  colspan\x3d"2"\x3e\r\n      \x3cspan data-dojo-attach-point\x3d"maxDateSelector"\x3e\x3c/span\x3e\r\n    \x3c/td\x3e\r\n  \x3c/tr\x3e\r\n\x3c/tbody\x3e\r\n\x3c/table\x3e',
"url:esri/dijit/templates/PagedDateTimeWidget.html":'\x3cdiv\x3e\r\n  \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass:\'tsButton tsStartButton\', showLabel: false" data-dojo-attach-point\x3d"StartBtn" data-dojo-attach-event\x3d"onClick:_onStartBtnClick" type\x3d"button"\x3e${_i18n.widgets.multidimensionalFilter.startDateButtonTooltip}\x3c/button\x3e\r\n  \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass:\'tsButton tsPrevButton\', showLabel: false" data-dojo-attach-point\x3d"PreviousBtn" data-dojo-attach-event\x3d"onClick:_onPreviousBtnClick" type\x3d"button"\x3e${_i18n.widgets.multidimensionalFilter.previousButtonTooltip}\x3c/button\x3e\r\n  \x3cdiv class\x3d"esriMultidimensionalFilterSelectorDiv"\x3e\x3cspan data-dojo-attach-point\x3d"DateSelector"\x3e\x3c/span\x3e\x3cspan data-dojo-attach-point\x3d"TimeSelector"\x3e\x3c/span\x3e\x3c/div\x3e\r\n  \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass:\'tsButton tsNextButton\', showLabel: false" data-dojo-attach-point\x3d"NextBtn" data-dojo-attach-event\x3d"onClick:_onNextBtnClick" type\x3d"button"\x3e${_i18n.widgets.multidimensionalFilter.nextButtonTooltip}\x3c/button\x3e\r\n  \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass:\'tsButton tsEndButton\', showLabel: false" data-dojo-attach-point\x3d"EndBtn" data-dojo-attach-event\x3d"onClick:_onEndBtnClick" type\x3d"button"\x3e${_i18n.widgets.multidimensionalFilter.endDateButtonTooltip}\x3c/button\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/PagedNumberWidget.html":'\x3cdiv\x3e\r\n  \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass:\'tsButton tsStartButton\', showLabel: false" data-dojo-attach-point\x3d"StartBtn" data-dojo-attach-event\x3d"onClick:_onStartBtnClick" type\x3d"button"\x3e${_i18n.widgets.multidimensionalFilter.startNumberButtonTooltip}\x3c/button\x3e\r\n  \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass:\'tsButton tsPrevButton\', showLabel: false" data-dojo-attach-point\x3d"PreviousBtn" data-dojo-attach-event\x3d"onClick:_onPreviousBtnClick" type\x3d"button"\x3e${_i18n.widgets.multidimensionalFilter.previousButtonTooltip}\x3c/button\x3e\r\n  \x3cdiv class\x3d"esriMultidimensionalFilterSelectorDiv"\x3e\x3cspan data-dojo-attach-point\x3d"NumberSelector"\x3e\x3c/span\x3e\x3c/div\x3e\r\n  \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass:\'tsButton tsNextButton\', showLabel: false" data-dojo-attach-point\x3d"NextBtn" data-dojo-attach-event\x3d"onClick:_onNextBtnClick" type\x3d"button"\x3e${_i18n.widgets.multidimensionalFilter.nextButtonTooltip}\x3c/button\x3e\r\n  \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass:\'tsButton tsEndButton\', showLabel: false" data-dojo-attach-point\x3d"EndBtn" data-dojo-attach-event\x3d"onClick:_onEndBtnClick" type\x3d"button"\x3e${_i18n.widgets.multidimensionalFilter.endNumberButtonTooltip}\x3c/button\x3e\r\n\x3c/div\x3e'}});
define("esri/dijit/MultidimensionalFilter","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/i18n!../nls/jsapi dojo/text!./templates/MultidimensionalFilter.html dojo/text!./templates/NumericDimensionItem.html dojo/text!./templates/TimeDimensionItem.html dojo/text!./templates/PagedDateTimeWidget.html dojo/text!./templates/PagedNumberWidget.html dojo/store/Memory dojo/has ../kernel dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/form/DateTextBox dijit/registry dojo/date/locale dojo/dom-style dojo/dom-class ../layers/DimensionalDefinition ../layers/MosaicRule dojo/html dijit/form/FilteringSelect dijit/form/ComboBox dojox/widget/YearlyCalendar dojox/widget/MonthlyCalendar dojox/widget/Calendar3Pane dojo/_base/array ./_EventedWidget dijit/Tooltip dijit/form/CheckBox dijit/form/Button".split(" "),
function(v,n,x,y,z,L,M,A,N,w,O,P,E,F,G,Q,R,p,S,m,T,H,q,U,V,I,J,B,k){var K=v("PagedDimensionWidgetMixin",[E,F,G],{pageCount:100,displayValue:"",dimension:"",_currentIndex:"",values:"",constructor:function(a){v.safeMixin(this,a);this._i18n=y},_checkButtons:function(){var a=this.values,b=this._currentIndex;1===a.length?this._setButtonProperties(!0,!0,!0,!0):0===b?this._setButtonProperties(!0,!0,!1,!1):b===a.length-1?this._setButtonProperties(!1,!1,!0,!0):this._setButtonProperties(!1,!1,!1,!1)},_setButtonProperties:function(a,
b,d,c){this.StartBtn.set("disabled",a);this.PreviousBtn.set("disabled",b);this.NextBtn.set("disabled",d);this.EndBtn.set("disabled",c)},_onStartBtnClick:function(){this._currentIndex=0;this._updateValues()},_onPreviousBtnClick:function(){this._currentIndex--;this._updateValues()},_onNextBtnClick:function(){this._currentIndex++;this._updateValues()},_onEndBtnClick:function(){this._currentIndex=this.values.length-1;this._updateValues()}}),C=v("PagedDateTimeWidget",[K],{dateValue:"",intervalInfo:{},
_fullDateFormat:"yyyy-MM-dd",templateString:A,_setValuesAttr:function(a){this._set("values",a);this._currentIndex=this.displayValue?k.indexOf(this.values,this.displayValue):0;this.displayValue&&this._set("dateValue",this.displayValue);this._checkButtons();this._populateValues()},_setDateValueAttr:function(a){a&&(this._currentIndex=k.indexOf(this.values,a),-1!==this._currentIndex?(this._set("dateValue",a),this._set("displayValue",a)):(this._set("dateValue",this._snapToClosest(a)),this._set("displayValue",
this._snapToClosest(a)),this._currentIndex=k.indexOf(this.values,this.dateValue)),this._updateValues())},_getTimeArray:function(){var a=[],b=this.values,d=this._currentIndex;var c=p.format(new Date(b[this._currentIndex]),{datePattern:"MM/dd/yyyy",selector:"date"});var e=b[d]-Math.abs(b[d]%864E5);var g=e+864E5;for(d=0;d<b.length;d++)if(b[d]>=e&&b[d]<g){var h=p.format(new Date(b[d]),{timePattern:"hh:mm a",selector:"time"});var f=p.format(new Date(b[d]),{datePattern:"MM/dd/yyyy",selector:"date"});c===
f&&a.push({id:b[d],label:h})}else if(0!==a.length)break;return a},_updateTimeDropDown:function(){var a=[];a=this._getTimeArray();this.timeSelect.reset();a=new w({data:a});this.timeSelect.set({store:a,value:this.values[this._currentIndex]})},_populateValues:function(){var a=[],b=this.values;var d=p.format(new Date(b[this._currentIndex]),{datePattern:this._fullDateFormat,selector:"date"});a=this._getTimeArray();var c=p.format(new Date(b[0]),{datePattern:this._fullDateFormat,selector:"date"});b=p.format(new Date(b[b.length-
1]),{datePattern:this._fullDateFormat,selector:"date"});this.dateSelect?(this.dateSelect.set("constraints",{min:c,max:b}),this.dateSelect.set("value",d)):(this.dateSelect=new Q({value:d,constraints:{min:c,max:b},popupClass:B,style:"width:95px;","class":"dijitSelect esriMultidimensionalFilterVariableList"},this.DateSelector),this.dateSelect.startup(),this.dateSelect.on("change",n.hitch(this,this._dateBoxChange)));a=new w({data:a});this.timeSelect?this.timeSelect.set({store:a,value:this.displayValue}):
(this.timeSelect=new U({store:a,value:this.displayValue,labelAttr:"label",labelType:"text",searchAttr:"label",style:"width:85px;","class":"dijitSelect esriMultidimensionalFilterVariableList",maxHeight:-1},this.TimeSelector),this.timeSelect.startup(),this.timeSelect.on("change",n.hitch(this,this._timeValueChange)),this._checkCalendarControlView())},_checkCalendarControlView:function(){var a=[],b=[],d=[],c=this.values,e=this.intervalInfo,g;if(e.intervalUnit)"years"==e.intervalUnit.toLowerCase()?(this.dateSelect.set("popupClass",
I),m.add(this.timeSelect.domNode,"esriTimeSelectDisplayNone")):"months"==e.intervalUnit.toLowerCase()?(this.dateSelect.set("popupClass",J),m.add(this.timeSelect.domNode,"esriTimeSelectDisplayNone")):"days"==e.intervalUnit.toLowerCase()?(this.dateSelect.set("popupClass",B),m.add(this.timeSelect.domNode,"esriTimeSelectDisplayNone")):this.dateSelect.set("popupClass",B);else{var h=12>c.length?c.length:12;for(g=0;g<h;g++){e=p.format(new Date(c[g]),{datePattern:"yyyy",selector:"date"});var f=p.format(new Date(c[g]),
{datePattern:"yyyyMM",selector:"date"});var l=p.format(new Date(c[g]),{timePattern:"HH:mm",selector:"time"});-1===k.indexOf(b,e)&&b.push(e);-1===k.indexOf(d,f)&&d.push(f);-1===k.indexOf(a,l)&&a.push(l)}b.length===h?(this.dateSelect.set("popupClass",I),m.add(this.timeSelect.domNode,"esriTimeSelectDisplayNone")):d.length===h?(this.dateSelect.set("popupClass",J),m.add(this.timeSelect.domNode,"esriTimeSelectDisplayNone")):(this.dateSelect.set("popupClass",B),1===a.length&&m.add(this.timeSelect.domNode,
"esriTimeSelectDisplayNone"))}},_timeValueChange:function(a){a&&(this._currentIndex=k.indexOf(this.values,a),this._set("dateValue",a),this._set("displayValue",a),this._checkButtons())},_updateValues:function(){var a=p.format(new Date(this.values[this._currentIndex]),{datePattern:this._fullDateFormat,selector:"date"});this.dateSelect.set("_onChangeActive",!1);this.dateSelect.set("value",a,!1);this.dateSelect.set("_onChangeActive",!0);this._updateTimeDropDown();this._checkButtons()},_getUTCTime:function(a){a&&
a.setTime(a.getTime()+6E4*a.getTimezoneOffset());return a},_snapToClosest:function(a){var b=0,d=0,c=this.values,e;a=new Date(a);a=a.getTime();var g=Math.abs(a-c[0]);var h=Math.abs(a-c[0]);var f=c[0];for(e=1;e<c.length;e++)f=c[e]-a,0>f?Math.abs(f)<h&&(h=Math.abs(f),b=e):f<g&&(g=f,d=e);86399999>g||g<h?(f=c[d],this._currentIndex=d):(f=c[b],this._currentIndex=b);return f},_dateBoxChange:function(a){var b=[];a&&(b=(new Date(a)).getTime(),a=this._snapToClosest(parseInt(b,10)),this.dateSelect.set("_onChangeActive",
!1),this.dateSelect.set("value",p.format(new Date(a),{datePattern:this._fullDateFormat,selector:"date"})),this.dateSelect.set("_onChangeActive",!0),p.format(new Date(a),{datePattern:this._fullDateFormat,selector:"date"})!=p.format(new Date(b),{datePattern:this._fullDateFormat,selector:"date"})&&(this.dateSelect.focus(),this.dateSelect.set("message",this._i18n.widgets.multidimensionalFilter.dateSnapText)),b=this._getTimeArray(),this.timeSelect.reset(),a=new w({data:b}),this.timeSelect.set({store:a,
value:b[0].id}),this._checkButtons())}}),D=v("PagedNumberWidget",[K],{numValue:"",templateString:N,_setValuesAttr:function(a){var b=[];this._set("values",a);this.displayValue||0===this.displayValue?(this._currentIndex=k.indexOf(this.values,this.displayValue),this._set("numValue",this.displayValue)):this._currentIndex=0;this._checkButtons();this.numSelect?(k.forEach(this.values,function(d){b.push({id:d,label:d})},this),a=new w({data:b}),this._currentIndex=this.displayValue?k.indexOf(this.values,this.displayValue):
0,this.numSelect.set({store:a,value:this.displayValue||this.values[0]}),this.numSelect.startup()):this._populateValues()},_setNumValueAttr:function(a){if(a||0===a)this._currentIndex=k.indexOf(this.values,a),-1!==this._currentIndex?(this._set("numValue",a),this._set("displayValue",a)):(this._set("numValue",this._snapToClosest(a)),this._set("displayValue",this._snapToClosest(a)),this._currentIndex=k.indexOf(this.values,this.numValue)),this._updateValues()},_populateValues:function(){var a=[];k.forEach(this.values,
function(d){a.push({id:d,label:d})},this);var b=new w({data:a});this.numSelect=new V({store:b,value:this.displayValue,labelAttr:"label",labelType:"text",searchAttr:"label",pageSize:this.pageCount,scrollOnFocus:!0,style:"width:95px;","class":"dijitSelect esriMultidimensionalFilterVariableList",maxHeight:-1},this.NumberSelector);this.numSelect.startup();this.numSelect.on("change",n.hitch(this,this._numValueChange))},_snapToClosest:function(a){var b=this.values,d;var c=Math.abs(a-b[0]);var e=b[0];for(d=
1;d<b.length;d++){var g=Math.abs(a-b[d]);g<c&&(c=g,e=b[d],this._currentIndex=d)}return e},_numValueChange:function(a){if(a){var b=this._snapToClosest(a);this.numSelect.set("_onChangeActive",!1);this.numSelect.set("value",b);this.numSelect.set("_onChangeActive",!0);a!=b&&(this.numSelect.focus(),this.numSelect.set("message",this._i18n.widgets.multidimensionalFilter.numSnapText));this._currentIndex=k.indexOf(this.values,b);this._set("numValue",b);this._set("displayValue",b);this._checkButtons()}},_updateValues:function(){this.numSelect.set("value",
this.values[this._currentIndex]);this._checkButtons()}});A=v("DimensionItemMixin",[E,F,G],{dimension:"",fromText:"",toText:"",valueCount:"",values:[],dimensionAlias:"",unit:"",disabled:!1,intervalInfo:{},_unitString:"",_unitReplaceString:"",_disabledDimensionText:"",_valueFieldString:"",_selectWidgetNameString:"",_onDimensionCheckboxChange:function(a){this.hasRanges?a?(m.replace(this.maxRow,"esriRowShow","esriDomHide"),m.replace(this.minRow,"esriRowShow","esriDomHide"),m.replace(this.rangeSpan,"esriInlineShow",
"esriDomHide")):(m.replace(this.maxRow,"esriDomHide","esriRowShow"),m.replace(this.minRow,"esriDomHide","esriRowShow"),m.replace(this.rangeSpan,"esriDomHide","esriInlineShow")):a?(this.rangeCheckbox.get("checked")?m.replace(this.maxRow,"esriRowShow","esriDomHide"):m.replace(this.maxRow,"esriDomHide","esriRowShow"),m.replace(this.minRow,"esriRowShow","esriDomHide"),m.replace(this.rangeSpan,"esriInlineShow","esriDomHide")):(m.replace(this.maxRow,"esriDomHide","esriRowShow"),m.replace(this.minRow,"esriDomHide",
"esriRowShow"),m.replace(this.rangeSpan,"esriDomHide","esriInlineShow"))},_setDisabledAttr:function(a){this._set("disabled",a);a?(this.dimensionCheckbox.set("checked",!1),this.dimensionCheckbox.set("disabled",!0),m.replace(this.dimensionAlias,"esriDisabled","esriEnabled"),m.replace(this.dimensionUnit,"esriDisabled","esriEnabled"),q.set(this.disabledDimText,"\x3cbr/\x3e"+this._disabledDimensionText)):(this.dimensionCheckbox.set("checked",!0),this.dimensionCheckbox.set("disabled",!1),m.replace(this.dimensionAlias,
"esriEnabled","esriDisabled"),m.replace(this.dimensionUnit,"esriEnabled","esriDisabled"),q.set(this.disabledDimText,""))},_setDisableDimensionCheckBoxAttr:function(a){this._set("disableDimensionCheckBox",a);a&&this.dimensionCheckbox.set("disabled",!0)},_createNewValues:function(){var a=[],b=[],d={};k.forEach(this.values,function(c){-1===k.indexOf(a,c[0])&&a.push(c[0]);-1===k.indexOf(a,c[1])&&a.push(c[1]);-1===k.indexOf(b,c[0])&&(b.push(c[0]),d[c[0]]=[]);d[c[0]].push(c[1])},this);a.sort(function(c,
e){return c-e});this._distinctRangeValues=a;this._rangeStartArray=b;this._rangeEndArrayMap=d},_setUnitAttr:function(a){a&&(-1<a.indexOf(this._unitString)&&(this.unit=a.replace(this._unitString,this._unitReplaceString)),q.set(this.dimensionUnit,"("+this.unit+")"),q.set(this.tooltipUnit,"\x3cbr/\x3e   \x3cspan class\x3d'esriMultidimensionalFilterTooltipLeftText'\x3eUnit:\x3c/span\x3e "+this.unit))},_refreshMaxBox:function(a){if(this.hasRanges)this.rangeCheckbox.get("checked")||this.maxBox.set({displayValue:this._rangeEndArrayMap[a][0],
values:this._rangeEndArrayMap[a]});else if(parseFloat(a)===this.values[this.values.length-1])this.maxBox.set({displayValue:a,values:[a]});else{var b=this.values.filter(function(c){return c>a}),d=this.maxBox.displayValue;this.maxBox.set({displayValue:-1<b.indexOf(d)?d:b[b.length-1],values:b})}},getDimensionCheckboxValue:function(){return this.dimensionCheckbox.get("checked")},setDimensionCheckboxValue:function(a){this.dimensionCheckbox.set("checked",a)},getRangeCheckboxValue:function(){return this.rangeCheckbox.get("value")},
setRangeCheckboxValue:function(a){this.rangeCheckbox.set("value",a)},getMinValue:function(){return this.minBox.get(this._valueFieldString)},setMinValue:function(a){this.minBox.set(this._valueFieldString,a)},getMaxValue:function(){return this.maxBox.get(this._valueFieldString)},setMaxValue:function(a){this.maxBox.set(this._valueFieldString,a)},isMinBoxSupportedValue:function(a){return this.minBox[this._selectWidgetNameString].isValid(a)?!0:!1},isMaxBoxSupportedValue:function(a){return this.maxBox[this._selectWidgetNameString].isValid(a)?
!0:!1}});var W=v("DateItem",[A],{fromDateValue:"",toDateValue:"",_unitString:"ISO8601",_unitReplaceString:"UTC",_valueFieldString:"dateValue",_selectWidgetNameString:"timeSelect",templateString:M,constructor:function(a){v.safeMixin(this,a);this._i18n=y;this.fromText=this._i18n.widgets.multidimensionalFilter.fromTimeText;this.toText=this._i18n.widgets.multidimensionalFilter.toTimeText;this._disabledDimensionText=this._i18n.widgets.multidimensionalFilter.disabledTimeDimensionText},_onRangeCheckboxChange:function(a){if(this.hasRanges){var b=
this.minBox.displayValue;a?(m.replace(this.hasRangesInfo,"esriRangeInfoHide","esriRangeInfoVisible"),this.minBox.set({displayValue:b,values:this._distinctRangeValues}),this.maxBox.set({displayValue:this._distinctRangeValues[this._distinctRangeValues.length-1],values:this._distinctRangeValues})):(m.replace(this.hasRangesInfo,"esriRangeInfoVisible","esriRangeInfoHide"),-1<k.indexOf(this._rangeStartArray,b)&&(this.minBox.set({displayValue:b,values:this._rangeStartArray}),this.maxBox.set({displayValue:this._rangeEndArrayMap[b][0],
values:this._rangeEndArrayMap[b]})))}else a?(m.replace(this.maxRow,"esriRowShow","esriDomHide"),q.set(this.minDateText,this._i18n.widgets.multidimensionalFilter.fromTimeText)):(m.replace(this.maxRow,"esriDomHide","esriRowShow"),q.set(this.minDateText,this._i18n.widgets.multidimensionalFilter.sliceTimeText));this.emit("range-rendered",{})},_updateTooltip:function(){var a=this.values,b=this._distinctRangeValues;this.hasRanges?(this.fromValue=p.format(new Date(b[0]),{datePattern:"MM/dd/yyyy",timePattern:"hh:mm:ss a"}),
this.toValue=p.format(new Date(b[b.length-1]),{datePattern:"MM/dd/yyyy",timePattern:"hh:mm:ss a"})):(this.fromValue=p.format(new Date(a[0]),{datePattern:"MM/dd/yyyy",timePattern:"hh:mm:ss a"}),this.toValue=p.format(new Date(a[a.length-1]),{datePattern:"MM/dd/yyyy",timePattern:"hh:mm:ss a"}));this.valueCount=a.length;q.set(this.tooltipFromValue,this.fromValue.toString());q.set(this.tooltipToValue,this.toValue.toString());q.set(this.tooltipValueCount,this.valueCount.toString())},_setValuesAttr:function(a){this.values=
a;this.hasRanges?(this._createNewValues(),a=this._distinctRangeValues,this._updateTooltip(),this._set("values",this._distinctRangeValues),this.minBox=new C({values:this._rangeStartArray,dimension:this.dimension,displayValue:this._rangeStartArray[0],intervalInfo:this.intervalInfo},this.minDateSelector),this.minBox.startup(),this.minBox.dateSelect.on("change",n.hitch(this,function(){this._refreshMaxBox(this.minBox.displayValue)})),this.minBox.timeSelect.on("change",n.hitch(this,this._refreshMaxBox)),
this.maxBox=new C({values:this._rangeEndArrayMap[this._rangeStartArray[0]],dimension:this.dimension,displayValue:this._rangeEndArrayMap[this._rangeStartArray[0]][this._rangeEndArrayMap[this._rangeStartArray[0]].length-1],intervalInfo:this.intervalInfo},this.maxDateSelector),this.maxBox.startup(),q.set(this.minDateText,this._i18n.widgets.multidimensionalFilter.fromTimeText),m.replace(this.maxRow,"esriRowShow","esriDomHide"),m.replace(this.hasRangesInfo,"esriRangeInfoVisible","esriRangeInfoHide")):
(this._set("values",a),this._updateTooltip(),this.minBox=new C({values:a,dimension:this.dimension,displayValue:a[0],intervalInfo:this.intervalInfo},this.minDateSelector),this.minBox.startup(),this.minBox.timeSelect.on("change",n.hitch(this,this._refreshMaxBox)),this.maxBox=new C({values:a,dimension:this.dimension,displayValue:a[a.length-1],intervalInfo:this.intervalInfo},this.maxDateSelector),this.maxBox.startup())},_getUTCTime:function(a){a&&a.setTime(a.getTime()+6E4*a.getTimezoneOffset());return a}}),
X=v("NumericItem",[A],{_unitString:"esri",_unitReplaceString:"",_valueFieldString:"numValue",_selectWidgetNameString:"numSelect",templateString:L,constructor:function(a){v.safeMixin(this,a);this._i18n=y;this.fromText=this._i18n.widgets.multidimensionalFilter.fromNumericText;this.toText=this._i18n.widgets.multidimensionalFilter.toNumericText;this._disabledDimensionText=this._i18n.widgets.multidimensionalFilter.disabledNumericDimensionText},_onRangeCheckboxChange:function(a){if(this.hasRanges){var b=
this.minBox.numSelect.value;a?(m.replace(this.hasRangesInfo,"esriRangeInfoHide","esriRangeInfoVisible"),this.minBox.set({displayValue:b,values:this._distinctRangeValues}),this.maxBox.set({displayValue:this._distinctRangeValues[this._distinctRangeValues.length-1],values:this._distinctRangeValues})):(m.replace(this.hasRangesInfo,"esriRangeInfoVisible","esriRangeInfoHide"),-1<k.indexOf(this._rangeStartArray,b)&&(this.minBox.set({displayValue:b,values:this._rangeStartArray}),this.maxBox.set({displayValue:this._rangeEndArrayMap[b][0],
values:this._rangeEndArrayMap[b]})));this.emit("range-rendered",{})}else a?(m.replace(this.maxRow,"esriRowShow","esriDomHide"),q.set(this.minValueText,this._i18n.widgets.multidimensionalFilter.fromNumericText)):(m.replace(this.maxRow,"esriDomHide","esriRowShow"),q.set(this.minValueText,this._i18n.widgets.multidimensionalFilter.sliceNumberText))},_updateTooltip:function(){var a=this.values,b=this._distinctRangeValues;this.hasRanges?(this.fromValue=b[0],this.toValue=b[b.length-1]):(this.fromValue=a[0],
this.toValue=a[a.length-1]);this.valueCount=a.length;q.set(this.tooltipFromValue,this.fromValue.toString());q.set(this.tooltipToValue,this.toValue.toString());q.set(this.tooltipValueCount,this.valueCount.toString())},_setValuesAttr:function(a){this.values=a;this.hasRanges?(this._createNewValues(),a=this._distinctRangeValues,this._updateTooltip(),this._set("values",this._distinctRangeValues),this.minBox=new D({values:this._rangeStartArray,dimension:this.dimension,displayValue:this._rangeStartArray[0],
intervalInfo:this.intervalInfo},this.minNumberSelector),this.minBox.startup(),this.minBox.numSelect.on("change",n.hitch(this,this._refreshMaxBox)),this.maxBox=new D({values:this._rangeEndArrayMap[this._rangeStartArray[0]],dimension:this.dimension,displayValue:this._rangeEndArrayMap[this._rangeStartArray[0]][this._rangeEndArrayMap[this._rangeStartArray[0]].length-1],intervalInfo:this.intervalInfo},this.maxNumberSelector),this.maxBox.startup(),q.set(this.minValueText,this._i18n.widgets.multidimensionalFilter.fromNumericText),
m.replace(this.maxRow,"esriRowShow","esriDomHide"),m.replace(this.hasRangesInfo,"esriRangeInfoVisible","esriRangeInfoHide")):(this._set("values",a),this._updateTooltip(),this.minBox=new D({values:a,dimension:this.dimension,displayValue:a[0],intervalInfo:this.intervalInfo},this.minNumberSelector),this.minBox.startup(),this.minBox.numSelect.on("change",n.hitch(this,this._refreshMaxBox)),this.maxBox=new D({values:a,dimension:this.dimension,displayValue:a[a.length-1],intervalInfo:this.intervalInfo},this.maxNumberSelector),
this.maxBox.startup())}});z=v([E,F,G],{declaredClass:"esri.dijit.MultidimensionalFilter",templateString:z,widgetsInTemplate:!0,layer:null,map:null,hideApplyButton:!1,_multidimensionalInfo:null,_variableStore:null,_variableData:[],_dimensionStore:null,_savedMultidimensionalDefinition:null,_dimensionWithRanges:[],_dimensionWidgets:{},reset:0,constructor:function(a){v.safeMixin(this,a);this._i18n=y},startup:function(){this.inherited(arguments);x.subscribe("onMultidimensionalFilterApply",n.hitch(this,
"_onClickApplyMultidimensionalFilter"));x.subscribe("onMultidimensionalFilterReset",n.hitch(this,"_onClickResetMultidimensionalFilter"))},postCreate:function(){x.connect(this.variableList,"onChange",n.hitch(this,"_onVariableListChange"));this.hideApplyButton&&S.set(this.applyButton.domNode,"display","none")},destroy:function(){this.inherited(arguments)},_setLayerAttr:function(a){if(a){this.inherited(arguments);this._dimensionStore=this._cachedDimensions=null;this._set("layer",a);var b=n.hitch(this,
"_setupDefaults");this.layer.loaded?this._setupDefaults():x.connect(this.layer,"onLoad",b)}},_setupDefaults:function(){this.layer.getMultidimensionalInfo().then(n.hitch(this,function(a){this._multidimensionalInfo=a;this._setupVariableFilterDefaults()}),function(a){console.log(a)});this.layer.getDefaultMultidimensionalDefinition().then(n.hitch(this,function(a){this.defaultMultidimensionalDefinition=a}),function(a){console.log(a)})},_computeDimensionUnion:function(a){var b=[],d=[],c=[],e,g,h,f;if(a){for(e=
0;e<a.length;e++){var l=a[e].dimensions;for(g=0;g<l.length;g++){var r=l[g];for(h=f=0;h<b.length;h++)if(r.name==b[h].name){var t=b[h].values;var u=r.values;if(r.hasRanges){for(f=0;f<t.length;f++)d.push(t[f][0]),c.push(t[f][1]);for(f=0;f<u.length;f++)-1!==k.indexOf(d,u[f][0])&&-1!==k.indexOf(c,u[f][1])||t.push(u[f])}else for(f=0;f<u.length;f++)-1===k.indexOf(t,u[f])&&t.push(u[f]);f=1}f||b.push(n.clone(r));r.hasRanges&&-1===k.indexOf(this._dimensionWithRanges,r.name)&&this._dimensionWithRanges.push(r.name)}}0<
this._dimensionWithRanges.length&&(b=this._convertSliceToRange(this._dimensionWithRanges,b));return this._sortDimensionValues(b)}},_sortDimensionValues:function(a){k.forEach(a,function(b){b&&b.values&&(b.values=b.hasRanges?this._sortRangeDimensionValues(b.values):this._sortNoRangeDimensionValues(b.values))},this);return a},_sortRangeDimensionValues:function(a){var b=[],d=[],c={},e={},g=[],h;k.forEach(a,function(f){-1===k.indexOf(b,f[0])&&(b.push(f[0]),c[f[0]]=[]);c[f[0]].push(f)},this);b=b.sort(function(f,
l){return f-l});k.forEach(b,function(f){if(1===c[f].length)g.push(c[f][0]);else{d=[];e={};for(h=0;h<c[f].length;h++)d.push(c[f][h][1]),e[c[f][h][1]]=c[f][h];d=d.sort(function(l,r){return l-r});for(h=0;h<d.length;h++)g.push(e[d[h]])}});return g},_sortNoRangeDimensionValues:function(a){return a.sort(function(b,d){return b-d})},_convertSliceToRange:function(a,b){var d=[];k.forEach(b,function(c){-1!==k.indexOf(a,c.name)&&(c.hasRanges=!0,d=[],k.forEach(c.values,function(e){e instanceof Array?(d.push(e),
c.extent[0]>e[0]?c.extent[0]=e[0]:c.extent[1]<e[0]&&(c.extent[1]=e[0]),c.extent[0]>e[1]?c.extent[0]=e[1]:c.extent[1]<e[1]&&(c.extent[1]=e[1])):(d.push([e,e]),c.extent[0]>e?c.extent[0]=e:c.extent[1]<e&&(c.extent[1]=e))},this),c.values=d)},this);return b},_setupVariableFilterDefaults:function(){var a=this._multidimensionalInfo.variables,b=this.layer.mosaicRule,d;this.layer&&this._multidimensionalInfo&&a&&(this._variableData=[],"esri.layers.RasterXLayer"!==this.layer.declaredClass&&this._variableData.push({name:this._i18n.widgets.multidimensionalFilter.defaultVariableText,
label:"\x3chtml\x3e\x3cbody\x3e\x3csection\x3e\x3ctable\x3e\x3ctr\x3e\x3ctd\x3e\x3cb\x3e"+this._i18n.widgets.multidimensionalFilter.defaultVariableText+"\x3c/b\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3cp style\x3d'white-space:pre-wrap;width:50ex'\x3e\x3ci\x3eNo user-defined restriction on Variable.\x3c/i\x3e\x3c/p\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/section\x3e\x3c/body\x3e\x3c/html",dimensions:this._computeDimensionUnion(a)}),k.forEach(a,function(c){d=c.unit?c.name+" ("+c.unit+")":
c.name;this._variableData.push({name:c.name,dimensions:c.dimensions,description:c.description,label:"\x3chtml\x3e\x3cbody\x3e\x3csection\x3e\x3ctable\x3e\x3ctr\x3e\x3ctd\x3e\x3cb\x3e"+d+"\x3c/b\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd\x3e\x3cp style\x3d'white-space:pre-wrap;width:50ex'\x3e\x3ci\x3e"+c.description+"\x3c/i\x3e\x3c/p\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/section\x3e\x3c/body\x3e\x3c/html\x3e"})},this),this._variableStore=new w({data:this._variableData,idProperty:"name"}),this.variableList.reset(),
this.variableList.set({store:this._variableStore,labelAttr:"label",labelType:"html",value:this.layer.defaultVariable||this._variableData[0].name}),this._savedMultidimensionalDefinition=null,b&&b.multidimensionalDefinition&&0<b.multidimensionalDefinition.length&&(this._savedMultidimensionalDefinition=b.multidimensionalDefinition,this._setVariableValueDefault()))},_setVariableValueDefault:function(){var a=this._savedMultidimensionalDefinition&&this._savedMultidimensionalDefinition[0];a&&a.variableName&&
(a=""==a.variableName?this._i18n.widgets.multidimensionalFilter.defaultVariableText:a.variableName,this.variableList&&this.reset&&1===this.reset?a!=this.variableList.get("value")?this.variableList.set("value",a):this._onVariableListChange():this.variableList.set("value",a))},_setCachedDimensionProperties:function(){var a;for(a in this._cachedDimensions)if(this._cachedDimensions.hasOwnProperty(a)){var b=a;this._dimensionWidgets[b]&&(b=this._dimensionWidgets[b],this._cachedDimensions[a].selected=b.getDimensionCheckboxValue(),
this._cachedDimensions[a].isSlice=!b.getRangeCheckboxValue(),this._cachedDimensions[a].values=[Number(b.getMinValue()),Number(b.getMaxValue())])}},_onVariableListChange:function(){var a=this.variableList.get("value"),b=this._variableStore.query({name:a})[0].dimensions,d=this._variableData[0],c=this._savedMultidimensionalDefinition;!this._cachedDimensions&&this._dimensionStore&&(this._cachedDimensions={},k.forEach(d.dimensions,function(e){this._cachedDimensions[e.field]={}},this));this._cachedDimensions&&
this._setCachedDimensionProperties();this._dimensionStore=null;this._dimensionStore=new w({data:b,idProperty:"name"});this._createDimensionWidgets();this._cachedDimensions?this._displayCachedProperties():c&&0<c.length&&(b=""==c[0].variableName?this._i18n.widgets.multidimensionalFilter.defaultVariableText:c[0].variableName,a==b&&this._setDimensionDefaults())},_createDimensionWidgets:function(){var a,b,d,c,e,g,h=this._savedMultidimensionalDefinition;this._destroyDimensionWidgets();var f="esri.layers.RasterXLayer"===
this.layer.declaredClass;k.forEach(this._dimensionStore.data,function(l){a=l.field;c={hasRegularIntervals:l.hasRegularIntervals,interval:l.interval,intervalUnit:l.intervalUnit};g=l.hasRanges||!1;"StdTime"==a?(b=new W({dimension:l.name,hasRanges:g,dimensionAlias:this._returnFieldAlias(l.name),unit:l.unit,disabled:this.layer.useMapTime,intervalInfo:c,values:l.values,disableDimensionCheckBox:f}),b.placeAt(this.dimensionFilterGrid),this._dimensionWidgets[l.name]=b):"StdTime"!=a&&(e=this._isActiveDimension(l.name),
d=new X({dimension:l.name,hasRanges:g,dimensionAlias:this._returnFieldAlias(l.name),unit:l.unit,disabled:e,intervalInfo:c,values:l.values,disableDimensionCheckBox:f}),d.placeAt(this.dimensionFilterGrid),this._dimensionWidgets[l.name]=d);h&&this._mdDefinitionContainsDimension(h,l.name)?this._dimensionWidgets[l.name].setDimensionCheckboxValue(!0):f||this._dimensionWidgets[l.name].setDimensionCheckboxValue(!1)},this)},_mdDefinitionContainsDimension:function(a,b){return a&&b&&k.some(a,function(d){return d.dimension===
b})},_getUTCTime:function(a){a&&a.setTime(a.getTime()+6E4*a.getTimezoneOffset());return a},_destroyDimensionWidgets:function(){var a=R.findWidgets(this.dimensionFilterGrid);k.forEach(a,function(b){b.destroyRecursive()});this._dimensionWidgets={}},_displayCachedProperties:function(){var a=this._cachedDimensions,b,d,c,e,g,h;k.forEach(this._dimensionStore.data,function(f){b=0;for(d in a)if(a.hasOwnProperty(d)&&d==f.name&&a[d].values){b=1;c=d;e=a[d].isSlice;g=a[d].values;h=a[d].selected;break}b?(-1<c.toLowerCase().indexOf("time")&&
!this.layer.useMapTime||-1===c.toLowerCase().indexOf("time")&&!this._isActiveDimension(c))&&this._updateDimensionValues(c,h,e,g[0],g[1]):(c=f.name,(-1===c.toLowerCase().indexOf("time")&&!this._isActiveDimension(c)||-1<c.toLowerCase().indexOf("time")&&!this.layer.useMapTime)&&this._updateDimensionValues(c,!1,!0,f.extent[0],f.extent[1]))},this)},_isActiveDimension:function(a){return this.layer.activeMapDimensions&&0<this.layer.activeMapDimensions.length&&-1<k.indexOf(this.layer.activeMapDimensions,
a)},_isVariableDimension:function(a,b){var d=!1;this.layer.multidimensionalInfo.variables.some(function(c){if(c.name===a)return c.dimensions.some(function(e){if(e.name===b)return d=!0}),!0});return d},_setDimensionDefaults:function(){var a=this._savedMultidimensionalDefinition,b=0,d,c,e,g;k.forEach(this._dimensionStore.data,function(h){d=0;k.forEach(a,function(f){f.dimensionName==h.name&&(d=1,c=f.dimensionName,e=f.isSlice,g=f.values[1]?f.values:f.values[0],g.length||(g=[g]),!this._dimensionWidgets[c].isMinBoxSupportedValue(g[0])||
2===g.length&&!this._dimensionWidgets[c].isMaxBoxSupportedValue(g[1]))&&(b=1)},this);if(d){if(-1<c.toLowerCase().indexOf("time")&&!this.layer.useMapTime||-1===c.toLowerCase().indexOf("time")&&!this._isActiveDimension(c))e&&-1==k.indexOf(this._dimensionWithRanges,c)?this._updateDimensionValues(c,!0,e,g[0],h.extent[1]):this._updateDimensionValues(c,!0,e,g[0],g[1])}else c=h.name,(-1===c.toLowerCase().indexOf("time")&&!this._isActiveDimension(c)||-1<c.toLowerCase().indexOf("time")&&!this.layer.useMapTime)&&
this._updateDimensionValues(c,"esri.layers.RasterXLayer"===this.layer.declaredClass,!0,h.extent[0],h.extent[1])},this);b&&this._onClickApplyMultidimensionalFilter();this.reset=0},_updateDimensionValues:function(a,b,d,c,e){var g=this._dimensionWidgets[a],h=null;g.getRangeCheckboxValue()===d&&(h||(h=g.on("range-rendered",function(){g.setMinValue(c);g.setMaxValue(e);h.remove();h=null})),g.setRangeCheckboxValue(!d));g.setMinValue(c);g.setMaxValue(e);g.setDimensionCheckboxValue(b)},_returnFieldAlias:function(a){var b;
k.forEach(this.layer.fields,function(d){d.name.toLowerCase()==a.toLowerCase()&&(b=d.alias)},this);return b||a},_onClickApplyMultidimensionalFilter:function(){var a=this._dimensionWidgets,b=this.layer.mosaicRule||n.clone(this.layer.defaultMosaicRule),d=b&&b.multidimensionalDefinition,c=d&&d[0]&&d[0].variableName,e,g=[],h,f,l;for(e in a)a.hasOwnProperty(e)&&a[e].getDimensionCheckboxValue()&&g.push(e);var r=[];var t=this.variableList.get("value")==this._i18n.widgets.multidimensionalFilter.defaultVariableText?
"":this.variableList.get("value");g.length||r.length||r.push({variableName:t});k.forEach(g,function(u){h=u;l=this._dimensionWidgets[h];f=l.getRangeCheckboxValue()?[[Number(l.getMinValue()),Number(l.getMaxValue())]]:-1<k.indexOf(this._dimensionWithRanges,h)&&""==t||l.hasRanges&&""!=t?[[Number(l.getMinValue()),Number(l.getMaxValue())]]:[Number(l.getMinValue())];(-1===h.toLowerCase().indexOf("time")&&!this._isActiveDimension(h)||-1<h.toLowerCase().indexOf("time")&&!this.layer.useMapTime)&&r.push(new T({variableName:t,
dimensionName:h,isSlice:!l.getRangeCheckboxValue(),values:f}))},this);d&&k.forEach(d,function(u){h=u.dimensionName;u.variableName=t;h&&-1===h.toLowerCase().indexOf("time")&&this._isActiveDimension(h)&&this._isVariableDimension(t,h)&&r.push(u)},this);b?(a=b,a.multidimensionalDefinition=r):this.layer.defaultMosaicRule?(a=this.layer.defaultMosaicRule,a.multidimensionalDefinition=r):a=new H({multidimensionalDefinition:[]});"esri.layers.RasterXLayer"===this.layer.declaredClass&&this.layer.setMultiDimensionalDefinition(a);
this.layer.setMosaicRule(a);this.emit("filter-applied",{layer:this.layer,variableChanged:c!==t})},_onClickResetMultidimensionalFilter:function(){var a=this.layer.mosaicRule,b=[],d;this.defaultMultidimensionalDefinition&&0===this.reset&&(this.reset=1,this._cachedDimensions=null,k.forEach(this.defaultMultidimensionalDefinition,function(c){d=c.dimensionName;(-1===d.toLowerCase().indexOf("time")&&!this._isActiveDimension(d)||-1<d.toLowerCase().indexOf("time")&&!this.layer.useMapTime)&&b.push(c)},this),
a&&a.multidimensionalDefinition&&k.forEach(a.multidimensionalDefinition,function(c){d=c.dimensionName;-1===d.toLowerCase().indexOf("time")&&this._isActiveDimension(d)&&b.push(c)},this),0===b.length&&(b=this.defaultMultidimensionalDefinition),a?a.multidimensionalDefinition=b:this.layer.defaultMosaicRule?(a=this.layer.defaultMosaicRule,a.multidimensionalDefinition=b):a=new H({multidimensionalDefinition:[]}),this.layer.setMosaicRule(a),this._savedMultidimensionalDefinition=b)&&(this._dimensionStore=
null,this._setupDefaults(),this._setVariableValueDefault(),this.reset=0)}});O("extend-esri")&&n.setObject("dijit.MultidimensionalFilter",z,P);return z});