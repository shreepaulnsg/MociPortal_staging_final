// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/RasterFunctionEditor/templates/RFxAggregationDefinitionEditor.html":'\x3cdiv class\x3d"esri-rfx-aggregationdef-editor" data-dojo-attach-point\x3d"aggregationdefBase"\x3e\r\n  \x3cdiv class\x3d"esri-rfx-rasterDimension-select"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_rasterDimensionSelectDiv"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n'}});
define("esri/dijit/RasterFunctionEditor/RFxAggregationDefinitionEditor","dojo/_base/declare dojo/i18n!../../nls/jsapi dojo/text!./templates/RFxAggregationDefinitionEditor.html dojo/_base/lang dojo/_base/array dojo/has dojo/Evented ../../kernel dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin ./EditableGridMixin ./RFxGridBase dijit/form/Select dijit/form/NumberTextBox ./RFxRasterDimensionSelect".split(" "),function(n,q,t,l,r,u,F,v,w,x,y,z,A,B,C,D,E){n=
n("RFxAggregationDefinitionEditor",[w,x,y,z,A],{declaredClass:"esri.dijit.RasterFunctionEditor.RFxAggregationDefinitionEditor",templateString:t,widgetsInTemplate:!0,rasterDimensionSelect:null,intervalRangesGrid:null,_intervalKeywordFormTimeUnits:null,_intervalValueFormTimeUnits:null,_dimensionDefinitionSelect:null,_valueIntervalTextbox:null,_intervalKeywordFormTimeUnitsContainer:null,_intervalRangesGridDivContainer:null,_intervalValueDivContainer:null,_intervalValueFormTimeUnitsContainer:null,definitionType:"",
selectedDimension:"",widgetState:null,aggregationDefinitionEnum:{ALL:"ALL",INTERVAL_KEYWORD:"INTERVAL_KEYWORD",INTERVAL_VALUE:"INTERVAL_VALUE",INTERVAL_RANGES:"INTERVAL_RANGES"},aggregationDefinition:{ALL:"aggDefTypeAll",INTERVAL_VALUE:"aggDefTypeIntervalValue",INTERVAL_RANGES:"aggDefTypeIntervalRanges"},esriTimeIntervalKeywords:{HOURLY:"esriTimeIntervalKeywordHourly",DAILY:"esriTimeIntervalKeywordDaily",WEEKLY:"esriTimeIntervalKeywordWeekly",DEKADLY:"esriTimeIntervalKeywordDekadly",PENTADLY:"esriTimeIntervalKeywordPentadly",
MONTHLY:"esriTimeIntervalKeywordMonthly",QUARTERLY:"esriTimeIntervalKeywordQuarterly",YEARLY:"esriTimeIntervalKeywordYearly",RECURRING_DAILY:"esriTimeIntervalKeywordRecurringDaily",RECURRING_WEEKLY:"esriTimeIntervalKeywordRecurringWeekly",RECURRING_MONTHLY:"esriTimeIntervalKeywordRecurringMonthly",RECURRING_QUARTERLY:"esriTimeIntervalKeywordRecurringQuarterly"},esriTimeUnits:{HOURS:"esriTimeUnitsHours",DAYS:"esriTimeUnitsDays",WEEKS:"esriTimeUnitsWeeks",MONTHS:"esriTimeUnitsMonths",YEARS:"esriTimeUnitsYears"},
mdimFilterSetting:void 0,constructor:function(){this.inherited(arguments);this.widgetState={};this._i18n=q.rasterFunctions.enumLabels;this._i18n=l.mixin(this._i18n,q.rasterFunctions.rfxArgs)},postCreate:function(){this.inherited(arguments);this._generateLabelNode(this._i18n.dimensionName,this.aggregationdefBase,!0);this._generateLabelNode(this._i18n.rasterTypeName,this.aggregationdefBase);this._addBreakLine(this.aggregationdefBase);var a=this._generateDropdownOptions(this.aggregationDefinition);this._dimensionDefinitionSelect=
this._generateDropdownNode(a,this.aggregationdefBase);this._intervalKeywordFormTimeUnitsContainer=document.createElement("div");this._intervalKeywordFormTimeUnitsContainer.classList.add("hidden");this.aggregationdefBase.appendChild(this._intervalKeywordFormTimeUnitsContainer);this._generateLabelNode(this._i18n.dimensionUnit,this._intervalKeywordFormTimeUnitsContainer);this._addBreakLine(this._intervalKeywordFormTimeUnitsContainer);a=this._generateDropdownOptions(this.esriTimeIntervalKeywords);this._intervalKeywordFormTimeUnits=
this._generateDropdownNode(a,this._intervalKeywordFormTimeUnitsContainer);this._intervalValueDivContainer=document.createElement("div");this._intervalValueDivContainer.classList.add("hidden","esri-rfx-aggregationdef-intervalValue-div");this.aggregationdefBase.appendChild(this._intervalValueDivContainer);this._generateLabelNode(this._i18n.predictDimensionInterval,this._intervalValueDivContainer);this._valueIntervalTextbox=this._generateTextBoxNode(this._intervalValueDivContainer);this._intervalValueFormTimeUnitsContainer=
document.createElement("div");this._intervalValueFormTimeUnitsContainer.classList.add("hidden");this._intervalValueDivContainer.appendChild(this._intervalValueFormTimeUnitsContainer);this._generateLabelNode(this._i18n.dimensionUnit,this._intervalValueFormTimeUnitsContainer);this._addBreakLine(this._intervalValueFormTimeUnitsContainer);a=this._generateDropdownOptions(this.esriTimeUnits);this._intervalValueFormTimeUnits=this._generateDropdownNode(a,this._intervalValueFormTimeUnitsContainer);this._intervalRangesGridDivContainer=
document.createElement("div");this._intervalRangesGridDivContainer.classList.add("hidden","esri-rfx-aggregationdef-intervalRanges-grid");this.aggregationdefBase.appendChild(this._intervalRangesGridDivContainer);this._generateLabelNode(this._i18n.rangesName,this._intervalRangesGridDivContainer);if(this.layerArg&&this.layerArg.input){this.defaultValue&&"string"===typeof this.defaultValue&&(this.defaultValue=JSON.parse(this.defaultValue));a=this.layerArg.input;this.set("labelAttr","alias");if(0<a.declaredClass.indexOf("RFxRasterInput")&&
a.value){var c=a.getSelectedLayer(a.get("value").name);c.getMultidimensionalInfo().then(l.hitch(this,function(b){c.multidimensionalInfo=b;this.defaultValue&&this.defaultValue.dimension&&(this.selectedDimension=this.defaultValue.dimension);this.defaultValue&&this.defaultValue.definitionType?(this.definitionType=this.defaultValue&&this.defaultValue.definitionType,b=this._dimensionDefinitionSelect.getOptions("INTERVAL_KEYWORD"),"INTERVAL_KEYWORD"!==this.definitionType||b||this._dimensionDefinitionSelect.addOption({value:"INTERVAL_KEYWORD",
label:this._i18n.aggDefTypeIntervalKeyword}),this._dimensionDefinitionSelect.set("value",this.definitionType),this.widgetState[this.definitionType]=this._cloneData(this.defaultValue)):this.definitionType=this._dimensionDefinitionSelect.value})).catch(l.hitch(this,function(b){console.error("Error: Layer does not support multidimensional info")}))}this._dimensionDefinitionSelect.on("change",this._handleDimensionDefinitionSelectChange.bind(this));this.rasterDimensionSelect=new E({layerArg:this.layerArg,
defaultValue:this.defaultValue&&this.defaultValue.dimension},this._rasterDimensionSelectDiv);this.rasterDimensionSelect.on("change",function(b){this._handleDimensionSelectChange(b)}.bind(this));this.rasterDimensionSelect.on("raster-dimension-select-update",function(b){this._handleDimensionSelectChange(b[0].name)}.bind(this));this.rasterDimensionSelect.startup();if(this.layerArg.customFunction)a.on("change",this.onRasterChange.bind(this));this.filterArg&&(a=this.filterArg.input.selectedVariables.map(function(b){return b.value}.bind(this)),
this.rasterDimensionSelect.setAllowedVariables(a),this.filterArg.input.on("change",function(b){this.rasterDimensionSelect.setAllowedVariables(b.variables);this.mdimFilterSetting=b}.bind(this)))}},onRasterChange:function(){if(this.layerArg&&this.layerArg.input){var a=this.layerArg.input;if(0<a.declaredClass.indexOf("RFxRasterInput")&&a.value){var c=a.getSelectedLayer(a.get("value").name);c.getMultidimensionalInfo().then(l.hitch(this,function(b){c.multidimensionalInfo=b;this.rasterDimensionSelect.onRasterChange();
this.widgetState={}})).catch(l.hitch(this,function(b){console.error("Error: Layer does not support multidimensional info")}))}}},_handleDimensionDefinitionSelectChange:function(a){this.definitionType=a;this.defaultValue=this._cloneData(this.widgetState[a]);switch(this.definitionType){case this.aggregationDefinitionEnum.ALL:this._intervalKeywordFormTimeUnitsContainer.classList.add("hidden");this._intervalValueDivContainer.classList.add("hidden");this._intervalRangesGridDivContainer.classList.add("hidden");
break;case "INTERVAL_KEYWORD":this._updateIntervalKeywordSelect();this._intervalKeywordFormTimeUnitsContainer.classList.remove("hidden");this._intervalValueDivContainer.classList.add("hidden");this._intervalRangesGridDivContainer.classList.add("hidden");break;case this.aggregationDefinitionEnum.INTERVAL_VALUE:this._updateIntervalValueForm();this._intervalKeywordFormTimeUnitsContainer.classList.add("hidden");this._intervalValueDivContainer.classList.remove("hidden");this._intervalRangesGridDivContainer.classList.add("hidden");
break;case this.aggregationDefinitionEnum.INTERVAL_RANGES:this._createIntervalRangesGrid(),this._intervalKeywordFormTimeUnitsContainer.classList.add("hidden"),this._intervalValueDivContainer.classList.add("hidden"),this._intervalRangesGridDivContainer.classList.remove("hidden")}},_handleDimensionSelectChange:function(a){this.selectedDimension=a;var c="StdTime"===this.selectedDimension?!1:!0;"StdTime"===a?this._dimensionDefinitionSelect.getOptions("INTERVAL_KEYWORD")||this._dimensionDefinitionSelect.addOption({value:"INTERVAL_KEYWORD",
label:this._i18n.aggDefTypeIntervalKeyword}):this._dimensionDefinitionSelect.removeOption("INTERVAL_KEYWORD");switch(this.definitionType){case "INTERVAL_KEYWORD":c&&(this._dimensionDefinitionSelect.reset(),this._handleDimensionDefinitionSelectChange("ALL"));break;case this.aggregationDefinitionEnum.INTERVAL_VALUE:this._updateIntervalValueForm();break;case this.aggregationDefinitionEnum.INTERVAL_RANGES:this._createIntervalRangesGrid()}},_createIntervalRangesGrid:function(){var a=this._getGridSchema(["MinValue",
"MaxValue"],["dropdown","dropdown"],[this._i18n.minValue,this._i18n.maxValue]),c=this._getGridData(),b=this._getDefaultValueObject(c[0]);this.intervalRangesGrid&&this.intervalRangesGrid.destroy();this._intervalRangesGridDiv=document.createElement("div");this._intervalRangesGridDivContainer.appendChild(this._intervalRangesGridDiv);this.intervalRangesGrid=new B({isForMultidimensional:!0,schema:a,data:c,hasIdColumn:!0,isExtensible:!0,defaultBlankObject:b},this._intervalRangesGridDiv);this.intervalRangesGrid.keepScrollPosition=
!0;this.intervalRangesGrid.on("grid-data-change",this._handleIntervalRangesGridChange.bind(this))},_handleIntervalRangesGridChange:function(){this.defaultValue=this._getValueAttr(!0)},_updateIntervalKeywordSelect:function(){var a=this.defaultValue&&this.defaultValue.intervalKeyword;a&&this._intervalKeywordFormTimeUnits.set("value",a)},_updateIntervalValueForm:function(){var a=this.defaultValue&&this.defaultValue.units||"HOURS";this._valueIntervalTextbox.set("value",this.defaultValue&&this.defaultValue.intervalValue||
3);"StdTime"===this.selectedDimension?(this._intervalValueFormTimeUnitsContainer.classList.remove("hidden"),this._intervalValueFormTimeUnits.set("value",a)):this._intervalValueFormTimeUnitsContainer.classList.add("hidden")},_getGridSchema:function(a,c,b){var d=[];return d=a.map(function(e,f){return{label:b[f],name:e,dataType:c[f]}})},_getGridData:function(){var a=[{MinValue:[],MaxValue:[]}];if(!this.layerArg||!this.layerArg.input)return a;var c=this.layerArg.input;this.set("labelAttr","alias");return 0<
c.declaredClass.indexOf("RFxRasterInput")&&c.value?(a=this.layerArg.value&&this.layerArg.value.name||c.get("value").name,c=c.getSelectedLayer(a),this._createIntervalRangesDataObject(c)):a},_getDefaultValueObject:function(a){var c=this._cloneData(a),b={label:" ",value:"",selected:!0,disabled:!0};Object.keys(c).forEach(function(d,e){c[d].unshift(b)},this);return c},_createIntervalRangesDataObject:function(a){var c=[],b=[],d=[],e=[{MinValue:[],MaxValue:[]}];if(!a)return e;var f=a.multidimensionalInfo;
if(!f||!f.variables)return e;if(this.defaultValue&&this.defaultValue.dimension&&0<this.defaultValue.minValues.length&&0<this.defaultValue.maxValues.length){var g=this.defaultValue&&this.defaultValue.minValues,k=this.defaultValue&&this.defaultValue.maxValues;g.forEach(function(p,h){b=this._getDimensionValues(f,this.selectedDimension);d=this._getDimensionValues(f,this.selectedDimension);this._makeDropdownSelection(b,g[h]);this._makeDropdownSelection(d,k[h]);c.push(this._cloneData({MinValue:b,MaxValue:d}))},
this)}else b=this._getDimensionValues(f,this.selectedDimension),d=this._getDimensionValues(f,this.selectedDimension),c.push({MinValue:b,MaxValue:d});return c},_parseIntervalRangesGridData:function(a,c){var b=[],d=[];a.forEach(function(e){if("*"!==e.idNum){var f=e.MinValue.filter(function(g){return g.selected});e=e.MaxValue.filter(function(g){return g.selected});1===f.length&&1===e.length&&(f=f[0].value,e=e[0].value,c||""!==f&&""!==e)&&(b.push(f),d.push(e))}});return{MinValue:b,MaxValue:d}},_getDimensionValues:function(a,
c){var b=[];a.variables.forEach(function(d){d.dimensions.forEach(function(e){if(e.name===c){var f=e.values;var g=f;if(this.mdimFilterSetting){var k=0;"ALL"!==this.mdimFilterSetting.definitionType&&(k=this.mdimFilterSetting.dimensions.indexOf(e.name));switch(0<=k&&this.mdimFilterSetting.definitionType){case "BY_RANGES":g=this.mdimFilterSetting.minValues[k];k=this.mdimFilterSetting.maxValues[k];"StdTime"===e.name&&(g=this._getDateInMilliseconds(g),k=this._getDateInMilliseconds(k));"boolean"===typeof g||
isNaN(g)||(g=Number(g));"boolean"===typeof k||isNaN(k)||(k=Number(k));g=f.slice(f.indexOf(g),f.indexOf(k)+1);break;case "BY_VALUES":var p=this.mdimFilterSetting.values[k];"StdTime"===e.name&&(p=this._getDateInMilliseconds(p));g=f.filter(function(h){"boolean"===typeof h||isNaN(h)||(h=Number(h));return p==h}.bind(this));break;default:g=f}}g.forEach(function(h){h=e.hasRanges?this._removeDuplicatesFromArray(h).join(" - "):h+"";var m={label:h,value:h,selected:!1,disabled:!1};"StdTime"===e.name&&(h=(new Date(Number(m.value))).toISOString().slice(0,
22),m.label=h,m.value=h);this._itemInArray(b,m)||b.push(m)}.bind(this))}}.bind(this))}.bind(this));return b},_getDateInMilliseconds:function(a){return(new Date(a+"0Z")).getTime()},_removeDuplicatesFromArray:function(a){return r.filter(a,function(c,b,d){return r.indexOf(d,c)===b})},_cloneData:function(a){return l.clone(a)},_itemInArray:function(a,c){return a.some(function(b){return b.label===c.label})},_makeDropdownSelection:function(a,c){var b=!1;a.forEach(function(d){d.value===c?b=d.selected=!0:
d.selected=!1});b||a.unshift({label:" ",value:"",selected:!0,disabled:!0})},_addBreakLine:function(a){var c=document.createElement("br");a.appendChild(c)},_generateLabelNode:function(a,c,b){var d=document.createElement("label");d.innerHTML=a;d.classList.add("esri-rfx-args-editor__tr--arg-name","esri-paddingTop-5");b?c.prepend(d):c.appendChild(d)},_generateDropdownNode:function(a,c){var b=document.createElement("div");c.appendChild(b);return new C({options:a},b)},_generateTextBoxNode:function(a){var c=
document.createElement("div");a.appendChild(c);return new D(null,c)},_generateDropdownOptions:function(a){return Object.keys(a).map(function(c){return{value:c,label:this._i18n[a[c]]}}.bind(this))},_getValueAttr:function(a){a||(a=!1);var c=this._dimensionDefinitionSelect.value,b=this.rasterDimensionSelect.get("value");b={definitionType:c,dimension:b};switch(c){case "INTERVAL_KEYWORD":b.intervalKeyword=this._intervalKeywordFormTimeUnits.get("value");break;case this.aggregationDefinitionEnum.INTERVAL_VALUE:b.intervalValue=
this._valueIntervalTextbox.get("value");"StdTime"===b.dimension&&(b.units=this._intervalValueFormTimeUnits.get("value"));break;case this.aggregationDefinitionEnum.INTERVAL_RANGES:var d=this.intervalRangesGrid.getStoreValue();a=this._parseIntervalRangesGridData(d,a);b.minValues=a.MinValue;b.maxValues=a.MaxValue}this.widgetState[c]=this._cloneData(b);return b}});u("extend-esri")&&l.setObject("dijit.RasterFunctionEditor.RFxAggregationDefinitionEditor",n,v);return n});