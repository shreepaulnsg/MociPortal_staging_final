// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/RasterFunctionEditor/RFxFeatureSelect","dojo/_base/declare dojo/has ../../kernel dojo/_base/lang dojo/_base/array dojo/store/Memory dojo/store/Observable dojo/data/ObjectStore dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin ./utils ../analysis/AnalysisRegistry ../analysis/utils ../analysis/mixins/browselayers/BrowseLayerMixin dojo/i18n!../../nls/jsapi".split(" "),function(e,m,n,f,p,x,y,z,q,r,t,u,g,k,v,w){e=e("esri.dijit.RasterFunctionEditor.RFxFeatureSelect",
[q,r,t,v],{templateString:"\x3cdiv\x3e\x3cdiv data-dojo-type\x3d'dijit/form/Select' data-dojo-attach-point\x3d '_layerSelect'\x3e\x3c/div\x3e\x3c/div\x3e",geometryTypes:{point:g.GeometryTypes.Point,polygon:g.GeometryTypes.Polygon,line:g.GeometryTypes.Line,multiPoint:g.GeometryTypes.MultiPoint},value:null,isRequired:!0,showBrowseLayers:!0,useArcGISComponents:!0,constructor:function(a){this.inherited(arguments);this._i18n=w.widgets.rasterFunctionEditor},postCreate:function(){this.inherited(arguments);
this._populateLayerSelect()},_setInputLayersAttr:function(a){this.inputLayers=a&&a.map(function(b){return b})},_populateLayerSelect:function(){var a=[];this.isRequired||a.push({value:"",label:" "});var b=this.geometryType&&"point"===this.geometryType?this._i18n.rfxFeatureSelect.addPointLayer:this._i18n.rfxFeatureSelect.addFeatureLayer;this.inputLayers&&p.forEach(this.inputLayers,function(d,l){this.geometryType?this._isLayerGeometryTypeSupported(d.geometryType)&&a.push({value:l+1,label:d.name}):a.push({value:l+
1,label:d.name})},this);this._layerSelect.addOption(a);if(this.value){var c=this._getSelectedLayer(),h=c&&c.name;c=h&&a.filter(function(d){return d.label===h})[0];this._layerSelect.set("value",c&&c.value)}else this._layerChange();k.addReadyToUseLayerOption(this,[this._layerSelect]);this.own(this._layerSelect.on("change",f.hitch(this,this._handleFeatureLayerChange)));setTimeout(f.hitch(this,function(){this._layerSelect&&this._layerSelect.updateOption({value:"browselayers",label:b,selected:!1})}),1E3);
this.on("add-ready-to-use-layer",f.hitch(this,function(d){this.emit("add-layer",d)}))},_handleFeatureLayerChange:function(a){if("browselayers"===a||"browse"===a){var b=[],c=[];this.geometryType&&(Array.isArray(this.geometryType)?(c=this.geometryType,this.geometryType.forEach(function(h){b.push(this.geometryTypes[h])}.bind(this))):(c.push(this.geometryType),b.push(this.geometryTypes[this.geometryType])));this._createBrowseItems({browseValue:a,disableLAAL:!0},{geometryTypes:b,tags:c},this._layerSelect)}else this._layerChange()},
_handleBrowseItemsSelect:function(a){a&&a.selection&&k.addAnalysisReadyLayer({item:a.selection,layers:this.inputLayers,layersSelect:this._layerSelect,posIncrement:1,browseDialog:a.dialog||this._browsedlg,widget:this})},_isLayerGeometryTypeSupported:function(a){if(a&&this.geometryType)return Array.isArray(this.geometryType)?this.geometryType.some(function(b){return this.geometryTypes[b]===a||b===a}.bind(this)):this.geometryTypes[this.geometryType]===a||this.geometryType===a},_getSelectedLayer:function(){if(this.value&&
this.inputLayers)return this.inputLayers.filter(function(a){return-1<a.url.indexOf(this.value.url)||-1<this.value.url.indexOf(a.url)}.bind(this))[0]},_layerChange:function(){var a=this._layerSelect.value;""===a?this.value=a:0<a&&(this.value=u.getRasterJsonFromLayer(this.inputLayers[a-1]));this.emit("change")},_setBrowsePropertiesAttr:function(a){this.isSingleTenant=!0;this.map=a.map?a.map:this.map;this.portalUrl=a.portalUrl?a.portalUrl:this.portalUrl;this.portalSelf=a.portalSelf?a.portalSelf:this.portalSelf}});
m("extend-esri")&&f.setObject("dijit.RasterFunctionEditor.RFxFeatureSelect",e,n);return e});