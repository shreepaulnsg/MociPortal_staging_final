// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/RasterFunctionEditor/templates/RFxRasterArrayEditor.html":'\x3cdiv class\x3d"esriRFxRasterArrayEditor"\x3e\r\n  \x3ctable class\x3d"esriRFxArgsEditor__table"\x3e\r\n    \x3ccol width\x3d"auto"\x3e\r\n    \x3ccol class\x3d"esriRFxRasterArrayEditor__td--btn"\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd colspan\x3d"2"\x3e\r\n        \x3cdiv data-dojo-type\x3d"esri/dijit/RasterFunctionEditor/RFxRasterInput" data-dojo-attach-point\x3d"_layerSelect"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd rowspan\x3d"3" class\x3d"esriRFxRasterArrayEditor__td--grid"\x3e\r\n        \x3cdiv class\x3d"esriRFxRasterArrayEditor__grid" data-dojo-attach-point\x3d"_gridNode"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n      \x3ctd\x3e\r\n        \x3cdiv data-dojo-type\x3d"dijit/form/Button" class\x3d"esriActionButton esriRFxRasterArrayEditor__btn" data-dojo-attach-event\x3d"onClick: _onUpButtonClick" data-dojo-props\x3d"iconClass: \'iconMoveUp\'"\r\n        data-dojo-attach-point\x3d"_moveUpButton" title\x3d"${_i18n.rfxRasterArrayEditor.moveUp}"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd\x3e\r\n        \x3cdiv data-dojo-type\x3d"dijit/form/Button" class\x3d"esriActionButton esriRFxRasterArrayEditor__btn" data-dojo-attach-event\x3d"onClick: _onDownButtonClick" data-dojo-props\x3d"iconClass: \'iconMoveDown\'"\r\n        data-dojo-attach-point\x3d"_moveDownButton" title\x3d"${_i18n.rfxRasterArrayEditor.moveDown}"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd\x3e\r\n        \x3cdiv data-dojo-type\x3d"dijit/form/Button" class\x3d"esriActionButton esriRFxRasterArrayEditor__btn" data-dojo-attach-event\x3d"onClick: _onRemoveButtonClick" data-dojo-props\x3d"iconClass:\'esriAnalysisDeleteIcon\'"\r\n        data-dojo-attach-point\x3d"_removeButton" title\x3d"${_i18n.rfxRasterArrayEditor.remove}"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e'}});
define("esri/dijit/RasterFunctionEditor/RFxRasterArrayEditor","dojo/_base/declare dojo/has ../../kernel dojo/_base/lang dojo/_base/array dojo/store/Memory dojo/store/Observable dojo/data/ObjectStore dijit/form/Select dijit/form/Button dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dgrid/OnDemandGrid dgrid/Selection ./utils dojo/text!./templates/RFxRasterArrayEditor.html dojo/i18n!../../nls/jsapi".split(" "),function(m,p,q,k,h,n,r,t,l,B,u,v,w,x,y,g,z,A){l=m("RFxRasterArrayEditor",
[u,v,w],{templateString:z,inputLayers:null,value:[],_lastId:1,constructor:function(a){this.inherited(arguments);this._i18n=A.widgets.rasterFunctionEditor},postCreate:function(){this.inherited(arguments);this._populateLayerSelect();this._setupGrid();this._readValues()},_getValueAttr:function(){this._updateValue();var a=this.value.elements;a&&h.forEach(a,function(c,b){k.mixin(a[b].value,g.getRasterJsonFromLayer(c.value))});return this.value},_getInputLayersStore:function(){return new t(new n({data:this.inputLayers}))},
_populateLayerSelect:function(){this._layerSelect.set("browseProperties",this.browseProperties);this._layerSelect.set("selectDefault",!1);this._layerSelect.set("allowScalar",this.allowScalar);this._layerSelect.set("inputLayers",this.inputLayers);this.own(this._layerSelect.on("change",k.hitch(this,this._addLayer)))},_setupGrid:function(){this._layerStore=r(new n);this._layerGrid=new (m([x,y]))({selectionMode:"single",showHeader:!1,store:this._layerStore,allowSelect:function(a){return!(a.data&&a.data.isTemplate)},
queryOptions:{sort:[{attribute:"id"}]},columns:[{field:"name"}]},this._gridNode)},_readValues:function(){if(this.value&&(this.value.elements||Array.isArray(this.value))){var a=this._layerStore,c=0,b=this.value.elements||this.value,e,f;this._rasterElements=b;h.forEach(b,function(d){e=d&&d.type===g.RFX_VARIABLE_TYPE?d.value:d;f=d.type;if(f===g.RFX_TEMPLATE_TYPE)return a.put(this._getRFTGridData(d,++c));if(e&&e.type===g.RFX_TEMPLATE_TYPE)return a.put(this._getRFTGridData(e,++c));(f===g.RFX_VARIABLE_TYPE||
d.url)&&(d=this._getRFVGridData(d,++c))&&a.put(d)},this);this._layerGrid.refresh()}},_getRFVGridData:function(a,c){var b=a&&a.value;if(b){var e=g.getLayerIdfromRasterValue(b,this.inputLayers),f;if(b&&b.type&&"scalar"===b.type.toLowerCase())return{id:c,name:String(b.value),value:b,isTemplate:!1,element:a};if(e){if(h.some(this.inputLayers,function(d){if(e===d.id)return f=d,!0}),f)return{id:c,name:f.name,value:b,isTemplate:!1}}else return a=g.getArcGISImageServiceLayerItem(b),this.inputLayers.push(a),
{id:c,name:b.name||b.value,value:b,isTemplate:!1}}},_getRFTGridData:function(a,c){if(a)return{id:c,name:"\x3c"+a["function"].name+"."+this._i18n.rfxArgsEditor.outputRaster+"\x3e",value:a,element:a,isTemplate:!0}},_addLayer:function(){this._adjustGridItemIds();var a=this._layerSelect.get("value"),c=this._layerStore.data.length;a&&(a={id:c+1,value:a,name:a.name||a.value},this._layerStore.put(a),this._refreshGrid())},_onRemoveButtonClick:function(){var a=this._getSelectedId();this._layerStore.remove(a);
this._refreshGrid()},_adjustGridItemIds:function(){var a=this._layerStore&&this._layerStore.data;a&&(h.forEach(a,function(c,b){c.id=b+1}),this._layerStore.setData(a))},_onUpButtonClick:function(){var a=this._getSelectedItem();if(this._layerStore&&this._layerStore.data&&a){var c=this._layerStore.data,b=h.indexOf(c,a);if(!(0>=b)){var e=c[b-1];c[b-1]=a;c[b]=e;this._refreshGrid()}}},_onDownButtonClick:function(){var a=this._getSelectedItem();if(this._layerStore&&this._layerStore.data&&a){var c=this._layerStore.data,
b=h.indexOf(c,a);b!==c.length-1&&(c[b]=c[b+1],c[b+1]=a,this._refreshGrid())}},_getSelectedId:function(){return Object.keys(this._layerGrid&&this._layerGrid.selection)[0]},_getSelectedItem:function(){var a=this._getSelectedId();return this._layerStore.get(a)},_refreshGrid:function(){this._adjustGridItemIds();this._updateValue();this._layerGrid.refresh()},_updateValue:function(){var a=this._layerStore&&this._layerStore.data,c=[];a&&(a.forEach(function(b){var e;this._rasterElements&&this._rasterElements.some(function(d){if(d===
b.element||d.value===b.element)return e=d,!0},this);if(b.isTemplate){var f=this.getRFT?this.getRFT(b.value):b.value;e.value?(e.value=f,c.push(e)):c.push(f)}else e?e.value=b.value:c.push({type:g.RFX_VARIABLE_TYPE,isDataset:!0,value:b.value})},this),this._rasterElements&&this._rasterElements.forEach(function(b){void 0!==b._object_ref_id&&null!==b._object_ref_id&&c.push(b)}),this.value={elements:c,type:"ArgumentArray"})}});p("extend-esri")&&k.setObject("dijit.RasterFunctionEditor.RFxNamedRasterEditor",
l,q);return l});