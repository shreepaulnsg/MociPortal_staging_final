// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/RasterFunctionEditor/templates/RFxRasterVariableGrid.html":'\x3cdiv class\x3d"esri-rfx-raster-variable-grid"\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"_rasterVariableDivContainer"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n'}});
define("esri/dijit/RasterFunctionEditor/RFxRasterVariableGrid","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin ../../kernel dojo/text!./templates/RFxRasterVariableGrid.html ./EditableGridMixin ./utils ./RFxGridBase".split(" "),function(m,k,p,q,r,t,u,v,w,x,y,z,A,g){m=m("RFxRasterVariableGrid",[t,u,v,w,r,z],{declaredClass:"esri.dijit.RasterFunctionEditor.RFxRasterVariableGrid",templateString:y,
widgetsInTemplate:!0,rftGridMode:0,rftGridData:null,gridVariableIndex:1,constructor:function(a){this.names=["Select","Variables"];this.dataTypes=[g.DATA_TYPES.boolean,g.DATA_TYPES.string];this.isEditable=[!0,!1];a.containerNode&&(this.container=a.containerNode)},postCreate:function(){this.inherited(arguments);if(this.layerArg&&this.layerArg.input){var a=this.layerArg.input;0<a.declaredClass.indexOf("RFxRasterInput")&&a.value?(this.rftGridMode=1,this._createGrid()):(this.rftGridMode=0,this._createRFTGrid());
this.rasterVariableGrid.on("grid-data-change",k.hitch(this,function(b){this._updateValue(b)}))}},startup:function(){this.inherited(arguments);this.setVariableOptions()},onRasterChange:function(){0===this.rftGridMode&&(this.rftGridMode=1,this._createGrid());this.setVariableOptions()},setVariableOptions:function(){if(this.layerArg&&this.layerArg.input){var a=this.layerArg.input;if(0<a.declaredClass.indexOf("RFxRasterInput")&&a.value){var b=(b=a.get("value"))&&(b.name||b.datasetName.name);(a=a.getSelectedLayer(b))&&
this._createDataObject(a)}}},_getSchema:function(){return this.names.map(function(a,b){return{name:a,dataType:this.dataTypes[b],isEditable:this.isEditable[b]}},this)},_createGrid:function(){var a=this._getSchema(),b=this._createDataObject(this.value);this.rasterVariableGrid&&this.rasterVariableGrid.destroy();this._rasterVariableDiv=document.createElement("div");this._rasterVariableDivContainer.appendChild(this._rasterVariableDiv);this.rasterVariableGrid=new g({schema:a,data:b,hasIdColumn:!1,isExtensible:!1,
showHeader:!1},this._rasterVariableDiv)},_createRFTGrid:function(){var a=[g.DATA_TYPES.boolean,g.DATA_TYPES.string,"delete"],b=[!0,!0,!1],c=["Select","Variables","Delete"].map(function(f,d){return{name:f,dataType:a[d],isEditable:b[d]}},this);this.defaultValue&&0<this.defaultValue.length&&!this.rftGridData&&(this.rftGridData=[],this.rftGridData=this.defaultValue.map(function(f){return{Select:!0,Variables:f,value:f}}.bind(this)));var l=this.rftGridData||[];this.rasterVariableGrid&&this.rasterVariableGrid.destroy();
this._rasterVariableDiv=document.createElement("div");this._rasterVariableDivContainer.appendChild(this._rasterVariableDiv);this.rasterVariableGrid=new g({isForMultidimensional:!0,schema:c,data:l,hasIdColumn:!1,isExtensible:!1,showHeader:!1},this._rasterVariableDiv);this.rasterVariableGrid.startup();this.rasterVariableGrid.keepScrollPosition=!0},_updateValue:function(a){var b=!1;a.forEach(function(c){c.Select&&(b=!0)});b||0===this.rftGridMode||(a[0].Select=!0,setTimeout(function(){this.rasterVariableGrid.updateStoreValue(a)}.bind(this),
0));0===this.rftGridMode&&(a.forEach(function(c){c.value!==c.Variables&&(c.value=c.Variables)}.bind(this)),this.rftGridData=a);this.emit("variable-grid-update",a)},_createDataObject:function(a){var b=[],c="",l=!1,f=!1;if(!a)return b;a.getMultidimensionalInfo().then(k.hitch(this,function(d){a.multidimensionalInfo=d;d=A.filterMDInfoIfMosiacRuleIsSet(a);d.variables&&d.variables.forEach(k.hitch(this,function(e,h){l=0==h;h=p.map(e.dimensions,function(n){return n.name+"\x3d"+n.values.length}).join(",");
c=e.name+" ["+h+"] ("+(e.description||"")+"})";h=!1;this.defaultValue&&0<this.defaultValue.length&&(l=!1,h=this.defaultValue.includes(e.name));e={Select:l||h,Variables:c,value:e.name};b.push(e);e.Select&&(f=!0)}));f||(b[0].Select=!0);this.rasterVariableGrid.updateStoreValue(b);this.emit("variable-grid-update",b)})).catch(k.hitch(this,function(d){console.error("Error: Layer does not support multidimensional info");this.rasterVariableGrid.updateStoreValue(b);this.emit("variable-grid-update",b)}))},
_getValueAttr:function(){var a=this.rasterVariableGrid.getStoreValue(),b=[];a.forEach(function(c){c.Select&&b.push(c.value)});1>b.length&&b.push(a[0]&&a[0].value);return b}});q("extend-esri")&&k.setObject("dijit.RasterFunctionEditor.RFxRasterVariableGrid",m,x);return m});