// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/RasterFunctionEditor/RFxFieldSelect","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/store/Memory dojo/data/ObjectStore dojo/i18n!../../nls/jsapi dijit/form/Select ../../kernel".split(" "),function(d,k,h,l,e,f,m,n,p){d=d([n],{declaredClass:"esri.dijit.RasterFunctionEditor.RFxFieldSelect",postCreate:function(){this.inherited(arguments);this._i18n=m.widgets.rasterFunctionEditor.rfxFieldSelect},startup:function(){this.inherited(arguments);this.setFieldOptions(this.layerArg)},
onRasterChange:function(){this.setFieldOptions()},onFeatureChange:function(){this.setFieldOptions()},setFieldOptions:function(){if(this.layerArg&&this.layerArg.input){var a=this.layerArg.input,b;this.set("labelAttr","alias");0<a.declaredClass.indexOf("RFxFeatureSelect")?(a.value&&(h.some(a.inputLayers,function(c){if(c.url===a.value.url)return b=c,!0}),b&&this.setStore(new f(new e({idProperty:"name",data:k.clone(b.fields)})))),this.otherOptions&&this._addOtherOptions()):0<a.declaredClass.indexOf("RFxRasterInput")&&
(a.value?(b=a.getSelectedLayer(a.get("value").name))?this.setFieldStore(b):this._setDefaultFieldStore():this._setDefaultFieldStore());this.defaultValue?this.set("value",this.defaultValue):this.reset()}},setFieldStore:function(a){"undefined"===typeof a.hasRasterAttributeTable||a.hasRasterAttributeTable?a.getRasterAttributeTable({renderingRule:a.renderingRule}).then(function(b){b&&b.fields?(b=this._getFieldStore(b.fields),this.setStore(b)):this._setDefaultFieldStore();this._setFieldValue()}.bind(this),
function(b){this._setDefaultFieldStore();this.reset()}.bind(this)):(this._setDefaultFieldStore(),this._setFieldValue())},_setDefaultFieldStore:function(){var a=this._getFieldStore();this.setStore(a)},_setFieldValue:function(){this.selectedValue?this.set("value",this.selectedValue):this.defaultValue?this.set("value",this.defaultValue):this.reset()},_addOtherOptions:function(){var a=[];Object.keys(this.otherOptions).forEach(function(c){a.push({name:c,alias:this.otherOptions[c]})},this);if(this.store&&
this.store.data&&this.store.data.length){var b=this.store.data;a.forEach(function(c){b.some(function(g){if(g.name===c.name)return!0})||b.push(c)});this.setStore(this.store)}else this.setStore(new f(new e({idProperty:"name",data:a})))},_getFieldStore:function(a){var b=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],c=["esriFieldTypeString"];return a&&a.length?(a=h.filter(a,function(g){return"list"===this.fieldType?-1<c.indexOf(g.type):-1<h.indexOf(b,
g.type)}.bind(this)),new f(new e({data:a,idProperty:"name"}))):new f(new e({data:this.isInGrid?[{name:"VALUE",alias:this._i18n.value}]:[{name:"VALUE",alias:this._i18n.value},{name:"COUNT",alias:this._i18n.count}],idProperty:"name"}))}});l("extend-esri")&&k.setObject("dijit.RasterFunctionEditor.RFxFieldSelect",d,p);return d});