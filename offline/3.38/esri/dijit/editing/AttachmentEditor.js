// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/editing/templates/AttachmentEditor.html":"\x3cdiv class\x3d\"attachmentEditor\"\x3e\r\n    \x3cbr /\x3e\r\n    \x3cdiv\x3e\r\n        \x3cb\x3e${NLS_attachments}\x3c/b\x3e\r\n        \x3chr /\x3e\r\n        \x3cdiv dojoAttachPoint\x3d\"_attachmentError\" style\x3d'color:red;display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e\r\n        \x3cspan dojoAttachPoint\x3d'_attachmentList' style\x3d'word-wrap: break-word;'\x3e\x3c/span\x3e\r\n        \x3cbr\x3e\x3cbr\x3e\r\n        \x3cdiv data-dojo-type\x3d\"dijit/ProgressBar\" dojoAttachPoint\x3d\"_attachmentProgress\" indeterminate\x3d\"true\" style\x3d'display:none'\x3e\x3c/div\x3e\r\n        \x3cbr /\x3e        \r\n        \x3cform dojoAttachPoint\x3d'_uploadForm'\x3e ${NLS_add}:\x26nbsp;\x26nbsp;\x3cinput type\x3d'file' name\x3d'attachment' dojoAttachPoint\x3d'_uploadField' /\x3e \x3c/form\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e"}});
define("esri/dijit/editing/AttachmentEditor","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/io-query dojo/dom-attr dijit/_Widget dijit/_Templated dijit/ProgressBar ../../kernel ../../lang ../../domUtils dojo/text!./templates/AttachmentEditor.html dojo/i18n!../../nls/jsapi dojo/NodeList-dom".split(" "),function(l,f,g,h,n,q,z,r,t,u,v,A,w,m,d,x,y){l=l([u,v],{declaredClass:"esri.dijit.editing.AttachmentEditor",widgetsInTemplate:!0,templateString:x,
_listHtml:"\x3cspan id\x3d'node_${oid}_${attid}' style\x3d'display: flex;'\x3e\x3ca href\x3d'${href}' target\x3d'_blank'\x3e${name}\x3c/a\x3e",_deleteBtnHtml:"\x3cspan style\x3d'cursor:pointer;color:red;font-weight:bold;padding:0 2px;' class\x3d'deleteAttachment' id\x3d'${attid}');'\x3eX\x3c/span\x3e",_endHtml:"\x3cbr/\x3e\x3c/span\x3e",_aeConnects:[],_layerEditingCapChecked:{},_layerEditingCap:{},constructor:function(a,b){f.mixin(this,y.widgets.attachmentEditor)},startup:function(){this.inherited(arguments);
this._uploadField_connect=g.connect(this._uploadField,"onchange",this,function(){0<this._uploadField.value.length&&this._addAttachment()});this._uploadFieldFocus_connect=g.connect(this._uploadField,"onfocus",f.hitch(this,function(a){d.hide(this._attachmentError)}))},destroy:function(){h.forEach(this._aeConnects,g.disconnect);g.disconnect(this._uploadField_connect);g.disconnect(this._uploadFieldFocus_connect);this.inherited(arguments)},showAttachments:function(a,b){this._attachmentList.innerHTML=this.NLS_none;
this._uploadField.value="";h.forEach(this.domNode.children,function(e,c){d.show(e)});d.hide(this._attachmentError);a&&(this._featureLayer=a.getLayer()||b)&&("esri.layers.FeatureLayer"===this._featureLayer.declaredClass&&this._featureLayer.getEditCapabilities?(this._currentLayerId=this._featureLayer.id,this._layerEditingCapChecked[this._currentLayerId]||(this._layerEditingCap[this._currentLayerId]=this._featureLayer.getEditCapabilities(),this._layerEditingCapChecked[this._currentLayerId]=!0),this._featureCanUpdate=
this._featureLayer.getEditCapabilities({feature:a}).canUpdate,this._oid=a.attributes[this._featureLayer.objectIdField],this._getAttachments(a)):b&&b.getEditCapabilities()||(d.hide(this._uploadForm),h.forEach(this.domNode.children,function(e,c){d.hide(e)})))},_getAttachments:function(a){this._featureLayer&&this._featureLayer.queryAttachmentInfos&&this._featureLayer.queryAttachmentInfos(this._oid,f.hitch(this,"_onQueryAttachmentInfosComplete"))},_addAttachment:function(){d.hide(this._attachmentError);
this._featureLayer&&this._featureLayer.addAttachment?(d.show(this._attachmentProgress),this._featureLayer.addAttachment(this._oid,this._uploadForm,f.hitch(this,"_onAddAttachmentComplete"),f.hitch(this,"_onAddAttachmentError"))):this._tempUpload=this._uploadForm},_chainAttachment:function(a,b){this._tempUpload&&(d.show(this._attachmentProgress),b.addAttachment(a,this._tempUpload,f.hitch(this,"_onAddAttachmentComplete"),f.hitch(this,"_onAddAttachmentError")));this._tempUpload=null},_deleteAttachment:function(a,
b){d.show(this._attachmentProgress);this._featureLayer.deleteAttachments(a,[b],f.hitch(this,"_onDeleteAttachmentComplete"))},_onQueryAttachmentInfosComplete:function(a){var b=this._listHtml+this._deleteBtnHtml+this._endHtml;this._uploadForm.style.display="block";!this._featureCanUpdate&&this._layerEditingCap[this._currentLayerId].canUpdate||!this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate?(b=this._listHtml+this._endHtml,this._uploadForm.style.display=
"none"):this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(b=this._listHtml+this._endHtml);var e=this._attachmentList;a=h.map(a,f.hitch(this,function(c){return m.substitute({href:c.url,name:c.name,oid:c.objectId,attid:c.id},b)}));e.innerHTML=a.join("")||this.NLS_none;this._updateConnects()},_onAddAttachmentComplete:function(a){d.hide(this._attachmentProgress.domNode);var b=this._attachmentList,e=this._uploadField,c=e.value,k=c.lastIndexOf("\\");
-1<k&&(c=c.substring(k+1,c.length));c=c.replace(/ /g,"_");k=r.objectToQuery({gdbVersion:this._featureLayer.gdbVersion,token:this._featureLayer._getToken()});var p=this._listHtml+this._deleteBtnHtml+this._endHtml;this._layerEditingCap[this._currentLayerId].canCreate&&!this._layerEditingCap[this._currentLayerId].canUpdate&&(p=this._listHtml+this._endHtml);a=m.substitute({href:this._featureLayer._url.path+"/"+a.objectId+"/attachments/"+a.attachmentId+(k?"?"+k:""),name:c,oid:a.objectId,attid:a.attachmentId},
p);b.innerHTML=b.innerHTML==this.NLS_none?a:b.innerHTML+a;this._updateConnects();e.value=""},_onAddAttachmentError:function(a){d.hide(this._attachmentProgress.domNode);if(a){var b=this.NLS_error,e=this._attachmentError;m.isDefined(a.code)&&400===a.code&&(b=this.NLS_fileNotSupported);t.set(e,"innerHTML",b);d.show(e)}},_onDeleteAttachmentComplete:function(a){d.hide(this._attachmentProgress.domNode);var b=this._attachmentList;h.every(a,function(e){return e.success})&&(n.query("#node_"+a[0].objectId+
"_"+a[0].attachmentId).orphan(),b.children&&b.children.length||(b.innerHTML=this.NLS_none))},_updateConnects:function(){h.forEach(this._aeConnects,g.disconnect);n.query(".deleteAttachment").forEach(function(a){this._aeConnects.push(g.connect(a,"onclick",f.hitch(this,"_deleteAttachment",this._oid,a.id)))},this)}});q("extend-esri")&&f.setObject("dijit.editing.AttachmentEditor",l,w);return l});