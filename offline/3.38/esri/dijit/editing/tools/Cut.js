// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/editing/tools/Cut","dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/has dojo/DeferredList ../../../graphicsUtils ../../../graphic ../../../tasks/query ../../../layers/FeatureLayer ../../../toolbars/draw ../Cut ./ToggleToolBase ../../../kernel".split(" "),function(k,d,f,m,t,u,v,p,w,x,y,z,A,B){k=k([A],{declaredClass:"esri.dijit.editing.tools.Cut",id:"btnFeatureCut",_enabledIcon:"toolbarIcon cutIcon",_disabledIcon:"toolbarIcon cutIcon",_drawType:y.POLYLINE,
_enabled:!0,_label:"NLS_cutLbl",_cutConnects:[],activate:function(){this._cutConnects.push(m.connect(this._toolbar,"onDrawEnd",this,"_onDrawEnd"));this.inherited(arguments)},deactivate:function(){this.inherited(arguments);f.forEach(this._cutConnects,m.disconnect);this._cutConnects=[];this._edits=[]},_onDrawEnd:function(g){var e=this._cutLayers=f.filter(this._settings.layers,function(a){return"esriGeometryPolygon"===a.geometryType||"esriGeometryPolyline"===a.geometryType&&a.visible&&a._isMapAtVisibleScale()});
this._cutConnects=this._cutConnects.concat(f.map(e,d.hitch(this,function(a){return m.connect(a,"onEditsComplete",d.hitch(this,function(l,q,n){if(this._settings.undoRedoManager){var h=this._settings.undoRedoManager;f.forEach(this._edits,d.hitch(this,function(c){h.add(new z({featureLayer:c.layer,addedGraphics:c.adds,preUpdatedGraphics:c.preUpdates,postUpdatedGraphics:c.updates}))}),this)}this.onFinished()}))})));var b=new w;b.geometry=g;f.forEach(e,function(a,l){this._settings.editor._selectionHelper.selectFeatures([a],
b,x.SELECTION_NEW,d.hitch(this,"_cutFeatures",a,b))},this)},_cutFeatures:function(g,e,b){if(b&&b.length){this._edits=[];var a=[];a.push(this._settings.geometryService.cut(v.getGeometries(b),e.geometry,d.hitch(this,"_cutHandler",g,b)));(new u(a)).addCallback(d.hitch(this,function(){this.onApplyEdits(this._edits)}))}},_cutHandler:function(g,e,b){var a=[],l=[],q=f.map(e,function(c){return new p(d.clone(c.toJson()))}),n,h;f.forEach(b.cutIndexes,function(c,r){n!=c?(n=c,l.push(e[c].setGeometry(b.geometries[r]))):
(h=new p(b.geometries[r],null,d.mixin({},e[c].attributes),null),h.attributes[e[0].getLayer().objectIdField]=null,a.push(h))},this);this._edits.push({layer:g,adds:a,updates:l,preUpdates:q})}});t("extend-esri")&&d.setObject("dijit.editing.tools.Cut",k,B);return k});