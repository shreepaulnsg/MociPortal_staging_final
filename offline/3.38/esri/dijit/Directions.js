// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),function(C,O,l,G,K,E,B,D,q,k,w,t,h,a,f,d,g,c,m){function F(M){return function(T){this._isLoaded?this.inherited(M,arguments):
this.loadDropDown(D.hitch(this,M,T))}}var I=O("dijit.form._SelectMenu",h,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(q(this.domNode,"selectstart",function(M){M.preventDefault();M.stopPropagation()}))},focus:function(){var M=!1,T=this.parentWidget.value;D.isArray(T)&&(T=T[T.length-1]);T&&C.forEach(this.parentWidget._getChildren(),function(V){V.option&&T===V.option.value&&(M=!0,
this.focusChild(V,!1))},this);M||this.inherited(arguments)}});K=O("dijit.form.Select"+(k("dojo-bidi")?"_NoBidi":""),[w,t,g],{baseClass:"dijitSelect dijitValidationTextBox",templateString:m,_buttonInputDisabled:k("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);if(this.options.length&&!this.value&&this.srcNodeRef){var M=this.srcNodeRef.selectedIndex||0;this._set("value",
this.options[0<=M?M:0].value)}this.dropDown=new I({id:this.id+"_menu",parentWidget:this});G.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(M){if(M.value||M.label){var T=D.hitch(this,"_setValueAttr",M);M=new a({option:M,label:("text"===this.labelType?(M.label||"").toString().replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):M.label)||this.emptyLabel,onClick:T,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:M.disabled||
!1});M.focusNode.setAttribute("role","option");return M}return new f({ownerDocument:this.ownerDocument})},_addOptionItem:function(M){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(M))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(M){}},focusChild:function(M){M&&this.set("value",M.option)},_getFirst:function(){var M=this._getChildren();return M.length?M[0]:null},
_getLast:function(){var M=this._getChildren();return M.length?M[M.length-1]:null},childSelector:function(M){return(M=c.byNode(M))&&M.getParent()==this.dropDown},onKeyboardSearch:function(M,T,V,J){M&&this.focusChild(M)},_loadChildren:function(M){if(!0===M)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{C.forEach(this._getChildren(),function(V){V.destroyRecursive()});var T=new a({ownerDocument:this.ownerDocument,label:this.emptyLabel});
this.dropDown.addChild(T)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(M){this.inherited(arguments);l.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",_setDisabledAttr:function(M){this.inherited(arguments);this._refreshState()},
_setRequiredAttr:function(M){this._set("required",M);this.focusNode.setAttribute("aria-required",M);this._refreshState()},_setOptionsAttr:function(M){this._isLoaded=!1;this._set("options",M)},_setDisplay:function(M){M=("text"===this.labelType?(M||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):M)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+M+"\x3c/span\x3e"},
validate:function(M){M=this.disabled||this.isValid(M);this._set("state",M?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",M?"false":"true");var T=M?"":this._missingMsg;T&&this.focused&&this._hasBeenBlurred?d.show(T,this.domNode,this.tooltipPosition,!this.isLeftToRight()):d.hide(this.domNode);this._set("message",T);return M},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||"")},reset:function(){this.inherited(arguments);d.hide(this.domNode);
this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=E.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(q(this.domNode,"selectstart",function(T){T.preventDefault();T.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var M=this._keyNavCodes;delete M[B.LEFT_ARROW];delete M[B.RIGHT_ARROW]},_setStyleAttr:function(M){this.inherited(arguments);G.toggle(this.domNode,
this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(M){this._loadChildren(!0);this._isLoaded=!0;M()},destroy:function(M){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(M),delete this.dropDown);d.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){d.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});k("dojo-bidi")&&(K=
O("dijit.form.Select",K,{_setDisplay:function(M){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));K._Menu=I;K.prototype._onContainerKeydown=F("_onContainerKeydown");K.prototype._onContainerKeypress=F("_onContainerKeypress");return K})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(C,O,l,G,K,E,B,D,q,k,w,t,h){return K("dijit.form._FormSelectWidget",h,{multiple:!1,options:null,store:null,_setStoreAttr:function(a){this._created&&this._deprecatedSetStore(a)},query:null,_setQueryAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:a})},queryOptions:null,_setQueryOptionsAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:a})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(a){var f=this.options||[];if(null==a)return f;if(q.isArrayLike(a))return C.map(a,"return this.getOptions(item);",this);q.isString(a)&&(a={value:a});q.isObject(a)&&(C.some(f,function(d,g){for(var c in a)if(!(c in d)||d[c]!=a[c])return!1;a=g;return!0})||(a=-1));return 0<=a&&a<f.length?f[a]:null},addOption:function(a){C.forEach(q.isArrayLike(a)?a:[a],function(f){f&&q.isObject(f)&&this.options.push(f)},this);this._loadChildren()},removeOption:function(a){a=this.getOptions(q.isArrayLike(a)?
a:[a]);C.forEach(a,function(f){f&&(this.options=C.filter(this.options,function(d){return d.value!==f.value||d.label!==f.label}),this._removeOptionItem(f))},this);this._loadChildren()},updateOption:function(a){C.forEach(q.isArrayLike(a)?a:[a],function(f){var d=this.getOptions({value:f.value}),g;if(d)for(g in f)d[g]=f[g]},this);this._loadChildren()},setStore:function(a,f,d){D.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(a,f,d)},_deprecatedSetStore:function(a,f,d){var g=this.store;d=d||{};if(g!==a){for(var c;c=this._notifyConnections.pop();)c.remove();a.get||(q.mixin(a,{_oldAPI:!0,get:function(m){var F=new O;this.fetchItemByIdentity({identity:m,onItem:function(I){F.resolve(I)},onError:function(I){F.reject(I)}});return F.promise},query:function(m,F){var I=new O(function(){M.abort&&M.abort()});I.total=new O;var M=this.fetch(q.mixin({query:m,onBegin:function(T){I.total.resolve(T)},
onComplete:function(T){I.resolve(T)},onError:function(T){I.reject(T)}},F));return new t(I)}}),a.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[l.after(a,"onNew",q.hitch(this,"_onNewItem"),!0),l.after(a,"onDelete",q.hitch(this,"_onDeleteItem"),!0),l.after(a,"onSet",q.hitch(this,"_onSetItem"),!0)]));this._set("store",a)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);d.query&&this._set("query",d.query);d.queryOptions&&this._set("queryOptions",d.queryOptions);a&&a.query&&(this._loadingStore=!0,this.onLoadDeferred=new O,this._queryRes=a.query(this.query,this.queryOptions),w(this._queryRes,q.hitch(this,function(m){if(this.sortByLabel&&!d.sort&&m.length)if(a.getValue)m.sort(G.createSortFunction([{attribute:a.getLabelAttributes(m[0])[0]}],a));else{var F=this.labelAttr;m.sort(function(I,M){return I[F]>M[F]?1:M[F]>
I[F]?-1:0})}d.onFetch&&(m=d.onFetch.call(this,m,d));C.forEach(m,function(I){this._addOptionForItem(I)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(q.hitch(this,function(I,M,T){M==T?this._onSetItem(I):(-1!=M&&this._onDeleteItem(I),-1!=T&&this._onNewItem(I))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:f);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(m):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),q.hitch(this,function(m){console.error("dijit.form.Select: "+m.toString());this.onLoadDeferred.reject(m)})));return g},_setValueAttr:function(a,f){this._onChangeActive||(f=null);if(this._loadingStore)this._pendingValue=a;else if(null!=a){a=q.isArrayLike(a)?C.map(a,function(c){return q.isObject(c)?c:{value:c}}):q.isObject(a)?[a]:[{value:a}];a=C.filter(this.getOptions(a),function(c){return c&&c.value});var d=this.getOptions()||[];this.multiple||a[0]&&a[0].value||!d.length||(a[0]=
d[0]);C.forEach(d,function(c){c.selected=C.some(a,function(m){return m.value===c.value})});d=C.map(a,function(c){return c.value});if("undefined"!=typeof d&&"undefined"!=typeof d[0]){var g=C.map(a,function(c){return c.label});this._setDisplay(this.multiple?g:g[0]);this.inherited(arguments,[this.multiple?d:d[0],f]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var a=C.map([].concat(this.get("selectedOptions")),function(f){return f&&"label"in f?f.label:f?f.value:null},this);return this.multiple?
a:a[0]},_setDisplayedValueAttr:function(a){this.set("value",this.getOptions("string"==typeof a?{label:a}:a))},_loadChildren:function(){this._loadingStore||(C.forEach(this._getChildren(),function(a){a.destroyRecursive()}),C.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var a=[].concat(this.value);if(a&&a[0]){var f=this;C.forEach(this._getChildren(),function(d){var g=C.some(a,function(c){return d.option&&
c===d.option.value});g&&!f.multiple&&(f.focusedChild=d);B.toggle(d.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),g);d.domNode.setAttribute("aria-selected",g?"true":"false")},this)}},_getValueFromOpts:function(){var a=this.getOptions()||[];if(!this.multiple&&a.length){var f=C.filter(a,function(d){return d.selected})[0];if(f&&f.value)return f.value;a[0].selected=!0;return a[0].value}return this.multiple?C.map(C.filter(a,function(d){return d.selected}),function(d){return d.value})||[]:""},
_onNewItem:function(a,f){f&&f.parent||this._addOptionForItem(a)},_onDeleteItem:function(a){this.removeOption({value:this.store.getIdentity(a)})},_onSetItem:function(a){this.updateOption(this._getOptionObjForItem(a))},_getOptionObjForItem:function(a){var f=this.store,d=this.labelAttr&&this.labelAttr in a?a[this.labelAttr]:f.getLabel(a);return{value:d?f.getIdentity(a):null,label:d,item:a}},_addOptionForItem:function(a){var f=this.store;f.isItemLoaded&&!f.isItemLoaded(a)?f.loadItem({item:a,onItem:function(d){this._addOptionForItem(d)},
scope:this}):(a=this._getOptionObjForItem(a),this.addOption(a))},constructor:function(a){this._oValue=(a||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);E.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?k("\x3e *",this.srcNodeRef).map(function(a){return"separator"===a.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:a.getAttribute("data-"+D._scopeName+"-value")||a.getAttribute("value"),
label:String(a.innerHTML),selected:a.getAttribute("selected")||!1,disabled:a.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);l.after(this,"onChange",q.hitch(this,"_updateSelection"));var a=this.store;a&&(a.getIdentity||a.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(a,this._oValue,
{query:this.query,queryOptions:this.queryOptions}));this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var a;a=this._notifyConnections.pop();)a.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(C){var O={};C.setObject("dojo.data.util.sorter",O);O.basicComparator=function(l,G){var K=-1;null===l&&(l=void 0);null===G&&(G=void 0);if(l==G)K=0;else if(l>G||null==l)K=1;return K};O.createSortFunction=function(l,G){function K(h,a,f,d){return function(g,c){g=d.getValue(g,h);c=d.getValue(c,h);
return a*f(g,c)}}for(var E=[],B,D=G.comparatorMap,q=O.basicComparator,k=0;k<l.length;k++){B=l[k];var w=B.attribute;if(w){B=B.descending?-1:1;var t=q;D&&("string"!==typeof w&&"toString"in w&&(w=w.toString()),t=D[w]||q);E.push(K(w,B,t,G))}}return function(h,a){for(var f=0;f<E.length;){var d=E[f++](h,a);if(0!==d)return d}return 0}};return O})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(C,O,l,G){return C("dijit.DropDownMenu",
G,{templateString:l,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(K){this._moveToPopup(K);K.stopPropagation();K.preventDefault()},_onLeftArrow:function(K){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else K.stopPropagation(),K.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(C,O,l,G,K,E,B,D,q,k,w,t,h,a,f){return O("dijit._MenuBase",[t,f,a,h],{selected:null,_setSelectedAttr:function(d){this.selected!=d&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),d&&d._setSelected(!0),this._set("selected",d))},activated:!1,_setActivatedAttr:function(d){K.toggle(this.domNode,"dijitMenuActive",d);K.toggle(this.domNode,"dijitMenuPassive",!d);this._set("activated",d)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,
childSelector:function(d){var g=w.byNode(d);return d.parentNode==this.containerNode&&g&&g.focus},postCreate:function(){var d=this,g="string"==typeof this.childSelector?this.childSelector:E.hitch(this,"childSelector");this.own(D(this.containerNode,D.selector(g,B.enter),function(){d.onItemHover(w.byNode(this))}),D(this.containerNode,D.selector(g,B.leave),function(){d.onItemUnhover(w.byNode(this))}),D(this.containerNode,D.selector(g,k),function(c){d.onItemClick(w.byNode(this),c);c.stopPropagation()}),
D(this.containerNode,D.selector(g,"focusin"),function(){d._onItemFocus(w.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(d,g,c,m){this.inherited(arguments);if(d&&(-1==m||d.popup&&1==m))this.onItemClick(d,g)},_keyboardSearchCompare:function(d,g){return d.shortcutKey?g==d.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(d){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,
d);else(d=this._getTopMenu())&&d._isMenuBar&&d.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(d){this.activated?(this.set("selected",d),!d.popup||d.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(d)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(d,
{type:"click"})},this.passivePopupDelay));this._hoveredChild=d;d._set("hovering",!0)},_onChildDeselect:function(d){this._stopPopupTimer();this.currentPopupItem==d&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;d._closePopup()},this.popupDelay))},onItemUnhover:function(d){this._hoveredChild==d&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);d._set("hovering",
!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var d=this;d.parentMenu;d=d.parentMenu);return d},onItemClick:function(d,g){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(d);if(d.disabled)return!1;d.popup?(this.set("selected",d),this.set("activated",!0),g=/^key/.test(g._origType||
g.type)||0==g.clientX&&0==g.clientY,this._openItemPopup(d,g)):(this.onExecute(),d._onClick?d._onClick(g):d.onClick(g))},_openItemPopup:function(d,g){if(d!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var c=d.popup;c.parentMenu=this;this.own(this._mouseoverHandle=D.once(c.domNode,"mouseover",E.hitch(this,"_onPopupHover")));var m=this;d._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){g&&
m.focusChild(d);m._cleanUp()},onExecute:E.hitch(this,"_cleanUp",!0),onClose:function(){m._mouseoverHandle&&(m._mouseoverHandle.remove(),delete m._mouseoverHandle)}},g);this.currentPopupItem=d}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(G.set(this.selected.focusNode,"tabIndex",this.tabIndex),
this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(d){if(this._hoveredChild&&this._hoveredChild!=d)this.onItemUnhover(this._hoveredChild);this.set("selected",d)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(d){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);d&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(C,O,l,G,K,E,B,D,q,k){return O("dijit._KeyNavContainer",[q,k,D],{connectKeyNavHandlers:function(w,t){var h=this._keyNavCodes={},a=E.hitch(this,"focusPrev"),f=E.hitch(this,"focusNext");C.forEach(w,function(d){h[d]=a});C.forEach(t,function(d){h[d]=f});h[K.HOME]=E.hitch(this,"focusFirstChild");h[K.END]=E.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){G.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);C.forEach(this.getChildren(),
E.hitch(this,"_startupChild"))},addChild:function(w,t){this.inherited(arguments);this._startupChild(w)},_startupChild:function(w){w.set("tabIndex","-1")},_getFirst:function(){var w=this.getChildren();return w.length?w[0]:null},_getLast:function(){var w=this.getChildren();return w.length?w[w.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(w){return(w=
B.byNode(w))&&w.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(C,O,l,G,K,E,B,D){return O("dijit._KeyNavMixin",D,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);l.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var q=this._keyNavCodes={};q[G.HOME]=K.hitch(this,"focusFirstChild");q[G.END]=K.hitch(this,
"focusLastChild");q[this.isLeftToRight()?G.LEFT_ARROW:G.RIGHT_ARROW]=K.hitch(this,"_onLeftArrow");q[this.isLeftToRight()?G.RIGHT_ARROW:G.LEFT_ARROW]=K.hitch(this,"_onRightArrow");q[G.UP_ARROW]=K.hitch(this,"_onUpArrow");q[G.DOWN_ARROW]=K.hitch(this,"_onDownArrow")}var k=this;q="string"==typeof this.childSelector?this.childSelector:K.hitch(this,"childSelector");this.own(E(this.domNode,"keypress",K.hitch(this,"_onContainerKeypress")),E(this.domNode,"keydown",K.hitch(this,"_onContainerKeydown")),E(this.domNode,
"focus",K.hitch(this,"_onContainerFocus")),E(this.containerNode,E.selector(q,"focusin"),function(w){k._onChildFocus(B.getEnclosingWidget(this),w)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(q,k){q&&(this.focusedChild&&q!==this.focusedChild&&this._onChildBlur(this.focusedChild),q.set("tabIndex",this.tabIndex),q.focus(k?"end":"start"))},_onContainerFocus:function(q){q.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){l.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(q){l.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(q){q&&q!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),q.set("tabIndex",this.tabIndex),this.lastFocused=q,this._set("focusedChild",q))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(q,k,w,t){q&&this.focusChild(q)},_keyboardSearchCompare:function(q,k){var w=q.domNode;q=(q.label||(w.focusNode?
w.focusNode.label:"")||w.innerText||w.textContent||"").replace(/^\s+/,"").substr(0,k.length).toLowerCase();return k.length&&q==k?-1:0},_isFormElement:function(q){return"INPUT"===q.tagName||"TEXTAREA"===q.tagName||"SELECT"===q.tagName||"BUTTON"===q.tagName},_onContainerKeydown:function(q){if(!this._isFormElement(document.activeElement)){var k=this._keyNavCodes[q.keyCode];k?(k(q,this.focusedChild),q.stopPropagation(),q.preventDefault(),this._searchString=""):q.keyCode!=G.SPACE||!this._searchTimer||
q.ctrlKey||q.altKey||q.metaKey||(q.stopImmediatePropagation(),q.preventDefault(),this._keyboardSearch(q," "))}},_onContainerKeypress:function(q){this._isFormElement(document.activeElement)||q.charCode<=G.SPACE||q.ctrlKey||q.altKey||q.metaKey||(q.preventDefault(),q.stopPropagation(),this._keyboardSearch(q,String.fromCharCode(q.charCode).toLowerCase()))},_keyboardSearch:function(q,k){var w=null,t,h=0;K.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=k;var a=/^(.)\1*$/.test(this._searchString)?
1:this._searchString.length;t=this._searchString.substr(0,a);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var f=this.focusedChild||null;if(1==a||!f)if(f=this._getNextFocusableChild(f,1),!f)return;a=f;do{var d=this._keyboardSearchCompare(f,t);d&&0==h++&&(w=f);if(-1==d){h=-1;break}f=this._getNextFocusableChild(f,1)}while(f&&f!=a)})();this.onKeyboardSearch(w,q,t,h)},_onChildBlur:function(){},_getNextFocusableChild:function(q,k){var w=
q;do{if(q)q=this._getNext(q,k);else if(q=this[0<k?"_getFirst":"_getLast"](),!q)break;if(null!=q&&q!=w&&q.isFocusable())return q}while(q!=w);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(q,k){if(q)for(q=q.domNode;q;)if((q=q[0>k?"previousSibling":"nextSibling"])&&"getAttribute"in q){var w=B.byNode(q);if(w)return w}return null}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(C,O,l,G,K,E,B,D,q,k,w,t){B=C("dijit.MenuItem"+(E("dojo-bidi")?"_NoBidi":""),[D,q,k,w],{templateString:t,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(h){this._set("label",h);var a="";var f=h.search(/{\S}/);if(0<=f){a=h.charAt(f+1);var d=h.substr(0,f);h=h.substr(f+3);f=d+a+h;h=d+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+a+"\x3c/span\x3e"+h}else f=h;this.domNode.setAttribute("aria-label",f+" "+this.accelKey);this.containerNode.innerHTML=h;this._set("shortcutKey",a)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(h){!h||"label"in this.params||this._set("label",h.innerHTML)},buildRendering:function(){this.inherited(arguments);l.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&l.set(this.accelKeyNode,"id",this.id+"_accel");O.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==E("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(h){}},_setSelected:function(h){G.toggle(this.domNode,
"dijitMenuItemSelected",h)},setLabel:function(h){K.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",h)},setDisabled:function(h){K.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",h)},_setDisabledAttr:function(h){this.focusNode.setAttribute("aria-disabled",h?"true":"false");this._set("disabled",h)},_setAccelKeyAttr:function(h){this.accelKeyNode&&(this.accelKeyNode.style.display=
h?"":"none",this.accelKeyNode.innerHTML=h,l.set(this.containerNode,"colSpan",h?"1":"2"));this._set("accelKey",h)}});E("dojo-bidi")&&(B=C("dijit.MenuItem",B,{_setLabelAttr:function(h){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return B})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(C,O){return C("dijit._Contained",null,{_getSibling:function(l){var G=this.getParent();return G&&G._getSiblingOfChild&&G._getSiblingOfChild(this,
"previous"==l?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var l=this.getParent();return l&&l.getIndexOfChild?l.getIndexOfChild(this):-1}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(C,O,l,G,K,E){return C("dijit.MenuSeparator",[l,G,K],{templateString:E,
buildRendering:function(){this.inherited(arguments);O.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/form/DateTextBox":function(){define(["dojo/_base/declare","../Calendar","./_DateTimeTextBox"],function(C,O,l){return C("dijit.form.DateTextBox",l,{baseClass:"dijitTextBox dijitComboBox dijitDateTextBox",popupClass:O,_selector:"date",maxHeight:Infinity,value:new Date("")})})},"dijit/Calendar":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff ./CalendarLite ./_Widget ./_CssStateMixin ./_TemplatedMixin ./form/DropDownButton".split(" "),
function(C,O,l,G,K,E,B,D,q,k,w,t,h,a,f,d,g){var c=G("dijit.Calendar",[h,a,f],{baseClass:"dijitCalendar",cssStateNodes:{decrementMonth:"dijitCalendarArrow",incrementMonth:"dijitCalendarArrow",previousYearLabelNode:"dijitCalendarPreviousYear",nextYearLabelNode:"dijitCalendarNextYear"},setValue:function(m){D.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",m)},_createMonthWidget:function(){return new c._MonthDropDownButton({id:this.id+"_mddb",
tabIndex:-1,onMonthSelect:k.hitch(this,"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},postCreate:function(){this.inherited(arguments);this.own(w(this.domNode,"keydown",k.hitch(this,"_onKeyDown")),w(this.dateRowsNode,"mouseover",k.hitch(this,"_onDayMouseOver")),w(this.dateRowsNode,"mouseout",k.hitch(this,"_onDayMouseOut")),w(this.dateRowsNode,"mousedown",k.hitch(this,"_onDayMouseDown")),w(this.dateRowsNode,"mouseup",k.hitch(this,"_onDayMouseUp")))},_onMonthSelect:function(m){var F=
new this.dateClassObj(this.currentFocus);F.setDate(1);F.setMonth(m);m=this.dateModule.getDaysInMonth(F);var I=this.currentFocus.getDate();F.setDate(Math.min(I,m));this._setCurrentFocusAttr(F)},_onDayMouseOver:function(m){(m=E.contains(m.target,"dijitCalendarDateLabel")?m.target.parentNode:m.target)&&(m.dijitDateValue&&!E.contains(m,"dijitCalendarDisabledDate")||m==this.previousYearLabelNode||m==this.nextYearLabelNode)&&(E.add(m,"dijitCalendarHoveredDate"),this._currentNode=m)},_onDayMouseOut:function(m){!this._currentNode||
m.relatedTarget&&m.relatedTarget.parentNode==this._currentNode||(m="dijitCalendarHoveredDate",E.contains(this._currentNode,"dijitCalendarActiveDate")&&(m+=" dijitCalendarActiveDate"),E.remove(this._currentNode,m),this._currentNode=null)},_onDayMouseDown:function(m){(m=m.target.parentNode)&&m.dijitDateValue&&!E.contains(m,"dijitCalendarDisabledDate")&&(E.add(m,"dijitCalendarActiveDate"),this._currentNode=m)},_onDayMouseUp:function(m){(m=m.target.parentNode)&&m.dijitDateValue&&E.remove(m,"dijitCalendarActiveDate")},
handleKey:function(m){var F=-1,I=this.currentFocus;switch(m.keyCode){case q.RIGHT_ARROW:F=1;case q.LEFT_ARROW:var M="day";this.isLeftToRight()||(F*=-1);break;case q.DOWN_ARROW:F=1;case q.UP_ARROW:M="week";break;case q.PAGE_DOWN:F=1;case q.PAGE_UP:M=m.ctrlKey||m.altKey?"year":"month";break;case q.END:I=this.dateModule.add(I,"month",1),M="day";case q.HOME:I=new this.dateClassObj(I);I.setDate(1);break;default:return!0}M&&(I=this.dateModule.add(I,M,F));this._setCurrentFocusAttr(I);return!1},_onKeyDown:function(m){this.handleKey(m)||
(m.stopPropagation(),m.preventDefault())},onValueSelected:function(){},onChange:function(m){this.onValueSelected(m)},getClassForDate:function(){}});c._MonthDropDownButton=G("dijit.Calendar._MonthDropDownButton",g,{onMonthSelect:function(){},postCreate:function(){this.inherited(arguments);this.dropDown=new c._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect})},_setMonthAttr:function(m){var F=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,m);this.dropDown.set("months",
F);this.containerNode.innerHTML=(6==t("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+this.dropDown.domNode.innerHTML+"\x3c/div\x3e")+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+F[m.getMonth()]+"\x3c/div\x3e"}});c._MonthDropDown=G("dijit.Calendar._MonthDropDown",[a,d,f],{months:[],baseClass:"dijitCalendarMonthMenu dijitMenu",templateString:"\x3cdiv data-dojo-attach-event\x3d'ondijitclick:_onClick'\x3e\x3c/div\x3e",_setMonthsAttr:function(m){this.domNode.innerHTML=
"";C.forEach(m,function(F,I){B.create("div",{className:"dijitCalendarMonthLabel",month:I,innerHTML:F},this.domNode)._cssState="dijitCalendarMonthLabel"},this)},_onClick:function(m){this.onChange(K.get(m.target,"month"))},onChange:function(){}});return c})},"dijit/CalendarLite":function(){define("dojo/_base/array dojo/_base/declare dojo/cldr/supplemental dojo/date dojo/date/locale dojo/date/stamp dojo/dom dojo/dom-class dojo/dom-attr dojo/_base/lang dojo/on dojo/sniff dojo/string ./_WidgetBase ./_TemplatedMixin dojo/text!./templates/Calendar.html ./a11yclick ./hccss".split(" "),
function(C,O,l,G,K,E,B,D,q,k,w,t,h,a,f,d){var g=O("dijit.CalendarLite",[a,f],{templateString:d,dowTemplateString:'\x3cth class\x3d"dijitReset dijitCalendarDayLabelTemplate" role\x3d"columnheader" scope\x3d"col"\x3e\x3cspan class\x3d"dijitCalendarDayLabel"\x3e${d}\x3c/span\x3e\x3c/th\x3e',dateTemplateString:'\x3ctd class\x3d"dijitReset" role\x3d"gridcell" data-dojo-attach-point\x3d"dateCells"\x3e\x3cspan class\x3d"dijitCalendarDateLabel" data-dojo-attach-point\x3d"dateLabels"\x3e\x3c/span\x3e\x3c/td\x3e',
weekTemplateString:'\x3ctr class\x3d"dijitReset dijitCalendarWeekTemplate" role\x3d"row"\x3e${d}${d}${d}${d}${d}${d}${d}\x3c/tr\x3e',value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",dayOffset:-1,currentFocus:new Date,_setSummaryAttr:"gridNode",baseClass:"dijitCalendar dijitCalendarLite",_isValidDate:function(c){return c&&!isNaN(c)&&"object"==typeof c&&c.toString()!=this.constructor.prototype.value.toString()},_getValueAttr:function(){var c=this._get("value");if(c&&!isNaN(c)){var m=
new this.dateClassObj(c);m.setHours(0,0,0,0);m.getDate()<c.getDate()&&(m=this.dateModule.add(m,"hour",1));return m}return null},_setValueAttr:function(c,m){"string"==typeof c&&(c=E.fromISOString(c));c=this._patchDate(c);if(this._isValidDate(c)&&!this.isDisabledDate(c,this.lang)){if(this._set("value",c),this.set("currentFocus",c),this._markSelectedDates([c]),this._created&&(m||"undefined"==typeof m))this.onChange(this.get("value"))}else this._set("value",null),this._markSelectedDates([])},_patchDate:function(c){if(c||
0===c)c=new this.dateClassObj(c),c.setHours(1,0,0,0);return c},_setText:function(c,m){for(;c.firstChild;)c.removeChild(c.firstChild);c.appendChild(c.ownerDocument.createTextNode(m))},_populateGrid:function(){var c=new this.dateClassObj(this.currentFocus);c.setDate(1);c=this._patchDate(c);var m=c.getDay(),F=this.dateModule.getDaysInMonth(c),I=this.dateModule.getDaysInMonth(this.dateModule.add(c,"month",-1)),M=new this.dateClassObj,T=0<=this.dayOffset?this.dayOffset:l.getFirstDayOfWeek(this.lang);T>
m&&(T-=7);if(!this.summary){var V=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,c);this.gridNode.setAttribute("summary",V[c.getMonth()])}this._date2cell={};C.forEach(this.dateCells,function(J,L){var aa=L+T,P=new this.dateClassObj(c),H="dijitCalendar",R=0;aa<m?(aa=I-m+aa+1,R=-1,H+="Previous"):aa>=m+F?(aa=aa-m-F+1,R=1,H+="Next"):(aa=aa-m+1,H+="Current");R&&(P=this.dateModule.add(P,"month",R));P.setDate(aa);this.dateModule.compare(P,M,"date")||(H="dijitCalendarCurrentDate "+H);
this.isDisabledDate(P,this.lang)?(H="dijitCalendarDisabledDate "+H,J.setAttribute("aria-disabled","true")):(H="dijitCalendarEnabledDate "+H,J.removeAttribute("aria-disabled"),J.setAttribute("aria-selected","false"));(R=this.getClassForDate(P,this.lang))&&(H=R+" "+H);J.className=H+"Month dijitCalendarDateTemplate";H=P.valueOf();this._date2cell[H]=J;J.dijitDateValue=H;H=P.getDateLocalized?P.getDateLocalized(this.lang):P.getDate();this._setText(this.dateLabels[L],H);q.set(J,"aria-label",K.format(P,{selector:"date",
formatLength:"long"}))},this)},_populateControls:function(){var c=new this.dateClassObj(this.currentFocus);c.setDate(1);this.monthWidget.set("month",c);var m=c.getFullYear()-1,F=new this.dateClassObj;C.forEach(["previous","current","next"],function(I){F.setFullYear(m++);this._setText(this[I+"YearLabelNode"],this.dateLocaleModule.format(F,{selector:"year",locale:this.lang}))},this)},goToToday:function(){this.set("value",new this.dateClassObj)},constructor:function(c){this.dateModule=c.datePackage?
k.getObject(c.datePackage,!1):G;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=c.datePackage?k.getObject(c.datePackage+".locale",!1):K},_createMonthWidget:function(){return g._MonthWidget({id:this.id+"_mddb",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},buildRendering:function(){var c=this.dowTemplateString,m=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),F=0<=this.dayOffset?this.dayOffset:l.getFirstDayOfWeek(this.lang);this.dayCellsHtml=
h.substitute([c,c,c,c,c,c,c].join(""),{d:""},function(){return m[F++%7]});c=h.substitute(this.weekTemplateString,{d:this.dateTemplateString});this.dateRowsHtml=[c,c,c,c,c,c].join("");this.dateCells=[];this.dateLabels=[];this.inherited(arguments);B.setSelectable(this.domNode,!1);c=new this.dateClassObj(this.currentFocus);this.monthWidget=this._createMonthWidget();this.set("currentFocus",c,!1)},postCreate:function(){this.inherited(arguments);this._connectControls()},_connectControls:function(){var c=
k.hitch(this,function(m,F,I){this[m].dojoClick=!0;return w(this[m],"click",k.hitch(this,function(){this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,F,I))}))});this.own(c("incrementMonth","month",1),c("decrementMonth","month",-1),c("nextYearLabelNode","year",1),c("previousYearLabelNode","year",-1))},_setCurrentFocusAttr:function(c,m){var F=this.currentFocus,I=this._getNodeByDate(F);c=this._patchDate(c);this._set("currentFocus",c);this._date2cell&&0==this.dateModule.difference(F,c,"month")||
(this._populateGrid(),this._populateControls(),this._markSelectedDates([this.value]));c=this._getNodeByDate(c);c.setAttribute("tabIndex",this.tabIndex);(this.focused||m)&&c.focus();I&&I!=c&&(t("webkit")?I.setAttribute("tabIndex","-1"):I.removeAttribute("tabIndex"))},focus:function(){this._setCurrentFocusAttr(this.currentFocus,!0)},_onDayClick:function(c){c.stopPropagation();c.preventDefault();for(c=c.target;c&&!c.dijitDateValue&&0!==c.dijitDateValue;c=c.parentNode);c&&!D.contains(c,"dijitCalendarDisabledDate")&&
this.set("value",c.dijitDateValue)},_getNodeByDate:function(c){return(c=this._patchDate(c))&&this._date2cell?this._date2cell[c.valueOf()]:null},_markSelectedDates:function(c){function m(F,I){D.toggle(I,"dijitCalendarSelectedDate",F);I.setAttribute("aria-selected",F?"true":"false")}C.forEach(this._selectedCells||[],k.partial(m,!1));this._selectedCells=C.filter(C.map(c,this._getNodeByDate,this),function(F){return F});C.forEach(this._selectedCells,k.partial(m,!0))},onChange:function(){},isDisabledDate:function(){},
getClassForDate:function(){}});g._MonthWidget=O("dijit.CalendarLite._MonthWidget",a,{_setMonthAttr:function(c){var m=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,c),F=6==t("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+C.map(m,function(I){return"\x3cdiv\x3e"+I+"\x3c/div\x3e"}).join("")+"\x3c/div\x3e";this.domNode.innerHTML=F+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+m[c.getMonth()]+"\x3c/div\x3e"}});return g})},"dijit/form/_DateTimeTextBox":function(){define("dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/_base/lang ./RangeBoundTextBox ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(C,O,l,G,K,E,B,D){new Date("X");return G("dijit.form._DateTimeTextBox",[E,B],{templateString:D,hasDownArrow:!0,cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_unboundedConstraints:{},pattern:O.regexp,datePackage:"",postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},compare:function(q,k){var w=this._isInvalidDate(q),t=this._isInvalidDate(k);if(w||t)return w&&t?0:w?-1:1;q=this.format(q,this._unboundedConstraints);k=this.format(k,this._unboundedConstraints);
w=this.parse(q,this._unboundedConstraints);t=this.parse(k,this._unboundedConstraints);return q==k?0:C.compare(w,t,this._selector)},autoWidth:!0,format:function(q,k){return q?this.dateLocaleModule.format(q,k):""},parse:function(q,k){return this.dateLocaleModule.parse(q,k)||(this._isEmpty(q)?null:void 0)},serialize:function(q,k){q.toGregorian&&(q=q.toGregorian());return l.toISOString(q,k)},dropDownDefaultValue:new Date,value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(q){q=
q||{};this.dateModule=q.datePackage?K.getObject(q.datePackage,!1):C;this.dateClassObj=this.dateModule.Date||Date;this.dateClassObj instanceof Date||(this.value=new this.dateClassObj(this.value));this.dateLocaleModule=q.datePackage?K.getObject(q.datePackage+".locale",!1):O;this._set("pattern",this.dateLocaleModule.regexp);this._invalidDate=this.constructor.prototype.value.toString()},buildRendering:function(){this.inherited(arguments);this.hasDownArrow||(this._buttonNode.style.display="none");this.hasDownArrow||
(this._buttonNode=this.domNode,this.baseClass+=" dijitComboBoxOpenOnClick")},_setConstraintsAttr:function(q){q.selector=this._selector;q.fullYear=!0;var k=l.fromISOString;"string"==typeof q.min&&(q.min=k(q.min),this.dateClassObj instanceof Date||(q.min=new this.dateClassObj(q.min)));"string"==typeof q.max&&(q.max=k(q.max),this.dateClassObj instanceof Date||(q.max=new this.dateClassObj(q.max)));this.inherited(arguments);this._unboundedConstraints=K.mixin({},this.constraints,{min:null,max:null})},_isInvalidDate:function(q){return!q||
isNaN(q)||"object"!=typeof q||q.toString()==this._invalidDate},_setValueAttr:function(q,k,w){void 0!==q&&("string"==typeof q&&(q=l.fromISOString(q)),this._isInvalidDate(q)&&(q=null),q instanceof Date&&!(this.dateClassObj instanceof Date)&&(q=new this.dateClassObj(q)));this.inherited(arguments,[q,k,w]);this.value instanceof Date&&(this.filterString="");!1!==k&&this.dropDown&&this.dropDown.set("value",q,!1)},_set:function(q,k){if("value"==q){k instanceof Date&&!(this.dateClassObj instanceof Date)&&
(k=new this.dateClassObj(k));var w=this._get("value");if(w instanceof this.dateClassObj&&0==this.compare(k,w))return}this.inherited(arguments)},_setDropDownDefaultValueAttr:function(q){this._isInvalidDate(q)&&(q=new this.dateClassObj);this._set("dropDownDefaultValue",q)},openDropDown:function(q){this.dropDown&&this.dropDown.destroy();var k=K.isString(this.popupClass)?K.getObject(this.popupClass,!1):this.popupClass,w=this,t=this.get("value");this.dropDown=new k({onChange:function(h){w.set("value",
h,!0)},id:this.id+"_popup",dir:w.dir,lang:w.lang,value:t,textDir:w.textDir,currentFocus:this._isInvalidDate(t)?this.dropDownDefaultValue:t,constraints:w.constraints,filterString:w.filterString,datePackage:w.datePackage,isDisabledDate:function(h){return!w.rangeCheck(h,w.constraints)}});this.inherited(arguments)},_getDisplayedValueAttr:function(){return this.textbox.value},_setDisplayedValueAttr:function(q,k){this._setValueAttr(this.parse(q,this.constraints),k,q)}})})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare",
"dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(C,O,l){return C("dijit.form.RangeBoundTextBox",l,{rangeMessage:"",rangeCheck:function(G,K){return("min"in K?0<=this.compare(G,K.min):!0)&&("max"in K?0>=this.compare(G,K.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var G=this.get("value");if(null==G)return!1;var K=!1;"min"in this.constraints&&(K=this.constraints.min,K=0>this.compare(G,"number"==typeof K&&
0<=K&&0!=G?0:K));!K&&"max"in this.constraints&&(K=this.constraints.max,K=0<this.compare(G,"number"!=typeof K||0<K?K:0));return K},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(G){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(G))},getErrorMessage:function(G){var K=this.get("value");return null==K||""===K||"number"==typeof K&&isNaN(K)||this.isInRange(G)?this.inherited(arguments):this.rangeMessage},
postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=O.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(C,O,l,G){return C("dijit.form.MappedTextBox",G,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(K){return K.toString?
K.toString():""},toString:function(){var K=this.filter(this.get("value"));return null!=K?"string"==typeof K?K:this.serialize(K,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=l.place("\x3cinput type\x3d'hidden'"+(this.name&&!O("msapp")?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},
"dijit/form/TimeTextBox":function(){define("dojo/_base/declare dojo/keys dojo/query dojo/_base/lang ../_TimePicker ./_DateTimeTextBox".split(" "),function(C,O,l,G,K,E){return C("dijit.form.TimeTextBox",E,{baseClass:"dijitTextBox dijitComboBox dijitTimeTextBox",popupClass:K,_selector:"time",value:new Date(""),maxHeight:-1,openDropDown:function(B){this.inherited(arguments);var D=l(".dijitTimePickerItemSelected",this.dropDown.domNode),q=this.dropDown.domNode.parentNode;q.scrollTop=D[0]?D[0].offsetTop-
(q.clientHeight-D[0].clientHeight)/2:(q.scrollHeight-q.clientHeight)/2;this.dropDown.on("input",G.hitch(this,function(){this.set("value",this.dropDown.get("value"),!1)}))},_onInput:function(){this.inherited(arguments);var B=this.get("displayedValue");this.filterString=B&&!this.parse(B,this.constraints)?B.toLowerCase():"";this._opened&&this.closeDropDown();this.openDropDown()}})})},"dijit/_TimePicker":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/sniff dojo/query dojo/mouse dojo/on ./_WidgetBase ./form/_ListMouseMixin".split(" "),
function(C,O,l,G,K,E,B,D,q,k,w,t,h,a,f,d){return K("dijit._TimePicker",[f,d],{baseClass:"dijitTimePicker",pickerMin:"T00:00:00",pickerMax:"T23:59:59",clickableIncrement:"T00:15:00",visibleIncrement:"T01:00:00",value:new Date,_visibleIncrement:2,_clickableIncrement:1,_totalIncrements:10,constraints:{},serialize:G.toISOString,buildRendering:function(){this.inherited(arguments);this.timeMenu=this.containerNode=this.domNode},setValue:function(g){D.deprecated("dijit._TimePicker:setValue() is deprecated.  Use set('value', ...) instead.",
"","2.0");this.set("value",g)},_setValueAttr:function(g){this._set("value",g);this._showText()},_setFilterStringAttr:function(g){this._set("filterString",g);this._showText()},isDisabledDate:function(){return!1},_getFilteredNodes:function(g,c,m,F){g=this.ownerDocument.createDocumentFragment();for(c=0;c<this._maxIncrement;c++)(m=this._createOption(c))&&g.appendChild(m);return g},_showText:function(){var g=G.fromISOString;this.domNode.innerHTML="";this._clickableIncrementDate=g(this.clickableIncrement);
this._visibleIncrementDate=g(this.visibleIncrement);var c=function(F){return 3600*F.getHours()+60*F.getMinutes()+F.getSeconds()},m=c(this._clickableIncrementDate);c=c(this._visibleIncrementDate);(this.value||this.currentFocus).getTime();this._refDate=g(this.pickerMin);this._refDate.setFullYear(1970,0,1);this._clickableIncrement=1;this._visibleIncrement=c/m;g=g(this.pickerMax);g.setFullYear(1970,0,1);g=.001*(g.getTime()-this._refDate.getTime());this._maxIncrement=Math.ceil((g+1)/m);m=this._getFilteredNodes();
!m.firstChild&&this.filterString?(this.filterString="",this._showText()):this.domNode.appendChild(m)},constructor:function(){this.constraints={}},postMixInProperties:function(){this.inherited(arguments);this._setConstraintsAttr(this.constraints)},_setConstraintsAttr:function(g){for(var c in{clickableIncrement:1,visibleIncrement:1,pickerMin:1,pickerMax:1})c in g&&(this[c]=g[c]);g.locale||(g.locale=this.lang)},_createOption:function(g){var c=new Date(this._refDate),m=this._clickableIncrementDate;c.setHours(c.getHours()+
m.getHours()*g,c.getMinutes()+m.getMinutes()*g,c.getSeconds()+m.getSeconds()*g);"time"==this.constraints.selector&&c.setFullYear(1970,0,1);var F=l.format(c,this.constraints);if(this.filterString&&0!==F.toLowerCase().indexOf(this.filterString))return null;m=this.ownerDocument.createElement("div");m.className=this.baseClass+"Item";m.date=c;m.idx=g;B.create("div",{"class":this.baseClass+"ItemInner",innerHTML:F},m);F=1>g%this._visibleIncrement&&-1<g%this._visibleIncrement;g=!F&&!(g%this._clickableIncrement);
F?m.className+=" "+this.baseClass+"Marker":g&&(m.className+=" "+this.baseClass+"Tick");this.isDisabledDate(c)&&(m.className+=" "+this.baseClass+"ItemDisabled");this.value&&!O.compare(this.value,c,this.constraints.selector)&&(m.selected=!0,m.className+=" "+this.baseClass+"ItemSelected",this._selectedDiv=m,F?m.className+=" "+this.baseClass+"MarkerSelected":g&&(m.className+=" "+this.baseClass+"TickSelected"),this._highlightOption(m,!0));return m},onOpen:function(){this.inherited(arguments);this.set("selected",
this._selectedDiv)},_onOptionSelected:function(g,c){(g=g.target.date||g.target.parentNode.date)&&!this.isDisabledDate(g)&&(this._set("value",g),this.emit("input"),c&&(this._highlighted_option=null,this.set("value",g),this.onChange(g)))},onChange:function(){},_highlightOption:function(g,c){if(g){if(c)this._highlighted_option&&this._highlightOption(this._highlighted_option,!1),this._highlighted_option=g;else{if(this._highlighted_option!==g)return;this._highlighted_option=null}E.toggle(g,this.baseClass+
"ItemHover",c);E.contains(g,this.baseClass+"Marker")?E.toggle(g,this.baseClass+"MarkerHover",c):E.toggle(g,this.baseClass+"TickHover",c)}},handleKey:function(g){if(g.keyCode==q.DOWN_ARROW)return this.selectNextNode(),this._onOptionSelected({target:this._highlighted_option},!1),g.stopPropagation(),g.preventDefault(),!1;if(g.keyCode==q.UP_ARROW)return this.selectPreviousNode(),this._onOptionSelected({target:this._highlighted_option},!1),g.stopPropagation(),g.preventDefault(),!1;if(g.keyCode==q.ENTER||
g.keyCode===q.TAB){if(!this._keyboardSelected&&g.keyCode===q.TAB)return!0;this._highlighted_option&&this._onOptionSelected({target:this._highlighted_option},!0);return g.keyCode===q.TAB}},onHover:function(g){this._highlightOption(g,!0)},onUnhover:function(g){this._highlightOption(g,!1)},onSelect:function(g){this._highlightOption(g,!0)},onDeselect:function(g){this._highlightOption(g,!1)},onClick:function(g){this._onOptionSelected({target:g},!0)}})})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare",
"dojo/on","dojo/touch","./_ListBase"],function(C,O,l,G){return C("dijit.form._ListMouseMixin",G,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover","_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(K,E){this._setSelectedAttr(E,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=
this.defer(function(){this._deferredClick=null;this.onClick(E)})},_onMouseDown:function(K,E){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(E,!1)},_onMouseUp:function(K,E){this._isDragging=!1;var B=this.selected,D=this._hoveredNode;B&&E==B?this.defer(function(){this._onClick(K,B)}):D&&this.defer(function(){this._onClick(K,D)})},_onMouseOut:function(K,E){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=
null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(K,E){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=E;this.onHover(E);this._isDragging&&this._setSelectedAttr(E,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on","dojo/window"],function(C,O,l){return C("dijit.form._ListBase",null,{selected:null,_listConnect:function(G,K){var E=this;return E.own(O(E.containerNode,
O.selector(function(B,D,q){return B.parentNode==q},G),function(B){E[K](B,this)}))},selectFirstNode:function(){for(var G=this.containerNode.firstChild;G&&"none"==G.style.display;)G=G.nextSibling;this._setSelectedAttr(G,!0)},selectLastNode:function(){for(var G=this.containerNode.lastChild;G&&"none"==G.style.display;)G=G.previousSibling;this._setSelectedAttr(G,!0)},selectNextNode:function(){var G=this.selected;if(G){for(G=G.nextSibling;G&&"none"==G.style.display;)G=G.nextSibling;G?this._setSelectedAttr(G,
!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var G=this.selected;if(G){for(G=G.previousSibling;G&&"none"==G.style.display;)G=G.previousSibling;G?this._setSelectedAttr(G,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(G,K){if(this.selected!=G){var E=this.selected;if(E)this.onDeselect(E);G&&(K&&l.scrollIntoView(G),this.onSelect(G));this._set("selected",G)}else if(G)this.onSelect(G)}})})},"dojo/data/ObjectStore":function(){define("../_base/lang ../Evented ../_base/declare ../_base/Deferred ../promise/all ../_base/array ../_base/connect ../regexp".split(" "),
function(C,O,l,G,K,E,B,D){function q(k){return"*"==k?".*":"?"==k?".":k}return l("dojo.data.ObjectStore",[O],{objectStore:null,constructor:function(k){this._dirtyObjects=[];k.labelAttribute&&(k.labelProperty=k.labelAttribute);C.mixin(this,k)},labelProperty:"label",getValue:function(k,w,t){return"function"===typeof k.get?k.get(w):w in k?k[w]:t},getValues:function(k,w){k=this.getValue(k,w);return k instanceof Array?k:void 0===k?[]:[k]},getAttributes:function(k){var w=[],t;for(t in k)!k.hasOwnProperty(t)||
"_"==t.charAt(0)&&"_"==t.charAt(1)||w.push(t);return w},hasAttribute:function(k,w){return w in k},containsValue:function(k,w,t){return-1<E.indexOf(this.getValues(k,w),t)},isItem:function(k){return"object"==typeof k&&k&&!(k instanceof Date)},isItemLoaded:function(k){return k&&"function"!==typeof k.load},loadItem:function(k){var w;"function"===typeof k.item.load?G.when(k.item.load(),function(t){w=t;var h=t instanceof Error?k.onError:k.onItem;h&&h.call(k.scope,t)}):k.onItem&&k.onItem.call(k.scope,k.item);
return w},close:function(k){return k&&k.abort&&k.abort()},fetch:function(k){function w(c){k.onError&&k.onError.call(h,c,k)}k=C.delegate(k,k&&k.queryOptions);var t=this,h=k.scope||t,a=k.query;if("object"==typeof a){a=C.delegate(a);for(var f in a){var d=a[f];"string"==typeof d&&(a[f]=RegExp("^"+D.escapeString(d,"*?\\").replace(/\\.|\*|\?/g,q)+"$",k.ignoreCase?"mi":"m"),a[f].toString=function(c){return function(){return c}}(d))}}var g=this.objectStore.query(a,k);G.when(g.total,function(c){G.when(g,function(m){k.onBegin&&
k.onBegin.call(h,c||m.length,k);if(k.onItem)for(var F=0;F<m.length;F++)k.onItem.call(h,m[F],k);k.onComplete&&k.onComplete.call(h,k.onItem?null:m,k);return m},w)},w);k.abort=function(){g.cancel&&g.cancel()};g.observe&&(this.observing&&this.observing.cancel(),this.observing=g.observe(function(c,m,F){if(-1==E.indexOf(t._dirtyObjects,c))if(-1==m)t.onNew(c);else if(-1==F)t.onDelete(c);else for(var I in c)if(I!=t.objectStore.idProperty)t.onSet(c,I,null,c[I])},!0));this.onFetch(g);k.store=this;return k},
getFeatures:function(){return{"dojo.data.api.Read":!!this.objectStore.get,"dojo.data.api.Identity":!0,"dojo.data.api.Write":!!this.objectStore.put,"dojo.data.api.Notification":!0}},getLabel:function(k){if(this.isItem(k))return this.getValue(k,this.labelProperty)},getLabelAttributes:function(k){return[this.labelProperty]},getIdentity:function(k){return this.objectStore.getIdentity?this.objectStore.getIdentity(k):k[this.objectStore.idProperty||"id"]},getIdentityAttributes:function(k){return[this.objectStore.idProperty]},
fetchItemByIdentity:function(k){var w;G.when(this.objectStore.get(k.identity),function(t){w=t;k.onItem.call(k.scope,t)},function(t){k.onError.call(k.scope,t)});return w},newItem:function(k,w){if(w){var t=this.getValue(w.parent,w.attribute,[]);t=t.concat([k]);k.__parent=t;this.setValue(w.parent,w.attribute,t)}this._dirtyObjects.push({object:k,save:!0});this.onNew(k);return k},deleteItem:function(k){this.changing(k,!0);this.onDelete(k)},setValue:function(k,w,t){var h=k[w];this.changing(k);k[w]=t;this.onSet(k,
w,h,t)},setValues:function(k,w,t){if(!C.isArray(t))throw Error("setValues expects to be passed an Array object as its value");this.setValue(k,w,t)},unsetAttribute:function(k,w){this.changing(k);var t=k[w];delete k[w];this.onSet(k,w,t,void 0)},changing:function(k,w){k.__isDirty=!0;for(var t=0;t<this._dirtyObjects.length;t++){var h=this._dirtyObjects[t];if(k==h.object){w&&(h.object=!1,this._saveNotNeeded||(h.save=!0));return}}h=k instanceof Array?[]:{};for(t in k)k.hasOwnProperty(t)&&(h[t]=k[t]);this._dirtyObjects.push({object:!w&&
k,old:h,save:!this._saveNotNeeded})},save:function(k){k=k||{};var w=[],t=[],h=this,a=this._dirtyObjects;try{B.connect(k,"onError",function(){if(!1!==k.revertOnError){var I=a;a=t;h.revert();h._dirtyObjects=I}else h._dirtyObjects=a.concat(t)});var f;this.objectStore.transaction&&(f=this.objectStore.transaction());for(var d=0;d<a.length;d++){var g=a[d],c=g.object,m=g.old;delete c.__isDirty;if(c){var F=this.objectStore.put(c,{overwrite:!!m});w.push(F)}else"undefined"!=typeof m&&(F=this.objectStore.remove(this.getIdentity(m)),
w.push(F));t.push(g);a.splice(d--,1)}K(w).then(function(I){k.onComplete&&k.onComplete.call(k.scope,I)},function(I){k.onError&&k.onError.call(k.scope,I)});f&&f.commit()}catch(I){k.onError.call(k.scope,value)}},revert:function(){for(var k=this._dirtyObjects,w=k.length;0<w;){w--;var t=k[w],h=t.object;t=t.old;if(h&&t){for(var a in t)t.hasOwnProperty(a)&&h[a]!==t[a]&&(this.onSet(h,a,h[a],t[a]),h[a]=t[a]);for(a in h)t.hasOwnProperty(a)||(this.onSet(h,a,h[a]),delete h[a])}else if(t)this.onNew(t);else this.onDelete(h);
delete (h||t).__isDirty;k.splice(w,1)}},isDirty:function(k){return k?k.__isDirty:!!this._dirtyObjects.length},onSet:function(){},onNew:function(){},onDelete:function(){},onFetch:function(k){}})})},"esri/dijit/Search":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Evented dojo/Deferred dojo/keys dojo/on dojo/query dojo/uacss dojo/regexp dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-style dojo/dom-construct dojo/date/locale dojo/i18n!../nls/jsapi dojo/text!./Search/templates/Search.html dijit/_WidgetBase dijit/_TemplatedMixin dijit/_FocusMixin dijit/a11yclick dijit/focus ../lang ../InfoTemplate ../kernel ../SpatialReference ../graphic ../promiseList ../symbols/PictureMarkerSymbol ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/TextSymbol ../symbols/Font ../geometry/Point ../geometry/Extent ../geometry/normalizeUtils ../geometry/scaleUtils ../tasks/locator ../tasks/query ../Color ../styles/basic".split(" "),
function(C,O,l,G,K,E,B,D,q,k,w,t,h,a,f,d,g,c,m,F,I,M,T,V,J,L,aa,P,H,R,y,Y,da,z,v,u,Q,fa,ea,ka,qa,pa,xa,ya){function Ea(n,N){n&&N&&(n._layer=N,n._sourceLayer=N)}O=O([F,I,M,K],{declaredClass:"esri.dijit.Search",templateString:m,reHostedFS:/https?:\/\/services.*\.arcgis\.com/i,constructor:function(n,N){this.css={searchGroup:"searchGroup",searchInput:"searchInput",searchInputGroup:"searchInputGroup",searchBtn:"searchBtn",searchSubmit:"searchSubmit",searchIcon:"searchIcon esri-icon-search",searchButtonText:"searchButtonText",
searchToggle:"searchToggle",searchToggleIcon:"searchIcon esri-icon-down-arrow",searchMenu:"searchMenu",searchMenuHeader:"menuHeader",searchClear:"searchClear",searchClearIcon:"searchIcon esri-icon-close searchClose",searchSpinner:"searchIcon esri-icon-loading-indicator searchSpinner",searchSourceName:"sourceName",suggestionsMenu:"suggestionsMenu",sourcesMenu:"sourcesMenu",activeSource:"active",hasValue:"hasValue",hasButtonMode:"hasButtonMode",hasMultipleSources:"hasMultipleSources",showSuggestions:"showSuggestions",
showSources:"showSources",showNoResults:"showNoResults",searchLoading:"searchLoading",latLonHeader:"searchLatLongHeader",searchMoreResults:"moreResults",searchMoreResultsList:"resultsList",searchMoreResultsHeader:"moreHeader",searchMoreResultsItem:"moreItem",searchMoreResultsListHeader:"popupHeader",searchShowMoreResults:"showMoreResults",searchNoResultsMenu:"noResultsMenu",searchNoResultsBody:"noResultsBody",searchNoResultsHeader:"noResultsHeader",searchNoValueIcon:"noValueIcon esri-icon-notice-triangle",
searchNoValueText:"noValueText",searchNoResultsText:"noResultsText",searchExpandContainer:"searchExpandContainer",searchAnimateContainer:"searchAnimate",searchExpanded:"searchExpanded",searchCollapsed:"searchCollapsed",searchClearFloat:"searchClearFloat"};this._allIndex="all";this._objectIdIdentifier="_objectId";this._deferreds=[];this._sourceNames=[];this.defaultSource={locator:new qa("//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"),singleLineFieldName:"SingleLine",outFields:["Addr_type",
"Match_addr","StAddr","City"],name:c.widgets.Search.main.esriLocatorName,localSearchOptions:{minScale:3E5,distance:5E4},placeholder:c.widgets.Search.main.placeholder,highlightSymbol:(new y(C.toUrl("./Search/images/search-pointer.png"),36,36)).setOffset(9,18)};this.options={map:null,theme:"arcgisSearch",visible:!0,value:"",allPlaceholder:"",sources:[this.defaultSource],activeSourceIndex:0,suggestionDelay:350,enableSourcesMenu:!0,enableSuggestionsMenu:!0,enableInfoWindow:!0,showInfoWindowOnSelect:!0,
enableSuggestions:!0,enableButtonMode:!1,autoNavigate:!0,autoSelect:!0,addLayersFromMap:!1,zoomScale:1E3,graphicsLayer:null,enableHighlight:!0,highlightGraphic:null,enableLabel:!1,labelSymbol:(new v).setColor(new xa([181,56,46,.9])).setFont(new u("14px",u.STYLE_NORMAL,u.VARIANT_NORMAL,u.WEIGHT_BOLD,"Arial")),labelGraphic:null,infoTemplate:new L(c.widgets.Search.main.searchResult,'\x3cdiv class\x3d"${searchTheme}"\x3e\x3cdiv id\x3d"${searchMoreResultsId}" class\x3d"${searchMoreResults}"\x3e\x3cdiv class\x3d"${searchMoreResultsItem}"\x3e${searchResult}\x3c/div\x3e\x3cdiv\x3e${searchMoreResultsHtml}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'),
searchResults:null,suggestResults:null,selectedResult:null,magicKey:null,selectedFeatureId:null,expanded:!1,maxLength:128,maxResults:6,maxSuggestions:6,locationToAddressDistance:1500,minCharacters:3,enableSearchingAll:!0};n=l.mixin({},this.options,n);this.set(n);this._updateActiveSource();this._i18n=c;this._defaultSR=new P(4326);this.domNode=N},startup:function(){this.inherited(arguments);this.sources||(this.sources=[]);this._mapLoaded().then(l.hitch(this,this._init))},postCreate:function(){var n=
this;this.inherited(arguments);this._moreResultsId=this.id+"_more_results";this.own(D(this.submitNode,T,l.hitch(this,this._searchButton)));this.own(D(this.sourcesBtnNode,T,l.hitch(this,this._toggleSourcesMenu)));this.own(D(this.inputNode,T,l.hitch(this,this._inputClick)));this.own(D(this.clearNode,T,l.hitch(this,this._clearButton)));this.own(D(this.formNode,"submit",l.hitch(this,function(N){N.preventDefault();this._cancelSuggest();this.search()})));this.own(D(this.inputNode,"keyup",l.hitch(this,function(N){this._inputKey(N)})));
this.own(D(this.sourcesBtnNode,"keyup",l.hitch(this,function(N){this._sourceBtnKey(N)})));this.own(D(this.suggestionsNode,"li:click, li:keyup",function(N){n._suggestionsEvent(N,this)}));this.own(D(this.sourcesNode,"li:click, li:keyup",function(N){n._sourcesEvent(N,this)}));this.own(D(this.inputNode,"input, paste",l.hitch(this,function(){this._suggestDelay()})));this.map&&this.map.infoWindow&&this.map.infoWindow.domNode&&this.enableInfoWindow&&(this.own(D(this.map.infoWindow.domNode,"#"+this._moreResultsId+
"_show:click",l.hitch(this,function(N){this._showMoreResultsClick(N)}))),this.own(D(this.map.infoWindow.domNode,"#"+this._moreResultsId+"_list li a:click",l.hitch(this,function(N){this._moreResultsClick(N)}))),this.own(D(this.map.infoWindow.domNode,"#"+this._moreResultsId+" [data-switch-coordinates]:click",l.hitch(this,function(N){this._switchCoordinatesClick(N)}))));this.value&&this._checkStatus();this._hideMenus();this._updateVisible();this._insertSources(this.sources);this._setPlaceholder(this.activeSourceIndex);
this._updateButtonMode(this.enableButtonMode);this.toggle(this.expanded)},destroy:function(){this.clear();d.empty(this.domNode);this.inherited(arguments)},clear:function(){this.clearGraphics();h.get(this.inputNode,"value")&&h.set(this.inputNode,"value","");this._changeAttrValue("value","");this.set("searchResults",null);this.set("suggestResults",null);this.set("selectedResult",null);this.set("magicKey",null);this.set("selectedFeatureId",null);a.remove(this.containerNode,this.css.hasValue);h.set(this.clearNode,
"title","");this._hideMenus();this._closePopup();this._hideLoading();this.emit("clear-search")},show:function(){f.set(this.domNode,"display","block")},hide:function(){f.set(this.domNode,"display","none")},expand:function(){this.enableButtonMode&&(a.add(this.containerNode,this.css.searchExpanded),a.remove(this.containerNode,this.css.searchCollapsed),this._hideMenus(),this.set("expanded",!0))},collapse:function(){this.enableButtonMode&&(a.remove(this.containerNode,this.css.searchExpanded),a.add(this.containerNode,
this.css.searchCollapsed),this._hideMenus(),this.set("expanded",!1))},toggle:function(n){this.enableButtonMode&&("undefined"===typeof n&&(n=!this.expanded),n?this.expand():this.collapse())},search:function(n){var N=new E;this._mapLoaded().then(l.hitch(this,function(){this._searchDeferred(n).then(l.hitch(this,function(W){var U=W.results;this.set("searchResults",U);0===W.numResults&&(this._noResults(W.value),this._showNoResultsMenu());this._hideLoading();this.emit("search-results",W);this._selectFirstResult(U,
W.activeSourceIndex);N.resolve(U)}),l.hitch(this,function(W){N.reject(W)}))}));return N.promise},suggest:function(n){var N=new E;this._mapLoaded().then(l.hitch(this,function(){this._suggestDeferred(n).then(l.hitch(this,function(W){if(W){var U=W.results;this.set("suggestResults",U);this._insertSuggestions(U,W.value);this.emit("suggest-results",W);N.resolve(U)}}),l.hitch(this,function(W){N.reject(W)}))}));return N.promise},select:function(n){var N=this._getDefaultSymbol(n),W=this.labelSymbol,U=this.sources,
ca=this.activeSourceIndex,ja=this.enableHighlight,oa=this.enableLabel,Aa=this.autoNavigate,ra=this.showInfoWindowOnSelect,wa=this.enableInfoWindow,la=this.infoTemplate,ua=n.feature?new H(n.feature.toJson()):null,Ia=ua?n.feature._sourceLayer:null;Ea(ua,Ia);if(ca===this._allIndex){var Ka=this._getSourceIndexOfResult(n);if(null!==Ka){var Ba=U[Ka];ca=Ka}}else Ba=U[ca];Ba&&(Ba.hasOwnProperty("highlightSymbol")&&(N=Ba.highlightSymbol),Ba.hasOwnProperty("labelSymbol")&&(W=Ba.labelSymbol),Ba.hasOwnProperty("enableHighlight")&&
(ja=Ba.enableHighlight),Ba.hasOwnProperty("enableLabel")&&(oa=Ba.enableLabel),Ba.hasOwnProperty("autoNavigate")&&(Aa=Ba.autoNavigate),Ba.hasOwnProperty("showInfoWindowOnSelect")&&(ra=Ba.showInfoWindowOnSelect),Ba.hasOwnProperty("enableInfoWindow")&&(wa=Ba.enableInfoWindow),Ba.hasOwnProperty("infoTemplate")?la=Ba.infoTemplate:Ba.featureLayer&&Ba.featureLayer.infoTemplate&&(la=Ba.featureLayer.infoTemplate));this._hideMenus();this._hideLoading();if(ua){U=this.highlightGraphic;var Pa=this.graphicsLayer;
Ka=this.labelGraphic;var Sa=l.mixin({},ua.attributes,{searchTheme:this.theme,searchResult:this._searchResultHTML(n),searchMoreResults:this.css.searchMoreResults,searchMoreResultsItem:this.css.searchMoreResultsItem,searchMoreResultsId:this._moreResultsId,searchMoreResultsHtml:this._moreResultsHTML(n)}),Va=null;wa&&(Va=la);Ka?(Ka.setGeometry(ua.geometry),Ka.setAttributes(Sa),Ka.setSymbol(W),W&&"textsymbol"===W.type&&Ka.symbol.setText(n.name)):(Ka=new H(ua.geometry,W,Sa),Ea(Ka,Ia),W&&"textsymbol"===
W.type&&Ka.symbol.setText(n.name),oa&&(Pa?Pa.add(Ka):this.map&&this.map.graphics&&this.map.graphics.add(Ka)));U?(U.setGeometry(ua.geometry),U.setAttributes(Sa),U.setInfoTemplate(Va),U.setSymbol(N)):(U=new H(ua.geometry,N,Sa,Va),Ea(U,Ia),ja&&(Pa?Pa.add(U):this.map&&this.map.graphics&&this.map.graphics.add(U)));U&&U.symbol&&"textsymbol"===U.symbol.type&&U.symbol.setText(n.name);this.map&&this.map.infoWindow&&wa&&ra&&(this.map.infoWindow.setFeatures([U]),N=this._getPointFromGeometry(U.geometry),this.map.infoWindow.show(N));
this.map&&Aa&&n&&n.hasOwnProperty("extent")&&"function"===typeof this.map.setExtent&&this.map.setExtent(n.extent,!0);this.set("highlightGraphic",U);this.set("labelGraphic",Ka)}this.set("selectedResult",n);this.emit("select-result",{result:n,source:Ba,sourceIndex:ca})},focus:function(){V.focus(this.inputNode)},blur:function(){this.inputNode.blur();V.curNode&&V.curNode.blur()},clearGraphics:function(){var n=this.highlightGraphic,N=this.graphicsLayer,W=this.labelGraphic;n&&(N?N.remove(n):this.map&&this.map.graphics&&
this.map.graphics.remove(n));W&&(N?N.remove(W):this.map&&this.map.graphics&&this.map.graphics.remove(W));this.set("labelGraphic",null);this.set("highlightGraphic",null)},_mapLoaded:function(){var n=new E;if(this.map)if(this.map.loaded)n.resolve();else D.once(this.map,"load",l.hitch(this,function(){n.resolve()}));else n.resolve();return n.promise},_init:function(){this._getMapLayers().then(l.hitch(this,function(){this.set("loaded",!0);this.emit("load")}))},_clearButton:function(){this.clear();V.focus(this.inputNode)},
_error:function(n){return Error(this.declaredClass+" "+n)},_searchDeferred:function(n){var N=new E,W=this.value,U=this.activeSourceIndex;n&&n.hasOwnProperty("index")&&(U=n.index);this._showLoading();this._hideMenus();this._closePopup();this.clearGraphics();var ca={magicKey:this.magicKey,text:W};n?"string"===typeof n?(ca.text=n,n=this._searchQueries(ca)):n="object"===typeof n&&n.hasOwnProperty("magicKey")?this._searchQueries(n):"object"===typeof n&&n.hasOwnProperty("geometry")?this._searchQueries({geometry:n}):
"object"===typeof n&&n.hasOwnProperty(this._objectIdIdentifier)?this._searchQueries(n):"object"===typeof n&&"point"===n.type?this._searchQueries({point:n}):n instanceof Array&&2===n.length?this._searchQueries({latlon:n}):this._searchQueries(ca):n=this._searchQueries(ca);n.always(l.hitch(this,function(ja){ja=this._formatResults(ja,U,W);N.resolve(ja)}));return N.promise},_suggestDeferred:function(n){var N=new E;this._deferreds.push(N);n||(n=this.value);var W=this.activeSourceIndex;this._suggestQueries({text:n}).always(l.hitch(this,
function(U){var ca;if(U)for(var ja=0;ja<U.length;ja++)U[ja]&&(ca=!0);ca?(U=this._formatResults(U,W,n),N.resolve(U)):N.resolve()}));return N.promise},_getDefaultSymbol:function(n){var N;this.map&&(N=this.map.getBasemap());N||(N="topo");if(n&&n.feature&&n.feature.geometry)var W=n.feature.geometry.type;"polyline"===W?W="line":"circle"===W||"extent"===W?W="polygon":"multipoint"===W&&(W="point");if(W){if(n=ya.getSchemes({theme:"default",basemap:N,geometryType:W}))var U=n.primaryScheme;if(U){U.color&&U.hasOwnProperty("opacity")&&
(U.color.a=U.opacity);var ca=U;n=U.color;U=U.size;switch(W){case "point":var ja=new Y;ja.setColor(n);ja.setSize(null!==U?U:ca.size);W=new da;W.setColor(ca.outline.color);W.setWidth(ca.outline.width);ja.setOutline(W);break;case "line":ja=new da;ja.setColor(n);ja.setWidth(null!==U?U:ca.width);break;case "polygon":ja=new z,ja.setColor(n),W=new da,W.setColor(ca.outline.color),W.setWidth(ca.outline.width),ja.setOutline(W)}ca=ja}}return ca},_selectFirstResult:function(n,N){if(this.autoSelect&&n){var W;
N===this._allIndex?W=this._getFirstResult(n):n[N]&&n[N][0]&&(W=n[N][0]);W&&this.select(W)}},_getSourceIndexOfResult:function(n){var N=this.searchResults;if(N)for(var W in N)if(N[W]&&N[W].length)for(var U=0;U<N[W].length;U++)if(N[W][U]===n)return parseInt(W,10);return null},_getFirstResult:function(n){if(n)for(var N in n)if(n[N]&&n[N][0])return n[N][0];return!1},_onFocus:function(){this.map&&"function"===typeof this.map.disableKeyboardNavigation&&this.map.disableKeyboardNavigation();this.emit("focus");
this.inherited(arguments)},_onBlur:function(){this._hideMenus();this.map&&"function"===typeof this.map.enableKeyboardNavigation&&this.map.enableKeyboardNavigation();this.enableButtonMode&&this.loaded&&this.collapse();this.emit("blur");this.inherited(arguments)},_getMapLayers:function(){var n=new E;if(this.addLayersFromMap&&this.map){var N=[],W=this.map.graphicsLayerIds;if(W&&W.length){for(var U=0;U<W.length;U++){var ca=this.map.getLayer(W[U]);ca&&N.push(this._featureLayerLoaded(ca))}R(N).always(l.hitch(this,
function(ja){for(var oa,Aa=this.sources,ra=0;ra<ja.length;ra++)ja[ra]&&ja[ra].loaded&&"Feature Layer"===ja[ra].type&&(Aa.push({featureLayer:ja[ra],enableSuggestions:!0}),oa=!0);oa&&this.set("sources",Aa);n.resolve()}))}else n.resolve()}else n.resolve();return n.promise},_switchCoordinatesClick:function(n){n.preventDefault();if(n=h.get(n.target,"data-switch-coordinates"))this._cancelSuggest(),this.set("value",n),this.search()},_moreResultsClick:function(n){n.preventDefault();var N=n.target;n=parseInt(h.get(N,
"data-source-index"),10);N=parseInt(h.get(N,"data-index"),10);var W=this.searchResults;W&&W[n]&&(n=W[n][N])&&this.select(n)},_showMoreResultsClick:function(n){n.preventDefault();if(n=t.byId(this._moreResultsId)){a.toggle(n,this.css.searchShowMoreResults);var N=t.byId(this._moreResultsId+"_show");N&&(a.contains(n,this.css.searchShowMoreResults)?h.set(N,"textContent",c.widgets.Search.main.hideMoreResults):h.set(N,"textContent",c.widgets.Search.main.showMoreResults))}},_featureLayerLoaded:function(n){var N=
new E;if(n.loaded)N.resolve(n);else if(n.loadError)N.reject(this._error("Layer failed to load."));else{var W=D.once(n,"load",l.hitch(this,function(){U.remove();N.resolve(n)}));var U=D.once(n,"error",l.hitch(this,function(){W.remove();N.reject(this._error("Layer could not be loaded."))}))}return N.promise},_getObjectSize:function(n){var N=0,W;for(W in n)n.hasOwnProperty(W)&&N++;return N},_sourcesEvent:function(n,N){var W=h.get(N,"data-index"),U=q("li",this.sourcesNode);N=G.indexOf(U,N);W!==this._allIndex&&
(W=parseInt(W,10));"click"===n.type||n.keyCode===B.ENTER?(this.set("activeSourceIndex",W),V.focus(this.inputNode),this._hideSourcesMenu()):n.keyCode===B.UP_ARROW?(n.stopPropagation(),n.preventDefault(),n=N-1,0>n?V.focus(this.sourcesBtnNode):V.focus(U[n])):n.keyCode===B.DOWN_ARROW?(n.stopPropagation(),n.preventDefault(),n=N+1,n>=U.length?V.focus(this.sourcesBtnNode):V.focus(U[n])):n.keyCode===B.ESCAPE&&(this._hideSourcesMenu(),V.focus(this.inputNode))},_suggestionsEvent:function(n,N){var W=h.get(N,
"data-source-index"),U=parseInt(h.get(N,"data-index"),10),ca=q("li",this.suggestionsNode),ja=this.sources;N=G.indexOf(ca,N);W!==this._allIndex&&(W=parseInt(W,10));var oa;this._clearQueryTimeout();"click"===n.type||n.keyCode===B.ENTER?((ca=this.suggestResults)&&ca[W]&&ca[W][U]&&(oa=ca[W][U]),oa&&(oa.index=W,ja[W].featureLayer?(W=ja[W].featureLayer.objectIdField,oa[this._objectIdIdentifier]=oa.feature.attributes[W],this.set("value",this._getSuggestionName(oa)),this.set("selectedFeatureId",oa.feature.attributes[W])):
oa.magicKey&&oa.text&&(this.set("value",oa.text),this.set("magicKey",oa.magicKey)),this.search(oa),V.focus(this.inputNode))):n.keyCode===B.BACKSPACE||n.keyCode===B.DELETE?V.focus(this.inputNode):n.keyCode===B.UP_ARROW?(n.stopPropagation(),n.preventDefault(),oa=N-1,0>oa?V.focus(this.inputNode):V.focus(ca[oa])):n.keyCode===B.DOWN_ARROW?(n.stopPropagation(),n.preventDefault(),oa=N+1,oa>=ca.length?V.focus(this.inputNode):V.focus(ca[oa])):n.keyCode===B.ESCAPE&&(this._hideMenus(),V.focus(this.inputNode))},
_getResultName:function(n){var N;n.hasOwnProperty("name")&&null!==n.name&&(N=n.name.toString());N||(N=c.widgets.Search.main.untitledResult);return N},_getSuggestionName:function(n){var N;n.hasOwnProperty("name")&&null!==n.name&&(N=n.name.toString());n=n.text||N;n||(n=c.widgets.Search.main.untitledResult);return n},_searchResultHTML:function(n){var N="";if(n.feature&&n.feature.attributes&&n.feature.attributes.Addr_type&&"LatLong"===n.feature.attributes.Addr_type){var W=n.name.split(" ");if(2===W.length){var U=
W[0];var ca=W[1]}ca&&U?(n=parseFloat(U),ca=parseFloat(ca),W=ca+", "+n,N+='\x3cdiv class\x3d"'+this.css.searchMoreResultsItem+'"\x3e',N+='\x3cdiv class\x3d"'+this.css.latLonHeader+'"\x3e'+c.widgets.Search.main.lonlat+"\x3c/div\x3e",N=N+(n+", "+ca)+'\x3c/div\x3e\x3cdiv class\x3d"'+(this.css.searchMoreResultsItem+'"\x3e'),n===ca||90<n||-90>n||180<ca||-180>ca||(N+='\x3cdiv class\x3d"'+this.css.latLonHeader+'"\x3e'+c.widgets.Search.main.reverseLonLatHeader+"\x3c/div\x3e",N+='\x3ca data-switch-coordinates\x3d"'+
W+'" tabindex\x3d"0" href\x3d"#"\x3e'+W+"\x3c/a\x3e\x3c/div\x3e")):N=n.name}else N=n.name;return N},_moreResultsHTML:function(n){var N="",W="",U=this.searchResults,ca=this.sources,ja=0;if(U){W+='\x3cdiv class\x3d"'+this.css.searchMoreResultsItem+'"\x3e';W+='\x3ca href\x3d"#" id\x3d"'+this._moreResultsId+'_show"\x3e'+c.widgets.Search.main.showMoreResults+"\x3c/a\x3e";W=W+'\x3c/div\x3e\x3cdiv class\x3d"'+(this.css.searchMoreResultsList+'"\x3e');W+='\x3cdiv id\x3d"'+this._moreResultsId+'_list"\x3e';
for(var oa in U)if(U[oa]){var Aa=U[oa].length;if(Aa){var ra=1===Aa&&U[oa][0]===n;if(1<this._getObjectSize(U)&&!ra){var wa=this._getSourceName(oa);W+='\x3cdiv class\x3d"'+this.css.searchMoreResultsListHeader+'"\x3e'+wa+"\x3c/div\x3e"}if(Aa&&!ra){W+="\x3cul\x3e";wa=ca[oa].maxResults||this.maxResults;for(ra=0;ra<Aa&&ra<wa;++ra)if(U[oa][ra]!==n){var la=this._getResultName(U[oa][ra]);W+='\x3cli\x3e\x3ca tabindex\x3d"0" data-index\x3d"'+ra+'" data-source-index\x3d"'+oa+'" href\x3d"#"\x3e'+la+"\x3c/a\x3e\x3c/li\x3e";
ja++}W+="\x3c/ul\x3e"}}}W+="\x3c/div\x3e\x3c/div\x3e"}ja&&(N+=W);return N},_validField:function(n,N){return n.getField(N)},_validFields:function(n,N){if(n&&N&&N.length){for(var W=0;W<N.length;W++)if(!this._validField(n,N[W]))return!1;return!0}return!1},_getCodedName:function(n,N){if(n&&n.length)for(var W=0,U=n.length;W<U;W++){var ca=n[W];if(ca.code===N)return ca.name}},_getCodedValue:function(n,N,W){if(n&&n.length)for(var U=0,ca=n.length;U<ca;U++){var ja=n[U],oa=ja.name,Aa=N;W||(oa=oa.toLowerCase(),
Aa=Aa.toLowerCase());if(oa===Aa)return ja.code}return!1},_whereClause:function(n,N,W,U,ca){var ja=null;if(n){var oa="",Aa=this.reHostedFS.test(N.url);Aa&&this._containsNonLatinCharacter(n)&&(oa="N");if(W&&W.length)for(var ra=0,wa=W.length;ra<wa;ra++){var la="";la=n.replace(/'/g,"''");var ua=W[ra],Ia=N.getField(ua),Ka=N.getDomain(ua);Ka&&"codedValue"===Ka.type&&(la=this._getCodedValue(Ka.codedValues,la,U));!1!==la&&(Ia=Ia.type,"esriFieldTypeString"===Ia||"esriFieldTypeDate"===Ia?U&&"search"===ca?la=
ua+" \x3d "+oa+"'"+la+"'":(ua=Aa?ua:"UPPER("+ua+")",la=Aa?la:la.toUpperCase(),la=ua+" LIKE "+oa+"'"+(U?la+"%":"%"+la+"%")+"'"):"esriFieldTypeOID"===Ia||"esriFieldTypeSmallInteger"===Ia||"esriFieldTypeInteger"===Ia||"esriFieldTypeSingle"===Ia||"esriFieldTypeDouble"===Ia?(la=parseFloat(la),la=isNaN(la)?!1:ua+" \x3d "+la):la=ua+" \x3d "+la,la&&(ja=ja?ja+" or ":"",ja+=la))}}return ja},_suggest:function(n){n||(n={index:this.activeSourceIndex,text:this.value});var N=new E,W=n.index,U=this.sources[W],ca=
this.enableSuggestions;U.hasOwnProperty("enableSuggestions")&&(ca=U.enableSuggestions);var ja=0;if(n.hasOwnProperty("text")&&n.text){var oa=l.trim(n.text);ja=n.text.length}n=U.minCharacters||this.minCharacters;if(ca&&oa&&ja>=n&&this._supportsPagination(U)){var Aa="";U.prefix&&(Aa+=U.prefix);Aa+=oa;U.suffix&&(Aa+=U.suffix);var ra=this._defaultSR;this.map&&(ra=this.map.spatialReference);ca={};U.locator?(U.categories&&(ca.categories=U.categories),U.locator.outSpatialReference=ra,this.map&&U.localSearchOptions&&
U.localSearchOptions.hasOwnProperty("distance")&&U.localSearchOptions.hasOwnProperty("minScale")&&(ja=this._getScale(),!U.localSearchOptions.minScale||ja&&ja<=parseFloat(U.localSearchOptions.minScale))&&(ca.location=this.map.extent.getCenter(),ca.distance=U.localSearchOptions.distance),ca.text=Aa,U.useMapExtent&&this.map&&this.map.extent&&(ca.searchExtent=this.map.extent),U.searchExtent&&(ca.searchExtent=U.searchExtent),ca.maxSuggestions=U.maxSuggestions||this.maxSuggestions,U.sourceCountry&&(ca.countryCode=
U.sourceCountry),U.countryCode&&(ca.countryCode=U.countryCode),U.locator.suggestLocations(ca).then(l.hitch(this,function(wa){N.resolve(wa)}),l.hitch(this,function(wa){wa||(wa=this._error("Locator suggestLocations could not be performed."));N.reject(wa)}))):U.featureLayer?this._featureLayerLoaded(U.featureLayer).then(l.hitch(this,function(){var wa=this._getDisplayField(U),la=U.searchFields||[wa],ua=[];U.suggestionTemplate?U.suggestionTemplate.replace(/(?:\$\{([^}]+)\})/g,function(Pa,Sa){ua.push(Sa)}):
ua=[wa];-1===G.indexOf(ua,U.featureLayer.objectIdField)&&ua.push(U.featureLayer.objectIdField);wa=this._validField(U.featureLayer,wa);var Ia=this._validFields(U.featureLayer,ua),Ka=this._validFields(U.featureLayer,la);if(wa&&Ia&&Ka){wa=new pa;U.hasOwnProperty("suggestQueryParams")&&l.mixin(wa,U.suggestQueryParams);wa.outSpatialReference=ra;wa.returnGeometry=!1;wa.num=U.maxSuggestions||this.maxSuggestions;wa.outFields=ua;U.useMapExtent&&this.map&&this.map.extent&&(wa.geometry=this.map.extent);U.searchExtent&&
(wa.geometry=U.searchExtent);if(la=this._whereClause(Aa,U.featureLayer,la,U.exactMatch,"suggest")){wa.where=la;var Ba=!0}Ba?U.featureLayer.queryFeatures(wa,l.hitch(this,function(Pa){var Sa;(Pa=Pa.features)&&(Sa=this._hydrateResults(Pa,W,!0));N.resolve(Sa)}),l.hitch(this,function(Pa){Pa||(Pa=this._error("FeatureLayer queryFeatures errored with suggestions"));N.reject(Pa)})):N.resolve()}else N.reject(this._error("Invalid FeatureLayer field"))})):N.reject(this._error("Invalid source"))}else N.resolve();
return N.promise},_supportsPagination:function(n){var N;n.locator?N=!0:n.featureLayer&&n.featureLayer.advancedQueryCapabilities&&n.featureLayer.advancedQueryCapabilities.supportsPagination&&(N=!0);return N},_suggestQueries:function(n){var N=this.sources,W=this.activeSourceIndex,U=[];if(W===this._allIndex)for(W=0;W<N.length;W++){var ca=n;ca.index=W;ca=this._suggest(ca);U.push(ca)}else n.index=W,ca=this._suggest(n),U.push(ca);return R(U)},_getPointFromGeometry:function(n){switch(n.type){case "extent":var N=
n.getCenter();break;case "multipoint":N=n.getPoint(0);break;case "point":N=n;break;case "polygon":N=n.getCentroid();break;case "polyline":N=n.getPoint(0,0)}return N},_searchQueries:function(n){n.hasOwnProperty("index")||(n.index=this.activeSourceIndex);var N=[];if(n.index===this._allIndex)for(var W=this.sources,U=0;U<W.length;U++){var ca=n;ca.index=U;ca=this._search(ca);N.push(ca)}else n=this._search(n),N.push(n);return R(N)},_searchButton:function(){this.enableButtonMode&&!this.expanded?(this.expand(),
V.focus(this.inputNode)):(this._cancelSuggest(),this.search())},_search:function(n){n||(n={text:this.value,magicKey:null,geometry:null,point:null,index:this.activeSourceIndex,latlon:null});this.selectedFeatureId&&(n.text=null,n[this._objectIdIdentifier]=this.selectedFeatureId);var N,W=new E,U=n.index,ca=this.sources[U],ja;n.hasOwnProperty("text")&&n.text&&(ja=l.trim(n.text));if(ca){var oa="";ca.prefix&&!n.magicKey&&(oa+=ca.prefix);oa+=ja;ca.suffix&&!n.magicKey&&(oa+=ca.suffix);var Aa=this._defaultSR;
this.map&&(Aa=this.map.spatialReference);if(ca.locator)if(n.hasOwnProperty("text")&&ja){var ra={};ca.categories&&(ra.categories=ca.categories);ca.locationType&&(ra.locationType=ca.locationType);Aa&&(ca.locator.outSpatialReference=Aa);if(this.map&&ca.localSearchOptions&&ca.localSearchOptions.hasOwnProperty("distance")&&ca.localSearchOptions.hasOwnProperty("minScale")){var wa=this._getScale();if(!ca.localSearchOptions.minScale||wa&&wa<=parseFloat(ca.localSearchOptions.minScale))ra.location=this.map.extent.getCenter(),
ra.distance=ca.localSearchOptions.distance}ra.address={};ra.maxLocations=ca.maxResults||this.maxResults;ca.useMapExtent&&this.map&&this.map.extent&&(ra.searchExtent=this.map.extent);ca.searchExtent&&(ra.searchExtent=ca.searchExtent);ca.sourceCountry&&(ra.countryCode=ca.sourceCountry);ca.countryCode&&(ra.countryCode=ca.countryCode);n.magicKey&&(ra.magicKey=n.magicKey);ca.singleLineFieldName?ra.address[ca.singleLineFieldName]=oa:ra.address["Single Line Input"]=oa;ca.outFields&&(ra.outFields=ca.outFields);
ca.locator.addressToLocations(ra).then(l.hitch(this,function(la){la=this._hydrateResults(la,U,!1);W.resolve(la)}),l.hitch(this,function(la){la||(la=this._error("Locator addressToLocations could not be performed"));W.reject(la)}))}else n.geometry?(N=this._getPointFromGeometry(n.geometry.geometry))?this._reverseGeocodePoint(U,N).then(function(la){W.resolve(la)},function(la){W.reject(la)}):W.reject(this._error("Invalid point to reverse geocode")):n.point?this._reverseGeocodePoint(U,n.point).then(function(la){W.resolve(la)},
function(la){W.reject(la)}):n.latlon?(ra=new Q(n.latlon,this._defaultSR),this._reverseGeocodePoint(U,ra).then(function(la){W.resolve(la)},function(la){W.reject(la)})):n.hasOwnProperty("text")&&!ja?W.resolve([]):W.reject(this._error("Invalid query type for Locator"));else ca.featureLayer?this._featureLayerLoaded(ca.featureLayer).then(l.hitch(this,function(){var la=this._getDisplayField(ca),ua=ca.searchFields||[la];la=this._validField(ca.featureLayer,la);var Ia=this._validFields(ca.featureLayer,ua);
if(la&&Ia){la=new pa;ca.hasOwnProperty("searchQueryParams")&&l.mixin(la,ca.searchQueryParams);Aa&&(la.outSpatialReference=Aa,Ia=this.map&&this.map.getMaxResolution()||1/ka.getUnitValueForSR(Aa))&&(la.maxAllowableOffset=Ia);la.returnGeometry=!0;ca.outFields&&(la.outFields=ca.outFields);if(!n.hasOwnProperty(this._objectIdIdentifier)){this._supportsPagination(ca)&&(la.num=ca.maxResults||this.maxResults);ca.useMapExtent&&this.map&&this.map.extent&&(la.geometry=this.map.extent);ca.searchExtent&&(la.geometry=
ca.searchExtent);var Ka=ca.exactMatch}n.hasOwnProperty("text")&&ja?(ua=this._whereClause(oa,ca.featureLayer,ua,Ka,"search"))?(la.where=ua,ua=!0):ua=!1:n.hasOwnProperty(this._objectIdIdentifier)?(la.objectIds=[n[this._objectIdIdentifier]],ua=!0):n.geometry?(la.geometry=n.geometry,ua=!0):n.point?(la.geometry=n.point,ua=!0):n.latlon?(N=new Q(n.latlon,this._defaultSR),la.geometry=N,ua=!0):(n.hasOwnProperty("text")&&!ja?W.resolve([]):W.reject(this._error("Invalid query type for FeatureLayer")),ua=!1);
ua?ca.featureLayer.queryFeatures(la,l.hitch(this,function(Ba){Ba=Ba.features;var Pa;Ba&&(Pa=this._hydrateResults(Ba,U,!1));W.resolve(Pa)}),l.hitch(this,function(Ba){Ba||(Ba=this._error("FeatureLayer queryFeatures could not be performed"));W.reject(Ba)})):W.resolve()}else W.reject(this._error("Invalid FeatureLayer field"))})):W.reject(this._error("Invalid source"))}else W.reject(this._error("Source is undefined"));return W.promise},_clearQueryTimeout:function(){this._queryTimer&&clearTimeout(this._queryTimer)},
_formatResults:function(n,N,W){W={activeSourceIndex:N,value:W,numResults:0,numErrors:0,errors:null,results:null};var U={},ca={};if(n)if(N===this._allIndex)for(N=0;N<n.length;N++)n[N]&&(n[N]instanceof Error?(U[N]=n[N],W.numErrors++):(ca[N]=n[N],W.numResults+=n[N].length));else n[0]&&(n[0]instanceof Error?(U[N]=n[0],W.numErrors++):(ca[N]=n[0],W.numResults+=n[0].length));W.numErrors&&(W.errors=U);W.numResults&&(W.results=ca);return W},_reverseGeocodePoint:function(n,N){var W=new E,U=this.sources[n];
if(N&&U){var ca=U.locationToAddressDistance||this.locationToAddressDistance;U.locator.outSpatialReference=this._defaultSR;this.map&&(U.locator.outSpatialReference=this.map.spatialReference);U.locator.locationToAddress(N,ca,l.hitch(this,function(ja){ja=this._hydrateResults([ja],n,!1);W.resolve(ja)}),l.hitch(this,function(ja){ja||(ja=this._error("Locator locationToAddress could not be performed"));W.reject(ja)}))}else W.reject(this._error("No point or source defined for reverse geocoding"));return W.promise},
_cancelDeferreds:function(){if(this._deferreds&&this._deferreds.length)for(var n=0;n<this._deferreds.length;n++)this._deferreds[n].cancel(this.declaredClass+" cancelling request");this._deferreds=[]},_sourceBtnKey:function(n){if(n){var N=q("li",this.sourcesNode);n.keyCode===B.UP_ARROW?(n.stopPropagation(),n.preventDefault(),this._showSourcesMenu(),(n=N.length)&&V.focus(N[n-1])):n.keyCode===B.DOWN_ARROW&&(n.stopPropagation(),n.preventDefault(),this._showSourcesMenu(),N[0]&&V.focus(N[0]))}},_inputKey:function(n){if(n){var N=
q("li",this.suggestionsNode),W=this.suggestResults;if(n.keyCode===B.TAB||n.keyCode===B.ESCAPE)this._cancelSuggest(),this._hideMenus();else if(n.keyCode===B.UP_ARROW)n.stopPropagation(),n.preventDefault(),this._cancelSuggest(),W&&this._showSuggestionsMenu(),(n=N.length)&&V.focus(N[n-1]);else if(n.keyCode===B.DOWN_ARROW)n.stopPropagation(),n.preventDefault(),this._cancelSuggest(),W&&this._showSuggestionsMenu(),N[0]&&V.focus(N[0]);else{if(n.ctrlKey||n.metaKey||n.keyCode===B.copyKey||n.keyCode===B.LEFT_ARROW||
n.keyCode===B.RIGHT_ARROW||n.keyCode===B.ENTER)return n;this._suggestDelay()}}},_cancelSuggest:function(){this._cancelDeferreds();this._clearQueryTimeout()},_suggestDelay:function(){this._cancelSuggest();this._changeValue();this._queryTimer=setTimeout(l.hitch(this,function(){this.suggest()}),this.suggestionDelay)},_changeValue:function(){this.set("magicKey",null);this.set("selectedFeatureId",null);this._changeAttrValue("value",this.inputNode.value);this._checkStatus()},_inputClick:function(){this._hideSourcesMenu();
this._hideNoResultsMenu()},_getSourceName:function(n){return this._sourceNames[n]},_loadSources:function(n){n=G.filter(n,function(N){return!!N.featureLayer});n=G.map(n,function(N){return this._featureLayerLoaded(N.featureLayer)},this);return R(n)},_createSourceNameMap:function(n){return this._loadSources(n).then(l.hitch(this,function(){var N=G.map(n,function(W){return W.name||W.featureLayer&&W.featureLayer.name||c.widgets.Search.main.untitledSource});this._preventDuplicateSourceNames(n,N);return N}))},
_getDuplicateSourceNameIndexes:function(n){var N={},W=[];G.forEach(n,function(U,ca){N.hasOwnProperty(U)?(-1===W.indexOf(N[U])&&W.push(N[U]),W.push(ca)):n.lastIndexOf(U)!==ca&&(N[U]=ca)});return W},_preventDuplicateSourceNames:function(n,N){if(N&&1<N.length){var W=this._getDuplicateSourceNameIndexes(N);G.forEach(W,function(U){N[U]+=this._getFieldsString(n[U])},this)}},_getFieldsString:function(n){var N="",W=n.featureLayer;if(W){n=n.searchFields||[this._getDisplayField(n)];for(var U=0;U<n.length;U++){N=
0===U?N+": ":N+", ";var ca=n[U],ja=W.getFieldLabel(ca);N+=ja||ca}}return N},_splitResult:function(n,N){N=w.escapeString(N);return n.replace(new RegExp("(^|)("+N+")(|$)","ig"),"$1|$2|$3").split("|")},_insertSuggestions:function(n,N){if(this.enableSuggestionsMenu&&this.suggestionsNode){this._hideSourcesMenu();this._hideNoResultsMenu();var W=this.sources;if(n){var U=d.create("div");for(var ca in n)if(n[ca]&&n[ca].length){var ja=this._getSourceName(ca);1<W.length&&this.activeSourceIndex===this._allIndex&&
d.create("div",{className:this.css.searchMenuHeader,textContent:ja},U);ja=d.create("ul",{role:"menu"},U);for(var oa=W[ca].maxSuggestions||this.maxSuggestions,Aa=0;Aa<n[ca].length&&Aa<oa;++Aa){var ra=d.create("li",{"data-index":Aa,"data-source-index":ca,role:"menuitem",tabindex:0},ja),wa=this._getSuggestionName(n[ca][Aa]);wa=this._splitResult(wa,N);for(var la=wa.length,ua=0;ua<la;ua++){var Ia=wa[ua];Ia.toLowerCase()===N.toLowerCase()?d.create("strong",{textContent:Ia},ra):(Ia=document.createTextNode(Ia),
d.place(Ia,ra))}}}}U?(d.place(U,this.suggestionsNode,"only"),this._showSuggestionsMenu()):(d.empty(this.suggestionsNode),this._hideSuggestionsMenu())}},_insertSources:function(n){if(this.enableSourcesMenu&&n&&1<n.length){var N,W=this.activeSourceIndex,U=d.create("ul",{role:"menu"});if(this.enableSearchingAll){var ca="";W===this._allIndex&&(ca="active");d.create("li",{"data-index":this._allIndex,role:"menuitem",className:ca,tabIndex:0,textContent:c.widgets.Search.main.all},U)}for(N=0;N<n.length;N++){ca=
"";N===W&&(ca=this.css.activeSource);var ja=this._getSourceName(N);d.create("li",{"data-index":N,role:"menuitem",className:ca,tabIndex:0,textContent:ja},U)}a.add(this.containerNode,this.css.hasMultipleSources);d.place(U,this.sourcesNode,"only")}else a.remove(this.containerNode,this.css.hasMultipleSources),d.empty(this.sourcesNode)},_showLoading:function(){a.add(this.containerNode,this.css.searchLoading)},_hideLoading:function(){a.remove(this.containerNode,this.css.searchLoading)},_checkStatus:function(){this.value?
(a.add(this.containerNode,this.css.hasValue),h.set(this.clearNode,"title",c.widgets.Search.main.clearButtonTitle)):this.clear()},_closePopup:function(){this.enableInfoWindow&&this.map&&this.map.infoWindow&&this.map.infoWindow.hide()},_noResults:function(n){var N;n&&(N=l.trim(n));var W=d.create("div",{className:this.css.searchNoResultsBody});n&&N?(d.create("div",{className:this.css.searchNoResultsHeader,textContent:c.widgets.Search.main.noResults},W),d.create("div",{className:this.css.searchNoResultsText,
textContent:J.substitute({value:'"'+n+'"'},c.widgets.Search.main.noResultsFound)},W)):(n=d.create("div",{},W),d.create("span",{"aria-hidden":"true",className:this.css.searchNoValueIcon},n),d.create("span",{className:this.css.searchNoValueText,textContent:c.widgets.Search.main.emptyValue},n));d.place(W,this.noResultsMenuNode,"only")},_hideMenus:function(){this._hideSourcesMenu();this._hideSuggestionsMenu();this._hideNoResultsMenu()},_hideNoResultsMenu:function(){a.remove(this.containerNode,this.css.showNoResults)},
_showNoResultsMenu:function(){this._hideSourcesMenu();this._hideSuggestionsMenu();a.add(this.containerNode,this.css.showNoResults)},_hideSourcesMenu:function(){a.remove(this.containerNode,this.css.showSources)},_hideSuggestionsMenu:function(){a.remove(this.containerNode,this.css.showSuggestions)},_showSourcesMenu:function(){this._hideSuggestionsMenu();this._hideNoResultsMenu();a.add(this.containerNode,this.css.showSources)},_showSuggestionsMenu:function(){this._hideSourcesMenu();this._hideNoResultsMenu();
a.add(this.containerNode,this.css.showSuggestions)},_toggleSourcesMenu:function(){this._hideSuggestionsMenu();this._hideNoResultsMenu();a.toggle(this.containerNode,this.css.showSources)},_getFirstStringField:function(n){if(n&&(n=n.fields)&&n.length)for(var N=0;N<n.length;N++){var W=n[N];if("esriFieldTypeString"===W.type)return W.name}return""},_getDisplayField:function(n){return n.displayField||n.featureLayer.displayField||this._getFirstStringField(n.featureLayer)},_validLocation:function(n){return n&&
"number"===typeof n.x&&"number"===typeof n.y},_validExtent:function(n){return n&&"number"===typeof n.xmin&&"number"===typeof n.ymin&&"number"===typeof n.xmax&&"number"===typeof n.ymax},_hydrateResult:function(n,N,W){var U={},ca=this._defaultSR;N=this.sources[N];this.map&&(ca=this.map.spatialReference);if(n.hasOwnProperty("text")&&n.hasOwnProperty("magicKey"))return n;if(n.hasOwnProperty("geometry")){var ja=new H(n.toJson());U.feature=ja;(ja=U.feature.geometry)&&ja.setSpatialReference(ca)}else if(n.hasOwnProperty("location")&&
this._validLocation(n.location)){var oa=new Q(n.location.x,n.location.y,ca);ja={};n.hasOwnProperty("attributes")&&(ja=n.attributes);n.hasOwnProperty("address")&&"object"===typeof n.address&&l.mixin(ja,n.address);n.hasOwnProperty("score")&&(ja.score=n.score);U.feature=new H(oa,null,ja,null)}!U.feature&&W&&(ja={},n.hasOwnProperty("attributes")&&(ja=n.attributes),n.hasOwnProperty("score")&&(ja.score=n.score),U.feature=new H(null,null,ja,null));if(U.feature){if(n.hasOwnProperty("extent")&&this._validExtent(n.extent))U.extent=
new fa(n.extent),U.extent.setSpatialReference(ca);else if(U.feature&&U.feature.geometry)switch(U.feature.geometry.type){case "extent":U.extent=U.feature.geometry;break;case "multipoint":U.extent=ea.getDenormalizedExtent(U.feature.geometry);break;case "polygon":U.extent=ea.getDenormalizedExtent(U.feature.geometry);break;case "polyline":U.extent=ea.getDenormalizedExtent(U.feature.geometry);break;case "point":this.map?(ca=this.zoomScale,N&&N.zoomScale&&(ca=N.zoomScale),this._getScale()>ca?U.extent=ka.getExtentForScale(this.map,
ca).centerAt(U.feature.geometry):U.extent=this.map.extent.centerAt(U.feature.geometry)):U.extent=new fa({xmin:U.feature.geometry.x-.25,ymin:U.feature.geometry.y-.25,xmax:U.feature.geometry.x+.25,ymax:U.feature.geometry.y+.25,spatialReference:this._defaultSR})}else U.extent=null;U.name="";N.featureLayer?N.suggestionTemplate&&W?U.name=J.substitute(n.attributes,N.suggestionTemplate):N.searchTemplate?U.name=J.substitute(n.attributes,N.searchTemplate):(ja=this._getDisplayField(N),W=N.featureLayer.getField(ja),
ca=N.featureLayer.getDomain(ja),ja&&n.hasOwnProperty("attributes")&&n.attributes.hasOwnProperty(ja)&&(n=n.attributes[ja],ca&&"codedValue"===ca.type?U.name=this._getCodedName(ca.codedValues,n):W&&"esriFieldTypeDate"===W.type&&!isNaN(n)?U.name=g.format(new Date(n)):U.name=n)):n.address&&N.searchTemplate?U.name=J.substitute(n.address,N.searchTemplate):n.hasOwnProperty("name")?U.name=n.name:n.hasOwnProperty("attributes")&&"object"===typeof n.attributes&&n.attributes.LongLabel?U.name=n.attributes.LongLabel:
n.hasOwnProperty("attributes")&&"object"===typeof n.attributes&&n.attributes.Match_addr?(U.name=n.attributes.Match_addr,n.attributes.Addr_type&&"POI"===n.attributes.Addr_type&&n.attributes.StAddr&&n.attributes.City?U.name+=" - "+n.attributes.StAddr+", "+n.attributes.City:n.attributes.Addr_type&&"POI"===n.attributes.Addr_type&&n.attributes.City&&(U.name+=" - "+n.attributes.City)):n.hasOwnProperty("address")&&"string"===typeof n.address?U.name=n.address:n.hasOwnProperty("address")&&"object"===typeof n.address&&
n.address.hasOwnProperty("Address")?n.address.hasOwnProperty("Match_addr")?U.name=n.address.Match_addr:n.address.hasOwnProperty("Address")&&(U.name=n.address.Address):U.feature&&U.feature.geometry&&(U.name=U.feature.geometry.x+","+U.feature.geometry.y);N.featureLayer&&U.feature&&Ea(U.feature,N.featureLayer);return U}},_getScale:function(){var n;this.map&&"function"===typeof this.map.getScale&&(n=this.map.getScale());return n},_hydrateResults:function(n,N,W,U){U=[];var ca=0;if(n&&n.length)for(ca;ca<
n.length;ca++){var ja=this._hydrateResult(n[ca],N,W);ja&&U.push(ja)}return U},_containsNonLatinCharacter:function(n){for(var N=0;N<n.length;N++)if(255<n.charCodeAt(N))return!0;return!1},_setPlaceholder:function(n){var N="",W=this.sources[n];n===this._allIndex?N=this.allPlaceholder||c.widgets.Search.main.allPlaceholder:W&&W.placeholder&&(N=W.placeholder);var U=c.widgets.Search.main.all;W&&(U=this._getSourceName(n));h.set(this.sourceNameNode,"textContent",U);h.set(this.inputNode,"placeholder",N);h.set(this.inputNode,
"title",N)},_updateActiveSource:function(){var n=this.sources,N=this.activeSourceIndex,W;n&&n[N]&&(W=n[N]);W?this.set("activeSource",W):this.set("activeSource",null)},_updateVisible:function(){this.visible?this.show():this.hide()},_updateButtonMode:function(n){n?(a.toggle(this.containerNode,this.css.searchExpanded,this.expanded),a.toggle(this.containerNode,this.css.searchCollapsed,!this.expanded),a.add(this.containerNode,this.css.hasButtonMode)):(a.remove(this.containerNode,this.css.searchExpanded),
a.remove(this.containerNode,this.css.searchCollapsed),a.remove(this.containerNode,this.css.hasButtonMode))},_setDefaultActiveSourceIndex:function(n){n&&1===n.length||!this.enableSearchingAll?this.set("activeSourceIndex",0):this.set("activeSourceIndex",this._allIndex)},_setEnableSourcesMenuAttr:function(n){this._set("enableSourcesMenu",n);this._created&&this._insertSources(this.sources)},_setEnableSearchingAllAttr:function(n){this._set("enableSearchingAll",n);this._created&&(this._setDefaultActiveSourceIndex(this.sources),
this._hideMenus(),this._insertSources(this.sources))},_setSourcesAttr:function(n){this._createSourceNameMap(n).then(l.hitch(this,function(N){this._sourceNames=N;this._created&&(this._setDefaultActiveSourceIndex(n),this._hideMenus(),this._insertSources(n))}));this._set("sources",n)},_setAllPlaceholderAttr:function(n){this._set("allPlaceholder",n);this._created&&this._setPlaceholder(this.activeSourceIndex)},_setActiveSourceIndexAttr:function(n){this._set("activeSourceIndex",n);this._updateActiveSource();
this._created&&(this._setPlaceholder(n),this._hideMenus(),this._insertSources(this.sources))},_setMaxLengthAttr:function(n){this._set("maxLength",n);this._created&&h.set(this.inputNode,"maxLength",n)},_setValueAttr:function(n){this.set("magicKey",null);this.set("selectedFeatureId",null);this._set("value",n);this._created&&(h.set(this.inputNode,"value",n),this._checkStatus())},_setVisibleAttr:function(n){this._set("visible",n);this._created&&this._updateVisible()},_setEnableButtonModeAttr:function(n){this._set("enableButtonMode",
n);this._created&&this._updateButtonMode(n)},_setThemeAttr:function(n){this._created&&(a.remove(this.domNode,this.theme),a.add(this.domNode,n));this._set("theme",n)}});k("extend-esri")&&l.setObject("dijit.Search",O,aa);return O})},"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),function(C,O,l,G,K,E,B,D,q,k,w){C=C(k,{declaredClass:"esri.tasks.Locator",
_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},constructor:function(t){this._geocodeHandler=O.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=O.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=O.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},outSpatialReference:null,setOutSpatialReference:function(t){this.outSpatialReference=
t},_geocodeHandler:function(t,h,a,f,d){try{var g=t.candidates;h=[];var c,m=g.length,F=t.spatialReference,I;for(c=0;c<m;c++){var M=g[c];if(I=M.location)I.spatialReference=F;h[c]=new w(M)}this._successHandler([h],"onAddressToLocationsComplete",a,d)}catch(T){this._errorHandler(T,f,d)}},_geocodeAddressesHandler:function(t,h,a,f,d){try{var g=t.locations;h=[];var c,m=g.length,F=t.spatialReference,I;for(c=0;c<m;c++){if(I=g[c].location)I.spatialReference=F;h[c]=new w(g[c])}this._successHandler([h],"onAddressesToLocationsComplete",
a,d)}catch(M){this._errorHandler(M,f,d)}},addressToLocations:function(t,h,a,f,d){var g;if(t.address){f=a;a=h;h=t.outFields;d=t.searchExtent;var c=t.countryCode;var m=t.magicKey;var F=t.distance;var I=t.categories;t.location&&this.normalization&&(g=t.location.normalize());var M=t.locationType;var T=t.maxLocations;var V=t.forStorage;t=t.address}d&&(d=d.shiftCentralMeridian());var J=this.outSpatialReference;t=this._encode(O.mixin({},this._url.query,t,{f:"json",outSR:J&&K.toJson(J.toJson()),outFields:h&&
h.join(",")||null,searchExtent:d&&K.toJson(d.toJson()),category:I&&I.join(",")||null,countryCode:c||null,magicKey:m||null,distance:F||null,location:g||null,locationType:M||null,maxLocations:T||null,forStorage:V||null}));var L=this._geocodeHandler,aa=this._errorHandler,P=new G(q._dfdCanceller);P._pendingDfd=D({url:this._url.path+"/findAddressCandidates",content:t,callbackParamName:"callback",load:function(H,R){L(H,R,a,f,P)},error:function(H){aa(H,f,P)}});return P},suggestLocations:function(t){var h=
new G(q._dfdCanceller);t.hasOwnProperty("location")&&this.normalization&&(t.location=t.location.normalize());t.searchExtent&&(t.searchExtent=t.searchExtent.shiftCentralMeridian());t=this._encode(O.mixin({},this._url.query,{f:"json",text:t.text,maxSuggestions:t.maxSuggestions,searchExtent:t.searchExtent&&K.toJson(t.searchExtent.toJson()),category:t.categories&&t.categories.join(",")||null,countryCode:t.countryCode||null,location:t.location||null,distance:t.distance||null},{f:"json"}));t=D({url:this._url.path+
"/suggest",content:t,callbackParamName:"callback"});h._pendingDfd=t;t.then(O.hitch(this,function(a){a=a.suggestions||[];this.onSuggestLocationsComplete(a);h.resolve(a)}),O.hitch(this,function(a){this._errorHandler(a);h.reject(a)}));return h},addressesToLocations:function(t,h,a){var f=this.outSpatialReference,d=[],g=t.categories,c=t.locationType,m=t.countryCode;l.forEach(t.addresses,function(T,V){d.push({attributes:T})});t=this._encode(O.mixin({},this._url.query,{category:g&&g.join(",")||null,locationType:c||
null,sourceCountry:m||null},{addresses:K.toJson({records:d})},{f:"json",outSR:f&&K.toJson(f.toJson())}));var F=this._geocodeAddressesHandler,I=this._errorHandler,M=new G(q._dfdCanceller);M._pendingDfd=D({url:this._url.path+"/geocodeAddresses",content:t,callbackParamName:"callback",load:function(T,V){F(T,V,h,a,M)},error:function(T){I(T,a,M)}});return M},_reverseGeocodeHandler:function(t,h,a,f,d){try{var g=new w({address:t.address,location:t.location,score:100});this._successHandler([g],"onLocationToAddressComplete",
a,d)}catch(c){this._errorHandler(c,f,d)}},locationToAddress:function(t,h,a,f){t&&this.normalization&&(t=t.normalize());var d=this.outSpatialReference;t=this._encode(O.mixin({},this._url.query,{outSR:d&&K.toJson(d.toJson()),location:t&&K.toJson(t.toJson()),distance:h,f:"json"}));var g=this._reverseGeocodeHandler,c=this._errorHandler,m=new G(q._dfdCanceller);m._pendingDfd=D({url:this._url.path+"/reverseGeocode",content:t,callbackParamName:"callback",load:function(F,I){g(F,I,a,f,m)},error:function(F){c(F,
f,m)}});return m},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}});E("extend-esri")&&O.setObject("tasks.Locator",C,B);return C})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(C,O,l,G,K){C=C(null,{declaredClass:"esri.tasks.AddressCandidate",constructor:function(E){O.mixin(this,E);this.location=
new K(this.location)}});l("extend-esri")&&O.setObject("tasks.AddressCandidate",C,G);return C})},"esri/styles/basic":function(){define(["dojo/_base/array","dojo/_base/lang","dojo/has","../kernel","../Color"],function(C,O,l,G,K){function E(w,t){if(w){var h={};h.color=new K(w.color);h.opacity=w.opacity||1;switch(t){case "point":h.outline={color:new K(w.outline.color),width:w.outline.width};h.size=w.size;break;case "line":h.width=w.width;break;case "polygon":h.outline={color:new K(w.outline.color),width:w.outline.width}}}return h}
function B(w){if("esriGeometryPoint"===w||"esriGeometryMultipoint"===w)w="point";else if("esriGeometryPolyline"===w)w="line";else if("esriGeometryPolygon"===w||"esriGeometryMultiPatch"===w)w="polygon";return w}var D={"default":{name:"default",label:"Default",description:"Default theme for basic visualization of features.",basemapGroups:{light:"streets gray topo terrain national-geographic oceans osm gray-vector streets-vector topo-vector streets-relief-vector streets-navigation-vector".split(" "),
dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector"]},pointSchemes:{light:{primary:{color:[77,77,77,1],outline:{color:[255,255,255,.25],width:1},size:8},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,.25],width:1},size:8},{color:[255,255,255,1],outline:{color:[51,51,51,.25],width:1},size:8}]},dark:{primary:{color:[255,255,255,1],outline:{color:[92,92,92,.25],width:1},size:8},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,.25],width:1},size:8},
{color:[26,26,26,1],outline:{color:[178,178,178,.25],width:1},size:8}]}},lineSchemes:{light:{primary:{color:[77,77,77,1],width:2},secondary:[{color:[226,119,40,1],width:2},{color:[255,255,255,1],width:2}]},dark:{primary:{color:[255,255,255,1],width:2},secondary:[{color:[226,119,40,1],width:2},{color:[26,26,26,1],width:2}]}},polygonSchemes:{light:{primary:{color:[227,139,79,1],outline:{color:[255,255,255,.25],width:1},opacity:.8},secondary:[{color:[128,128,128,1],outline:{color:[255,255,255,.25],width:1},
opacity:.8},{color:[255,255,255,1],outline:{color:[128,128,128,.25],width:1},opacity:.8}]},dark:{primary:{color:[227,139,79,1],outline:{color:[92,92,92,.25],width:1},opacity:.8},secondary:[{color:[178,178,178,1],outline:{color:[92,92,92,.25],width:1},opacity:.8},{color:[26,26,26,1],outline:{color:[128,128,128,.25],width:1},opacity:.8}]}}}},q={};(function(){var w,t,h;for(w in D){var a=D[w];var f=a.basemapGroups;var d=q[w]={basemaps:[].concat(f.light).concat(f.dark),point:{},line:{},polygon:{}};for(t in f){var g=
f[t];for(h=0;h<g.length;h++){var c=g[h];a.pointSchemes&&(d.point[c]=a.pointSchemes[t]);a.lineSchemes&&(d.line[c]=a.lineSchemes[t]);a.polygonSchemes&&(d.polygon[c]=a.polygonSchemes[t])}}}})();var k={getAvailableThemes:function(w){var t=[],h;for(h in D){var a=D[h];var f=q[h];w&&-1===C.indexOf(f.basemaps,w)||t.push({name:a.name,label:a.label,description:a.description,basemaps:f.basemaps.slice(0)})}return t},getSchemes:function(w){var t=w.theme,h=w.basemap,a=B(w.geometryType);w=q[t];var f;(w=(w=w&&w[a])&&
w[h])&&(f={primaryScheme:E(w.primary,a),secondarySchemes:C.map(w.secondary,function(d){return E(d,a)})});return f},cloneScheme:function(w){if(w){var t=O.mixin({},w);t.color&&(t.color=new K(t.color));t.outline&&(t.outline={color:t.outline.color&&new K(t.outline.color),width:t.outline.width})}return t}};l("extend-esri")&&O.setObject("styles.basic",k,G);return k})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),
function(C,O,l,G,K,E,B,D,q,k,w,t){l.isAsync||D(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var h=O("dojo.dnd.Source",w,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(a,f){G.mixin(this,G.mixin({},f));a=this.accept;if(a.length)for(this.accept={},f=0;f<a.length;++f)this.accept[a[f]]=1;this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=
!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&K.add(this.node,"dojoDndSource");this.targetState="";this.accept&&K.add(this.node,"dojoDndTarget");this.horizontal&&K.add(this.node,"dojoDndHorizontal");this.topics=[q.subscribe("/dnd/source/over",G.hitch(this,"onDndSourceOver")),q.subscribe("/dnd/start",G.hitch(this,"onDndStart")),q.subscribe("/dnd/drop",G.hitch(this,"onDndDrop")),q.subscribe("/dnd/cancel",G.hitch(this,"onDndCancel"))]},checkAcceptance:function(a,f){if(this==a)return!this.copyOnly||
this.selfAccept;for(var d=0;d<f.length;++d){for(var g=a.getItem(f[d].id).type,c=!1,m=0;m<g.length;++m)if(g[m]in this.accept){c=!0;break}if(!c)return!1}return!0},copyState:function(a,f){if(a)return!0;2>arguments.length&&(f=this==t.manager().target);if(f){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){h.superclass.destroy.call(this);C.forEach(this.topics,function(a){a.remove()});this.targetAnchor=null},onMouseMove:function(a){if(!this.isDragging||"Disabled"!=
this.targetState){h.superclass.onMouseMove.call(this,a);var f=t.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(a.pageX-this._lastX)>this.delay||Math.abs(a.pageY-this._lastY)>this.delay)){var d=this.getSelectedNodes();d.length&&f.startDrag(this,d,this.copyState(k.getCopyKeyState(a),!0))}this.isDragging&&(d=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=E.position(this.current,!0)),d=this.horizontal?a.pageX-this.targetBox.x<this.targetBox.w/
2==E.isBodyLtr(this.current.ownerDocument):a.pageY-this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||d!=this.before)&&(this._markTargetAnchor(d),f.canDrop(!this.current||f.source!=this||!(this.current.id in this.selection)))}},onMouseDown:function(a){this.mouseDown||!this._legalMouseDown(a)||this.skipForm&&k.isFormElement(a)||(this.mouseDown=!0,this._lastX=a.pageX,this._lastY=a.pageY,h.superclass.onMouseDown.call(this,a))},onMouseUp:function(a){this.mouseDown&&(this.mouseDown=
!1,h.superclass.onMouseUp.call(this,a))},onDndSourceOver:function(a){this!==a?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(a=t.manager(),a.canDrop("Disabled"!=this.targetState&&(!this.current||a.source!=this||!(this.current.id in this.selection))))},onDndStart:function(a,f,d){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==a?d?"Copied":"Moved":"");f=this.accept&&this.checkAcceptance(a,f);this._changeState("Target",f?"":"Disabled");
this==a&&t.manager().overSource(this);this.isDragging=!0},onDndDrop:function(a,f,d,g){if(this==g)this.onDrop(a,f,d);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(a,f,d){if(this!=a)this.onDropExternal(a,f,d);else this.onDropInternal(f,d)},onDropExternal:function(a,f,d){var g=this._normalizedCreator;this._normalizedCreator=
this.creator?function(c,m){return g.call(this,a.getItem(c.id).data,m)}:d?function(c){var m=a.getItem(c.id);c=c.cloneNode(!0);c.id=k.getUniqueId();return{node:c,data:m.data,type:m.type}}:function(c){var m=a.getItem(c.id);a.delItem(c.id);return{node:c,data:m.data,type:m.type}};this.selectNone();d||this.creator||a.selectNone();this.insertNodes(!0,f,this.before,this.current);!d&&this.creator&&a.deleteSelectedNodes();this._normalizedCreator=g},onDropInternal:function(a,f){var d=this._normalizedCreator;
if(!(this.current&&this.current.id in this.selection)){if(f)this._normalizedCreator=this.creator?function(g,c){return d.call(this,this.getItem(g.id).data,c)}:function(g){var c=this.getItem(g.id);g=g.cloneNode(!0);g.id=k.getUniqueId();return{node:g,data:c.data,type:c.type}};else{if(!this.current)return;this._normalizedCreator=function(g){var c=this.getItem(g.id);return{node:g,data:c.data,type:c.type}}}this._removeSelection();this.insertNodes(!0,a,this.before,this.current);this._normalizedCreator=d}},
onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){h.superclass.onOverEvent.call(this);t.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){h.superclass.onOutEvent.call(this);t.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(a){if(this.current!=this.targetAnchor||this.before!=a)this.targetAnchor&&this._removeItemClass(this.targetAnchor,
this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=a,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(a){this._changeState("Source",a?"Copied":"Moved")},_legalMouseDown:function(a){if("touchstart"!=a.type&&!B.isLeft(a))return!1;
if(!this.withHandles)return!0;for(a=a.target;a&&a!==this.node;a=a.parentNode){if(K.contains(a,"dojoDndHandle"))return!0;if(K.contains(a,"dojoDndItem")||K.contains(a,"dojoDndIgnore"))break}return!1}});return h})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),function(C,O,l,G,K,E,B,D,q,k,w,t){var h=O("dojo.dnd.Selector",t,{constructor:function(a,f){f||
(f={});this.singular=f.singular;this.autoSync=f.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(q(this.node,k.press,G.hitch(this,"onMouseDown")),q(this.node,k.release,G.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var a=new D,f=w._empty,d;for(d in this.selection)d in f||a.push(K.byId(d));return a},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){this.forInItems(function(a,f){this._addItemClass(K.byId(f),
"Selected");this.selection[f]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var a=w._empty,f;for(f in this.selection)if(!(f in a)){var d=K.byId(f);this.delItem(f);E.destroy(d)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(a,f){f=f||l.global;var d=this.selection,g=w._empty,c;for(c in d)c in g||a.call(f,this.getItem(c),c,this)},sync:function(){h.superclass.sync.call(this);this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var a=[],f=w._empty,
d;for(d in this.selection)d in f||this.getItem(d)||a.push(d);C.forEach(a,function(g){delete this.selection[g]},this);return this},insertNodes:function(a,f,d,g){var c=this._normalizedCreator;this._normalizedCreator=function(m,F){m=c.call(this,m,F);a?(this.anchor?this.anchor!=m.node&&(this._removeItemClass(m.node,"Anchor"),this._addItemClass(m.node,"Selected")):(this.anchor=m.node,this._removeItemClass(m.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[m.node.id]=1):(this._removeItemClass(m.node,
"Selected"),this._removeItemClass(m.node,"Anchor"));return m};h.superclass.insertNodes.call(this,f,d,g);this._normalizedCreator=c;return this},destroy:function(){h.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(a){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!w.getCopyKeyState(a)&&!a.shiftKey&&this.current.id in this.selection)this.simpleSelection=!0,B.isLeft(a)&&(a.stopPropagation(),a.preventDefault());else{if(!this.singular&&a.shiftKey){w.getCopyKeyState(a)||
this._removeSelection();var f=this.getAllNodes();if(f.length&&(this.anchor||(this.anchor=f[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var d=0,g;d<f.length&&(g=f[d],g!=this.anchor&&g!=this.current);++d);for(++d;d<f.length;++d){g=f[d];if(g==this.anchor||g==this.current)break;this._addItemClass(g,"Selected");this.selection[g.id]=1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==
this.current?w.getCopyKeyState(a)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):w.getCopyKeyState(a)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),
this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);a.stopPropagation();a.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},
onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=q(this.node,k.move,G.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var a=w._empty,f;for(f in this.selection)if(!(f in a)){var d=K.byId(f);d&&this._removeItemClass(d,"Selected")}this.selection={};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),
this.anchor=null);return this}});return h})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),function(C,O,l,G,K,E,B,D,q,k,w,t,h,a){O=O("dojo.dnd.Container",q,{skipForm:!1,allowNested:!1,constructor:function(f,d){this.node=E.byId(f);d||(d={});this.creator=d.creator||null;this.skipForm=d.skipForm;this.parent=d.dropParent&&E.byId(d.dropParent);
this.map={};this.current=null;this.containerState="";B.add(this.node,"dojoDndContainer");d&&d._skipStartup||this.startup();this.events=[w(this.node,h.over,G.hitch(this,"onMouseOver")),w(this.node,h.out,G.hitch(this,"onMouseOut")),w(this.node,"dragstart",G.hitch(this,"onSelectStart")),w(this.node,"selectstart",G.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(f){return this.map[f]},setItem:function(f,d){this.map[f]=d},delItem:function(f){delete this.map[f]},forInItems:function(f,
d){d=d||l.global;var g=this.map,c=a._empty,m;for(m in g)m in c||f.call(d,g[m],m,this);return d},clearItems:function(){this.map={}},getAllNodes:function(){return t((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var f={};this.getAllNodes().forEach(function(d){if(d.id){var g=this.getItem(d.id);if(g){f[d.id]=g;return}}else d.id=a.getUniqueId();g=d.getAttribute("dndType");var c=d.getAttribute("dndData");f[d.id]={data:c||d.innerHTML,type:g?g.split(/\s*,\s*/):["text"]}},this);
this.map=f;return this},insertNodes:function(f,d,g){this.parent.firstChild?d?g||(g=this.parent.firstChild):g&&(g=g.nextSibling):g=null;if(g)for(d=0;d<f.length;++d){var c=this._normalizedCreator(f[d]);this.setItem(c.node.id,{data:c.data,type:c.type});g.parentNode.insertBefore(c.node,g)}else for(d=0;d<f.length;++d)c=this._normalizedCreator(f[d]),this.setItem(c.node.id,{data:c.data,type:c.type}),this.parent.appendChild(c.node);return this},destroy:function(){C.forEach(this.events,function(f){f.remove()});
this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(f,d,g){f._skipStartup=!0;return new g(d,f)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var f=this.parent.getElementsByTagName("tbody");f&&f.length&&(this.parent=f[0])}this.defaultCreator=a._defaultCreator(this.parent);this.sync()},onMouseOver:function(f){for(var d=f.relatedTarget;d&&d!=this.node;)try{d=d.parentNode}catch(g){d=null}d||(this._changeState("Container",
"Over"),this.onOverEvent());d=this._getChildByEvent(f);this.current!=d&&(this.current&&this._removeItemClass(this.current,"Over"),d&&this._addItemClass(d,"Over"),this.current=d)},onMouseOut:function(f){for(f=f.relatedTarget;f;){if(f==this.node)return;try{f=f.parentNode}catch(d){f=null}}this.current&&(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(f){this.withHandles||this.skipForm&&a.isFormElement(f)||(f.stopPropagation(),
f.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(f,d){var g="dojoDnd"+f;f=f.toLowerCase()+"State";B.replace(this.node,g+d,g+this[f]);this[f]=d},_addItemClass:function(f,d){B.add(f,"dojoDndItem"+d)},_removeItemClass:function(f,d){B.remove(f,"dojoDndItem"+d)},_getChildByEvent:function(f){if(f=f.target)for(var d=f.parentNode;d;f=d,d=f.parentNode)if((d==this.parent||this.allowNested)&&B.contains(f,"dojoDndItem"))return f;return null},_normalizedCreator:function(f,
d){f=(this.creator||this.defaultCreator).call(this,f,d);G.isArray(f.type)||(f.type=["text"]);f.node.id||(f.node.id=a.getUniqueId());B.add(f.node,"dojoDndItem");return f}});a._createNode=function(f){return f?function(d){return D.create(f,{innerHTML:d})}:a._createSpan};a._createTrTd=function(f){var d=D.create("tr");D.create("td",{innerHTML:f},d);return d};a._createSpan=function(f){return D.create("span",{innerHTML:f})};a._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};a._defaultCreator=function(f){f=
f.tagName.toLowerCase();var d="tbody"==f||"thead"==f?a._createTrTd:a._createNode(a._defaultCreatorNodes[f]);return function(g,c){var m=g&&G.isObject(g);if(m&&g.tagName&&g.nodeType&&g.getAttribute){var F=g.getAttribute("dndData")||g.innerHTML;m=(m=g.getAttribute("dndType"))?m.split(/\s*,\s*/):["text"]}else F=m&&g.data?g.data:g,m=m&&g.type?g.type:["text"],g=("avatar"==c?a._createSpan:d)(String(F));g.id||(g.id=a.getUniqueId());return{node:g,data:F,type:m}}};return O})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),
function(C,O,l,G,K,E,B,D,q,k,w,t,h,a){var f=O("dojo.dnd.Manager",[E],{constructor:function(){this.source=this.avatar=null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:B("touch")?4:16,OFFSET_Y:B("touch")?4:16,overSource:function(d){this.avatar&&(this.target=d&&"Disabled"!=d.targetState?d:null,this.canDropFlag=!!this.target,this.avatar.update());k.publish("/dnd/source/over",d)},outSource:function(d){this.avatar?this.target==d&&(this.target=null,this.canDropFlag=
!1,this.avatar.update(),k.publish("/dnd/source/over",null)):k.publish("/dnd/source/over",null)},startDrag:function(d,g,c){function m(F){F.preventDefault();F.stopPropagation()}h.autoScrollStart(G.doc);this.source=d;this.nodes=g;this.copy=!!c;this.avatar=this.makeAvatar();G.body().appendChild(this.avatar.node);k.publish("/dnd/start",d,g,this.copy);this.events=[q(G.doc,w.move,l.hitch(this,"onMouseMove")),q(G.doc,w.release,l.hitch(this,"onMouseUp")),q(G.doc,"keydown",l.hitch(this,"onKeyDown")),q(G.doc,
"keyup",l.hitch(this,"onKeyUp")),q(G.doc,"dragstart",m),q(G.body(),"selectstart",m)];d="dojoDnd"+(c?"Copy":"Move");K.add(G.body(),d)},canDrop:function(d){d=!(!this.target||!d);this.canDropFlag!=d&&(this.canDropFlag=d,this.avatar.update())},stopDrag:function(){K.remove(G.body(),["dojoDndCopy","dojoDndMove"]);C.forEach(this.events,function(d){d.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new a(this)},updateAvatar:function(){this.avatar.update()},
onMouseMove:function(d){var g=this.avatar;g&&(h.autoScrollNodes(d),g=g.node.style,g.left=d.pageX+this.OFFSET_X+"px",g.top=d.pageY+this.OFFSET_Y+"px",g=!!this.source.copyState(t.getCopyKeyState(d)),this.copy!=g&&this._setCopyStatus(g));B("touch")&&d.preventDefault()},onMouseUp:function(d){if(this.avatar){if(this.target&&this.canDropFlag){var g=!!this.source.copyState(t.getCopyKeyState(d));k.publish("/dnd/drop/before",this.source,this.nodes,g,this.target,d);k.publish("/dnd/drop",this.source,this.nodes,
g,this.target,d)}else k.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(d){if(this.avatar)switch(d.keyCode){case D.CTRL:d=!!this.source.copyState(!0);this.copy!=d&&this._setCopyStatus(d);break;case D.ESCAPE:k.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(d){this.avatar&&d.keyCode==D.CTRL&&(d=!!this.source.copyState(!1),this.copy!=d&&this._setCopyStatus(d))},_setCopyStatus:function(d){this.copy=d;this.source._markDndStatus(this.copy);this.updateAvatar();K.replace(G.body(),"dojoDnd"+
(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});t._manager=null;f.manager=t.manager=function(){t._manager||(t._manager=new f);return t._manager};return f})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(C,O,l,G,K,E,B,D){return C("dojo.dnd.Avatar",null,{constructor:function(q){this.manager=q;this.construct()},construct:function(){var q=E.create("table",{"class":"dojoDndAvatar",
style:{position:"absolute",zIndex:"1999",margin:"0px"}}),k=this.manager.source,w=E.create("tbody",null,q),t=E.create("tr",null,w),h=E.create("td",null,t),a=Math.min(5,this.manager.nodes.length),f=0;B("highcontrast")&&E.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},h);E.create("span",{innerHTML:k.generateText?this._generateText():""},h);for(G.set(t,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});f<a;++f){if(k.creator)var d=k._normalizedCreator(k.getItem(this.manager.nodes[f].id).data,
"avatar").node;else d=this.manager.nodes[f].cloneNode(!0),"tr"==d.tagName.toLowerCase()&&(t=E.create("table"),E.create("tbody",null,t).appendChild(d),d=t);d.id="";t=E.create("tr",null,w);h=E.create("td",null,t);h.appendChild(d);G.set(t,{"class":"dojoDndAvatarItem",style:{opacity:(9-f)/10}})}this.node=q},destroy:function(){E.destroy(this.node);this.node=!1},update:function(){K.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(B("highcontrast")){var q=l.byId("a11yIcon"),k="+";this.manager.canDropFlag&&
!this.manager.copy?k="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||(k="x"):k="o";q.innerHTML=k}D("tr.dojoDndAvatarHeader td span"+(B("highcontrast")?" span":""),this.node).forEach(function(w){w.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"esri/tasks/RouteTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../request ../geometry/normalizeUtils ./Task ./RouteResult ./NAMessage ./NAServiceDescription".split(" "),
function(C,O,l,G,K,E,B,D,q,k,w,t){C=C([q,t],{declaredClass:"esri.tasks.RouteTask",_eventMap:{"solve-complete":["result"]},constructor:function(h){this._url.orig=this._url.path;this._url.path+="/solve";this._handler=O.hitch(this,this._handler);this.registerConnectEvents()},__msigns:[{n:"solve",c:3,a:[{i:0,p:["stops.features","barriers.features","polylineBarriers.features","polygonBarriers.features"]}],e:2}],_handler:function(h,a,f,d,g){try{var c=[],m=[],F=h.directions||[],I=h.routes?h.routes.features:
[],M=h.stops?h.stops.features:[],T=h.barriers?h.barriers.features:[],V=h.polygonBarriers?h.polygonBarriers.features:[],J=h.polylineBarriers?h.polylineBarriers.features:[],L=h.messages,aa=l.forEach,P=l.indexOf,H=!0,R,y,Y=h.routes&&h.routes.spatialReference||h.stops&&h.stops.spatialReference||h.barriers&&h.barriers.spatialReference||h.polygonBarriers&&h.polygonBarriers.spatialReference||h.polylineBarriers&&h.polylineBarriers.spatialReference;this._chk=h.checksum;aa(F,function(v){c.push(R=v.routeName);
m[R]={directions:v}});aa(I,function(v){-1===P(c,R=v.attributes.Name)&&(c.push(R),m[R]={});m[R].route=v});aa(M,function(v){y=v.attributes;-1===P(c,R=y.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME")&&(c.push(R),m[R]={});"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==R&&(H=!1);void 0===m[R].stops&&(m[R].stops=[]);m[R].stops.push(v)});0<M.length&&!0===H&&(m[c[0]].stops=m["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,delete m["esri.tasks.RouteTask.NULL_ROUTE_NAME"],c.splice(l.indexOf(c,"esri.tasks.RouteTask.NULL_ROUTE_NAME"),
1));var da=[];aa(c,function(v,u){m[v].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===v?null:v;m[v].spatialReference=Y;da.push(new k(m[v]))});h=function(v){aa(v,function(u,Q){u.geometry&&(u.geometry.spatialReference=Y);v[Q]=new E(u)});return v};aa(L,function(v,u){L[u]=new w(v)});var z={routeResults:da,barriers:h(T),polygonBarriers:h(V),polylineBarriers:h(J),messages:L};this._successHandler([z],"onSolveComplete",f,g)}catch(v){this._errorHandler(v,d,g)}},solve:function(h,a,f,d){var g=d.assembly;
h=this._encode(O.mixin({},this._url.query,{f:"json"},h.toJson(g&&g[0]),this._chk?{checksum:this._chk}:{}));var c=this._handler,m=this._errorHandler;return B({url:this._url.path,timeout:25E4,content:h,callbackParamName:"callback",load:function(F,I){c(F,I,a,f,d.dfd)},error:function(F){m(F,f,d.dfd)}})},onSolveComplete:function(){}});D._createWrappers(C);G("extend-esri")&&O.setObject("tasks.RouteTask",C,K);return C})},"esri/tasks/RouteResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ./DirectionsFeatureSet".split(" "),
function(C,O,l,G,K,E,B){C=C(null,{declaredClass:"esri.tasks.RouteResult",constructor:function(D){var q=D.spatialReference,k=D.route;if(D.directions){var w=[],t=[],h=[];l.forEach(D.directions.features,function(f,d){t[d]=f.compressedGeometry;w[d]=f.strings;h[d]=f.events});D.directions.strings=w;D.directions.events=h;this.directions=new B(D.directions,t)}this.routeName=D.routeName;k&&(k.geometry&&(k.geometry.spatialReference=q),this.route=new E(k));if(D.stops){var a=this.stops=[];l.forEach(D.stops,function(f,
d){f.geometry&&(f.geometry.spatialReference=q);a[f.attributes.Sequence-1]=new E(f)})}},routeName:null,directions:null,route:null,stops:null});G("extend-esri")&&O.setObject("tasks.RouteResult",C,K);return C})},"esri/tasks/DirectionsFeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/json ../kernel ../geometry/Extent ../geometry/Polyline ../geometry/Point ../graphic ./FeatureSet".split(" "),function(C,O,l,G,K,E,B,D,q,k,w){C=C(w,{declaredClass:"esri.tasks.DirectionsFeatureSet",
constructor:function(t,h){this.routeId=t.routeId;this.routeName=t.routeName;O.mixin(this,t.summary);this.extent=new B(this.envelope);var a=this._fromCompressedGeometry,f=this.features,d=this.extent.spatialReference,g=[];l.forEach(h,function(c,m){f[m].setGeometry(g[m]=c?a(c,d):f[m].geometry)});this.mergedGeometry=this._mergePolylinesToSinglePath(g,d);this.geometryType="esriGeometryPolyline";l.forEach(t.events,function(c,m){l.forEach(c,function(F,I){c[I]=new k(new q(F.point.x,F.point.y,d),null,{ETA:F.ETA,
strings:K.stringify(F.strings),arriveTimeUTC:F.arriveTimeUTC})});t.events[m]=c});delete this.envelope},_fromCompressedGeometry:function(t,h){var a=0,f=0,d=0,g=0,c=[],m=0,F=0,I=0;(t=t.match(/((\+|\-)[^\+\-\|]+|\|)/g))||(t=[]);if(0===parseInt(t[m],32)){m=2;var M=parseInt(t[m],32);m++;var T=parseInt(t[m],32);m++;if(M&1){F=l.indexOf(t,"|")+1;var V=parseInt(t[F],32);F++}if(M&2){I=l.indexOf(t,"|",F)+1;var J=parseInt(t[I],32);I++}}else T=parseInt(t[m],32),m++;for(;m<t.length&&"|"!==t[m];){M=parseInt(t[m],
32)+a;m++;a=M;var L=parseInt(t[m],32)+f;m++;f=L;M=[M/T,L/T];F&&(L=parseInt(t[F],32)+d,F++,d=L,M.push(L/V));I&&(L=parseInt(t[I],32)+g,I++,g=L,M.push(L/J));c.push(M)}a=new D({paths:[c],hasZ:0<F,hasM:0<I});a.setSpatialReference(h);return a},_mergePolylinesToSinglePath:function(t,h){var a=[],f=!1;l.forEach(t,function(c){l.forEach(c.paths,function(m){f=f||c.hasM;a=a.concat(m)})});var d=[],g=[0,0];l.forEach(a,function(c){if(c[0]!==g[0]||c[1]!==g[1])d.push(c),g=c});return new D({paths:[d],spatialReference:h,
hasM:f})}});G("extend-esri")&&O.setObject("tasks.DirectionsFeatureSet",C,E);return C})},"esri/tasks/NAMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(C,O,l,G){C=C(null,{declaredClass:"esri.tasks.NAMessage",constructor:function(K){O.mixin(this,K)}});O.mixin(C,{TYPE_INFORMATIVE:0,TYPE_PROCESS_DEFINITION:1,TYPE_PROCESS_START:2,TYPE_PROCESS_STOP:3,TYPE_WARNING:50,TYPE_ERROR:100,TYPE_EMPTY:101,TYPE_ABORT:200});l("extend-esri")&&O.setObject("tasks.NAMessage",
C,G);return C})},"esri/tasks/NAServiceDescription":function(){define(["dojo/_base/declare","dojo/json","dojo/Deferred","dojo/_base/lang","../request"],function(C,O,l,G,K){return C(null,{declaredClass:"esri.tasks._NAServiceDescription",_sd:null,getServiceDescription:function(E,B){var D=new l;if(this._sd)D.resolve(this._sd);else if(this._url&&this._url.orig){var q=this._url.orig,k=(this._url.path.match(/\/solve$/)||[]).length?"Route":(this._url.path.match(/\/solveClosestFacility$/)||[]).length?"ClosestFacility":
"ServiceAreas",w,t=function(h){K({url:h+("/"===h[h.length-1]?"":"/")+"GetTravelModes/execute",content:{f:"json",serviceName:k},callbackParamName:"callback"}).then(function(a){var f=[],d=null;if(a&&a.results&&a.results.length)for(var g=0;g<a.results.length;g++)if("supportedTravelModes"===a.results[g].paramName){if(a.results[g].value&&a.results[g].value.features)for(var c=0;c<a.results[g].value.features.length;c++)if(a.results[g].value.features[c].attributes){var m=O.parse(a.results[g].value.features[c].attributes.TravelMode);
f.push(m)}}else"defaultTravelMode"===a.results[g].paramName&&(d=a.results[g].value);w.supportedTravelModes=f;w.defaultTravelMode=d;D.resolve(w)},function(a){console.log("Could not read from the routingUtilities service.");D.reject(a)})};K({url:q,content:{f:"json"},callbackParamName:"callback"}).then(function(h){w=h;w.supportedTravelModes||(w.supportedTravelModes=[]);for(h=0;h<w.supportedTravelModes.length;h++)w.supportedTravelModes[h].id||(w.supportedTravelModes[h].id=w.supportedTravelModes[h].itemId);
B?D.resolve(w):E?t(E):10.4<=w.currentVersion?K({url:q+("/"===q[q.length-1]?"":"/")+"retrieveTravelModes",content:{f:"json"},callbackParamName:"callback"}).then(function(a){w.supportedTravelModes=a.supportedTravelModes;w.defaultTravelMode=a.defaultTravelMode;D.resolve(w)},function(a){console.log("Could not get to the NAServer's retrieveTravelModes.");D.reject(a)}):K({url:q.substring(0,q.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).then(function(a){a.owningSystemUrl?
(q=a.owningSystemUrl,K({url:q+("/"===q[q.length-1]?"":"/")+"sharing/rest/portals/self",content:{f:"json"},callbackParamName:"callback"}).then(function(f){f&&f.helperServices&&f.helperServices.routingUtilities&&f.helperServices.routingUtilities.url?t(f.helperServices.routingUtilities.url):(console.log("Portal does not have helperServices.routingUtilities defined."),D.resolve(w))},function(f){console.log("Could not get to the portal's self.");D.reject(f)})):D.resolve(w)},function(a){console.log("Could not get to the NAServer service description.");
D.reject(a)})},function(h){D.reject(h)})}else D.reject("NA Task has no URL specified.");D.then(G.hitch(this,function(h){this._sd=h}),G.hitch(this,function(){this._sd=null}));return D.promise},getOwningSystemUrl:function(){var E=new l;if(this._url&&this._url.orig){var B=this._url.orig;K({url:B.substring(0,B.indexOf("/rest/")+6)+"info",content:{f:"json"},callbackParamName:"callback"}).promise.always(function(D){E.resolve(D.owningSystemUrl)})}else E.resolve(void 0);return E.promise}})})},"esri/tasks/RouteParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang ../graphicsUtils ./NATypes".split(" "),
function(C,O,l,G,K,E,B,D){C=C(null,{declaredClass:"esri.tasks.RouteParameters",accumulateAttributes:null,attributeParameterValues:null,barriers:null,directionsLanguage:null,directionsLengthUnits:null,directionsOutputType:null,directionsStyleName:null,directionsTimeAttribute:null,doNotLocateOnRestrictedElements:!0,findBestSequence:null,ignoreInvalidLocations:null,impedanceAttribute:null,outputLines:"esriNAOutputLineTrueShape",outputGeometryPrecision:null,outputGeometryPrecisionUnits:null,outSpatialReference:null,
overrides:null,polygonBarriers:null,polylineBarriers:null,preserveFirstStop:null,preserveLastStop:null,restrictionAttributes:null,restrictUTurns:null,returnBarriers:!1,returnDirections:!1,returnPolygonBarriers:!1,returnPolylineBarriers:!1,returnRoutes:!0,returnStops:!1,returnZ:!0,startTime:null,startTimeIsUTC:null,timeWindowsAreUTC:null,stops:null,useHierarchy:null,useTimeWindows:null,travelMode:null,toJson:function(q){var k={returnDirections:this.returnDirections,returnRoutes:this.returnRoutes,returnZ:this.returnZ,
returnStops:this.returnStops,returnBarriers:this.returnBarriers,returnPolygonBarriers:this.returnPolygonBarriers,returnPolylineBarriers:this.returnPolylineBarriers,attributeParameterValues:this.attributeParameterValues&&l.toJson(this.attributeParameterValues),outSR:this.outSpatialReference?this.outSpatialReference.wkid||l.toJson(this.outSpatialReference.toJson()):null,outputLines:this.outputLines,overrides:this.overrides,findBestSequence:this.findBestSequence,preserveFirstStop:this.preserveFirstStop,
preserveLastStop:this.preserveLastStop,useTimeWindows:this.useTimeWindows,startTime:this.startTime?this.startTime.getTime():null,startTimeIsUTC:this.startTimeIsUTC,timeWindowsAreUTC:this.timeWindowsAreUTC,accumulateAttributeNames:this.accumulateAttributes?this.accumulateAttributes.join(","):null,ignoreInvalidLocations:this.ignoreInvalidLocations,impedanceAttributeName:this.impedanceAttribute,restrictionAttributeNames:this.restrictionAttributes?this.restrictionAttributes.join(","):null,restrictUTurns:this.restrictUTurns,
useHierarchy:this.useHierarchy,directionsLanguage:this.directionsLanguage,outputGeometryPrecision:this.outputGeometryPrecision,outputGeometryPrecisionUnits:this.outputGeometryPrecisionUnits,directionsLengthUnits:D.LengthUnit[this.directionsLengthUnits],directionsTimeAttributeName:this.directionsTimeAttribute,directionsStyleName:this.directionsStyleName,travelMode:"object"===typeof this.travelMode?l.toJson(this.travelMode):this.travelMode},w=this.stops;"esri.tasks.FeatureSet"===w.declaredClass&&0<
w.features.length?k.stops=l.toJson({type:"features",features:B._encodeGraphics(w.features,q&&q["stops.features"]),doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}):"esri.tasks.DataLayer"===w.declaredClass?k.stops=w:"esri.tasks.DataFile"===w.declaredClass&&(k.stops=l.toJson({type:"features",url:w.url,doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements}));if(this.directionsOutputType)switch(this.directionsOutputType.toLowerCase()){case "complete":k.directionsOutputType=
"esriDOTComplete";break;case "complete-no-events":k.directionsOutputType="esriDOTCompleteNoEvents";break;case "instructions-only":k.directionsOutputType="esriDOTInstructionsOnly";break;case "standard":k.directionsOutputType="esriDOTStandard";break;case "summary-only":k.directionsOutputType="esriDOTSummaryOnly";break;default:k.directionsOutputType=this.directionsOutputType}w=function(t,h){return t?"esri.tasks.FeatureSet"===t.declaredClass?0<t.features.length?l.toJson({type:"features",features:B._encodeGraphics(t.features,
q&&q[h])}):null:"esri.tasks.DataLayer"===t.declaredClass?t:"esri.tasks.DataFile"===t.declaredClass?l.toJson({type:"features",url:t.url}):l.toJson(t):null};this.barriers&&(k.barriers=w(this.barriers,"barriers.features"));this.polygonBarriers&&(k.polygonBarriers=w(this.polygonBarriers,"polygonBarriers.features"));this.polylineBarriers&&(k.polylineBarriers=w(this.polylineBarriers,"polylineBarriers.features"));return E.filter(k,function(t){if(null!==t)return!0})}});G("extend-esri")&&O.setObject("tasks.RouteParameters",
C,K);return C})},"esri/tasks/NATypes":function(){define(["dojo/_base/lang","dojo/has","../kernel"],function(C,O,l){var G={esriFeet:"esriNAUFeet",esriKilometers:"esriNAUKilometers",esriMeters:"esriNAUMeters",esriMiles:"esriNAUMiles",esriNauticalMiles:"esriNAUNauticalMiles",esriYards:"esriNAUYards"},K={NONE:"esriNAOutputLineNone",STRAIGHT:"esriNAOutputLineStraight",TRUE_SHAPE:"esriNAOutputLineTrueShape",TRUE_SHAPE_WITH_MEASURE:"esriNAOutputLineTrueShapeWithMeasure"},E={ALLOW_BACKTRACK:"esriNFSBAllowBacktrack",
AT_DEAD_ENDS_ONLY:"esriNFSBAtDeadEndsOnly",NO_BACKTRACK:"esriNFSBNoBacktrack",AT_DEAD_ENDS_AND_INTERSECTIONS:"esriNFSBAtDeadEndsAndIntersections"},B={NONE:"esriNAOutputPolygonNone",SIMPLIFIED:"esriNAOutputPolygonSimplified",DETAILED:"esriNAOutputPolygonDetailed"},D={FROM_FACILITY:"esriNATravelDirectionFromFacility",TO_FACILITY:"esriNATravelDirectionToFacility"},q={LengthUnit:G,OutputLine:K,UTurn:E,OutputPolygon:B,TravelDirection:D};O("extend-esri")&&(C.setObject("tasks._NALengthUnit",G,l),C.setObject("tasks.NAOutputLine",
K,l),C.setObject("tasks.NAUTurn",E,l),C.setObject("tasks.NAOutputPolygon",B,l),C.setObject("tasks.NATravelDirection",D,l));return q})},"esri/tasks/DistanceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../geometry/jsonUtils".split(" "),function(C,O,l,G,K,E){C=C(null,{declaredClass:"esri.tasks.DistanceParameters",geometry1:null,geometry2:null,distanceUnit:null,geodesic:null,toJson:function(){var B={},D=this.geometry1;D&&(B.geometry1=l.toJson({geometryType:E.getJsonType(D),
geometry:D}));if(D=this.geometry2)B.geometry2=l.toJson({geometryType:E.getJsonType(D),geometry:D});B.sr=l.toJson(this.geometry1.spatialReference.toJson());this.distanceUnit&&(B.distanceUnit=this.distanceUnit);this.geodesic&&(B.geodesic=this.geodesic);return B}});G("extend-esri")&&O.setObject("tasks.DistanceParameters",C,K);return C})},"esri/tasks/PrintTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../lang ../layerUtils ../deferredUtils ../Color ../request ../urlUtils ../geometry/Polygon ../renderers/SimpleRenderer ../symbols/FillSymbol ./Geoprocessor ./PrintTemplate ./Task dojo/dom-attr dojo/dom-construct dojox/gfx/_base dojox/gfx/canvas dojox/json/query dojo/has!extend-esri?./PrintParameters dojo/has!extend-esri?./LegendLayer".split(" "),
function(C,O,l,G,K,E,B,D,q,k,w,t,h,a,f,d,g,c,m,F,I,M,T,V){C=C(m,{declaredClass:"esri.tasks.PrintTask",constructor:function(J,L){this.url=J;this.printGp=new g(this.url);this._handler=O.hitch(this,this._handler);L&&L.async&&(this.async=!0);this._colorEvaluator=V("$..color")},async:!1,_vtlExtent:null,_cimVersion:null,_is11xService:!1,_loadGpServerMetadata:!0,execute:function(J,L,aa){if(!this._loadGpServerMetadata)return this._execute(J,L,aa);var P=new K(k._dfdCanceller),H=this._url.path,R=H.lastIndexOf("/GPServer/");
0<R&&(H=H.slice(0,R+9));P._pendingDfd=t({url:H,callbackParamName:"callback",content:O.mixin({},this._url.query,{f:"json"})}).then(O.hitch(this,function(y){this._loadGpServerMetadata=!1;this.async="esriExecutionTypeAsynchronous"===y.executionType;this._cimVersion=y.cimVersion;this._is11xService=!!this._cimVersion;P._pendingDfd=this._execute(J);return P._pendingDfd})).then(O.hitch(this,function(y){this._successHandler([y],null,L,P)})).otherwise(function(y){aa&&aa(y);P.errback(y)});return P},_handler:function(J,
L,aa,P,H){try{if(this.async)"esriJobSucceeded"===J.jobStatus?this.printGp.getResultData(J.jobId,"Output_File",O.hitch(this,function(y){R=y.value;this._successHandler([R],"onComplete",aa,H)})):this._errorHandler(Error(J.jobStatus),P,H);else{var R=J[0].value;this._successHandler([R],"onComplete",aa,H)}}catch(y){this._errorHandler(y,P,H)}},_execute:function(J,L,aa){var P=this._handler,H=this._errorHandler,R=J.template||new c;R.hasOwnProperty("showLabels")||(R.showLabels=!0);var y=R.exportOptions,Y;y&&
(Y={outputSize:[y.width,y.height],dpi:y.dpi});y=R.layoutOptions;var da=[];if(y){this.legendAll=!1;y.legendLayers?l.forEach(y.legendLayers,function(ya){var Ea={};Ea.id=ya.layerId;ya.subLayerIds&&(Ea.subLayerIds=ya.subLayerIds);da.push(Ea)}):this.legendAll=!0;if("Miles"===y.scalebarUnit||"Kilometers"===y.scalebarUnit){var z="esriKilometers";var v="esriMiles"}else if("Meters"===y.scalebarUnit||"Feet"===y.scalebarUnit)z="esriMeters",v="esriFeet";var u={esriMiles:"mi",esriKilometers:"km",esriFeet:"ft",
esriMeters:"m"};u={titleText:y.titleText,authorText:y.authorText,copyrightText:y.copyrightText,customTextElements:y.customTextElements,scaleBarOptions:{metricUnit:z,metricLabel:u[z],nonMetricUnit:v,nonMetricLabel:u[v]},legendOptions:{operationalLayers:da}}}z=this._getPrintDefinition(J.map,R);J.outSpatialReference&&(z.mapOptions.spatialReference=J.outSpatialReference.toJson());J.template&&D.isDefined(J.template.showAttribution)&&(z.mapOptions.showAttribution=J.template.showAttribution);O.mixin(z,{exportOptions:Y,
layoutOptions:u});this.allLayerslegend&&O.mixin(z.layoutOptions,{legendOptions:{operationalLayers:this.allLayerslegend}});if(z.operationalLayers){Y=z.operationalLayers;var Q=function(ya){return D.fixJson(O.mixin(ya,{type:"esriSLS",cap:void 0,join:void 0,meterLimit:void 0}))},fa=/[\u4E00-\u9FFF\u0E00-\u0E7F\u0900-\u097F\u3040-\u309F\u30A0-\u30FF\u31F0-\u31FF]/,ea=/[\u0600-\u06FF]/,ka=function(ya){var Ea=ya.text,n=(ya=ya.font)&&ya.family&&ya.family.toLowerCase();Ea&&ya&&("arial"===n||"arial unicode ms"===
n)&&(ya.family=fa.test(Ea)?"Arial Unicode MS":"Arial","normal"!==ya.style&&ea.test(Ea)&&(ya.family="Arial Unicode MS"))};for(u=0;u<Y.length;u++)if(Y[u].featureCollection&&Y[u].featureCollection.layers)for(v=0;v<Y[u].featureCollection.layers.length;v++){var qa=Y[u].featureCollection.layers[v];if(qa.layerDefinition&&qa.layerDefinition.drawingInfo&&qa.layerDefinition.drawingInfo.renderer&&qa.layerDefinition.drawingInfo.renderer.symbol){var pa=qa.layerDefinition.drawingInfo.renderer;"esriCLS"===pa.symbol.type?
pa.symbol=Q(pa.symbol):"esriTS"===pa.symbol.type?ka(pa.symbol):pa.symbol.outline&&"esriCLS"===pa.symbol.outline.type&&(pa.symbol.outline=Q(pa.symbol.outline))}if(qa.featureSet&&qa.featureSet.features)for(y=0;y<qa.featureSet.features.length;y++)pa=qa.featureSet.features[y],pa.symbol&&("esriCLS"===pa.symbol.type?pa.symbol=Q(pa.symbol):"esriTS"===pa.symbol.type?ka(pa.symbol):pa.symbol.outline&&"esriCLS"===pa.symbol.outline.type&&(pa.symbol.outline=Q(pa.symbol.outline)))}}R={Web_Map_as_JSON:G.toJson(D.fixJson(z)),
Format:R.format,Layout_Template:R.layout};J.extraParameters&&(R=O.mixin(R,J.extraParameters));var xa=new K(k._dfdCanceller);J=function(ya,Ea){P(ya,Ea,L,aa,xa)};z=function(ya){H(ya,aa,xa)};xa._pendingDfd=this.async?this.printGp.submitJob(R,J,null,z):this.printGp.execute(R,J,z);return xa},onComplete:function(){},_createMultipointLayer:function(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",
features:[]}}},_createPolygonLayer:function(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}},_createPointLayer:function(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}},_createPolylineLayer:function(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",
drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}},_convertSvgSymbol:function(J){if(!(8>=E("ie")||!J.path&&"image/svg+xml"!==J.contentType)){var L=T.createSurface(I.create("div"),1024,1024);var aa="image/svg+xml"===J.contentType?L.createObject(T.Image,{src:"data:image/svg+xml;base64,"+J.imageData,width:M.pt2px(J.width),height:M.pt2px(J.height),x:0,y:0}):L.createObject(T.Path,J.path).setFill(J.color).setStroke(J.outline);"pendingRender"in L&&L._render(!0);var P=
L.rawNode.getContext("2d"),H=Math.ceil(aa.getBoundingBox().width),R=Math.ceil(aa.getBoundingBox().height);aa=P.getImageData(aa.getBoundingBox().x,aa.getBoundingBox().y,H,R);P.canvas.width=H;P.canvas.height=R;P.putImageData(aa,0,0);P=P.canvas.toDataURL("image/png");J={type:"esriPMS",imageData:P.substr(22,P.length),angle:J.angle,contentType:"image/png",height:J.size?J.size:M.px2pt(R),width:J.size?H/R*J.size:M.px2pt(H),xoffset:J.xoffset,yoffset:J.yoffset};L.destroy();return J}},_convertSvgRenderer:function(J){"simple"===
J.type&&J.symbol&&(J.symbol.path||"image/svg+xml"===J.symbol.contentType)?J.symbol=this._convertSvgSymbol(J.symbol):"uniqueValue"===J.type?(J.defaultSymbol&&(J.defaultSymbol.path||"image/svg+xml"===J.defaultSymbol.contentType)&&(J.defaultSymbol=this._convertSvgSymbol(J.defaultSymbol)),J.uniqueValueInfos&&l.forEach(J.uniqueValueInfos,function(L){if(L.symbol.path||"image/svg+xml"===L.symbol.contentType)L.symbol=this._convertSvgSymbol(L.symbol)},this)):"classBreaks"===J.type&&(J.defaultSymbol&&(J.defaultSymbol.path||
"image/svg+xml"===J.defaultSymbol.contentType)&&(J.defaultSymbol=this._convertSvgSymbol(J.defaultSymbol)),J.classBreakInfos&&l.forEach(J.classBreakInfos,function(L){if(L.symbol.path||"image/svg+xml"===L.symbol.contentType)L.symbol=this._convertSvgSymbol(L.symbol)},this))},_createFeatureCollection:function(J,L,aa,P){var H=this._createPolygonLayer(),R=this._createPolylineLayer(),y=this._createPointLayer(),Y=this._createMultipointLayer(),da=this._createPointLayer();da.layerDefinition.name="textLayer";
delete da.layerDefinition.drawingInfo;if("esri.layers.FeatureLayer"===J.declaredClass||"esri.layers.StreamLayer"===J.declaredClass)H.layerDefinition.name=R.layerDefinition.name=y.layerDefinition.name=Y.layerDefinition.name=O.getObject("arcgisProps.title",!1,J)||J.name||J.id;var z=J.renderer&&"esri.renderer.SimpleRenderer"===J.renderer.declaredClass;if(!J.renderer||J.renderer.valueExpression||O.isFunction(J.renderer.attributeField))delete H.layerDefinition.drawingInfo,delete R.layerDefinition.drawingInfo,
delete y.layerDefinition.drawingInfo,delete Y.layerDefinition.drawingInfo;else{var v=J.renderer.toJson({useLegacyRotationProperties:!0});if("temporal"===v.type){v={latestObservationRenderer:v.latestObservationRenderer,trackLinesRenderer:v.trackRenderer,observationAger:v.observationAger,renderer:v.observationRenderer};var u={};J._trackIdField&&(u.trackIdField=J._trackIdField);J._startTimeField&&(u.startTimeField=J._startTimeField);J._endTimeField&&(u.endTimeField=J._endTimeField);H.layerDefinition.drawingInfo=
v;H.layerDefinition.timeInfo=u;R.layerDefinition.drawingInfo=v;R.layerDefinition.timeInfo=u;y.layerDefinition.drawingInfo=v;y.layerDefinition.timeInfo=u;Y.layerDefinition.drawingInfo=v;Y.layerDefinition.timeInfo=u}else H.layerDefinition.drawingInfo.renderer=v,R.layerDefinition.drawingInfo.renderer=v,y.layerDefinition.drawingInfo.renderer=v,Y.layerDefinition.drawingInfo.renderer=v}v=J.fields;v||!J.renderer||J.renderer.valueExpression||O.isFunction(J.renderer.attributeField)||("esri.renderer.ClassBreaksRenderer"===
J.renderer.declaredClass?(v=[{name:J.renderer.attributeField,type:"esriFieldTypeDouble"}],J.renderer.normalizationField&&v.push({name:J.renderer.normalizationField,type:"esriFieldTypeDouble"})):"esri.renderer.UniqueValueRenderer"===J.renderer.declaredClass&&(v=[{name:J.renderer.attributeField,type:"esriFieldTypeString"}],J.renderer.attributeField2&&v.push({name:J.renderer.attributeField2,type:"esriFieldTypeString"}),J.renderer.attributeField3&&v.push({name:J.renderer.attributeField3,type:"esriFieldTypeString"})));
v&&(H.layerDefinition.fields=v,R.layerDefinition.fields=v,y.layerDefinition.fields=v,Y.layerDefinition.fields=v);v=J.graphics;J.isFeatureReductionActive&&J.isFeatureReductionActive()&&(v=J.getSingleGraphics());u=v.length;var Q;for(Q=0;Q<u;Q++){var fa=v[Q];if(!1!==fa.visible&&fa.geometry){var ea=fa.toJson();ea.symbol&&ea.symbol.outline&&ea.symbol.outline.color&&ea.symbol.outline.color[3]&&!this._is11xService&&(ea.symbol.outline.color[3]=255);if(J.renderer&&!ea.symbol&&(O.isFunction(J.renderer.attributeField)||
J.renderer.valueExpression||this._isFeatureCollectionRequired(J.renderer,J)||"esri.renderer.DotDensityRenderer"===J.renderer.declaredClass||aa)){aa=aa||J.renderer;var ka=null;try{ka=aa.getSymbol(fa)}catch(qa){}if(!ka)continue;ea.symbol=ka.toJson();this._isFeatureCollectionRequired(aa,J)&&this._applyVisualVariables(ea.symbol,{renderer:aa,graphic:fa,symbol:ka,mapResolution:L&&L.getResolutionInMeters(),mapScale:L&&L.getScale()})}ea.symbol&&(ea.symbol.path||"image/svg+xml"===ea.symbol.contentType?ea.symbol=
this._convertSvgSymbol(ea.symbol):ea.symbol.text&&delete ea.attributes);switch(fa.geometry.type){case "polygon":H.featureSet.features.push(ea);break;case "polyline":R.featureSet.features.push(ea);break;case "point":ea.symbol&&ea.symbol.text?da.featureSet.features.push(ea):y.featureSet.features.push(ea);break;case "multipoint":Y.featureSet.features.push(ea);break;case "extent":ea.geometry=a.fromExtent(fa.geometry).toJson(),H.featureSet.features.push(ea)}}}L=[];0<H.featureSet.features.length&&L.push(H);
0<R.featureSet.features.length&&L.push(R);0<Y.featureSet.features.length&&L.push(Y);0<y.featureSet.features.length&&L.push(y);0<da.featureSet.features.length&&L.push(da);if(!L.length)return null;l.forEach(L,function(qa){var pa=l.every(qa.featureSet.features,function(xa){return xa.symbol});if(z||pa)P&&P.forceFeatureAttributes||l.forEach(qa.featureSet.features,function(xa){delete xa.attributes}),P.forceFeatureAttributes||delete qa.layerDefinition.fields;pa&&delete qa.layerDefinition.drawingInfo});l.forEach(L,
function(qa){qa.layerDefinition.drawingInfo&&qa.layerDefinition.drawingInfo.renderer&&this._convertSvgRenderer(qa.layerDefinition.drawingInfo.renderer)},this);return{id:J.id,opacity:J.opacity,minScale:J.minScale||0,maxScale:J.maxScale||0,featureCollection:{layers:L}}},_getPrintDefinition:function(J,L){var aa={operationalLayers:this._createOperationalLayers(J,L)},P=this._vtlExtent||J.extent,H=J.spatialReference;this._vtlExtent=null;J.spatialReference._isWrappable()&&(P=P._normalize(!0),H=P.spatialReference);
P={mapOptions:{showAttribution:J.showAttribution,extent:P.toJson(),spatialReference:H.toJson()}};L.preserveScale&&O.mixin(P.mapOptions,{scale:L.outScale||J.getScale()});J.timeExtent&&O.mixin(P.mapOptions,{time:[J.timeExtent.startTime.getTime(),J.timeExtent.endTime.getTime()]});J={};O.mixin(J,P,aa);return J},_createOperationalLayers:function(J,L){var aa,P=[],H=0;L.preserveScale&&(H=L.outScale||J.getScale());this.allLayerslegend=this.legendAll?[]:null;this._vtlExtent=null;var R=l.map(J.layerIds,J.getLayer,
J);J._mapImageLyr&&R.push(J._mapImageLyr);for(aa=0;aa<R.length;aa++){var y=R[aa];if(y.loaded&&y.visible&&(!H||y.isVisibleAtScale(H))){var Y=y.declaredClass;var da={id:y.id,title:O.getObject("arcgisProps.title",!1,y)||y.id,opacity:y.opacity,minScale:y.minScale||0,maxScale:y.maxScale||0};da=O.mixin(da,this._getUrlAndToken(y));y.getNode()&&F.get(y.getNode(),"data-reference")&&(da._isRefLayer=!0);switch(Y){case "esri.layers.ArcGISDynamicMapServiceLayer":var z=[];Y=!!y._params.layers;if(y._params.dynamicLayers)Y=
L.outScale?y._getDynLayerObjs(L.outScale):G.fromJson(y._params.dynamicLayers),l.forEach(Y,function(ea){z.push({id:ea.id,name:ea.name,layerDefinition:ea});delete ea.id;delete ea.name;delete ea.maxScale;delete ea.minScale}),0===z.length&&(da.visibleLayers=[-1]);else if(y.supportsDynamicLayers){if(Y||y.layerDefinitions||y.layerTimeOptions){var v=y.createDynamicLayerInfosFromLayerInfos(),u=null;Y&&(u=y.visibleLayers);u=q._getVisibleLayers(v,u);var Q=q._getLayersForScale(L.outScale||J.getScale(),v);l.forEach(v,
function(ea){if(!ea.subLayerIds){var ka=ea.id;-1<l.indexOf(u,ka)&&-1<l.indexOf(Q,ka)&&(ea={source:ea.source.toJson()},y.layerDefinitions&&y.layerDefinitions[ka]&&(ea.definitionExpression=y.layerDefinitions[ka]),y.layerTimeOptions&&y.layerTimeOptions[ka]&&(ea.layerTimeOptions=y.layerTimeOptions[ka].toJson()),z.push({id:ka,layerDefinition:ea}))}});0===z.length&&(da.visibleLayers=[-1])}}else l.forEach(y.layerInfos,function(ea){var ka={id:ea.id,layerDefinition:{}};y.layerDefinitions&&y.layerDefinitions[ea.id]&&
(ka.layerDefinition.definitionExpression=y.layerDefinitions[ea.id]);y.layerTimeOptions&&y.layerTimeOptions[ea.id]&&(ka.layerDefinition.layerTimeOptions=y.layerTimeOptions[ea.id].toJson());(ka.layerDefinition.definitionExpression||ka.layerDefinition.layerTimeOptions)&&z.push(ka)}),Y&&(da.visibleLayers=y.visibleLayers.length?y.visibleLayers:[-1]);z.length&&(da.layers=z);P.push(da);this.allLayerslegend&&this.allLayerslegend.push({id:y.id,subLayerIds:y.visibleLayers});break;case "esri.layers.ArcGISImageServiceLayer":da=
O.mixin(da,{url:y.url,bandIds:y.bandIds,compressionQuality:y.compressionQuality,format:y.format,interpolation:y.interpolation});y.mosaicRule&&O.mixin(da,{mosaicRule:y.mosaicRule.toJson()});if(y.renderingRule||y.renderer)this._is11xService?(y.renderingRule&&(da.renderingRule=y.renderingRule.toJson()),y.renderer&&(da.layerDefinition=da.layerDefinition||{},da.layerDefinition.drawingInfo=da.layerDefinition.drawingInfo||{},da.layerDefinition.drawingInfo.renderer=y.renderer.toJson())):(Y=y.getExportImageRenderingRule())&&
O.mixin(da,{renderingRule:Y.toJson()});P.push(da);this.allLayerslegend&&this.allLayerslegend.push({id:y.id});break;case "esri.layers.RasterXLayer":this._is11xService&&(da=O.mixin(da,{url:y.url,bandIds:y.bandIds,interpolation:y.interpolation}),y.renderer&&(da.layerDefinition=da.layerDefinition||{},da.layerDefinition.drawingInfo=da.layerDefinition.drawingInfo||{},da.layerDefinition.drawingInfo.renderer=y.renderer.toJson()),P.push(da),this.allLayerslegend&&this.allLayerslegend.push({id:y.id}));break;
case "esri.layers.WMSLayer":da=O.mixin(da,{url:y.url,title:y.title,type:"wms",version:y.version,transparentBackground:y.imageTransparency,visibleLayers:y.visibleLayers});P.push(da);this.allLayerslegend&&this.allLayerslegend.push({id:y.id,subLayerIds:y.visibleLayers});break;case "esri.virtualearth.VETiledLayer":Y=y.mapStyle;"roadOnDemand"===Y?Y="Road":"aerialWithLabelsOnDemand"===Y&&(Y="Hybrid");da=O.mixin(da,{visibility:y.visible,type:"BingMaps"+Y,culture:y.culture,key:y.bingMapsKey});P.push(da);
break;case "esri.layers.OpenStreetMapLayer":da=O.mixin(da,{credits:y.copyright,type:"OpenStreetMap",url:h.getAbsoluteUrl(y.tileServers[0])});P.push(da);break;case "esri.layers.WMTSLayer":da=O.mixin(da,{url:y.url,type:"wmts",layer:y._identifier,style:y._style,format:y.format,tileMatrixSet:y._tileMatrixSetId});P.push(da);break;case "esri.layers.MapImageLayer":Y=y.getImages();l.forEach(Y,function(ea,ka){ea.visible&&ea.href&&(da={id:y.id+"_image"+ka,type:"image",title:y.id,minScale:y.minScale||0,maxScale:y.maxScale||
0,opacity:y.opacity*ea.opacity,extent:ea.extent.toJson()},"data:image/png;base64,"===ea.href.substr(0,22)?da.imageData=ea.href.substr(22):da.url=ea.href,P.push(da))});break;case "esri.layers.VectorTileLayer":delete da.url;delete da.token;if(this._is11xService&&y.currentStyleInfo.serviceUrl&&y.currentStyleInfo.styleUrl&&(Y=B.id&&B.id.findCredential(y.currentStyleInfo.styleUrl),v=B.id&&B.id.findCredential(y.currentStyleInfo.serviceUrl),!Y&&!v||"2.1.0"!==this._cimVersion)){da.type="VectorTileLayer";
da.styleUrl=y.currentStyleInfo.styleUrl;Y&&(da.token=Y.token);v&&v.token!==da.token&&(da.additionalTokens=[{url:y.currentStyleInfo.serviceUrl,token:v.token}]);P.push(da);break}da.type="image";Y=this._vtlExtent||J.extent.offset(0,0);var fa=L.exportOptions&&L.exportOptions.dpi||96;v={format:"png",pixelRatio:fa/96};"MAP_ONLY"!==L.layout||!L.preserveScale||L.outScale&&L.outScale!==J.getScale()||96!==fa||!L.exportOptions||L.exportOptions.width%2===J.width%2&&L.exportOptions.height%2===J.height%2||(v.area=
{x:0,y:0,width:J.width,height:J.height},L.exportOptions.width%2!==J.width%2&&--v.area.width,L.exportOptions.height%2!==J.height%2&&--v.area.height,this._vtlExtent||(fa=J.toMap({x:v.area.width,y:v.area.height}),Y.update(Y.xmin,fa.y,fa.x,Y.ymax,Y.spatialReference),this._vtlExtent=Y));da.extent=Y._normalize(!0).toJson();Y=y.takeScreenshot(v);Y.isResolved()?Y.then(function(ea){"data:image/png;base64,"===ea.dataURL.substr(0,22)&&(da.imageData=ea.dataURL.substr(22))}):console.error("PrintTask: VectorTileLayer.takeScreenshot() returned an unresolved Promise");
da.imageData&&P.push(da);break;case "esri.layers.WebTiledLayer":Y=y.url.replace(/\$\{/g,"{");da=O.mixin(da,{type:"WebTiledLayer",urlTemplate:Y,credits:y.copyright});y.subDomains&&0<y.subDomains.length&&(da.subDomains=y.subDomains);y._wmtsInfo&&(da.wmtsInfo=y._wmtsInfo);delete da.url;P.push(da);break;default:if(y.getTileUrl||y.getImageUrl)da=O.mixin(da,{url:y.url}),P.push(da)}}}R=l.map(J.graphicsLayerIds,J.getLayer,J);for(aa=0;aa<R.length;aa++)y=R[aa],y.isFeatureReductionActive&&y.isFeatureReductionActive()&&
(y.getSingleGraphics().length?R.splice(++aa,0,y.getFeatureReductionLayer()):R[aa]=y.getFeatureReductionLayer());for(aa=0;aa<R.length;aa++)if(y=R[aa],y.loaded&&y.visible&&(!H||y.isVisibleAtScale(H)))switch(Y=y.declaredClass,Y){case "esri.layers.CSVLayer":if(this._is11xService){da={id:y.id,url:y.url,title:y.title,opacity:y.opacity,minScale:y.minScale||0,maxScale:y.maxScale||0,type:"CSV",locationInfo:{latitudeFieldName:y.latitudeFieldName,longitudeFieldName:y.longitudeFieldName},layerDefinition:{drawingInfo:{renderer:y.renderer&&
y.renderer.toJson({useLegacyRotationProperties:!0})}}};P.push(da);break}case "esri.layers.FeatureLayer":case "esri.layers.LabelLayer":case "esri.layers.StreamLayer":if("esri.layers.LabelLayer"===Y&&!L.showLabels||y.renderer&&"esri.renderer.HeatmapRenderer"===y.renderer.declaredClass)continue;Y=null;y.url&&y.renderer&&("esri.renderer.ScaleDependentRenderer"===y.renderer.declaredClass?"scale"===y.renderer.rangeType?Y=y.renderer.getRendererInfoByScale(J.getScale())&&y.renderer.getRendererInfoByScale(J.getScale()).renderer:
"zoom"===y.renderer.rangeType&&(Y=y.renderer.getRendererInfoByZoom(J.getZoom())&&y.renderer.getRendererInfoByZoom(J.getZoom()).renderer):Y=y.renderer);v=Y&&"esri.layers.CSVLayer"!==y.declaredClass&&!this._isFeatureCollectionRequired(Y,y)&&!Y.valueExpression;fa=y.isFeatureReductionActive&&y.isFeatureReductionActive();if(Y&&!fa&&"esri.renderer.DotDensityRenderer"!==Y.declaredClass&&"esri.layers.StreamLayer"!==y.declaredClass&&(this._is11xService||v)&&("esri.renderer.SimpleRenderer"===Y.declaredClass||
"esri.renderer.TemporalRenderer"===Y.declaredClass||null==Y.attributeField||O.isString(Y.attributeField)&&y._getField(Y.attributeField,!0)))if(da={id:y.id,title:O.getObject("arcgisProps.title",!1,y)||y.id,opacity:y.opacity,minScale:y.minScale||0,maxScale:y.maxScale||0,layerDefinition:{drawingInfo:{renderer:Y.toJson({useLegacyRotationProperties:!0})}}},da=O.mixin(da,this._getUrlAndToken(y)),"esri.renderer.TemporalRenderer"===Y.declaredClass&&(v=da.layerDefinition.drawingInfo,v.latestObservationRenderer=
v.renderer.latestObservationRenderer,v.trackLinesRenderer=v.renderer.trackRenderer,v.observationAger=v.renderer.observationAger,v.renderer=v.renderer.observationRenderer,y._trackIdField&&(da.layerDefinition.timeInfo={trackIdField:y._trackIdField})),this._convertSvgRenderer(da.layerDefinition.drawingInfo.renderer),this._is11xService||1>y.opacity||"esri.renderer.TemporalRenderer"===Y.declaredClass||this._updateLayerOpacity(da))if(y._params.source&&(Y=y._params.source.toJson(),O.mixin(da.layerDefinition,
{source:Y})),y.getDefinitionExpression()&&O.mixin(da.layerDefinition,{definitionExpression:y.getDefinitionExpression()}),2!==y.mode)0<y.getSelectedFeatures().length&&(Y=l.map(y.getSelectedFeatures(),function(ea){return ea.attributes[y.objectIdField]}),0<Y.length&&y.getSelectionSymbol()&&O.mixin(da,{selectionObjectIds:Y,selectionSymbol:y.getSelectionSymbol().toJson()}));else{Y=l.map(y.getSelectedFeatures(),function(ea){return ea.attributes[y.objectIdField]});if(0===Y.length||!y._params.drawMode)break;
O.mixin(da.layerDefinition,{objectIds:Y});Y=null;y.getSelectionSymbol()&&(Y=new f(y.getSelectionSymbol()));O.mixin(da.layerDefinition.drawingInfo,{renderer:Y&&Y.toJson()})}else da=this._createFeatureCollection(y,J,null,L);else da=Y&&(Y.valueExpression||this._isFeatureCollectionRequired(Y,y)||"esri.renderer.DotDensityRenderer"===Y.declaredClass)?this._createFeatureCollection(y,J,Y,L):this._createFeatureCollection(y,J,null,L);if(!da)continue;P.push(da);this.allLayerslegend&&this.allLayerslegend.push({id:y.id});
break;case "esri.layers._GraphicsLayer":case "esri.layers.GraphicsLayer":case "esri.layers.WFSLayer":da=this._createFeatureCollection(y,J,null,L);if(!da)continue;P.push(da);this.allLayerslegend&&this.allLayerslegend.push({id:y.id});break;case "esri.layers.ArcGISImageServiceVectorLayer":da={id:y.id,title:O.getObject("arcgisProps.title",!1,y)||y.id,opacity:y.opacity,minScale:y.minScale||0,maxScale:y.maxScale||0,visibility:y.visible,symbolTileSize:y.symbolTileSize,layerDefinition:{drawingInfo:{renderer:y.renderer.toJson({useLegacyRotationProperties:!0})}}},
da=O.mixin(da,this._getUrlAndToken(y)),y.mosaicRule&&O.mixin(da,{mosaicRule:y.mosaicRule.toJson()}),P.push(da),this.allLayerslegend&&this.allLayerslegend.push({id:y.id})}H&&l.forEach(P,function(ea){ea.minScale=0;ea.maxScale=0});J.graphics&&0<J.graphics.graphics.length&&(da=this._createFeatureCollection(J.graphics,J,null,L))&&P.push(da);J._labels&&L.showLabels&&(da=this._createFeatureCollection(J._labels,J,null,L))&&P.push(da);l.forEach(P,function(ea,ka,qa){ea._isRefLayer&&(delete ea._isRefLayer,qa.splice(ka,
1),qa.push(ea))});return P},_getUrlAndToken:function(J){return{token:J._getToken(),url:J._url?J._url.path:null}},_updateLayerOpacity:function(J){var L=this._colorEvaluator(J);L=l.filter(L,function(R){return O.isArray(R)&&4===R.length});var aa=!0;if(L.length){var P=L[0][3],H;for(H=1;H<L.length;H++)if(P!==L[H][3]){aa=!1;break}if(aa)for(J.opacity=P/255,H=0;H<L.length;H++)L[H][3]=255}return aa},_isFeatureCollectionRequired:function(J,L){if(L&&L.isFeatureReductionActive&&L.isFeatureReductionActive())return!0;
var aa=!1;if(L=this._getVariable(J,"rotationInfo",!1))aa=(aa=L.field)&&O.isFunction(aa)||L.valueExpression;return J.hasVisualVariables("sizeInfo")||J.hasVisualVariables("colorInfo")||J.hasVisualVariables("opacityInfo")||aa},_getVariable:function(J,L,aa){if(J)var P=(J=J.getVisualVariablesForType(L,aa))&&J[0];return P},_applyVisualVariables:function(J,L){var aa=L.renderer,P=L.graphic,H=L.symbol,R=L.mapResolution,y=L.mapScale,Y=H.type;if("textsymbol"!==Y&&"shieldlabelsymbol"!==Y){var da=this._getVariable(aa,
"sizeInfo",!1),z=this._getVariable(aa,"colorInfo",!1),v=this._getVariable(aa,"opacityInfo",!1);L=this._getVariable(aa,"rotationInfo",!1);H instanceof d&&(da=this._getVariable(aa,"sizeInfo","outline")||da);R=da?aa.getSize(P,{sizeInfo:da,shape:"simplemarkersymbol"===Y?H.style:null,resolution:R,scale:y}):P.size;null!=R&&("simplemarkersymbol"===Y?J.size=M.px2pt(R):"picturemarkersymbol"===Y?(y=H.width/H.height*R,J.width=M.px2pt(y),J.height=M.px2pt(R),0!==H.xoffset&&(J.xoffset=M.px2pt(H.xoffset/H.width*
y)),0!==H.yoffset&&(J.yoffset=M.px2pt(H.yoffset/H.height*R))):"simplelinesymbol"===Y?J.width=M.px2pt(R):J.outline&&(J.outline.width=M.px2pt(R)));z&&(!(H=aa.getColor(P,{colorInfo:z}))||"simplemarkersymbol"!==Y&&"simplelinesymbol"!==Y&&"simplefillsymbol"!==Y||(J.color=w.toJsonColor(H)));v&&(H=aa.getOpacity(P,{opacityInfo:v}),null!=H&&J.color&&(J.color[3]=Math.round(255*H)));L&&(aa=aa.getRotationAngle(P,{rotationInfo:L}))&&(J.angle=-aa)}}});E("extend-esri")&&O.setObject("tasks.PrintTask",C,B);return C})},
"esri/tasks/Geoprocessor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has dojo/io-query ../kernel ../request ../deferredUtils ../geometry/normalizeUtils ./Task ./FeatureSet ./JobInfo ./GPMessage ./LinearUnit ./DataFile ./RasterData ./Date ./ParameterValue ./GPResultImageLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/MapImage".split(" "),function(C,O,l,G,K,E,B,D,q,k,w,t,h,a,f,d,g,c,m,F,I,M,T){C=C(t,{declaredClass:"esri.tasks.Geoprocessor",
_eventMap:{"execute-complete":["results","messages"],"get-result-data-complete":["result"],"get-result-image-complete":["mapImage"],"get-result-image-layer-complete":["layer"],"job-cancel":["jobInfo"],"job-complete":["jobInfo"],"status-update":["jobInfo"]},constructor:function(V){this._jobUpdateHandler=O.hitch(this,this._jobUpdateHandler);this._getJobStatus=O.hitch(this,this._getJobStatus);this._getResultDataHandler=O.hitch(this,this._getResultDataHandler);this._getResultImageHandler=O.hitch(this,
this._getResultImageHandler);this._executeHandler=O.hitch(this,this._executeHandler);this._updateTimers=[];this.registerConnectEvents()},updateDelay:1E3,processSpatialReference:null,outputSpatialReference:null,outSpatialReference:null,setUpdateDelay:function(V){this.updateDelay=V},setProcessSpatialReference:function(V){this.processSpatialReference=V},setOutputSpatialReference:function(V){this._setOutSR(V)},setOutSpatialReference:function(V){this._setOutSR(V)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["*"]}],
e:2,f:1},{n:"submitJob",c:4,a:[{i:0,p:["*"]}],e:3}],_setOutSR:function(V){this.outSpatialReference=this.outputSpatialReference=V},_getOutSR:function(){return this.outSpatialReference||this.outputSpatialReference},_gpEncode:function(V,J,L){for(var aa in V){var P=V[aa];O.isArray(P)?V[aa]=K.toJson(l.map(P,function(H){return this._gpEncode({item:H},!0).item},this)):P instanceof Date&&(V[aa]=P.getTime())}return this._encode(V,J,L)},_decode:function(V){var J=V.dataType,L=new F(V);if(-1!==l.indexOf(["GPBoolean",
"GPDouble","GPLong","GPString"],J))return L;if("GPLinearUnit"===J)L.value=new d(L.value);else if("GPFeatureRecordSetLayer"===J||"GPRecordSet"===J)L.value=new h(L.value);else if("GPDataFile"===J)L.value=new g(L.value);else if("GPDate"===J)V=L.value,O.isString(V)?L.value=new m({date:V}):L.value=new Date(V);else if("GPRasterData"===J||"GPRasterDataLayer"===J)V=V.value.mapImage,L.value=V?new T(V):new c(L.value);else if(-1!==J.indexOf("GPMultiValue:")){var aa=J.split(":")[1];V=L.value;L.value=l.map(V,
function(P){return this._decode({paramName:"_name",dataType:aa,value:P}).value},this)}else console.log(this.declaredClass+" : GP Data type not handled. : "+L.dataType),L=null;return L},submitJob:function(V,J,L,aa,P){var H=this._getOutSR(),R=P.assembly;V=this._gpEncode(O.mixin({},this._url.query,{f:"json","env:outSR":H?H.wkid||K.toJson(H.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||K.toJson(this.processSpatialReference.toJson()):null},V),null,R&&R[0]);
var y=this._jobUpdateHandler,Y=this._errorHandler;return q({url:this._url.path+"/submitJob",content:V,callbackParamName:"callback",load:function(da,z){y(da,z,!1,J,L,P.dfd)},error:function(da){Y(da,aa,P.dfd)}})},_jobUpdateHandler:function(V,J,L,aa,P,H){var R=V.jobId;J=new a(V);this._successHandler([J],"onStatusUpdate",P,L&&H);if(!L)switch(clearTimeout(this._updateTimers[R]),this._updateTimers[R]=null,H&&H.progress(J),V.jobStatus){case a.STATUS_SUBMITTED:case a.STATUS_EXECUTING:case a.STATUS_WAITING:case a.STATUS_NEW:var y=
this._getJobStatus;this._updateTimers[R]=setTimeout(function(){y(R,L,aa,P,H)},this.updateDelay);break;default:this._successHandler([J],"onJobComplete",aa,H)}},_getJobStatus:function(V,J,L,aa,P){var H=this._jobUpdateHandler;q({url:this._url.path+"/jobs/"+V,content:O.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(R,y){H(R,y,J,L,aa,P)},error:this._errorHandler})},_getResultDataHandler:function(V,J,L,aa,P){try{var H=this._decode(V);this._successHandler([H],"onGetResultDataComplete",
L,P)}catch(R){this._errorHandler(R,aa,P)}},getResultData:function(V,J,L,aa){var P=this._getResultDataHandler,H=this._errorHandler,R=new G(k._dfdCanceller);R._pendingDfd=q({url:this._url.path+"/jobs/"+V+"/results/"+J,content:O.mixin({},this._url.query,{f:"json",returnType:"data"}),callbackParamName:"callback",load:function(y,Y){P(y,Y,L,aa,R)},error:function(y){H(y,aa,R)}});return R},checkJobStatus:function(V,J,L){var aa=this._jobUpdateHandler,P=this._errorHandler,H=new G(k._dfdCanceller);H._pendingDfd=
q({url:this._url.path+"/jobs/"+V,content:O.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(R,y){aa(R,y,!0,null,J,H)},error:function(R){P(R,L,H)}});return H},cancelJob:function(V,J,L){var aa=this._errorHandler,P=new G(k._dfdCanceller);P._pendingDfd=q({url:this._url.path+"/jobs/"+V+"/cancel",content:O.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:O.hitch(this,function(H,R){this._successHandler([H],"onJobCancel",J,P)}),error:function(H){aa(H,L,
P)}});return P},execute:function(V,J,L,aa){var P=this._getOutSR(),H=aa.assembly;V=this._gpEncode(O.mixin({},this._url.query,{f:"json","env:outSR":P?P.wkid||K.toJson(P.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||K.toJson(this.processSpatialReference.toJson()):null},V),null,H&&H[0]);var R=this._executeHandler,y=this._errorHandler;return q({url:this._url.path+"/execute",content:V,callbackParamName:"callback",load:function(Y,da){R(Y,da,J,L,aa.dfd)},error:function(Y){y(Y,
L,aa.dfd)}})},_executeHandler:function(V,J,L,aa,P){try{var H=V.results,R,y=V.messages;var Y=0;for(R=H.length;Y<R;Y++)H[Y]=this._decode(H[Y]);Y=0;for(R=y.length;Y<R;Y++)y[Y]=new f(y[Y]);this._successHandler([H,y],"onExecuteComplete",L,P)}catch(da){this._errorHandler(da,aa,P)}},_getResultImageHandler:function(V,J,L,aa,P){try{var H=this._decode(V);this._successHandler([H],"onGetResultImageComplete",L,P)}catch(R){this._errorHandler(R,aa,P)}},getResultImage:function(V,J,L,aa,P){var H=this._getResultImageHandler,
R=this._errorHandler;L=this._gpEncode(O.mixin({},this._url.query,{f:"json"},L.toJson()));var y=new G(k._dfdCanceller);y._pendingDfd=q({url:this._url.path+"/jobs/"+V+"/results/"+J,content:L,callbackParamName:"callback",load:function(Y,da){H(Y,da,aa,P,y)},error:function(Y){R(Y,P,y)}});return y},cancelJobStatusUpdates:function(V){clearTimeout(this._updateTimers[V]);this._updateTimers[V]=null},getResultImageLayer:function(V,J,L,aa){if(null==J){var P=this._url.path.indexOf("/GPServer/");V=this._url.path.substring(0,
P)+"/MapServer/jobs/"+V}else V=this._url.path+"/jobs/"+V+"/results/"+J;this._url.query&&(V+="?"+B.objectToQuery(this._url.query));J=null==J?new M(V,{imageParameters:L}):new I(V,{imageParameters:L},!0);this.onGetResultImageLayerComplete(J);aa&&aa(J);return J},onStatusUpdate:function(){},onJobComplete:function(){},onExecuteComplete:function(){},onGetResultDataComplete:function(){},onGetResultImageComplete:function(){},onGetResultImageLayerComplete:function(){},onJobCancel:function(){}});w._createWrappers(C);
E("extend-esri")&&O.setObject("tasks.Geoprocessor",C,D);return C})},"esri/tasks/JobInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./GPMessage"],function(C,O,l,G,K){C=C(null,{declaredClass:"esri.tasks.JobInfo",constructor:function(E){this.messages=[];O.mixin(this,E);E=this.messages;var B,D=E.length;for(B=0;B<D;B++)E[B]=new K(E[B])},jobId:"",jobStatus:""});O.mixin(C,{STATUS_CANCELLED:"esriJobCancelled",STATUS_CANCELLING:"esriJobCancelling",STATUS_DELETED:"esriJobDeleted",
STATUS_DELETING:"esriJobDeleting",STATUS_EXECUTING:"esriJobExecuting",STATUS_FAILED:"esriJobFailed",STATUS_NEW:"esriJobNew",STATUS_SUBMITTED:"esriJobSubmitted",STATUS_SUCCEEDED:"esriJobSucceeded",STATUS_TIMED_OUT:"esriJobTimedOut",STATUS_WAITING:"esriJobWaiting"});l("extend-esri")&&O.setObject("tasks.JobInfo",C,G);return C})},"esri/tasks/GPMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(C,O,l,G){C=C(null,{declaredClass:"esri.tasks.GPMessage",constructor:function(K){O.mixin(this,
K)}});O.mixin(C,{TYPE_INFORMATIVE:"esriJobMessageTypeInformative",TYPE_PROCESS_DEFINITION:"esriJobMessageTypeProcessDefinition",TYPE_PROCESS_START:"esriJobMessageTypeProcessStart",TYPE_PROCESS_STOP:"esriJobMessageTypeProcessStop",TYPE_WARNING:"esriJobMessageTypeWarning",TYPE_ERROR:"esriJobMessageTypeError",TYPE_EMPTY:"esriJobMessageTypeEmpty",TYPE_ABORT:"esriJobMessageTypeAbort"});l("extend-esri")&&O.setObject("tasks.GPMessage",C,G);return C})},"esri/tasks/LinearUnit":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(C,O,l,G){C=C(null,{declaredClass:"esri.tasks.LinearUnit",constructor:function(K){K&&O.mixin(this,K)},distance:0,units:null,toJson:function(){var K={};this.distance&&(K.distance=this.distance);this.units&&(K.units=this.units);return K}});l("extend-esri")&&O.setObject("tasks.LinearUnit",C,G);return C})},"esri/tasks/DataFile":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(C,O,l,G){C=C(null,{declaredClass:"esri.tasks.DataFile",
constructor:function(K){K&&O.mixin(this,K)},url:null,itemID:null,toJson:function(){var K={};this.url&&(K.url=this.url);this.itemID&&(K.itemID=this.itemID);return K}});l("extend-esri")&&O.setObject("tasks.DataFile",C,G);return C})},"esri/tasks/RasterData":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(C,O,l,G){C=C(null,{declaredClass:"esri.tasks.RasterData",constructor:function(K){K&&O.mixin(this,K)},url:null,format:null,itemID:null,toJson:function(){var K=
{};this.url&&(K.url=this.url);this.format&&(K.format=this.format);this.itemID&&(K.itemID=this.itemID);return K}});l("extend-esri")&&O.setObject("tasks.RasterData",C,G);return C})},"esri/tasks/Date":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/date/locale","dojo/has","../kernel"],function(C,O,l,G,K){C=C(null,{declaredClass:"esri.tasks.Date",constructor:function(E){E&&(E.format&&(this.format=E.format),this.date=l.parse(E.date,{selector:"date",datePattern:this.format}))},date:new Date,
format:"EEE MMM dd HH:mm:ss zzz yyyy",toJson:function(){return{date:l.format(this.date,{selector:"date",datePattern:this.format}),format:this.format}}});G("extend-esri")&&O.setObject("tasks.Date",C,K);return C})},"esri/tasks/ParameterValue":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(C,O,l,G){C=C(null,{declaredClass:"esri.tasks.ParameterValue",constructor:function(K){O.mixin(this,K)}});l("extend-esri")&&O.setObject("tasks.ParameterValue",C,G);return C})},
"esri/tasks/GPResultImageLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has dojo/io-query ../kernel ../layers/ArcGISDynamicMapServiceLayer".split(" "),function(C,O,l,G,K,E,B){C=C(B,{declaredClass:"esri.tasks._GPResultImageLayer",constructor:function(D,q){q&&q.imageParameters&&q.imageParameters.extent&&(this.initialExtent=this.fullExtent=q.imageParameters.extent,this.spatialReference=this.initialExtent.spatialReference);this.getImageUrl=O.hitch(this,this.getImageUrl);
this.loaded=!0;this.onLoad(this)},getImageUrl:function(D,q,k,w){var t=D.spatialReference.wkid;w(this._url.path+"?"+K.objectToQuery(O.mixin(this._params,{f:"image",bbox:l.toJson(D.toJson()),bboxSR:t,imageSR:t,size:q+","+k})))}});G("extend-esri")&&O.setObject("tasks._GPResultImageLayer",C,E);return C})},"esri/tasks/PrintTemplate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(C,O,l,G){C=C(null,{declaredClass:"esri.tasks.PrintTemplate",label:null,exportOptions:{width:800,
height:1100,dpi:96},layoutOptions:null,format:"PNG32",layout:"MAP_ONLY",outScale:0,preserveScale:!0,forceFeatureAttributes:!1,showAttribution:null,showLabels:!0});l("extend-esri")&&O.setObject("tasks.PrintTemplate",C,G);return C})},"dojox/gfx/canvas":function(){define("./_base dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/_base/window dojo/dom-geometry dojo/dom ./shape ./path ./arc ./matrix ./decompose ./bezierutils".split(" "),function(C,O,l,G,K,E,B,D,q,k,w,t,h){function a(z,v,u,Q,fa,
ea,ka,qa,pa,xa){var ya=v.length,Ea=0;if(xa){var n=xa.l/fa;Ea=xa.i}else n=v[0]/fa;for(;ea<ka;){if(ea+n>ka){var N={l:(ea+n-ka)*fa,i:Ea};n=ka-ea}Ea%2||(z.beginPath(),z.arc(u,Q,fa,ea,ea+n,qa),pa&&z.stroke());ea+=n;++Ea;n=v[Ea%ya]/fa}return N}function f(z,v,u,Q){var fa=0,ea=0,ka=0;if(Q){var qa=Q.l;ka=Q.i}else qa=v[0];for(;1>ea;)ea=h.tAtLength(z,qa),1==ea&&(fa=h.computeLength(z),fa={l:qa-fa,i:ka}),z=h.splitBezierAtT(z,ea),ka%2||u.push(z[0]),z=z[1],++ka,qa=v[ka%v.length];return fa}function d(z,v,u,Q){var fa=
[v.last.x,v.last.y].concat(u),ea=!(z instanceof Array);u=4===u.length?"quadraticCurveTo":"bezierCurveTo";var ka=[];v=f(fa,v.canvasDash,ka,Q);for(Q=0;Q<ka.length;++Q)fa=ka[Q],ea?(z.moveTo(fa[0],fa[1]),z[u].apply(z,fa.slice(2))):(z.push("moveTo",[fa[0],fa[1]]),z.push(u,fa.slice(2)));return v}function g(z,v,u,Q,fa,ea,ka){var qa=0,pa=0,xa=0,ya=h.distance(u,Q,fa,ea),Ea=0;v=v.canvasDash;var n=u,N=Q,W=!(z instanceof Array);ka?(xa=ka.l,Ea=ka.i):xa+=v[0];for(;.01<Math.abs(1-pa);){xa>ya&&(qa={l:xa-ya,i:Ea},
xa=ya);pa=xa/ya;ka=u+(fa-u)*pa;var U=Q+(ea-Q)*pa;Ea++%2||(W?(z.moveTo(n,N),z.lineTo(ka,U)):(z.push("moveTo",[n,N]),z.push("lineTo",[ka,U])));n=ka;N=U;xa+=v[Ea%v.length]}return qa}var c=C.canvas={},m=null,F=w.multiplyPoint,I=Math.PI,M=2*I,T=I/2;t=O.extend;if(K.global.CanvasRenderingContext2D){K=K.doc.createElement("canvas").getContext("2d");var V="function"==typeof K.setLineDash,J="function"==typeof K.fillText}var L={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,
1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};c.Shape=G("dojox.gfx.canvas.Shape",D.Shape,{_render:function(z){z.save();this._renderTransform(z);this._renderClip(z);this._renderShape(z);this._renderFill(z,!0);this._renderStroke(z,!0);z.restore()},_renderClip:function(z){this.canvasClip&&(this.canvasClip.render(z),z.clip())},_renderTransform:function(z){if("canvasTransform"in this){var v=this.canvasTransform;z.translate(v.dx,v.dy);
z.rotate(v.angle2);z.scale(v.sx,v.sy);z.rotate(v.angle1)}},_renderShape:function(z){},_renderFill:function(z,v){if("canvasFill"in this){var u=this.fillStyle;if("canvasFillImage"in this){var Q=u.width,fa=u.height,ea=this.canvasFillImage.width,ka=this.canvasFillImage.height,qa=Math.min(Q==ea?1:Q/ea,fa==ka?1:fa/ka),pa=(Q-qa*ea)/2,xa=(fa-qa*ka)/2;m.width=Q;m.height=fa;var ya=m.getContext("2d");ya.clearRect(0,0,Q,fa);ya.drawImage(this.canvasFillImage,0,0,ea,ka,pa,xa,qa*ea,qa*ka);this.canvasFill=z.createPattern(m,
"repeat");delete this.canvasFillImage}z.fillStyle=this.canvasFill;v&&("pattern"!==u.type||0===u.x&&0===u.y||z.translate(u.x,u.y),z.fill())}else z.fillStyle="rgba(0,0,0,0.0)"},_renderStroke:function(z,v){var u=this.strokeStyle;u?(z.strokeStyle=u.color.toString(),z.lineWidth=u.width,z.lineCap=u.cap,"number"==typeof u.join?(z.lineJoin="miter",z.miterLimit=u.join):z.lineJoin=u.join,this.canvasDash?V?(z.setLineDash(this.canvasDash),v&&z.stroke()):this._renderDashedStroke(z,v):v&&z.stroke()):v||(z.strokeStyle=
"rgba(0,0,0,0.0)")},_renderDashedStroke:function(z,v){},getEventSource:function(){return null},on:function(){},connect:function(){},disconnect:function(){},canvasClip:null,setClip:function(z){this.inherited(arguments);var v=z?"width"in z?"rect":"cx"in z?"ellipse":"points"in z?"polyline":"d"in z?"path":null:null;if(z&&!v)return this;this.canvasClip=z?aa(v,z):null;this.parent&&this.parent._makeDirty();return this}});var aa=function(z,v){switch(z){case "ellipse":return{canvasEllipse:y({shape:v}),render:function(u){return c.Ellipse.prototype._renderShape.call(this,
u)}};case "rect":return{shape:O.delegate(v,{r:0}),render:function(u){return c.Rect.prototype._renderShape.call(this,u)}};case "path":return{canvasPath:P(v),render:function(u){this.canvasPath._renderShape(u)}};case "polyline":return{canvasPolyline:v.points,render:function(u){return c.Polyline.prototype._renderShape.call(this,u)}}}return null},P=function(z){var v=new dojox.gfx.canvas.Path;v.canvasPath=[];v._setPath(z.d);return v},H=function(z,v,u){var Q=z.prototype[v];z.prototype[v]=u?function(){this.parent&&
this.parent._makeDirty();Q.apply(this,arguments);u.call(this);return this}:function(){this.parent&&this.parent._makeDirty();return Q.apply(this,arguments)}};H(c.Shape,"setTransform",function(){this.matrix?this.canvasTransform=C.decompose(this.matrix):delete this.canvasTransform});H(c.Shape,"setFill",function(){var z=this.fillStyle;if(z){if("object"==typeof z&&"type"in z){var v=this.surface.rawNode.getContext("2d");switch(z.type){case "linear":case "radial":var u="linear"==z.type?v.createLinearGradient(z.x1,
z.y1,z.x2,z.y2):v.createRadialGradient(z.cx,z.cy,0,z.cx,z.cy,z.r);l.forEach(z.colors,function(Q){u.addColorStop(Q.offset,C.normalizeColor(Q.color).toString())});break;case "pattern":m||(m=document.createElement("canvas")),v=new Image,this.surface.downloadImage(v,z.src),this.canvasFillImage=v}}else u=z.toString();this.canvasFill=u}else delete this.canvasFill});H(c.Shape,"setStroke",function(){var z=this.strokeStyle;if(z){var v=this.strokeStyle.style.toLowerCase();v in L&&(v=L[v]);if(v instanceof Array){this.canvasDash=
v=v.slice();var u;for(u=0;u<v.length;++u)v[u]*=z.width;if("butt"!=z.cap){for(u=0;u<v.length;u+=2)v[u]-=z.width,1>v[u]&&(v[u]=1);for(u=1;u<v.length;u+=2)v[u]+=z.width}}else delete this.canvasDash}else delete this.canvasDash;this._needsDash=!V&&!!this.canvasDash});H(c.Shape,"setShape");c.Group=G("dojox.gfx.canvas.Group",c.Shape,{constructor:function(){D.Container._init.call(this)},_render:function(z){z.save();this._renderTransform(z);this._renderClip(z);for(var v=0;v<this.children.length;++v)this.children[v]._render(z);
z.restore()},destroy:function(){D.Container.clear.call(this,!0);c.Shape.prototype.destroy.apply(this,arguments)}});c.Rect=G("dojox.gfx.canvas.Rect",[c.Shape,D.Rect],{_renderShape:function(z){var v=this.shape,u=Math.min(v.r,v.height/2,v.width/2),Q=v.x,fa=Q+v.width,ea=v.y;v=ea+v.height;var ka=Q+u,qa=fa-u,pa=ea+u,xa=v-u;z.beginPath();z.moveTo(ka,ea);u?(z.arc(qa,pa,u,-T,0,!1),z.arc(qa,xa,u,0,T,!1),z.arc(ka,xa,u,T,I,!1),z.arc(ka,pa,u,I,I+T,!1)):(z.lineTo(qa,ea),z.lineTo(fa,xa),z.lineTo(ka,v),z.lineTo(Q,
pa));z.closePath()},_renderDashedStroke:function(z,v){var u=this.shape,Q=Math.min(u.r,u.height/2,u.width/2),fa=u.x,ea=fa+u.width,ka=u.y,qa=ka+u.height,pa=fa+Q,xa=ea-Q,ya=ka+Q,Ea=qa-Q;Q?(z.beginPath(),u=g(z,this,pa,ka,xa,ka),v&&z.stroke(),u=a(z,this.canvasDash,xa,ya,Q,-T,0,!1,v,u),z.beginPath(),u=g(z,this,ea,ya,ea,Ea,u),v&&z.stroke(),u=a(z,this.canvasDash,xa,Ea,Q,0,T,!1,v,u),z.beginPath(),u=g(z,this,xa,qa,pa,qa,u),v&&z.stroke(),u=a(z,this.canvasDash,pa,Ea,Q,T,I,!1,v,u),z.beginPath(),u=g(z,this,fa,
Ea,fa,ya,u),v&&z.stroke(),a(z,this.canvasDash,pa,ya,Q,I,I+T,!1,v,u)):(z.beginPath(),u=g(z,this,pa,ka,xa,ka),u=g(z,this,xa,ka,ea,Ea,u),u=g(z,this,ea,Ea,pa,qa,u),g(z,this,pa,qa,fa,ya,u),v&&z.stroke())}});var R=[];(function(){var z=k.curvePI4;R.push(z.s,z.c1,z.c2,z.e);for(var v=45;360>v;v+=45){var u=w.rotateg(v);R.push(F(u,z.c1),F(u,z.c2),F(u,z.e))}})();var y=function(z){var v=[],u=z.shape,Q=w.normalize([w.translate(u.cx,u.cy),w.scale(u.rx,u.ry)]);var fa=F(Q,R[0]);v.push([fa.x,fa.y]);for(u=1;u<R.length;u+=
3){var ea=F(Q,R[u]);var ka=F(Q,R[u+1]);fa=F(Q,R[u+2]);v.push([ea.x,ea.y,ka.x,ka.y,fa.x,fa.y])}if(z._needsDash){fa=[];ea=v[0];for(u=1;u<v.length;++u)ka=[],f(ea.concat(v[u]),z.canvasDash,ka),ea=[v[u][4],v[u][5]],fa.push(ka);z._dashedPoints=fa}return v};c.Ellipse=G("dojox.gfx.canvas.Ellipse",[c.Shape,D.Ellipse],{setShape:function(){this.inherited(arguments);this.canvasEllipse=y(this);return this},setStroke:function(){this.inherited(arguments);V||(this.canvasEllipse=y(this));return this},_renderShape:function(z){var v=
this.canvasEllipse,u;z.beginPath();z.moveTo.apply(z,v[0]);for(u=1;u<v.length;++u)z.bezierCurveTo.apply(z,v[u]);z.closePath()},_renderDashedStroke:function(z,v){var u=this._dashedPoints;z.beginPath();for(var Q=0;Q<u.length;++Q)for(var fa=u[Q],ea=0;ea<fa.length;++ea){var ka=fa[ea];z.moveTo(ka[0],ka[1]);z.bezierCurveTo(ka[2],ka[3],ka[4],ka[5],ka[6],ka[7])}v&&z.stroke()}});c.Circle=G("dojox.gfx.canvas.Circle",[c.Shape,D.Circle],{_renderShape:function(z){var v=this.shape;z.beginPath();z.arc(v.cx,v.cy,
v.r,0,M,1)},_renderDashedStroke:function(z,v){var u=this.shape,Q=0,fa=this.canvasDash.length;for(i=0;Q<M;){var ea=this.canvasDash[i%fa]/u.r;i%2||(z.beginPath(),z.arc(u.cx,u.cy,u.r,Q,Q+ea,0),v&&z.stroke());Q+=ea;++i}}});c.Line=G("dojox.gfx.canvas.Line",[c.Shape,D.Line],{_renderShape:function(z){var v=this.shape;z.beginPath();z.moveTo(v.x1,v.y1);z.lineTo(v.x2,v.y2)},_renderDashedStroke:function(z,v){var u=this.shape;z.beginPath();g(z,this,u.x1,u.y1,u.x2,u.y2);v&&z.stroke()}});c.Polyline=G("dojox.gfx.canvas.Polyline",
[c.Shape,D.Polyline],{setShape:function(){this.inherited(arguments);var z=this.shape.points,v=z[0],u;this.bbox=null;this._normalizePoints();if(z.length)if("number"==typeof v)v=z;else for(v=[],u=0;u<z.length;++u){var Q=z[u];v.push(Q.x,Q.y)}else v=[];this.canvasPolyline=v;return this},_renderShape:function(z){var v=this.canvasPolyline;if(v.length){z.beginPath();z.moveTo(v[0],v[1]);for(var u=2;u<v.length;u+=2)z.lineTo(v[u],v[u+1])}},_renderDashedStroke:function(z,v){var u=this.canvasPolyline,Q=0;z.beginPath();
for(var fa=0;fa<u.length;fa+=2)Q=g(z,this,u[fa],u[fa+1],u[fa+2],u[fa+3],Q);v&&z.stroke()}});c.Image=G("dojox.gfx.canvas.Image",[c.Shape,D.Image],{setShape:function(){this.inherited(arguments);var z=new Image;this.surface.downloadImage(z,this.shape.src);this.canvasImage=z;return this},_renderShape:function(z){var v=this.shape;z.drawImage(this.canvasImage,v.x,v.y,v.width,v.height)}});c.Text=G("dojox.gfx.canvas.Text",[c.Shape,D.Text],{_setFont:function(){this.fontStyle?this.canvasFont=C.makeFontString(this.fontStyle):
delete this.canvasFont},getTextWidth:function(){var z=this.shape,v=0;if(z.text){var u=this.surface.rawNode.getContext("2d");u.save();this._renderTransform(u);this._renderFill(u,!1);this._renderStroke(u,!1);this.canvasFont&&(u.font=this.canvasFont);v=u.measureText(z.text).width;u.restore()}return v},_render:function(z){z.save();this._renderTransform(z);this._renderFill(z,!1);this._renderStroke(z,!1);this._renderShape(z);z.restore()},_renderShape:function(z){var v=this.shape;v.text&&(z.textAlign="middle"===
v.align?"center":v.align,this.canvasFont&&(z.font=this.canvasFont),this.canvasFill&&z.fillText(v.text,v.x,v.y),this.strokeStyle&&(z.beginPath(),z.strokeText(v.text,v.x,v.y),z.closePath()))}});H(c.Text,"setFont");J||c.Text.extend({getTextWidth:function(){return 0},getBoundingBox:function(){return null},_renderShape:function(){}});var Y={M:"_moveToA",m:"_moveToR",L:"_lineToA",l:"_lineToR",H:"_hLineToA",h:"_hLineToR",V:"_vLineToA",v:"_vLineToR",C:"_curveToA",c:"_curveToR",S:"_smoothCurveToA",s:"_smoothCurveToR",
Q:"_qCurveToA",q:"_qCurveToR",T:"_qSmoothCurveToA",t:"_qSmoothCurveToR",A:"_arcTo",a:"_arcTo",Z:"_closePath",z:"_closePath"};c.Path=G("dojox.gfx.canvas.Path",[c.Shape,q.Path],{constructor:function(){this.lastControl={}},setShape:function(){this.canvasPath=[];this._dashedPath=[];return this.inherited(arguments)},setStroke:function(){this.inherited(arguments);V||(this.segmented=!1,this._confirmSegmented());return this},_setPath:function(){this._dashResidue=null;this.inherited(arguments)},_updateWithSegment:function(z){var v=
O.clone(this.last);this[Y[z.action]](this.canvasPath,z.action,z.args,this._needsDash?this._dashedPath:null);this.last=v;this.inherited(arguments)},_renderShape:function(z){var v=this.canvasPath;z.beginPath();for(var u=0;u<v.length;u+=2)z[v[u]].apply(z,v[u+1])},_renderDashedStroke:V?function(){}:function(z,v){var u=this._dashedPath;z.beginPath();for(var Q=0;Q<u.length;Q+=2)z[u[Q]].apply(z,u[Q+1]);v&&z.stroke()},_moveToA:function(z,v,u,Q){z.push("moveTo",[u[0],u[1]]);Q&&Q.push("moveTo",[u[0],u[1]]);
for(v=2;v<u.length;v+=2)z.push("lineTo",[u[v],u[v+1]]),Q&&(this._dashResidue=g(Q,this,u[v-2],u[v-1],u[v],u[v+1],this._dashResidue));this.last.x=u[u.length-2];this.last.y=u[u.length-1];this.lastControl={}},_moveToR:function(z,v,u,Q){v="x"in this.last?[this.last.x+=u[0],this.last.y+=u[1]]:[this.last.x=u[0],this.last.y=u[1]];z.push("moveTo",v);Q&&Q.push("moveTo",v);for(v=2;v<u.length;v+=2)z.push("lineTo",[this.last.x+=u[v],this.last.y+=u[v+1]]),Q&&(this._dashResidue=g(Q,this,Q[Q.length-1][0],Q[Q.length-
1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_lineToA:function(z,v,u,Q){for(v=0;v<u.length;v+=2)Q&&(this._dashResidue=g(Q,this,this.last.x,this.last.y,u[v],u[v+1],this._dashResidue)),z.push("lineTo",[u[v],u[v+1]]);this.last.x=u[u.length-2];this.last.y=u[u.length-1];this.lastControl={}},_lineToR:function(z,v,u,Q){for(v=0;v<u.length;v+=2)z.push("lineTo",[this.last.x+=u[v],this.last.y+=u[v+1]]),Q&&(this._dashResidue=g(Q,this,Q[Q.length-1][0],Q[Q.length-1][1],this.last.x,this.last.y,
this._dashResidue));this.lastControl={}},_hLineToA:function(z,v,u,Q){for(v=0;v<u.length;++v)z.push("lineTo",[u[v],this.last.y]),Q&&(this._dashResidue=g(Q,this,Q[Q.length-1][0],Q[Q.length-1][1],u[v],this.last.y,this._dashResidue));this.last.x=u[u.length-1];this.lastControl={}},_hLineToR:function(z,v,u,Q){for(v=0;v<u.length;++v)z.push("lineTo",[this.last.x+=u[v],this.last.y]),Q&&(this._dashResidue=g(Q,this,Q[Q.length-1][0],Q[Q.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl=
{}},_vLineToA:function(z,v,u,Q){for(v=0;v<u.length;++v)z.push("lineTo",[this.last.x,u[v]]),Q&&(this._dashResidue=g(Q,this,Q[Q.length-1][0],Q[Q.length-1][1],this.last.x,u[v],this._dashResidue));this.last.y=u[u.length-1];this.lastControl={}},_vLineToR:function(z,v,u,Q){for(v=0;v<u.length;++v)z.push("lineTo",[this.last.x,this.last.y+=u[v]]),Q&&(this._dashResidue=g(Q,this,Q[Q.length-1][0],Q[Q.length-1][1],this.last.x,this.last.y,this._dashResidue));this.lastControl={}},_curveToA:function(z,v,u,Q){for(v=
0;v<u.length;v+=6)z.push("bezierCurveTo",u.slice(v,v+6)),Q&&(this._dashResidue=d(Q,this,z[z.length-1],this._dashResidue));this.last.x=u[u.length-2];this.last.y=u[u.length-1];this.lastControl.x=u[u.length-4];this.lastControl.y=u[u.length-3];this.lastControl.type="C"},_curveToR:function(z,v,u,Q){for(v=0;v<u.length;v+=6)z.push("bezierCurveTo",[this.last.x+u[v],this.last.y+u[v+1],this.lastControl.x=this.last.x+u[v+2],this.lastControl.y=this.last.y+u[v+3],this.last.x+u[v+4],this.last.y+u[v+5]]),Q&&(this._dashResidue=
d(Q,this,z[z.length-1],this._dashResidue)),this.last.x+=u[v+4],this.last.y+=u[v+5];this.lastControl.type="C"},_smoothCurveToA:function(z,v,u,Q){for(v=0;v<u.length;v+=4){var fa="C"==this.lastControl.type;z.push("bezierCurveTo",[fa?2*this.last.x-this.lastControl.x:this.last.x,fa?2*this.last.y-this.lastControl.y:this.last.y,u[v],u[v+1],u[v+2],u[v+3]]);Q&&(this._dashResidue=d(Q,this,z[z.length-1],this._dashResidue));this.lastControl.x=u[v];this.lastControl.y=u[v+1];this.lastControl.type="C"}this.last.x=
u[u.length-2];this.last.y=u[u.length-1]},_smoothCurveToR:function(z,v,u,Q){for(v=0;v<u.length;v+=4){var fa="C"==this.lastControl.type;z.push("bezierCurveTo",[fa?2*this.last.x-this.lastControl.x:this.last.x,fa?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+u[v],this.last.y+u[v+1],this.last.x+u[v+2],this.last.y+u[v+3]]);Q&&(this._dashResidue=d(Q,this,z[z.length-1],this._dashResidue));this.lastControl.x=this.last.x+u[v];this.lastControl.y=this.last.y+u[v+1];this.lastControl.type="C";this.last.x+=
u[v+2];this.last.y+=u[v+3]}},_qCurveToA:function(z,v,u,Q){for(v=0;v<u.length;v+=4)z.push("quadraticCurveTo",u.slice(v,v+4));Q&&(this._dashResidue=d(Q,this,z[z.length-1],this._dashResidue));this.last.x=u[u.length-2];this.last.y=u[u.length-1];this.lastControl.x=u[u.length-4];this.lastControl.y=u[u.length-3];this.lastControl.type="Q"},_qCurveToR:function(z,v,u,Q){for(v=0;v<u.length;v+=4)z.push("quadraticCurveTo",[this.lastControl.x=this.last.x+u[v],this.lastControl.y=this.last.y+u[v+1],this.last.x+u[v+
2],this.last.y+u[v+3]]),Q&&(this._dashResidue=d(Q,this,z[z.length-1],this._dashResidue)),this.last.x+=u[v+2],this.last.y+=u[v+3];this.lastControl.type="Q"},_qSmoothCurveToA:function(z,v,u,Q){for(v=0;v<u.length;v+=2){var fa="Q"==this.lastControl.type;z.push("quadraticCurveTo",[this.lastControl.x=fa?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=fa?2*this.last.y-this.lastControl.y:this.last.y,u[v],u[v+1]]);Q&&(this._dashResidue=d(Q,this,z[z.length-1],this._dashResidue));this.lastControl.type=
"Q"}this.last.x=u[u.length-2];this.last.y=u[u.length-1]},_qSmoothCurveToR:function(z,v,u,Q){for(v=0;v<u.length;v+=2){var fa="Q"==this.lastControl.type;z.push("quadraticCurveTo",[this.lastControl.x=fa?2*this.last.x-this.lastControl.x:this.last.x,this.lastControl.y=fa?2*this.last.y-this.lastControl.y:this.last.y,this.last.x+u[v],this.last.y+u[v+1]]);Q&&(this._dashResidue=d(Q,this,z[z.length-1],this._dashResidue));this.lastControl.type="Q";this.last.x+=u[v];this.last.y+=u[v+1]}},_arcTo:function(z,v,
u,Q){v="a"==v;for(var fa=0;fa<u.length;fa+=7){var ea=u[fa+5],ka=u[fa+6];v&&(ea+=this.last.x,ka+=this.last.y);var qa=k.arcAsBezier(this.last,u[fa],u[fa+1],u[fa+2],u[fa+3]?1:0,u[fa+4]?1:0,ea,ka);l.forEach(qa,function(pa){z.push("bezierCurveTo",pa)});Q&&(this._dashResidue=d(Q,this,p,this._dashResidue));this.last.x=ea;this.last.y=ka}this.lastControl={}},_closePath:function(z,v,u,Q){z.push("closePath",[]);Q&&(this._dashResidue=g(Q,this,this.last.x,this.last.y,Q[1][0],Q[1][1],this._dashResidue));this.lastControl=
{}}});l.forEach("moveTo lineTo hLineTo vLineTo curveTo smoothCurveTo qCurveTo qSmoothCurveTo arcTo closePath".split(" "),function(z){H(c.Path,z)});c.TextPath=G("dojox.gfx.canvas.TextPath",[c.Shape,q.TextPath],{_renderShape:function(z){},_setText:function(){},_setFont:function(){}});c.Surface=G("dojox.gfx.canvas.Surface",D.Surface,{constructor:function(){D.Container._init.call(this);this.pendingImageCount=0;this.makeDirty()},destroy:function(){D.Container.clear.call(this,!0);this.inherited(arguments)},
setDimensions:function(z,v){this.width=C.normalizedLength(z);this.height=C.normalizedLength(v);if(!this.rawNode)return this;z=!1;this.rawNode.width!=this.width&&(this.rawNode.width=this.width,z=!0);this.rawNode.height!=this.height&&(this.rawNode.height=this.height,z=!0);z&&this.makeDirty();return this},getDimensions:function(){return this.rawNode?{width:this.rawNode.width,height:this.rawNode.height}:null},_render:function(z){!this.rawNode||!z&&this.pendingImageCount||(z=this.rawNode.getContext("2d"),
z.clearRect(0,0,this.rawNode.width,this.rawNode.height),this.render(z),"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender))},render:function(z){z.save();for(var v=0;v<this.children.length;++v)this.children[v]._render(z);z.restore()},makeDirty:function(){this.pendingImagesCount||"pendingRender"in this||this._batch||(this.pendingRender=setTimeout(O.hitch(this,this._render),0))},downloadImage:function(z,v){var u=O.hitch(this,this.onImageLoad);!this.pendingImageCount++&&
"pendingRender"in this&&(clearTimeout(this.pendingRender),delete this.pendingRender);z.onload=u;z.onerror=u;z.onabort=u;z.src=v},onImageLoad:function(){--this.pendingImageCount||(this.onImagesLoaded(),this._render())},onImagesLoaded:function(){},getEventSource:function(){return null},connect:function(){},disconnect:function(){},on:function(){}});c.createSurface=function(z,v,u){if(!v&&!u){var Q=E.position(z);v=v||Q.w;u=u||Q.h}"number"==typeof v&&(v+="px");"number"==typeof u&&(u+="px");Q=new c.Surface;
z=B.byId(z);var fa=z.ownerDocument.createElement("canvas");fa.width=C.normalizedLength(v);fa.height=C.normalizedLength(u);z.appendChild(fa);Q.rawNode=fa;Q._parent=z;return Q.surface=Q};var da=D.Container;G={openBatch:function(){++this._batch;return this},closeBatch:function(){this._batch=0<this._batch?--this._batch:0;this._makeDirty();return this},_makeDirty:function(){this._batch||this.surface.makeDirty()},add:function(z){this._makeDirty();return da.add.apply(this,arguments)},remove:function(z,v){this._makeDirty();
return da.remove.apply(this,arguments)},clear:function(){this._makeDirty();return da.clear.apply(this,arguments)},getBoundingBox:da.getBoundingBox,_moveChildToFront:function(z){this._makeDirty();return da._moveChildToFront.apply(this,arguments)},_moveChildToBack:function(z){this._makeDirty();return da._moveChildToBack.apply(this,arguments)}};q={createObject:function(z,v){z=new z;z.surface=this.surface;z.setShape(v);this.add(z);return z}};t(c.Group,G);t(c.Group,D.Creator);t(c.Group,q);t(c.Surface,
G);t(c.Surface,D.Creator);t(c.Surface,q);c.fixTarget=function(z,v){return!0};return c})},"dojox/gfx/shape":function(){define("./_base dojo/_base/lang dojo/_base/declare dojo/_base/kernel dojo/_base/sniff dojo/on dojo/_base/array dojo/dom-construct dojo/_base/Color ./matrix".split(" "),function(C,O,l,G,K,E,B,D,q,k){function w(h,a){for(var f=h.length-1;a<f;)h[a]=h[++a];h.length=f}var t=C.shape={};t.Shape=l("dojox.gfx.shape.Shape",null,{constructor:function(){this.parentMatrix=this.parent=this.bbox=
this.strokeStyle=this.fillStyle=this.matrix=this.shape=this.rawNode=null;if(K("gfxRegistry")){var h=t.register(this);this.getUID=function(){return h}}},destroy:function(){K("gfxRegistry")&&t.dispose(this);this.rawNode&&"__gfxObject__"in this.rawNode&&(this.rawNode.__gfxObject__=null);this.rawNode=null},getNode:function(){return this.rawNode},getShape:function(){return this.shape},getTransform:function(){return this.matrix},getFill:function(){return this.fillStyle},getStroke:function(){return this.strokeStyle},
getParent:function(){return this.parent},getBoundingBox:function(){return this.bbox},getTransformedBoundingBox:function(){var h=this.getBoundingBox();if(!h)return null;var a=this._getRealMatrix();return[k.multiplyPoint(a,h.x,h.y),k.multiplyPoint(a,h.x+h.width,h.y),k.multiplyPoint(a,h.x+h.width,h.y+h.height),k.multiplyPoint(a,h.x,h.y+h.height)]},getEventSource:function(){return this.rawNode},setClip:function(h){this.clip=h},getClip:function(){return this.clip},setShape:function(h){this.shape=C.makeParameters(this.shape,
h);this.bbox=null;return this},setFill:function(h){if(!h)return this.fillStyle=null,this;var a=null;if("object"==typeof h&&"type"in h)switch(h.type){case "linear":a=C.makeParameters(C.defaultLinearGradient,h);break;case "radial":a=C.makeParameters(C.defaultRadialGradient,h);break;case "pattern":a=C.makeParameters(C.defaultPattern,h)}else a=C.normalizeColor(h);this.fillStyle=a;return this},setStroke:function(h){if(!h)return this.strokeStyle=null,this;if("string"==typeof h||O.isArray(h)||h instanceof
q)h={color:h};h=this.strokeStyle=C.makeParameters(C.defaultStroke,h);h.color=C.normalizeColor(h.color);return this},setTransform:function(h){this.matrix=k.clone(h?k.normalize(h):k.identity);return this._applyTransform()},_applyTransform:function(){return this},moveToFront:function(){var h=this.getParent();h&&(h._moveChildToFront(this),this._moveToFront());return this},moveToBack:function(){var h=this.getParent();h&&(h._moveChildToBack(this),this._moveToBack());return this},_moveToFront:function(){},
_moveToBack:function(){},applyRightTransform:function(h){return h?this.setTransform([this.matrix,h]):this},applyLeftTransform:function(h){return h?this.setTransform([h,this.matrix]):this},applyTransform:function(h){return h?this.setTransform([this.matrix,h]):this},removeShape:function(h){this.parent&&this.parent.remove(this,h);return this},_setParent:function(h,a){this.parent=h;return this._updateParentMatrix(a)},_updateParentMatrix:function(h){this.parentMatrix=h?k.clone(h):null;return this._applyTransform()},
_getRealMatrix:function(){for(var h=this.matrix,a=this.parent;a;)a.matrix&&(h=k.multiply(a.matrix,h)),a=a.parent;return h}});t._eventsProcessing={on:function(h,a){return E(this.getEventSource(),h,t.fixCallback(this,C.fixTarget,a))},connect:function(h,a,f){"on"==h.substring(0,2)&&(h=h.substring(2));return this.on(h,f?O.hitch(a,f):a)},disconnect:function(h){return h.remove()}};t.fixCallback=function(h,a,f,d){d||(d=f,f=null);if(O.isString(d)){f=f||G.global;if(!f[d])throw['dojox.gfx.shape.fixCallback: scope["',
d,'"] is null (scope\x3d"',f,'")'].join("");return function(g){return a(g,h)?f[d].apply(f,arguments||[]):void 0}}return f?function(g){return a(g,h)?d.apply(f,arguments||[]):void 0}:function(g){return a(g,h)?d.apply(f,arguments):void 0}};O.extend(t.Shape,t._eventsProcessing);t.Container={_init:function(){this.children=[];this._batch=0},openBatch:function(){return this},closeBatch:function(){return this},add:function(h){var a=h.getParent();a&&a.remove(h,!0);this.children.push(h);return h._setParent(this,
this._getRealMatrix())},remove:function(h,a){for(var f=0;f<this.children.length;++f)if(this.children[f]==h){a||(h.parent=null,h.parentMatrix=null);w(this.children,f);break}return this},clear:function(h){for(var a,f=0;f<this.children.length;++f)a=this.children[f],a.parent=null,a.parentMatrix=null,h&&a.destroy();this.children=[];return this},getBoundingBox:function(){if(this.children){var h=null;B.forEach(this.children,function(a){var f=a.getBoundingBox();f&&((a=a.getTransform())&&(f=k.multiplyRectangle(a,
f)),h?(h.x=Math.min(h.x,f.x),h.y=Math.min(h.y,f.y),h.endX=Math.max(h.endX,f.x+f.width),h.endY=Math.max(h.endY,f.y+f.height)):h={x:f.x,y:f.y,endX:f.x+f.width,endY:f.y+f.height})});h&&(h.width=h.endX-h.x,h.height=h.endY-h.y);return h}return null},_moveChildToFront:function(h){for(var a=0;a<this.children.length;++a)if(this.children[a]==h){w(this.children,a);this.children.push(h);break}return this},_moveChildToBack:function(h){for(var a=0;a<this.children.length;++a)if(this.children[a]==h){w(this.children,
a);this.children.unshift(h);break}return this}};t.Surface=l("dojox.gfx.shape.Surface",null,{constructor:function(){this._parent=this.rawNode=null;this._nodes=[];this._events=[]},destroy:function(){B.forEach(this._nodes,D.destroy);this._nodes=[];B.forEach(this._events,function(h){h&&h.remove()});this._events=[];this.rawNode=null;if(K("ie"))for(;this._parent.lastChild;)D.destroy(this._parent.lastChild);else this._parent.innerHTML="";this._parent=null},getEventSource:function(){return this.rawNode},
_getRealMatrix:function(){return null},isLoaded:!0,onLoad:function(h){},whenLoaded:function(h,a){var f=O.hitch(h,a);if(this.isLoaded)f(this);else E.once(this,"load",function(d){f(d)})}});O.extend(t.Surface,t._eventsProcessing);t.Rect=l("dojox.gfx.shape.Rect",t.Shape,{constructor:function(h){this.shape=C.getDefault("Rect");this.rawNode=h},getBoundingBox:function(){return this.shape}});t.Ellipse=l("dojox.gfx.shape.Ellipse",t.Shape,{constructor:function(h){this.shape=C.getDefault("Ellipse");this.rawNode=
h},getBoundingBox:function(){if(!this.bbox){var h=this.shape;this.bbox={x:h.cx-h.rx,y:h.cy-h.ry,width:2*h.rx,height:2*h.ry}}return this.bbox}});t.Circle=l("dojox.gfx.shape.Circle",t.Shape,{constructor:function(h){this.shape=C.getDefault("Circle");this.rawNode=h},getBoundingBox:function(){if(!this.bbox){var h=this.shape;this.bbox={x:h.cx-h.r,y:h.cy-h.r,width:2*h.r,height:2*h.r}}return this.bbox}});t.Line=l("dojox.gfx.shape.Line",t.Shape,{constructor:function(h){this.shape=C.getDefault("Line");this.rawNode=
h},getBoundingBox:function(){if(!this.bbox){var h=this.shape;this.bbox={x:Math.min(h.x1,h.x2),y:Math.min(h.y1,h.y2),width:Math.abs(h.x2-h.x1),height:Math.abs(h.y2-h.y1)}}return this.bbox}});t.Polyline=l("dojox.gfx.shape.Polyline",t.Shape,{constructor:function(h){this.shape=C.getDefault("Polyline");this.rawNode=h},setShape:function(h,a){h&&h instanceof Array?(this.inherited(arguments,[{points:h}]),a&&this.shape.points.length&&this.shape.points.push(this.shape.points[0])):this.inherited(arguments,[h]);
return this},_normalizePoints:function(){var h=this.shape.points,a=h&&h.length;if(a&&"number"==typeof h[0]){for(var f=[],d=0;d<a;d+=2)f.push({x:h[d],y:h[d+1]});this.shape.points=f}},getBoundingBox:function(){if(!this.bbox&&this.shape.points.length){for(var h=this.shape.points,a=h.length,f=h[0],d=f.x,g=f.y,c=f.x,m=f.y,F=1;F<a;++F)f=h[F],d>f.x&&(d=f.x),c<f.x&&(c=f.x),g>f.y&&(g=f.y),m<f.y&&(m=f.y);this.bbox={x:d,y:g,width:c-d,height:m-g}}return this.bbox}});t.Image=l("dojox.gfx.shape.Image",t.Shape,
{constructor:function(h){this.shape=C.getDefault("Image");this.rawNode=h},getBoundingBox:function(){return this.shape},setStroke:function(){return this},setFill:function(){return this}});t.Text=l(t.Shape,{constructor:function(h){this.fontStyle=null;this.shape=C.getDefault("Text");this.rawNode=h},getFont:function(){return this.fontStyle},setFont:function(h){this.fontStyle="string"==typeof h?C.splitFontString(h):C.makeParameters(C.defaultFont,h);this._setFont();return this},getBoundingBox:function(){var h=
null;this.getShape().text&&(h=C._base._computeTextBoundingBox(this));return h}});t.Creator={createShape:function(h){switch(h.type){case C.defaultPath.type:return this.createPath(h);case C.defaultRect.type:return this.createRect(h);case C.defaultCircle.type:return this.createCircle(h);case C.defaultEllipse.type:return this.createEllipse(h);case C.defaultLine.type:return this.createLine(h);case C.defaultPolyline.type:return this.createPolyline(h);case C.defaultImage.type:return this.createImage(h);
case C.defaultText.type:return this.createText(h);case C.defaultTextPath.type:return this.createTextPath(h)}return null},createGroup:function(){return this.createObject(C.Group)},createRect:function(h){return this.createObject(C.Rect,h)},createEllipse:function(h){return this.createObject(C.Ellipse,h)},createCircle:function(h){return this.createObject(C.Circle,h)},createLine:function(h){return this.createObject(C.Line,h)},createPolyline:function(h){return this.createObject(C.Polyline,h)},createImage:function(h){return this.createObject(C.Image,
h)},createText:function(h){return this.createObject(C.Text,h)},createPath:function(h){return this.createObject(C.Path,h)},createTextPath:function(h){return this.createObject(C.TextPath,{}).setText(h)},createObject:function(h,a){return null}};return t})},"dojox/gfx/path":function(){define(["./_base","dojo/_base/lang","dojo/_base/declare","./matrix","./shape"],function(C,O,l,G,K){K=l("dojox.gfx.path.Path",K.Shape,{constructor:function(E){this.shape=O.clone(C.defaultPath);this.segments=[];this.tbbox=
null;this.absolute=!0;this.last={};this.rawNode=E;this.segmented=!1},setAbsoluteMode:function(E){this._confirmSegmented();this.absolute="string"==typeof E?"absolute"==E:E;return this},getAbsoluteMode:function(){this._confirmSegmented();return this.absolute},getBoundingBox:function(){this._confirmSegmented();return this.bbox&&"l"in this.bbox?{x:this.bbox.l,y:this.bbox.t,width:this.bbox.r-this.bbox.l,height:this.bbox.b-this.bbox.t}:null},_getRealBBox:function(){this._confirmSegmented();if(this.tbbox)return this.tbbox;
var E=this.bbox,B=this._getRealMatrix();this.bbox=null;for(var D=0,q=this.segments.length;D<q;++D)this._updateWithSegment(this.segments[D],B);B=this.bbox;this.bbox=E;return this.tbbox=B?[{x:B.l,y:B.t},{x:B.r,y:B.t},{x:B.r,y:B.b},{x:B.l,y:B.b}]:null},getLastPosition:function(){this._confirmSegmented();return"x"in this.last?this.last:null},_applyTransform:function(){this.tbbox=null;return this.inherited(arguments)},_updateBBox:function(E,B,D){D&&(B=G.multiplyPoint(D,E,B),E=B.x,B=B.y);this.bbox&&"l"in
this.bbox?(this.bbox.l>E&&(this.bbox.l=E),this.bbox.r<E&&(this.bbox.r=E),this.bbox.t>B&&(this.bbox.t=B),this.bbox.b<B&&(this.bbox.b=B)):this.bbox={l:E,b:B,r:E,t:B}},_updateWithSegment:function(E,B){var D=E.args,q=D.length,k;switch(E.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(k=0;k<q;k+=2)this._updateBBox(D[k],D[k+1],B);this.last.x=D[q-2];this.last.y=D[q-1];this.absolute=!0;break;case "H":for(k=0;k<q;++k)this._updateBBox(D[k],this.last.y,B);this.last.x=D[q-1];this.absolute=!0;
break;case "V":for(k=0;k<q;++k)this._updateBBox(this.last.x,D[k],B);this.last.y=D[q-1];this.absolute=!0;break;case "m":k=0;"x"in this.last||(this._updateBBox(this.last.x=D[0],this.last.y=D[1],B),k=2);for(;k<q;k+=2)this._updateBBox(this.last.x+=D[k],this.last.y+=D[k+1],B);this.absolute=!1;break;case "l":case "t":for(k=0;k<q;k+=2)this._updateBBox(this.last.x+=D[k],this.last.y+=D[k+1],B);this.absolute=!1;break;case "h":for(k=0;k<q;++k)this._updateBBox(this.last.x+=D[k],this.last.y,B);this.absolute=!1;
break;case "v":for(k=0;k<q;++k)this._updateBBox(this.last.x,this.last.y+=D[k],B);this.absolute=!1;break;case "c":for(k=0;k<q;k+=6)this._updateBBox(this.last.x+D[k],this.last.y+D[k+1],B),this._updateBBox(this.last.x+D[k+2],this.last.y+D[k+3],B),this._updateBBox(this.last.x+=D[k+4],this.last.y+=D[k+5],B);this.absolute=!1;break;case "s":case "q":for(k=0;k<q;k+=4)this._updateBBox(this.last.x+D[k],this.last.y+D[k+1],B),this._updateBBox(this.last.x+=D[k+2],this.last.y+=D[k+3],B);this.absolute=!1;break;
case "A":for(k=0;k<q;k+=7)this._updateBBox(D[k+5],D[k+6],B);this.last.x=D[q-2];this.last.y=D[q-1];this.absolute=!0;break;case "a":for(k=0;k<q;k+=7)this._updateBBox(this.last.x+=D[k+5],this.last.y+=D[k+6],B);this.absolute=!1}E=[E.action];for(k=0;k<q;++k)E.push(C.formatNumber(D[k],!0));if("string"==typeof this.shape.path)this.shape.path+=E.join("");else for(k=0,q=E.length;k<q;++k)this.shape.path.push(E[k])},_validSegments:{m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},_pushSegment:function(E,B){this.tbbox=
null;var D=this._validSegments[E.toLowerCase()];"number"==typeof D&&(D?B.length>=D&&(E={action:E,args:B.slice(0,B.length-B.length%D)},this.segments.push(E),this._updateWithSegment(E)):(E={action:E,args:[]},this.segments.push(E),this._updateWithSegment(E)))},_collectArgs:function(E,B){for(var D=0;D<B.length;++D){var q=B[D];"boolean"==typeof q?E.push(q?1:0):"number"==typeof q?E.push(q):q instanceof Array?this._collectArgs(E,q):"x"in q&&"y"in q&&E.push(q.x,q.y)}},moveTo:function(){this._confirmSegmented();
var E=[];this._collectArgs(E,arguments);this._pushSegment(this.absolute?"M":"m",E);return this},lineTo:function(){this._confirmSegmented();var E=[];this._collectArgs(E,arguments);this._pushSegment(this.absolute?"L":"l",E);return this},hLineTo:function(){this._confirmSegmented();var E=[];this._collectArgs(E,arguments);this._pushSegment(this.absolute?"H":"h",E);return this},vLineTo:function(){this._confirmSegmented();var E=[];this._collectArgs(E,arguments);this._pushSegment(this.absolute?"V":"v",E);
return this},curveTo:function(){this._confirmSegmented();var E=[];this._collectArgs(E,arguments);this._pushSegment(this.absolute?"C":"c",E);return this},smoothCurveTo:function(){this._confirmSegmented();var E=[];this._collectArgs(E,arguments);this._pushSegment(this.absolute?"S":"s",E);return this},qCurveTo:function(){this._confirmSegmented();var E=[];this._collectArgs(E,arguments);this._pushSegment(this.absolute?"Q":"q",E);return this},qSmoothCurveTo:function(){this._confirmSegmented();var E=[];this._collectArgs(E,
arguments);this._pushSegment(this.absolute?"T":"t",E);return this},arcTo:function(){this._confirmSegmented();var E=[];this._collectArgs(E,arguments);this._pushSegment(this.absolute?"A":"a",E);return this},closePath:function(){this._confirmSegmented();this._pushSegment("Z",[]);return this},_confirmSegmented:function(){if(!this.segmented){var E=this.shape.path;this.shape.path=[];this._setPath(E);this.shape.path=this.shape.path.join("");this.segmented=!0}},_setPath:function(E){E=O.isArray(E)?E:E.match(C.pathSvgRegExp);
this.segments=[];this.absolute=!0;this.bbox={};this.last={};if(E){for(var B="",D=[],q=E.length,k=0;k<q;++k){var w=E[k],t=parseFloat(w);isNaN(t)?(B&&this._pushSegment(B,D),D=[],B=w):D.push(t)}this._pushSegment(B,D)}},setShape:function(E){this.inherited(arguments,["string"==typeof E?{path:E}:E]);this.segmented=!1;this.segments=[];C.lazyPathSegmentation||this._confirmSegmented();return this},_2PI:2*Math.PI});l=l("dojox.gfx.path.TextPath",K,{constructor:function(E){"text"in this||(this.text=O.clone(C.defaultTextPath));
"fontStyle"in this||(this.fontStyle=O.clone(C.defaultFont))},getText:function(){return this.text},setText:function(E){this.text=C.makeParameters(this.text,"string"==typeof E?{text:E}:E);this._setText();return this},getFont:function(){return this.fontStyle},setFont:function(E){this.fontStyle="string"==typeof E?C.splitFontString(E):C.makeParameters(C.defaultFont,E);this._setFont();return this}});return C.path={Path:K,TextPath:l}})},"dojox/gfx/arc":function(){define(["./_base","dojo/_base/lang","./matrix"],
function(C,O,l){function G(k){var w=Math.cos(k);k=Math.sin(k);var t={x:w+4/3*(1-w),y:k-4/3*w*(1-w)/k};return{s:{x:w,y:-k},c1:{x:t.x,y:-t.y},c2:t,e:{x:w,y:k}}}var K=2*Math.PI,E=Math.PI/4,B=Math.PI/8,D=E+B,q=G(B);return C.arc={unitArcAsBezier:G,curvePI4:q,arcAsBezier:function(k,w,t,h,a,f,d,g){a=!!a;f=!!f;var c=l._degToRad(h);h=w*w;var m=t*t,F=l.multiplyPoint(l.rotate(-c),{x:(k.x-d)/2,y:(k.y-g)/2}),I=F.x*F.x,M=F.y*F.y;h=Math.sqrt((h*m-h*M-m*I)/(h*M+m*I));isNaN(h)&&(h=0);h={x:h*w*F.y/t,y:-h*t*F.x/w};
a==f&&(h={x:-h.x,y:-h.y});h=l.multiplyPoint([l.translate((k.x+d)/2,(k.y+g)/2),l.rotate(c)],h);w=l.normalize([l.translate(h.x,h.y),l.rotate(c),l.scale(w,t)]);h=l.invert(w);k=l.multiplyPoint(h,k);g=l.multiplyPoint(h,d,g);d=Math.atan2(k.y,k.x);h=d-Math.atan2(g.y,g.x);f&&(h=-h);0>h?h+=K:h>K&&(h-=K);t=B;g=q;t=f?t:-t;k=[];for(a=h;0<a;a-=E)a<D&&(t=a/2,g=G(t),t=f?t:-t,a=0),F=l.normalize([w,l.rotate(d+t)]),f?(h=l.multiplyPoint(F,g.c1),c=l.multiplyPoint(F,g.c2),F=l.multiplyPoint(F,g.e)):(h=l.multiplyPoint(F,
g.c2),c=l.multiplyPoint(F,g.c1),F=l.multiplyPoint(F,g.s)),k.push([h.x,h.y,c.x,c.y,F.x,F.y]),d+=2*t;return k}}})},"dojox/gfx/decompose":function(){define(["./_base","dojo/_base/lang","./matrix"],function(C,O,l){function G(q,k){return Math.abs(q-k)<=1E-6*(Math.abs(q)+Math.abs(k))}function K(q,k,w,t){if(!isFinite(q))return w;if(!isFinite(w))return q;k=Math.abs(k);t=Math.abs(t);return(k*q+t*w)/(k+t)}function E(q){q=l.normalize(q);var k=-q.xx-q.yy,w=q.xx*q.yy-q.xy*q.yx,t=Math.sqrt(k*k-4*w);k=-(k+(0>k?
-t:t))/2;w/=k;t=q.xy/(k-q.xx);var h=1,a=q.xy/(w-q.xx),f=1;G(k,w)&&(t=1,a=h=0,f=1);isFinite(t)||(t=1,h=(k-q.xx)/q.xy,isFinite(h)||(t=(k-q.yy)/q.yx,h=1,isFinite(t)||(t=1,h=q.yx/(k-q.yy))));isFinite(a)||(a=1,f=(w-q.xx)/q.xy,isFinite(f)||(a=(w-q.yy)/q.yx,f=1,isFinite(a)||(a=1,f=q.yx/(w-q.yy))));q=Math.sqrt(t*t+h*h);var d=Math.sqrt(a*a+f*f);isFinite(t/=q)||(t=0);isFinite(h/=q)||(h=0);isFinite(a/=d)||(a=0);isFinite(f/=d)||(f=0);return{value1:k,value2:w,vector1:{x:t,y:h},vector2:{x:a,y:f}}}function B(q,
k){var w=0>q.xx*q.yy||0<q.xy*q.yx?-1:1,t=k.angle1=(Math.atan2(q.yx,q.yy)+Math.atan2(-w*q.xy,w*q.xx))/2;w=Math.cos(t);t=Math.sin(t);k.sx=K(q.xx/w,w,-q.xy/t,t);k.sy=K(q.yy/w,w,q.yx/t,t);return k}function D(q,k){var w=0>q.xx*q.yy||0<q.xy*q.yx?-1:1,t=k.angle2=(Math.atan2(w*q.yx,w*q.xx)+Math.atan2(-q.xy,q.yy))/2;w=Math.cos(t);t=Math.sin(t);k.sx=K(q.xx/w,w,q.yx/t,t);k.sy=K(q.yy/w,w,-q.xy/t,t);return k}return C.decompose=function(q){var k=l.normalize(q);q={dx:k.dx,dy:k.dy,sx:1,sy:1,angle1:0,angle2:0};if(G(k.xy,
0)&&G(k.yx,0))return O.mixin(q,{sx:k.xx,sy:k.yy});if(G(k.xx*k.yx,-k.xy*k.yy))return B(k,q);if(G(k.xx*k.xy,-k.yx*k.yy))return D(k,q);var w=new l.Matrix2D(k);var t=O.mixin(w,{dx:0,dy:0,xy:w.yx,yx:w.xy});w=E([k,t]);t=E([t,k]);w=new l.Matrix2D({xx:w.vector1.x,xy:w.vector2.x,yx:w.vector1.y,yy:w.vector2.y});t=new l.Matrix2D({xx:t.vector1.x,xy:t.vector1.y,yx:t.vector2.x,yy:t.vector2.y});k=new l.Matrix2D([l.invert(w),k,l.invert(t)]);B(t,q);k.xx*=q.sx;k.yy*=q.sy;D(w,q);k.xx*=q.sx;k.yy*=q.sy;return O.mixin(q,
{sx:k.xx,sy:k.yy})}})},"dojox/gfx/bezierutils":function(){define(["./_base"],function(C){C=C.bezierutils={};C.tAtLength=function(B,D){var q=0,k=6==B.length,w=0,t=0,h=k?G:E,a=function(f,d){for(var g=0,c=0;c<f.length-2;c+=2)g+=l(f[c],f[c+1],f[c+2],f[c+3]);c=k?l(B[0],B[1],B[4],B[5]):l(B[0],B[1],B[6],B[7]);g-c>d||w+g>D+d?(++t,f=h(f,.5),a(f[0],d),Math.abs(w-D)<=d||a(f[1],d)):(w+=g,q+=1/(1<<t))};D&&a(B,.5);return q};var O=C.computeLength=function(B){for(var D=6==B.length,q=0,k=0;k<B.length-2;k+=2)q+=l(B[k],
B[k+1],B[k+2],B[k+3]);k=D?l(B[0],B[1],B[4],B[5]):l(B[0],B[1],B[6],B[7]);return.1<q-k?(B=D?G(B,.5):K(B,.5),q=O(B[0],D),q+=O(B[1],D)):q},l=C.distance=function(B,D,q,k){return Math.sqrt((q-B)*(q-B)+(k-D)*(k-D))},G=function(B,D){var q=1-D,k=q*q,w=D*D,t=B[0],h=B[1],a=B[2],f=B[3],d=B[4];B=B[5];var g=k*t+2*q*D*a+w*d;k=k*h+2*q*D*f+w*B;return[[t,h,q*t+D*a,q*h+D*f,g,k],[g,k,q*a+D*d,q*f+D*B,d,B]]},K=function(B,D){var q=1-D,k=q*q,w=k*q,t=D*D,h=t*D,a=B[0],f=B[1],d=B[2],g=B[3],c=B[4],m=B[5],F=B[6];B=B[7];var I=
w*a+3*k*D*d+3*q*t*c+h*F;w=w*f+3*k*D*g+3*q*t*m+h*B;return[[a,f,q*a+D*d,q*f+D*g,k*a+2*q*D*d+t*c,k*f+2*q*D*g+t*m,I,w],[I,w,k*d+2*q*D*c+t*F,k*g+2*q*D*m+t*B,q*c+D*F,q*m+D*B,F,B]]},E=C.splitBezierAtT=function(B,D){return 6==B.length?G(B,D):K(B,D)};return C})},"dojox/json/query":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojox","dojo/_base/array"],function(C,O,l){O.getObject("json",!0,l);l.json._slice=function(G,K,E,B){var D=G.length,q=[];E=E||D;K=0>K?Math.max(0,K+D):Math.min(D,K);for(E=0>
E?Math.max(0,E+D):Math.min(D,E);K<E;K+=B)q.push(G[K]);return q};l.json._find=function(G,K){function E(q){K&&(!0!==K||q instanceof Array?q[K]&&B.push(q[K]):B.push(q));for(var k in q){var w=q[k];K?w&&"object"==typeof w&&E(w):B.push(w)}}var B=[];if(K instanceof Array){if(1==K.length)return G[K[0]];for(var D=0;D<K.length;D++)B.push(G[K[D]])}else E(G);return B};l.json._distinctFilter=function(G,K){for(var E=[],B={},D=0,q=G.length;D<q;++D){var k=G[D];K(k,D,G)&&("object"==typeof k&&k?k.__included||(k.__included=
!0,E.push(k)):B[k+typeof k]||(B[k+typeof k]=!0,E.push(k)))}D=0;for(q=E.length;D<q;++D)E[D]&&delete E[D].__included;return E};return l.json.query=function(G,K){function E(t,h,a,f,d,g,c,m){return D[m].match(/[\*\?]/)||"~"==c?"/^"+D[m].substring(1,D[m].length-1).replace(/\\([btnfr\\"'])|([^\w\*\?])/g,"\\$1$2").replace(/([\*\?])/g,"[\\w\\W]$1")+("~"==c?"$/i":"$/")+".test("+h+")":t}var B=0,D=[];G=G.replace(/"(\\.|[^"\\])*"|'(\\.|[^'\\])*'|[\[\]]/g,function(t){B+="["==t?1:"]"==t?-1:0;return"]"==t&&0<B?
"`]":'"'==t.charAt(0)||"'"==t.charAt(0)?"`"+(D.push(t)-1):t});var q="";G.replace(/(\]|\)|push|pop|shift|splice|sort|reverse)\s*\(/,function(){throw Error("Unsafe function call");});G=G.replace(/([^<>=]=)([^=])/g,"$1\x3d$2").replace(/@|(\.\s*)?[a-zA-Z\$_]+(\s*:)?/g,function(t){return"."==t.charAt(0)?t:"@"==t?"$obj":(t.match(/:|^(\$|Math|true|false|null)$/)?"":"$obj.")+t}).replace(/\.?\.?\[(`\]|[^\]])*\]|\?.*|\.\.([\w\$_]+)|\.\*/g,function(t,h,a){return(h=t.match(/^\.?\.?(\[\s*\^?\?|\^?\?|\[\s*==)(.*?)\]?$/))?
(a="",t.match(/^\./)&&(q="dojox.json._find("+q,a=",true)"),q=(h[1].match(/=/)?"dojo.map":h[1].match(/\^/)?"dojox.json._distinctFilter":"dojo.filter")+"("+q,a+",function($obj){return "+h[2]+"})"):(h=t.match(/^\[\s*([\/\\].*)\]/))?".concat().sort(function(a,b){"+h[1].replace(/\s*,?\s*([\/\\])\s*([^,\\\/]+)/g,function(f,d,g){return"var av\x3d "+g.replace(/\$obj/,"a")+",bv\x3d "+g.replace(/\$obj/,"b")+";if(av\x3ebv||bv\x3d\x3dnull){return "+("/"==d?1:-1)+";}\nif(bv\x3eav||av\x3d\x3dnull){return "+("/"==
d?-1:1)+";}\n"})+"return 0;})":(h=t.match(/^\[(-?[0-9]*):(-?[0-9]*):?(-?[0-9]*)\]/))?(q="dojox.json._slice("+q,","+(h[1]||0)+","+(h[2]||0)+","+(h[3]||1)+")"):t.match(/^\.\.|\.\*|\[\s*\*\s*\]|,/)?(q="dojox.json._find("+q,("."==t.charAt(1)?",'"+a+"'":t.match(/,/)?","+t:"")+")"):t}).replace(/(\$obj\s*((\.\s*[\w_$]+\s*)|(\[\s*`([0-9]+)\s*`\]))*)(==|~)\s*`([0-9]+)/g,E).replace(/`([0-9]+)\s*(==|~)\s*(\$obj\s*((\.\s*[\w_$]+)|(\[\s*`([0-9]+)\s*`\]))*)/g,function(t,h,a,f,d,g,c,m){return E(t,f,d,g,c,m,a,h)});
G=q+("$"==G.charAt(0)?"":"$")+G.replace(/`([0-9]+|\])/g,function(t,h){return"]"==h?"]":D[h]});for(var k=eval("1\x26\x26function($,$1,$2,$3,$4,$5,$6,$7,$8,$9){var $obj\x3d$;return "+G+"}"),w=0;w<arguments.length-1;w++)arguments[w]=arguments[w+1];return K?k.apply(this,arguments):k}})},"dojox/main":function(){define(["dojo/_base/kernel"],function(C){return C.dojox})},"esri/tasks/PrintParameters":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(C,O,l,G){C=C(null,
{declaredClass:"esri.tasks.PrintParameters",map:null,template:null,outSpatialReference:null,extraParameters:null});l("extend-esri")&&O.setObject("tasks.PrintParameters",C,G);return C})},"esri/toolbars/edit":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/Color dojo/has dojo/dom-construct dojo/dom-style ../kernel ../lang ../sniff ./_toolbar ./_Box ./_GraphicMover ./_VertexEditor ./TextEditor ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/TextSymbol ../graphic".split(" "),
function(C,O,l,G,K,E,B,D,q,k,w,t,h,a,f,d,g,c,m,F,I){var M=O(h,{declaredClass:"esri.toolbars.Edit",constructor:function(T,V){this._map=T;this._tool=0;if(this._map.loaded)this._scratchGL=T.graphics;else var J=G.connect(this._map,"onLoad",this,function(){G.disconnect(J);J=null;this._scratchGL=this._map.graphics});T=B("esri-mobile");this._defaultOptions=l.mixin({vertexSymbol:new c(c.STYLE_CIRCLE,T?20:12,new m(m.STYLE_SOLID,new E([0,0,0,.5]),1),new E([128,128,128])),ghostVertexSymbol:new c(c.STYLE_CIRCLE,
T?18:10,new m(m.STYLE_SOLID,new E([0,0,0,.5]),1),new E([255,255,255,.75])),ghostLineSymbol:new m(m.STYLE_DOT,new E([128,128,128]),2),allowDeleteVertices:!0,allowAddVertices:!0,rotateHandleOffset:T?24:16,boxLineSymbol:new m(m.STYLE_DASH,new E([64,64,64]),1),boxHandleSymbol:new c(c.STYLE_SQUARE,T?16:9,new m(m.STYLE_SOLID,new E([0,0,0,.5]),1),new E([255,255,255,.75])),textAnchorSymbol:new c(c.STYLE_CIRCLE,10,null,new E([255,0,0]))},V||{})},activate:function(T,V,J){this.deactivate();this._graphic=V;this._options=
l.mixin(l.mixin({},this._defaultOptions),J||{});var L=M.MOVE;J=M.EDIT_VERTICES;var aa=M.SCALE,P=M.ROTATE,H=M.EDIT_TEXT,R=!1,y=!1,Y=!1,da=this._map,z=da.spatialReference,v=V.geometry.spatialReference;this._geo=!(!z||!v||z.equals(v)||!z.isWebMercator()||4326!==v.wkid);this._isTextPoint=this._prepareTextSymbolEditing(V,T);(T&L)===L&&(R=this._enableMove(V));L=(T&aa)===aa;P=(T&P)===P;if(L||P)Y=this._enableBoxEditing(V,L,P);(T&J)===J&&(y=this._enableVertexEditing(V));(T&H)===H&&this._enableTextEditing(V);
if(!(R||y||Y))throw Error("[esri.toolbars.Edit::activate] Unable to activate the tool. Check if the tool is valid for the given geometry type.");if(this._tool=T)this._mapPanEndHandle=G.connect(da,"onPanEnd",this,this._mapPanEndHandler),this._mapExtChgHandle=G.connect(da,"onExtentChange",this,this._mapExtentChangeHandler),this.onActivate(this._tool,V);da.snappingManager&&(R||y)&&da.snappingManager._startSelectionLayerQuery()},deactivate:function(){this._isTextPoint=null;var T=this._tool,V=this._graphic;
if(T){var J=!!this._modified;this._clear();G.disconnect(this._mapPanEndHandle);G.disconnect(this._mapExtChgHandle);this._graphic=this._geo=this._mapPanEndHandle=this._mapExtChgHandle=null;this.onDeactivate(T,V,{isModified:J});this._map.snappingManager&&this._map.snappingManager._stopSelectionLayerQuery()}},refresh:function(){this._refreshMoveables(!0)},getCurrentState:function(){return{tool:this._tool,graphic:this._graphic,isModified:!!this._modified}},onActivate:function(T,V){},onDeactivate:function(T,
V,J){},onGraphicMoveStart:function(T){},onGraphicFirstMove:function(T){this._modified=!0},onGraphicMove:function(T,V){},onGraphicMoveStop:function(T,V){},onGraphicClick:function(T,V){},onVertexMoveStart:function(T,V){},onVertexFirstMove:function(T,V){this._modified=!0},onVertexMove:function(T,V,J){},onVertexMoveStop:function(T,V,J){},onVertexAdd:function(T,V){this._modified=!0},onVertexClick:function(T,V){},onVertexMouseOver:function(T,V){},onVertexMouseOut:function(T,V){},onVertexDelete:function(T,
V){this._modified=!0},onTextEditStart:function(T,V){},onTextEditEnd:function(T){},onScaleStart:function(T){},onScaleFirstMove:function(T){this._modified=!0},onScale:function(T,V){},onScaleStop:function(T,V){},onRotateStart:function(T){},onRotateFirstMove:function(T){this._modified=!0},onRotate:function(T,V){},onRotateStop:function(T,V){},_eventMap:{activate:["tool","graphic"],deactivate:["tool","graphic","info"],"graphic-move-start":["graphic"],"graphic-first-move":["graphic"],"graphic-move":["graphic",
"transform"],"graphic-move-stop":["graphic","transform"],"graphic-click":["graphic","info"],"vertex-move-start":["graphic","vertexinfo"],"vertex-first-move":["graphic","vertexinfo"],"vertex-move":["graphic","vertexinfo","transform"],"vertex-move-stop":["graphic","vertexinfo","transform"],"vertex-add":["graphic","vertexinfo"],"vertex-click":["graphic","vertexinfo"],"vertex-mouse-over":["graphic","vertexinfo"],"vertex-mouse-out":["graphic","vertexinfo"],"vertex-delete":["graphic","vertexinfo"],"scale-start":["graphic"],
"scale-first-move":["graphic"],scale:["graphic","info"],"scale-stop":["graphic","info"],"rotate-start":["graphic"],"rotate-first-move":["graphic"],rotate:["graphic","info"],"rotate-stop":["graphic","info"]},_prepareTextSymbolEditing:function(T,V){if("point"===T.geometry.type||"multipoint"===T.geometry.type){var J=T.getLayer(),L=J.renderer;J=T.symbol||J._getSymbol(T);!J&&(L.hasVisualVariables("sizeInfo",!1)||L.hasVisualVariables("colorInfo",!1)||L.hasVisualVariables("opacityInfo",!1))&&L.addBreak&&
L.infos&&1===L.infos.length&&(J=L.infos[0].symbol||L.defaultSymbol);if(J&&"textsymbol"===J.type){if((V&M.SCALE)===M.SCALE||(V&M.ROTATE)===M.ROTATE||(V&M.EDIT_TEXT)===M.EDIT_TEXT){T.setSymbol(new F(J.toJson()));var aa=this;this._textSymbolEditor?(this._textSymbolEditor.createForm(T),this._textSymbolEditor.show()):this._options&&this._options.textSymbolEditor?(this._textSymbolEditor=this._options.textSymbolEditor,this._textSymbolEditor.on("symbol-change",function(){aa._boxEditor&&aa._boxEditor.refresh()})):
C(["../dijit/SymbolEditor"],function(P){if(!aa._textSymbolEditor){var H=aa._options.textSymbolEditorHolder?D.create("div",null,aa._options.textSymbolEditorHolder):D.create("div",null,aa._map.root);aa._textSymbolEditor=new P({graphic:T},H);P=aa._textSymbolEditor.domNode.parentNode.id;q.set(aa._textSymbolEditor.domNode,{position:"map_root"===P?"absolute":"relative",left:"map_root"===P?aa._map.width/2-100+"px":"5px",top:"20px","z-index":50});aa._textSymbolEditor.startup();aa._textSymbolEditor.createForm(T);
aa._textSymbolEditor.show();aa._textSymbolEditor.on("symbol-change",function(){aa._boxEditor&&aa._boxEditor.refresh()})}})}if((V&M.MOVE)===M.MOVE||(V&M.ROTATE)===M.ROTATE||(V&M.SCALE)===M.SCALE)this._textAnchor=new I(T.geometry,this._options.textAnchorSymbol),this._scratchGL.add(this._textAnchor);return!0}}return!1},_enableMove:function(T){var V=this._map;switch(T.geometry.type){case "point":case "polyline":case "polygon":return this._graphicMover=new f(T,V,this,this._textAnchor),!0}return!1},_enableVertexEditing:function(T){var V=
this._map;switch(T.geometry.type){case "multipoint":case "polyline":case "polygon":return this._vertexEditor=d.create(T,V,this),!0}return!1},_enableBoxEditing:function(T,V,J){var L=this._map,aa=T.geometry.type;return"polyline"===aa||"polygon"===aa||this._isTextPoint?(this._boxEditor=new a(T,L,this,V,J,this._options.uniformScaling,this._isTextPoint),!0):!1},_enableTextEditing:function(T){return this._isTextPoint?(this._textEditor=new g(T,this._map,this),G.connect(this._textEditor,"onEditStart",l.hitch(this,
function(){this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._map.disableKeyboardNavigation();this._disableMove();this._disableBoxEditing()})),!0):!1},_disableMove:function(){var T=this._graphicMover;T&&(T.destroy(),this._graphicMover=null)},_disableVertexEditing:function(){var T=this._vertexEditor;T&&(T.destroy(),this._vertexEditor=null)},_disableBoxEditing:function(){var T=this._boxEditor;T&&(T.destroy(),this._boxEditor=null)},_disableTextEditing:function(){this._textEditor&&
(this._textEditor.destroy(),this._textEditor=null);this._map.enableKeyboardNavigation()},_disableSymbolEditing:function(){this._textSymbolEditor&&this._textSymbolEditor.hide()},_clear:function(){this._disableMove();this._disableVertexEditing();this._disableBoxEditing();this._disableTextEditing();this._disableSymbolEditing();this._textAnchor&&(this._textAnchor.getLayer().remove(this._textAnchor),this._textAnchor=null);this._tool=0;this._modified=!1},_mapPanEndHandler:function(){this._refreshMoveables()},
_mapExtentChangeHandler:function(T,V,J){J&&this._refreshMoveables()},_refreshMoveables:function(T){var V=K.filter([this._graphicMover,this._vertexEditor,this._boxEditor],w.isDefined);K.forEach(V,function(J){J.refresh(T)})},_beginOperation:function(T){K.forEach(this._getAffectedTools(T),function(V){V.suspend()})},_endOperation:function(T){K.forEach(this._getAffectedTools(T),function(V){V.resume()})},_getAffectedTools:function(T){var V=[];switch(T){case "MOVE":V=[this._vertexEditor,this._boxEditor];
break;case "VERTICES":V=[this._boxEditor];break;case "BOX":V=[this._vertexEditor]}return V=K.filter(V,w.isDefined)}});l.mixin(M,{MOVE:1,EDIT_VERTICES:2,SCALE:4,ROTATE:8,EDIT_TEXT:16});B("extend-esri")&&l.setObject("toolbars.Edit",M,k);return M})},"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],function(C,O,l,G,K){C=C([K],{declaredClass:"esri.toolbars._Toolbar",constructor:function(E){this.map=E},_cursors:{move:"pointer","move-v":"pointer",
"move-gv":"pointer",box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(E,B,D,q){var k=this.map;E&&(this._mapNavState={isDoubleClickZoom:k.isDoubleClickZoom,isClickRecenter:k.isClickRecenter,isPan:k.isPan,isRubberBandZoom:k.isRubberBandZoom,isKeyboardNavigation:k.isKeyboardNavigation,isScrollWheelZoom:k.isScrollWheelZoom},k.disableDoubleClickZoom(),k.disableClickRecenter(),
k.disablePan(),k.disableRubberBandZoom(),k.disableKeyboardNavigation());B&&k.hideZoomSlider();D&&k.hidePanArrows();q&&k.graphics.disableMouseEvents()},_activateMapTools:function(E,B,D,q){var k=this.map,w=this._mapNavState;E&&w&&(w.isDoubleClickZoom&&k.enableDoubleClickZoom(),w.isClickRecenter&&k.enableClickRecenter(),w.isPan&&k.enablePan(),w.isRubberBandZoom&&k.enableRubberBandZoom(),w.isKeyboardNavigation&&k.enableKeyboardNavigation(),w.isScrollWheelZoom&&k.enableScrollWheelZoom());B&&k.showZoomSlider();
D&&k.showPanArrows();q&&k.graphics.enableMouseEvents()},_deactivateScrollWheel:function(){var E=this.map;this._scrollWheelState={isScrollWheelZoom:E.isScrollWheelZoom,isScrollWheelPan:E.isScrollWheelPan};E.disableScrollWheelZoom();E.disableScrollWheelPan()},_activateScrollWheel:function(){var E=this.map,B=this._scrollWheelState;B&&(B.isScrollWheelZoom&&E.enableScrollWheelZoom(),B.isScrollWheelPan&&E.enableScrollWheelPan())}});l("extend-esri")&&O.setObject("toolbars._Toolbar",C,G);return C})},"esri/toolbars/_Box":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/has dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../lang ../geometry/Point ../geometry/Polyline ../symbols/SimpleMarkerSymbol ../geometry/webMercatorUtils ../geometry/jsonUtils ../graphic".split(" "),
function(C,O,l,G,K,E,B,D,q,k,w,t,h,a,f,d,g){C=C(null,{declaredClass:"esri.toolbars._Box",constructor:function(c,m,F,I,M,T,V){this._graphic=c;this._map=m;this._toolbar=F;this._scale=I;this._rotate=M;this._defaultEventArgs={};this._scaleEvent="Scale";this._rotateEvent="Rotate";this._uniformScaling=T;c=F._options;this._markerSymbol=c.boxHandleSymbol;this._lineSymbol=c.boxLineSymbol;this._moveStartHandler=O.hitch(this,this._moveStartHandler);this._firstMoveHandler=O.hitch(this,this._firstMoveHandler);
this._moveStopHandler=O.hitch(this,this._moveStopHandler);this._moveHandler=O.hitch(this,this._moveHandler);this._isTextPoint=V;this._init()},destroy:function(){this._cleanUp();this._graphic=this._map=this._toolbar=this._markerSymbol=this._lineSymbol=null},refresh:function(){this._draw()},suspend:function(){l.forEach(this._getAllGraphics(),function(c){c.hide()})},resume:function(){l.forEach(this._getAllGraphics(),function(c){c.show()});this._draw()},_init:function(){this._draw()},_cleanUp:function(){this._connects&&
l.forEach(this._connects,G.disconnect);var c=this._toolbar._scratchGL;this._anchors&&l.forEach(this._anchors,function(m){c.remove(m.graphic);(m=m.moveable)&&m.destroy()});this._box&&c.remove(this._box);this._box=this._anchors=this._connects=null},_draw:function(){if(this._graphic.getDojoShape()){var c=this._map,m=this._toolbar._scratchGL,F=this._getBoxCoords(),I=new h(c.spatialReference),M=O.clone(l.filter(F,function(T,V){return 8!==V&&0===V%2}));M[0]&&M.push([M[0][0],M[0][1]]);I.addPath(M);this._rotate&&
I.addPath([F[1],F[8]]);this._box?this._box.setGeometry(I):(this._box=new g(I,this._lineSymbol),m.add(this._box));this._anchors?l.forEach(this._anchors,function(T,V){this._scale||(V=8);var J=new t(F[V],c.spatialReference);T.graphic.setGeometry(J);J=T.moveable;var L=T.graphic.getDojoShape();L&&(J?L!==J.shape&&(J.destroy(),T.moveable=this._getMoveable(T.graphic,V)):T.moveable=this._getMoveable(T.graphic,V))},this):(this._anchors=[],this._connects=[],l.forEach(F,function(T,V){!this._scale&&8>V||(T=new t(T,
c.spatialReference),T=new g(T,this._markerSymbol),this._isTextPoint&&1===V%2&&T.hide(),m.add(T),this._anchors.push({graphic:T,moveable:this._getMoveable(T,V)}))},this))}else this._cleanUp()},_getBoxCoords:function(c){var m=this._map,F=[],I,M,T;if(this._isTextPoint){var V=this._graphic.getNode().getBoundingClientRect();var J=m.__container.getBoundingClientRect();V=[{x:V.left-J.left,y:V.top-J.top},{x:V.right-J.left,y:V.top-J.top},{x:V.right-J.left,y:V.bottom-J.top},{x:V.left-J.left,y:V.bottom-J.top}]}else V=
this._getTransformedBoundingBox(this._graphic);l.forEach(V,function(L,aa,P){I=L;(M=P[aa+1])||(M=P[0]);T={x:(I.x+M.x)/2,y:(I.y+M.y)/2};c||(I=m.toMap(I),T=m.toMap(T));F.push([I.x,I.y]);F.push([T.x,T.y])});this._rotate&&(V=O.clone(F[1]),V=c?{x:V[0],y:V[1]}:m.toScreen({x:V[0],y:V[1],spatialReference:m.spatialReference}),V.y-=this._toolbar._options.rotateHandleOffset,c||(V=m.toMap(V)),F.push([V.x,V.y]));return F},_getTransformedBoundingBox:function(c){var m=this._map,F=c.geometry.getExtent(),I=c.geometry.spatialReference;
c=new t(F.xmin,F.ymax,I);F=new t(F.xmax,F.ymin,I);c=m.toScreen(c);F=m.toScreen(F);return[{x:c.x,y:c.y},{x:F.x,y:c.y},{x:F.x,y:F.y},{x:c.x,y:F.y}]},_getAllGraphics:function(){var c=[this._box];this._anchors&&l.forEach(this._anchors,function(m){c.push(m.graphic)});return c=l.filter(c,w.isDefined)},_getMoveable:function(c,m){var F=c.getDojoShape();if(F)return c=new D(F),c._index=m,this._connects.push(G.connect(c,"onMoveStart",this._moveStartHandler)),this._connects.push(G.connect(c,"onFirstMove",this._firstMoveHandler)),
this._connects.push(G.connect(c,"onMoveStop",this._moveStopHandler)),c.onMove=this._moveHandler,(F=F.getEventSource())&&B.set(F,"cursor",this._toolbar._cursors["box"+m]),c},_moveStartHandler:function(c){this._toolbar["on"+(8===c.host._index?this._rotateEvent:this._scaleEvent)+"Start"](this._graphic)},_firstMoveHandler:function(c){this._toolbar._deactivateScrollWheel();var m=c.host._index,F=this._wrapOffset=c.host.shape._wrapOffsets[0]||0,I=this._graphic.getLayer().getNavigationTransform();c=l.map(this._getBoxCoords(!0),
function(T){return{x:T[0]+F,y:T[1]}});var M=this._isTextPoint?this._map.toScreen(this._graphic.geometry):{x:c[1].x,y:c[3].y};this._centerCoord=q.multiplyPoint(q.invert(I),M);if(8===m)M=q.multiplyPoint(q.invert(I),c[1]),this._isTextPoint&&(this._centerCoord=this._deNormalizePoint(this._centerCoord,M)),this._startLine=[this._centerCoord,M],this._moveLine=O.clone(this._startLine);else if(M=q.multiplyPoint(q.invert(I),c[m]),I=q.multiplyPoint(q.invert(I),c[(m+4)%8]),this._isTextPoint&&(this._centerCoord=
this._deNormalizePoint(this._centerCoord,M)),this._firstMoverToAnchor=Math.sqrt((M.x-this._centerCoord.x)*(M.x-this._centerCoord.x)+(M.y-this._centerCoord.y)*(M.y-this._centerCoord.y)),this._startBox=I,this._startBox.width=c[4].x-c[0].x,this._startBox.height=c[4].y-c[0].y,this._moveBox=O.clone(this._startBox),this._xfactor=M.x>I.x?1:-1,this._yfactor=M.y>I.y?1:-1,1===m||5===m)this._xfactor=0;else if(3===m||7===m)this._yfactor=0;this._toolbar._beginOperation("BOX");this._toolbar["on"+(8===m?this._rotateEvent:
this._scaleEvent)+"FirstMove"](this._graphic)},_moveHandler:function(c,m){c=c.host._index;var F=this._defaultEventArgs;F.angle=0;F.scaleX=1;F.scaleY=1;if(8===c){var I=this._startLine;var M=this._moveLine;var T=M[1];T.x+=m.dx;T.y+=m.dy;m=this._getAngle(I,M);this._isTextPoint&&(m+=this._graphic.symbol.angle);M=q.rotategAt(m,I[0]);this._graphic.getDojoShape().setTransform(M);F.transform=M;F.angle=m;F.around=I[0]}else{I=this._startBox;M=this._moveBox;M.width+=m.dx*this._xfactor;M.height+=m.dy*this._yfactor;
this._uniformScaling||this._isTextPoint?(I=M.x+this._xfactor*M.width,M=M.y+this._yfactor*M.height,I=Math.sqrt((I-this._centerCoord.x)*(I-this._centerCoord.x)+(M-this._centerCoord.y)*(M-this._centerCoord.y)),this._scaleRatio=m=T=I/this._firstMoverToAnchor,I=this._centerCoord):(m=M.width/I.width,T=M.height/I.height,I={x:I.x,y:I.y});if(isNaN(m)||Infinity===m||-Infinity===m)m=1;if(isNaN(T)||Infinity===T||-Infinity===T)T=1;M=q.scaleAt(m,T,I);if(this._isTextPoint){var V=q.rotategAt(this._graphic.symbol.angle,
I);this._graphic.getDojoShape().setTransform([V,M])}else this._graphic.getDojoShape().setTransform(M);F.transform=M;F.scaleX=m;F.scaleY=T;F.around=I}this._toolbar["on"+(8===c?this._rotateEvent:this._scaleEvent)](this._graphic,F)},_moveStopHandler:function(c){this._toolbar._activateScrollWheel();var m=this._graphic,F=this._toolbar,I=F._geo?f.geographicToWebMercator(m.geometry):m.geometry,M=I.spatialReference,T=m.getDojoShape(),V=T.getTransform(),J=m.getLayer().getNavigationTransform();this._isTextPoint?
(m=this._graphic.symbol,8===c.host._index?m.angle+=this._getAngle(this._startLine,this._moveLine):m.font.setSize(Math.round(m.font.size*this._scaleRatio*100)/100),this._graphic.setSymbol(m)):(I=I.toJson(),this._updateSegments(I.paths||I.rings,V,J,M),T.setTransform(null),I=d.fromJson(I),m.setGeometry(F._geo?f.webMercatorToGeographic(I,!0):I));this._draw();this._startLine=this._moveLine=this._startBox=this._moveBox=this._xfactor=this._yfactor=null;F._endOperation("BOX");this._defaultEventArgs.transform=
V;F["on"+(8===c.host._index?this._rotateEvent:this._scaleEvent)+"Stop"](this._graphic,this._defaultEventArgs)},_updateSegments:function(c,m,F,I){var M=this._map,T=this._wrapOffset||0;l.forEach(c,function(V){l.forEach(V,function(J){this._updatePoint(J,I,T,q,M,F,m)},this)},this)},_updatePoint:function(c,m,F,I,M,T,V){m=M.toScreen({x:c[0],y:c[1],spatialReference:m},!0);m.x+=F;m=I.multiplyPoint([T,V,I.invert(T)],m);m.x-=F;F=M.toMap(m);c[0]=F.x;c[1]=F.y},_getAngle:function(c,m){return 180*Math.atan2(m[0].y-
m[1].y,m[0].x-m[1].x)/Math.PI-180*Math.atan2(c[0].y-c[1].y,c[0].x-c[1].x)/Math.PI},_deNormalizePoint:function(c,m){var F=this._map._getFrameWidth();if(-1===F)return c;for(c={x:c.x,y:c.y};Math.abs(c.x-m.x)>=F;)c.x=c.x<m.x?c.x+F:c.x-F;var I=Math.abs(c.x-m.x);Math.abs(c.x-m.x+F)<I?c.x+=F:Math.abs(c.x-m.x-F)<I&&(c.x-=F);return c}});E("extend-esri")&&O.setObject("toolbars._Box",C,k);return C})},"dojox/gfx/Moveable":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/_base/event dojo/topic dojo/touch dojo/dom-class dojo/_base/window ./Mover dojo/mouse".split(" "),
function(C,O,l,G,K,E,B,D,q,k){return O("dojox.gfx.Moveable",null,{constructor:function(w,t){this.shape=w;this.delay=t&&0<t.delay?t.delay:0;this.mover=t&&t.mover?t.mover:q;this.leftButtonOnly=t&&t.leftButtonOnly;this.events=[this.shape.on(E.press,C.hitch(this,"onMouseDown"))]},destroy:function(){l.forEach(this.events,function(w){w.remove()});this.events=this.shape=null},onMouseDown:function(w){this.delay?(this.events.push(this.shape.on(E.move,C.hitch(this,"onMouseMove")),this.shape.on(E.release,C.hitch(this,
"onMouseUp"))),this._lastX=w.clientX,this._lastY=w.clientY):this.leftButtonOnly&&!k.isLeft(w)||new this.mover(this.shape,w,this);G.stop(w)},onMouseMove:function(w){var t=w.clientY;if(Math.abs(w.clientX-this._lastX)>this.delay||Math.abs(t-this._lastY)>this.delay)this.onMouseUp(w),new this.mover(this.shape,w,this);G.stop(w)},onMouseUp:function(w){this.events.pop().remove()},onMoveStart:function(w){K.publish("/gfx/move/start",w);B.add(D.body(),"dojoMove")},onMoveStop:function(w){K.publish("/gfx/move/stop",
w);B.remove(D.body(),"dojoMove")},onFirstMove:function(w){},onMove:function(w,t,h){this.onMoving(w,t,h);this.shape.applyLeftTransform(t);this.onMoved(w,t)},onMoving:function(w,t){},onMoved:function(w,t){}})})},"dojox/gfx/Mover":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/on dojo/touch dojo/_base/event".split(" "),function(C,O,l,G,K,E){return l("dojox.gfx.Mover",null,{constructor:function(B,D,q){this.shape=B;this.lastX=D.clientX;this.lastY=D.clientY;B=this.host=q;D=
document;q=G(D,K.move,C.hitch(this,"onFirstMove"));this.events=[G(D,K.move,C.hitch(this,"onMouseMove")),G(D,K.release,C.hitch(this,"destroy")),G(D,"dragstart",C.hitch(E,"stop")),G(D,"selectstart",C.hitch(E,"stop")),q];if(B&&B.onMoveStart)B.onMoveStart(this)},onMouseMove:function(B){var D=B.clientX,q=B.clientY;this.host.onMove(this,{dx:D-this.lastX,dy:q-this.lastY},B);this.lastX=D;this.lastY=q;E.stop(B)},onFirstMove:function(){this.host.onFirstMove(this);this.events.pop().remove()},destroy:function(){O.forEach(this.events,
function(D){D.remove()});var B=this.host;if(B&&B.onMoveStop)B.onMoveStop(this);this.events=this.shape=null}})})},"esri/toolbars/_GraphicMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/json dojo/dom-style dojox/gfx/Moveable dojox/gfx/Mover dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/webMercatorUtils ../geometry/ScreenPoint ../geometry/Point".split(" "),function(C,O,l,G,K,E,B,D,q,k,w,t,h,a){var f=C(null,{declaredClass:"esri.toolbars._GraphicMover",
constructor:function(d,g,c,m){this.graphic=d;this.map=g;this.toolbar=c;this.tempPt=m;this._enableGraphicMover();this._moved=!1},refresh:function(d){var g=this.graphic.getDojoShape();!g||!d&&g._hostGraphic||(this._disableGraphicMover(),this._enableGraphicMover())},destroy:function(){this._disableGraphicMover()},hasMoved:function(){return this._moved},_enableGraphicMover:function(){var d=this.graphic,g=d.getDojoShape();g&&(g._hostGraphic=d,this._moveable=new E(g,{mover:f.Mover}),this._moveStartHandle=
l.connect(this._moveable,"onMoveStart",this,this._moveStartHandler),this._firstMoveHandle=l.connect(this._moveable,"onFirstMove",this,this._firstMoveHandler),this._movingHandle=l.connect(this._moveable,"onMoving",this,this._movingHandler),this._moveStopHandle=l.connect(this._moveable,"onMoveStop",this,this._moveStopHandler),(d=g.getEventSource())&&K.set(d,"cursor",this.toolbar._cursors.move))},_disableGraphicMover:function(){var d=this._moveable;if(d){l.disconnect(this._moveStartHandle);l.disconnect(this._firstMoveHandle);
l.disconnect(this._movingHandle);l.disconnect(this._moveStopHandle);var g=d.shape;g&&(g._hostGraphic=null,(g=g.getEventSource())&&K.set(g,"cursor","inherit"));d.destroy()}this._moveable=null},_moveStartHandler:function(){var d=this.graphic,g=this.map;this._startTx=d.getDojoShape().getTransform();"point"===this.graphic.geometry.type&&g.snappingManager&&g.snappingManager._setUpSnapping();this.toolbar.onGraphicMoveStart(d)},_firstMoveHandler:function(){this.toolbar._beginOperation("MOVE");this.toolbar.onGraphicFirstMove(this.graphic)},
_movingHandler:function(d,g,c){d=d.shape.getTransform();g=this.map;var m;w("esri-pointer")?m=g.navigationManager.pointerEvents._processTouchEvent(c,c):c&&"pointermove"===c.type&&(m=k.prototype._processTouchEvent.call({map:g},c,c));m&&g.snappingManager&&g.snappingManager._onSnappingMouseMoveHandler(m);this.tempPt&&this.tempPt.getDojoShape().setTransform(d);this.toolbar.onGraphicMove(this.graphic,d)},_moveStopHandler:function(d){var g=this.graphic,c=this.toolbar,m=this.map,F=c._geo?t.geographicToWebMercator(g.geometry):
g.geometry,I=F.type,M=g.getDojoShape(),T=M.getTransform();if(G.toJson(T)!==G.toJson(this._startTx)){this._moved=!0;switch(I){case "point":I=[T,D.invert(this._startTx)];if(m.snappingManager)var V=m.snappingManager._snappingPoint;F=V||m.toMap(D.multiplyPoint(I,m.toScreen(F,!0)));m.snappingManager&&m.snappingManager._killOffSnapping();break;case "polyline":F=this._updatePolyGeometry(F,F.paths,T);break;case "polygon":F=this._updatePolyGeometry(F,F.rings,T)}M.setTransform(null);g.setGeometry(c._geo?t.webMercatorToGeographic(F,
!0):F);this.tempPt&&this.tempPt.setGeometry(new a(g.geometry.toJson()))}else this._moved=!1;c._endOperation("MOVE");c.onGraphicMoveStop(g,T);this._moved||(d=d.__e,m=this.map.position,d=new h(d.pageX-m.x,d.pageY-m.y),c.onGraphicClick(g,{screenPoint:d,mapPoint:this.map.toMap(d)}))},_updatePolyGeometry:function(d,g,c){var m=this.map,F=d.getPoint(0,0);m=m.toMap(m.toScreen(F).offset(c.dx,c.dy));c=m.x-F.x;F=m.y-F.y;var I;for(m=0;m<g.length;m++){var M=g[m];for(I=0;I<M.length;I++){var T=d.getPoint(m,I);d.setPoint(m,
I,T.offset(c,F))}}return d}});f.Mover=C(B,{declaredClass:"esri.toolbars._Mover",constructor:function(d,g,c){this.__e=g}});w("extend-esri")&&(O.setObject("toolbars._GraphicMover",f,q),O.setObject("toolbars._Mover",f.Mover,q));return f})},"esri/toolbars/_VertexEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/has dijit/Menu dijit/MenuItem ../kernel ./_VertexMover ../geometry/Point ../geometry/jsonUtils dojo/i18n!../nls/jsapi".split(" "),function(C,
O,l,G,K,E,B,D,q,k,w,t){var h=C(null,{declaredClass:"esri.toolbars._GraphicVertexEditor",constructor:function(a,f,d){this.graphic=a;this.map=f;this.toolbar=d;a=d._options;this._symbol1=a.vertexSymbol;this._symbol2=a.ghostVertexSymbol;f=a.ghostLineSymbol;this._lineStroke={style:f.style,width:f.width,color:f.color};this._canDel=a.allowDeleteVertices;this._canAdd=a.allowAddVertices;this._addControllers()},destroy:function(){this._removeControllers()},refresh:function(a){a?(this._removeControllers(),this._addControllers()):
(this._refresh(this._vertexMovers),this._refresh(this._mpVertexMovers))},suspend:function(){this._suspended||this._removeControllers();this._suspended=!0},resume:function(){this._suspended&&this._addControllers();this._suspended=!1},_addControllers:function(){this._firstMoveHandle=l.connect(q,"onFirstMove",this,this._firstMoveHandler);this._moveStopHandle=l.connect(q,"onMoveStop",this,this._moveStopHandler);this._vertexMovers=this._add(this._getSegments(this.graphic.geometry),this._symbol1);this._canAdd&&
(this._mpVertexMovers=this._add(this._getMidpointSegments(this.graphic.geometry),this._symbol2,!0));var a=this._getGraphicsLayer();this._mouseOverHandle=l.connect(a,"onMouseOver",this,this._mouseOverHandler);this._mouseOutHandle=l.connect(a,"onMouseOut",this,this._mouseOutHandler);this._canDel&&(this._ctxMenu=new E({style:"font-size: 12px; margin-left: 5px; margin-top: 5px;"}),a=this._ctxDelete=new B({label:t.toolbars.edit.deleteLabel,iconClass:"vertexDeleteIcon",style:"outline: none;"}),this._deleteHandle=
l.connect(a,"onClick",this,this._deleteHandler),this._ctxMenu.addChild(a),this._ctxMenu.startup())},_removeControllers:function(){l.disconnect(this._firstMoveHandle);l.disconnect(this._moveStopHandle);l.disconnect(this._mouseOverHandle);l.disconnect(this._mouseOutHandle);l.disconnect(this._deleteHandle);this._ctxMenu&&(this._ctxDelete=null,this._unbindCtxNode(),this._ctxMenu.destroyRecursive());this._remove(this._vertexMovers);this._remove(this._mpVertexMovers);this._vertexMovers=this._mpVertexMovers=
null},_add:function(a,f,d){var g,c,m=this.graphic,F=[];for(g=0;g<a.length;g++){var I=a[g],M=[];for(c=0;c<I.length;c++)M.push(new q(I[c],f,m,g,c,I.length,this,d));F.push(M)}return F},_remove:function(a){a&&G.forEach(a,function(f){G.forEach(f,function(d){d.destroy()})})},_refresh:function(a){a&&G.forEach(a,function(f){G.forEach(f,function(d){d.refresh()})})},_isNew:function(a){return-1===G.indexOf(this._vertexMovers[a.segIndex],a)?!0:!1},_getGraphicsLayer:function(){return this.toolbar._scratchGL},
_deleteHandler:function(a){a=this._selectedMover;this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength,!1,!0);this._canAdd&&this._deleteMidpoints(a);this._deleteVertex(a);this.toolbar._endOperation("VERTICES")},_mouseOverHandler:function(a){a=a.graphic;var f=this._findMover(a);f&&(this.toolbar.onVertexMouseOver(this.graphic,f._getInfo()),f._placeholder||(this._selectedMover=f,this._canDel&&this._bindCtxNode(a.getDojoShape().getNode())))},_mouseOutHandler:function(a){if(a=
this._findMover(a.graphic))this.toolbar.onVertexMouseOut(this.graphic,a._getInfo())},_bindCtxNode:function(a){this._unbindCtxNode();this._ctxDelete.set("disabled",this._selectedMover.segLength<=this.minLength?!0:!1);this._ctxMenu.bindDomNode(a);this._bindNode=a},_unbindCtxNode:function(){var a=this._bindNode;a&&this._ctxMenu.unBindDomNode(a)},_findMover:function(a){var f=[];var d=this._mpVertexMovers;G.forEach(this._vertexMovers,function(c){f=f.concat(c)});d&&G.forEach(d,function(c){f=f.concat(c)});
for(d=0;d<f.length;d++){var g=f[d];if(g.graphic===a)return g}},_firstMoveHandler:function(a){!this._isNew(a)&&this._canAdd&&this._hideRelatedMidpoints(a);this.toolbar._beginOperation("VERTICES")},_moveStopHandler:function(a,f){var d=this._isNew(a);f&&(f.dx||f.dy)?(this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength,d),this._canAdd&&(d?this._addMidpoints(a):(this._repositionRelatedMidpoints(a),this._showRelatedMidpoints(a))),this.toolbar._endOperation("VERTICES")):
!d&&this._canAdd&&this._showRelatedMidpoints(a)},_showRelatedMidpoints:function(a){var f=this._getAdjacentMidpoints(a.ptIndex,a.segLength),d=this._mpVertexMovers[a.segIndex];for(a=0;a<f.length;a++){var g=d[f[a]];g.graphic.show();g.refresh()}},_hideRelatedMidpoints:function(a){var f=this._getAdjacentMidpoints(a.ptIndex,a.segLength),d=this._mpVertexMovers[a.segIndex];for(a=0;a<f.length;a++)d[f[a]].graphic.hide()},_repositionRelatedMidpoints:function(a){var f,d=this._getAdjacentMidpoints(a.ptIndex,a.segLength),
g=this._mpVertexMovers[a.segIndex];for(f=0;f<d.length;f++){var c=this._getAdjacentVertices(d[f],a.segLength),m=a.relatedGraphic.geometry.getPoint(a.segIndex,c[0]);c=a.relatedGraphic.geometry.getPoint(a.segIndex,c[1]);m=new k({x:(m.x+c.x)/2,y:(m.y+c.y)/2,spatialReference:m.spatialReference.toJson()});g[d[f]].graphic.setGeometry(m)}},_addMidpoints:function(a){var f=a.segIndex,d=a.ptIndex,g=a.segLength,c=d+1,m,F=g+1;this._mpVertexMovers[f].splice(d,1);var I=this._vertexMovers[f];for(m=0;m<c;m++)I[m].segLength+=
1;for(m=c;m<I.length;m++)I[m].ptIndex+=1,I[m].segLength+=1;a.ptIndex=c;a.segLength=I.length+1;I.splice(c,0,a);a.graphic.setSymbol(this._symbol1);I=this._mpVertexMovers[f];for(m=0;m<d;m++)I[m].segLength+=1;for(m=d;m<g-1;m++)I[m].ptIndex+=1,I[m].segLength+=1;c=this._getAdjacentVertices(d,F);f=this._getAdjacentVertices(d+1,F);g=a.relatedGraphic.geometry.getPoint(a.segIndex,c[0]);m=a.relatedGraphic.geometry.getPoint(a.segIndex,c[1]);c=new k({x:(g.x+m.x)/2,y:(g.y+m.y)/2,spatialReference:g.spatialReference.toJson()});
g=a.relatedGraphic.geometry.getPoint(a.segIndex,f[0]);m=a.relatedGraphic.geometry.getPoint(a.segIndex,f[1]);f=new k({x:(g.x+m.x)/2,y:(g.y+m.y)/2,spatialReference:g.spatialReference.toJson()});g=new q(c,this._symbol2,this.graphic,a.segIndex,d,F,this,!0);a=new q(f,this._symbol2,this.graphic,a.segIndex,d+1,F,this,!0);I.splice(d,0,g,a)},_deleteVertex:function(a){var f,d=a.ptIndex,g=this._vertexMovers[a.segIndex];for(f=0;f<d;f++)--g[f].segLength;for(f=d+1;f<g.length;f++){var c=g[f];--c.ptIndex;--c.segLength}g.splice(d,
1);f=a._getInfo();a.destroy();this.toolbar.onVertexDelete(this.graphic,f)}});O.mixin(h,{create:function(a,f,d){switch(a.geometry.type){case "multipoint":return new h.MultipointVertexEditor(a,f,d);case "polyline":return new h.PolylineVertexEditor(a,f,d);case "polygon":return new h.PolygonVertexEditor(a,f,d)}}});h.MultipointVertexEditor=C(h,{declaredClass:"esri.toolbars._MultipointVertexEditor",minLength:1,constructor:function(){this._moveStartHandle=l.connect(q,"onMoveStart",this,this._moveStartHandler);
l.disconnect(this._firstMoveHandle)},destroy:function(){this.inherited(arguments);l.disconnect(this._moveStartHandle)},_getSegments:function(a){var f=a.points,d=[],g=a.spatialReference;for(a=0;a<f.length;a++){var c=f[a];d.push(new k({x:c[0],y:c[1],spatialReference:g.toJson()}))}return[d]},_getMidpointSegments:function(a){return[]},_getControlPoints:function(a,f,d,g,c){return[]},_getGraphicsLayer:function(){return this.graphic._graphicsLayer},_mouseOverHandler:function(a){var f=a.graphic;if(a=this._findMover(a))this.toolbar.onVertexMouseOver(f,
a._getInfo()),this._selectedMover=a,this._canDel&&this._bindCtxNode(a.graphic.getDojoShape().getNode())},_mouseOutHandler:function(a){var f=a.graphic;if(a=this._findMover(a))this.toolbar.onVertexMouseOut(f,a._getInfo())},_findMover:function(a){var f=[].concat(this._vertexMovers[0]),d=a.target;for(a=0;a<f.length;a++){var g=f[a];if(g.graphic.getDojoShape().getNode()===d)return g}},_moveStartHandler:function(a){var f=a.ptIndex,d=a.segLength-1,g=a.relatedGraphic.geometry.points;a=g.splice(f,1);g.push(a[0]);
g=this._vertexMovers[0];for(a=d;a>f;a--)--g[a].ptIndex;a=g.splice(f,1);g.push(a[0]);a[0].ptIndex=d},_moveStopHandler:function(a){this._updateRelatedGraphic(a,a.relatedGraphic,a.graphic.geometry,a.segIndex,a.ptIndex,a.segLength);this.toolbar._endOperation("VERTICES")},_updateRelatedGraphic:function(a,f,d,g,c,m,F,I){a=f.geometry;I?a.removePoint(c):a.setPoint(c,d);f.setGeometry(a)},_deleteMidpoints:function(a){}});h.PolylineVertexEditor=C(h,{declaredClass:"esri.toolbars._PolylineVertexEditor",minLength:2,
_getSegments:function(a){var f,d,g=a.paths,c=[];for(f=0;f<g.length;f++){var m=g[f],F=[];for(d=0;d<m.length;d++)F.push(a.getPoint(f,d));c.push(F)}return c},_getMidpointSegments:function(a){var f,d,g=a.paths,c=[],m=a.spatialReference;for(f=0;f<g.length;f++){var F=g[f],I=[];for(d=0;d<F.length-1;d++){var M=a.getPoint(f,d),T=a.getPoint(f,d+1);M=new k({x:(M.x+T.x)/2,y:(M.y+T.y)/2,spatialReference:m.toJson()});I.push(M)}c.push(I)}return c},_getControlPoints:function(a,f,d,g,c){var m=this.map,F,I;this._isNew(a)?
(a=g,g+=1,0<=a&&(F=m.toScreen(f.getPoint(d,a))),g<=c&&(I=m.toScreen(f.getPoint(d,g)))):(a=g-1,g+=1,0<=a&&(F=m.toScreen(f.getPoint(d,a))),g<c&&(I=m.toScreen(f.getPoint(d,g))));return[F,I]},_getAdjacentMidpoints:function(a,f){var d=[],g=a-1;0<=g&&d.push(g);a<f-1&&d.push(a);return d},_getAdjacentVertices:function(a,f){return[a,a+1]},_deleteMidpoints:function(a){var f=this._mpVertexMovers[a.segIndex],d=f.length-1,g=this._getAdjacentMidpoints(a.ptIndex,a.segLength).sort(),c,m=g[0];for(c=0;c<m;c++)--f[c].segLength;
for(c=m+1;c<f.length;c++){var F=f[c];--F.ptIndex;--F.segLength}if(1===g.length)f.splice(m,1)[0].destroy();else for(F=this._getAdjacentVertices(m,d),c=a.relatedGraphic.geometry.getPoint(a.segIndex,F[0]),F=a.relatedGraphic.geometry.getPoint(a.segIndex,F[1]),c=new k({x:(c.x+F.x)/2,y:(c.y+F.y)/2,spatialReference:c.spatialReference.toJson()}),a=new q(c,this._symbol2,this.graphic,a.segIndex,m,d,this,!0),f=f.splice(m,g.length,a),c=0;c<f.length;c++)f[c].destroy()},_updateRelatedGraphic:function(a,f,d,g,c,
m,F,I){a=f.geometry;F?a.insertPoint(g,c+1,w.fromJson(d.toJson())):I?a.removePoint(g,c):a.setPoint(g,c,w.fromJson(d.toJson()));f.setGeometry(a)}});h.PolygonVertexEditor=C(h,{declaredClass:"esri.toolbars._PolygonVertexEditor",minLength:3,_getSegments:function(a){var f,d,g=a.rings,c=[];for(f=0;f<g.length;f++){var m=g[f],F=[];for(d=0;d<m.length-1;d++)F.push(a.getPoint(f,d));c.push(F)}return c},_getMidpointSegments:function(a){var f,d,g=a.rings,c=[],m=a.spatialReference;for(f=0;f<g.length;f++){var F=g[f],
I=[];for(d=0;d<F.length-1;d++){var M=a.getPoint(f,d),T=a.getPoint(f,d+1);M=new k({x:(M.x+T.x)/2,y:(M.y+T.y)/2,spatialReference:m.toJson()});I.push(M)}c.push(I)}return c},_getControlPoints:function(a,f,d,g,c){var m=this.map;this._isNew(a)?a=g:(a=g-1,a=0>a?(c+a)%c:a);g=(g+1)%c;c=m.toScreen(f.getPoint(d,a));f=m.toScreen(f.getPoint(d,g));return[c,f]},_getAdjacentMidpoints:function(a,f){var d=a-1;return[0>d?(f+d)%f:d,a]},_getAdjacentVertices:function(a,f){return[a,(a+1)%f]},_deleteMidpoints:function(a){var f=
a.ptIndex,d=this._mpVertexMovers[a.segIndex],g=d.length-1,c=this._getAdjacentMidpoints(f,a.segLength).sort();var m=c[0];var F=c[c.length-1];if(0===f){var I=this._getAdjacentVertices(g-1,g);f=a.relatedGraphic.geometry.getPoint(a.segIndex,I[0]);I=a.relatedGraphic.geometry.getPoint(a.segIndex,I[1]);f=new k({x:(f.x+I.x)/2,y:(f.y+I.y)/2,spatialReference:f.spatialReference.toJson()});a=new q(f,this._symbol2,this.graphic,a.segIndex,g-1,g,this,!0);d.splice(F,1,a)[0].destroy();d.splice(m,1)[0].destroy();for(c=
0;c<d.length-1;c++)m=d[c],--m.ptIndex,--m.segLength}else{I=this._getAdjacentVertices(m,g);f=a.relatedGraphic.geometry.getPoint(a.segIndex,I[0]);I=a.relatedGraphic.geometry.getPoint(a.segIndex,I[1]);f=new k({x:(f.x+I.x)/2,y:(f.y+I.y)/2,spatialReference:f.spatialReference.toJson()});a=new q(f,this._symbol2,this.graphic,a.segIndex,m,g,this,!0);F=d.splice(m,c.length,a);for(c=0;c<F.length;c++)F[c].destroy();for(c=0;c<m;c++)--d[c].segLength;for(c=m+1;c<d.length;c++)m=d[c],--m.ptIndex,--m.segLength}},_updateRelatedGraphic:function(a,
f,d,g,c,m,F,I){a=f.geometry;F?a.insertPoint(g,c+1,w.fromJson(d.toJson())):I?(a.removePoint(g,c),0===c&&a.setPoint(g,m-1,w.fromJson(a.getPoint(g,0).toJson()))):(a.setPoint(g,c,w.fromJson(d.toJson())),0===c&&a.setPoint(g,m,w.fromJson(d.toJson())));f.setGeometry(a)}});K("extend-esri")&&(O.setObject("toolbars._GraphicVertexEditor",h,D),O.setObject("toolbars._MultipointVertexEditor",h.MultipointVertexEditor,D),O.setObject("toolbars._PolylineVertexEditor",h.PolylineVertexEditor,D),O.setObject("toolbars._PolygonVertexEditor",
h.PolygonVertexEditor,D));return h})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(C,O,l,G,K,E,B,D,q,k,w,t,h,a,f,d){w("dijit-legacy-requires")&&d(0,function(){C(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return l("dijit.Menu",f,{constructor:function(){this._bindings=
[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):O.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(g){return h.get(this._iframeContentDocument(g))||this._iframeContentDocument(g).__parent__||g.name&&document.frames[g.name]||null},_iframeContentDocument:function(g){return g.contentDocument||g.contentWindow&&g.contentWindow.document||
g.name&&document.frames[g.name]&&document.frames[g.name].document||null},bindDomNode:function(g){g=G.byId(g,this.ownerDocument);if("iframe"==g.tagName.toLowerCase()){var c=g;var m=this._iframeContentWindow(c);m=t.body(m.document)}else m=g==t.body(this.ownerDocument)?this.ownerDocument.documentElement:g;var F={node:g,iframe:c};K.set(g,"_dijitMenu"+this.id,this._bindings.push(F));var I=q.hitch(this,function(M){var T=this.selector,V=T?function(L){return k.selector(T,L)}:function(L){return L},J=this;
return[k(M,V(this.leftClickToOpen?"click":"contextmenu"),function(L){L.stopPropagation();L.preventDefault();(new Date).getTime()<J._lastKeyDown+500||J._scheduleOpen(this,c,{x:L.pageX,y:L.pageY},L.target)}),k(M,V("keydown"),function(L){if(93==L.keyCode||L.shiftKey&&L.keyCode==D.F10||J.leftClickToOpen&&L.keyCode==D.SPACE)L.stopPropagation(),L.preventDefault(),J._scheduleOpen(this,c,null,L.target),J._lastKeyDown=(new Date).getTime()})]});F.connects=m?I(m):[];c&&(F.onloadHandler=q.hitch(this,function(){var M=
this._iframeContentWindow(c);M=t.body(M.document);F.connects=I(M)}),c.addEventListener?c.addEventListener("load",F.onloadHandler,!1):c.attachEvent("onload",F.onloadHandler))},unBindDomNode:function(g){try{var c=G.byId(g,this.ownerDocument)}catch(M){return}g="_dijitMenu"+this.id;if(c&&K.has(c,g)){for(var m=K.get(c,g)-1,F=this._bindings[m],I;I=F.connects.pop();)I.remove();(I=F.iframe)&&(I.removeEventListener?I.removeEventListener("load",F.onloadHandler,!1):I.detachEvent("onload",F.onloadHandler));K.remove(c,
g);delete this._bindings[m]}},_scheduleOpen:function(g,c,m,F){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:F,delegatedTarget:g,iframe:c,coords:m})},1))},_openMyself:function(g){function c(){L.refocus&&aa&&aa.focus();a.close(L)}var m=g.target,F=g.iframe,I=g.coords,M=!I;this.currentTarget=g.delegatedTarget;if(I){if(F){g=E.position(F,!0);m=this._iframeContentWindow(F);m=E.docScroll(m.document);var T=B.getComputedStyle(F),V=B.toPixelValue,J=(w("ie")&&
w("quirks")?0:V(F,T.paddingLeft))+(w("ie")&&w("quirks")?V(F,T.borderLeftWidth):0);F=(w("ie")&&w("quirks")?0:V(F,T.paddingTop))+(w("ie")&&w("quirks")?V(F,T.borderTopWidth):0);I.x+=g.x+J-m.x;I.y+=g.y+F-m.y}}else I=E.position(m,!0),I.x+=10,I.y+=10;var L=this;F=this._focusManager.get("prevNode");g=this._focusManager.get("curNode");var aa=!g||G.isDescendant(g,this.domNode)?F:g;a.open({popup:this,x:I.x,y:I.y,onExecute:c,onCancel:c,orient:this.isLeftToRight()?"L":"R"});this.focus();M||this.defer(function(){this._cleanUp(!0)});
this._onBlur=function(){this.inherited("_onBlur",arguments);a.close(this)}},destroy:function(){O.forEach(this._bindings,function(g){g&&this.unBindDomNode(g.node)},this);this.inherited(arguments)}})})},"esri/toolbars/_VertexMover":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/sniff dojo/dom-style dojox/gfx/Moveable dojox/gfx/matrix ../kernel ../PointerEvents ../sniff ../geometry/Point ../graphic ../geometry/webMercatorUtils".split(" "),function(C,O,l,G,K,E,B,D,q,k,w,
t,h){C=C(null,{declaredClass:"esri.toolbars.VertexMover",constructor:function(a,f,d,g,c,m,F,I){this.point=a;this.symbol=f;this.relatedGraphic=d;this.segIndex=g;this.ptIndex=c;this.segLength=m;this.editor=F;this.map=F.map;this._scratchGL=F.toolbar._scratchGL;this._placeholder=I||!1;this._type=d.geometry.type;this._init();this._enable()},refresh:function(a){if(a||this._needRefresh())this._disable(),this._enable()},destroy:function(){this._disable();this.graphic&&this._scratchGL.remove(this.graphic);
this.point=this.symbol=this.graphic=this.relatedGraphic=this.segIndex=this.ptIndex=this.segLength=this.editor=this.map=this._scratchGL=null},_init:function(){var a=new w(this.point.toJson());a=new t(a,this.symbol);switch(this._type){case "multipoint":a._shape=this.relatedGraphic.getDojoShape().children[this.ptIndex];break;case "polyline":case "polygon":this._scratchGL.add(a)}this.graphic=a},_enable:function(){var a=this.graphic.getDojoShape();a&&(a._hasMover=!0,this._moveable=this._getMoveable(a),
(a=a.getEventSource())&&K.set(a,"cursor",this.editor.toolbar._cursors[this._placeholder?"move-gv":"move-v"]))},_disable:function(){var a=this._moveable;if(a){l.disconnect(this._startHandle);l.disconnect(this._firstHandle);l.disconnect(this._movingHandle);l.disconnect(this._stopHandle);var f=a.shape;f&&(f=f.getEventSource())&&K.set(f,"cursor","inherit");a.destroy();this._moveable=null}},_needRefresh:function(){var a=this.graphic.getDojoShape(),f=!1;if(a)switch(this._type){case "multipoint":var d=this.relatedGraphic.getDojoShape();
d&&(d=d.children[this.ptIndex],a!==d&&(this.graphic._shape=d,f=!0));break;case "polyline":case "polygon":f=!a._hasMover}return f},_getMoveable:function(a){a=new E(a,G("mac")&&G("ff")&&!k("esri-touch")&&{leftButtonOnly:!0});this._startHandle=l.connect(a,"onMoveStart",this,this._moveStartHandler);this._firstHandle=l.connect(a,"onFirstMove",this,this._firstMoveHandler);this._movingHandle=l.connect(a,"onMoving",this,this._movingHandler);this._stopHandle=l.connect(a,"onMoveStop",this,this._moveStopHandler);
return a},_getPtIndex:function(){return this.ptIndex+(this._placeholder?1:0)},_getInfo:function(){return{graphic:this.graphic,isGhost:this._placeholder,segmentIndex:this.segIndex,pointIndex:this._getPtIndex()}},_moveStartHandler:function(a){var f=this.map;f.snappingManager&&f.snappingManager._setUpSnapping();this.editor.toolbar._deactivateScrollWheel();this._startTx=this.graphic.getDojoShape().getTransform();a.shape.moveToFront();this.constructor.onMoveStart(this);this.editor.toolbar.onVertexMoveStart(this.relatedGraphic,
this._getInfo())},_firstMoveHandler:function(a){var f=a.shape,d=this._getControlEdges(),g=this._scratchGL._div,c,m=[],F=a.host.shape._wrapOffsets[0]||0;for(c=0;c<d.length;c++){var I=d[c];I.x1+=F;I.x2+=F;m.push([g.createLine({x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2}).setStroke(this.editor._lineStroke),I.x1,I.y1,I.x2,I.y2])}f._lines=m;a.shape.moveToFront();this.constructor.onFirstMove(this);this.editor.toolbar.onVertexFirstMove(this.relatedGraphic,this._getInfo())},_movingHandler:function(a,f,d){f=this.map;
var g;k("esri-pointer")?g=f.navigationManager.pointerEvents._processTouchEvent(d,d):d&&"pointermove"===d.type&&(g=q.prototype._processTouchEvent.call({map:f},d,d));g&&f.snappingManager&&f.snappingManager._onSnappingMouseMoveHandler(g);d=a.shape;a=d.getTransform();d=d._lines;for(g=0;g<d.length;g++)f=d[g],f[0].setShape({x1:f[1]+a.dx,y1:f[2]+a.dy,x2:f[3],y2:f[4]});this.editor.toolbar.onVertexMove(this.relatedGraphic,this._getInfo(),a)},_moveStopHandler:function(a){a=a.shape;var f=this.editor.toolbar,
d=a.getTransform(),g=this.map,c=this.graphic,m=f._geo?h.geographicToWebMercator(c.geometry):c.geometry;f._activateScrollWheel();var F,I=a._lines;if(I){for(F=0;F<I.length;F++)I[F][0].removeShape();a._lines=null}F=!1;I=!0;var M=this._getInfo();d&&(d.dx||d.dy)?this._placeholder&&(this._placeholder=!1,F=!0):I=!1;if(g.snappingManager)var T=g.snappingManager._snappingPoint;var V=[d,B.invert(this._startTx)];T=T||g.toMap(B.multiplyPoint(V,g.toScreen(m,!0)));g.snappingManager&&g.snappingManager._killOffSnapping();
a.setTransform(null);c.setGeometry(f._geo?h.webMercatorToGeographic(T,!0):T);this.constructor.onMoveStop(this,d);f.onVertexMoveStop(this.relatedGraphic,M,d);if(!I)f.onVertexClick(this.relatedGraphic,M);if(F)f.onVertexAdd(this.relatedGraphic,this._getInfo())},_getControlEdges:function(){var a=this.map,f=this.relatedGraphic.geometry,d=this.segIndex,g=this.ptIndex,c=this.segLength,m=this._scratchGL.getNavigationTransform(),F=m.dx;m=m.dy;var I=a.toScreen(this.graphic.geometry);a=I.x-F;I=I.y-m;var M=[];
f=this.editor._getControlPoints(this,f,d,g,c);f[0]&&M.push({x1:a,y1:I,x2:f[0].x-F,y2:f[0].y-m});f[1]&&M.push({x1:a,y1:I,x2:f[1].x-F,y2:f[1].y-m});return M}});k("extend-esri")&&O.setObject("toolbars.VertexMover",C,D);O.mixin(C,{onMoveStart:function(){},onFirstMove:function(){},onMoveStop:function(){}});return C})},"esri/toolbars/TextEditor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/has dojo/dom-construct dojo/dom-class dojo/dom-style dojo/keys ../kernel".split(" "),
function(C,O,l,G,K,E,B,D,q,k){C=C(null,{declaredClass:"esri.toolbars.TextEditor",constructor:function(w,t,h){this._graphic=w;this._map=t;this._toolbar=h;this._enable(this._graphic)},destroy:function(){this._disable()},onEditStart:function(){},onEditEnd:function(){},_enable:function(w){this._editBox?(l.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null):(this._map.navigationManager.setImmediateClick(!0),this._addEditBoxHandler=l.connect(w.getLayer(),"onDblClick",this,function(t){this._map.navigationManager.setImmediateClick(!1);
t.graphic==w&&(G.stop(t),l.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null,this._addTextBox(w))}))},_disable:function(){this._applyEdit();this._addEditBoxHandler&&(l.disconnect(this._addEditBoxHandler),this._addEditBoxHandler=null);this._removeTextBox();this.onEditEnd(this._graphic);this._toolbar.onTextEditEnd(this._graphic)},_addTextBox:function(w,t){if(!this._editBox){if(!w.symbol.text){w.symbol.text="Tempt text";w.setSymbol(w.symbol);var h=""}var a=this._createInputTextStyle(w,
this._map);""!==h&&(h=t||w.symbol.text);this._editBox=E.create("input",{type:"text",value:h});D.set(this._editBox,a);B.add(this._editBox,"esriTextEditorInput");this._map.container.appendChild(this._editBox);this._editBox.focus();this._editBoxKeyHandler=l.connect(this._editBox,"onkeyup",O.hitch(this,function(d){d.keyCode!=q.ENTER&&d.keyCode!==q.TAB||this._disable()}));this._editBoxBlurHandler=l.connect(this._editBox,"onblur",O.hitch(this,function(d){this._disable()}));w.symbol.text="";w.setSymbol(w.symbol);
w.hide();var f=this._editBox;this._disableBoxHandler||(this._disableBoxHandler=this._map.on("zoom-start",O.hitch(this,function(){this._disable()})));this._moveBoxHandler=this._map.on("pan",function(d){D.set(f,{left:this._editBoxLeft+d.delta.x+"px",top:this._editBoxTop+d.delta.y+"px"})});this._moveBoxStartHandler=this._map.on("pan-start",function(){this._editBoxLeft=parseFloat(D.get(f,"left"));this._editBoxTop=parseFloat(D.get(f,"top"))});this.onEditStart(w,this._editBox);this._toolbar.onTextEditStart(w,
this._editBox)}},_removeTextBox:function(){this._editBoxBlurHandler&&(l.disconnect(this._editBoxBlurHandler),this._editBoxBlurHandler=null);this._editBox&&(this._editBox.parentNode.removeChild(this._editBox),this._editBox=null);this._disableBoxHandler&&(this._disableBoxHandler.remove(),this._disableBoxHandler=null);this._moveBoxHandler&&(this._moveBoxHandler.remove(),this._moveBoxHandler=null);this._moveBoxStartHandler&&(this._moveBoxStartHandler.remove(),this._moveBoxStartHandler=null);this._editBoxKeyHandler&&
(l.disconnect(this._editBoxKeyHandler),this._editBoxKeyHandler=null)},_createInputTextStyle:function(w,t){t=w.getDojoShape().getTransformedBoundingBox();var h=w.getLayer();h=h.hasLocalNavigationTransform()?{dx:0,dy:0}:h.getNavigationTransform();var a=w.symbol.font;return{"font-family":a.family,"font-size":a.size+"px","font-style":a.style,"font-variant":a.variant,"font-weight":a.weight,left:t[0].x+h.dx+"px",top:t[0].y+h.dy+"px",width:Math.abs(t[0].x-t[1].x)/Math.cos(w.symbol.angle/180*Math.PI)+"px"}},
_applyEdit:function(){if(this._editBox)if(this._editBox.value){this._graphic.show();var w=this._graphic.symbol;w.text=this._editBox.value;this._graphic.setSymbol(w)}else this._graphic.getLayer().remove(this._graphic)}});K("extend-esri")&&O.setObject("toolbars.TextEditor",C,k);return C})},"esri/toolbars/draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/window dojo/has dojo/sniff dojo/keys dojo/dom-construct dojo/dom-style dojo/dom-geometry ../kernel ../sniff ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/jsonUtils ../geometry/webMercatorUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/Rect dojo/i18n!../nls/jsapi".split(" "),
function(C,O,l,G,K,E,B,D,q,k,w,t,h,a,f,d,g,c,m,F,I,M,T,V,J,L){var aa=C(f,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(P,H){this.markerSymbol=new d(d.STYLE_SOLID,10,new g(g.STYLE_SOLID,new K([255,0,0]),2),new K([0,0,0,.25]));this.lineSymbol=new g(g.STYLE_SOLID,new K([255,0,0]),2);this.fillSymbol=new c(c.STYLE_SOLID,new g(g.STYLE_SOLID,new K([255,0,0]),2),new K([0,0,0,.25]));this._points=[];this._mouse=!B("esri-touch")&&!B("esri-pointer");
this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15};this._options=O.mixin(O.mixin({},this._defaultOptions),H||{});if(D("ios")||D("android"))this._options.showTooltips=!1;this._onKeyDownHandler=O.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=O.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=O.hitch(this,this._onMouseUpHandler);this._onClickHandler=O.hitch(this,this._onClickHandler);this._onMouseMoveHandler=O.hitch(this,this._onMouseMoveHandler);
this._onMouseDragHandler=O.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=O.hitch(this,this._onDblClickHandler);this._updateTooltip=O.hitch(this,this._updateTooltip);this._hideTooltip=O.hitch(this,this._hideTooltip);this._redrawGraphic=O.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(P){this.respectDrawingVertexOrder=P},setMarkerSymbol:function(P){this.markerSymbol=P},setLineSymbol:function(P){this.lineSymbol=P},
setFillSymbol:function(P){this.fillSymbol=P},activate:function(P,H){this._geometryType&&this.deactivate();var R=this.map,y=G.connect,Y=aa;this._options=O.mixin(O.mixin({},this._options),H||{});R.navigationManager.setImmediateClick(!1);switch(P){case Y.ARROW:case Y.LEFT_ARROW:case Y.RIGHT_ARROW:case Y.UP_ARROW:case Y.DOWN_ARROW:case Y.TRIANGLE:case Y.CIRCLE:case Y.ELLIPSE:case Y.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0);this._onClickHandler_connect=y(R,"onClick",this._onClickHandler);this._mouse?
(this._onMouseDownHandler_connect=y(R,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=y(R,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=y(R,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=y(R,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=y(R,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=y(R,"onMouseDragEnd",this._onMouseUpHandler));B("esri-touch")&&(this._onMouseDownHandler2_connect=
y(R,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=y(R,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=y(R,"onSwipeEnd",this._onMouseUpHandler));break;case Y.POINT:this._onClickHandler_connect=y(R,"onClick",this._onClickHandler);break;case Y.LINE:case Y.EXTENT:case Y.FREEHAND_POLYLINE:case Y.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0);this._mouse?(this._onMouseDownHandler_connect=y(R,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=
y(R,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=y(R,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=y(R,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=y(R,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=y(R,"onMouseDragEnd",this._onMouseUpHandler));B("esri-touch")&&(this._onMouseDownHandler2_connect=y(R,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=y(R,"onSwipeMove",
this._onMouseDragHandler),this._onMouseUpHandler2_connect=y(R,"onSwipeEnd",this._onMouseUpHandler));break;case Y.POLYLINE:case Y.POLYGON:case Y.MULTI_POINT:R.navigationManager.setImmediateClick(!0);this._onClickHandler_connect=y(R,"onClick",this._onClickHandler);this._onDblClickHandler_connect=y(R,"onDblClick",this._onDblClickHandler);this._dblClickZoom=R.isDoubleClickZoom;R.disableDoubleClickZoom();break;default:console.error("Unsupported geometry type: "+P);return}this._onKeyDown_connect=y(R,"onKeyDown",
this._onKeyDownHandler);this._redrawConnect=y(R,"onExtentChange",this._redrawGraphic);this._geometryType=P;this._toggleTooltip(!0);R.snappingManager&&"freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType&&(R.snappingManager._startSelectionLayerQuery(),R.snappingManager._setUpSnapping());this.onActivate(this._geometryType)},deactivate:function(){var P=this.map;this._clear();var H=G.disconnect;H(this._onMouseMoveHandler_connect);H(this._onMouseDownHandler_connect);H(this._onMouseDragHandler_connect);
H(this._onMouseUpHandler_connect);H(this._onMouseDownHandler2_connect);H(this._onMouseDragHandler2_connect);H(this._onMouseUpHandler2_connect);H(this._onClickHandler_connect);H(this._onDblClickHandler_connect);H(this._onKeyDown_connect);H(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=this._onMouseUpHandler2_connect=this._onClickHandler_connect=
this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;P.snappingManager&&(P.snappingManager._stopSelectionLayerQuery(),P.snappingManager._killOffSnapping());switch(this._geometryType){case aa.CIRCLE:case aa.ELLIPSE:case aa.TRIANGLE:case aa.ARROW:case aa.LEFT_ARROW:case aa.RIGHT_ARROW:case aa.UP_ARROW:case aa.DOWN_ARROW:case aa.RECTANGLE:case aa.LINE:case aa.EXTENT:case aa.FREEHAND_POLYLINE:case aa.FREEHAND_POLYGON:this._activateMapTools(!0,!1,!1,!0);break;case aa.POLYLINE:case aa.POLYGON:case aa.MULTI_POINT:this._dblClickZoom&&
P.enableDoubleClickZoom()}H=this._geometryType;this._geometryType=null;P.navigationManager.setImmediateClick(!1);this._toggleTooltip(!1);this.onDeactivate(H)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0);this._graphic=null;this.map.snappingManager&&this.map.snappingManager._setGraphic(null);this._points=[]},finishDrawing:function(){var P=this._points,H=this.map.spatialReference,R=aa;P=P.slice(0,P.length);switch(this._geometryType){case R.POLYLINE:if(!this._graphic||
2>P.length)return;var y=new M(H);y.addPath([].concat(P));break;case R.POLYGON:if(!this._graphic||3>P.length)return;y=new T(H);P=[].concat(P,[P[0].offset(0,0)]);T.prototype.isClockwise(P)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),P.reverse());y.addRing(P);break;case R.MULTI_POINT:y=new V(H),l.forEach(P,function(Y){y.addPoint(Y)})}G.disconnect(this._onMouseMoveHandler_connect);this._clear();
this._setTooltipMessage(0);this._drawEnd(y)},_drawEnd:function(P){if(P){var H=this.map.spatialReference,R;this.onDrawEnd(P);H&&(H.isWebMercator()?R=I.webMercatorToGeographic(P,!0):4326===H.wkid&&(R=F.fromJson(P.toJson())));this.onDrawComplete({geometry:P,geographicGeometry:R})}},_normalizeRect:function(P,H,R){var y=P.x;P=P.y;var Y=H.x;H=H.y;return{x:Math.min(y,Y),y:Math.max(P,H),width:Math.abs(y-Y),height:Math.abs(P-H),spatialReference:R}},_onMouseDownHandler:function(P){this._dragged=!1;if(this.map.snappingManager)var H=
this.map.snappingManager._snappingPoint;var R=H||P.mapPoint,y=aa;H=this.map;var Y=H.spatialReference;this._points.push(R.offset(0,0));switch(this._geometryType){case y.LINE:this._graphic=H.graphics.add(new m(new M({paths:[[[R.x,R.y],[R.x,R.y]]],spatialReference:Y}),this.lineSymbol),!0);H.snappingManager&&H.snappingManager._setGraphic(this._graphic);break;case y.FREEHAND_POLYLINE:this._oldPoint=P.screenPoint;R=new M(Y);R.addPath(this._points);this._graphic=H.graphics.add(new m(R,this.lineSymbol),!0);
H.snappingManager&&H.snappingManager._setGraphic(this._graphic);break;case y.CIRCLE:case y.ELLIPSE:case y.TRIANGLE:case y.ARROW:case y.LEFT_ARROW:case y.RIGHT_ARROW:case y.UP_ARROW:case y.DOWN_ARROW:case y.RECTANGLE:case y.FREEHAND_POLYGON:this._oldPoint=P.screenPoint,R=new T(Y),R.addRing(this._points),this._graphic=H.graphics.add(new m(R,this.fillSymbol),!0),H.snappingManager&&H.snappingManager._setGraphic(this._graphic)}B("esri-touch")&&P.preventDefault();if(1===this._points.length)this.onDrawStart()},
_onMouseMoveHandler:function(P){if(this.map.snappingManager)var H=this.map.snappingManager._snappingPoint;P=H||P.mapPoint;H=this._graphic.geometry;switch(this._geometryType){case aa.POLYLINE:case aa.POLYGON:var R=this._points.length,y=!!H.getPoint(0,R);P=P.offset(0,0);y?H.setPoint(0,R,P):H.insertPoint(0,R,P);this._graphic.setGeometry(H)}},_onMouseDragHandler:function(P){if(this._graphic||this._points.length)if(B("esri-touch")&&!this._points.length)P.preventDefault();else{this._dragged=!0;if(this.map.snappingManager)var H=
this.map.snappingManager._snappingPoint;var R=this._points[0],y=H||P.mapPoint,Y=this.map,da=Y.spatialReference;H=this._graphic;var z=aa,v=Y.toScreen(R),u=Y.toScreen(y),Q=[];Q=u.x-v.x;u=u.y-v.y;var fa=Math.sqrt(Q*Q+u*u);switch(this._geometryType){case z.CIRCLE:this._hideTooltip();H.geometry=T.createCircle({center:v,r:fa,numberOfPoints:60,map:Y});H.setGeometry(H.geometry);break;case z.ELLIPSE:this._hideTooltip();H.geometry=T.createEllipse({center:v,longAxis:Q,shortAxis:u,numberOfPoints:60,map:Y});H.setGeometry(H.geometry);
break;case z.TRIANGLE:this._hideTooltip();Q=[[0,-fa],[.8660254037844386*fa,.5*fa],[-.8660254037844386*fa,.5*fa],[0,-fa]];H.geometry=this._toPolygon(Q,v.x,v.y);H.setGeometry(H.geometry);break;case z.ARROW:this._hideTooltip();R=u/fa;Y=Q/fa;y=.25*Y*fa;da=.25*fa/(u/Q);fa*=.25*R;Q=[[Q,u],[Q-y*(1+24/da),u+24*Y-fa],[Q-y*(1+12/da),u+12*Y-fa],[-12*R,12*Y],[12*R,-12*Y],[Q-y*(1-12/da),u-12*Y-fa],[Q-y*(1-24/da),u-24*Y-fa],[Q,u]];H.geometry=this._toPolygon(Q,v.x,v.y);H.setGeometry(H.geometry);break;case z.LEFT_ARROW:this._hideTooltip();
Q=0>=Q?[[Q,0],[.75*Q,u],[.75*Q,.5*u],[0,.5*u],[0,-.5*u],[.75*Q,-.5*u],[.75*Q,-u],[Q,0]]:[[0,0],[.25*Q,u],[.25*Q,.5*u],[Q,.5*u],[Q,-.5*u],[.25*Q,-.5*u],[.25*Q,-u],[0,0]];H.geometry=this._toPolygon(Q,v.x,v.y);H.setGeometry(H.geometry);break;case z.RIGHT_ARROW:this._hideTooltip();Q=0<=Q?[[Q,0],[.75*Q,u],[.75*Q,.5*u],[0,.5*u],[0,-.5*u],[.75*Q,-.5*u],[.75*Q,-u],[Q,0]]:[[0,0],[.25*Q,u],[.25*Q,.5*u],[Q,.5*u],[Q,-.5*u],[.25*Q,-.5*u],[.25*Q,-u],[0,0]];H.geometry=this._toPolygon(Q,v.x,v.y);H.setGeometry(H.geometry);
break;case z.UP_ARROW:this._hideTooltip();Q=0>=u?[[0,u],[-Q,.75*u],[-.5*Q,.75*u],[-.5*Q,0],[.5*Q,0],[.5*Q,.75*u],[Q,.75*u],[0,u]]:[[0,0],[-Q,.25*u],[-.5*Q,.25*u],[-.5*Q,u],[.5*Q,u],[.5*Q,.25*u],[Q,.25*u],[0,0]];H.geometry=this._toPolygon(Q,v.x,v.y);H.setGeometry(H.geometry);break;case z.DOWN_ARROW:this._hideTooltip();Q=0<=u?[[0,u],[-Q,.75*u],[-.5*Q,.75*u],[-.5*Q,0],[.5*Q,0],[.5*Q,.75*u],[Q,.75*u],[0,u]]:[[0,0],[-Q,.25*u],[-.5*Q,.25*u],[-.5*Q,u],[.5*Q,u],[.5*Q,.25*u],[Q,.25*u],[0,0]];H.geometry=this._toPolygon(Q,
v.x,v.y);H.setGeometry(H.geometry);break;case z.RECTANGLE:this._hideTooltip();Q=[[0,0],[Q,0],[Q,u],[0,u],[0,0]];H.geometry=this._toPolygon(Q,v.x,v.y);H.setGeometry(H.geometry);break;case z.LINE:H.setGeometry(O.mixin(H.geometry,{paths:[[[R.x,R.y],[y.x,y.y]]]}));break;case z.EXTENT:H&&Y.graphics.remove(H,!0);H=new J(this._normalizeRect(R,y,da));H._originOnly=!0;this._graphic=Y.graphics.add(new m(H,this.fillSymbol),!0);Y.snappingManager&&Y.snappingManager._setGraphic(this._graphic);break;case z.FREEHAND_POLYLINE:this._hideTooltip();
if(!1===this._canDrawFreehandPoint(P)){B("esri-touch")&&P.preventDefault();return}this._points.push(P.mapPoint.offset(0,0));H.geometry._insertPoints([y.offset(0,0)],0);H.setGeometry(H.geometry);break;case z.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(P)){B("esri-touch")&&P.preventDefault();return}this._points.push(P.mapPoint.offset(0,0));H.geometry._insertPoints([y.offset(0,0)],0);H.setGeometry(H.geometry)}B("esri-touch")&&P.preventDefault()}},_canDrawFreehandPoint:function(P){if(!this._oldPoint)return!1;
var H=this._oldPoint.x-P.screenPoint.x,R=this._oldPoint.y-P.screenPoint.y,y=this._options.tolerance;if((0>H?-1*H:H)<y&&(0>R?-1*R:R)<y)return!1;H=new Date;if(H-this._startTime<this._options.drawTime)return!1;this._startTime=H;this._oldPoint=P.screenPoint;return!0},_onMouseUpHandler:function(P){if(this._dragged&&this._graphic){0===this._points.length&&this._points.push(P.mapPoint.offset(0,0));if(this.map.snappingManager)var H=this.map.snappingManager._snappingPoint;var R=this._points[0];H=H||P.mapPoint;
var y=this.map.spatialReference,Y=aa;switch(this._geometryType){case Y.CIRCLE:case Y.ELLIPSE:case Y.TRIANGLE:case Y.ARROW:case Y.LEFT_ARROW:case Y.RIGHT_ARROW:case Y.UP_ARROW:case Y.DOWN_ARROW:case Y.RECTANGLE:var da=this._graphic.geometry;break;case Y.LINE:da=new M({paths:[[[R.x,R.y],[H.x,H.y]]],spatialReference:y});break;case Y.EXTENT:da=(new J(this._normalizeRect(R,H,y))).getExtent();break;case Y.FREEHAND_POLYLINE:da=new M(y);da.addPath([].concat(this._points,[H.offset(0,0)]));break;case Y.FREEHAND_POLYGON:da=
new T(y),R=[].concat(this._points,[H.offset(0,0),this._points[0].offset(0,0)]),T.prototype.isClockwise(R)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),R.reverse()),da.addRing(R)}B("esri-touch")&&P.preventDefault();this._clear();this._drawEnd(da)}else this._clear()},_isPointToPointTool:function(P){switch(P){case aa.POLYLINE:case aa.POLYGON:case aa.MULTI_POINT:return!0;default:return!1}},_onClickHandler:function(P){if(this.map.snappingManager)var H=
this.map.snappingManager._snappingPoint;H=H||P.mapPoint;P=this.map;var R=P.toScreen(H),y=aa;if(this._isPointToPointTool(this._geometryType)){var Y=this._points[this._points.length-1];if(H&&Y&&H.x===Y.x&&H.y===Y.y)return;this._points.push(H.offset(0,0))}switch(this._geometryType){case y.POINT:this.onDrawStart();this._drawEnd(H.offset(0,0));this._setTooltipMessage(0);break;case y.POLYLINE:1===this._points.length?(H=new M(P.spatialReference),H.addPath(this._points),this._graphic=P.graphics.add(new m(H,
this.lineSymbol),!0),P.snappingManager&&P.snappingManager._setGraphic(this._graphic,{snapToLastVertex:!1}),this._onMouseMoveHandler_connect=G.connect(P,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry.setPoint(0,this._points.length-1,H.offset(0,0)),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol));break;case y.POLYGON:1===this._points.length?(H=new T(P.spatialReference),H.addRing(this._points),this._graphic=P.graphics.add(new m(H,this.fillSymbol),
!0),P.snappingManager&&P.snappingManager._setGraphic(this._graphic,{snapToLastVertex:!1}),this._onMouseMoveHandler_connect=G.connect(P,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry.setPoint(0,this._points.length-1,H.offset(0,0)),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol));break;case y.MULTI_POINT:H=this._points;1===H.length?(R=new V(P.spatialReference),R.addPoint(H[H.length-1]),this._graphic=P.graphics.add(new m(R,this.markerSymbol),
!0),P.snappingManager&&P.snappingManager._setGraphic(this._graphic),this.onDrawStart()):(this._graphic.geometry.addPoint(H[H.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));break;case y.ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],R.x,R.y);break;case y.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],R.x,R.y);break;case y.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,
12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],R.x,R.y);break;case y.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],R.x,R.y);break;case y.DOWN_ARROW:this._addShape([[0,0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],R.x,R.y);break;case y.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],R.x,R.y);break;case y.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],R.x-48,R.y+48);break;case y.CIRCLE:this._clear();
this.onDrawStart();this._drawEnd(T.createCircle({center:R,r:48,numberOfPoints:60,map:P}));break;case y.ELLIPSE:this._clear(),this.onDrawStart(),this._drawEnd(T.createEllipse({center:R,longAxis:48,shortAxis:24,numberOfPoints:60,map:P}))}this._setTooltipMessage(this._points.length)},_addShape:function(P,H,R){this._setTooltipMessage(0);this._clear();this.onDrawStart();this._drawEnd(this._toPolygon(P,H,R))},_toPolygon:function(P,H,R){var y=this.map,Y=new T(y.spatialReference);Y.addRing(l.map(P,function(da){return y.toMap({x:da[0]+
H,y:da[1]+R})}));return Y},_onDblClickHandler:function(P){var H=this._points,R=this.map.spatialReference,y=aa;B("esri-touch")&&H.push(P.mapPoint);var Y=H[H.length-1],da=H[H.length-2];H=Y&&da&&Y.x===da.x&&Y.y===da.y?H.slice(0,H.length-1):H.slice(0,H.length);switch(this._geometryType){case y.POLYLINE:if(!this._graphic||2>H.length){G.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(P);return}var z=new M(R);z.addPath([].concat(H));break;case y.POLYGON:if(!this._graphic||
3>H.length)return;z=new T(R);P=[].concat(H,[H[0].offset(0,0)]);T.prototype.isClockwise(P)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),P.reverse());z.addRing(P);break;case y.MULTI_POINT:z=new V(R),l.forEach(H,function(v){z.addPoint(v)})}G.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(z)},_onKeyDownHandler:function(P){P.keyCode===q.ESCAPE&&
(G.disconnect(this._onMouseMoveHandler_connect),this._clear(),this._setTooltipMessage(0))},_toggleTooltip:function(P){this._options.showTooltips&&(P?this._tooltip||(this._tooltip=k.create("div",{"class":"esriMapTooltip"},this.map.container),t.isBodyLtr()||w.set(this._tooltip,"direction","rtl"),this._tooltip.style.display="none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=G.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=
G.connect(this.map,"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=G.connect(this.map,"onMouseMove",this._updateTooltip)):this._tooltip&&(G.disconnect(this._onTooltipMouseEnterHandler_connect),G.disconnect(this._onTooltipMouseLeaveHandler_connect),G.disconnect(this._onTooltipMouseMoveHandler_connect),k.destroy(this._tooltip),this._tooltip=null))},_hideTooltip:function(){var P=this._tooltip;P&&(P.style.display="none")},_setTooltipMessage:function(P){var H=this._tooltip;if(H){var R=
"";switch(this._geometryType){case aa.POINT:R=L.toolbars.draw.addPoint;break;case aa.ARROW:case aa.LEFT_ARROW:case aa.RIGHT_ARROW:case aa.UP_ARROW:case aa.DOWN_ARROW:case aa.TRIANGLE:case aa.RECTANGLE:case aa.CIRCLE:case aa.ELLIPSE:R=L.toolbars.draw.addShape;break;case aa.LINE:case aa.EXTENT:case aa.FREEHAND_POLYLINE:case aa.FREEHAND_POLYGON:R=L.toolbars.draw.freehand;break;case aa.POLYLINE:case aa.POLYGON:R=L.toolbars.draw.start;1===P?R=L.toolbars.draw.resume:2<=P&&(R=L.toolbars.draw.complete);break;
case aa.MULTI_POINT:R=L.toolbars.draw.addMultipoint,1<=P&&(R=L.toolbars.draw.finish)}H.innerHTML=R}},_updateTooltip:function(P){var H=this._tooltip;if(H){if(P.clientX||P.pageY){var R=P.clientX;P=P.clientY}else R=P.clientX+E.body().scrollLeft-E.body().clientLeft,P=P.clientY+E.body().scrollTop-E.body().clientTop;H.style.display="none";w.set(H,{left:R+this._options.tooltipOffset+"px",top:P+"px"});H.style.display=""}},_redrawGraphic:function(P,H,R,y){(R||this.map.wrapAround180)&&(P=this._graphic)&&P.setGeometry(P.geometry)},
onActivate:function(){},onDeactivate:function(){},onDrawComplete:function(){},onDrawStart:function(){},onDrawEnd:function(){}});O.mixin(aa,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});B("extend-esri")&&
O.setObject("toolbars.Draw",aa,h);return aa})},"esri/tasks/ProjectParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(C,O,l,G,K,E,B,D){C=C(null,{declaredClass:"esri.tasks.ProjectParameters",geometries:null,outSR:null,transformation:null,transformForward:null,toJson:function(){var q=l.map(this.geometries,function(w){return w.toJson()}),k={};k.outSR=this.outSR.wkid||G.toJson(this.outSR.toJson());
k.inSR=this.geometries[0].spatialReference.wkid||G.toJson(this.geometries[0].spatialReference.toJson());k.geometries=G.toJson({geometryType:D.getJsonType(this.geometries[0]),geometries:q});this.transformation&&(k.transformation=this.transformation.wkid||G.toJson(this.transformation));B.isDefined(this.transformForward)&&(k.transformForward=this.transformForward);return k}});K("extend-esri")&&O.setObject("tasks.ProjectParameters",C,E);return C})},"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',
"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/templates/Calendar.html":'\x3cdiv class\x3d"dijitCalendarContainer dijitInline" role\x3d"presentation" aria-labelledby\x3d"${id}_mddb ${id}_year"\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarMonthContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarDecrementArrow\' data-dojo-attach-point\x3d"decrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarDecrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"decreaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e-\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d\'dijitReset dijitCalendarArrow dijitCalendarIncrementArrow\' data-dojo-attach-point\x3d"incrementMonth"\x3e\r\n\t\t\t\x3cimg src\x3d"${_blankGif}" alt\x3d"" class\x3d"dijitCalendarIncrementControl dijitCalendarIncrease" role\x3d"presentation"/\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"increaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e+\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-attach-point\x3d"monthNode" class\x3d"dijitInline"\x3e\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\t\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" role\x3d"grid" data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\t\x3cthead\x3e\r\n\t\t\t\x3ctr role\x3d"row"\x3e\r\n\t\t\t\t${!dayCellsHtml}\r\n\t\t\t\x3c/tr\x3e\r\n\t\t\x3c/thead\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"dateRowsNode" data-dojo-attach-event\x3d"ondijitclick: _onDayClick" class\x3d"dijitReset dijitCalendarBodyContainer"\x3e\r\n\t\t\t\t${!dateRowsHtml}\r\n\t\t\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\t\x3cdiv class\x3d"dijitReset dijitCalendarYearContainer" role\x3d"presentation"\x3e\r\n\t\t\x3cdiv class\x3d"dijitCalendarYearLabel"\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"previousYearLabelNode" class\x3d"dijitInline dijitCalendarPreviousYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"currentYearLabelNode" class\x3d"dijitInline dijitCalendarSelectedYear" role\x3d"button" id\x3d"${id}_year"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan data-dojo-attach-point\x3d"nextYearLabelNode" class\x3d"dijitInline dijitCalendarNextYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\x3c/div\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:esri/dijit/templates/Directions.html":'\x3cdiv class\x3d"${options.theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_widgetContainer" class\x3d"${_css.widgetContainerClass}" role\x3d"presentation"\x3e\r\n        \x3cdiv class\x3d"${_css.stopsContainerClass}" role\x3d"presentation"\x3e\r\n            \x3cdiv id\x3d"search-source-container" class\x3d"${_css.searchSourceContainerClass}" data-dojo-attach-point\x3d"_searchSourceContainerNode"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_searchSourceSelectorContainer"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsTableContainerClass}"\x3e\r\n                \x3ctable class\x3d"${_css.stopsClass}" data-dojo-attach-point\x3d"_dndNode"\x3e\x3c/table\x3e\r\n                \x3cdiv class\x3d"${_css.stopsTableCoverClass}" data-dojo-attach-point\x3d"_stopsTableCover"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsButtonContainerClass}"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsAddDestinationClass}"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_activateButtonNode" title\x3d"${_i18n.widgets.directions.activate}" class\x3d"${_css.activateButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsPressedButtonClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_lineBarrierButtonNode" title\x3d"${_i18n.widgets.directions.lineBarrier}" class\x3d"${_css.lineBarrierButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true"\x3e\x3c/div\x3e\r\n                    \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"${_css.linkButtonClass} ${_css.stopsAddDestinationBtnClass}" data-dojo-attach-point\x3d"_addDestinationNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.addDestination}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.travelModesContainerClass}" data-dojo-attach-point\x3d"_travelModeContainerNode"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_travelModeSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} startTimeMenuButton" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_startTimeButtonNodeContainer"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_startTimeButtonNode"\x3e\r\n                        \x3cspan data-dojo-attach-point\x3d"_startTimeButtonLabel"\x3e${_i18n.widgets.directions.leaveNow}\x3c/span\x3e\r\n                        \x3cdiv data-dojo-attach-point\x3d"_startTimeDDLArrow" class\x3d"esriDirectionsDDLArrow"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"startTimeMenu" data-dojo-attach-point\x3d"_startTimeMenu"\x3e\r\n                        \x3cul role\x3d"menu"\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuLeaveNow" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio" aria-checked\x3d"true"\x3e${_i18n.widgets.directions.leaveNow}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuDepartAt" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.departAt}\x3c/li\x3e\r\n                            \x3cli data-dojo-attach-point\x3d"_startTimeMenuNone" tabindex\x3d"0" class\x3d"esriRouteZoom startTimeMenuItem" role\x3d"menuitemradio"\x3e${_i18n.widgets.directions.noStartTime}\x3c/li\x3e\r\n                        \x3c/ul\x3e\r\n                    \x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsOptionsButtonClass}" data-dojo-attach-point\x3d"_optionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.showOptions}\x3c/div\x3e\r\n            \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3cdiv class\x3d"departAtContainer" data-dojo-attach-point\x3d"_departAtContainer"\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtTime" data-dojo-attach-point\x3d"_departAtTimeContainer"\x3e\x3c/div\x3e\r\n                    \x3cdiv id\x3d"${id}_directionsDepartAtDate" data-dojo-attach-point\x3d"_departAtDateContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass}" data-dojo-attach-point\x3d"_optionsMenuNode"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsCheckboxesClass}"\x3e\r\n                    \x3cul\x3e\r\n                        \x3cli class\x3d"${_css.stopsFindOptimalOrderClass}" data-dojo-attach-point\x3d"_findOptimalOrderItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_findOptimalOrderNode" type\x3d"checkbox" id\x3d"${id}_find_optimal_order" /\x3e\x3clabel for\x3d"${id}_find_optimal_order"\x3e${_i18n.widgets.directions.findOptimalOrder}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsReturnToStartClass}" data-dojo-attach-point\x3d"_returnToStartItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_returnToStartNode" type\x3d"checkbox" id\x3d"${id}_stopsReturnToStart" /\x3e\x3clabel for\x3d"${id}_stopsReturnToStart"\x3e${_i18n.widgets.directions.returnToStart}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsUseTrafficClass}" data-dojo-attach-point\x3d"_useTrafficItemNode" title\x3d"${_i18n.widgets.directions.trafficLabelLive}"\x3e\r\n                            \x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_useTrafficNode" type\x3d"checkbox" id\x3d"${id}_stopsUseTraffic" /\x3e\x3clabel for\x3d"${id}_stopsUseTraffic"\x3e${_i18n.widgets.directions.useTraffic}\x3c/label\x3e\r\n                            \x3ca data-dojo-attach-point\x3d"_trafficAvailabilityButton" style\x3d"display: none;" href\x3d"http://www.arcgis.com/home/item.html?id\x3db7a893e8e1e04311bd925ea25cb8d7c7" target\x3d"_blank"\x3e\x3cdiv class\x3d"esriTrafficAvailabilityButton" title\x3d"${_i18n.widgets.directions.seeTrafficAvailability}"\x3e\x3c/div\x3e\x3c/a\x3e\r\n                        \x3c/li\x3e\r\n                    \x3c/ul\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsToggleContainerClass}"\x3e\r\n                    \x3cdiv class\x3d"${_css.stopsOptionsUnitsContainerClass}"  data-dojo-attach-point\x3d"_agolDistanceUnitsNode"\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsMiClass} ${_css.stopsButtonClass}" data-dojo-attach-point\x3d"_useMilesNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriMiles.abbr}\x3c/div\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsKmClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabLastClass} ${_css.stopsPressedButtonClass}" data-dojo-attach-point\x3d"_useKilometersNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.units.esriKilometers.abbr}\x3c/div\x3e\r\n                        \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsGetDirectionsContainerClass}"\x3e\r\n                \x3cdiv class\x3d"getDirectionsBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} ${_css.stopsGetDirectionsClass} esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_getDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.getDirections}\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsClearDirectionsClass}" data-dojo-attach-point\x3d"_clearDirectionsButtonNode" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.clearDirections}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"savePrintBtnContainer" data-dojo-attach-point\x3d"_savePrintBtnContainer"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsSaveClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_saveMenuButton" title\x3d"${_i18n.widgets.directions.saveTitle}" \x3e\x3c/div\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.resultsPrintClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-blur-on-click\x3d"true" data-dojo-attach-point\x3d"_printButton" title\x3d"${_i18n.widgets.directions.print}" \x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass} esriSaveContainer" data-dojo-attach-point\x3d"_saveMenuNode"\x3e\r\n                \x3cdiv class\x3d"esriLayerNameLabel"\x3e${_i18n.widgets.directions.layerName}\x3c/div\x3e\r\n                \x3cinput type\x3d"text" data-dojo-attach-point\x3d"_outputLayerContainer"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_folderSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} esriSaveButton esriDisabledDirectionsButton" data-dojo-attach-point\x3d"_saveButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.save}\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"esriLinkButton esriSaveAsButton" data-dojo-attach-point\x3d"_saveAsButton" data-blur-on-click\x3d"true"\x3e${_i18n.widgets.directions.saveAs}\x3c/div\x3e\r\n            \x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n    \t\x3cdiv data-dojo-attach-point\x3d"_msgNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" role\x3d"presentation"\x3e\r\n        \t\x3cdiv class\x3d"${_css.routesContainerClass}" data-dojo-attach-point\x3d"_resultsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/Search/templates/Search.html":'\x3cdiv role\x3d"presentation" class\x3d"${theme}"\x3e\r\n  \x3cdiv role\x3d"presentation" class\x3d"${css.searchGroup}" data-dojo-attach-point\x3d"containerNode"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"expandNode" class\x3d"${css.searchExpandContainer}"\x3e\r\n      \x3cdiv class\x3d"${css.searchAnimateContainer}"\x3e\r\n        \x3cdiv role\x3d"button" title\x3d"${_i18n.widgets.Search.main.searchIn}" id\x3d"${id}_menu_button" class\x3d"${css.searchBtn} ${css.searchToggle}" tabindex\x3d"0" data-dojo-attach-point\x3d"sourcesBtnNode"\x3e\r\n          \x3cspan aria-hidden\x3d"true" role\x3d"presentation" class\x3d"${css.searchToggleIcon}"\x3e\x3c/span\x3e\x3cspan class\x3d"${css.searchSourceName}" data-dojo-attach-point\x3d"sourceNameNode"\x3e\x3c/span\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"${css.searchInputGroup}"\x3e\r\n          \x3cform data-dojo-attach-point\x3d"formNode"\x3e\r\n            \x3cinput maxlength\x3d"${maxLength}" autocomplete\x3d"off" type\x3d"text" tabindex\x3d"0" class\x3d"${css.searchInput}" value\x3d"${value}" aria-haspopup\x3d"true" id\x3d"${id}_input" data-dojo-attach-point\x3d"inputNode" role\x3d"textbox"\x3e\r\n          \x3c/form\x3e\r\n          \x3cdiv role\x3d"button" class\x3d"${css.searchClear}" tabindex\x3d"0" data-dojo-attach-point\x3d"clearNode"\x3e\x3cspan aria-hidden\x3d"true" class\x3d"${css.searchClearIcon}"\x3e\x3c/span\x3e\x3cspan aria-hidden\x3d"true" class\x3d"${css.searchSpinner}"\x3e\x3c/span\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"suggestionsNode" class\x3d"${css.searchMenu} ${css.suggestionsMenu}"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv role\x3d"button" title\x3d"${_i18n.widgets.Search.main.searchButtonTitle}" class\x3d"${css.searchBtn} ${css.searchSubmit}" tabindex\x3d"0" data-dojo-attach-point\x3d"submitNode"\x3e\r\n      \x3cspan aria-hidden\x3d"true" role\x3d"presentation" class\x3d"${css.searchIcon}"\x3e\x3c/span\x3e\r\n      \x3cspan class\x3d"${css.searchButtonText}"\x3e${_i18n.widgets.Search.main.searchButtonTitle}\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"sourcesNode" class\x3d"${css.searchMenu} ${css.sourcesMenu}"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"noResultsMenuNode" class\x3d"${css.searchMenu} ${css.searchNoResultsMenu}"\x3e\x3c/div\x3e\r\n    \x3cdiv class\x3d"${css.searchClearFloat}"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"*noref":1}});
define("esri/dijit/Directions","require dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/array dojo/_base/Color dijit/a11yclick dijit/_TemplatedMixin dijit/form/Select dijit/form/ValidationTextBox dijit/form/DateTextBox dijit/form/TimeTextBox dojo/store/Memory dojo/data/ObjectStore dojo/keys dojo/has dojo/on dojo/mouse dojo/dom dojo/dom-geometry dojo/dom-style dojo/dom-class dojo/dom-attr dojo/query dojo/number dojo/i18n!../nls/jsapi dojo/text!./templates/Directions.html ./Search dojo/dom-construct dojo/promise/all dojo/Deferred dojo/dnd/Source dojo/json ../kernel ../urlUtils ../graphic ../units ../TimeExtent ../InfoTemplate ../SpatialReference ../layers/ArcGISDynamicMapServiceLayer ../layers/GraphicsLayer ../geometry/webMercatorUtils ../geometry/geodesicUtils ../arcgis/utils ../geometry/Point ../geometry/Extent ../geometry/Polyline ../geometry/mathUtils ../symbols/SimpleMarkerSymbol ../symbols/PictureMarkerSymbol ../symbols/CartographicLineSymbol ../symbols/TextSymbol ../renderers/UniqueValueRenderer ../symbols/Font ./_EventedWidget ../tasks/FeatureSet ../tasks/RouteTask ../tasks/RouteParameters ../tasks/GeometryService ../tasks/DistanceParameters ../tasks/PrintTask ../tasks/PrintParameters ../tasks/PrintTemplate ../toolbars/edit ../toolbars/draw ../config ../tasks/ProjectParameters dojo/uacss".split(" "),function(C,
O,l,G,K,E,B,D,q,k,w,t,h,a,f,d,g,c,m,F,I,M,T,V,J,L,aa,P,H,R,y,Y,da,z,v,u,Q,fa,ea,ka,qa,pa,xa,ya,Ea,n,N,W,U,ca,ja,oa,Aa,ra,wa,la,ua,Ia,Ka,Ba,Pa,Sa,Va,fb,Ya,Za,gb,$a){var Ta=v.getProtocolForWebResource(),ab=P.createSubclass({_setSourcesAttr:function(b){b&&(b=b.map(function(e){e.locator&&null==e.locationType&&(e=l.mixin({locationType:"street"},e));return e}));this.inherited(arguments,[b])}});O=O("esri.dijit.Directions",[la,D],{templateString:aa,mapClickActive:!1,barrierToolActive:!1,_eventMap:{activate:!0,
deactivate:!1,load:!0,"directions-start":!0,"directions-finish":["result"],"directions-clear":!0,"segment-select":["graphic"],"segment-highlight":["graphic"],error:["error"],"stops-update":["stops"],"route-item-created":!0,"route-item-updated":!0,"feature-collection-created":!0},_emptyStop:{name:""},constructor:function(b,e){if(!b.map)throw Error('Required "map" parameter is missing. Cannot instantiate Directions Widget.');if(!e)throw Error('Required "srcNodeRef" parameter is missing. Cannot instantiate Directions Widget.');
this._i18n=L;this._css={widgetContainerClass:"esriDirectionsContainer",searchSourceContainerClass:"esriSearchSourceContainer",stopsContainerClass:"esriStopsContainer",stopsTableContainerClass:"esriStopsTableContainer",stopsTableCoverClass:"esriStopsTableCover",reverseStopsClass:"esriStopsReverse",addStopsClass:"esriStopsAdd",stopsClass:"esriStops",stopsRemovableClass:"esriStopsRemovable",stopsButtonContainerClass:"esriStopsButtons",stopsOptionsButtonClass:"esriStopsOptionsButton",stopsAddDestinationClass:"esriStopsAddDestination",
stopsAddDestinationBtnClass:"esriStopsAddDestinationBtn",stopsGetDirectionsContainerClass:"esriStopsGetDirectionsContainer",stopsGetDirectionsClass:"esriStopsGetDirections",stopsClearDirectionsClass:"esriStopsClearDirections",stopsInnerGeocoderClass:"esriInnerGeocoder",stopsOptionsOptionsEnabledClass:"esriStopsOptionsEnabled",stopsOptionsMenuClass:"esriStopsOptionsMenu",stopsFindOptimalOrderClass:"esriFindOptimalOrderOption",stopsUseTrafficClass:"esriUseTrafficOption",stopsReturnToStartClass:"esriReturnToStartOption",
stopsOptionsCheckboxesClass:"esriOptionsCheckboxes",stopsOptionsToggleContainerClass:"esriOptionsToggleContainer",stopsOptionsUnitsContainerClass:"esriOptionsUnitsContainer",stopsOptionsUnitsMiClass:"esriOptionsUnitsMi",stopsOptionsUnitsKmClass:"esriOptionsUnitsKm",stopsOptionsImpedanceContainerClass:"esriOptionsImpedanceContainer",stopsOptionsImpedanceTimeClass:"esriOptionsImpedanceTime",stopsOptionsImpedanceDistanceClass:"esriOptionsImpedanceDistance",stopClass:"esriStop",stopOriginClass:"esriStopOrigin",
stopDestinationClass:"esriStopDestination",stopUnreachedFirstOrLastClass:"esriStopUnreachedFirstOrLast",stopUnreachedClass:"esriStopUnreached",esriStopGeocoderColumnClass:"esriStopGeocoderColumn",esriStopReverseColumnClass:"esriStopReverseColumn",stopDnDHandleClass:"esriStopDnDHandle",stopDnDHandleClassHidden:"esriStopDnDHandleHidden",stopIconColumnClass:"esriStopIconColumn",stopIconClass:"esriStopIcon",stopIconRemoveColumnClass:"esriStopIconRemoveColumn",stopIconRemoveClass:"esriStopIconRemove",
stopIconRemoveClassHidden:"esriStopIconRemoveHidden",resultsContainerClass:"esriResultsContainer",resultsLoadingClass:"esriResultsLoading",resultsPrintClass:"esriResultsPrint",resultsSaveClass:"esriResultsSave",resultsSummaryClass:"esriResultsSummary",routesContainerClass:"esriRoutesContainer",routesClass:"esriRoutes",routesErrorClass:"esriRoutesError",routesInfoClass:"esriRoutesInfo",routeClass:"esriRoute",routeTextColumnClass:"esriRouteTextColumn",routeTextClass:"esriRouteText",routeLengthClass:"esriRouteLength",
routeOriginClass:"esriDMTStopOrigin",routeDestinationClass:"esriDMTStopDestination",routeInfoClass:"esriRouteInfo",routeIconColumnClass:"esriRouteIconColumn",routeIconClass:"esriRouteIcon",infoWindowRouteClass:"esriInfoWindowRoute",routeZoomClass:"esriRouteZoom",esriPrintPageClass:"esriPrintPage",esriPrintBarClass:"esriPrintBar",esriPrintButtonClass:"esriPrintButton",esriCloseButtonClass:"esriCloseButton",esriPrintMainClass:"esriPrintMain",esriPrintHeaderClass:"esriPrintHeader",esriPrintLogoClass:"esriPrintLogo",
esriPrintMapClass:"esriPrintMap",esriPrintNameClass:"esriPrintName",esriPrintNotesClass:"esriPrintNotes",esriPrintLengthClass:"esriPrintLength",esriPrintDirectionsClass:"esriPrintDirections",esriPrintFooterClass:"esriPrintFooter",esriPrintStopLabelClass:"esriPrintStopLabel",clearClass:"esriClear",dndDragBodyClass:"esriDndDragDirection",stopsButtonClass:"esriDirectionsButton",stopsButtonTabClass:"esriDirectionsTabButton",stopsButtonTabLastClass:"esriDirectionsTabLastButton",stopsPressedButtonClass:"esriDirectionsPressedButton",
linkButtonClass:"esriLinkButton",activateButtonClass:"esriActivateButton",lineBarrierButtonClass:"esriLineBarrierButton",travelModesContainerClass:"esriTravelModesContainer"};this.options={map:null,autoSolve:!0,minStops:2,maxStops:20,theme:"simpleDirections",alphabet:"1234567890",directions:null,returnToStart:!1,optimalRoute:!1,routeTaskUrl:Ta+"//route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",printTaskUrl:Ta+"//utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task",
geometryTaskUrl:Ta+"//utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",routeParams:{},stops:["",""],searchOptions:{},stopsInfoTemplate:new ea(L.widgets.directions.stop,"${address}${error}"),waypointInfoTemplate:new ea(L.widgets.directions.maneuver,L.widgets.directions.waypoint),segmentInfoTemplate:new ea(L.widgets.directions.maneuver,'\x3cdiv class\x3d"${maneuverType}"\x3e\x3cdiv class\x3d"'+this._css.routeIconClass+" "+this._css.infoWindowRouteClass+'"\x3e\x3cstrong\x3e${step}.\x3c/strong\x3e ${formattedText}\x3c/div\x3e\x3c/div\x3e'),
textSymbolFont:new wa("11px",wa.STYLE_NORMAL,wa.VARIANT_NORMAL,wa.WEIGHT_NORMAL,"Arial, Helvetica, sans-serif"),textSymbolColor:new E([255,255,255]),textSymbolOffset:{x:0,y:10.875},fromSymbol:(new ja({url:C.toUrl("./images/Directions/greenPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),fromSymbolDrag:(new ja({url:C.toUrl("./images/Directions/greenPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbol:(new ja({url:C.toUrl("./images/Directions/bluePoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbolDrag:(new ja({url:C.toUrl("./images/Directions/bluePointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbol:(new ja({url:C.toUrl("./images/Directions/redPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbolDrag:(new ja({url:C.toUrl("./images/Directions/redPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbol:(new ja({url:C.toUrl("./images/Directions/grayPoint.png"),
height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbolDrag:(new ja({url:C.toUrl("./images/Directions/grayPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),waypointSymbol:new ca({color:[255,255,255,255],size:10,type:"esriSMS",style:"esriSMSCircle",outline:{color:[20,89,127,255],width:2.5,type:"esriSLS",style:"esriSLSSolid"}}),maneuverSymbol:new ca({color:[255,255,255,255],size:4,type:"esriSMS",style:"esriSMSCircle",outline:{color:[30,99,137,255],
width:1,type:"esriSLS",style:"esriSLSSolid"}}),routeSymbol:(new oa).setColor(new E([20,89,127,.75])).setWidth(10).setCap(oa.CAP_ROUND).setJoin(oa.JOIN_ROUND),segmentSymbol:(new oa).setColor(new E([255,255,255,1])).setWidth(6).setCap(oa.CAP_ROUND).setJoin(oa.JOIN_ROUND),barrierRenderer:new ra({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjIyIiBoZWlnaHQ9IjIyMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z181IiByeD0iMTAwIiByeT0iMTAwIi8+CjxlbGxpcHNlIGZpbGw9IiNmZjAwMDAiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSIyMCIgY3g9IjExMiIgY3k9IjExMSIgaWQ9InN2Z182IiByeD0iOTUiIHJ5PSI5NSIvPgo8cmVjdCBmaWxsPSIjZmYwMDAwIiBzdHJva2Utd2lkdGg9IjIwIiB4PSI2NC41IiB5PSIxMDIiIHdpZHRoPSI5NSIgaGVpZ2h0PSIxOCIgaWQ9InN2Z183IiBzdHJva2U9IiNmZmZmZmYiLz4KPC9nPgo8L3N2Zz4\x3d",
contentType:"image/svg+xml",width:18,height:18},uniqueValueInfos:[{value:"2",symbol:{type:"esriPMS",imageData:"PHN2ZyB3aWR0aD0iMjg2IiBoZWlnaHQ9IjI1NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGc+CjxwYXRoIGZpbGw9IiNmZmYiIHN0cm9rZS13aWR0aD0iMTAiIGQ9Im04Ljc0OTk5MiwyNTEuNzQ5OTk3bDEzNC45OTk5OTgsLTI0MS45OTk5OThsMTM0Ljk5OTk5OCwyNDEuOTk5OTk4bC0yNjkuOTk5OTk1LDBsLTAuMDAwMDAxLDB6IiBpZD0ic3ZnXzEiIHN0cm9rZT0iIzAwMCIvPgo8cGF0aCBzdHJva2U9IiNmZmYiIGZpbGw9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMTUiIGQ9Im0yMy41MDAwMDQsMjQyLjUwMDAwNWwxMTkuOTk5OTkyLC0yMTUuOTk5OTk5bDExOS45OTk5OTIsMjE1Ljk5OTk5OWwtMjM5Ljk5OTk4MywwbC0wLjAwMDAwMSwweiIgaWQ9InN2Z18yIi8+Cjx0ZXh0IGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjZmZmZmZmIiBzdHJva2U9IiNmZjAwMDAiIHN0cm9rZS13aWR0aD0iMCIgeD0iMTA5IiB5PSIyMjIuNzUiIGlkPSJzdmdfNSIgZm9udC1zaXplPSIxODAiIGZvbnQtZmFtaWx5PSJHZW9yZ2lhLCBUaW1lcywgJ1RpbWVzIE5ldyBSb21hbicsIHNlcmlmIiB0ZXh0LWFuY2hvcj0ic3RhcnQiIHhtbDpzcGFjZT0icHJlc2VydmUiPiE8L3RleHQ+CjwvZz4KPC9zdmc+",
contentType:"image/svg+xml",width:19,height:18}}]}),polylineBarrierRenderer:new ra({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,85,0,184],width:7.5,type:"esriSLS",style:"esriSLSSolid"}}]}),polygonBarrierRenderer:new ra({type:"uniqueValue",field1:"BarrierType",defaultSymbol:{color:[255,0,0,156],outline:{color:[255,0,0,153],width:2.4,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",
style:"esriSFSSolid"},uniqueValueInfos:[{value:"1",symbol:{color:[255,170,0,156],outline:{color:[255,0,0,153],width:7.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"}}]}),printPage:"",printTemplate:"",focusOnNewStop:!0,dragging:!0,canModifyStops:!0,canModifyWaypoints:!0,directionsLengthUnits:null,directionsLanguage:null,traffic:!1,trafficLayer:null,showPrintPage:!0,showSaveButton:!1,showSegmentPopup:!1,showSegmentHighlight:!0,showReverseStopsButton:!0,showReturnToStartOption:!0,
showOptimalRouteOption:!0,showTravelModesOption:!0,showMilesKilometersOption:!0,showClearButton:!1,showActivateButton:!0,showBarriersButton:!0,loaded:!1,routeLayer:{itemId:null,title:null,isItemOwner:!0,ownerFolder:null},startTime:"now"};this.userOptions=b;this.defaults=l.mixin({},this.options,b,{_waypointName:"DWWP",_userDefinedStopName:"UserDefinedStopName",_solveInProgress:!1,_moveInProgress:!1,_stopSequence:1E3});if(!this.defaults.minStops||2>this.defaults.minStops)this.defaults.minStops=2;if(2<
this.defaults.minStops&&this.defaults.stops&&","===this.defaults.stops.toString())for(b=2;b<this.defaults.minStops;b++)this.defaults.stops.splice(0,0,"");this.domNode=e},postCreate:function(){this.inherited(arguments);this.own(g(this._activateButtonNode,B,l.hitch(this,function(){this.mapClickActive?this.deactivate():this.activate()})));this.own(g(this._lineBarrierButtonNode,B,l.hitch(this,function(){this.barrierToolActive?this.deactivateBarrierTool():this.activateBarrierTool()})));this.own(g(this._addDestinationNode,
B,l.hitch(this,this._addStopButton)));this.own(g(this._optionsButtonNode,B,l.hitch(this,this._toggleOptionsMenu)));this.own(g(this._saveMenuButton,B,l.hitch(this,this._toggleSaveMenu)));this.own(g(this._saveButton,B,l.hitch(this,function(){this._saveButton._enabled&&this._storeRouteUI()})));this.own(g(this._saveAsButton,B,l.hitch(this,function(){l.mixin(this.routeLayer,{itemId:null,title:null,ownerFolder:null});this._storeRouteUI()})));this.own(g(this._findOptimalOrderNode,B,l.hitch(this,this._toggleCheckbox)));
this.own(g(this._returnToStartNode,B,l.hitch(this,this._toggleCheckbox)));this.own(g(this._useTrafficNode,B,l.hitch(this,this._toggleCheckbox)));this.own(g(this._useMilesNode,B,l.hitch(this,this._toggleUnits)));this.own(g(this._useKilometersNode,B,l.hitch(this,this._toggleUnits)));this.own(g(this._getDirectionsButtonNode,B,l.hitch(this,this.getDirections)));this.own(g(this._clearDirectionsButtonNode,B,l.hitch(this,function(){this.clearDirections()})));var b=l.hitch(this,function(){clearTimeout(this._startTimeMenu._hideTimer);
this._startTimeMenu._hideTimer=setTimeout(l.hitch(this,function(){I.set(this._startTimeMenu,"display","none")}),100)});this.own(g(this._startTimeButtonNode,B,l.hitch(this,function(){this._startTimeButtonNode.disabled||"block"===I.get(this._startTimeMenu,"display")?I.set(this._startTimeMenu,"display","none"):(I.set(this._startTimeMenu,"display","block"),this["now"===this.startTime?"_startTimeMenuLeaveNow":"none"===this.startTime?"_startTimeMenuNone":"_startTimeMenuDepartAt"].focus())})));this.own(g(this._startTimeMenuLeaveNow,
"blur",b));this.own(g(this._startTimeMenuDepartAt,"blur",b));this.own(g(this._startTimeMenuNone,"blur",b));this.own(g(this._startTimeMenuLeaveNow,"mousedown",l.hitch(this,function(){this.startTime="now";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(g(this._startTimeMenuDepartAt,"mousedown",l.hitch(this,function(){this.startTime=(new Date).getTime();this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this.own(g(this._startTimeMenuNone,"mousedown",l.hitch(this,function(){this.startTime=
"none";this._updateStartTimeUI();this._clearDisplayBeforeSolve()})));this._symbolEventPaddingDirections=(new oa).setColor(new E([0,255,0,0])).setWidth(20).setCap(oa.CAP_ROUND);this._stopLayer=new pa({id:"directions_stopLayer_"+this.id,displayOnPan:!0});this._routeLayer=new pa({id:"directions_routeLayer_"+this.id,displayOnPan:!0});this._waypointsEventLayer=new pa({id:"directions_waypointsEventLayer_"+this.id,displayOnPan:!0});this._barriersLayer=new pa({id:"directions_barriersLayer_"+this.id,displayOnPan:!0});
this._polylineBarriersLayer=new pa({id:"directions_polylineBarriersLayer_"+this.id,displayOnPan:!0});this._polygonBarriersLayer=new pa({id:"directions_polygonBarriersLayer_"+this.id,displayOnPan:!0});this._barriersLayer.setRenderer(this.defaults.barrierRenderer);this._polylineBarriersLayer.setRenderer(this.defaults.polylineBarrierRenderer);this._polygonBarriersLayer.setRenderer(this.defaults.polygonBarrierRenderer);this.map&&(this.map.addLayer(this._routeLayer),this.map.addLayer(this._polygonBarriersLayer),
this.map.addLayer(this._polylineBarriersLayer),this.map.addLayer(this._barriersLayer),this.map.addLayer(this._stopLayer),this._externalTimeExtent=this.map.timeExtent);this._snappingManager=this.map.enableSnapping({layerInfos:[{layer:this._waypointsEventLayer,snapToVertex:!1,snapToPoint:!0,snapToEdge:!0}],tolerance:15});this._setWidgetProperties();var e=new u(null,this.waypointSymbol,{});b=l.hitch(this,function(){this._moveInProgress||this._solveInProgress||!e._isShown()||(this.editToolbar.deactivate(),
this._stopLayer.remove(e),clearTimeout(e._solveTimeout),e._solveTimeout=null,e.attributes.isWaypoint=!0,e._isStopIcon&&this.stopGraphics[e._index]&&(this._stopLayer.add(this.stopGraphics[e._index]),this._stopLayer.add(this.textGraphics[e._index])));e._showTooltip()});this._handle=l.mixin(e,{_isHandle:!0,_tooltip:H.create("div",{className:this.theme+" esriDirectionsRouteTooltip",onmouseover:b},this.map.container),_showTooltip:l.hitch(this,function(r){e._tooltip.style.display=!r||r instanceof MouseEvent?
"none":"inline";r&&(r="string"===typeof r?r:"\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(r)+"\x3c/table\x3e",e._tooltip.innerHTML!==r&&(e._tooltip.innerHTML=r))}),_isShown:l.hitch(this,function(){return-1<K.indexOf(this._stopLayer.graphics,e)}),_remove:b});this._activate(this.mapClickActive)},startup:function(){this.inherited(arguments);return this._enqueue(this._init)},destroy:function(){this.deactivate();this.map.removeLayer(this._barriersLayer);this.map.removeLayer(this._polylineBarriersLayer);
this.map.removeLayer(this._polygonBarriersLayer);this.map.removeLayer(this._routeLayer);this.map.removeLayer(this._stopLayer);this.map.removeLayer(this._waypointsEventLayer);this._disconnectEvents();H.empty(this.domNode);this.inherited(arguments)},activate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(l.hitch(this,function(){this.set("mapClickActive",!0)}))})},deactivate:function(){return this._enqueue(function(){this.deactivateBarrierTool().then(l.hitch(this,function(){this.set("mapClickActive",
!1)}))})},activateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!0)})},deactivateBarrierTool:function(){return this._enqueue(function(){this.set("mapClickActive",!1);this.set("barrierToolActive",!1)})},clearDirections:function(){return this._enqueue(function(){this.clearMessages();return this._clearDirections()})},reset:function(){return this._enqueue(this._reset)},modifyStopSequence:function(b,e){return this._enqueue(function(){return this._modifyStopSequence(b,
e)})},onActivate:function(){},onDeactivate:function(){},onActivateBarrierTool:function(){},onDeactivateBarrierTool:function(){},onLoad:function(){this._enableButton(this._getDirectionsButtonNode)},onDirectionsStart:function(){this._clearDisplayBeforeSolve();this.set("solving",!0);this._showLoadingSpinner(!0)},onDirectionsFinish:function(){this._showLoadingSpinner(!1);this.set("solving",!1)},onDirectionsClear:function(){},onSegmentSelect:function(){},onSegmentHighlight:function(){},onStopsUpdate:function(){},
onRouteItemCreated:function(){},onRouteItemUpdated:function(){},onFeatureCollectionCreated:function(){},onError:function(){},removeStops:function(){return this.reset()},removeStop:function(b,e,r){return this._enqueue(function(){this.clearMessages();return this._removeStop(b,e,r)})},updateStops:function(b){return this._enqueue(function(){return this._updateStops(b)})},addStops:function(b,e){return this._enqueue(function(){return this._addStops(b,e)}).then(l.hitch(this,this.zoomToFullRoute))},addStop:function(b,
e){return this._enqueue(function(){return this._addStop(b,e)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},updateStop:function(b,e,r){return this._enqueue(function(){return this._updateStop(b,e,r)},{_incrementalSolveStopRange:this._incrementalSolveStopRange})},setBarriers:function(b){this.routeParams.barriers=b;return this._getDirections().then(l.hitch(this,function(){this.zoomToFullRoute()}))},setPolylineBarriers:function(b){this.routeParams.polylineBarriers=b;return this._getDirections().then(l.hitch(this,
function(){this.zoomToFullRoute()}))},setPolygonBarriers:function(b){this.routeParams.polygonBarriers=b;return this._getDirections().then(l.hitch(this,function(){this.zoomToFullRoute()}))},clearMessages:function(){this.messages=[];this._msgNode&&(this._msgNode.innerHTML="")},getDirections:function(b){return this._enqueue(function(){return this._getDirections().then(l.hitch(this,function(){!0!==b&&this.zoomToFullRoute()}))})},selectSegment:function(b){if(!(!this.directions||!this.directions.features||
0>b||b>=this.directions.features.length))for(var e=V("[data-segment]",this._resultsNode),r=0;r<e.length;r++){var A=parseInt(T.get(e[r],"data-segment"),10);if(b===A&&e[r]!==this._focusedDirectionsItem){this._focusedDirectionsItem=e[r];this.centerAtSegmentStart(b);this.onSegmentSelect(this.directions.features[b]);e[r].focus();break}}},unhighlightSegment:function(b){var e=this._segmentGraphics;if(e&&(!this._focusedDirectionsItem||b)){for(b=0;b<e.length;b++)this._routeLayer.remove(e[b]);this._segmentGraphics=
[]}},highlightSegment:function(b,e){if(!(this._focusedDirectionsItem&&!e||b>=this.directions.features.length)){b=b||0;var r=l.hitch(this,function(ta){var sa=this.map.toMap({x:0,y:0});return this.map.toScreen(sa.offset(ta,0)).x}),A=l.hitch(this,function(ta){for(var sa=0,Ca=0;Ca<ta.length;Ca++)for(var Ha=1;Ha<ta[Ca].length;Ha++){var Qa=ta[Ca][Ha-1],La=ta[Ca][Ha];sa+=r(Math.sqrt((Qa[0]-La[0])*(Qa[0]-La[0])+(Qa[1]-La[1])*(Qa[1]-La[1])))}return sa}),x=l.hitch(this,function(ta){var sa=this.map.toMap({x:0,
y:0});return this.map.toMap({x:ta,y:0}).x-sa.x}),S=function(ta,sa,Ca){sa=Math.max(1,sa);for(var Ha=Ca?ta[0].length-1:0,Qa=0,La,Ja,Ga,za=[[ta[0][Ca?Ha:0]]];Ca&&0<Ha||!Ca&&Ha<ta[0].length-1;){Ja=ta[0][Ca?Ha-1:Ha];Ga=ta[0][Ca?Ha:Ha+1];if(La=r(Math.sqrt((Ja[0]-Ga[0])*(Ja[0]-Ga[0])+(Ja[1]-Ga[1])*(Ja[1]-Ga[1]))))if(Qa+La<sa)Ca?za[0].splice(0,0,Ja):za[0].push(Ga),Qa+=La;else{sa=(sa-Qa)/La;Ca?za[0].splice(0,0,[Ga[0]-(Ga[0]-Ja[0])*sa,Ga[1]-(Ga[1]-Ja[1])*sa]):za[0].push([Ja[0]+(Ga[0]-Ja[0])*sa,Ja[1]+(Ga[1]-
Ja[1])*sa]);break}Ha+=Ca?-1:1}return 0<Qa+La?za:ta};e=this.get("directions").features[b];var X=new W(e.geometry),Z=40*Math.PI/180;l.mixin(e.attributes,{_index:b});if(b){var ba=S(this.get("directions").features[b-1].geometry.paths,25,!0),ha="esriDMTStop"!==e.attributes.maneuverType?S(X.paths,25,!1):ba;ba=ha!==ba?[ba[0].concat(ha[0])]:ha;var ia=(new W(ha)).getExtent();if(1<ha[0].length&&15<=r(Math.max(ia.getWidth(),ia.getHeight()))){S=15*Math.cos(Z/2);A=15*Math.sin(Z/2);var ma=ha[0].length-2;Z=ha[0][ma+
1];for(ia=0;0<=ma&&!ia;){var na=ha[0][ma];ia=r(Math.sqrt((na[0]-Z[0])*(na[0]-Z[0])+(na[1]-Z[1])*(na[1]-Z[1])));ma--}22>ia&&(ha=ia+(22-ia)/3,ma=ia+2*(22-ia)/3,ma=[na[0]+ma/ia*(Z[0]-na[0]),na[1]+ma/ia*(Z[1]-na[1])],na=[Z[0]-ha/ia*(Z[0]-na[0]),Z[1]-ha/ia*(Z[1]-na[1])],Z=ma,ia=22);S/=ia;ha=[Z[0]-(Z[0]-na[0])*S,Z[1]-(Z[1]-na[1])*S];na[1]!==Z[1]?(S=(Z[0]-na[0])/(Z[1]-na[1]),na=x(A/Math.sqrt(1+S*S)),x=S*na):(na=0,x=x(A));Infinity===Math.abs(na)||Infinity===Math.abs(x)||isNaN(na)||isNaN(x)||(ba[0].push(Z),
ba[0].push([ha[0]-na,ha[1]+x]),ba[0].push([ha[0]+na,ha[1]-x]),ba[0].push(Z))}else ba=S(ba,2*A(ha),!0);X.paths=ba}this.unhighlightSegment(this._segmentGraphics&&this._segmentGraphics.length);x=l.clone(this.routeSymbol).setWidth(this.segmentSymbol.width).setColor(new E([parseInt(.9*this.segmentSymbol.color.r),parseInt(.9*this.segmentSymbol.color.g),parseInt(.9*this.segmentSymbol.color.b)]));this._segmentGraphics=[new u(e.geometry,x,e.attributes,this.get("segmentInfoTemplate")),new u(X,this.routeSymbol,
e.attributes,this.get("segmentInfoTemplate")),new u(X,this.segmentSymbol,e.attributes,this.get("segmentInfoTemplate"))];this.get("showSegmentHighlight")&&(this._routeLayer.add(this._segmentGraphics[0]),this._routeLayer.add(this._segmentGraphics[1]),this._routeLayer.add(this._segmentGraphics[2]));e=l.hitch(this,function(ta){if(0<ta&&ta<this.directions.features.length){ta=this.directions.features[ta]._associatedFeaturesWithWaypoints;for(var sa=0;sa<ta.length;sa++)ta[sa]._associatedSnapFeature&&ta[sa]._associatedSnapFeature.getDojoShape()&&
ta[sa]._associatedSnapFeature.getDojoShape().moveToFront()}});e(b-1);e(b);this.onSegmentHighlight(this.directions.features[b])}},zoomToSegment:function(b){var e=new y;if(this.directions&&this.directions.features){var r=Math.max(0,Math.min(this.directions.features.length-1,b||0));this.map.setExtent(this.get("directions").features[r].geometry.getExtent(),!0).promise.always(l.hitch(this,function(){this.highlightSegment(r);e.resolve()}))}else e.reject(Error("No directions."));return e.promise},centerAtSegmentStart:function(b){var e=
new y;if(this.directions&&this.directions.features){var r=Math.max(0,Math.min(this.directions.features.length-1,b||0));var A=this.directions.features[r];this.map.centerAt(A.geometry.getPoint(0,0)).promise.always(l.hitch(this,function(){this.highlightSegment(r,!0);this._showSegmentPopup(A,r);e.resolve()}))}else e.reject(Error("No directions."));return e.promise},zoomToFullRoute:function(){var b=new y;this.directions&&this.directions.features?(this._clearInfoWindow(),this.unhighlightSegment(),this.get("map").setExtent(this.get("directions").extent,
!0).promise.always(b.resolve)):b.resolve();return b.promise},setListIcons:function(){var b,e=this._dnd.getAllNodes();for(b=0;b<e.length;b++){var r=V("."+this._css.stopIconClass,e[b])[0];r&&(r.innerHTML=this._getLetter(b));M.remove(e[b],this._css.stopOriginClass+" "+this._css.stopDestinationClass+" "+this._css.stopUnreachedClass+" "+this._css.stopUnreachedFirstOrLastClass);r=this._getStopSymbol(this.stops[b]);r===this.fromSymbol?M.add(e[b],this._css.stopOriginClass):r===this.toSymbol?M.add(e[b],this._css.stopDestinationClass):
r===this.unreachedSymbol&&M.add(e[b],this._css.stopUnreachedClass)}b=V("[data-reverse-td]",this._dndNode)[0];H.destroy(b);this.get("showReverseStopsButton")&&H.create("td",{"data-reverse-td":"true",rowspan:e.length,className:this._css.esriStopReverseColumnClass,innerHTML:'\x3cdiv role\x3d"button" class\x3d"'+this._css.reverseStopsClass+'" data-reverse-stops\x3d"true" title\x3d"'+L.widgets.directions.reverseDirections+'"\x3e\x3c/div\x3e',onmouseover:function(A){A.stopPropagation()},onmouseout:function(A){A.stopPropagation()}},
e[0])},addRouteSymbols:function(){if(this.stopGraphics.length){this._moveLayersToFront();for(var b=0;b<this.stopGraphics.length;b++)if(this.stopGraphics[b]&&(!this._handle._isShown()||this._handle._isShown()&&this._handle._index!==b)){this._stopLayer.add(this.stopGraphics[b]);var e=this.stopGraphics[b].getDojoShape();e&&e.moveToFront();this._stopLayer.add(this.textGraphics[b]);(e=this.textGraphics[b].getDojoShape())&&e.moveToFront()}this._moveInProgress&&!this._handle.attributes.isWaypoint&&this._handle.getDojoShape()&&
this._handle.getDojoShape().moveToFront()}},createRouteSymbols:function(){this._clearStopGraphics();for(var b=this.stops,e=function(Z){var ba={},ha;for(ha in Z)Z.hasOwnProperty(ha)&&0===ha.indexOf("Attr_")&&(ba[ha]=Z[ha]);return ba},r=0;r<b.length;r++){var A=b[r];if(A&&A.feature){var x=A.feature.attributes,S=x?x.Status:void 0,X=null;this._isStopAWaypoint(A)||(X=new Aa(this._getLetter(r),this.get("textSymbolFont"),this.get("textSymbolColor")),this.get("textSymbolOffset")&&X.setOffset(this.get("textSymbolOffset").x,
this.get("textSymbolOffset").y));X=new u(A.feature.geometry,X,{address:A.name},this.get("stopsInfoTemplate"));X._isStopLabel=!0;X._index=r;A=new u(A.feature.geometry,this._getStopSymbol(A),l.mixin({address:A.name,Status:void 0===S?0:S,CurbApproach:x&&x.CurbApproach?x.CurbApproach:null,TimeWindowStart:x&&x.TimeWindowStart?x.TimeWindowStart:null,TimeWindowEnd:x&&x.TimeWindowEnd?x.TimeWindowEnd:null,isWaypoint:this._isStopAWaypoint(A)},e(x)),this.get(this._isStopAWaypoint(A)?"waypointInfoTemplate":"stopsInfoTemplate"));
A._isStopIcon=!0;A._index=r;this.stopGraphics[r]=A;this.textGraphics[r]=X}}this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);this._showBarriers();this.addRouteSymbols();this.setListIcons()},setTravelMode:function(b){return this._enqueue(function(){this.clearMessages();this._travelModeSelector.setValue(b);return this._setTravelMode(b)})},getSupportedTravelModeNames:function(){var b=[],e=this.serviceDescription;if(e&&e.supportedTravelModes&&e.supportedTravelModes.length){e=
e.supportedTravelModes;for(var r=0;r<e.length;r++)b.push(e[r].name)}return b},setDirectionsLengthUnits:function(){var b=1===arguments.length?arguments[0]:this.get("directionsLengthUnits");return this._enqueue(function(){this.clearMessages();return this._setDirectionsLengthUnits(b)})},setDirectionsLanguage:function(){var b=1===arguments.length?arguments[0]:this.get("directionsLanguage");return this._enqueue(function(){this.clearMessages();return this._setDirectionsLanguage(b)})},useMyCurrentLocation:function(b){this.clearMessages();
return this._createLocateButton(this.geocoders[b],!0,!0)},loadRoute:function(b){return this._enqueue(l.hitch(this,function(){return this._loadRoute(b)}))},_getStopsAttr:function(){return this.returnToStart&&this._returnToStartStop?this.stops.concat(this._returnToStartStop):this.stops},_getTravelModeNameAttr:function(){return this.routeParams&&this.routeParams.travelMode&&this.routeParams.travelMode.name},_reset:function(){var b=this.mapClickActive||this.barrierToolActive;this._clearBarriersGraphics();
this._setWidgetProperties();return this._init().then(l.hitch(this,function(){this.mapClickActive=!b;this.set("mapClickActive",b);this._searchSourceSelector&&this._searchSourceSelector.setValue("all")}))},_activate:function(){var b=this.get("mapClickActive"),e=l.hitch(this,function(r){for(var A=r?[this.textGraphics,this.stopGraphics,this.displayedManeuverPointGraphics,this.displayedRouteGraphics]:[this.displayedRouteGraphics,this.displayedManeuverPointGraphics,this.stopGraphics,this.textGraphics],
x=0;x<A.length;x++)for(var S=A[x],X=0;X<S.length;X++){var Z=S[X].getDojoShape();Z&&Z[r?"moveToBack":"moveToFront"].call(Z)}});this.drawToolbar&&(this.barrierToolActive=!1,this.drawToolbar.deactivate(),M.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass));this._addStopOnMapClickListener&&this._addStopOnMapClickListener.remove();b?(this.map.activeDirectionsWidget&&this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=
this,this._addStopOnMapClickListener=g(this.map,"click",l.hitch(this,function(r){this.canModifyStops&&!this._solveInProgress&&(this.map.infoWindow.hide(),this.addStop(new u(r.mapPoint)))})),this.map.addLayer(this._waypointsEventLayer),this._moveLayersToFront(),M.add(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onActivate()):(this.map.removeLayer(this._waypointsEventLayer),M.remove(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onDeactivate());e(!b);this.emit("map-click-active",
{mapClickActive:this.mapClickActive})},_activateBarrierTool:function(){this.get("barrierToolActive")?(this.map.activeDirectionsWidget&&this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this.drawToolbar.activate(Za.FREEHAND_POLYLINE),M.add(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),this.onActivateBarrierTool()):(this.drawToolbar.deactivate(),M.remove(this._lineBarrierButtonNode,this._css.stopsPressedButtonClass),
this.onDeactivateBarrierTool());this.emit("barrier-tool-active",{barrierToolActive:this.barrierToolActive})},_moveLayersToFront:function(){var b=this.get("map"),e=b.graphicsLayerIds.length-1;b.reorderLayer(this._routeLayer,e);b.reorderLayer(this._polygonBarriersLayer,e);b.reorderLayer(this._polylineBarriersLayer,e);b.reorderLayer(this._barriersLayer,e);b.reorderLayer(this._waypointsEventLayer,e);b.reorderLayer(this._stopLayer,e)},_destroyGeocoders:function(){for(;this.geocoders&&this.geocoders.length;){if(this.geocoders[0])try{this.geocoders[0].destroy()}catch(b){}this.geocoders.splice(0,
1)}this.geocoders=[]},_disconnectEvents:function(){var b=this._clearDirections(!0),e;if(this._watchEvents&&this._watchEvents.length)for(e=0;e<this._watchEvents.length;e++)this._watchEvents[e].unwatch();if(this._onEvents&&this._onEvents.length)for(e=0;e<this._onEvents.length;e++)this._onEvents[e].remove();if(this._geocoderEvents)for(e=0;e<this._geocoderEvents.length;e++)this._geocoderEvents[e].value.unwatch(),this._geocoderEvents[e].blur.remove(),this._geocoderEvents[e].select.remove(),this._geocoderEvents[e].suggest.remove();
this._onEvents=[];this._watchEvents=[];this._geocoderEvents=[];this._disconnectResults();this._destroyGeocoders();this._destroyGlobalGeocoder();this._destroyDnD();return b},_getDirections:function(){var b=new y;this._removeEmptyStops();1<this._getStopCount()+this._getWaypointCount()&&this.loaded?(this.onDirectionsStart(),this.clearMessages(),this._dnd.sync(),this._sortGeocoders(),this._getCandidates(this.stops).then(l.hitch(this,function(e){this.stops=e;this._setStops();this._configureRoute().always(l.hitch(this,
function(r){b.resolve(r)}))}),l.hitch(this,function(e){this.set("directions",null);this._clearRouteGraphics();b.reject(e);this.onDirectionsFinish(e)}))):this._clearDirections(!0).always(l.hitch(this,function(){this.createRouteSymbols();b.resolve()}));return b.promise},_clearDirections:function(){var b=new y;this._handle&&this._handle._remove();this.get("routeParams")&&this.get("routeParams").stops?this.get("routeParams").stops.features.length?(this.get("routeParams").stops.features=[],this.onDirectionsClear(),
b.resolve()):arguments.length?b.resolve():this._reset().then(b.resolve,b.reject):b.resolve();this.set("directions",null);this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this._routeLayer.clear();this._waypointsEventLayer.clear();this._stopLayer.clear();return b.promise},_setTravelMode:function(b){var e=new y,r=this.serviceDescription,A=function(){e.resolve(b)};if(r&&r.supportedTravelModes&&r.supportedTravelModes.length){var x=r.supportedTravelModes,S=!1;for(r=0;r<x.length;r++)if(x[r].name===
b){S=!0;!this.routeParams.travelMode||this.routeParams.travelMode&&this.routeParams.travelMode.name!==b?(this.routeParams.travelMode=x[r].impedanceAttributeName?x[r]:x[r].itemId,this._checkStartTimeUIAvailability(),this._solveAndZoom().always(A)):A();this._travelModeSelector&&this._travelModeSelector.domNode&&(this._travelModeSelector.domNode.title=x[r].description);break}S||e.reject(b)}else e.reject(b);return e.promise},_setDirectionsLengthUnits:function(b){this._clearDisplayBeforeSolve();var e=
new y;M.remove(this._useMilesNode,this._css.stopsPressedButtonClass);M.remove(this._useKilometersNode,this._css.stopsPressedButtonClass);b===Q.KILOMETERS?M.add(this._useKilometersNode,this._css.stopsPressedButtonClass):b===Q.MILES&&M.add(this._useMilesNode,this._css.stopsPressedButtonClass);b===Q.KILOMETERS||b===Q.METERS||b===Q.MILES||b===Q.FEET||b===Q.YARDS||b===Q.NAUTICAL_MILES?(this.directionsLengthUnits=b,e.resolve(b)):e.reject(b);return e.promise},_setDirectionsLanguage:function(b){this._clearDisplayBeforeSolve();
var e=new y;b=this._setDirectionsLanguageByLocale(b);this._solveAndZoom().always(function(){e.resolve(b)},e.reject);return e.promise},_showLoadingSpinner:function(b){void 0===b&&(b=this._requestQueueTail&&!this._requestQueueTail.isFulfilled()||this._moveInProgress);b?(M.add(this._widgetContainer,this._css.resultsLoadingClass),M.add(this._resultsNode,"esriRoutesContainerBusy")):(M.remove(this._widgetContainer,this._css.resultsLoadingClass),M.remove(this._resultsNode,"esriRoutesContainerBusy"))},_enqueue:function(b,
e){var r=new y;this._requestQueueTail||(this._requestQueueTail=new y,this._requestQueueTail.resolve());this._requestQueueTail.promise.always(l.hitch(this,function(){try{l.mixin(this,{_incrementalSolveStopRange:null},e);var A=b.call(this);A&&"object"===typeof A&&A.hasOwnProperty("isFulfilled")?A.then(l.hitch(this,function(x){r.resolve(x);this._showLoadingSpinner()}),l.hitch(this,function(x){r.reject(x);this._showLoadingSpinner()})):(r.resolve(A),this._showLoadingSpinner())}catch(x){r.reject(x),this._showLoadingSpinner()}}));
this._requestQueueTail=r;this._showLoadingSpinner();return r.promise},_createDnD:function(){this._dnd=new Y(this._dndNode,{skipForm:!0,withHandles:!0})},_destroyDnD:function(){H.empty(this._dndNode);this._dnd&&(this._dnd.destroy(),this._dnd=null)},_createDepartAtControls:function(){if(this._departAtTime)this.map&&this._restoreMapTimeExtent(),this._useTrafficItemNode.title=L.widgets.directions.trafficLabelLive,M.remove(this._departAtContainer,"departAtContainerVisible"),this.startTime="now",this._updateStartTimeUI();
else{var b=this,e=function(){this._keepDirections||b._clearDisplayBeforeSolve();this._keepDirections=!1},r=l.hitch(this,function(){this.map&&this.map.disableKeyboardNavigation()}),A=l.hitch(this,function(){this.map&&this.map.enableKeyboardNavigation()});this._departAtTime=new t({required:!0,value:new Date,onChange:e,onFocus:r,onBlur:A},this._departAtTimeContainer);this._departAtDate=new w({required:!0,value:new Date,onChange:e,onFocus:r,onBlur:A,constraints:{min:new Date(864E5)}},this._departAtDateContainer)}},
_setStartTime:function(b,e,r){if(isNaN(r))this.startTime="now"===r?r:"none";else{e=r instanceof Date?r:new Date(r);r=this.directions&&this.directions.features&&this.directions.features[0]&&this.directions.features[0].attributes;var A=6E4*-e.getTimezoneOffset();e=new Date(e-A+(r&&r.arriveTimeUTC?r.ETA-r.arriveTimeUTC:A));this._departAtTime._keepDirections=!b;this._departAtDate._keepDirections=!b;this._departAtTime.setValue(e);this._departAtDate.setValue(e)}this._updateStartTimeUI()},_checkStartTimeUIAvailability:function(){var b=
this._getImpedanceAttribute();b=this._isTimeUnits(b?b.units:"")||this.serviceDescription&&10.6<=this.serviceDescription.currentVersion;this._startTimeButtonNode.disabled=!b;M[b?"remove":"add"].apply(this,[this._startTimeButtonNodeContainer,"esriLinkButtonDisabled"]);M[b?"remove":"add"].apply(this,[this._startTimeDDLArrow,"esriDirectionsDDLArrowDisabled"]);b||this.set("startTime","now")},_usingAGOL:function(b){b||(b=this.routeTaskUrl);return-1<b.search(/^(https?:)*\/\/*[^.]*\.arcgis\.com.*$/i)},_usingRouteAGOL:function(){return-1<
this.get("routeTaskUrl").search(/^(https?:)*\/\/route*[^.]*\.arcgis\.com.*$/i)},_setSearchOptions:function(){var b={map:this.get("map"),autoNavigate:!1,enableInfoWindow:!1,enableHighlight:!1,enableSourcesMenu:!1};this.searchOptions=l.mixin({maxResults:1,locationToAddressDistance:100},this.defaults.searchOptions,b)},_setDefaultUnits:function(){if(!this.get("directionsLengthUnits")){var b="EN-US"===G.locale.toUpperCase()?Q.MILES:Q.KILOMETERS;this.defaults.directionsLengthUnits?b=this.defaults.directionsLengthUnits:
this.userOptions.routeParams&&this.userOptions.routeParams.directionsLengthUnits&&(b=this.userOptions.routeParams.directionsLengthUnits);this.set("directionsLengthUnits",b)}this._setDirectionsLengthUnits(this.directionsLengthUnits)},_setTrafficOptions:function(){this._usingRouteAGOL()&&!this.trafficLayer&&(this.trafficLayer=new qa(Ta+"//traffic.arcgis.com/arcgis/rest/services/World/Traffic/MapServer",{opacity:.4}));this.trafficLayer&&this.trafficLayer.url&&this._usingAGOL(this.trafficLayer.url)&&
(this._trafficAvailabilityButton.style.display="inline-block");this.set("showTrafficOption",(this.defaults.showTrafficOption||!this.defaults.hasOwnProperty("showTrafficOption"))&&!!this.trafficLayer);this._optionsMenu()},_updateCanModifyStops:function(b,e){this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!1);e||!this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!0);this._showAddDestination();this._showMapClickActiveButton();this._stopsTableCover.style.display=
this.canModifyStops?"none":"inline"},_updateCanAddWaypoints:function(b,e){this.canModifyStops||this.canModifyWaypoints||this.set("mapClickActive",!1);e||this.canModifyStops||!this.canModifyWaypoints||this.set("mapClickActive",!0);this._showMapClickActiveButton();this._handle._remove()},_updateStartTimeUI:function(){isNaN(this.startTime)?(this._startTimeButtonLabel.innerHTML="now"==this.startTime?this._i18n.widgets.directions.leaveNow:this._i18n.widgets.directions.noStartTime,M.remove(this._startTimeButtonNodeContainer,
"departAtButton"),M.remove(this._departAtContainer,"departAtContainerVisible")):(M.add(this._startTimeButtonNodeContainer,"departAtButton"),M.add(this._departAtContainer,"departAtContainerVisible"),this._startTimeButtonLabel.innerHTML=this._i18n.widgets.directions.departAt)},_setWidgetProperties:function(){this._disconnectEvents();this.set(this.defaults);this.routeLayer=l.clone(this.defaults.routeLayer);this._folderSelector&&(this._outputLayer.setValue(""),this._outputLayer.set("disabled",!0),this._folderSelector.set("disabled",
!0));this.set("stops",[]);this._updateCanModifyStops()},_updateStops:function(b){var e=new y;b?this.get("loaded")?this._reset().then(l.hitch(this,function(){this._addStops(b).then(e.resolve,e.reject)}),e.reject):this._addStops(b).then(e.resolve,e.reject):e.reject();return e.promise},_removeStop:function(b,e,r,A){var x=new y,S=l.hitch(this,function(Z){this.stops.splice(Z,1);var ba=this._dnd.getAllNodes()[Z],ha=this.get("geocoders");this._geocoderEvents[ba.id]&&(this._geocoderEvents[ba.id].blur.remove(),
this._geocoderEvents[ba.id].select.remove(),this._geocoderEvents[ba.id].suggest.remove(),this._geocoderEvents[ba.id].value.unwatch());ha[Z].destroy();ha.splice(Z,1);this.set("geocoders",ha);H.destroy(ba);this._dnd.sync();this._stopsRemovable();this._optionsMenu();this._checkMaxStops();this.setListIcons();this._sortGeocoders()});if(0>b||b>=this.stops.length||void 0===b)b=this.stops.length-1;var X=!1;for(A=this.stopGraphics[b]&&this._isStopAWaypoint(this.stops[b])||A;!X;)S(b),A?X=!0:(b-=0>=b||b<this.stops.length&&
this._isStopAWaypoint(this.stops[b])?0:1,X=!this._isStopAWaypoint(this.stops[b]));for(;this.stops.length-this._getWaypointCount()<this.minStops;)this._addStop();this._clearStopsStatusAttr();this._setStops();this.createRouteSymbols();r?(this._clearDisplayBeforeSolve(),this._clearDisplayAfterSolve(),this.createRouteSymbols(),x.resolve()):this._solveAndZoom(e).then(x.resolve,x.reject);return x.promise},_removeTrafficLayer:function(){this.trafficLayer&&this.map&&this.map.removeLayer(this.trafficLayer);
this._trafficLayerAdded=!1},_addStops:function(b,e){var r=new y,A=[],x=this.autoSolve;this.autoSolve=!1;void 0===e&&(e=this._getStopCount());for(var S=0;S<Math.min(b.length,this.maxStops-this._getStopCount());S++){var X=new y;this._addStop(b[S],e+S,!0).always(X.resolve);A.push(X)}R(A).always(l.hitch(this,function(){this.autoSolve=x;this._getDirections().always(function(){r.resolve(b)})}));return r.promise},_addStop:function(b,e,r){var A=new y;this._checkMaxStops();this.maxStopsReached?(this._showMessage(L.widgets.directions.error.maximumStops),
A.reject(Error(L.widgets.directions.error.maximumStops))):(void 0===b&&void 0===e&&(e=this.stops.length),b instanceof u&&b.attributes&&b.attributes.isWaypoint&&(!e||e===this.stops.length||2>this._getStopCount())&&!r?(this._showMessage(L.widgets.directions.error.waypointShouldBeInBetweenStops),A.reject(Error(L.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(b).then(l.hitch(this,function(x){this._isStopAWaypoint(x)&&x&&x.feature&&(x.feature.attributes=l.mixin({},x.feature.attributes,
{isWaypoint:!0,CurbApproach:3}));this._insertStop(x,e);this.autoSolve&&""!==x.name?this._getDirections().always(function(){A.resolve(x,e)}):A.resolve(x,e)}),l.hitch(this,function(x){A.reject(x)})));return A.promise},_removeEmptyStops:function(){for(var b=0,e=this.stops.length-this._getWaypointCount()-this.minStops;b<this.stops.length&&0<e;)this.stops[b]&&this.stops[b].name?b++:(this._removeStop(b,!0,!0,!0),e--,this._moveInProgress&&this._handle._index>=b&&this._handle._isStopIcon&&this._handle._index--)},
_setReverseGeocode:function(b,e,r){if(b.feature.geometry&&-1<r){var A={address:b.name};this.stopGraphics[r]&&(l.mixin(this.stopGraphics[r].attributes,A),this.stopGraphics[r].setGeometry(e));this.textGraphics[r]&&(l.mixin(this.textGraphics[r].attributes,A),this.textGraphics[r].setGeometry(e));this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);(A=this.geocoders[r])&&A.inputNode&&(A.value=b.name,A.inputNode.value=b.name);l.mixin(b.feature.attributes,this.stops[r].feature.attributes);
this.stops[r]=b;this.stops[r].feature.setGeometry(e);this._setStops();return this._enqueue(function(){return this._getDirections()})}},_insertStop:function(b,e){var r;if(void 0===e)for(r=0;r<this.geocoders.length;r++){if(!this.geocoders[r].get("value")){var A=this.geocoders[r];break}}else r=e,this.geocoders[r]&&!this.geocoders[r].get("value")&&(A=this.geocoders[r]);!A||void 0!==e&&e!==r||this._isStopAWaypoint(b)?(void 0===e&&(e=this.geocoders.length),this.stops.splice(e,0,b),this._createGeocoder(b,
e)):(this.stops[r]=b,A.set("value",b.name),A._stopReference=b);this._optionsMenu()},_createGeocoder:function(b,e){var r=this._dnd.getAllNodes(),A=!1,x=!1,S=r.length;r[e]?(x=r[e],A=!0):A=x=!1;var X=l.hitch(this,function(ia,ma){var na=ma?this._css.stopDnDHandleClass:this._css.stopDnDHandleClassHidden,ta=ma?this._css.stopDnDHandleClassHidden:this._css.stopDnDHandleClass;M.replace(ia.children[0],na,ta);2<this.geocoders.length&&(na=ma?this._css.stopIconRemoveClass:this._css.stopIconRemoveClassHidden,ta=
ma?this._css.stopIconRemoveClassHidden:this._css.stopIconRemoveClass,M.replace(ia.children[3].children[0],na,ta))}),Z=H.create("tr",{className:this._css.stopClass,style:this._isStopAWaypoint(b)?"display:none;":"",onmouseover:function(){X(this,!0)},onmouseout:function(){X(this,!1)}});H.create("td",{className:this._css.stopDnDHandleClassHidden+" dojoDndHandle"},Z);r=H.create("td",{className:this._css.stopIconColumnClass},Z);H.create("div",{className:this._css.stopIconClass+" dojoDndHandle",innerHTML:this._getLetter(S),
"data-center-at":"true"},r);S=H.create("td",{className:this._css.esriStopGeocoderColumnClass},Z);S=H.create("div",{},S);r=H.create("td",{className:this._css.stopIconRemoveColumnClass},Z);H.create("div",{className:this._css.stopIconRemoveClassHidden,role:"button","data-remove":"true"},r);this._dnd.insertNodes(!1,[Z],A,x);A=l.mixin({},this.get("searchOptions"),{value:b.name,activeSourceIndex:this._globalGeocoder.activeSourceIndex});var ba=new ab(A,S),ha=l.hitch(this,function(ia,ma){this._enqueue(function(){if(ma!==
ia&&ba._stopReference&&ba._stopReference.name!==ma){var na=K.indexOf(this.stops,ba._stopReference);this.stops[na]={name:ma};this._handle._remove();this._removeSomeWaypoints(this._markWPsForRemovalAfterUserChangedStopSequence(na));this._setStops();this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this.createRouteSymbols()}})});ba._tr=Z;ba._stopReference=b;ba.startup();this.geocoders.splice(e,0,ba);this._geocoderEvents[Z.id]={blur:ba.on("blur",function(){""!==this.value&&this._stopReference&&
!this._stopReference.feature&&this.search()}),select:ba.on("select-result",l.hitch(this,function(ia){var ma=!0;if(ia&&(ia.results||ia.result)){var na=this._dnd.getAllNodes();na=K.indexOf(na,Z);var ta=ba.value,sa=ia.results&&ia.results.results&&ia.results.results.length?ia.results.results[0]:ia.result;sa?(sa.name=ta,this.stops[na]=this._toPointGeometry(sa),this.geocoders[na]._stopReference=this.stops[na],ha("",ta)):(this.removeStop(na),this.set("directions",null),this._showMessage(L.widgets.directions.error.unknownStop.replace("\x3cname\x3e",
ia.target.get("value"))),this._clearRouteGraphics(),ma=!1);ma&&this.getDirections()}})),suggest:ba.on("suggest-results",function(){if(document.activeElement===this.inputNode)for(var ia=V("LI[role\x3d'menuitem']",this.suggestionsNode),ma=0;ma<ia.length;ma++)T.set(ia[ma],"tabindex",-1);else this._hideSuggestionsMenu()}),value:ba.watch("value",function(ia,ma,na){ha(ma,na)})};this._checkMaxStops();this.setListIcons();this._stopsRemovable();this._optionsMenu();this._sortGeocoders()},_blurGeocoders:function(){if(document.activeElement)for(var b=
0;b<this.geocoders.length;b++)if(this.geocoders[b].inputNode===document.activeElement){this.geocoders[b]._hideSuggestionsMenu();this.geocoders[b].inputNode.blur();1<this._getStopCount()+this._getWaypointCount()&&this.getDirections(!0);break}},_decorateEmptyAGOLGeocoderResponse:function(b){b&&", , "===b.name&&(b.name=b.feature&&b.feature.attributes&&b.feature.attributes.Match_addr?b.feature.attributes.Match_addr+("POI"===b.feature.attributes.Addr_type&&b.feature.attributes.City&&-1===b.feature.attributes.Match_addr.indexOf(b.feature.attributes.City)?
", "+b.feature.attributes.City:""):"");return b},_toPointGeometry:function(b){var e=b.feature.geometry;e&&(e.getCentroid?b.feature.geometry=e.getCentroid():e.getExtent&&(e=e.getExtent())&&(b.feature.geometry=e.getCenter()));return b},_removeLocateButtonVisibilityEvents:function(){for(var b=0;b<this.geocoders.length;b++){var e=this.geocoders[b];e._onMouseEnter&&e._onMouseEnter.remove();e._onMouseOut&&e._onMouseOut.remove();e._onKeyPress&&e._onKeyPress.remove();e._locateButton&&(e._locateButton._onMouseEnter&&
e._locateButton._onMouseEnter.remove(),e._locateButton._onMouseOut&&e._locateButton._onMouseOut.remove())}},_setLocateButtonVisibilityEvents:function(){this._removeLocateButtonVisibilityEvents();for(var b=this,e=function(ba){ba instanceof FocusEvent?this._geocoder._lbShown_f=!0:this._geocoder._lbShown_g=!0;b._createLocateButton(this._geocoder,!0)},r=function(ba){ba instanceof FocusEvent?this._geocoder._lbShown_f=!1:this._geocoder._lbShown_g=!1;clearTimeout(this._destroyTimeout);this._destroyTimeout=
setTimeout(l.hitch(this,function(){this._geocoder._lbShown_lb||this._geocoder._lbShown_f||b._destroyLocateButton(this._locateButton)}),400)},A=function(){this._geocoder._lbShown_g=!0;clearTimeout(this._destroyTimeout);this._destroyTimeout=setTimeout(l.hitch(this,function(){""===this.value?b._createLocateButton(this._geocoder,!0):b._destroyLocateButton(this._locateButton)}),400)},x=function(){this._geocoder._lbShown_lb=!0;clearTimeout(this._geocoder._destroyTimeout)},S=function(){this._geocoder._lbShown_lb=
!1;clearTimeout(this._geocoder._destroyTimeout);this._geocoder._destroyTimeout=setTimeout(l.hitch(this,function(){this._geocoder._lbShown_g||this._geocoder._lbShown_f||b._destroyLocateButton(this._geocoder.inputNode._locateButton)}),400)},X=0;X<this.geocoders.length;X++){var Z=this.geocoders[X];Z&&Z.inputNode&&(Z.inputNode._geocoder=Z,Z._onMouseEnter=g(Z.inputNode,c.enter,e),Z._onMouseOut=g(Z.inputNode,[c.leave,"blur"],r),Z._onKeyPress=g(Z.inputNode,"keydown",A),Z.inputNode._locateButton&&(Z=Z.inputNode._locateButton,
Z._onMouseEnter=g(Z.domNode,c.enter,x),Z._onMouseOut=g(Z.domNode,c.leave,S)))}},_createLocateButton:function(b,e,r){var A=new y;b.inputNode._locateButton&&b.inputNode._locateButton._locating?A.resolve():C(["./LocateButton"],l.hitch(this,function(x){this._destroyLocateButton(b.inputNode._locateButton);if(b&&!this._solveInProgress){var S=H.create("div",{},b.domNode);M.add(b.domNode,this._css.stopsInnerGeocoderClass);var X=new x({map:this.map,highlightLocation:!1,centerAt:!1,setScale:!1,useTracking:!1},
S);X.startup();b.inputNode._locateButton=X;X.domNode._geocoder=b;this._setLocateButtonVisibilityEvents();x=l.hitch(this,function(){X._locating=!0;b.set("value","");b.inputNode.placeholder=L.widgets.directions.retrievingMyLocation.toUpperCase()});X._onBeforeLocate=g(X._locateNode,B,x);X._onLocate=g(X,"locate",l.hitch(this,function(Z){X._locating=!1;Z.graphic?(e&&this._destroyLocateButton(b.inputNode._locateButton),this.updateStop(new u(Z.graphic.geometry),K.indexOf(this.geocoders,b)).then(l.hitch(this,
function(){1<this.stopGraphics.length?this.getDirections().always(function(){A.resolve(Z)}):A.resolve(Z)}))):(b.set("value",""),b.inputNode.placeholder=L.widgets.directions.myLocationError.toUpperCase(),console.error(Z.error),A.reject(Z.error))}));r?(x(),X.locate().then(null,A.reject)):A.resolve()}else A.resolve()}));return A.promise},_destroyLocateButton:function(b){if(b){var e=b.domNode._geocoder;clearTimeout(e._destroyTimeout);b._locating?e._destroyTimeout=setTimeout(l.hitch(this,function(){e._lbShown_lb||
e._lbShown_f||this._destroyLocateButton(b)}),100):(b.clear(),b._onBeforeLocate.remove(),b._onLocate.remove(),b._onMouseEnter&&b._onMouseEnter.remove(),b._onMouseOut&&b._onMouseOut.remove(),b.destroy(),e.inputNode&&(e.inputNode._locateButton=null,e._setPlaceholder(e.activeSourceIndex)))}},_sortStops:function(){this.stops.length&&(this.stops.sort(l.hitch(this,function(b,e){for(var r,A,x=0;x<this.get("geocoders").length;x++)this.geocoders[x]._stopReference===b?r=x:this.geocoders[x]._stopReference===
e&&(A=x);return r>A?1:A>r?-1:0})),this._setStops())},_getCandidate:function(b){var e=new y,r=typeof b;b?"object"===r&&b.hasOwnProperty("feature")&&b.hasOwnProperty("name")?(b.feature.attributes&&void 0!==b.feature.attributes.displayName&&!this._isStopAWaypoint(b)&&(b.name=b.feature.attributes.displayName,b.feature.attributes.Name=this._userDefinedStopName),b.name=this._isStopAWaypoint(b)?this._waypointName:String(b.name),"point"!==b.feature.geometry.type&&(b.feature.geometry=new n([b.feature.geometry.x,
b.feature.geometry.y],this.map.spatialReference)),e.resolve(b)):"object"===r&&b.hasOwnProperty("address")&&b.hasOwnProperty("location")?(b=this._globalGeocoder._hydrateResult(b),e.resolve(b)):"object"!==r||!b.hasOwnProperty("name")||null!==b.name&&""!==b.name?b instanceof u&&b.attributes&&(void 0!==b.attributes.Name||b.attributes.isWaypoint)?(r=this._addStopWrapperToGraphic(b,b.attributes.isWaypoint?this._waypointName:String(b.attributes.Name)),String(b.attributes.Name)&&(r.feature.attributes.Name=
this._userDefinedStopName),e.resolve(r)):("object"===r&&b.hasOwnProperty("name")&&(b=String(b.name)),this._reverseGeocode(b).then(e.resolve,e.reject)):e.resolve(l.clone(this._emptyStop)):e.resolve(l.clone(this._emptyStop));return e.promise},_reverseGeocode:function(b){var e=new y,r,A=b.geometry?b.geometry:b;if(this._globalGeocoder){var x=l.hitch(this,function(ba){var ha=new y,ia=500;if(this.map){var ma=this.map.toScreen(A);ma.x+=Ea._calculateClickTolerance([ba]);this.map.spatialReference.isWebMercator()?
(ia=Math.abs(this.map.toMap(ma).x-A.x),ha.resolve(ia)):4326===this.map.spatialReference.wkid?(ia=Math.abs(xa.geographicToWebMercator(this.map.toMap(ma)).x-xa.geographicToWebMercator(A).x),ha.resolve(ia)):this._geometryService&&(ba=new Pa,ba.distanceUnit=Ba.UNIT_METER,ba.geometry1=A,ba.geometry2=this.map.toMap(ma),this._geometryService.distance(ba,function(na){ia=na;ha.resolve(ia)},function(){ha.resolve(ia)}))}return ha.promise}),S=[],X=this._globalGeocoder.sources,Z=function(){X[r].featureLayer&&
S.push(x(X[r].featureLayer).then(l.hitch(X[r],function(ba){this.searchQueryParams=l.mixin(this.searchQueryParams,{distance:ba})})))};if("all"===this._globalGeocoder.activeSourceIndex)for(r=0;r<X.length;r++)Z();else r=this._globalGeocoder.activeSourceIndex,Z();R(S).always(l.hitch(this,function(){this._globalGeocoder.search(A).then(l.hitch(this,function(ba){var ha=!1;if(ba){var ia=null;for(r=0;r<this._globalGeocoder.sources.length;r++)if(ba[r]&&ba[r].length){var ma=ba[r];break}if(ma.length&&(ha=!0,
ia=ma[0],this._globalGeocoder.sources[r].featureLayer))for(ba=Number.POSITIVE_INFINITY,r=0;r<ma.length;r++){ma[r]=this._toPointGeometry(ma[r]);var na=ya.geodesicLengths([new W({paths:[[xa.xyToLngLat(A.x,A.y),xa.xyToLngLat(ma[r].feature.geometry.x,ma[r].feature.geometry.y)]],spatialReference:{wkid:this.map.spatialReference.wkid}})],"esriMeters")[0];ba>na&&(ba=na,ia=ma[r])}(ia=this._decorateEmptyAGOLGeocoderResponse(ia))&&""!==ia.name&&null!==ia.name&&void 0!==ia.name?(ia.name=String(ia.name),isNaN(A.x)||
isNaN(A.y)||this.map.spatialReference.wkid!==A.spatialReference.wkid?!ia.feature.geometry||isNaN(ia.feature.geometry.x)||isNaN(ia.feature.geometry.y)?(this._showMessage(L.widgets.directions.error.locator),e.reject(Error(L.widgets.directions.error.locator))):e.resolve(ia):(ia.feature.geometry=A,e.resolve(ia))):ha=!1}ha||(b instanceof n?b=new u(b):b instanceof Array&&(b=new u(new n(b[0],b[1]))),b instanceof u?this._decorateUngeocodedStop(b).then(e.resolve,e.reject):(this._showMessage(L.widgets.directions.error.unknownStop.replace("\x3cname\x3e",
b.toString())),e.reject(Error(L.widgets.directions.error.unknownStop.replace("\x3cname\x3e",b.toString())))))}))}))}else this._showMessage(L.widgets.directions.error.locatorUndefined),e.reject(Error(L.widgets.directions.error.locatorUndefined));return e.promise},_updateStop:function(b,e,r){var A=new y;this.stops&&this.stops[e]?b instanceof u&&b.attributes&&b.attributes.isWaypoint&&(!e||e===this.stops.length-1||2>this._getStopCount())?(this._showMessage(L.widgets.directions.error.waypointShouldBeInBetweenStops),
A.reject(Error(L.widgets.directions.error.waypointShouldBeInBetweenStops))):this._getCandidate(b).then(l.hitch(this,function(x){var S=x.feature;S=S?S.geometry:null;var X=this.stops[e].feature;X=X?X.geometry:null;S=S&&X&&(S.x!==X.x||S.y!==X.y)||!S&&X;this.stops[e]=x;this.geocoders[e]||this._createGeocoder(x,e);X=this.geocoders[e];X._stopReference=x;X._tr.style.display=this._isStopAWaypoint(x)?"none":"";X.value=x.name;X.inputNode&&(X.inputNode.value=x.name);S&&this.autoSolve&&1<this._getStopCount()+
this._getWaypointCount()||r?this._getDirections().then(A.resolve,A.reject):(this._setStops(),A.resolve(x))}),l.hitch(this,function(x){A.reject(x)})):(this._showMessage(L.widgets.directions.error.couldNotUpdateStop),A.reject(Error(L.widgets.directions.error.couldNotUpdateStop)));this._optionsMenu();return A.promise},_renderDirections:function(){var b=this.get("directions");if(this._resultsNode){var e='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';e+=this._renderDirectionsSummary(b);
e+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';e+='\x3cdiv class\x3d"'+this._css.routesClass+'"\x3e';e+=this._renderDirectionsTable(b);e+="\x3cdiv class\x3d'esriPrintFooter'\x3e"+L.widgets.directions.printDisclaimer+"\x3c/div\x3e";e+="\x3c/div\x3e";this._resultsNode&&(this._resultsNode.innerHTML=e);this._disconnectResults();(b=V("[data-segment]",this._resultsNode))&&b.length&&K.forEach(b,l.hitch(this,function(r){this._resultEvents.push(g(r,c.enter,l.hitch(this,function(){if(!this._focusedDirectionsItem){var A=
parseInt(T.get(r,"data-segment"),10);this.highlightSegment(A)}})));this._resultEvents.push(g(r,"focusout",l.hitch(this,function(){this._focusedDirectionsItem=null;this.unhighlightSegment(!0)})));this._resultEvents.push(g(r,c.leave,this.unhighlightSegment));this._resultEvents.push(g(r,"click, keydown",l.hitch(this,function(A){A&&("click"===A.type||"keydown"===A.type&&A.keyCode===f.ENTER)&&(this._focusedDirectionsItem!==r?this.selectSegment(parseInt(T.get(r,"data-segment"),10)):(r.blur(),this.map.infoWindow.hide(),
this._focusedDirectionsItem=null,this.unhighlightSegment(!0)))})))}))}},_renderDirectionsSummary:function(b){var e="",r=l.hitch(this,function(){for(var X={},Z=this._getDirectionsTimeAttribute()||{},ba=this._getTimeNeutralAttribute()||{},ha=0,ia=0,ma=this.get("stops"),na=ma.length-1;0<=na;na--)if(null!==ma[na].feature.attributes.ArriveCurbApproach){X=ma[na].feature.attributes;break}for(var ta in X)X.hasOwnProperty(ta)&&(ta==="Cumul_"+Z.name&&(ha=X[ta]),ta==="Cumul_"+ba.name&&(ia=X[ta]));X="esriTrafficLabelHidden";
ma=L.widgets.directions.noTraffic;na=b.totalTime-b.totalDriveTime;na=(ia-this._convertCostValue(na,Z.units,ba.units))/(ha-na||1);0<na&&.8>na?(X="esriTrafficLabelHeavy",ma=L.widgets.directions.heavyTraffic):1===na?(X="esriTrafficLabelNone",ma=L.widgets.directions.noTraffic):1.25<na&&(X="esriTrafficLabelLight",ma=L.widgets.directions.ligthTraffic);ba=this._formatTime(ia,!1,ba.units);return{label:ma,labelClass:X,ratio:na,noTrafficCostStr:1!==na&&ba?ba+" "+L.widgets.directions.onAverage+"\x3cbr\x3e":
"",trafficCost:ha,noTrafficCost:ia,timeAtt:Z}});if(b.totalLength||b.totalTime){r=r();var A=this._getImpedanceAttribute();e+="\x3cdiv class\x3d'"+this._css.resultsSummaryClass+"' data-full-route\x3d'true'\x3e\x3cdiv class\x3d'esriImpedanceCost'\x3e";if(this._isTimeUnits(A.units))e+=this._formatTime(r.trafficCost,!0,r.timeAtt.units)+"\x3cdiv class\x3d'esriImpedanceCostHrMin'\x3e\x3cdiv class\x3d'esriImpedanceCostHr'\x3e"+L.widgets.directions.time.hr+"\x3c/div\x3e\x3cdiv class\x3d'esriImpedanceCostMin'\x3e"+
L.widgets.directions.time.min+"\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+(r.noTrafficCost?"\x3cdiv class\x3d'esriTrafficLabel "+r.labelClass+"'\x3e"+r.label+"\x3c/div\x3e"+r.noTrafficCostStr:"")+this._formatDistance(b.totalLength);else{A=(A=L.widgets.directions.units[this.directionsLengthUnits])?A.name:"";var x=this.serviceDescription&&10.6<=this.serviceDescription.currentVersion,S=this.directions.features[0].attributes;e+=J.format(b.totalLength,{places:1})+"\x3cdiv class\x3d'esriImpedanceCostDist'\x3e"+
A+"\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'esriOtherCosts'\x3e"+(r.noTrafficCost&&x?"\x3cdiv class\x3d'esriTrafficLabel "+r.labelClass+"'\x3e"+r.label+"\x3c/div\x3e"+r.noTrafficCostStr:"")+this._formatTime(b.totalTime)+" "+("none"!==this.startTime&&r.noTrafficCost&&x?L.widgets.directions.atTheMoment+" "+this._toSpatiallyLocalTimeString(S.arriveTimeUTC,S.ETA):"")}e+="\x3c/div\x3e\x3c/div\x3e"}return e},_renderDirectionsTable:function(b){for(var e=0,r=0,A=0,x='\x3ctable summary\x3d"'+b.routeName+
'"\x3e\x3ctbody role\x3d"menu"\x3e',S=0;S<b.features.length;S++){var X=b.features[S].attributes;"esriDMTDepart"===X.maneuverType&&(r=A=0);A+=X.length;r+=X.time;e+=X.time;x+=this._renderDirectionsItemTR(b.features[S],A,r,e)}return x+"\x3c/tbody\x3e\x3c/table\x3e"},_renderDirectionsItemTR:function(b,e,r,A){var x=this.directions,S=x?K.indexOf(x.features,b):-1;A="";var X=this._css.routeClass,Z=b._associatedStopWithReturnToStart&&b._associatedStopWithReturnToStart.attributes,ba=b.attributes;if(-1<S){ba&&
(ba.step=S+1);ba.maneuverType&&(X+=" "+ba.maneuverType);Z&&null===Z.ArriveCurbApproach&&null!==Z.DepartCurbApproach?X+=" "+this._css.routeOriginClass:Z&&null!==Z.ArriveCurbApproach&&null===Z.DepartCurbApproach&&(X+=" "+this._css.routeDestinationClass+" "+this._css.routeLastClass);A+='\x3ctr tabindex\x3d"0" role\x3d"menuitem" class\x3d"'+X+" "+this._css.routeZoomClass+'" data-segment\x3d"'+S+'"\x3e';A+='\x3ctd class\x3d"'+this._css.routeIconColumnClass+'"\x3e';A+='\x3cdiv class\x3d"'+this._css.routeIconClass+
'"\x3e';A+=this._getLetter(b._associatedStop);A=A+'\x3c/div\x3e\x3c/td\x3e\x3ctd class\x3d"'+(this._css.routeTextColumnClass+'"\x3e');A+='\x3cdiv class\x3d"'+this._css.routeInfoClass+'"\x3e';A+='\x3cdiv class\x3d"'+this._css.routeTextClass+'"\x3e';b=(x.strings[S]||[]).slice();if("esriDMTDepart"===ba.maneuverType||"esriDMTStop"===ba.maneuverType)for(x=0;x<this.stops.length;x++)this.stops[x]&&this.stops[x].name&&b.push({string:this.stops[x].name});if(b){X=ba.text;for(x=0;x<b.length;x++)X=this._boldText(X,
b[x].string);ba.formattedText=X}else ba.formattedText=ba.text;if("esriDMTStop"===ba.maneuverType&&(e||r)||"esriDMTDepart"===ba.maneuverType&&0===S)e=this._formatDistance(e-ba.length,!0),r=this._formatTime(r-ba.time),S=this._formatTime(ba.time),b=this._formatDistance(ba.length,!0),ba.formattedText+="\x3cdiv class\x3d'esriRouteTextColumnCumulative'\x3e"+e+(e&&r?" \x26middot; ":"")+r+(e||r?"\x3cbr\x3e":"")+(S?L.widgets.directions.serviceTime+":\x26nbsp;"+S:"")+(S&&b?"\x3cbr\x3e":"")+(b?L.widgets.directions.serviceDistance+
":\x26nbsp;"+b:"")+"\x3c/div\x3e";A+="\x3cstrong\x3e"+J.format(ba.step)+".\x3c/strong\x3e "+ba.formattedText;A+="\x3c/div\x3e";e=this._formatDistance(ba.length,!0);r=this._formatTime(ba.time);"esriDMTStop"!==ba.maneuverType&&"esriDMTDepart"!==ba.maneuverType||!this.routeParams.startTime||-22091616E5===ba.ETA?e&&(A+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e',A+=e,r&&(A+="\x26nbsp;\x26middot;\x3cwbr\x3e\x26nbsp;"+r),A+="\x3c/div\x3e"):A+='\x3cdiv class\x3d"'+this._css.routeLengthClass+
'"\x3e'+this._toSpatiallyLocalTimeString(ba.arriveTimeUTC,ba.ETA)+"\x3c/div\x3e";A+="\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e"}return A},_toSpatiallyLocalTimeString:function(b,e){var r=new Date(e),A=new Date(r.getTime()+6E4*r.getTimezoneOffset());A=G.date.locale.format(A,{selector:"time"});var x="";b?(e=(e-b)/1E3/60/60,b=Math.floor(e),e=60*(e-b),b=L.widgets.directions.GMT+(0>b?"":"+")+J.format(b,{pattern:"00"})+J.format(e,{pattern:"00"}),x=A+" "+b):x="now"===this.startTime?G.date.locale.format(r,{selector:"time"}):
A;return x},_addStopWrapperToGraphic:function(b,e){return{extent:new N({xmin:b.geometry.x-.25,ymin:b.geometry.y-.25,xmax:b.geometry.x+.25,ymax:b.geometry.y+.25,spatialReference:b.geometry.spatialReference}),feature:b,name:e}},_clearBarriersGraphics:function(){this._barriersLayer.clear();this._polylineBarriersLayer.clear();this._polygonBarriersLayer.clear()},_showBarriers:function(){this._clearBarriersGraphics();var b=this.routeParams,e=b.polylineBarriers&&b.polylineBarriers.features||[],r=b.polygonBarriers&&
b.polygonBarriers.features||[];K.forEach(b.barriers&&b.barriers.features||[],l.hitch(this,function(A){this._barriersLayer.add(A)}));K.forEach(e,l.hitch(this,function(A){this._polylineBarriersLayer.add(A)}));K.forEach(r,l.hitch(this,function(A){this._polygonBarriersLayer.add(A)}));this._barriersLayer.refresh();this._polylineBarriersLayer.refresh();this._polygonBarriersLayer.refresh()},_showRoute:function(b){this._clearDisplayAfterSolve();var e=b.routeResults[0].directions,r=new y;if(e){this.set("solveResult",
b);this.set("directions",e);var A=b.routeResults[0].stops,x,S;if(A&&A.length){var X=[];for(x=0;x<A.length;x++){var Z=A[x];Z.attributes.isWaypoint=Z.attributes.Name===this._waypointName||Z.attributes.isWaypoint;Z=this._addStopWrapperToGraphic(Z,Z.attributes.Name);this.stops[x]&&this.stops[x].feature&&this.stops[x].feature.attributes&&this.stops[x].feature.attributes.Name===this._userDefinedStopName&&(Z.feature.attributes.Name=this._userDefinedStopName);this._returnToStartStop&&this._returnToStartStop._resultsStopIndex===
x?this._returnToStartStop=Z:X.push(Z)}if(this.stops.length>X.length)for(x=0;x<this.stops.length;x++)this.stops[x].feature||""!==this.stops[x].name||X.splice(x,0,this._emptyStop);this.stops=X;for(x=0;x<this.stops.length;x++)this._updateStop(this.stops[x],x);this._setStops();this._setMenuNodeValues()}this.set("mergedRouteGraphic",new u(e.mergedGeometry,this.get("routeSymbol")));A=[];X=[];for(x=Z=0;x<e.featuresWithWaypoints.length;x++){var ba=e.featuresWithWaypoints[x];if("esriDMTDepart"===ba.attributes.maneuverType)for(S=
0;S<this.stops.length;S++)if(this.stops[S].feature===ba._associatedStop){Z=S+1;break}ba.setSymbol(this.get("routeSymbol"));this._routeLayer.add(ba);A.push(ba);(S=ba.getDojoShape())&&S.moveToBack();S=new u(ba.geometry,this._symbolEventPaddingDirections,ba.attributes);S._nextStopIndex=Z-.5;S._isSnapFeature=!0;ba._associatedSnapFeature=S;this._waypointsEventLayer.add(S);"esriDMTDepart"!==ba.attributes.maneuverType&&(S=ba.geometry.getPoint(0,0))&&(S=new u(S,this.maneuverSymbol),S._directionsFeature=ba._associatedFeatureNoWaypoints,
X.push(S),this._waypointsEventLayer.add(X[X.length-1]))}this.set("displayedRouteGraphics",A);this.set("displayedManeuverPointGraphics",X);this._renderDirections();for(x=0;x<this.stops.length;x++)if(this._isStopAWaypoint(this.stops[x])&&this._modifiedWaypointIndex===x){for(S=0;S<e.featuresWithWaypoints.length;S++)if(A=e.featuresWithWaypoints[S],A._associatedStop===this.stops[x].feature){if("esriDMTStop"===A.attributes.maneuverType||"esriDMTDepart"===A.attributes.maneuverType)this.stops[x].feature.geometry.x=
A.geometry.paths[0][0][0],this.stops[x].feature.geometry.y=A.geometry.paths[0][0][1];break}this._modifiedWaypointIndex=null;break}I.set(this._savePrintBtnContainer,"display","inline-block");this.onDirectionsFinish(b)}else b=b.routeResults[0].route,b.setSymbol(this.routeSymbol),this._routeLayer.add(b),this._incrementalRouteSegment=b;r.resolve();this._moveLayersToFront();this.createRouteSymbols();return r.promise},_setGeocodersStopReference:function(){if(this.geocoders)for(var b=0;b<this.geocoders.length;b++)this.geocoders[b]&&
this.stops[b]&&(this.geocoders[b]._stopReference=this.stops[b])},_setStops:function(){this._setGeocodersStopReference();this.createRouteSymbols();this._set("stops",this.stops);this.onStopsUpdate(this.stops)},_getCandidates:function(b){var e=[];if(b&&b.length){for(var r=0;r<b.length;r++)e.push(this._getCandidate(b[r]));return R(e)}b=new y;b.resolve([]);return b.promise},_clearResultsHTML:function(){this._resultsNode.innerHTML="";I.set(this._savePrintBtnContainer,"display","none")},_showSegmentPopup:function(b){if(b&&
this.get("showSegmentPopup")&&this.get("map").infoWindow){var e=b.geometry.getPoint(0,0);b=new u(e,null,b.attributes,this.get("segmentInfoTemplate"));var r=this.get("map").infoWindow;r.setFeatures([b]);r.show(e)}},_addStopButton:function(){this.addStop().then(l.hitch(this,function(){this.get("focusOnNewStop")&&this.geocoders[this.stops.length-1].focus()}))},_sortGeocoders:function(){var b=this._dnd.getAllNodes();this.geocoders.sort(l.hitch(this,function(r,A){return r.domNode&&r.domNode.parentNode&&
r.domNode.parentNode.parentNode&&A.domNode&&A.domNode.parentNode&&A.domNode.parentNode.parentNode?K.indexOf(b,r.domNode.parentNode.parentNode)>K.indexOf(b,A.domNode.parentNode.parentNode)?1:-1:0}));this.stops.length===this.geocoders.length&&this._sortStops();for(var e=0;e<this.geocoders.length;e++)this.geocoders[e]&&this.geocoders[e].inputNode&&(this.geocoders[e].inputNode.title=L.widgets.directions.stopNoTitle+(e+1));this._setLocateButtonVisibilityEvents()},_disconnectResults:function(){if(this._resultEvents&&
this._resultEvents.length)for(var b=0;b<this._resultEvents.length;b++)this._resultEvents[b]&&this._resultEvents[b].remove();this._resultEvents=[]},_formatArbitraryCostsForRouteTooltip:function(b){var e="",r;for(r in b)if(0===r.indexOf("Total_")&&b.hasOwnProperty(r)){var A=this._getCostAttribute(r.substr(6));A&&(e+=this._isTimeUnits(A.units)?this._formatTime(b[r],!1,A.units):this._formatDistance(b[r],!0,A.units),e+=e?" \x26middot; ":"")}e&&(e=L.widgets.directions.toNearbyStops+": \x3cb\x3e"+e.substr(0,
e.length-10)+"\x3c/b\x3e");return e},_formatTime:function(b,e,r){r||(r=(this._getDirectionsTimeAttribute()||{}).units);var A="";r=Math.round(this._convertCostValue(b,r,"esriNAUMinutes"));b=Math.floor(r/60);r=Math.floor(r%60);e?A=J.format(b,{pattern:100>b?"00":"000"})+":"+J.format(r,{pattern:"00"}):(b&&(A+=b+" "+L.widgets.directions.time.hr+" "),A+=b||r?r+" "+L.widgets.directions.time.min:"");return A},_formatDistance:function(b,e,r){r||(r=this.directionsLengthUnits);var A=this.directionsLengthUnits,
x=L.widgets.directions.units[A],S=A.replace("esri","").toLowerCase();b=this._convertCostValue(b,r,A);x&&(S=e?x.abbr:x.name);return b?J.format(b,{locale:"root",places:2})+" "+S:""},_projectToGeographic:function(b){var e=new y;if(!b)return e.reject("Directions:: 'geometry' is not defined.",{geometry:b}),e.promise;if(4326==b.spatialReference.wkid)return e.resolve(b),e.promise;if(!this._geometryService)return e.reject("Directions:: Geometry service is not defined."),e.promise;var r=new $a;r.outSR=new ka(4326);
r.geometries=[b];this._geometryService.project(r).then(function(A){e.resolve(A&&A[0])},e.reject);return e.promise},_createToolbars:function(){this.editToolbar||(this.editToolbar=new Ya(this.map));this.drawToolbar||(this.drawToolbar=new Za(this.map),L.toolbars.draw.freehand=L.widgets.directions.lineBarrierFreehand,this.drawToolbar.onDrawComplete=l.hitch(this,function(b){var e=new u(b.geometry,null,{BarrierType:0});this._projectToGeographic(b.geographicGeometry||b.geometry).then(l.hitch(this,function(r){1<
ya.geodesicLengths([r],Q.METERS)[0]&&(this._polylineBarriersLayer.add(e),this.routeParams.polylineBarriers||(this.routeParams.polylineBarriers=new ua),this.routeParams.polylineBarriers.features.push(e),this._clearStopsStatusAttr(),this.getDirections(!0))}))}))},_destroyGlobalGeocoder:function(){this._globalGeocoder&&(this._globalGeocoder.destroy(),this._globalGeocoder=null)},_createGlobalGeocoder:function(){var b=new y;this._globalGeocoder=new ab(this.get("searchOptions"));g.once(this._globalGeocoder,
"load",b.resolve,b.reject);this._globalGeocoder.startup();return b.promise},_init:function(){var b=new y;this.set("loaded",!1);this._enableButton(this._getDirectionsButtonNode,!1);I.set(this._saveAsButton,"display","none");this.clearMessages();if(this.get("map").loaded)this._configure().always(b.resolve);else g.once(this.get("map"),"load",l.hitch(this,function(){this._configure().always(b.resolve)}));return b.promise},_setDefaultStops:function(){var b=new y;this.defaults.stops&&this.defaults.stops.length?
this._updateStops(this.defaults.stops).then(l.hitch(this,function(){this._removeEmptyStops();b.resolve()}),b.reject):b.resolve();return b.promise},_configure:function(){var b=new y;this._handle&&this._handle._remove();this._createDnD();this._createDepartAtControls();this._setSearchOptions();this._createGlobalGeocoder().then(l.hitch(this,function(){this._createToolbars();this._usingAGOL()||(this.printTaskUrl=this.geometryTaskUrl=null);this._createGeometryTask();this._createPrintTask();this._showActivateButton();
this._showBarriersButton();this._createTravelModesDDL();this._createSearchSourceDDL();var e=[this._createRouteTask(),this._setDefaultStops()];R(e).then(l.hitch(this,function(){this._setDefaultUnits();this._setTrafficOptions();this._setMenuNodeValues();this._setupEvents();var r=this.directionsLanguage||this.userOptions.routeParams&&this.userOptions.routeParams.directionsLanguage||G.locale.toLowerCase();this._setDirectionsLanguageByLocale(r);this._setupTravelModes().then(l.hitch(this,function(){this.set("loaded",
!0);this.onLoad();b.resolve(!0)}),function(A){b.reject(A)})}),function(r){b.reject(r)})}),function(e){b.reject(e)});this._naRouteSharing=null;return b.promise},_setDirectionsLanguageByLocale:function(b){var e=this.serviceDescription.directionsSupportedLanguages,r=function(x){if(e)for(var S=0;S<e.length;S++)if(e[S].toLowerCase().substr(0,2)===x)return e[S];return null},A=r(b);A||(b=b.substr(0,2),A=r(b));this.directionsLanguage=A;return this.routeParams.directionsLanguage=A},_getStopSymbol:function(b,
e){var r=b&&(b.feature&&b.feature.attributes||b.attributes),A=this.stopSymbol;r&&(A=this._isStopAWaypoint(b)?this.waypointSymbol:void 0===r.Status||0===r.Status||6===r.Status?null===r.ArriveCurbApproach&&null!==r.DepartCurbApproach?this.get(e?"fromSymbolDrag":"fromSymbol"):null!==r.ArriveCurbApproach&&null===r.DepartCurbApproach?this.get(e?"toSymbolDrag":"toSymbol"):this.get(e?"stopSymbolDrag":"stopSymbol"):this.get(e?"unreachedSymbolDrag":"unreachedSymbol"));return A},_addTrafficLayer:function(){this.trafficLayer&&
!this._trafficLayerAdded&&this.map&&(this.map.addLayer(this.trafficLayer),this.trafficLayer.show(),this._trafficLayerAdded=!0)},_toggleUnits:function(b){b.target===this._useMilesNode?this.setDirectionsLengthUnits(Q.MILES):b.target===this._useKilometersNode&&this.setDirectionsLengthUnits(Q.KILOMETERS)},_toggleCheckbox:function(b){var e=T.get(b.target,"checked");b.target===this._findOptimalOrderNode?this.set("optimalRoute",e):b.target===this._useTrafficNode?this.set("traffic",e):b.target===this._returnToStartNode&&
this.set("returnToStart",e)},_isStopLocated:function(b){return b&&b.feature&&b.feature.attributes&&(!b.feature.attributes.Status||6===b.feature.attributes.Status)},_configureRouteOptions:function(){var b=this.get("routeParams"),e;this.get("directionsLengthUnits")?b.directionsLengthUnits=this.get("directionsLengthUnits"):this.set("directionsLengthUnits",b.directionsLengthUnits);b.findBestSequence=this.get("optimalRoute");if(b.findBestSequence)for(b.preserveFirstStop=this._isStopLocated(this.stops[0]),
b.preserveLastStop=!this.returnToStart&&this._isStopLocated(this.stops[this.stops.length-1])||this.returnToStart&&this._isStopLocated(this.stops[0]),e=0;e<this.stops.length;)this._isStopAWaypoint(this.stops[e])?this._removeStop(e,!0,!0):e++;if(!this.returnToStart&&this.stops.length&&this._isStopAWaypoint(this.stops[this.stops.length-1]))for(e=this.stops.length-1;0<e;)this._isStopAWaypoint(this.stops[e])&&this._removeStop(e,!0,!0),e--;if(this._isTimeUnits(this._getImpedanceAttribute().units)||this.serviceDescription&&
10.6<=this.serviceDescription.currentVersion)if(b.useTimeWindows=!0,"now"===this.startTime)b.timeWindowsAreUTC=!0,b.startTimeIsUTC=!0,b.startTime=new Date;else if("none"===this.startTime)b.startTime=null;else{b.timeWindowsAreUTC=!1;b.startTimeIsUTC=!1;var r=this._departAtTime,A=6E4*r.getValue().getTimezoneOffset();r=new Date(r.getValue().getTime()+this._departAtDate.getValue().getTime()-A);r=new Date(r.getTime()-6E4*r.getTimezoneOffset());b.startTime=r}else b.startTime=null,b.useTimeWindows=!1;r=
this._getImpedanceAttribute();A=this._getTimeNeutralAttribute();var x=this._getDirectionsTimeAttribute();e=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames;A&&-1===K.indexOf(e,A.name)&&e.push(A.name);!this._isTimeUnits(r.units)&&this.serviceDescription&&10.6<=this.serviceDescription.currentVersion&&x&&-1===K.indexOf(e,x.name)&&e.push(x.name);this.routeParams.accumulateAttributes=e;b.returnStops=!0;x=[];for(e=0;e<this.stopGraphics.length;e++)if(this.stopGraphics[e]&&
(x.push(new u(this.stopGraphics[e].toJson())),e)){var S=x[0].attributes,X=x[e].attributes;for(Z in X)X.hasOwnProperty(Z)&&!S.hasOwnProperty(Z)&&(S[Z]=null)}if(this.get("returnToStart")&&this.stopGraphics.length&&this._isStopLocated(this.stops[0])){var Z=new u(this.stopGraphics[0].toJson());this._returnToStartStop=this._addStopWrapperToGraphic(Z,Z.attributes.Name);x.push(Z)}else this._returnToStartStop=null;b.stops.features=x;if(A)for(e=0;e<x.length;e++)x[e].attributes["Attr_"+A.name]=this._convertCostValue(x[e].attributes["Attr_"+
r.name],r.units,A.units);this.set("routeParams",b)},_configureRoute:function(){var b=new y;b.promise.always(l.hitch(this,function(){this._checkMaxStops()}));this.createRouteSymbols();this._configureRouteOptions();if(this.routeParams.returnRoutes&&this._incrementalSolveStopRange){var e=this._incrementalSolveStopRange;e.start<e.end?this.routeParams.stops.features=this.routeParams.stops.features.slice(e.start,e.end+1):e.start>e.end&&(this.routeParams.stops.features=this.routeParams.stops.features.slice(e.start,
this.routeParams.stops.features.length-1).concat(this.routeParams.stops.features.slice(0,e.end+1)))}else this._incrementalSolveStopRange=null;var r={},A=this.routeParams.stops.features;for(e=0;e<A.length;e++){var x=A[e].attributes.address;var S=(e===this._handle._index&&!this._handle.attributes.isWaypoint&&this._incrementalSolveStopRange?this._waypointName:x)+"_"+this._stopSequence++;A[e].attributes.Name=S;r[S]=x;delete A[e].attributes.address;delete A[e].attributes.isWaypoint;delete A[e].attributes.Status}this._solveInProgress=
!0;var X={_incrementalSolveStopRange:this._incrementalSolveStopRange};this.routeTask.solve(this.routeParams,l.hitch(this,function(Z){this._solveResultProcessing(Z,r,X).then(b.resolve,b.reject)}),l.hitch(this,function(Z){l.mixin(this,X);this._solveInProgress=!1;for(var ba=0;ba<this.stops.length;ba++)this.stops[ba].feature&&(this.stops[ba].feature.attributes=l.mixin(this.stops[ba].feature.attributes,{Status:5}));this.set("directions",null);this._clearDisplayAfterSolve();this.createRouteSymbols();this._routeTaskError(Z);
b.reject(Z)}));return b.promise},_solveResultProcessing:function(b,e,r){var A=new y;l.mixin(this,r);this._solveInProgress=!1;r=b.routeResults[0];var x=r.directions;r=r.stops;if(x){this._solverMessages=b.messages;var S=function(ia){for(var ma in e)if(ia&&0===x.routeName.indexOf(ma)||!ia&&0<x.routeName.indexOf(ma))return e[ma];return""};var X=S(!0);S=S(!1);x.routeName=(X!==this._waypointName?X:L.widgets.directions.waypoint)+" \u2014 "+(S!==this._waypointName?S:L.widgets.directions.waypoint);for(X=0;X<
x.features.length;X++)if(S=x.features[X].attributes,"esriDMTDepart"===S.maneuverType||"esriDMTStop"===S.maneuverType)for(var Z in e)if(e.hasOwnProperty(Z)&&-1<S.text.indexOf(Z)){S.text=S.text.replace(Z,e[Z]);for(var ba=0;ba<r.length;ba++){var ha=r[ba].attributes;if(ha.Name===Z){l.mixin(x.features[X],{_associatedStop:r[this.returnToStart&&ba===r.length-1?0:ba],_associatedStopWithReturnToStart:r[ba]});if(!ha.ArriveTime&&!ha.ArriveTimeUTC&&S.ETA&&S.arriveTimeUTC){ha.ArriveTime=S.ETA;ha.ArriveTimeUTC=
S.arriveTimeUTC;ba=0;if(0==X&&"esriDMTDepart"===S.maneuverType||0<X&&"esriDMTStop"===S.maneuverType)ba=this._convertCostValue(S.time,(this._getDirectionsTimeAttribute()||{}).units,"milliseconds");ha.DepartTime=ha.ArriveTime+ba;ha.DepartTimeUTC=ha.ArriveTimeUTC+ba}break}}}for(X=0;X<r.length;X++)this._returnToStartStop&&r[X].attributes.Name===this._returnToStartStop.feature.attributes.Name&&(this._returnToStartStop._resultsStopIndex=X),r[X].attributes.Name=e[r[X].attributes.Name];this._directionsPostprocessing(x);
this.traffic&&this._updateMapTimeExtent()}this._showRoute(b).always(l.hitch(this,function(){this._incrementalSolveStopRange=null;A.resolve(b)}));return A.promise},_directionsPostprocessing:function(b){var e,r=function(S,X){var Z=b.features[S]._associatedFeaturesWithWaypoints||[];Z.push(b.featuresWithWaypoints[X]);b.features[S]._associatedFeaturesWithWaypoints=Z;b.featuresWithWaypoints[X]._associatedFeatureNoWaypoints=b.features[S]};var A=l.hitch(this,function(S){return"\x3cdiv class\x3d'"+this.theme+
"'\x3e\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(S._associatedFeatureNoWaypoints)+"\x3c/table\x3e\x3c/div\x3e"});b.featuresWithWaypoints=[];for(e=0;e<b.features.length;e++){var x=new u(b.features[e].toJson());x.setInfoTemplate(new ea({title:this._i18n.widgets.directions.maneuver,content:A}));b.featuresWithWaypoints.push(x);b.featuresWithWaypoints[e]._associatedStop=b.features[e]._associatedStop;b.featuresWithWaypoints[e]._associatedStopWithReturnToStart=b.features[e]._associatedStopWithReturnToStart}b.stringsWithWaypoints=
l.mixin([],b.strings);b.eventsWithWaypoints=l.mixin([],b.events);for(A=e=0;e<b.features.length;)b.features[e]._associatedStop&&b.features[e]._associatedStop.attributes.Name===this._waypointName?(b.features.splice(e,e?2:1),b.strings.splice(e,e?2:1),b.events.splice(e,e?2:1),e&&b.features[e]&&"esriDMTStraight"===b.features[e].attributes.maneuverType?(x=b.features.splice(e,1)[0],b.strings[e-1]=(b.strings[e-1]||[]).concat(b.strings.splice(e,1)[0]||[]),b.strings[e-1].length||(b.strings[e-1]=void 0),b.events[e-
1]=(b.events[e-1]||[]).concat(b.events.splice(e,1)[0]||[]),b.events[e-1].length||(b.events[e-1]=void 0),b.features[e-1].attributes.length+=x.attributes.length,b.features[e-1].attributes.time+=x.attributes.time,b.features[e-1].geometry.paths[0]=b.features[e-1].geometry.paths[0].concat(x.geometry.paths[0]),r(e-1,A++),r(e-1,A++),r(e-1,A++)):(e&&r(e-1,A++),e<b.features.length&&r(e,A++))):(r(e,A++),e++)},_boldText:function(b,e){try{var r=new RegExp("[^\x3cstrong\x3e\x26nbsp;]"+e.replace(/(\||\$|\^|\(|\)|\[|\]|\{|\}|\/|\.|\+|\*|\?|\?)/g,
"\\$1")+"[^\x26nbsp;\x3c/strong\x3e]","g");b=(" "+b+" ").replace(r,"\x3cstrong\x3e\x26nbsp;"+e+"\x26nbsp;\x3c/strong\x3e");b=b.trim()}catch(A){}return b},_clearStopGraphics:function(){if(this.stopGraphics&&this.stopGraphics.length)for(var b=0;b<this.stopGraphics.length;b++)this._stopLayer.remove(this.stopGraphics[b]),this._stopLayer.remove(this.textGraphics[b]);this.set("stopGraphics",[]);this.set("textGraphics",[])},_updateMapTimeExtent:function(){if(this.map){var b=this.directions&&this.directions.features[0]&&
this.directions.features[0].attributes||{},e=(new Date).getTime();e="none"==this.startTime?e:b.arriveTimeUTC||e;this._useTrafficItemNode.title="none"!==this.startTime&&b.arriveTimeUTC?L.widgets.directions.trafficLabelDepartAt+": "+this._toSpatiallyLocalTimeString(b.arriveTimeUTC,b.ETA):"";this._myTimeExtentUpdate=!0;b=new Date(e);this.map.setTimeExtent(new fa(b,b))}},_restoreMapTimeExtent:function(){this.map&&(this._myTimeExtentUpdate=!0,this.map.setTimeExtent(this._externalTimeExtent))},_clearRouteGraphics:function(){for(var b=
this.displayedRouteGraphics,e=this.displayedManeuverPointGraphics,r=this._routeLayer,A=this._waypointsEventLayer,x=0,S=0,X=this._incrementalSolveStopRange?this._incrementalSolveStopRange:{start:0,end:this.stops?this.stops.length:-1};b&&S<b.length;){if(b[S]._associatedStop)for(var Z=0;Z<this.stops.length;Z++)if(this.stops[Z].feature===b[S]._associatedStop){x=Z;break}x>=X.start&&x<X.end||X.start>=X.end&&(x>=X.start||x<X.end)?(r.remove(b[S]),b.splice(S,1)):S++}r.remove(this._incrementalRouteSegment);
this.set("displayedRouteGraphics",b?b:[]);e&&e.length&&K.forEach(e,function(ba){A.remove(ba)});this.set("displayedManeuverPointGraphics",[]);this._waypointsEventLayer.clear();this.unhighlightSegment(!0)},_clearInfoWindow:function(){var b=this.get("map").infoWindow;b&&(b.hide(),b.clearFeatures())},_clearDisplayBeforeSolve:function(){this._toggleSaveMenu(!1);this._clearInfoWindow();this._clearResultsHTML()},_clearDisplayAfterSolve:function(){this._clearStopGraphics();this._clearRouteGraphics();this._clearBarriersGraphics();
this.clearMessages()},_getLetter:function(b){var e=this.alphabet,r="",A=function(X){var Z="";"0123456789"===e||"1234567890"===e?Z=String(X+1):(X=X||0,X>=e.length&&(Z=A(Math.floor(X/e.length)-1),X%=e.length),Z+=e[X]);return Z},x=b instanceof u?l.hitch(this,function(){for(var X=this.get("returnToStart")?0:-1,Z=0;Z<this.stops.length;Z++)if(this.stops[Z].feature===b){X=Z;break}return X})():b;if(-1<x&&e&&e.length){e instanceof Array&&(e=e.toString().replace(/,/g,""));r=-1;for(var S=0;S<=x;S++)r+=this._isStopAWaypoint(this.stops[S])?
0:1;r=A(r)}return r},_solveAndZoom:function(b){if(this.autoSolve)return this._getDirections().then(l.hitch(this,function(){b||this.zoomToFullRoute()}));var e=new y;e.resolve();return e.promise},_setupEvents:function(){this._onEvents.push(g(this.domNode,"[data-blur-on-click]:click",function(){this.blur()}));this._onEvents.push(g(this._dndNode,"[data-reverse-stops]:click, [data-reverse-stops]:keydown",l.hitch(this,function(x){x&&("click"===x.type||"keydown"===x.type&&x.keyCode===f.ENTER)&&this.modifyStopSequence()})));
this._onEvents.push(g(this._printButton,"click, keydown",l.hitch(this,function(x){x&&("click"===x.type||"keydown"===x.type&&x.keyCode===f.ENTER)&&this._printDirections()})));this._onEvents.push(g(this._resultsNode,"[data-full-route]:click, [data-full-route]:keydown",l.hitch(this,function(x){x&&("click"===x.type||"keydown"===x.type&&x.keyCode===f.ENTER)&&this.zoomToFullRoute()})));this._onEvents.push(g(this._dndNode,"[data-remove]:click, [data-remove]:keydown",l.hitch(this,function(x){if(x&&("click"===
x.type||"keydown"===x.type&&x.keyCode===f.ENTER)){var S=V("[data-remove]",this._dndNode);x=K.indexOf(S,x.target);this.removeStop(x)}})));this._onEvents.push(g(this._dndNode,"[data-center-at]:click, [data-center-at]:keydown",l.hitch(this,function(x){if(x&&("click"===x.type||"keydown"===x.type&&x.keyCode===f.ENTER)){var S=V("[data-center-at]",this._dndNode);x=K.indexOf(S,x.target);this.stops[x]&&this.stops[x].feature&&this.stops[x].feature.geometry&&this.map.centerAndZoom(this.stops[x].feature.geometry)}})));
this._onEvents.push(g(this.map,"zoom-end",l.hitch(this,function(){var x=this._segmentGraphics;x&&x[0]&&void 0!==x[0].attributes._index&&this.highlightSegment(x[0].attributes._index,!0)})));this._onEvents.push(g(this._dnd,"Drop",l.hitch(this,function(){this._dnd.sync();this.set("optimalRoute",!1);var x,S=!1,X=[],Z=this._dnd.getAllNodes();for(x=0;x<this.geocoders.length;x++){var ba=K.indexOf(Z,this.geocoders[x]._tr);if(-1<ba&&x!==ba&&x!==ba-1){for(;0<ba&&this._isStopAWaypoint(this.stops[ba]);)ba--;
S=!0;break}}S&&(X=this._markWPsForRemovalAfterUserChangedStopSequence(x,ba));this._sortGeocoders();this.setListIcons();this._removeSomeWaypoints(X);this.stops[ba].name&&this.getDirections()})));this._onEvents.push(g(this._dnd,"DndStart",l.hitch(this,function(){var x=V("body")[0];M.add(x,this._css.dndDragBodyClass);this._removeLocateButtonVisibilityEvents()})));this._onEvents.push(g(this._dnd,"DndDrop, DndCancel",l.hitch(this,function(){var x=V("body")[0];M.remove(x,this._css.dndDragBodyClass);this._setLocateButtonVisibilityEvents()})));
var b=this._handle,e=l.hitch(this,function(x){var S=l.hitch(this,function(Z,ba,ha,ia,ma){var na=b._isShown();b.setGeometry(Z);b._tooltip.style.left=x.screenPoint.x+"px";b._tooltip.style.top=x.screenPoint.y+"px";!na||b._index===ha&&b.attributes.isWaypoint===ia||(b._remove(),na=!1);b.setSymbol(ba);b._index=ha;b._isStopIcon=b._index===Math.floor(b._index);b.attributes.isWaypoint=ia;b._isStopIcon&&(b.attributes.address=this.stopGraphics[ha].attributes.address,b.setInfoTemplate(this.stopGraphics[ha].infoTemplate));
if(this.canModifyWaypoints||b._isStopIcon)na||(this._stopLayer.add(b),(Z=b.getDojoShape())&&Z[ia?"moveToBack":"moveToFront"].call(Z)),this.editToolbar.activate(Ya.MOVE,b);ia=ia?b._isStopIcon?L.widgets.directions.dragWaypoint:this.canModifyWaypoints?L.widgets.directions.dragRoute:"":L.widgets.directions.dragStop;b._showTooltip(ma||ia)});this.unhighlightSegment();if(this.mapClickActive&&this.dragging&&!this._solveInProgress&&!this._moveInProgress&&!b._solveTimeout)if(clearTimeout(b._removeTimeout),
(x.graphic._isStopIcon||x.graphic._isStopLabel)&&!x.graphic.attributes.isWaypoint&&this.canModifyStops||x.graphic._isStopIcon&&x.graphic.attributes.isWaypoint&&this.canModifyWaypoints){var X=x.graphic._isStopLabel?this.stopGraphics[x.graphic._index]:x.graphic;S(X.geometry,this._getStopSymbol(this.stops[X._index],!0),X._index,!0===X.attributes.isWaypoint);this._stopLayer.remove(this.stopGraphics[X._index]);this._stopLayer.remove(this.textGraphics[X._index])}else if(x.graphic._isSnapFeature||x.graphic._isHandle&&
!x.graphic._isStopIcon)this._snappingManager||(this._snappingManager=this.map.snappingManager),this._snappingManager.getSnappingPoint(x.screenPoint).then(l.hitch(this,function(Z){if(!this.maxStopsReached&&!this._moveInProgress&&Z){for(var ba=this.displayedManeuverPointGraphics,ha=null,ia=0;ia<ba.length;ia++)if(ba[ia].geometry.x===Z.x&&ba[ia].geometry.y===Z.y){ha=ba[ia]._directionsFeature;ba=K.indexOf(this.directions.features,ha);-1<ba&&this.highlightSegment(ba);break}S(Z,x.graphic._isHandle?b.symbol:
this.waypointSymbol,x.graphic._isHandle?b._index:x.graphic._nextStopIndex,x.graphic._isHandle?b.attributes.isWaypoint:!0,ha)}}))}),r=l.hitch(this,function(){clearTimeout(b._removeTimeout);b._removeTimeout=setTimeout(b._remove,100);this.unhighlightSegment()}),A=l.hitch(this,function(x){if(this.barrierToolActive){x=x.graphic;var S=this.routeParams,X=S.barriers?K.indexOf(S.barriers.features,x):-1,Z=S.polygonBarriers?K.indexOf(S.polygonBarriers.features,x):-1,ba=S.polylineBarriers?K.indexOf(S.polylineBarriers.features,
x):-1;-1<X&&S.barriers.features.splice(X,1);-1<Z&&S.polygonBarriers.features.splice(Z,1);-1<ba&&S.polylineBarriers.features.splice(ba,1);this._barriersLayer.remove(x);this._polygonBarriersLayer.remove(x);this._polylineBarriersLayer.remove(x);this._clearStopsStatusAttr();this.getDirections(!0)}});this._onEvents.push(this._waypointsEventLayer.on("mouse-move",e));this._onEvents.push(this._waypointsEventLayer.on("mouse-out",r));this._onEvents.push(this._stopLayer.on("mouse-move",e));this._onEvents.push(this._stopLayer.on("mouse-out",
r));this._onEvents.push(this._barriersLayer.on("click",A));this._onEvents.push(this._polylineBarriersLayer.on("click",A));this._onEvents.push(this._polygonBarriersLayer.on("click",A));this._editToolbarEvents();this._watchEvents.push(this.watch("theme",this._updateThemeWatch));this._watchEvents.push(this.watch("canModifyStops",this._updateCanModifyStops));this._watchEvents.push(this.watch("canModifyWaypoints",this._updateCanAddWaypoints));this._watchEvents.push(this.watch("showReturnToStartOption",
this._optionsMenu));this._watchEvents.push(this.watch("showOptimalRouteOption",this._optionsMenu));this._watchEvents.push(this.watch("returnToStart",this._setMenuNodeValues));this._watchEvents.push(this.watch("optimalRoute",this._setMenuNodeValues));this._watchEvents.push(this.watch("startTime",this._setStartTime));this._watchEvents.push(this.watch("traffic",this._setMenuNodeValues));this._watchEvents.push(this.watch("trafficLayer",this._trafficLayerUpdate));this._watchEvents.push(this.watch("routeTaskUrl",
l.hitch(this,function(){this._createRouteTask();this._setTrafficOptions()})));this._watchEvents.push(this.watch("printTaskUrl",l.hitch(this,function(){this._createPrintTask()})));this._watchEvents.push(this.watch("geometryTaskUrl",l.hitch(this,function(){this._createGeometryTask()})));this._watchEvents.push(this.watch("routeParams",l.hitch(this,function(){this._createRouteParams();this._setDefaultUnits()})));this._watchEvents.push(this.watch("searchOptions",l.hitch(this,function(){this._setSearchOptions();
this._createGlobalGeocoder();var x=this.get("searchOptions").sources;if(x)for(var S=0;S<this.geocoders.length;S++)this.geocoders[S].set("sources",x)})));this._watchEvents.push(this.watch("showReverseStopsButton",this.setListIcons));this._watchEvents.push(this.watch("editToolbar",this._editToolbarEvents));this._watchEvents.push(this.watch("showTravelModesOption",this._showTravelModesOption));this._watchEvents.push(this.watch("showMilesKilometersOption",this._showMilesKilometersOption));this._watchEvents.push(this.watch("showClearButton",
this._showClearButton));this._watchEvents.push(this.watch("directionsLengthUnits",this.setDirectionsLengthUnits));this._watchEvents.push(this.watch("directionsLanguage",this.setDirectionsLanguage));this._watchEvents.push(this.watch("mapClickActive",this._activate));this._watchEvents.push(this.watch("barrierToolActive",this._activateBarrierTool));this._watchEvents.push(this.watch("showActivateButton",this._showActivateButton));this._watchEvents.push(this.watch("showBarriersButton",this._showBarriersButton));
this._watchEvents.push(this.watch("showPrintPage",function(){I.set(this._printButton,"display",this.showPrintPage?"inline-block":"none")}));this._watchEvents.push(this.watch("showSaveButton",function(){I.set(this._saveMenuButton,"display",this.showSaveButton&&this.owningSystemUrl?"inline-block":"none")}))},_editToolbarEvents:function(){var b=l.hitch(this,function(r){var A="";if((r=r.routeResults?r.routeResults[0]:null)&&r.route){r=r.route.attributes;var x=this.routeParams.travelMode;if(x){A+="\x3cb\x3e"+
x.name+"\x3c/b\x3e "+L.widgets.directions.toNearbyStops+": ";var S=void 0!==r["Total_"+x.timeAttributeName]?this._formatTime(r["Total_"+x.timeAttributeName],!1,(this._getCostAttribute(x.timeAttributeName)||{}).units):"";A+=(void 0!==r["Total_"+x.distanceAttributeName]?this._formatDistance(r["Total_"+x.distanceAttributeName],!0,(this._getCostAttribute(x.distanceAttributeName)||{}).units):"")+(S?" \x26middot; "+S:"")}else A=this._formatArbitraryCostsForRouteTooltip(r)}this._handle._showTooltip(A)}),
e=l.hitch(this,function(r,A){var x=new y,S=this._handle,X=this.map.toScreen(S._origPoint).offset(r.transform.dx+S.symbol.xoffset,r.transform.dy+S.symbol.yoffset);r.origMapPoint||(r.origMapPoint=this.map.toMap(X));I.set(S._tooltip,"left",X.x+"px");I.set(S._tooltip,"top",X.y+"px");clearTimeout(S._solveTimeout);if(this._solveInProgress||!this._requestQueueTail.isFulfilled())S._solveTimeout=setTimeout(function(){e(r,A).always(x.resolve)},100);else if(S._isStopIcon){X=r.graphic._index;var Z=this.stops[X];
(Z=Z?{name:Z.name,extent:Z.extent,feature:new u(Z.feature.toJson())}:null)?(Z.feature.setGeometry(r.origMapPoint),this._modifiedWaypointIndex=this._isStopAWaypoint(this.stops[X])?X:null,this._incrementalSolveStopRange={start:this.returnToStart?(this.stops.length+X-1)%this.stops.length:Math.max(0,X-1),end:this.returnToStart?(X+1)%this.stops.length:Math.min(this.stops.length-1,X+1)},this.updateStop(Z,X,A).always(l.hitch(this,function(ba){S._solveTimeout=null;ba.routeResults&&b(ba);x.resolve()}))):x.resolve()}else x.resolve();
return x.promise});this._onEvents.push(g(this.editToolbar,"graphic-click",l.hitch(this,function(r){if(r.graphic.attributes.isWaypoint)!r.graphic._isStopIcon||this._moveInProgress||this._solveInProgress||(this._handle._remove(),this._moveInProgress=!0,this.removeStop(r.graphic._index,!0).always(l.hitch(this,function(){this._moveInProgress=!1})));else{var A=this.get("map").infoWindow;A&&(A.setFeatures([r.graphic]),A.show(r.graphic.geometry))}})));this._onEvents.push(g(this.editToolbar,"graphic-move-start",
l.hitch(this,function(r){this._blurGeocoders();this._moveInProgress=!0;this._removeEmptyStops();this.routeParams.returnDirections=!1;this.routeParams.returnRoutes=!0;r=r.graphic;r._origPoint=new n(r.geometry.toJson());r._maxDeviation=0;r._solveHasHappened=!1;this.map.disableMapNavigation()})));this._onEvents.push(g(this.editToolbar,"graphic-move-stop",l.hitch(this,function(r){this.map.enableMapNavigation();this.routeParams.returnDirections=!0;this.routeParams.returnRoutes=!1;if(this._handle._isStopIcon)if(this._handle._solveHasHappened)if(this._handle.attributes.isWaypoint)e(r,
!0).always(l.hitch(this,function(){this._moveInProgress=!1;this._handle._isStopIcon=!0;this._handle._remove();this._showLoadingSpinner()}));else{clearTimeout(this._handle._solveTimeout);this._handle._solveTimeout=null;var A=this.stops[r.graphic._index],x=(A&&A.feature&&A.feature.attributes&&A.feature.attributes.Name)===this._userDefinedStopName,S=A&&A.name;this._reverseGeocode(new u(r.graphic.toJson())).then(l.hitch(this,function(X){x&&(X.name=S,X.feature.attributes.Name=this._userDefinedStopName);
this._setReverseGeocode(X,X.feature.geometry,r.graphic._index).always(l.hitch(this,function(){this._moveInProgress=!1;this._handle._remove();this._showLoadingSpinner()}))}))}else this._moveInProgress=!1;else this._moveInProgress=!1})));this._onEvents.push(g(this.editToolbar,"graphic-move",l.hitch(this,function(r){var A=this._handle,x=r.transform;x.dx&&x.dy&&(r.graphic._maxDeviation=Math.max(A._maxDeviation,Math.sqrt(x.dx*x.dx+x.dy*x.dy)));10<A._maxDeviation&&(A._solveHasHappened=!0,r.graphic===A&&
A.attributes.isWaypoint&&!A._isStopIcon?(this.set("optimalRoute",!1),A._index+=.5,A._isStopIcon=!0,r.graphic._stopIndex=A._index,this._incrementalSolveStopRange={start:this.returnToStart?(this.stops.length+A._index-1)%this.stops.length:Math.max(0,A._index-1),end:this.returnToStart?(A._index+1)%(this.stops.length+1):Math.min(this.stops.length,A._index+1)},this.addStop({name:this._waypointName,feature:new u(A.geometry,A.symbol,{isWaypoint:!0,CurbApproach:3})},r.graphic._stopIndex)):((A=r.graphic.getDojoShape())&&
A.moveToFront(),e(r)))})))},_isStopAWaypoint:function(b){return b&&b.feature&&b.feature.attributes&&b.feature.attributes.isWaypoint},_getStopCount:function(){var b=0,e;for(e=0;e<this.stops.length;e++)b+=!this._isStopAWaypoint(this.stops[e])&&this.stops[e].name?1:0;return b},_getWaypointCount:function(){var b=0,e;for(e=0;e<this.stops.length;e++)b+=this._isStopAWaypoint(this.stops[e])?1:0;return b},_decorateUngeocodedStop:function(b){var e=new y,r=function(x,S){e.resolve({name:void 0===x?L.widgets.directions.unlocatedStop:
x.toFixed(6)+" "+S.toFixed(6),feature:b})};if(b.geometry)if(b.geometry.spatialReference&&4326!==b.geometry.spatialReference.wkid)if(this.map&&this.map.spatialReference&&this.map.spatialReference.isWebMercator()){var A=xa.xyToLngLat(b.geometry.x,b.geometry.y);r(A[0],A[1])}else this._geometryService?(A=new $a,A.outSR=new ka(4326),A.geometries=[b.geometry],this._geometryService.project(A).then(l.hitch(this,function(x){x&&x.length?r(x[0].x,x[0].y):r(b.geometry.x,b.geometry.y)}),l.hitch(this,function(){r()}))):
r(b.geometry.x,b.geometry.y);else r(b.geometry.x,b.geometry.y);else r();return e.promise},_trafficLayerUpdate:function(b,e,r){b=this.get("map");e&&this._trafficLayerAdded&&(b.removeLayer(e),this._trafficLayerAdded=!1);r&&this.get("traffic")&&!this._trafficLayerAdded&&(b.addLayer(r),r.show(),this._trafficLayerAdded=!0)},_routeTaskError:function(b){var e=L.widgets.directions.error.routeTask,r=b.details,A=function(x){return(res=x.match(/(\d+)/))?": "+res[0]:"."};r&&1===r.length&&("The distance between any inputs must be less than 50 miles (80 kilometers) when walking."===
r[0]?e=L.widgets.directions.error.maxWalkingDistance:"Driving a truck is currently not supported outside of North America and Central America."===r[0]?e=L.widgets.directions.error.nonNAmTruckingMode:0===r[0].indexOf("The number of input locations loaded into Barriers")?e=L.widgets.directions.error.tooManyBarriers+A(r[0]):0===r[0].indexOf("The number of input locations loaded into PolygonBarriers")?e=L.widgets.directions.error.tooManyPolygonBarriers+A(r[0]):0===r[0].indexOf("The number of input locations loaded into PolylineBarriers")&&
(e=L.widgets.directions.error.tooManyPolylineBarriers+A(r[0])));this._showMessage(e);this.onDirectionsFinish(b)},_showMessage:function(b,e){var r="";this.messages.push({msg:b,error:!e});if(this.messages.length){r+="\x3cul\x3e";for(var A=0;A<this.messages.length;A++)r+='\x3cli class\x3d"'+(this.messages[A].error?this._css.routesErrorClass:this._css.routesInfoClass)+'"\x3e'+this.messages[A].msg+"\x3c/li\x3e";r+="\x3c/ul\x3e"}this._msgNode&&(this._msgNode.innerHTML=r);if(!e)this.onError(b)},_isTimeUnits:function(b){return"milliseconds"===
b||"esriNAUSeconds"===b||"esriNAUMinutes"===b||"esriNAUHours"===b||"esriNAUDays"===b},_getImpedanceAttribute:function(){return this._getCostAttribute(this.routeParams&&this.routeParams.travelMode&&this.routeParams.travelMode.impedanceAttributeName||this.routeParams.impedanceAttribute||this.serviceDescription.impedance)},_getDirectionsTimeAttribute:function(){return this._getCostAttribute(this.routeParams&&this.routeParams.travelMode&&this.routeParams.travelMode.timeAttributeName||this.routeParams.directionsTimeAttribute||
this.serviceDescription.directionsTimeAttribute)},_getTimeNeutralAttribute:function(){var b=(this._getDirectionsTimeAttribute()||{}).timeNeutralAttributeName;return this._getCostAttribute(b)},_getCostAttribute:function(b){for(var e=this.serviceDescription&&this.serviceDescription.networkDataset.networkAttributes||[],r,A=0;A<e.length;A++)if(e[A].name===b&&"esriNAUTCost"===e[A].usageType){r=e[A];break}return r},_convertCostValue:function(b,e,r){var A=this._isTimeUnits(e),x=this._isTimeUnits(r);e=A?
this._toMinutes(b,e):this._toMeters(b,e);return A===x?x?this._fromMinutes(e,r):this._fromMeters(e,r):b},_toMinutes:function(b,e,r){b=b||0;switch(e){case "milliseconds":b/=Math.pow(6E4,r?-1:1);break;case "esriNAUSeconds":b/=Math.pow(60,r?-1:1);break;case "esriNAUHours":b*=Math.pow(60,r?-1:1);break;case "esriNAUDays":b*=Math.pow(1440,r?-1:1)}return b},_fromMinutes:function(b,e){return this._toMinutes(b,e,!0)},_toMeters:function(b,e,r){b=b||0;switch((e||"").replace("esriNAU","esri")){case "esriInches":b*=
Math.pow(.0254,r?-1:1);break;case "esriFeet":b*=Math.pow(.3048,r?-1:1);break;case "esriYards":b*=Math.pow(.9144,r?-1:1);break;case "esriMiles":b*=Math.pow(1609.344,r?-1:1);break;case "esriNauticalMiles":b*=Math.pow(1851.995396854,r?-1:1);break;case "esriMillimeters":b/=Math.pow(1E3,r?-1:1);break;case "esriCentimeters":b/=Math.pow(100,r?-1:1);break;case "esriKilometers":b*=Math.pow(1E3,r?-1:1);break;case "esriDecimeters":b/=Math.pow(10,r?-1:1)}return b},_fromMeters:function(b,e){return this._toMeters(b,
e,!0)},_createRouteTask:function(){var b=new y;this.set("routeTask",new Ia(this.get("routeTaskUrl")));this._createRouteParams();this.routeTask.getServiceDescription(this.travelModesServiceUrl,this.doNotFetchTravelModesFromOwningSystem).then(l.hitch(this,function(e){e.networkDataset?(this.set("serviceDescription",e),this.set("maxStops",parseInt(this.userOptions.maxStops||e.serviceLimits&&e.serviceLimits.Route_MaxStops||this.defaults.maxStops)),this.defaults.portalUrl?(this.owningSystemUrl=this.defaults.portalUrl,
b.resolve()):this.routeTask.getOwningSystemUrl().then(l.hitch(this,function(r){this.owningSystemUrl=r;b.resolve()}),b.reject)):(this._showMessage(L.widgets.directions.error.cantFindRouteServiceDescription),b.reject(Error(L.widgets.directions.error.cantFindRouteServiceDescription)))}),l.hitch(this,function(){this._showMessage(L.widgets.directions.error.cantFindRouteServiceDescription);b.reject(Error(L.widgets.directions.error.cantFindRouteServiceDescription));this.mapClickActive=!1;this._activate()}));
return b.promise},_createSearchSourceDDL:function(){if(this._globalGeocoder&&this._globalGeocoder.sources&&1<this._globalGeocoder.sources.length){var b=l.hitch(this,function(A){this._searchSourceSelector.domNode.blur();this._globalGeocoder.set("activeSourceIndex",A);for(var x=0;x<this.geocoders.length;x++)this.geocoders[x].set("activeSourceIndex",A);this._truncateSearchSourceIfNeeded()});if(!this._searchSourceSelector){for(var e=[{value:"all",label:L.widgets.Search.main.all,selected:!0}],r=0;r<this._globalGeocoder.sources.length;r++)e.push({value:String(r),
label:this._globalGeocoder.sources[r].name});this._searchSourceSelector=new q({className:"esriSearchSourcesDDL",style:"width:100%;",options:e},this._searchSourceSelectorContainer);this._searchSourceSelector.startup();this._searchSourceSelector.on("change",b);this._searchSourceSelector.domNode.style.width=""}b("all")}else 2>this._globalGeocoder.sources.length&&(this._searchSourceContainerNode.style.display="none")},_createTravelModesDDL:function(){this._travelModeSelector||(this._travelModeSelector=
new q({className:"esriTravelModesDDL",style:"width:100%;"},this._travelModeSelectorContainer),this._travelModeSelector.startup(),this._travelModeSelector._interractive=!0,this._travelModeSelector.on("change",l.hitch(this,function(b){this._travelModeSelector._interractive?this._enqueue(function(){return this._setTravelMode(b).always(l.hitch(this,function(){this._travelModeSelector._interractive=!0}))}):this._travelModeSelector._interractive=!0})))},_setupTravelModes:function(){var b=this.get("serviceDescription"),
e=b.supportedTravelModes,r=new y;if(e&&e.length&&this._travelModeSelector){for(var A=e[0].name,x=[],S=0;S<e.length;S++){for(var X="AUTOMOBILE"===e[S].type?"Driving":"TRUCK"===e[S].type?"Trucking":"WALK"===e[S].type?"Walking":"Other",Z="",ba=b.networkDataset.networkAttributes,ha=0;ha<ba.length;ha++){var ia=ba[ha];if(ia.name===e[S].impedanceAttributeName){if("esriNAUCentimeters"===ia.units||"esriNAUDecimalDegrees"===ia.units||"esriNAUDecimeters"===ia.units||"esriNAUFeet"===ia.units||"esriNAUInches"===
ia.units||"esriNAUKilometers"===ia.units||"esriNAUMeters"===ia.units||"esriNAUMiles"===ia.units||"esriNAUMillimeters"===ia.units||"esriNAUNauticalMiles"===ia.units||"esriNAUYards"===ia.units)Z="Distance";else if("esriNAUDays"===ia.units||"esriNAUHours"===ia.units||"esriNAUMinutes"===ia.units||"esriNAUSeconds"===ia.units)Z="Time";break}}x.push({id:e[S].name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+X+Z+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName" title\x3d"'+
e[S].description+'"\x3e'+e[S].name+"\x3c/div\x3e"});!b.defaultTravelMode||e[S].id!==b.defaultTravelMode&&e[S].itemId!==b.defaultTravelMode||(A=e[S].name)}this._showTravelModesOption();this._travelModeSelector.setStore(new a({objectStore:new h({data:x})}));this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(A);this._setTravelMode(A).always(r.resolve)}else this._checkStartTimeUIAvailability(),this.set("showTravelModesOption",!1),r.resolve();return r.promise},_createPrintTask:function(){this._printService=
(this.printTaskUrl=this._usingAGOL()?this.printTaskUrl:this.defaults.printTaskUrl)?new Sa(this.printTaskUrl,{async:!1}):null;var b=new fb;b.exportOptions={width:670,height:750,dpi:96};b.format="PNG32";b.layout="MAP_ONLY";b.preserveScale=!1;b.showAttribution=!1;var e=new Va;e.map=this.map;e.outSpatialReference=this.map.spatialReference;e.template=b;this._printParams=e},_createGeometryTask:function(){this._geometryService=null;this._usingAGOL()?this._geometryService=new Ba(this.geometryTaskUrl):this.geometryTaskUrl=
(this._geometryService=this.defaults.geometryTaskUrl?new Ba(this.defaults.geometryTaskUrl):gb.defaults.geometryService)?this._geometryService.url:null},_showTravelModesOption:function(){var b=this.get("serviceDescription");I.set(this._travelModeContainerNode,"display",this.showTravelModesOption&&b&&b.supportedTravelModes&&b.supportedTravelModes.length&&!this.doNotFetchTravelModesFromOwningSystem?"block":"none")},_showMilesKilometersOption:function(){I.set(this._agolDistanceUnitsNode,"display",this.showMilesKilometersOption?
"block":"none")},_showClearButton:function(){I.set(this._clearDirectionsButtonNode,"display",this.showClearButton?"inline-block":"none")},_showActivateButton:function(){I.set(this._activateButtonNode,"display",this.showActivateButton?"inline-block":"none");this.showActivateButton||this.deactivate()},_showBarriersButton:function(){I.set(this._lineBarrierButtonNode,"display",this.showBarriersButton?"inline-block":"none");this.showBarriersButton||this.deactivateBarrierTool()},_createRouteParams:function(){var b=
{returnDirections:!0,returnRoutes:!1,outputLines:"esriNAOutputLineTrueShape",preserveFirstStop:!0,preserveLastStop:!0,directionsOutputType:"complete",stops:new ua,ignoreInvalidLocations:!0,doNotLocateOnRestrictedElements:!0,outSpatialReference:this.get("map").spatialReference};this.get("routeParams")||(this.routeParams={});var e=new Ka;this.routeParams=l.mixin(e,{outputGeometryPrecision:0,outputGeometryPrecisionUnits:"esriMeters",restrictUTurns:"esriNFSBAtDeadEndsOnly"},this.get("routeParams"),b)},
_markWPsForRemovalAfterUserChangedStopSequence:function(b,e){for(var r=b-1,A=[];0<=r&&this._isStopAWaypoint(this.stops[r]);)A.push(this.stops[r]),r--;for(r=b+1;r<this.stops.length&&this._isStopAWaypoint(this.stops[r]);)A.push(this.stops[r]),r++;if(e>b)for(r=e+1;r<this.stops.length&&this._isStopAWaypoint(this.stops[r]);)A.push(this.stops[r]),r++;else if(void 0!==e)for(r=e-1;0<=r&&this._isStopAWaypoint(this.stops[r]);)A.push(this.stops[r]),r--;else if(this.returnToStart&&0===b)for(r=this.stops.length-
1;0<=r&&this._isStopAWaypoint(this.stops[r]);)A.push(this.stops[r]),r--;return A},_removeSomeWaypoints:function(b){for(var e=new y,r=[],A=0;A<b.length;A++){var x=K.indexOf(this.stops,b[A]);-1<x&&r.push(this._removeStop(x,!0,!0))}R(r).always(e.resolve);return e.promise},_modifyStopSequence:function(b,e){var r=this._dnd.getAllNodes(),A=new y,x,S=[];if(r.length)if(this._removeLocateButtonVisibilityEvents(),arguments.length&&void 0!==b)if(0<=b&&0<=e&&b<this.stops.length&&e<this.stops.length&&b!==e){r=
this._markWPsForRemovalAfterUserChangedStopSequence(b,e);var X=this.stops.splice(b,1);this.stops.splice(e,0,X[0]);for(x=0;x<this.stops.length;x++)S.push(this._updateStop(this.stops[x],x));S.push(this._removeSomeWaypoints(r));R(S).always(l.hitch(this,function(){this._solveAndZoom().always(A.resolve)}))}else A.reject("Invalid From and To values.");else{for(x=0;x<this.stops.length;)this._isStopAWaypoint(this.stops[x])?S.push(this._removeStop(x,!0,!0)):x++;R(S).always(l.hitch(this,function(){S=[];this.stops.reverse();
for(x=0;x<this.stops.length;x++)S.push(this._updateStop(this.stops[x],x));R(S).always(l.hitch(this,function(){this._solveAndZoom().always(A.resolve)}))}))}else A.resolve();return A.promise},_setMenuNodeValues:function(b){"traffic"!==b&&this._clearDisplayBeforeSolve();b=this.get("optimalRoute");this._findOptimalOrderNode&&T.set(this._findOptimalOrderNode,"checked",b);this._returnToStartNode&&(b=this.returnToStart&&!this.maxStopsReached&&this.stops[0]&&(!this.stops[0].feature||this._isStopLocated(this.stops[0])),
T.set(this._returnToStartNode,"checked",b),this.set("returnToStart",b),this.maxStopsReached&&this.returnToStart&&this._showMessage(L.widgets.directions.error.maximumStops));if(!this.returnToStart&&!this._incrementalSolveStopRange&&this.directions)for(this._incrementalSolveStopRange={start:this.stops.length-1,end:this.stops.length},this._clearRouteGraphics(),this._incrementalSolveStopRange=null,b=this.stops.length;0<b--&&this._isStopAWaypoint(this.stops[b]);)this._removeSomeWaypoints([this.stops[b]]);
this._useTrafficNode&&(T.set(this._useTrafficNode,"checked",this.traffic),this.traffic?(this._updateMapTimeExtent(),this._addTrafficLayer()):(this._removeTrafficLayer(),this._restoreMapTimeExtent()));switch(this.get("directionsLengthUnits")){case Q.KILOMETERS:T.set(this._useKilometersNode,"checked",!0);T.set(this._useMilesNode,"checked",!1);break;case Q.MILES:T.set(this._useKilometersNode,"checked",!1),T.set(this._useMilesNode,"checked",!0)}I.set(this._printButton,"display",this.showPrintPage?"inline-block":
"none");I.set(this._saveMenuButton,"display",this.showSaveButton&&this.owningSystemUrl?"inline-block":"none");this._showMilesKilometersOption();this._showClearButton()},_optionsMenu:function(){this._useTrafficItemNode&&I.set(this._useTrafficItemNode,"display",this.get("showTrafficOption")?"block":"none");this._returnToStartItemNode&&I.set(this._returnToStartItemNode,"display",this.get("showReturnToStartOption")?"block":"none");this._findOptimalOrderItemNode&&I.set(this._findOptimalOrderItemNode,"display",
this.get("showOptimalRouteOption")&&3<this._getStopCount()?"block":"none");this.stops.length>=this.get("minStops")?M.add(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass):(M.remove(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass),this._optionsMenuNode&&"block"===I.get(this._optionsMenuNode,"display")&&this._toggleOptionsMenu())},_stopsRemovable:function(){2<this._dnd.getAllNodes().length-this._getWaypointCount()?M.add(this._widgetContainer,this._css.stopsRemovableClass):
M.remove(this._widgetContainer,this._css.stopsRemovableClass)},_checkMaxStops:function(){this.set("maxStopsReached",this._getStopCount()+this._getWaypointCount()+(this.returnToStart?1:0)>=this.maxStops);this._showAddDestination()},_updateThemeWatch:function(b,e,r){M.remove(this.domNode,e);M.add(this.domNode,r)},_toggleOptionsMenu:function(){"block"===I.get(this._optionsMenuNode,"display")?(I.set(this._optionsMenuNode,"display","none"),M.remove(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=
L.widgets.directions.showOptions):(I.set(this._optionsMenuNode,"display","block"),M.add(this._optionsButtonNode,"esriStopsOptionsOpen"),this._optionsButtonNode.innerHTML=L.widgets.directions.hideOptions)},_toggleSaveMenu:function(b){"block"===I.get(this._saveMenuNode,"display")||!1===b?(I.set(this._saveMenuNode,"display","none"),M.remove(this._saveMenuButton,this._css.stopsPressedButtonClass)):(this.clearMessages(),I.set(this._saveMenuNode,"display","block"),M.add(this._saveMenuButton,this._css.stopsPressedButtonClass),
this._enableSharing().then(l.hitch(this,function(){this._outputLayer.setValue(this.routeLayer.title?this.routeLayer.title:this.directions&&this.directions.routeName);if(this.routeLayer.ownerFolder)for(var e=this._folderSelector.store.objectStore.data,r=0;r<e.length;r++)if(e[r].folderId===this.routeLayer.ownerFolder){this._folderSelector.getValue()!==e[r].id&&(this._folderSelector._interractive=!1,this._folderSelector.setValue(e[r].id));break}this._enableButton(this._saveButton,this.routeLayer.isItemOwner||
!this._userCanCreatePortalItem);this._outputLayer.set("disabled",!1)})))},_showToolbar:function(){M[this.stops.length<this.maxStops&&this.canModifyStops||this.canModifyWaypoints?"add":"remove"].call(H,this._widgetContainer,this._css.addStopsClass)},_showAddDestination:function(){this._showToolbar();this._addDestinationNode.style.display=this.stops.length<this.maxStops&&this.canModifyStops?"inline":"none"},_showMapClickActiveButton:function(){this._showToolbar();this._activateButtonNode.style.display=
this.canModifyStops||this.canModifyWaypoints?"inline-block":"none"},_getAbsoluteUrl:function(b){b=C.toUrl(b);return/^https?:/i.test(b)?b:/^\/\//i.test(b)?Ta+b:/^\//i.test(b)?Ta+"//"+window.location.host+b:b},_getManeuverImage:function(b){return b?"esriDMTStop"===b||"esriDMTDepart"===b?"":this._getAbsoluteUrl("./images/Directions/maneuvers/"+b+".png"):""},_loadPrintDirections:function(b){var e=this.get("printTemplate"),r=new y;this.directionsLengthUnits!==this.routeParams.directionsLengthUnits?this.getDirections().then(r.resolve,
r.reject):r.resolve();r.then(l.hitch(this,function(){if(!e&&this.directions){var A=this._getAbsoluteUrl("./css/Directions.css"),x=this._getAbsoluteUrl("./css/DirectionsPrint.css"),S=this._getAbsoluteUrl("./images/Directions/print-logo.png");var X=F.isBodyLtr()?"ltr":"rtl";e="";e+="\x3c!DOCTYPE HTML\x3e";e+='\x3chtml lang\x3d"en" class\x3d"'+this.get("theme")+'" dir\x3d"'+X+'"\x3e';e+="\x3chead\x3e";e+='\x3cmeta charset\x3d"utf-8"\x3e';e+='\x3cmeta http-equiv\x3d"X-UA-Compatible" content\x3d"IE\x3dEdge,chrome\x3d1"\x3e';
e+="\x3ctitle\x3e"+this.get("directions").routeName+"\x3c/title\x3e";e+='\x3clink rel\x3d"stylesheet" media\x3d"screen" type\x3d"text/css" href\x3d"'+A+'" /\x3e';e+='\x3clink rel\x3d"stylesheet" media\x3d"print" type\x3d"text/css" href\x3d"'+x+'" /\x3e';e+="\x3c/head\x3e";e+='\x3cbody class\x3d"'+this._css.esriPrintPageClass+'"\x3e';e+='\x3cdiv class\x3d"'+this._css.esriPrintBarClass+'"\x3e';e+='\x3cdiv class\x3d"'+this._css.esriCloseButtonClass+'" title\x3d"'+L.common.close+'" onclick\x3d"window.close();"\x3e'+
L.common.close+"\x3c/div\x3e";e+='\x3cdiv id\x3d"printButton" class\x3d"'+this._css.esriPrintButtonClass+'" title\x3d"'+L.widgets.directions.print+'" onclick\x3d"window.print();"\x3e'+L.widgets.directions.print+"\x3c/div\x3e";e+="\x3c/div\x3e";e+='\x3cdiv class\x3d"'+this._css.esriPrintMainClass+'"\x3e';e+='\x3cdiv class\x3d"'+this._css.esriPrintHeaderClass+'"\x3e';e+='\x3cimg class\x3d"'+this._css.esriPrintLogoClass+'" src\x3d"'+S+'" /\x3e';e+='\x3cdiv class\x3d"'+this._css.esriPrintNameClass+'"\x3e'+
this.get("directions").routeName+"\x3c/div\x3e";e+=this._renderDirectionsSummary(this.directions);b&&(e+='\x3cdiv id\x3d"divMap" class\x3d"esriPrintMap esriPrintWait"\x3e\x3c/div\x3e',e+='\x3chr class\x3d"esriNoPrint"/\x3e');e+='\x3cdiv id\x3d"print_helper"\x3e\x3c/div\x3e';e+='\x3ctextarea onkeyup\x3d"document.getElementById(\'print_helper\').innerHTML\x3dthis.value;" id\x3d"print_area" class\x3d"'+this._css.esriPrintNotesClass+'" placeholder\x3d"'+L.widgets.directions.printNotes+'"\x3e\x3c/textarea\x3e';
e+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';e+="\x3c/div\x3e";e+='\x3cdiv class\x3d"'+this._css.esriPrintDirectionsClass+'"\x3e';e+=this._renderDirectionsTable(this.directions);e+="\x3c/div\x3e";e+='\x3cdiv class\x3d"'+this._css.esriPrintFooterClass+'"\x3e';e+="\x3cp\x3e"+L.widgets.directions.printDisclaimer+"\x3c/p\x3e";e+="\x3c/div\x3e";e+="\x3c/div\x3e";e+="\x3c/body\x3e";e+="\x3c/html\x3e"}this._printWindow.document.open("text/html","replace");this._printWindow.document.write(e);
this._printWindow.document.close()}))},resize:function(){this._truncateSearchSourceIfNeeded()},_truncateSearchSourceIfNeeded:function(){var b=this._searchSourceSelector,e=b.containerNode.firstChild;b.domNode.clientWidth>this.domNode.clientWidth?I.set(e,"width",this._searchSourceContainerNode.clientWidth-20+"px"):I.set(e,"width","")},_printDirections:function(){if(this.directions){var b=screen.width/2,e=screen.height/1.5;b="toolbar\x3dno, location\x3dno, directories\x3dno, status\x3dyes, menubar\x3dno, scrollbars\x3dyes, resizable\x3dyes, width\x3d"+
b+", height\x3d"+e+", top\x3d"+(screen.height/2-e/2)+", left\x3d"+(screen.width/2-b/2);this.get("printPage")?(window.directions=this.get("directions"),window.open(this.get("printPage"),"directions_widget_print",b,!0)):(this._printWindow=window.open("","directions_widget_print",b,!0),this._loadPrintDirections(!!this._printService),this._printService&&C(["dojo/_base/window"],l.hitch(this,function(r){this.zoomToFullRoute().then(l.hitch(this,function(){this._printService.execute(this._printParams,l.hitch(this,
function(A){r.withDoc(this._printWindow.document,function(){var x=m.byId("divMap");x&&(M.remove(x,"esriPrintWait"),M.add(x,"esriPageBreak"),H.create("img",{src:A.url,"class":"esriPrintMapImg"},x))})}),l.hitch(this,function(A){r.withDoc(this._printWindow.document,function(){var x=m.byId("divMap");x&&M.remove(x,"esriPrintWait")});console.error("Error while calling print service:\n "+A)}))}))})))}},_enableButton:function(b,e){e=e||void 0===e;M[e?"remove":"add"].apply(this,[b,"esriDisabledDirectionsButton"]);
b._enabled=e},_clearStopsStatusAttr:function(){for(var b=0;b<this.stops.length;b++)this.stops[b].feature&&this.stops[b].feature.attributes&&(this.stops[b].feature.attributes.Status=void 0)},_enableSharing:function(){var b=new y;!this._naRouteSharing&&this.owningSystemUrl?C(["../tasks/NARouteSharing"],l.hitch(this,function(e){this._naRouteSharing=new e(this.owningSystemUrl,this.map.spatialReference);this._folderSelector||(this._folderSelector=new q({className:"esriFoldersDDL",style:"width: 100%;",
sortByLabel:!1,disabled:!0,_interractive:!0,onChange:l.hitch(this,function(){this._folderSelector._interractive?this._enableButton(this._saveButton,!this.routeLayer.itemId):this._folderSelector._interractive=!0})},this._folderSelectorContainer),this._folderSelector.startup(),this._outputLayer=new k({style:"width: 100%",required:!0,trim:!0,regExp:'[^\x26|\x3c|\x3e|%|#|?|\\|"|/|+]+',maxLength:98,disabled:!0,onKeyPress:l.hitch(this,function(){this._enableButton(this._saveButton,!this.routeLayer.itemId||
!this._userCanCreatePortalItem)}),onFocus:l.hitch(this,function(){this.map&&this.map.disableKeyboardNavigation()}),onBlur:l.hitch(this,function(){this.map&&this.map.enableKeyboardNavigation()})},this._outputLayerContainer),this._outputLayer.startup());this._naRouteSharing.getFolders().then(l.hitch(this,function(r){for(var A=[],x=0;x<r.length;x++)A.push({id:r[x].url,folderId:r[x].id,label:r[x].title});this._folderSelector.setStore(new a({objectStore:new h({data:A})}));this._naRouteSharing.canCreateItem().then(l.hitch(this,
function(S){this._folderSelector.set("disabled",!S);this._userCanCreatePortalItem=S}));this._enableButton(this._saveButton);b.resolve()}),l.hitch(this,function(r){console.log(r);this._naRouteSharing=null;this._toggleSaveMenu(!1);b.reject(r)}))})):this.owningSystemUrl?b.resolve():(b.reject(Error("Owning system is not defined, or the Directions widget is not done initializing.")),this._naRouteSharing=null);return b.promise},_storeRouteUI:function(){var b=new y;this._outputLayer&&this._outputLayer.isValid()?
this._storeRoute(this._outputLayer.getValue(),this._folderSelector.getValue(),this._folderSelector.store.objectStore.get(this._folderSelector.getValue()).folderId).then(b.resolve,b.reject):(this._outputLayer&&this._outputLayer.focus(),b.reject(Error("Need result layer name specified.")));return b.promise},_storeRoute:function(b,e,r){var A=new y,x=this.directions;if(this._savingRoute||!this._naRouteSharing)return this._saveButton.blur(),A.reject(Error("Not ready to store route.")),A.promise;this.clearMessages();
A.then(null,l.hitch(this,function(va){console.log("ERR",va);this._showMessage(L.widgets.directions.error.cantSaveRoute)}));A.promise.always(l.hitch(this,function(){this._enableButton(this._saveButton);I.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":"none");this._showLoadingSpinner();this._savingRoute=!1}));if(x&&x.features&&x.features.length&&this.stops&&this.stops.length)if(this.owningSystemUrl)if(this.routeParams&&this.routeParams.travelMode)if(b&&
e){var S=l.hitch(this,function(va){return this._naRouteSharing.getAttributeUnits(va,this.serviceDescription)});var X=this.routeParams.travelMode.timeAttributeName;var Z=this.routeParams.travelMode.distanceAttributeName,ba=S(X),ha=S(Z),ia=this.routeParams.directionsLengthUnits||this.serviceDescription.directionsLengthUnits,ma=this._naRouteSharing.toMeters,na=this._naRouteSharing.toMinutes,ta=function(va,Fa,Ma){var Na;for(Na in va)if(va.hasOwnProperty(Na)&&0===Na.indexOf(Fa)&&-1===K.indexOf(Ma,Na.substr(Fa.length))){var Wa=
Wa||{};Wa[Na.substr(Fa.length)]=va[Na]}return Wa},sa=[],Ca=[],Ha=[];if(X&&ba&&Z&&ha){var Qa=[],La=this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames||[],Ja=this.serviceDescription.networkDataset.networkAttributes;for(S=0;S<Ja.length;S++)"esriNAUTCost"===Ja[S].usageType&&-1===K.indexOf(La,Ja[S].name)&&Ja[S].name!==X&&Ja[S].name!==Z&&Qa.push(Ja[S].name);La=this.get("stops");var Ga={xmin:Infinity,ymin:Infinity,xmax:-Infinity,ymax:-Infinity};for(S=0;S<La.length;S++)if(La[S].feature&&
La[S].feature.toJson){Ja=La[S].feature.toJson();var za=Ja.attributes;var Da=Ja.geometry,Oa=this._naRouteSharing.getUTCOffset(za.ArriveTime,za.ArriveTimeUTC),Ra=this._naRouteSharing.getUTCOffset(za.DepartTime,za.DepartTimeUTC);l.mixin(Ga,{xmin:Ga.xmin>Da.x?Da.x:Ga.xmin,ymin:Ga.ymin>Da.y?Da.y:Ga.ymin,xmax:Ga.xmax<Da.x?Da.x:Ga.xmax,ymax:Ga.ymax<Da.y?Da.y:Ga.ymax});Ja.attributes={__OBJECTID:S+1,CurbApproach:za.CurbApproach,ArrivalCurbApproach:za.ArriveCurbApproach,DepartureCurbApproach:za.DepartCurbApproach,
Name:za.Name===this._waypointName?L.widgets.directions.waypoint:za.Name===this._userDefinedStopName?La[S].name:za.Name,RouteName:x.routeName,Sequence:za.Sequence,Status:za.Status,LocationType:za.isWaypoint?1:0,TimeWindowStart:za.TimeWindowStart,TimeWindowEnd:za.TimeWindowEnd,TimeWindowStartUTCOffset:Oa,TimeWindowEndUTCOffset:Oa,ServiceMinutes:na(za["Attr_"+X],ba),ServiceMeters:ma(za["Attr_"+Z],ha),ServiceCosts:da.stringify(ta(za,"Attr_",Qa)),CumulativeMinutes:na(za["Cumul_"+X],ba),CumulativeMeters:ma(za["Cumul_"+
Z],ha),CumulativeCosts:da.stringify(ta(za,"Cumul_",Qa)),LateMinutes:na(za["Violation_"+X],ba),WaitMinutes:na(za["Wait_"+X],ba),ArrivalTime:this._naRouteSharing.toUTCTime(za.ArriveTime,Oa),DepartureTime:this._naRouteSharing.toUTCTime(za.DepartTime,Ra),ArrivalUTCOffset:Oa,DepartureUTCOffset:Ra};sa.push(Ja)}Z=0;ha=function(va){try{va.strings=da.parse(va.strings)}catch(Ma){Xa.strings=void 0}if(va.strings&&va.strings.length)for(var Fa=0;Fa<va.strings.length;Fa++)if("esriDSTGeneral"===va.strings[Fa].stringType)return va.strings[Fa].string};
La=function(va,Fa){for(var Ma=[],Na=0;Na<(va||[]).length;Na++)va[Na].stringType!==Fa&&Fa||Ma.push(va[Na].string);return Ma.length?Ma.toString():void 0};Ja=function(va){switch(va){case "esriDMTStop":return"esriDPTManeuverArrive";case "esriDMTDepart":return"esriDPTManeuverDepart";case "esriDMTDoorPassage":return"esriDPTManeuverDoor";case "esriDMTBearLeft":return"esriDPTManeuverBearLeft";case "esriDMTBearRight":return"esriDPTManeuverBearRight";case "esriDMTElevator":return"esriDPTManeuverElevator";case "esriDMTEscalator":return"esriDPTManeuverEscalator";
case "esriDMTFerry":return"esriDPTManeuverFerryOn";case "esriDMTEndOfFerry":return"esriDPTManeuverFerryOff";case "esriDMTForkCenter":return"esriDPTManeuverForkCenter";case "esriDMTForkLeft":return"esriDPTManeuverForkLeft";case "esriDMTForkRight":return"esriDPTManeuverForkRight";case "esriDMTPedestrianRamp":return"esriDPTManeuverPedestrianRamp";case "esriDMTRampLeft":return"esriDPTManeuverRampLeft";case "esriDMTRampRight":return"esriDPTManeuverRampRight";case "esriDMTRoundabout":return"esriDPTManeuverRoundabout";
case "esriDMTTurnLeft":return"esriDPTManeuverTurnLeft";case "esriDMTLeftLeft":return"esriDPTManeuverTurnLeftLeft";case "esriDMTLeftRight":return"esriDPTManeuverTurnLeftRight";case "esriDMTTurnRight":return"esriDPTManeuverTurnRight";case "esriDMTRightLeft":return"esriDPTManeuverTurnRightLeft";case "esriDMTRightRight":return"esriDPTManeuverTurnRightRight";case "esriDMTSharpLeft":return"esriDPTManeuverSharpLeft";case "esriDMTSharpRight":return"esriDPTManeuverSharpRight";case "esriDMTStraight":return"esriDPTManeuverStraight";
case "esriDMTStrairs":return"esriDPTManeuverStairs";case "esriDMTUTurn":return"esriDPTManeuverUTurn"}return"esriDPTUnknown"};for(S=0;S<x.featuresWithWaypoints.length;S++){var Ua=x.featuresWithWaypoints[S];Da=Ua.toJson();Oa=Da.attributes;Ra=Da.geometry&&Da.geometry.paths&&Da.geometry.paths[0]||[];var bb=Da.geometry.hasM||Ra[0]&&3===Ra[0].length;za=this._naRouteSharing.getUTCOffset(Oa.ETA,Oa.arriveTimeUTC);Da.attributes={__OBJECTID:S+1,Sequence:++Z,StopID:function(){var va=void 0,Fa=Ua._associatedStopWithReturnToStart&&
Ua._associatedStopWithReturnToStart.attributes.Sequence;if(Fa)for(var Ma=0;Ma<sa.length;Ma++)if(sa[Ma].attributes.Sequence===Fa){va=sa[Ma].attributes.__OBJECTID;break}return va}(),DirectionPointType:Ja(Oa.maneuverType),DisplayText:Ua._associatedStopWithReturnToStart&&Ua._associatedStopWithReturnToStart.attributes.isWaypoint?Oa.text.replace(this._waypointName,L.widgets.directions.waypoint):Oa.text,ArrivalTime:this._naRouteSharing.toUTCTime(Oa.ETA,za),ArrivalUTCOffset:za,Azimuth:void 0,Name:La(x.stringsWithWaypoints[S],
"esriDSTStreetName"),AlternateName:La(x.stringsWithWaypoints[S],"esriDSTAltName"),ExitName:La(x.stringsWithWaypoints[S],"esriDSTExit"),IntersectingName:La(x.stringsWithWaypoints[S],"esriDSTCrossStreet"),BranchName:La(x.stringsWithWaypoints[S],"esriDSTBranch"),TowardName:La(x.stringsWithWaypoints[S],"esriDSTToward"),ShortVoiceInstruction:void 0,VoiceInstruction:void 0,Level:void 0};delete Da.symbol;delete Da.infoTemplate;Ra.length?(Da.geometry={x:Ra[0][0],y:Ra[0][1],spatialReference:Da.geometry.spatialReference},
bb&&l.mixin(Da.geometry,{m:Ra[0][2]})):delete Da.geometry;Ca.push(Da);Da=Ua.toJson();Oa=Da.attributes;Ra=Da.geometry&&Da.geometry.paths&&Da.geometry.paths[0]||[];za=!0;for(X=0;X<Ra.length-1;X++)if(Ra[X][0]!==Ra[X+1][0]||Ra[X][1]!==Ra[X+1][1]){za=!1;break}za||(Da.attributes={DirectionPointID:S+1,DirectionLineType:"esriDLTSegment",Meters:ma(Oa.length,ia),Minutes:na(Oa.time,ba),FromLevel:void 0,ToLevel:void 0},Da.geometry.hasM=bb,delete Da.symbol,delete Da.infoTemplate,Ha.push(Da));var Xa=x.eventsWithWaypoints[Da.attributes.Sequence]||
[];for(X=0;X<Xa.length;X++)Da=Xa[X].toJson(),Oa=Da.attributes,za=this._naRouteSharing.getUTCOffset(Oa.ETA,Oa.arriveTimeUTC),Da.attributes={Sequence:++Z,DirectionPointType:"esriDPTEvent",DisplayText:ha(Oa),ArrivalTime:this._naRouteSharing.toUTCTime(Oa.ETA,za),ArrivalUTCOffset:za,Name:Oa.strings},Ca.push(Da)}X=this.routeParams.barriers&&this.routeParams.barriers.features||[];var cb=[];for(S=0;S<X.length;S++)Z=X[S].toJson(),ha=Z.attributes,Z.attributes={BarrierType:ha.BarrierType||0,FullEdge:ha.FullEdge||
!1,AddedCost:ha["Attr_"+this._getImpedanceAttribute().name]||0,Costs:da.stringify(ta(ha,"Attr_",Qa)),CurbApproach:ha.CurbApproach||0,Name:ha.Name},cb.push(Z);X=this.routeParams.polylineBarriers&&this.routeParams.polylineBarriers.features||[];var db=[];for(S=0;S<X.length;S++)Z=X[S].toJson(),ha=Z.attributes,Z.attributes={BarrierType:ha.BarrierType||0,ScaleFactor:ha["Attr_"+this._getImpedanceAttribute().name]||1,Costs:da.stringify(ta(ha,"Attr_",Qa)),Name:ha.Name},db.push(Z);X=this.routeParams.polygonBarriers&&
this.routeParams.polygonBarriers.features||[];var eb=[];for(S=0;S<X.length;S++)Z=X[S].toJson(),ha=Z.attributes,Z.attributes={BarrierType:ha.BarrierType||0,ScaleFactor:ha["Attr_"+this._getImpedanceAttribute().name]||1,Costs:da.stringify(ta(ha,"Attr_",Qa)),Name:ha.Name},eb.push(Z);var hb={geometry:x.mergedGeometry,attributes:{RouteName:x.routeName,TotalMinutes:na(x.totalTime,ba),TotalMeters:ma(x.totalLength,ia),TotalLateMinutes:function(){for(var va=0,Fa=0;Fa<sa.length;Fa++)va+=sa[Fa].attributes.LateMinutes||
0;return va}(),TotalWaitMinutes:function(){for(var va=0,Fa=0;Fa<sa.length;Fa++)va+=sa[Fa].attributes.WaitMinutes||0;return va}(),TotalCosts:sa[sa.length-1].attributes.CumulativeCosts,StartTime:"none"!==this.startTime?sa[0].attributes.ArrivalTime:null,EndTime:"none"!==this.startTime?sa[sa.length-1].attributes.DepartureTime:null,StartUTCOffset:sa[0].attributes.ArrivalUTCOffset,EndUTCOffset:sa[sa.length-1].attributes.DepartureUTCOffset,Messages:da.stringify(this._solverMessages),AnalysisSettings:da.stringify({travelMode:l.hitch(this,
function(){var va=l.clone(this.routeParams.travelMode);"\x26lt;"===va.name.substr(0,4)&&"\x26gt;"===va.name.substr(va.name.length-4,4)&&(va.name=va.name.substr(4,va.name.length-8));return va})(),directionsLanguage:this.routeParams.directionsLanguage||this.serviceDescription.directionsLanguage,startTimeIsUTC:this.routeParams.startTimeIsUTC,timeWindowsAreUTC:this.routeParams.timeWindowsAreUTC,findBestSequence:this.routeParams.findBestSequence,preserveFirstStop:this.routeParams.preserveFirstStop,preserveLastStop:this.routeParams.preserveLastStop,
accumulateAttributeNames:this.routeParams.accumulateAttributes||this.serviceDescription.accumulateAttributeNames})}};this._enableButton(this._saveButton,!1);this._savingRoute=!0;this._showLoadingSpinner(!0);l.hitch(this,function(){var va=new y;this._printService?this.zoomToFullRoute().then(l.hitch(this,function(){var Fa=this._printParams.template,Ma=Fa.exportOptions;Fa.exportOptions={width:200,height:133,dpi:96};this._printService.execute(this._printParams,function(Na){Fa.exportOptions=Ma;va.resolve(Na.url)},
function(Na){Fa.exportOptions=Ma;console.error("Error while calling print service:\n "+Na);va.resolve()})})):va.resolve();return va.promise})().then(l.hitch(this,function(va){var Fa={folder:e,name:b,stops:sa,directionPoints:Ca,directionLines:Ha,barriers:cb,polylineBarriers:db,polygonBarriers:eb,extent:l.mixin(l.clone(x.extent),{xmin:Ga.xmin>x.extent.xmin?x.extent.xmin:Ga.xmin,ymin:Ga.ymin>x.extent.ymin?x.extent.ymin:Ga.ymin,xmax:Ga.xmax<x.extent.xmax?x.extent.xmax:Ga.xmax,ymax:Ga.ymax<x.extent.ymax?
x.extent.ymax:Ga.ymax}),routeInfo:hb,thumbnail:va};this._userCanCreatePortalItem?this._naRouteSharing.store(Fa,this.routeLayer.itemId,"1.0.0").then(l.hitch(this,function(Ma){if(Ma.success){var Na=this._naRouteSharing.portal;Na="//"+(Na.isPortal?Na.portalHostname:Na.urlKey+"."+Na.customBaseUrl);this._toggleSaveMenu();this._showMessage(L.widgets.directions.routeIsSaved+"\x3cbr/\x3e\x3ca class\x3d'esriLinkButton' target\x3d'_blank' href\x3d'"+Na+"/home/item.html?id\x3d"+Ma.id+"'\x3e"+L.widgets.directions.share+
"\x3c/a\x3e",!0);if(this.routeLayer.itemId)this.onRouteItemUpdated(Ma.id);else this.onRouteItemCreated(Ma.id);l.mixin(this.routeLayer,{itemId:Ma.id,title:Fa.name,isItemOwner:!0,ownerFolder:r});A.resolve(Ma)}else A.reject(Ma)}),A.reject):this._naRouteSharing.createFeatureCollection(Fa,"1.0.0").then(l.hitch(this,function(Ma){A.resolve(Ma);this._toggleSaveMenu();this.onFeatureCollectionCreated(Ma)}),A.reject)}))}else A.reject(Error("Cannot deduce the impedance used."))}else A.reject(Error("Missing required parameter: layerName, folder must be specified."));
else A.reject(Error("Shared route must be built using a Travel Mode."));else A.reject(Error("Cannot store route: owning system to store routes is not defined. Please specify Portal or ArcGIS Online Url in constructor."));else A.reject(Error("No route to share. Build a route first."));return A.promise},_loadRoute:function(b){var e=new y;e.promise.always(l.hitch(this,function(){this._showLoadingSpinner(!1);I.set(this._saveAsButton,"display",this.routeLayer.itemId&&this._userCanCreatePortalItem?"inline-block":
"none");this._enableButton(this._saveButton,this.routeLayer.isItemOwner)}));this._reset().then(l.hitch(this,function(){this._showLoadingSpinner(!0);this._enableSharing().then(l.hitch(this,function(){var r=l.clone(this.serviceDescription),A=l.hitch(this,function(ba){l.mixin(this.routeLayer,{itemId:b,title:ba.title,isItemOwner:ba.isItemOwner,ownerFolder:ba.ownerFolder})}),x,S,X,Z;r.directionsLengthUnits=this.directionsLengthUnits;this._naRouteSharing.load(b,r).then(l.hitch(this,function(ba){if(ba.routeParameters){l.mixin(this.routeParams,
ba.routeParameters);this.routeParams.accumulateAttributes=ba.routeParameters.accumulateAttributeNames;this.set("optimalRoute",this.routeParams.findBestSequence);this.startTime=this.routeParams.startTime?this.routeParams.startTime:"none";this._setStartTime(void 0,void 0,this.startTime);var ha=ba.routeParameters.travelMode,ia=ha?this._getCostAttribute(ha.impedanceAttributeName):void 0;ia=ia?this._isTimeUnits(ia.units)?"Time":"Distance":"";Z=r.supportedTravelModes&&r.supportedTravelModes.length?this._travelModeSelector.store.objectStore.data.slice():
[];if(canUseRouteLayerTM=1!==ba.successCode&&ia){var ma="AUTOMOBILE"===ha.type?"Driving":"TRUCK"===ha.type?"Trucking":"WALK"===ha.type?"Walking":"Other";ha.name="\x26lt;"+ha.name+"\x26gt;";this.serviceDescription.supportedTravelModes=(r.supportedTravelModes||[]).concat(ha);Z.push({id:ha.name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+ma+ia+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName"\x3e'+ha.name+"\x3c/div\x3e"});this._travelModeSelector.setStore(new a({objectStore:new h({data:Z})}));
this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(ha.name)}else{ia=!1;if(ha&&ha.name)for(Z=r.supportedTravelModes||[],x=0;x<Z.length;x++)if(Z[x].name===ha.name){ia=!0;this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(ha.name);this.routeParams.travelMode=Z[x].impedanceAttributeName?Z[x]:Z[x].itemId;ba.loadMessages.push({message:L.widgets.directions.error.tmFromPortalSameName+" "+ha.name,messageType:"Warning"});break}if(!ia)if((ha=r.defaultTravelMode)&&
Z)for(x=0;x<Z.length;x++){if(Z[x].id===ha){this.routeParams.travelMode=Z[x].impedanceAttributeName?Z[x]:Z[x].itemId;ba.loadMessages.push({message:L.widgets.directions.error.tmFromPortalDefault+" "+(Z[x].name?Z[x].name:Z[x].itemId),messageType:"Warning"});break}}else this.routeParams.travelMode=null}this._checkStartTimeUIAvailability()}if(ba.solveResult&&ba.solveResult.routeResults){var na=Infinity,ta=-Infinity;ha=ba.solveResult.routeResults[0].stops;var sa=ba.solveResult.routeResults[0].directions.features;
ia={};for(x=0;x<ha.length;x++){var Ca=ha[x].attributes;if(Ca.isWaypoint)for(S=0;S<sa.length;S++)ma=sa[S].attributes,ma._stopSequence===Ca.Sequence&&(ma.text=ma.text.replace(Ca.Name,this._waypointName));X=Ca.Name+"_"+this._stopSequence++;ia[X]=Ca.isWaypoint?this._waypointName:Ca.Name;Ca.Name=X;if(Ca.Sequence<na&&(null!==Ca.ArriveCurbApproach||null!==Ca.DepartCurbApproach)){var Ha=Ca.Name;na=Ca.Sequence}if(Ca.Sequence>ta&&(null!==Ca.ArriveCurbApproach||null!==Ca.DepartCurbApproach)){var Qa=Ca.Name;
ta=Ca.Sequence}}X=Ha+" - "+Qa;ba.solveResult.routeResults[0].routeName=X;ba.solveResult.routeResults[0].directions.routeName=X;for(x=0;x<sa.length;x++)if(ma=sa[x].attributes,void 0!==ma._stopSequence)for(S=0;S<ha.length;S++)if(ma._stopSequence===ha[S].attributes.Sequence){X=ha[S].attributes.Name;ma.text=(ma.text||"").replace(ia[X],X);delete ma._stopSequence;break}Ha=ha[ha.length-1];ha[0].geometry.x===Ha.geometry.x&&ha[0].geometry.y===Ha.geometry.y&&(this._returnToStartStop=this._addStopWrapperToGraphic(new u(Ha.geometry,
null,Ha.attributes),ia[Ha.attributes.Name]),this.set("returnToStart",!0));this._solveResultProcessing(ba.solveResult,ia).then(l.hitch(this,function(){this._setStartTime(void 0,void 0,this.startTime);A(ba);this.zoomToFullRoute();e.resolve(ba)}),e.reject)}else{if(ba.routeParameters){Ha=ba.routeParameters.stops.features;this.stops=[];for(x=0;x<Ha.length;x++)this.stops.push(this._addStopWrapperToGraphic(Ha[x],Ha[x].attributes.Name)),this._updateStop(this.stops[x],x);this._setStops();ba.loadMessages.push({message:L.widgets.directions.routeLayerStopsOnly,
messageType:"Warning"})}else ba.loadMessages.push({message:L.widgets.directions.routeLayerEmpty,messageType:"Warning"});A(ba);e.resolve(ba)}for(x=0;x<ba.loadMessages.length;x++)this._showMessage(ba.loadMessages[x].message)}),l.hitch(this,function(ba){e.reject(ba);this._showMessage("GWM_0003"===ba.messageCode?L.widgets.directions.error.accessDenied+this._naRouteSharing.portal.getPortalUser().username:L.widgets.directions.error.loadError)}))}),e.reject)}),e.reject);return e.promise}});d("extend-esri")&&
l.setObject("dijit.Directions",O,z);return O});