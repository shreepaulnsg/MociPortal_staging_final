// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/templates/RenderingRule.html":'\x3cdiv data-dojo-attach-point\x3d"_renderingRuleContainer" class\x3d"esriRenderingRuleContainer"\x3e\r\n  \x3ctable class\x3d"esriRenderingRuleTable"\x3e\r\n    \x3ctbody\x3e\r\n      \x3ccol class\x3d"esriRenderingRuleCol1"/\x3e\r\n      \x3ccol class\x3d"esriRenderingRuleCol2"/\x3e\r\n      \x3ccol class\x3d"esriRenderingRuleCol3"/\x3e\r\n      \x3ccol class\x3d"esriRenderingRuleCol4"/\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel class\x3d"esriRenderingRuleHeadingLabel" data-dojo-attach-point\x3d"rendererLabel"\x3e${_i18n.widgets.renderingRule.rendererLabelTitle}\x3c/label\x3e\r\n          \x3ca class\x3d"esriRenderingRuleWarningIcon" data-dojo-attach-point\x3d"vectorWarningIcon"\x3e\x3c/a\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"rasterFunctionBlock"\x3e\r\n        \x3ctd colspan\x3d"3" data-dojo-attach-point\x3d"rasterFunctionRow"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"rasterFunctionList" data-dojo-type\x3d"dijit/form/FilteringSelect"\r\n            class\x3d"esriRenderingRuleRasterFunctionList dijitSelect"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd\x3e\r\n          \x3cspan tabindex\x3d"0" id\x3d"rftAddition" class\x3d"esri-icon-plus-circled" data-dojo-attach-point\x3d"addRasterFunction" data-dojo-attach-event\x3d\'onClick: _addCustomRasterFunction\'\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3" data-dojo-attach-point\x3d"messageBlock"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"customRFTMessage" class\x3d"esriRenderingRuleLoadingMsg"\x3e${_i18n.applyRFxTemplateTool.loadingMessage}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"bandIdsLabelBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel class\x3d"esriRenderingRuleHeadingLabel" data-dojo-attach-point\x3d"bandIdsLabel"\x3e${_i18n.widgets.renderingRule.bandCombinationLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"bandIdsBlock"\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"bandIdsRedList" data-dojo-type\x3d"dijit/form/FilteringSelect"\r\n            class\x3d"esriRenderingRuleBandIdsRedList dijitSelect" data-dojo-attach-event\x3d"onChange: _updateStretchStatsGrid"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"bandIdsGreenList" data-dojo-type\x3d"dijit/form/FilteringSelect"\r\n            class\x3d"esriRenderingRuleBandIdsGreenList dijitSelect" data-dojo-attach-event\x3d"onChange: _updateStretchStatsGrid"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"bandIdsBlueList" data-dojo-type\x3d"dijit/form/FilteringSelect"\r\n            class\x3d"esriRenderingRuleBandIdsBlueList dijitSelect" data-dojo-attach-event\x3d"onChange: _updateStretchStatsGrid"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"bandIdsMsgBlock"\x3e\r\n        \x3ctd/\x3e\r\n        \x3ctd colspan\x3d"2"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"msgLabel" class\x3d"esriRenderingRuleMsgLabel"\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel class\x3d"esriRenderingRuleEnhancementHeadingLabel" data-dojo-attach-point\x3d"imageEnhancementLabel"\x3e${_i18n.widgets.renderingRule.imageEnhancementLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"symbologyTypeBlock"\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"symbologyTypeLabelRow" class\x3d"esriRenderingRuleVisible"\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3clabel class\x3d"esriRenderingRuleSymbologyTypeLabel"\x3e${_i18n.widgets.renderingRule.symbologyTypeLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"symbologyTypeSelectRow" class\x3d"esriRenderingRuleVisible"\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"symbologyTypeSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-props\x3d"labelAttr: \'label\'"\r\n            class\x3d"esriRnderingRuleSymbologyTypeSelect" data-dojo-attach-event\x3d"onChange: _onSymbologyTypeChange"\x3e\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"stretchBlock"\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"stretchDescLabel"\x3e${_i18n.widgets.renderingRule.stretchDescLabel}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"stretchMethodLabel"\x3e${_i18n.widgets.renderingRule.stretchMethodLabel}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3cselect data-dojo-attach-point\x3d"stretchMethodList" style\x3d"width:100%;" data-dojo-type\x3d"dijit/form/Select" class\x3d"esriRenderingRuleStretchMethodList"\x3e\r\n          \x3c/select\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"stretchMethodNoneDescBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"stretchMethodNoneDesc"\x3e${_i18n.widgets.renderingRule.stretchMethodNoneDesc}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"stretchMethodMinMaxDescBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"stretchMethodMinMaxDesc"\x3e${_i18n.widgets.renderingRule.stretchMethodMinMaxDesc}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"numStdDevBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"numStdDevLabel"\x3e${_i18n.widgets.renderingRule.numStdDevLabelTitle}\x3c/label\x3e\r\n          \x3cinput type\x3d"text" value\x3d"2.0" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-point\x3d"numStdDevText" class\x3d"esriRenderingRuleFixedInput"\x3e\r\n          \x3c/input\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"numStdDevLabel"\x3e${_i18n.widgets.renderingRule.numStdDevEndLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd/\x3e\r\n        \x3ctd/\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"minMaxPercentDescBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"numStdDescLabel"\x3e${_i18n.widgets.renderingRule.minMaxDescLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"maxPercentBlock"\x3e\r\n        \x3ctd\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"maxPercentLabel"\x3e${_i18n.widgets.renderingRule.maxPercentLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd colspan\x3d"2"\x3e\r\n          \x3cinput data-dojo-type\x3d"dijit/form/NumberTextBox" type\x3d"text" value\x3d"2.0" data-dojo-attach-point\x3d"maxPercentText" class\x3d"esriRenderingRuleFixedInput"\x3e\r\n          \x3c/input\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"percentLabel"\x3e${_i18n.widgets.renderingRule.percentLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"minPercentBlock"\x3e\r\n        \x3ctd\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"minPercentLabel"\x3e${_i18n.widgets.renderingRule.minPercentLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd colspan\x3d"2"\x3e\r\n          \x3cinput data-dojo-type\x3d"dijit/form/NumberTextBox" type\x3d"text" value\x3d"2.0" data-dojo-attach-point\x3d"minPercentText" class\x3d"esriRenderingRuleFixedInput"\x3e\r\n          \x3c/input\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"percentLabel"\x3e${_i18n.widgets.renderingRule.percentLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"gammaBlock"\x3e\r\n        \x3ctd\x3e\r\n          \x3clabel data-dojo-attach-point\x3d"gammaLabel"\x3e${_i18n.widgets.renderingRule.gammaLabelTitle}\x3c/label\x3e\r\n        \x3c/td\x3e\r\n        \x3ctd colspan\x3d"2"\x3e\r\n          \x3cdiv id\x3d"gammaSliderID" data-dojo-attach-point\x3d"gammaSlider" class\x3d"esriRenderingRuleGammaSlider" data-dojo-type\x3d"dijit.form.HorizontalSlider" showbuttons\x3d"true" value\x3d"0.0" minimum\x3d"-1" maximum\x3d"1" intermediatechanges\x3d"true"\x3e\r\n            \x3cdiv data-dojo-type\x3d"dijit.form.HorizontalRuleLabels" container\x3d"bottomDecoration" labels\x3d"${_i18n.widgets.renderingRule.minGammaLabel}, ${_i18n.widgets.renderingRule.maxGammaLabel}" style\x3d"height: 1.5em; font-size: 0.8em; color: #666"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"draBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3cinput type\x3d"checkbox" value\x3d"true" data-dojo-attach-point\x3d"draCheckbox" class\x3d"esriRenderingRuleDraCheckbox" data-dojo-attach-event\x3d"onChange: _onDRAChange"\x3e\r\n          \x3c/input\x3e\r\n          \x3clabel class\x3d"esriRenderingRuleDraLabel" data-dojo-attach-point\x3d"draLabel"\x3e${_i18n.widgets.renderingRule.draLabelTitle}\x3c/label\x3e\r\n        \x3ctd/\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"stretchStatsBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\x3cdiv data-dojo-attach-point\x3d"stretchStatsGrid"\x3e\x3c/div\x3e\x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"classifyBlock"\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"classifyFieldBlock"\x3e\r\n          \x3ctd\x3e\r\n            \x3clabel data-dojo-attach-point\x3d"classifyFieldLabel"\x3e${_i18n.widgets.renderingRule.fieldLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3cinput data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"classifyFieldSelect" class\x3d"esriRenderingRuleClassifySelect"\r\n            data-dojo-props\x3d"labelAttr: \'alias\'" data-dojo-attach-event\x3d"onChange: _onClassifyFieldChange"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"classifyMethodBlock"\x3e\r\n          \x3ctd\x3e\r\n            \x3clabel data-dojo-attach-point\x3d"classifyMethodLabel"\x3e${_i18n.widgets.renderingRule.methodLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3cinput data-dojo-type\x3d"dijit/form/FilteringSelect" data-dojo-attach-point\x3d"classifyMethodSelect" class\x3d"esriRenderingRuleClassifyMethodSelect"\r\n            data-dojo-props\x3d"labelAttr: \'label\', labelType: \'html\'" data-dojo-attach-event\x3d"onChange: _onClassifyMethodChange"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"classifyNClassesBlock"\x3e\r\n          \x3ctd\x3e\r\n            \x3clabel data-dojo-attach-point\x3d"classifyNClassesLabel"\x3e${_i18n.widgets.renderingRule.nClassesLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3cinput data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-point\x3d"classifyNClassesInput" class\x3d"esriRenderingRuleClassifyClassSelect" data-dojo-attach-event\x3d"onChange: _updateClassifyGrid"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"classifyIntervalsBlock"\x3e\r\n          \x3ctd\x3e\r\n            \x3clabel data-dojo-attach-point\x3d"classifyIntervalLabel"\x3e${_i18n.widgets.renderingRule.intervalLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3cinput data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-point\x3d"classifyIntervalInput" class\x3d"esriRenderingRuleClassifyIntervalSelect"\r\n            data-dojo-attach-event\x3d"onChange: _updateClassifyGrid"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"uniqueValuesBlock"\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"uniqueValuesFieldBlock"\x3e\r\n          \x3ctd\x3e\r\n            \x3clabel data-dojo-attach-point\x3d"uniqueValuesFieldLabel"\x3e${_i18n.widgets.renderingRule.fieldLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3cinput data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"uniqueValuesFieldSelect"\r\n            class\x3d"esriRenderingRuleUniqueValuesSelect" data-dojo-props\x3d"labelAttr: \'alias\'" data-dojo-attach-event\x3d"onChange: _updateUniqueValuesGrid"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"shadedReliefBlock"\x3e\r\n        \x3ctr class\x3d"shadedReliefHillShadeTypeBlock"\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3clabel data-dojo-attach-point\x3d"shadedReliefHillshadeTypeLabel"\x3e${_i18n.widgets.renderingRule.hillshadeTypeLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr class\x3d"shadedReliefHillShadeTypeBlock"\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3clabel class\x3d"esriRenderingRuleHillshadeType"\x3e\r\n              \x3cinput type\x3d"radio" name\x3d"hillshadeType" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"_traditionalRadio"\r\n              data-dojo-attach-event\x3d"onChange: _onHillShadeTypeChange" checked\x3d"true"\x3e\r\n              ${_i18n.widgets.renderingRule.traditionalLabel}\r\n            \x3c/label\x3e\r\n            \x3clabel class\x3d"esriRenderingRuleHillshadeType"\x3e\r\n              \x3cinput type\x3d"radio" name\x3d"hillshadeType" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"_multidirectionalRadio"\x3e\r\n              ${_i18n.widgets.renderingRule.multidirectionalLabel}\r\n            \x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr class\x3d"shadedReliefAzimuthBlock"\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\x3clabel data-dojo-attach-point\x3d"shadedReliefAzimuthLabel"\x3e\r\n            ${_i18n.widgets.renderingRule.azimuthLabel}\x3c/label\x3e\r\n            \x3cinput class\x3d"esriRenderingRuleSliderValue" data-dojo-type\x3d"dijit/form/NumberTextBox"\r\n             data-dojo-attach-point\x3d"azimuthValueInput" data-dojo-attach-event\x3d"onChange: _onAzimuthValueChange, onKeyDown: _onAzimuthKeyDown"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr class\x3d"shadedReliefAzimuthBlock"\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3cdiv id\x3d"azimuthSliderID" data-dojo-attach-point\x3d"shadedReliefAzimuthSlider" class\x3d"esriRenderingRuleGammaSlider" data-dojo-type\x3d"dijit.form.HorizontalSlider" showbuttons\x3d"true" minimum\x3d"0" maximum\x3d"360" intermediatechanges\x3d"true"\x3e\r\n              \x3cdiv data-dojo-type\x3d"dijit.form.HorizontalRuleLabels" container\x3d"bottomDecoration" labels\x3d"0, 360" style\x3d"height: 1.5em; font-size: 0.8em; color: #666"\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr class\x3d"shadedReliefAltitudeBlock"\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\x3clabel data-dojo-attach-point\x3d"shadedReliefAltitudeLabel"\x3e\r\n            ${_i18n.widgets.renderingRule.altitudeLabel}\x3c/label\x3e\r\n            \x3cinput class\x3d"esriRenderingRuleSliderValue" data-dojo-type\x3d"dijit/form/NumberTextBox"\r\n              data-dojo-attach-point\x3d"altitudeValueInput" data-dojo-attach-event\x3d"onChange: _onAltitudeValueChange, onKeyDown: _onAltitudeKeyDown"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr class\x3d"shadedReliefAltitudeBlock"\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3cdiv id\x3d"altitudeSliderID" data-dojo-attach-point\x3d"shadedReliefAltitudeSlider" class\x3d"esriRenderingRuleGammaSlider" data-dojo-type\x3d"dijit.form.HorizontalSlider" showbuttons\x3d"true" minimum\x3d"0" maximum\x3d"90" intermediatechanges\x3d"true"\x3e\r\n              \x3cdiv data-dojo-type\x3d"dijit.form.HorizontalRuleLabels" container\x3d"bottomDecoration" labels\x3d"0, 90" style\x3d"height: 1.5em; font-size: 0.8em; color: #666"\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3clabel data-dojo-attach-point\x3d"shadedReliefScalingLabel"\x3e${_i18n.widgets.renderingRule.scaling}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3clabel class\x3d"esriRenderingRuleHillshadeType"\x3e\r\n              \x3cinput type\x3d"radio" name\x3d"scaling" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"_noneRadio"\r\n              data-dojo-attach-event\x3d"onChange: _onScalingChange" checked\x3d"true"\x3e\r\n              ${_i18n.widgets.renderingRule.none}\r\n            \x3c/label\x3e\r\n            \x3clabel class\x3d"esriRenderingRuleHillshadeType"\x3e\r\n              \x3cinput type\x3d"radio" name\x3d"scaling" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"_adjustedRadio"\x3e\r\n              ${_i18n.widgets.renderingRule.adjusted}\r\n            \x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n\r\n        \x3ctr data-dojo-attach-point\x3d"shadedReliefZFactorBlock"\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\x3clabel data-dojo-attach-point\x3d"shadedReliefZFactorLabel"\x3e\r\n          ${_i18n.widgets.renderingRule.zFactor}\x3c/label\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3cinput data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-point\x3d"zFactorInput" class\x3d"esriRenderingRuleClassifyClassSelect"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n\r\n        \x3ctr class\x3d"shadedReliefPixelSizePowerBlock"\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\x3clabel data-dojo-attach-point\x3d"shadedReliefPixelSizePowerLabel"\x3e\r\n          ${_i18n.widgets.renderingRule.pixelSizePower}\x3c/label\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr class\x3d"shadedReliefPixelSizePowerBlock"\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3cinput data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-point\x3d"pixelSizePowerInput" class\x3d"esriRenderingRuleClassifyClassSelect"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n\r\n        \x3ctr class\x3d"shadedReliefPixelSizeFactorBlock"\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\x3clabel data-dojo-attach-point\x3d"shadedReliefPixelSizeFactorLabel"\x3e\r\n          ${_i18n.widgets.renderingRule.pixelSizeFactor}\x3c/label\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr class\x3d"shadedReliefPixelSizeFactorBlock"\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3cinput data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-attach-point\x3d"pixelSizeFactorInput" class\x3d"esriRenderingRuleClassifyClassSelect"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n\r\n      \x3c/tbody\x3e\r\n      \x3ctbody data-dojo-attach-point\x3d"colorRampSelectionBlock"\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"colorRampLabelBlock"\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3cdiv class\x3d"esriRenderingRuleColorRampHeading"\x3e${_i18n.widgets.renderingRule.colorRampTitle}\x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"colorRampBlock"\x3e\r\n          \x3ctd colspan\x3d"3" \x3e\r\n            \x3cselect data-dojo-attach-point\x3d"colorRampSelect" data-dojo-type\x3d"esri/dijit/ColorRampSelector" class\x3d"esriRenderingRuleColorRampList dijitSelect"\r\n            data-dojo-props\x3d"dropDownPosition: [\'below\', \'above\'], maxHeight: 200" data-dojo-attach-event\x3d"onChange: _onColorRampChange"\x3e\x3c/select\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"colorRampInvertBlock"\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3cinput type\x3d"checkbox" value\x3d"true" data-dojo-attach-point\x3d"invertColorRampCheckbox" class\x3d"esriRenderingRuleDraCheckbox" data-dojo-attach-event\x3d"onChange: _onColorRampChange"\x3e\r\n            \x3c/input\x3e\r\n            \x3clabel class\x3d"esriRenderingRuleDraLabel"\x3e${_i18n.widgets.renderingRule.invertColorRampLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"classifyGridBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"classifyLoadingMsg" class\x3d"esriRenderingRuleLoadingMsg"\x3e${_i18n.widgets.renderingRule.classifyLoadingMsg}\x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"classifyGrid"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"uniqueValuesGridBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"uniqueValuesLoadingMsg" class\x3d"esriRenderingRuleLoadingMsg"\x3e${_i18n.widgets.renderingRule.uniqueValuesLoadingMsg}\x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"uniqueValuesGrid"\x3e\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr data-dojo-attach-point\x3d"serviceInfoLoadingBlock"\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"serviceInfoLoadingMsg" class\x3d"esriRenderingRuleLoadingMsg"\x3e${_i18n.widgets.renderingRule.serviceInfoLoadingMsg}\x3c/div\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n      \x3ctr\x3e\r\n        \x3ctd colspan\x3d"3"\x3e\r\n          \x3ccenter\x3e\x3cinput type\x3d"button" data-dojo-attach-point\x3d"_apply" value\x3d"APPLY" size\x3d"15" class\x3d"esriRenderingRuleApplyButton" /\x3e\x3c/center\x3e\r\n        \x3c/td\x3e\r\n      \x3c/tr\x3e\r\n    \x3c/tbody\x3e\r\n  \x3c/table\x3e\r\n   \x3cdiv data-dojo-type\x3d"dijit/TooltipDialog" data-dojo-attach-point\x3d"_vectorTooltipDlg"\r\n    class\x3d"esriRenderingRuleVectorTooltip" style\x3d"display: none;"\x3e\r\n      \x3cp\x3e${_i18n.widgets.renderingRule.createVectorLayerDesc}\x3c/p\x3e\r\n      \x3cdiv class\x3d\'dijitDialogPaneActionBar\'\x3e\r\n        \x3cbutton data-dojo-type\x3d\'dijit/form/Button\' data-dojo-attach-event\x3d\'onClick: _createVectorLayer\' class\x3d"calcite blue"\x3e${_i18n.common.yesLabel}\x3c/button\x3e\r\n        \x3cbutton data-dojo-type\x3d\'dijit/form/Button\' data-dojo-attach-event\x3d\'onClick: _hideVectorWarning\' class\x3d"calcite transparent"\x3e${_i18n.common.noLabel}\x3c/button\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e\r\n'}});
define("esri/dijit/RenderingRule","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/json dojo/dom-style dojo/dom-class dojo/dom-construct dojo/i18n!../nls/jsapi dojo/text!./templates/RenderingRule.html dojo/store/Memory dojo/store/Observable dojo/data/ObjectStore dojo/has dojo/on dojo/io-query dojo/Deferred dojo/query ../kernel ../lang ../config ../urlUtils ../request ../layers/RasterFunction ../geometry/Extent ../geometry/Point ./ColorRampSelector ../renderers/colorUtils ./ColorPicker ./analysis/mixins/browselayers/BrowseLayerMixin ./RasterFunctionEditor/utils ./analysis/ItemTypes ../tasks/generateRenderer ../tasks/AlgorithmicColorRamp ../tasks/MultipartColorRamp ../symbols/SimpleFillSymbol ../Color ../renderers/StretchRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/colorRampUtils ../renderers/ShadedReliefRenderer ../renderers/ColormapRenderer dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/popup dijit/Tooltip dgrid/OnDemandGrid dgrid/editor dgrid/Keyboard dijit/form/NumberTextBox dijit/form/TextBox dijit/form/ValidationTextBox dijit/form/HorizontalSlider dijit/form/HorizontalRuleLabels dijit/form/FilteringSelect dijit/TooltipDialog".split(" "),
function(K,h,y,l,ca,p,t,E,da,M,u,ea,Q,fa,N,ha,ia,z,ja,L,ka,U,la,v,ma,na,Da,F,oa,pa,qa,ra,V,W,sa,X,G,ta,ua,va,O,wa,xa,ya,za,Aa,H,Y,R,C,S,Ba,Z,Ca){M=K([ya,za,Aa,pa],{declaredClass:"esri.dijit.RenderingRule",templateString:M,widgetsInTemplate:!0,layer:null,map:null,hideApplyButton:!1,_renderingRuleObject:null,_rasterFunctionData:[],_rasterFunctionStore:null,_cachedFunctionList:[],_cachedkeyProperties:{},_cachedHistogramsList:{},_cachedRATList:{},_cachedColormapList:{},_pendingDfds:{},_redBandIdStore:null,
_greenBandIdStore:null,_blueBandIdStore:null,_donotSaveChanges:!1,_resetBandCombination:!1,_serviceBandCount:3,_defaultBandCombinationFncName:"User Defined Renderer",_firstFncInRenderingRuleList:null,_gammaSliderTooltip:null,_preFetchRFTServiceInfoThreshold:0,_symbologyTypes:{classify:"classify",stretch:"stretch",uniqueValues:"uniqueValues",shadedRelief:"shadedRelief",colormap:"colormap"},_defaultNClasses:5,_defaultMaxClasses:16,_classifyMethods:{naturalBreaks:"natural-breaks",equalInterval:"equal-interval",
quantile:"quantile",definedInterval:"defined-interval",manualInterval:"manual-interval"},_isTileImagery:!1,_customFunctionList:{},isSingleTenant:!0,rasterUtilitiesServer:null,portalUrl:null,canPublishImageCollection:!1,pixelTypeRanges:{u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-3.4*1E39,3.4*1E39],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},classificationMethodMapping:{esriClassifyDefinedInterval:"defined-interval",
esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"},constructor:function(a){K.safeMixin(this,a);this._i18n=da;this._defaultBandCombinationFncName=this._i18n.widgets.renderingRule.userDefinedRendererTitle;this._renderingRuleObject=new v},startup:function(){this.inherited(arguments);y.connect(this.rasterFunctionList,"onChange",h.hitch(this,"_onRasterFunctionChange"));
y.connect(this.stretchMethodList,"onChange",h.hitch(this,"_onStretchMethodChange"));y.connect(this.gammaSlider,"onChange",h.hitch(this,"_onGammaChange"));y.connect(this.gammaSlider,"onMouseLeave",h.hitch(this,"_onGammaMouseLeave"));y.connect(this._apply,"onclick",h.hitch(this,"_onClickApplyRenderingRule"));y.subscribe("onRenderingRuleApply",h.hitch(this,"_onClickApplyRenderingRule"));y.subscribe("onRenderingRuleReset",h.hitch(this,"_onClickResetRenderingRule"));y.connect(this.shadedReliefAltitudeSlider,
"onChange",h.hitch(this,"_onAltitudeSliderChange"));y.connect(this.shadedReliefAzimuthSlider,"onChange",h.hitch(this,"_onAzimuthSliderChange"));this.own(N(this.vectorWarningIcon,"mouseover",h.hitch(this,this._showVectorWarning)),N(this.colorRampSelect,"colorRamp-change",h.hitch(this,this._updateInvertBlockVisibility)));this._onRasterFunctionChange(this.rasterFunctionList.value);this.hideApplyButton&&(this._apply.style.display="none");this._setupUniqueValuesGrid();this._setupClassifyGrid();this._setupStretchStatsGrid();
this._setupClassifyMethodStore();this._symbologyBlocks=[this.stretchBlock,this.colorRampSelectionBlock,this.classifyBlock,this.classifyGridBlock,this.uniqueValuesBlock,this.uniqueValuesGridBlock,this.shadedReliefBlock,this.serviceInfoLoadingBlock];p.set(this.messageBlock,"display","none");this._startupCalled=!0;this.customRFTTooltip=new Y({connectId:["rftAddition"],label:this._i18n.widgets.renderingRule.addCustomRFTToolTip})},_getColorMapFunction:function(a){a=new v;a.functionArguments=this.colorRampSelect.colorRampName?
{colorRamp:this.colorRampSelect.colorRampName}:{Colormap:this.colorRampSelect.colorMap};a.variableName="Raster";a.functionName="Colormap";return a},destroy:function(){this._pendingDfds=null;this._gammaSliderTooltip&&(this._gammaSliderTooltip.destroy(),this._gammaSliderTooltip=null);this.inherited(arguments)},_setLayerAttr:function(a){if(a){a!==this.layer&&(this._vectorWarningShown=!1);this.inherited(arguments);this.layer=a;if(this._isTileImagery="esri.layers.RasterXLayer"===a.declaredClass)this.layer.rasterFunctionInfos=
[];this._isElevationData="esriImageServiceDataTypeElevation"===a.serviceDataType||this._isTileImagery&&a.raster&&"Elevation"===a.raster.rasterInfo.keyProperties.Datatype;this._donotSaveChanges=!0;this._firstFncInRenderingRuleList=null;this._stretchReadFromRenderingRule=!1;this.colorRampSelect.removeColorRamp(this._uniqueValuesColorRamp);this._customColorRamp=this._uniqueValuesColorRamp=null;this._fillStretchMethodList();this._hideStretch();var b=h.hitch(this,"_setupDefaults");this.layer.loaded?this._setupDefaults():
y.connect(this.layer,"onLoad",b);this._donotSaveChanges=!1;10.61<this.layer.version&&this.layer.allowRasterFunction&&this.rasterUtilitiesServer&&this.canPublishImageCollection?p.set(this.addRasterFunction,"display","block"):p.set(this.addRasterFunction,"display","none")}},_setupDefaults:function(){this._setupLayout();this._setDefaultNoneFunctionName();this._setupBandIdDefaults();this._setupStretchDefaults();this._setupRenderingRuleDefaults();this._setupCustomRFTOption();this._setupColorRampDefaults();
this._setupSymbologyDefaults();this._setupClassifyDefaults();this._setupUniqueValuesDefaults();this._setupColormapDefaults()},_setupLayout:function(){this._isTileImagery?(this.rasterFunctionBlock.style.display="none",this.imageEnhancementLabel.style.display="none",this.symbologyTypeLabelRow.style.display="none",E.place(this.symbologyTypeSelectRow,this.rasterFunctionBlock,"after")):(this.rasterFunctionBlock.style.display="",this.imageEnhancementLabel.style.display="",this.symbologyTypeLabelRow.style.display=
"",E.place(this.symbologyTypeSelectRow,this.symbologyTypeLabelRow,"after"),p.set(this.messageBlock,"display","none"))},_setDefaultNoneFunctionName:function(){var a;this.layer.rasterFunctionInfos.some(h.hitch(this,function(b){if("none"===b.name.toLowerCase())return a=b.name,!0}));this._defaultNoneFunctionName=a||"None"},_setLayerBandIds:function(a,b){this.layer&&(null==a||Array.isArray(a)&&0===a.length?this.layer.setBandIds(a,b):Array.isArray(a)&&0<a.length&&a.every(function(c){return"number"===typeof c})&&
(1<this.layer.bandCount||1===a.length&&0===a[0])?a[0]===a[1]&&a[0]===a[2]?this.layer.setBandIds(a.slice(0,1),b):this.layer.setBandIds(a,b):b||this.layer.refresh())},_setupRFTDefaults:function(){this._setupColorRampDefaults();this._setupStretchDefaults();this._setupSymbologyDefaults();this._setupClassifyDefaults();this._setupUniqueValuesDefaults();this._setupColormapDefaults()},_setupCustomRFTOption:function(){var a=this.layer.renderingRule;a&&this._isRFTJson(a)&&this._addCustomRFTOption(a)},_setupRenderingRuleDefaults:function(){if(this.layer){this._rasterFunctionData=
[];var a=new ia,b;for(b=0;b<this._cachedFunctionList.length;b++){var c=this._cachedFunctionList[b];if(c&&this.layer===c.layer)return this._rasterFunctionData=c.data,this._setupFunctionStore(),a.resolve(),a}return this._fillRasterFunctionList(this.layer)}},_clearClassifyGrid:function(){this._classifyGrid&&this._classifyGrid.set("store",new Q(new u({data:[]})))},_setupColormapDefaults:function(){var a=this.layer,b=this.layer.id,c=this.layer.serviceInfo,d=this.rasterFunctionList.value;(c?!c.hasColormap:
!this.layer.hasColormap)||this._cachedColormapList[b]&&this._cachedColormapList[b][d]||d===this._defaultBandCombinationFncName&&a.getColormap().then(h.hitch(this,function(e){this._cachedColormapList[b]=this._cachedColormapList[b]||{};this._cachedColormapList[b][d]=e;this._updateColormapGrid()}))},_setupClassifyDefaults:function(){if(this.layer&&this.symbologyTypeSelect.store.get(this._symbologyTypes.classify)){this._showClassifyLoadingMsg();this._clearClassifyGrid();this._setupClassifyMethodStore();
this._setupClassifyGridDefaults();this._setupClassifyFieldStore();var a=this.layer,b=this.layer.id,c=this._rasterFunctionStore.get(this.rasterFunctionList.value),d=c.name,e=c&&c.serviceInfo;c=e?e.hasRasterAttributeTable:this.layer.hasRasterAttributeTable;e=e?e.hasHistograms:this.layer.hasHistograms;var f=d===this._defaultBandCombinationFncName?this._defaultNoneFunctionName:d;f=-1<f.indexOf(this._i18n.widgets.renderingRule.custom+": ")?new v(this._customFunctionList[this.layer.id][f]):new v({functionName:f});
this._cachedRATList[b]&&this._cachedRATList[b][d]?this._handleRasterAttributeTableClassify(this._cachedRATList[b][d]):c?this.rasterFunctionList.value===this._defaultBandCombinationFncName?a.getRasterAttributeTable().then(h.hitch(this,this._handleRasterAttributeTableClassify)):a.getRenderingRuleAttributeTable({renderingRule:f}).then(h.hitch(this,this._handleRasterAttributeTableClassify)):e&&a.mosaicRule&&a.mosaicRule.multidimensionalDefinition&&a.mosaicRule.multidimensionalDefinition.length?this._getHistograms(h.hitch(this,
this._handleHistogramsResultClassify),a.mosaicRule.multidimensionalDefinition[0].variableName):this._cachedHistogramsList&&this._cachedHistogramsList[b]&&this._cachedHistogramsList[b][d]?this._handleHistogramsResultClassify(this._cachedHistogramsList[this.layer.id][d]):e&&this.rasterFunctionList.value===this._defaultBandCombinationFncName?this._getHistograms(h.hitch(this,this._handleHistogramsResultClassify)):(10.1<a.currentVersion||this._isSingleBitRaster(a.pixelType))&&!this._isMultidimensionalLayer()&&
this._getComputeHistograms(h.hitch(this,this._handleHistogramsResultClassify),{renderingRule:f,pixelSize:this._getOverviewPixelSize()})}},_getComputeHistograms:function(a,b){if(this.layer)return this._computeHistogramsTask&&!this._computeHistogramsTask.isResolved()?this._computeHistogramsTask:this._computeHistogramsTask=this.layer.computeHistograms(b).then(a)},_getHistograms:function(a,b){if(this.layer)return this._getHistogramsTask&&!this._getHistogramsTask.isResolved()?this._getHistogramsTask:this._getHistogramsTask=
this.layer.getHistograms(b).then(a)},_getOverviewPixelSize:function(){var a=this.layer.extent;return new na((a.xmax-a.xmin)/this.map.width,(a.ymax-a.ymin)/this.map.height,a.spatialReference)},_addUniqueValuesColorRamp:function(a){var b={},c=a&&a.features;c&&c.length&&this._ratContainsColormap(a)&&(this._uniqueValuesColorRampName=this._i18n.widgets.renderingRule.uniqueValuesDefaultColorRamp,b.id=this._uniqueValuesColorRampName,b.name=this._uniqueValuesColorRampName,b.type="multipart",b.colorRamps=
[],l.forEach(c,function(d){d=this._getFeatureRGBValue(d.attributes);b.colorRamps.push({fromColor:d,toColor:d})},this),this._uniqueValuesColorRamp=b,this._setColorRampSelectValue())},_addCustomColorRamp:function(a){if(a){if(this._customColorRamp)return this.colorRampSelect.setSelected(this._customColorRamp);this._customColorRamp=a.toJson();this._customColorRampName=this._i18n.widgets.renderingRule.customColorRampName;this._customColorRamp.id=this._customColorRampName;this._customColorRamp.name=this._customColorRampName;
this.colorRampSelect.addColorRamp(this._customColorRamp);this.colorRampSelect.setSelected(this._customColorRamp)}},_getFeatureRGBValue:function(a){if(a){var b=this._getCaseInsensitiveFieldValue("red",a);var c=this._getCaseInsensitiveFieldValue("green",a);a=this._getCaseInsensitiveFieldValue("blue",a);b=1<b?b:Math.round(255*b);c=1<c?c:Math.round(255*c);a=1<a?a:Math.round(255*a);return[b,c,a]}},_getCaseInsensitiveFieldValue:function(a,b){if(b&&a){a=a.toLowerCase();for(var c in b)if(b.hasOwnProperty(c)&&
c.toLowerCase()===a)return b[c]}},_ratContainsColormap:function(a){if(!a||!a.fields)return!1;var b,c,d;return l.some(a.fields,function(e){e&&e.name&&(e=e.name.toLowerCase(),"red"===e&&(b=!0),"green"===e&&(c=!0),"blue"===e&&(d=!0));return b&&c&&d})},_getRATValueClassNameMap:function(a){if(!a||!a.fields)return null;var b={},c,d;a.fields.forEach(function(e){if("classname"===e.name.toLowerCase()||"class_name"===e.name.toLowerCase())c=e.name;"value"===e.name.toLowerCase()&&(d=e.name)});a.features.forEach(function(e){e=
e.attributes;b[e[d]]=c?e[c]:e[d]});return b},_handleRasterAttributeTableClassify:function(a){if(a&&a.features&&a.features.length){var b=this.rasterFunctionList.value;this._cachedRATList[this.layer.id]=this._cachedRATList[this.layer.id]||{};this._cachedRATList[this.layer.id][b]=a;this._setupClassifyNClassesInput(a.features.length);this._setDefaultIntervalSize();this._addUniqueValuesColorRamp(a);this._setupClassifyFieldStore();this._setupUniqueValuesFieldStore();this.symbologyTypeSelect.set("value",
this._getDefaultSymbologyType());this._isClassBreaksRenderer(this.layer.renderer)||this._updateClassifyGrid();this._isUniqueValueRenderer(this.layer.renderer)||this._updateUniqueValuesGrid()}},_handleHistogramsResultClassify:function(a){if(a&&a.histograms&&a.histograms.length){a=a.histograms;var b=this.rasterFunctionList.value;this._cachedHistogramsList[this.layer.id]=this._cachedHistogramsList[this.layer.id]||{};this._cachedHistogramsList[this.layer.id][b]=a;this._setupClassifyNClassesInput(a[0].counts&&
a[0].counts.length);this._setDefaultIntervalSize();this._setupUniqueValuesFieldStore();this._getServiceMinAndMax();var c=0,d=[];if(a&&a.length&&a[0].size){b=a[0].counts;var e=this._isIntegerImageService()?Math.floor(a[0].min+.5):a[0].min;c=this._isIntegerImageService()?Math.floor(a[0].max-.5):a[0].max;e=this.minValues.length&&!this.layer.hasMultidimensions?this.minValues[0]:e;var f=this.maxValues.length&&!this.layer.hasMultidimensions?this.maxValues[0]:c;for(c=0;c<b.length-1;c++)d.push(e+(f-e)*c/
b.length);d.push(f);a[0].dataPoints=d}this._isClassBreaksRenderer(this.layer.renderer)||this._updateClassifyGrid();this._isUniqueValueRenderer(this.layer.renderer)||this._updateUniqueValuesGrid()}},_setDefaultIntervalSize:function(){if(this.layer){var a=this.layer,b=a.id,c=a.renderer,d=this.rasterFunctionList.value,e=this.classifyFieldSelect.value,f,g;this._getServiceMinAndMax();if(this._isSelectedRenderingRule(a.renderingRule)&&this._isClassBreaksRenderer(c)&&c.infos&&c.infos.length&&c.attributeField===
e){var k=c.infos.length;a=c.infos[0];c=c.infos[k-1];k=(c.maxValue-a.minValue)/k}if(!k){if(this._cachedRATList&&this._cachedRATList[b]&&this._cachedRATList[b][d]){b=this._cachedRATList[b][d];var n=f=b.features[0].attributes[e];var m=b.features.length;l.forEach(b.features,function(q){g=q.attributes[e];g<n&&(n=g);g>f&&(f=g)})}else this._cachedHistogramsList&&this._cachedHistogramsList[b]&&this._cachedHistogramsList[b][d]&&(m=this._cachedHistogramsList[b][d],n=this.minValues.length&&!this.layer.hasMultidimensions?
this.minValues[0]:m[0].min,f=this.maxValues.length&&!this.layer.hasMultidimensions?this.maxValues[0]:m[0].max,m=m[0].counts&&m[0].counts.length);m=this.classifyNClassesInput&&this.classifyNClassesInput.value||this._getDefaultNClasses(m);k=(f-n)/m}this.classifyIntervalInput.attr("value",k,!1)}},_setupUniqueValuesDefaults:function(){this.layer&&this.symbologyTypeSelect.store.get(this._symbologyTypes.uniqueValues)&&(this._showUniqueValuesLoadingMsg(),this._setupUniqueValuesGridDefaults())},_setupSymbologyDefaults:function(){this._setupSymbologyStore();
this._setSymbologySelectVisibility()},_setSymbologySelectVisibility:function(){var a=this._canApplyRenderer();t.toggle(this.symbologyTypeBlock,"esriRenderingRuleHidden",!a);t.toggle(this.symbologyTypeBlock,"esriRenderingRuleVisible",a)},_isSingleBitRaster:function(a){return 8>=a.replace(/^\D+/g,"")},_isIntegerImageService:function(){return-1===["F32","F64"].indexOf(this.layer.pixelType)},_setupSymbologyStore:function(){if(this.layer){var a=this._rasterFunctionStore&&this._rasterFunctionStore.get(this.rasterFunctionList.value),
b=a&&a.serviceInfo?a.serviceInfo:null;a=this.layer.renderer;var c=[],d=this.layer,e=b?b.bandCount:d.bandCount,f=b?b.hasRasterAttributeTable:d.hasRasterAttributeTable,g=b?b.pixelType:d.pixelType;b=b?b.hasColormap:d.hasColormap;this._canApplyRenderer()&&(c.push({name:this._symbologyTypes.stretch}),e&&1===e&&(f?(c.push({name:this._symbologyTypes.uniqueValues}),c.push({name:this._symbologyTypes.classify})):(10.3<=d.currentVersion&&c.push({name:this._symbologyTypes.classify}),this._isSingleBitRaster(g)&&
this._hasServiceMinMax(d)&&c.push({name:this._symbologyTypes.uniqueValues}))));this._isSelectedRenderingRule(d.renderingRule)&&(this._isUniqueValueRenderer(a)&&!l.some(c,function(k){return k.name===this._symbologyTypes.uniqueValues},this)&&c.push({name:this._symbologyTypes.uniqueValues}),this._isClassBreaksRenderer(a)&&!l.some(c,function(k){return k.name===this._symbologyTypes.classify},this)&&c.push({name:this._symbologyTypes.classify}));this.rasterFunctionList.value===this._defaultBandCombinationFncName&&
(this._isElevationData&&c.push({name:this._symbologyTypes.shadedRelief}),b&&c.push({name:this._symbologyTypes.colormap}));l.forEach(c,function(k){k.label=this._i18n.widgets.renderingRule[k.name+"Label"];k.id=k.name},this);this.symbologyTypeSelect.set("store",new u({data:c}));(this.symbologyType=this._getDefaultSymbologyType())&&this.symbologyTypeSelect.set("value",this.symbologyType);this._onSymbologyTypeChange(this.symbologyType)}},_canApplyRenderer:function(){if(this.layer){var a=this.rasterFunctionList.value;
return 10.3<=this.layer.currentVersion||a===this._defaultBandCombinationFncName}},_getDefaultUniqueValuesField:function(a){var b,c=["classname","class_name","class_names"];l.some(a,function(d){d=d&&d.name;if(d){var e=d.toLowerCase();if(-1<l.indexOf(c,e))return b=d,!0;"value"===e&&(b=d)}});return b},_setupUniqueValuesFieldStore:function(){if(this.layer){var a,b=this._i18n.widgets.renderingRule.valueLabel;(a=this._getRasterAttributeTableFields())||(a=[{name:b,alias:b,id:"Value"}]);(a=new u({data:a}),
this.uniqueValuesFieldSelect)&&this.uniqueValuesFieldSelect.set("store",a);a=this._isUniqueValueRenderer(this.layer.renderer)?this.layer.renderer.attributeField:this._getDefaultUniqueValuesField(a.data);this.uniqueValuesFieldSelect.attr("value",a,!1)}},_setupStretchStatsGrid:function(){var a=this._i18n.widgets.renderingRule,b={sortable:!1,editor:Ba,editOn:"click",autoSave:!0,renderCell:h.hitch(this,this._stretchStatsRenderCell),canEdit:h.hitch(this,function(){return"6"!==this.stretchMethodList.value})};
this._stretchStatsGrid=new (K([R,S]))({selectionMode:"single",className:"dgrid-autoheight",columns:[C(h.mixin({field:"esriRenderingRuleStretchMin",label:a.minLabel},b)),C(h.mixin({field:"esriRenderingRuleStretchMax",label:a.maxLabel},b)),C(h.mixin({field:"esriRenderingRuleStretchMean",label:a.meanLabel},b)),C(h.mixin({field:"esriRenderingRuleStretchStdv",label:a.stdDevLabel},b))]},this.stretchStatsGrid);this._stretchStatsGrid.startup()},_stretchStatsRenderCell:function(a,b,c){null===b||void 0===b||
isNaN(b)?c.innerHTML="":c.innerHTML=Math.round(1E4*b)/1E4},_setupUniqueValuesGrid:function(){this._uniqueValuesGrid=new (K([R,S]))({selectionMode:"single",columns:[{field:"esriRenderingRuleUniqueValuesSymbol",sortable:!1,renderCell:h.hitch(this,function(a,b,c){b=E.toDom('\x3cdiv class \x3d esriRenderingRuleSymbolCell style \x3d "background: rgba( '+a.esriRenderingRuleUniqueValuesSymbol.r+", "+a.esriRenderingRuleUniqueValuesSymbol.g+", "+a.esriRenderingRuleUniqueValuesSymbol.b+","+255*a.esriRenderingRuleUniqueValuesSymbol.a+
') " id \x3d EsriRenderingRuleUniqueValuesGrid'+a.id+"\x3e\x3c/div\x3e");E.place(b,c);a.isesriRenderingRuleColormapData||(b.onclick=h.hitch(this,function(d){this._openColorPickerPopup(d)}))}),label:this._i18n.widgets.renderingRule.symbolLabel},{field:"esriRenderingRuleUniqueValuesValue",label:this._i18n.widgets.renderingRule.valueLabel},C({field:"esriRenderingRuleUniqueValuesLabel",sortable:!1,label:this._i18n.widgets.renderingRule.labelLabel,editor:Z,editOn:"click",autoSave:!0})]},this.uniqueValuesGrid);
this._uniqueValuesGrid.startup()},_setupClassifyGrid:function(){this._classifyGrid=new (K([R,S]))({className:"dgrid-autoheight",columns:[{field:"esriRenderingRuleClassifySymbol",sortable:!1,renderCell:h.hitch(this,function(a,b,c){a=E.toDom('\x3cdiv class \x3d esriRenderingRuleSymbolCell style \x3d "background: rgba( '+a.esriRenderingRuleClassifySymbol.r+", "+a.esriRenderingRuleClassifySymbol.g+", "+a.esriRenderingRuleClassifySymbol.b+","+255*a.esriRenderingRuleClassifySymbol.a+') " id \x3d EsriRenderingRuleEditorClassifyGrid'+
a.id+"\x3e\x3c/div\x3e");E.place(a,c);a.onclick=h.hitch(this,function(d){this._openColorPickerPopup(d)})}),label:this._i18n.widgets.renderingRule.symbolLabel},C({field:"esriRenderingRuleClassifyValue",label:this._i18n.widgets.renderingRule.upperValueLabel,sortable:!1,editor:Ca,editOn:"click",autoSave:!0,autoSelect:!0,get:function(a){this.editorInstance.constraints={maxValue:a.serviceMaxValue?a.serviceMaxValue:a.maxValue,minValue:a.minValue};return"\u2264 "+Math.floor(1E3*a.maxValue)/1E3},editorArgs:{required:!0,
invalidMessage:this._i18n.widgets.renderingRule.outOfRangeMessage,notANumberMessage:this._i18n.widgets.renderingRule.notANumberMessage,blankMessage:this._i18n.widgets.renderingRule.blankMessage,validator:function(a,b){var c=!0;a=a.replace("\u2264","").trim();if(null!==a&&" "!==a&&""!==a)if(isNaN(a))c=!1,this.promptMessage=this.params.notANumberMessage;else{if(a<=b.minValue||a>=b.maxValue)c=!1,this.promptMessage=this.params.invalidMessage}else c=!1,this.promptMessage=this.params.blankMessage;return c}},
set:h.hitch(this,this._setManualClassBreak)}),C({field:"esriRenderingRuleClassifyLabel",label:this._i18n.widgets.renderingRule.labelLabel,editor:Z,editOn:"click",autoSave:!0,sortable:!1})]},this.classifyGrid);this._classifyGrid.startup()},_setManualClassBreak:function(a){if(a.esriRenderingRuleClassifyValue){this.classifyMethodSelect.set("value",this._classifyMethods.manualInterval);var b=this._getIntegerValue(a.esriRenderingRuleClassifyValue.replace("\u2264","").trim()),c=a.maxValue;a.maxValue=b;
a.esriRenderingRuleClassifyLabel=this._createLabelString(a.minValue,a.maxValue);l.some(this._classifySymbolData,function(d,e){d.minValue===c&&(d.minValue=b,d.esriRenderingRuleClassifyLabel=this._createLabelString(d.minValue,d.maxValue));d.serviceMaxValue===c&&e!=this._classifySymbolData.length-1&&(d.serviceMaxValue=b)},this);this._classifyGrid.refresh()}},_createLabelString:function(a,b){return this._getIntegerValue(a)+" "+this._i18n.widgets.renderingRule.toLabel+" "+this._getIntegerValue(b)},_getIntegerValue:function(a){return Math.floor(1E3*
a)/1E3},_setupClassifyGridDefaults:function(){if(this.layer&&this._isClassBreaksRenderer(this.layer.renderer)){var a=[];l.forEach(this.layer.renderer.infos,function(b){a.push({minValue:b.minValue,maxValue:b.maxValue,esriRenderingRuleClassifySymbol:b.symbol.color,esriRenderingRuleClassifyLabel:b.label})});this._updateClassifyGrid(a)}},_setupUniqueValuesGridDefaults:function(){if(this.layer&&this._isUniqueValueRenderer(this.layer.renderer)){var a=[];l.forEach(this.layer.renderer.infos,function(b){a.push({esriRenderingRuleUniqueValuesValue:b.value,
esriRenderingRuleUniqueValuesSymbol:b.symbol.color,esriRenderingRuleUniqueValuesLabel:b.label||b.value})});this._updateUniqueValuesGrid(a)}},_setupClassifyNClassesInput:function(a){if(this.layer){var b=this._getDefaultMaxClasses(a);a=this._isClassBreaksRenderer(this.layer.renderer)?this.layer.renderer.infos.length:this._getDefaultNClasses(a);this.classifyNClassesInput.attr("value",a,!1);this.classifyNClassesInput.set("constraints",{min:0,max:b})}},_getDefaultNClasses:function(a){return void 0===a?
this._defaultNClasses:Math.min(this._defaultNClasses,a)},_getDefaultMaxClasses:function(a){return void 0===a?this._defaultMaxClasses:Math.min(this._defaultMaxClasses,a)},_isSelectedRenderingRule:function(a){var b=this._getStretchRenderingRule(a),c=this.rasterFunctionList.value;if(!a||this._isNoneRenderingRule(a)){if(this.rasterFunctionList.value===this._defaultBandCombinationFncName)return!0}else if(b){if((a=b.functionArguments)&&this._isSelectedRenderingRule(a.Raster))return!0}else if(c&&a.functionName.toLowerCase()===
c.toLowerCase()||this._isRFTJson(a)&&-1<c.toLowerCase().indexOf(a.functionName.toLowerCase()))return!0},_isUniqueValueRenderer:function(a){return a&&"esri.renderer.UniqueValueRenderer"===a.declaredClass},_isClassBreaksRenderer:function(a){return a&&"esri.renderer.ClassBreaksRenderer"===a.declaredClass},_isStretchRenderer:function(a){return a&&"esri.renderer.StretchRenderer"===a.declaredClass},_isNoneRenderingRule:function(a){return a&&a.functionName&&"none"===a.functionName.toLowerCase()},_isShadedReliefRenderer:function(a){return a&&
"esri.renderer.ShadedReliefRenderer"===a.declaredClass},_isColormapRenderer:function(a){return a&&"esri.renderer.ColormapRenderer"===a.declaredClass},_getStretchRenderingRule:function(a){if(a){if(a&&a.functionName&&"stretch"===a.functionName.toLowerCase())return a;if(a&&a.functionName&&"colormap"===a.functionName.toLowerCase()&&a.functionArguments&&a.functionArguments.Raster&&a.functionArguments.Raster.functionName&&"stretch"===a.functionArguments.Raster.functionName.toLowerCase())return a=a.functionArguments.Raster}},
_setupClassifyMethodStore:function(){if(this.layer){var a=[],b=this._isClassBreaksRenderer(this.layer.renderer)?this.layer.renderer.classificationMethod||this.classificationMethodMapping[this.layer.renderer.authoringInfo&&this.layer.renderer.authoringInfo.classificationMethod]:this._classifyMethods.equalInterval,c;for(c in this._classifyMethods)this._classifyMethods.hasOwnProperty(c)&&a.push({label:"\x3cdiv class\x3d 'esriRenderingRuleFilteringSelectLabel'\x3e\x3ch4 style\x3d'font-weight:bold;'\x3e"+
this._i18n.widgets.renderingRule[c]+"\x3c/h4\x3e\x3cbr/\x3e\x3ci\x3e"+this._i18n.widgets.renderingRule[c+"Desc"]+"\x3c/i\x3e\x3c/div\x3e",id:this._classifyMethods[c],name:this._i18n.widgets.renderingRule[c]});this.classifyMethodSelect.set("store",new u({data:a}));this.classifyMethodSelect.set("labelType","html");this.classifyMethodSelect.set("labelAttr","label");this.classifyMethodSelect.attr("value",b,!1);this._handleClassifyIntervalVisibility(b)}},_setupClassifyFieldStore:function(){if(this.layer){var a=
this._i18n.widgets.renderingRule.valueLabel;var b=this._isClassBreaksRenderer(this.layer.renderer)?this.layer.renderer.attributeField:"Value";a=this.layer&&this.layer.rasterAttributeTable?this._getRasterAttributeTableFields(!0):[{name:a,alias:a,id:"Value"}];this.classifyFieldSelect.set("store",new u({data:a}));this.classifyFieldSelect.attr("value",b,!1)}},_getRasterAttributeTableFields:function(a){if(this.layer){var b=this.layer.id,c=this.rasterFunctionList.value;if(b=this._cachedRATList[b]&&this._cachedRATList[b][c]||
this.layer.rasterAttributeTable)return b=h.clone(b.fields),b=l.filter(b,function(d){if("esriFieldTypeOID"!==d.type&&(!a||"esriFieldTypeString"!==d.type))return!0}),b=l.map(b,function(d){d.id=d.name;return d})}},_setupFunctionStore:function(){if(this.layer){this._rasterFunctionStore=new u({data:this._rasterFunctionData,idProperty:"name"});this.rasterFunctionList.set("store",this._rasterFunctionStore);this.rasterFunctionList.set("labelAttr","label");this.rasterFunctionList.set("labelType","html");var a=
this.layer.rasterFunctionInfos;a&&0<a.length&&a[0].name&&(this._firstFncInRenderingRuleList=a[0].name);a=this.layer.renderingRule;var b="";(b=a&&a.functionName&&!this._isNoneRenderingRule(a)?"stretch"!==a.functionName.toLowerCase()&&"colormap"!==a.functionName.toLowerCase()?this._isRFTJson(a)?this._i18n.widgets.renderingRule.custom+": "+a.functionName:a.functionName:this._getRenderingRuleNameFromStretchFunction(a)||this._defaultBandCombinationFncName:this._firstFncInRenderingRuleList&&"none"!==this._firstFncInRenderingRuleList.toLowerCase()&&
!this.layer.bandIds?this._firstFncInRenderingRuleList:this._defaultBandCombinationFncName)&&(this._rasterFunctionStore.get(b)||"Colormap"===b)&&(this.rasterFunctionList.set("value",b),this._onRasterFunctionChange())}else console.log("Could not populate renderers as the layer does not exists")},_getExportImageCall:function(){var a=this.layer;if(null!==a&&null!==a.extent){var b=new ma(a.extent.xmin,a.extent.ymin,a.extent.xmax,a.extent.ymax,a.extent.spatialReference),c=b.getWidth(),d=b.getHeight();if(2<=
c/d||2<=d/c)c=Math.min(c,d)/2,d=b.getCenter(),b.update(d.x-c,d.y-c,d.x+c,d.y+c,a.extent.spatialReference);b=b.xmin+","+b.ymin+","+b.xmax+","+b.ymax;a=a._getToken();return{path:this.layer.url+"/exportImage?",params:{bbox:b,token:a,size:"400,400",f:"image"}}}},_fillRasterFunctionList:function(a){if(this.layer){this._rasterFunctionData=[];var b=this._getExportImageCall(),c=b.params,d=this.layer.bandIds;c.renderingRule='{"rasterFunction":"none"}';d&&3<=d.length&&(c.bandIds=d[0]+","+d[1]+","+d[2]);this._addFunctionItemToList(this._defaultBandCombinationFncName,
this._defaultBandCombinationFncName,this._i18n.widgets.renderingRule.userDefinedRendererDesc,b,"");a.rasterFunctionInfos&&0<a.rasterFunctionInfos.length&&l.forEach(a.rasterFunctionInfos,h.hitch(this,function(e){var f={};if("none"!==e.name.toLowerCase()){if(e.thumbnail&&0<e.thumbnail.length&&this._isADataUrl(e.thumbnail))f.path=e.thumbnail;else{var g='{"rasterFunction":"'+e.name+'"}';f=b;f.params.renderingRule=g}this._addFunctionItemToList(e.name,e.name,e.description,f)}}));a={};a.layer=this.layer;
a.data=this._rasterFunctionData;this._cachedFunctionList.push(a);this._setupFunctionStore();a=this.rasterFunctionList.value;this.layer.rasterFunctionInfos&&this.layer.rasterFunctionInfos.length<this._preFetchRFTServiceInfoThreshold?l.forEach(this.layer.rasterFunctionInfos,function(e){this._generateRenderingRuleServiceInfo(e.name)},this):a&&a!==this._defaultBandCombinationFncName&&this._generateRenderingRuleServiceInfo(a)}},_generateRenderingRuleServiceInfo:function(a){a=new v({rasterFunction:a});
this.layer.getRenderingRuleServiceInfo(a).then(function(b){var c=l.filter(this._rasterFunctionData,function(d){return d.name===this.rasterFunctionList.value},this)[0];c&&(c.serviceInfo=b,this._isVectorData(b)&&!this._isTileOnlyTileImageryLayer(b)&&this._showVectorWarningIcon(),this._setupRFTDefaults())}.bind(this))},_isADataUrl:function(a){return/^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+=[a-z\-]+)?)?(;base64)?,[a-z0-9!\$&',\(\)\*\+,;=\-\._~:@\/\?%\s]*\s*$/i.test(a)},_addFunctionItemToList:function(a,b,c,
d,e,f){function g(w){var x={};x.name=a;x.id=b;var A=c||"";A&&200<A.length&&(A=A.substring(0,200)+"...");x.description=A;x.serviceInfo=e;x.label="\x3chtml\x3e\x3cbody\x3e\x3csection\x3e\x3ch4\x3e"+a+":\x3c/h4\x3e\x3ctable cellspacing\x3d'5'\x3e\x3ctr\x3e\x3ctd\x3e\x3cimg src\x3d'"+w+"' height\x3d'100' width\x3d'100'\x3e\x3c/td\x3e\x3ctd\x3e\x3cp style\x3d'white-space:pre-wrap;width:40ex'\x3e\x3ci\x3e"+A+"\x3c/i\x3e\x3c/p\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/section\x3e\x3c/body\x3e\x3c/html\x3e";
m._rasterFunctionData.push(x);f&&f()}var k=d.path,n=(d=d.params)&&d.token,m=this,q=U.addProxy(k+ha.objectToQuery(d));q.length>ka.defaults.io.postLength&&!this._isADataUrl(k)?(g(q),la({url:k,content:h.mixin(d,{f:"json"}),callbackParamName:"callback",load:function(w,x){w=w.href;n&&(w+=-1===w.indexOf("?")?"?token\x3d"+n:"\x26token\x3d"+n);this._rasterFunctionStore.remove(a);g(U.addProxy(w))}.bind(this),error:this._errorHandler})):g(q)},_setupColorRampDefaults:function(){this.layer&&this._setColorRampVisibility()},
_setColorRampVisibility:function(){var a=this._rasterFunctionStore&&this._rasterFunctionStore.get(this.rasterFunctionList.value);a=a?a.serviceInfo:null;if(!this._canApplyRenderer())return this._hideColorRampSelector();this.bandIdsLabel.value=this._i18n.widgets.renderingRule.bandCombinationLabelTitle;if(this.symbologyType===this._symbologyTypes.stretch){var b=a&&a.bandCount?a.bandCount:this.layer.bandCount,c=a&&a.pixelType?a.pixelType:this.layer.pixelType,d=this.layer.renderer,e=this.layer.renderingRule,
f=this._getStretchRenderingRule(e);if(this._isSelectedRenderingRule(this.layer.renderingRule)&&(this._isStretchRenderer(d)&&d.colorRamp&&d.stretchType==this.stretchMethodList.value||e&&e.functionName&&"colormap"===e.functionName.toLowerCase()&&(f&&f.StretchType)===this.stretchMethodList.value))return this._showColorRampSelector();1<b||10.3>this.layer.currentVersion||"u8"!==c.toLowerCase()&&"0"===this.stretchMethodList.value?1<b?this._updateMultiBandStretchColorRampVisibility(a):this._hideColorRampSelector():
this._showColorRampSelector()}else this.symbologyType===this._symbologyTypes.colormap?this._hideColorRampSelector():this._showColorRampSelector()},_updateMultiBandStretchColorRampVisibility:function(a){a=a||this._getCurrentServiceInfo();1!==a.bandCount&&this.symbologyType===this._symbologyTypes.stretch&&(this.bandIdsRedList.value===this.bandIdsGreenList.value&&this.bandIdsRedList.value===this.bandIdsBlueList.value&&null!==this.bandIdsRedList.value?this._showColorRampSelector():this._hideColorRampSelector())},
_setColorRampSelectValue:function(){if(this.layer){var a=this.layer.renderer,b=this.layer.renderingRule&&this.layer.renderingRule.functionName;b="none"===b?this._defaultBandCombinationFncName:b;var c=this.rasterFunctionList.value;b=this._isTileImagery||b===c;c=this.layer.renderingRule;this.symbologyType===this._symbologyTypes.stretch?(this.colorRampSelect.removeColorRamp(this._uniqueValuesColorRamp),this._isStretchRenderer(a)&&this._isSelectedRenderingRule(this.layer.renderingRule)?this._setRendererColorRamp(a.colorRamp):
c&&c.functionName&&"colormap"===c.functionName.toLowerCase()&&c.functionArguments&&c.functionArguments.colorRamp?this.colorRampSelect.setSelected(c.functionArguments.colorRamp):this._setStretchColorRamp()):(c=a&&a.authoringInfo&&a.authoringInfo.colorRamp?O.fromJson(h.clone(a.authoringInfo.colorRamp)):null,this.symbologyTypeSelect.value===this._symbologyTypes.uniqueValues?(this._uniqueValuesColorRamp&&this.colorRampSelect.addColorRamp(this._uniqueValuesColorRamp),this._isUniqueValueRenderer(a)&&c&&
b?this._setRendererColorRamp(c):this._setUniqueValuesColorRamp()):this.symbologyTypeSelect.value===this._symbologyTypes.classify&&(this.colorRampSelect.removeColorRamp(this._uniqueValuesColorRamp),this._isClassBreaksRenderer(a)&&c?this._setRendererColorRamp(c):this._setClassifyColorRamp()));this.invertColorRampCheckbox.checked=this.colorRampSelect.isInverted}},_setRendererColorRamp:function(a){a&&this.layer?this.colorRampSelect.setSelected(a)||this._addCustomColorRamp(a):this.colorRampSelect.reset()},
_hideColorRampSelector:function(){p.set(this.colorRampBlock,"display","none");p.set(this.colorRampLabelBlock,"display","none");p.set(this.colorRampInvertBlock,"display","none");t.remove(this.colorRampSelectionBlock,"esriRenderingRuleVisible");t.add(this.colorRampSelectionBlock,"esriRenderingRuleHidden");this._colorRampVisible=!1},_showColorRampSelector:function(){this.layer&&(this._setColorRampSelectValue(),t.remove(this.colorRampSelectionBlock,"esriRenderingRuleHidden"),t.add(this.colorRampSelectionBlock,
"esriRenderingRuleVisible"),p.set(this.colorRampBlock,"display","table-row"),p.set(this.colorRampLabelBlock,"display","table-row"),this._updateInvertBlockVisibility(),this._colorRampVisible=!0)},_updateInvertBlockVisibility:function(){this.symbologyType!==this._symbologyTypes.stretch&&this.symbologyType!==this._symbologyTypes.shadedRelief||"none"===this.colorRampSelect.value?p.set(this.colorRampInvertBlock,"display","none"):p.set(this.colorRampInvertBlock,"display","table-row")},_getDefaultSymbologyType:function(){if(this.layer){if(this._isSelectedRenderingRule(this.layer.renderingRule)){if(this.layer.renderer&&
this.layer.renderer.declaredClass){var a=this.layer.renderer.declaredClass;if("esri.renderer.StretchRenderer"===a)return this._symbologyTypes.stretch;if("esri.renderer.ClassBreaksRenderer"===a)return this._symbologyTypes.classify;if("esri.renderer.UniqueValueRenderer"===a)return this._symbologyTypes.uniqueValues;if("esri.renderer.ShadedReliefRenderer"===a)return this._symbologyTypes.shadedRelief;if("esri.renderer.ColormapRenderer"===a)return this._symbologyTypes.colormap}if(this.layer.renderingRule&&
((a=this.layer.renderingRule)&&a.functionName&&"stretch"===a.functionName.toLowerCase()||a&&a.functionName&&"colormap"===a.functionName.toLowerCase()&&a.functionArguments&&a.functionArguments.Raster&&a.functionArguments.Raster.functionName&&"stretch"===a.functionArguments.Raster.functionName.toLowerCase()))return this._symbologyTypes.stretch}if(this.rasterFunctionList.value===this._defaultBandCombinationFncName&&this.layer.hasColormap)return this._symbologyTypes.colormap;if(this._cachedRATList[this.layer.id]&&
this._cachedRATList[this.layer.id][this.rasterFunctionList.value]&&(a=this._cachedRATList[this.layer.id][this.rasterFunctionList.value],a.features.length&&this._ratContainsColormap(a)))return this._symbologyTypes.uniqueValues;if(this._canApplyRenderer())return this._symbologyTypes.stretch}},_setupBandIdDefaults:function(){if(this.layer){var a=3;a=this.layer.bandCount;var b=this.layer.id,c=this._cachedkeyProperties[b];!c&&1<a?(this.msgLabel.style.display="",this.msgLabel.innerHTML="\x3ci\x3e"+this._i18n.widgets.renderingRule.bandNamesRequestMsg+
"\x3c/i\x3e",c=this.layer.getKeyProperties(),this._pendingDfds[b]=1,c.addBoth(h.partial(this._fillBandIdList,this,this.layer))):this._fillBandIdList(this,this.layer,c);3>a?this._hideBandIds():this._showBandIds()}},_fillBandIdList:function(a,b,c){if(a.layer&&a.layer===b){var d=a._pendingDfds,e=a.layer.id;d&&d[e]&&delete d[e];a.msgLabel.style.display="none";a.msgLabel.innerHTML="";d=3;d=a.layer.bandCount;if(c&&c.BandProperties&&0<c.BandProperties.length)var f=c.BandProperties;var g=a._getBandIdList(d,
f,"");a._redBandIdStore=new u({data:g,idProperty:"name"});a.bandIdsRedList.set("store",a._redBandIdStore);a.bandIdsRedList.set("labelAttr","label");a.bandIdsRedList.set("labelType","html");a.bandIdsRedList.on("change",function(){a._setColorRampVisibility()});g=a._getBandIdList(d,f,"");a._greenBandIdStore=new u({data:g,idProperty:"name"});a.bandIdsGreenList.set("store",a._greenBandIdStore);a.bandIdsGreenList.set("labelAttr","label");a.bandIdsGreenList.set("labelType","html");a.bandIdsGreenList.on("change",
function(){a._setColorRampVisibility()});g=a._getBandIdList(d,f,"");a._blueBandIdStore=new u({data:g,idProperty:"name"});a.bandIdsBlueList.set("store",a._blueBandIdStore);a.bandIdsBlueList.set("labelAttr","label");a.bandIdsBlueList.set("labelType","html");a.bandIdsBlueList.on("change",function(){a._setColorRampVisibility()});f=a.layer.bandIds||a._getDefaultBandCombination(d,f);2<=d&&f&&1===f.length&&(f=[f[0],f[0],f[0]]);f&&2<f.length?(a.bandIdsRedList.attr("value",a._getBandName(a._redBandIdStore,
f[0]),!1),a.bandIdsGreenList.attr("value",a._getBandName(a._greenBandIdStore,f[1]),!1),a.bandIdsBlueList.attr("value",a._getBandName(a._blueBandIdStore,f[2]),!1)):0<a._redBandIdStore.data.length&&(d=a._getRedBandIndex(c),f=a._getGreenBandIndex(c),g=a._getBlueBandIndex(c),a.bandIdsRedList.attr("value",a._redBandIdStore.data[d].name,!1),1<a._greenBandIdStore.data.length?a.bandIdsGreenList.attr("value",a._greenBandIdStore.data[f].name,!1):a.bandIdsGreenList.attr("value",a._greenBandIdStore.data[d].name,
!1),2<a._blueBandIdStore.data.length?a.bandIdsBlueList.attr("value",a._blueBandIdStore.data[g].name,!1):2>a._blueBandIdStore.data.length?a.bandIdsBlueList.attr("value",a._blueBandIdStore.data[d].name,!1):a.bandIdsBlueList.attr("value",a._blueBandIdStore.data[f].name,!1));a._cachedkeyProperties[e]=c;a.rasterFunctionList.get("value")===a._defaultBandCombinationFncName&&a._enableBandIds();a._updateMultiBandStretchColorRampVisibility(b)}},_getDefaultBandCombination:function(a,b){if(1===a)return null;
if(2===a)return[0,0,0];var c=[];b&&b.length===a&&(b=this._getWellKnownBandIndexes(b),null!=b.red&&null!=b.green&&null!=b.blue?c=[b.red,b.green,b.blue]:null!=b.nir&&null!=b.red&&null!=b.green&&(c=[b.nir,b.red,b.green]));!c&&3<=a&&(c=[0,1,2]);return c},_getWellKnownBandIndexes:function(a){for(var b={},c=0;c<a.length;c++){var d=a[c],e=d.BandName&&d.BandName.toLowerCase();"red"===e?b.red=c:"green"===e?b.green=c:"blue"===e?b.blue=c:"nearinfrared"===e||"nearinfrared_1"===e||"nir"===e?b.nir=c:d.WavelengthMax&&
d.WavelengthMin&&(e=d.WavelengthMin,d=d.WavelengthMax,null==b.blue&&410<=e&&480>=e&&480<=d&&540>=d?b.blue=c:null==b.green&&490<=e&&560>=e&&560<=d&&610>=d?b.green=c:null==b.red&&595<=e&&670>=e&&660<=d&&730>=d?b.red=c:null==b.nir&&700<=e&&860>=e&&800<=d&&950>=d&&(b.nir=c))}return b},_getRedBandIndex:function(a){a=a&&a.BandProperties;if(!this.layer||!a)return 0;var b;for(b=0;b<a.length;b++)if(a[b]&&a[b].hasOwnProperty("BandName")&&"red"===a[b].BandName.toLowerCase())return b;return 0},_getGreenBandIndex:function(a){var b=
a&&a.BandProperties;if(!this.layer||!b)return 1;var c;for(c=0;c<b.length;c++)if(b[c]&&b[c].hasOwnProperty("BandName")&&"green"===b[c].BandName.toLowerCase())return c;return this._isCCDC(a)?0:1},_getBlueBandIndex:function(a){var b=a&&a.BandProperties;if(!this.layer||!b)return 2;var c;for(c=0;c<b.length;c++)if(b[c]&&b[c].hasOwnProperty("BandName")&&"blue"===b[c].BandName.toLowerCase())return c;return this._isCCDC(a)?0:2},_isCCDC:function(a){return(a=a&&a.ChangeAnalysisParameters&&a.ChangeAnalysisParameters.AnalysisType)&&
("ccdc"===a.toLowerCase()||"landtrendr"===a.toLowerCase())},_getBandIdList:function(a,b,c){if(this.layer){var d=[];c||(c="Black");var e=!1;b&&a===b.length&&(e=!0);var f;for(f=0;f<a;f++){var g=f,k=f;e&&b[f]&&b[f].BandName?g=b[f].BandName:g++;var n={};n.name=g;n.index=k;n.label="\x3chtml\x3e\x3cbody\x3e\x3cspan value\x3d"+k+"\x3e\x3cfont color\x3d"+c+"\x3e"+g+"\x3c/font\x3e\x3c/span\x3e\x3c/body\x3e\x3c/html\x3e";d.push(n)}return d}},_showVectorWarningIcon:function(){p.set(this.vectorWarningIcon,"display",
"inline-block");this._vectorWarningShown||this._showVectorWarning()},_showVectorWarning:function(){this._startupCalled&&(H.open({popup:this._vectorTooltipDlg,around:this.vectorWarningIcon,orient:["below"],onCancel:this._hideVectorWarning}),this._vectorWarningShown=!0)},_hideVectorWarning:function(){H.close(this._vectorTooltipDlg)},_hideVectorWarningIcon:function(){p.set(this.vectorWarningIcon,"display","none");H.close(this._vectorTooltipDlg)},_showClassifyLoadingMsg:function(){p.set(this.classifyLoadingMsg,
"display","block")},_hideClassifyLoadingMsg:function(){p.set(this.classifyLoadingMsg,"display","none")},_showUniqueValuesLoadingMsg:function(){p.set(this.uniqueValuesLoadingMsg,"display","block")},_hideUniqueValuesLoadingMsg:function(){p.set(this.uniqueValuesLoadingMsg,"display","none")},_createVectorLayer:function(){var a=-1<this.rasterFunctionList.value.indexOf(this._i18n.widgets.renderingRule.custom+": ")?this._customFunctionList[this.layer.id][this.rasterFunctionList.value]:this.rasterFunctionList.value;
this.emit("vector-rft-select",{layer:this.layer,rasterFunctionTemplate:a});this._hideVectorWarning()},_getBandName:function(a,b){if(a&&a.data){var c;for(c=0;c<a.data.length;c++){var d=a.data[c];if(d.index===b)return d.name}return""}},_setupStretchDefaults:function(){if(this.layer){var a=this._getStretchRenderingRule(this.layer.renderingRule);this._isTileImagery&&this.layer.renderer?this._loadStretchRenderer(this.layer.renderer):this._isSelectedRenderingRule(this.layer.renderingRule)&&(this._isStretchRenderer(this.layer.renderer)||
a)?this._isStretchRenderer(this.layer.renderer)?this._loadStretchRenderer(this.layer.renderer):a&&this._loadStretchFunction(a):(this.stretchMethodList.attr("value","0",!1),this._onStretchMethodChange(),this.numStdDevText.set("value",2),this.minPercentText.set("value",2),this.maxPercentText.set("value",2),this.gammaSlider.setValue(0),this._updateStretchStatsGrid(),this._getServiceMinAndMax(),this.draCheckbox.checked=this.minValues&&0<this.minValues.length&&this.maxValues&&0<this.maxValues.length?!1:
this._isMultidimensionalLayer()?!1:!0);this._gammaSliderTooltip||(this._gammaSliderTooltip=new Y({connectId:["gammaSliderID"],position:["below","above"],id:"gammaSliderTooltipID"}))}},_isMultidimensionalLayer:function(){return this.layer.hasMultidimensions&&("esri.layers.RasterXLayer"===this.layer.declaredClass||10.81<=this.layer.version)},_hasServiceMinMax:function(a){return a.minValues&&0<a.minValues.length&&a.maxValues&&0<a.maxValues.length},_getServiceMinAndMax:function(){var a=this._getCurrentServiceInfo();
this.minValues=a&&a.minValues;this.maxValues=a&&a.maxValues},_loadStretchFunction:function(a){if(a&&a.functionName&&"stretch"===a.functionName.toLowerCase()){this._stretchReadFromRenderingRule=!0;a=a.functionArguments;this.stretchMethodList.attr("value",a.StretchType.toString(),!1);this._onStretchMethodChange();a.NumberOfStandardDeviations&&this.numStdDevText.set("value",a.NumberOfStandardDeviations);this.draCheckbox.checked=a.DRA?!0:!1;if(a.UseGamma){var b=a.Gamma;0<a.Gamma.length&&(b=a.Gamma[0]);
(b=Math.log(b)/Math.log(10))&&this.gammaSlider.setValue(b)}else this.gammaSlider.setValue(0);a.MinPercent&&this.minPercentText.set("value",a.MinPercent);a.MaxPercent&&this.maxPercentText.set("value",a.MaxPercent);a.Statistics&&a.Statistics.length&&this._loadStretchStats(a.Statistics)}},_loadStretchRenderer:function(a){if(this._isStretchRenderer(a)){this._stretchReadFromRenderingRule=!1;var b=a._convertStretchTypeEnumToIndex(a.stretchType);this.stretchMethodList.set("value",b.toString());this._onStretchMethodChange();
a.numberOfStandardDeviations&&this.numStdDevText.set("value",a.numberOfStandardDeviations);this.draCheckbox.checked=a.dra?!0:!1;a.useGamma?(b=a.gamma,0<a.gamma.length&&(b=a.gamma[0]),(b=Math.log(b)/Math.log(10))&&this.gammaSlider.setValue(b)):this.gammaSlider.setValue(0);a.minPercent&&this.minPercentText.set("value",a.minPercent);a.maxPercent&&this.maxPercentText.set("value",a.maxPercent);a.statistics&&a.statistics.length&&this._loadStretchStats(a.statistics)}},_loadStretchStats:function(a){a&&a.length?
this._populateStatsGrid(a):this._isMultidimensionalLayer()?this._populateStatsGridForMultiDimensionalLayer():(this._updateStretchStatsGrid(),this._setStretchStatsGridVisibility())},_populateStatsGridForMultiDimensionalLayer:function(){var a=this.layer._getDefaultMultidimensionalDefinition(this.layer._multidimensionalInfo),b=this.layer.mosaicRule&&this.layer.mosaicRule.multidimensionalDefinition;this.layer.getStatistics(b&&b.length?b[0].variableName:a.length?a[0].variableName:"").then(h.hitch(this,
function(c){this._populateStatsGrid(c)}),h.hitch(this,function(c){this.draCheckbox.checked=!0}))},_populateStatsGrid:function(a){if(a){var b=this._getCurrentServiceInfo().bandCount;this.symbologyType===this._symbologyTypes.stretch&&1<b&&1===a.length&&(a=[a[0],a[0],a[0]]);var c=this._getValidBandArray(a.length);b=Math.max.apply(null,c);a.length<=b&&(c=[],a.map(function(e,f){c.push(f)}));var d=[];l.forEach(c,function(e,f){e=a[e]||a[e-1];d.push({id:f,esriRenderingRuleStretchMin:null!=e[0]?e[0]:e.min,
esriRenderingRuleStretchMax:null!=e[1]?e[1]:e.max,esriRenderingRuleStretchMean:null!=e[2]?e[2]:e.mean,esriRenderingRuleStretchStdv:null!=e[3]?e[3]:e.standardDeviation})});this._updateStretchStatsGrid(d);this._setStretchStatsGridVisibility()}},_getRenderingRuleNameFromStretchFunction:function(a){if(a&&a.functionName&&"stretch"===a.functionName.toLowerCase())return(a=a.functionArguments.Raster)&&a.functionName||null},_fillStretchMethodList:function(){this.stretchMethodList.removeOption(this.stretchMethodList.getOptions());
this.stretchMethodList.addOption([{value:"0",label:this._i18n.widgets.renderingRule.noneStretchAlias},{value:"5",label:this._i18n.widgets.renderingRule.minMaxStretchAlias},{value:"3",label:this._i18n.widgets.renderingRule.stdDevStretchAlias},{value:"6",label:this._i18n.widgets.renderingRule.percentClipStretchAlias}]);this.stretchMethodList.set("value","0");this._onStretchMethodChange()},_onDRAChange:function(){this.symbologyType===this._symbologyTypes.stretch&&"0"!==this.stretchMethodList.value&&
(this._updateStretchStatsGrid(),this._setStretchStatsGridVisibility())},_setStretchStatsGridVisibility:function(){var a=this.stretchMethodList.value,b="0"!==a&&!this.draCheckbox.checked&&this._stretchStatsData&&this._stretchStatsData.length?"":"none";t.toggle(this.stretchStatsBlock,"esriRenderingRuleDisabledGrid","6"===a);this.stretchStatsBlock.style.display=b},_getCurrentServiceInfo:function(){var a=this._rasterFunctionStore&&this._rasterFunctionStore.get(this.rasterFunctionList.value);return this.rasterFunctionList.value===
this._defaultBandCombinationFncName?this.layer:a&&a.serviceInfo?a.serviceInfo:this.layer},_updateStretchStatsGrid:function(a){if(this._stretchStatsGrid){if(!a||"number"===typeof a||"string"===typeof a){if(this._isMultidimensionalLayer()){this._populateStatsGridForMultiDimensionalLayer();return}var b=this._getCurrentServiceInfo(),c=b&&b.bandCount,d={},e=["minValues","maxValues","meanValues","stdvValues"];a=[];l.forEach(e,function(f){d[f]=b&&b[f]?b[f]:this.layer[f]?this.layer[f]:Array(c)},this);0===
d[e[0]].length||0===d[e[1]].length?(e=this.layer.pixelType?this.pixelTypeRanges[this.layer.pixelType.toLowerCase()]:[0,255],a.push({id:0,esriRenderingRuleStretchMin:e[0],esriRenderingRuleStretchMax:e[1],esriRenderingRuleStretchMean:"",esriRenderingRuleStretchStdv:""})):(e=this._getValidBandArray(c),l.forEach(e,function(f,g){a.push({id:g,esriRenderingRuleStretchMin:d.minValues[f],esriRenderingRuleStretchMax:d.maxValues[f],esriRenderingRuleStretchMean:d.meanValues[f],esriRenderingRuleStretchStdv:d.stdvValues[f]})}))}a=
this._sanitizeStretchStatsData(a);e=new Q(new u({data:a,idProperty:"id"}));this._stretchStatsGrid.set("store",e);this._stretchStatsData=a}},_getValidBandArray:function(a){var b=0,c=1,d=2;if(this.rasterFunctionList.value===this._defaultBandCombinationFncName&&1<a){var e=this._redBandIdStore&&this._redBandIdStore.get(this.bandIdsRedList.value);var f=this._greenBandIdStore&&this._greenBandIdStore.get(this.bandIdsGreenList.value);var g=this._blueBandIdStore&&this._blueBandIdStore.get(this.bandIdsBlueList.value);
b=e?e.index:b;c=f?f.index:c;d=g?g.index:d}return 1<a?[b,c,d]:[b]},_onSymbologyTypeChange:function(a){if(this.layer){this.symbologyType=a;var b=this.layer.renderer,c=this.layer.renderingRule,d=this._getStretchRenderingRule(c);c=this._isSelectedRenderingRule(c);this._showBlocks([]);a===this._symbologyTypes.classify?(this._showBlocks([this.classifyBlock,this.classifyGridBlock]),this._isClassBreaksRenderer(b)&&c?this._setupClassifyGridDefaults():this._updateClassifyGrid()):a===this._symbologyTypes.uniqueValues?
(this._showBlocks([this.uniqueValuesBlock,this.uniqueValuesGridBlock]),this._isUniqueValueRenderer(b)&&c?this._setupUniqueValuesGridDefaults():this._updateUniqueValuesGrid()):a===this._symbologyTypes.stretch?(c?this._isStretchRenderer(b)?this._loadStretchStats(b.statistics):d&&d.functionArguments?this._loadStretchStats(d.functionArguments.Statistics):this._updateStretchStatsGrid():this._updateStretchStatsGrid(),this._showBlocks([this.stretchBlock])):a===this._symbologyTypes.shadedRelief?(this._isShadedReliefRenderer(b)?
this._loadShadedReliefWithRenderer(b):this._loadShadedReliefWithDefaults(),this._showBlocks([this.shadedReliefBlock]),10.8>=this.layer.currentVersion?z(".shadedReliefHillShadeTypeBlock",this.domNode).addClass("esriRenderingRuleHidden"):z(".shadedReliefHillShadeTypeBlock",this.domNode).removeClass("esriRenderingRuleHidden"),this._onHillShadeTypeChange(),this._onScalingChange()):a===this._symbologyTypes.colormap&&(this._showBlocks([this.uniqueValuesGridBlock]),this._updateColormapGrid())}},_updateColormapGrid:function(){var a=
this._getColormapGridData();a&&a.length&&this._updateUniqueValuesGrid(a)},_loadShadedReliefWithDefaults:function(){this._traditionalRadio.set("checked",!0);this._noneRadio.set("checked",!0);this.shadedReliefAzimuthSlider.set("value",315);this.shadedReliefAltitudeSlider.set("value",45);this.zFactorInput.set("value",1);this.pixelSizePowerInput.set("value",.664);this.pixelSizeFactorInput.set("value",.024);this.colorRampSelect.reset()},_loadShadedReliefWithRenderer:function(a){this.shadedReliefAzimuthSlider.set("value",
a.azimuth);this.shadedReliefAltitudeSlider.set("value",a.altitude);this.zFactorInput.set("value",a.zFactor);this.pixelSizePowerInput.set("value",a.pixelSizePower);this.pixelSizeFactorInput.set("value",a.pixelSizeFactor);("traditional"===a.hillshadeType?this._traditionalRadio:this._multidirectionalRadio).set("checked",!0);("none"===a.scalingType?this._noneRadio:this._adjustedRadio).set("checked",!0);a.colorRamp?this._setRendererColorRamp(a.colorRamp):this.colorRampSelect.reset()},_onClassifyFieldChange:function(){this.classifyMethodSelect.value===
this._classifyMethods.definedInterval&&this._setDefaultIntervalSize();this._updateClassifyGrid()},_onClassifyMethodChange:function(a){this.classifyMethodSelect.value!==this._classifyMethods.manualInterval&&(this.classifyMethodSelect.value===this._classifyMethods.definedInterval&&this._setDefaultIntervalSize(),this._handleClassifyIntervalVisibility(a),this._updateClassifyGrid())},_handleClassifyIntervalVisibility:function(a){a===this._classifyMethods.definedInterval?(p.set(this.classifyIntervalsBlock,
"display","table-row"),this.classifyNClassesInput.set("disabled",!0)):(p.set(this.classifyIntervalsBlock,"display","none"),this.classifyNClassesInput.set("disabled",!1))},_showBlocks:function(a){l.forEach(this._symbologyBlocks,function(b){-1<l.indexOf(a,b)?(t.remove(b,"esriRenderingRuleHidden"),t.add(b,"esriRenderingRuleVisible")):(t.remove(b,"esriRenderingRuleVisible"),t.add(b,"esriRenderingRuleHidden"))});this._setColorRampVisibility()},_onRasterFunctionChange:function(){var a=this.rasterFunctionList.value;
this.customRFTMessage.innerText="";if(this._rasterFunctionStore&&this._rasterFunctionStore.get(a))if(a===this._defaultBandCombinationFncName||this._rasterFunctionStore.get(a).serviceInfo)this._updateRasterFunction();else{var b=new v({rasterFunction:a});this._showBlocks([this.serviceInfoLoadingBlock]);this._hideColorRampSelector();this.layer.getRenderingRuleServiceInfo(b).then(function(c){this._rasterFunctionStore.get(a).serviceInfo=c;this._updateRasterFunction()}.bind(this),function(c){this._updateRasterFunction()}.bind(this))}},
_updateRasterFunction:function(){var a=this.rasterFunctionList.get("value");this._removeCustomItemFromList(a);if(a){var b=this._rasterFunctionStore.get(a).description,c=this._getCurrentServiceInfo();this._setupRFTDefaults();this.rasterFunctionList.set("title",b);this._isVectorData(c)&&!this._isTileOnlyTileImageryLayer(c)?this._showVectorWarningIcon():this._hideVectorWarningIcon();b=this.layer.id;this._setColorRampVisibility();a===this._defaultBandCombinationFncName?(this.rasterFunctionRow.width="",
1<this.layer.bandCount?(this._showBandIds(),this._pendingDfds[b]?this._disableBandIds():this._enableBandIds()):this._hideBandIds()):(0<this.domNode.clientWidth&&(this.rasterFunctionRow.width=this.domNode.clientWidth),this._hideBandIds());a===this._defaultBandCombinationFncName||10.3<=this.layer.version?(this.imageEnhancementLabel.style.display="",this.stretchMethodLabel.style.display="",this.stretchDescLabel.style.display="",this.stretchMethodList.domNode.style.display="",this._onStretchMethodChange()):
this._hideStretch()}},_isVectorData:function(a){a=a&&a.serviceDataType;return"esriImageServiceDataTypeVector-UV"===a||"esriImageServiceDataTypeVector-MagDir"===a},_isTileOnlyTileImageryLayer:function(a){return a&&a.cacheType&&"raster"===a.cacheType.toLowerCase()&&a.capabilities&&-1<a.capabilities.toLowerCase().indexOf("tilesonly")},_setClassifyColorRamp:function(){this.colorRampSelect.setSelected("Yellow to Red")},_setUniqueValuesColorRamp:function(){this._uniqueValuesColorRamp?this.colorRampSelect.setSelected(this._uniqueValuesColorRampName):
this.colorRampSelect.setSelected("Aspect")},_setStretchColorRamp:function(){this.colorRampSelect.reset()},_updateUniqueValuesGrid:function(a,b){this._uniqueValuesGrid&&(a=a&&a.length&&a[0].esriRenderingRuleUniqueValuesSymbol?a:this._getUniqueValuesGridData(b))&&a.length&&(void 0===a[0].id&&l.forEach(a,function(c,d){c.id=d}),b=new ea(new u({data:a,idProperty:"id"})),this._uniqueValuesGrid.set("store",b),this._uniqueValuesSymbolData=a,this._hideUniqueValuesLoadingMsg())},_updateClassifyGrid:function(a,
b){if(this._classifyGrid&&(a=a&&a.length&&a[0].esriRenderingRuleClassifySymbol?a:this._getClassifyGridData(b))&&a.length){b=a[0]?a[0].maxValue-a[0].minValue:this.classifyIntervalInput.value;void 0===a[0].id&&l.forEach(a,function(d,e){d.id=e});var c=new Q(new u({data:a,idProperty:"id"}));this._classifyGrid.set("store",c);this._classifySymbolData=a;this.classifyIntervalInput.attr("value",b,!1);this.classifyNClassesInput.attr("value",a.length,!1);this._hideClassifyLoadingMsg()}},_openColorPickerPopup:function(a){if(!this._colorPickerOpen){a.stopPropagation();
this._colorPicker||(this._colorPicker=new oa({showTransparencySlider:!1}),this._colorPicker.startup());var b=a.target;this._colorPicker.set("color",b.style.backgroundColor,!1);H.open({popup:this._colorPicker,around:b,orient:["below","above"]});this._colorPickerOpen=!0;var c=N(document.body,"click",h.hitch(this,function(e){this._colorPicker.domNode.contains(e.target)||e.target===this._colorPicker.domNode||(d.remove(),c.remove(),H.close(this._colorPicker),this._colorPickerOpen=!1)}));var d=N(this._colorPicker,
"color-change",h.hitch(this,function(e){c.remove();d.remove();var f=e.color,g=this.symbologyType===this._symbologyTypes.classify?parseInt(b.id.replace("EsriRenderingRuleEditorClassifyGrid",""),10):parseInt(b.id.replace("EsriRenderingRuleUniqueValuesGrid",""),10);H.close(this._colorPicker);this._colorPickerOpen=!1;"no-color"===f?b.style.background="rgba(0,0,0,0)":(f.a=1,b.style.background="rgba("+f.r+", "+f.g+","+f.b+", 255)");this.symbologyType===this._symbologyTypes.classify?l.some(this._classifySymbolData,
h.hitch(this,function(k){if(k.id===g)return k.esriRenderingRuleClassifySymbol={r:f.r,g:f.g,b:f.b,a:f.a}})):l.some(this._uniqueValuesSymbolData,h.hitch(this,function(k){if(k.id===g)return k.esriRenderingRuleUniqueValuesSymbol={r:f.r,g:f.g,b:f.b,a:f.a}}))}))}},_onColorRampChange:function(){if(this.symbologyType===this._symbologyTypes.uniqueValues)return this._updateUniqueValuesGrid(null,!0);if(this.symbologyType===this._symbologyTypes.classify)return this._updateClassifyGrid(null,!0)},_onStretchMethodChange:function(){if(!(1>
this.stretchMethodList.getOptions.length)){var a=this.stretchMethodList.get("value");"0"===a?this._hideStretchOptions(!0):this._hideStretchOptions(!1);"6"!==a||this.draCheckbox.checked||this._updateStretchStatsGrid();this._setColorRampVisibility();this._setStretchStatsGridVisibility();switch(a){case "0":this.stretchMethodNoneDescBlock.style.display="";break;case "3":this.numStdDevBlock.style.display="";break;case "5":this.stretchMethodMinMaxDescBlock.style.display="";break;case "6":this.minMaxPercentDescBlock.style.display=
"",this.minPercentBlock.style.display="",this.maxPercentBlock.style.display=""}}},_onClickApplyRenderingRule:function(){p.set(this.messageBlock,"display","none");if(this._isTileImagery)return this._onRendererApplyClient();this.rasterFunctionList.get("value")!==this._defaultBandCombinationFncName?this._onRasterFunctionApply():this._onBandIdsApply()},_onClickResetRenderingRule:function(){this.layer&&(this.layer.renderingRule=null,this.layer.bandIds=null,this._isTileImagery?this.layer.setDefaultRenderer():
this.layer.renderer=null,this._setupDefaults(),this._onClickApplyRenderingRule())},_onRasterFunctionApply:function(){if(!this._donotSaveChanges&&this.layer){this._setLayerBandIds([],!0);var a=this.rasterFunctionList.get("value");if(-1<a.indexOf(this._i18n.widgets.renderingRule.custom+": "))var b=new v(this._customFunctionList[this.layer.id][a]);else b=new v,b.functionName=a;a=this._getStretchFunction();10.3<=this.layer.version?this.symbologyType===this._symbologyTypes.stretch&&this._stretchReadFromRenderingRule?
a&&(a.functionArguments.Raster=b,this._colorRampVisible&&"none"!==this.colorRampSelect.value?(b=this._getColorMapFunction(),b.functionArguments.Raster=a,this.layer.setRenderingRule(b)):this.layer.setRenderingRule(a)):(this._onRendererApply(!0),this.layer.setRenderingRule(b)):(this.layer.setRenderer(null,!0),this.layer.setRenderingRule(b))}},_onBandIdsApply:function(){if(!this._donotSaveChanges&&this.layer){var a=new v({functionName:"none"});if(this._redBandIdStore&&this.bandIdsGreenList&&this.bandIdsBlueList)if(this.layer.setRenderingRule(a,
!0),this._onRendererApply(!0),1<this.layer.bandCount){a=[];var b=this._redBandIdStore.get(this.bandIdsRedList.value),c=this._greenBandIdStore.get(this.bandIdsGreenList.value),d=this._blueBandIdStore.get(this.bandIdsBlueList.value);b&&c&&d&&(a.push(b.index),a.push(c.index),a.push(d.index));this._setLayerBandIds(a)}else this.layer.refresh();else this.layer.setRenderingRule(a,!0),this._onRendererApply(!1)}},_onRendererApply:function(a){!this._donotSaveChanges&&this.layer&&(this.symbologyType===this._symbologyTypes.classify?
this._onClassifyApply(a):this.symbologyType===this._symbologyTypes.uniqueValues?this._onUniqueValuesApply(a):this.symbologyType===this._symbologyTypes.shadedRelief?this._onShadedReliefApply(a):this.symbologyType===this._symbologyTypes.colormap?this._onColormapApply(a):this._onStretchApply(a))},_onRendererApplyClient:function(){if(!this._donotSaveChanges&&this.layer){if(1<this.layer.bandCount){var a=[],b=this._redBandIdStore.get(this.bandIdsRedList.value),c=this._greenBandIdStore.get(this.bandIdsGreenList.value),
d=this._blueBandIdStore.get(this.bandIdsBlueList.value);b&&c&&d&&(a.push(b.index),a.push(c.index),a.push(d.index));this._bandIds=a}this.symbologyType===this._symbologyTypes.classify?this._onClassifyApply(!1):this.symbologyType===this._symbologyTypes.uniqueValues?this._onUniqueValuesApply(!1):this.symbologyType===this._symbologyTypes.shadedRelief?this._onShadedReliefApply(!1):this.symbologyType===this._symbologyTypes.colormap?this._onColormapApply(!1):this._onStretchApply(!1)}},_onStretchApply:function(a){if(!this._donotSaveChanges&&
this.layer)if(this._stretchReadFromRenderingRule){var b=this._getStretchFunction();this.layer.bandIds&&this._setLayerBandIds(this.layer.bandIds,!0);this._colorRampVisible&&"none"!==this.colorRampSelect.value?(a=this._getColorMapFunction(),a.functionArguments.Raster=b,this.layer.setRenderingRule(a)):this.layer.setRenderingRule(b,a)}else{if(!("0"!==this.stretchMethodList.value||this._colorRampVisible&&"none"!=this.colorRampSelect.value||this._isTileImagery))return this.layer.setRenderer(null,a);b=new ta;
var c=this.stretchMethodList.get("value");b.stretchType=b._convertStretchTypeIndexToEnum(parseInt(c,10));b.dra=this.draCheckbox.checked?!0:!1;var d=Math.exp(this.gammaSlider.value*Math.log(10));d=parseFloat(parseFloat(d).toFixed(2));var e=[];e.push(d);1<this.layer.bandCount&&(e.push(d),e.push(d));6==c&&(b.minPercent=this.minPercentText.value,b.maxPercent=this.maxPercentText.value);3==c&&(b.numberOfStandardDeviations=this.numStdDevText.value);b.statistics=this._getStretchStats();b.gamma=e;b.useGamma=
!0;b.outputPixelType="U8";this._colorRampVisible&&"none"!==this.colorRampSelect.value&&(b.colorRamp=this._convertColorRamps(this.colorRampSelect.colorRamp,this.colorRampSelect.colorRampName,this.invertColorRampCheckbox.checked));this._isTileImagery?(this._bandIds&&0<this._bandIds.length&&this._setLayerBandIds(this._bandIds,!0),"none"===b.stretchType&&(b.dra=!1,b.useGamma=!1,b.gamma=1<this.layer.bandCount?[1,1,1]:[1]),b=this._updateStretchRenderer(b),this.layer.setRenderer(b),this.layer.redraw()):
(this.layer.bandIds&&this._setLayerBandIds(this.layer.bandIds,!0),b=this._updateStretchRenderer(b),this.layer.setRenderer(b,a))}},_updateStretchRenderer:function(a){if(null===a)return null;this.layer.bandIds&&1===this.layer.bandIds.length&&(a.statistics&&(a.statistics=a.statistics.slice(0,1)),a.gamma&&(a.gamma=a.gamma.slice(0,1)));return a},_getStretchStats:function(){var a=this._getCurrentServiceInfo().bandCount,b=[],c=this._stretchStatsData;if(a&&!this.draCheckbox.checked&&"6"!==this.stretchMethodList.value&&
"0"!==this.stretchMethodList.value&&this._isStretchGridDataValid()){var d;for(d=0;d<Math.min(a,3);d++)b.push([c[d].esriRenderingRuleStretchMin,c[d].esriRenderingRuleStretchMax,c[d].esriRenderingRuleStretchMean,c[d].esriRenderingRuleStretchStdv]);return b}return[]},_onShadedReliefApply:function(a){var b=new wa,c=this._convertColorRamps(this.colorRampSelect.colorRamp,this.colorRampSelect.colorRampName,this.invertColorRampCheckbox.checked);c&&(b.colorRamp=c);b.hillshadeType=this._traditionalRadio.get("checked")?
"traditional":"multi-directional";b.azimuth=this.azimuthValueInput.get("value");b.altitude=this.altitudeValueInput.get("value");b.zFactor=this.zFactorInput.get("value");b.pixelSizePower=this.pixelSizePowerInput.get("value");b.pixelSizeFactor=this.pixelSizeFactorInput.get("value");b.scalingType=this._noneRadio.get("checked")?"none":"adjusted";this.layer.setRenderer(b,a)},_onColormapApply:function(a){var b=new xa,c=[];this._uniqueValuesSymbolData.forEach(function(d){if(d.isesriRenderingRuleColormapData){var e=
{};e.value=d.esriRenderingRuleUniqueValuesValue;e.color=[d.esriRenderingRuleUniqueValuesSymbol.r,d.esriRenderingRuleUniqueValuesSymbol.g,d.esriRenderingRuleUniqueValuesSymbol.b];e.label=d.esriRenderingRuleUniqueValuesLabel;c.push(e)}});c.length&&(b.colormapInfos=c,this.layer.setRenderer(b,a))},_onUniqueValuesApply:function(a){var b=new ua,c=this._convertColorRamps(this.colorRampSelect.colorRamp,this.colorRampSelect.colorRampName);c&&(b.authoringInfo={},b.authoringInfo.colorRamp=c.toJson());b.infos=
this._getUniqueValueInfos(this._uniqueValuesSymbolData);b.attributeField=this.uniqueValuesFieldSelect.value;this.layer.setRenderer(b,a)},_getUniqueValueInfos:function(a){var b=[],c;l.forEach(a,function(d){c=d.esriRenderingRuleUniqueValuesSymbol;if(isNaN(c.r)||isNaN(c.g)||isNaN(c.b))c={r:0,g:0,b:0,a:0};var e=new X("solid",null,new G(c));b.push({value:d.esriRenderingRuleUniqueValuesValue,label:d.esriRenderingRuleUniqueValuesLabel.toString(),symbol:e})});return b},_onClassifyApply:function(a){var b=
this._convertColorRamps(this.colorRampSelect.colorRamp,this.colorRampSelect.colorRampName);var c=new va({field:this.classifyFieldSelect.value,showInAscendingOrder:!0,classificationMethod:this.classifyMethodSelect.value});b&&(c.authoringInfo={},c.authoringInfo.colorRamp=b.toJson());c.infos=this._getClassBreakInfos();c.minimumBreak=c.infos.minValue;c.attributeField=this.classifyFieldSelect.value;this.layer.setRenderer(c,a)},_getClassBreakInfos:function(){var a=[],b,c;l.forEach(this._classifySymbolData,
function(d,e){b=d.esriRenderingRuleClassifySymbol;if(isNaN(b.r)||isNaN(b.g)||isNaN(b.b))b={r:0,g:0,b:0,a:0};c=new X("solid",null,new G(b));a.push({minValue:d.minValue,maxValue:d.maxValue,label:d.esriRenderingRuleClassifyLabel,symbol:c})});return a},_getStretchFunction:function(){var a=null;"0"!==this.stretchMethodList.get("value")&&(a=new v,a.functionName="Stretch",this._buildStretchFunction(a));return a},_buildStretchFunction:function(a){a.functionName="Stretch";var b=this.stretchMethodList.get("value"),
c={};c.StretchType=parseInt(b,10);c.DRA=this.draCheckbox.checked?!0:!1;var d=Math.exp(this.gammaSlider.value*Math.log(10));d=parseFloat(parseFloat(d).toFixed(2));var e=[];e.push(d);1<this.layer.bandCount&&(e.push(d),e.push(d));c.Gamma=e;c.UseGamma=!0;"3"===b?(c.NumberOfStandardDeviations=this.numStdDevText.value,a.outputPixelType="U8"):"6"===b?(c.MinPercent=parseFloat(this.minPercentText.value),c.MaxPercent=parseFloat(this.maxPercentText.value),a.outputPixelType="U8"):"5"===b&&(a.outputPixelType=
"U8");c.Statistics=this._getStretchStats();a.functionArguments=c},_onGammaChange:function(a){var b=this._gammaSliderTooltip;if(b&&this.symbologyTypeSelect.value===this._symbologyTypes.stretch){var c=Math.exp(a*Math.log(10));b.label=c?parseFloat(c).toFixed(2):a;b.open("gammaSliderID")}},_onGammaMouseLeave:function(){this.gammaTooltipClose()},_onAltitudeChange:function(a){var b=this._altitudeSliderTooltip;b&&this.symbologyTypeSelect.value===this._symbologyTypes.shadedRelief&&(b.label=parseFloat(a).toFixed(2),
b.open("altitudeSliderID"))},_onAzimuthChange:function(a){var b=this._azimuthSliderTooltip;b&&this.symbologyTypeSelect.value===this._symbologyTypes.shadedRelief&&(b.label=parseFloat(a).toFixed(2),b.open("azimuthSliderID"))},_disableBandIds:function(){this.bandIdsRedList.set("disabled",!0);this.bandIdsGreenList.set("disabled",!0);this.bandIdsBlueList.set("disabled",!0);this.bandIdsLabel.style.color="Gray"},_enableBandIds:function(){this.bandIdsRedList.set("disabled",!1);this.bandIdsGreenList.set("disabled",
!1);this.bandIdsBlueList.set("disabled",!1);""===this.bandIdsRedList.value&&this.bandIdsRedList.attr("value","1",!1);""===this.bandIdsGreenList.value&&this.bandIdsGreenList.attr("value","2",!1);""===this.bandIdsBlueList.value&&this.bandIdsBlueList.attr("value","3",!1);this._isStretchRenderer(this.layer.renderer)||this._getStretchFunction(this.layer.renderingRule)||this._updateStretchStatsGrid();this.bandIdsLabel.style.color="Black"},_showBandIds:function(){this.bandIdsLabelBlock.style.display="";
this.bandIdsBlock.style.display="";this.bandIdsMsgBlock.style.display=""},_hideBandIds:function(){this.bandIdsLabelBlock.style.display="none";this.bandIdsBlock.style.display="none";this.bandIdsMsgBlock.style.display="none"},_hideStretch:function(){this.imageEnhancementLabel.style.display="none";this.stretchDescLabel.style.display="none";this.stretchMethodLabel.style.display="none";this.stretchMethodList.domNode.style.display="none";this._hideStretchOptions(!0)},_hideStretchOptions:function(a){var b=
"";a&&(b="none");this.gammaBlock.style.display=b;this.draBlock.style.display=b;this.stretchMethodNoneDescBlock.style.display="none";this.stretchMethodMinMaxDescBlock.style.display="none";this.numStdDevBlock.style.display="none";this.minMaxPercentDescBlock.style.display="none";this.minPercentBlock.style.display="none";this.maxPercentBlock.style.display="none";this.stretchStatsBlock.style.display="none"},_getDefaultRedBandIndex:function(){var a;this._redBandIdStore&&(a=this._redBandIdStore.get("Red"));
a||(a=1);return a},_getClassifyGridData:function(a){this.classifyMethod=this.classifyMethodSelect.value===this._classifyMethods.manualInterval?this.classifyMethod:this.classifyMethodSelect.value;var b=Math.min(this.classifyNClassesInput.value,this.classifyNClassesInput.constraints&&this.classifyNClassesInput.constraints.max),c=this.colorRampSelect.colorRamp,d=this.classifyIntervalInput.value,e=this.classifyFieldSelect.value;this._classifySymbolData||(a=!1);if(this.layer&&this.classifyMethod&&b&&c){var f=
a?this._classifySymbolData:this._getClassBreaks(this.classifyMethod,b,e,d);if(f){var g=O.convertColorRampToColormap(c,f.length),k=a?this._classifySymbolData:[],n;b=f.length;l.forEach(f,function(m,q){n={r:g[q][1],g:g[q][2],b:g[q][3],a:1};a?k[q].esriRenderingRuleClassifySymbol=n:k.push({esriRenderingRuleClassifySymbol:n,minValue:m.minValue,maxValue:m.maxValue,serviceMaxValue:q===b-1?m.maxValue:f[q+1].maxValue,esriRenderingRuleClassifyLabel:this._createLabelString(m.minValue,m.maxValue)})},this);return k}}},
_getClassBreaks:function(a,b,c,d){var e=this._cachedHistogramsList&&this._cachedHistogramsList[this.layer.id]?this._cachedHistogramsList[this.layer.id][this.rasterFunctionList.value]:null,f=this._cachedRATList&&this._cachedRATList[this.layer.id]?this._cachedRATList[this.layer.id][this.rasterFunctionList.value]:null,g,k;if(this.layer&&(f||e)){if(f){e=f.features;var n=[];e.sort(this._getSortFeaturesFun(c));var m=g=e[0].attributes[c];l.forEach(e,function(q){q.attributes.Count&&n.push(q.attributes.Count);
k=q.attributes[c];k<m&&(m=k);k>g&&(g=k)});d&&16<(g-m)/d&&(d=(g-m)/16);return V.calculateClassBreaks(e,null,c,null,null,a,b,null,n,d)}if(e&&e.length&&e[0].dataPoints&&e[0].counts)return m=e[0].dataPoints[0],g=e[0].dataPoints[e[0].dataPoints.length-1],d&&16<(g-m)/d&&(d=(g-m)/16),V.calculateClassBreaks(null,e[0].dataPoints,null,null,null,a,b,null,e[0].counts,d)}},_getSortFeaturesFun:function(a){return function(b,c){b=b.attributes[a];c=c.attributes[a];return b-c}},_getUniqueValuesGridData:function(a){var b=
this._getCurrentServiceInfo();b=b&&b.hasRasterAttributeTable?b.hasRasterAttributeTable:this.layer.hasRasterAttributeTable;var c=this.layer.rasterAttributeTable,d=this.rasterFunctionList.value,e=this._cachedHistogramsList&&this._cachedHistogramsList[this.layer.id]?this._cachedHistogramsList[this.layer.id][this.rasterFunctionList.value]:null,f=e&&e.length&&e[0].dataPoints;d!==this._defaultBandCombinationFncName&&this._cachedRATList[this.layer.id]&&this._cachedRATList[this.layer.id][d]&&(c=this._cachedRATList[this.layer.id][d]);
var g=this.colorRampSelect.colorRamp;d=this.uniqueValuesFieldSelect.value;var k,n=g&&g.colorRamps?g.colorRamps.length:1,m=[],q=[],w,x,A,P,aa,T=0,D=0;a?q=k=this._uniqueValuesSymbolData:b?(k=c.features,k=this._sortFeatures(k,d)):f&&(k=e[0].dataPoints);if(g&&k&&d){for(D=0;D<n;D++)m[D]={},m[D].start=T,m[D].end=T+1/n,T=m[D].end;l.forEach(k,function(r,I){if(g&&g.colorRamps&&this._uniqueValuesColorRamp&&this._uniqueValuesColorRamp.colorRamps&&g.id===this._uniqueValuesColorRampName){if(r.features&&r.features[0]){var J=
this._getFeatureRGBValue(r.features[0].attributes);a?r.esriRenderingRuleUniqueValuesSymbol={r:J[0],g:J[1],b:J[2],a:1}:q.push({esriRenderingRuleUniqueValuesSymbol:{r:J[0],g:J[1],b:J[2],a:1},esriRenderingRuleUniqueValuesValue:r.value,esriRenderingRuleUniqueValuesLabel:L.isDefined(r.value)?r.value.toString():"",features:r.features})}}else P=(I+.5)/k.length,l.forEach(m,function(B,ba){P>=B.start&&P<B.end&&(aa=(P-B.start)/(B.end-B.start),1<m.length?(w=F.getDojoColor(g.colorRamps[ba].fromColor),x=F.getDojoColor(g.colorRamps[ba].toColor)):
(w=F.getDojoColor(g.fromColor),x=F.getDojoColor(g.toColor)),A=O.interpolateLabColor(w,x,aa),a?k[I].esriRenderingRuleUniqueValuesSymbol=F.correctRGBLimits(A):(B=f?Math.round(r):r.value,q.push({esriRenderingRuleUniqueValuesSymbol:F.correctRGBLimits(A),esriRenderingRuleUniqueValuesValue:B,esriRenderingRuleUniqueValuesLabel:L.isDefined(B)?B.toString():"",features:f?r:r.features})))},this)},this);return a?q:q.sort(function(r,I){return(r.features[0]&&(r.features[0].attributes.Value||r.features[0].attributes.value)||
0)-(I.features[0]&&(I.features[0].attributes.Value||I.features[0].attributes.value)||0)})}},_areFieldValuesUnique:function(a,b){var c=[];return l.some(b,function(d){if(-1<c.indexOf(d.attributes[a]))return!0;c.push(d.attributes[a])})?!1:!0},_sortFeatures:function(a,b){if(a&&b){a=h.clone(a);var c=[],d=[];this._areFieldValuesUnique(b,a)||a.sort(h.hitch(this,function(e,f){return"string"===typeof e.attributes[b]?(e=e.attributes[b],f=f.attributes[b],this._isRangeValue(e,f)&&(e=parseFloat(e.split("-")[0]),
f=parseFloat(f.split("-")[0])),e<f?-1:1):e.attributes[b]-f.attributes[b]}));l.forEach(a,function(e,f){var g=e.attributes[b];0<f&&-1<d.indexOf(g)?c[d.indexOf(g)].features.push(e):(d.push(g),c.push({value:g,features:[e]}))});return c}},_isRangeValue:function(a,b){return(a&&0<=a.indexOf("-")||b&&0<=b.indexOf("-"))&&!isNaN(parseFloat(a.split("-")[0]))},_getColorRGB:function(a){return{r:a[0],g:a[1],b:a[2]}},_isStretchGridDataValid:function(){var a=this._stretchStatsData,b;return a&&a.length?l.some(a,function(c){for(var d in c)if(b=
c[d],c.hasOwnProperty(d)&&"id"!==d&&void 0!==b&&null!==b&&!isNaN(b))return!0}):!1},_sanitizeStretchStatsData:function(a){if(a)return l.forEach(a,function(b){for(var c in b)void 0===b[c]&&(b[c]=null)}),a},_convertColorRamps:function(a,b,c){if(a){var d=null;if(a.type&&"multipart"==a.type.toLowerCase()){d=new sa;var e=[];l.forEach(a.colorRamps,function(f){var g=new W;g.algorithm="hsv";g.fromColor=new G(f.fromColor);g.toColor=new G(f.toColor);e.push(g)});d.colorRamps=e}else d=new W,d.algorithm="hsv",
d.fromColor=new G(a.fromColor),d.toColor=new G(a.toColor);c&&(d=O.invertColorRamp(d));d.name=b;return d}},gammaTooltipClose:function(){this._gammaSliderTooltip&&this._gammaSliderTooltip.close()},_onHillShadeTypeChange:function(){this._traditionalRadio.get("checked")?(z(".shadedReliefAzimuthBlock",this.domNode).removeClass("esriRenderingRuleHidden"),z(".shadedReliefAltitudeBlock",this.domNode).removeClass("esriRenderingRuleHidden")):(z(".shadedReliefAzimuthBlock",this.domNode).addClass("esriRenderingRuleHidden"),
z(".shadedReliefAltitudeBlock",this.domNode).addClass("esriRenderingRuleHidden"))},_onScalingChange:function(){this._noneRadio.get("checked")?(z(".shadedReliefPixelSizePowerBlock",this.domNode).addClass("esriRenderingRuleHidden"),z(".shadedReliefPixelSizeFactorBlock",this.domNode).addClass("esriRenderingRuleHidden")):(z(".shadedReliefPixelSizePowerBlock",this.domNode).removeClass("esriRenderingRuleHidden"),z(".shadedReliefPixelSizeFactorBlock",this.domNode).removeClass("esriRenderingRuleHidden"))},
_onAzimuthKeyDown:function(a){L.isObject(a)&&13===a.keyCode&&(a=this.azimuthValueInput.get("value"),this._onAzimuthValueChange(a))},_onAltitudeKeyDown:function(a){L.isObject(a)&&13===a.keyCode&&(a=this.altitudeValueInput.get("value"),this._onAltitudeValueChange(a))},_onAzimuthValueChange:function(a){this.shadedReliefAzimuthSlider.set("value",a)},_onAltitudeValueChange:function(a){L.isObject(a)&&13===a.keyCode&&(a=this.altitudeValueInput.get("value"));this.shadedReliefAltitudeSlider.set("value",a)},
_onAltitudeSliderChange:function(a){this.altitudeValueInput.set("value",parseFloat(a.toFixed(2)))},_onAzimuthSliderChange:function(a){this.azimuthValueInput.set("value",parseFloat(a.toFixed(2)))},_getColormapGridData:function(){var a=[];if(this._isColormapRenderer(this.layer.renderer))this.layer.renderer.colormapInfos.forEach(function(f){var g=f.color;a.push({esriRenderingRuleUniqueValuesSymbol:{r:g[0],g:g[1],b:g[2],a:1},esriRenderingRuleUniqueValuesValue:f.value,esriRenderingRuleUniqueValuesLabel:f.label,
isesriRenderingRuleColormapData:!0})});else{var b=this.rasterFunctionList.value,c=this._cachedColormapList[this.layer.id]&&this._cachedColormapList[this.layer.id][b];b=this._cachedRATList[this.layer.id]&&this._cachedRATList[this.layer.id][b];var d=this._ratContainsColormap(b);if(d)var e=this._getRATValueClassNameMap(b);c&&c.colormap&&c.colormap.forEach(function(f){a.push({esriRenderingRuleUniqueValuesSymbol:{r:f[1],g:f[2],b:f[3],a:1},esriRenderingRuleUniqueValuesValue:f[0],esriRenderingRuleUniqueValuesLabel:d?
e[f[0]]||"":f[0],isesriRenderingRuleColormapData:!0})})}return a},_addCustomRasterFunction:function(){this.customRFTMessage.innerText="";this.useArcGISComponents=!0;var a=[ra.RFT];this.defaultItemTypes=[];this.set("allowedItemTypes",a);this.set("availableItemTypeFilters",["rasterFunctionTemplates","tools"]);this._createBrowseItems({disableLAAL:!0,disableBoundary:!0,title:this._i18n.common.browseRFTs,showRFTSystemSection:!1,showRFTEditCustomAction:!1,enableMapAreaFilter:!1})},_handleSelectRFTTool:function(a){this._fetchRFT(a)},
_fetchRFT:function(a){p.set(this.messageBlock,"display","table-cell");t.add(document.getElementById("renderingRuleContentButtons"),"disabled");this.customRFTMessage.innerText=this._i18n.applyRFxTemplateTool.loadingMessage;var b=h.hitch(this,function(e){return e}),c=h.hitch(this,this._handleErrorWithCustomRFT),d=h.hitch(this,this._processRFT);qa.fetchRFT(a,b,c,d,this.rasterUtilitiesServer)},_processRFT:function(a){var b=h.hitch(this,this._handleErrorWithCustomRFT,"customTemplateValidateFailure");this.layer.getRenderingRuleServiceInfo(new v(a),
b).then(h.hitch(this,function(c){t.remove(document.getElementById("renderingRuleContentButtons"),"disabled");c?(this._addCustomRFTOption(a,c),p.set(this.messageBlock,"display","none")):this._handleErrorWithCustomRFT("customTemplateValidateFailure")}))},_handleErrorWithCustomRFT:function(a){var b={errorRetrievingRFTItem:this._i18n.applyRFxTemplateTool.errorRetrievingRFTItem,errorUtilitiesServiceNotAvailable:this._i18n.applyRFxTemplateTool.errorUtilitiesServiceNotAvailable,errorFetchingRFT:this._i18n.applyRFxTemplateTool.errorFetchingRFT,
customTemplateValidateFailure:this._i18n.widgets.renderingRule.customTemplateValidateFailure};this.customRFTMessage.innerText=a?b[a]||a.message:b.errorFetchingRFT;t.remove(document.getElementById("renderingRuleContentButtons"),"disabled")},_addCustomRFTOption:function(a,b){var c={name:this._i18n.widgets.renderingRule.custom+": "+a.name,function:a};this._removeCustomItemFromList(c.name,!0);this._customFunctionList[this.layer.id]={};this._customFunctionList[this.layer.id][c.name]=c.function;var d={};
a.thumbnailEx?d.path=a.thumbnailEx:(d=this._getExportImageCall(),d.params.renderingRule=ca.toJson(a));this._addFunctionItemToList(c.name,c.name,a.description,d,b,this._setCustomRFTOption.bind(this,c))},_setCustomRFTOption:function(a){this._rasterFunctionStore.setData(this._rasterFunctionData);this.rasterFunctionList.set("value",a.name)},_removeCustomItemFromList:function(a,b){this._rasterFunctionStore.query(h.hitch(this,function(c){return-1<c.name.indexOf(this._i18n.widgets.renderingRule.custom+": ")&&
(b?c.name===a:c.name!==a)})).forEach(h.hitch(this,function(c){this._rasterFunctionStore.remove(c.name)}))},_isRFTJson:function(a){return a.name&&a.arguments&&a.function&&a.hasOwnProperty("functionType")}});fa("extend-esri")&&h.setObject("dijit.RenderingRule",M,ja);return M});