// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/analysis/templates/OverlayLayers.html":'\x3cdiv class\x3d"esriAnalysis"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" style\x3d"margin-top:0.5em; margin-bottom: 0.5em;"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_overlaylayersToolContentTitle" class\x3d"analysisTitle"\x3e\r\n         \x3ctable class\x3d"esriFormTable" \x3e \r\n            \x3ctr\x3e\r\n              \x3ctd class\x3d"esriToolIconTd"\x3e\x3cdiv class\x3d"overlayLayersIcon"\x3e\x3c/div\x3e\x3c/td\x3e\r\n              \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" data-dojo-attach-point\x3d"_toolTitle"\x3e\r\n                \x3clabel data-dojo-attach-point\x3d"_titleLbl"\x3e${i18n.overlayLayers}\x3c/label\x3e\r\n                \x3cnav class\x3d"breadcrumbs"  data-dojo-attach-point\x3d"_analysisModeLblNode" style\x3d"display:none;"\x3e\r\n                  \x3ca href\x3d"#" class\x3d"crumb breadcrumbs__modelabel" data-dojo-attach-event\x3d"onclick:_handleModeCrumbClick" data-dojo-attach-point\x3d"_analysisModeCrumb"\x3e\x3c/a\x3e\r\n                  \x3ca href\x3d"#" class\x3d"crumb is-active" data-dojo-attach-point\x3d"_analysisTitleCrumb" style\x3d"font-size:16px;"\x3e${i18n.overlayLayers}\x3c/a\x3e\r\n                \x3c/nav\x3e                 \r\n              \x3c/td\x3e\r\n              \x3ctd\x3e\r\n              \x3cdiv class\x3d"esriFloatTrailing" style\x3d"padding:0;"\x3e\r\n                  \x3cdiv class\x3d"esriFloatLeading"\x3e\r\n                    \x3ca href\x3d"#" class\x3d\'esriFloatLeading helpIcon\' esriHelpTopic\x3d"toolDescription"\x3e\x3c/a\x3e\r\n                  \x3c/div\x3e\r\n                  \x3cdiv class\x3d"esriFloatTrailing"\x3e\r\n                    \x3ca href\x3d"#" data-dojo-attach-point\x3d"_closeBtn" title\x3d"${i18n.close}" class\x3d"esriAnalysisCloseIcon"\x3e\x3c/a\x3e\r\n                  \x3c/div\x3e              \r\n              \x3c/div\x3e  \r\n              \x3c/td\x3e\r\n            \x3c/tr\x3e\r\n         \x3c/table\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv style\x3d"clear:both; border-bottom: #CCC thin solid; height:1px;width:100%;"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"_form" readOnly\x3d"true"\x3e\r\n     \x3ctable class\x3d"esriFormTable"  data-dojo-attach-point\x3d"_overlaylayersTable"\x3e \r\n       \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"_titleRow"\x3e\r\n          \x3ctd  colspan\x3d"3" class\x3d"sectionHeader one-width" data-dojo-attach-point\x3d"_overlaylayersToolDescription"\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"_analysisLabelRow" style\x3d"display:none;"\x3e\r\n          \x3ctd colspan\x3d"2" style\x3d"padding-bottom:0;" class\x3d"twobythree-width"\x3e\r\n            \x3clabel class\x3d"esriFloatLeading  esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.oneLabel}\x3c/label\x3e\r\n            \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.analysisLayerLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"shortTextInput strict-onebythree-width" style\x3d"padding-bottom:0;"\x3e\r\n            \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"inputLayer"\x3e\x3c/a\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"_selectAnalysisRow" style\x3d"display:none;"\x3e\r\n          \x3ctd  colspan\x3d"3" style\x3d"padding-top:0"\x3e\r\n            \x3cselect class\x3d"esriLeadingMargin1 longInput esriLongLabel"  style\x3d"margin-top:1.0em;" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_analysisSelect" data-dojo-props\x3d"required:true" data-dojo-attach-event\x3d"onChange:_handleAnalysisLayerChange"\x3e\x3c/select\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e          \r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3clabel data-dojo-attach-point\x3d"_labelOne" class\x3d"esriFloatLeading esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.oneLabel}\x3c/label\x3e\r\n            \x3clabel data-dojo-attach-point\x3d"_polylabel" class\x3d"esriAnalysisStepsLabel"\x3e${i18n.chooseOverlayLayer}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"shortTextInput" width\x3d"1%"\x3e\r\n            \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' data-dojo-attach-point\x3d"_analysisFieldHelpLink" esriHelpTopic\x3d"OverlayLayer"\x3e\x3c/a\x3e \r\n          \x3c/td\x3e \r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3cselect class\x3d"esriLeadingMargin1  longInput esriAnalysisSelect esriLongLabel" data-dojo-type\x3d"dijit/form/Select" data-dojo-props\x3d"required:true" data-dojo-attach-point\x3d"_overlayFeaturesSelect" data-dojo-attach-event\x3d"onChange:_handleLayerChange"\x3e\x3c/select\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd width\x3d"99%" colspan\x3d"2" style\x3d"white-space:nowrap;"\x3e\r\n            \x3clabel class\x3d"esriFloatLeading esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.twoLabel}\x3c/label\x3e\r\n            \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.chooseOverlayMethod}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd\x3e\r\n            \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"OverlayType"\x3e\x3c/a\x3e \r\n          \x3c/td\x3e          \r\n        \x3c/tr\x3e  \r\n        \x3ctr data-dojo-attach-point\x3d"_operatorsGrid"\x3e\r\n          \x3ctd class\x3d"overlayTypeCell" align\x3d\'center\' data-dojo-attach-point\x3d"_intersectBtnCell"\x3e\r\n            \x3cdiv class\x3d"esriContainerSelector" data-dojo-props\x3d"groupName:\'overlayType\',checked:true" data-dojo-type\x3d"esri/dijit/analysis/AnalysisToggleButton" data-dojo-attach-point\x3d"_intersectBtnCtr" style\x3d"width:100%" data-dojo-attach-event\x3d"onClick:_handleIntersectBtnCtrClick" \x3e\r\n              \x3cdiv data-dojo-type\x3d"esri/dijit/analysis/GroupToggleButton" class\x3d"" data-dojo-attach-event\x3d"onClick:_handleIntersectBtnClick" data-dojo-attach-point\x3d"_intersectBtn" data-dojo-props\x3d"groupName:\'overlayType\',showLabel:false,iconClass:\'intersectLayersIcon\',checked:true, style:\'width:36px;height:36px;\',label:\'intersect\'"\x3e\x3c/div\x3e\r\n              \x3cdiv\x3e\x3clabel\x3e${i18n.intersect}\x3c/label\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"overlayTypeCell" align\x3d\'center\' data-dojo-attach-point\x3d"_unionBtnCell"\x3e  \r\n            \x3cdiv class\x3d"esriContainerSelector" data-dojo-props\x3d"groupName:\'overlayType\'"  data-dojo-type\x3d"esri/dijit/analysis/AnalysisToggleButton" data-dojo-attach-point\x3d"_unionBtnCtr" style\x3d"width:100%" data-dojo-attach-event\x3d"onClick:_handleUnionBtnCtrClick"\x3e          \r\n            \x3cdiv data-dojo-type\x3d"esri/dijit/analysis/GroupToggleButton" class\x3d"" data-dojo-attach-event\x3d"onClick:_handleUnionBtnClick" data-dojo-attach-point\x3d"_unionBtn" data-dojo-props\x3d"groupName:\'overlayType\',showLabel:false,iconClass:\'unionLayersIcon\' ,   style:\'width:36px;height:36px;\',label:\'union\'"\x3e\x3c/div\x3e\r\n              \x3cdiv\x3e\x3clabel\x3e${i18n.union}\x3c/label\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"overlayTypeCell" align\x3d\'center\' data-dojo-attach-point\x3d"_eraseBtnCell"\x3e\r\n            \x3cdiv class\x3d"esriContainerSelector" data-dojo-props\x3d"groupName:\'overlayType\'"  data-dojo-type\x3d"esri/dijit/analysis/AnalysisToggleButton" style\x3d"width:100%" data-dojo-attach-point\x3d"_eraseBtnCtr" data-dojo-attach-event\x3d"onClick:_handleEraseBtnCtrClick"\x3e\r\n              \x3cdiv  data-dojo-type\x3d"esri/dijit/analysis/GroupToggleButton" class\x3d"" data-dojo-attach-event\x3d"onClick:_handleEraseBtnClick" data-dojo-attach-point\x3d"_eraseBtn" data-dojo-props\x3d"groupName:\'overlayType\',showLabel:false,iconClass:\'eraseLayersIcon\',   style:\'width:36px;height:36px;\',label:\'erase\'"\x3e\x3c/div\x3e\r\n              \x3cdiv\x3e\x3clabel\x3e${i18n.erase}\x3c/label\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"_operatorsDropdown" class\x3d"hide"\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3cselect class\x3d"esriLeadingMargin1 longInput esriAnalysisSelect esriLongLabel" data-dojo-type\x3d"dijit/form/Select" data-dojo-props\x3d"required:true" data-dojo-attach-point\x3d"_operatorsSelect" data-dojo-attach-event\x3d"onChange:_handleOperatorChange"\x3e\r\n            \x3c/select\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3ctable data-dojo-attach-point\x3d"_outputTypeTable"\x3e\r\n              \x3ctbody\x3e\r\n                \x3ctd\x3e\r\n                  \x3clabel class\x3d"esriLeadingMargin2" data-dojo-attach-point\x3d"_outputTypeLabel"\x3e${i18n.outputLabel}\x3c/label\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd colspan\x3d"2"\x3e\r\n                  \x3cselect class\x3d"esriLeadingMargin1 mediumInput esriAnalysisSelect"  style\x3d"table-layout:fixed;width:150px;" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_outputTypeSelect"\x3e\r\n                    \x3coption value\x3d"Point"\x3e ${i18n.points}\x3c/option\x3e\r\n                    \x3coption value\x3d"Line"\x3e${i18n.lines}\x3c/option\x3e\r\n                    \x3coption value\x3d"Input"\x3e${i18n.areas}\x3c/option\x3e\r\n                  \x3c/select\x3e\r\n                \x3c/td\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tbody\x3e\r\n            \x3c/table\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"2"\x3e\r\n            \x3clabel class\x3d"esriFloatLeading esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.threeLabel}\x3c/label\x3e\r\n            \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.outputLayerLabel}\x3c/label\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"shortTextInput"\x3e\r\n            \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"OutputLayer" data-dojo-attach-point\x3d"_outputLayerHelpNode"\x3e\x3c/a\x3e \r\n          \x3c/td\x3e             \r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n            \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"trim:true,required:true" class\x3d"esriOutputText esriLeadingMargin1" data-dojo-attach-point\x3d"_outputLayerInput"\x3e\x3c/input\x3e\r\n          \x3c/td\x3e                \r\n        \x3c/tr\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd colspan\x3d"3"\x3e\r\n             \x3cdiv class\x3d"esriLeadingMargin1" data-dojo-attach-point\x3d"_chooseFolderRow"\x3e\r\n               \x3clabel style\x3d"width:9px;font-size:smaller;"\x3e${i18n.saveResultIn}\x3c/label\x3e\r\n               \x3cinput class\x3d"longInput" data-dojo-attach-point\x3d"_webMapFolderSelect" data-dojo-type\x3d"dijit/form/FilteringSelect" trim\x3d"true" style\x3d"width:60%;"\x3e\x3c/input\x3e\r\n             \x3c/div\x3e              \r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e         \r\n      \x3c/tbody\x3e         \r\n     \x3c/table\x3e\r\n   \x3c/div\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"_overlaylayersToolContentButtons" style\x3d"padding:5px;margin-top:5px;border-top:solid 1px #BBB;"\x3e\r\n      \x3cdiv class\x3d"esriExtentCreditsCtr"\x3e\r\n        \x3ca class\x3d"esriFloatTrailing esriSmallFont"  href\x3d"#" data-dojo-attach-point\x3d"_showCreditsLink"\x3e${i18n.showCredits}\x3c/a\x3e\r\n       \x3clabel data-dojo-attach-point\x3d"_chooseExtentDiv" class\x3d"esriSelectLabel esriExtentLabel"\x3e\r\n         \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_useExtentCheck" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"checked:true" name\x3d"extent" value\x3d"true"/\x3e\r\n           ${i18n.useMapExtent}\r\n       \x3c/label\x3e\r\n      \x3c/div\x3e     \r\n    \x3cbutton data-dojo-type\x3d"dijit/form/Button" type\x3d"submit" data-dojo-attach-point\x3d"_saveBtn" class\x3d"esriLeadingMargin4 esriAnalysisSubmitButton" data-dojo-attach-event\x3d"onClick:_handleSaveBtnClick"\x3e\r\n        ${i18n.runAnalysis}\r\n    \x3c/button\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" title\x3d"${i18n.creditTitle}" data-dojo-attach-point\x3d"_usageDialog" style\x3d"width:40em;"\x3e\r\n    \x3cdiv data-dojo-type\x3d"esri/dijit/analysis/CreditEstimator"  data-dojo-attach-point\x3d"_usageForm"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e    \r\n  \x3cdiv class\x3d"esriFormWarning esriRoundedBox" data-dojo-attach-point\x3d"_errorMessagePane" style\x3d"display:none;"\x3e\r\n    \x3ca href\x3d"#" title\x3d"${i18n.close}" class\x3d"esriFloatTrailing esriAnalysisCloseIcon" title\x3d\'${i18n.close}\' data-dojo-attach-event\x3d"onclick:_handleCloseMsg"\x3e\r\n    \x3c/a\x3e\r\n    \x3cspan data-dojo-attach-point\x3d"_bodyNode"\x3e\x3c/span\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n'}});
define("esri/dijit/analysis/OverlayLayers","require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/fx dojo/has dojo/json dojo/string dojo/dom-style dojo/dom-attr dojo/dom-construct dojo/query dojo/dom-class dojo/fx/easing dojox/lang/functional/object dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin dijit/_FocusMixin dijit/registry dijit/form/Button dijit/form/CheckBox dijit/form/Form dijit/form/Select dijit/form/TextBox dijit/form/ValidationTextBox dijit/layout/ContentPane dijit/form/FilteringSelect ../../kernel ./AnalysisBase ./_AnalysisOptions ./CreditEstimator ./AnalysisToggleButton ./GroupToggleButton ./utils ./AnalysisRegistry dojo/i18n!../../nls/jsapi dojo/text!./templates/OverlayLayers.html".split(" "),
function(q,x,h,m,u,n,v,y,N,r,k,p,O,P,l,w,z,A,B,C,D,E,Q,R,S,T,U,V,W,X,Y,F,G,H,Z,aa,ba,c,g,I,J){q=x([A,B,C,D,E,H,G],{declaredClass:"esri.dijit.analysis.OverlayLayers",templateString:J,widgetsInTemplate:!0,inputLayer:null,overlayLayer:null,overlayType:"intersect",tolerance:0,snapToInput:!1,outputLayerName:null,outputType:"Input",i18n:null,toolName:"OverlayLayers",helpFileName:"OverlayLayers",resultParameter:"Outputlayer",removeJobParamKeys:["overlayExpressionObject"],operators:{Intersect:"Intersect",
Erase:"Erase",Union:"Union",Identity:"Identity",Symmetrical:"SymmetricalDifference"},constructor:function(a,b){this._pbConnects=[];a.containerNode&&(this.container=a.containerNode)},destroy:function(){this.inherited(arguments);m.forEach(this._pbConnects,u.disconnect);delete this._pbConnects},postMixInProperties:function(){this.inherited(arguments);h.mixin(this.i18n,I.overlayLayersTool)},postCreate:function(){this.inherited(arguments);l.add(this._form.domNode,"esriSimpleForm");this._outputLayerInput.set("validator",
h.hitch(this,this.validateServiceName));this.filterObjects=[{layer:"inputLayer",select:this._analysisSelect,expressionObj:"attributeExprObj"},{layer:"overlayLayer",select:this._overlayFeaturesSelect,expressionObj:"overlayExpressionObject"}];this._buildUI()},startup:function(){},_onClose:function(a){a&&(this._save(),this.emit("save",{save:!0}));this.emit("close",{save:a})},_buildJobParams:function(){var a={};a.inputLayer=n.toJson(this.constructAnalysisInputLyrObj(this.inputLayer,this.showGeoAnalyticsParams));
if("0"!==this._overlayFeaturesSelect.get("value")){var b=this.overlayLayers[this._overlayFeaturesSelect.get("value")-1];a.overlayLayer=n.toJson(this.constructAnalysisInputLyrObj(b,this.showGeoAnalyticsParams))}a.overlayType=this.get("overlayType");this.returnFeatureCollection||(a.OutputName=n.toJson({serviceProperties:{name:this._outputLayerInput.get("value")}}));this.showGeoAnalyticsParams||("intersect"===this.overlayType&&(a.outputType=this._outputTypeSelect.get("value")),a.tolerance=this.tolerance,
a.snapToInput=this.snapToInput);this.showChooseExtent&&this._useExtentCheck.get("checked")&&(a.context=n.toJson({extent:this.map.extent._normalize(!0)}));this.returnFeatureCollection&&(b={outSR:this.map.spatialReference},this.showChooseExtent&&this._useExtentCheck.get("checked")&&(b.extent=this.map.extent._normalize(!0)),a.context=n.toJson(b));return this._updateJobFilterAndSelection(a)},_handleSaveBtnClick:function(a){this._form.validate()&&(a={},this._saveBtn.set("disabled",!0),a.jobParams=this._buildJobParams(),
a.itemParams={description:this.i18n.itemDescription,tags:r.substitute(this.i18n.itemTags,{layername:this.inputLayer.name}),snippet:this.i18n.itemSnippet},this.showSelectFolder&&(a.itemParams.folder=this.get("folderId")),this.showGeoAnalyticsParams&&(this.resultParameter="output",a.isSpatioTemporalDataStore=!0),this.execute(a))},_handleShowCreditsClick:function(a){a.preventDefault();this._form.validate()&&this.getCreditsEstimate(this.toolName,this._buildJobParams()).then(h.hitch(this,function(b){this._usageForm.set("content",
b);this._usageDialog.show()}))},_save:function(){},_sortbyGeometryType:function(a,b){if(this.isPolygon(a.geometryType))return-1;if(this.isPolygon(b.geometryType))return 1;if(this.isLine(a.geometryType))return-1;if(this.isLine(b.geometryType))return 1;if(this.isPoint(a.geometryType))return-1;if(this.isPoint(b.geometryType))return 1},filterOverlayLayers:function(a,b){var d=[];m.forEach(a,function(e){e.geometryType===b&&d.push(e)});return d},_buildUI:function(){var a=!0;this.signInPromise.then(h.hitch(this,
c.initHelpLinks,this.domNode,this.showHelp,{analysisGpServer:this.analysisGpServer}));this.showGeoAnalyticsParams&&(p.set(this._analysisFieldHelpLink,"esriHelpTopic","overlayLayer"),p.set(this._outputLayerHelpNode,"esriHelpTopic","outputLayer"));this.get("showSelectAnalysisLayer")&&(this.inputLayers&&this.inputLayer&&!c.isLayerInLayers(this.inputLayer,this.inputLayers)&&this.inputLayers.push(this.inputLayer),this.get("inputLayer")||!this.get("inputLayers")||this.rerun||this.set("inputLayer",this.inputLayers[0]),
c.populateAnalysisLayers(this,"inputLayer","inputLayers"));this.overlayLayers&&this.overlayLayer&&!c.isLayerInLayers(this.overlayLayer,this.overlayLayers)&&this.overlayLayers.push(this.overlayLayer);this.outputLayerName&&(this._outputLayerInput.set("value",this.outputLayerName),a=!1);if(this.overlayLayer||this.rerun)a=!1;this.inputLayer&&this._updateAnalysisLayerUI(a);c.addReadyToUseLayerOption(this,[this._analysisSelect,this._overlayFeaturesSelect]);k.set(this._chooseFolderRow,"display",!0===this.showSelectFolder?
"block":"none");this.showSelectFolder&&this.getFolderStore().then(h.hitch(this,function(b){this.folderStore=b;c.setupFoldersUI({folderStore:this.folderStore,folderId:this.folderId,folderName:this.folderName,folderSelect:this._webMapFolderSelect,username:this.portalUser?this.portalUser.username:""})}));this.updateUIForGeoAnalytics();this.showGeoAnalyticsParams&&(this.inputLayer&&this.overlayLayer?(this._filterOutOperators(this.overlayLayer),this._operatorsSelect.set("value",this.overlayType)):this._updateOperatorOptions());
k.set(this._chooseExtentDiv,"display",!0===this.showChooseExtent?"inline-block":"none");k.set(this._showCreditsLink,"display",!0===this.showCredits?"block":"none");this.showGeoAnalyticsParams||c.updateDisplay([this._eraseBtnCell],this.isServerAdvanceLicensed,"table-cell");this._operatorsSelect.set("required",this.showGeoAnalyticsParams);this._createFilterAndSelections();this._loadConnections()},_updateAnalysisLayerUI:function(a){this.inputLayer&&p.set(this._overlaylayersToolDescription,"innerHTML",
r.substitute(this.i18n.overlayDefine,{layername:this.inputLayer.name}));if(this.overlayLayers){this.overlayLayers.sort(h.hitch(this,this._sortbyGeometryType));var b=m.some(this._overlayFeaturesSelect.getOptions(),function(f){return"browse"===f.value},this),d=m.some(this._overlayFeaturesSelect.getOptions(),function(f){return"browselayers"===f.value},this),e=[],K=this._overlayFeaturesSelect.get("value");this._overlayFeaturesSelect.removeOption(this._overlayFeaturesSelect.getOptions());this.rerun&&!this.overlayLayers&&
c.addBlankOption(this._overlayFeaturesSelect,e);var L=this.overlayLayers.concat([]);m.forEach(L,function(f,M){var t=!0;f.url&&this.inputLayer.url&&f.url!==this.inputLayer.url?t=!1:this.inputLayer===f||f.analysisReady&&this.inputLayer.analysisReady||(t=!1);!t&&(this.isPolygon(f.geometryType)||this.isPoint(f.geometryType)||this.isLine(f.geometryType))&&e.push({value:M+1,label:f.name,selected:this.overlayLayer&&!a&&(this.overlayLayer.url&&f.url&&f.url===this.overlayLayer.url||this.overlayLayer.name===
f.name)})},this);(this.get("showReadyToUseLayers")||this.get("showBrowseLayers")||b||d)&&e.push({type:"separator",value:""});this._overlayFeaturesSelect.addOption(e);c.addBrowseOptionForTool({select:this._overlayFeaturesSelect,disableLAAL:!1},this);a&&this._overlayFeaturesSelect.set("value",K);this._handleLayerChange(this._overlayFeaturesSelect.get("value"))}this.overlayType&&("intersect"===this.overlayType?(this._intersectBtn.set("checked",!0),this._handleIntersectBtnClick()):"union"===this.overlayType?
(this._unionBtn.set("checked",!0),this._handleUnionBtnClick()):"erase"===this.overlayType&&(this._eraseBtn.set("checked",!0),this._handleEraseBtnClick()));this.outputType&&this._outputTypeSelect.set("value",this.outputType);!a&&this.outputLayerName&&this._outputLayerInput.set("value",this.outputLayerName);this.updateUIForGeoAnalytics()},_handleAnalysisLayerChange:function(a){this._checkBrowseLayer(a,!0)||(this.inputLayer=this.inputLayers[a],this._updateAnalysisLayerUI(!0))},updateUIForGeoAnalytics:function(){this.showGeoAnalyticsParams&&
(k.set(this._operatorsGrid,"display","none"),k.set(this._outputTypeTable,"display","none"),l.add(this._intersectBtnCell,"gaxOverlayTypeCell"),l.add(this._eraseBtnCell,"gaxOverlayTypeCell"),l.remove(this._operatorsDropdown,"hide"))},_handleBrowseItemsSelect:function(a,b){a&&a.selection&&c.addAnalysisReadyLayer({item:a.selection,layers:this._isAnalysisSelect?this.inputLayers:this.overlayLayers,layersSelect:this._isAnalysisSelect?this._analysisSelect:this._overlayFeaturesSelect,browseDialog:a.dialog||
this._browsedlg,posIncrement:this._isAnalysisSelect?0:1,widget:this},b).always(h.hitch(this,function(d){this._isAnalysisSelect&&(this.inputLayer=this.inputLayers[this._analysisSelect.get("value")])&&(m.some(this.overlayLayers,function(e){return e&&e.analysisReady&&this.inputLayer.analysisReady&&e.itemId===this.inputLayer.itemId},this)||this.overlayLayers.push(this.inputLayer));this._isAnalysisSelect&&this._handleAnalysisLayerChange(this._analysisSelect.get("value"))}))},_checkBrowseLayer:function(a,
b){this._isAnalysisSelect=b;return"browse"===a||"browselayers"===a?(this._filterLayersForGeometryType(b,a),!0):!1},_filterLayersForGeometryType:function(a,b){a?this._createBrowseItems({browseValue:b,disabledSubResources:[this.inputLayer]},{tags:["point","polygon","line"],geometryTypes:[g.GeometryTypes.Point,g.GeometryTypes.Polygon,g.GeometryTypes.Line]},this._analysisSelect):this._createBrowseItems({browseValue:b,disabledSubResources:[this.inputLayer,this.overlayLayers]},{tags:["point","polygon",
"line"],geometryTypes:[g.GeometryTypes.Point,g.GeometryTypes.Polygon,g.GeometryTypes.Line]},this._overlayFeaturesSelect)},_getInputLivingAtlasType:function(){if(this.inputLayer){if(this.isPoint(this._getGeometryType()))return["point"];if(this.isPolygon(this._getGeometryType()))return["polygon"];if(this.isLine(this._getGeometryType()))return["line"]}return["point","polygon","line"]},_getGeometryType:function(){return this.inputLayer?[this.inputLayer.geometryType]:[g.GeometryTypes.Point,g.GeometryTypes.Polygon,
g.GeometryTypes.Line]},isPolygon:function(a){return g.GeometryTypes.Polygon===a},isPoint:function(a){return g.GeometryTypes.Point===a},isLine:function(a){return g.GeometryTypes.Line===a},_loadConnections:function(){this.on("start",h.hitch(this,"_onClose",!0));this._connect(this._closeBtn,"onclick",h.hitch(this,"_onClose",!1))},_handleLayerChange:function(a){if(!this._checkBrowseLayer(a,!1)){this.overlayLayer=a=this.overlayLayers[a-1];var b=!1;var d=this.get("overlayType");if(a&&this.inputLayer){var e=
!this.isPolygon(this.inputLayer.geometryType)||!this.isPolygon(a.geometryType);this._unionBtn.set("disabled",e);this._unionBtn.set("iconClass",e?"unionLayersDisabledIcon":"unionLayersIcon");this.isPolygon(this.inputLayer.geometryType)?b=this.isPolygon(this.inputLayer.geometryType)&&!this.isPolygon(a.geometryType):this.isLine(this.inputLayer.geometryType)?b=this.isLine(this.inputLayer.geometryType)&&this.isPoint(a.geometryType):this.isLine(this.inputLayer.geometryType)&&(b=!0);this._eraseBtn.set("disabled",
b);this._eraseBtn.set("iconClass",b?"eraseLayersDisabledIcon":"eraseLayersIcon");"union"!==d||this.isPolygon(this.inputLayer.geometryType)&&this.isPolygon(a.geometryType)?"erase"===d&&this.isLine(this.inputLayer.geometryType)&&this.isPoint(a.geometryType)?(this._showMessages(this.i18n.notSupportedEraseOverlayMsg),this._intersectBtn.set("checked",!0),this._handleIntersectBtnCtrClick()):"erase"===d&&this.isPolygon(this.inputLayer.geometryType)&&!this.isPolygon(a.geometryType)?(this._showMessages(this.i18n.notSupportedEraseOverlayMsg),
this._intersectBtn.set("checked",!0),this._handleIntersectBtnCtrClick()):"intersect"===d?this._handleIntersectBtnCtrClick():"union"===d?this._handleUnionBtnCtrClick():"erase"===d&&this._handleEraseBtnCtrClick():(this._showMessages(this.i18n.overlayLayerPolyMsg),this._intersectBtn.set("checked",!0),this._handleIntersectBtnCtrClick());this.showGeoAnalyticsParams&&this._filterOutOperators(a)}}this.updateUIForGeoAnalytics()},_handleOperatorChange:function(a){var b="";this.set("overlayType",a);switch(a){case this.operators.Intersect:b=
this.i18n.intersectOutputLyrName;break;case this.operators.Erase:b=this.i18n.eraseOutputLyrName;break;case this.operators.Union:b=this.i18n.unionOutputLyrName;break;case this.operators.Identity:b=this.i18n.identityOutputLyrName;break;case this.operators.Symmetrical:b=this.i18n.symmetricalOutputLyrName}this._outputLayerInput.set("value",this._getOutputLayerName(b))},_filterOutOperators:function(a){c.isPolygon(this.inputLayer)?c.isPolygon(a)?this._updateOperatorOptions():c.isLine(a)?this._updateOperatorOptions([this.operators.Intersect]):
c.isPoint(a)&&this._updateOperatorOptions([this.operators.Intersect]):c.isLine(this.inputLayer)?c.isPolygon(a)?this._updateOperatorOptions([this.operators.Intersect,this.operators.Identity]):c.isLine(a)?this._updateOperatorOptions([this.operators.Intersect,this.operators.Erase,this.operators.Identity,this.operators.Symmetrical]):c.isPoint(a)&&this._updateOperatorOptions([this.operators.Intersect]):c.isPoint(this.inputLayer)&&(c.isPolygon(a)?this._updateOperatorOptions([this.operators.Intersect,this.operators.Identity]):
c.isLine(a)?this._updateOperatorOptions([this.operators.Intersect]):c.isPoint(a)&&this._updateOperatorOptions([this.operators.Intersect,this.operators.Erase,this.operators.Identity,this.operators.Symmetrical]))},_updateOperatorOptions:function(a){var b={Intersect:{value:this.operators.Intersect,label:"\x3cdiv class\x3d'esriFloatLeading intersectLayersIcon'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriLeadingMargin4' style\x3d'height:20px;margin-top:10px;'\x3e"+this.i18n.intersect+"\x3c/div\x3e",selected:!0},
Erase:{value:this.operators.Erase,label:"\x3cdiv class\x3d'esriFloatLeading eraseLayersIcon'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriLeadingMargin4' style\x3d'height:20px;margin-top:10px;'\x3e"+this.i18n.erase+"\x3c/div\x3e"},Union:{value:this.operators.Union,label:"\x3cdiv class\x3d'esriFloatLeading unionLayersIcon'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriLeadingMargin4' style\x3d'height:20px;margin-top:10px;'\x3e"+this.i18n.union+"\x3c/div\x3e"},Identity:{value:this.operators.Identity,label:"\x3cdiv class\x3d'esriFloatLeading identityLayersIcon'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriLeadingMargin4' style\x3d'height:20px;margin-top:10px;'\x3e"+
this.i18n.identity+"\x3c/div\x3e"},SymmetricalDifference:{value:this.operators.Symmetrical,label:"\x3cdiv class\x3d'esriFloatLeading symmetricalDifferenceLayersIcon'\x3e\x3c/div\x3e\x3cdiv class\x3d'esriLeadingMargin4' style\x3d'height:20px;margin-top:10px;'\x3e"+this.i18n.symmetrical+"\x3c/div\x3e"}},d=[];a&&0!==a.length&&a.length?0<a.length&&a.forEach(function(e){(e=b[e])&&d.push(e)}):d=z.values(b);c.updateOptions(this._operatorsSelect,d)},_showMessages:function(a){p.set(this._bodyNode,"innerHTML",
a);v.fadeIn({node:this._errorMessagePane,easing:w.quadIn,onEnd:h.hitch(this,function(){k.set(this._errorMessagePane,{display:""})})}).play();window.setTimeout(h.hitch(this,this._handleCloseMsg),3E3)},_handleCloseMsg:function(a){a&&a.preventDefault();v.fadeOut({node:this._errorMessagePane,easing:w.quadOut,onEnd:h.hitch(this,function(){k.set(this._errorMessagePane,{display:"none"})})}).play()},_updateOutputType:function(){var a;"0"!==this._overlayFeaturesSelect.get("value")&&(a=this.overlayLayers[this._overlayFeaturesSelect.get("value")-
1]);var b=this.isPoint(this.inputLayer.geometryType)||this.inputLayer.geometryType===g.GeometryTypes.MultiPoint||this.isPoint(a.geometryType)||a.geometryType===g.GeometryTypes.MultiPoint;k.set(this._outputTypeTable,"display","table");this._outputTypeSelect.removeOption(this._outputTypeSelect.getOptions());this._outputTypeSelect.set("disabled",b);b?l.add(this._outputTypeLabel,"esriAnalysisTextDisabled"):l.remove(this._outputTypeLabel,"esriAnalysisTextDisabled");b?this._outputTypeSelect.addOption({value:"Input",
label:this.i18n.points}):this.isLine(this.inputLayer.geometryType)&&this.isLine(a.geometryType)?this._outputTypeSelect.addOption([{value:"Point",label:this.i18n.points,selected:!0},{value:"Input",label:this.i18n.lines}]):this.isPolygon(this.inputLayer.geometryType)&&this.isPolygon(a.geometryType)?this._outputTypeSelect.addOption([{value:"Point",label:this.i18n.points},{value:"Line",label:this.i18n.lines},{value:"Input",label:this.i18n.areas,selected:!0}]):this.isLine(this.inputLayer.geometryType)&&
this.isPolygon(a.geometryType)?this._outputTypeSelect.addOption([{value:"Point",label:this.i18n.points,selected:!0},{value:"Input",label:this.i18n.lines}]):this.isPolygon(this.inputLayer.geometryType)&&this.isLine(a.geometryType)&&this._outputTypeSelect.addOption([{value:"Point",label:this.i18n.points,selected:!0},{value:"Input",label:this.i18n.lines}])},_handleUnionBtnCtrClick:function(){this._unionBtnCtr.set("checked",!0);this._unionBtn.set("checked",!0);k.set(this._outputTypeTable,"display","none");
this._outputTypeSelect.set("disabled",!0);l.add(this._outputTypeLabel,"esriAnalysisTextDisabled");this._handleUnionBtnClick()},_handleIntersectBtnCtrClick:function(){this._intersectBtnCtr.set("checked",!0);this._intersectBtn.set("checked",!0);this._overlayFeaturesSelect.get("value");this._handleIntersectBtnClick();this.showGeoAnalyticsParams||this._updateOutputType();this.updateUIForGeoAnalytics()},_handleEraseBtnCtrClick:function(){this._eraseBtnCtr.set("checked",!0);this._eraseBtn.set("checked",
!0);k.set(this._outputTypeTable,"display","none");this._outputTypeSelect.set("disabled",!0);l.add(this._outputTypeLabel,"esriAnalysisTextDisabled");this._handleEraseBtnClick()},_handleUnionBtnClick:function(a){this._canSelectOverlayType()||(this._outputLayerInput.set("value",this._getOutputLayerName(this.i18n.unionOutputLyrName)),this._unionBtn.focus(),this.set("OverlayType","union"))},_handleEraseBtnClick:function(a){this._canSelectOverlayType()||(this._outputLayerInput.set("value",this._getOutputLayerName(this.i18n.eraseOutputLyrName)),
this._eraseBtn.focus(),this.set("OverlayType","erase"))},_handleIntersectBtnClick:function(a){this._canSelectOverlayType()||(this._outputLayerInput.set("value",this._getOutputLayerName(this.i18n.intersectOutputLyrName)),this._intersectBtn.focus(),this.set("OverlayType","intersect"))},_getOutputLayerName:function(a){var b=this.overlayLayers[this._overlayFeaturesSelect.get("value")-1].name;return r.substitute(a,{layername:this.inputLayer.name,overlayname:b})},_canSelectOverlayType:function(){return"browse"===
this._overlayFeaturesSelect.get("value")||"browselayers"===this._overlayFeaturesSelect.get("value")||""===this._overlayFeaturesSelect.get("value")||!this.inputLayer},_setAnalysisGpServerAttr:function(a){a&&(this.analysisGpServer=a,this.set("toolServiceUrl",this.analysisGpServer+"/"+this.toolName))},_setInputLayerAttr:function(a){this.inputLayer=a},_setInputLayersAttr:function(a){this.inputLayers=a||[]},_setOverlayLayersAttr:function(a){this.overlayLayers=a},_setOverlayLayerAttr:function(a){this.overlayLayer=
a},_setOverlayTypeAttr:function(a){this.overlayType=a},_getOverlayTypeAttr:function(){return this.overlayType},_setDisableRunAnalysisAttr:function(a){this._saveBtn.set("disabled",a)},_setOutputTypeAttr:function(a){this.outputType=a},_getOutputTypeAttr:function(){return this.outputType},validateServiceName:function(a){return c.validateServiceName(a,{textInput:this._outputLayerInput,isItem:!this.returnFeatureCollection})},_connect:function(a,b,d){this._pbConnects.push(u.connect(a,b,d))}});y("extend-esri")&&
h.setObject("dijit.analysis.OverlayLayers",q,F);return q});