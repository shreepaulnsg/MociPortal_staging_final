// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/analysis/templates/JoinFeatures.html":'\x3cdiv class\x3d"esriAnalysis"\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" style\x3d"margin-top:0.5em; margin-bottom: 0.5em;"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_joinFeaturesToolContentTitle" class\x3d"analysisTitle"\x3e\r\n        \x3ctable class\x3d"esriFormTable" \x3e \r\n          \x3ctr\x3e\r\n            \x3ctd class\x3d"esriToolIconTd"\x3e\x3cdiv class\x3d"joinFeaturesIcon"\x3e\x3c/div\x3e\x3c/td\x3e\r\n            \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" data-dojo-attach-point\x3d"_toolTitle"\x3e\r\n\t\t\t\t\t\t\t\x3clabel data-dojo-attach-point\x3d"_titleLbl"\x3e${i18n.joinFeaturesTitle}\x3c/label\x3e\r\n\t\t\t\t\t\t\t\x3cnav class\x3d"breadcrumbs"  data-dojo-attach-point\x3d"_analysisModeLblNode" style\x3d"display:none;"\x3e\r\n\t\t\t\t\t\t\t\t\x3ca href\x3d"#" class\x3d"crumb breadcrumbs__modelabel" data-dojo-attach-event\x3d"onclick:_handleModeCrumbClick" data-dojo-attach-point\x3d"_analysisModeCrumb"\x3e\x3c/a\x3e\r\n\t\t\t\t\t\t\t\t\x3ca href\x3d"#" class\x3d"crumb is-active" data-dojo-attach-point\x3d"_analysisTitleCrumb" style\x3d"font-size:16px;"\x3e${i18n.joinFeaturesTitle}\x3c/a\x3e\r\n\t\t\t\t\t\t\t\x3c/nav\x3e \t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\x3c/td\x3e\r\n            \x3ctd\x3e\r\n              \x3cdiv class\x3d"esriFloatTrailing" style\x3d"padding:0;"\x3e\r\n                  \x3cdiv class\x3d"esriFloatLeading"\x3e\r\n                    \x3ca href\x3d"#" class\x3d\'esriFloatLeading helpIcon\' esriHelpTopic\x3d"toolDescription"\x3e\x3c/a\x3e\r\n                  \x3c/div\x3e\r\n                  \x3cdiv class\x3d"esriFloatTrailing"\x3e\r\n                    \x3ca href\x3d"#" data-dojo-attach-point\x3d"_closeBtn" title\x3d"${i18n.close}" class\x3d"esriAnalysisCloseIcon"\x3e\x3c/a\x3e\r\n                  \x3c/div\x3e              \r\n              \x3c/div\x3e                \r\n            \x3c/td\x3e\r\n          \x3c/tr\x3e\r\n        \x3c/table\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv style\x3d"clear:both; border-bottom: #CCC thin solid; height:1px;width:100%;"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\t\x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"_form" readOnly\x3d"true"\x3e\r\n\t    \x3ctable class\x3d"esriFormTable" style\x3d"border-collapse:collapse;border-spacing:5px;margin-top:15px;" cellpadding\x3d"5px" cellspacing\x3d"5px" data-dojo-attach-point\x3d"_targetLayerTable"\x3e \r\n\t        \x3ctbody\x3e\r\n\t        \t\x3ctr data-dojo-attach-point\x3d"_targetLayerLabelRow" style\x3d"display: table-row;"\x3e\r\n\t\t            \x3ctd colspan\x3d"3" style\x3d"padding-bottom:1em;"\x3e\r\n\t\t              \x3clabel class\x3d"esriFloatLeading esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.oneLabel}\x3c/label\x3e\r\n\t\t              \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.targetLayerLabel}\x3c/label\x3e\r\n\t\t            \x3c/td\x3e\r\n\t\t            \x3ctd class\x3d"shortTextInput" style\x3d"padding-bottom:0;"\x3e\r\n\t\t              \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" esrihelptopic\x3d"targetLayer"\x3e\x3c/a\x3e\r\n\t\t            \x3c/td\x3e\r\n\t          \t\x3c/tr\x3e\r\n\t          \t\x3ctr data-dojo-attach-point\x3d"_targetLayerRow"  style\x3d"display: table-row;"\x3e\r\n\t\t            \x3ctd style\x3d"padding-top: 0px; padding-bottom: 1em;" \x3e\r\n\t\t              \t\x3cselect class\x3d"esriLeadingMargin1 esriTrailingMargin025 longInput esriLongLabel" data-dojo-attach-point\x3d"_targetLayerSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"overflow:hidden!important;" data-dojo-attach-event\x3d"onChange:_handleTargetLayerChange" required\x3d"true"\x3e\r\n\t \t              \t\x3c/select\x3e\r\n\t\t            \x3c/td\x3e\r\n\t          \t\x3c/tr\x3e\r\n\t        \x3c/tbody\x3e\r\n\t    \x3c/table\x3e\r\n\t    \x3ctable class\x3d"esriFormTable" style\x3d"border-collapse:collapse;border-spacing:5px;margin-top:5px;" cellpadding\x3d"5px" cellspacing\x3d"5px" data-dojo-attach-point\x3d"_joinLayerTable"\x3e \r\n\t        \x3ctbody\x3e\r\n\t        \t\x3ctr data-dojo-attach-point\x3d"_joinLayerLabelRow" style\x3d"display: table-row;"\x3e\r\n\t\t            \x3ctd colspan\x3d"3" style\x3d"padding-bottom:1em;"\x3e\r\n\t\t              \x3clabel class\x3d"esriFloatLeading esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.twoLabel}\x3c/label\x3e\r\n\t\t              \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.joinLayerLabel}\x3c/label\x3e\r\n\t\t            \x3c/td\x3e\r\n\t\t            \x3ctd class\x3d"shortTextInput" style\x3d"padding-bottom:0;"\x3e\r\n\t\t              \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" esrihelptopic\x3d"joinLayer"\x3e\x3c/a\x3e\r\n\t\t            \x3c/td\x3e\r\n\t          \t\x3c/tr\x3e\r\n\t          \t\x3ctr data-dojo-attach-point\x3d"_joinLayerRow" style\x3d"display: table-row;"\x3e\r\n\t\t            \x3ctd style\x3d"padding-top: 0px; padding-bottom: 1em;"\x3e\r\n\t\t              \t\x3cselect class\x3d"esriLeadingMargin1 esriTrailingMargin025 longInput esriLongLabel" data-dojo-attach-point\x3d"_joinLayerSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"overflow:hidden!important;" data-dojo-attach-event\x3d"onChange:_handleJoinLayerChange" required\x3d"true"\x3e\x3c/select\x3e\r\n\t\t            \x3c/td\x3e\r\n\t          \t\x3c/tr\x3e\r\n\t        \x3c/tbody\x3e\r\n\t    \x3c/table\x3e\r\n\t    \x3ctable class\x3d"esriFormTable" style\x3d"border-collapse:collapse;border-spacing:5px;margin-top:5px;" cellpadding\x3d"5px" cellspacing\x3d"5px"\x3e \r\n\t        \x3ctbody\x3e\r\n\t        \t\x3ctr data-dojo-attach-point\x3d"_JoinOptionsLabelRow"\x3e\r\n\t\t            \x3ctd colspan\x3d"3" style\x3d"padding-bottom:1em;"\x3e\r\n\t\t              \x3clabel class\x3d"esriFloatLeading esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.threeLabel}\x3c/label\x3e\r\n\t\t              \x3clabel class\x3d"esriAnalysisStepsLabel" data-dojo-attach-point\x3d"_joinOptionsLabel"\x3e${i18n.joinOptionsLabel}\x3c/label\x3e\r\n\t\t            \x3c/td\x3e\r\n\t\t            \x3ctd class\x3d"shortTextInput" style\x3d"padding-bottom:0;"\x3e\r\n\t\t              \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" data-dojo-attach-point\x3d"_joinOptionsHelpNode" esrihelptopic\x3d"joinOptions"\x3e\x3c/a\x3e\r\n\t\t            \x3c/td\x3e\r\n\t          \t\x3c/tr\x3e\r\n\t        \x3c/tbody\x3e\r\n\t    \x3c/table\x3e\r\n\t    \x3ctable class\x3d"esriFormTable" data-dojo-attach-point\x3d"_spatialJoinNode" style\x3d"border-collapse:collapse;border-spacing:5px;margin-top:5px;" cellpadding\x3d"5px" cellspacing\x3d"5px"\x3e \r\n\t        \x3ctbody\x3e\r\n\t          \t\x3ctr\x3e\r\n\t\t            \x3ctd colspan\x3d"3" style\x3d"padding-top: 0px;"\x3e\r\n\t\t            \t\x3clabel class\x3d"esriSelectLabel esriExtentLabel esriLeadingMargin2 esriTrailingMargin025 hide" style\x3d"display:none;padding-top: 0px; padding-bottom: 1em;"\x3e\r\n\t\t\t\t\t     \t\x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_spatialCheck" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"checked:false"  data-dojo-attach-event\x3d"onChange:_handleSpatialCheckChange" required\x3d"true"/\x3e${i18n.spatialJoinLabel}\r\n\t\t\t\t\t   \t\x3c/label\x3e\r\n\t\t\t\t\t\t\t    \x3cdiv data-dojo-attach-point\x3d"_spatialJoinCtr" class\x3d"esriSelectLabel" style\x3d"width:100%;"\x3e\r\n\t\t\t        \t    \x3cdiv class\x3d"esriFloatLeading esriLeadingMargin2 bufferSelector iconSelector" data-dojo-attach-point\x3d"_spatialJoin"\x3e\r\n                       \x3cdiv class\x3d"bufferIcon spatialJoinIcon"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n\t\t\t\t\t\t\t      \x3cdiv class\x3d"esriLeadingMargin6 padTop075"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\x3clabel class\x3d"esriSelectLabel" data-dojo-attach-point\x3d"_spatialJoinLabel"\x3e ${i18n.chooseSpatialJoin}\x3c/label\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t    \x3c/div\x3e\r\n\t\t\t\t\t    \x3c/td\x3e\r\n\t\t\t\t\t\t  \x3ctd class\x3d"shortTextInput padTop075"\x3e\r\n\t\t\t            \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" esrihelptopic\x3d"spatialRelationship"\x3e\x3c/a\x3e\r\n\t\t\t        \x3c/td\x3e\r\n\t\t\t    \x3c/tr\x3e\r\n\t        \t\x3ctr\x3e\r\n\t        \t\t\x3ctd colspan\x3d"4" style\x3d"padding:1em;"\x3e\r\n\t\t              \t\x3cspan data-dojo-attach-point\x3d"_spatialRelationshipRow" class\x3d"hide"\x3e\r\n\t\t\t              \t\x3cselect class\x3d"esriLeadingMargin1 esriTrailingMargin025 longInput esriLongLabel" data-dojo-attach-point\x3d"_spatialRelationshipSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"onChange:_handleSpatialRelationshipChange"\x3e\x3c/select\x3e\r\n\t\t\t            \x3c/span\x3e\r\n\t\t\t        \x3c/td\x3e\r\n\t\t        \x3c/tr\x3e\r\n\t\t\t    \x3ctr data-dojo-attach-point\x3d"_spatialDistanceRow" class\x3d"hide"\x3e\r\n\t\t\t    \t\x3ctd colspan\x3d"4" style\x3d"padding:1em;"\x3e\r\n\t\t              \t\x3cinput class\x3d"esriLeadingMargin1 esriTrailingMargin05" style\x3d"width:40%;overflow:hidden!important;" data-dojo-attach-point\x3d"_spatialDistanceInput" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"constraints:{min:0}" data-dojo-attach-event\x3d"onChange:_handleSpatialDistanceChange"\x3e\x3c/input\x3e\r\n\t\t              \t\x3cselect class\x3d"esriLeadingMargin025" style\x3d"width:41.2%;overflow:hidden!important;" data-dojo-attach-point\x3d"_spatialUnitSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"onChange:_handleSpatialUnitChange"\x3e\x3c/select\x3e\r\n\t\t\t        \x3c/td\x3e\r\n\t\t\t      \t\x3c/tr\x3e\r\n\t    \t\x3c/tbody\x3e\r\n\t    \x3c/table\x3e\r\n\t    \x3ctable class\x3d"esriFormTable" data-dojo-attach-point\x3d"_temporalJoinNode" style\x3d"border-collapse:collapse;border-spacing:5px;margin-top:5px;" cellpadding\x3d"5px" cellspacing\x3d"5px"\x3e \r\n\t        \x3ctbody\x3e\r\n\t          \t\x3ctr\x3e\r\n\t\t            \x3ctd colspan\x3d"3" style\x3d"padding-top: 0px;"\x3e\r\n\t\t            \t\x3clabel class\x3d"esriSelectLabel esriExtentLabel esriLeadingMargin2 esriTrailingMargin025 hide" style\x3d"display:none;padding-top: 0px; padding-bottom: 1em;"\x3e\r\n\t\t\t\t\t     \t\x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_temporalCheck" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"checked:false"  data-dojo-attach-event\x3d"onChange:_handleTemporalCheckChange" required\x3d"true"/\x3e${i18n.temporalJoinLabel}\r\n\t\t\t\t\t   \t\x3c/label\x3e\r\n\t\t\t\t\t\t\t    \x3cdiv data-dojo-attach-point\x3d"_temporalJoinCtr" class\x3d"esriSelectLabel" style\x3d"width:100%;"\x3e\r\n\t\t\t              \x3cdiv class\x3d"esriFloatLeading esriLeadingMargin2 bufferSelector iconSelector" data-dojo-attach-point\x3d"_temporalJoin"\x3e\r\n                       \x3cdiv class\x3d"bufferIcon temporalJoinIcon"\x3e\x3c/div\x3e\r\n\t\t\t              \x3c/div\x3e\r\n\t\t\t\t\t\t\t      \x3cdiv class\x3d"esriLeadingMargin6 padTop075"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\x3clabel class\x3d"esriSelectLabel" data-dojo-attach-point\x3d"_temporalJoinLabel"\x3e ${i18n.chooseTemporalJoin}\x3c/label\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t    \x3c/div\x3e\r\n\t\t          \x3c/td\x3e\r\n\t\t\t        \x3ctd class\x3d"shortTextInput padTop075"\x3e\r\n\t\t\t            \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" esrihelptopic\x3d"temporalRelationship"\x3e\x3c/a\x3e\r\n\t\t\t        \x3c/td\x3e\r\n\t\t\t    \x3c/tr\x3e\r\n\t        \t\x3ctr\x3e\r\n\t        \t\t\x3ctd colspan\x3d"4" style\x3d"padding:1em;"\x3e\r\n\t\t              \t\x3cspan data-dojo-attach-point\x3d"_temporalRelationshipRow" class\x3d"hide"\x3e\r\n\t\t\t              \t\x3cselect class\x3d"esriLeadingMargin1 esriTrailingMargin025 longInput esriLongLabel" data-dojo-attach-point\x3d"_temporalRelationshipSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"onChange:_handleTemporalRelationshipChange"\x3e\x3c/select\x3e\r\n\t\t\t            \x3c/span\x3e\r\n\t\t\t        \x3c/td\x3e\r\n\t\t\t      \x3c/tr\x3e\r\n\t\t\t    \x3ctr data-dojo-attach-point\x3d"_temporalDistanceRow" class\x3d"hide"\x3e\r\n\t\t\t    \t\x3ctd colspan\x3d"4" style\x3d"padding:1em;"\x3e\r\n\t\t              \t\x3cinput class\x3d"esriLeadingMargin1 esriTrailingMargin05" style\x3d"width:40%;overflow:hidden!important;" data-dojo-attach-point\x3d"_temporalDistanceInput" data-dojo-type\x3d"dijit/form/NumberTextBox" data-dojo-props\x3d"constraints:{min:0}" data-dojo-attach-event\x3d"onChange:_handleTemporalDistanceChange"\x3e\x3c/input\x3e\r\n\t\t              \t\x3cselect class\x3d"esriLeadingMargin025" style\x3d"width:41.2%;overflow:hidden!important;" data-dojo-attach-point\x3d"_temporalUnitSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"onChange:_handleTemporalUnitChange"\x3e\x3c/select\x3e\r\n\t\t\t        \x3c/td\x3e\r\n\t    \t\x3c/tbody\x3e\r\n\t    \x3c/table\x3e\r\n\t    \x3ctable class\x3d"esriFormTable" data-dojo-attach-point\x3d"_attributeJoinNode" style\x3d"border-collapse:collapse;border-spacing:5px;margin-top:5px;" cellpadding\x3d"5px" cellspacing\x3d"5px"\x3e \r\n\t        \x3ctbody\x3e\r\n\t          \t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd colspan\x3d"3" style\x3d"padding-top: 0px;"\x3e\r\n\t\t            \t\x3clabel class\x3d"esriSelectLabel esriExtentLabel esriLeadingMargin2 esriTrailingMargin025 hide" style\x3d"display:none;padding-top: 0px;"\x3e\r\n\t\t\t\t\t     \t\x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_attributeCheck" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"checked:false"  data-dojo-attach-event\x3d"onChange:_handleAttributeCheckChange" required\x3d"true"/\x3e${i18n.attributeJoinLabel}\r\n\t\t\t\t\t   \t\x3c/label\x3e\r\n\t\t\t\t\t\t\t   \x3cdiv data-dojo-attach-point\x3d"_attributeJoinCtr" style\x3d"width:100%;" class\x3d"esriSelectLabel"\x3e\r\n\t\t                \x3cdiv class\x3d"esriFloatLeading esriLeadingMargin2 bufferSelector iconSelector" data-dojo-attach-point\x3d"_attributeJoin"\x3e\r\n                       \x3cdiv class\x3d"bufferIcon attributeJoinIcon"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n\t\t\t\t\t\t\t      \x3cdiv class\x3d"esriLeadingMargin6 padTop075"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\t\x3clabel class\x3d"esriSelectLabel" data-dojo-attach-point\x3d"_attrJoinLabel"\x3e ${i18n.chooseAttrJoin}\x3c/label\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t    \x3c/div\x3e\r\n\t\t            \x3c/td\x3e\r\n\t\t\t\t       \x3ctd class\x3d"shortTextInput padTop075"\x3e\r\n\t       \t            \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" esrihelptopic\x3d"attributeRelationship"\x3e\x3c/a\x3e\r\n\t\t\t        \x3c/td\x3e\r\n\t          \t\x3c/tr\x3e\r\n\t    \t\x3c/tbody\x3e\r\n\t    \x3c/table\x3e\r\n\t    \x3ctable class\x3d"esriFormTable esriLeadingMargin1 attributeJoin" style\x3d"border-collapse:collapse;border-spacing:5px;margin-top:10px;" cellpadding\x3d"5px" cellspacing\x3d"5px"\x3e \r\n\t        \x3ctbody\x3e\r\n\t\t      \t\x3ctr data-dojo-attach-point\x3d"_attributeRelationshipRow" class\x3d"hide longInput"\x3e\r\n\t\t          \t\r\n\t\t        \x3c/tr\x3e\r\n\t        \x3c/tbody\x3e\r\n\t    \x3c/table\x3e\r\n\t    \x3ctable class\x3d"esriFormTable" style\x3d"border-collapse:collapse;border-spacing:5px; margin-top:10px;margin-bottom:5px;" cellpadding\x3d"5px" cellspacing\x3d"5px" data-dojo-attach-point\x3d"_summaryStatisticTable"\x3e \r\n\t        \x3ctbody\x3e\r\n\t        \t\x3ctr data-dojo-attach-point\x3d"_summaryStatisticLabelRow" style\x3d"display: table-row;"\x3e\r\n\t\t            \x3ctd colspan\x3d"3"\x3e\r\n\t\t              \x3clabel class\x3d"esriFloatLeading esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.fourLabel}\x3c/label\x3e\r\n\t\t              \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.joinTypeLabel}\x3c/label\x3e\r\n\t\t            \x3c/td\x3e\r\n\t\t            \x3ctd class\x3d"shortTextInput" style\x3d"padding-bottom:0;"\x3e\r\n\t\t              \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" esrihelptopic\x3d"joinOperation"\x3e\x3c/a\x3e\r\n\t\t            \x3c/td\x3e\r\n\t          \t\x3c/tr\x3e\r\n\t          \t\x3ctr data-dojo-attach-point\x3d"_joinOperationRow" style\x3d"display: table-row;"\x3e\r\n\t\t            \x3ctd colspan\x3d"3" style\x3d"padding-top: 0px; padding-bottom: 1em;"\x3e\r\n\t\t              \t\x3cselect class\x3d"esriLeadingMargin1 esriTrailingMargin025 longInput esriLongLabel" style\x3d"overflow:hidden!important;" data-dojo-attach-point\x3d"_joinOperation" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"onChange:_handleJoinOperationChange"\x3e\r\n\t\t              \t\x3c/select\x3e\r\n\t\t            \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3ctr data-dojo-attach-point\x3d"_joinOneOneOptionRow" style\x3d"display: table-row;"\x3e\r\n                \x3ctd colspan\x3d"3"\x3e\r\n                  \x3cselect data-dojo-attach-point\x3d"_joinOptionSelect" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-event\x3d"onChange:_handleJoinOneToOneOptionChange" class\x3d"esriLeadingMargin1 esriTrailingMargin025 longInput esriLongLabel"\x3e\r\n                    \x3coption value\x3d"RECORD"\x3e${i18n.recordKept}\x3c/option\x3e\r\n                    \x3coption value\x3d"STATS"\x3e${i18n.addStats}\x3c/option\x3e\r\n                  \x3c/select\x3e\r\n                \x3c/td\x3e\r\n\t\t            \x3ctd data-dojo-attach-point\x3d"_joinOneOneOptionsHelpTd" class\x3d"shortTextInput" style\x3d"padding-bottom:0;"\x3e\r\n\t\t              \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" esrihelptopic\x3d"summaryFields"\x3e\x3c/a\x3e\r\n\t\t            \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n              \x3c!--\x3ctr\x3e\r\n                \x3ctd colspan\x3d"4"\x3e\r\n                    \x3clabel class\x3d"esriLeadingMargin1" data-dojo-attach-point\x3d"_joinRecordRowLabel"\x3e${i18n.recordKept}\x3c/label\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e--\x3e\r\n              \x3ctr data-dojo-attach-point\x3d"_joinRecordRow" style\x3d"display: table-row;"\x3e\r\n                \x3ctd colspan\x3d"4"\x3e\r\n                  \x3cdiv class\x3d"esriLeadingMargin2" style\x3d"width:100%;"\x3e\r\n                    \x3clabel class\x3d"esriSelectLabel"\x3e\r\n                      \x3cinput type\x3d"radio" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"_firstRecRadioBtn" data-dojo-props\x3d"\'class\':\'esriSelectLabel\',checked:true" name\x3d"chooserecord"/\x3e\r\n                      ${i18n.chooseFirstRecord}\r\n                    \x3c/label\x3e\r\n                    \x3cbr/\x3e\r\n                    \x3clabel class\x3d"esriSelectLabel"\x3e\r\n                      \x3cinput type\x3d"radio" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"_exprRadioBtn" data-dojo-attach-event\x3d"onChange:_handleExprRadioChange" data-dojo-props\x3d"\'class\':\'esriSelectLabel\'" name\x3d"chooserecord"/\x3e \r\n                      ${i18n.orderByField}\r\n                    \x3c/label\x3e\r\n                    \x3cbr/\x3e\r\n                    \x3cselect class\x3d"padTop05 esriTableFixedLayout mediumDivInput"  data-dojo-type\x3d"dijit/form/Select"  data-dojo-attach-event\x3d"onChange:_handleExpFieldChange" data-dojo-attach-point\x3d"_expFieldsSelect"\x3e\r\n                    \x3c/select\x3e\r\n                    \x3cselect class\x3d"padTop05 esriTableFixedLayout mediumDivInput"  data-dojo-type\x3d"dijit/form/Select"  data-dojo-attach-point\x3d"_expFilterSelect"\x3e\r\n                    \x3c/select\x3e\r\n                  \x3c/div\x3e\r\n                \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n\t\t\t\t\t\t\t\x3ctr data-dojo-attach-point\x3d"_joinOperationLabelRow" style\x3d"display: table-row;"\x3e\r\n\t\t            \x3ctd colspan\x3d"3" style\x3d"padding-bottom:1em;"\x3e\r\n\t\t              \x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.statisticsLabel}\x3c/label\x3e\r\n\t\t            \x3c/td\x3e\r\n\t\t            \x3ctd class\x3d"shortTextInput" style\x3d"padding-bottom:0;"\x3e\r\n\t\t              \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" esrihelptopic\x3d"summaryFields"\x3e\x3c/a\x3e\r\n\t\t            \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n\t          \t\x3ctr data-dojo-type\x3d"esri/dijit/analysis/components/AddSummaryFields" data-dojo-attach-point\x3d"_summaryWidget" \r\n\t\t\t\t\t\t\t\tdata-dojo-props\x3d"layer:\'\', showGeoAnalyticsParams:${showGeoAnalyticsParams}, addAsRow:true, allowDateType:true, isGPStringObjType: true"\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n              \x3ctr data-dojo-attach-point\x3d"_keepTargetFeaturesRow" style\x3d"display: table-row;"\x3e\r\n                \x3ctd colspan\x3d"3"\x3e\r\n\t\t\t\t   \x3clabel class\x3d"esriLeadingMargin1 esriSelectLabel esriExtentLabel"\x3e\r\n\t\t\t\t\t \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_keepTargetFeaturesCheck" data-dojo-type\x3d"dijit/form/CheckBox" name\x3d"keepAllTargetFeatures"/\x3e\r\n\t\t\t\t\t\t${i18n.keepAllTargetFeatures}\r\n\t\t\t\t   \x3c/label\x3e\r\n                \x3c/td\x3e\r\n\t\t        \x3ctd class\x3d"shortTextInput" style\x3d"padding-bottom:0;"\x3e\r\n\t\t          \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" esrihelptopic\x3d"keepTargetFeatures"\x3e\x3c/a\x3e\r\n\t\t        \x3c/td\x3e\r\n              \x3c/tr\x3e\r\n\t        \x3c/tbody\x3e\r\n\t    \x3c/table\x3e\r\n\t\t\t\x3ctable data-dojo-attach-point\x3d"_joinConditionNode" class\x3d"esriFormTable" style\x3d"border-collapse:collapse;border-spacing:5px; margin-top:10px;margin-bottom:5px;" cellpadding\x3d"5px" cellspacing\x3d"5px" data-dojo-attach-point\x3d"_joinOperationTable"\x3e \r\n\t\t\t  \x3ctr data-dojo-attach-point\x3d""\x3e\r\n            \x3ctd colspan\x3d"3" style\x3d"padding-bottom:1em;"\x3e\r\n\t\t\t\t\t\t\t\x3clabel class\x3d"esriFloatLeading esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.fiveLabel}\x3c/label\x3e\r\n\t\t          \x3clabel class\x3d"esriAnalysisStepsLabel"\x3e${i18n.joinOperationLbl}\x3c/label\x3e\r\n            \x3c/td\x3e\r\n\t\t\t\t\t\t\x3ctd class\x3d"shortTextInput" style\x3d"padding-bottom:0;"\x3e\r\n\t\t          \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" esrihelptopic\x3d"joinCondition"\x3e\x3c/a\x3e\r\n\t\t        \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n\t\t\t  \x3ctr data-dojo-attach-point\x3d"_bufFielExpRow"\x3e\r\n          \x3ctd colspan\x3d"4"\x3e\r\n            \x3ctable style\x3d"width:85%" class\x3d"esriFormTable"\x3e\r\n              \x3ctr\x3e\r\n                \x3ctd colspan\x3d"3"\x3e\r\n                  \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/ValidationTextBox" style\x3d"width:90%;" class\x3d"esriLeadingMargin1 longInput" data-dojo-props\x3d"trim:true" data-dojo-attach-point\x3d"_bufFieldOutput" value\x3d""\x3e\x3c/input\x3e\r\n                \x3c/td\x3e\r\n                \x3ctd class\x3d"shortTextInput"\x3e\r\n                  \x3cdiv data-dojo-type\x3d"dijit/form/Button" class\x3d"esriActionButton" data-dojo-props\x3d"label:\'${i18n.add}\',iconClass:\'esriAnalysisExpIcon\',showLabel: false" data-dojo-attach-point\x3d"_expBtn" data-dojo-attach-event\x3d"onClick:_handleExpBtnClick"\x3e\x3c/div\x3e\r\n                \x3c/td\x3e\r\n             \x3c/tr\x3e\r\n            \x3c/table\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t    \x3ctable class\x3d"esriFormTable" style\x3d"border-collapse:collapse;border-spacing:5px;margin-top:15px;" cellpadding\x3d"5px" cellspacing\x3d"5px" data-dojo-attach-point\x3d"_outputNameTable"\x3e \r\n\t        \x3ctbody\x3e\r\n\t          \t\x3ctr\x3e\r\n\t\t            \x3ctd colspan\x3d"3" style\x3d"border-collapse:collapse;border-spacing:5px;"\x3e\r\n\t\t              \x3clabel data-dojo-attach-point\x3d"_resultStepLabel" class\x3d"esriFloatLeading esriTrailingMargin025 esriAnalysisNumberLabel"\x3e${i18n.sixLabel}\x3c/label\x3e\r\n\t\t              \x3clabel class\x3d"longTextInput esriAnalysisStepsLabel"\x3e${i18n.resultLabel}\x3c/label\x3e\r\n\t\t            \x3c/td\x3e\r\n\t\t            \x3ctd class\x3d"shortTextInput"\x3e\r\n\t\t              \x3ca href\x3d"#" class\x3d\'esriFloatTrailing helpIcon\' esriHelpTopic\x3d"outputName"\x3e\x3c/a\x3e \r\n\t\t            \x3c/td\x3e             \r\n\t            \x3c/tr\x3e\r\n\t          \t\x3ctr\x3e\r\n\t\t\t        \x3ctd colspan\x3d"3" style\x3d"border-collapse:collapse;border-spacing:5px;"\x3e\r\n\t\t\t          \x3cinput type\x3d"text" data-dojo-type\x3d"dijit/form/ValidationTextBox" data-dojo-props\x3d"required:true,trim:true" class\x3d"esriOutputText esriLeadingMargin1 longInput" data-dojo-attach-point\x3d"_outputName"\x3e\x3c/input\x3e\r\n\t\t\t        \x3c/td\x3e                \r\n\t\t        \x3c/tr\x3e\r\n\t        \x3c/tbody\x3e\r\n\t    \x3c/table\x3e\r\n\t    \x3ctable class\x3d"esriFormTable" style\x3d"border-collapse:collapse;border-spacing:5px;margin-top:15px;" cellpadding\x3d"5px" cellspacing\x3d"5px" data-dojo-attach-point\x3d"_outputNameTable"\x3e \r\n\t        \x3ctbody\x3e\r\n\t          \t\x3ctr\x3e\r\n\t\t            \x3ctd colspan\x3d"3" style\x3d"border-collapse:collapse;border-spacing:5px;"\x3e\r\n\t\t              \x3cdiv class\x3d"esriLeadingMargin1 attrSelect" data-dojo-attach-point\x3d"_chooseFolderRow"\x3e\r\n\t\t                \x3clabel style\x3d"width:9px;font-size:smaller;"\x3e${i18n.saveResultIn}\x3c/label\x3e\r\n\t\t                \x3cinput class\x3d"longInput esriFolderSelect" data-dojo-attach-point\x3d"_webMapFolderSelect" dojotype\x3d"dijit/form/FilteringSelect" trim\x3d"true"\x3e\x3c/input\x3e\r\n\t\t              \x3c/div\x3e              \r\n\t\t            \x3c/td\x3e\r\n\t          \t\x3c/tr\x3e   \r\n\t        \x3c/tbody\x3e\r\n\t    \x3c/table\x3e\r\n\t\x3c/div\x3e\r\n  \t\x3cdiv style\x3d"padding:5px;margin-top:5px;border-top:solid 1px #BBB;"\x3e\r\n      \t\x3cdiv class\x3d"esriExtentCreditsCtr"\x3e\r\n        \x3ca class\x3d"esriFloatTrailing esriSmallFont"  href\x3d"#" data-dojo-attach-point\x3d"_showCreditsLink"\x3e${i18n.showCredits}\x3c/a\x3e\r\n       \t\x3clabel data-dojo-attach-point\x3d"_chooseExtentDiv" class\x3d"esriSelectLabel esriExtentLabel esriLeadingMargin025"\x3e\r\n         \t\x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_useExtentCheck" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-attach-event\x3d"onChange:_handleExtentChange" data-dojo-props\x3d"checked:true" name\x3d"extent" value\x3d"true"/\x3e\r\n           \t${i18n.useMapExtent}\r\n       \t\x3c/label\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_outputTypeRow" class\x3d"padBottom1"\x3e\r\n        \x3ctable style\x3d"width:100%;"\x3e\r\n          \x3ctr\x3e\r\n            \x3ctd colspan\x3d"3" style\x3d"padding:0;"\x3e\r\n              \x3clabel data-dojo-attach-point\x3d"" class\x3d"esriSelectLabel esriExtentLabel"\x3e\r\n                \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_checkCreateView" data-dojo-attach-event\x3d"onChange:_handleCreateViewChange" data-dojo-type\x3d"dijit/form/CheckBox" name\x3d"storeResultAsView"/\x3e\r\n                ${i18n.saveResultAsView}\r\n              \x3c/label\x3e\r\n            \x3c/td\x3e\r\n            \x3ctd class\x3d"shortTextInput"\x3e\r\n              \x3ca href\x3d"#" class\x3d"esriFloatTrailing helpIcon" esrihelptopic\x3d"isView"\x3e\x3c/a\x3e\r\n            \x3c/td\x3e\r\n          \x3c/tr\x3e\r\n        \x3c/table\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"esriFormWarning esriRoundedBox" data-dojo-attach-point\x3d"_errorMessagePane" style\x3d"display:none;"\x3e\r\n        \x3ca href\x3d"#" title\x3d"${i18n.close}" class\x3d"esriFloatTrailing esriAnalysisCloseIcon" title\x3d\'${i18n.close}\' data-dojo-attach-event\x3d"onclick:_handleCloseMsg"\x3e\x3c/a\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"_bodyNode"\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n      \x3cbutton data-dojo-type\x3d"dijit/form/Button" type\x3d"submit" data-dojo-attach-point\x3d"_saveBtn" class\x3d"esriLeadingMargin4 esriAnalysisSubmitButton" data-dojo-attach-event\x3d"onClick:_handleSaveBtnClick"\x3e\r\n          ${i18n.runAnalysis}\r\n      \x3c/button\x3e\r\n    \x3c/div\x3e\r\n\t\t\x3cdiv data-dojo-type\x3d"dijit/Dialog" data-dojo-attach-point\x3d"_exprDialog" class\x3d"esriBufExpressDialog" data-dojo-props\x3d"title:\'${i18n.addJoinCondition}\'"\x3e\r\n      \x3cdiv class\x3d"esriBufExpressionFormCtr"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"_expressionCtr"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/Dialog" title\x3d"${i18n.creditTitle}" data-dojo-attach-point\x3d"_usageDialog" style\x3d"width:40em;"\x3e\r\n      \x3cdiv data-dojo-type\x3d"esri/dijit/analysis/CreditEstimator"  data-dojo-attach-point\x3d"_usageForm"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e    \r\n  \t\r\n\x3c/div\x3e\r\n'}});
define("esri/dijit/analysis/JoinFeatures","esri/layers/FeatureLayer require dojo/aspect dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/has dojo/on dojo/json dojo/string dojo/dom-style dojo/dom-attr dojo/dom-construct dojo/query dojo/dom-class dojo/store/Memory dojo/_base/fx dojo/fx/easing dojo/Deferred dojo/promise/all dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin dijit/_FocusMixin dijit/registry dijit/layout/AccordionContainer dijit/TitlePane dijit/form/FilteringSelect dijit/form/Select dijit/form/TextBox dijit/Dialog ../../kernel ../../lang ./utils ./AnalysisBase ./CreditEstimator ./_AnalysisOptions ../CalculateField ../../geometry/Point ../../geometry/Polyline ../../geometry/Polygon ../../SpatialReference ./AnalysisRegistry ./ItemTypes ./ViewJsonTypes ./components/AddSummaryFields dojo/i18n!../../nls/jsapi dojo/text!./templates/JoinFeatures.html".split(" "),
function(I,V,W,X,m,k,J,w,Y,K,oa,Z,A,F,B,pa,n,qa,N,O,G,P,aa,ba,ca,da,ea,Q,ra,sa,ta,R,ua,va,fa,v,u,ha,wa,ia,H,ja,ka,la,S,E,L,ma,xa,T,na){I=X([aa,ba,ca,da,ea,ia,ha],{declaredClass:"esri.dijit.analysis.JoinFeatures",templateString:na,widgetsInTemplate:!0,showGeoAnalyticsParams:!0,showTemporalJoin:!0,showAttributeJoin:!0,showSpatialJoin:!0,showJoinCondition:!0,allowAllAttributesTypes:!0,showRecordToKeepOption:!0,i18n:null,toolName:"JoinFeatures",helpFileName:"JoinFeatures",resultParameter:"output",removeJobParamKeys:["polyExpressionObject"],
_spatialDistanceOperators:["Near","NearGeodesic","withindistance"],_temporalDistanceOperators:["Near","NearAfter","NearBefore"],constructor:function(a,b){this.targetLayers=[];this.joinLayers=[];this._pbConnects=[];this._attrJoinRows=[];a.containerNode&&(this.container=a.containerNode)},postCreate:function(){this.inherited(arguments);this.filterObjects=[{layer:"targetLayer",layers:this.targetLayers,select:this._targetLayerSelect,expressionObj:"attributeExprObj"},{layer:"joinLayer",layers:this.joinLayers,
select:this._joinLayerSelect,expressionObj:"polyExpressionObject"}];this._buildUI()},postMixInProperties:function(){this.inherited(arguments);m.mixin(this.i18n,T.expressionForm);m.mixin(this.i18n,T.joinFeaturesTool);this.joinOperation||(this.joinOperation="JoinOneToOne");this.joinOperationTypes=[{value:"JoinOneToOne",label:this.i18n.oneToOneLabel},{value:"JoinOneToMany",label:this.i18n.oneToManyLabel}];this.spatialDistance=this.spatialRelationshipDistance||this.spatialNearDistance||0;this.spatialUnit=
this.spatialRelationshipDistanceUnits||this.spatialNearDistanceUnit||this.i18n.feet;this.spatialUnitTypes=[{value:"Miles",label:this.i18n.miles},{value:"Yards",label:this.i18n.yards},{value:"Feet",label:this.i18n.feet},{value:"NauticalMiles",label:this.i18n.nautMiles},{type:"separator"},{value:"Kilometers",label:this.i18n.kilometers},{value:"Meters",label:this.i18n.meters}];this.temporalDistance=0;this.temporalUnit=this.i18n.years;this.temporalUnitTypes=[{value:"Years",label:this.i18n.years},{value:"Months",
label:this.i18n.months},{value:"Weeks",label:this.i18n.weeks},{value:"Days",label:this.i18n.days},{value:"Hours",label:this.i18n.hours},{value:"Minutes",label:this.i18n.minutes},{value:"Seconds",label:this.i18n.seconds},{value:"Milliseconds",label:this.i18n.milliseconds}];this.attributeType=[{value:"Equal",label:this.i18n.equalSign}]},startup:function(){},_buildUI:function(){var a=!0,b=!0,c;this._outputName.set("validator",m.hitch(this,this.validateServiceName));this.signInPromise.then(m.hitch(this,
u.initHelpLinks,this.domNode,this.showHelp,{analysisGpServer:this.analysisGpServer}));u.updateDisplay([this._temporalJoinNode],this.showTemporalJoin,"table");u.updateDisplay([this._spatialJoinNode],this.showSpatialJoin,"table");u.updateDisplay([this._attributeJoinNode],this.showAttributeJoin,"table");u.updateDisplay([this._joinConditionNode],this.showJoinCondition,"table");u.updateDisplay([this._outputTypeRow],this.get("showOutputType")&&!this.showGeoAnalyticsParams,"block");u.updateDisplay([this._joinOneOneOptionRow,
this._joinRecordRow],this.showRecordToKeepOption&&!this.showGeoAnalyticsParams,"table-row");this.allowAllAttributesTypes=this.showGeoAnalyticsParams?!1:this.allowAllAttributesTypes;this.showJoinCondition||F.set(this._resultStepLabel,"innerHTML",this.i18n.fiveLabel);this.showGeoAnalyticsParams||(F.set(this._joinOptionsLabel,"innerHTML",this.i18n.joinOptionsStdLabel),F.set(this._joinOptionsHelpNode,"esriHelpTopic","joinType"));k.forEach(this.joinOperationTypes,function(g,p){this._joinOperation.addOption({value:g.value,
label:g.label})},this);this.joinOperation&&(this._joinOperation.set("value",this.joinOperation),"JoinOneToMany"===this.joinOperation&&u.updateDisplay([this._joinOperationLabelRow,this._joinRecordRow,this._joinOneOneOptionRow].concat(this._summaryWidget.rows),"JoinOneToOne"===this.joinOperation,"table-row"));k.forEach(this.spatialUnitTypes,function(g,p){this._spatialUnitSelect.addOption({value:g.value,label:g.label})},this);this.spatialUnit&&this._spatialUnitSelect.set("value",this.spatialUnit);k.forEach(this.temporalUnitTypes,
function(g,p){this._temporalUnitSelect.addOption({value:g.value,label:g.label})},this);this.temporalUnit&&this._temporalUnitSelect.set("value",this.temporalUnit);if(v.isDefined(this.targetLayer)){var d=k.indexOf(this.targetLayers,this.targetLayer);-1===d&&k.forEach(this.targetLayers,function(g,p){g&&(g.url&&this.targetLayer.url&&g.url===this.targetLayer.url||g.name===this.targetLayer.name)&&(d=p)},this);-1===d&&this.targetLayers.push(this.targetLayer)}v.isDefined(this.joinLayer)&&(d=k.indexOf(this.joinLayers,
this.joinLayer),-1===d&&k.forEach(this.joinLayers,function(g,p){g&&(g.url&&this.joinLayer.url&&g.url===this.joinLayer.url||g.name===this.joinLayer.name)&&(d=p)},this),-1===d&&this.joinLayers.push(this.joinLayer));if(v.isDefined(this.targetLayers)&&0<this.targetLayers.length){var f=[];this.rerun&&!this.targetLayer&&u.addBlankOption(this._targetLayerSelect,f);k.forEach(this.targetLayers,function(g,p){f.push({value:this._toString(p),label:g.name,selected:g.url&&this.targetLayer&&this.targetLayer.url&&
g.url===this.targetLayer.url||g&&this.targetLayer&&!g.url&&!this.targetLayer.url&&g.name===this.targetLayer.name})},this);this._targetLayerSelect.addOption(f);v.isDefined(this.targetLayer)||this.rerun||this.set("targetLayer",this.targetLayers[this._targetLayerSelect.get("value")])}if(v.isDefined(this.joinLayers)&&0<this.joinLayers.length){var e=[];this.rerun&&!this.joinLayer&&u.addBlankOption(this._joinLayerSelect,e);k.forEach(this.joinLayers,function(g,p){e.push({value:this._toString(p),label:g.name,
selected:g.url&&this.joinLayer&&this.joinLayer.url&&g.url===this.joinLayer.url||g&&this.joinLayer&&!g.url&&!this.joinLayer.url&&g.name===this.joinLayer.name})},this);this._joinLayerSelect.addOption(e);v.isDefined(this.joinLayer)||this.rerun||this.set("joinLayer",this.joinLayers[this._joinLayerSelect.get("value")])}u.addReadyToUseLayerOption(this,[this._targetLayerSelect,this._joinLayerSelect]);A.set(this._chooseFolderRow,"display",!0===this.showSelectFolder?"block":"none");this.showSelectFolder&&
this.getFolderStore().then(m.hitch(this,function(g){this.folderStore=g;u.setupFoldersUI({folderStore:this.folderStore,folderId:this.folderId,folderName:this.folderName,folderSelect:this._webMapFolderSelect,username:this.portalUser?this.portalUser.username:""})}));A.set(this._showCreditsLink,"display",!0===this.showCredits?"block":"none");A.set(this._chooseExtentDiv,"display",!0===this.showChooseExtent?"inline-block":"none");this._loadConnections();this.outputLayerName&&(this._outputName.set("value",
this.outputLayerName),a=!1);a=!(this.outputLayerName||this.spatialRelationship||this.temporalRelationship||this.attributeRelationship);this.joinCondition&&this._bufFieldOutput.set("value",this.joinCondition);!this.showGeoAnalyticsParams&&v.isDefined(this.joinType)?this._keepTargetFeaturesCheck.set("checked","left"===this.joinType):this.showGeoAnalyticsParams&&v.isDefined(this.keepAllTargetFeatures)&&this._keepTargetFeaturesCheck.set("checked",this.keepAllTargetFeatures);this._checkCreateView.set("checked",
this.outputType===L.FLAYERVIEW);this._updateAnalysisLayerUI(a);if(this.showRecordToKeepOption&&!this.showGeoAnalyticsParams){u.updateDisplay([this._joinOperationLabelRow],!1);this._joinOptionSelect.set("value",this.summaryFields&&0<this.summaryFields.length?"STATS":"RECORD");this._handleJoinOneToOneOptionChange(this._joinOptionSelect.get("value"));this._buildOrderByField(this.joinLayer,{priorityChange:!1});if(this.recordsToMatch&&this.recordsToMatch.orderByFields&&this.joinLayer&&this.joinLayer.fields){var l=
this.recordsToMatch.orderByFields.split(" ");var q=l[0];b=q===this.joinLayer.objectIdField;l=l[1]}this._exprRadioBtn.set("checked",!b);this._handleExprRadioChange(this._exprRadioBtn.get("checked"));!b&&q&&this._expFieldsSelect.set("value",q,!1);this._handleExpFieldChange(this._expFieldsSelect.get("value"));!b&&q&&(b=this._expFieldsSelect.getOptions(q),"number"===b.type?c="ASC"===l?"Smallest":"Largest":"date"===b.type&&(c="ASC"===l?"Oldest":"Newest"),this._expFilterSelect.set("value",c))}v.isDefined(this.temporalNearDistance)&&
this._temporalDistanceInput.set("value",this.temporalNearDistance);v.isDefined(this.temporalNearDistanceUnit)&&this._temporalUnitSelect.set("value",this.temporalNearDistanceUnit);this._createFilterAndSelections()},_handleTargetLayerChange:function(a){this._isAnalysisSelect=!0;"browse"===a||"browselayers"===a?this._createBrowseItems({browseValue:a,disabledSubResources:[this.targetLayer,this.joinLayer]},{layerTypes:[]},this._targetLayerSelect):(this.set("targetLayer",this.targetLayers[a]),this._updateAnalysisLayerUI(!0))},
_toString:function(a){return""+a},_handleJoinLayerChange:function(a){this._isAnalysisSelect=!1;"browse"===a||"browselayers"===a?this._createBrowseItems({browseValue:a,disabledSubResources:[this.joinLayer]},{layerTypes:[]},this._joinLayerSelect):(this.set("joinLayer",this.joinLayers[a]),this._updateAnalysisLayerUI(!0),this.showRecordToKeepOption&&this._buildOrderByField(this.joinLayer))},_buildOrderByField:function(a,b){a={selectWidget:this._expFieldsSelect,layer:a,allowStringType:!1,allowDateType:!this.showGeoAnalyticsParams};
v.isDefined(b)&&v.isDefined(b.priorityChange)&&(a.priorityChange=b.priorityChange);u.addAttributeOptions(a)},_handleJoinOperationChange:function(a){if(a!==this.joinOperation){this._summaryWidget.set("required",!1);this._summaryWidget.hide();var b=[this._joinRecordRow,this._joinOneOneOptionRow];this.showRecordToKeepOption&&!this.showGeoAnalyticsParams&&u.updateDisplay(b,"JoinOneToOne"===a,"table-row");"JoinOneToOne"!==a||this.showRecordToKeepOption&&!this.showGeoAnalyticsParams&&"STATS"!==this._joinOptionSelect.get("value")||
("STATS"===this._joinOptionSelect.get("value")&&this._summaryWidget.set("required",!0),this._summaryWidget.show(),u.updateDisplay([this._joinRecordRow],!0,"none"));this.showGeoAnalyticsParams&&u.updateDisplay([this._joinOperationLabelRow],"JoinOneToOne"===a,"table-row");this.joinOperation=a;this._updateCreateViewUI();this.showGeoAnalyticsParams&&this._enableKeepAllTargetFeaturesUI("JoinOneToOne"===a)}},_handleSpatialCheckChange:function(a,b){n.toggle(this._spatialJoin,"selected");this.spatialJoin=
n.contains(this._spatialJoin,"selected");v.isDefined(this.targetLayer)&&v.isDefined(this.joinLayer)&&this._repopulateSpatialTypes(this.targetLayer.geometryType,this.joinLayer.geometryType,b);this.spatialJoin||n.add(this._spatialDistanceRow,"hide");n.toggle(this._spatialRelationshipRow,"hide");n.contains(this._spatialRelationshipRow,"hide")&&this._spatialDistanceInput.set("required",!1);this._updateCreateViewUI();this._firstRecRadioBtn.set("checked",!0);this._exprRadioBtn.set("disabled",this.spatialJoin);
this._firstRecRadioBtn.set("disabled",this.spatialJoin)},_handleSpatialRelationshipChange:function(a){this.spatialRelationship=a;-1!==this._spatialDistanceOperators.indexOf(a)?(this._spatialDistanceInput.set("required",!0),n.remove(this._spatialDistanceRow,"hide")):(n.add(this._spatialDistanceRow,"hide"),this._spatialDistanceInput.set("required",!1));this._updateCreateViewUI()},_handleSpatialDistanceChange:function(a){this.spatialDistance=a},_handleSpatialUnitChange:function(a){this.spatialUnit=a},
_handleExpBtnClick:function(){this._calcField.set("expression",this._bufFieldOutput.get("value"));this._calcField.reset();this._exprDialog.show()},_repopulateSpatialTypes:function(a,b,c){this._spatialRelationshipSelect.removeOption(this._spatialRelationshipSelect.getOptions());var d={value:this.showGeoAnalyticsParams?"Equals":"identicalto",label:this.showGeoAnalyticsParams?this.i18n.equalsLabel:this.i18n.identical};var f={value:this.showGeoAnalyticsParams?"Intersects":"intersects",label:this.i18n.intersectsLabel},
e={value:this.showGeoAnalyticsParams?"Contains":"completelycontains",label:this.showGeoAnalyticsParams?this.i18n.containsLabel:this.i18n.completelyContains},l={value:this.showGeoAnalyticsParams?"Within":"completelywithin",label:this.showGeoAnalyticsParams?this.i18n.withinLabel:this.i18n.completelyWithin},q={value:"Crosses",label:this.i18n.crossesLabel},g={value:"Touches",label:this.i18n.touchesLabel},p={value:"Overlaps",label:this.i18n.overlapsLabel},r={value:this.showGeoAnalyticsParams?"Near":"withindistance",
label:this.showGeoAnalyticsParams?this.i18n.nearPlanar:this.i18n.withinDistance},h={value:"NearGeodesic",label:this.i18n.nearGeodesic};d={esriGeometryPoint:{esriGeometryPoint:this.showGeoAnalyticsParams?[d,f,e,l,r,h]:[d,f,e,l,r],esriGeometryPolyline:this.showGeoAnalyticsParams?[f,l,g,r,h]:[f,l,r],esriGeometryPolygon:this.showGeoAnalyticsParams?[f,l,g,r,h]:[f,l,r]},esriGeometryPolyline:{esriGeometryPoint:this.showGeoAnalyticsParams?[f,e,g,r,h]:[f,e,r],esriGeometryPolyline:this.showGeoAnalyticsParams?
[d,f,e,l,q,g,p,r,h]:[d,f,e,l,r],esriGeometryPolygon:this.showGeoAnalyticsParams?[f,l,q,g,r,h]:[f,l,r]},esriGeometryPolygon:{esriGeometryPoint:this.showGeoAnalyticsParams?[f,e,g,r,h]:[f,e,r],esriGeometryPolyline:this.showGeoAnalyticsParams?[f,e,q,g,r,h]:[f,e,r],esriGeometryPolygon:this.showGeoAnalyticsParams?[d,f,e,l,g,p,r,h]:[d,f,e,l,r]}};c||(this.spatialRelationship=d[a][b][0].value);k.forEach(d[a][b],function(x,C){this._spatialRelationshipSelect.addOption({value:x.value,label:x.label})},this);this._spatialRelationshipSelect.set("value",
this.spatialRelationship)},_handleTemporalCheckChange:function(a,b){n.toggle(this._temporalJoin,"selected");this.temporalJoin=n.contains(this._temporalJoin,"selected");if(v.isDefined(this.targetLayer)&&v.isDefined(this.joinLayer)){var c=u.isTimeInstantLayer(this.targetLayer)?"TimeInstant":"TimeInterval";var d=u.isTimeInstantLayer(this.joinLayer)?"TimeInstant":"TimeInterval";this._repopulateTemporalTypes(c,d,b)}a||n.add(this._temporalDistanceRow,"hide");n.toggle(this._temporalRelationshipRow,"hide");
n.contains(this._temporalRelationshipRow,"hide")&&this._temporalDistanceInput.set("required",!1)},_handleTemporalRelationshipChange:function(a){this.temporalRelationship=a;-1!==this._temporalDistanceOperators.indexOf(a)?(this._temporalDistanceInput.set("required",!0),n.remove(this._temporalDistanceRow,"hide")):(n.add(this._temporalDistanceRow,"hide"),this._temporalDistanceInput.set("required",!1))},_handleTemporalDistanceChange:function(a){this.temporalDistance=a},_handleTemporalUnitChange:function(a){this.temporalUnit=
a},_repopulateTemporalTypes:function(a,b,c){this._temporalRelationshipSelect.removeOption(this._temporalRelationshipSelect.getOptions());var d,f={value:"Equals",label:this.i18n.equalsLabel},e={value:"Intersects",label:this.i18n.intersectsLabel},l={value:"During",label:this.i18n.duringLabel},q={value:"Contains",label:this.i18n.containsLabel},g={value:"Finishes",label:this.i18n.finishesLabel},p={value:"FinishedBy",label:this.i18n.finishedByLabel},r={value:"Meets",label:this.i18n.meetsLabel},h={value:"MetBy",
label:this.i18n.metByLabel},x={value:"Near",label:this.i18n.near},C={value:"NearAfter",label:this.i18n.nearAfter},t={value:"NearBefore",label:this.i18n.nearBefore},y={value:"Overlaps",label:this.i18n.overlapsLabel},M={value:"OverlappedBy",label:this.i18n.overlappedByLabel},z={value:"Starts",label:this.i18n.startsLabel},D={value:"StartedBy",label:this.i18n.startedByLabel};a&&b&&(d={TimeInstant:{TimeInstant:[f,e,x,C,t],TimeInterval:[e,l,g,z,x,C,t]},TimeInterval:{TimeInstant:[e,q,p,D,x,C,t],TimeInterval:[f,
e,l,q,g,p,r,h,y,M,z,D,x,C,t]}});c||(this.temporalRelationship=d[a][b][0].value);k.forEach(d[a][b],function(U,ya){this._temporalRelationshipSelect.addOption({value:U.value,label:U.label})},this)},_handleAttributeCheckChange:function(a,b){n.toggle(this._attributeJoin,"selected");this.attributeJoin=n.contains(this._attributeJoin,"selected");n.toggle(this._attributeRelationshipRow,"hide");b||(!0===this.attributeJoin?this._createAttrJoinRow():this._removeAttrJoinRows())},_createAttrJoinRow:function(a){a=
B.create("tr",{style:{height:"40px"}},this._attributeRelationshipRow,"before");var b=B.create("td",{style:{width:"39%"}},a);var c=B.create("td",{style:{width:"8%"}},a);var d=B.create("td",{style:{width:"39%"}},a);var f=new R({maxHeight:200,"class":"esriLeadingMargin1 esriTrailingMargin1 mediumInput esriVeryShortlabel",style:{width:"90%",overflow:"hidden",tableLayout:"fixed"}},B.create("select",null,b));f.addOption({value:"",label:this.i18n.selectTargetField});this.targetLayer.fields.forEach(function(e,
l){e.type!==E.FieldTypes.ObjectId&&f.addOption({value:this._toString(l+1),label:e.name})},this);f.set("targetLayer",this.targetLayer);f.set("joinLayer",this.joinLayer);c.innerHTML="\x3d";A.set(c,"text-align","center");d=new R({"class":"mediumInput esriLeadingMargin05 esriVeryShortlabel",style:{width:"90%",overflow:"hidden",tableLayout:"fixed"}},B.create("select",null,d));d.addOption({value:"",label:this.i18n.selectJoinField});f.set("statisticSelect",d);J.connect(f,"onChange",this._handleAttrTargetChange);
b=B.create("td",{"class":"shortTextInput removeTd",style:{display:"none",width:"10%",paddingTop:"1em"}},a);c=B.create("a",{title:this.i18n.remove,"class":"closeIcon statsRemove",innerHTML:"\x3cimg src\x3d'"+V.toUrl("./images/close.gif")+"' border\x3d'0''/\x3e"},b);J.connect(c,"onclick",m.hitch(this,this._removeAttrJoinRow,a));this._attrJoinRows.push(a);1===this._attrJoinRows.length&&(f.set("required","true"),d.set("required","true"));a=B.create("td",{style:{width:"10%",display:"block"}},a);d.set("attributeSelect",
f);d.set("removeTd",b);d.set("stylingTd",a);d.set("isnewRowAdded",!1);d.set("referenceWidget",this);f.set("referenceWidget",this);d._watchHandle=d.watch("value",this._handleAttrJoinUpdate);this._currentJoinSelect=d;this._currentTargetSelect=f;return!0},_removeAttrJoinRow:function(a){k.forEach(Q.findWidgets(a),function(b){b.destroyRecursive()});B.destroy(a)},_removeAttrJoinRows:function(){k.forEach(this._attrJoinRows,this._removeAttrJoinRow,this);this._attrJoinRows=[]},_handleAttrTargetChange:function(a,
b,c){var d=[],f;var e=this.get("statisticSelect");if(a!==this._curTargetAttrValue){b&&c||k.forEach(e.getOptions(),function(p){""!==p.value&&e.removeOption(p)},this);if(""!==a){b&&c&&(e.removeOption(e.getOptions()),d.push({value:"",label:this.referenceWidget.i18n.selectJoinField,selected:!1}));var l=this.get("targetLayer").fields[a-1]&&this.get("targetLayer").fields[a-1].type;this.get("joinLayer").fields.forEach(function(p,r){p.type!==E.FieldTypes.ObjectId&&(this.referenceWidget.showGeoAnalyticsParams&&
p.type===l||this.referenceWidget.allowAllAttributesTypes)&&(b&&c&&c.joinField===p.name&&(f=r+1+""),d.push({value:r+1+"",label:p.name,selected:b&&c&&c.joinField===p.name}))},this);e._watchHandle&&b&&c&&e._watchHandle.unwatch();e.addOption(d);e.set("value",f);if(""!==e.get("value")&&!e.get("isnewRowAdded")){var q=e.get("removeTd");var g=e.get("stylingTd");A.set(q,"display","block");A.set(g,"display","none");q=e.get("referenceWidget");m.hitch(q,q._createAttrJoinRow)();e.set("isnewRowAdded",!0)}}this._curTargetAttrValue=
a}},_handleAttrJoinUpdate:function(a,b,c){this.get("attributeSelect")&&""!==this.get("attributeSelect").get("value")&&""!==c&&!this.get("isnewRowAdded")&&(a=this.get("removeTd"),A.set(a,"display","block"),a=this.get("referenceWidget"),m.hitch(a,a._createAttrJoinRow)(),this.set("isnewRowAdded",!0))},addExpOperators:function(a){var b=a.selectWidget,c=[{value:"Largest",label:this.i18n.largest},{value:"Smallest",label:this.i18n.smallest}],d=[{value:"Newest",label:this.i18n.newest},{value:"Oldest",label:this.i18n.oldest}],
f=v.isDefined(a.emptyValue)?a.emptyValue:"";b.removeOption(b.getOptions());b.addOption([{value:f,label:this.i18n.sortBy}]);a.type&&"number"===a.type?b.addOption(c):a.type&&"date"===a.type&&b.addOption(d);b.set("value",f)},_handleShowCreditsClick:function(a){var b={};a.preventDefault();this._form.validate()&&(b=this._buildJobParams(),this.getCreditsEstimate(this.toolName,b).then(m.hitch(this,function(c){b.outputType===L.FLAYERVIEW&&(c.cost=0,c.infoMessage=this.i18n.zeroCreditsViewResult);this._usageForm.set("content",
c);this._usageDialog.show()})))},_canCreateView:function(a){var b=!1,c=new G;b=!!a&&!!this.joinLayer&&!!this.targetLayer&&!!this.joinLayer.url&&!!this.targetLayer.url&&this._isOwner(this.joinLayer,a)&&this._isOwner(this.targetLayer,a)&&!this._isMultiServiceViewLayer(this.targetLayer)&&!this._isMultiServiceViewLayer(this.joinLayer)&&!this.spatialJoin;!0===this.isSingleTenant&&!0===b?P([this._isSpatioTemporalLayer(this.joinLayer),this._isSpatioTemporalLayer(this.targetLayer)]).then(m.hitch(this,function(d){b=
b&&!(!0===d[0]||!0===d[1]);c.resolve(b)}),function(){c.resolve(b)}):c.resolve(b);return c.promise},_isSpatioTemporalLayer:function(a){var b=new G,c=!1;a.url?this._getAdminLayerInfo(a.url).then(function(d){c=!!d.sqlParserVersion&&-1!==d.sqlParserVersion.indexOf("ES_");b.resolve(c)},function(){b.resolve(c)}):b.resolve(c);return b.promise},_isMultiServiceViewLayer:function(a){var b=!1;a._json&&(a=w.fromJson(a._json),b=a.isMultiServicesView);return b},_isOwner:function(a,b){return this.isOwner(a,b)&&
(!1===this.isSingleTenant&&a.url?-1!==a.url.indexOf(b.orgId):!0)},_enableCreateViewUI:function(a){!a&&this._checkCreateView.get("checked")&&this._checkCreateView.set("checked",a);this._checkCreateView.set("disabled",!a)},_handleCreateViewChange:function(a){this._useExtentCheck.get("checked")&&a&&this._useExtentCheck.set("checked",!a)},_enableKeepAllTargetFeaturesUI:function(a){!a&&this._keepTargetFeaturesCheck.get("checked")&&this._keepTargetFeaturesCheck.set("checked",a);this._keepTargetFeaturesCheck.set("disabled",
!a)},_handleExtentChange:function(a){this._checkCreateView.get("checked")&&a&&this._checkCreateView.set("checked",!a)},_handleJoinOneToOneOptionChange:function(a){u.updateDisplay([this._joinRecordRow],"RECORD"===a);u.updateDisplay([this._joinOneOneOptionsHelpTd],"STATS"===a,"table-cell");this._summaryWidget.set("required",!1);this._summaryWidget.hide();"STATS"===a&&(this._summaryWidget.set("required",!0),this._summaryWidget.show());this._handleExprRadioChange(this._exprRadioBtn.get("checked"))},_handleExprRadioChange:function(a){this._expFieldsSelect.set("disabled",
!a);this._expFilterSelect.set("disabled",!a);this._expFieldsSelect.set("required","RECORD"===this._joinOptionSelect.get("value")&&a);this._expFilterSelect.set("required","RECORD"===this._joinOptionSelect.get("value")&&a)},_handleExpFieldChange:function(a){a=this._expFieldsSelect.getOptions(a);this.addExpOperators({selectWidget:this._expFilterSelect,type:a&&a.type,showGeoAnalyticsParams:this.showGeoAnalyticsParams})},_getSourceLayerFields:function(a){a=k.filter(a,function(b){return b.type!==E.FieldTypes.ObjectId});
return k.map(a,function(b){var c={name:b.name,alias:b.alias,source:b.source?b.source:b.name};b.statisticType&&(c.statisticType=b.statisticType,c.statisticType=c.statisticType.toLowerCase(),"mean"===c.statisticType&&(c.statisticType="avg"));return c})},_getSourceServiceName:function(a){a=a.substring(a.indexOf("/services/")+10,a.indexOf("/FeatureServer/"));!0===this.isSingleTenant&&(a=a.replace("Hosted/",""));return a},_getLogicalTableName:function(a){return a+"_"+(new Date).getTime()},_arrIntersections:function(a,
b,c){return k.filter(a,function(d){if(c){var f=b.map(function(e){return e[c]});return-1!==k.indexOf(f,d[c])}return-1!==k.indexOf(b,d)})},_updateSameFieldsInRelTable:function(a,b){a=this._arrIntersections(a,b,"name");var c=k.map(a,function(d){return d.name});0<a.length&&k.forEach(b,function(d){-1!==k.indexOf(c,d.name)&&(d.name=this._getLogicalTableName(d.name))},this)},_createIntermediateTableView:function(a){var b=new G,c={layers:[{name:"",description:"tablestatsjoin",adminLayerInfo:{viewLayerDefinition:{table:{materialized:!1}}}}]},
d=a.jobParams;a=a.resultService;var f=this._getSourceServiceName(this.joinLayer.url),e=[],l=[];var q=c.layers[0].adminLayerInfo.viewLayerDefinition.table;q.name=this._getLogicalTableName(f)+"_StatsTable";c.layers[0].name=f+"_StatsTable";var g=w.fromJson(d.joinLayer);q.sourceServiceName=f;q.sourceLayerId=this.joinLayer.layerId;g.filter&&(q.filter={sqlExpression:g.filter});k.forEach(d.attributeRelationship,function(h){h=w.fromJson(h);e.push(h.targetField);l.push(h.joinField)},this);var p=k.filter(this.joinLayer.fields,
function(h){return-1!==k.indexOf(l,h.name)});if(d.summaryFields){var r=!1;k.forEach(d.summaryFields,function(h){var x=w.fromJson(h);h=this.joinLayer.fields.findIndex(m.hitch(this,function(C){return C.name===x.onStatisticField}));h=m.mixin({},this.joinLayer.fields[h],{statisticType:x.statisticType.toLowerCase()});r||(p.push({name:"join_count",alias:"join_count",statisticType:"count",source:"esriFieldTypeDate"===h.type?l[0]+"":h.name+""}),r=!0);h.source=h.name+"";-1!==["SHAPE__Area","SHAPE__Length"].indexOf(h.name)&&
(h.name=h.name.toLowerCase());h.name=h.name+"_"+h.statisticType;h.alias=h.alias+"_"+h.statisticType;p.push(h)},this)}q.sourceLayerFields=this._getSourceLayerFields(p);q.groupBy=l.join();this._addToDefinition(a.url,c).then(m.hitch(this,function(h){b.resolve({interTableViewParams:c,response:h})}),m.hitch(this,function(h){b.reject(h)}));return b.promise},getViewParams:function(a){var b=new G,c=a.jobParams,d=a.resultService,f;P([this._getAdminLayerInfo(this.targetLayer.url),this._getAdminLayerInfo(this.joinLayer.url)]).then(m.hitch(this,
function(e){var l=m.clone(ma.joinFeatures),q=[],g=[];var p=e[0].adminLayerInfo;e=e[1].adminLayerInfo;var r=this._getSourceServiceName(this.targetLayer.url),h=this._getSourceServiceName(this.joinLayer.url);f=w.fromJson(c[this.outputName]);var x=w.fromJson(c.targetLayer);var C=w.fromJson(c.joinLayer);l.layers[0].name=f.serviceProperties?f.serviceProperties.name:this._outputName.get("value");var t=l.layers[0].adminLayerInfo.viewLayerDefinition.table;t.name=this._getLogicalTableName(r)+"_target";t.sourceServiceName=
r;t.sourceLayerId=this.targetLayer.layerId;t.sourceLayerFields=this._getSourceLayerFields(this.targetLayer.fields);x.filter&&(t.filter={sqlExpression:x.filter});p.geometryField&&p.geometryField.name?l.layers[0].adminLayerInfo.geometryField.name=t.name+"."+p.geometryField.name:l.layers[0].adminLayerInfo.geometryField=null;t.relatedTables[0].type="INNER";"left"===c.joinType&&(t.relatedTables[0].type="LEFT");if("JoinOneToOne"===c.joinOperation&&c.summaryFields&&0<c.summaryFields.length)this._createIntermediateTableView({viewParams:l,
targetALinfo:p,joinALinfo:e,jobParams:c,resultService:d}).then(m.hitch(this,function(y){y=y.interTableViewParams.layers[0];t.relatedTables[0].name=y.name;t.relatedTables[0].sourceServiceName=l.layers[0].name;t.relatedTables[0].sourceLayerId=0;var M=k.map(t.sourceLayerFields,function(z){return z.name});t.relatedTables[0].sourceLayerFields=y.adminLayerInfo.viewLayerDefinition.table.sourceLayerFields.reduce(function(z,D){-1===k.indexOf(M,D.name)&&z.push({name:D.name,alias:D.alias,source:D.name});return z},
[]);k.forEach(c.attributeRelationship,function(z){z=w.fromJson(z);q.push(z.targetField);g.push(z.joinField)},this);t.relatedTables[0].parentKeyFields=q;t.relatedTables[0].keyFields=g;b.resolve(l)}),m.hitch(this,function(y){b.reject(y)}));else{t.relatedTables[0].name=this._getLogicalTableName(h)+"_join";t.relatedTables[0].sourceServiceName=h;t.relatedTables[0].sourceLayerId=this.joinLayer.layerId;C.filter&&(t.relatedTables[0].filter={sqlExpression:C.filter});if("JoinOneToMany"===c.joinOperation||"JoinOneToOne"===
c.joinOperation&&!c.summaryFields)t.relatedTables[0].sourceLayerFields=this._getSourceLayerFields(this.joinLayer.fields),this._updateSameFieldsInRelTable(t.sourceLayerFields,t.relatedTables[0].sourceLayerFields);c.spatialRelationship?(t.relatedTables[0].parentKeyFields=[p.geometryField.name],t.relatedTables[0].keyFields=[e.geometryField.name],t.relatedTables[0].operator="completelycontains"===c.spatialRelationship?"esriSpatialRelContains":"intersects"===c.spatialRelationship?"esriSpatialRelIntersects":
"esriSpatialRelWithin"):(p=c.attributeRelationship,k.forEach(p,function(y){y=w.fromJson(y);q.push(y.targetField);g.push(y.joinField)},this),t.relatedTables[0].parentKeyFields=q,t.relatedTables[0].keyFields=g,"JoinOneToOne"===c.joinOperation&&this.showRecordToKeepOption&&!c.summaryFields&&(t.relatedTables[0].topFilter=this._getTopFilter(g)));b.resolve(l)}}),m.hitch(this,function(e){b.reject(e)}));return b.promise},_getTopFilter:function(a){var b={};a||(a=[]);return b=this._exprRadioBtn.get("checked")?
{groupByFields:a.join(","),orderByFields:this._getOrderByFields(),topCount:1}:{groupByFields:a.join(","),orderByFields:this.joinLayer.objectIdField+" ASC",topCount:1}},_getOrderByFields:function(){var a="",b=this._expFilterSelect.get("value");this._exprRadioBtn.get("checked")&&(a=this._expFieldsSelect.get("value"),a="Largest"===b||"Newest"===b?a+" DESC":a+" ASC");return a},_buildJobParams:function(){var a={};a.targetLayer=this.constructAnalysisInputLyrObj(this.targetLayer);this.doRefreshItem="table"!==
this.targetLayer.type.toLowerCase();a.joinLayer=this.constructAnalysisInputLyrObj(this.joinLayer);this.showGeoAnalyticsParams||(a.targetLayer=w.toJson(a.targetLayer),a.joinLayer=w.toJson(a.joinLayer));a.joinOperation=this.get("joinOperation");this._bufFieldOutput.get("value")&&(a.joinCondition=this._bufFieldOutput.get("value"));this.spatialJoin&&(a.spatialRelationship=this._spatialRelationshipSelect.get("value"),-1!==this._spatialDistanceOperators.indexOf(a.spatialRelationship)&&(this.showGeoAnalyticsParams?
(a.spatialNearDistance=parseFloat(this.get("spatialDistance")),a.spatialNearDistanceUnit=this._spatialUnitSelect.get("value")):(a.spatialRelationshipDistance=parseFloat(this.get("spatialDistance")),a.spatialRelationshipDistanceUnits=this._spatialUnitSelect.get("value"))));this.temporalJoin&&(a.temporalRelationship=this._temporalRelationshipSelect.get("value"),-1!==this._temporalDistanceOperators.indexOf(a.temporalRelationship)&&(a.temporalNearDistance=parseFloat(this.get("temporalDistance")),a.temporalNearDistanceUnit=
this._temporalUnitSelect.get("value")));if(this.attributeJoin){var b=[],c=0;k.forEach(this._attrJoinRows,function(f,e,l){var q={},g=0,p="";k.forEach(f.children,function(r,h){if(3>h){if(1!==h)var x=Q.byNode(r.children[0]).get("value");0===h&&""!==x&&(g++,p=this.targetLayer.fields[parseInt(x,10)-1].type,q.targetField=r.textContent);1===h&&(g++,q.operator="\x3d"===r.textContent?this._getEqualParamValue(p):r.textContent);2===h&&""!==x&&(g++,q.joinField=r.textContent)}},this);3===g&&(b.push(this.showGeoAnalyticsParams?
q:w.toJson(q)),c++)},this);a.attributeRelationship=this.showGeoAnalyticsParams?w.toJson(b):b}if("JoinOneToOne"===this._joinOperation.get("value")){var d=this._summaryWidget.get("summaryFields");0<d.length?a.summaryFields=this.showGeoAnalyticsParams?w.toJson(d):d:this.showRecordToKeepOption&&!this.spatialJoin&&"RECORD"===this._joinOptionSelect.get("value")&&(a.recordsToMatch=w.toJson(this._getTopFilter()))}this.showGeoAnalyticsParams?a.keepAllTargetFeatures=this._keepTargetFeaturesCheck.get("checked"):
a.joinType=this._keepTargetFeaturesCheck.get("checked")?"left":"inner";this.showChooseExtent&&this._useExtentCheck.get("checked")&&(a.context=w.toJson({extent:this.map.extent._normalize(!0)}));a.OutputName=w.toJson({serviceProperties:{name:this._outputName.get("value")}});!this.showGeoAnalyticsParams&&this._checkCreateView.get("checked")&&(a.outputType=L.FLAYERVIEW);return this._updateJobFilterAndSelection(a)},_getEqualParamValue:function(a){return this.showGeoAnalyticsParams&&a===E.FieldTypes.String?
"equalIgnoreCaseTrimWhitespace":"equal"},_handleSaveBtnClick:function(){var a={},b={};this._summaryWidget.updateRequiredAttributes();if(this._form.validate())if("_NOVALUE_"===this._joinLayerSelect.get("value"))this._showMessages(this.i18n.joinLayerErrorMsg);else if("_NOVALUE_"===this._joinOperation.get("value"))this._showMessages(this.i18n.joinOpErrorMsg);else if(this.attributeJoin||this.temporalJoin||this.spatialJoin){this._handleCloseMsg();this._saveBtn.set("disabled",!0);a=this._buildJobParams();
b.jobParams=a;b.itemParams={description:this.i18n.itemDescription,tags:this.i18n.itemTags,snippet:this.i18n.itemSnippet};this.showSelectFolder&&(b.itemParams.folder=this.get("folderId"));if(this.showGeoAnalyticsParams){a=u.checkPCSforAnalysis({widget:this,jobParams:a});if(!a)return;b.isSpatioTemporalDataStore=!0}this.resultParameter=this.showGeoAnalyticsParams?"output":"outputLayer";this.execute(b)}else this._showMessages(this.i18n.joinTypesErrorMsg)},_isMultiPointLayer:function(a){return!!a&&a.geometryType===
E.GeometryTypes.MultiPoint},_filterMultiPoints:function(a){return a.filter(function(b){return!1===this._isMultiPointLayer(b)},this)},_setDisableRunAnalysisAttr:function(a){this._saveBtn.set("disabled",a)},_setTargetLayerAttr:function(a){this.showGeoAnalyticsParams&&a&&this._isMultiPointLayer(a)&&(a=null);this._set("targetLayer",a||null)},_setTargetLayersAttr:function(a){this.showGeoAnalyticsParams&&(a=this._filterMultiPoints(a));this._set("targetLayers",a||[])},_setJoinLayerAttr:function(a){this.showGeoAnalyticsParams&&
a&&this._isMultiPointLayer(a)&&(a=null);this._set("joinLayer",a||null)},_setShowSpatialJoinAttr:function(a){this._set("showSpatialJoin",a)},_setShowAttributeJoinAttr:function(a){this._set("showAttributeJoin",a)},_setShowTemporalJoinAttr:function(a){this._set("showTemporalJoin",a)},_setShowJoinConditionAttr:function(a){this._set("showJoinCondition",a)},_setJoinLayersAttr:function(a){this.showGeoAnalyticsParams&&(a=this._filterMultiPoints(a));this._set("joinLayers",a||[])},_handleBrowseItemsSelect:function(a,
b){a&&a.selection&&u.addAnalysisReadyLayer({item:a.selection,layers:this._isAnalysisSelect?this.targetLayers:this.joinLayers,layersSelect:this._isAnalysisSelect?this._targetLayerSelect:this._joinLayerSelect,posIncrement:0,browseDialog:a.dialog||this._browsedlg,widget:this},b)},_save:function(){},_onClose:function(a){a&&(this._save(),this.emit("save",{save:!0}));this.emit("close",{save:a})},_loadConnections:function(){this.on("start",m.hitch(this,"_onClose",!0));this._connect(this._closeBtn,"onclick",
m.hitch(this,"_onClose",!1));this._spatialJoinHandle=K.pausable(this._spatialJoinCtr,"click",m.hitch(this,this._handleSpatialCheckChange));this._temporalJoinHandle=K.pausable(this._temporalJoinCtr,"click",m.hitch(this,this._handleTemporalCheckChange));this._attributeJoinHandle=K.pausable(this._attributeJoinCtr,"click",m.hitch(this,this._handleAttributeCheckChange));this.own(this._spatialJoinHandle,this._temporalJoinHandle,this._attributeJoinHandle)},_connect:function(a,b,c){this._pbConnects.push(J.connect(a,
b,c))},_updateAnalysisLayerUI:function(a){this._expBtn.set("disabled",!this.targetLayer);this._bufFieldOutput.set("disabled",!this.targetLayer);if(this.targetLayer){var b=this._joinLayerSelect.getOptions(),c=!1;c=!1;a&&(this.outputLayerName=Z.substitute(this.i18n.outputLayerName,{targetLayerName:this.targetLayer.name}),this._outputName.set("value",this.outputLayerName));this._isAnalysisSelect&&(c=k.some(b,function(f,e){return f.label===this.targetLayer.title},this),c||(c=this.showBrowseLayers&&this.showReadyToUseLayers?
3:!this.showBrowseLayers&&this.showReadyToUseLayers?2:this.showBrowseLayers&&!this.showReadyToUseLayers?2:0,b=b.splice(b.length-c,c),c=k.some(this.joinLayers,function(f){return f&&f.analysisReady&&this.targetLayer.analysisReady&&f.itemId===this.targetLayer.itemId},this),c||(this.joinLayers.push(this.targetLayer),1===this.joinLayers.length&&this._handleJoinLayerChange(0)),b.unshift({value:this.joinLayers.length-1,label:this.targetLayer.title}),this._joinLayerSelect.addOption(b),1===this.joinLayers.length&&
this._joinLayerSelect.set("value",0)));b={};var d=k.map(this.targetLayer.fields,function(f){var e=m.clone(f);m.mixin(e,{name:'target["'+f.name+'"]',alias:'target["'+f.alias+'"]'});return e},this);c=k.map(this.joinLayer.fields,function(f){var e=m.clone(f);m.mixin(e,{name:'join["'+f.name+'"]',alias:'join["'+f.alias+'"]'});return e},this);b.fields=[].concat(c,d);if(this.showJoinCondition)if(c=[],c.push(this.makeArcadeProfile(this.joinLayer,"$join")),c.push(this.makeArcadeProfile(this.targetLayer,"$target")),
this._calcField)this._calcField&&this._calcField.layer!==this.inputLayer&&(this._bufFieldOutput.set("value",""),this._calcField.reset(),this._calcField.set("arcadeProfile",c),this._calcField.set("layer",b));else{d=u.getExprFunctions();d=k.filter(d,function(f){return f&&f.name&&-1===f.name.indexOf("as_")});this._calcField=new H({expressionMode:H.MODE_ARCADE,arcadeEditor:this.arcadeEditor,map:this.map,layer:b,field:this.i18n.bufField,baseClass:"esriBufFieldExp",helperMethods:d,showHelp:!0,helpUrl:u.getHelpUrl({widget:this,
topic:"BufferExpression"}),css:{base:"esriBufFieldExp",addButton:"btn calcite primary",closeButton:"btn calcite cancel"},helperType:"numeric",showHeader:!1,arcadeProfile:c,calculateLabel:this.i18n.add,expression:this._bufFieldOutput.get("value")},this._expressionCtr);this._calcField.startup();if(this._calcField.expressionMode===H.MODE_SQL)A.set(this._calcField._validateBtn.domNode,"display","none"),this._calcField._handleHelperTypeChange("value",null,{functionType:"NumType"}),this._aspectHandle=W.around(this._calcField,
"_handleAddButtonClick",m.hitch(this,function(f){return m.hitch(this,function(e,l){e=this._calcField.get("expression")[0];this._bufFieldOutput.set("value",e.sqlExpression);this._exprDialog.hide()})}));else if(this._calcField.expressionMode===H.MODE_ARCADE)this._calcField.on("expression-add",m.hitch(this,function(f){this._bufFieldOutput.set("value",f.expression)}));this._calcField.on("close",m.hitch(this,function(){this._exprDialog.hide()}))}}v.isDefined(this.joinLayer)&&this._summaryWidget.set("layer",
this.joinLayer);a?(this.temporalJoin=this.attributeJoin=this.spatialJoin=!1,this._summaryWidget.hide(),this._removeAttrJoinRows(),n.contains(this._spatialJoin,"selected")&&(n.remove(this._spatialJoin,"selected"),n.add(this._spatialDistanceRow,"hide"),n.add(this._spatialRelationshipRow,"hide"),this._spatialRelationshipSelect.reset(),this._spatialDistanceInput.set("required",!1)),n.contains(this._temporalJoin,"selected")&&(n.remove(this._temporalJoin,"selected"),n.add(this._temporalRelationshipRow,
"hide"),n.add(this._temporalDistanceRow,"hide"),this._temporalDistanceInput.set("required",!1)),n.contains(this._attributeJoin,"selected")&&(n.remove(this._attributeJoin,"selected"),n.add(this._attributeRelationshipRow,"hide")),v.isDefined(this.targetLayer)&&v.isDefined(this.joinLayer)&&"_NOVALUE_"!==this._joinLayerSelect.get("value")?("JoinOneToOne"!==this._joinOperation.get("value")||this.showRecordToKeepOption&&!this.showGeoAnalyticsParams&&"STATS"!==this._joinOptionSelect.get("value")||this._summaryWidget.show(),
n.remove(this._spatialJoin,"disabled"),n.remove(this._attributeJoin,"disabled"),n.remove(this._spatialJoinLabel,"esriAnalysisTextDisabled"),n.remove(this._attrJoinLabel,"esriAnalysisTextDisabled"),this._spatialJoinHandle.resume()):(n.add(this._spatialJoin,"disabled"),n.add(this._attributeJoin,"disabled"),n.add(this._temporalJoin,"disabled"),n.add(this._spatialJoinLabel,"esriAnalysisTextDisabled"),n.add(this._attrJoinLabel,"esriAnalysisTextDisabled"),n.add(this._temporalJoinLabel,"esriAnalysisTextDisabled"),
this._attributeJoinHandle.pause(),this._spatialJoinHandle.pause(),this._temporalJoinHandle.pause())):(this.spatialRelationship&&(this.spatialJoin=!0,this._spatialRelationshipSelect.set("value",this.spatialRelationship),this._handleSpatialCheckChange(this.spatialJoin,!a),this.spatialDistance&&this._spatialDistanceInput.set("value",this.spatialDistance)),this.attributeRelationship&&(this.attributeJoin=!0,this._handleAttributeCheckChange(this.attributeJoin,!a),this.attributeRelationship&&this.targetLayer&&
this.joinLayer&&(this._isAttrAdded=!1,this._createAttrJoinRow(this.attributeRelationship),this.attributeRelationship&&!this.attributeRelationship.length&&(this.attributeRelationship=[this.attributeRelationship]),k.forEach(this.attributeRelationship,function(f){var e=k.map(this.targetLayer.fields,function(l){return l.name});e=k.indexOf(e,f.targetField);this._currentTargetSelect.set("value",e+1+"");m.hitch(this._currentTargetSelect,this._handleAttrTargetChange,this._currentTargetSelect.get("value"),
!a,f)()},this),this._isAttrAdded=!0)),this.temporalRelationship&&(this.temporalJoin=!0,this._handleTemporalCheckChange(this.temporalJoin,!a),this._temporalRelationshipSelect.set("value",this.temporalRelationship)),this.summaryFields&&this._summaryWidget.set("summaryFields",this.summaryFields));v.isDefined(this.targetLayer)&&v.isDefined(this.joinLayer)&&"_NOVALUE_"!==this._joinLayerSelect.get("value")&&(b=!(u.isTimeEnabled(this.joinLayer)&&u.isTimeEnabled(this.targetLayer)),n.toggle(this._temporalJoin,
"disabled",b),n.toggle(this._temporalJoinLabel,"esriAnalysisTextDisabled",b),this._attributeJoinHandle.resume(),b?this._temporalJoinHandle.pause():this._temporalJoinHandle.resume());v.isDefined(this.targetLayer)&&v.isDefined(this.joinLayer)&&(this.targetLayer.type&&"table"===this.targetLayer.type.toLowerCase()||this.joinLayer.type&&"table"===this.joinLayer.type.toLowerCase())&&(n.add(this._spatialJoin,"disabled"),n.add(this._spatialJoinLabel,"esriAnalysisTextDisabled"),this._spatialJoinHandle.pause());
this._updateCreateViewUI()},_updateCreateViewUI:function(){this.getUserProfile().then(m.hitch(this,function(a){this.spatialRelationship=this._spatialRelationshipSelect.get("value");this._canCreateView(a).always(m.hitch(this,function(b){this._enableCreateViewUI(b)}))}))},_setAttributeRelationshipAttr:function(a){var b=[];if(a&&"string"===typeof a){var c=a.split(" and ");k.forEach(c,function(d){d=d.split(" \x3d ");b.push({targetField:-1!==d[0].indexOf('["')?d[0].substring(d[0].indexOf('["')+2,d[0].indexOf('"]')):
d[0],operator:"equal",joinField:-1!==d[1].indexOf('["')?d[1].substring(d[1].indexOf('["')+2,d[1].indexOf('"]')):d[1]})});a=b}k.forEach(a,function(d,f){"string"===typeof d&&-1!==d.indexOf("{")&&(a[f]=u.tryParseJSON(d))},this);this.attributeRelationship=a},_setAnalysisGpServerAttr:function(a){a&&(this.analysisGpServer=a,this.set("toolServiceUrl",this.analysisGpServer+"/"+this.toolName))},validateServiceName:function(a){return u.validateServiceName(a,{textInput:this._outputName})},_showMessages:function(a){F.set(this._bodyNode,
"innerHTML",a);N.fadeIn({node:this._errorMessagePane,easing:O.quadIn,onEnd:m.hitch(this,function(){A.set(this._errorMessagePane,{display:""})})}).play()},_handleCloseMsg:function(a){a&&a.preventDefault();N.fadeOut({node:this._errorMessagePane,easing:O.quadOut,onEnd:m.hitch(this,function(){A.set(this._errorMessagePane,{display:"none"})})}).play()},makeArcadeProfile:function(a,b){if(a){var c=a.fields,d={layer:a,popupInfo:a.infoTemplate?a.infoTemplate.toJson():null};b={type:"Feature",value:{attributes:null,
geometry:null,layer:{fields:k.map(c,function(e){e.domain&&-1<k.indexOf(["range","codedValue"],e.domain.type)&&(e=m.clone(e),e.domain=e.domain.toJson?e.domain.toJson():e.domain);return e}),objectIdField:a.objectIdField,typeIdField:a.typeIdField,types:a.types?k.map(a.types,function(e){return e.toJson?e.toJson():e}):null,templates:a.templates}},id:v.isDefined(b)?b:"$feature"};if(d._queryResponse&&d._queryResponse.features&&d._queryResponse.features.length)b.value.attributes=m.clone(d._queryResponse.features[0].attributes),
b.value.geometry=d._queryResponse.features[0].geometry;else if(d._queryResponse&&d._queryResponse[a.url]&&d._queryResponse[a.url].features&&d._queryResponse[a.url].features.length)b.value.attributes=m.clone(d._queryResponse[a.url].features[0].attributes),b.value.geometry=d._queryResponse[a.url].features[0].geometry;else if(a.graphics&&a.graphics.length&&a.geometryType)b.value.attributes=m.clone(a.graphics[0].attributes),b.value.geometry=a.graphics[0].geometry.toJson();else{var f={};k.forEach(c,function(e){-1<
k.indexOf("esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeString esriFieldTypeDate esriFieldTypeOID esriFieldTypeGlobalID".split(" "),e.type)?!1===e.nullable?e.defaultValue?f[e.name]=e.defaultValue:-1<k.indexOf(["esriFieldTypeString"],e.type)?f[e.name]="":f[e.name]=0:f[e.name]=null:f[e.name]=null});b.value.attributes=f;c=this.map.extent;"esriGeometryPolygon"==a.geometryType||a.getCustomRasterFields?(b.value.geometry=new la(new S(this.map.spatialReference.toJson())),
b.value.geometry.addRing([[c.xmin,c.ymin],[c.xmax,c.ymin],[c.xmax,c.ymax],[c.xmin,c.ymax],[c.xmin,c.ymin]])):"esriGeometryPoint"==a.geometryType||a.geometryType==E.GeometryTypes.MultiPoint?b.value.geometry=new ja(c.getCenter().toJson()):"esriGeometryPolyline"==a.geometryType&&(b.value.geometry=new ka(new S(this.map.spatialReference.toJson())),b.value.geometry.addPath([[c.xmin,c.ymin],[c.xmax,c.ymax]]))}return b}}});Y("extend-esri")&&m.setObject("dijit.analysis.JoinFeatures",I,fa);return I});