// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/dijit/analysis/tree","dojo/_base/declare dojo/_base/array dojo/_base/Deferred dojo/_base/lang dojo/query dojo/on dojo/has dojo/aspect dgrid/util/has-css3 dgrid/Grid dojo/has!touch?dgrid/util/touch put-selector/put ../../kernel".split(" "),function(N,G,H,I,A,J,K,t,B,L,C,l,M){function D(d,u,m,h){h=this.grid.isRTL?"right":"left";var b=".dgrid-expando-icon";u&&(b+=".ui-icon.ui-icon-triangle-1-"+(m?"se":"e"));d=l("div"+b+"[style\x3dmargin-"+h+": "+d*(this.indentWidth||9)+"px; float: "+h+"]");
d.innerHTML="\x26nbsp;";return d}function E(d){var u=this,m=this.style.height;m&&(this.style.display="0px"==m?"none":"block");d&&(l(this,".dgrid-tree-resetting"),setTimeout(function(){l(u,"!dgrid-tree-resetting")}));this.style.height=""}function y(d){var u=d.renderCell||L.defaultRenderCell,m,h;d||(d={});d.shouldExpand=d.shouldExpand||function(b,q,e){return e};t.after(d,"init",function(){var b=d.grid,q=".dgrid-content .dgrid-column-"+d.id,e=[];b.cleanEmptyObservers=!1;if(!b.store)throw Error("dgrid tree column plugin requires a store to operate.");
d.renderExpando||(d.renderExpando=D);e.push(b.on(d.expandOn||".dgrid-expando-icon:click,"+q+":dblclick,"+q+":keydown",function(a){var c=b.row(a);b.store.mayHaveChildren&&!b.store.mayHaveChildren(c.data)||"keydown"==a.type&&32!=a.keyCode||"dblclick"==a.type&&h&&1<h.count&&c.id==h.id&&-1<a.target.className.indexOf("dgrid-expando-icon")||b.expand(c);-1<a.target.className.indexOf("dgrid-expando-icon")&&(h&&h.id==b.row(a).id?h.count++:h={id:b.row(a).id,count:1})}));B("touch")&&e.push(b.on(C.selector(q,
C.dbltap),function(){b.expand(this)}));b._expanded||(b._expanded={});e.push(t.after(b,"insertRow",function(a){var c=this.row(a);d.shouldExpand(c,m,this._expanded[c.id])&&this.expand(a,!0,!0);return a}));e.push(t.before(b,"removeRow",function(a,c){if(a=a.connected)A("\x3e.dgrid-row",a).forEach(function(k){b.removeRow(k,!0)}),c||l(a,"!")}));d.collapseOnRefresh&&e.push(t.after(b,"cleanup",function(){this._expanded={}}));b._calcRowHeight=function(a){var c=a.connected;return a.offsetHeight+(c?c.offsetHeight:
0)};b.expand=function(a,c,k){var f=a.element?a:b.row(a),n=B("transitionend");a=f.element;if((a=-1<a.className.indexOf("dgrid-expando-icon")?a:A(".dgrid-expando-icon",a)[0])&&a.mayHaveChildren&&(k||c!==!!this._expanded[f.id])){var p=void 0===c?!this._expanded[f.id]:c;l(a,".ui-icon-triangle-1-"+(p?"se":"e")+"!ui-icon-triangle-1-"+(p?"e":"se"));var w=a.preloadNode;c=f.element;var z={originalQuery:this.query};if(!w){var g=c.connected=l("div.dgrid-tree-container");w=a.preloadNode=l(c,"+",g,"div.dgrid-preload");
var v=function(x){return b.store.getChildren(f.data,x)};d.allowDuplicates&&(z.parentId=f.id);"level"in a&&(v.level=a.level);H.when(b.renderQuery?b._trackError(function(){return b.renderQuery(v,w,z)}):b.renderArray(v(z),w,"level"in v?{queryLevel:v.level}:{}),function(){if(b._expanded[f.id]&&n){var x=g.scrollHeight;g.style.height=x?x+"px":"auto"}});n?J(g,n,E):E.call(g)}g=c.connected;g.hidden=!p;var r=g.style;if(!n||k)r.display=p?"block":"none",r.height="";else{if(p){r.display="block";var F=g.scrollHeight;
r.height="0px"}else l(g,".dgrid-tree-resetting"),r.height=g.scrollHeight+"px";setTimeout(function(){l(g,"!dgrid-tree-resetting");r.height=p?F?F+"px":"auto":"0px"})}p?this._expanded[f.id]=!0:delete this._expanded[f.id]}};t.after(d,"destroy",function(){G.forEach(e,function(a){a.remove()});delete b.expand;delete b._calcRowHeight})});d.renderCell=function(b,q,e,a){var c=d.grid,k=Number(a&&a.queryLevel)+1,f=!c.store.mayHaveChildren||c.store.mayHaveChildren(b),n=a.parentId;k=m=isNaN(k)?0:k;c=d.renderExpando(k,
f,c._expanded[(n?n+"-":"")+c.store.getIdentity(b)],b);c.level=k;c.mayHaveChildren=f;a.level=k;u.call(d,b,q,e,a);e.insertBefore(c,e.firstChild)};return d}y.defaultRenderExpando=D;K("extend-esri")&&I.setObject("dijit.analysis.tree",y,M);return y});