// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/analysis/templates/ExpressionGrid.html":'\x3cdiv class\x3d"esriAnalysisExpressionGrid"\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit.layout.ContentPane" style\x3d"padding:1px;width:100%;height:200px;"  data-dojo-attach-point\x3d"_gridPane"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_gridDiv" style\x3d"height:90%"\x3e\x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_textDiv" style\x3d"border:1px #EFEEEF solid;display:none;height:90%"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv style\x3d"clear:both;"\x3e\x3c/div\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit.layout.ContentPane" style\x3d"padding:1px;width:100%;"\x3e\r\n    \x3ctable style\x3d"width:100%;"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd style\x3d"width:20%;"\x3e\r\n            \x3cdiv data-dojo-type\x3d"dijit/form/Button" class\x3d"esriTertiaryActionBtn calcite green tiny" data-dojo-attach-point\x3d"_addBtn" data-dojo-attach-event\x3d"onClick:_handleAddButtonClick" class\x3d""\x3e\r\n              ${i18n.addExpr}\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd class\x3d"esriFloatTrailing"\x3e\r\n            \x3cdiv class\x3d"esriLeadingMargin025"\x3e\r\n              \x3cdiv data-dojo-type\x3d"dijit/form/Button" class\x3d"esriActionButton" data-dojo-props\x3d"label:\'${i18n.edit}\',iconClass:\'esriAnalysisEditIcon\',showLabel: false, disabled:true" data-dojo-attach-point\x3d"_editBtn" data-dojo-attach-event\x3d"onClick:_handleEditButtonClick"\x3e\x3c/div\x3e\r\n              \x3cdiv data-dojo-type\x3d"dijit/form/Button" class\x3d"esriActionButton" data-dojo-props\x3d"label:\'${i18n.remove}\',iconClass:\'esriAnalysisRemoveIcon\',showLabel: false, disabled:true" data-dojo-attach-point\x3d"_removeBtn" data-dojo-attach-event\x3d"onClick:_handleRemoveButtonClick"\x3e\x3c/div\x3e     \r\n              \x3cdiv data-dojo-type\x3d"dijit/form/Button" class\x3d"esriActionButton" data-dojo-props\x3d"label:\'${i18n.groupLabel}\',iconClass:\'esriAnalysisGroupIcon\',showLabel: false, disabled:true" data-dojo-attach-point\x3d"_groupBtn" data-dojo-attach-event\x3d"onClick:_handleGroupButtonClick"\x3e\x3c/div\x3e\r\n              \x3cdiv data-dojo-type\x3d"dijit/form/Button" class\x3d"esriActionButton" data-dojo-props\x3d"label:\'${i18n.ungroupLabel}\',iconClass:\'esriAnalysisUngroupIcon\',showLabel: false, disabled:true" data-dojo-attach-point\x3d"_ungroupBtn" data-dojo-attach-event\x3d"onClick:_handleUngroupButtonClick"\x3e\x3c/div\x3e\r\n              \x3cdiv data-dojo-type\x3d"dijit/form/ToggleButton" class\x3d"esriActionButton" data-dojo-props\x3d"label:\'${i18n.viewText}\',iconClass:\'esriAnalysisTextIcon\',showLabel: false, checked: false, disabled:true" data-dojo-attach-point\x3d"_viewBtn" data-dojo-attach-event\x3d"onChange:_handleViewButtonClick"\x3e\x3c/div\x3e           \r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n      \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv data-dojo-type\x3d"dijit/Dialog" title\x3d"${i18n.expression}" data-dojo-props\x3d"closable:false" data-dojo-attach-point\x3d"_expDialog" style\x3d"width:65em;"\x3e\r\n    \x3c!--\x3cdiv data-dojo-attach-point\x3d"_testdiv"\x3etesting\x3c/div\x3e--\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_expressionForm" data-dojo-type\x3d"esri/dijit/analysis/ExpressionForm" data-dojo-props\x3d"primaryActionButttonClass:\'${primaryActionButttonClass}\'"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e   \r\n\x3c/div\x3e'}});
define("esri/dijit/analysis/ExpressionGrid","require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/has dojo/json dojo/string dojo/dom-style dojo/dom-attr dojo/dom-construct dojo/query dojo/dom-class dojo/store/Memory dojo/store/Observable dojo/Evented dojo/_base/event dojo/window dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin dijit/_FocusMixin dijit/registry dijit/form/Button dijit/form/CheckBox dijit/form/Form dijit/form/Select dijit/form/ToggleButton dijit/form/TextBox dijit/form/ValidationTextBox dijit/layout/ContentPane dijit/Dialog dijit/InlineEditBox dgrid/OnDemandGrid dgrid/Keyboard dgrid/Selection dgrid/selector dgrid/extensions/DijitRegistry dgrid/util/mouse ./tree put-selector/put ../../kernel ../../lang ./ExpressionForm dojo/i18n!../../nls/jsapi dojo/text!./templates/ExpressionGrid.html".split(" "),
function(t,x,k,e,T,U,B,y,V,l,u,m,W,X,C,D,E,v,F,G,H,I,J,K,Y,Z,aa,ba,ca,da,ea,fa,ha,ia,ja,L,M,N,ka,O,la,z,P,Q,q,ma,r,R){var S=x([z,L,N,M,O]);t=x([G,H,I,J,K,E],{declaredClass:"esri.dijit.analysis.ExpressionGrid",templateString:R,widgetsInTemplate:!0,indentWidth:10,refreshOptions:{keepScrollPosition:!0},allowAllInputOperands:!1,isServerAdvanceLicensed:!0,_selectedIds:[],constructor:function(a){a.containerNode&&(this.container=a.containerNode)},destroy:function(){this.inherited(arguments)},postMixInProperties:function(){this.inherited(arguments);
this.i18n={};k.mixin(this.i18n,r.common);k.mixin(this.i18n,r.analysisTools);k.mixin(this.i18n,r.analysisMsgCodes);k.mixin(this.i18n,r.expressionGrid)},postCreate:function(){this.inherited(arguments);this.expressionStore=D(new C({idProperty:"id",allExpressionText:"",data:this.data||[{id:0,operator:"",expressionText:""}],getChildren:function(b){return this.query({parent:b.id})},getAllChildren:function(b){var c;var d=this.getChildren(b);0<d.total&&e.forEach(d,function(f){c=this.getAllChildren(f);0<c.total&&
e.forEach(c,function(h){d[d.total]=h;d.total+=1},this)},this);return d},getExpressions:function(b,c){var d,f;var h=this.getChildren(b);if(0<h.total){var g=[];c={};c.operator=b.operator;c.layer=b.layer;b.where?c.where=b.where:(c.selectingLayer=b.selectingLayer,c.spatialRel=b.spatialRel,b.distance&&(c.distance=b.distance,c.units=b.units));-1===this.allExpressionText.indexOf(b.text)&&(this.allExpressionText+=b.operator+" ( "+b.text+" ");g.push(c);e.forEach(h,function(p,n){d=this.getExpressions(p,n===
h.total-1?!0:!1);f=this.getChildren(p);0<f.total&&(p._isAdd||(this.allExpressionText+=")"),p._isAdd=!0);g.push(d)},this)}else g={},g.operator=b.operator,g.layer=b.layer,b.where?g.where=b.where:(g.selectingLayer=b.selectingLayer,g.spatialRel=b.spatialRel,b.distance&&(g.distance=b.distance,g.units=b.units)),-1===this.allExpressionText.indexOf(b.text)&&(this.allExpressionText+=b.operator+" "+b.text+" ",c&&!0===c&&(this.allExpressionText+=")"));return g},getLabel:function(b){return b.text},mayHaveChildren:function(b){return 1!==
b.id}}));var a={operator:z({label:"",renderCell:k.hitch(this,this._renderExpOperatorCell),shouldExpand:function(){return!0},sortable:!1,indentWidth:10,renderExpando:function(b,c,d,f){b=P("div.dgrid-expando-icon[style\x3dwidth:0;height:0;]");b.innerHTML=" ";return b}})};this.expressiongrid=new S({store:this.expressionStore,query:{expressionText:""},selectionMode:"extended",columns:a,showHeader:!1,allowSelectAll:!0,allowSelect:function(b){return b&&b.data&&0===b.data.id?!1:!0}},this._gridDiv);this.expressiongrid.on("dgrid-select",
k.hitch(this,this._handleExpressiongridSelect));this.expressiongrid.startup();this.expressiongrid.keepScrollPosition=!0;this.allowAllInputOperands?this._expressionForm.set("firstOperands",this.inputLayers):(this._expressionForm.set("firstOperands",[this.analysisLayer]),this.data&&this._updateFirstOperands());this._expressionForm.set("selectedFirstOperand",this.analysisLayer);this._expressionForm.set("inputOperands",this.inputLayers);this._expressionForm.set("showReadyToUseLayers",this.get("showReadyToUseLayers"));
this._expressionForm.set("showBrowseLayers",this.get("showBrowseLayers"));this._expressionForm.set("showReadyLayersForFirst",this.allowAllInputOperands);this._expressionForm.set("owningWidget",this.get("owningWidget"));this._expressionForm.set("isServerAdvanceLicensed",this.isServerAdvanceLicensed);this._expressionForm.init();this._expressionForm.on("add-expression",k.hitch(this,this._handleExpressionFormAdd));this._expressionForm.on("cancel-expression",k.hitch(this,this._handleExpressionFormCancel))},
_handleExpressiongridSelect:function(a){if((this._selectedObj=a.grid.selection)&&this._selectedIds&&0<this._selectedIds.length){var b=!0;a=this._selectedIds.toString();for(c in this._selectedObj)if(this._selectedObj.hasOwnProperty(c)){var c=parseInt(c,10);b=-1!==a.indexOf(c)}if(b)return}this._selectedIds=[];this._selectedRows=[];for(c in this._selectedObj)this._selectedObj.hasOwnProperty(c)&&(c=parseInt(c,10),!0===this._selectedObj[c]&&0!==c&&(this._selectedIds.push(c),this._selectedRows.push(this.expressiongrid.cell(c).row),
a=this.expressiongrid.cell(c).row.data,a=this.expressionStore.getAllChildren(a),0<a.total&&e.forEach(a,function(d){this._selectedIds.push(d.id);this._selectedRows.push(this.expressiongrid.cell(d.id).row);this.expressiongrid.select(d.id)},this)),!0===this._selectedObj[c]&&0===c&&(this._groupBtn.set("disabled",!0),this._ungroupBtn.set("disabled",!0),this._removeBtn.set("disabled",!0),this._editBtn.set("disabled",!0),this._addBtn.set("disabled",!1),this._viewBtn.set("disabled",!0)));0<this._selectedIds.length&&
(c=1===this._selectedIds.length,this._groupBtn.set("disabled",c||3>=this.expressionStore.data.length),this._ungroupBtn.set("disabled",c||3>=this.expressionStore.data.length),this._removeBtn.set("disabled",!1),this._editBtn.set("disabled",!c),this._addBtn.set("disabled",!c),this._viewBtn.set("disabled",!1))},_renderExpOperatorCell:function(a,b,c,d){if(!a.expressionText)1===this.expressionStore.data.length?m.create("label",{innerHTML:this.i18n.addExprDescription,style:{fontStyle:"italic",textAlign:"center",
display:"inline-block",width:"105%",fontWeight:"lighter"}},c):l.set(c,"display","none");else if(a.expressionText){var f=0;var h=this._gridPane.isRTL?"marginRight":"marginLeft";var g=m.create("table",{"class":"esriExpressionTable"},c);if(1<d.level){var p=d.level*d.level*this.indentWidth+8+"px";l.set(g,h,p)}else l.set(g,h,"5px");g=m.create("tr",{},g);h=this.expressionStore.getAllChildren(a);0<d.level&&0<h.total&&(f=1===d.level?2*this.indentWidth*d.level+24:this.indentWidth*d.level*2+this.indentWidth);
d=m.create("td",{"class":"expressionTd"},g);l.set(d,"width","32px");h=m.create("td",{"class":"expressionTd"},g);l.set(h,"width",f+"px");h=m.create("div",{},h);l.set(h,"width",f+"px");b?m.create("div",{innerHTML:this.i18n[b],name:a.operator,id:a.id,"class":"esriAnalysisOperatorButton",onclick:k.hitch(this,function(n){v.stop(n);n=n.target;var A=this.expressionStore.get(n.id);this.expressiongrid.clearSelection();this._selectedRows=[];this._selectedIds=[];var w=u.get(n,"name");n.innerHTML="and"===w?this.i18n.or:
this.i18n.and;u.set(n,"name","and"===w?"or":"and");A.operator="and"===w?"or":"and";this.expressionStore.put(A);this.expressiongrid.refresh(this.refreshOptions)})},d,"first"):m.create("div",{style:"width:32px;"},d);b=m.create("td",{"class":"esriAnalysisExpression expressionTd"},g);m.create("label",{"class":"",title:this.expressionStore.getLabel(a),innerHTML:a.expressionText},b)}return c},_clear:function(){this._selectedIds=[];this.expressiongrid.clearSelection();this.expressiongrid.refresh(this.refreshOptions);
this._groupBtn.set("disabled",!0);this._ungroupBtn.set("disabled",!0);this._removeBtn.set("disabled",!0);this._editBtn.set("disabled",!0);this._addBtn.set("disabled",!1);this._viewBtn.set("disabled",1===this.expressionStore.data.length?!0:!1);1===this.expressionStore.data.length&&(this.allowAllInputOperands?this._expressionForm.set("firstOperands",this.inputLayers):this._expressionForm.set("firstOperands",[this.analysisLayer]),this._expressionForm.set("selectedFirstOperand",this.analysisLayer),this._expressionForm.set("inputOperands",
this.inputLayers))},_handleAddButtonClick:function(a){this._expDialog.set("title",this.i18n.addExpr);this._expressionForm.set("action","add");this._expressionForm.clear();this._expDialog.show()},_handleEditButtonClick:function(a){v.stop(a);this._expDialog.set("title",this.i18n.editExpr);if(this._selectedIds&&0===this._selectedIds.length)return!1;a=this.expressionStore.get(this._selectedIds[0]);this._expressionForm.set("action","edit");this._expressionForm.clear();this._expressionForm.set("expression",
a);this._expDialog.show()},_handleRemoveButtonClick:function(a){v.stop(a);if(this._selectedIds&&0===this._selectedIds.length)return!1;e.forEach(this._selectedIds,function(b){this.expressionStore.remove(b)},this);this._clear();this.emit("update-expressions",this.expressionStore.query())},_handleGroupButtonClick:function(a){var b;if(this._selectedIds&&0===this._selectedIds.length)return!1;a=e.map(this._selectedIds,function(d){return parseInt(d,10)});var c=this._arrayMin(a);e.forEach(this._selectedRows,
function(d,f){b=this.expressiongrid.cell(this._selectedRows[f].id);1<this._selectedRows[f].id&&this._selectedRows[f].id!==c&&(0===b.row.data.parent&&this.expressionStore.mayHaveChildren(this.expressionStore.get(c))&&(b.row.data.parent=c),this.expressionStore.put(b.row.data));this.expressiongrid.refresh(this.refreshOptions)},this);this._clear()},_handleUngroupButtonClick:function(a){var b;if(this._selectedIds&&0===this._selectedIds.length)return!1;a=e.map(this._selectedIds,function(d){return parseInt(d,
10)});var c=this._arrayMin(a);e.forEach(this._selectedRows,function(d,f){b=this.expressiongrid.cell(this._selectedRows[f].id);1<this._selectedRows[f].id&&this._selectedRows[f].id!==c&&(b.row.data.parent===c&&(b.row.data.parent=0),this.expressionStore.put(b.row.data));this.expressiongrid.refresh(this.refreshOptions)},this);this._clear()},_handleExpressionFormAdd:function(a){var b={};if("add"===a.action)if(b={id:this.expressionStore.data.length,operator:1===this.expressionStore.data.length?"":"and"},
0===this._selectedIds.length)b.parent=0;else{if(1===this._selectedIds.length){var c=parseInt(this._selectedIds[0],10);b.parent=this.expressionStore.mayHaveChildren(this.expressionStore.get(c))?c:0}}else b=this.expressionStore.get(parseInt(this._selectedIds[0],10)),b.where&&a.expression.spatialRel&&delete b.where,b.spatialRel&&a.expression.where&&(delete b.spatialRel,delete b.selectingLayer,b.distance&&(delete b.distance,delete b.units));k.mixin(b,a.expression);b.expressionText=a.displayText;b.text=
a.text;this.expressionStore.put(b);this.expressiongrid.refresh(this.refreshOptions);this._expDialog.hide();this.allowAllInputOperands||this._updateFirstOperands(a.expression);this._clear();this.validate();this.emit("update-expressions",this.expressionStore.query())},_handleExpressionFormCancel:function(){this._expDialog.hide();this._clear()},_handleViewButtonClick:function(a){this._viewBtn.set("label",a?this.i18n.viewGrid:this.i18n.viewText);this._viewBtn.set("iconClass",a?"esriAnalysisGridIcon":
"esriAnalysisTextIcon");a&&(this._groupBtn.set("disabled",a),this._ungroupBtn.set("disabled",a),this._removeBtn.set("disabled",a),this._editBtn.set("disabled",a),this._addBtn.set("disabled",a));this.get("expressions");l.set(this._textDiv,"display",a?"":"none");l.set(this._gridDiv,"display",a?"none":"");u.set(this._textDiv,"innerHTML",a?this.expressionStore.allExpressionText:"");a||this._clear()},_updateFirstOperands:function(a){a=this.get("selectedLayers");this._expressionForm.set("firstOperands",
a)},_getInputLayerById:function(a){e.forEach(this.inputLayers,function(b){if(b.id===a)return b},this)},_arrayMin:function(a){return Math.min.apply(Math,a)},_setInputLayersAttr:function(a){this.inputLayers=a},_getInputLayersAttr:function(){return this.inputLayers},_setAnalysisLayerAttr:function(a){this.analysisLayer=a},_getAnalysisLayerAttr:function(){return this.analysisLayer},_setSelectedLayersAttr:function(a){this.selectedLayers=a},_getSelectedLayersAttr:function(){var a=[],b=[];e.forEach(this.expressionStore.data,
function(c,d){q.isDefined(c.layer)&&-1===e.indexOf(a,c.layer)&&(a.push(c.layer),b.push(this.inputLayers[c.layer]));q.isDefined(c.selectingLayer)&&-1===e.indexOf(a,c.selectingLayer)&&(a.push(c.selectingLayer),b.push(this.inputLayers[c.selectingLayer]))},this);this.selectedLayers=b;this.set("selectedLayerIds",a);return this.selectedLayers},_setSelectedLayerIdsAttr:function(a){this.selectedLayerIds=a},_getSelectedLayerIdsAttr:function(){return this.selectedLayerIds},_getSelectedLayersMapAttr:function(){var a=
{};a.inputLayers=this.get("inputLayers");a.selectedLayers=this.get("selectedLayers");a.selectedLayerIds=this.get("selectedLayerIds");return a},_setDataAttr:function(a){this.data=a},_getExpressionsAttr:function(){var a=[],b,c;this.expressionStore.allExpressionText="";e.forEach(this.expressionStore.data,function(d,f){d._isAdd=!1});e.forEach(this.expressionStore.data,function(d,f){0!==f&&(c={},c.operator=d.operator,c.layer=d.layer,d.where?c.where=d.where:(c.selectingLayer=d.selectingLayer,c.spatialRel=
d.spatialRel,d.distance&&(c.distance=d.distance,c.units=d.units)),this._findElementInMultiArray(a,c)||(b=this.expressionStore.getExpressions(d),a.push(b)))},this);return a},_getExpressionMapAttr:function(){var a=this.get("selectedLayersMap");var b=this.get("expressions");b=this._updateExpressions(b,a);return{data:this.expressionStore.data,expressions:b,inputLayers:a.selectedLayers,expressionString:this.expressionStore.allExpressionText}},_setExpressionMapAttr:function(a){this.expressionsMap=a},_setShowReadyToUseLayersAttr:function(a){this._set("showReadyToUseLayers",
a)},_setShowBrowseLayersAttr:function(a){this._set("showBrowseLayers",a)},_setOwningWidgetAttr:function(a){this._set("owningWidget",a)},_updateExpressions:function(a,b){e.forEach(a,function(c,d){c instanceof Array||c.length?c=this._updateExpressions(c,b):(q.isDefined(c.layer)&&-1!==e.indexOf(b.selectedLayerIds,c.layer)&&(c.layer=e.indexOf(b.selectedLayerIds,c.layer)),q.isDefined(c.selectingLayer)&&-1!==e.indexOf(b.selectedLayerIds,c.selectingLayer)&&(c.selectingLayer=e.indexOf(b.selectedLayerIds,
c.selectingLayer)))},this);return a},_findElementInMultiArray:function(a,b){var c=!1;e.forEach(a,function(d,f){if(y.stringify(b)===y.stringify(d))return c=!0;if(d instanceof Array||d.length)c=this._findElementInMultiArray(d,b)},this);return c},_setPrimaryActionButttonClassAttr:function(a){this.primaryActionButttonClass=a},_getCssClassesAttr:function(){return this.primaryActionButttonClass},validate:function(){var a;(a=1!==this.expressionStore.data.length)?l.set(this.expressiongrid.domNode,"borderColor",
"#bba"):(F.scrollIntoView(this.expressiongrid.domNode),this.expressiongrid.focus(),l.set(this.expressiongrid.domNode,"borderColor","#f94"));return a}});B("extend-esri")&&k.setObject("dijit.analysis.ExpressionGrid",t,Q);return t});