// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/analysis/templates/GPWidget.html":'\x3cdiv class\x3d"esriAnalysis"\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" style\x3d"margin-top:0.5em; margin-bottom: 0.5em;"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_aggregateToolContentTitle" class\x3d"analysisTitle breakWord"\x3e\r\n        \x3ctable class\x3d"esriFormTable" \x3e\r\n          \x3ctr\x3e\r\n            \x3ctd class\x3d"esriToolIconTd"\x3e\x3cdiv class\x3d"GPWidgetIcon"\x3e\x3c/div\x3e\x3c/td\x3e\r\n            \x3ctd class\x3d"esriAlignLeading esriAnalysisTitle" data-dojo-attach-point\x3d"_toolTitle"\x3e\r\n              \x3clabel data-dojo-attach-point\x3d"_titleLbl"\x3e\x3c/label\x3e\r\n            \x3c/td\x3e\r\n            \x3ctd\x3e\r\n              \x3cdiv class\x3d"esriFloatTrailing" style\x3d"padding:0;"\x3e\r\n                  \x3cdiv class\x3d"esriFloatLeading" data-dojo-attach-point\x3d"_toolDescHelpDiv"\x3e\r\n                    \x3ca href\x3d"#" class\x3d\'esriFloatLeading helpIcon\' esriHelpTopic\x3d"toolDescription"\x3e\x3c/a\x3e\r\n                  \x3c/div\x3e\r\n                  \x3cdiv class\x3d"esriFloatTrailing"\x3e\r\n                    \x3ca href\x3d"#" data-dojo-attach-point\x3d"_closeBtn" title\x3d"${i18n.close}" class\x3d"esriAnalysisCloseIcon"\x3e\x3c/a\x3e\r\n                  \x3c/div\x3e\r\n              \x3c/div\x3e\r\n            \x3c/td\x3e\r\n          \x3c/tr\x3e\r\n        \x3c/table\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"toolHeaderLine"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"_form" readOnly\x3d"true"\x3e\r\n      \x3cdiv class\x3d"section" data-dojo-attach-point\x3d"inputSectionNode"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_aggregateToolContentButtons" style\x3d"padding:5px;margin-top:5px;border-top:solid 1px #BBB;"\x3e\r\n      \x3cdiv class\x3d"esriFormWarning esriRoundedBox" data-dojo-attach-point\x3d"_errorMessagePane" style\x3d"display:none;"\x3e\r\n        \x3ca href\x3d"#" title\x3d"${i18n.close}" class\x3d"esriFloatTrailing esriAnalysisCloseIcon"\x3e\x3c/a\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"_bodyNode"\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"esriExtentCreditsCtr"\x3e\r\n        \x3ca class\x3d"esriFloatTrailing esriSmallFont"  href\x3d"#" data-dojo-attach-point\x3d"_showCreditsLink"\x3e\x3c/a\x3e\r\n       \x3clabel data-dojo-attach-point\x3d"_chooseExtentDiv" class\x3d"esriSelectLabel esriExtentLabel"\x3e\r\n         \x3cinput type\x3d"radio" data-dojo-attach-point\x3d"_useExtentCheck" data-dojo-type\x3d"dijit/form/CheckBox" data-dojo-props\x3d"checked:true" name\x3d"extent" value\x3d"true"/\x3e\r\n           ${i18n.useMapExtent}\r\n       \x3c/label\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"esriExtentCreditsCtr"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" type\x3d"submit" style\x3d"width:100%;" data-dojo-attach-point\x3d"_saveBtn" data-dojo-attach-event\x3d"onClick:_handleSaveBtnClick" class\x3d"calcite btn large blue webtoolbtn"\x3e\r\n        ${i18n.runAnalysis}\r\n        \x3c/button\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" type\x3d "button" class\x3d"calcite btn large transparent webtoolbtn" style\x3d"border:1px solid" data-dojo-attach-point\x3d"_cancelBtn" data-dojo-attach-event\x3d"onClick:_handleCancelBtnClick"\x3e\r\n        ${i18n.cancel}\r\n        \x3c/button\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"output-pane" data-dojo-attach-point\x3d"outputPaneNode"\x3e\r\n      \x3cdiv class\x3d"section info" data-dojo-attach-point\x3d"infoNode"\x3e\r\n        \x3ca href\x3d"#" title\x3d"${i18n.close}" data-dojo-attach-point\x3d"_msgCloseIcon" style\x3d"padding:0;display:none;" class\x3d"esriFloatTrailing esriAnalysisCloseIcon" data-dojo-attach-event\x3d"onclick:_handleCloseMsg"\x3e\x3c/a\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"loadingNode" class\x3d"loading"\x3e\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"infoTextNode" class\x3d"text"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"section" data-dojo-attach-point\x3d"outputSectionNode"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n'}});
define("esri/dijit/analysis/GPWidget","require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Deferred dojo/has dojo/json dojo/string dojo/dom-style dojo/dom-attr dojo/dom-construct dojo/query dojo/dom-class dojo/NodeList dojo/NodeList-dom dojo/on dojo/Deferred dojo/promise/all dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin dijit/_FocusMixin dijit/registry dijit/form/Button dijit/form/CheckBox dijit/form/ValidationTextBox dijit/form/Form dijit/layout/ContentPane ./_Widget ./_AnalysisOptions ./utils ./GPWidgetViewModel ./customgp/editorManager ./customgp/resultRendererManager ./customgp/common/dijit/Message ../../kernel ../../lang ../../tasks/Geoprocessor ../../tasks/GPMessage ../../tasks/JobInfo ../../layers/ImageParameters ../../graphicsUtils ../../deferredUtils ../../request dojo/i18n!../../nls/jsapi dojo/i18n!./customgp/common/nls/main dojo/i18n!./customgp/nls/strings dojo/text!./templates/GPWidget.html".split(" "),
function(v,ba,e,g,B,C,D,E,ca,da,m,F,h,z,w,ea,fa,n,G,H,I,ha,J,K,L,M,ia,ja,ka,N,la,ma,O,P,Q,R,x,r,na,S,T,U,p,t,oa,V,W,X,q,A,Y,Z){v=O.createSubclass([J,K,L,M,I,P],{declaredClass:"esri.dijit.analysis.GPWidget",templateString:Z,widgetsInTemplate:!0,viewModelType:R,showChooseExtent:!0,i18n:null,toolName:"GPWidget",helpFileName:"GPWidget",_resultLayerGPTypes:["GPFeatureRecordSetLayer","GPRecordSet"],constructor:function(a){a.containerNode&&(this.container=a.containerNode);this.drawTools=[]},destroy:function(){this._clearLastInput();
this._clearLastResult();this._clearMessageInterval();this.inherited(arguments)},_onClose:function(a){a&&this.emit("save",{save:!0});a||(this._clearLastInput(),this._clearLastResult(),this._clearMessageInterval());this.emit("close",e.mixin({save:a},{isWebTool:!0,addToMap:0<this.resultLayerNames.length}))},postMixInProperties:function(){this.inherited(arguments);this.i18n={};e.mixin(this.i18n,q.common);e.mixin(this.i18n,q.analysisTools);e.mixin(this.i18n,q.analysisMsgCodes);e.mixin(this.i18n,q.analysisSettings);
e.mixin(this.i18n,q.aggregatePointsTool);e.mixin(this.i18n,A.common);e.mixin(this.i18n,A.units);e.mixin(this.i18n,Y);this._initModelWatchers()},postCreate:function(){this.inherited(arguments);this._loadConnections();m.set(this._chooseExtentDiv,"display",!0===this.showChooseExtent?"inline-block":"none");m.set(this._showCreditsLink,"display",!0===this.showCredits?"block":"none");m.set(this._cancelBtn.domNode,"display","none");this.renderUI();this.resultLayerNames=[]},_loadConnections:function(){B.connect(this._closeBtn,
"onclick",e.hitch(this,this._onClose,!1));this.own(this.on("start",e.hitch(this,function(){this._onClose(!0)})))},startup:function(){},renderUI:function(){x.setMap(this.viewModel.map);x.setNls(this.i18n);r.setMap(this.viewModel.map);r.setNls(this.i18n);this.viewModel.title&&this._updateTitle();this.viewModel.inputParams&&this._createInputNodes();this.viewModel.outputParams&&this._createResultNameNodes();this.viewModel.taskUrl&&this._setUpGP();this.viewModel.helpUrl&&this._updateHelpUrl();this.viewModel.map&&
this._updateMap()},_initModelWatchers:function(){this.own(this.viewModel.watch("title",e.hitch(this,this._updateTitle)),this.viewModel.watch("inputParams",e.hitch(this,this._createInputNodes)),this.viewModel.watch("outputParams",e.hitch(this,this._createResultNameNodes)),this.viewModel.watch("taskUrl",e.hitch(this,this._setUpGP)),this.viewModel.watch("helpUrl",e.hitch(this,this._updateHelpUrl)),this.viewModel.watch("helpUrl",e.hitch(this,this._updateMap)))},_setUpGP:function(){this.gp=new U(this.viewModel.taskUrl);
this.gp.setOutSpatialReference(this.viewModel.map.spatialReference);this.own(n(this.gp,"execute-complete",e.hitch(this,this.onExecuteComplete)));this.own(n(this.gp,"job-complete",e.hitch(this,this.onJobComplete)));this.own(n(this.gp,"job-cancel",e.hitch(this,this.onJobCancel)));this.own(n(this.gp,"status-update",e.hitch(this,this.onStatusUpdate)));this.own(n(this.gp,"get-result-data-complete",e.hitch(this,this.onGetResultDataComplate)));this.own(n(this.gp,"get-result-image-layer-complete",e.hitch(this,
this.onGetResultImageLayerComplete)));this.own(n(this.gp,"error",e.hitch(this,this.onError)))},_createInputNodes:function(){this.inputNodes&&0<this.inputNodes.length&&g.forEach(this.inputNodes,function(a,b){h.destroy(a)},this);this.inputNodes=[];this.drawnLayers=[];this.hasESRIFSOutput=this.viewModel.inputParams.some(function(a){return"esri_out_feature_service_name"===a.name});g.forEach(this.viewModel.inputParams,function(a,b){this._createInputNode(a,b)},this);this._createInputFieldNodes()},_createInputNode:function(a,
b){var c=h.create("div",{"class":"esriAnalysisPadding1"},this.inputSectionNode),d=h.create("div",{"class":"esriAnalysisStepsLabel",title:a.tooltip||a.label||""},c);h.create("span",{"class":"esriTrailingMargin025 esriAnalysisNumberLabel",innerHTML:b+1+""},d);h.create("span",{"class":"",innerHTML:a.label},d);a.required&&h.create("span",{"class":"label-star",innerHTML:"*"},d);b=h.create("div",{"class":"esriLeadingMargin1"},c);d=x.createEditor(a,"input","widget",{uid:this.id,config:this.viewModel,widget:this});
d.placeAt(b);"SelectFeatureSetFromLayer"===d.editorName&&this.drawTools.push(d);c.param=a;c.inputEditor=d;if("GPFeatureRecordSetLayer"===a.dataType)c.inputEditor.on("analysislayer-change",e.hitch(this,this._handleInputLayerChange,c));"esri_out_feature_service_name"===a.name&&(this.featureServiceInpututNode=c,this.own(c.inputEditor.gEditor.on("change",e.hitch(this,this._handleFSNameChange))));this.inputNodes.push(c);!1===a.visible&&m.set(c,"display","none");return c},_createInputFieldNodes:function(){this.inputNodes&&
0!==this.inputNodes.length&&(this.inputFieldNodes=this.inputNodes.filter(function(a){return!!a&&!!a.param&&"Field"===a.param.dataType&&a.param.dependency},this))&&0<this.inputFieldNodes.length&&this.inputFieldNodes.forEach(function(a){a.inputEditor.set("dependencyParam",this._getInputFieldDepNode(a.param.dependency))},this)},_getInputFieldDepNode:function(a){return this.inputNodes.filter(function(b){if(b.param.name===a)return b})[0].param},_createResultNameNodes:function(){this.resultNameNodes&&0<
this.resultNameNodes.length&&g.forEach(this.resultNameNodes,function(d,f){h.destroy(d)},this);this.resultLayerParams=[];this.resultNameNodes=[];var a=[],b=[];g.forEach(this.viewModel.outputParams,function(d,f){-1!==this._resultLayerGPTypes.indexOf(d.dataType)&&this.resultLayerParams.push(d)},this);0<this.resultLayerParams.length&&(a=this.resultLayerParams.filter(function(d){return"GPFeatureRecordSetLayer"===d.dataType}),b=a.map(function(d){return d.name}));var c=null;g.forEach(this.resultLayerParams,
function(d,f){2>b.length||2<b.length&&-1===b.indexOf(d.name)?this._createResultNameNode(d,this.inputNodes.length+f):(T.isDefined(c)||(c=f,this._createResultLabel({label:this.i18n.outputFClass},this.inputNodes.length+f)),this._createResultNameNode(d,this.inputNodes.length+c,{addStep:!1}))},this)},_createResultLabel:function(a,b,c,d){c||(c=h.create("div",{"class":"esriAnalysisPadding1"},this.inputSectionNode));c=h.create("div",{"class":d&&!d.addStep?"":"esriAnalysisStepsLabel",title:a.tooltip||a.label||
""},c);(!d||d&&d.addStep)&&h.create("span",{"class":"esriTrailingMargin025 esriAnalysisNumberLabel",innerHTML:b+1+""},c);h.create("span",{"class":d&&!d.addStep?"esriLeadingMargin1":"",innerHTML:a.label},c);a.required&&!this.hasESRIFSOutput&&h.create("span",{"class":"label-star",innerHTML:"*"},c)},_createResultNameNode:function(a,b,c){if(!c||!c.node)var d=h.create("div",{"class":"esriAnalysisPadding1"},this.inputSectionNode);this._createResultLabel(a,b,d,c);b=h.create("div",{"class":"esriLeadingMargin1"},
d);c=new N({"class":"one-width"});c.placeAt(b);this.hasESRIFSOutput||c.set("value",a.name);!1===a.visible&&m.set(d,"display","none");d.param=a;d.resultNameNode=c;d.resultNameNode.on("change",e.hitch(this,this._handleResultNameNodeChange));this.resultNameNodes.push(d);return d},_handleFSNameChange:function(a){var b=0<a.length;this.resultNameNodes.forEach(function(c){c.param&&"GPFeatureRecordSetLayer"===c.param.dataType&&c.resultNameNode&&(c.resultNameNode.set("disabled",b),c.resultNameNode.set("required",
b),z(".esriAnalysisStepsLabel",c).forEach(function(d){w.toggle(d,"esriAnalysisTextDisabled",b)},this))},this)},_handleResultNameNodeChange:function(a){var b=this.resultNameNodes.some(function(c){return 0<c.resultNameNode.get("value").length});this.featureServiceInpututNode&&(this.featureServiceInpututNode.inputEditor.gEditor.set("disabled",b),z(".esriAnalysisStepsLabel",this.featureServiceInpututNode).forEach(function(c){w.toggle(c,"esriAnalysisTextDisabled",b)},this))},validateOutputNames:function(){if(!(this.resultNameNodes&&
0!==this.resultNameNodes.length||this.featureServiceInpututNode))return!0;var a=this.resultNameNodes.some(function(b){return 0<b.resultNameNode.get("value").length});(a=a||this.featureServiceInpututNode&&0<this.featureServiceInpututNode.inputEditor.gEditor.get("value").length)||this._showMessage(this.i18n.outputnameMissingMsg,"error");return a},_handleCancelBtnClick:function(){this._cancelBtn.set("disabled",!0);this.cancel(this.jobInfo)},_handleSaveBtnClick:function(){this._form.validate()&&this.validateOutputNames()&&
(this.set("disableRunAnalysis",!0),this._clearLastResult(),this._getInputParamValues().then(e.hitch(this,function(a){this.jobParams=a;this.resultLayerNames=[];this.resultNameNodes&&0<this.resultNameNodes.length&&g.forEach(this.resultNameNodes,function(b,c){(b.param&&"GPFeatureRecordSetLayer"===b.param.dataType||"GPFeatureRecordSetLayer"!==b.param.dataType&&a.esri_out_feature_service_name&&b.resultNameNode)&&this.resultLayerNames.push(b.resultNameNode.get("value"))},this);this.showChooseExtent&&this._useExtentCheck.get("checked")&&
(a.context=C.toJson({extent:this.map.extent._normalize(!0)}));0<this.resultLayerNames.length&&(a.resultName=a.esri_out_feature_service_name?a.esri_out_feature_service_name:this.resultLayerNames[0],a.returnFeatureCollection=!(this.viewModel.serverInfo.resultMapServerName||a.esri_out_feature_service_name));a.esri_out_feature_service_name&&0<a.esri_out_feature_service_name.length?this.viewModel.checkServiceNameAvailable(a.esri_out_feature_service_name).then(e.hitch(this,function(b){b.available?this._submitJob(a):
(this._showMessage(this.i18n.servNameExists,"error"),this.set("disableRunAnalysis",!1))}),e.hitch(this,function(b){console.log(b);this.set("disableRunAnalysis",!1)})):this._submitJob(a)}),e.hitch(this,function(a){this._showMessage(a,"error");this.set("disableRunAnalysis",!1)})))},_submitJob:function(a){this.emit("start",e.mixin({},a,{isWebTool:!0,addToMap:0<this.resultLayerNames.length}));this.viewModel.serverInfo.isSynchronous||"esriExecutionTypeAsynchronous"!==this.viewModel.taskInfo.executionType?
this.gp.execute(a):this.gp.submitJob(a);this.emit("job-submit",e.mixin({},a,{isWebTool:!0,addToMap:0<this.resultLayerNames.length}))},_getInputParamValues:function(){var a=new G,b={},c=[],d,f="";g.forEach(this.inputNodes,function(k){d=k.inputEditor.getGPValue();d.param=k.param;c.push(d)},this);H(c).then(e.hitch(this,function(k){for(var l=0;l<k.length;l++)!c[l].param.required||null!==k[l]&&void 0!==k[l]?b[c[l].param.name]=k[l]:(f=c[l].param.label+" "+this.i18n.requiredInfo,a.reject(f));a.resolve(b)}),
function(k){a.reject(k)});return a},_createOutputNodes:function(a){var b=[];this.resultNodes=[];this.resultLayers=[];g.forEach(this.viewModel.outputParams,function(f,k){b.push(this._createOutputNode(f,a[k]))},this);if(g.some(b,function(f){return null!==f})){var c=[];g.forEach(a,e.hitch(this,function(f){"GPFeatureRecordSetLayer"===f.dataType&&(f=f.value&&f.value.features)&&0<f.length&&(c=c.concat(f))}));if(0<c.length)try{var d=V.graphicsExtent(c);d&&this.viewModel.map.setExtent(d.expand(1.4))}catch(f){console.error(f)}}},
_createOutputNode:function(a,b){if(a.visible){try{var c=r.createResultRenderer(a,b,{uid:this.id,config:this.viewModel})}catch(f){console.error(f),c=r.createResultRenderer("error",b,{uid:this.id,config:this.viewModel})}b=h.create("div",{"class":"output-node"},this.outputSectionNode);this.resultNodes.push(b);var d=h.create("div",{"class":"output-label",title:a.tooltip||a.label||"",innerHTML:a.label},b);b.param=a;b.labelNode=d;a=h.create("div",{"class":"renderer-container"},b);c.placeAt(a);c.startup();
b.resultRenderer=c;return b}return null},_updateTitle:function(){F.set(this._titleLbl,"innerHTML",this.viewModel.title)},_showMessage:function(a,b){w.toggle(this.infoTextNode,"esriFormWarning esriRoundedBox",b&&"error"===b);this.infoTextNode.innerHTML=a;m.set(this._msgCloseIcon,"display",a&&0<a.length?"block":"none")},_handleCloseMsg:function(){this._showMessage("")},_handleInputLayerChange:function(a,b){var c=[];this.inputFieldNodes&&0<this.inputFieldNodes.length&&(c=this.inputFieldNodes.filter(function(d){return d.param.dependency===
a.param.name},this),0<c.length&&c.forEach(function(d){d.inputEditor.set("analysisLayer",b.analysisLayer)},this))},_setDisableRunAnalysisAttr:function(a){this._saveBtn.set("disabled",a);this._saveBtn.set("iconClass",a?"esriLoading":"");m.set(this._cancelBtn.domNode,"display",a?"block":"none")},_getDrawLayerAttr:function(){return this.drawLayer},_setDrawLayerAttr:function(a){this.drawLayer||(this.drawLayer=[]);this.drawLayer.push(a)},_setDrawnLayerNameAttr:function(a){this.drawnLayerName=a},_setDrawPointLayerNameAttr:function(a){this.drawPointLayerName=
a},_setDrawLineLayerNameAttr:function(a){this.drawLineLayerName=a},_setDrawPolyLayerNameAttr:function(a){this.drawPolyLayerName=a},_getDrawnLayerNameAttr:function(a){return this.drawnLayerName},clear:function(){g.forEach(this.drawTools,function(a){a.clear()})},onExecuteComplete:function(a){this.set("disableRunAnalysis",!1);if(a.messages&&0<a.messages.length){var b=g.filter(a.messages,function(c){return c.type===p.TYPE_WARNING||c.type===p.TYPE_ERROR});0<b.length&&this._createErrorMessages(b)}this._createOutputNodes(a.results)},
onJobComplete:function(a){this.set("disableRunAnalysis",!1);if(-1===[t.STATUS_CANCELLED,t.STATUS_CANCELLING].indexOf(a.jobInfo.jobStatus)){this._clearMessageInterval();a.jobParams=this.jobParams;this.resultLayerNames&&0<this.resultLayerNames.length&&(a.jobParams.resultName=this.resultLayerNames[0]);if(a.jobInfo.messages&&0<a.jobInfo.messages.length){var b=g.filter(a.jobInfo.messages,function(d){return d.type===p.TYPE_WARNING||d.type===p.TYPE_ERROR});if(0<b.length&&(this._createErrorMessages(b,a),
a.jobInfo.jobStatus!==t.STATUS_SUCCEEDED))return}this.emit("job-success",e.mixin({},a,{isWebTool:!0,addToMap:0<this.resultLayerNames.length}));if(this.viewModel.useResultMapServer){b=this.viewModel.taskUrl.replace("GPServer","MapServer");b=b.substring(0,b.lastIndexOf("/"));b+="/jobs/"+a.jobInfo.jobId;var c=g.filter(this.resultNameNodes,function(d,f){return d.param&&d.param.name===a.jobParams.resultName},this);c=0<c.length&&c[0].resultNameNode?c[0].resultNameNode.get("value"):a.jobParams.resultName;
this.emit("job-result",{value:{url:b,type:"ArcGISDynamicMapServiceLayer"},outputLayerName:c,isWebTool:!0,addToMap:!0});g.some(this.viewModel.outputParams,function(d){if("MapServiceLayer"===d.dataType)return!0});g.forEach(this.viewModel.outputParams,function(d){d.visible&&"GPFeatureRecordSetLayer"!==d.dataType&&"GPRasterDataLayer"!==d.dataType&&"GPRecordSet"!==d.dataType&&this.gp.getResultData(a.jobInfo.jobId,d.name)},this)}else g.forEach(this.viewModel.outputParams,function(d){d.visible&&("GPFeatureRecordSetLayer"!==
d.dataType||!this.viewModel.serverInfo||this.viewModel.serverInfo.resultMapServerName||this.jobParams.esri_out_feature_service_name?this.gp.getResultData(a.jobInfo.jobId,d.name):this._getCustomResultData(a.jobInfo.jobId,d.name,{returnFeatureCollection:!0}))},this)}},_getCustomResultData:function(a,b,c,d,f){var k=this.gp._getResultDataHandler,l=this.gp._errorHandler,u=new D(W._dfdCanceller);u._pendingDfd=X({url:this.gp._url.path+"/jobs/"+a+"/results/"+b,content:e.mixin({},this.gp._url.query,{f:"json",
returnType:"data"},c),callbackParamName:"callback",load:function(y,aa){k(y,aa,d,f,u)},error:function(y){l(y,f,u)}});return u},cancel:function(a){this.gp.cancelJob(a.jobId)},onJobCancel:function(a){this._showMessage(this.i18n.BD_101031,"error");this._clearMessageInterval();this.resultLayerNames&&0<this.resultLayerNames.length&&(a.resultName=this.resultLayerNames[0]);this._cancelBtn.set("disabled",!1);this.emit("job-cancel",e.mixin({},a,{isWebTool:!0,addToMap:0<this.resultLayerNames.length}))},onStatusUpdate:function(a){this.jobId=
a.jobInfo.jobId;e.mixin(a,a.jobInfo);a.jobInfo.jobStatus===t.STATUS_SUCCEEDED&&(this.set("disableRunAnalysis",!1),this._clearMessageInterval());!this.messageInterval&&this.jobId&&this._setupMessageInterval();a.jobParams=this.jobParams;this.resultLayerNames&&0<this.resultLayerNames.length&&(a.jobParams.resultName=this.resultLayerNames[0]);this.jobInfo=a;this.emit("job-status",e.mixin({},a,{isWebTool:!0,addToMap:0<this.resultLayerNames.length}))},onGetResultDataComplate:function(a){a.result&&("GPFeatureRecordSetLayer"!==
a.result.dataType&&0===this.resultLayerNames.length||"GPFeatureRecordSetLayer"===a.result.dataType&&this.shouldAddToMap)&&this._createOutputNode(this._getOutputParamByName(a.result.paramName),a.result);var b=g.filter(this.resultNameNodes,function(c,d){return c.param&&c.param.name===a.result.paramName},this);a.result.outputLayerName=0<b.length&&b[0].resultNameNode?b[0].resultNameNode.get("value")?b[0].resultNameNode.get("value"):this.jobParams.esri_out_feature_service_name:a.result.paramName;this.emit("job-result",
e.mixin({},a.result,{param:this._getOutputParamByName(a.result.paramName),isWebTool:!0,addToMap:0<this.resultLayerNames.length}))},onGetResultImageLayerComplete:function(a){if(a=a.layer){var b=a.url.substring(a.url.lastIndexOf("/")+1);b={name:b,title:b,tooltip:b,dataType:"result map service",visible:!0};a._wab_type="ArcGISDynamicMapServiceLayer";var c=this._getResultMapServiceParam();c&&(b.label=c.label,b.tooltip=c.tooltip,a.title=c.label);null!==this._createOutputNode(b,a)&&this.resultLayers.push(a)}},
onError:function(a){this._showMessage(a.error.message,"error");this._clearMessageInterval()},_createErrorMessages:function(a,b){var c="",d=0;g.forEach(a,function(f){if(f.type===p.TYPE_WARNING||f.type===p.TYPE_ERROR)f.type===p.TYPE_ERROR&&d++,c+=f.description+"\n"});a={message:c};b&&b.jobParams&&b.jobParams.resultName&&e.mixin(a,{jobParams:b.jobParams,resultName:b.jobParams.resultName});0===d&&c&&(a.type="warning");a.isWebTool=!0;this.emit("job-fail",a)},_setupMessageInterval:function(){this.messageInterval=
setInterval(e.hitch(this,this._updateJobMessage),1E3)},_updateJobMessage:function(){},_clearMessageInterval:function(){this.jobId="";this.messageInterval&&(clearInterval(this.messageInterval),this.messageInterval=null)},_getResultMapServiceParam:function(){var a;g.some(this.viewModel.outputParams,function(b){if("MapServiceLayer"===b.dataType)return a=b,!0});return a},_getOutputParamByName:function(a){for(var b=0;b<this.viewModel.outputParams.length;b++)if(this.viewModel.outputParams[b].name===a)return this.viewModel.outputParams[b]},
_clearLastInput:function(){g.forEach(this.inputNodes,function(a){a.inputEditor.clear&&e.isFunction(a.inputEditor.clear)&&a.inputEditor.clear()},this)},_clearLastResult:function(){h.empty(this.infoTextNode);g.forEach(this.resultNodes,function(a){h.destroy(a.labelNode);a.resultRenderer&&a.resultRenderer.destroy();h.destroy(a)});g.forEach(this.resultLayers,function(a){null!==a&&this.viewModel.map.removeLayer(a)},this);this.resultNodes=[];this.resultLayers=[]},_showLoading:function(){},_hideLoading:function(){},
_updateHelpUrl:function(){Q.initHelpLinks(this.domNode,!0,{isSingleTenant:!0,helpUrl:this.viewModel.helpUrl,showHelpFromUrl:!0})},_updateMap:function(){this.viewModel.map&&this.set("map",this.viewModel.map)}});E("extend-esri")&&e.setObject("dijit.analysis.GPWidget",v,S);return v});