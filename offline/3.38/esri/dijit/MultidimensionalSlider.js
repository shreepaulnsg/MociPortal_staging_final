// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/templates/MultidimensionalSlider_vertical.html":'\x3cdiv class\x3d"esriMdSliderVertical esriMdSliderPassive"\x3e\r\n  \x3ctable class\x3d"esriMdSliderTableVertical" data-dojo-attach-point\x3d"mdSliderTable"\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd colspan\x3d"3" class\x3d"esriMdSliderInfoCellVertical"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"dimensionInfo" class\x3d"esriMdSliderInfo"\x3e\r\n          \x3cbr/\x3e\x3cbr/\x3e\r\n        \x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd colspan\x3d"3" class\x3d"esriMdSliderCellVertical" data-dojo-attach-point\x3d"mdSliderCell"\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr  class\x3d"esriMdSliderPlayButtonRow"  data-dojo-attach-point\x3d"playPauseBtnRow"\x3e\r\n      \x3ctd class\x3d"esriMdSliderPrevButtonCell"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsPrevButton\'" data-dojo-attach-event\x3d"onClick:decrement" data-dojo-attach-point\x3d"prevBtn" type\x3d"button"\r\n                title\x3d"${_i18n.widgets.mdSlider.NLS_previous}"\x3e\r\n        \x3c/button\x3e\x3c/td\x3e\r\n      \x3ctd class\x3d"esriMdSliderPlayButtonCell"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsPlayButton\'" data-dojo-attach-event\x3d"onClick:_onPlay" data-dojo-attach-point\x3d"playPauseBtn" type\x3d"button"\r\n                title\x3d"${_i18n.widgets.mdSlider.NLS_play}"\x3e\r\n        \x3c/button\x3e\x3c/td\x3e\r\n      \x3ctd class\x3d"esriMdSliderNextButtonCell"\x3e\r\n        \x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsNextButton\'" data-dojo-attach-event\x3d"onClick:increment" data-dojo-attach-point\x3d"nextBtn" type\x3d"button"\r\n                title\x3d"${_i18n.widgets.mdSlider.NLS_next}"\x3e\r\n        \x3c/button\x3e\x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e',
"url:esri/dijit/templates/MultidimensionalSlider_horizontal.html":'\x3cdiv class\x3d"esriMdSliderHorizontal"\x3e\r\n  \x3ctable class\x3d"esriMdSliderTableHorizontal"\x3e\r\n    \x3ccolgroup\x3e\r\n      \x3ccol class\x3d"esriMdSliderHorizontalCol1"\x3e\r\n      \x3ccol\x3e\r\n    \x3c/colgroup\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd class\x3d"esriMdSliderDimensionInfoCellHorizontal" colspan\x3d"2"\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"dimensionInfo"\x3e\x3c/div\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n    \x3ctr\x3e\r\n      \x3ctd align\x3d"right" valign\x3d"middle"\x3e\x3cbutton data-dojo-type\x3d"dijit/form/Button" data-dojo-props\x3d"iconClass: \'mdsButton mdsPlayButton\'" data-dojo-attach-event\x3d"onClick:_onPlay" \r\n                                               data-dojo-attach-point\x3d"playPauseBtn" type\x3d"button" title\x3d"${_i18n.widgets.mdSlider.NLS_play}"\x3e\x3c/button\x3e\x3c/td\x3e\r\n      \x3ctd class\x3d"esriMdSliderCellHorizontal" data-dojo-attach-point\x3d"mdSliderCell"\x3e\r\n      \x3c/td\x3e\r\n    \x3c/tr\x3e\r\n  \x3c/table\x3e\r\n\x3c/div\x3e\r\n'}});
define("esri/dijit/MultidimensionalSlider","dojo/_base/declare dojo/_base/lang dojo/has dojo/on dojo/json dijit/form/VerticalSlider dojox/form/VerticalRangeSlider dijit/form/VerticalRule dijit/form/VerticalRuleLabels dijit/form/HorizontalSlider dojox/form/HorizontalRangeSlider dijit/form/HorizontalRule dijit/form/HorizontalRuleLabels dijit/_Widget dijit/_Templated dojox/timing/_base dojo/_base/array dojo/Deferred dojo/DeferredList ../layers/MosaicRule ../layers/DimensionalDefinition ../kernel ../lang ./_EventedWidget dojo/text!./templates/MultidimensionalSlider_vertical.html dojo/text!./templates/MultidimensionalSlider_horizontal.html dojo/i18n!../nls/jsapi dojo/dom-class dojo/dom-style dojo/dom-geometry dojo/touch dojo/query dojo/dom-construct dojo/_base/sniff".split(" "),
function(D,h,A,r,B,F,G,H,I,J,K,L,M,y,N,O,g,P,Q,R,S,T,p,U,V,W,X,v,t,C,x,E,z){var w={LAYOUT_VERTICAL:"vertical",LAYOUT_HORIZONTAL:"horizontal"};y=D([U,y,N],{declaredClass:"esri.dijit.MultidimensionalSlider",widgetsInTemplate:!0,templateString:V,nLabels:10,_thumbCount:1,useRanges:void 0,loop:!0,useLayersDimSlices:!0,prefetch:!0,prefetchedValues:{},showPlayButton:!0,prefetchFactor:2,_hasUnitConflict:!1,_update:!0,useDefaults:!1,playDirectionAscending:!0,unitSymbols:{meter:"m",pascal:"Pa"},_eventMap:{"dimension-value-change":!0,
play:!0,pause:!0,next:!0,previous:!0,change:!0,"dimension-array-create":!0},onChange:function(){},onPlay:function(){},onPause:function(){},onDimensionValueChange:function(){},_onPlay:function(){this.playing=!this.playing;this._updateUI();this.playing?(this._timer.start(),this.onPlay()):(this._timer.stop(),this.onPause())},constructor:function(a,b){D.safeMixin(this,a);this.playing=!1;this._iconClass="mdsButton mdsPlayButton";this.map&&this._getImageLayers();this.layout===w.LAYOUT_HORIZONTAL&&(this.templateString=
W);this.thumbMovingRate=this.thumbMovingRate||3E3;this._i18n=X;this.prefetchImgNodes={}},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments);var a=this;this._getAllLayersMDInfo().then(function(){a._sortDimensionValues();a.dimensionValues=a.dimensionValues&&a.dimensionValues.length&&!a.useLayersDimSlices?a.dimensionValues:a._mapSortedDimensionValues;a.getUnit();a._setupSlider()});this._timer=new O.Timer;this._timer.setInterval(this.thumbMovingRate);this._timer.onTick=
h.hitch(this,function(){this.playDirectionAscending?this._bumpSlider(1):this._bumpSlider(-1)});this.layout===w.LAYOUT_VERTICAL&&(this.computeSliderStyle(),this.on("resize",h.hitch(this,"computeSliderStyle")));this._setupHandles()},_insertPassiveLabels:function(){var a=E(".dijitSliderMoveable.dijitSliderMoveableV",this.domNode);this._passiveLbl1=z.create("div");v.add(this._passiveLbl1,"esriMdSliderPassiveLbl");z.place(this._passiveLbl1,a[0]);2===this._thumbCount&&(this._passiveLbl2=z.create("div"),
v.add(this._passiveLbl2,"esriMdSliderPassiveLbl"),z.place(this._passiveLbl2,a[1]))},_setupHandles:function(){this._eventHandles=[];this._eventHandles.push(r(this.domNode,"mouseover",h.hitch(this,"activateSlider")));this._eventHandles.push(r(this.domNode,"mouseleave",h.hitch(this,"deactivateSlider")));this._eventHandles.push(r(this.domNode,x.press,h.hitch(this,"activateSlider")));this._eventHandles.push(r(this.domNode,x.release,h.hitch(this,"deactivateSlider")));this._eventHandles.push(r(this.prevBtn.domNode,
x.press,h.hitch(this,"activateSlider")));this._eventHandles.push(r(this.playPauseBtn.domNode,x.press,h.hitch(this,"activateSlider")));this._eventHandles.push(r(this.nextBtn.domNode,x.press,h.hitch(this,"activateSlider")));var a=E(".dijitSliderImageHandle.dijitSliderImageHandleV",this.domNode);g.forEach(a,function(b){this._eventHandles.push(r(b,x.press,h.hitch(this,"activateSlider")));this._eventHandles.push(r(b,x.release,h.hitch(this,"deactivateSlider")))},this)},_removeHandles:function(){g.forEach(this._eventHandles,
function(a){a&&a.remove()})},activateSlider:function(){9>A("ie")&&t.set(this.domNode,"background","#fff");this.sliderActive=!0;this.deactivateTimer&&clearTimeout(this.deactivateTimer);v.remove(this.domNode,"esriMdSliderPassive");v.add(this.domNode,"esriMdSliderActive");t.set(this._passiveLbl1,"display","none");this._passiveLbl2&&t.set(this._passiveLbl2,"display","none")},deactivateSlider:function(){if(!(10>A("ie"))){var a=this;this.deactivateTimer=setTimeout(function(){a.sliderActive=!1;a.updatePassiveLabels();
v.remove(a.domNode,"esriMdSliderActive");v.add(a.domNode,"esriMdSliderPassive");a._showPassiveLabels()},2500)}},updatePassiveLabels:function(){this._slider&&p.isDefined(this._slider.value)&&(this._passiveLbl1.innerHTML=this.value.length?this.value[0]:this.value,this._slider.value.length&&(this._passiveLbl2.innerHTML=this.value[1]),this.sliderActive||this._showPassiveLabels())},_showPassiveLabels:function(){p.isDefined(this.value)&&(t.set(this._passiveLbl1,"display","inline-block"),this.value.length?
t.set(this._passiveLbl2,"display","inline-block"):this._passiveLbl2&&t.set(this._passiveLbl2,"display","none"))},increment:function(){var a=1;!this.playDirectionAscending&&this.playing&&(a=-1);this._bumpSlider(a)},decrement:function(){var a=-1;!this.playDirectionAscending&&this.playing&&(a=1);this._bumpSlider(a)},_setDimensionAttr:function(a){this._slider&&(a.dimension&&(this.dimension=a.dimension),this.dimensionValues=a.dimensionValues&&a.dimensionValues.length?a.dimensionValues:[],this.update())},
update:function(){var a=this;this._mapSortedDimensionValues=[];this._getImageLayers();this.value=this.dimensionValues[this._slider.value];this._getAllLayersMDInfo().then(function(){a._sortDimensionValues();a.getUnit();a.dimensionValues&&a.dimensionValues.length&&!a.useLayersDimSlices||(a.dimensionValues=a._mapSortedDimensionValues);a._setupSlider()})},pause:function(){this.playing=!1;this._updateUI();this._timer.stop()},play:function(a){!0!==this.playing&&(this.playing=!1,this._onPlay())},_setupSlider:function(){this._destroySlider();
this.dimensionValues&&this.dimensionValues.length&&(this.sliderNode=document.createElement("div"),this._getDimensionAlias(),this._layers&&this._layers.length&&1===this._layers.length&&this._readMosaicRule(),this._createRule(),this._createLabels(),this._createSlider(),this._insertPassiveLabels(),this._slider.onChange(this._slider.value))},_createLabels:function(){this.layout===w.LAYOUT_HORIZONTAL?this._createHorizontalLabels():this._createVerticalLabels()},_createRule:function(){this.layout===w.LAYOUT_HORIZONTAL?
this._createHorizontalRule():this._createVerticalRule()},_createVerticalLabels:function(){this.labelsNode=document.createElement("div");this.sliderNode.appendChild(this.labelsNode);this._sliderLabels=new I({labels:this._filterLabels(),labelStyle:"font-size: 83%; padding-left: 5px;"},this.labelsNode)},_createVerticalRule:function(){this.rulesNode=document.createElement("div");this.sliderNode.appendChild(this.rulesNode);100>=this.dimensionValues.length&&(this._sliderRules=new H({count:this.dimensionValues.length,
style:"width:5px;"},this.rulesNode),this._sliderRules.startup())},_createHorizontalLabels:function(){this.labelsNode=document.createElement("div");this.sliderNode.appendChild(this.labelsNode);this._sliderLabels=new M({labels:this._filterLabels(),labelStyle:"font-size: 83%"},this.labelsNode)},_createHorizontalRule:function(){this.rulesNode=document.createElement("div");this.sliderNode.appendChild(this.rulesNode);100>=this.dimensionValues.length&&(this._sliderRules=new L({count:this.dimensionValues.length,
style:"height:5px;"},this.rulesNode),this._sliderRules.startup())},_createHorizontalSingleSlider:function(a){a=a?a:this.playDirectionAscending?0:this.dimensionValues.length-1;this._slider=new J({name:"horizontal",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:"width: 100%;",increment:h.hitch(this,"increment"),decrement:h.hitch(this,"decrement"),value:a||0,onChange:h.hitch(this,this._onSingleSliderChange),showButtons:!1},this.sliderNode);
this._slider.startup()},_createHorizontalRangeSlider:function(a){a=a?a:this.playDirectionAscending?[0,1]:[this.dimensionValues.length-2,this.dimensionValues.length-1];this._slider=new K({name:"horizontal",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:"width:100%;",increment:h.hitch(this,"increment"),decrement:h.hitch(this,"decrement"),value:a||[0,1],onChange:h.hitch(this,this._onRangeSliderChange),showButtons:!1},this.sliderNode);
this._slider.startup();r(this._slider.incrementButton,"click",this._slider.increment);r(this._slider.decrementButton,"click",this._slider.decrement);this._slider._typematicCallback=function(){}},_createVerticalSingleSlider:function(a){a=p.isDefined(a)?a:this.playDirectionAscending?0:this.dimensionValues.length-1;this._slider=new F({name:"vertical",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:this.computeSliderStyle(),increment:h.hitch(this,
"increment"),decrement:h.hitch(this,"decrement"),value:a||0,onChange:h.hitch(this,this._onSingleSliderChange),showButtons:!1},this.sliderNode);this._slider.startup()},_createVerticalRangeSlider:function(a){a=a?a:this.playDirectionAscending?[0,1]:[this.dimensionValues.length-2,this.dimensionValues.length-1];this._slider=new G({name:"vertical",minimum:0,maximum:this.dimensionValues.length-1,intermediateChanges:!1,discreteValues:this.dimensionValues.length,style:this.computeSliderStyle(),increment:h.hitch(this,
"increment"),decrement:h.hitch(this,"decrement"),value:a||[0,1],onChange:h.hitch(this,this._onRangeSliderChange),showButtons:!1},this.sliderNode);this._slider.startup();this._slider._typematicCallback=function(){}},_onSingleSliderChange:function(a){var b=this.dimensionValues[a];this.setDimensionInfoText(b);g.forEach(this._layers,function(c){this._updateMosaicRule(c,b);this.prefetch&&this.playing&&"esri.layers.RasterXLayer"!==c.declaredClass&&this._prefetchData(a,c)},this);this._oldValue=a;this.value=
b;this.updatePassiveLabels();this.onChange(b)},_onRangeSliderChange:function(a){if(this._update){this._snap&&(a=this._snapToNearestRange(a));var b=[this.dimensionValues[a[1]],this.dimensionValues[a[0]]];b.sort(this._sortCompareFunction);this.value=b;this.setDimensionInfoText(b);this.updatePassiveLabels();g.forEach(this._layers,function(c){this._updateMosaicRule(c,b);this.prefetch&&this.playing&&this._prefetchData(a,c)},this);this._update=!0;this._oldValue=h.clone(a);this.onChange(b)}},destroy:function(){this.inherited(arguments);
this._timer.stop();this._destroySlider();this._removeHandles()},_destroySlider:function(){if(this._slider)try{this._slider.destroy()}catch(a){this._slider.domNode&&z.destroy(this._slider.domNode)}finally{this._slider=null}},_createSlider:function(){this.mdSliderCell.appendChild(this.sliderNode);if(this.value&&this.value.length&&0<=g.indexOf(this.dimensionValues,this.value[0])&&0<=g.indexOf(this.dimensionValues,this.value[1]))var a=[g.indexOf(this.dimensionValues,this.value[0]),g.indexOf(this.dimensionValues,
this.value[1])];else if(p.isDefined(this.value)){var b=g.indexOf(this.dimensionValues,this.value);0<=b&&(a=b)}p.isDefined(a)||(a=this._getDefaultSliderValue());this.useDefaults&&p.isDefined(a)&&(a===this.dimensionValues.length-1||a.length&&0<=g.indexOf(a,this.dimensionValues.length-1))&&(this.playDirectionAscending=!1);2===this._thumbCount?this.layout===w.LAYOUT_HORIZONTAL?this._createHorizontalRangeSlider(a):this._createVerticalRangeSlider(a):this.layout===w.LAYOUT_HORIZONTAL?this._createHorizontalSingleSlider(a):
this._createVerticalSingleSlider(a)},_getDefaultSliderValue:function(){if(this.dimensionValues&&this.dimensionValues.length){var a=Infinity,b=1,c;if(this.dimension&&"stdz"===this.dimension.toLowerCase())for(c=0;c<this.dimensionValues.length;c++){var d=this.dimensionValues[c];var e=Math.abs(d-0);if(e<a){a=e;var f=d}if(0===e)break}else f=this.dimensionValues[0];f=g.indexOf(this.dimensionValues,f);f=0>f?0:f;2===this._thumbCount&&(f===this.dimensionValues.length-1&&(b=-1),f=[f,f+b]);return f}},_getMultidimensionalInfo:function(a){function b(){a.getMultidimensionalInfo().then(function(d){a.multidimensionalInfo=
d;c.resolve(a)},function(d){c.reject(d)})}var c=new P;if(a.multidimensionalInfo)c.resolve(a);else if(a.loaded)b();else a.on("load",function(){b()});return c},_getAllLayersMDInfo:function(){var a=[];g.forEach(this._layers,function(b){a.push(this._getMultidimensionalInfo(b))},this);return new Q(a)},_getImageLayers:function(){var a=this.map.layerIds.concat(this.map.graphicsLayerIds),b;this._layers=[];g.forEach(a,function(c){b=this.map.getLayer(c);"esri.layers.ArcGISImageServiceLayer"!==b.declaredClass&&
"esri.layers.ArcGISImageServiceVectorLayer"!==b.declaredClass&&"esri.layers.RasterLayer"!==b.declaredClass&&"esri.layers.WCSLayer"!==b.declaredClass&&"esri.layers.RasterXLayer"!==b.declaredClass||this._layers.push(b)},this);return this._layers},_sortCompareFunction:function(a,b){return p.isDefined(a)&&p.isDefined(b)?a-b:!1},_getDimensionObjects:function(){function a(d){if(d&&d.values&&d.hasRanges){var e=[];g.forEach(d.values,function(f){f.length?e=b(e,f):e.push.apply(b(e.sort(this._sortCompareFunction),
[f]))},this);e=e.sort(c._sortCompareFunction);d.decodedValues=e}return d}var b=this._merge,c=this;this._allRangeValues=!0;this._thumbCount=1;this._snap=!1;this._dimensionObjects=[];this._layers=this._filterLayers();g.forEach(this._layers,function(d){d.multidimensionalInfo&&g.some(d.multidimensionalInfo.variables,function(e){g.some(e.dimensions,function(f){f.name!==this.dimension||f.hasRanges||(this._allRangeValues=!1)},this)},this)},this);this.useRanges?(this._thumbCount=2,this._snap=!1):this._allRangeValues&&
this.useLayersDimSlices?(this._thumbCount=2,this._snap=!0):this._snap=!1;g.forEach(this._layers,function(d){d.multidimensionalInfo&&g.some(d.multidimensionalInfo.variables,function(e){g.some(e.dimensions,function(f){f.name===this.dimension&&(this._allRangeValues&&f.hasRanges||this.useRanges?this._dimensionObjects.push(a(h.clone(f))):this._dimensionObjects.push(h.clone(f)))},this)},this)},this)},_merge:function(a,b){for(var c=[],d=0,e=0;d<a.length&&e<b.length;)a[d]<b[e]?c.push(a[d++]):a[d]>b[e]?c.push(b[e++]):
(c.push(b[e++]),d++);c=c.concat(a.slice(d)).concat(b.slice(e));return c=g.filter(c,function(f,n,m){return m.indexOf(f)===n})},_mergeRangeArrays:function(a,b){for(var c=[],d=0,e=0;d<a.length&&e<b.length;)a[d][0]<b[e][0]||a[d][0]===b[e][0]&&a[d][1]<b[e][1]?c.push(a[d++]):a[d][0]>b[e][0]||a[d][0]===b[e][0]&&a[d][1]>b[e][1]?c.push(b[e++]):(c.push(b[e++]),d++);c=c.concat(a.slice(d)).concat(b.slice(e));return c=g.filter(c,function(f,n,m){return m.indexOf(f)===n},this)},_sortDimensionValues:function(){var a=
0,b=this._merge,c=this._mergeRangeArrays;this._getDimensionObjects();1<=this._dimensionObjects.length&&(this._mapSortedDimensionValues=this._dimensionObjects[0].decodedValues||this._dimensionObjects[0].values,this._allRangeValues&&(this._dimensionRangeValues=this._dimensionObjects[0].values));if(1<this._dimensionObjects.length)for(a=1;a<this._dimensionObjects.length;a++)this._mapSortedDimensionValues=b(this._mapSortedDimensionValues,this._dimensionObjects[a].decodedValues||this._dimensionObjects[a].values),
this._allRangeValues&&(this._dimensionRangeValues=c(this._dimensionRangeValues,this._dimensionObjects[a].values))},_createDimensionalDefinition:function(a,b){a=[a];return new S({variableName:b,dimensionName:this.dimension,values:a,isSlice:1===a.length})},_updateMosaicRule:function(a,b){var c=!1,d=a.mosaicRule||a.defaultMosaicRule||new R({multidimensionalDefinition:[]}),e="esri.layers.WCSLayer"===a.declaredClass,f="esri.layers.RasterXLayer"===a.declaredClass,n=(e?a.multidimensionalDefinition:d.multidimensionalDefinition)||
[];b.length&&b.sort(this._sortCompareFunction);g.forEach(n,function(q){q.dimensionName===this.dimension&&(q.values=[b],q.isSlice=!this.useRanges,c=!0)},this);if(!c){var m="",u=g.filter(a.multidimensionalInfo.variables,function(q){return g.some(n,function(k){return k.variableName&&k.variableName.toLowerCase()===q.name.toLowerCase()},this)},this);0===u.length&&(u=a.multidimensionalInfo.variables);g.some(u,function(q){if(g.some(q.dimensions,function(k){if(k.name===this.dimension){if(e||f)m=q.name;return!0}},
this))return!0},this)&&(n.push(this._createDimensionalDefinition(b,m)),c=!0)}c&&(e&&a.setMultidimensionalDefinition(n),f?a.setMultiDimensionalDefinition(d):(d.multidimensionalDefinition=n,a.setMosaicRule(d)))},_prefetchData:function(a,b){if(b&&(b.mosaicRule||b.multidimensionalDefinition)){var c,d,e=!1,f,n=this,m;this.prefetchedValues[b.id]||(this.prefetchedValues[b.id]=[]);this.prefetchImgNodes[b.id]=[];var u=h.clone(b._params);var q=(d=h.clone(b.mosaicRule))&&d.multidimensionalDefinition||h.clone(b.multidimensionalDefinition);
for(c=1;c<=this.prefetchFactor;c++)e=!1,g.forEach(q,function(k){k.dimensionName===this.dimension&&(this.playDirectionAscending?a.length?(this.snap?(f=this._getNextRangeIndex(a)||a,k.values=[this.dimensionValues[f[0]],this.dimensionValues[f[1]]]):k.values=[this.dimensionValues[(a[0]+c)%this.dimensionValues.length],this.dimensionValues[(a[1]+c)%this.dimensionValues.length]],k.values.sort(this._sortCompareFunction)):k.values=[this.dimensionValues[(a+c)%this.dimensionValues.length]]:a.length?(this.snap?
(f=this._getNextRangeIndex(a,-1)||a,k.values=[this.dimensionValues[f[0]],this.dimensionValues[f[1]]]):k.values=[this.dimensionValues[(this.dimensionValues.length+a[0]-c)%this.dimensionValues.length],this.dimensionValues[(this.dimensionValues.length+a[1]-c)%this.dimensionValues.length]],k.values.sort(this._sortCompareFunction)):k.values=[this.dimensionValues[(this.dimensionValues.length+a-c)%this.dimensionValues.length]],g.some(this.prefetchedValues[b.id],function(l){if(B.stringify(l)===B.stringify(k.values))return!0})||
(e=!0,this.prefetchedValues[b.id].push(k.values)))},this),e&&"esri.layers.WCSLayer"!==b.declaredClass&&(u.mosaicRule=B.stringify(d.toJson()),b.getImageUrl(this.map.extent,this.map.width,this.map.height,function(k){m=new Image;n.prefetchImgNodes[b.id].push(m);m.src=k},u))}},setDimensionInfoText:function(a){if(p.isDefined(a)){var b=this.unitSymbol||this.unit;if("number"!==typeof a){a=h.clone(a.sort(this._sortCompareFunction));if(0!==a[0]%1||0!==a[1]%1)a[0]=parseFloat(a[0].toFixed(2)),a[1]=parseFloat(a[1].toFixed(2));
a="["+a[0]+", "+a[1]+"]"}else 0!==a%1&&(a=a.toFixed(2));this.dimensionInfo.innerHTML=this.unitSymbol?"\x3clabel style\x3d'font-weight:700;'\x3e"+this.dimensionAlias+" ("+b+")\x3c/label\x3e":"\x3clabel style\x3d'font-weight:700;'\x3e"+this.dimensionAlias+"\x3c/label\x3e";this.dimensionInfo.innerHTML=this.layout===w.LAYOUT_HORIZONTAL?this.dimensionInfo.innerHTML+(": "+a):this.dimensionInfo.innerHTML+("\x3cbr/\x3e "+a)}},setLabels:function(a){},_filterLabels:function(){if(this.nLabels&&this.dimensionValues&&
this.dimensionValues.length){var a=Math.ceil(this.dimensionValues.length/this.nLabels);return g.map(this.dimensionValues,function(b,c){return 0===c%a||c===this.dimensionValues.length-1?(0!==b%1&&(b=parseFloat(b.toFixed(2))),b):""},this)}},_filterLayers:function(){return g.filter(this._layers,function(a){if(a.multidimensionalInfo&&a.visible&&a.useMapDimensionValue&&g.some(a.multidimensionalInfo.variables,function(b){if(g.some(b.dimensions,function(c){if(c.name===this.dimension)return!0},this))return!0},
this))return!0},this)},_updateUI:function(){v.remove(this.playPauseBtn.iconNode,this._iconClass);this._iconClass=this.playing?"mdsButton mdsPauseButton":"mdsButton mdsPlayButton";v.add(this.playPauseBtn.iconNode,this._iconClass)},_bumpSlider:function(a){var b=this._slider.value;if(0<=a)!this._snap&&(0>b||b>=this.dimensionValues.length-1||b[0]>=this.dimensionValues.length-1||b[1]>=this.dimensionValues.length-1)?this._timer.isRunning&&(this.loop?(this._timer.stop(),this.prefetchedValues={},this.prefetchImgNodes=
{},2===this._thumbCount?this._snap?this._slider.set("value",this._getNextRangeIndex(b)):this._slider.set("value",[0,Math.abs(b[0]-b[1])]):this._slider.set("value",0),this._timer.start(),this.playing=!0):this.pause()):2===this._thumbCount&&!this._snap&&b[0]<this.dimensionValues.length-1&&b[1]<this.dimensionValues.length-1?this._slider.set("value",[b[0]+1,b[1]+1]):1===this._thumbCount&&b<this.dimensionValues.length-1?this._slider.set("value",b+1):this._snap&&this._slider.set("value",this._getNextRangeIndex(b));
else if(0>=b||0>=b[0]||0>=b[1])this._timer.isRunning&&(this.loop?(this._timer.stop(),this.prefetchedValues={},2===this._thumbCount?this._snap?this._slider.set("value",this._getNextRangeIndex(b,-1)):this._slider.set("value",[this.dimensionValues.length-1,this.dimensionValues.length-1-Math.abs(b[0]-b[1])]):this._slider.set("value",this.dimensionValues.length-1),this._timer.start(),this.playing=!0):this.pause());else if(0<=b||0<=b[1])2===this._thumbCount&&0<b[1]&&0<b[0]?this._snap?this._slider.set("value",
this._getNextRangeIndex(b,-1)):this._slider.set("value",[b[0]-1,b[1]-1]):1===this._thumbCount&&0<b&&this._slider.set("value",b-1)},setThumbMovingRate:function(a){this.thumbMovingRate=a;this._timer&&this._timer.setInterval(this.thumbMovingRate)},getFullDimensionRange:function(a){a=a||this.dimension;var b,c;g.forEach(this._layers,function(d){d.multidimensionalInfo&&d.multidimensionalInfo.variables&&g.forEach(d.multidimensionalInfo.variables,function(e){g.forEach(e.dimensions,function(f){if(f.name===
a&&f.extent&&f.extent.length&&1<f.extent.length){if(!p.isDefined(b)||f.extent[0]<b)b=f.extent[0];if(!p.isDefined(c)||f.extent[1]>c)c=f.extent[1]}},this)},this)},this);return[b,c]},setThumbCount:function(a){this._thumbCount=2==a?2:1;this.value=this.dimensionValues[this._slider.value];this._setupSlider()},clearDimensionalDefinition:function(a){var b=[];if(a&&a.mosaicRule&&a.mosaicRule.multidimensionalDefinition){var c=a.mosaicRule;var d=c.multidimensionalDefinition;g.forEach(d,function(e){e.dimensionName!==
this.dimension&&b.push(e)},this);c.multidimensionalDefinition=b;a.setMosaicRule(c)}},getUnit:function(){var a=null,b=!1;this.unit=null;g.forEach(this._layers,function(c){c.multidimensionalInfo&&g.forEach(c.multidimensionalInfo.variables,function(d){g.forEach(d.dimensions,function(e){e.name===this.dimension&&e.unit&&(null!=a||b?p.isDefined(e.unit)&&e.unit.replace("esri","").toLowerCase()!==a.toLowerCase()&&(a=null,b=!0):a=e.unit.replace("esri",""))},this)},this)},this);a&&(a=a.replace("esri",""));
this.unit=a;this.unitSymbol=this.getUnitSymbol();this._hasUnitConflict=b;return a},_getDimensionAlias:function(){this.dimensionAlias=this.dimension;g.some(this._layers,function(a){if(a.fields&&a.fields.length&&g.some(a.fields,function(b){if(b.name&&b.name===this.dimension&&b.alias)return this.dimensionAlias=b.alias,!0},this))return!0},this)},_readMosaicRule:function(){var a;g.forEach(this._layers,function(b){(b=b.mosaicRule&&b.mosaicRule.multidimensionalDefinition||b.multidimensionalDefinition)&&
g.forEach(b,function(c){c&&c.dimensionName===this.dimension&&c.values&&(a=c.values.length&&c.values[0]&&c.values[0].length?c.values[0]:c.values)},this)},this);this.useRanges=p.isDefined(this.useRanges)?this.useRanges:a&&1!==a.length?!0:!1;a&&(this.useRanges?(this._thumbCount=2,this.value=1===a.length?[a[0],this.dimensionValues[this.dimensionValues.length-1]]:a):1<a.length&&this._snap?(this._thumbCount=2,this.value=a):(this._thumbCount=1,this.useRanges=!1,this.value=a[0]))},hasUnitConflict:function(){this.getUnit();
return this._hasUnitConflict},resizeSlider:function(a,b){t.set(this.domNode,{height:a+"px",width:b+"px"});t.set(this.mdSliderTable,{height:a+"px",width:b+"px"});this.computeSliderStyle()},computeSliderStyle:function(){var a=C.getContentBox(this.domNode).h-C.getContentBox(this.dimensionInfo).h-(C.getContentBox(this.playPauseBtnRow).h+20);10>=A("ie")&&(a-=53);var b="height: "+a+"px;";this._slider&&this._slider.domNode&&t.set(this._slider.domNode,"height",a+"px");return b},getUnitSymbol:function(){if(!p.isDefined(this.unit))return null;
var a=this.unit.toLowerCase();if("meters"===a||"meter"===a)return this.unitSymbols.meter;if("pascal"===a||"pascals"===a)return this.unitSymbols.pascal},_snapToNearestRange:function(a){if(a&&a.length&&this._snap){var b,c,d,e=this;var f=[this.dimensionValues[a[1]],this.dimensionValues[a[0]]];f.sort(this._sortCompareFunction);if(g.some(this._dimensionObjects,function(k){if(g.some(k.values,function(l){if(l&&l.length&&l[0]===f[0]&&l[1]===f[1])return!0}))return!0},this))return a;if(g.some(this._dimensionObjects,
function(k){if(g.some(k.values,function(l){if(l&&l.length&&l[0]===f[0])return b=h.clone(l.sort(this._sortCompareFunction)),!0},this))return!0},this)){g.some(this.dimensionValues,function(k,l){k===b[0]&&(c=l);k===b[1]&&(d=l)});var n=Math.abs(a[0]-c);var m=[c,d]}if(g.some(this._dimensionObjects,function(k){if(g.some(k.values,function(l){if(l&&l.length&&l[1]===f[1])return b=h.clone(l.sort(this._sortCompareFunction)),!0},this))return!0},this)){g.some(this.dimensionValues,function(k,l){k===b[1]&&(d=l);
k===b[0]&&(c=l)});var u=Math.abs(a[1]-d);var q=[c,d]}a=n&&u?this._oldValue&&this._oldValue.length&&this._arraysEqual(this._oldValue,m)?q:this._oldValue&&this._oldValue.length&&this._arraysEqual(this._oldValue,q)?m:n<=u?m:q:m||q||a;this._update=!1;setTimeout(function(){e._slider.set("value",a)},100);return a}},_arraysEqual:function(a,b){var c;if(!p.isDefined(a)||!p.isDefined(b))return!1;if(a===b)return!0;if(a.length!==b.length)return!1;a.sort(this._sortCompareFunction);b.sort(this._sortCompareFunction);
for(c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0},_getNextRangeIndex:function(a,b){if(!this._dimensionRangeValues||!this._dimensionRangeValues.length)return null;var c,d,e;b=p.isDefined(b)?b:1;g.some(this._dimensionRangeValues,function(n,m){if(this._arraysEqual(n,[this.dimensionValues[a[0]],this.dimensionValues[a[1]]]))return c=m,!0},this);var f=this._dimensionRangeValues[0<b?(c+1)%this._dimensionRangeValues.length:(this._dimensionRangeValues.length+c-1)%this._dimensionRangeValues.length];
g.some(this.dimensionValues,function(n,m){n===f[0]&&(d=m);n===f[1]&&(e=m);if(d&&e)return!0},this);return[d,e]}});h.mixin(y,w);A("extend-esri")&&h.setObject("dijit.MultidimensionalSlider",y,T);return y});