// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/DimensionalProfile/templates/DimensionalProfile.html":'\x3cdiv role\x3d"presentation" class\x3d"${baseClass}" data-dojo-attach-point\x3d"containerNode"\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"_chartNode" class\x3d"${baseClass}ChartNode"\x3e\x3c/div\x3e\r\n    \x3cdiv\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"_chartLegendNode"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("esri/dijit/DimensionalProfile/MultiDimensionalProfile","dojo/aspect dojo/_base/declare dojo/_base/lang dojo/_base/array dijit/registry dijit/_WidgetBase dijit/_OnDijitClickMixin dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/_base/Color dojox/charting/Chart dojox/charting/plot2d/Grid dojox/charting/plot2d/Markers dojox/charting/themes/ThreeD dojox/charting/SimpleTheme dojox/charting/widget/SelectableLegend dojox/charting/action2d/Magnify dojox/charting/action2d/Highlight dojox/charting/action2d/Tooltip ../../request ../../graphic ../../TimeExtent ../../layers/DimensionalDefinition ../../layers/RasterFunction dojo/i18n!../../nls/jsapi dojo/text!./templates/DimensionalProfile.html xstyle/css!./css/MultiDimensionalProfile.css".split(" "),function(u,
v,g,n,t,w,x,y,z,r,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P){return v([w,x,y,z],{declaredClass:"esri.dijit.MultiDimensionalProfile",baseClass:"esriMultiDimensionalChart",templateString:P,SERIES_NAME_DIMENSIONS:"Dimensions",SERIES_NAME_LEGEND:"Point",_samplingDataCount:50,_reduceDataPoints:!0,_chartRenderingOptions:null,_defaultXAxisRange:{min:Number.MAX_VALUE,max:Number.MIN_VALUE},_defaultYAxisRange:{min:0,max:100},_xAxisRange:null,_yAxisRange:null,_profileResults:[],_maxResultCount:4,_map:null,_layers:[],
_dimension:null,_variable:null,_chart:null,_valueIndicator:[],_drawProfileGeometry:!0,_mapGraphics:[],_chartLocationGraphic:null,_posIndicator:null,_negIndicator:null,_chartLocationGraphicsLayer:null,_defaultMapSymbol:{type:"esriSMS",style:"esriSMSCross",color:[0,0,0,0],size:13,angle:0,xoffset:0,yoffset:0,outline:{type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:3}},_profileSeries:[{stroke:"#ff00a9",fill:""},{stroke:"#00ff00",fill:""},{stroke:"#ff5722",fill:""},{stroke:"#0900ff",fill:""},
{stroke:"#845422",fill:""},{stroke:"#6C618D",fill:""}],_highlightColor:"#ffff00",_highlightSeriesName:"Current Selection",constructor:function(a){this._layers=[];this._i18n=O;a.hasOwnProperty("map")&&(this._map=a.map);a.hasOwnProperty("layers")&&a.layers.forEach(function(b){b.options=this._updateLayerOptions(b);this._layers.push(b)},this);1<this._layers.length&&(this._maxResultCount=this._layers.length);a.hasOwnProperty("dimension")&&(this._dimension=a.dimension);a.hasOwnProperty("variable")&&(this._variable=
a.variable);this._chartRenderingOptions=g.mixin({xAxisTitle:"X",yAxisTitle:"Y",chartFontFamily:"verdana",chartTitleFontSize:13,axisTitleFontSize:11,axisLabelFontSize:9,indicatorFontColor:"#eee",indicatorFillColor:"#666",titleFontColor:"#eee",axisFontColor:"#ccc",axisMajorTickColor:"#333",profileBackgroundTopColor:[250,250,250,.8],profileBackgroundBottomColor:[229,230,235,.7],profileLineColor:"#D2B48C",profileTopColor:"#8B4513",profileBottomColor:"#CD853F",indicatorMarkerStrokeColor:"#FF0000",indicatorMarkerSymbol:"m -6 -6, l 12 12, m 0 -12, l -12 12",
profileGeometrySymbol:this._defaultMapSymbol},a.chartOptions||{})},postCreate:function(){this.inherited(arguments);null!==t.getEnclosingWidget(this.domNode)&&this.own(u.after(t.getEnclosingWidget(this.domNode),"resize",g.hitch(this,this.resize),!0))},startup:function(){this.inherited(arguments);if(this._map&&this._layers.length&&this._dimension)if(this.map.loaded)this._initProfile();else this.map.on("load",g.hitch(this,this._initProfile));else this.emit("error",Error(this._i18n.widgets.DimensionalProfile.errors.MissingInputParameters)),
this.destroy()},clear:function(){this._clearProfileGeometriesOnMap();this._resetProfileResults();this._clearIndicators();this._clearChart();this.emit("clear")},refresh:function(){this.emit("refresh")},update:function(a){a?(a=this._reduceProfileResults(g.mixin({},a)),this._updateProfileResults(a),this._updateChart(a),this._updateGraphic(a),this._updateIndicators(),this.emit("update",a)):this.emit(Error(this._i18n.widgets.DimensionalProfile.errors.InvalidProfileResults))},resize:function(){this.inherited(arguments);
this._chart&&this._chart.resize()},destroy:function(){this._chart&&this._chart.destroy();this.inherited(arguments)},_updateLayerOptions:function(a){if(!a||!a.options)return{};var b=g.mixin({},a.options);if(a=a.options.renderingRule){var c=new N(a);c.functionName=a;b.renderingRule=c}return b},_setProfileGeometryAttr:function(a){a?(this._map.setMapCursor("progress"),this._clearMapTime(),this._layers.forEach(g.hitch(this,function(b){var c=this._createNewMapGraphic(a);this._drawProfileGeometryOnMap(c);
this._getProfile(b,c).then(g.hitch(this,function(d){this._map.setMapCursor("default");this.update(d)}),g.hitch(this,function(d){this._map.setMapCursor("default");this.emit("error",d)}))}))):this.emit("error",Error(this._i18n.widgets.DimensionalProfile.errors.NullGeometry))},_setTitleAttr:function(a){this._chart&&(this._chart.title=a,this._chart.dirty=!0,this._chart.render(),this.emit("title-changed"))},_resetProfileResults:function(){this._xAxisRange=g.mixin({},this._defaultXAxisRange);this._yAxisRange=
g.mixin({},this._defaultYAxisRange);this._profileResults=[]},_initProfile:function(){this._buildProfileSeries();this._getDefaultDimensionalRange().then(g.hitch(this,function(a){this._defaultXAxisRange=a;this._resetProfileResults();this._buildChart();this.emit("load")}))},_buildProfileSeries:function(){var a=0,b=2===this._layers.length,c=this._layers[0].options,d,f,e;var h=d=c&&c.legendLabel;c=f=c&&c.seriesColor;if(b){var k=(e=this._layers[1].options)&&e.legendLabel;e=e&&e.seriesColor}for(a;a<this._maxResultCount;a++){if(a<
this._profileSeries.length&&b)h=0===Math.abs(a%2)?d:k,c=0===Math.abs(a%2)?f:e;else if(a<this._profileSeries.length&&!b&&d)h=d+" "+a;else if(a>=this._profileSeries.length){var l="#"+Math.floor(16777215*Math.random()).toString(16);this._profileSeries.push({stroke:l,fill:""})}c&&(this._profileSeries[a].stroke=c);this._profileSeries[a].name=this.SERIES_NAME_DIMENSIONS+"_"+a;this._profileSeries[a].legend=h||this.SERIES_NAME_LEGEND+" "+a}},_buildChart:function(){var a=new A(this._chartNode,{title:this._chartRenderingOptions.title,
titlePos:"top",titleGap:10,titleFont:g.replace("normal normal bold {chartTitleFontSize}pt {chartFontFamily}",this._chartRenderingOptions),titleFontColor:this._chartRenderingOptions.titleFontColor});if(2===this._layers.length){var b=new E({markers:{CIRCLE:"m-3,0 c0,-4 6,-4 6,0 m-6,0 c0,4 6,4 6,0",SQUARE:"m-3,-3 l0,6 6,0 0,-6 z"}});a.setTheme(b)}else a.setTheme(D);a.fill="transparent";a.theme.axis.stroke.width=2;a.theme.axis.majorTick.color=r.named.white.concat(.5);a.theme.axis.majorTick.width=1;a.theme.plotarea.fill=
{type:"linear",space:"plot",x1:50,y1:100,x2:50,y2:0,colors:[{offset:0,color:this._chartRenderingOptions.profileBackgroundTopColor},{offset:1,color:this._chartRenderingOptions.profileBackgroundBottomColor}]};a.addAxis("y",{min:this._yAxisRange.min,max:this._yAxisRange.max,fontColor:this._chartRenderingOptions.axisFontColor,font:g.replace("normal normal bold {axisLabelFontSize}pt {chartFontFamily}",this._chartRenderingOptions),vertical:!0,natural:!0,fixed:!0,includeZero:!1,majorLabels:!0,minorLabels:!0,
majorTicks:!0,minorTicks:!0,majorTick:{color:this._chartRenderingOptions.axisMajorTickColor,length:6},title:this._chartRenderingOptions.yAxisTitle,titleGap:30,titleFont:g.replace("normal normal bold {axisTitleFontSize}pt {chartFontFamily}",this._chartRenderingOptions),titleFontColor:this._chartRenderingOptions.titleFontColor,titleOrientation:"axis"});a.addAxis("x",{min:this._xAxisRange.min,max:this._xAxisRange.max,fontColor:this._chartRenderingOptions.axisFontColor,font:g.replace("normal normal bold {axisLabelFontSize}pt {chartFontFamily}",
this._chartRenderingOptions),natural:!0,fixed:!0,includeZero:!1,majorLabels:!0,minorLabels:!0,majorTicks:!0,minorTicks:!0,majorTick:{color:this._chartRenderingOptions.axisMajorTickColor,length:6},title:this._chartRenderingOptions.xAxisTitle,titleGap:5,titleFont:g.replace("normal normal bold {axisTitleFontSize}pt {chartFontFamily}",this._chartRenderingOptions),titleFontColor:this._chartRenderingOptions.titleFontColor,titleOrientation:"away",labelFunc:g.hitch(this,this._formatChartValues)});a.addPlot("grid",
{type:B,hMajorLines:!0,hMinorLines:!1,vMajorLines:!1,vMinorLines:!1});a.addPlot("default",{type:C,tension:"X"});b={plot:"default",stroke:{width:1.5,color:this._chartRenderingOptions.profileLineColor},fill:this._chartRenderingOptions.profileTopColor};var c=g.clone(b);c.stroke.width=5;c.stroke.color=this._highlightColor;c.fill=this._highlightColor;a.addSeries(this._highlightSeriesName,[],c);c=0;for(c;c<this._maxResultCount;c++){var d=g.clone(b);d.stroke.color=this._profileSeries[c].stroke;d.fill=this._profileSeries[c].stroke;
d.legend=this._profileSeries[c].legend;a.addSeries(this._profileSeries[c].name,[],d)}new G(a,"default",{scale:3});new H(a,"default");new I(a,"default");a.render();a.connectToPlot("default",g.hitch(this,function(f){if("onclick"===f.type){var e=f.run.data[f.index]||f;this._chart.updateSeries(this._highlightSeriesName,[e]);this._chart.render();f=e?new Date(e.closestXValue||e.x):new Date(f.x);this._setMapTime(f,f)}}));b=new F({chart:a,autoScale:!0},this._chartLegendNode);this._chart=a;this._chartLegend=
b},_formatChartValues:function(a,b){return this._dimension&&"stdtime"===this._dimension.toLowerCase()?(new Date(b)).toUTCString().substring(5,16):b},_chartTooltipForX:function(a){if(a)return a=a.x||a,this._dimension&&"stdtime"===this._dimension.toLowerCase()&&(a=(new Date(a)).toUTCString().substring(5,16)),this._chartRenderingOptions.xAxisTitle+": "+a},_chartTooltipForY:function(a){if(a)return a=a.y||a,a="string"===typeof a?parseFloat(a):a,this._chartRenderingOptions.yAxisTitle+": "+a.toFixed(3)},
_getProfile:function(a,b){var c=a.layer,d=b&&b.geometry;if(!c||!b||!d)return Error(this.strings.errors.UnableToProcessResults);d={f:"json",geometry:JSON.stringify(d.toJson()),geometryType:"esriGeometryPoint",returnGeometry:!1,returnCatalogItems:!0};a=a.options;var f=c.mosaicRule||c.defaultMosaicRule;a.variable&&f&&(f=g.clone(f),f.multidimensionalDefinition.push(new M({variableName:a.variable})),d.mosaicRule=JSON.stringify(f.toJson()));f=["value"];var e=a&&a.renderingRule||c.renderingRule;e&&(f.push(e.functionName.toLowerCase()),
d.renderingRule=JSON.stringify(e.toJson()));(a&&a.hasOwnProperty("useMapTime")?a.useMapTime:c.useMapTime)&&this._map.timeExtent&&(d.time=this._map.timeExtent.toJson().join(","));return J({url:c.url+"/identify",handleAs:"json",content:d}).then(g.hitch(this,function(h){if(h&&!(1>h.catalogItems.length)){var k=h.catalogItems.features,l=[],q=this._getLayerVariable(c);n.forEach(k,function(m,p){p=h.properties.Values[p];m=m.attributes;!p||"nodata"===p.toLowerCase()||q&&m.Variable.toLowerCase()!==q.toLowerCase()||
(m={x:m[this.dimension],y:p,tooltip:this._chartTooltipForX(m[this.dimension])+" , "+this._chartTooltipForY(p)},l.push(m))},this);return{values:l,graphic:b}}}),g.hitch(this,function(){return Error(this.strings.errors.UnableToProcessResults)}))},_updateProfileResults:function(a){if(a){this._profileResults.length===this._profileSeries.length?(a.series=this._profileResults[0].series,this._profileResults.shift()):a.series=this._profileSeries[this._profileResults.length];a.values.sort(function(d,f){return d.x-
f.x});this._profileResults.push(a);a={min:Number.MAX_VALUE,max:Number.MIN_VALUE};var b=g.mixin({},a);var c=g.mixin({},a);n.forEach(this._profileResults,function(d){var f=this._getArrayMin(d.values,"x"),e=this._getArrayMax(d.values,"x"),h=this._getArrayMin(d.values,"y");d=this._getArrayMax(d.values,"y");b.min=f<b.min?f:b.min;b.max=e>b.max?e:b.max;c.min=h<c.min?h:c.min;c.max=d>c.max?d:c.max},this);this._xAxisRange=b;this._yAxisRange=c;this._yAxisRange.min=c.min-.03*c.min;this._yAxisRange.max=c.max+
.03*c.max}},_updateChart:function(a){this._chart&&(this._chart.getAxis("x").opt.min=this._xAxisRange.min,this._chart.getAxis("x").opt.max=this._xAxisRange.max,this._chart.getAxis("y").opt.min=this._yAxisRange.min,this._chart.getAxis("y").opt.max=this._yAxisRange.max,this._chart.dirty=!0,a&&this._chart.updateSeries(a.series.name,a.values),this._chart.render(),this._chartLegend.refresh())},_clearChart:function(){if(this._chart){var a;for(a=0;a<this._chart.series.length;a++)this._chart.updateSeries(this._chart.series[a].name,
[]);this._chart.render();this._chartLegend.refresh();this._clearMapTime()}},_clearIndicators:function(){this._valueIndicator&&(n.forEach(this._valueIndicator,function(a){a.destroy();a=null}),this._valueIndicator=[])},_updateIndicators:function(){if(this._chart){this._clearIndicators();var a={mouseOver:!0,font:"normal normal bold 8pt Tahoma",fontColor:this._chartRenderingOptions.indicatorFontColor,fill:this._chartRenderingOptions.indicatorFillColor,markerFill:"none",markerStroke:{color:this._chartRenderingOptions.indicatorMarkerStrokeColor,
width:3},markerSymbol:this._chartRenderingOptions.indicatorMarkerSymbol},b=0;for(b;b<this._profileResults.length;b++){var c=this._getSeriesLegend(this.SERIES_NAME_DIMENSIONS+"_"+b);c={label:c||this._chartRenderingOptions.yAxisTitle};c={labelFunc:g.hitch(c,this._chartTooltipForY)};g.mixin({series:this.SERIES_NAME_DIMENSIONS+"_"+b,offset:{x:10,y:20*(b+1)}},c,a)}this._chart.fullRender()}},_getSeriesLegend:function(a){return(a=this._chart.getSeries(a))?a.legend:""},_createNewMapGraphic:function(a){if(this._map&&
a){var b=this._chartRenderingOptions.profileGeometrySymbol;b=b.hasOwnProperty("type")?b:b.toJson();"esriSMS"!==b.type&&"esriPMS"!==b.type&&(b=this._defaultMapSymbol);return new K({geometry:a,symbol:b})}},_drawProfileGeometryOnMap:function(a){this._map&&a&&this._drawProfileGeometry&&(this._mapGraphics.length===this._maxResultCount&&(this._map.graphics.remove(this._mapGraphics[0]),this._mapGraphics.shift()),this._mapGraphics.push(a),this._map.graphics.add(a))},_updateGraphic:function(a){if(a&&a.graphic){var b=
a.graphic;if(a=a.series)b.symbol.color=new r(a.stroke),b.symbol.outline.color=new r(a.stroke),b.draw()}},_clearProfileGeometriesOnMap:function(){this._mapGraphics&&(n.forEach(this._mapGraphics,function(a){this._map.graphics.remove(a)},this),this._mapGraphics=[])},_reduceProfileResults:function(a){var b=a.values;if(!this._reduceDataPoints||b.length<3*this._samplingDataCount)return a;var c=[],d=this._samplingDataCount/3,f=Math.ceil(b.length/d),e,h=[];for(e=0;e<f;e++){h=0===e?e*d:e*d+1;var k=(e+1)*d;
h=b.slice(h,k);var l=this._getArrayMin(h,"x");var q=this._getArrayMax(h,"x");k=this._getArrayMin(h,"y");var m=this._getArrayMax(h,"y");l=(l+q)/2;k=(k+m)/2;h=this._findClosestValue(l,h,"x");c.push({x:l,y:k,tooltip:this._chartTooltipForX(l)+" , "+this._chartTooltipForY(k),closestXValue:h})}a.values=c;return a},_getArrayMax:function(a,b){a=n.map(a,function(c){return c[b]});return Math.max.apply(Math,a)},_getArrayMin:function(a,b){a=n.map(a,function(c){return c[b]});return Math.min.apply(Math,a)},_getLayerVariable:function(a){var b=
null;a&&a.mosaicRule&&a.mosaicRule.multidimensionalDefinition&&a.mosaicRule.multidimensionalDefinition.length&&(b=a.mosaicRule.multidimensionalDefinition[0].variableName);return b},_getDefaultDimensionalRange:function(){var a=this._layers[0].layer;if(a){var b=this._getLayerVariable(a),c={min:0,max:100};return a.getMultidimensionalInfo().then(g.hitch(this,function(d){d&&d.variables&&d.variables.length&&b&&n.forEach(d.variables,function(f){f.name.toLowerCase()===b.toLowerCase()&&n.forEach(f.dimensions,
function(e){e.name.toLowerCase()===this.dimension.toLowerCase()&&e.extent&&2===e.extent.length&&(c.min=e.extent[0],c.max=e.extent[1])},this)},this);return c}),function(d){console.log(d);return c})}},_setMapTime:function(a,b){var c=new L;c.startTime=a;c.endTime=b;this.map.setTimeExtent(c)},_clearMapTime:function(){this.map.setTimeExtent(this.map.timeSlider?this.map.timeSlider.getCurrentTimeExtent():null)},_findClosestValue:function(a,b,c){var d=b[0][c],f=Math.abs(a-d);b.forEach(function(e){var h=Math.abs(a-
e[c]);h<f&&(f=h,d=e[c])});return d}})});