// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/arcadeProfiles/fieldCalculateProfile","dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../promiseList ../arcade/Feature ../arcade/featureset/support/RecentlyUsedCache ../support/expressionUtils ./utils".split(" "),function(f,l,r,t,u,v,w,c,e){f=new (f(null,{declaredClass:"esri.arcadeProfiles.FieldCalculateProfile",defaults:{globals:{featureSet:["$layer","$datastore"],async:["$layer","$datastore"]},context:{vars:{$feature:"any",$layer:"any",$datastore:"any"}}},_lruCache:null,constructor:function(){this._lruCache=
new w},initialize:function(a){var b=[];e.hasGeometryOperations(a)&&b.push(c.enableGeometryOperations());(e.hasFeatureSetOperations(a)||e.hasVariables(a,this.defaults.globals.featureSet))&&b.push(c.enableFeatureSetOperations());e.isAsync(a)&&b.push(c.enableAsyncOperations());return u(b)},isAsync:function(a){a=[a];return e.hasFeatureSetOperations(a)||e.hasVariables(a,this.defaults.globals.async)},parse:function(a){return c.createSyntaxTree(a.expression)},compile:function(a){var b=l.clone(this.defaults.context);
b.useAsync=a.async;return a.syntaxTree?c.createFunction(a.syntaxTree,b):null},getEvalOptions:function(a){var b=a.expression,h=a.feature,d=a.layer,m=a.spatialReference;a=a.portal;var n,p,g={spatialReference:m,cache:this._lruCache};if(d&&(b.hasVariable("$layer")&&(n=p=d.getMap()?c.createFeatureSetFromLayer(d,g):c.createFeatureSetFromLayerUrl(d.url,g)),b.hasVariable("$datastore")))var k=(k=e.getServiceUrl(d.url))?c.createFeatureSetCollectionFromServiceUrl(k,g):null;b=h&&b.hasVariable("$feature")?v.createFromGraphicLikeObject(h.geometry,
h.attributes,(b.hasFunction("attachments")||b.hasFunction("featuresetbyrelationship"))&&d&&!d.getMap()?p||c.createFeatureSetFromLayerUrl(d.url,g):d):null;if(a){a=a.replace(/\/+$/ig,"");var q={url:a,portalUrl:a+"/sharing/rest"}}return{context:{vars:{$feature:b,$layer:n,$datastore:k},services:q?{portal:q}:null,lrucache:this._lruCache,spatialReference:m}}}}));r("extend-esri")&&l.setObject("arcadeProfiles.fieldCalculateProfile",f,t);return f});