// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/arcadeProfiles/popupProfile","dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../promiseList ../arcade/Feature ../support/expressionUtils ./utils".split(" "),function(g,m,r,t,u,v,c,d){g=new (g(null,{declaredClass:"esri.arcadeProfiles.PopupProfile",defaults:{globals:{featureSet:["$layer","$datastore","$map","$aggregatedfeatures"],async:["$layer","$datastore","$map","$aggregatedfeatures"]},context:{vars:{$feature:"any",$layer:"any",$datastore:"any",$map:"any",$aggregatedfeatures:"any"}}},
initialize:function(a){var b=[];d.hasGeometryOperations(a)&&b.push(c.enableGeometryOperations());(d.hasFeatureSetOperations(a)||d.hasVariables(a,this.defaults.globals.featureSet))&&b.push(c.enableFeatureSetOperations());d.isAsync(a)&&b.push(c.enableAsyncOperations());return u(b)},isAsync:function(a){a=[a];return d.hasFeatureSetOperations(a)||d.hasVariables(a,this.defaults.globals.async)},parse:function(a){return c.createSyntaxTree(a.expression)},compile:function(a){var b=m.clone(this.defaults.context);
b.useAsync=a.async;return a.syntaxTree?c.createFunction(a.syntaxTree,b):null},getEvalOptions:function(a){var b=a.expression,f=a.feature,e=a.layer,k=a.aggregatedFeaturesLayer,n=a.map;a=a.spatialReference;f=f&&b.hasVariable("$feature")?v.createFromGraphicLikeObject(f.geometry,f.attributes,e):null;var p,q;if(e){var h={spatialReference:a};b.hasVariable("$layer")&&(p=e.getMap()?c.createFeatureSetFromLayer(e,h):c.createFeatureSetFromLayerUrl(e.url,h));if(b.hasVariable("$datastore"))var l=(l=d.getServiceUrl(e.url))?
c.createFeatureSetCollectionFromServiceUrl(l,h):null;b.hasVariable("$aggregatedfeatures")&&k&&(q=k.getMap()?c.createFeatureSetFromLayer(k,h):null)}b=n&&b.hasVariable("$map")?c.createFeatureSetCollectionFromMap(n):null;return{context:{vars:{$feature:f,$layer:p,$datastore:l,$map:b,$aggregatedfeatures:q},spatialReference:a}}}}));r("extend-esri")&&m.setObject("arcadeProfiles.popupProfile",g,t);return g});