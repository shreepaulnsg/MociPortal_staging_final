// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/arcade/arcadeAsyncRuntime","require exports ./ArcadePortal ./Attachment ./Dictionary ./Feature ./FunctionWrapper ./ImmutablePathArray ./ImmutablePointArray ./languageUtils ./treeAnalysis ./featureset/support/shared ./functions/array ./functions/date ./functions/geomasync ./functions/geometry ./functions/maths ./functions/stats ./functions/string ./polyfill/promiseUtils ../geometry/Extent ../geometry/Geometry ../geometry/Multipoint ../geometry/Point ../geometry/Polygon ../geometry/Polyline ../SpatialReference".split(" "),
function(Q,u,ea,fa,x,y,E,R,ha,g,p,ia,ja,ka,la,ma,na,oa,pa,l,qa,S,ra,sa,ta,ua,va){function r(b){return b instanceof Error?l.reject(b):l.reject(Error(b))}function T(b){return l.resolve(b)}function H(b,a){for(var c=[],d=0;d<a.arguments.length;d++)c.push(n(b,a.arguments[d]));return l.all(c)}function w(b,a,c){return l.create(function(d,e){H(b,a).then(function(f){try{d(c(b,a,f))}catch(h){e(h)}},e)})}function C(b,a,c){try{return H(b,a).then(function(d){try{var e=c(b,a,d);return e&&"function"===typeof e.then?
e:l.resolve(e)}catch(f){return r(f)}})}catch(d){return r(d)}}function n(b,a,c){try{if(a.breakpoint&&!0!==c)return a.breakpoint().then(function(){return n(b,a,!0)});switch(a.type){case "VariableDeclarator":return wa(b,a);case "VariableDeclaration":return U(b,a,0);case "BlockStatement":try{var d=V(b,a,0)}catch(e){d=r(e)}return d;case "FunctionDeclaration":return xa(b,a);case "ReturnStatement":return ya(b,a);case "IfStatement":return za(b,a);case "ExpressionStatement":return Aa(b,a);case "UpdateExpression":return Ba(b,
a);case "AssignmentExpression":return Ca(b,a);case "ForStatement":return Da(b,a);case "ForInStatement":return Ea(b,a);case "BreakStatement":return l.resolve(g.breakResult);case "EmptyStatement":return l.resolve(g.voidOperation);case "ContinueStatement":return l.resolve(g.continueResult);case "TemplateElement":return l.resolve(a.value?a.value.cooked:"");case "TemplateLiteral":return Fa(b,a);case "Identifier":return I(b,a);case "MemberExpression":return Ga(b,a);case "Literal":return T(a.value);case "CallExpression":return Ha(b,
a);case "UnaryExpression":return Ia(b,a);case "BinaryExpression":return Ja(b,a);case "LogicalExpression":return Ka(b,a);case "ArrayExpression":return La(b,a);case "ObjectExpression":return Ma(b,a);case "Property":return Na(b,a);default:return r(p.nodeErrorMessage(a,"RUNTIME","UNREOGNISED"))}}catch(e){return r(e)}}function Ma(b,a){try{for(var c=[],d=0;d<a.properties.length;d++)c.push(n(b,a.properties[d]));return l.all(c).then(function(e){return l.create(function(f){for(var h={},k=0;k<e.length;k++){var m=
e[k];if(g.isFunctionParameter(m.value))throw Error("Illegal Argument");if(!1===g.isString(m.key))throw Error("Illegal Argument");h[m.key.toString()]=m.value===g.voidOperation?null:m.value}h=new x(h);h.immutable=!1;f(h)})})}catch(e){return r(e)}}function Na(b,a){try{return n(b,a.value).then(function(c){return l.create(function(d){"Identifier"===a.key.type?d({key:a.key.name,value:c}):n(b,a.key).then(function(e){d({key:e,value:c})})})})}catch(c){return l.reject(c)}}function W(b,a,c){try{return n(b,a.body).then(function(d){try{return c.lastAction=
d,c.lastAction===g.breakResult||c.lastAction instanceof g.ReturnResult?(c.testResult=!1,l.resolve(c)):null!==a.update?n(b,a.update).then(function(){return l.resolve(c)}):l.resolve(c)}catch(e){return l.reject(e)}})}catch(d){return l.reject(d)}}function Oa(b,a,c){try{return null!==a.test?n(b,a.test).then(function(d){try{if(!0===b.abortSignal.aborted)return l.reject(Error("Cancelled"));c.testResult=d;return!1===c.testResult?l.resolve(c):!0!==c.testResult?l.reject(Error(p.nodeErrorMessage(a,"RUNTIME",
"CANNOT_USE_NONBOOLEAN_IN_CONDITION"))):W(b,a,c)}catch(e){return l.reject(e)}}):W(b,a,c)}catch(d){return l.reject(d)}}function F(b,a,c,d,e,f){try{Oa(b,a,c).then(function(){try{!0===c.testResult?(f++,100<f?(f=0,setTimeout(function(){F(b,a,c,d,e,f)},0)):F(b,a,c,d,e,f)):c.lastAction instanceof g.ReturnResult?d(c.lastAction):d(g.voidOperation)}catch(h){e(h)}},function(h){e(h)})}catch(h){e(h)}}function Da(b,a){try{return null!==a.init?n(b,a.init).then(function(){return l.create(function(c,d){F(b,a,{testResult:!0,
lastAction:g.voidOperation},function(e){c(e)},function(e){d(e)},0)})}):l.create(function(c,d){F(b,a,{testResult:!0,lastAction:g.voidOperation},function(e){c(e)},function(e){d(e)},0)})}catch(c){return l.reject(c)}}function J(b,a,c,d,e,f,h,k,m,q){try{d<=f?k(g.voidOperation):(e.value="k"===h?c[f]:f,n(b,a.body).then(function(v){try{v instanceof g.ReturnResult?k(v):v===g.breakResult?k(g.voidOperation):(q++,100<q?(q=0,setTimeout(function(){J(b,a,c,d,e,f+1,h,k,m,q)},0)):J(b,a,c,d,e,f+1,h,k,m,q))}catch(K){m(K)}},
function(v){m(v)}))}catch(v){m(v)}}function L(b,a,c,d,e,f,h,k,m){try{c.length()<=e?h(g.voidOperation):(d.value="k"===f?c.get(e):e,n(b,a.body).then(function(q){q instanceof g.ReturnResult?h(q):q===g.breakResult?h(g.voidOperation):(m++,100<m?(m=0,setTimeout(function(){L(b,a,c,d,e+1,f,h,k,m)},0)):L(b,a,c,d,e+1,f,h,k,m))},function(q){k(q)}))}catch(q){k(q)}}function M(b,a,c,d,e,f){try{void 0===f&&(f="i"),0===c.length?d.resolve(g.voidOperation):J(b,a,c,c.length,e,0,f,function(h){d.resolve(h)},function(h){d.reject(h)},
0)}catch(h){d.reject(h)}}function Pa(b,a,c,d,e,f){try{void 0===f&&(f="i"),0===c.length?d.resolve(g.voidOperation):L(b,a,c,e,0,f,function(h){d.resolve(h)},function(h){d.reject(h)},0)}catch(h){d.reject(h)}}function Qa(b,a,c,d,e){try{var f=c.keys();M(b,a,f,d,e,"k")}catch(h){d.reject(h)}}function N(b,a,c,d,e,f,h,k){try{b.next().then(function(m){try{if(null===m)f(g.voidOperation);else{var q=y.createFromGraphicLikeObject(m.geometry,m.attributes,d);q._underlyingGraphic=m;e.value=q;n(a,c.body).then(function(v){try{v===
g.breakResult?f(g.voidOperation):v instanceof g.ReturnResult?f(v):(k++,100<k?(k=0,setTimeout(function(){N(b,a,c,d,e,f,h,k)},0)):N(b,a,c,d,e,f,h,k))}catch(K){h(K)}},function(v){h(v)})}}catch(v){h(v)}},function(m){h(m)})}catch(m){h(m)}}function Ea(b,a){return l.create(function(c,d){n(b,a.right).then(function(e){try{var f=null;f="VariableDeclaration"===a.left.type?n(b,a.left):l.resolve();f.then(function(){try{var h="";if("VariableDeclaration"===a.left.type){var k=a.left.declarations[0].id;"Identifier"===
k.type&&(h=k.name)}else"Identifier"===a.left.type&&(h=a.left.name);if(!h)throw Error(p.nodeErrorMessage(a,"RUNTIME","INVALIDVARIABLE"));h=h.toLowerCase();k=null;null!==b.localScope&&void 0!==b.localScope[h]&&(k=b.localScope[h]);null===k&&void 0!==b.globalScope[h]&&(k=b.globalScope[h]);null===k?d(Error(p.nodeErrorMessage(a,"RUNTIME","VARIABLENOTDECLARED"))):g.isArray(e)||g.isString(e)?M(b,a,e,{reject:d,resolve:c},k):g.isImmutableArray(e)?Pa(b,a,e,{reject:d,resolve:c},k):e instanceof x||e instanceof
y?Qa(b,a,e,{reject:d,resolve:c},k):g.isFeatureSet(e)?N(e.iterator(b.abortSignal),b,a,e,k,function(m){c(m)},function(m){d(m)},0):M(b,a,[],{reject:d,resolve:c},k)}catch(m){d(m)}},d)}catch(h){d(h)}},d)})}function Ba(b,a){try{var c=a.argument;if("MemberExpression"===c.type){var d=null;return n(b,c.object).then(function(e){var f=null;d=e;!0===c.computed?f=n(b,c.property):"Identifier"===c.property.type&&(f=l.resolve(c.property.name));return f}).then(function(e){return l.create(function(f){var h=d;if(g.isArray(h))if(g.isNumber(e)){0>
e&&(e=h.length+e);if(0>e||e>=h.length)throw Error("Assignment outside of array bounds");var k=g.toNumber(h[e]);h[e]="++"===a.operator?k+1:k-1}else throw Error("Invalid Parameter");else if(h instanceof x){if(!1===g.isString(e))throw Error("Dictionary accessor must be a string");if(!0===h.hasField(e))k=g.toNumber(h.field(e)),h.setField(e,"++"===a.operator?k+1:k-1);else throw Error("Invalid Parameter");}else if(h instanceof y){if(!1===g.isString(e))throw Error("Feature accessor must be a string");if(!0===
h.hasField(e))k=g.toNumber(h.field(e)),h.setField(e,"++"===a.operator?k+1:k-1);else throw Error("Invalid Parameter");}else{if(g.isImmutableArray(h))throw Error("Array is Immutable");throw Error("Invalid Parameter");}!1===a.prefix?f(k):f("++"===a.operator?k+1:k-1)})})}return l.create(function(e,f){var h="Identifier"===a.argument.type?a.argument.name.toLowerCase():"";if(!h)throw Error("Invalid identifier");null!==b.localScope&&void 0!==b.localScope[h]?(f=g.toNumber(b.localScope[h].value),b.localScope[h]=
{value:"++"===a.operator?f+1:f-1,valueset:!0,node:a},!1===a.prefix?e(f):e("++"===a.operator?f+1:f-1)):void 0!==b.globalScope[h]?(f=g.toNumber(b.globalScope[h].value),b.globalScope[h]={value:"++"===a.operator?f+1:f-1,valueset:!0,node:a},!1===a.prefix?e(f):e("++"===a.operator?f+1:f-1)):f(Error("Variable not recognised"))})}catch(e){return l.reject(e)}}function A(b,a,c,d){switch(a){case "\x3d":return b===g.voidOperation?null:b;case "/\x3d":return g.toNumber(c)/g.toNumber(b);case "*\x3d":return g.toNumber(c)*
g.toNumber(b);case "-\x3d":return g.toNumber(c)-g.toNumber(b);case "+\x3d":return g.isString(c)||g.isString(b)?g.toString(c)+g.toString(b):g.toNumber(c)+g.toNumber(b);case "%\x3d":return g.toNumber(c)%g.toNumber(b);default:throw Error(p.nodeErrorMessage(d,"RUNTIME","OPERATORNOTRECOGNISED"));}}function Ca(b,a){return l.create(function(c,d){var e=a.left;if("MemberExpression"===e.type)n(b,a.right).then(function(h){try{n(b,e.object).then(function(k){try{var m=null;if(!0===e.computed)m=n(b,e.property);
else if("Identifier"===e.property.type)m=l.resolve(e.property.name);else throw Error("Expected computed or identifier for assignemnt target");m.then(function(q){try{if(g.isArray(k))if(g.isNumber(q)){0>q&&(q=k.length+q);if(0>q||q>k.length)throw Error("Assignment outside of array bounds");if(q===k.length&&"\x3d"!==a.operator)throw Error("Invalid Parameter");k[q]=A(h,a.operator,k[q],a)}else throw Error("Invalid Parameter");else if(k instanceof x){if(!1===g.isString(q))throw Error("Dictionary accessor must be a string");
if(!0===k.hasField(q))k.setField(q,A(h,a.operator,k.field(q),a));else{if("\x3d"!==a.operator)throw Error("Invalid Parameter");k.setField(q,A(h,a.operator,null,a))}}else if(k instanceof y){if(!1===g.isString(q))throw Error("Feature accessor must be a string");if(!0===k.hasField(q))k.setField(q,A(h,a.operator,k.field(q),a));else{if("\x3d"!==a.operator)throw Error("Invalid Parameter");k.setField(q,A(h,a.operator,null,a))}}else{if(g.isImmutableArray(k))throw Error("Array is Immutable");throw Error("Invalid Parameter");
}c(g.voidOperation)}catch(v){d(v)}},d)}catch(q){d(q)}},d)}catch(k){d(k)}},d);else{var f=e.name.toLowerCase();null!==b.localScope&&void 0!==b.localScope[f]?n(b,a.right).then(function(h){try{b.localScope[f]={value:A(h,a.operator,b.localScope[f].value,a),valueset:!0,node:a.right},c(g.voidOperation)}catch(k){d(k)}},d):void 0!==b.globalScope[f]?n(b,a.right).then(function(h){try{b.globalScope[f]={value:A(h,a.operator,b.globalScope[f].value,a),valueset:!0,node:a.right},c(g.voidOperation)}catch(k){d(k)}},
d):d(Error("Cannot assign undeclared variable"))}})}function Aa(b,a){try{return"AssignmentExpression"===a.expression.type?n(b,a.expression):n(b,a.expression).then(function(c){return l.create(function(d){c===g.voidOperation?d(g.voidOperation):d(new g.ImplicitResult(c))})})}catch(c){return l.reject(c)}}function za(b,a){return l.create(function(c,d){"AssignmentExpression"===a.test.type||"UpdateExpression"===a.test.type?d(Error(p.nodeErrorMessage(a.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"))):
n(b,a.test).then(function(e){try{!0===e?n(b,a.consequent).then(c,d):!1===e?null!==a.alternate?n(b,a.alternate).then(c,d):c(g.voidOperation):d(Error(p.nodeErrorMessage(a.test,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION")))}catch(f){d(f)}},d)})}function V(b,a,c){try{return c>=a.body.length?l.resolve(g.voidOperation):l.create(function(d,e){n(b,a.body[c]).then(function(f){try{f instanceof g.ReturnResult||f===g.breakResult||f===g.continueResult?d(f):c===a.body.length-1?d(f):V(b,a,c+1).then(d,e)}catch(h){e(h)}},
e)})}catch(d){return r(d)}}function ya(b,a){return l.create(function(c,d){null===a.argument?c(new g.ReturnResult(g.voidOperation)):n(b,a.argument).then(function(e){try{c(new g.ReturnResult(e))}catch(f){d(f)}},d)})}function xa(b,a){try{var c=a.id.name.toLowerCase();b.globalScope[c]={valueset:!0,node:null,value:new E(a,b)};return l.resolve(g.voidOperation)}catch(d){return r(d)}}function U(b,a,c){return l.create(function(d,e){c>=a.declarations.length?d(g.voidOperation):n(b,a.declarations[c]).then(function(){c===
a.declarations.length-1?d(g.voidOperation):U(b,a,c+1).then(function(){d(g.voidOperation)},e)},e)})}function wa(b,a){try{var c=null;c=null===a.init?l.resolve(null):n(b,a.init);return null!==b.localScope?c.then(function(d){return l.create(function(e){d===g.voidOperation&&(d=null);if("Identifier"!==a.id.type)throw Error("Can only assign a regular variable");var f=a.id.name.toLowerCase();b.localScope[f]={value:d,valueset:!0,node:a.init};e(g.voidOperation)})}):c.then(function(d){return l.create(function(e){if("Identifier"!==
a.id.type)throw Error("Can only assign a regular variable");var f=a.id.name.toLowerCase();d===g.voidOperation&&(d=null);b.globalScope[f]={value:d,valueset:!0,node:a.init};e(g.voidOperation)})})}catch(d){return r(d)}}function X(b,a,c,d){a=a.toLowerCase();switch(a){case "hasz":return b=b.hasZ,void 0===b?!1:b;case "hasm":return b=b.hasM,void 0===b?!1:b;case "spatialreference":return a=b.spatialReference._arcadeCacheId,void 0===a&&(c=!0,Object.freeze&&Object.isFrozen(b.spatialReference)&&(c=!1),c&&(z++,
a=b.spatialReference._arcadeCacheId=z)),b=new x({wkt:b.spatialReference.wkt,wkid:b.spatialReference.wkid}),void 0!==a&&(b._arcadeCacheId="SPREF"+a.toString()),b}switch(b.type){case "extent":switch(a){case "xmin":case "xmax":case "ymin":case "ymax":case "zmin":case "zmax":case "mmin":case "mmax":return b=b[a],void 0!==b?b:null;case "type":return"Extent"}break;case "polygon":switch(a){case "rings":return a=b.getCacheValue("_arcadeCacheId"),void 0===a&&(z++,a=z,b.setCacheValue("_arcadeCacheId",a)),b=
new R(b.rings,b.spatialReference,!0===b.hasZ,!0===b.hasM,a);case "type":return"Polygon"}break;case "point":switch(a){case "x":case "y":case "z":case "m":return void 0!==b[a]?b[a]:null;case "type":return"Point"}break;case "polyline":switch(a){case "paths":return a=b.getCacheValue("_arcadeCacheId"),void 0===a&&(z++,a=z,b.setCacheValue("_arcadeCacheId",a)),b=new R(b.paths,b.spatialReference,!0===b.hasZ,!0===b.hasM,a);case "type":return"Polyline"}break;case "multipoint":switch(a){case "points":return a=
b.getCacheValue("_arcadeCacheId"),void 0===a&&(z++,a=z,b.setCacheValue("_arcadeCacheId",a)),b=new ha(b.points,b.spatialReference,!0===b.hasZ,!0===b.hasM,a,1);case "type":return"Multipoint"}}throw Error(p.nodeErrorMessage(d,"RUNTIME","PROPERTYNOTFOUND"));}function Ga(b,a){try{return n(b,a.object).then(function(c){try{return null===c?l.reject(Error(p.nodeErrorMessage(a,"RUNTIME","NOTFOUND"))):!1===a.computed?"Identifier"===a.property.type?c instanceof x||c instanceof y?l.resolve(c.field(a.property.name)):
c instanceof S?l.resolve(X(c,a.property.name,b,a)):l.reject(Error(p.nodeErrorMessage(a,"RUNTIME","INVALIDTYPE"))):l.reject(Error(p.nodeErrorMessage(a,"RUNTIME","INVALIDTYPE"))):n(b,a.property).then(function(d){return l.create(function(e,f){if(c instanceof x||c instanceof y)g.isString(d)?e(c.field(d)):f(Error(p.nodeErrorMessage(a,"RUNTIME","INVALIDTYPE")));else if(c instanceof S)g.isString(d)?e(X(c,d,b,a)):f(Error(p.nodeErrorMessage(a,"RUNTIME","INVALIDTYPE")));else if(g.isArray(c))if(g.isNumber(d)&&
isFinite(d)&&Math.floor(d)===d){0>d&&(d=c.length+d);if(d>=c.length||0>d)throw Error(p.nodeErrorMessage(a,"RUNTIME","OUTOFBOUNDS"));e(c[d])}else f(Error(p.nodeErrorMessage(a,"RUNTIME","INVALIDTYPE")));else if(g.isImmutableArray(c))if(g.isNumber(d)&&isFinite(d)&&Math.floor(d)===d){0>d&&(d=c.length()+d);if(d>=c.length()||0>d)throw Error(p.nodeErrorMessage(a,"RUNTIME","OUTOFBOUNDS"));e(c.get(d))}else f(Error(p.nodeErrorMessage(a,"RUNTIME","INVALIDTYPE")));else if(g.isString(c))if(g.isNumber(d)&&isFinite(d)&&
Math.floor(d)===d){0>d&&(d=c.length+d);if(d>=c.length||0>d)throw Error(p.nodeErrorMessage(a,"RUNTIME","OUTOFBOUNDS"));e(c[d])}else f(Error(p.nodeErrorMessage(a,"RUNTIME","INVALIDTYPE")));else f(Error(p.nodeErrorMessage(a,"RUNTIME","INVALIDTYPE")))})})}catch(d){return r(d)}})}catch(c){return r(c)}}function Ia(b,a){try{return n(b,a.argument).then(function(c){return l.create(function(d,e){g.isBoolean(c)?"!"===a.operator?d(!c):"-"===a.operator?d(-1*g.toNumber(c)):"+"===a.operator?d(1*g.toNumber(c)):"~"===
a.operator?d(~g.toNumber(c)):e(Error(p.nodeErrorMessage(a,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))):"-"===a.operator?d(-1*g.toNumber(c)):"+"===a.operator?d(1*g.toNumber(c)):"~"===a.operator?d(~g.toNumber(c)):e(Error(p.nodeErrorMessage(a,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR")))})})}catch(c){return r(c)}}function La(b,a){try{for(var c=[],d=0;d<a.elements.length;d++)c.push(n(b,a.elements[d]));return l.all(c).then(function(e){return l.create(function(f,h){for(var k=0;k<e.length;k++){if(g.isFunctionParameter(e[k])){h(Error(p.nodeErrorMessage(a,
"RUNTIME","FUNCTIONCONTEXTILLEGAL")));return}e[k]===g.voidOperation&&(e[k]=null)}f(e)})})}catch(e){return r(e)}}function Ja(b,a){try{return l.all([n(b,a.left),n(b,a.right)]).then(function(c){return l.create(function(d,e){var f=c[0],h=c[1];switch(a.operator){case "|":case "\x3c\x3c":case "\x3e\x3e":case "\x3e\x3e\x3e":case "^":case "\x26":d(g.binaryOperator(g.toNumber(f),g.toNumber(h),a.operator));case "\x3d\x3d":d(g.equalityTest(f,h));break;case "!\x3d":d(!g.equalityTest(f,h));break;case "\x3c":d(g.greaterThanLessThan(f,
h,a.operator));break;case "\x3e":d(g.greaterThanLessThan(f,h,a.operator));break;case "\x3c\x3d":d(g.greaterThanLessThan(f,h,a.operator));break;case "\x3e\x3d":d(g.greaterThanLessThan(f,h,a.operator));break;case "+":g.isString(f)||g.isString(h)?d(g.toString(f)+g.toString(h)):d(g.toNumber(f)+g.toNumber(h));break;case "-":d(g.toNumber(f)-g.toNumber(h));break;case "*":d(g.toNumber(f)*g.toNumber(h));break;case "/":d(g.toNumber(f)/g.toNumber(h));break;case "%":d(g.toNumber(f)%g.toNumber(h));break;default:e(Error(p.nodeErrorMessage(a,
"RUNTIME","OPERATORNOTRECOGNISED")))}})})}catch(c){return r(c)}}function Ka(b,a){return l.create(function(c,d){"AssignmentExpression"===a.left.type||"UpdateExpression"===a.left.type?d(Error(p.nodeErrorMessage(a.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"))):"AssignmentExpression"===a.right.type||"UpdateExpression"===a.right.type?d(Error(p.nodeErrorMessage(a.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"))):n(b,a.left).then(function(e){try{if(g.isBoolean(e))switch(a.operator){case "||":!0===
e?c(e):n(b,a.right).then(function(f){try{if(g.isBoolean(f))c(f);else throw Error(p.nodeErrorMessage(a,"RUNTIME","ONLYORORAND"));}catch(h){d(h)}},d);break;case "\x26\x26":!1===e?c(e):n(b,a.right).then(function(f){try{if(g.isBoolean(f))c(f);else throw Error(p.nodeErrorMessage(a,"RUNTIME","ONLYORORAND"));}catch(h){d(h)}},d);break;default:throw Error(p.nodeErrorMessage(a,"RUNTIME","ONLYORORAND"));}else throw Error(p.nodeErrorMessage(a,"RUNTIME","ONLYBOOLEAN"));}catch(f){d(f)}},d)})}function I(b,a){return l.create(function(c,
d){var e=a.name.toLowerCase();if(null!==b.localScope&&void 0!==b.localScope[e]){var f=b.localScope[e];!0===f.valueset?c(f.value):null!==f.d?f.d.then(c,d):(f.d=n(b,f.node),f.d.then(function(k){try{f.value=k,f.valueset=!0,c(k)}catch(m){d(m)}},d))}else if(void 0!==b.globalScope[e]){var h=b.globalScope[e];!0===h.valueset?c(h.value):null!==h.d?h.d.then(c,d):(h.d=n(b,h.node),h.d.then(function(k){try{h.value=k,h.valueset=!0,c(k)}catch(m){d(m)}},d))}else d(Error(p.nodeErrorMessage(a,"RUNTIME","VARIABLENOTFOUND")))})}
function Ha(b,a){try{if("Identifier"!==a.callee.type)return r(p.nodeErrorMessage(a,"RUNTIME","ONLYNODESSUPPORTED"));if(null!==b.localScope&&void 0!==b.localScope[a.callee.name.toLowerCase()]){var c=b.localScope[a.callee.name.toLowerCase()];return c.value instanceof g.NativeFunction?c.value.fn(b,a):c.value instanceof E?Y(b,a,c.value.definition):r(p.nodeErrorMessage(a,"RUNTIME","NOTAFUNCTION"))}return void 0!==b.globalScope[a.callee.name.toLowerCase()]?(c=b.globalScope[a.callee.name.toLowerCase()],
c.value instanceof g.NativeFunction?c.value.fn(b,a):c.value instanceof E?Y(b,a,c.value.definition):r(p.nodeErrorMessage(a,"RUNTIME","NOTAFUNCTION"))):r(p.nodeErrorMessage(a,"RUNTIME","NOTFOUND"))}catch(d){return r(d)}}function Fa(b,a){return l.create(function(c){var d=[];ia.reduceArrayWithPromises(a.expressions,function(e,f,h,k){return n(b,f).then(function(m){d[h]=g.toString(m)})}).then(function(){for(var e="",f=0,h=0,k=a.quasis;h<k.length;h++){var m=k[h];e+=m.value?m.value.cooked:"";!1===m.tail&&
(e+=d[f]?d[f]:"",f++)}c(e)})})}function Z(b){return null===b?"":g.isArray(b)||g.isImmutableArray(b)?"Array":g.isDate(b)?"Date":g.isString(b)?"String":g.isBoolean(b)?"Boolean":g.isNumber(b)?"Number":b instanceof fa?"Attachment":b instanceof ea?"Portal":b instanceof x?"Dictionary":b instanceof y?"Feature":b instanceof sa?"Point":b instanceof ta?"Polygon":b instanceof ua?"Polyline":b instanceof ra?"Multipoint":b instanceof qa?"Extent":g.isFunctionParameter(b)?"Function":g.isFeatureSet(b)?"FeatureSet":
g.isFeatureSetCollection(b)?"FeatureSetCollection":b===g.voidOperation?"":"number"===typeof b&&isNaN(b)?"Number":"Unrecognised Type"}function aa(b,a,c,d){return l.create(function(e,f){n(b,a.arguments[c]).then(function(h){try{if(g.equalityTest(h,d))n(b,a.arguments[c+1]).then(e,f);else{var k=a.arguments.length-c;1===k?n(b,a.arguments[c]).then(e,f):(2===k&&e(null),3===k?n(b,a.arguments[c+2]).then(e,f):aa(b,a,c+2,d).then(e,f))}}catch(m){f(m)}},f)})}function ba(b,a,c,d){return l.create(function(e,f){!0===
d?n(b,a.arguments[c+1]).then(e,f):3===a.arguments.length-c?n(b,a.arguments[c+2]).then(e,f):n(b,a.arguments[c+2]).then(function(h){try{!1===g.isBoolean(h)?f(Error("WHEN needs boolean test conditions")):ba(b,a,c+2,h).then(e,f)}catch(k){f(k)}})})}function O(b,a){try{var c=b.length,d=Math.floor(c/2);return 0===c?l.resolve([]):1===c?l.resolve([b[0]]):l.create(function(e,f){var h=[O(b.slice(0,d),a),O(b.slice(d,c),a)];l.all(h).then(function(k){try{G(k[0],k[1],a,[]).then(e,f)}catch(m){f(m)}},f)})}catch(e){return r(e)}}
function G(b,a,c,d){return l.create(function(e,f){0<b.length||0<a.length?0<b.length&&0<a.length?c(b[0],a[0]).then(function(h){try{isNaN(h)&&(h=1),0>=h?(d.push(b[0]),b=b.slice(1)):(d.push(a[0]),a=a.slice(1)),G(b,a,c,d).then(e,f)}catch(k){f(k)}},f):0<b.length?(d.push(b[0]),b=b.slice(1),G(b,a,c,d).then(e,f)):0<a.length&&(d.push(a[0]),a=a.slice(1),G(b,a,c,d).then(e,f)):e(d)})}function B(b,a){var c=b.length,d=Math.floor(c/2);a||(a=function(e,f){return e<f?-1:e===f?0:1});return 0===c?[]:1===c?[b[0]]:Ra(B(b.slice(0,
d),a),B(b.slice(d,c),a),a)}function Ra(b,a,c){for(var d=[];0<b.length||0<a.length;)if(0<b.length&&0<a.length){var e=c(b[0],a[0]);isNaN(e)&&(e=1);0>=e?(d.push(b[0]),b=b.slice(1)):(d.push(a[0]),a=a.slice(1))}else 0<b.length?(d.push(b[0]),b=b.slice(1)):0<a.length&&(d.push(a[0]),a=a.slice(1));return d}function ca(b,a,c){try{var d=b.body;if(c.length!==b.params.length)return r(Error("Invalid Parameter calls to function."));for(var e=0;e<c.length;e++){var f=b.params[e];"Identifier"===f.type&&(a.localScope[f.name.toLowerCase()]=
{d:null,value:c[e],valueset:!0,node:null})}return n(a,d).then(function(h){return l.create(function(k,m){h instanceof g.ReturnResult?k(h.value):h===g.breakResult?m(Error("Cannot Break from a Function")):h===g.continueResult?m(Error("Cannot Continue from a Function")):h instanceof g.ImplicitResult?k(h.value):k(h)})})}catch(h){return l.reject(h)}}function Y(b,a,c){return C(b,a,function(d,e,f){d={spatialReference:b.spatialReference,services:b.services,console:b.console,lrucache:b.lrucache,interceptor:b.interceptor,
localScope:{},abortSignal:b.abortSignal,globalScope:b.globalScope,depthCounter:b.depthCounter+1};if(64<d.depthCounter)throw Error("Exceeded maximum function depth");return ca(c,d,f)})}function P(b){return function(){var a={abortSignal:b.context.abortSignal,spatialReference:b.context.spatialReference,console:b.context.console,lrucache:b.context.lrucache,interceptor:b.context.interceptor,services:b.context.services,localScope:{},globalScope:b.context.globalScope,depthCounter:b.context.depthCounter+
1};if(64<a.depthCounter)throw Error("Exceeded maximum function depth");return ca(b.definition,a,arguments)}}function Sa(b,a){var c=new D;if(void 0===b||null===b)b={};if(void 0===a||null===a)a={};var d=new x({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});d.immutable=!1;c.textformatting={value:d,valueset:!0,node:null};for(var e in a)c[e]={value:new g.NativeFunction(a[e]),native:!0,valueset:!0,node:null};for(e in b)c[e]=b[e]&&"esri.Graphic"===b[e].declaredClass?
{value:y.createFromGraphic(b[e]),valueset:!0,node:null}:{value:b[e],valueset:!0,node:null};return c}function Ta(b){console.log(b)}Object.defineProperty(u,"__esModule",{value:!0});u.findFunctionCalls=u.referencesFunction=u.referencesMember=u.validateScript=u.extractFieldLiterals=u.executeScript=u.extend=u.functionHelper=void 0;var z=0,t={};ja.registerFunctions(t,w);ka.registerFunctions(t,w);pa.registerFunctions(t,w);na.registerFunctions(t,w);ma.registerFunctions(t,w);oa.registerFunctions(t,w);la.registerFunctions({functions:t,
compiled:!1,signatures:null,failDefferred:null,evaluateIdentifier:null,arcadeCustomFunctionHandler:null,mode:"async",standardFunction:w,standardFunctionAsync:C});t.typeof=function(b,a){return w(b,a,function(c,d,e){g.pcCheck(e,1,1);c=Z(e[0]);if("Unrecognised Type"===c)throw Error("Unrecognised Type");return c})};t.iif=function(b,a){return l.create(function(c,d){g.pcCheck(null===a.arguments?[]:a.arguments,3,3);n(b,a.arguments[0]).then(function(e){try{!1===g.isBoolean(e)?d(Error("IF Function must have a boolean test condition")):
l.all([n(b,a.arguments[1]),n(b,a.arguments[2])]).then(function(f){e?c(f[0]):c(f[1])},d)}catch(f){d(f)}},d)})};t.decode=function(b,a){return l.create(function(c,d){2>a.arguments.length?d(Error("Missing Parameters")):2===a.arguments.length?n(b,a.arguments[1]).then(c,d):0===(a.arguments.length-1)%2?d(Error("Must have a default value result.")):n(b,a.arguments[0]).then(function(e){try{aa(b,a,1,e).then(c,d)}catch(f){d(f)}},d)})};t.when=function(b,a){try{return 3>a.arguments.length?r("Missing Parameters"):
0===a.arguments.length%2?r("Must have a default value result."):n(b,a.arguments[0]).then(function(c){return l.create(function(d,e){!1===g.isBoolean(c)?e(Error("WHEN needs boolean test conditions")):ba(b,a,0,c).then(d,e)})})}catch(c){return r(c)}};t.sort=function(b,a){return C(b,a,function(c,d,e){g.pcCheck(e,1,2);c=e[0];g.isImmutableArray(c)&&(c=c.toArray());if(!1===g.isArray(c))return r(Error("Illegal Argument"));if(1<e.length){if(!1===g.isFunctionParameter(e[1]))return r(Error("Illegal Argument"));
var f=P(e[1]);return O(c,f)}if(0===c.length)return l.resolve([]);e={};for(d=0;d<c.length;d++){var h=Z(c[d]);""!==h&&(e[h]=!0)}if(!0===e.Array||!0===e.Dictionary||!0===e.Feature||!0===e.Point||!0===e.Polygon||!0===e.Polyline||!0===e.Multipoint||!0===e.Extent||!0===e.Function)return l.resolve(c.slice(0));d=0;h="";for(f in e)d++,h=f;1<d||"String"===h?c=B(c,function(k,m){if(null===k||void 0===k||k===g.voidOperation)return null===m||void 0===m||m===g.voidOperation?0:1;if(null===m||void 0===m||m===g.voidOperation)return-1;
k=g.toString(k);m=g.toString(m);return k<m?-1:k===m?0:1}):"Number"===h?c=B(c,function(k,m){return k-m}):"Boolean"===h?c=B(c,function(k,m){return k===m?0:m?-1:1}):"Date"===h&&(c=B(c,function(k,m){return m-k}));return l.resolve(c)})};Q={failDefferred:r,resolveDeffered:T,fixSpatialReference:g.fixSpatialReference,parseArguments:H,standardFunction:w,standardFunctionAsync:C,evaluateIdentifier:I,arcadeCustomFunction:P};for(var da in t)t[da]={value:new g.NativeFunction(t[da]),valueset:!0,node:null};var D=
function(){};D.prototype=t;D.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null};D.prototype.pi={value:Math.PI,valueset:!0,node:null};u.functionHelper=Q;u.extend=function(b){for(var a={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:w,standardFunctionAsync:C,failDefferred:r,evaluateIdentifier:I,arcadeCustomFunctionHandler:P},c=0;c<b.length;c++)b[c].registerFunctions(a);for(var d in a.functions)t[d]={value:new g.NativeFunction(a.functions[d]),valueset:!0,
node:null},D.prototype[d]=t[d];for(c=0;c<a.signatures.length;c++)p.addFunctionDeclaration(a.signatures[c],"async")};u.executeScript=function(b,a){var c=a.spatialReference;if(null===c||void 0===c)c=new va({wkid:102100});var d=Sa(a.vars,a.customfunctions);return n({spatialReference:c,services:a.services,abortSignal:void 0===a.abortSignal||null===a.abortSignal?{aborted:!1}:a.abortSignal,globalScope:d,console:a.console?a.console:Ta,lrucache:a.lrucache,interceptor:a.interceptor,localScope:null,depthCounter:1},
b.body[0].body).then(function(e){return l.create(function(f,h){e instanceof g.ReturnResult&&(e=e.value);e instanceof g.ImplicitResult&&(e=e.value);e===g.voidOperation&&(e=null);e===g.breakResult?h(Error("Cannot return BREAK")):e===g.continueResult?h(Error("Cannot return CONTINUE")):e instanceof g.NativeFunction?h(Error("Cannot return FUNCTION")):e instanceof E?h(Error("Cannot return FUNCTION")):f(e)})})};u.extractFieldLiterals=function(b,a){void 0===a&&(a=!1);return p.findFieldLiterals(b)};u.validateScript=
function(b,a){return p.validateScript(b,a,"full")};u.referencesMember=function(b,a){return p.referencesMember(b,a)};u.referencesFunction=function(b,a){return p.referencesFunction(b,a)};u.findFunctionCalls=function(b){return p.findFunctionCalls(b)}});