// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/arcade/lib/comment-handler",["require","exports","./syntax"],function(h,g,k){Object.defineProperty(g,"__esModule",{value:!0});g.CommentHandler=void 0;h=function(){function f(){this.attach=!1;this.comments=[];this.stack=[];this.leading=[];this.trailing=[]}f.prototype.insertInnerComments=function(a,b){if(a.type===k.Syntax.BlockStatement&&0===a.body.length){for(var c=[],d=this.leading.length-1;0<=d;--d){var e=this.leading[d];b.end.offset>=e.start&&(c.unshift(e.comment),this.leading.splice(d,
1),this.trailing.splice(d,1))}c.length&&(a.innerComments=c)}};f.prototype.findTrailingComments=function(a){var b=[];if(0<this.trailing.length){for(var c=this.trailing.length-1;0<=c;--c){var d=this.trailing[c];d.start>=a.end.offset&&b.unshift(d.comment)}this.trailing.length=0;return b}(c=this.stack[this.stack.length-1])&&c.node.trailingComments&&(d=c.node.trailingComments[0])&&d.range[0]>=a.end.offset&&(b=c.node.trailingComments,delete c.node.trailingComments);return b};f.prototype.findLeadingComments=
function(a){for(var b=[],c;0<this.stack.length;){var d=this.stack[this.stack.length-1];if(d&&d.start>=a.start.offset)c=d.node,this.stack.pop();else break}if(c){for(var e=(c.leadingComments?c.leadingComments.length:0)-1;0<=e;--e)d=c.leadingComments[e],d.range[1]<=a.start.offset&&(b.unshift(d),c.leadingComments.splice(e,1));c.leadingComments&&0===c.leadingComments.length&&delete c.leadingComments;return b}for(e=this.leading.length-1;0<=e;--e)d=this.leading[e],d.start<=a.start.offset&&(b.unshift(d.comment),
this.leading.splice(e,1));return b};f.prototype.visitNode=function(a,b){if(!(a.type===k.Syntax.Program&&0<a.body.length)){this.insertInnerComments(a,b);var c=this.findTrailingComments(b),d=this.findLeadingComments(b);0<d.length&&(a.leadingComments=d);0<c.length&&(a.trailingComments=c);this.stack.push({node:a,start:b.start.offset})}};f.prototype.visitComment=function(a,b){this.comments.push(a);this.attach&&(b={comment:{type:a.type,value:a.value,range:[b.start.offset,b.end.offset]},start:b.start.offset},
a.loc&&(b.comment.loc=a.loc),this.leading.push(b),this.trailing.push(b))};f.prototype.visit=function(a,b){"Line"===a.type||"Block"===a.type?this.visitComment(a,b):this.attach&&this.visitNode(a,b)};return f}();g.CommentHandler=h});