// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/arcade/arcadeCompiler","require exports ./ArcadePortal ./Attachment ./Dictionary ./Feature ./ImmutablePathArray ./ImmutablePointArray ./languageUtils ./treeAnalysis ./functions/array ./functions/date ./functions/geometry ./functions/geomsync ./functions/maths ./functions/stats ./functions/string ./polyfill/promiseUtils ../geometry/Extent ../geometry/Geometry ../geometry/Multipoint ../geometry/Point ../geometry/Polygon ../geometry/Polyline ../SpatialReference".split(" "),function(ha,u,
ia,ja,D,H,Y,ka,e,h,la,ma,na,oa,pa,qa,ra,A,sa,ta,ua,va,wa,xa,ya){function w(a,b,c){try{return c(a,null,b)}catch(d){throw d;}}function za(a){return a instanceof Error?A.reject(a):A.reject(Error(a))}function g(a,b){try{switch(b.type){case "EmptyStatement":return"lc.voidOperation";case "VariableDeclarator":return Aa(a,b);case "VariableDeclaration":for(var c=[],d=0;d<b.declarations.length;d++)c.push(g(a,b.declarations[d]));return c.join("\n")+" \n lastStatement\x3d  lc.voidOperation; \n";case "BlockStatement":return S(a,
b);case "FunctionDeclaration":var f=b.id.name.toLowerCase(),n={isAsync:a.isAsync,spatialReference:a.spatialReference,console:a.console,lrucache:a.lrucache,interceptor:a.interceptor,services:a.services,symbols:a.symbols,mangleMap:a.mangleMap,localScope:{_SymbolsMap:{}},depthCounter:a.depthCounter+1,globalScope:a.globalScope};if(64<n.depthCounter)throw Error("Exceeded maximum function depth");c="new lc.SizzleFunction( lang.functionDepthchecker(function() { var lastStatement \x3d lc.voidOperation; \n   var lscope \x3d runtimeCtx.localStack[runtimeCtx.localStack.length-1];\n";
for(d=0;d<b.params.length;d++){var k=b.params[d].name.toLowerCase(),r=N(a);n.localScope._SymbolsMap[k]=r;n.mangleMap[k]=r;c+="lscope['"+r+"']\x3darguments["+d.toString()+"];\n"}!0===a.isAsync?(c=c+"return lang.__awaiter(this, void 0, void 0, function* () {\n"+(S(n,b.body)+"\n return lastStatement; "),c+="});  }, runtimeCtx))\n lastStatement \x3d lc.voidOperation; \n"):(c+=S(n,b.body)+"\n return lastStatement; }, runtimeCtx))",c+="\n lastStatement \x3d lc.voidOperation; \n");if(void 0!==a.globalScope[f])var p=
"gscope['"+f+"']\x3d"+c;else void 0!==a.globalScope._SymbolsMap[f]?p="gscope['"+a.globalScope._SymbolsMap[f]+"']\x3d"+c:(r=N(a),a.globalScope._SymbolsMap[f]=r,a.mangleMap[f]=r,p="gscope['"+r+"']\x3d"+c);return p;case "ReturnStatement":var v=null===b.argument?"return lc.voidOperation":"return "+g(a,b.argument);return v;case "IfStatement":if("AssignmentExpression"===b.test.type||"UpdateExpression"===b.test.type)throw Error(h.nodeErrorMessage(b.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));var l=
g(a,b.test),q=J(a),O="var "+q+" \x3d "+l+";\n if ("+q+" \x3d\x3d\x3d true) {\n"+Z(a,b.consequent)+"\n }\n";O=null!==b.alternate?O+("else if ("+q+"\x3d\x3d\x3dfalse)   { \n"+Z(a,b.alternate)+"}\n"):O+("else if ("+q+"\x3d\x3d\x3dfalse) { \n lastStatement \x3d lc.voidOperation;\n }\n");return O+="else { lang.error({type: '"+b.type+"'},'RUNTIME','CANNOT_USE_NONBOOLEAN_IN_CONDITION'); \n}\n";case "ExpressionStatement":var Ba="AssignmentExpression"===b.expression.type?"lastStatement \x3d lc.voidOperation; "+
g(a,b.expression)+"; \n ":"lastStatement \x3d "+g(a,b.expression)+"; ";return Ba;case "AssignmentExpression":return Ca(a,b);case "UpdateExpression":return Da(a,b);case "BreakStatement":return"break";case "ContinueStatement":return"continue";case "TemplateLiteral":try{var L=[];f=p=0;for(d=b.quasis;f<d.length;f++){var E=d[f];L.push(E.value?JSON.stringify(E.value.cooked):JSON.stringify(""));!1===E.tail&&(L.push(b.expressions[p]?"lang.castString(lang.aCheck("+g(a,b.expressions[p])+", 'TemplateLiteral'))":
""),p++)}c="(["+L.join(",")+"]).join('')"}catch(y){throw y;}return c;case "TemplateElement":return JSON.stringify(b.value?b.value.cooked:"");case "ForStatement":c="lastStatement \x3d lc.voidOperation; \n";null!==b.init&&(c+=g(a,b.init)+"; ");var P=J(a),T=J(a);c+="var "+P+" \x3d true; \n do { ";null!==b.update&&(c+=" if ("+P+"\x3d\x3d\x3dfalse) {\n "+g(a,b.update)+"  \n}\n "+P+"\x3dfalse; \n");null!==b.test&&(c+="var "+T+" \x3d "+g(a,b.test)+"; ",c+="if ("+T+"\x3d\x3d\x3dfalse) { break; } else if ("+
T+"!\x3d\x3dtrue) { lang.error({type: '"+b.type+"'},'RUNTIME','CANNOT_USE_NONBOOLEAN_IN_CONDITION');   }\n");c+=g(a,b.body);null!==b.update&&(c+="\n "+g(a,b.update));return c+("\n"+P+" \x3d true; \n} while(true);  lastStatement \x3d lc.voidOperation; ");case "ForInStatement":var z=J(a),B=J(a),x=J(a),m="var "+z+" \x3d "+g(a,b.right)+";\n";"VariableDeclaration"===b.left.type&&(m+=g(a,b.left));var C="VariableDeclaration"===b.left.type?b.left.declarations[0].id.name:b.left.name;C=C.toLowerCase();c="";
null!==a.localScope&&(void 0!==a.localScope[C]?c="lscope['"+C+"']":void 0!==a.localScope._SymbolsMap[C]&&(c="lscope['"+a.localScope._SymbolsMap[C]+"']"));""===c&&(void 0!==a.globalScope[C]?c="gscope['"+C+"']":void 0!==a.globalScope._SymbolsMap[C]&&(c="gscope['"+a.globalScope._SymbolsMap[C]+"']"));m=m+("if ("+z+"\x3d\x3d\x3dnull) {  lastStatement \x3d lc.voidOperation; }\n else if (lc.isArray(")+(z+") || lc.isString("+z+")) {var ")+(B+"\x3d"+z+".length; \nfor(var ")+(x+"\x3d0; "+x+"\x3c"+B+"; "+x+
"++) {\n");m+=c+"\x3d"+x+";\n";m+=g(a,b.body);m+="\n}\n";m+=" lastStatement \x3d lc.voidOperation; \n";m+=" \n}\n";m+="else if (lc.isImmutableArray("+z+")) {";m=m+("var "+B+"\x3d"+z+".length(); \nfor(var ")+(x+"\x3d0; "+x+"\x3c"+B+"; "+x+"++) {\n");m+=c+"\x3d"+x+";\n";m+=g(a,b.body);m+="\n}\n";m+=" lastStatement \x3d lc.voidOperation; \n";m+=" \n}\n";m+="else if (( "+z+" instanceof lang.Dictionary) || ( "+z+" instanceof lang.Feature)) {";m=m+("var "+B+"\x3d"+z+".keys(); \nfor(var ")+(x+"\x3d0; "+
x+"\x3c"+B+".length; "+x+"++) {\n");m+=c+"\x3d"+B+"["+x+"];\n";m+=g(a,b.body);m+="\n}\n";m+=" lastStatement \x3d lc.voidOperation; \n";m+=" \n}\n";a.isAsync&&(m+="else if (lc.isFeatureSet("+z+")) {",m=m+("var "+B+"\x3d"+z+".iterator(runtimeCtx.abortSignal); \nfor(var ")+(x+"\x3dlang. graphicToFeature( yield "+B+".next(),"+z+"); "+x+"!\x3dnull; "+x+"\x3dlang. graphicToFeature( yield "+B+".next(),"+z+")) {\n")+(c+"\x3d"+x+";\n"),m+=g(a,b.body),m+="\n}\n",m+=" lastStatement \x3d lc.voidOperation; \n",
m+=" \n}\n");return m+"else { lastStatement \x3d lc.voidOperation; } \n";case "Identifier":return Ea(a,b);case "MemberExpression":try{c=void 0;c=!0===b.computed?g(a,b.property):"'"+b.property.name+"'";var Fa="lang.member("+g(a,b.object)+","+c+")"}catch(y){throw y;}return Fa;case "Literal":return null===b.value||void 0===b.value?"null":JSON.stringify(b.value);case "ThisExpression":throw Error(h.nodeErrorMessage(b,"RUNTIME","NOTSUPPORTED"));case "CallExpression":try{if("Identifier"!==b.callee.type)throw Error(h.nodeErrorMessage(b,
"RUNTIME","ONLYNODESSUPPORTED"));var F=b.callee.name.toLowerCase();c="";null!==a.localScope&&(void 0!==a.localScope[F]?c="lscope['"+F+"']":void 0!==a.localScope._SymbolsMap[F]&&(c="lscope['"+a.localScope._SymbolsMap[F]+"']"));""===c&&(void 0!==a.globalScope[F]?c="gscope['"+F+"']":void 0!==a.globalScope._SymbolsMap[F]&&(c="gscope['"+a.globalScope._SymbolsMap[F]+"']"));if(""!==c){d="[";for(E=0;E<b.arguments.length;E++)0<E&&(d+=", "),d+=g(a,b.arguments[E]);d+="]";L=a.isAsync?"(yield lang.callfunc("+
c+","+d+",runtimeCtx) )":"lang.callfunc("+c+","+d+",runtimeCtx)"}else throw Error(h.nodeErrorMessage(b,"RUNTIME","NOTFOUND"));}catch(y){throw y;}return L;case "UnaryExpression":try{var Ga="lang.unary("+g(a,b.argument)+",'"+b.operator+"')"}catch(y){throw y;}return Ga;case "BinaryExpression":try{var Ha="lang.binary("+g(a,b.left)+","+g(a,b.right)+",'"+b.operator+"')"}catch(y){throw y;}return Ha;case "LogicalExpression":try{if("AssignmentExpression"===b.left.type||"UpdateExpression"===b.left.type)throw Error(h.nodeErrorMessage(b.left,
"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("AssignmentExpression"===b.right.type||"UpdateExpression"===b.right.type)throw Error(h.nodeErrorMessage(b.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("\x26\x26"===b.operator||"||"===b.operator)var Ia="(lang.logicalCheck("+g(a,b.left)+") "+b.operator+" lang.logicalCheck("+g(a,b.right)+"))";else throw Error(h.nodeErrorMessage(b,"RUNTIME","ONLYORORAND"));}catch(y){throw y;}return Ia;case "ConditionalExpression":throw Error(h.nodeErrorMessage(b,
"RUNTIME","NOTSUPPORTED"));case "ArrayExpression":try{c=[];for(d=0;d<b.elements.length;d++)"Literal"===b.elements[d].type?c.push(g(a,b.elements[d])):c.push("lang.aCheck("+g(a,b.elements[d])+",'ArrayExpression')");var Ja="["+c.join(",")+"]"}catch(y){throw y;}return Ja;case "ObjectExpression":c="lang.dictionary([";for(d=0;d<b.properties.length;d++){var Q=b.properties[d],Ka="Identifier"===Q.key.type?"'"+Q.key.name+"'":g(a,Q.key),La=g(a,Q.value);0<d&&(c+=",");c+="lang.strCheck("+Ka+",'ObjectExpression'),lang.aCheck("+
La+", 'ObjectExpression')"}return c+"])";case "Property":throw Error("Should not get here");case "Array":throw Error(h.nodeErrorMessage(b,"RUNTIME","NOTSUPPORTED"));default:throw Error(h.nodeErrorMessage(b,"RUNTIME","UNREOGNISED"));}}catch(y){throw y;}}function Da(a,b){var c=null,d="";if("MemberExpression"===b.argument.type)return c=g(a,b.argument.object),d=!0===b.argument.computed?g(a,b.argument.property):"'"+b.argument.property.name+"'","lang.memberupdate("+c+","+d+",'"+b.operator+"',"+b.prefix+
")";c=b.argument.name.toLowerCase();if(null!==a.localScope){if(void 0!==a.localScope[c])return"lang.update(lscope, '"+c+"','"+b.operator+"',"+b.prefix+")";if(void 0!==a.localScope._SymbolsMap[c])return"lang.update(lscope, '"+a.localScope._SymbolsMap[c]+"','"+b.operator+"',"+b.prefix+")"}if(void 0!==a.globalScope[c])return"lang.update(gscope, '"+c+"','"+b.operator+"',"+b.prefix+")";if(void 0!==a.globalScope._SymbolsMap[c])return"lang.update(gscope, '"+a.globalScope._SymbolsMap[c]+"','"+b.operator+
"',"+b.prefix+")";throw Error("Variable not recognised");}function Ca(a,b){var c=g(a,b.right),d=null,f="";if("MemberExpression"===b.left.type)return d=g(a,b.left.object),f=!0===b.left.computed?g(a,b.left.property):"'"+b.left.property.name+"'","lang.assignmember("+d+","+f+",'"+b.operator+"',"+c+")";d=b.left.name.toLowerCase();if(null!==a.localScope){if(void 0!==a.localScope[d])return"lscope['"+d+"']\x3dlang.assign("+c+",'"+b.operator+"', lscope['"+d+"'])";if(void 0!==a.localScope._SymbolsMap[d])return"lscope['"+
a.localScope._SymbolsMap[d]+"']\x3dlang.assign("+c+",'"+b.operator+"', lscope['"+a.localScope._SymbolsMap[d]+"'])"}if(void 0!==a.globalScope[d])return"gscope['"+d+"']\x3dlang.assign("+c+",'"+b.operator+"', gscope['"+d+"'])";if(void 0!==a.globalScope._SymbolsMap[d])return"gscope['"+a.globalScope._SymbolsMap[d]+"']\x3dlang.assign("+c+",'"+b.operator+"', gscope['"+a.globalScope._SymbolsMap[d]+"'])";throw Error("Variable not recognised");}function Z(a,b){return"BlockStatement"===b.type?g(a,b):"ReturnStatement"===
b.type||"BreakStatement"===b.type||"ContinueStatement"===b.type?g(a,b)+"; ":"UpdateExpression"===b.type?"lastStatement \x3d "+g(a,b)+"; ":"ExpressionStatement"===b.type?g(a,b):"ObjectExpression"===b.type?"lastStatement \x3d "+g(a,b)+"; ":g(a,b)+"; "}function S(a,b){for(var c="",d=0;d<b.body.length;d++)c="ReturnStatement"===b.body[d].type?c+(g(a,b.body[d])+"; \n"):"BreakStatement"===b.body[d].type?c+(g(a,b.body[d])+"; \n"):"ContinueStatement"===b.body[d].type?c+(g(a,b.body[d])+"; \n"):"UpdateExpression"===
b.body[d].type?c+("lastStatement \x3d "+g(a,b.body[d])+"; \n"):"ObjectExpression"===b.body[d].type?c+("lastStatement \x3d "+g(a,b.body[d])+"; \n"):c+(g(a,b.body[d])+" \n");return c}function Aa(a,b){var c=null===b.init?null:g(a,b.init);c===e.voidOperation&&(c=null);b=b.id.name.toLowerCase();if(null!==a.localScope){if(void 0!==a.localScope[b])return"lscope['"+b+"']\x3d"+c+"; ";if(void 0!==a.localScope._SymbolsMap[b])return"lscope['"+a.localScope._SymbolsMap[b]+"']\x3d"+c+"; ";var d=N(a);a.localScope._SymbolsMap[b]=
d;a.mangleMap[b]=d;return"lscope['"+d+"']\x3d"+c+"; "}if(void 0!==a.globalScope[b])return"gscope['"+b+"']\x3d"+c+"; ";if(void 0!==a.globalScope._SymbolsMap[b])return"gscope['"+a.globalScope._SymbolsMap[b]+"']\x3d"+c+"; ";d=N(a);a.globalScope._SymbolsMap[b]=d;a.mangleMap[b]=d;return"gscope['"+d+"']\x3d"+c+"; "}function Ma(a,b,c){b=b.toLowerCase();switch(b){case "hasz":return a=a.hasZ,void 0===a?!1:a;case "hasm":return a=a.hasM,void 0===a?!1:a;case "spatialreference":return b=a.spatialReference._arcadeCacheId,
void 0===b&&(c=!0,Object.freeze&&Object.isFrozen(a.spatialReference)&&(c=!1),c&&(G++,b=a.spatialReference._arcadeCacheId=G)),a=new D({wkt:a.spatialReference.wkt,wkid:a.spatialReference.wkid}),void 0!==b&&(a._arcadeCacheId="SPREF"+b.toString()),a}switch(a.type){case "extent":switch(b){case "xmin":case "xmax":case "ymin":case "ymax":case "zmin":case "zmax":case "mmin":case "mmax":return a=a[b],void 0!==a?a:null;case "type":return"Extent"}break;case "polygon":switch(b){case "rings":return b=a.getCacheValue("_arcadeCacheId"),
void 0===b&&(G++,b=G,a.setCacheValue("_arcadeCacheId",b)),a=new Y(a.rings,a.spatialReference,!0===a.hasZ,!0===a.hasM,b);case "type":return"Polygon"}break;case "point":switch(b){case "x":case "y":case "z":case "m":return void 0!==a[b]?a[b]:null;case "type":return"Point"}break;case "polyline":switch(b){case "paths":return b=a.getCacheValue("_arcadeCacheId"),void 0===b&&(G++,b=G,a.setCacheValue("_arcadeCacheId",b)),a=new Y(a.paths,a.spatialReference,!0===a.hasZ,!0===a.hasM,b);case "type":return"Polyline"}break;
case "multipoint":switch(b){case "points":return b=a.getCacheValue("_arcadeCacheId"),void 0===b&&(G++,b=G,a.setCacheValue("_arcadeCacheId",b)),a=new ka(a.points,a.spatialReference,!0===a.hasZ,!0===a.hasM,b,1);case "type":return"Multipoint"}}throw Error(h.nodeErrorMessage(c,"RUNTIME","PROPERTYNOTFOUND"));}function Ea(a,b){try{var c=b.name.toLowerCase();if(null!==a.localScope){if(void 0!==a.localScope[c])return"lscope['"+c+"']";if(void 0!==a.localScope._SymbolsMap[c])return"lscope['"+a.localScope._SymbolsMap[c]+
"']"}if(void 0!==a.globalScope[c])return"gscope['"+c+"']";if(void 0!==a.globalScope._SymbolsMap[c])return"gscope['"+a.globalScope._SymbolsMap[c]+"']";throw Error(h.nodeErrorMessage(b,"RUNTIME","VARIABLENOTFOUND"));}catch(d){throw d;}}function aa(a){return null===a?"":e.isArray(a)||e.isImmutableArray(a)?"Array":e.isDate(a)?"Date":e.isString(a)?"String":e.isBoolean(a)?"Boolean":e.isNumber(a)?"Number":a instanceof ja?"Attachment":a instanceof ia?"Portal":a instanceof D?"Dictionary":a instanceof H?"Feature":
a instanceof va?"Point":a instanceof wa?"Polygon":a instanceof xa?"Polyline":a instanceof ua?"Multipoint":a instanceof sa?"Extent":e.isFunctionParameter(a)?"Function":e.isFeatureSet(a)?"FeatureSet":e.isFeatureSetCollection(a)?"FeatureSetCollection":a===e.voidOperation?"":"number"===typeof a&&isNaN(a)?"Number":"Unrecognised Type"}function ba(a,b,c,d){try{if(e.equalityTest(b[c],d))return b[c+1];var f=b.length-c;return 1===f?b[c]:2===f?null:3===f?b[c+2]:ba(a,b,c+2,d)}catch(n){throw n;}}function ca(a,
b,c,d){try{if(!0===d)return b[c+1];if(3===b.length-c)return b[c+2];var f=b[c+2];if(!1===e.isBoolean(f))throw Error("WHEN needs boolean test conditions");return ca(a,b,c+2,f)}catch(n){throw n;}}function I(a,b){var c=a.length,d=Math.floor(c/2);if(0===c)return[];if(1===c)return[a[0]];var f=I(a.slice(0,d),b);a=I(a.slice(d,c),b);for(c=[];0<f.length||0<a.length;)0<f.length&&0<a.length?(d=b(f[0],a[0]),isNaN(d)&&(d=0),0>=d?(c.push(f[0]),f=f.slice(1)):(c.push(a[0]),a=a.slice(1))):0<f.length?(c.push(f[0]),
f=f.slice(1)):0<a.length&&(c.push(a[0]),a=a.slice(1));return c}function U(a,b){try{var c=a.length,d=Math.floor(c/2);if(0===c)return A.resolve([]);if(1===c)return A.resolve([a[0]]);var f=[U(a.slice(0,d),b),U(a.slice(d,c),b)];return A.all(f).then(function(n){return R(n[0],n[1],b,[])})}catch(n){return A.reject(n)}}function R(a,b,c,d){return A.create(function(f,n){0<a.length||0<b.length?0<a.length&&0<b.length?c(a[0],b[0]).then(function(k){try{isNaN(k)&&(k=1),0>=k?(d.push(a[0]),a=a.slice(1)):(d.push(b[0]),
b=b.slice(1)),R(a,b,c,d).then(function(r){f(r)},n)}catch(r){n(r)}},n):0<a.length?(d.push(a[0]),a=a.slice(1),R(a,b,c,d).then(function(k){f(k)},n)):0<b.length&&(d.push(b[0]),b=b.slice(1),R(a,b,c,d).then(function(k){f(k)},n)):f(d)})}function N(a){a.symbols.symbolCounter++;return"_T"+a.symbols.symbolCounter.toString()}function J(a){a.symbols.symbolCounter++;return"_Tvar"+a.symbols.symbolCounter.toString()}function Na(a,b,c){var d={};a||(a={});c||(c={});d._SymbolsMap={};d.textformatting=1;d.infinity=1;
d.pi=1;for(var f in b)d[f]=1;for(f in c)d[f]=1;for(f in a)d[f]=1;return d}function da(a,b){for(var c={mode:b,compiled:!0,functions:{},signatures:[],failDefferred:za,standardFunction:w,standardFunctionAsync:w,evaluateIdentifier:Oa},d=0;d<a.length;d++)a[d].registerFunctions(c);if("sync"===b){for(var f in c.functions)t[f]=new e.NativeFunction(c.functions[f]),V.prototype[f]=t[f];for(d=0;d<c.signatures.length;d++)h.addFunctionDeclaration(c.signatures[d],"sync")}else{for(f in c.functions)M[f]=new e.NativeFunction(c.functions[f]),
W.prototype[f]=M[f];for(d=0;d<c.signatures.length;d++)h.addFunctionDeclaration(c.signatures[d],"async")}}function Oa(a,b){b=b.name;if("_SymbolsMap"===b)throw"Illegal";if(0<a.localStack.length){if("_t"!==b.substr(0,2).toLowerCase()&&void 0!==a.localStack[a.localStack.length-1][b])return a.localStack[a.localStack.length-1][b];var c=a.mangleMap[b];if(void 0!==c&&void 0!==a.localStack[a.localStack.length-1][c])return a.localStack[a.localStack.length-1][c]}if("_t"!==b.substr(0,2).toLowerCase()&&void 0!==
a.globalScope[b]||1===a.globalScope._SymbolsMap[b])return a.globalScope[b];b=a.mangleMap[b];if(void 0!==b)return a.globalScope[b]}function ea(a){console.log(a)}Object.defineProperty(u,"__esModule",{value:!0});u.enableAsyncSupport=u.compileScript=u.referencesFunction=u.referencesMember=u.validateScript=u.extractExpectedFieldLiterals=u.extractFieldLiterals=u.executeScript=u.extend=u.functionHelper=void 0;var G=0,t={};la.registerFunctions(t,w);ma.registerFunctions(t,w);ra.registerFunctions(t,w);pa.registerFunctions(t,
w);na.registerFunctions(t,w);qa.registerFunctions(t,w);t["typeof"]=function(a,b){return w(a,b,function(c,d,f){e.pcCheck(f,1,1);c=aa(f[0]);if("Unrecognised Type"===c)throw Error("Unrecognised Type");return c})};t.iif=function(a,b){try{return w(a,b,function(c,d,f){e.pcCheck(f,3,3);if(!1===e.isBoolean(f[0]))throw Error("IF Function must have a boolean test condition");return f[0]?f[1]:f[2]})}catch(c){throw c;}};t.decode=function(a,b){try{return w(a,b,function(c,d,f){if(2>f.length)throw Error("Missing Parameters");
if(2===f.length)return f[1];if(0===(f.length-1)%2)throw Error("Must have a default value result.");return ba(a,f,1,f[0])})}catch(c){throw c;}};t.when=function(a,b){try{return w(a,b,function(c,d,f){if(3>f.length)throw Error("Missing Parameters");if(0===f.length%2)throw Error("Must have a default value result.");c=f[0];if(!1===e.isBoolean(c))throw Error("WHEN needs boolean test conditions");return ca(a,f,0,c)})}catch(c){throw c;}};t.top=function(a,b){return w(a,b,function(c,d,f){e.pcCheck(f,2,2);if(e.isArray(f[0]))return e.toNumber(f[1])>=
f[0].length?f[0].slice(0):f[0].slice(0,e.toNumber(f[1]));if(e.isImmutableArray(f[0]))return e.toNumber(f[1])>=f[0].length()?f[0].slice(0):f[0].slice(0,e.toNumber(f[1]));throw Error("Top cannot accept this parameter type");})};t.first=function(a,b){return w(a,b,function(c,d,f){e.pcCheck(f,1,1);return e.isArray(f[0])?0===f[0].length?null:f[0][0]:e.isImmutableArray(f[0])?0===f[0].length()?null:f[0].get(0):null})};t.sort=function(a,b){return w(a,b,function(c,d,f){e.pcCheck(f,1,2);d=f[0];e.isImmutableArray(d)&&
(d=d.toArray());if(!1===e.isArray(d))throw Error("Illegal Argument");if(1<f.length){if(!1===e.isFunctionParameter(f[1]))throw Error("Illegal Argument");var n=function(l,q){return fa.callfunc(f[1],[l,q],c)};return a.isAsync?U(d,n):d=I(d,function(l,q){return n(l,q)})}if(0===d.length)return[];for(var k={},r=0;r<d.length;r++){var p=aa(d[r]);""!==p&&(k[p]=!0)}if(!0===k.Array||!0===k.Dictionary||!0===k.Feature||!0===k.Point||!0===k.Polygon||!0===k.Polyline||!0===k.Multipoint||!0===k.Extent||!0===k.Function)return d.slice(0);
r=0;p="";for(var v in k)r++,p=v;return d=1<r||"String"===p?I(d,function(l,q){if(null===l||void 0===l||l===e.voidOperation)return null===q||void 0===q||q===e.voidOperation?0:1;if(null===q||void 0===q||q===e.voidOperation)return-1;l=e.toString(l);q=e.toString(q);return l<q?-1:l===q?0:1}):"Number"===p?I(d,function(l,q){return l-q}):"Boolean"===p?I(d,function(l,q){return l===q?0:q?-1:1}):"Date"===p?I(d,function(l,q){return q-l}):d.slice(0)})};var M={},K;for(K in t)M[K]=new e.NativeFunction(t[K]);oa.registerFunctions(t,
w);for(K in t)t[K]=new e.NativeFunction(t[K]);var V=function(){};V.prototype=t;var W=function(){};W.prototype=M;u.functionHelper={fixSpatialReference:e.fixSpatialReference,parseArguments:function(a,b){for(var c=[],d=0;d<b.arguments.length;d++)c.push(g(a,b.arguments[d]));return c},standardFunction:w};u.extend=da;u.executeScript=function(a,b){return a(b)};u.extractFieldLiterals=function(a,b){void 0===b&&(b=!1);return h.findFieldLiterals(a)};u.extractExpectedFieldLiterals=function(a){return h.findExpectedFieldLiterals(a)};
u.validateScript=function(a,b){return h.validateScript(a,b,"sync")};u.referencesMember=function(a,b){return h.referencesMember(a,b)};u.referencesFunction=function(a,b){return h.referencesFunction(a,b)};var X=0,fa={error:function(a,b,c){throw Error(h.nodeErrorMessage(a,b,c));},__awaiter:function(a,b,c,d){return A.create(function(f,n){function k(v){try{p(d.next(v))}catch(l){n(l)}}function r(v){try{p(d["throw"](v))}catch(l){n(l)}}function p(v){v.done?f(v.value):v.value&&v.value.then?v.value.then(k,r):
(X++,0===X%100?setTimeout(function(){X=0;k(v.value)},0):k(v.value))}p((d=d.apply(a,b||[])).next())})},functionDepthchecker:function(a,b){return function(){b.depthCounter++;b.localStack.push([]);if(64<b.depthCounter)throw Error("Exceeded maximum function depth");var c=a.apply(this,arguments);if(A.isPromiseLike(c))return c.then(function(d){b.depthCounter--;--b.localStack.length;return d});b.depthCounter--;--b.localStack.length;return c}},castString:function(a){return e.toString(a)},aCheck:function(a,
b){if(e.isFunctionParameter(a))throw Error(h.nodeErrorMessage({type:b},"RUNTIME","FUNCTIONCONTEXTILLEGAL"));return a===e.voidOperation?null:a},Dictionary:D,Feature:H,dictionary:function(a){for(var b={},c=0;c<a.length;c+=2){if(e.isFunctionParameter(a[c+1]))throw Error("Illegal Argument");if(!1===e.isString(a[c]))throw Error("Illegal Argument");b[a[c].toString()]=a[c+1]===e.voidOperation?null:a[c+1]}a=new D(b);a.immutable=!1;return a},strCheck:function(a){if(!1===e.isString(a))throw Error("Illegal Argument");
return a},unary:function(a,b){if(e.isBoolean(a)){if("!"===b)return!a;if("-"===b)return-1*e.toNumber(a);if("+"===b)return 1*e.toNumber(a);if("~"===b)return~e.toNumber(a);throw Error(h.nodeErrorMessage({type:"UnaryExpression",operator:b,prefix:null,argument:null},"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"));}if("-"===b)return-1*e.toNumber(a);if("+"===b)return 1*e.toNumber(a);if("~"===b)return~e.toNumber(a);throw Error(h.nodeErrorMessage({type:"UnaryExpression",operator:b,prefix:null,argument:null},"RUNTIME",
"NOTSUPPORTEDUNARYOPERATOR"));},logicalCheck:function(a){if(!1===e.isBoolean(a))throw Error(h.nodeErrorMessage({type:"LogicalExpression",operator:null,left:null,right:null},"RUNTIME","ONLYORORAND"));return a},logical:function(a,b,c){if(e.isBoolean(a)&&e.isBoolean(b))switch(c){case "||":return a||b;case "\x26\x26":return a&&b}throw Error(h.nodeErrorMessage({type:"LogicalExpression",operator:null,left:null,right:null},"RUNTIME","ONLYORORAND"));},binary:function(a,b,c){switch(c){case "|":case "\x3c\x3c":case "\x3e\x3e":case "\x3e\x3e\x3e":case "^":case "\x26":return e.binaryOperator(e.toNumber(a),
e.toNumber(b),c);case "\x3d\x3d":return e.equalityTest(a,b);case "\x3d":return e.equalityTest(a,b);case "!\x3d":return!e.equalityTest(a,b);case "\x3c":return e.greaterThanLessThan(a,b,c);case "\x3e":return e.greaterThanLessThan(a,b,c);case "\x3c\x3d":return e.greaterThanLessThan(a,b,c);case "\x3e\x3d":return e.greaterThanLessThan(a,b,c);case "+":return e.isString(a)||e.isString(b)?e.toString(a)+e.toString(b):e.toNumber(a)+e.toNumber(b);case "-":return e.toNumber(a)-e.toNumber(b);case "*":return e.toNumber(a)*
e.toNumber(b);case "/":return e.toNumber(a)/e.toNumber(b);case "%":return e.toNumber(a)%e.toNumber(b);default:throw Error(h.nodeErrorMessage({type:"BinaryExpression",operator:c,left:a,right:b},"RUNTIME","OPERATORNOTRECOGNISED"));}},assign:function(a,b,c){switch(b){case "\x3d":return a===e.voidOperation?null:a;case "/\x3d":return e.toNumber(c)/e.toNumber(a);case "*\x3d":return e.toNumber(c)*e.toNumber(a);case "-\x3d":return e.toNumber(c)-e.toNumber(a);case "+\x3d":return e.isString(c)||e.isString(a)?
e.toString(c)+e.toString(a):e.toNumber(c)+e.toNumber(a);case "%\x3d":return e.toNumber(c)%e.toNumber(a);default:throw Error(h.nodeErrorMessage({type:"AssignmentExpression",operator:b,left:null,right:null},"RUNTIME","OPERATORNOTRECOGNISED"));}},update:function(a,b,c,d){var f=e.toNumber(a[b]);a[b]="++"===c?f+1:f-1;return!1===d?f:"++"===c?f+1:f-1},graphicToFeature:function(a,b){return null===a?null:H.createFromGraphicLikeObject(a.geometry,a.attributes,b)},memberupdate:function(a,b,c,d){if(e.isArray(a))if(e.isNumber(b)){0>
b&&(b=a.length+b);if(0>b||b>=a.length)throw Error("Assignment outside of array bounds");var f=e.toNumber(a[b]);a[b]="++"===c?f+1:f-1}else throw Error("Invalid Parameter");else if(a instanceof D){if(!1===e.isString(b))throw Error("Dictionary accessor must be a string");if(!0===a.hasField(b))f=e.toNumber(a.field(b)),a.setField(b,"++"===c?f+1:f-1);else throw Error("Invalid Parameter");}else if(a instanceof H){if(!1===e.isString(b))throw Error("Feature accessor must be a string");if(!0===a.hasField(b))f=
e.toNumber(a.field(b)),a.setField(b,"++"===c?f+1:f-1);else throw Error("Invalid Parameter");}else{if(e.isImmutableArray(a))throw Error("Array is Immutable");throw Error("Invalid Parameter");}return!1===d?f:"++"===c?f+1:f-1},assignmember:function(a,b,c,d){if(e.isArray(a))if(e.isNumber(b)){0>b&&(b=a.length+b);if(0>b||b>a.length)throw Error("Assignment outside of array bounds");if(b===a.length&&"\x3d"!==c)throw Error("Invalid Parameter");a[b]=this.assign(d,c,a[b])}else throw Error("Invalid Parameter");
else if(a instanceof D){if(!1===e.isString(b))throw Error("Dictionary accessor must be a string");if(!0===a.hasField(b))a.setField(b,this.assign(d,c,a.field(b)));else{if("\x3d"!==c)throw Error("Invalid Parameter");a.setField(b,this.assign(d,c,null))}}else if(a instanceof H){if(!1===e.isString(b))throw Error("Feature accessor must be a string");if(!0===a.hasField(b))a.setField(b,this.assign(d,c,a.field(b)));else{if("\x3d"!==c)throw Error("Invalid Parameter");a.setField(b,this.assign(d,c,null))}}else{if(e.isImmutableArray(a))throw Error("Array is Immutable");
throw Error("Invalid Parameter");}},member:function(a,b){if(null===a)throw Error(h.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","NOTFOUND"));if(a instanceof D||a instanceof H){if(e.isString(b))return a.field(b);throw Error(h.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"));}if(a instanceof ta){if(e.isString(b))return Ma(a,b,"MemberExpression");throw Error(h.nodeErrorMessage({type:"MemberExpression",
object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"));}if(e.isArray(a)){if(e.isNumber(b)&&isFinite(b)&&Math.floor(b)===b){0>b&&(b=a.length+b);if(b>=a.length||0>b)throw Error(h.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","OUTOFBOUNDS"));return a[b]}throw Error(h.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"));}if(e.isString(a)){if(e.isNumber(b)&&isFinite(b)&&Math.floor(b)===b){0>
b&&(b=a.length+b);if(b>=a.length||0>b)throw Error(h.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","OUTOFBOUNDS"));return a[b]}throw Error(h.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"));}if(e.isImmutableArray(a)&&e.isNumber(b)&&isFinite(b)&&Math.floor(b)===b){0>b&&(b=a.length()+b);if(b>=a.length()||0>b)throw Error(h.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},
"RUNTIME","OUTOFBOUNDS"));return a.get(b)}throw Error(h.nodeErrorMessage({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"));},callfunc:function(a,b,c){return a instanceof e.NativeFunction?a.fn(c,b):a instanceof e.SizzleFunction?a.fn.apply(this,b):a.apply(this,b)}};u.compileScript=function(a,b,c){void 0===b&&(b=null);void 0===c&&(c=!1);null===b&&(b={vars:{},customfunctions:{}});b={isAsync:c,globalScope:Na(b.vars,c?M:t,b.customfunctions),localScope:null,mangleMap:{},
console:ea,lrucache:b.lrucache,interceptor:b.interceptor,services:b.services,symbols:{symbolCounter:0}};a=g(b,a.body[0].body);""===a&&(a="lc.voidOperation; ");b={lc:e,lang:fa,mangles:b.mangleMap,postProcess:function(d){d instanceof e.ReturnResult&&(d=d.value);d instanceof e.ImplicitResult&&(d=d.value);d===e.voidOperation&&(d=null);if(d===e.breakResult)throw Error("Cannot return BREAK");if(d===e.continueResult)throw Error("Cannot return CONTINUE");if(e.isFunctionParameter(d))throw Error("Cannot return FUNCTION");
return d},prepare:function(d,f){var n=d.spatialReference;if(null===n||void 0===n)n=new ya({wkid:102100});var k=d.vars,r=d.customfunctions,p=f?new W:new V;k||(k={});r||(r={});var v=new D({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});v.immutable=!1;p._SymbolsMap={textformatting:1,infinity:1,pi:1};p.textformatting=v;p.infinity=Number.POSITIVE_INFINITY;p.pi=Math.PI;for(var l in r)p[l]=r[l],p._SymbolsMap[l]=1;for(l in k)p._SymbolsMap[l]=1,p[l]=k[l]&&"esri.Graphic"===
k[l].declaredClass?H.createFromGraphic(k[l]):k[l];return{localStack:[],isAsync:f,mangleMap:this.mangles,spatialReference:n,globalScope:p,abortSignal:void 0===d.abortSignal||null===d.abortSignal?{aborted:!1}:d.abortSignal,localScope:null,services:d.services,console:d.console?d.console:ea,lrucache:d.lrucache,interceptor:d.interceptor,symbols:{symbolCounter:0},depthCounter:1}}};return(new Function("context","spatialReference",c?"var runtimeCtx\x3dthis.prepare(context, true);\n var lc \x3d this.lc;  var lang \x3d this.lang; var gscope\x3druntimeCtx.globalScope; \nreturn lang.__awaiter(this, void 0, void 0, function* () {\n\n function mainBody() {\n var lastStatement\x3dlc.voidOperation;\n return lang.__awaiter(this, void 0, void 0, function* () {\n"+
a+"\n return lastStatement; }); } \n return this.postProcess(yield mainBody()); }); ":"var runtimeCtx\x3dthis.prepare(context, false);\n var lc \x3d this.lc;  var lang \x3d this.lang; var gscope\x3druntimeCtx.globalScope; \n function mainBody() {\n var lastStatement\x3dlc.voidOperation;\n "+a+"\n return lastStatement; } \n return this.postProcess(mainBody()); ")).bind(b)};u.enableAsyncSupport=function(){return A.create(function(a,b){ha(["./functions/geomasync"],function(c){da([c],"async");a(!0)},
function(c){b(c)})})}});