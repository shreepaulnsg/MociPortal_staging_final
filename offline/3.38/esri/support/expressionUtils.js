// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/support/expressionUtils","dojo/_base/lang dojo/_base/array dojo/has dojo/Deferred ../kernel ../arcade/arcade ../arcade/Feature".split(" "),function(l,h,r,m,t,d,n){function u(a){return a.replace(/[|\\{}()[\]^$+*?.]/g,"\\$\x26")}var v={vars:{$feature:"any",$view:"any"}},p=/^\$(feature|aggregatedFeatures)\./i,f={_getSyntaxTree:function(a){return"string"===typeof a?f.createSyntaxTree(a):a},createSyntaxTree:function(a){try{var b=a?d.parseScript(a):null}catch(c){b=null}return b},createFunction:function(a,
b){b=b||l.clone(v);a=f._getSyntaxTree(a);try{var c=a?d.compileScript(a,b):null}catch(g){console.log("expressionUtils.createFunction: compilation failed. "+(g.message||"")),c=null}return c},createExecContext:function(a,b){return{vars:{$feature:a?n.createFromGraphic(a):new n,$view:b&&b.view},spatialReference:b&&b.sr}},evalSyntaxTree:function(a,b){try{var c=d.executeScript(a,b)}catch(g){c=null}return c},executeFunction:function(a,b){try{var c=a?a(b):null}catch(g){c=null}return c},executeAsyncFunction:function(a,
b){try{var c=a?a(b):(new m).reject(Error("expressionUtils.executeAsyncFunction: Invalid argument. compiledFunc is missing."))}catch(g){c=(new m).reject(g)}return c},extractFieldNames:function(a,b){a=f._getSyntaxTree(a);a=d.extractExpectedFieldLiterals(a);var c=[];h.forEach(a,function(e){p.test(e)&&(e=e.replace(p,""),c.push(e))});var g=h.filter(c,function(e){return-1!==e.indexOf("*")});c=h.filter(c,function(e){return-1===g.indexOf(e)});b&&h.forEach(g,function(e){var k=new RegExp("^"+e.split(/\*+/).map(u).join(".*")+
"$","i");h.forEach(b,function(q){k.test(q)&&c.push(q)})});c.sort();return h.filter(c,function(e,k){return 0===k||c[k-1]!==e})},dependsOnView:function(a){return f.hasVariable(a,"$view")},hasGeometryFunctions:function(a){return(a=f._getSyntaxTree(a))?d.scriptTouchesGeometry(a):!1},hasGeometryOperations:function(a){return(a=f._getSyntaxTree(a))?d.scriptUsesGeometryEngine(a):!1},enableGeometryOperations:function(){return d.enableGeometrySupport()},hasVariable:function(a,b){return(a=f._getSyntaxTree(a))?
d.referencesMember(a,b):!1},hasFunction:function(a,b){return(a=f._getSyntaxTree(a))?d.referencesFunction(a,b):!1},createFeatureSetFromLayer:function(a,b){b=b||{};var c=d.featureSetUtils();return c?c.constructFeatureSet(a,b.spatialReference,b.outFields,b.returnGeometry,b.cache):null},createFeatureSetFromLayerUrl:function(a,b){b=b||{};var c=d.featureSetUtils();return c?c.constructFeatureSetFromUrlRaw(a,b.spatialReference,b.outFields,b.returnGeometry,b.cache):null},createFeatureSetCollectionFromMap:function(a,
b){var c=d.featureSetUtils();return c?c.createFeatureSetCollectionFromMap(a,a.spatialReference,b&&b.cache):null},createFeatureSetCollectionFromServiceUrl:function(a,b){b=b||{};var c=d.featureSetUtils();return c?c.createFeatureSetCollectionFromService(a,b.spatialReference,b.cache):null},hasFeatureSetOperations:function(a){return(a=f._getSyntaxTree(a))?d.scriptUsesFeatureSet(a):!1},enableFeatureSetOperations:function(){return d.enableFeatureSetSupport().then(function(){var a=d.featureSetUtils();a&&
a.initialiseMetaDataCache()})},enableAsyncOperations:function(){return d.enableAsyncSupport()}};r("extend-esri")&&l.setObject("support.expressionUtils",f,t);return f});