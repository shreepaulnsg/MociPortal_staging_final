// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/GraphicsLayer","require dojo/_base/declare dojo/_base/Deferred dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/window dojo/dom-attr dojo/dom-construct dojo/dom-style dojo/dom dojox/gfx dojox/gfx/matrix ./gfxSniff!esri-svg?dojox/gfx/filters ./layer ./support/webglUtils ./support/WebGLSurface ../kernel ../lang ../sniff ../Color ../domUtils ../symbols/MarkerSymbol ../symbols/SimpleMarkerSymbol ../symbols/utils ../geometry/Point ../geometry/ScreenPoint ../geometry/Extent ../geometry/mathUtils ../geometry/screenUtils ../PluginTarget ./gfxSniff!esri-svg?dojox/gfx/svgext".split(" "),
function(oa,O,pa,D,B,z,fa,aa,W,F,qa,P,R,K,Y,ba,ra,H,ha,I,sa,X,ya,J,ia,ja,ca,S,ka,da,ta){var T=-1!==P.renderer.toLowerCase().indexOf("svg"),L=-1!==P.renderer.toLowerCase().indexOf("canvas"),ea=L?"canvas-2d":P.renderer,G=9>I("ie");fa=10===I("ie");var la=void 0===I("ie")&&7==I("trident"),ua=fa||la,ma=I("esri-touch"),na=!!I("chrome"),Z=ba.isWebGLEnabled(),va=T&&I("esri-will-change"),Q=Z||L;ba=O(null,{declaredClass:"esri.layers._GraphicsContainer",_setMap:function(a,b){var c=this._connects=[];this._map=
a;this._useWillChange=this._useGlobalTransform="css-transforms"===a.navigationMode&&va;if(Q){var d=W.create("div",{style:{position:"absolute",overflow:"visible"}},b);this._surface={getEventSource:function(){return d}};L&&(c.push(D.connect(d,"onmousedown",this,this._canvasDownHandler)),c.push(D.connect(d,"onmouseup",this,this._canvasUpHandler)),c.push(D.connect(d,"onclick",this,this._canvasClickHandler)));Z&&(this._webglSurface=new ra({map:a,node:d}))}else d=(this._surface=P.createSurface(b,a.width,
a.height)).getEventSource(),this._useWillChange&&F.set(d,"will-change","transform"),F.set(d=G?d.parentNode:d,{overflow:"visible",position:"absolute"});c.push(D.connect(a,"onResize",this,"_onResizeHandler"));this._useGlobalTransform&&(c.push(D.connect(a,"onPan",this,"_onPanHandler")),c.push(D.connect(a,"onPanEnd",this,"_onPanEndHandler")),c.push(D.connect(a,"onExtentChange",this,"_onExtentChangeHandler")));return d},_reorderLayer:function(a,b,c){b=b.getEventSource();Q&&"svg"===a.surfaceType&&(b=b.parentNode);
W.place(b,this._surface.getEventSource(),c)},_onPanHandler:function(a,b){var c=this._map.__visibleRect;a=c.x+b.x;b=c.y+b.y;this._panDx=a;this._panDy=b;Q||F.set(this._surface.getEventSource(),H._css.names.transform,H._css.translate(a,b))},_onPanEndHandler:function(a,b){b=this._map.__visibleRect;a=b.x;b=b.y;this._panDx=a;this._panDy=b;Q||F.set(this._surface.getEventSource(),H._css.names.transform,H._css.translate(a,b))},_onExtentChangeHandler:function(a,b,c,d){c&&(this._panDy=this._panDx=0,Q||F.set(this._surface.getEventSource(),
H._css.names.transform,H._css.translate(0,0)))},_getTransform:function(){return{dx:this._panDx||0,dy:this._panDy||0}},_onResizeHandler:function(a,b,c){a=this._surface.getEventSource();var d=this._map,e;G&&F.set(a=a.parentNode,{width:b+"px",height:c+"px",clip:"rect(0px "+b+"px "+c+"px 0px)"});aa.set(a,"width",b);aa.set(a,"height",c);this._surface.declaredClass||z.forEach(a.childNodes,function(f){aa.set(f,"width",b);aa.set(f,"height",c)});d.loaded&&(d.graphics.suspended||(d.graphics._resized=!0),z.forEach(d.graphicsLayerIds,
function(f){e=d.getLayer(f);e.suspended||(e._resized=!0,e._childLayer&&(e._childLayer._resized=!0));e._updateSVGFilters(null,null,b,c)}),d.graphics._updateSVGFilters(null,null,b,c),d._labels&&d._labels._updateSVGFilters(null,null,b,c))},_cleanUp:function(){z.forEach(this._connects,D.disconnect,D);this._map=this._surface=null},_processEvent:function(a){var b=this._map;a.screenPoint=new ca(a.pageX-b.position.x,a.pageY-b.position.y);a.mapPoint=b.toMap(a.screenPoint)},_canvasDownHandler:function(a){this._processEvent(a);
this._downPt=a.screenPoint.x+","+a.screenPoint.y},_canvasUpHandler:function(a){this._processEvent(a);this._upPt=a.screenPoint.x+","+a.screenPoint.y},_tolerance:15,_isPrimaryMatch:function(a,b,c,d){if(!a.visible||!b)return!1;var e=b.getTransformedBoundingBox();if(e){var f=new S(e[0].x,e[0].y,e[2].x,e[2].y);delete f.spatialReference;return ma?f.intersects(c):f.contains(d)}return z.some(b.children||[],function(g){e=g.getTransformedBoundingBox();f=new S(e[0].x,e[0].y,e[2].x,e[2].y);delete f.spatialReference;
return ma?f.intersects(c):f.contains(d)})},_canvasClickHandler:function(a){if(this._downPt&&this._upPt&&this._downPt===this._upPt){this._processEvent(a);var b=this._map,c=z.map(b.graphicsLayerIds,function(n){return b.getLayer(n)});c.push(b.graphics);c.reverse();c=z.filter(c,function(n){return n.loaded&&!n.hasWebGLSurface()&&n._mouseEvents&&!n.suspended&&(!ha.isDefined(n.opacity)||0<n.opacity)});var d=a.screenPoint,e=this._tolerance,f=d.x-e,g=d.y+e,h=d.x+e;e=d.y-e;var m=new S(f,e,h,g);f=b.toMap(new ca(f,
g));h=b.toMap(new ca(h,e));g=f.spatialReference._getInfo();var p=new S(S.prototype._normalizeX(f.x,g).x,f.y,S.prototype._normalizeX(h.x,g).x,h.y,f.spatialReference),r;delete m.spatialReference;z.some(c,function(n){n=z.filter(n.graphics,function(v){return this._isPrimaryMatch(v,v.getDojoShape(),m,d)||!(!v._bgShape||!this._isPrimaryMatch(v,v._bgShape,m,d))},this);n.reverse();if(0<n.length){var y;z.some(n,function(v){return v.geometry&&p.intersects(v.geometry)?(y=v,!0):!1});if(y)return r=y,!0}return!1},
this);r&&(c=r.getLayer())&&(a.graphic=r,c.onClick(a))}}});Y=O(Y,{declaredClass:"esri.layers._GraphicsLayer",managedSuspension:!0,surfaceType:ea,webglEnabled:Z,renderer:null,_eventMap:{"graphic-add":["graphic"],"graphic-remove":["graphic"],"renderer-change":["renderer"]},_suspendGraphics:!1,constructor:function(a,b){a=a||{};if(B.isString(a)||B.isObject(a)&&(a.layerDefinition||a.query))a=b;this._params=B.mixin({displayOnPan:!0,drawMode:!0,styling:!0},a);b=this._params.dataAttributes;"string"===typeof b&&
(b=[b]);this.styling=T?this._params.styling:!0;this.dataAttributes=b;this.infoTemplate=a&&a.infoTemplate;this.graphics=[];this._draw=B.hitch(this,this._draw);this._refresh=B.hitch(this,this._refresh);this._acquireSVGMarker=B.hitch(this,this._acquireSVGMarker);this._evalSurfaceType=B.hitch(this,this._evalSurfaceType);this._setSurfaceType=B.hitch(this,this._setSurfaceType);this.setWebGLEnabled(null!=this._params.webglEnabled?this._params.webglEnabled:this.webglEnabled);this.registerConnectEvents()},
getNode:function(){return this._div&&this._div.getEventSource()},setDrawMode:function(a){this._params.drawMode=a},suspendGraphics:function(a){this._suspendGraphics=a;z.forEach(this.graphics,function(b){b._suspended=a})},setWebGLEnabled:function(a){var b=this.webglEnabled;this.webglEnabled=(a||!1)&&Z;b!==this.webglEnabled&&(this._evalSurfaceType(),this.onWebGLEnabledChange())},hasWebGLSurface:function(){return"webgl"===this.surfaceType},_getSurfaceType:function(a){return a&&"webgl"===a.surfaceType?
"webgl":ea},_evalSurfaceType:function(a){Z&&(a?this._setSurfaceType():null==this._evalSurfaceTimerHandle&&(this._evalSurfaceTimerHandle=setTimeout(this._setSurfaceType,0)))},_hasPendingSurfaceEval:function(){return!!this._evalSurfaceTimerHandle},_setSurfaceType:function(){clearTimeout(this._evalSurfaceTimerHandle);this._evalSurfaceTimerHandle=null;var a=this._canUseWebGLSurface()?"webgl":ea;this.surfaceType!==a?(this.surfaceType=a,this._handleSurfaceChange(),this.onSurfaceChange()):this._pendingRedraw&&
this._redraw()},_handleSurfaceChange:function(){this._cancelWebGLDepsLoad();this._webglDepsPromise=this._prepareToAttach(this._map);this._webglDepsPromise.always(B.hitch(this,function(a){this._webglDepsPromise=null;a&&"cancel"===a.dojoType||this._evalSurface()}))},_cancelWebGLDepsLoad:function(){this._webglDepsPromise&&!this._webglDepsPromise.isFulfilled()&&this._webglDepsPromise.cancel();this._webglDepsPromise=null},_evalSurface:function(){var a=this._map,b=this._div;a&&b&&this._getSurfaceType(b)!==
this.surfaceType&&(a._detachGraphicsLayer(this),a._attachGraphicsLayer(this))},_canUseWebGLSurface:function(a){a=a||this._map;return this.webglEnabled&&(!a||a.webglEnabled&&(a.ownsWebGLContext(this)||a.isWebGLContextAvailable()))&&this._params.drawMode&&this._isWebGLCompatible()},_isWebGLCompatible:function(){return!1},_prepareToAttach:function(a){var b=new pa;!this.webglDeps&&this._canUseWebGLSurface(a)?oa(["./support/webglDeps"],B.hitch(this,function(c){this.webglDeps=c;b.isFulfilled()||b.resolve()})):
b.resolve();return b.promise},_setMap:function(a,b){this.inherited(arguments);this._map=a;this._evalSurfaceType(!0);this._webglChangeMapHandle=a.on("webgl-enabled-change",B.hitch(this,function(){this._evalSurfaceType()}));this._wrap=a.wrapAround180;this._srInfo=a.spatialReference._getInfo();this._svgFilters={};this._lineMarkers={};if(this.hasWebGLSurface())a.acquireWebGLContext(this),this._div=a._gc._webglSurface.createRenderer(this.webglDeps.WebGLRenderer,a.width,a.height,this);else{if("svg"===this.surfaceType)if(Q){b=
P.createSurface(b.getEventSource(),a.width,a.height);var c=b.getEventSource();F.set(c,{position:"absolute",overflow:"visible",pointerEvents:"none"});a._gc._useWillChange&&F.set(c,"will-change","transform");this._div=b.createGroup();F.set(this._div.getEventSource(),"pointer-events","auto")}else this._div=b.createGroup();else b=P.createSurface(b.getEventSource(),a.width,a.height),F.set(b.rawNode,"position","absolute"),this._div=b.createGroup(),this._renderProto=this._div.constructor.prototype._render,
this._div._render=B.hitch(this,this._canvasRender);this._bgGroup=this._div.createGroup()}this._div.getEventSource().id=this.id+"_layer";this._initOpacity();return this._div},_unsetMap:function(a,b){a.releaseWebGLContext(this);"webgl"===this._div.surfaceType?a._gc._webglSurface.destroyRenderer(this._div):(z.forEach(this.graphics,function(c){c._shape=null}),"svg"===this.surfaceType?Q?(b=this._div.parent,this._div.clear(),b.remove(this._div),W.destroy(this._div.getEventSource()),W.destroy(b.getEventSource())):
(this._div.clear(),b.remove(this._div),W.destroy(this._div.getEventSource())):(b=this._div.getParent(),b._parent={},W.destroy(b.rawNode),b.destroy()));this._map=this._div=this._svgFilters=this._lineMarkers=null;this._pendingRedraw=!1;clearTimeout(this._wakeTimer);this._wakeTimer=null;clearTimeout(this._evalSurfaceTimerHandle);this._evalSurfaceTimerHandle=null;this._webglChangeMapHandle&&this._webglChangeMapHandle.remove();this._cancelWebGLDepsLoad();this._disableDrawConnectors();this.inherited(arguments)},
_initOpacity:function(){var a=this.opacity;ha.isDefined(a)&&1>a&&this.setOpacity(a,!0)},_onZoomStartHandler:function(){this.hasWebGLSurface()||X.hide(this._div.getEventSource())},_onExtentChangeHandler:function(a,b,c,d){clearTimeout(this._wakeTimer);this._wakeTimer=null;c?(a=this._map.__visibleRect,b=this._div,this._evalSDRenderer(),this._refresh(!0),this._params._child||this._updateTransform(b,a.x,a.y,!0),this._renderProto&&b.surface.pendingRender?this._dirty=!0:this.suspended||X.show(b.getEventSource())):
this._resized&&(this._resized=!1,this._refresh(!1));if(0<this.graphics.length)this.onUpdate()},_canvasRender:function(){var a=this._div;this._dirty&&(delete this._dirty,this.suspended||X.show(a.getEventSource()));return this._renderProto.apply(a,arguments)},_refresh:function(a){if(!this.hasWebGLSurface()){var b=this.graphics,c=b.length,d,e=this._draw;for(d=0;d<c;d++)e(b[d],a)}},refresh:function(){this._refresh(!0)},_redraw:function(){this._pendingRedraw=!1;this.hasWebGLSurface()?this._div&&this._div.redraw():
this._refresh(!0)},redraw:function(){this._hasPendingSurfaceEval()?this._pendingRedraw=!0:this._redraw()},hasLocalNavigationTransform:function(){return!(this._map&&this._map._gc._useGlobalTransform)},getNavigationTransform:function(){var a={dx:0,dy:0};this._map&&(this.hasLocalNavigationTransform()?this._div&&!this.hasWebGLSurface()&&(a=this._div.getTransform()):a=this._map._gc._getTransform());return a},_onPanHandler:function(a,b){this._panDx=b.x;this._panDy=b.y;a=this._map.__visibleRect;this._updateTransform(this._div,
a.x+b.x,a.y+b.y);la&&this._updateSVGMarkers()},_onPanEndUpdateHandler:function(a,b){a=this._map.__visibleRect;this._params._child||b.x===this._panDx&&b.y===this._panDy?(this._updateSVGFilters(-a.x,-a.y),this._updateSVGMarkers()):this._updateTransform(this._div,a.x,a.y,!0);this._refresh(!1);if(this.graphics.length)this.onUpdate()},_onPanStartHandler:function(){X.hide(this._div.getEventSource())},_onPanEndHandler:function(){var a=this._map.__visibleRect,b=this._div;this._updateTransform(b,a.x,a.y,!0);
this._refresh(!1);this._renderProto&&b.surface.pendingRender?this._dirty=!0:X.show(b.getEventSource());if(this.graphics.length)this.onUpdate()},_updateTransform:function(a,b,c,d){this.hasWebGLSurface()||(this.hasLocalNavigationTransform()?a.setTransform(R.translate({x:b,y:c})):Q&&F.set(this._div.parent.getEventSource(),H._css.names.transform,H._css.translate(b,c)),d&&(this._updateSVGFilters(-b,-c),this._updateSVGMarkers()))},onSuspend:function(){this.inherited(arguments);X.hide(this._div.getEventSource());
clearTimeout(this._wakeTimer);this._wakeTimer=null;this._disableDrawConnectors()},onResume:function(a){this.inherited(arguments);a.firstOccurrence&&this._evalSDRenderer();this._enableDrawConnectors();this._wakeTimer=this._wakeTimer||setTimeout(B.hitch(this,function(){this.suspended||this._map.__zooming||this._onExtentChangeHandler(null,null,!0)}),0)},_enableDrawConnectors:function(){var a=this._map,b=D.connect;this._disableDrawConnectors();this._params.displayOnPan?(this._params._child||(this._onPanHandler_connect=
b(a,"onPan",this,"_onPanHandler")),this._onPanEndHandler_connect=b(a,"onPanEnd",this,"_onPanEndUpdateHandler")):(this._onPanStartHandler_connect=b(a,"onPanStart",this,"_onPanStartHandler"),this._onPanEndHandler_connect=b(a,"onPanEnd",this,"_onPanEndHandler"));this._onZoomStartHandler_connect=b(a,"onZoomStart",this,"_onZoomStartHandler");this._onExtentChangeHandler_connect=b(a,"onExtentChange",this,"_onExtentChangeHandler")},_disableDrawConnectors:function(){var a=D.disconnect;a(this._onExtentChangeHandler_connect);
a(this._onZoomStartHandler_connect);a(this._onPanHandler_connect);a(this._onPanStartHandler_connect);a(this._onPanEndHandler_connect);this._onExtentChangeHandler_connect=this._onZoomStartHandler_connect=this._onPanHandler_connect=this._onPanStartHandler_connect=this._onPanEndHandler_connect=null},_updateExtent:function(a){var b=a.geometry;if(!b)a._extent=null;else if(!(a._extent=b.getExtent())){if("esri.geometry.Point"===b.declaredClass){var c=b.x;var d=b.y}else if("esri.geometry.Multipoint"===b.declaredClass)c=
b.points[0][0],d=b.points[0][1];else{a._extent=null;return}a._extent=new S(c,d,c,d,b.spatialReference)}},_intersects:function(a,b,c){var d=a.spatialReference,e=b.spatialReference,f=d&&e&&!d.equals(e)&&d._canProject(e)&&4326===e.wkid;if(this._wrap&&!c){c=[];d=a._getFrameWidth();var g=this._srInfo,h=a._clip?a._getAvailExtent():a.extent,m,p=[];var r=b._partwise;f&&(h=a.geographicExtent,g=e._getInfo());a=h._getParts(g);if(r&&r.length)for(b=[],e=0,f=r.length;e<f;e++)b=b.concat(r[e]._getParts(g));else b=
b._getParts(g);e=0;for(f=b.length;e<f;e++){var n=b[e];g=0;for(h=a.length;g<h;g++){var y=a[g];if(y.extent.intersects(n.extent))for(r=0,m=n.frameIds.length;r<m;r++)c.push((y.frameIds[0]-n.frameIds[r])*d)}}e=0;for(f=c.length;e<f;e++)r=c[e],z.indexOf(c,r)===e&&p.push(r);return p.length?p:null}return(f?a.geographicExtent:a.extent).intersects(b)?[0]:null},_defaultMarker:{type:"simplemarkersymbol",style:"square",size:1,xoffset:0,yoffset:0,angle:0},_draw:function(a,b){if(!this.hasWebGLSurface()&&this._params.drawMode&&
this._map&&!this.suspended&&!this._map.__zooming&&!this._resized)try{var c=a._extent,d,e,f=!T||this.styling,g=T&&this.dataAttributes,h=a.getDojoShape(),m;if(!a._suspended&&a.visible&&c&&(d=this._intersects(this._map,c,a.geometry._originOnly))&&(e=f?this._getSymbol(a):this._defaultMarker)){if(a._offsets&&a._offsets.join(",")===d.join(",")?m=!0:a._offsets=d,!h||b||!m){var p=a.geometry.type;b={graphic:a};var r=a._bgShape,n=f&&!a.symbol?this._getRenderer(a):null,y=n&&n.backgroundFillSymbol;if("point"===
p)this._isInvalidShape(e,h)&&this._removeShape(a),a._shape=this._drawPoint(this._div,a.geometry,e,a.getDojoShape(),d,n,a),f&&this._symbolizePoint(a.getDojoShape(),e,n,a);else if("multipoint"===p)this._drawMarkers(a,e,d,n),f&&this._symbolizeMarkers(a,e,n);else{var v;p=e;var k;f&&(p=(v="simplemarkersymbol"===e.type||"picturemarkersymbol"===e.type||"textsymbol"===e.type?e:null)?y:e);if(f&&p&&-1<p.type.indexOf("fillsymbol")){var l=this._bgGroup;var q=!(!l||!v)}r&&!q&&this._removeBgShape(a);if(p){!q&&
(this._isInvalidShape(p,a._shape)||a._shape&&a._shape._isCentroidMarker)&&this._removeShape(a,!1);if(k=this._drawShape(a,d,l||this._div,q?r:a.getDojoShape()))k._isCentroidMarker=!1;f&&this._symbolizeShape(k,p,n,p===y,a);a[q?"_bgShape":"_shape"]=k}if(v){(this._isInvalidShape(v,a._shape)||a._shape&&!a._shape._isCentroidMarker)&&this._removeShape(a,!1);var u=a.geometry.getCentroid();if(k=u&&this._drawPoint(this._div,u,v,a._shape,d,n,a))k._isCentroidMarker=!0,this._symbolizePoint(k,v,n,a);a._shape=k}}L||
(a._bgShape&&this._initNode(a,a._bgShape,a._bgShape!==r,b,g),a._shape&&this._initNode(a,a._shape,a._shape!==h,b,g));a._applyDataAttrs();b.node=a.getNode();this.onGraphicDraw(b)}}else h&&this._removeShape(a)}catch(t){this._errorHandler(t,a)}},_initNode:function(a,b,c,d,e){if(b=b&&b.getNode())b.e_graphic=a,this._addDataAttrs(a,e,b),c&&(d.node=b,this.onGraphicNodeAdd(d))},_removeShape:function(a,b,c){var d=a.getDojoShape(),e=d&&d.getNode();d&&!c&&(d.removeShape(),d.destroy());a._shape=a._offsets=null;
!1!==b&&this._removeBgShape(a,c);if(e&&(e.e_graphic=null,!L))this.onGraphicNodeRemove({graphic:a,node:e})},_removeBgShape:function(a,b){var c=a._bgShape,d=c&&c.getNode();c&&!b&&(c.removeShape(),c.destroy());a._bgShape=null;if(d&&(d.e_graphic=null,!L))this.onGraphicNodeRemove({graphic:a,node:d})},_addDataAttrs:function(a,b,c){var d=a.attributes,e,f=b?b.length:0,g=this._getRenderer(a);if(c&&d){for(e=0;e<f;e++)(c=b[e])&&a.attr("data-"+c,d[c]);!this.styling&&g&&(g.getBreakIndex?(b=g.getBreakIndex(a),
a.attr("data-class-break",-1!==b?b:null)):g.getUniqueValueInfo&&(b=g.getUniqueValueInfo(a),a.attr("data-unique-value",b?b.value:null)))}},_drawShape:function(a,b,c,d){a=a.geometry;var e=a.type,f=this._map,g=f.extent,h=f.width,m=f.height;f=f.__visibleRect;var p=[],r;var n="extent"===e;if("rect"===e||n)p={x:0,y:0,spatialReference:a.spatialReference},p.x=n?a.xmin:a.x,p.y=n?a.ymax:a.y,e=da.toScreenPoint(g,h,m,p),p.x=n?a.xmax:a.x+a.width,p.y=n?a.ymin:a.y+a.height,a=da.toScreenPoint(g,h,m,p),b={x:e.x-f.x+
b[0],y:e.y-f.y,width:Math.abs(a.x-e.x),height:Math.abs(a.y-e.y)},0===b.width&&(b.width=1),0===b.height&&(b.height=1),d=this._drawRect(c,d,b);else if("polyline"===e||"polygon"===e){n=0;for(r=b.length;n<r;n++)p=p.concat(da._toScreenPath(g,h,m,a,-f.x+b[n],-f.y));d=this._drawPath(c,d,p);this._rendererLimits&&("polyline"===e?this._clipPolyline(d,a):this._clipPolygon(d,a))}return d},_drawRect:function(a,b,c){return b?b.setShape(c):a.createRect(c)},_drawImage:function(a,b,c){return b?b.setShape(c):a.createImage(c)},
_drawCircle:function(a,b,c){return b?b.setShape(c):a.createCircle(c)},_drawPath:function(){return G?function(a,b,c,d){c=d?c:c.join(" ");if(b)return b.setShape(c);b=a.createObject(d?P.Path:P.EsriPath,c);a._overrideSize(b.getEventSource());return b}:function(a,b,c,d){c=d?c:c.join(" ");return b?b.setShape(c):a.createPath(c)}}(),_drawText:function(a,b,c){return b?b.setShape(c):a.createText(c)},_evalSDRenderer:function(a){var b=this._map,c=this.renderer,d,e=this._rndForScale;b&&b.loaded&&c&&c.getRendererInfo&&
(d="zoom"===c.rangeType?c.getRendererInfoByZoom(b.getZoom()):c.getRendererInfoByScale(b.getScale()));this._rndForScale=d&&d.renderer;a||this._rndForScale==e||this.emit("renderer-change",{renderer:this._rndForScale})},_getRenderer:function(a){var b=this._rndForScale||this.renderer;a&&b&&b.getObservationRenderer&&(b=b.getObservationRenderer(a));return b},_getSymbol:function(a){var b=this._getRenderer();return a.symbol||b&&b.getSymbol(a)},_getVariable:function(a,b,c){if(a)var d=(a=a.getVisualVariablesForType(b,
c))&&a[0];return d},_applyOpacity:function(a,b,c,d){b=b.getOpacity(d,{opacityInfo:c});null!=b&&(a=new sa(a),a.a=b);return a},_symbolizeShape:function(a,b,c,d,e){var f=b.getStroke(),g=b.getFill(),h=b.type,m=-1!==h.indexOf("linesymbol"),p=-1!==h.indexOf("fillsymbol")?null:this._getVariable(c,"sizeInfo",!1),r=this._getVariable(c,"colorInfo",!1),n=this._getVariable(c,"opacityInfo",!1),y=m?"none"!==b.style:b.outline&&"none"!==b.outline.style,v=m?null:this._getVariable(c,"sizeInfo","outline");p=(p=d?v:
v||p)?c.getSize(e,{sizeInfo:p,resolution:this._map.getResolutionInMeters(),scale:this._map.getScale()}):null;d&&(r=n=null);if((r||n)&&"picturefillsymbol"!==h)if(m){var k=f&&f.color;r&&(k=c.getColor(e,{colorInfo:r})||k);k&&n&&(k=this._applyOpacity(k,c,n,e))}else if(g&&g.toCss){var l=g;r&&(l=c.getColor(e,{colorInfo:r})||l);l&&n&&(l=this._applyOpacity(l,c,n,e))}a.setStroke(!y||null==p&&!k?f:B.mixin({},f,null!=p?{width:p}:null,k&&{color:k})).setFill(l||g);m&&ia.applyLineMarker(a,b,k,this._acquireSVGMarker)},
_smsToPath:function(){return G?function(a,b,c,d,e,f,g,h,m){switch(b){case a.STYLE_SQUARE:return["M",e+","+g,"L",f+","+g,f+","+h,e+","+h,"X","E"];case a.STYLE_CROSS:return["M",c+","+g,"L",c+","+h,"M",e+","+d,"L",f+","+d,"E"];case a.STYLE_X:return["M",e+","+g,"L",f+","+h,"M",e+","+h,"L",f+","+g,"E"];case a.STYLE_DIAMOND:return["M",c+","+g,"L",f+","+d,c+","+h,e+","+d,"X","E"];case a.STYLE_TARGET:return["M",e+","+g,"L",f+","+g,f+","+h,e+","+h,e+","+g,"M",e-m+","+d,"L",e+","+d,"M",c+","+(g-m),"L",c+","+
g,"M",f+m+","+d,"L",f+","+d,"M",c+","+(h+m),"L",c+","+h,"E"]}}:function(a,b,c,d,e,f,g,h,m){switch(b){case a.STYLE_SQUARE:return["M",e+","+g,f+","+g,f+","+h,e+","+h,"Z"];case a.STYLE_TRIANGLE:return["M",c+","+g,f+","+h,e+","+h,"Z"];case a.STYLE_CROSS:return["M",c+","+g,c+","+h,"M",e+","+d,f+","+d];case a.STYLE_X:return["M",e+","+g,f+","+h,"M",e+","+h,f+","+g];case a.STYLE_DIAMOND:return["M",c+","+g,f+","+d,c+","+h,e+","+d,"Z"];case a.STYLE_TARGET:return a=["M",e+","+g,f+","+g,f+","+h,e+","+h,e+","+
g],m&&a.push("M",e-m+","+d,e+","+d,"M",c+","+(g-m),c+","+g,"M",f+m+","+d,f+","+d,"M",c+","+(h+m),c+","+h),a}}}(),_pathStyles:{square:1,cross:1,x:1,diamond:1,target:1},_typeMaps:{picturemarkersymbol:"image",picturefillsymbol:"path",simplefillsymbol:"path",simplelinesymbol:"path",cartographiclinesymbol:"path",textsymbol:"text"},_isInvalidShape:function(a,b){b=b&&b.shape&&b.shape.type;var c=a&&a.type;a=a&&a.style;"rect"===b&&(b="path");c&&(a=this._typeMaps[c]||a);this._pathStyles[a]&&(a="path");return"shieldlabelsymbol"===
c?!0:!(!b||!a||b===a)},_reArialFont:/\s*(^|,)\s*arial\s*(,|$)\s*/i,_fallbackFont:"Arial",_drawPoint:function(a,b,c,d,e,f,g){var h=c.type,m=this._map,p=m.__visibleRect,r=da.toScreenPoint(m.extent,m.width,m.height,b).offset(-p.x+e[0],-p.y);p=r.x;var n=r.y;b=[];var y=this._getVariable(f,"rotationInfo",!1);y=y?f.getRotationAngle(g,{rotationInfo:y}):null;var v=this._getVariable(f,"sizeInfo",!1);m=null!=g.size?g.size:v&&f.getSize(g,{sizeInfo:v,shape:c.style,resolution:m.getResolutionInMeters(),scale:m.getScale()});
y&&b.push(R.rotategAt(y,r));if(0!==c.xoffset||0!==c.yoffset){var k=R.translate(c.xoffset,-c.yoffset);b.push(k)}0!==c.angle&&b.push(R.rotategAt(c.angle,r));if("simplemarkersymbol"===h){var l=c.style;f=Math.round;null!=m?k&&(null!=k.dx&&(k.dx=k.dx/c.size*m),null!=k.dy&&(k.dy=k.dy/c.size*m)):m=c.size;switch(l){case J.STYLE_SQUARE:case J.STYLE_TRIANGLE:case J.STYLE_CROSS:case J.STYLE_X:case J.STYLE_DIAMOND:c=isNaN(m)?16:m/2;l=this._drawPath(a,d,this._smsToPath(J,l,p,n,f(p-c),f(p+c),f(n-c),f(n+c)));break;
case J.STYLE_TARGET:g=c._targetWidth/2;k=c._targetHeight/2;l=this._drawPath(a,d,this._smsToPath(J,l,p,n,f(p-g),f(p+g),f(n-k),f(n+k),c._spikeSize));break;case J.STYLE_PATH:l=this._drawPath(a,d,c.path,!0);c=l.getBoundingBox();a=this._getScaleMatrix(c,m);1===a.xx&&1===a.yy||b.push(R.scaleAt(a.xx,a.yy,r));b.push(R.translate(-(c.x+c.width/2)+p,-(c.y+c.height/2)+n));break;default:c=isNaN(m)?16:m/2,l=this._drawCircle(a,d,{cx:p,cy:n,r:c})}}else if("shieldlabelsymbol"===h)l=c.width,r=c.height,d=a.createGroup(),
l=a.createImage({x:p-l/2,y:n-r/2,width:l,height:r,src:c.url}),d.add(l),null!=c.font&&(n+=.2*c.getHeight(),a=a.createText({type:"text",text:c.text,x:p,y:n,align:"middle",decoration:c.decoration,rotated:c.rotated,kerning:c.kerning}),a.setFont(c.font),a.setFill(c.color),d.add(a)),l=d;else if("picturemarkersymbol"===h){if(null==m?(l=c.width,r=c.height):(r=m,l=c.width/c.height*r,k&&(null!=k.dx&&(k.dx=k.dx/c.width*l),null!=k.dy&&(k.dy=k.dy/c.height*r))),l=this._drawImage(a,d,{x:p-l/2,y:n-r/2,width:l,height:r,
src:c.url}),T&&(a=l.getNode()))c=(c=this._getVariable(f,"opacityInfo",!1))?f.getOpacity(g,{opacityInfo:c}):null,null!=c?a.setAttribute("opacity",c):a.setAttribute("opacity",1)}else if("textsymbol"===h){if(f=c.font){l=null!=m;g=f.family&&!this._reArialFont.test(f.family);if(l||g||L)f=new f.constructor(f.toJson());l&&f.setSize(m);L&&(f.size+="px");g&&f.setFamily(f.family+","+this._fallbackFont)}l=this._drawText(a,d,{type:"text",text:c.text,x:p,y:n,align:c.getSVGAlign(),decoration:c.decoration||f&&f.decoration,
rotated:c.rotated,kerning:c.kerning});f&&l.setFont(f);T&&(a=l.getNode(),p=c.getSVGBaseline(),n=c.getSVGBaselineShift(),a&&(a.setAttribute("dominant-baseline",p),n&&a.setAttribute("baseline-shift",n),this._applyHalo(l,c.haloColor,c.haloSize)))}l.setTransform(R.multiply(b));l._wrapOffsets=e;return l},_acquireSVGMarker:function(a,b,c,d){a=this._getSVGMarkerId(b,d);var e=this._getSVGMarker(a);e||(e=ia.createSVGMarker(b,a,c,d),this._div.getParent().defNode.appendChild(e),this._lineMarkers[a]=e);return e},
_getSVGMarkerId:function(a,b){return"marker_"+this._map.id+"_"+a.r+"_"+a.g+"_"+a.b+"_"+b},_getSVGMarker:function(a){return this._lineMarkers[a]},_updateSVGMarkers:function(){if(T&&ua){var a=this._lineMarkers,b;for(b in a){var c=a[b];c.setAttribute("id",b+"_temp");c.setAttribute("id",b)}}},_applyHalo:function(a,b,c){var d=b&&c?this._getHaloId(b,c):null;a.setFilter(b&&c?I("webkit")||I("ff")?this._getDilateFilter(b,c,d):this._getOffsetFilter(b,c,d):null)},_getDilateFilter:function(a,b,c){var d=this._getSVGFilter(c);
d||(d=this._createSVGFilter({id:c},[K.feMorphology({operator:"dilate",radius:b,result:"dilated"}),K.feFlood({"flood-color":a.toCss(!0)}),K.feComposite({in2:"dilated",operator:"in",result:"composite"}),K.feMerge("composite","SourceGraphic")]));return d},_getOffsetFilter:function(a,b,c){var d=this._getSVGFilter(c);if(!d){a=a.toCss(!0);d=this._offsetPrimitives;var e,f=d.length,g=[],h=[];for(e=0;e<f;e++){var m=d[e],p="offset"+m.dir,r="composite"+m.dir;h.push(r);g.push(K.feOffset({dx:m.dx*b,dy:m.dy*b,
"in":"SourceAlpha",result:p}),K.feFlood({"flood-color":a}),K.feComposite({in2:p,operator:"in",result:r}))}h.push("SourceGraphic");g.push(K.feMerge.apply(K.feMerge,h));d=this._createSVGFilter({id:c},g)}return d},_offsetPrimitives:[{dir:"L",dx:-1,dy:0},{dir:"TL",dx:-1,dy:-1},{dir:"T",dx:0,dy:-1},{dir:"TR",dx:1,dy:-1},{dir:"R",dx:1,dy:0},{dir:"BR",dx:1,dy:1},{dir:"B",dx:0,dy:1},{dir:"BL",dx:-1,dy:1}],_getHaloId:function(a,b){return"halo_"+this._map.id+"_"+this.id+"_"+a.r+"_"+a.g+"_"+a.b+"_"+a.a+"_"+
b},_getSVGFilter:function(a){return this._svgFilters[a]},_createSVGFilter:function(a,b){b=K.createFilter(a,b);var c=this._map,d=c.__visibleRect;b.x=-d.x;b.y=-d.y;b.width=c.width;b.height=c.height;return this._svgFilters[a.id]=b},_updateSVGFilters:function(a,b,c,d){var e=this._svgFilters,f,g,h;for(g in e)if(f=e[g]){if(h=qa.byId(g))null!=a&&h.setAttribute("x",a),null!=b&&h.setAttribute("y",b),null!=c&&h.setAttribute("width",c),null!=d&&h.setAttribute("height",d);null!=a&&(f.x=a);null!=b&&(f.y=b);null!=
c&&(f.width=c);null!=d&&(f.height=d)}},_getScaleMatrix:function(a,b){var c=a.width/a.height,d=1,e=1;isNaN(b)||(1<c?(d=b/a.width,e=b/c/a.height):(e=b/a.height,d=b*c/a.width));return{xx:d,yy:e}},_symbolizePoint:function(a,b,c,d){var e=b.type,f=b.style;if("shieldlabelsymbol"!==e&&"picturemarkersymbol"!==e){var g=b.getStroke();b=b.getFill();f=f===J.STYLE_X||f===J.STYLE_CROSS;var h=g&&g.color,m=f?h:b;if(c){var p=this._getVariable(c,"colorInfo",!1),r=this._getVariable(c,"opacityInfo",!1);p&&(m=c.getColor(d,
{colorInfo:p})||m);m&&r&&(m=this._applyOpacity(m,c,r,d));m&&(f?m!==h&&(g=g?B.mixin({},g):{},g.color=m):m!==b&&(b=m))}"textsymbol"===e?a.setFill(b):"simplemarkersymbol"===e&&a.setFill(b).setStroke(g)}},_drawMarkers:function(a,b,c,d){var e=a.geometry,f=e.points,g=a.getDojoShape()||this._div.createGroup(),h,m=f.length,p=[],r=0,n,y=c?c.length:0;g.children[0]&&this._isInvalidShape(b,g.children[0])&&g.clear();for(h=0;h<m;h++){var v=f[h];for(n=0;n<y;n++)p[0]=c[n],this._drawPoint(g,{x:v[0],y:v[1],spatialReference:e.spatialReference},
b,g.children[r++],p,d,a)}b=g.children.length;if(m*c.length<b)for(h=b-1;h>=m*c.length;h--)g.children[h].removeShape();a._shape=g},_symbolizeMarkers:function(a,b,c){var d=a.getDojoShape().children,e,f=d.length;for(e=0;e<f;e++)this._symbolizePoint(d[e],b,c,a)},_errorHandler:function(a,b){b&&(a.message="Unable to draw graphic (geometry:"+(b.geometry?b.geometry.declaredClass:null)+", symbol:"+(b.symbol?b.symbol.declaredClass:null)+"): "+a.message);this.inherited(arguments)},_rendererLimits:function(){if(G){var a=
1E5;var b=-1E5;var c=1E5}else I("chrome")&&6>I("chrome")&&(a=8150,b=-1E4,c=1E4);if(a)return{clipLimit:a,rangeMin:b,rangeMax:c,clipBBox:[-a,-a,a,a],clipSegments:[[[-a,-a],[a,-a]],[[a,-a],[a,a]],[[a,a],[-a,a]],[[-a,a],[-a,-a]]]}}(),_clipPolyline:function(a,b){b=this._getCorners(a,b);var c=b.br,d=this._rendererLimits,e=d.rangeMin,f=d.rangeMax,g=d.clipBBox,h=d.clipSegments;d=this._isPointWithinRange;var m=this._isPointWithinBBox,p=this._getClipperIntersection,r=this._getPlaneIndex;if(!d(b.tl,e,f)||!d(c,
e,f)){G&&this._createSegments(a);var n=[];z.forEach(a.segments,function(y){y=y.args;var v=y.length,k=[],l;for(l=0;l<v;l+=2){var q=[y[l],y[l+1]],u=[y[l+2],y[l+3]],t=m(q,g),w=m(u,g);if(t^w){if(w=p([q,u],h))t?(l?k.push(w[1]):k.push(q,w[1]),n.push(k),k=[]):k.push(w[1],u)}else t?l?k.push(u):k.push(q,u):(w=r(q,g),t=r(u,g),-1!==w&&-1!==t&&w!==t&&(q=p([q,u],h,!0),0<q.length&&(q[w]||(w=q[w[0]]?w[0]:w[1]),q[t]||(t=q[t[0]]?t[0]:t[1]),u=q[w],q=q[t],u&&k.push(u),q&&(k.push(q),n.push(k),k=[]))))}n.push(k)});a.setShape(this._getPathStringFromPaths(n))}},
_clipPolygon:function(a,b){b=this._getCorners(a,b);var c=b.br,d=this._rendererLimits,e=d.clipLimit,f=d.rangeMin,g=d.rangeMax,h=d.clipBBox,m=d.clipSegments;d=this._isPointWithinRange;var p=this._isPointWithinBBox,r=this._getClipperIntersection,n=this._getPlaneIndex,y=ka._pointLineDistance;d(b.tl,f,g)&&d(c,f,g)||(G&&this._createSegments(a),b=z.filter(a.segments,function(v){return v.args&&v.args.length}),b=z.map(b,function(v){var k=v.args,l=k.length,q=[];v=[];var u;for(u=0;u<l;u+=2){var t=[k[u],k[u+
1]],w=[k[u+2],k[u+3]];if(u===l-2){q.push(t);break}var C=p(t,h),A=p(w,h);q.push(t);if(C^A){if(A=r([t,w],m))t=A[1],t[C?"inOut":"outIn"]=!0,q.push(t),v.push([C?"INOUT":"OUTIN",q.length-1,A[0]])}else if(!C){C=n(t,h);var E=n(w,h);-1!==C&&-1!==E&&C!==E&&(A=r([t,w],m,!0),0<A.length?(A[C]||(C=A[C[0]]?C[0]:C[1]),A[E]||(E=A[E[0]]?E[0]:E[1]),t=A[C],w=A[E],t&&(t.outIn=!0,q.push(t),v.push(["OUTIN",q.length-1,C])),w&&(w.inOut=!0,q.push(w),v.push(["INOUT",q.length-1,E]))):B.isArray(C)&&B.isArray(E)&&(A=C.concat(E),
A.sort(),"0123"===A.join("")&&(A=[],3===C[0]+C[1]?A.push([e,-e],[-e,e]):A.push([-e,-e],[e,e]),C=y(A[0],[t,w]),t=y(A[1],[t,w]),q.push(C<t?A[0]:A[1]))))}}var M=h[0],N=h[1],U=h[2],V=h[3];z.forEach(q,function(x){x[0]<M&&(x[1]>=N&&x[1]<=V?x[0]=M:(x[0]=M,x[1]=x[1]<N?N:V))});z.forEach(q,function(x){x[1]<N&&(x[0]>=M&&x[0]<=U?x[1]=N:(x[1]=N,x[0]=x[0]<M?M:U))});z.forEach(q,function(x){x[0]>U&&(x[1]>=N&&x[1]<=V?x[0]=U:(x[0]=U,x[1]=x[1]<N?N:V))});z.forEach(q,function(x){x[1]>V&&(x[0]>=M&&x[0]<=U?x[1]=V:(x[1]=
V,x[0]=x[0]<M?M:U))});k=0;l=v.length;if(0<l){do{w=v[k];u=v[(k+1)%l];if(w[2]===u[2]&&"INOUT"===w[0]&&"OUTIN"===u[0])if(t=w[1],u=u[1],t<u)for(t+=1;t<u;t++)q[t][2]=!0;else if(t>u){for(t+=1;t<q.length;t++)q[t][2]=!0;for(t=0;t<u;t++)q[t][2]=!0}k=(k+1)%l}while(0!==k)}l=q[0];k=q[q.length-1];l[2]&&(k[2]=!0,z.some(v,function(x){return 1===x[1]?(q.splice(q.length-1,0,B.clone(q[1])),!0):!1}));q=z.filter(q,function(x){return x[2]?!1:!0});for(k=0;k<q.length-1;k++)l=q[k],(u=q[k+1])&&l[0]===u[0]&&l[1]===u[1]&&(u.outIn?
l.outIn=!0:u.inOut&&(l.inOut=!0),q.splice(k+1,1));l=Math.abs;v=[];for(k=0;k<q.length-1;k++){w=q[k];t=w[0];w=w[1];C=l(t)===e;A=l(w)===e;u=q[k+1];E=u[0];u=u[1];var wa=l(E)===e,xa=l(u)===e;C&&xa?v.push([k+1,[t,u]]):A&&wa&&v.push([k+1,[E,w]])}for(k=v.length-1;0<=k;k--)u=v[k],t=q[u[0]-1],l=q[u[0]],t.outIn||t.inOut||l.outIn||l.inOut||q.splice(u[0],0,u[1]);l=q[0];k=q[q.length-1];l[0]===k[0]&&l[1]===k[1]||q.push(l);return q}),a.setShape(this._getPathStringFromPaths(b)))},_getCorners:function(a,b){if(G){a=
this._map;var c=b.getExtent(),d=c.spatialReference;b=a.toScreen(new ja(c.xmin,c.ymax,d));a=a.toScreen(new ja(c.xmax,c.ymin,d));return{tl:b,br:a}}a=a.getTransformedBoundingBox();return{tl:a[0],br:a[2]}},_createSegments:function(a){a.shape.path=a.vmlPath;a.segmented=!1;a._confirmSegmented();var b=a.segments;1<b.length&&(a.segments=z.filter(b,function(c,d,e){d=e[d+1];return"M"===c.action&&d&&"L"===d.action?(c.args=c.args.concat(d.args),!0):!1}))},_getPathStringFromPaths:function(a){G?(a=z.map(a,function(b){return"m "+
z.map(b,function(c,d){return(1===d?"l ":"")+c.join(",")}).join(" ")}),a.push("e")):a=z.map(a,function(b){return"M "+z.map(b,function(c){return c.join(",")}).join(" ")});return a.join(" ")},_isPointWithinBBox:function(a,b){var c=b[1],d=b[2],e=b[3],f=a[0];a=a[1];return f>b[0]&&f<d&&a>c&&a<e?!0:!1},_isPointWithinRange:function(a,b,c){var d=a.x;a=a.y;return d<b||a<b||d>c||a>c?!1:!0},_getClipperIntersection:function(a,b,c){var d,e=ka._getLineIntersection2,f=Math.round,g={length:0};for(d=0;4>d;d++){var h=
e(a,b[d]);if(h)if(h[0]=f(h[0]),h[1]=f(h[1]),c)g[d]=h,g.length++;else return[d,h]}return c?g:null},_getPlaneIndex:function(a,b){var c=a[0];a=a[1];var d=b[0],e=b[1],f=b[2];b=b[3];return c<=d?a>=e&&a<=b?3:a<e?[0,3]:[2,3]:a<=e?c>=d&&c<=f?0:c<d?[3,0]:[1,0]:c>=f?a>=e&&a<=b?1:a<e?[0,1]:[2,1]:a>=b?c>=d&&c<=f?2:c<d?[3,2]:[1,2]:-1},onGraphicAdd:function(){},onGraphicRemove:function(){},onGraphicNodeAdd:function(){},onGraphicNodeRemove:function(){},onGraphicDraw:function(){},onGraphicsClear:function(){},onRendererChange:function(){},
onOpacityChange:function(){},onInfoTemplateChange:function(){},onSurfaceChange:function(){},onWebGLEnabledChange:function(){},setInfoTemplate:function(a){this.infoTemplate=a;this._evalSurfaceType();this.onInfoTemplateChange()},add:function(a,b){if(a._graphicsLayer===this)return a;a._suspended=this._suspendGraphics;b||this.graphics.push(a);a._graphicsLayer=this;a._sourceLayer||(a._layer&&"esri.layers.GraphicsLayer"!==a._layer.declaredClass?a._sourceLayer=a._layer:"esri.layers.GraphicsLayer"!==this.declaredClass&&
(a._sourceLayer=this));a._layer=this;this.hasWebGLSurface()||(this._updateExtent(a),this._draw(a));if(!b)this.onGraphicAdd(a);return a},remove:function(a,b,c){if(!b&&!c){b=this.graphics;var d;if(-1===(d=z.indexOf(b,a)))return null;if(!na||64<=na)b.splice(d,1);else{var e=b.length;if(e){for(;d<e;)b[d]=b[d+1],d++;b.length--}}}this.hasWebGLSurface()||a.getDojoShape()&&this._removeShape(a,null,c);a._shape=a._graphicsLayer=null;this.onGraphicRemove(a);return a},clear:function(a,b){a=this.graphics;var c,
d=!G;for(c=a.length-1;0<=c;c--)this.remove(a[c],null,d);this.graphics=[];this.hasWebGLSurface()||this._destroyAllNodes();if(!b)this.onGraphicsClear()},_destroyAllNodes:function(){if(!G&&this._div){var a;this._childLayer&&(a=this._childLayer.getNode())&&a.parentNode&&a.parentNode.removeChild(a);this._bgGroup.clear();this._div.clear();this._bgGroup=this._div.createGroup();a&&this._div.getEventSource().appendChild(a);this._initOpacity()}},clearNodes:function(){if(!this.hasWebGLSurface()){var a=this.graphics,
b=a.length,c;for(c=0;c<b;c++)this._removeShape(a[c],!0,!0);this._destroyAllNodes()}},_graphicVisibilityChanged:function(a){},_setIEOpacity:function(a,b){var c=a&&a.getNode();if(c){var d=a.strokeStyle,e=c.stroke;d&&e&&(e.opacity=d.color.a*b);a=a.fillStyle;d=c.fill;a&&d&&("tile"===d.type?F.set(c,"opacity",b):d.opacity=a.a*b)}},setOpacity:function(a,b){if(b||this.opacity!=a){var c=this._div;c&&!this.hasWebGLSurface()&&(G?(z.forEach(this.graphics,function(d){this._setIEOpacity(d._shape,a);this._setIEOpacity(d._bgShape,
a)},this),c._esriIeOpacity=a,this._bgGroup._esriIeOpacity=a):"canvas-2d"===this.surfaceType?F.set(c.getEventSource(),"opacity",a):c.getEventSource().setAttribute("opacity",a));this.opacity=a;if(!b)this.onOpacityChange(a)}},setRenderer:function(a){this.renderer=a;this._evalSDRenderer(!0);this._evalSurfaceType();this.emit("renderer-change",{renderer:this._rndForScale||a})}});O=O([Y,ta],{declaredClass:"esri.layers.GraphicsLayer",constructor:function(){this._processEvent=B.hitch(this,this._processEvent);
this._initLayer()},_initLayer:function(){this.loaded=!0;this.onLoad(this)},_setMap:function(){var a=this.inherited("_setMap",arguments);this.enableMouseEvents();return a},_unsetMap:function(){this.disableMouseEvents();this.inherited("_unsetMap",arguments)},_processEvent:function(a){var b=this._map,c=a.target,d;a.screenPoint=new ca(a.pageX-b.position.x,a.pageY-b.position.y);for(a.mapPoint=b.toMap(a.screenPoint);c&&!(d=c.e_graphic);)c=c.parentNode;if(d)return a.graphic=d,a},_onMouseOverHandler:function(a){if(this._processEvent(a))this.onMouseOver(a)},
_onMouseMoveHandler:function(a){if(this._processEvent(a))this.onMouseMove(a)},_onMouseDragHandler:function(a){if(this._processEvent(a))this.onMouseDrag(a)},_onMouseOutHandler:function(a){if(this._processEvent(a))this.onMouseOut(a)},_onMouseDownHandler:function(a){this._downGr=this._downPt=null;this._processEvent(a)&&(D.disconnect(this._onmousemove_connect),D.disconnect(this._onmousedrag_connect),this._onmousedrag_connect=D.connect(this._div.getEventSource(),"onmousemove",this,"_onMouseDragHandler"),
this._downGr=a.graphic,this._downPt=a.screenPoint.x+","+a.screenPoint.y,this.onMouseDown(a))},_onMouseUpHandler:function(a){this._upGr=this._upPt=null;this._processEvent(a)&&(D.disconnect(this._onmousedrag_connect),D.disconnect(this._onmousemove_connect),this._onmousemove_connect=D.connect(this._div.getEventSource(),"onmousemove",this,"_onMouseMoveHandler"),this._upGr=a.graphic,this._upPt=a.screenPoint.x+","+a.screenPoint.y,this.onMouseUp(a))},_onClickHandler:function(a){if(this._processEvent(a)){var b=
this._downGr,c=this._upGr;b&&c&&b===c&&this._downPt===this._upPt&&(G&&(H._ieGraphic=a.graphic),this.onClick(a))}},_onDblClickHandler:function(a){if(this._processEvent(a))this.onDblClick(a)},onMouseOver:function(){},onMouseMove:function(){},onMouseDrag:function(){},onMouseOut:function(){},onMouseDown:function(){},onMouseUp:function(){},onClick:function(){},onDblClick:function(){},enableMouseEvents:function(){if(!this._mouseEvents){var a=D.connect,b=this._div.getEventSource();L||(this._onmouseover_connect=
a(b,"onmouseover",this,"_onMouseOverHandler"),this._onmousemove_connect=a(b,"onmousemove",this,"_onMouseMoveHandler"),this._onmouseout_connect=a(b,"onmouseout",this,"_onMouseOutHandler"),this._onmousedown_connect=a(b,"onmousedown",this,"_onMouseDownHandler"),this._onmouseup_connect=a(b,"onmouseup",this,"_onMouseUpHandler"),this._onclick_connect=a(b,"onclick",this,"_onClickHandler"),this._ondblclick_connect=a(b,"ondblclick",this,"_onDblClickHandler"));this._mouseEvents=!0}},disableMouseEvents:function(){if(this._mouseEvents){var a=
D.disconnect;a(this._onmouseover_connect);a(this._onmousemove_connect);a(this._onmousedrag_connect);a(this._onmouseout_connect);a(this._onmousedown_connect);a(this._onmouseup_connect);a(this._onclick_connect);a(this._ondblclick_connect);this._mouseEvents=!1}}});O._GraphicsContainer=ba;O._GraphicsLayer=Y;I("extend-esri")&&(B.setObject("layers.GraphicsLayer",O,H),B.setObject("layers._GraphicsContainer",ba,H),B.setObject("layers._GraphicsLayer",Y,H));return O});