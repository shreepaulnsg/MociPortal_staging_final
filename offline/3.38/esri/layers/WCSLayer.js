// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/BaseRasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojox/gfx/matrix ../kernel ../config ../lang ../domUtils ../geometry/Point ./layer".split(" "),function(P,H,L,g,a,e,d,b,c,l,h,m,r,t){var q=l.defaults.map.zoomDuration;return P([t],{declaredClass:"esri.layers.BaseRasterLayer",managedSuspension:!0,opacity:1,constructor:function(n,p){this.drawMode=p&&void 0!==p.drawMode?p.drawMode:
!0;this.drawType=p&&p.drawType?p.drawType:"2d";this.pixelData=null;this._initialize(n,p)},setDrawMode:function(n){this.drawMode=n},setOpacity:function(n){this.opacity!==n&&(this.opacity=n,this.onOpacityChange(n))},onOpacityChange:function(){},refresh:function(){if(!this._canDraw()||10>a("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else this._map&&this._extentChangeHandler(this._map.extent)},clear:function(){this._canDraw()&&"2d"===this.drawType&&
this._context.clearRect(0,0,this._mapWidth,this._mapHeight)},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);this._toggleTime();if("css-transforms"===this._map.navigationMode){var n=this._map.__visibleDelta;this._left=this._tdx=n.x;this._top=this._tdy=n.y;d.set(this._div,c._css.names.transform,c._css.translate(this._left,this._top))}this._displayTimer=this._displayTimer||setTimeout(H.hitch(this,function(){this._extentChangeHandler(this._map.extent,null,!0)}),
0)},onSuspend:function(){this.inherited(arguments);this._toggleTime();clearTimeout(this._displayTimer);this._displayTimer=null},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getCurrentResolution:function(){var n=this._map.extent;return new r((n.xmax-n.xmin)/this._map.width,(n.ymax-n.ymin)/this._map.height,n.spatialReference)},setPixelFilter:function(n,p){this.pixelFilter=n;p||this.redraw()},_toggleTime:function(){},_setMap:function(n,p){this.inherited(arguments);
this._dragOrigin={x:0,y:0};var u=this._div=e.create("div",null,p),v={width:n.width+"px",height:n.height+"px",position:"absolute"};"css-transforms"===n.navigationMode?(v[c._css.names.transform]=c._css.translate(n.__visibleDelta.x,n.__visibleDelta.y),this._left=n.__visibleDelta.x,this._top=n.__visibleDelta.y):this._left=this._top=0;d.set(u,v);this._canvas=e.create("canvas",{id:"canvas",width:n.width+"px",height:n.height+"px",style:"position: absolute;"},u);h.isDefined(this.opacity)&&d.set(u,"opacity",
this.opacity);(this._context=this._canvas.getContext(this.drawType))||console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this._mapWidth=n.width;this._mapHeight=n.height;this._connects=[];this._connects.push(L.connect(n,"onPan",this,this._panHandler));this._connects.push(L.connect(n,"onPanEnd",this,this._panEndHandler));"css-transforms"===n.navigationMode?this._connects.push(L.connect(n,"onScale",this,this._onScaleHandler)):(this._connects.push(L.connect(n,
"onZoom",this,this._onZoomHandler)),this._connects.push(L.connect(n,"onZoomEnd",this,this._onZoomEndHandler)));this._connects.push(L.connect(n,"onResize",this,this._onResizeHandler));this._connects.push(L.connect(n,"onExtentChange",this,this._extentChangeHandler));this._connects.push(L.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(L.connect(this,"onOpacityChange",this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:n.width,height:n.height};
this.evaluateSuspension();if(this.suspended&&!n.loaded)var z=L.connect(n,"onLoad",this,function(){L.disconnect(z);z=null;this.evaluateSuspension()});return u},_unsetMap:function(n,p){g.forEach(this._connects,L.disconnect,this);var u=this._div;u&&(p.removeChild(u),e.destroy(u));this.updating&&n._jobs&&n._jobs--;this._rasterReadPromise&&this._rasterReadPromise.cancel();this._map=this._canvas=this._context=this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},
_canDraw:function(){return!!(this._map&&this._canvas&&this._context)},_requestDataErrorHandler:function(n){"CancelError"!==n.name&&(this.clear(),this.onError(n))},_drawPixelData:function(){if(this._map){this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};var n=this._useBrowserDecoding();!n&&this.drawMode||"css-transforms"!==this._map.navigationMode||(this._tdx=this._left,this._tdy=this._top,this._multiply=null,d.set(this._div,c._css.names.transform,c._css.translate(this._left,
this._top)),d.set(this._canvas,c._css.names.transform,c._css.translate(-this._left,-this._top)),this._dragOrigin={x:0,y:0});if(this._canDraw&&this.drawMode)if(n)this._fireUpdateEnd();else if(this.drawMode)if(this.pixelData&&this.pixelData.pixelBlock){n=this.pixelData.pixelBlock;var p=this._context,u=p.createImageData(n.width,n.height);u.data.set(n.getAsRGBA());var v=this.pixelData.extent,z=this._map.extent,A=this.getCurrentResolution(),G=0,D=0;Math.abs(v.xmin-z.xmin)>A.x&&(G=Math.round((v.xmin-z.xmin)/
A.x));Math.abs(z.ymax-v.ymax)>A.y&&(D=Math.round((z.ymax-v.ymax)/A.y));this.clear();"css-transforms"===this._map.navigationMode?(this._tdx=this._left,this._tdy=this._top,this._multiply=null,d.set(this._div,c._css.names.transform,c._css.translate(this._left,this._top)),d.set(this._canvas,c._css.names.transform,c._css.translate(-this._left,-this._top))):(d.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),d.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+
"px",height:this._map.height+"px"}));this._dragOrigin={x:0,y:0};p.putImageData(u,G,D,0,0,n.width,n.height);this._fireUpdateEnd()}else this.clear()}},_panHandler:function(n,p){"css-transforms"===this._map.navigationMode?(this._left=this._map.__visibleDelta.x+p.x,this._top=this._map.__visibleDelta.y+p.y,d.set(this._div,c._css.names.transform,c._css.translate(this._left,this._top))):d.set(this._div,{left:this._startRect.left+p.x+"px",top:this._startRect.top+p.y+"px"})},_panEndHandler:function(n,p){p&&
(this._startRect.left+=p.x,this._startRect.top+=p.y)},_onScaleHandler:function(n,p){var u={},v=c._css.names;d.set(this._canvas,v.transition,p?"none":v.transformName+" "+q+"ms ease");this._matrix=n;n=this._multiply?b.multiply(n,this._multiply):n;if(this._tdx||this._tdy)n=b.multiply(n,{xx:1,xy:0,yx:0,yy:1,dx:-this._tdx,dy:-this._tdy});u[v.transform]=c._css.matrix(n);d.set(this._canvas,u)},_onZoomHandler:function(n,p,u){var v=this._startRect;n=v.width*p;p*=v.height;var z=v.left-(n-v.width)*(u.x-v.left)/
v.width;u=v.top-(p-v.height)*(u.y-v.top)/v.height;d.set(this._canvas,{left:z+"px",top:u+"px",width:n+"px",height:p+"px"});this._endRect={left:z,top:u,width:n,height:p}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(n,p,u){d.set(this._div,{width:p+"px",height:u+"px"});d.set(this._canvas,{width:p+"px",height:u+"px"});this._startRect.width=this._canvas.width=p;this._startRect.height=this._canvas.height=u},_extentChangeHandler:function(n,p,u,v){this.suspended||
p&&0===p.x&&0===p.y&&!u||("css-transforms"===this._map.navigationMode&&(p&&(this._dragOrigin.x+=p.x,this._dragOrigin.y+=p.y),u||(this._left=this._map.__visibleDelta.x,this._top=this._map.__visibleDelta.y,d.set(this._div,c._css.names.transform,c._css.translate(this._left,this._top))),u&&(d.set(this._canvas,c._css.names.transition,"none"),this._multiply=this._multiply?b.multiply(this._matrix,this._multiply):this._matrix)),this._fireUpdateStart(),n=this._map,this._requestData(n.extent,n.width,n.height))},
_visibilityChangeHandler:function(n){n?m.show(this._div):m.hide(this._div)},_opacityChangeHandler:function(n){d.set(this._div,"opacity",n)}})})},"esri/layers/WCSConnection":function(){define("dojo/_base/declare dojo/_base/lang dojo/io-query dojo/has dojo/_base/Deferred dojo/DeferredList ../deferredUtils ../request ../kernel ./WCSCapabilities ./WCSCoverageDescription".split(" "),function(P,H,L,g,a,e,d,b,c,l,h){var m=function(r,t,q){var n;if(q)for(n=0;n<r.length;n++){if(r[n][q].toLowerCase()===t.toLowerCase())return r[n]}else for(n=
0;n<r.length;n++)if(r[n].toLowerCase()===t.toLowerCase())return r[n]};P=P(null,{declaredClass:"esri.layers.WCSConnection",url:null,supportedVersions:["1.0.0","1.1.0","1.1.1","2.0.1"],version:null,name:null,onlineResources:null,coverages:null,supportedFormats:null,profiles:null,supportedInterpolations:null,onConnected:null,constructor:function(r,t){if(r){var q=r.indexOf("?");-1<q&&q<=r.length-1?(this.optionalParameters=L.queryToObject(r.substring(q+1,r.length)),this.url=r.substring(0,q+1)):this.url=
r}this.optionalParameters=this.optionalParameters||{};t&&H.mixin(this.optionalParameters,t);this.optionalParameters.version&&(this.version=this.optionalParameters.version);var n=this.optionalParameters;Object.keys(n).forEach(function(p){n[p]||delete n[p]});this.connect=H.hitch(this,this.connect);this.url&&this.connect(this.version)},_getCapabilities:function(r){var t=new a,q=H.mixin({},this.optionalParameters);if(r)var n={version:r,AcceptVersions:r};var p=["service","request","coverageId","coverage",
"identifier"];Object.keys(q).forEach(function(u){p.some(function(v){return v.toLowerCase()===u.toLowerCase()})&&delete q[u]});b({url:this.url,content:H.mixin({request:"GetCapabilities",service:"WCS"},q,n),handleAs:"xml"}).then(H.hitch(this,function(u){u=new l(u);t.resolve(u)}),function(u){t.reject(u)});return t.promise},_getCapabilitiesHelper:function(r){if(r)r=this._getCapabilities(r);else{var t=new a;r=t.promise;this._getCapabilities().then(H.hitch(this,function(q){!this.version&&-1<this.url.toLowerCase().indexOf("wcsserver")?
1===q.supportedVersions.length&&"2.0.1"===q.supportedVersions[0]?this._getCapabilities().then(H.hitch(this,function(n){t.resolve(n)}),H.hitch(this,function(n){t.reject(n)})):t.resolve(q):t.resolve(q)}),H.hitch(this,function(q){t.reject(q)}))}return r},_describeCoverage:function(){var r=new a,t=this.coverageId||this.optionalParameters.coverage||this.optionalParameters.coverageId||this.optionalParameters.identifiers||this.coverages.map(function(z){return z.id}).join(","),q=this.version,n={request:"DescribeCoverage",
service:"WCS",version:q};switch(q){case "1.0.0":n=H.mixin(n,{coverage:t});break;case "1.1.0":case "1.1.1":case "1.1.2":n=H.mixin(n,{identifiers:t});break;case "2.0.1":n=H.mixin(n,{coverageId:t})}var p=H.mixin({},this.optionalParameters),u=["service","request"];Object.keys(p).forEach(function(z){u.some(function(A){return A.toLowerCase()===z.toLowerCase()})&&delete p[z]});var v=b({url:this._onlineResources?this._onlineResources.describeCoverage:this.url,content:H.mixin(n,p),handleAs:"xml"});"2.0.1"===
q&&(q=t,-1<t.indexOf(",")?q=t.split(",").map(function(z){return 0===z.toLowerCase().indexOf("coverage")?z.slice(8):z}).join(","):0===t.toLowerCase().indexOf("coverage")&&(q=t.slice(8)),t=b({url:this._onlineResources?this._onlineResources.describeCoverage:this.url,content:H.mixin(n,p,{identifiers:q,version:"1.1.1"}),handleAs:"xml"}),v=new e([v,t]));v.then(H.hitch(this,function(z){if("2.0.1"===this.version){var A=z[0][0]&&z[0][1]?this._parseCoverageDescriptions(z[0][1],this.version):null;if((z=z[1][0]&&
z[1][1]?this._parseCoverageDescriptions(z[1][1],"1.1.1"):null)&&z.length){var G,D,I,f,x;for(I=0;I<A.length;I++){var y=A[I].multidimensionalInfo;var k=z[I].multidimensionalInfo;if(y&&k)for(x=0;x<y.variables.length;x++){var w=y.variables[x];if(G=m(k.variables,w.name,"name"))for(f=0;f<w.dimensions.length;f++){var C=w.dimensions[f];if(D=m(G.dimensions,C.name,"name"))C.values=C.values||D.values,C.values&&(C.hasRegularIntervals=!1)}}}}}else A=this._parseCoverageDescriptions(z,this.version);r.resolve(A)}),
function(z){r.reject(z)});return r.promise},_parseCoverageDescriptions:function(r,t){var q,n=[];r="1.0.0"===t?r.getElementsByTagNameNS("*","CoverageOffering"):r.getElementsByTagNameNS("*","CoverageDescription");for(q=0;q<r.length;q++)n.push(new h(r[q],t));return n},connect:function(r){var t=new a(function(){return"cancelled"});this._connectPromise&&this._connectPromise.cancel();this.version=(r=r||this.version)||this.version;var q=function(n){t.reject(n);this._connectPromise=null;if(this.onConnectionFailed)this.onConnectionFailed(n)};
this._getCapabilitiesHelper(r).then(H.hitch(this,function(n){if(!t.isCanceled()){this.supportedInterpolations=n.supportedInterpolations;this.supportedVersions=n.supportedVersions;-1<this.url.toLowerCase().indexOf("wcsserver")?("2.0.1"===this.supportedVersions[0]&&1===this.supportedVersions.length&&(this.supportedVersions=["1.0.0","1.1.0","1.1.1","2.0.1"]),this.version=this.version||n.version||this.supportedVersions.reduce(function(p,u){return p>u?p:u})):this.version=this.version||"1.0.0";this.name=
this.name||n.name;this.version=this.version||n.version;this.onlineResources=this.onlineResources||n.onlineResources;this.coverages=this.coverages||n.coverages;if(void 0===this.coverages||null===this.coverages||0===this.coverages.length)throw"No valid coverages";this.supportedFormats=this.supportedFormats||n.supportedFormats;this.profiles=this.profiles||n.profiles;this._describeCoverage().then(H.hitch(this,function(p){if(!t.isCanceled())if(p){if(p.forEach(H.hitch(this,function(u){u.lonLatEnvelope=
m(this.coverages,u.id,"id").lonLatEnvelope||u.lonLatEnvelope})),this.coverages=p,t.resolve(this),this._connectPromise=null,this.onConnected)this.onConnected()}else q("cannot parse coverage descriptions")}),q)}}),q);return this._connectPromise=t.promise}});g("extend-esri")&&H.setObject("layers.WCSConnection",P,c);return P})},"esri/layers/WCSCapabilities":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../geometry/Extent"],function(P,H,L,g,a){var e=function(d,b){if(null===
d||null===b||null===d.tagName||void 0===d.tagName)return!1;d=d.tagName.toLowerCase();b=b.toLowerCase();return d===b||0<d.indexOf(":"+b)};P=P(null,{declaredClass:"esri.layers.WCSCapabilities",version:null,name:null,onlineResources:null,coverages:null,supportedFormats:null,supportedVersions:null,profiles:null,supportedInterpolations:null,constructor:function(d){this._parse=H.hitch(this,this._parse);d&&H.mixin(this,this._parse(d))},_parse:function(d){var b=this._getElement(d,"Capabilities")||this._getElement(d,
"WCS_Capabilities");if(null===b)throw"not a valid capabilities file -- cannot find Capabilities or WCS_Capabilities root element";this.version=b=b.getAttribute("version");switch(b){case "1.0.0":this._parse100(d);break;case "1.1.0":case "1.1.1":case "1.1.2":this._parse110(d);break;case "2.0.1":this._parse201(d);break;default:throw"unsupported WCS version "+b;}},_getElements:function(d,b){if(!d)return null;if(!b)return d;var c=b;-1<b.indexOf("/")?(c=b.slice(0,b.indexOf("/")),b=b.slice(b.indexOf("/")+
1)):b="";return b?this._getElement(d,c).getElementsByTagNameNS("*",b):d.getElementsByTagNameNS("*",c)},_getElement:function(d,b){if(!d)return null;if(!b)return d;var c=b;-1<b.indexOf("/")?(c=b.slice(0,b.indexOf("/")),b=b.slice(b.indexOf("/")+1)):b="";d=this._getElements(d,c);return 0<d.length?b?this._getElement(d[0],b):d[0]:null},_getElementValue:function(d,b){return(d=this._getElement(d,b))?(d=d.textContent||d.text||d.nodeValue||d.innerText)?d.trim():null:null},_getElementValues:function(d,b){d=
this._getElements(d,b);b=[];var c,l;for(l=0;l<d.length;l++)if(c=d[l].textContent||d[l].text||d[l].nodeValue||d[l].innerText)c=c.trim(),""!==c&&b.push(c);return b},_removeTrailingQuestionMark:function(d){return d?d.indexOf("?")===d.length-1?d.substring(0,d.length-1):d:null},_parse100:function(d){var b=this._getElement(d,"Service");this.name=this._getElementValue(b,"name");this.supportedVersions=["1.0.0"];b={};var c=this._getElement(d,"Capability");b.getCapabilities=this._removeTrailingQuestionMark(this._getElement(c,
"GetCapabilities/Get/OnlineResource").getAttribute("xlink:href"));b.describeCoverage=this._removeTrailingQuestionMark(this._getElement(c,"DescribeCoverage/Get/OnlineResource").getAttribute("xlink:href"));b.getCoverage=this._removeTrailingQuestionMark(this._getElement(c,"GetCoverage/Get/OnlineResource").getAttribute("xlink:href"));this.onlineResources=b;d=this._getElements(d,"CoverageOfferingBrief");c=[];for(b=0;b<d.length;b++){var l=d[b];var h={};h.id=this._getElementValue(l,"name");h.label=this._getElementValue(l,
"label");h.description=this._getElementValue(l,"description");var m=this._getElements(l,"pos");l=this._getElementValue(m[0]).split(" ");m=this._getElementValue(m[1]).split(" ");h.lonLatEnvelope=new a({xmin:parseFloat(l[0]),ymin:parseFloat(l[1]),xmax:parseFloat(m[0]),ymax:parseFloat(m[1]),spatialReference:{wkid:4326}});c.push(h)}this.coverages=c;return!0},_parse110:function(d){var b=H.hitch(this,function(r){var t;var q={};for(t=0;t<r.childNodes.length;t++){var n=r.childNodes[t];if(e(n,"title"))q.title=
this._getElementValue(n);else if(e(n,"abstract"))q["abstract"]=this._getElementValue(n);else if(e(n,"identifier"))q.id=this._getElementValue(n);else if(e(n,"WGS84BoundingBox")){var p=this._getElementValue(n,"LowerCorner").split(" ");n=this._getElementValue(n,"UpperCorner").split(" ");q.lonLatEnvelope=new a({xmin:parseFloat(p[0]),ymin:parseFloat(p[1]),xmax:parseFloat(n[0]),ymax:parseFloat(n[1]),spatialReference:{wkid:4326}})}else e(n,"CoverageSummary")&&(q.coverageSummaries=q.coverageSummaries||[],
q.coverageSummaries.push(b(n)))}return q}),c=function(r,t){var q;if(r.coverageSummaries)for(q=0;q<r.coverageSummaries.length;q++)r.coverageSummaries[q]["abstract"]=r.coverageSummaries[q]["abstract"]||r["abstract"],r.coverageSummaries[q].lonLatEnvelope=r.coverageSummaries[q].lonLatEnvelope||r.lonLatEnvelope,r.coverageSummaries[q].title=r.coverageSummaries[q].title||r.title,c(r.coverageSummaries[q],t);void 0!==r.id&&t.push(r)};this.name=this._getElementValue(d,"ServiceIdentification/Title");this.supportedVersions=
this._getElementValues(d,"ServiceIdentification/ServiceTypeVersion");var l={},h=this._getElement(d,"OperationsMetadata");l.getCapabilities=this._removeTrailingQuestionMark(this._getElement(h.querySelector("Operation[name\x3dGetCapabilities]"),"Get").getAttribute("xlink:href"));l.describeCoverage=this._removeTrailingQuestionMark(this._getElement(h.querySelector("Operation[name\x3dDescribeCoverage]"),"Get").getAttribute("xlink:href"));l.getCoverage=this._removeTrailingQuestionMark(this._getElement(h.querySelector("Operation[name\x3dGetCoverage]"),
"Get").getAttribute("xlink:href"));this.onlineResources=l;l=this._getElement(d,"Contents");h=[];for(d=0;d<l.childNodes.length;d++){var m=l.childNodes[d];e(m,"coveragesummary")&&c(b(m),h)}this.coverages=h;h=[];l=this._getElements(l,"SupportedFormat");for(d=0;d<l.length;d++)h.push(this._getElementValue(l[d]));this.supportedFormats=h;return!0},_parse201:function(d){var b=this._getElement(d,"ServiceIdentification");this.name=this._getElementValue(b,"Title");this.supportedVersions=this._getElementValues(b,
"ServiceTypeVersion");var c=this._getElements(b,"Profile"),l=[];for(b=0;b<c.length;b++)l.push(this._getElementValue(c[b]));this.profiles=l;b={};c=this._getElement(d,"OperationsMetadata");b.getCapabilities=this._removeTrailingQuestionMark(this._getElement(c.querySelector("Operation[name\x3dGetCapabilities]"),"Get").getAttribute("xlink:href"));b.describeCoverage=this._removeTrailingQuestionMark(this._getElement(c.querySelector("Operation[name\x3dDescribeCoverage]"),"Get").getAttribute("xlink:href"));
b.getCoverage=this._removeTrailingQuestionMark(this._getElement(c.querySelector("Operation[name\x3dGetCoverage]"),"Get").getAttribute("xlink:href"));this.onlineResources=b;c=this._getElements(d,"Contents/CoverageSummary");l=[];var h;for(b=0;b<c.length;b++){var m=c[b];var r={};r.id=this._getElementValue(m,"CoverageId");if(h=this._getElement(m,"WGS84BoundingBox"))m=this._getElementValue(h,"LowerCorner").split(" "),h=this._getElementValue(h,"UpperCorner").split(" "),r.lonLatEnvelope=new a({xmin:parseFloat(m[0]),
ymin:parseFloat(m[1]),xmax:parseFloat(h[0]),ymax:parseFloat(h[1]),spatialReference:{wkid:4326}});l.push(r)}this.coverages=l;d=this._getElement(d,"ServiceMetadata");c=this._getElements(d,"formatSupported");l=[];for(b=0;b<c.length;b++)l.push(this._getElementValue(c[b]));this.supportedFormats=l;d=this._getElements(d,"interpolationSupported");c=[];for(b=0;b<d.length;b++)c.push(this._getElementValue(d[b]));this.supportedInterpolations=c.map(function(t){var q=null;-1<t.toLowerCase().indexOf("nearest")?
q=0:-1<t.toLowerCase().indexOf("linear")?q=1:-1<t.toLowerCase().indexOf("cubic")&&(q=2);return q}).filter(function(t){return null!==t});return!0}});L("extend-esri")&&H.setObject("layers.WCSCapabilities",P,g);return P})},"esri/layers/WCSCoverageDescription":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ./TimeInfo ../geometry/Extent".split(" "),function(P,H,L,g,a,e){var d=function(b,c){var l;for(l=0;l<b.length;l++)if(c(b[l]))return l;return-1};P=P(null,{declaredClass:"esri.layers.WCSCoverageDescription",
version:null,id:null,description:null,lonLatEnvelope:null,extent:null,supportedFormats:null,supportedInterpolations:null,bandInfo:null,timeInfo:null,multidimensionalInfo:null,resolution:null,columns:null,rows:null,nativeCoverageDescription:null,_useEPSGAxis:!1,_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],
[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],constructor:function(b,c){this.version=c;this._parse=H.hitch(this,
this._parse);b&&H.mixin(this,this._parse(b,c))},_parse:function(b,c){this.version=c;switch(c){case "1.0.0":b=this._parse100(b);this._useEPSGAxis=!1;this.id=b.name;this.description=b.description||b.label;this.lonLatEnvelope=b.lonLatEnvelope;this.extent=b.domainSet.spatialDomain.envelope;this.supportedFormats=b.supportedFormats;c=b.domainSet;var l=b.rangeSet;b.supportedInterpolations&&0<b.supportedInterpolations.length&&(this.supportedInterpolations=b.supportedInterpolations.map(function(h){var m=null;
-1<h.toLowerCase().indexOf("nearest")?m=0:-1<h.toLowerCase().indexOf("linear")?m=1:-1<h.toLowerCase().indexOf("cubic")&&(m=2);return m}).filter(function(h){return null!==h}));break;case "1.1.0":case "1.1.1":case "1.1.2":b=this._parse110(b);this.id=b.identifier;this.description=b["abstract"]||b.title;this.extent=b.domain.spatialDomain.envelope;this.supportedFormats=b.supportedFormats;c=b.domain;l=b.range;b.range[0].supportedInterpolations&&0<b.range[0].supportedInterpolations.length&&(this.supportedInterpolations=
b.range[0].supportedInterpolations.map(function(h){var m=null;-1<h.toLowerCase().indexOf("nearest")?m=0:-1<h.toLowerCase().indexOf("linear")?m=1:-1<h.toLowerCase().indexOf("bicubic")&&(m=2);return m}).filter(function(h){return null!==h}));break;case "2.0.1":b=this._parse201(b);this._useEPSGAxis=!0;this.id=b.coverageId;this.description=b.description||b.coverageId;this.extent=b.boundedBy.envelope;this.supportedFormats=b.serviceParameters.supportedFormats;c=b.domainSet;l=b.rangeType;break;default:throw"unsupported WCS version "+
c;}this.nativeCoverageDescription=b;this.resolution=b.resolution;this.columns=c.columns||c.spatialDomain.columns;this.rows=c.rows||c.spatialDomain.rows;this.bandInfo=this._getBandInfo(l);this.timeInfo=this._getTimeInfo(b);this.multidimensionalInfo=this._getMultidimensionalInfo(b)},_getElements:function(b,c){if(!b)return null;if(!c)return b;var l=c;-1<c.indexOf("/")?(l=c.slice(0,c.indexOf("/")),c=c.slice(c.indexOf("/")+1)):c="";return c?this._getElement(b,l).getElementsByTagNameNS("*",c):b.getElementsByTagNameNS("*",
l)},_getElement:function(b,c){if(!b)return null;if(!c)return b;var l=c;-1<c.indexOf("/")?(l=c.slice(0,c.indexOf("/")),c=c.slice(c.indexOf("/")+1)):c="";b=this._getElements(b,l);return 0<b.length?c?this._getElement(b[0],c):b[0]:null},_getElementValue:function(b,c){return(b=this._getElement(b,c))?(b=b.textContent||b.text||b.nodeValue||b.innerText)?b.trim():null:null},_getElementValues:function(b,c){b=this._getElements(b,c);c=[];var l,h;for(h=0;h<b.length;h++)if(l=b[h].textContent||b[h].text||b[h].nodeValue||
b[h].innerText)l=l.trim(),""!==l&&c.push(l);return c},_checkTagName:function(b,c){if(null===b||null===c||null===b.tagName||void 0===b.tagName)return!1;b=b.tagName.toLowerCase();c=c.toLowerCase();return b===c||0<b.indexOf(":"+c)},_parseTimeResolution:function(b){if(!b)return{resolution:null,units:null};var c=b.toUpperCase(),l=["Y","M","D"],h=["H","M","S"];b="Years Months Days Hours Minutes Seconds".split(" ");var m;-1===c.indexOf("PT")?(c=c.slice(1),l=d(l,function(r){return-1<c.indexOf(r)}),-1<l&&
(m=b[l])):(c=c.slice(2),l=d(h,function(r){return-1<c.indexOf(r)}),m=b[3+l]);return{resolution:parseFloat(c.substring(0,c.length-1)),units:m}},_getMultidimensionalInfo:function(b){var c,l,h=this.version,m=[];if(0===h.indexOf("1.1"))(l=b.range.filter(function(v){return-1===v.identifier.toLowerCase().indexOf("field_1")&&!v.axis.some(function(z){return"band"===z.identifier.toLowerCase()})}))&&0<l.length&&(l.forEach(function(v){var z=v.axis.map(function(A){A={name:A.identifier.trim(),field:A.identifier.trim(),
unit:A.valuesUnit?A.valuesUnit.trim():"",hasRegularIntervals:!1,values:A.values.map(function(G){return parseFloat(G.trim())})};A.extent=[Math.min.apply(null,A.values),Math.max.apply(null,A.values)];return A});m.push({name:v.identifier.trim(),description:v.description?v.description.trim():"",unit:"",dimensions:z})}),0<m.length&&(c={variables:m}));else if(0===h.indexOf("2.0")&&(l=[],b.rangeType.forEach(function(v){l=l.concat(v.filter(function(z){return-1===z.name.toLowerCase().indexOf("band")}))}),
l&&0<l.length)){var r=[];h=function(v){var z="";if(Math.abs(v-1/24)<1/24*.01){var A=1;z="Hours"}else.01>Math.abs(v-1)?(A=1,z="Days"):1>v?(A=Math.round(24*v),z="Hours"):27.99<v&&31.01>v?(A=1,z="Months"):12>Math.round(v/30)?(A=12>Math.round(v/30),z="Months"):364.99<v&&366.01>v&&(A=1,z="Years");return{interval:A,intervalUnit:z}};var t=b.boundedBy,q,n;for(q=2;q<b.domainSet.axisLabels.length;q++){var p=(t.uomLabels&&t.uomLabels.length)>q?t.uomLabels[q]:"";p=(n=-1<b.domainSet.axisLabels[q].toLowerCase().indexOf("time")||
"iso8601"===p.toLowerCase())?h(b.domainSet.offset[q]):{interval:b.domainSet.offset[q],intervalUnit:p};var u={name:b.domainSet.axisLabels[q].trim(),field:b.domainSet.axisLabels[q].trim(),unit:t.uomLabels&&t.uomLabels.length>q?t.uomLabels[q].trim():"",hasRegularIntervals:!0};H.mixin(u,p);u.extent=n?[(new Date).setTime(864E5*(b.boundedBy.envelopeAllDims.mins[q]-25569)),(new Date).setTime(864E5*(b.boundedBy.envelopeAllDims.maxs[q]-25569))]:[t.envelopeAllDims.mins[q],t.envelopeAllDims.maxs[q]];r.push(u)}l.forEach(function(v){m.push({name:v.name.trim(),
description:v.description.trim(),unit:v.uom.trim(),dimensions:r})});0<m.length&&(c={variables:m})}return c},_getBandInfo:function(b){var c,l,h=!1;switch(this.version){case "1.0.0":for(c=0;c<b.length&&!h;c++)for(l=0;l<b[c].axis.length;l++)if("band"===b[c].axis[l].name.toLowerCase()){var m=b[c].axis[l].values;h=!0;break}break;case "1.1.0":case "1.1.1":case "1.1.2":for(c=0;c<b.length&&!h;c++)for(l=0;l<b[c].axis.length;l++)if("band"===b[c].axis[l].identifier.toLowerCase()){m=b[c].axis[l].values;h=!0;
break}break;case "2.0.1":for(c=0;c<b[0].length;c++)-1<b[0][c].name.toLowerCase().indexOf("band")&&(m=m||[],m.push(b[0][c].name))}return m},_useLatLong:function(b){var c;for(c=0;c<this._REVERSED_LAT_LONG_RANGES.length;c++){var l=this._REVERSED_LAT_LONG_RANGES[c];if(b>=l[0]&&b<=l[1]){var h=!0;break}}return h},_getTimeInfo:function(b){var c;switch(this.version){case "1.0.0":case "1.1.0":case "1.1.1":case "1.1.2":(b=(b.domainSet||b.domain).temporalDomain)&&(c=new a({timeExtent:[b.begin,b.end],interval:b.resolution,
intervalUnit:b.unit}));break;case "2.0.1":var l=d(b.domainSet.axisLabels,function(h){return-1<h.toLowerCase().indexOf("time")});-1<l&&(c=new a({startTimeField:b.domainSet.axisLabels[l],timeExtent:[(new Date).setTime(864E5*(b.boundedBy.envelopeAllDims.mins[l]-25569)),(new Date).setTime(864E5*(b.boundedBy.envelopeAllDims.maxs[l]-25569))]}))}return c},_parse100:function(b){var c={name:null,label:null,lonLatEnvelope:null,supportedFormats:null,supportedCRSs:null,domainSet:null,rangeSet:null,description:null,
metadataLink:null,supportedInterpolations:null},l=b.childNodes.length,h=this._checkTagName,m=H.hitch(this,function(v){var z=this._getElementValues(v,"requestResponseCRSs").map(function(A){return A.split(":")[1]});v=this._getElementValues(v,"nativeCRSs").map(function(A){return A.split(":")[1]});return{requestResponseCRSs:z,nativeCRSs:v}}),r=H.hitch(this,function(v){var z=this._getElementValues(v,"interpolationMethod"),A=v.getAttribute("default");return void 0!==A||null!==A?[A].concat(z.filter(function(G){return G.toLowerCase()!==
A.toLowerCase()})):z}),t=H.hitch(this,function(v){var z=this._getElements(v,"pos");v=this._getElementValue(z[0]).split(" ");z=this._getElementValue(z[1]).split(" ");return new e({xmin:parseFloat(v[0]),ymin:parseFloat(v[1]),xmax:parseFloat(z[0]),ymax:parseFloat(z[1]),spatialReference:{wkid:4326}})}),q=H.hitch(this,function(v){var z=[];v=this._getElements(v,"RangeSet");var A,G;for(A=0;A<v.length;A++){var D={};D.name=this._getElementValue(v[A],"name");D.label=this._getElementValue(v[A],"label");D.axis=
[];var I=this._getElements(v[A],"AxisDescription");for(G=0;G<I.length;G++){var f={};f.name=this._getElementValue(I[G],"name");f.label=this._getElementValue(I[G],"label");var x=[];x=this._getElementValues(I[G],"singleValue");if(0===x.length){var y=this._getElementValue(I[G],"min");var k=this._getElementValue(I[G],"max");if(null!==y&&null!==k)for(y=parseInt(y,10);y<=parseInt(k,10);y++)x.push(y)}f.values=x;D.axis.push(f)}z.push(D)}return z}),n=H.hitch(this,function(v){var z={},A={},G=this._getElement(v,
"spatialDomain"),D=this._getElement(G,"Envelope")||this._getElement(G,"EnvelopeWithTimePeriod"),I=D.getAttribute("srsName").split(":");I=I[I.length-1];var f=this._getElements(D,"pos");D=this._getElementValue(f[0]).split(" ");f=this._getElementValue(f[1]).split(" ");A.envelope=new e({xmin:parseFloat(D[0]),ymin:parseFloat(D[1]),xmax:parseFloat(f[0]),ymax:parseFloat(f[1]),spatialReference:{wkid:parseInt(I,10)}});I=this._getElement(G,"RectifiedGrid");D=this._getElementValue(I,"low").split(" ");f=this._getElementValue(I,
"high").split(" ");I=parseInt(f[0],10)-parseInt(D[0],10)+1;D=parseInt(f[1],10)-parseInt(D[1],10)+1;f=this._getElementValue(G,"origin/pos").split(" ");var x=this._getElements(G,"offsetVector");G=parseFloat(this._getElementValue(x[0]).split(" ")[0]);x=parseFloat(this._getElementValue(x[0]).split(" ")[1]);A.columns=I;A.rows=D;A.offset={x:G,y:x};A.origin={x:parseFloat(f[0]),y:parseFloat(f[1])};z.spatialDomain=A;A={begin:null,end:null};G=[];if(I=this._getElement(v,"temporalDomain")){v=this._getElements(I,
"timeposition");if(0<v.length){for(I=0;I<v.length;I++)G.push(new Date(this._getElementValue(v[I])));A.begin=G[0];A.end=G[G.length-1];A.values=G}else if(v=this._getElement(I,"timePeriod"))A.begin=new Date(this._getElementValue(v,"beginPosition")),A.end=new Date(this._getElementValue(v,"endPosition")),v=this._getElementValue(v,"timeResolution"),A=H.mixin(A,this._parseTimeResolution(v));z.temporalDomain=A}return z}),p;for(p=0;p<l;p++){var u=b.childNodes[p];h(u,"description")?c.description=this._getElementValue(u):
h(u,"name")?c.name=this._getElementValue(u):h(u,"label")?c.label=this._getElementValue(u):h(u,"supportedFormats")?c.supportedFormats=this._getElementValues(u,"formats"):h(u,"supportedCRSs")?c.supportedCRSs=m(u):h(u,"supportedInterpolations")?c.supportedInterpolations=r(u):h(u,"lonLatEnvelope")?c.lonLatEnvelope=t(u):h(u,"rangeSet")?c.rangeSet=q(u):h(u,"domainSet")&&(c.domainSet=n(u),c.resolution=c.domainSet.spatialDomain.offset)}return c},_parse110:function(b){var c={title:null,"abstract":null,identifier:null,
supportedFormats:null,supportedCRSs:null,domain:null,range:null,metadata:null},l=b.childNodes.length,h=this._checkTagName,m=H.hitch(this,function(n){var p=[];n=this._getElements(n,"Field");var u,v;for(u=0;u<n.length;u++){var z={};z.identifier=this._getElementValue(n[u],"Identifier");z.description=this._getElementValue(n[u],"Description");z.definition=this._getElementValue(n[u],"Definition");z.Abstract=this._getElementValue(n[u],"Abstract");z.Title=this._getElementValue(n[u],"Title");z.supportedInterpolations=
this._getElementValues(n[u],"InterpolationMethod");z.axis=[];var A=this._getElements(n[u],"Axis");for(v=0;v<A.length;v++){var G={};G.identifier=A[v].getAttribute("identifier");G.valuesUnit=this._getElementValue(A[v],"valuesUnit");G.dataType=this._getElementValue(A[v],"DataType");G.values=this._getElementValues(A[v],"Key");z.axis.push(G)}p.push(z)}return p}),r=H.hitch(this,function(n){var p={},u={},v=this._getElement(n,"SpatialDomain"),z=this._getElement(v,"GridCRS"),A=this._getElementValue(z,"GridBaseCRS"),
G=this._getElementValue(z,"GridOrigin");G=G?G.split(" "):[0,0];z=this._getElementValue(z,"GridOffsets").split(" ");var D=this._getElements(v,"BoundingBox");for(v=0;v<D.length;v++)if("urn:ogc:def:crs:OGC::imageCRS"===D[v].getAttribute("crs")){var I=this._getElementValue(D[v],"LowerCorner").split(" ");var f=this._getElementValue(D[v],"UpperCorner").split(" ");var x=parseInt(f[0],10)-parseInt(I[0],10)+1;var y=parseInt(f[1],10)-parseInt(I[1],10)+1}else if(0<D[v].getAttribute("crs").indexOf("EPSG")){var k=
D[v].getAttribute("crs").split("::")[1];I=this._getElementValue(D[v],"LowerCorner").split(" ");f=this._getElementValue(D[v],"UpperCorner").split(" ");u.envelope=new e({xmin:parseFloat(I[0]),ymin:parseFloat(I[1]),xmax:parseFloat(f[0]),ymax:parseFloat(f[1]),spatialReference:{wkid:parseInt(k,10)}})}v=x>y;D=u.envelope.xmax-u.envelope.xmin>u.envelope.ymax-u.envelope.ymin;this._useLatLong(k)&&(v===D?this._useEPSGAxis=!1:(this._useEPSGAxis=!0,u.envelope=new e({xmin:u.envelope.ymin,ymin:u.envelope.xmin,xmax:u.envelope.ymax,
ymax:u.envelope.xmax,spatialReference:{wkid:parseInt(k,10)}})));u.columns=x;u.rows=y;u.origin={x:parseFloat(G[0]),y:parseFloat(G[1])};u.offset={x:parseFloat(z[0]),y:parseFloat(z[1])};u.gridBaseCRS=A;p.spatialDomain=u;u={begin:null,end:null};A=[];if(G=this._getElement(n,"temporalDomain")){n=this._getElements(G,"timeposition");if(0<n.length){for(v=0;v<n.length;v++)A.push(new Date(this._getElementValue(n[v])));u.begin=A[0];u.end=A[A.length-1];u.values=A}else n=this._getElements(G,"timePeriod"),0<n.length&&
(u.begin=new Date(this._getElementValue(n[0],"beginPosition")),u.end=new Date(this._getElementValue(n[0],"endPosition")),n=this._getElementValue(n[0],"timeResolution"),u=H.mixin(u,this._parseTimeResolution(n)));p.temporalDomain=u}return p}),t;for(t=0;t<l;t++){var q=b.childNodes[t];h(q,"Title")?c.title=this._getElementValue(q):h(q,"Abstract")?c["abstract"]=this._getElementValue(q):h(q,"Identifier")?c.identifier=this._getElementValue(q):h(q,"SupportedFormat")?(c.supportedFormats||(c.supportedFormats=
[]),c.supportedFormats.push(this._getElementValue(q))):h(q,"SupportedCRS")?(c.supportedCRSs||(c.supportedCRSs=[]),c.supportedCRSs.push(this._getElementValue(q))):h(q,"Range")?c.range=m(q):h(q,"Domain")&&(c.domain=r(q),c.resolution=c.domain.spatialDomain.offset)}return c},_parse201:function(b){var c={coverageId:null,boundedBy:null,domainSet:null,rangeType:null,serviceParameters:null,coverageFunction:null,extension:null},l=b.childNodes.length,h=function(v){return parseFloat(v)},m=function(v){return parseInt(v,
10)},r=this._checkTagName,t=H.hitch(this,function(v){var z={envelope:null,axisLabels:null,uomLabels:null,envelopeAllDims:null};v=this._getElement(v,"Envelope")||this._getElement(v,"EnvelopeWithTimePeriod");var A=v.getAttribute("srsName");A=A.slice(A.lastIndexOf("/")+1);var G=v.getAttribute("axisLabels"),D=this._getElementValue(v,"lowerCorner").split(" ").map(h),I=this._getElementValue(v,"upperCorner").split(" ").map(h);"y lat latitude north nor n b".split(" ").some(function(f){return f===G[0].toLowerCase()})?
z.envelope=new e({xmin:D[1],ymin:D[0],xmax:I[1],ymax:I[0],spatialReference:{wkid:parseInt(A,10)}}):z.envelope=new e({xmin:D[0],ymin:D[1],xmax:I[0],ymax:I[1],spatialReference:{wkid:parseInt(A,10)}});z.axisLabels=G;z.envelopeAllDims={mins:D,maxs:I};v=v.getAttribute("uomLabels").trim().split(" ");z.uomLabels=v.length?v:null;return z}),q=H.hitch(this,function(v){var z=[];v=this._getElements(v,"DataRecord");var A,G,D,I=function(k){return k.map(function(w){return parseFloat(w)})};for(A=0;A<v.length;A++){var f=
this._getElements(v[A],"field");var x=[];for(G=0;G<f.length;G++){var y={};y.name=f[G].getAttribute("name");y.description=this._getElementValue(f[G],"description")||"";y.uom=this._getElement(f[G],"uom").getAttribute("code")||"";if(D=this._getElementValue(f[G],"interval"))D=D.split(" "),y.allowedValues=I(D);x.push(y)}z.push(x)}return z}),n=H.hitch(this,function(v){var z={},A=this._getElement(v,"RectifiedGrid"),G=this._getElementValue(A,"low").split(" ").map(m),D=this._getElementValue(A,"high").split(" ").map(m);
v=[];var I;for(I=0;I<G.length;I++)v.push(D[I]-G[I]+1);var f=this._getElementValue(A,"axisLabels").split(" ");G=this._getElementValue(A,"origin/pos").split(" ").map(h);A=this._getElements(A,"offsetVector");D=[];for(I=0;I<A.length;I++)D.push(parseFloat(this._getElementValue(A[I]).split(" ")[I]));"y lat latitude north nor n b".split(" ").some(function(x){return x===f[0].toLowerCase()})?(z.columns=v[1],z.rows=v[0],z._resolution={y:D[0],x:D[1]}):(z.columns=v[0],z.rows=v[1],z._resolution={x:D[0],y:D[1]});
z.gridSamples=v;z.axisLabels=f;z.offset=D;z.origin=G;return z}),p;for(p=0;p<l;p++){var u=b.childNodes[p];r(u,"coverageId")?c.coverageId=this._getElementValue(u):r(u,"ServiceParameters")?c.serviceParameters={supportedFormats:this._getElementValues(u,"nativeFormat")}:r(u,"boundedBy")?c.boundedBy=t(u):r(u,"rangeType")?c.rangeType=q(u):r(u,"domainSet")&&(c.domainSet=n(u),c.resolution=c.domainSet._resolution)}return c}});L("extend-esri")&&H.setObject("layers.WCSCoverageDescription",P,g);return P})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec ./rasterFormats/Lerc2Codec".split(" "),
function(P,H,L,g,a,e,d,b,c,l,h,m,r,t,q,n,p){var u,v,z,A,G,D;H=H(l,{declaredClass:"esri.layers.Raster",imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(k){this.imageServiceUrl=k;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(k,w,C){var E=this,F=new g(t._dfdCanceller);if(10>b("ie"))throw"This browser is not supported.";
if(!k.imageServiceParameters)throw"Insufficient parameters to read data";var B=L.clone(k.imageServiceParameters),J=k.pixelType;a.some(this.validPixelTypes,function(Q){return Q===J})||(B.pixelType="F32");a.some(this.validFormats,function(Q){return Q.toLowerCase()===B.format.toLowerCase()})||(B.format="lerc");var K=k.decodeFunc,M;this._prepareGetImageParameters(B);var O=B.width,N=B.height,R=B.extent;delete B.width;delete B.height;delete B.extent;F._pendingDfd=h({url:this.imageServiceUrl+"/exportImage",
handleAs:"arraybuffer",content:L.mixin(B,{f:"image"}),load:function(Q){E.decode(Q,{width:O,height:N,planes:null,pixelType:J,noDataValue:B.noData,format:B.format,decodeFunc:K}).then(function(T){M={pixelBlock:T,extent:R};E._resolve([M,B],"onRasterReadComplete",w,F)},function(T){E._resolve([T],null,C,F,!0)})},error:function(Q){E._resolve([Q],null,C,F,!0)}});return F.promise},decode:function(k,w){if(void 0===w||null===w)throw"missing decode options";var C;w.format&&(C=w.format.toUpperCase());"BSQ"!==
C&&"BIP"!==C&&(C=this._getFormat(k));var E=w.decodeFunc;if(void 0===E||null===E)E=this._getFormatDecoderDfd(C);return E(k,w)},onRasterReadComplete:function(){},_prepareGetImageParameters:function(k){if(k.size&&k.bbox){var w=k.size.split(",");k.width=parseFloat(w[0]);k.height=parseFloat(w[1]);k.extent||(w=k.bbox.split(","),k.extent=new m(parseFloat(w[0]),parseFloat(w[1]),parseFloat(w[2]),parseFloat(w[3]),new r(k.bboxSR)))}else{if(!k.width||Math.floor(k.width)!==k.width||!k.height||Math.floor(k.height)!==
k.height)throw"Incorrect Image Dimensions";if(!k.extent||"esri.geometry.Extent"!==k.extent.declaredClass)throw"Incorrect extent";w=k.extent;var C=w.spatialReference.wkid||d.toJson(w.spatialReference.toJson());delete k._ts;L.mixin(k,{bbox:w.xmin+","+w.ymin+","+w.xmax+","+w.ymax,imageSR:C,bboxSR:C,size:k.width+","+k.height},k.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(k,w,C){var E=k.ymax-k.ymin,F=k.xmax-k.xmin;C>=w?k.ymax=k.ymin+F*w/C:k.xmax=k.xmin+E*C/w;return k},
_resolve:function(k,w,C,E,F){w&&this[w].apply(this,k);C&&C.apply(null,k);E&&t._resDfd(E,k,F)},_getFormatDecoderDfd:function(k){var w=null;switch(k){case "LERC":w=this._decodeLerc;break;case "LERC2":w=this._decodeLerc2;break;case "JPEG":w=this._decodeJpeg;break;case "PNG":w=this._decodePng;break;case "BSQ":w=this._decodeBsq;break;case "BIP":w=this._decodeBip;break;case "TIFF":w=this._decodeTiff;break;default:w=function(C,E){throw"The raster format is not supported";}}w=L.hitch(this,w);return function(C,
E){var F=new g;try{if("LERC"===k||!0===G){var B=w(C,E);F.resolve(B)}else D.then(function(){B=w(C,E);F.resolve(B)})}catch(J){F.reject(J)}return F}},_getFormat:function(k){k=new Uint8Array(k,0,10);var w="";if(255===k[0]&&216===k[1])w="JPEG";else if(137===k[0]&&80===k[1]&&78===k[2]&&71===k[3])w="PNG";else if(67===k[0]&&110===k[1]&&116===k[2]&&90===k[3]&&73===k[4]&&109===k[5]&&97===k[6]&&103===k[7]&&101===k[8]&&32===k[9])w="LERC";else if(76===k[0]&&101===k[1]&&114===k[2]&&99===k[3]&&50===k[4]&&32===k[5])w=
"LERC2";else if(-1<String.fromCharCode.apply(null,k).toLowerCase().indexOf("error"))w="ERROR";else if(73===k[0]&&73===k[1]&&42===k[2]&&0===k[3]||77===k[0]&&77===k[1]&&0===k[2]&&42===k[3])w="TIFF";return w},_validateDecodeParams:function(k){if(!k.height||Math.floor(k.height)!==k.height)throw"Height not provided.";if(!k.width||Math.floor(k.width)!==k.width)throw"Width not provided.";},_decodeJpeg:function(k,w){if(!u)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(w);k=(new u).decode(k);
if(!y(k,w))throw"The decoded image dimensions are incorrect.";w=[];var C;for(C=0;C<k.pixels.length;C++){var E=k.pixels[C];w.push(this._calculateBandStatistics(E))}return new q({width:k.width,height:k.height,pixels:k.pixels,pixelType:"U8",mask:k.mask,statistics:w})},_decodePng:function(k,w){if(!v)throw"The png decoder module is not loaded.";this._validateDecodeParams(w);k=new Uint8Array(k);var C=new v(k);k=new Uint8Array(w.width*w.height*4);C.copyToImageData(k,C.decodePixels());var E=C=0;E=new Uint8Array(w.width*
w.height);for(C=0;C<w.width*w.height;C++)E[C]=k[4*C+3];var F=new q({width:w.width,height:w.height,pixels:[],pixelType:"U8",mask:E,statistics:[]});for(C=0;3>C;C++){var B=new Uint8Array(w.width*w.height);for(E=0;E<w.width*w.height;E++)B[E]=k[4*E+C];F.addData({pixels:B,statistics:this._calculateBandStatistics(B)})}return F},_decodeBsq:function(k,w){if(!z)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(w);f=w.noDataValue;w.pixelType=x(w.pixelType);k=z.decodeBSQ(k,{bandCount:w.planes,
width:w.width,height:w.height,pixelType:I,noDataValue:f});var C=[],E,F=null;for(E=0;E<k.pixels.length;E++)F=k.pixels[E],C.push(this._calculateBandStatistics(F));return new q({width:w.width,height:w.height,pixels:k.pixels,pixelType:w.pixelType,mask:k.maskData,statistics:C})},_decodeBip:function(k,w){this._validateDecodeParams(w);f=w.noDataValue;w.pixelType=x(w.pixelType);k=z.decodeBIP(k,{bandCount:w.planes,width:w.width,height:w.height,pixelType:I,noDataValue:f});var C=[],E,F=null;for(E=0;E<k.pixels.length;E++)F=
k.pixels[E],C.push(this._calculateBandStatistics(F));return new q({width:w.width,height:w.height,pixels:k.pixels,pixelType:w.pixelType,mask:k.maskData,statistics:C})},_decodeTiff:function(k,w){this._validateDecodeParams(w);f=w.noDataValue;w.pixelType=x(w.pixelType);k=A.decode(k);w=[];var C,E=null;for(C=0;C<k.pixels.length;C++)E=k.pixels[C],w.push(this._calculateBandStatistics(E,k.maskData));return new q({width:k.width,height:k.height,pixels:k.pixels,pixelType:k.pixelType,mask:k.maskData,statistics:w})},
_decodeLerc:function(k,w){this._validateDecodeParams(w);f=w.noDataValue;w.pixelType=x(w.pixelType);for(var C=0,E,F=0,B,J=k.byteLength-10;F<J;){var K=n.decode(k,{inputOffset:F,encodedMaskData:E,returnMask:0===C?!0:!1,returnEncodedMask:0===C?!0:!1,returnFileInfo:!0,pixelType:I,noDataValue:f});F=K.fileInfo.eofOffset;0===C&&(E=K.encodedMaskData,B=new q({width:w.width,height:w.height,pixels:[],pixelType:w.pixelType,mask:K.maskData,statistics:[]}));C++;if(!y(K,w))throw"The decoded image dimensions are incorrect";
B.addData({pixels:K.pixelData,statistics:{minValue:K.minValue,maxValue:K.maxValue,noDataValue:K.noDataValue}})}return B},_decodeLerc2:function(k,w){this._validateDecodeParams(w);f=w.noDataValue;w.pixelType=x(w.pixelType);for(var C=0,E,F,B=0,J,K=k.byteLength-10,M=[];B<K;){F=p.decode(k,{inputOffset:B,maskData:E,returnFileInfo:!0});B=F.fileInfo.eofOffset;0===C&&(E=F.maskData,J=new q({width:w.width,height:w.height,pixels:[],pixelType:F.fileInfo.pixelType,mask:F.maskData,statistics:[]}));F.fileInfo.mask&&
0<F.fileInfo.mask.numBytes&&M.push(F.maskData);C++;if(!y(F,w))throw"The decoded image dimensions are incorrect";if(1<F.dimCount&&F.pixelData&&F.pixelData.length===F.width*F.height*F.dimCount){F.pixelData=F.pixelData.slice(-F.width*F.height);var O=F.dimStats&&F.dimStats.minValues&&F.dimStats.minValues[F.dimCount-1],N=F.dimStats&&F.dimStats.maxValues&&F.dimStats.maxValues[F.dimCount-1];null!=O&&null!=N&&(F.minValue=O,F.maxValue=N)}J.addData({pixels:F.pixelData,statistics:{minValue:F.minValue,maxValue:F.maxValue,
noDataValue:F.noDataValue}})}if(1<M.length){F=J.width*J.height;J.bandMasks=M;E=new Uint8Array(F);E.set(M[0]);for(w=1;w<M.length;w++)for(k=M[w],C=0;C<F;C++)E[C]&=k[C];J.maskData=E}return J},_calculateBandStatistics:function(k,w){var C=Infinity,E=-Infinity,F=k.length,B,J=0;if(w)for(B=0;B<F;B++)w[B]&&(J=k[B],C=J<C?J:C,E=J>E?J:E);else for(B=0;B<F;B++)J=k[B],C=J<C?J:C,E=J>E?J:E;return{minValue:C,maxValue:E}},_loadRasterFormatModules:function(){G||(D||(D=new g),10>b("ie")?D.isRejected()||D.reject("unsupported browser version"):
P(["./rasterFormats/JpgPlus","./rasterFormats/Png","./rasterFormats/Raw","./rasterFormats/TiffDecoder","./rasterFormats/Zlib"],function(k,w,C,E){u=k;v=w;z=C;A=E;G=!0;D.isResolved()||D.resolve(!0)}))}});var I=null,f=null,x=function(k){if("U1"===k||"U2"===k||"U4"===k||"U8"===k)return f=Math.pow(2,8)-1,I=Uint8Array,"U8";"U16"===k?(f=f||Math.pow(2,16)-1,I=Uint16Array):"U32"===k?(f=f||Math.pow(2,32)-1,I=Uint32Array):"S8"===k?(f=f||0-Math.pow(2,7),I=Int8Array):"S16"===k?(f=f||0-Math.pow(2,15),I=Int16Array):
"S32"===k?(f=f||0-Math.pow(2,31),I=Int32Array):I=Float32Array;return k},y=function(k,w){return k.height!==w.height||k.width!==w.width?!1:!0};b("extend-esri")&&L.setObject("layers.Raster",H,c);return H})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(P,H,L,g){P=P([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],maskIsAlpha:!1,validPixelCount:null,constructor:function(a){if(a){if(!a.width||
Math.floor(a.width)!==a.width)throw"PixelBlock: incorrect width";if(!a.height||Math.floor(a.height)!==a.height)throw"PixelBlock: incorrect height";if(!a.pixels)throw"PixelBlock: pixel data not present";this.width=a.width;this.height=a.height;this.pixels=a.pixels;this.pixelType=a.pixelType||null;this.statistics=a.statistics;this.mask=a.mask||null;this.maskIsAlpha=a.maskIsAlpha||!1;a=a.validPixelCount;null==a&&(a=this.mask?this._getValidPixelCount(this.mask):this.width*this.height);this.validPixelCount=
a}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(a){if(!a.pixels||!a.statistics)throw"Pixel data or statistics are not present";if(a.pixels.length!==this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(a.statistics);this.pixels.push(a.pixels)},getAsRGBA:function(){var a=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(a);
break;default:this._fillFrom8Bit(a)}return new Uint8ClampedArray(a)},getAsRGBAFloat:function(){var a=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(a);return a},clone:function(a){a=a||this;var e=new this.constructor;e.width=a.width;e.height=a.height;e.pixelType=a.pixelType;e.maskIsAlpha=a.maskIsAlpha;a.mask&&(e.mask=new Uint8Array(a.mask));var d,b;if(a.pixels){e.pixels=[];var c=(b=a.pixels.length)&&a.pixels[0].slice;for(d=0;d<b;d++)e.pixels[d]=c?a.pixels[d].slice(0,a.pixels[d].length):
new a.pixels[d].constructor(a.pixels[d])}if(a.statistics)for(e.statistics=[],b=a.statistics.length,d=0;d<b;d++)e.statistics[d]=H.clone(a.statistics[d]);a=a.validPixelCount;null==a&&(a=e.mask?this._getValidPixelCount(e.mask):e.width*e.height);return e},clamp:function(a){if("F64"!==a&&"F32"!==a){switch(a){case "U8":var e=[0,255];break;case "U16":e=[0,65535];break;case "U32":e=[0,4294967295];break;case "S8":e=[-128,127];break;case "S16":e=[-32768,32767];break;case "S32":e=[-2147483648,2147483647];break;
default:e=[-3.4*1E39,3.4*1E39]}var d=e[0];e=e[1];var b=this.pixels,c=this.width*this.height,l=b.length,h,m,r=[];for(h=0;h<l;h++){var t=this._createEmptyBand(a,c);var q=b[h];for(m=0;m<c;m++){var n=q[m];t[m]=n>e?e:n<d?d:n}r.push(t)}this.pixels=r;this.pixelType=a}},calculateStatistics:function(){var a,e=[],d=this.mask;for(a=0;a<this.pixels.length;a++){var b=this.pixels[a];e.push(this._calculateBandStatistics(b,d))}this.statistics=e},_getValidPixelCount:function(a){var e,d=0;for(e=0;e<a.length;e++)a[e]&&
d++;return d},_createEmptyBand:function(a,e){switch(a){case "U8":a=new Uint8Array(e);break;case "U16":a=new Uint16Array(e);break;case "U32":a=new Uint32Array(e);break;case "S8":a=new Int8Array(e);break;case "S16":a=new Int16Array(e);break;case "S32":a=new Int32Array(e);break;case "U32":a=new Uint32Array(e);break;case "F32":a=new Float32Array(e);break;case "F64":a=new Float64Array(e);break;default:a=new Float32Array(e)}return a},_fillFrom8Bit:function(a){var e=this.pixels,d=this.mask;if(!a||!e||!e.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var b,c;var l=b=c=e[0];3<=e.length&&(b=e[1],c=e[2]);e=new Uint32Array(a);var h=this.width*this.height;if(l.length!==h)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(d&&d.length===h)if(this.maskIsAlpha)for(a=0;a<h;a++)d[a]&&(e[a]=d[a]<<24|c[a]<<16|b[a]<<8|l[a]);else for(a=0;a<h;a++)d[a]&&(e[a]=-16777216|c[a]<<16|b[a]<<8|l[a]);else for(a=0;a<h;a++)e[a]=-16777216|c[a]<<16|b[a]<<8|l[a]},_fillFromNon8Bit:function(a){var e=this.pixels,d=this.mask,b=this.statistics;if(!a||
!e||!e.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var c=1,l=0;c=1;b&&0<b.length?(l=b.map(function(t){return t.minValue}).reduce(function(t,q){return Math.min(t,q)}),c=b.map(function(t){return t.maxValue-t.minValue}).reduce(function(t,q){return Math.max(t,q)}),c=255/c):(c=255,"S8"===this.pixelType?(l=-128,c=127):"U16"===this.pixelType?c=65535:"S16"===this.pixelType?(l=-32768,c=32767):"U32"===this.pixelType?c=4294967295:"S32"===this.pixelType?(l=-2147483648,
c=2147483647):"F32"===this.pixelType?(l=-3.4*1E39,c=3.4*1E39):"F64"===this.pixelType&&(l=-Number.MAX_VALUE,c=Number.MAX_VALUE),c=255/(c-l));a=new Uint32Array(a);b=this.width*this.height;var h=e[0];if(h.length!==b)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(3<=e.length){var m=e[1];var r=e[2];if(d&&d.length===b)for(e=0;e<b;e++)d[e]&&(a[e]=-16777216|(r[e]-l)*c<<16|(m[e]-l)*c<<8|(h[e]-l)*c);else for(e=0;e<b;e++)a[e]=-16777216|(r[e]-l)*c<<16|(m[e]-l)*c<<8|(h[e]-l)*
c}else if(d&&d.length===b)for(e=0;e<b;e++)m=(h[e]-l)*c,d[e]&&(a[e]=-16777216|m<<16|m<<8|m);else for(e=0;e<b;e++)m=(h[e]-l)*c,a[e]=-16777216|m<<16|m<<8|m},_fillFrom32Bit:function(a){var e=this.pixels,d=this.mask;if(!a||!e||!e.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var b,c;var l=b=c=e[0];3<=e.length&&(b=e[1],c=e[2]);var h=this.width*this.height;if(l.length!==h)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var m=0;if(d&&
d.length===h)for(e=0;e<h;e++)a[m++]=l[e],a[m++]=b[e],a[m++]=c[e],a[m++]=d[e]&1;else for(e=0;e<h;e++)a[m++]=l[e],a[m++]=b[e],a[m++]=c[e],a[m++]=1},_calculateBandStatistics:function(a,e){var d=Infinity,b=-Infinity,c=a.length,l,h=0;if(e)for(l=0;l<c;l++)e[l]&&(h=a[l],d=h<d?h:d,b=h>b?h:b);else for(l=0;l<c;l++)h=a[l],d=h<d?h:d,b=h>b?h:b;return{minValue:d,maxValue:b}}});L("extend-esri")&&H.setObject("layers.PixelBlock",P,g);return P})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var P=
{defaultNoDataValue:-3.4027999387901484E38,decode:function(L,g){g=g||{};var a=g.inputOffset||0,e=g.encodedMaskData||null===g.encodedMaskData,d={},b=new Uint8Array(L,a,10);d.fileIdentifierString=String.fromCharCode.apply(null,b);if("CntZImage"!=d.fileIdentifierString.trim())throw"Unexpected file identifier string: "+d.fileIdentifierString;a+=10;b=new DataView(L,a,24);d.fileVersion=b.getInt32(0,!0);d.imageType=b.getInt32(4,!0);d.height=b.getUint32(8,!0);d.width=b.getUint32(12,!0);d.maxZError=b.getFloat64(16,
!0);a+=24;if(!e)if(b=new DataView(L,a,16),d.mask={},d.mask.numBlocksY=b.getUint32(0,!0),d.mask.numBlocksX=b.getUint32(4,!0),d.mask.numBytes=b.getUint32(8,!0),d.mask.maxValue=b.getFloat32(12,!0),a+=16,0<d.mask.numBytes){e=new Uint8Array(Math.ceil(d.width*d.height/8));b=new DataView(L,a,d.mask.numBytes);var c=b.getInt16(0,!0),l=2,h=0;do{if(0<c)for(;c--;)e[h++]=b.getUint8(l++);else{var m=b.getUint8(l++);for(c=-c;c--;)e[h++]=m}c=b.getInt16(l,!0);l+=2}while(l<d.mask.numBytes);if(-32768!==c||h<e.length)throw"Unexpected end of mask RLE encoding";
d.mask.bitset=e;a+=d.mask.numBytes}else 0===(d.mask.numBytes|d.mask.numBlocksY|d.mask.maxValue)&&(e=new Uint8Array(Math.ceil(d.width*d.height/8)),d.mask.bitset=e);b=new DataView(L,a,16);d.pixels={};d.pixels.numBlocksY=b.getUint32(0,!0);d.pixels.numBlocksX=b.getUint32(4,!0);d.pixels.numBytes=b.getUint32(8,!0);d.pixels.maxValue=b.getFloat32(12,!0);a+=16;e=d.pixels.numBlocksX;b=d.pixels.numBlocksY;e+=0<d.width%e?1:0;c=b+(0<d.height%b?1:0);d.pixels.blocks=Array(e*c);for(h=l=0;h<c;h++)for(m=0;m<e;m++){var r=
0;b=new DataView(L,a,Math.min(10,L.byteLength-a));var t={};d.pixels.blocks[l++]=t;var q=b.getUint8(0);r++;t.encoding=q&63;if(3<t.encoding)throw"Invalid block encoding ("+t.encoding+")";if(2===t.encoding)a++;else{if(0!==q&&2!==q){q>>=6;t.offsetType=q;if(2===q)t.offset=b.getInt8(1),r++;else if(1===q)t.offset=b.getInt16(1,!0),r+=2;else if(0===q)t.offset=b.getFloat32(1,!0),r+=4;else throw"Invalid block offset type";if(1===t.encoding)if(q=b.getUint8(r),r++,t.bitsPerPixel=q&63,q>>=6,t.numValidPixelsType=
q,2===q)t.numValidPixels=b.getUint8(r),r++;else if(1===q)t.numValidPixels=b.getUint16(r,!0),r+=2;else if(0===q)t.numValidPixels=b.getUint32(r,!0),r+=4;else throw"Invalid valid pixel count type";}a+=r;if(3!=t.encoding)if(0===t.encoding){q=(d.pixels.numBytes-1)/4;if(q!==Math.floor(q))throw"uncompressed block has invalid length";b=new ArrayBuffer(4*q);r=new Uint8Array(b);r.set(new Uint8Array(L,a,4*q));b=new Float32Array(b);t.rawData=b;a+=4*q}else 1===t.encoding&&(q=Math.ceil(t.numValidPixels*t.bitsPerPixel/
8),b=new ArrayBuffer(4*Math.ceil(q/4)),r=new Uint8Array(b),r.set(new Uint8Array(L,a,q)),t.stuffedData=new Uint32Array(b),a+=q)}}d.eofOffset=a;L=null!=g.noDataValue?g.noDataValue:P.defaultNoDataValue;e=g.encodedMaskData;q=g.returnMask;c=0;l=d.pixels.numBlocksX;h=d.pixels.numBlocksY;m=Math.floor(d.width/l);t=Math.floor(d.height/h);r=2*d.maxZError;a=Number.MAX_VALUE;e=e||(d.mask?d.mask.bitset:null);var n;b=new (g.pixelType||Float32Array)(d.width*d.height);q&&e&&(n=new Uint8Array(d.width*d.height));q=
new Float32Array(m*t);for(var p,u,v=0;v<=h;v++){var z=v!==h?t:d.height%h;if(0!==z)for(var A=0;A<=l;A++){var G=A!==l?m:d.width%l;if(0!==G){var D=v*d.width*t+A*m,I=d.width-G,f=d.pixels.blocks[c],x;if(2>f.encoding){if(0===f.encoding)var y=f.rawData;else{var k=x=y=void 0;p=f.stuffedData;u=f.bitsPerPixel;var w=f.numValidPixels,C=f.offset,E=r,F=q,B=d.pixels.maxValue,J=(1<<u)-1,K=0,M=0,O=Math.ceil((B-C)/E);p[p.length-1]<<=8*(4*p.length-Math.ceil(u*w/8));for(k=0;k<w;k++)0===M&&(y=p[K++],M=32),M>=u?(x=y>>>
M-u&J,M-=u):(M=u-M,x=(y&J)<<M&J,y=p[K++],M=32-M,x+=y>>>M),F[k]=x<O?C+x*E:B;y=q}x=0}else var N=2===f.encoding?0:f.offset;if(e)for(u=0;u<z;u++){if(D&7){var R=e[D>>3];R<<=D&7}for(p=0;p<G;p++)D&7||(R=e[D>>3]),R&128?(n&&(n[D]=1),k=2>f.encoding?y[x++]:N,a=a>k?k:a,b[D++]=k):(n&&(n[D]=0),b[D++]=L),R<<=1;D+=I}else if(2>f.encoding)for(u=0;u<z;u++){for(p=0;p<G;p++)k=y[x++],a=a>k?k:a,b[D++]=k;D+=I}else for(a=a>N?N:a,u=0;u<z;u++){for(p=0;p<G;p++)b[D++]=N;D+=I}if(1===f.encoding&&x!==f.numValidPixels)throw"Block and Mask do not match";
c++}}}N=n;n={width:d.width,height:d.height,pixelData:b,minValue:a,maxValue:d.pixels.maxValue,noDataValue:L};N&&(n.maskData=N);g.returnEncodedMask&&d.mask&&(n.encodedMaskData=d.mask.bitset?d.mask.bitset:null);if(g.returnFileInfo&&(n.fileInfo=H(d),g.computeUsedBitDepths)){g=n.fileInfo;N=d.pixels.numBlocksX*d.pixels.numBlocksY;R={};for(y=0;y<N;y++)x=d.pixels.blocks[y],0===x.encoding?R.float32=!0:1===x.encoding?R[x.bitsPerPixel]=!0:R[0]=!0;d=Object.keys(R);g.bitDepths=d}return n}},H=function(L){return{fileIdentifierString:L.fileIdentifierString,
fileVersion:L.fileVersion,imageType:L.imageType,height:L.height,width:L.width,maxZError:L.maxZError,eofOffset:L.eofOffset,mask:L.mask?{numBlocksX:L.mask.numBlocksX,numBlocksY:L.mask.numBlocksY,numBytes:L.mask.numBytes,maxValue:L.mask.maxValue}:null,pixels:{numBlocksX:L.pixels.numBlocksX,numBlocksY:L.pixels.numBlocksY,numBytes:L.pixels.numBytes,maxValue:L.pixels.maxValue,noDataValue:this.noDataValue}}};return P})},"esri/layers/rasterFormats/Lerc2Codec":function(){define([],function(){var P={unstuff:function(g,
a,e,d,b,c,l,h){var m=(1<<e)-1,r=0,t,q=0;g[g.length-1]<<=8*(4*g.length-Math.ceil(e*d/8));if(b)for(t=0;t<d;t++){if(0===q){var n=g[r++];q=32}if(q>=e){var p=n>>>q-e&m;q-=e}else q=e-q,p=(n&m)<<q&m,n=g[r++],q=32-q,p+=n>>>q;a[t]=b[p]}else for(b=Math.ceil((h-c)/l),t=0;t<d;t++)0===q&&(n=g[r++],q=32),q>=e?(p=n>>>q-e&m,q-=e):(q=e-q,p=(n&m)<<q&m,n=g[r++],q=32-q,p+=n>>>q),a[t]=p<b?c+p*l:h},unstuffLUT:function(g,a,e,d,b,c){var l=(1<<a)-1,h=0,m=0,r=0,t=r=0,q=[];g[g.length-1]<<=8*(4*g.length-Math.ceil(a*e/8));var n=
Math.ceil((c-d)/b);for(m=0;m<e;m++){if(0===r){var p=g[h++];r=32}r>=a?(t=p>>>r-a&l,r-=a):(r=a-r,t=(p&l)<<r&l,p=g[h++],r=32-r,t+=p>>>r);q[m]=t<n?d+t*b:c}q.unshift(d);return q},unstuff2:function(g,a,e,d,b,c,l,h){var m=(1<<e)-1,r=0,t,q=0,n=0;if(b)for(t=0;t<d;t++){if(0===q){var p=g[r++];q=32;n=0}if(q>=e){var u=p>>>n&m;q-=e;n+=e}else{var v=e-q;u=p>>>n&m;p=g[r++];q=32-v;u|=(p&(1<<v)-1)<<e-v;n=v}a[t]=b[u]}else for(b=Math.ceil((h-c)/l),t=0;t<d;t++)0===q&&(p=g[r++],q=32,n=0),q>=e?(u=p>>>n&m,q-=e,n+=e):(v=e-
q,u=p>>>n&m,p=g[r++],q=32-v,u|=(p&(1<<v)-1)<<e-v,n=v),a[t]=u<b?c+u*l:h;return a},unstuffLUT2:function(g,a,e,d,b,c){var l=(1<<a)-1,h=0,m=0,r=0,t=0,q=0,n=0,p=[],u=Math.ceil((c-d)/b);for(m=0;m<e;m++){if(0===t){var v=g[h++];t=32;n=0}t>=a?(q=v>>>n&l,t-=a,n+=a):(r=a-t,q=v>>>n&l,v=g[h++],t=32-r,q|=(v&(1<<r)-1)<<a-r,n=r);p[m]=q<u?d+q*b:c}p.unshift(d);return p},originalUnstuff:function(g,a,e,d){var b=(1<<e)-1,c=0,l,h=0;g[g.length-1]<<=8*(4*g.length-Math.ceil(e*d/8));for(l=0;l<d;l++){if(0===h){var m=g[c++];
h=32}if(h>=e){var r=m>>>h-e&b;h-=e}else h=e-h,r=(m&b)<<h&b,m=g[c++],h=32-h,r+=m>>>h;a[l]=r}return a},originalUnstuff2:function(g,a,e,d){var b=(1<<e)-1,c=0,l,h=0,m=0;for(l=0;l<d;l++){if(0===h){var r=g[c++];h=32;m=0}if(h>=e){var t=r>>>m&b;h-=e;m+=e}else{var q=e-h;t=r>>>m&b;r=g[c++];h=32-q;t|=(r&(1<<q)-1)<<e-q;m=q}a[l]=t}return a}},H={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(g){for(var a=65535,e=65535,d=g.length,b=Math.floor(d/2),c=0;b;){var l=359<=b?359:b;b-=l;do a+=g[c++]<<8,e+=a+=
g[c++];while(--l);a=(a&65535)+(a>>>16);e=(e&65535)+(e>>>16)}d&1&&(e+=a+=g[c]<<8);return((e&65535)+(e>>>16)<<16|(a&65535)+(a>>>16))>>>0},readHeaderInfo:function(g,a){var e=a.ptr,d=new Uint8Array(g,e,6),b={};b.fileIdentifierString=String.fromCharCode.apply(null,d);if(0!==b.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+b.fileIdentifierString;e+=6;d=new DataView(g,e,8);var c=d.getInt32(0,!0);b.fileVersion=c;e+=4;3<=c&&(b.checksum=d.getUint32(4,
!0),e+=4);d=new DataView(g,e,12);b.height=d.getUint32(0,!0);b.width=d.getUint32(4,!0);e+=8;4<=c?(b.numDims=d.getUint32(8,!0),e+=4):b.numDims=1;d=new DataView(g,e,40);b.numValidPixel=d.getUint32(0,!0);b.microBlockSize=d.getInt32(4,!0);b.blobSize=d.getInt32(8,!0);b.imageType=d.getInt32(12,!0);b.maxZError=d.getFloat64(16,!0);b.zMin=d.getFloat64(24,!0);b.zMax=d.getFloat64(32,!0);e+=40;a.headerInfo=b;a.ptr=e;if(3<=c&&(g=this.computeChecksumFletcher32(new Uint8Array(g,e-(4<=c?52:48),b.blobSize-14)),g!==
b.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(g,a){var e=a.headerInfo,d=this.getDataTypeArray(e.imageType),b=e.numDims*this.getDataTypeSize(e.imageType),c=this.readSubArray(g,a.ptr,d,b);g=this.readSubArray(g,a.ptr+b,d,b);a.ptr+=2*b;b=!0;for(a=0;a<e.numDims;a++)if(c[a]!==g[a]){b=!1;break}e.minValues=c;e.maxValues=g;return b},readSubArray:function(g,a,e,d){if(e===Uint8Array)g=new Uint8Array(g,a,d);else{var b=new ArrayBuffer(d);(new Uint8Array(b)).set(new Uint8Array(g,a,d));
g=new e(b)}return g},readMask:function(g,a){var e=a.ptr,d=a.headerInfo,b=d.width*d.height,c=d.numValidPixel,l=new DataView(g,e,4);d={};d.numBytes=l.getUint32(0,!0);e+=4;if((0===c||b===c)&&0!==d.numBytes)throw"invalid mask";if(0===c)c=new Uint8Array(Math.ceil(b/8)),d.bitset=c,l=new Uint8Array(b),a.pixels.resultMask=l,e+=d.numBytes;else if(0<d.numBytes){c=new Uint8Array(Math.ceil(b/8));l=new DataView(g,e,d.numBytes);g=l.getInt16(0,!0);var h=2,m=0,r=0;do{if(0<g)for(;g--;)c[m++]=l.getUint8(h++);else for(r=
l.getUint8(h++),g=-g;g--;)c[m++]=r;g=l.getInt16(h,!0);h+=2}while(h<d.numBytes);if(-32768!==g||m<c.length)throw"Unexpected end of mask RLE encoding";l=new Uint8Array(b);for(h=h=g=0;h<b;h++)h&7?(g=c[h>>3],g<<=h&7):g=c[h>>3],g&128&&(l[h]=1);a.pixels.resultMask=l;d.bitset=c;e+=d.numBytes}a.ptr=e;a.mask=d;return!0},readDataOneSweep:function(g,a,e,d){var b=a.ptr,c=a.headerInfo,l=c.numDims,h=c.width*c.height;c=c.numValidPixel*H.getDataTypeSize(c.imageType)*l;var m=a.pixels.resultMask;if(e===Uint8Array)g=
new Uint8Array(g,b,c);else{var r=new ArrayBuffer(c);(new Uint8Array(r)).set(new Uint8Array(g,b,c));g=new e(r)}if(g.length===h*l)a.pixels.resultPixels=d?H.swapDimensionOrder(g,h,l,e,!0):g;else{a.pixels.resultPixels=new e(h*l);var t=r=e=0,q=0;if(1<l)if(d)for(r=0;r<h;r++){if(m[r])for(q=r,t=0;t<l;t++,q+=h)a.pixels.resultPixels[q]=g[e++]}else for(r=0;r<h;r++){if(m[r])for(q=r*l,t=0;t<l;t++)a.pixels.resultPixels[q+t]=g[e++]}else for(r=0;r<h;r++)m[r]&&(a.pixels.resultPixels[r]=g[e++])}a.ptr=b+c;return!0},
readHuffmanTree:function(g,a){var e=this.HUFFMAN_LUT_BITS_MAX,d=new DataView(g,a.ptr,16);a.ptr+=16;if(2>d.getInt32(0,!0))throw"unsupported Huffman version";var b=d.getInt32(4,!0),c=d.getInt32(8,!0);d=d.getInt32(12,!0);if(c>=d)return!1;var l=new Uint32Array(d-c);H.decodeBits(g,a,l);var h=[],m;for(m=c;m<d;m++){var r=m-(m<b?0:b);h[r]={first:l[m-c],second:null}}m=g.byteLength-a.ptr;l=new ArrayBuffer(4*Math.ceil(m/4));(new Uint8Array(l)).set(new Uint8Array(g,a.ptr,m));g=new Uint32Array(l);a=0;l=0;var t=
g[0];for(m=c;m<d;m++){r=m-(m<b?0:b);var q=h[r].first;0<q&&(h[r].second=t<<a>>>32-q,32-a>=q?(a+=q,32===a&&(a=0,l++,t=g[l])):(a+=q-32,l++,t=g[l],h[r].second|=t>>>32-a))}var n=t=0,p=new L;for(m=0;m<h.length;m++)void 0!==h[m]&&(t=Math.max(t,h[m].first));n=t>=e?e:t;e=[];var u;for(m=c;m<d;m++)if(r=m-(m<b?0:b),q=h[r].first,0<q)if(c=[q,r],q<=n){r=h[r].second<<n-q;var v=1<<n-q;for(q=0;q<v;q++)e[r|q]=c}else for(r=h[r].second,v=p,--q;0<=q;q--)(u=r>>>q&1)?(v.right||(v.right=new L),v=v.right):(v.left||(v.left=
new L),v=v.left),0!==q||v.val||(v.val=c[1]);return{decodeLut:e,numBitsLUTQick:n,numBitsLUT:t,tree:p,stuffedData:g,srcPtr:l,bitPos:a}},readHuffman:function(g,a,e,d){var b=a.headerInfo.numDims,c=a.headerInfo.height,l=a.headerInfo.width,h=l*c,m=this.readHuffmanTree(g,a);g=m.decodeLut;var r=m.tree,t=m.stuffedData,q=m.srcPtr,n=m.bitPos,p=m.numBitsLUTQick;m=m.numBitsLUT;var u=0===a.headerInfo.imageType?128:0,v=a.pixels.resultMask,z,A,G,D,I,f,x=0;0<n&&(q++,n=0);var y=t[q],k=1===a.encodeMode,w=new e(h*b),
C=w,E;if(2>b||k)for(E=0;E<b;E++)if(1<b&&(C=new e(w.buffer,h*E,h),x=0),a.headerInfo.numValidPixel===l*c)for(G=I=0;G<c;G++)for(D=0;D<l;D++,I++){var F=0;var B=z=y<<n>>>32-p;32-n<p&&(B=z|=t[q+1]>>>64-n-p);if(g[B])F=g[B][1],n+=g[B][0];else for(B=z=y<<n>>>32-m,32-n<m&&(B=z|=t[q+1]>>>64-n-m),B=r,f=0;f<m;f++)if(B=(A=z>>>m-f-1&1)?B.right:B.left,!B.left&&!B.right){F=B.val;n=n+f+1;break}32<=n&&(n-=32,q++,y=t[q]);F-=u;k?(F=0<D?F+x:0<G?F+C[I-l]:F+x,F&=255,x=C[I]=F):C[I]=F}else for(G=I=0;G<c;G++)for(D=0;D<l;D++,
I++){if(v[I]){F=0;B=z=y<<n>>>32-p;32-n<p&&(B=z|=t[q+1]>>>64-n-p);if(g[B])F=g[B][1],n+=g[B][0];else for(B=z=y<<n>>>32-m,32-n<m&&(B=z|=t[q+1]>>>64-n-m),B=r,f=0;f<m;f++)if(B=(A=z>>>m-f-1&1)?B.right:B.left,!B.left&&!B.right){F=B.val;n=n+f+1;break}32<=n&&(n-=32,q++,y=t[q]);F-=u;k?(F=0<D&&v[I-1]?F+x:0<G&&v[I-l]?F+C[I-l]:F+x,F&=255,x=C[I]=F):C[I]=F}}else for(G=I=0;G<c;G++)for(D=0;D<l;D++)if(I=G*l+D,!v||v[I])for(E=0;E<b;E++,I+=h){F=0;B=z=y<<n>>>32-p;32-n<p&&(B=z|=t[q+1]>>>64-n-p);if(g[B])F=g[B][1],n+=g[B][0];
else for(B=z=y<<n>>>32-m,32-n<m&&(B=z|=t[q+1]>>>64-n-m),B=r,f=0;f<m;f++)if(B=(A=z>>>m-f-1&1)?B.right:B.left,!B.left&&!B.right){F=B.val;n=n+f+1;break}32<=n&&(n-=32,q++,y=t[q]);F-=u;C[I]=F}a.ptr=a.ptr+4*(q+1)+(0<n?4:0);a.pixels.resultPixels=w;1<b&&!d&&(a.pixels.resultPixels=H.swapDimensionOrder(w,h,b,e))},decodeBits:function(g,a,e,d,b){var c=a.headerInfo,l=c.fileVersion,h=0,m=new DataView(g,a.ptr,5<=g.byteLength-a.ptr?5:g.byteLength-a.ptr),r=m.getUint8(0);h++;var t=r>>6,q=0===t?4:3-t,n=0<(r&32)?!0:
!1;t=r&31;r=0;if(1===q)r=m.getUint8(h),h++;else if(2===q)r=m.getUint16(h,!0),h+=2;else if(4===q)r=m.getUint32(h,!0),h+=4;else throw"Invalid valid pixel count type";q=2*c.maxZError;b=1<c.numDims?c.maxValues[b]:c.zMax;if(n){a.counter.lut++;n=m.getUint8(h);h++;c=Math.ceil((n-1)*t/8);var p=Math.ceil(c/4);p=new ArrayBuffer(4*p);var u=new Uint8Array(p);a.ptr+=h;u.set(new Uint8Array(g,a.ptr,c));h=new Uint32Array(p);a.ptr+=c;for(m=0;n-1>>>m;)m++;c=Math.ceil(r*m/8);p=Math.ceil(c/4);p=new ArrayBuffer(4*p);
u=new Uint8Array(p);u.set(new Uint8Array(g,a.ptr,c));g=new Uint32Array(p);a.ptr+=c;a=3<=l?P.unstuffLUT2(h,t,n-1,d,q,b):P.unstuffLUT(h,t,n-1,d,q,b);3<=l?P.unstuff2(g,e,m,r,a):P.unstuff(g,e,m,r,a)}else a.counter.bitstuffer++,m=t,a.ptr+=h,0<m&&(c=Math.ceil(r*m/8),p=Math.ceil(c/4),p=new ArrayBuffer(4*p),u=new Uint8Array(p),u.set(new Uint8Array(g,a.ptr,c)),g=new Uint32Array(p),a.ptr+=c,3<=l?null==d?P.originalUnstuff2(g,e,m,r):P.unstuff2(g,e,m,r,!1,d,q,b):null==d?P.originalUnstuff(g,e,m,r):P.unstuff(g,
e,m,r,!1,d,q,b))},readTiles:function(g,a,e,d){var b=a.headerInfo,c=b.width,l=b.height,h=c*l,m=b.microBlockSize,r=b.imageType,t=H.getDataTypeSize(r),q=Math.ceil(c/m),n=Math.ceil(l/m);a.pixels.numBlocksY=n;a.pixels.numBlocksX=q;var p=a.pixels.ptr=0,u=0,v=0,z=0,A=0,G=0,D=0,I=0,f=p=0,x=0,y=0,k=D=0;D=D=0;var w=new e(m*m);l=l%m||m;var C=c%m||m,E=b.numDims,F,B=a.pixels.resultMask,J=a.pixels.resultPixels,K=5<=b.fileVersion?14:15,M=b.zMax;for(v=0;v<n;v++)for(A=v!==n-1?m:l,z=0;z<q;z++)for(G=z!==q-1?m:C,x=v*
c*m+z*m,y=c-G,F=0;F<E;F++){1<E?(k=J,x=v*c*m+z*m,J=new e(a.pixels.resultPixels.buffer,h*F*t,h),M=b.maxValues[F]):k=null;D=g.byteLength-a.ptr;u=new DataView(g,a.ptr,Math.min(10,D));var O={};D=0;I=u.getUint8(0);D++;var N=5<=b.fileVersion?I&4:0;p=I>>6&255;f=I>>2&K;if(f!==(z*m>>3&K))throw"integrity issue";if(N&&0===F)throw"integrity issue";I&=3;if(3<I)throw a.ptr+=D,"Invalid block encoding ("+I+")";if(2===I){if(N)if(B)for(p=0;p<A;p++)for(u=0;u<G;u++)B[x]&&(J[x]=k[x]),x++;else for(p=0;p<A;p++)for(u=0;u<
G;u++)J[x]=k[x],x++;a.counter.constant++;a.ptr+=D}else if(0===I){if(N)throw"integrity issue";a.counter.uncompressed++;a.ptr+=D;D=A*G*t;k=g.byteLength-a.ptr;D=D<k?D:k;k=new ArrayBuffer(0===D%t?D:D+t-D%t);N=new Uint8Array(k);N.set(new Uint8Array(g,a.ptr,D));k=new e(k);D=0;if(B)for(p=0;p<A;p++){for(u=0;u<G;u++)B[x]&&(J[x]=k[D++]),x++;x+=y}else for(p=0;p<A;p++){for(u=0;u<G;u++)J[x++]=k[D++];x+=y}a.ptr+=D*t}else if(p=H.getDataTypeUsed(N&&6>r?4:r,p),O=H.getOnePixel(O,D,p,u),D+=H.getDataTypeSize(p),3===
I)if(a.ptr+=D,a.counter.constantoffset++,B)for(p=0;p<A;p++){for(u=0;u<G;u++)B[x]&&(J[x]=N?Math.min(M,k[x]+O):O),x++;x+=y}else for(p=0;p<A;p++){for(u=0;u<G;u++)J[x]=N?Math.min(M,k[x]+O):O,x++;x+=y}else if(a.ptr+=D,H.decodeBits(g,a,w,O,F),D=0,N)if(B)for(p=0;p<A;p++){for(u=0;u<G;u++)B[x]&&(J[x]=w[D++]+k[x]),x++;x+=y}else for(p=0;p<A;p++){for(u=0;u<G;u++)J[x]=w[D++]+k[x],x++;x+=y}else if(B)for(p=0;p<A;p++){for(u=0;u<G;u++)B[x]&&(J[x]=w[D++]),x++;x+=y}else for(p=0;p<A;p++){for(u=0;u<G;u++)J[x++]=w[D++];
x+=y}}1<E&&!d&&(a.pixels.resultPixels=H.swapDimensionOrder(a.pixels.resultPixels,h,E,e))},formatFileInfo:function(g){return{fileIdentifierString:g.headerInfo.fileIdentifierString,fileVersion:g.headerInfo.fileVersion,imageType:g.headerInfo.imageType,height:g.headerInfo.height,width:g.headerInfo.width,numValidPixel:g.headerInfo.numValidPixel,microBlockSize:g.headerInfo.microBlockSize,blobSize:g.headerInfo.blobSize,maxZError:g.headerInfo.maxZError,pixelType:H.getPixelType(g.headerInfo.imageType),eofOffset:g.eofOffset,
mask:g.mask?{numBytes:g.mask.numBytes}:null,pixels:{numBlocksX:g.pixels.numBlocksX,numBlocksY:g.pixels.numBlocksY,maxValue:g.headerInfo.zMax,minValue:g.headerInfo.zMin,noDataValue:g.noDataValue}}},constructConstantSurface:function(g,a){var e=g.headerInfo.zMax,d=g.headerInfo.zMin,b=g.headerInfo.maxValues,c=g.headerInfo.numDims,l=g.headerInfo.height*g.headerInfo.width,h=0,m=0,r=0,t=g.pixels.resultMask;g=g.pixels.resultPixels;if(t)if(1<c)if(a)for(h=0;h<c;h++)for(r=h*l,e=b[h],m=0;m<l;m++)t[m]&&(g[r+m]=
e);else for(m=0;m<l;m++){if(t[m])for(r=m*c,h=0;h<c;h++)g[r+c]=b[h]}else for(m=0;m<l;m++)t[m]&&(g[m]=e);else if(1<c&&d!==e)if(a)for(h=0;h<c;h++)for(r=h*l,e=b[h],m=0;m<l;m++)g[r+m]=e;else for(m=0;m<l;m++)for(r=m*c,h=0;h<c;h++)g[r+h]=b[h];else for(m=0;m<l*c;m++)g[m]=e},getDataTypeArray:function(g){switch(g){case 0:g=Int8Array;break;case 1:g=Uint8Array;break;case 2:g=Int16Array;break;case 3:g=Uint16Array;break;case 4:g=Int32Array;break;case 5:g=Uint32Array;break;case 6:g=Float32Array;break;case 7:g=Float64Array;
break;default:g=Float32Array}return g},getPixelType:function(g){switch(g){case 0:g="S8";break;case 1:g="U8";break;case 2:g="S16";break;case 3:g="U16";break;case 4:g="S32";break;case 5:g="U32";break;case 6:g="F32";break;case 7:g="F64";break;default:g="F32"}return g},isValidPixelValue:function(g,a){if(null==a)return!1;switch(g){case 0:g=-128<=a&&127>=a;break;case 1:g=0<=a&&255>=a;break;case 2:g=-32768<=a&&32767>=a;break;case 3:g=0<=a&&65536>=a;break;case 4:g=-2147483648<=a&&2147483647>=a;break;case 5:g=
0<=a&&4294967296>=a;break;case 6:g=-3.4027999387901484E38<=a&&3.4027999387901484E38>=a;break;case 7:g=4.9E-324<=a&&1.7976931348623157E308>=a;break;default:g=!1}return g},getDataTypeSize:function(g){var a=0;switch(g){case 0:case 1:a=1;break;case 2:case 3:a=2;break;case 4:case 5:case 6:a=4;break;case 7:a=8;break;default:a=g}return a},getDataTypeUsed:function(g,a){var e=g;switch(g){case 2:case 4:e=g-a;break;case 3:case 5:e=g-2*a;break;case 6:e=0===a?g:1===a?2:1;break;case 7:e=0===a?g:g-2*a+1;break;default:e=
g}return e},getOnePixel:function(g,a,e,d){g=0;switch(e){case 0:g=d.getInt8(a);break;case 1:g=d.getUint8(a);break;case 2:g=d.getInt16(a,!0);break;case 3:g=d.getUint16(a,!0);break;case 4:g=d.getInt32(a,!0);break;case 5:g=d.getUInt32(a,!0);break;case 6:g=d.getFloat32(a,!0);break;case 7:g=d.getFloat64(a,!0);break;default:throw"the decoder does not understand this pixel type";}return g},swapDimensionOrder:function(g,a,e,d,b){var c=0,l=0,h=0,m=0,r=g;if(1<e)if(r=new d(a*e),b)for(c=0;c<a;c++)for(m=c,h=0;h<
e;h++,m+=a)r[m]=g[l++];else for(c=0;c<a;c++)for(m=c,h=0;h<e;h++,m+=a)r[l++]=g[m];return r}},L=function(g,a,e){this.val=g;this.left=a;this.right=e};return{decode:function(g,a){a=a||{};var e=a.noDataValue,d=0,b={};b.ptr=a.inputOffset||0;b.pixels={};if(H.readHeaderInfo(g,b)){d=b.headerInfo;var c=d.fileVersion,l=H.getDataTypeArray(d.imageType);if(5<c)throw"unsupported lerc version 2."+c;H.readMask(g,b);d.numValidPixel===d.width*d.height||b.pixels.resultMask||(b.pixels.resultMask=a.maskData);var h=d.width*
d.height;b.pixels.resultPixels=new l(h*d.numDims);b.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var m=!a.returnPixelInterleavedDims;if(0!==d.numValidPixel)if(d.zMax===d.zMin)H.constructConstantSurface(b,m);else if(4<=c&&H.checkMinMaxRanges(g,b))H.constructConstantSurface(b,m);else{var r=new DataView(g,b.ptr,2),t=r.getUint8(0);b.ptr++;if(t)H.readDataOneSweep(g,b,l,m);else if(1<c&&1>=d.imageType&&1E-5>Math.abs(d.maxZError-.5)){r=r.getUint8(1);b.ptr++;b.encodeMode=
r;if(2<r||4>c&&1<r)throw"Invalid Huffman flag "+r;r?H.readHuffman(g,b,l,m):H.readTiles(g,b,l,m)}else H.readTiles(g,b,l,m)}b.eofOffset=b.ptr;a.inputOffset?(g=b.headerInfo.blobSize+a.inputOffset-b.ptr,1<=Math.abs(g)&&(b.eofOffset=a.inputOffset+b.headerInfo.blobSize)):(g=b.headerInfo.blobSize-b.ptr,1<=Math.abs(g)&&(b.eofOffset=b.headerInfo.blobSize));g={width:d.width,height:d.height,pixelData:b.pixels.resultPixels,minValue:d.zMin,maxValue:d.zMax,validPixelCount:d.numValidPixel,dimCount:d.numDims,dimStats:{minValues:d.minValues,
maxValues:d.maxValues},maskData:b.pixels.resultMask};if(b.pixels.resultMask&&H.isValidPixelValue(d.imageType,e)){c=b.pixels.resultMask;for(d=0;d<h;d++)c[d]||(g.pixelData[d]=e);g.noDataValue=e}b.noDataValue=e;a.returnFileInfo&&(g.fileInfo=H.formatFileInfo(b));return g}},getBandCount:function(g){for(var a=0,e=0,d={ptr:0,pixels:{}};e<g.byteLength-58;)H.readHeaderInfo(g,d),e+=d.headerInfo.blobSize,a++,d.ptr=e;return a}}})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare",
"dojo/Deferred","dojo/sniff"],function(P,H,L,g){var a;return H(null,{constructor:function(e){this.ctx=e.ctx;this._loadRasterFormatModule()},decode:function(e,d){if(!d.width||!d.height)throw"Native decoding requires the image format, width and height";var b=new L,c,l=new Uint8Array(e);e=this._getFormat(e);if("error"===e)throw"invalid format";"jpeg"===e&&(c=this._getMask(l,d));var h="",m;for(m=0;m<l.length;m+=65535){var r=l.subarray(m,m+65535>l.length-1?l.length-1:m+65535);h+=String.fromCharCode.apply(null,
r)}l="data:image/"+e+";base64,"+window.btoa(h);var t=new Image,q;t.src=l;var n=this;t.onload=function(){n.ctx.clearRect(0,0,d.width,d.height);n.ctx.drawImage(t,0,0);var p=n.ctx.getImageData(0,0,t.width,t.height);q=p.data;if(c)for(m=0;m<c.length;m++)q[4*m+3]=c[m]?255:0;n.ctx.putImageData(p,0,0);b.resolve(null)};t.onerror=function(){b.reject("cannot load image")};return b},_getFormat:function(e){e=new Uint8Array(e,0,10);var d="error";255===e[0]&&216===e[1]?d="jpeg":137===e[0]&&80===e[1]&&78===e[2]&&
71===e[3]&&(d="png");return d},_getMask:function(e,d){try{if(!a)throw"The zlib decoder module is not loaded.";var b=0,c=0,l=Math.round(e.length/2);1===l%2&&(l+=1);var h=e.length-2;for(b=l;b<h&&(255!==e[b]||217!==e[b+1]);b++);l=b+=2;if(l<e.length-1){var m=(new a(e.subarray(l))).getBytes();var r=new Uint8Array(d.width*d.height);for(b=e=0;b<m.length;b++)for(c=7;0<=c;c--)r[e++]=m[b]>>c&1}}catch(t){}return r},_loadRasterFormatModule:function(){10>g("ie")||P(["./Zlib"],function(e){a=e})}})})},"esri/layers/pixelFilters/StretchFilter":function(){define(["dojo/_base/declare",
"dojo/_base/lang","../PixelBlock"],function(P,H,L){var g;return P(null,{stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,raster:null,outputPixelType:"U8",computeGamma:!1,constructor:function(a){this.stretchType=a.stretchType||a.StretchType||this.stretchType;this.min=a.min||a.Min||this.min;this.max=a.max||a.Max||this.max;this.numberOfStandardDeviations=a.numberOfStandardDeviations||a.NumberOfStandardDeviations||
this.numberOfStandardDeviations;this.statistics=a.statistics||a.Statistics||this.statistics;this.dra=a.dra||a.DRA||a.dRA||this.dra;this.minPercent=a.minPercent||a.MinPercent||this.minPercent;this.maxPercent=a.maxPercent||a.MaxPercent||this.maxPercent;this.useGamma=a.useGamma||a.UseGamma||this.useGamma;this.gamma=a.gamma||a.Gamma||this.gamma;this.computeGamma=a.computeGamma||a.ComputeGamma||this.computeGamma;this.raster=a.raster||a.Raster||this.raster;this.outputPixelType=a.outputPixelType||a.OutputPixelType||
this.outputPixelType;this.raster=a.raster||a.Raster||this.raster;g=this},filter:function(a){if(void 0!==a&&null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var e=a.pixelBlock,d=e.pixels,b=e.width*e.height,c=d.length,l;(l=6===g.stretchType||3===g.stretchType&&g.dra)&&g._calculateStatisticsHistograms(a);if(g.dra)if(l)g._statistics=e.statistics,g._histograms=e.histograms;else{var h=e.statistics;g._statistics=[];for(l=0;l<c;l++)g._statistics[l]=[h[l].minValue,h[l].maxValue,0,0]}else g._statistics=
g.statistics,g._histograms=g.histograms;g.computeGamma&&(g.gamma=g._computeGammaValues(e.pixelType),g.useGamma=!0);g._createLUT(a);if(void 0===g.LUT||null===g.LUT)return g._filterNoLUT(a);h=g.LUT;var m=g.LUTOffset;for(l=0;l<c;l++){var r=h[l];for(e=0;e<b;e++){var t=d[l][e];d[l][e]=r[t-m]}}a.pixelBlock.pixelType="U8";return a}},_calculateStatisticsHistograms:function(a){a=a.pixelBlock;var e=a.pixelType,d=a.pixels,b=a.mask,c=d.length,l,h,m=function(G){this.min=-.5;this.max=255.5;this.size=256;H.mixin(this,
G);this.counts=this.counts||new Uint32Array(this.size)},r=[],t,q;for(l=0;l<c;l++){var n=new m;var p=n.counts;var u=d[l];if("U8"===e)if(b)for(h=0;h<a.width*a.height;h++)b[h]&&p[u[h]]++;else for(h=0;h<a.width*a.height;h++)p[u[h]]++;else{var v=a.statistics[l].minValue;var z=a.statistics[l].maxValue;n.min=v;n.max=z;z=(z-v)/256;var A=new Uint32Array(257);if(b)for(h=0;h<a.width*a.height;h++)b[h]&&A[Math.floor((u[h]-v)/z)]++;else for(h=0;h<a.width*a.height;h++)A[Math.floor((u[h]-v)/z)]++;for(h=0;255>h;h++)p[h]=
A[h];p[255]=A[255]+A[256]}r.push(n);u=[];v=a.statistics[l].minValue;z=a.statistics[l].maxValue;for(h=q=t=A=0;h<n.size;h++)A+=p[h],t+=h*p[h];t/=A;for(h=0;h<n.size;h++)q+=p[h]*Math.pow(h-t,2);p=Math.sqrt(q/(A-1));h=(t+.5)*(n.max-n.min)/n.size+n.min;n=p*(n.max-n.min)/n.size;u.push(v);u.push(z);u.push(h);u.push(n);a.statistics[l]=u}a.histograms=r},_getCutOffPoints:function(a){a=a.pixelBlock.pixels.length;var e=[],d=[],b,c,l;switch(g.stretchType){case 5:for(c=0;c<a;c++)e[c]=g._statistics[c][0],d[c]=g._statistics[c][1];
break;case 3:for(c=0;c<a;c++)e[c]=g._statistics[c][2]-g.numberOfStandardDeviations*g._statistics[c][3],d[c]=g._statistics[c][2]+g.numberOfStandardDeviations*g._statistics[c][3],e[c]<g._statistics[c][0]&&(e[c]=g._statistics[c][0]),d[c]>g._statistics[c][1]&&(d[c]=g._statistics[c][1]);break;case 6:for(c=0;c<a;c++){var h=g._histograms[c];var m=new Uint32Array(h.size);var r=h.counts;for(l=b=0;l<h.size;l++)b+=r[l],m[l]=b;r=g.minPercent*b/100;for(l=1;l<h.size;l++)if(m[l]>r){e[c]=h.min+(h.max-h.min)/h.size*
(l-.5);break}r=(1-g.maxPercent/100)*b;for(l=h.size-2;0<=l;l--)if(m[l]<r){d[c]=h.min+(h.max-h.min)/h.size*(l+.5);break}}break;default:for(c=0;c<a;c++)e[c]=0,d[c]=255}return{minCutOff:e,maxCutOff:d}},_createLUT:function(a){var e=a.pixelBlock,d=e.pixelType;if("U8"===d||"U16"===d||"S8"===d||"S16"===d){if(g._LUTSignature&&(d=g._computeLutSignature(),d.length===g._LUTSignature.length&&!d.some(function(D,I){return D!==g._LUTSignature[I]})))return;d=e.pixels.length;var b=[],c=[],l=[],h,m=g.max,r=g.min,t=
g.gamma,q=m-r,n=g._getCutOffPoints(a);a=n.minCutOff;n=n.maxCutOff;var p=0,u=256;"S8"===e.pixelType?p=-127:"S16"===e.pixelType&&(p=-32767);if("U16"===e.pixelType||"S16"===e.pixelType)u=65536;for(e=0;e<d;e++)b[e]=n[e]-a[e];if(g.useGamma&&null!==t&&t.length===d)for(e=0;e<d;e++)l[e]=1<t[e]?2<t[e]?6.5+Math.pow(t[e]-2,2.5):6.5+100*Math.pow(2-t[e],4):1;if(g.useGamma)for(e=0;e<d;e++){var v=[];for(h=0;h<u;h++){var z=h+p;var A=(z-a[e])/b[e];var G=1;1<t[e]&&(G-=Math.pow(1/q,A*l[e]));z<n[e]&&z>a[e]?v[h]=Math.floor(G*
q*Math.pow(A,1/t[e]))+r:z>n[e]?v[h]=m:z<a[e]&&(v[h]=r)}c[e]=v}else for(e=0;e<d;e++){v=[];for(h=0;h<u;h++)z=h+p,v[h]=z<a[e]?r:z>n[e]?m:Math.floor((z-a[e])/b[e]*q)+r;c[e]=v}g.LUT=c;g.LUTOffset=p;g._LUTSignature=g._computeLutSignature()}},_computeLutSignature:function(){var a=[],e,d;a.push(g.stretchType);a.push(g.min);a.push(g.max);a.push(g.numberOfStandardDeviations);if(g._statistics)for(e=0;e<g._statistics.length;e++)for(d=0;d<g._statistics[e].length;d++)a.push(g._statistics[e][d]);a.push(g.dra?1:
0);a.push(g.minPercent);a.push(g.maxPercent);if(g.gamma)for(e=0;e<g._statistics.length;e++)a.push(g.gamma[e]);a.push(g.useGamma?1:0);return a},_filterNoLUT:function(a){if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){var e=a.pixelBlock,d=e.pixels,b=e.mask;e=e.width*e.height;var c=d.length,l=[],h=[],m,r=g.max,t=g.min,q=g.gamma,n=r-t;var p=g._getCutOffPoints(a);var u=p.minCutOff,v=p.maxCutOff;for(p=0;p<c;p++)l[p]=v[p]-u[p];if(g.useGamma&&null!==q&&q.length===c)for(p=0;p<c;p++)h[p]=1<q[p]?
2<q[p]?6.5+Math.pow(q[p]-2,2.5):6.5+100*Math.pow(2-q[p],4):1;if(g.useGamma)if(void 0!==b&&null!==b)for(m=0;m<e;m++){if(b[m])for(p=0;p<c;p++){var z=d[p][m];var A=(z-u[p])/l[p];var G=1;1<q[p]&&(G-=Math.pow(1/n,A*h[p]));z<v[p]&&z>u[p]?d[p][m]=Math.floor(G*n*Math.pow(A,1/q[p]))+t:z>v[p]?d[p][m]=r:z<u[p]&&(d[p][m]=t)}}else for(m=0;m<e;m++)for(p=0;p<c;p++)z=d[p][m],A=(z-u[p])/l[p],G=1,1<q[p]&&(G-=Math.pow(1/n,A*h[p])),z<v[p]&&z>u[p]?d[p][m]=Math.floor(G*n*Math.pow(A,1/q[p]))+t:z>v[p]?d[p][m]=r:z<u[p]&&
(d[p][m]=t);else if(void 0!==b&&null!==b)for(m=0;m<e;m++){if(b[m])for(p=0;p<c;p++)z=d[p][m],z<v[p]&&z>u[p]?d[p][m]=Math.floor((z-u[p])/l[p]*n)+t:z>v[p]?d[p][m]=r:z<u[p]&&(d[p][m]=t)}else for(m=0;m<e;m++)for(p=0;p<c;p++)z=d[p][m],z<v[p]&&z>u[p]?d[p][m]=Math.floor((z-u[p])/l[p]*n)+t:z>v[p]?d[p][m]=r:z<u[p]&&(d[p][m]=t);a.pixelBlock.pixelType="U8";return a}},_computeGammaValues:function(a){var e=this._statistics.length,d,b=[];for(d=0;d<e;d++){var c=this._statistics[d][2];"U8"!==a&&(c=255*(c-this._statistics[d][0])/
(this._statistics[d][1]-this._statistics[d][0]));b.push(this._computeGammaValue(c))}return b},_computeGammaValue:function(a){if(0!==a&&!(255<a||0>a)){var e=0;0<a&&150!=a&&255>a&&(e=150>=a?45*Math.cos(.01047*a):17*Math.sin(.021*a));e=Math.log((a+e)/255);if(0!==e&&(a=Math.log(a/255)/e,!isNaN(a)))return Math.min(9.9,Math.max(.01,a))}}})})},"*noref":1}});
define("esri/layers/WCSLayer","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/Deferred dojo/when dojo/io-query dojo/has ../kernel ../request ../deferredUtils ./BaseRasterLayer ./WCSConnection ./Raster ./rasterFormats/ImageCanvasDecoder ./pixelFilters/StretchFilter ../geometry/Extent ../geometry ../graphic ../SpatialReference".split(" "),function(P,H,L,g,a,e,d,b,c,l,h,m,r,t,q,n,p,u,v){var z=function(f,x){return-1<x.toLowerCase().indexOf("ole")?(new Date(864E5*(f-25569))).toISOString():
f},A=function(f,x){var y;for(y=0;y<f.length;y++)if(x(f[y]))return y;return-1},G=function(f,x){var y;for(y=0;y<f.length;y++)if(x(f[y]))return f[y]},D=function(f,x,y){var k;if(y)for(k=0;k<f.length;k++){if(f[k][y].toLowerCase()===x.toLowerCase())return f[k]}else for(k=0;k<f.length;k++)if(f[k].toLowerCase()===x.toLowerCase())return f[k]},I={parse:function(f){var x={isMultiPart:!0,data:null},y=this._getMultiPartHeader(f);y?(x.isMultiPart=!0,x.data=this._getParts(f.data,y)):(x.isMultiPart=!1,x.data=f.data);
return x},_getParts:function(f,x){var y=0,k=0,w=y=0,C=[],E=[],F=[],B=[];var J="--"+x.boundary;var K="--"+x.boundary+"\n",M="\n--"+x.boundary+"--",O=[10],N=[13,10];for(y=0;y<J.length;y++)E.push(J.charCodeAt(y));for(y=0;y<K.length;y++)F.push(K.charCodeAt(y));for(y=0;y<M.length;y++)B.push(M.charCodeAt(y));F=J.length;f=new Uint8Array(f);J=Math.min(1E4,f.length);for(y=0;y<J;y++)f[y]===E[w]?w===F-1?(w=0,k&&C.push(this._parsePart(f.subarray(k,y+1-F),x)),f[y+1]===O[0]?y+=1:f[y+1]===N[0]&&f[y+2]===N[1]&&(y+=
2),k=y+1):w++:w=0;for(y=f.length-B.length-2;y<f.length;y++)if(f[y]===B[w])if(w===B.length-1){w=0;y=y-B.length+1;C.push(this._parsePart(f.subarray(k,y),x));break}else w++;else w=0;return C},_getMultiPartHeader:function(f){var x=f.getHeader("Content-Type").split(";");if("multipart/related"===x[0]||"multipart/mixed"===x[0]){var y={boundary:"",start:"",type:""};for(f=1;f<x.length;f++){var k=x[f].split("\x3d");y[k[0].trim()]=k[1].trim().slice(1,k[1].length-1)}}return y},_parsePart:function(f,x){var y=
String.fromCharCode.apply(null,f.subarray(0,Math.min(300,f.length))).split("\n"),k=0,w=0,C=Math.min(y.length,7);var E={contentType:null,contentDescription:null,contentTransferEncoding:null,contentID:null,contentDisposition:null,contentData:null,contentLocation:null};for(k=0;k<C;k++)if(4>y[k].length)w=w+y[k].length+1;else if("content"===y[k].slice(0,7).toLowerCase()){if(w=w+y[k].length+1,-1!==y[k].indexOf(":")){var F=y[k].substring(0,y[k].indexOf(":")).trim();var B=y[k].substring(y[k].indexOf(":")+
1).trim();if(F)switch(F.toLowerCase()){case "content-type":E.contentType=B;break;case "content-description":E.contentDescription=B;break;case "content-transfer-encoding":E.contentTransferEncoding=B;break;case "content-id":E.contentID=B;break;case "content-disposition":E.contentDisposition=B;break;case "content-location":E.contentLocation=B}}}else if(E.contentDisposition&&4<=y[k].length&&-1<E.contentType.toLowerCase().indexOf("image")){x=new ArrayBuffer(f.length-w);y=new Uint8Array(x);y.set(f.subarray(w,
f.length));E.contentData=x;break}else if((""===x.start||E.contentID===x.start)&&E.contentType)if(-1<E.contentType.indexOf("text")){E.contentData=String.fromCharCode.apply(null,f.subarray(w,f.length));break}else E.contentData=f.subarray(w,f.length);return E}};h=P([h],{declaredClass:"esri.layers.WCSLayer",format:null,interpolation:null,bandIds:null,optionalParameters:null,multidimensionalDefinition:null,projectedFullExtent:null,wcsConnection:null,version:null,coverageId:null,coverageDescription:null,
extent:null,timeInfo:null,pixelType:null,_projectedResolution:null,_WEB_MERCATOR:[102100,3857,102113,900913],_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,
3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],_pivotServerGridOrigin110:!1,constructor:function(f,x){this._pixelValueReadPromise=this._rasterReadPromise=null},_initialize:function(f,x){this._params={};P.safeMixin(this,x);this.optionalParameters=this.optionalParameters||
{};this.bandIds=this.bandIds||null;f=this.url.indexOf("?");-1<f&&f<=this.url.length-1&&(this.optionalParameters=H.mixin(this.optionalParameters,e.queryToObject(this.url.substring(f+1,this.url.length))),this.url=this.url.substring(0,f));this.activeMapDimensions=x&&x.activeMapDimensions;this.useMapDimensionValue=x&&x.hasOwnProperty("useMapDimensionValue")?!!x.useMapDimensionValue:!0;this.coverageId=this.coverageId||this.coverage||this.identifiers||this.optionalParameters.coverage||this.optionalParameters.coverageId||
this.optionalParameters.identifiers;x=H.mixin({},{version:this.version,token:this.token,coverageId:this.coverageId},this.optionalParameters);x=this.wcsConnection||(new m(this.url,x))._connectPromise;a(x,H.hitch(this,this._initialized),this._errorHandler)},_initialized:function(f){var x;this.wcsConnection=f;this.version=this.version||f.version;this.coverageId=this.coverageId||f.coverages[0].id;var y=D(f.coverages,this.coverageId,"id");this.coverageDescription=y;this.coverageDescription.supportedInterpolations=
this.coverageDescription.supportedInterpolations||f.supportedInterpolations;this.extent=this.extent||y.extent;this.timeInfo=y.timeInfo;!this.bandIds&&this.coverageDescription.bandInfo&&(this.bandIds=Object.keys(this.coverageDescription.bandInfo).map(function(k){return parseInt(k,10)}));if((void 0===this.format||null===this.format||""===this.format||"tiff"===this.format)&&y.supportedFormats)for(x=0;x<y.supportedFormats.length;x++)if(-1<y.supportedFormats[x].toLowerCase().indexOf("tiff")){this.format=
y.supportedFormats[x];break}this.format=this.format||"image/tiff";this._findCredential();(this.credential&&this.credential.ssl||f&&f._ssl)&&this._useSSL();this._params.token=this._getToken();this.loaded=!0;this.onLoad(this);if(f=this._loadCallback)delete this._loadCallback,f(this)},onRasterReadComplete:function(){},setInfoTemplate:function(f){this.infoTemplate=f},identify:function(f){var x=new g;this._identifyPixelValue(f).then(H.hitch(this,function(y){var k=[];if((this.infoTemplate&&this.infoTemplate.info&&
this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?this.infoTemplate.info.layerOptions.showNoDataRecords:1)||"NoData"!==y.value){var w=new u;w.setInfoTemplate(this.infoTemplate);w._layer=this;w.geometry=this.projectedFullExtent;w.attributes={ObjectId:0,"Raster.ServicePixelValue":y.pixelValues.map(function(C){return C.toString()})};k.push(w)}x.resolve(k)}),H.hitch(this,function(y){x.reject(y)}));return x.promise},getMultidimensionalInfo:function(){var f=
new g;this.coverageDescription&&this.coverageDescription.multidimensionalInfo?f.resolve(this.coverageDescription.multidimensionalInfo):f.reject("no mdInfo found");return f},setUseMapTime:function(f,x){this.useMapTime=f;this._toggleTime();!x&&this._map&&this.refresh(!0)},setMultidimensionalDefinition:function(f,x){this.multidimensionalDefinition=f;!x&&this._map&&this.refresh(!0)},_setMap:function(f,x){f.extent?(this.projectedFullExtent=(this.projectedFullExtent=this.projectedFullExtent||this._convertExtentToMap(this.coverageDescription.lonLatEnvelope,
f.extent.spatialReference,1E-4))||this._convertExtentToMap(this.coverageDescription.extent,f.extent.spatialReference,1E-4),this._projectedResolution=this._projectedResolution||{x:(this.projectedFullExtent.xmax-this.projectedFullExtent.xmin)/this.coverageDescription.columns,y:(this.projectedFullExtent.ymax-this.projectedFullExtent.ymin)/this.coverageDescription.rows}):this.projectedFullExtent=this.projectedFullExtent||this.coverageDescription.extent;return this.inherited(arguments)},_convertExtentToNative:function(f){if(!f)return null;
var x=null,y=this.coverageDescription.lonLatEnvelope.spatialReference.wkid,k=f.spatialReference.wkid;y===k||-1<this._WEB_MERCATOR.indexOf(y)&&-1<this._WEB_MERCATOR.indexOf(k)?x=f:4326===y&&-1<this._WEB_MERCATOR.indexOf(k)?x=p.webMercatorUtils.webMercatorToGeographic(f):4326===k&&-1<this._WEB_MERCATOR.indexOf(y)&&(x=p.webMercatorUtils.geographicToWebMercator(f));return x},_convertExtentToMap:function(f,x,y){if(!f)return null;var k=null;x=x?x.wkid:this._map.extent.spatialReference.wkid;var w=f.spatialReference.wkid;
x===w||-1<this._WEB_MERCATOR.indexOf(x)&&-1<this._WEB_MERCATOR.indexOf(w)?k=f:4326===x&&-1<this._WEB_MERCATOR.indexOf(w)?k=p.webMercatorUtils.webMercatorToGeographic(f):4326===w&&-1<this._WEB_MERCATOR.indexOf(x)&&(k=p.webMercatorUtils.geographicToWebMercator(f));k&&k.spatialReference.wkid&&-1<this._WEB_MERCATOR.indexOf(k.spatialReference.wkid)&&(k.spatialReference.wkid=3857);if(y&&k&&k.spatialReference.wkid)if(3857===k.spatialReference.wkid)k.xmin+=y,k.ymin+=y,k.xmax-=y,k.ymax-=y;else if(4326===k.spatialReference.wkid||
180>=Math.abs(k.xmin)&&180>=Math.abs(k.xmax))f=1/111111,k.xmin+=y*f,k.ymin+=y*f,k.xmax-=y*f,k.ymax-=y*f;return k},_constructGetCoverageParams:function(f,x,y,k,w){var C=this.projectedFullExtent;if((new v(C.spatialReference)).equals(new v(f.spatialReference))&&(f.xmax<=C.xmin||f.xmin>=C.xmax||f.ymax<=C.ymin||f.ymin>=C.ymax))return null;var E=new n(f);E.xmin=Math.max(E.xmin,C.xmin);E.xmax=Math.min(E.xmax,C.xmax);E.ymin=Math.max(E.ymin,C.ymin);E.ymax=Math.min(E.ymax,C.ymax);C=w?f.spatialReference.wkid:
C.spatialReference.wkid;w=this._params;H.mixin(w,{extent:E,width:Math.round((E.xmax-E.xmin)/(f.xmax-f.xmin)*x),height:Math.round((E.ymax-E.ymin)/(f.ymax-f.ymin)*y),crs:"EPSG:"+C,epsgNSCRS:"urn:ogc:def:crs:EPSG::"+C,coverageId:this.coverageId,format:this.format,interpolation:this.interpolation});k&&H.mixin(w,k);w.multidimensionalDefinition||(w.multidimensionalDefinition=this.multidimensionalDefinition);w.interpolation||(this.interpolation?w.interpolation=this.interpolation:this.coverageDescription.supportedInterpolations&&
0<this.coverageDescription.supportedInterpolations.length&&(w.interpolation=this.coverageDescription.supportedInterpolations[0]));f=["nearest neighbor","bilinear","bicubic"];x=["nearest","linear","cubic"];y=["nearest-neighbor","linear","cubic"];if(0===w.interpolation||1===w.interpolation||2===w.interpolation)"1.0.0"===this.version?w.interpolation=f[w.interpolation]:"1.1.0"===this.version||"1.1.1"===this.version||"1.1.2"===this.version?w.interpolation=x[w.interpolation]:"2.0.1"===this.version&&(w.interpolation=
"http://www.opengis.net/def/interpolation/OGC/1/"+y[w.interpolation]);this.bandIds&&(w.bandIds=this.bandIds.map(H.hitch(this,function(F){return this.coverageDescription.bandInfo[F]})));!w.time&&this.coverageDescription.timeInfo&&"2.0.1"!==this.version&&(w.time=this.coverageDescription.timeInfo.timeExtent.endTime.toISOString());return w},_requestData:function(f,x,y){this._rasterReadPromise&&this._rasterReadPromise.cancel();if(0<["1.1.0","1.1.1","1.1.2"].indexOf(this.version)&&void 0===this.supports4ValueOffset){var k=
this.coverageDescription.extent.getCenter(),w=2*Math.abs(this.coverageDescription.resolution.x),C=2*Math.abs(this.coverageDescription.resolution.y);k=new n(k.x-w,k.y-C,k.x+w,k.y+C,k.spatialReference);k=k.expand(10);var E=this._constructGetCoverageParams(k,20,20,{},!0);this._getDecodedData(E).then(H.hitch(this,function(F){this.supports4ValueOffset=2===Math.round((E.extent.xmax-E.extent.xmin)/E.width/((F.extent.xmax-F.extent.xmin)/F.pixelBlock.width))?!0:!1;this._requestData(f,x,y)}))}else(E=this._constructGetCoverageParams(f,
x,y))?this._getDecodedData(E).then(H.hitch(this,function(F){this._requestDataHandler(F)})):this.clear()},_getDecodedData:function(f){var x=this,y=new r("");this._requestExtent=f.extent;if(this._useBrowserDecoding()){var k=new t({ctx:this._context});var w=H.hitch(k,"decode")}var C=new g(l._dfdCanceller);C._pendingDfd=this._getCoverage(f);var E,F,B,J=this._requestExtent;this._rasterReadPromise=C.promise;return C._pendingDfd.then(function(K){K=I.parse(K);if("1.0.0"===x.version)K=K.data;else if(K.isMultiPart)B=
A(K.data,function(M){return null!=M.contentType&&-1<M.contentType.toLowerCase().indexOf("image")}),B=-1===B?K.data.length-1:B,K=K.data[B].contentData;else{F=Error("not a valid multipart coverage response");x._resolve([F],null,H.hitch(x,x._requestDataErrorHandler),C,!0);return}return y.decode(K,{width:f.width,height:f.height,planes:null,pixelType:"UNKNOWN",decodeFunc:w}).then(function(M){x.pixelType=x.pixelType||M.pixelType;if(!x.pixelFilter){var O=x._getDefaultFilter();x.pixelFilter=O.filter;x._pixelFilterArgs=
O}return E={pixelBlock:M,extent:J}},function(M){x._resolve([M],null,H.hitch(x,x._requestDataErrorHandler),C,!0)})},function(K){x._resolve([K],null,H.hitch(x,x._requestDataErrorHandler),C,!0)})},_requestDataHandler:function(f){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this.originalPixelData=f,this.hasDataChanged=!0,this._setPixelData(f))},_setPixelData:function(f){f=this._clonePixelData(f);this.pixelFilter&&this.pixelFilter(f);this.pixelData=f;this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||
(this._drawPixelData(),this._rasterReadPromise=null)},_useBrowserDecoding:function(){var f=this._requestExtent,x=this._map.width,y=this._map.height,k=this.getCurrentResolution();return Math.round((f.xmax-f.xmin)/k.x)===x&&Math.round((f.ymax-f.ymin)/k.y)===y&&(void 0===this.pixelFilter||null===this.pixelFilter)&&("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},_clonePixelData:function(f){if(null===f||void 0===f)return f;var x={};
f.extent&&(x.extent=H.clone(f.extent));f=f.pixelBlock;if(null===f||void 0===f)return x;x.pixelBlock=f.clone();return x},_resolve:function(f,x,y,k,w){x&&this[x].apply(this,f);y&&y.apply(null,f);k&&l._resDfd(k,f,w)},_getDefaultFilter:function(){var f=0;"U8"!==this.pixelType&&(f=6);return new q({stretchType:f,min:0,max:255,dRA:!0,minPercent:.2,maxPercent:.2,useGamma:!1})},_getCoverage:function(f){var x=this.version,y=this.coverageDescription,k,w=function(J){return(new Date(J)).toISOString()},C=H.hitch(this,
function(){k={request:"GetCoverage",service:"WCS",version:x,coverage:f.coverageId,format:f.format||"GEOTIFF",crs:f.crs,bbox:f.extent.xmin+","+f.extent.ymin+","+f.extent.xmax+","+f.extent.ymax,width:f.width,height:f.height,time:f.time,interpolation:f.interpolation,band:f.bandIds?f.bandIds.join(","):null}}),E=H.hitch(this,function(){var J=this.coverageDescription.nativeCoverageDescription.domain.spatialDomain,K=J.origin.x<=J.envelope.xmin&&J.origin.y<=J.envelope.ymin;var M=this._pivotServerGridOrigin110&&
K?[(f.extent.xmax-f.extent.xmin)/f.width,(f.extent.ymax-f.extent.ymin)/f.height]:[(f.extent.xmax-f.extent.xmin)/f.width,(f.extent.ymin-f.extent.ymax)/f.height];var O=G(y.nativeCoverageDescription.range,function(T){return T.axis.some(function(S){return"band"===S.identifier.toLowerCase()})}),N,R;J=O&&f.interpolation&&f.bandIds?O.identifier+":"+f.interpolation+"["+O.axis[0].identifier+"["+f.bandIds.join(",")+"]]":null;if(f.multidimensionalDefinition)for(N=0;N<f.multidimensionalDefinition.length;N++){var Q=
f.multidimensionalDefinition[N].values;if(0<Q.length)if(-1<f.multidimensionalDefinition[N].dimensionName.toLowerCase().indexOf("time"))Q=Q.map(w).join(","),f.time=Q;else if(O=D(y.nativeCoverageDescription.range,f.multidimensionalDefinition[N].variableName,"identifier"))if(f.interpolation||(f.interpolation=O.supportedInterpolations[0]),R=D(O.axis,f.multidimensionalDefinition[N].dimensionName,"identifier"))Q=Q.join(","),J=O.identifier+":"+f.interpolation+"["+R.identifier+"["+Q+"]]"}O=this._pivotServerGridOrigin110&&
K?[f.extent.xmin,f.extent.ymin]:[f.extent.xmin,f.extent.ymax];this.coverageDescription._useEPSGAxis&&this._useLatLong(f.extent.spatialReference.wkid)?(K=f.extent.ymin+","+f.extent.xmin+","+f.extent.ymax+","+f.extent.xmax+","+f.epsgNSCRS,O=O[1]+","+O[0],M=this.supports4ValueOffset?M[1]+",0,0,"+M[0]:M[1]+","+M[0]):(K=f.extent.xmin+","+f.extent.ymin+","+f.extent.xmax+","+f.extent.ymax+","+f.epsgNSCRS,O=O[0]+","+O[1],M=this.supports4ValueOffset?M[0]+",0,0,"+M[1]:M[0]+","+M[1]);k={request:"GetCoverage",
service:"WCS",version:x,identifier:f.coverageId,format:f.format||"image/tiff",crs:f.crs,boundingbox:K,GridBaseCRS:f.epsgNSCRS,GridCS:"urn:ogc:def:cs:OGC:0.0:Grid2dSquareCS",GridType:"urn:ogc:def:method:WCS:1.1:2dGridIn2dCrs",GridOrigin:O,GridOffsets:M,TimeSequence:f.time,rangeSubset:J}}),F=H.hitch(this,function(){var J=[],K=y.nativeCoverageDescription.domainSet.axisLabels;if("x"===K[0].toLowerCase()||"x"===K[1].toLowerCase()){J.push("x,http://www.opengis.net/def/crs/EPSG/0/"+f.extent.spatialReference.wkid+
"("+f.extent.xmin+","+f.extent.xmax+")");J.push("y,http://www.opengis.net/def/crs/EPSG/0/"+f.extent.spatialReference.wkid+"("+f.extent.ymin+","+f.extent.ymax+")");var M="x";var O="y"}else-1<K[0].toLowerCase().indexOf("lat")||-1<K[0].toLowerCase().indexOf("north")?(J.push(K[1]+",http://www.opengis.net/def/crs/EPSG/0/"+f.extent.spatialReference.wkid+"("+f.extent.xmin+","+f.extent.xmax+")"),J.push(K[0]+",http://www.opengis.net/def/crs/EPSG/0/"+f.extent.spatialReference.wkid+"("+f.extent.ymin+","+f.extent.ymax+
")"),M=K[1],O=K[0]):-1<K[0].toLowerCase().indexOf("lon")||-1<K[0].toLowerCase().indexOf("east")?(J.push(K[0]+",http://www.opengis.net/def/crs/EPSG/0/"+f.extent.spatialReference.wkid+"("+f.extent.xmin+","+f.extent.xmax+")"),J.push(K[1]+",http://www.opengis.net/def/crs/EPSG/0/"+f.extent.spatialReference.wkid+"("+f.extent.ymin+","+f.extent.ymax+")"),M=K[0],O=K[1]):this._useLatLong(f.extent.spatialReference.wkid)?(J.push(K[1]+",http://www.opengis.net/def/crs/EPSG/0/"+f.extent.spatialReference.wkid+"("+
f.extent.xmin+","+f.extent.xmax+")"),J.push(K[0]+",http://www.opengis.net/def/crs/EPSG/0/"+f.extent.spatialReference.wkid+"("+f.extent.ymin+","+f.extent.ymax+")"),M=K[1],O=K[0]):(J.push(K[0]+",http://www.opengis.net/def/crs/EPSG/0/"+f.extent.spatialReference.wkid+"("+f.extent.xmin+","+f.extent.xmax+")"),J.push(K[1]+",http://www.opengis.net/def/crs/EPSG/0/"+f.extent.spatialReference.wkid+"("+f.extent.ymin+","+f.extent.ymax+")"),M=K[0],O=K[1]);if(2<K.length)for(N=2;N<K.length;N++)-1<K[N].toLowerCase().indexOf("time")?
J.push(K[N]+",http://www.opengis.net("+z(y.nativeCoverageDescription.domainSet.origin[N],y.nativeCoverageDescription.boundedBy.uomLabels[N])+")"):J.push(K[N]+",http://www.opengis.net("+y.nativeCoverageDescription.domainSet.origin[N]+")");N=null;var N,R=[],Q=[];if(f.multidimensionalDefinition){for(N=0;N<y.nativeCoverageDescription.rangeType.length;N++)Q=Q.concat(y.nativeCoverageDescription.rangeType[N].map(function(V){return V.name}));for(N=0;N<f.multidimensionalDefinition.length;N++){var T=D(K,f.multidimensionalDefinition[N].dimensionName);
var S=D(Q,f.multidimensionalDefinition[N].variableName);-1===R.indexOf(S)&&R.push(S);if(T&&(S=f.multidimensionalDefinition[N].values,0<S.length)){S[0]instanceof Array&&(S=S[0]);S=-1<T.toLowerCase().indexOf("time")?S.map(w).join(","):S.join(",");var U=A(J,function(V){return 0===V.indexOf(T)});-1===U&&J.push(T+",http://www.opengis.net("+S+")");-1!==U&&-1===J[U].indexOf("("+S+")")&&J.splice(U,1,T+",http://www.opengis.net("+S+")")}}N=0<R.length?R.join(","):null}K="http://www.opengis.net/def/crs/EPSG/0/"+
f.extent.spatialReference.wkid;J=J.join("\x26subset\x3d");k={request:"GetCoverage",service:"WCS",version:x,coverageId:f.coverageId,rangesubset:N,interpolation:f.interpolation,scaleSize:M+"("+f.width+"),"+O+"("+f.height+")",subset:J,extension:null,format:f.format||"image/tiff",outputcrs:K}});switch(x){case "1.0.0":C();break;case "1.1.0":case "1.1.1":case "1.1.2":E();break;case "2.0.1":F()}H.mixin(k,this.optionalParameters);f.token&&(k.token=f.token);var B=this.wcsConnection.onlineResources.getCoverage||
this.url;-1===B.indexOf("?")&&(B+="?");Object.keys(k).forEach(function(J){void 0!==k[J]&&null!==k[J]&&(B+=J,B+="\x3d",B+=k[J],B+="\x26")});B=B.substring(0,B.length-1);return c({url:encodeURI(B),handleAs:"arraybuffer"},{returnFullResponse:!0})},_identifyPixelValue:function(f){var x=new g,y={objectId:0,name:"Pixel",value:null,location:f,pixelValues:null};this._pixelValueReadPromise&&this._pixelValueReadPromise.cancel();var k=this.projectedFullExtent,w=this._projectedResolution,C=k.xmin+Math.floor((f.x-
k.xmin)/w.x)*w.x;k=k.ymin+Math.floor((f.y-k.ymin)/w.y)*w.y;var E=new n;E.spatialReference=f.spatialReference;E.xmin=C;E.ymin=k;E.xmax=C+2*w.x;E.ymax=k+2*w.y;var F=this._constructGetCoverageParams(E,2,2),B=this;if(!F)return x.resolve(y),B._pixelValueReadPromise=null,x;var J=new r(""),K;f=new g(l._dfdCanceller);f._pendingDfd=this._getCoverage(F);f._pendingDfd.then(function(M){M=I.parse(M);if("1.0.0"===B.version)M=M.data;else if(M.isMultiPart)M=M.data[M.data.length-1].contentData;else{K=Error("not a valid multipart coverage response");
x.reject(K);B._pixelValueReadPromise=null;return}J.decode(M,{width:F.width,height:F.height,planes:null,pixelType:"UNKNOWN"}).then(function(O){O&&O.pixels&&(!O.mask||O.mask[0]?O.pixels&&(y.pixelValues=O.pixels.map(function(N){return N[0]}),y.value=y.pixelValues.join(" ")):(y.value="NoData",y.pixelValues=[NaN]));x.resolve(y);B._pixelValueReadPromise=null},function(O){x.reject(O);B._pixelValueReadPromise=null})},function(M){x.reject(M);B._pixelValueReadPromise=null});return this._pixelValueReadPromise=
x.promise},_useLatLong:function(f){if(!f)return!1;var x;for(x=0;x<this._REVERSED_LAT_LONG_RANGES.length;x++){var y=this._REVERSED_LAT_LONG_RANGES[x];if(f>=y[0]&&f<=y[1]){var k=!0;break}}return k},_toggleTime:function(){var f=this._map;this.timeInfo&&this.useMapTime&&f&&!this.suspended?(this._timeConnect||(this._timeConnect=L.connect(f,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(f.timeExtent)):(L.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},
_setTime:function(f){if(this._params)if(f){var x=[];f.startTime&&x.push(f.startTime.toISOString());f.endTime&&x.push(f.endTime.toISOString());this._params.time=x.join(",")}else this._params.time=null},_onTimeExtentChangeHandler:function(f){this.suspended||(this._setTime(f),this.refresh(!0))}});H.mixin(h,{INTERPOLATION_NEARESTNEIGHBOR:0,INTERPOLATION_BILINEAR:1,INTERPOLATION_CUBICCONVOLUTION:2});d("extend-esri")&&H.setObject("layers.WCSLayer",h,b);return h});