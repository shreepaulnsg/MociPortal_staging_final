// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/rasterFormats/TiffDecoder",["./Jpg","./Zlib"],function(Ia,ia){var Ja=function(){var a=new ArrayBuffer(4),n=new Uint8Array(a);a=new Uint32Array(a);n[0]=1;n[1]=2;n[2]=3;n[3]=4;return 67305985===a[0]},$a=function(){var a=[];a[254]="NEWSUBFILETYPE";a[255]="SUBFILETYPE";a[256]="IMAGEWIDTH";a[257]="IMAGELENGTH";a[258]="BITSPERSAMPLE";a[259]="COMPRESSION";a[262]="PHOTOMETRICINTERPRETATION";a[263]="THRESHHOLDING";a[264]="CELLWIDTH";a[265]="CELLLENGTH";a[266]="FILLORDER";a[269]="DOCUMENTNAME";
a[270]="IMAGEDESCRIPTION";a[271]="MAKE";a[272]="MODEL";a[273]="STRIPOFFSETS";a[274]="ORIENTATION";a[277]="SAMPLESPERPIXEL";a[278]="ROWSPERSTRIP";a[279]="STRIPBYTECOUNTS";a[280]="MINSAMPLEVALUE";a[281]="MAXSAMPLEVALUE";a[282]="XRESOLUTION";a[283]="YRESOLUTION";a[284]="PLANARCONFIGURATION";a[285]="PAGENAME";a[286]="XPOSITION";a[287]="YPOSITION";a[288]="FREEOFFSETS";a[289]="FREEBYTECOUNTS";a[290]="GRAYRESPONSEUNIT";a[291]="GRAYRESPONSECURVE";a[292]="T4OPTIONS";a[293]="T6OPTIONS";a[296]="RESOLUTIONUNIT";
a[297]="PAGENUMBER";a[300]="COLORRESPONSEUNIT";a[301]="TRANSFERFUNCTION";a[305]="SOFTWARE";a[306]="DATETIME";a[315]="ARTIST";a[316]="HOSTCOMPUTER";a[317]="PREDICTOR";a[318]="WHITEPOINT";a[319]="PRIMARYCHROMATICITIES";a[320]="COLORMAP";a[321]="HALFTONEHINTS";a[322]="TILEWIDTH";a[323]="TILELENGTH";a[324]="TILEOFFSETS";a[325]="TILEBYTECOUNTS";a[326]="BADFAXLINES";a[327]="CLEANFAXDATA";a[328]="CONSECUTIVEBADFAXLINES";a[330]="SUBIFD";a[332]="INKSET";a[333]="INKNAMES";a[334]="NUMBEROFINKS";a[336]="DOTRANGE";
a[337]="TARGETPRINTER";a[338]="EXTRASAMPLES";a[339]="SAMPLEFORMAT";a[340]="SMINSAMPLEVALUE";a[341]="SMAXSAMPLEVALUE";a[342]="TRANSFERRANGE";a[347]="JPEGTABLES";a[512]="JPEGPROC";a[513]="JPEGIFOFFSET";a[514]="JPEGIFBYTECOUNT";a[515]="JPEGRESTARTINTERVAL";a[517]="JPEGLOSSLESSPREDICTORS";a[518]="JPEGPOINTTRANSFORM";a[519]="JPEGQTABLES";a[520]="JPEGDCTABLES";a[521]="JPEGACTABLES";a[529]="YCBCRCOEFFICIENTS";a[530]="YCBCRSUBSAMPLING";a[531]="YCBCRPOSITIONING";a[532]="REFERENCEBLACKWHITE";a[33550]="GEOPIXELSCALE";
a[33922]="GEOTIEPOINTS";a[33432]="COPYRIGHT";a[42112]="GDAL_METADATA";a[42113]="GDAL_NODATA";a[50844]="RPCCOEFFICIENT";a[34735]="GEOKEYDIRECTORY";a[34736]="GEODOUBLEPARAMS";a[34737]="GEOASCIIPARAMS";return a}(),Ka=[0,1,1,2,4,8,1,1,2,4,8,4,8],La=function(a,n){var w="UNKNOWN";3===a?w="F32":1===a?8>=n?w="U8":16>=n?w="U16":32>=n&&(w="U32"):2===a&&(8>=n?w="S8":16>=n?w="S16":32>=n&&(w="S32"));return w};return{decode:function(a){var n=new DataView(a,0,8),w=n.getUint16(0,!1);if(18761===w)var ja=!0;else if(19789===
w)ja=!1;else throw"unexpected endianess byte";if(42!==n.getUint16(2,ja))throw"unexpected tiff identifier";var ab=n.getUint32(4,ja);var A=ja;var va,Y;var ka=ab;for(var wa=[];ka;){var Ma=(new DataView(a,ka,2)).getUint16(0,A);var xa=ka+2;ka=(new DataView(a,xa+12*Ma,4)).getUint32(0,A);var Na={};for(va=0;va<Ma;va++){var la=new DataView(a,xa,12);var ya=la.getUint16(0,A);var ma=la.getUint16(2,A);var bb=la.getUint32(4,A);var cb=la.getUint32(8,A);xa+=12;if(!(7===ma||12<ma)){var db=Y={fieldTag:ya,fieldType:ma,
fieldValueCount:bb,fieldValueOffset:cb},B=void 0,q=void 0,r=a,x=A,C=[],na=Y.fieldType,oa=Y.fieldValueCount,T=Y.fieldValueOffset,m=T,za=Ka[na],Oa=8*za,eb=oa*za,Pa=oa*Ka[na]*8;if(32>=Pa)if(x||(T>>>=32-Pa),1===oa)C=[T];else for(B=0;B<oa;B++)C.push(T<<Oa*B>>>32-Oa);else for(m=T;m<T+eb;m+=za){switch(na){case 1:q=(new DataView(r,m,1)).getUint8(0);break;case 2:q=(new DataView(r,m,1)).getUint8(0);break;case 3:q=(new DataView(r,m,2)).getUint16(0,x);break;case 4:q=(new DataView(r,m,4)).getUint32(0,x);break;
case 5:q=(new DataView(r,m,4)).getUint32(0,x)/(new DataView(r,m+4,4)).getUint32(0,x);break;case 6:q=(new DataView(r,m,1)).getInt8(0);break;case 8:q=(new DataView(r,m,2)).getInt16(0,x);break;case 9:q=(new DataView(r,m,4)).getInt32(0,x);break;case 10:q=(new DataView(r,m,4)).getInt32(0,x)/(new DataView(r,m+4,4)).getInt32(0,x);break;case 11:q=(new DataView(r,m,4)).getFloat32(0,x);break;case 12:q=(new DataView(r,m,8)).getFloat64(0,x);break;case 7:q=null;break;default:q=null}C.push(q)}if(2===na){var U=
"",Aa=C;C=[];for(B=0;B<Aa.length;B++)0===Aa[B]&&""!==U?(C.push(U),U=""):U+=String.fromCharCode(Aa[B]);""===U&&0!==C.length||C.push(U)}db.fieldValues=C;var fb=Na,Ba=$a[ya];void 0===Ba&&(Ba="unknown"+ya);fb[Ba]={type:ma,values:Y.fieldValues}}}wa.push(Na)}if(0===wa.length)throw"no valid image file directory";var z,b=wa[0],V=void 0===b.GDAL_NODATA||null===b.GDAL_NODATA?null:parseFloat(b.GDAL_NODATA.values[0]);if(b.TILEOFFSETS){var gb=Ja()===A,I=b.TILEOFFSETS?b.TILEOFFSETS.values:void 0;if(void 0===I)var g=
void 0;else{var J=b.TILEBYTECOUNTS.values,K=b.TILEWIDTH.values[0],W=b.TILELENGTH.values[0],X=b.IMAGEWIDTH.values[0],Ca=b.IMAGELENGTH.values[0],D=X*Ca,t=b.BITSPERSAMPLE.values[0],h=b.SAMPLESPERPIXEL.values[0],Z=b.SAMPLEFORMAT?b.SAMPLEFORMAT.values[0]:1,pa=La(Z,t);if(1!==(b.PLANARCONFIGURATION?b.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),"can only handle PLANARCONFIGURATION\x3d1";var y=b.COMPRESSION?b.COMPRESSION.values[0]:1;if(1!==y&&6!==y&&8!==y&&
32946!==y)throw console.log("this compression is not supported at this moment"),"this compression is not supported at this moment";if(3<Z)g=void 0;else{if(3===Z){var E=new Float32Array(D*h);var L=Float32Array}else 1===Z?8>=t?(E=new Uint8Array(D*h),L=Uint8Array):16>=t?(E=new Uint16Array(D*h),L=Uint16Array):32>=t&&(E=new Uint32Array(D*h),L=Uint32Array):2===Z&&(8>=t?(E=new Int8Array(D*h),L=Int8Array):16>=t?(E=new Int16Array(D*h),L=Int16Array):32>=t&&(E=new Int32Array(D*h),L=Int32Array));var d,aa,k,ba,
Da,Qa=Math.ceil(X/K);if(0===t%8)for(d=0;d<I.length;d++){var Ra=Math.floor(d/Qa)*W;var Sa=d%Qa*K;var Ta=(Ra*X+Sa)*h;if("U8"===pa||"S8"===pa||gb)if(8===y||32946===y){var e=new Uint8Array(a,I[d],J[d]);var Ea=new ia(e);var Ua=Ea.getBytes();var F=new ArrayBuffer(Ua.length);e=new Uint8Array(F);e.set(Ua);e.length!==K*W*h*t/8&&console.log("tile byte counts is different than expected")}else if(6===y){e=new Uint8Array(a,I[d],J[d]);var qa=new Ia;qa.parse(e);var Va=qa.getData(qa.width,qa.height);F=new ArrayBuffer(Va.length);
e=new Uint8Array(F);e.set(Va)}else 1===y&&(J[d]!==K*W*h*t/8&&console.log("tile byte counts is different than expected"),F=a.slice(I[d],I[d]+J[d]));else{if(8===y||32946===y){e=new Uint8Array(a,I[d],J[d]);Ea=new ia(e);e=Ea.getBytes();F=new ArrayBuffer(e.length);var R=new Uint8Array(F);e.length!==K*W*h*t/8&&console.log("tile byte counts is different than expected")}else 1===y&&(J[d]!==K*W*h*t/8&&console.log("tile byte counts is different than expected"),F=new ArrayBuffer(J[d]),e=new Uint8Array(a,I[d],
J[d]),R=new Uint8Array(F));switch(pa){case "U16":case "S16":for(k=0;k<e.length;k+=2)R[k]=e[k+1],R[k+1]=e[k];break;case "U32":case "S32":case "F32":for(k=0;k<e.length;k+=4)R[k]=e[k+3],R[k+1]=e[k+2],R[k+2]=e[k+1],R[k+3]=e[k]}}var hb=new L(F);var Fa=0;var Ga=Ta;var ib=Math.min(K,X-Sa);var jb=Math.min(W,Ca-Ra);for(ba=0;ba<jb;ba++)for(Ga=Ta+ba*X*h,Fa=ba*K*h,Da=0;Da<ib*h;Da++,Ga++,Fa++)E[Ga]=hb[Fa]}var ra={width:X,height:Ca,pixelType:pa};if(1===h)ra.pixels=[E];else for(ra.pixels=[],d=0;d<h;d++){var Wa=
new L(D);for(aa=0;aa<D;aa++)Wa[aa]=E[aa*h+d];ra.pixels.push(Wa)}g=ra}}}else if(b.STRIPOFFSETS){var kb=Ja()===A,M=b.STRIPOFFSETS?b.STRIPOFFSETS.values:void 0;if(void 0===M)g=void 0;else{var N=b.STRIPBYTECOUNTS.values,ca=b.ROWSPERSTRIP.values,O=b.IMAGEWIDTH.values[0],da=b.IMAGELENGTH.values[0],P=O*da,u=b.BITSPERSAMPLE.values[0],p=b.SAMPLESPERPIXEL.values[0],ea=b.SAMPLEFORMAT?b.SAMPLEFORMAT.values[0]:1,sa=La(ea,u);if(1!==(b.PLANARCONFIGURATION?b.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),
"can only handle PLANARCONFIGURATION\x3d1";var v=b.COMPRESSION?b.COMPRESSION.values[0]:1;if(1!==v&&6!==v&&8!==v&&32946!==v)throw console.log("compressed tiff is not supported at this moment"),"compressed tiff is not supported at this moment";if(3<ea)g=void 0;else{if(3===ea){var G=new Float32Array(P*p);var Q=Float32Array}else 1===ea?8>=u?(G=new Uint8Array(P*p),Q=Uint8Array):16>=u?(G=new Uint16Array(P*p),Q=Uint16Array):32>=u&&(G=new Uint32Array(P*p),Q=Uint32Array):2===ea&&(8>=u?(G=new Int8Array(P*p),
Q=Int8Array):16>=u?(G=new Int16Array(P*p),Q=Int16Array):32>=u&&(G=new Int32Array(O*da*p),Q=Int32Array));var c,fa,l,ha=ca;if(0===u%8)for(c=0;c<M.length;c++){var lb=c*ca*O*p;ha=(c+1)*ca>da?da-c*ca:ca;if("U8"===sa||"S8"===sa||kb)if(8===v||32946===v){var f=new Uint8Array(a,M[c],N[c]);var Ha=new ia(f);var Xa=Ha.getBytes();var H=new ArrayBuffer(Xa.length);f=new Uint8Array(H);f.set(Xa);f.length!==ha*O*p*u/8&&console.log("strip byte counts is different than expected")}else if(6===v){f=new Uint8Array(a,M[c],
N[c]);var ta=new Ia;ta.parse(f);var Ya=ta.getData(ta.width,ta.height);H=new ArrayBuffer(Ya.length);f=new Uint8Array(H);f.set(Ya)}else 1===v&&(N[c]!==ha*O*p*u/8&&console.log("strip byte counts is different than expected"),H=a.slice(M[c],M[c]+N[c]));else{if(6===v||8===v||32946===v){f=new Uint8Array(a,M[c],N[c]);Ha=new ia(f);f=Ha.getBytes();H=new ArrayBuffer(f.length);var S=new Uint8Array(H);f.length!==ha*O*p*u/8&&console.log("strip byte counts is different than expected")}else 1===v&&(N[c]!==ha*O*p*
u/8&&console.log("strip byte counts is different than expected"),H=new ArrayBuffer(N[c]),f=new Uint8Array(a,M[c],N[c]),S=new Uint8Array(H));switch(sa){case "U16":case "S16":for(l=0;l<f.length;l+=2)S[l]=f[l+1],S[l+1]=f[l];break;case "U32":case "S32":case "F32":for(l=0;l<f.length;l+=4)S[l]=f[l+3],S[l+1]=f[l+2],S[l+2]=f[l+1],S[l+3]=f[l]}}var mb=new Q(H);G.set(mb,lb)}var ua={width:O,height:da,pixelType:sa};if(1===p)ua.pixels=[G];else for(ua.pixels=[],c=0;c<p;c++){var Za=new Q(P);for(fa=0;fa<P;fa++)Za[fa]=
G[fa*p+c];ua.pixels.push(Za)}g=ua}}}if(null!==V){g.maskData=new Uint8Array(g.width*g.height);if(1E24<Math.abs(V))for(z=0;z<g.width*g.height;z++)g.maskData[z]=1E-6>Math.abs((g.pixels[0][z]-V)/V)?0:1;else for(z=0;z<g.width*g.height;z++)g.maskData[z]=g.pixels[0][z]===V?0:1;g.noDataValue=V}return g}}});