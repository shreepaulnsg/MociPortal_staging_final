// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/rasterFormats/Lerc2Codec",[],function(){var L={unstuff:function(a,b,e,f,d,g,m,k){var c=(1<<e)-1,h=0,p,l=0;a[a.length-1]<<=8*(4*a.length-Math.ceil(e*f/8));if(d)for(p=0;p<f;p++){if(0===l){var q=a[h++];l=32}if(l>=e){var n=q>>>l-e&c;l-=e}else l=e-l,n=(q&c)<<l&c,q=a[h++],l=32-l,n+=q>>>l;b[p]=d[n]}else for(d=Math.ceil((k-g)/m),p=0;p<f;p++)0===l&&(q=a[h++],l=32),l>=e?(n=q>>>l-e&c,l-=e):(l=e-l,n=(q&c)<<l&c,q=a[h++],l=32-l,n+=q>>>l),b[p]=n<d?g+n*m:k},unstuffLUT:function(a,b,e,f,d,g){var m=
(1<<b)-1,k=0,c=0,h=0,p=h=0,l=[];a[a.length-1]<<=8*(4*a.length-Math.ceil(b*e/8));var q=Math.ceil((g-f)/d);for(c=0;c<e;c++){if(0===h){var n=a[k++];h=32}h>=b?(p=n>>>h-b&m,h-=b):(h=b-h,p=(n&m)<<h&m,n=a[k++],h=32-h,p+=n>>>h);l[c]=p<q?f+p*d:g}l.unshift(f);return l},unstuff2:function(a,b,e,f,d,g,m,k){var c=(1<<e)-1,h=0,p,l=0,q=0;if(d)for(p=0;p<f;p++){if(0===l){var n=a[h++];l=32;q=0}if(l>=e){var r=n>>>q&c;l-=e;q+=e}else{var w=e-l;r=n>>>q&c;n=a[h++];l=32-w;r|=(n&(1<<w)-1)<<e-w;q=w}b[p]=d[r]}else for(d=Math.ceil((k-
g)/m),p=0;p<f;p++)0===l&&(n=a[h++],l=32,q=0),l>=e?(r=n>>>q&c,l-=e,q+=e):(w=e-l,r=n>>>q&c,n=a[h++],l=32-w,r|=(n&(1<<w)-1)<<e-w,q=w),b[p]=r<d?g+r*m:k;return b},unstuffLUT2:function(a,b,e,f,d,g){var m=(1<<b)-1,k=0,c=0,h=0,p=0,l=0,q=0,n=[],r=Math.ceil((g-f)/d);for(c=0;c<e;c++){if(0===p){var w=a[k++];p=32;q=0}p>=b?(l=w>>>q&m,p-=b,q+=b):(h=b-p,l=w>>>q&m,w=a[k++],p=32-h,l|=(w&(1<<h)-1)<<b-h,q=h);n[c]=l<r?f+l*d:g}n.unshift(f);return n},originalUnstuff:function(a,b,e,f){var d=(1<<e)-1,g=0,m,k=0;a[a.length-
1]<<=8*(4*a.length-Math.ceil(e*f/8));for(m=0;m<f;m++){if(0===k){var c=a[g++];k=32}if(k>=e){var h=c>>>k-e&d;k-=e}else k=e-k,h=(c&d)<<k&d,c=a[g++],k=32-k,h+=c>>>k;b[m]=h}return b},originalUnstuff2:function(a,b,e,f){var d=(1<<e)-1,g=0,m,k=0,c=0;for(m=0;m<f;m++){if(0===k){var h=a[g++];k=32;c=0}if(k>=e){var p=h>>>c&d;k-=e;c+=e}else{var l=e-k;p=h>>>c&d;h=a[g++];k=32-l;p|=(h&(1<<l)-1)<<e-l;c=l}b[m]=p}return b}},A={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(a){for(var b=65535,e=65535,f=a.length,
d=Math.floor(f/2),g=0;d;){var m=359<=d?359:d;d-=m;do b+=a[g++]<<8,e+=b+=a[g++];while(--m);b=(b&65535)+(b>>>16);e=(e&65535)+(e>>>16)}f&1&&(e+=b+=a[g]<<8);return((e&65535)+(e>>>16)<<16|(b&65535)+(b>>>16))>>>0},readHeaderInfo:function(a,b){var e=b.ptr,f=new Uint8Array(a,e,6),d={};d.fileIdentifierString=String.fromCharCode.apply(null,f);if(0!==d.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+d.fileIdentifierString;e+=6;f=new DataView(a,e,8);var g=
f.getInt32(0,!0);d.fileVersion=g;e+=4;3<=g&&(d.checksum=f.getUint32(4,!0),e+=4);f=new DataView(a,e,12);d.height=f.getUint32(0,!0);d.width=f.getUint32(4,!0);e+=8;4<=g?(d.numDims=f.getUint32(8,!0),e+=4):d.numDims=1;f=new DataView(a,e,40);d.numValidPixel=f.getUint32(0,!0);d.microBlockSize=f.getInt32(4,!0);d.blobSize=f.getInt32(8,!0);d.imageType=f.getInt32(12,!0);d.maxZError=f.getFloat64(16,!0);d.zMin=f.getFloat64(24,!0);d.zMax=f.getFloat64(32,!0);e+=40;b.headerInfo=d;b.ptr=e;if(3<=g&&(a=this.computeChecksumFletcher32(new Uint8Array(a,
e-(4<=g?52:48),d.blobSize-14)),a!==d.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(a,b){var e=b.headerInfo,f=this.getDataTypeArray(e.imageType),d=e.numDims*this.getDataTypeSize(e.imageType),g=this.readSubArray(a,b.ptr,f,d);a=this.readSubArray(a,b.ptr+d,f,d);b.ptr+=2*d;d=!0;for(b=0;b<e.numDims;b++)if(g[b]!==a[b]){d=!1;break}e.minValues=g;e.maxValues=a;return d},readSubArray:function(a,b,e,f){if(e===Uint8Array)a=new Uint8Array(a,b,f);else{var d=new ArrayBuffer(f);(new Uint8Array(d)).set(new Uint8Array(a,
b,f));a=new e(d)}return a},readMask:function(a,b){var e=b.ptr,f=b.headerInfo,d=f.width*f.height,g=f.numValidPixel,m=new DataView(a,e,4);f={};f.numBytes=m.getUint32(0,!0);e+=4;if((0===g||d===g)&&0!==f.numBytes)throw"invalid mask";if(0===g)g=new Uint8Array(Math.ceil(d/8)),f.bitset=g,m=new Uint8Array(d),b.pixels.resultMask=m,e+=f.numBytes;else if(0<f.numBytes){g=new Uint8Array(Math.ceil(d/8));m=new DataView(a,e,f.numBytes);a=m.getInt16(0,!0);var k=2,c=0,h=0;do{if(0<a)for(;a--;)g[c++]=m.getUint8(k++);
else for(h=m.getUint8(k++),a=-a;a--;)g[c++]=h;a=m.getInt16(k,!0);k+=2}while(k<f.numBytes);if(-32768!==a||c<g.length)throw"Unexpected end of mask RLE encoding";m=new Uint8Array(d);for(k=k=a=0;k<d;k++)k&7?(a=g[k>>3],a<<=k&7):a=g[k>>3],a&128&&(m[k]=1);b.pixels.resultMask=m;f.bitset=g;e+=f.numBytes}b.ptr=e;b.mask=f;return!0},readDataOneSweep:function(a,b,e,f){var d=b.ptr,g=b.headerInfo,m=g.numDims,k=g.width*g.height;g=g.numValidPixel*A.getDataTypeSize(g.imageType)*m;var c=b.pixels.resultMask;if(e===Uint8Array)a=
new Uint8Array(a,d,g);else{var h=new ArrayBuffer(g);(new Uint8Array(h)).set(new Uint8Array(a,d,g));a=new e(h)}if(a.length===k*m)b.pixels.resultPixels=f?A.swapDimensionOrder(a,k,m,e,!0):a;else{b.pixels.resultPixels=new e(k*m);var p=h=e=0,l=0;if(1<m)if(f)for(h=0;h<k;h++){if(c[h])for(l=h,p=0;p<m;p++,l+=k)b.pixels.resultPixels[l]=a[e++]}else for(h=0;h<k;h++){if(c[h])for(l=h*m,p=0;p<m;p++)b.pixels.resultPixels[l+p]=a[e++]}else for(h=0;h<k;h++)c[h]&&(b.pixels.resultPixels[h]=a[e++])}b.ptr=d+g;return!0},
readHuffmanTree:function(a,b){var e=this.HUFFMAN_LUT_BITS_MAX,f=new DataView(a,b.ptr,16);b.ptr+=16;if(2>f.getInt32(0,!0))throw"unsupported Huffman version";var d=f.getInt32(4,!0),g=f.getInt32(8,!0);f=f.getInt32(12,!0);if(g>=f)return!1;var m=new Uint32Array(f-g);A.decodeBits(a,b,m);var k=[],c;for(c=g;c<f;c++){var h=c-(c<d?0:d);k[h]={first:m[c-g],second:null}}c=a.byteLength-b.ptr;m=new ArrayBuffer(4*Math.ceil(c/4));(new Uint8Array(m)).set(new Uint8Array(a,b.ptr,c));a=new Uint32Array(m);b=0;m=0;var p=
a[0];for(c=g;c<f;c++){h=c-(c<d?0:d);var l=k[h].first;0<l&&(k[h].second=p<<b>>>32-l,32-b>=l?(b+=l,32===b&&(b=0,m++,p=a[m])):(b+=l-32,m++,p=a[m],k[h].second|=p>>>32-b))}var q=p=0,n=new N;for(c=0;c<k.length;c++)void 0!==k[c]&&(p=Math.max(p,k[c].first));q=p>=e?e:p;e=[];var r;for(c=g;c<f;c++)if(h=c-(c<d?0:d),l=k[h].first,0<l)if(g=[l,h],l<=q){h=k[h].second<<q-l;var w=1<<q-l;for(l=0;l<w;l++)e[h|l]=g}else for(h=k[h].second,w=n,--l;0<=l;l--)(r=h>>>l&1)?(w.right||(w.right=new N),w=w.right):(w.left||(w.left=
new N),w=w.left),0!==l||w.val||(w.val=g[1]);return{decodeLut:e,numBitsLUTQick:q,numBitsLUT:p,tree:n,stuffedData:a,srcPtr:m,bitPos:b}},readHuffman:function(a,b,e,f){var d=b.headerInfo.numDims,g=b.headerInfo.height,m=b.headerInfo.width,k=m*g,c=this.readHuffmanTree(a,b);a=c.decodeLut;var h=c.tree,p=c.stuffedData,l=c.srcPtr,q=c.bitPos,n=c.numBitsLUTQick;c=c.numBitsLUT;var r=0===b.headerInfo.imageType?128:0,w=b.pixels.resultMask,B,F,z,v,y,E,u=0;0<q&&(l++,q=0);var D=p[l],C=1===b.encodeMode,I=new e(k*d),
J=I,G;if(2>d||C)for(G=0;G<d;G++)if(1<d&&(J=new e(I.buffer,k*G,k),u=0),b.headerInfo.numValidPixel===m*g)for(z=y=0;z<g;z++)for(v=0;v<m;v++,y++){var x=0;var t=B=D<<q>>>32-n;32-q<n&&(t=B|=p[l+1]>>>64-q-n);if(a[t])x=a[t][1],q+=a[t][0];else for(t=B=D<<q>>>32-c,32-q<c&&(t=B|=p[l+1]>>>64-q-c),t=h,E=0;E<c;E++)if(t=(F=B>>>c-E-1&1)?t.right:t.left,!t.left&&!t.right){x=t.val;q=q+E+1;break}32<=q&&(q-=32,l++,D=p[l]);x-=r;C?(x=0<v?x+u:0<z?x+J[y-m]:x+u,x&=255,u=J[y]=x):J[y]=x}else for(z=y=0;z<g;z++)for(v=0;v<m;v++,
y++){if(w[y]){x=0;t=B=D<<q>>>32-n;32-q<n&&(t=B|=p[l+1]>>>64-q-n);if(a[t])x=a[t][1],q+=a[t][0];else for(t=B=D<<q>>>32-c,32-q<c&&(t=B|=p[l+1]>>>64-q-c),t=h,E=0;E<c;E++)if(t=(F=B>>>c-E-1&1)?t.right:t.left,!t.left&&!t.right){x=t.val;q=q+E+1;break}32<=q&&(q-=32,l++,D=p[l]);x-=r;C?(x=0<v&&w[y-1]?x+u:0<z&&w[y-m]?x+J[y-m]:x+u,x&=255,u=J[y]=x):J[y]=x}}else for(z=y=0;z<g;z++)for(v=0;v<m;v++)if(y=z*m+v,!w||w[y])for(G=0;G<d;G++,y+=k){x=0;t=B=D<<q>>>32-n;32-q<n&&(t=B|=p[l+1]>>>64-q-n);if(a[t])x=a[t][1],q+=a[t][0];
else for(t=B=D<<q>>>32-c,32-q<c&&(t=B|=p[l+1]>>>64-q-c),t=h,E=0;E<c;E++)if(t=(F=B>>>c-E-1&1)?t.right:t.left,!t.left&&!t.right){x=t.val;q=q+E+1;break}32<=q&&(q-=32,l++,D=p[l]);x-=r;J[y]=x}b.ptr=b.ptr+4*(l+1)+(0<q?4:0);b.pixels.resultPixels=I;1<d&&!f&&(b.pixels.resultPixels=A.swapDimensionOrder(I,k,d,e))},decodeBits:function(a,b,e,f,d){var g=b.headerInfo,m=g.fileVersion,k=0,c=new DataView(a,b.ptr,5<=a.byteLength-b.ptr?5:a.byteLength-b.ptr),h=c.getUint8(0);k++;var p=h>>6,l=0===p?4:3-p,q=0<(h&32)?!0:
!1;p=h&31;h=0;if(1===l)h=c.getUint8(k),k++;else if(2===l)h=c.getUint16(k,!0),k+=2;else if(4===l)h=c.getUint32(k,!0),k+=4;else throw"Invalid valid pixel count type";l=2*g.maxZError;d=1<g.numDims?g.maxValues[d]:g.zMax;if(q){b.counter.lut++;q=c.getUint8(k);k++;g=Math.ceil((q-1)*p/8);var n=Math.ceil(g/4);n=new ArrayBuffer(4*n);var r=new Uint8Array(n);b.ptr+=k;r.set(new Uint8Array(a,b.ptr,g));k=new Uint32Array(n);b.ptr+=g;for(c=0;q-1>>>c;)c++;g=Math.ceil(h*c/8);n=Math.ceil(g/4);n=new ArrayBuffer(4*n);
r=new Uint8Array(n);r.set(new Uint8Array(a,b.ptr,g));a=new Uint32Array(n);b.ptr+=g;b=3<=m?L.unstuffLUT2(k,p,q-1,f,l,d):L.unstuffLUT(k,p,q-1,f,l,d);3<=m?L.unstuff2(a,e,c,h,b):L.unstuff(a,e,c,h,b)}else b.counter.bitstuffer++,c=p,b.ptr+=k,0<c&&(g=Math.ceil(h*c/8),n=Math.ceil(g/4),n=new ArrayBuffer(4*n),r=new Uint8Array(n),r.set(new Uint8Array(a,b.ptr,g)),a=new Uint32Array(n),b.ptr+=g,3<=m?null==f?L.originalUnstuff2(a,e,c,h):L.unstuff2(a,e,c,h,!1,f,l,d):null==f?L.originalUnstuff(a,e,c,h):L.unstuff(a,
e,c,h,!1,f,l,d))},readTiles:function(a,b,e,f){var d=b.headerInfo,g=d.width,m=d.height,k=g*m,c=d.microBlockSize,h=d.imageType,p=A.getDataTypeSize(h),l=Math.ceil(g/c),q=Math.ceil(m/c);b.pixels.numBlocksY=q;b.pixels.numBlocksX=l;var n=b.pixels.ptr=0,r=0,w=0,B=0,F=0,z=0,v=0,y=0,E=n=0,u=0,D=0,C=v=0;v=v=0;var I=new e(c*c);m=m%c||c;var J=g%c||c,G=d.numDims,x,t=b.pixels.resultMask,H=b.pixels.resultPixels,P=5<=d.fileVersion?14:15,O=d.zMax;for(w=0;w<q;w++)for(F=w!==q-1?c:m,B=0;B<l;B++)for(z=B!==l-1?c:J,u=w*
g*c+B*c,D=g-z,x=0;x<G;x++){1<G?(C=H,u=w*g*c+B*c,H=new e(b.pixels.resultPixels.buffer,k*x*p,k),O=d.maxValues[x]):C=null;v=a.byteLength-b.ptr;r=new DataView(a,b.ptr,Math.min(10,v));var M={};v=0;y=r.getUint8(0);v++;var K=5<=d.fileVersion?y&4:0;n=y>>6&255;E=y>>2&P;if(E!==(B*c>>3&P))throw"integrity issue";if(K&&0===x)throw"integrity issue";y&=3;if(3<y)throw b.ptr+=v,"Invalid block encoding ("+y+")";if(2===y){if(K)if(t)for(n=0;n<F;n++)for(r=0;r<z;r++)t[u]&&(H[u]=C[u]),u++;else for(n=0;n<F;n++)for(r=0;r<
z;r++)H[u]=C[u],u++;b.counter.constant++;b.ptr+=v}else if(0===y){if(K)throw"integrity issue";b.counter.uncompressed++;b.ptr+=v;v=F*z*p;C=a.byteLength-b.ptr;v=v<C?v:C;C=new ArrayBuffer(0===v%p?v:v+p-v%p);K=new Uint8Array(C);K.set(new Uint8Array(a,b.ptr,v));C=new e(C);v=0;if(t)for(n=0;n<F;n++){for(r=0;r<z;r++)t[u]&&(H[u]=C[v++]),u++;u+=D}else for(n=0;n<F;n++){for(r=0;r<z;r++)H[u++]=C[v++];u+=D}b.ptr+=v*p}else if(n=A.getDataTypeUsed(K&&6>h?4:h,n),M=A.getOnePixel(M,v,n,r),v+=A.getDataTypeSize(n),3===
y)if(b.ptr+=v,b.counter.constantoffset++,t)for(n=0;n<F;n++){for(r=0;r<z;r++)t[u]&&(H[u]=K?Math.min(O,C[u]+M):M),u++;u+=D}else for(n=0;n<F;n++){for(r=0;r<z;r++)H[u]=K?Math.min(O,C[u]+M):M,u++;u+=D}else if(b.ptr+=v,A.decodeBits(a,b,I,M,x),v=0,K)if(t)for(n=0;n<F;n++){for(r=0;r<z;r++)t[u]&&(H[u]=I[v++]+C[u]),u++;u+=D}else for(n=0;n<F;n++){for(r=0;r<z;r++)H[u]=I[v++]+C[u],u++;u+=D}else if(t)for(n=0;n<F;n++){for(r=0;r<z;r++)t[u]&&(H[u]=I[v++]),u++;u+=D}else for(n=0;n<F;n++){for(r=0;r<z;r++)H[u++]=I[v++];
u+=D}}1<G&&!f&&(b.pixels.resultPixels=A.swapDimensionOrder(b.pixels.resultPixels,k,G,e))},formatFileInfo:function(a){return{fileIdentifierString:a.headerInfo.fileIdentifierString,fileVersion:a.headerInfo.fileVersion,imageType:a.headerInfo.imageType,height:a.headerInfo.height,width:a.headerInfo.width,numValidPixel:a.headerInfo.numValidPixel,microBlockSize:a.headerInfo.microBlockSize,blobSize:a.headerInfo.blobSize,maxZError:a.headerInfo.maxZError,pixelType:A.getPixelType(a.headerInfo.imageType),eofOffset:a.eofOffset,
mask:a.mask?{numBytes:a.mask.numBytes}:null,pixels:{numBlocksX:a.pixels.numBlocksX,numBlocksY:a.pixels.numBlocksY,maxValue:a.headerInfo.zMax,minValue:a.headerInfo.zMin,noDataValue:a.noDataValue}}},constructConstantSurface:function(a,b){var e=a.headerInfo.zMax,f=a.headerInfo.zMin,d=a.headerInfo.maxValues,g=a.headerInfo.numDims,m=a.headerInfo.height*a.headerInfo.width,k=0,c=0,h=0,p=a.pixels.resultMask;a=a.pixels.resultPixels;if(p)if(1<g)if(b)for(k=0;k<g;k++)for(h=k*m,e=d[k],c=0;c<m;c++)p[c]&&(a[h+c]=
e);else for(c=0;c<m;c++){if(p[c])for(h=c*g,k=0;k<g;k++)a[h+g]=d[k]}else for(c=0;c<m;c++)p[c]&&(a[c]=e);else if(1<g&&f!==e)if(b)for(k=0;k<g;k++)for(h=k*m,e=d[k],c=0;c<m;c++)a[h+c]=e;else for(c=0;c<m;c++)for(h=c*g,k=0;k<g;k++)a[h+k]=d[k];else for(c=0;c<m*g;c++)a[c]=e},getDataTypeArray:function(a){switch(a){case 0:a=Int8Array;break;case 1:a=Uint8Array;break;case 2:a=Int16Array;break;case 3:a=Uint16Array;break;case 4:a=Int32Array;break;case 5:a=Uint32Array;break;case 6:a=Float32Array;break;case 7:a=Float64Array;
break;default:a=Float32Array}return a},getPixelType:function(a){switch(a){case 0:a="S8";break;case 1:a="U8";break;case 2:a="S16";break;case 3:a="U16";break;case 4:a="S32";break;case 5:a="U32";break;case 6:a="F32";break;case 7:a="F64";break;default:a="F32"}return a},isValidPixelValue:function(a,b){if(null==b)return!1;switch(a){case 0:a=-128<=b&&127>=b;break;case 1:a=0<=b&&255>=b;break;case 2:a=-32768<=b&&32767>=b;break;case 3:a=0<=b&&65536>=b;break;case 4:a=-2147483648<=b&&2147483647>=b;break;case 5:a=
0<=b&&4294967296>=b;break;case 6:a=-3.4027999387901484E38<=b&&3.4027999387901484E38>=b;break;case 7:a=4.9E-324<=b&&1.7976931348623157E308>=b;break;default:a=!1}return a},getDataTypeSize:function(a){var b=0;switch(a){case 0:case 1:b=1;break;case 2:case 3:b=2;break;case 4:case 5:case 6:b=4;break;case 7:b=8;break;default:b=a}return b},getDataTypeUsed:function(a,b){var e=a;switch(a){case 2:case 4:e=a-b;break;case 3:case 5:e=a-2*b;break;case 6:e=0===b?a:1===b?2:1;break;case 7:e=0===b?a:a-2*b+1;break;default:e=
a}return e},getOnePixel:function(a,b,e,f){a=0;switch(e){case 0:a=f.getInt8(b);break;case 1:a=f.getUint8(b);break;case 2:a=f.getInt16(b,!0);break;case 3:a=f.getUint16(b,!0);break;case 4:a=f.getInt32(b,!0);break;case 5:a=f.getUInt32(b,!0);break;case 6:a=f.getFloat32(b,!0);break;case 7:a=f.getFloat64(b,!0);break;default:throw"the decoder does not understand this pixel type";}return a},swapDimensionOrder:function(a,b,e,f,d){var g=0,m=0,k=0,c=0,h=a;if(1<e)if(h=new f(b*e),d)for(g=0;g<b;g++)for(c=g,k=0;k<
e;k++,c+=b)h[c]=a[m++];else for(g=0;g<b;g++)for(c=g,k=0;k<e;k++,c+=b)h[m++]=a[c];return h}},N=function(a,b,e){this.val=a;this.left=b;this.right=e};return{decode:function(a,b){b=b||{};var e=b.noDataValue,f=0,d={};d.ptr=b.inputOffset||0;d.pixels={};if(A.readHeaderInfo(a,d)){f=d.headerInfo;var g=f.fileVersion,m=A.getDataTypeArray(f.imageType);if(5<g)throw"unsupported lerc version 2."+g;A.readMask(a,d);f.numValidPixel===f.width*f.height||d.pixels.resultMask||(d.pixels.resultMask=b.maskData);var k=f.width*
f.height;d.pixels.resultPixels=new m(k*f.numDims);d.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var c=!b.returnPixelInterleavedDims;if(0!==f.numValidPixel)if(f.zMax===f.zMin)A.constructConstantSurface(d,c);else if(4<=g&&A.checkMinMaxRanges(a,d))A.constructConstantSurface(d,c);else{var h=new DataView(a,d.ptr,2),p=h.getUint8(0);d.ptr++;if(p)A.readDataOneSweep(a,d,m,c);else if(1<g&&1>=f.imageType&&1E-5>Math.abs(f.maxZError-.5)){h=h.getUint8(1);d.ptr++;d.encodeMode=
h;if(2<h||4>g&&1<h)throw"Invalid Huffman flag "+h;h?A.readHuffman(a,d,m,c):A.readTiles(a,d,m,c)}else A.readTiles(a,d,m,c)}d.eofOffset=d.ptr;b.inputOffset?(a=d.headerInfo.blobSize+b.inputOffset-d.ptr,1<=Math.abs(a)&&(d.eofOffset=b.inputOffset+d.headerInfo.blobSize)):(a=d.headerInfo.blobSize-d.ptr,1<=Math.abs(a)&&(d.eofOffset=d.headerInfo.blobSize));a={width:f.width,height:f.height,pixelData:d.pixels.resultPixels,minValue:f.zMin,maxValue:f.zMax,validPixelCount:f.numValidPixel,dimCount:f.numDims,dimStats:{minValues:f.minValues,
maxValues:f.maxValues},maskData:d.pixels.resultMask};if(d.pixels.resultMask&&A.isValidPixelValue(f.imageType,e)){g=d.pixels.resultMask;for(f=0;f<k;f++)g[f]||(a.pixelData[f]=e);a.noDataValue=e}d.noDataValue=e;b.returnFileInfo&&(a.fileInfo=A.formatFileInfo(d));return a}},getBandCount:function(a){for(var b=0,e=0,f={ptr:0,pixels:{}};e<a.byteLength-58;)A.readHeaderInfo(a,f),e+=f.headerInfo.blobSize,b++,f.ptr=e;return b}}});