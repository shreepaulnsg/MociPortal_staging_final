// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/BaseRasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojox/gfx/matrix ../kernel ../config ../lang ../domUtils ../geometry/Point ./layer".split(" "),function(O,A,H,d,b,c,e,g,h,n,m,l,t,v){var r=n.defaults.map.zoomDuration;return O([v],{declaredClass:"esri.layers.BaseRasterLayer",managedSuspension:!0,opacity:1,constructor:function(p,k){this.drawMode=k&&void 0!==k.drawMode?k.drawMode:
!0;this.drawType=k&&k.drawType?k.drawType:"2d";this.pixelData=null;this._initialize(p,k)},setDrawMode:function(p){this.drawMode=p},setOpacity:function(p){this.opacity!==p&&(this.opacity=p,this.onOpacityChange(p))},onOpacityChange:function(){},refresh:function(){if(!this._canDraw()||10>b("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else this._map&&this._extentChangeHandler(this._map.extent)},clear:function(){this._canDraw()&&"2d"===this.drawType&&
this._context.clearRect(0,0,this._mapWidth,this._mapHeight)},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);this._toggleTime();if("css-transforms"===this._map.navigationMode){var p=this._map.__visibleDelta;this._left=this._tdx=p.x;this._top=this._tdy=p.y;e.set(this._div,h._css.names.transform,h._css.translate(this._left,this._top))}this._displayTimer=this._displayTimer||setTimeout(A.hitch(this,function(){this._extentChangeHandler(this._map.extent,null,!0)}),
0)},onSuspend:function(){this.inherited(arguments);this._toggleTime();clearTimeout(this._displayTimer);this._displayTimer=null},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getCurrentResolution:function(){var p=this._map.extent;return new t((p.xmax-p.xmin)/this._map.width,(p.ymax-p.ymin)/this._map.height,p.spatialReference)},setPixelFilter:function(p,k){this.pixelFilter=p;k||this.redraw()},_toggleTime:function(){},_setMap:function(p,k){this.inherited(arguments);
this._dragOrigin={x:0,y:0};var x=this._div=c.create("div",null,k),C={width:p.width+"px",height:p.height+"px",position:"absolute"};"css-transforms"===p.navigationMode?(C[h._css.names.transform]=h._css.translate(p.__visibleDelta.x,p.__visibleDelta.y),this._left=p.__visibleDelta.x,this._top=p.__visibleDelta.y):this._left=this._top=0;e.set(x,C);this._canvas=c.create("canvas",{id:"canvas",width:p.width+"px",height:p.height+"px",style:"position: absolute;"},x);m.isDefined(this.opacity)&&e.set(x,"opacity",
this.opacity);(this._context=this._canvas.getContext(this.drawType))||console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");this._mapWidth=p.width;this._mapHeight=p.height;this._connects=[];this._connects.push(H.connect(p,"onPan",this,this._panHandler));this._connects.push(H.connect(p,"onPanEnd",this,this._panEndHandler));"css-transforms"===p.navigationMode?this._connects.push(H.connect(p,"onScale",this,this._onScaleHandler)):(this._connects.push(H.connect(p,
"onZoom",this,this._onZoomHandler)),this._connects.push(H.connect(p,"onZoomEnd",this,this._onZoomEndHandler)));this._connects.push(H.connect(p,"onResize",this,this._onResizeHandler));this._connects.push(H.connect(p,"onExtentChange",this,this._extentChangeHandler));this._connects.push(H.connect(this,"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(H.connect(this,"onOpacityChange",this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:p.width,height:p.height};
this.evaluateSuspension();if(this.suspended&&!p.loaded)var F=H.connect(p,"onLoad",this,function(){H.disconnect(F);F=null;this.evaluateSuspension()});return x},_unsetMap:function(p,k){d.forEach(this._connects,H.disconnect,this);var x=this._div;x&&(k.removeChild(x),c.destroy(x));this.updating&&p._jobs&&p._jobs--;this._rasterReadPromise&&this._rasterReadPromise.cancel();this._map=this._canvas=this._context=this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},
_canDraw:function(){return!!(this._map&&this._canvas&&this._context)},_requestDataErrorHandler:function(p){"CancelError"!==p.name&&(this.clear(),this.onError(p))},_drawPixelData:function(){if(this._map){this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};var p=this._useBrowserDecoding();!p&&this.drawMode||"css-transforms"!==this._map.navigationMode||(this._tdx=this._left,this._tdy=this._top,this._multiply=null,e.set(this._div,h._css.names.transform,h._css.translate(this._left,
this._top)),e.set(this._canvas,h._css.names.transform,h._css.translate(-this._left,-this._top)),this._dragOrigin={x:0,y:0});if(this._canDraw&&this.drawMode)if(p)this._fireUpdateEnd();else if(this.drawMode)if(this.pixelData&&this.pixelData.pixelBlock){p=this.pixelData.pixelBlock;var k=this._context,x=k.createImageData(p.width,p.height);x.data.set(p.getAsRGBA());var C=this.pixelData.extent,F=this._map.extent,P=this.getCurrentResolution(),M=0,J=0;Math.abs(C.xmin-F.xmin)>P.x&&(M=Math.round((C.xmin-F.xmin)/
P.x));Math.abs(F.ymax-C.ymax)>P.y&&(J=Math.round((F.ymax-C.ymax)/P.y));this.clear();"css-transforms"===this._map.navigationMode?(this._tdx=this._left,this._tdy=this._top,this._multiply=null,e.set(this._div,h._css.names.transform,h._css.translate(this._left,this._top)),e.set(this._canvas,h._css.names.transform,h._css.translate(-this._left,-this._top))):(e.set(this._div,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"}),e.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+
"px",height:this._map.height+"px"}));this._dragOrigin={x:0,y:0};k.putImageData(x,M,J,0,0,p.width,p.height);this._fireUpdateEnd()}else this.clear()}},_panHandler:function(p,k){"css-transforms"===this._map.navigationMode?(this._left=this._map.__visibleDelta.x+k.x,this._top=this._map.__visibleDelta.y+k.y,e.set(this._div,h._css.names.transform,h._css.translate(this._left,this._top))):e.set(this._div,{left:this._startRect.left+k.x+"px",top:this._startRect.top+k.y+"px"})},_panEndHandler:function(p,k){k&&
(this._startRect.left+=k.x,this._startRect.top+=k.y)},_onScaleHandler:function(p,k){var x={},C=h._css.names;e.set(this._canvas,C.transition,k?"none":C.transformName+" "+r+"ms ease");this._matrix=p;p=this._multiply?g.multiply(p,this._multiply):p;if(this._tdx||this._tdy)p=g.multiply(p,{xx:1,xy:0,yx:0,yy:1,dx:-this._tdx,dy:-this._tdy});x[C.transform]=h._css.matrix(p);e.set(this._canvas,x)},_onZoomHandler:function(p,k,x){var C=this._startRect;p=C.width*k;k*=C.height;var F=C.left-(p-C.width)*(x.x-C.left)/
C.width;x=C.top-(k-C.height)*(x.y-C.top)/C.height;e.set(this._canvas,{left:F+"px",top:x+"px",width:p+"px",height:k+"px"});this._endRect={left:F,top:x,width:p,height:k}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(p,k,x){e.set(this._div,{width:k+"px",height:x+"px"});e.set(this._canvas,{width:k+"px",height:x+"px"});this._startRect.width=this._canvas.width=k;this._startRect.height=this._canvas.height=x},_extentChangeHandler:function(p,k,x,C){this.suspended||
k&&0===k.x&&0===k.y&&!x||("css-transforms"===this._map.navigationMode&&(k&&(this._dragOrigin.x+=k.x,this._dragOrigin.y+=k.y),x||(this._left=this._map.__visibleDelta.x,this._top=this._map.__visibleDelta.y,e.set(this._div,h._css.names.transform,h._css.translate(this._left,this._top))),x&&(e.set(this._canvas,h._css.names.transition,"none"),this._multiply=this._multiply?g.multiply(this._matrix,this._multiply):this._matrix)),this._fireUpdateStart(),p=this._map,this._requestData(p.extent,p.width,p.height))},
_visibilityChangeHandler:function(p){p?l.show(this._div):l.hide(this._div)},_opacityChangeHandler:function(p){e.set(this._div,"opacity",p)}})})},"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query dojo/DeferredList ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ../renderers/colorRampUtils ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),
function(O,A,H,d,b,c,e,g,h,n,m,l,t,v,r,p,k,x,C,F,P,M,J,R,N,K,S,u,y,G,I,E){O=O(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_rasterFieldPrefix:"Raster.",_renderingRuleFieldSubPrefix:"ServicePixelValue.",_rasterFunctionServiceInfoProps:"bandCount pixelType hasRasterAttributeTable hasColormap hasHistograms minValues maxValues meanValues stdvValues serviceDataType".split(" "),_pixelTypeRanges:{U1:[0,1],U2:[0,3],U4:[0,15],U8:[0,255],S8:[-128,127],U16:[0,65535],S16:[-32768,32767]},_eventMap:{"rendering-change":!0,
"mosaic-rule-change":!0,"spatial-reference-change":!0,"renderer-change":!0},_cachedVariableStats:{},_cachedVariableHistogram:{},constructor:function(a,f){this.useMapTime=f&&f.hasOwnProperty("useMapTime")?!!f.useMapTime:!0},_initialize:function(a,f){this._url=p.urlToObject(a);this.raster=new R(this._url.path);this._rasterFunctionTemplateInfos={};this._customRenderingRuleId={};this.infoTemplate=f&&f.infoTemplate;this.format=(a=f&&f.imageServiceParameters)&&a.format;this.compressionTolerance=a&&a.compressionTolerance?
a.compressionTolerance:.01;this.interpolation=a?a.interpolation:null;this.compressionQuality=a?a.compressionQuality:null;this.bandIds=a?a.bandIds:null;this.mosaicRule=a?a.mosaicRule:null;this.renderingRule=a?a.renderingRule:null;this.renderer=a?a.renderer:null;this.useMapDimensionValue=f&&f.hasOwnProperty("useMapDimensionValue")?!!f.useMapDimensionValue:!0;this.hasImageFilter=f&&f.hasImageFilter;this.activeMapDimensions=f&&f.activeMapDimensions;this._params=A.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,
format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},a?a.toJson():{});this.pixelFilter=f&&f.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=A.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=A.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=A.hitch(this,this._initLayer);this._queryVisibleRastersHandler=A.hitch(this,this._queryVisibleRastersHandler);
this._visibleRasters=[];this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._renderingRuleAttributeTable={};this._renderingRuleColormap={};this._useRenderingRuleAttributeTable=!1;this._loadCallback=f&&f.loadCallback;a&&a.renderer&&(a.renderer.outputUnit||a.renderer.inputUnit)&&(this.vectorFieldPixelFilter=new K,this.vectorFieldPixelFilter.setUnits(a.renderer.inputUnit,a.renderer.outputUnit));(f=f&&f.resourceInfo)?this._initLayer(f):v({url:this._url.path,content:A.mixin({f:"json"},
this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(a,f){if(null!==a&&void 0!==a){this._findCredential();(this.credential&&this.credential.ssl||a&&a._ssl)&&this._useSSL();f=this.minScale;var q=this.maxScale;A.mixin(this,a);this.minScale=f;this.maxScale=q;this.initialExtent=this.fullExtent=this.extent=new k(a.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=
parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);var w=this.minValues,z=this.maxValues,D=this.meanValues,B=this.stdvValues,Q=this.bands=[];f=0;for(q=this.bandCount;f<q;f++)Q[f]={min:w[f],max:z[f],mean:D[f],stddev:B[f]};this.timeInfo=(f=this.timeInfo)&&f.timeExtent?new u(f):null;q=this.fields=[];if(w=a.fields)for(f=0;f<w.length;f++)q.push(new y(w[f]));this._updateInfoTemplateFields(this.fields);this.version=a.currentVersion;this.version||(this.version="fields"in a||"objectIdField"in
a||"timeInfo"in a?10:9.3);t.isDefined(a.minScale)&&!this._hasMin&&"Raster"!==a.cacheType&&this.setMinScale(a.minScale);t.isDefined(a.maxScale)&&!this._hasMax&&"Raster"!==a.cacheType&&this.setMaxScale(a.maxScale);f={};a.defaultMosaicMethod?(f.method=a.defaultMosaicMethod,f.operation=a.mosaicOperator,f.sortField=a.sortField,f.sortValue=a.sortValue):f.method=P.METHOD_NONE;this.defaultMosaicRule=new P(f);this.defaultMosaicRule.ascending=!0;this._useRenderingRuleAttributeTable=10<this.version&&"esriImageServiceDataTypeThematic"===
this.serviceDataType;this._setDefaultRenderingRule(!0);this._getRenderingRuleAttributeTableAndColormap();this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&this._setDefaultMultidimensionalDefinition(!0);10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(A.hitch(this,function(L){L&&(L.features&&L.fields&&(this.rasterAttributeTable=A.clone(L)),L.features&&0<L.features.length&&(this._rasterAttributeTableFeatures=
A.clone(L.features)),L.fields&&0<L.fields.length&&(this._rasterAttributeTableFields=A.clone(L.fields)),this.renderingRule||!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh())}));this._initVectorPixelFilter();this.bandIds||2!==this.bandCount||this.renderingRule||"esri.layers.ArcGISImageServiceLayer"!==this.declaredClass||this.setBandIds([0,0,0],!0);!(10.3<=this.version&&this.rasterFunctionInfos&&
this.rasterFunctionInfos.length)||this._url.query&&this._url.query.raster||this.getRasterFunctionInfos().then(A.hitch(this,function(L){if(L&&L.length){this.rasterFunctionInfos=L;var W=[],X;d.forEach(L,function(V){if(V){var T=V.functionType;X=X||1===T||2===T;W.push(V.name)}},this);this._hasItemLevelRFT=X;this._rasterFunctionNames=W;X&&(this._initVectorPixelFilter(),this.refresh())}}));this.loaded=!0;this._setDefaultFilter();this.onLoad(this);if(a=this._loadCallback)delete this._loadCallback,a(this)}},
_updateInfoTemplateFields:function(a){if(a&&!(1>a.length)&&this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.fieldInfos&&!(1>this.infoTemplate.info.fieldInfos.length)){var f,q;var w=this.infoTemplate.info.fieldInfos;for(f=0;f<a.length;f++){var z=a[f];for(q=0;q<w.length;q++)if(w[q].fieldName.toLowerCase()===z.name.toLowerCase()&&w[q].fieldName!==z.name){w[q].fieldName=z.name;break}}}},getKeyProperties:function(a){var f=this._url.path+"/keyProperties",q=new H(r._dfdCanceller),w={f:"json"};
a&&a.renderingRule&&(w.renderingRule=b.toJson(a.renderingRule.toJson()));10<this.version?(q._pendingDfd=v({url:f,content:w,handleAs:"json",callbackParamName:"callback"}),q._pendingDfd.then(function(z){q.callback(z)},function(z){q.errback(z)})):(a=Error("Layer does not have key properties"),a.log=!!c.isDebug,q.errback(a));return q},getRasterAttributeTable:function(a){var f=this._url.path+"/rasterAttributeTable",q=new H(r._dfdCanceller),w={f:"json"},z=this.hasRasterAttributeTable;a&&a.renderingRule&&
(w.renderingRule=b.toJson(a.renderingRule.toJson()),z=!0);!this.loaded||10<this.version&&z?(q._pendingDfd=v({url:f,content:w,handleAs:"json",callbackParamName:"callback"}),q._pendingDfd.then(function(D){q.callback(D)},function(D){q.errback(D)})):(a=Error("Layer does not support raster attribute table"),a.log=!!c.isDebug,q.errback(a));return q},getRenderingRuleAttributeTable:function(a){var f=new H(r._dfdCanceller);if(!a||!a.renderingRule)return f.errback(Error("Rendering rule is not specified")),
f;a=a.renderingRule;var q=this._getRenderingRuleId(a);this._renderingRuleAttributeTable&&q&&this._renderingRuleAttributeTable.hasOwnProperty(q)?f.resolve(this._renderingRuleAttributeTable[q]):f=this.getRasterAttributeTable({renderingRule:a}).then(A.hitch(this,function(w){if(w&&w.features&&w.features.length&&w.fields&&w.fields.length){var z={features:A.clone(w.features),fields:A.clone(w.fields)};q&&(this._renderingRuleAttributeTable[q]=z)}return z}));return f},_initVectorPixelFilter:function(){var a;
this._hasItemLevelRFT&&this.renderingRule&&(a=this._getItemLevelRenderingRule(this.renderingRule));if(a=a||this.renderingRule)return this.getRenderingRuleServiceInfo(a).then(A.hitch(this,function(f){!f||!this._isVectorData(f)&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass||t.isDefined(this.pixelFilter)||(this.vectorFieldPixelFilter=this.vectorFieldPixelFilter||new K,this.vectorFieldPixelFilter.isDataUV="esriImageServiceDataTypeVector-UV"===f.serviceDataType,this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,
this.getKeyProperties().then(A.hitch(this,this._setFlowRepresentation)),this._applyVectorResamplingType(f.serviceDataType))}))},_applyVectorResamplingType:function(a){if(a){var f=this.renderingRule;f&&"Resample"===f.functionName&&((f.functionArguments||{}).ResamplingType="esriImageServiceDataTypeVector-UV"===a?7:10,this.setRenderingRule(new M(f.toJson())))}},_getRasterAttributeTableFeatures:function(){var a=new H;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),
a;if(10<this.version&&this.hasRasterAttributeTable)return a=this.getRasterAttributeTable(),a.then(A.hitch(this,function(f){f&&f.features&&0<f.features.length&&(this._rasterAttributeTableFeatures=A.clone(f.features))})),a;a.resolve(this._rasterAttributeTableFeatures);return a},_getRenderingRuleAttributeTableFeatures:function(a){a=a&&a.renderingRule;return a?this.getRenderingRuleAttributeTable({renderingRule:a}).then(function(f){return f&&f.features}):(a=new H,a.errback(Error("Rendering rule is not specified")),
a)},_getRenderingRuleAttributeTableAndColormap:function(){this.renderingRule&&this.getRenderingRuleServiceInfo(this.renderingRule).then(A.hitch(this,function(a){a.hasRasterAttributeTable&&this.getRenderingRuleAttributeTable({renderingRule:this.renderingRule}).then(A.hitch(this,function(){!this.renderer||"esri.renderer.ClassBreaksRenderer"!==this.renderer.declaredClass&&"esri.renderer.UniqueValueRenderer"!==this.renderer.declaredClass||this.refresh()}));a.hasColormap&&this.getRenderingRuleColormap({renderingRule:this.renderingRule}).then(A.hitch(this,
function(){this.renderer&&"esri.renderer.ColormapRenderer"===this.renderer.declaredClass&&this.refresh()}))}))},getCustomRasterFields:function(a){var f=a?a.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix;a=10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString";var q={name:this._rasterFieldPrefix+"ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:a},w={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,
length:50,type:a},z={name:this._rasterFieldPrefix+"ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"},D=this.fields?A.clone(this.fields):[];a=D.length;D[a]=w;10.4<=this.version&&"esri.layers.ArcGISImageServiceLayer"===this.declaredClass&&(!this.rasterFunctionInfos||!this.rasterFunctionInfos.length||this._isRenderingRuleAProcessingTemplate({functionName:"none"}))&&(a++,D[a]=z);if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||
this.fields&&0<this.fields.length)a++,D[a]=q;!t.isDefined(this.pixelFilter)||"esriImageServiceDataTypeVector-UV"!==this.serviceDataType&&"esriImageServiceDataTypeVector-MagDir"!==this.serviceDataType||(q={name:this._rasterFieldPrefix+"Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},w={name:this._rasterFieldPrefix+"Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"},a++,D[a]=q,a++,D[a]=w);a=this._rasterAttributeTableFields;(q=this.renderingRule&&
this._getRenderingRuleId(this.renderingRule))&&this._renderingRuleAttributeTable&&this._renderingRuleAttributeTable.hasOwnProperty(q)&&(a=this._renderingRuleAttributeTable[q].fields);a&&0<a.length&&(a=d.filter(a,function(Q){return"esriFieldTypeOID"!==Q.type&&"value"!==Q.name.toLowerCase()}),a=d.map(a,function(Q){var L=A.clone(Q);L.name=f+Q.name;return L}),D=D.concat(a));var B=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;10.4<=this.version&&this.rasterFunctionInfos&&d.forEach(this.rasterFunctionInfos,
function(Q){Q&&Q.name&&"none"!==Q.name.toLowerCase()&&(Q={name:B+Q.name.replace(/ /gi,"_"),alias:Q.name,domain:null,editable:!1,type:"esriFieldTypeDouble"},D.push(Q))});return D},_applyTimeToMultidimensionalCRF:function(a,f){var q=this._isTimeSupportedOnCRF();if(q&&(!a||!a.multidimensionalDefinition))return a;var w=this.timeInfo&&this.timeInfo.startTimeField;if((f=f||this._params.time)&&w&&this._isMultidimensionalCRF()){a=A.clone(a||this.defaultMosaicRule)||new P;a.multidimensionalDefinition=a.multidimensionalDefinition||
[];var z=a.multidimensionalDefinition.filter(function(B){return B.dimensionName===w}),D=f.split(",").map(function(B){return parseInt(B,10)});2===D.length&&D[0]===D[1]&&(D.length=1);0<z.length?q?a.multidimensionalDefinition.forEach(function(B){B.dimensionName===w&&(B.dimensionName=null,B.isSlice=null,B.values=null)}):a.multidimensionalDefinition.forEach(function(B){B.dimensionName===w&&(B.isSlice=1===D.length,B.values=1===D.length?D:[D])}):q||(a.multidimensionalDefinition.some(function(B){return null!=
B.variableName&&null==B.dimensionName})?a.multidimensionalDefinition.forEach(function(B){null!=B.variableName&&null==B.dimensionName&&(B.dimensionName=w,B.isSlice=1===D.length,B.values=1===D.length?D:[D])}):a.multidimensionalDefinition.push(new J({variableName:"",dimensionName:w,isSlice:1===D.length,values:1===D.length?D:[D]})));this._cleanupMultidimensionalDefinition(a)}return a},_prepareGetImageParameters:function(a,f,q,w){w=t.isDefined(w)?w:this._params;if(this.renderer||this._hasItemLevelRFT&&
this.renderingRule){var z=this.getExportImageRenderingRule();w.renderingRule=z?b.toJson(z.toJson()):null}z=this.getExportImageMosaicRule(w);w.mosaicRule=z?b.toJson(z.toJson()):null;z=a.spatialReference.wkid||b.toJson(a.spatialReference.toJson(!1));delete w._ts;A.mixin(w,{bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,imageSR:z,bboxSR:z,size:f+","+q},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete w.compressionTolerance;w.format&&"LERC"===w.format.toUpperCase()&&(w.compressionTolerance=
this.compressionTolerance);w.token=this._getToken()},getImageUrl:function(a,f,q,w,z){z=t.isDefined(z)?z:this._params;this._prepareGetImageParameters(a,f,q,z);a=A.clone(z);this._cleanupRequestParams(a);f=this._url.path+"/exportImage?";q=p.addProxy(f+h.objectToQuery(A.mixin(a,{f:"image"})));var D=a.token;q.length>l.defaults.io.postLength||this.useMapImage?this._jsonRequest=v({url:f,content:A.mixin(a,{f:"json"}),callbackParamName:"callback",load:function(B,Q){B=B.href;D&&(B+=-1===B.indexOf("?")?"?token\x3d"+
D:"\x26token\x3d"+D);w(p.addProxy(B))},error:this._errorHandler}):w(q)},onRenderingChange:function(){},onMosaicRuleChange:function(){},onRendererChange:function(){},setInterpolation:function(a,f){this.interpolation=this._params.interpolation=a;f||this.refresh(!0)},setCompressionQuality:function(a,f){this.compressionQuality=this._params.compressionQuality=a;f||this.refresh(!0)},setCompressionTolerance:function(a,f){this.compressionTolerance=a;f||this.refresh(!0)},setBandIds:function(a,f){var q=!1;
this.bandIds!==a&&(q=!0);this.bandIds=a;this._params.bandIds=a?a.join(","):null;if(q&&!f)this.onRenderingChange();f||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;a||this.refresh(!0)},setDisableClientCaching:function(a){this.disableClientCaching=a},setMosaicRule:function(a,f){var q=!1;this.mosaicRule!==a&&(q=!0);this.mosaicRule=a;this._params.mosaicRule=b.toJson(a.toJson());if(q&&!f)this.onMosaicRuleChange();f||this.refresh(!0)},getRasterFunctionInfos:function(){if(10.3>
this.version||!this.rasterFunctionInfos||!this.rasterFunctionInfos.length)console.log("Layer doesn't support /rasterFunctionInfos resource.");else return v({url:this._url.path+"/rasterFunctionInfos",content:{f:"json"},handleAs:"json",load:function(a){return a&&a.rasterFunctionInfos}})},setRenderingRule:function(a,f){var q=!1;this.renderingRule!==a&&(q=!0);this.renderingRule=a;this._params.renderingRule=a?b.toJson(a.toJson()):null;this._useRenderingRuleAttributeTable?this.getRenderingRuleAttributeTable({renderingRule:a}):
"esri.layers.RasterXLayer"!==this.declaredClass&&this._getRenderingRuleAttributeTableAndColormap();if(q)this.onRenderingChange();this._setDefaultFilter();f||this.refresh(!0)},setImageFormat:function(a,f){this.format=this._params.format=a;this._setDefaultFilter();f||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=a;this._updateInfoTemplateFields(this.fields)},setDefinitionExpression:function(a,f){var q=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?
q=this.defaultMosaicRule.toJson():q.method=P.METHOD_NONE);q.where=a;a=new P(q);this.setMosaicRule(a,f);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},setPixelFilter:function(a){this.pixelFilter=a;this._isDefaultPixelFilter=!1},getPixelData:function(a){return a?(this._useBrowserDecoding()&&(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):
this.pixelData},getExportImageRenderingRule:function(){var a;this._hasItemLevelRFT&&this.renderingRule&&(a=this._getServiceLevelRenderingRule(this.renderingRule));a=a||this.renderingRule;this._isItemLevelRasterFunction(this.renderingRule)&&(a=void 0);return this._combineRenderingRule(this._convertRendererToRenderingRule(this.renderer),a)},getExportImageMosaicRule:function(){var a=this.mosaicRule,f;this._hasItemLevelRFT&&this.renderingRule&&(f=this._getItemLevelRenderingRule(this.renderingRule));f&&
(a=a||this.defaultMosaicRule||new P,a.itemRenderingRule=f);return a=this._applyTimeToMultidimensionalCRF(a)},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},getHistograms:function(a){var f=new H(r._dfdCanceller);if(a&&this._cachedVariableHistogram[a])return f.resolve(this._cachedVariableHistogram[a]),f;if(this.hasHistograms){var q={f:"json"};a&&(q.variable=a);f._pendingDfd=v({url:this._url.path+"/histograms",content:q,handleAs:"json",callbackParamName:"callback"});
f._pendingDfd.then(A.hitch(this,function(w){a&&(this._cachedVariableHistogram[a]=w);f.callback(w)}),function(w){f.errback(w)})}else q=Error("Layer does not have histograms."),q.log=!!c.isDebug,f.errback(q);return f},computeHistograms:function(a){var f=new H(r._dfdCanceller);if(10.1<=this.currentVersion){a=a||{};var q=a.geometry||this.fullExtent,w=(a.geometry||this.fullExtent).toJson();q="extent"===q.type?"esriGeometryEnvelope":"esriGeometryPolygon";var z=a.renderingRule||this.renderingRule||this.defaultRenderingRule;
z=z?z.toJson():null;var D=a.mosaicRule||this.mosaicRule||this.defaultMosaicRule;D=D?D.toJson():null;a=a.pixelSize||{x:this.pixelSizeX,y:this.pixelSizeY};f._pendingDfd=v({url:this._url.path+"/computeHistograms",content:A.mixin({f:"json",geometry:JSON.stringify(w),geometryType:q,renderingRule:JSON.stringify(z),mosaicRule:JSON.stringify(D),pixelSize:JSON.stringify(a),callbackParamName:"callback"}),handleAs:"json"});f._pendingDfd.then(function(B){f.callback(B)},function(B){f.errback(B)})}else w=Error("Layer doesn't support computeHistograms."),
w.log=!!c.isDebug,f.errback(w);return f},getRenderingRuleServiceInfo:function(a,f){function q(D){return D.name&&D.arguments&&D.function&&D.hasOwnProperty("functionType")}var w=new r._fixDfd(new H(r._dfdCanceller));if(!a)return w.errback(Error("Rendering rule is not specified")),w;if(q(a))"ClipFunction"===a.function.type&&(a=this._handleClipFunctionInRenderingRule(a));else{var z=this._getRenderingRuleId(a);if(z&&this._rasterFunctionTemplateInfos[z])return w.resolve(this._rasterFunctionTemplateInfos[z]),
w}return v({url:this._url.path,content:A.mixin(A.mixin({f:"json",renderingRule:JSON.stringify(a.toJson())},this._url.query)),callbackParamName:"callback",load:A.hitch(this,function(D){var B={};d.forEach(this._rasterFunctionServiceInfoProps,function(Q){B[Q]=D[Q]});q(a)||(this._rasterFunctionTemplateInfos[z]=B);return B}),error:f||this._errorHandler})},queryVisibleRasters:function(a,f,q,w){var z=this._map,D=r._fixDfd(new H(r._dfdCanceller));this._visibleRasters=[];var B,Q,L=!0,W=!0,X=null,V=this.infoTemplate?
this.infoTemplate.info:null,T=V?A.clone(this.infoTemplate.info.fieldInfos):null;f=f||{};if(V&&this.infoTemplate.info.mediaInfos&&this.infoTemplate.info.mediaInfos.length){var Y=[];d.forEach(this.infoTemplate.info.mediaInfos,function(U){Y=Y.concat(U&&U.value&&U.value.fields||[])});Y.length&&d.forEach(T,function(U){U&&-1<Y.indexOf(U.fieldName)&&(U.visible=!0)})}var ea=function(U){var ja=V&&V.title&&-1<V.title.toLowerCase().indexOf(U.toLowerCase());U=V&&V.description&&-1<V.description.toLowerCase().indexOf(U.toLowerCase());
return ja||U};if(T&&0<T.length)for(L=!1,B=0;B<T.length;B++)if((Q=T[B])&&Q.fieldName.toLowerCase()!==this._rasterFieldPrefix.toLowerCase()+"servicepixelvalue"&&(Q.visible||ea(Q.fieldName))){L=!0;break}this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("returnTopmostRaster")&&(X=this.infoTemplate.info.layerOptions.returnTopmostRaster?1:null);T&&0<T.length&&(W=!1,d.some(T,function(U){if(U&&U.fieldName.toLowerCase()===this._rasterFieldPrefix.toLowerCase()+
"itempixelvalue"&&U.visible)return W=!0},this),ea(this._rasterFieldPrefix.toLowerCase()+"itempixelvalue")&&(W=!0));var fa=(Q=this._removeVisualizationStretchFunction(this.renderingRule))&&Q.functionName,ha=[];if(10.4<=this.version){var aa=!1;if(this.rasterFunctionInfos&&T){var ia=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;d.forEach(this.rasterFunctionInfos,function(U){var ja=ia+U.name.replace(/ /gi,"_");d.some(T,function(qa){return qa.visible&&qa.fieldName===ja})&&(aa=aa||fa&&fa===
U.name,ha.push(new M({rasterFunction:U.name})))})}Q&&!aa&&ha.push(Q)}B=new E;B.geometry=a.geometry;B.returnGeometry=this._map.spatialReference.equals(this.spatialReference);B.returnCatalogItems=L;B.timeExtent=this.timeInfo?a.timeExtent:null;B.returnPixelValues=W;B.maxItemCount=X||a.maxItemCount;this._params.time&&this.mosaicRule?(a=A.clone(this.mosaicRule),a=this._filterOutTimeDimension(a),B.mosaicRule=a):B.mosaicRule=this.mosaicRule||null;this._isMultidimensionalCRF()&&B.timeExtent&&(B.mosaicRule=
this._applyTimeToMultidimensionalCRF(B.mosaicRule,B.timeExtent.toJson().join(",")),this._isTimeSupportedOnCRF()||delete B.timeExtent);B.renderingRule=10.4>this.version&&Q||null;B.renderingRules=ha||null;10.8>this.version&&(B.returnPixelValues=void 0,B.maxItemCount=void 0);z&&(z=new x((z.extent.xmax-z.extent.xmin)/z.width,(z.extent.ymax-z.extent.ymin)/z.height,z.extent.spatialReference),B.pixelSize=z);f.requestParams=B;var Z=this;z=new I(this.url);(D._pendingDfd=z.execute(B)).addCallbacks(function(U){Z._queryVisibleRastersHandler(U,
f,q,w,D)},function(U){Z._resolve([U],null,w,D,!0)});return D},_queryVisibleRastersHandler:function(a,f,q,w,z){function D(){var ba=this.getCustomRasterFields(f),ma=this._getDomainFields(ba),ua=f?f.returnDomainValues:!1,Ba=f&&f.rasterAttributeTableFieldPrefix,ka,va,ra,wa,la,sa,Ca,xa,ya,za;ba=(ba=this._getRenderingRuleId(this.renderingRule))&&this._rasterFunctionTemplateInfos[ba];this.renderingRule&&(this._useRenderingRuleAttributeTable||ba)?(ba=this._getRenderingRuleAttributeTableFeatures({renderingRule:this.renderingRule}),
this.hasRasterAttributeTable||(za=B)):ba=this._getRasterAttributeTableFeatures();ba.then(A.hitch(this,function(Aa){for(ka=0;ka<Z.length;ka++){da=Z[ka];da.setInfoTemplate(this.infoTemplate);da._layer=this;if(B){ya=B.replace(/ /gi,"").split(",");va=B;ra=ya;U&&U.length>=ka&&(va=U[ka].replace(/ /gi,", "),ra=U[ka].split(" "));da.attributes[this._rasterFieldPrefix+"ItemPixelValue"]=ra;da.attributes[this._rasterFieldPrefix+"ServicePixelValue"]=ya;Q&&(da.attributes[this._rasterFieldPrefix+"ServicePixelValue.Raw"]=
Q.replace(/ /gi,"").split(","));if(this.pixelFilter){var ta=new N({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]});d.forEach(ra,function(ca){ta.addData({pixels:[ca],statistics:{minValue:ca,maxValue:ca,noDataValue:null}})});this.pixelFilter({pixelBlock:ta,extent:new k(0,0,0,0,this._map.spatialReference)});if("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)da.attributes[this._rasterFieldPrefix+"Magnitude"]=ta.pixels[0][0],
da.attributes[this._rasterFieldPrefix+"Direction"]=ta.pixels[1][0]}d.forEach(T,function(ca){da.attributes[ca.name]=ca.value});var Da=0<this.fields.length?za||va:za||Q;if(Aa&&0<Aa.length&&(wa=d.filter(Aa,function(ca){if(ca&&ca.attributes)return ca.attributes.hasOwnProperty("Value")?ca.attributes.Value==Da:ca.attributes.VALUE==Da}),0<wa.length&&(la=A.clone(wa[0]),Ba&&la))){xa={};for(sa in la.attributes)la.attributes.hasOwnProperty(sa)&&(Ca=Ba+sa,xa[Ca]=la.attributes[sa]);la.attributes=xa;da.attributes=
A.mixin(da.attributes,la.attributes)}}ua&&ma&&0<ma.length&&d.forEach(ma,function(ca){if(ca){var na=da.attributes[ca.name];t.isDefined(na)&&(na=this._getDomainValue(ca.domain,na),t.isDefined(na)&&(da.attributes[ca.name]=na))}},this);oa.push(da);this._visibleRasters.push(da)}this._resolve([oa,null,!0],null,q,z)}))}var B=a.value,Q=a.value,L=0,W=0,X=this,V=this.objectIdField,T=[];w=f.requestParams.renderingRules;var Y=a.processedValues,ea=this.renderingRule&&b.toJson(this._removeVisualizationStretchFunction(this.renderingRule).toJson());
if(w&&Y&&w.length===Y.length){var fa=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;d.forEach(w,function(ba,ma){if(ba.functionName){var ua={name:fa+ba.functionName.replace(/ /gi,"_"),value:Y[ma].replace(/ /gi,"").split(",")};T.push(ua);ea&&ea===b.toJson(ba.toJson())&&(B=Y[ma])}})}w=this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?this.infoTemplate.info.layerOptions.showNoDataRecords:!0;
if(a.catalogItems){var ha=0,aa=a.catalogItems.features.length;var ia=0;var Z=Array(aa);var U=Array(aa);var ja=Array(aa);if(a.properties&&a.properties.Values){aa=a.properties.Values.length;for(L=0;L<aa;L++)-1<a.properties.Values[L].toLowerCase().indexOf("nodata")&&ia++;var qa=aa-ia;for(L=0;L<aa;L++){ia=!0;if(-1<a.properties.Values[L].toLowerCase().indexOf("nodata")){var pa=qa++;w||(ia=!1,Z.length--,U.length--,ja.length--)}else pa=ha++;ia&&(Z[pa]=a.catalogItems.features[L],U[pa]=a.properties.Values[L],
ja[pa]=Z[pa].attributes[V])}}else{for(L=0;L<aa;L++)Z[L]=a.catalogItems.features[L],ja[L]=Z[L].attributes[V];U=null}}this._visibleRasters=[];(a=-1<B.toLowerCase().indexOf("nodata"))&&!w&&(Z=[],U=[],ja=[]);if(B&&!Z&&!a){V="ObjectId";Z=[];var da=new G(new k(this.fullExtent),null,{ObjectId:0});Z.push(da)}var oa=[];Z?!this._map.spatialReference.equals(this.spatialReference)&&ja&&0<ja.length?v({url:this._url.path+"/query",content:{f:"json",objectIds:ja.join(","),returnGeometry:!0,outSR:b.toJson(X._map.spatialReference.toJson()),
outFields:V},handleAs:"json",callbackParamName:"callback",load:function(ba){if(0===ba.features.length)X._resolve([oa,null,null],null,q,z);else{for(L=0;L<ba.features.length;L++)for(W=0;W<Z.length;W++)Z[W].attributes[V]==ba.features[L].attributes[V]&&(Z[W].geometry=new C(ba.features[L].geometry),Z[W].geometry.setSpatialReference(X._map.spatialReference));D.call(X)}},error:function(ba){X._resolve([oa,null,null],null,q,z)}}):D.call(this):this._resolve([oa,null,null],null,q,z)},getVisibleRasters:function(){var a=
this._visibleRasters,f=[],q;for(q in a)a.hasOwnProperty(q)&&f.push(a[q]);return f},_getDomainFields:function(a){if(a){var f=[];d.forEach(a,function(q){if(q.domain){var w={};w.name=q.name;w.domain=q.domain;f.push(w)}});return f}},_getDomainValue:function(a,f){if(a&&a.codedValues){var q;d.some(a.codedValues,function(w){return w.code===f?(q=w.name,!0):!1});return q}},_requestData:function(a,f,q){this._rasterReadPromise&&this._rasterReadPromise.cancel();a=A.clone(a);var w=a._normalize(!0);this._prepareGetImageParameters(w,
f,q);f=A.clone(this._params);this._cleanupRequestParams(f);f.extent=a;f.format=f.format||(10.3<=this.version?"lerc":"jpgpng");"lerc"===f.format.toLowerCase()&&!f.lercVersion&&10.5<=this.version&&(f.lercVersion=2);this._params.time&&this._isMultidimensionalCRF()&&!this._isTimeSupportedOnCRF()&&delete f.time;q=null;this._useBrowserDecoding()&&(q=new S({ctx:this._context}));f={imageServiceParameters:f,nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,decodeFunc:q?A.hitch(q,"decode"):null};this._rasterReadPromise=
this.raster.read(f,this._requestDataHandler,this._requestDataErrorHandler)},_requestDataHandler:function(a){this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this.originalPixelData=a,this.hasDataChanged=!0,this._setPixelData(a))},_setPixelData:function(a){a=this._clonePixelData(a);this.pixelFilter&&this.pixelFilter(a);this.pixelData=a;this._rasterReadPromise&&this._rasterReadPromise.isCanceled()||(this._drawPixelData(),this._rasterReadPromise=null)},_clonePixelData:function(a){if(null===
a||void 0===a)return a;var f={};a.extent&&(f.extent=A.clone(a.extent));a=a.pixelBlock;if(null===a||void 0===a)return f;f.pixelBlock=a.clone();return f},_setDefaultFilter:function(){},_getPixelBlockFromCanvas:function(a,f,q){a=a.getImageData(0,0,f,q).data;var w=f*q,z=0,D=0,B=new Uint8Array(w),Q=new Uint8Array(w),L=new Uint8Array(w),W=new Uint8Array(w),X=Infinity,V=Infinity,T=Infinity,Y=-Infinity,ea=-Infinity,fa=-Infinity;for(z=0;z<w;z++){var ha=a[D++];var aa=a[D++];var ia=a[D++];X=X<ha?X:ha;Y=Y>ha?
Y:ha;V=V<aa?V:aa;ea=ea>aa?ea:aa;T=T<ia?T:ia;fa=fa>ia?fa:ia;B[z]=ha;Q[z]=aa;L[z]=ia;W[z]=a[D++]&1}return new N({width:f,height:q,pixels:[B,Q,L],pixelType:"U8",mask:W,statistics:[{minValue:X,maxValue:Y},{minValue:V,maxValue:ea},{minValue:T,maxValue:fa}]})},_useBrowserDecoding:function(){return(void 0===this.pixelFilter||null===this.pixelFilter)&&("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},getMultidimensionalInfo:function(){var a=
this._url.path+"/multiDimensionalInfo",f=new H(r._dfdCanceller);if(this._multidimensionalInfo)return f.resolve(this._multidimensionalInfo),f;!this.loaded||10.3<=this.version&&this.hasMultidimensions?(f._pendingDfd=v({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),f._pendingDfd.then(A.hitch(this,function(q){this._multidimensionalInfo=q.multidimensionalInfo;f.callback(q.multidimensionalInfo)}),function(q){f.errback(q)})):(a=Error("Layer does not support multidimensional info"),
a.log=!!c.isDebug,f.errback(a));return f},getStatistics:function(a){var f=new H(r._dfdCanceller);if(a&&this._cachedVariableStats[a])f.resolve(this._cachedVariableStats[a]);else{var q={f:"json"};a&&(q.variable=a);f._pendingDfd=v({url:this._url.path+"/statistics",content:q,handleAs:"json",callbackParamName:"callback"});f._pendingDfd.then(A.hitch(this,function(w){w=w.statistics||w.statitsics;var z=[];w&&w[0]&&null!=w[0].min?w.forEach(function(D){z.push([D.min,D.max,D.mean,D.standardDeviation])}):z=this.minValues&&
this.minValues.length?this.minValues.map(function(D,B){return[D,this.maxValues[B],this.meanValues[B],this.stdvValues[B]]}.bind(this)):w;a&&(this._cachedVariableStats[a]=z);f.callback(z)}),function(w){f.errback(w)})}return f},getDefaultMultidimensionalDefinition:function(){var a=new H(r._dfdCanceller);if(this._defaultMultidimensionalDefinition)return a.resolve(A.clone(this._defaultMultidimensionalDefinition)),a;a._pendingDfd=this.getMultidimensionalInfo();a._pendingDfd.then(A.hitch(this,function(f){f=
this._getDefaultMultidimensionalDefinition(f);a.callback(f)}),function(f){a.errback(f)});return a},_getDefaultMultidimensionalDefinition:function(a,f,q){var w,z=[],D=this.defaultVariable||"",B=D.length?a.variables.filter(function(Q){return Q.name===D})[0].dimensions:a.variables[0].dimensions;q&&(D=this.defaultVariable||a.variables[0].name);for(w in B)B.hasOwnProperty(w)&&(f||"StdTime"!==B[w].name)&&(a=B[w],z.push(new J({variableName:D,dimensionName:a.name,isSlice:!a.hasRanges,values:[this._getDefaultDimensionValue(a)]})));
this._defaultMultidimensionalDefinition=z;return A.clone(z)},_getDefaultDimensionValue:function(a){if(a&&a.values&&a.values.length){var f=Infinity,q;if(a.hasRanges)return a.values[0];if(a.name&&"stdz"===a.name.toLowerCase()){for(q=0;q<a.values.length;q++){var w=a.values[q];var z=Math.abs(w-0);if(z<f){f=z;var D=w}if(0===z)break}return D}return a.extent[0]}},_setDefaultMultidimensionalDefinition:function(a){var f,q={};this.getDefaultMultidimensionalDefinition().then(A.hitch(this,function(w){f=w;0<f.length&&
(this.mosaicRule?(q=A.clone(this.mosaicRule),q.multidimensionalDefinition=f):this.defaultMosaicRule?(q=A.clone(this.defaultMosaicRule),q.multidimensionalDefinition=f):q=new P({multidimensionalDefinition:f}),this.setMosaicRule(q,a))}))},_setDefaultRenderingRule:function(a){var f={},q=this.renderingRule;if(!q&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass&&!this.bandIds&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&"none"!==this.rasterFunctionInfos[0].name.toLowerCase())f.rasterFunction=
this.rasterFunctionInfos[0].name;else if("esri.layers.ArcGISImageServiceVectorLayer"===this.declaredClass&&10.3<this.version&&(!q||"Resample"!==q.functionName)){var w="esriImageServiceDataTypeVector-UV"===this.serviceDataType?7:10;f.rasterFunction="Resample";f.rasterFunctionArguments={ResamplingType:w,InputCellSize:{x:this.pixelSizeX,y:this.pixelSizeY}};q&&(f.rasterFunctionArguments.Raster=q.toJson())}f.hasOwnProperty("rasterFunction")&&(this.defaultRenderingRule=new M(f),this.setRenderingRule(this.defaultRenderingRule,
a))},_cleanupRequestParams:function(a){if(!a)return a;if(a.time&&a.mosaicRule){var f=new P(b.fromJson(a.mosaicRule));f=this._filterOutTimeDimension(f);a.mosaicRule=b.toJson(f.toJson())}f="displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent renderer".split(" ");for(var q in f)a.hasOwnProperty(f[q])&&delete a[f[q]];return a},_filterOutTimeDimension:function(a){if(this._isMultidimensionalCRF())return a;if(a&&a.multidimensionalDefinition&&0<a.multidimensionalDefinition.length){var f=
d.filter(a.multidimensionalDefinition,function(q){return"StdTime"!==q.dimensionName});a.multidimensionalDefinition=f}return a},_removeVisualizationStretchFunction:function(a){var f=a&&a.functionName;if(!f||"stretch"!==f.toLowerCase())return a;var q=a.functionArguments.Raster;return q&&q.functionName&&d.some(this.rasterFunctionInfos,function(w){return q.functionName===w.name})?q:a},_isMultidimensionalCRF:function(){return 10.71<=this.version&&this.hasMultidimensions&&this.timeInfo&&!(this.objectIdField&&
this.fields&&1<this.fields.length)},_isTimeSupportedOnCRF:function(){return 10.8<=this.version},_cleanupMultidimensionalDefinition:function(a){a&&a.multidimensionalDefinition&&(a.multidimensionalDefinition=a.multidimensionalDefinition.filter(function(f){return!(!f.variableName&&!f.dimensionName)}),0===a.multidimensionalDefinition.length&&(a.multidimensionalDefinition=null))},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===
this.serviceDataType||"esriImageServiceDataTypeScientific"===this.serviceDataType||this.hasMultidimensions},_isVectorData:function(a){a=(a=a||this)&&a.serviceDataType;return"esriImageServiceDataTypeVector-UV"===a||"esriImageServiceDataTypeVector-MagDir"===a},_isRenderingRuleAProcessingTemplate:function(a){var f=a&&a.functionName;return!f||a.functionArguments?!1:d.some(f&&(this.rasterFunctionInfos||[]),function(q){return q&&q.name&&q.name.toLowerCase()===f.toLowerCase()})},_getRenderingRuleId:function(a){var f=
a&&a.functionName;if(f){if(this._isRenderingRuleAProcessingTemplate(a))return f;var q=this._customRenderingRuleId[f];if(q){if(q!==a){for(var w in this._customRenderingRuleId)if(this._customRenderingRuleId[w]===a)return w;for(q=0;this._customRenderingRuleId[z];)q+=1;var z;this._customRenderingRuleId[f+q]=a}}else this._customRenderingRuleId[f]=a;return f}},_createPixelData:function(a){a=new N({width:2,height:2,pixels:a,pixelType:this.pixelType,statistics:a});var f=this.fullExtent.getCenter();f=new k(f.x,
f.y,f.x+this.pixelSizeX,f.y+this.pixelSizeY,this.spatialReference);return{pixelBlock:a,extent:f}},_convertRendererToRenderingRule:function(a){var f=a&&a.declaredClass;if(!f||"esri.renderer.UniqueValueRenderer"!==f&&"esri.renderer.ClassBreaksRenderer"!==f&&"esri.renderer.StretchRenderer"!==f&&"esri.renderer.ShadedReliefRenderer"!==f&&"esri.renderer.ColormapRenderer"!==f)return null;var q=null;"esri.renderer.StretchRenderer"===f?q=a.toRenderingRule({convertToColormap:10.6>this.version}):"esri.renderer.ClassBreaksRenderer"===
f?q=this._convertClassifyRenderer(a):"esri.renderer.UniqueValueRenderer"===f?q=this._convertUniqueValueRenderer(a):"esri.renderer.ShadedReliefRenderer"===f?q=this._convertShadedReliefRenderer(a):"esri.renderer.ColormapRenderer"===f&&(q=this._convertColormapRenderer(a));return q},_getValueField:function(a){if(a&&a.length){var f,q;d.some(a,function(w){if((q=w.name)&&"value"===q.toLowerCase())return f=q,!0});return f}},_convertColormapRenderer:function(a){var f=new M;f.functionName="Colormap";f.functionArguments=
{};a=a.colormapInfos.map(function(q){return[q.value].concat(q.color)});f.functionArguments.Colormap=a;return f},_convertShadedReliefRenderer:function(a){var f=new M;f.functionName="Hillshade";var q="traditional"===a.hillshadeType?0:1,w="none"===a.scalingType?1:3,z={HillshadeType:q,SlopeType:w,ZFactor:a.zFactor};0===q&&(z.Azimuth=a.azimuth,z.Altitude=a.altitude);3===w&&(z.PSPower=a.pixelSizePower,z.PSZFactor=a.pixelSizeFactor);f.functionArguments=z;f.variableName="Raster";a.colorRamp&&(f.functionName=
"ShadedRelief",z.Colormap=F.convertColorRampToColormap(a.colorRamp,256));return f},_convertClassifyRenderer:function(a){var f=[],q=[],w=[],z=[],D;var B=this.renderingRule&&this._getRenderingRuleId(this.renderingRule);var Q=this.hasRasterAttributeTable;if(B){Q=this._rasterFunctionTemplateInfos[B]?this._rasterFunctionTemplateInfos[B].hasRasterAttributeTable:this.hasRasterAttributeTable;var L=this._renderingRuleAttributeTable[B];var W=this._rasterFunctionTemplateInfos[B]}var X=L&&L.features?L.features:
this._rasterAttributeTableFeatures;var V=this._getValueField(L&&L.fields?L.fields:this._rasterAttributeTableFields);Q&&X?(d.forEach(a.infos,function(T,Y){var ea,fa=T.symbol.color;fa.a&&d.forEach(X,function(ha){ea=ha.attributes[a.attributeField];(ea>=T.minValue&&ea<T.maxValue||Y===a.infos.length-1&&ea>=T.minValue)&&z.push([ha.attributes[V],fa.r,fa.g,fa.b])},this)},this),B=W&&W.pixelType||this.pixelType,this._adjustColormapToPixelTypeRange(z,B),B=new M,B.functionName="Colormap",B.functionArguments=
{},B.functionArguments.Colormap=z,B.variableName="Raster"):(d.forEach(a.infos,function(T,Y){D=T.symbol&&T.symbol.color;D.a?(0===Y?f.push.call(f,T.minValue,T.maxValue+1E-4):f.push.call(f,T.minValue+1E-4,T.maxValue+1E-4),q.push(Y),z.push([Y,D.r,D.g,D.b])):w.push(T.minValue,T.maxValue)}),B=W&&W.pixelType||this.pixelType,this._adjustColormapToPixelTypeRange(z,B),B=new M,B.functionName="Remap",B.functionArguments={InputRanges:f,OutputValues:q,NoDataRanges:w},B.variableName="Raster",L=new M,L.functionName=
"Colormap",L.functionArguments={Colormap:z,Raster:B},B=L);return B},_convertUniqueValueRenderer:function(a){var f=[],q=this.renderingRule&&this._getRenderingRuleId(this.renderingRule);if(q){var w=this._renderingRuleAttributeTable[q];var z=this._rasterFunctionTemplateInfos[q]}var D=w&&w.features?w.features:this._rasterAttributeTableFeatures;var B=(q=w&&w.fields?w.fields:this._rasterAttributeTableFields)&&q.length?this._getValueField(q):"Value";d.forEach(a.infos,function(Q){var L=Q.symbol.color;L.a&&
(a.attributeField!==B&&D?d.forEach(D,function(W){W.attributes[a.attributeField]==Q.value&&f.push([W.attributes[B],L.r,L.g,L.b])},this):f.push([Q.value,L.r,L.g,L.b]))},this);this._adjustColormapToPixelTypeRange(f,z&&z.pixelType||this.pixelType);z=new M;z.functionName="Colormap";z.functionArguments={};z.functionArguments.Colormap=f;z.variableName="Raster";return z},_adjustColormapToPixelTypeRange:function(a,f){(f=this._pixelTypeRanges[f])&&a.push([Math.floor(f[0]-1),0,0,0],[Math.ceil(f[1]+1),0,0,0]);
return a},_combineRenderingRule:function(a,f){if(!a||!f)return a||f;var q=function(w){var z=w.Raster;return z=z&&"esri.layers.RasterFunction"===z.declaredClass?q(z.functionArguments):w};a=A.clone(a);"none"!==f.functionName.toLocaleLowerCase()&&(q(a.functionArguments).Raster=f);return a},_isItemLevelRasterFunction:function(a){var f=a&&a.functionName;if(!f||!this._hasItemLevelRFT)return!1;var q=!1;d.some(this.rasterFunctionInfos,function(w){if(w&&w.name===f){if(1===w.functionType||2===w.functionType)q=
!0;return!0}});return q},_getServiceLevelRenderingRule:function(a){if(!this._hasItemLevelRFT||!a)return a;a=new M(a.toJson());var f=a.functionArguments;for(var q;;)if((q=f&&f.Raster)&&q.functionArguments&&q.functionArguments.Raster)f=q,f=f.functionArguments;else{this._isItemLevelRasterFunction(q)&&delete f.Raster;break}return a},_getItemLevelRenderingRule:function(a){if(!this._hasItemLevelRFT||!a)return null;if(this._isItemLevelRasterFunction(a))return a;a=new M(a.toJson());for(a=a.functionArguments;;)if((a=
a&&a.Raster)&&a.functionArguments&&a.functionArguments.Raster)a=a.functionArguments;else{if(this._isItemLevelRasterFunction(a))return a;break}},_resolve:function(a,f,q,w,z){f&&this[f].apply(this,a);q&&q.apply(null,a);w&&r._resDfd(w,a,z)},_toggleTime:function(){var a=this._map;this.timeInfo&&this.useMapTime&&a&&!this.suspended?(this._timeConnect||(this._timeConnect=e.connect(a,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(a.timeExtent)):(e.disconnect(this._timeConnect),
this._timeConnect=null,this._setTime(null))},setUseMapTime:function(a,f){this.useMapTime=a;this._toggleTime();!f&&this._map&&this.refresh(!0)},_setTime:function(a){this._params&&(this._params.time=a?a.toJson().join(","):null)},_onTimeExtentChangeHandler:function(a){this.suspended||(this._setTime(a),this.refresh(!0))},handleSpatialReferenceChange:function(){this.onSpatialReferenceChange()},getColormap:function(a){var f=this._url.path+"/colormap",q=new H(r._dfdCanceller),w={f:"json"};a&&a.renderingRule&&
(w.renderingRule=b.toJson(a.renderingRule.toJson()));this.hasColormap?(q._pendingDfd=v({url:f,content:w,handleAs:"json",callbackParamName:"callback"}),q._pendingDfd.then(function(z){q.callback(z)},function(z){q.errback(z)})):(a=Error("Layer does not support colormap"),a.log=!!c.isDebug,q.errback(a));return q},getRenderingRuleColormap:function(a){var f=new H(r._dfdCanceller);if(!a||!a.renderingRule)return f.errback(Error("Rendering rule is not specified")),f;a=a.renderingRule;var q=this._getRenderingRuleId(a);
this._renderingRuleColormap&&q&&this._renderingRuleColormap.hasOwnProperty(q)?f.resolve(this._renderingRuleColormap[q]):f=this.getColormap({renderingRule:a}).then(A.hitch(this,function(w){w=w&&w.colormap;q&&(this._renderingRuleColormap[q]=w);return w}));return f},_handleClipFunctionInRenderingRule:function(a){a=A.clone(a);var f=a.arguments,q=f.ClippingGeometry&&f.ClippingGeometry.value,w=f.Extent&&f.Extent.value;f.ClippingRaster&&f.ClippingRaster.value||q||w||(f=this._map.extent.toJson(),a.arguments.Extent.value=
f,a.functionArguments.Extent.value=f,a._isTemplate&&(a._templateJson.arguments.Extent.value=f));return a}});g("extend-esri")&&A.setObject("layers.ImageServiceLayerMixin",O,m);return O})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point ./RasterFunction".split(" "),function(O,A,H,d,b,c,e){var g=O(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,
viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],itemRenderingRule:null,constructor:function(h){A.isObject(h)&&(A.mixin(this,h),h.mosaicMethod&&(this.method=h.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),h.mosaicOperation&&(this.operation=h.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),h.fids&&(this.objectIds=
h.fids),h.viewpoint&&(this.viewpoint=new c(h.viewpoint)),h.itemRenderingRule&&(this.itemRenderingRule=new e(h.itemRenderingRule)),this.multidimensionalDefinition=h.multidimensionalDefinition||[])},toJson:function(){var h=null,n=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(n){h=[];for(var m=0;m<n;m++)h.push("esri.layers.DimensionalDefinition"===this.multidimensionalDefinition[m].declaredClass?this.multidimensionalDefinition[m].toJson():this.multidimensionalDefinition[m])}h=
{mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:A.clone(this.lockRasterIds),viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:A.clone(this.objectIds),mosaicOperation:this.operation,multidimensionalDefinition:h,itemRenderingRule:this.itemRenderingRule?this.itemRenderingRule.toJson():null};return b.filter(h,function(l){if(null!==l)return!0})},_getMethodEnum:function(h){if(h){var n=g.METHOD_NONE;switch(h.toLowerCase()){case "byattribute":n=
g.METHOD_ATTRIBUTE;break;case "center":n=g.METHOD_CENTER;break;case "lockraster":n=g.METHOD_LOCKRASTER;break;case "nadir":n=g.METHOD_NADIR;break;case "northwest":n=g.METHOD_NORTHWEST;break;case "seamline":n=g.METHOD_SEAMLINE;break;case "viewpoint":n=g.METHOD_VIEWPOINT}return n}},_getOperatorEnum:function(h){if(h)switch(h.toLowerCase()){case "first":return g.OPERATION_FIRST;case "last":return g.OPERATION_LAST;case "max":return g.OPERATION_MAX;case "min":return g.OPERATION_MIN;case "blend":return g.OPERATION_BLEND;
case "mean":return g.OPERATION_MEAN;case "sum":return g.OPERATION_SUM}}});A.mixin(g,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",
OPERATION_SUM:"MT_SUM"});H("extend-esri")&&A.setObject("layers.MosaicRule",g,d);return g})},"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(O,A,H,d,b){O=O(null,{declaredClass:"esri.layers.DimensionalDefinition",variableName:null,dimensionName:null,values:[],isSlice:!1,constructor:function(c){A.isObject(c)&&A.mixin(this,c)},toJson:function(){var c={variableName:this.variableName,dimensionName:this.dimensionName,
values:A.clone(this.values),isSlice:this.isSlice};return b.filter(c,function(e){return null!==e})}});H("extend-esri")&&A.setObject("layers.DimensionalDefinition",O,d);return O})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec ./rasterFormats/Lerc2Codec".split(" "),
function(O,A,H,d,b,c,e,g,h,n,m,l,t,v,r,p,k){var x,C,F,P,M,J;A=A(n,{declaredClass:"esri.layers.Raster",imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(u){this.imageServiceUrl=u;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(u,y,G){var I=this,E=new d(v._dfdCanceller);if(10>g("ie"))throw"This browser is not supported.";
if(!u.imageServiceParameters)throw"Insufficient parameters to read data";var a=H.clone(u.imageServiceParameters),f=u.pixelType;b.some(this.validPixelTypes,function(Q){return Q===f})||(a.pixelType="F32");b.some(this.validFormats,function(Q){return Q.toLowerCase()===a.format.toLowerCase()})||(a.format="lerc");var q=u.decodeFunc,w;this._prepareGetImageParameters(a);var z=a.width,D=a.height,B=a.extent;delete a.width;delete a.height;delete a.extent;E._pendingDfd=m({url:this.imageServiceUrl+"/exportImage",
handleAs:"arraybuffer",content:H.mixin(a,{f:"image"}),load:function(Q){I.decode(Q,{width:z,height:D,planes:null,pixelType:f,noDataValue:a.noData,format:a.format,decodeFunc:q}).then(function(L){w={pixelBlock:L,extent:B};I._resolve([w,a],"onRasterReadComplete",y,E)},function(L){I._resolve([L],null,G,E,!0)})},error:function(Q){I._resolve([Q],null,G,E,!0)}});return E.promise},decode:function(u,y){if(void 0===y||null===y)throw"missing decode options";var G;y.format&&(G=y.format.toUpperCase());"BSQ"!==
G&&"BIP"!==G&&(G=this._getFormat(u));var I=y.decodeFunc;if(void 0===I||null===I)I=this._getFormatDecoderDfd(G);return I(u,y)},onRasterReadComplete:function(){},_prepareGetImageParameters:function(u){if(u.size&&u.bbox){var y=u.size.split(",");u.width=parseFloat(y[0]);u.height=parseFloat(y[1]);u.extent||(y=u.bbox.split(","),u.extent=new l(parseFloat(y[0]),parseFloat(y[1]),parseFloat(y[2]),parseFloat(y[3]),new t(u.bboxSR)))}else{if(!u.width||Math.floor(u.width)!==u.width||!u.height||Math.floor(u.height)!==
u.height)throw"Incorrect Image Dimensions";if(!u.extent||"esri.geometry.Extent"!==u.extent.declaredClass)throw"Incorrect extent";y=u.extent;var G=y.spatialReference.wkid||e.toJson(y.spatialReference.toJson());delete u._ts;H.mixin(u,{bbox:y.xmin+","+y.ymin+","+y.xmax+","+y.ymax,imageSR:G,bboxSR:G,size:u.width+","+u.height},u.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(u,y,G){var I=u.ymax-u.ymin,E=u.xmax-u.xmin;G>=y?u.ymax=u.ymin+E*y/G:u.xmax=u.xmin+I*G/y;return u},
_resolve:function(u,y,G,I,E){y&&this[y].apply(this,u);G&&G.apply(null,u);I&&v._resDfd(I,u,E)},_getFormatDecoderDfd:function(u){var y=null;switch(u){case "LERC":y=this._decodeLerc;break;case "LERC2":y=this._decodeLerc2;break;case "JPEG":y=this._decodeJpeg;break;case "PNG":y=this._decodePng;break;case "BSQ":y=this._decodeBsq;break;case "BIP":y=this._decodeBip;break;case "TIFF":y=this._decodeTiff;break;default:y=function(G,I){throw"The raster format is not supported";}}y=H.hitch(this,y);return function(G,
I){var E=new d;try{if("LERC"===u||!0===M){var a=y(G,I);E.resolve(a)}else J.then(function(){a=y(G,I);E.resolve(a)})}catch(f){E.reject(f)}return E}},_getFormat:function(u){u=new Uint8Array(u,0,10);var y="";if(255===u[0]&&216===u[1])y="JPEG";else if(137===u[0]&&80===u[1]&&78===u[2]&&71===u[3])y="PNG";else if(67===u[0]&&110===u[1]&&116===u[2]&&90===u[3]&&73===u[4]&&109===u[5]&&97===u[6]&&103===u[7]&&101===u[8]&&32===u[9])y="LERC";else if(76===u[0]&&101===u[1]&&114===u[2]&&99===u[3]&&50===u[4]&&32===u[5])y=
"LERC2";else if(-1<String.fromCharCode.apply(null,u).toLowerCase().indexOf("error"))y="ERROR";else if(73===u[0]&&73===u[1]&&42===u[2]&&0===u[3]||77===u[0]&&77===u[1]&&0===u[2]&&42===u[3])y="TIFF";return y},_validateDecodeParams:function(u){if(!u.height||Math.floor(u.height)!==u.height)throw"Height not provided.";if(!u.width||Math.floor(u.width)!==u.width)throw"Width not provided.";},_decodeJpeg:function(u,y){if(!x)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(y);u=(new x).decode(u);
if(!S(u,y))throw"The decoded image dimensions are incorrect.";y=[];var G;for(G=0;G<u.pixels.length;G++){var I=u.pixels[G];y.push(this._calculateBandStatistics(I))}return new r({width:u.width,height:u.height,pixels:u.pixels,pixelType:"U8",mask:u.mask,statistics:y})},_decodePng:function(u,y){if(!C)throw"The png decoder module is not loaded.";this._validateDecodeParams(y);u=new Uint8Array(u);var G=new C(u);u=new Uint8Array(y.width*y.height*4);G.copyToImageData(u,G.decodePixels());var I=G=0;I=new Uint8Array(y.width*
y.height);for(G=0;G<y.width*y.height;G++)I[G]=u[4*G+3];var E=new r({width:y.width,height:y.height,pixels:[],pixelType:"U8",mask:I,statistics:[]});for(G=0;3>G;G++){var a=new Uint8Array(y.width*y.height);for(I=0;I<y.width*y.height;I++)a[I]=u[4*I+G];E.addData({pixels:a,statistics:this._calculateBandStatistics(a)})}return E},_decodeBsq:function(u,y){if(!F)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(y);N=y.noDataValue;y.pixelType=K(y.pixelType);u=F.decodeBSQ(u,{bandCount:y.planes,
width:y.width,height:y.height,pixelType:R,noDataValue:N});var G=[],I,E=null;for(I=0;I<u.pixels.length;I++)E=u.pixels[I],G.push(this._calculateBandStatistics(E));return new r({width:y.width,height:y.height,pixels:u.pixels,pixelType:y.pixelType,mask:u.maskData,statistics:G})},_decodeBip:function(u,y){this._validateDecodeParams(y);N=y.noDataValue;y.pixelType=K(y.pixelType);u=F.decodeBIP(u,{bandCount:y.planes,width:y.width,height:y.height,pixelType:R,noDataValue:N});var G=[],I,E=null;for(I=0;I<u.pixels.length;I++)E=
u.pixels[I],G.push(this._calculateBandStatistics(E));return new r({width:y.width,height:y.height,pixels:u.pixels,pixelType:y.pixelType,mask:u.maskData,statistics:G})},_decodeTiff:function(u,y){this._validateDecodeParams(y);N=y.noDataValue;y.pixelType=K(y.pixelType);u=P.decode(u);y=[];var G,I=null;for(G=0;G<u.pixels.length;G++)I=u.pixels[G],y.push(this._calculateBandStatistics(I,u.maskData));return new r({width:u.width,height:u.height,pixels:u.pixels,pixelType:u.pixelType,mask:u.maskData,statistics:y})},
_decodeLerc:function(u,y){this._validateDecodeParams(y);N=y.noDataValue;y.pixelType=K(y.pixelType);for(var G=0,I,E=0,a,f=u.byteLength-10;E<f;){var q=p.decode(u,{inputOffset:E,encodedMaskData:I,returnMask:0===G?!0:!1,returnEncodedMask:0===G?!0:!1,returnFileInfo:!0,pixelType:R,noDataValue:N});E=q.fileInfo.eofOffset;0===G&&(I=q.encodedMaskData,a=new r({width:y.width,height:y.height,pixels:[],pixelType:y.pixelType,mask:q.maskData,statistics:[]}));G++;if(!S(q,y))throw"The decoded image dimensions are incorrect";
a.addData({pixels:q.pixelData,statistics:{minValue:q.minValue,maxValue:q.maxValue,noDataValue:q.noDataValue}})}return a},_decodeLerc2:function(u,y){this._validateDecodeParams(y);N=y.noDataValue;y.pixelType=K(y.pixelType);for(var G=0,I,E,a=0,f,q=u.byteLength-10,w=[];a<q;){E=k.decode(u,{inputOffset:a,maskData:I,returnFileInfo:!0});a=E.fileInfo.eofOffset;0===G&&(I=E.maskData,f=new r({width:y.width,height:y.height,pixels:[],pixelType:E.fileInfo.pixelType,mask:E.maskData,statistics:[]}));E.fileInfo.mask&&
0<E.fileInfo.mask.numBytes&&w.push(E.maskData);G++;if(!S(E,y))throw"The decoded image dimensions are incorrect";if(1<E.dimCount&&E.pixelData&&E.pixelData.length===E.width*E.height*E.dimCount){E.pixelData=E.pixelData.slice(-E.width*E.height);var z=E.dimStats&&E.dimStats.minValues&&E.dimStats.minValues[E.dimCount-1],D=E.dimStats&&E.dimStats.maxValues&&E.dimStats.maxValues[E.dimCount-1];null!=z&&null!=D&&(E.minValue=z,E.maxValue=D)}f.addData({pixels:E.pixelData,statistics:{minValue:E.minValue,maxValue:E.maxValue,
noDataValue:E.noDataValue}})}if(1<w.length){E=f.width*f.height;f.bandMasks=w;I=new Uint8Array(E);I.set(w[0]);for(y=1;y<w.length;y++)for(u=w[y],G=0;G<E;G++)I[G]&=u[G];f.maskData=I}return f},_calculateBandStatistics:function(u,y){var G=Infinity,I=-Infinity,E=u.length,a,f=0;if(y)for(a=0;a<E;a++)y[a]&&(f=u[a],G=f<G?f:G,I=f>I?f:I);else for(a=0;a<E;a++)f=u[a],G=f<G?f:G,I=f>I?f:I;return{minValue:G,maxValue:I}},_loadRasterFormatModules:function(){M||(J||(J=new d),10>g("ie")?J.isRejected()||J.reject("unsupported browser version"):
O(["./rasterFormats/JpgPlus","./rasterFormats/Png","./rasterFormats/Raw","./rasterFormats/TiffDecoder","./rasterFormats/Zlib"],function(u,y,G,I){x=u;C=y;F=G;P=I;M=!0;J.isResolved()||J.resolve(!0)}))}});var R=null,N=null,K=function(u){if("U1"===u||"U2"===u||"U4"===u||"U8"===u)return N=Math.pow(2,8)-1,R=Uint8Array,"U8";"U16"===u?(N=N||Math.pow(2,16)-1,R=Uint16Array):"U32"===u?(N=N||Math.pow(2,32)-1,R=Uint32Array):"S8"===u?(N=N||0-Math.pow(2,7),R=Int8Array):"S16"===u?(N=N||0-Math.pow(2,15),R=Int16Array):
"S32"===u?(N=N||0-Math.pow(2,31),R=Int32Array):R=Float32Array;return u},S=function(u,y){return u.height!==y.height||u.width!==y.width?!1:!0};g("extend-esri")&&H.setObject("layers.Raster",A,h);return A})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(O,A,H,d){O=O([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],maskIsAlpha:!1,validPixelCount:null,constructor:function(b){if(b){if(!b.width||
Math.floor(b.width)!==b.width)throw"PixelBlock: incorrect width";if(!b.height||Math.floor(b.height)!==b.height)throw"PixelBlock: incorrect height";if(!b.pixels)throw"PixelBlock: pixel data not present";this.width=b.width;this.height=b.height;this.pixels=b.pixels;this.pixelType=b.pixelType||null;this.statistics=b.statistics;this.mask=b.mask||null;this.maskIsAlpha=b.maskIsAlpha||!1;b=b.validPixelCount;null==b&&(b=this.mask?this._getValidPixelCount(this.mask):this.width*this.height);this.validPixelCount=
b}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(b){if(!b.pixels||!b.statistics)throw"Pixel data or statistics are not present";if(b.pixels.length!==this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(b.statistics);this.pixels.push(b.pixels)},getAsRGBA:function(){var b=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(b);
break;default:this._fillFrom8Bit(b)}return new Uint8ClampedArray(b)},getAsRGBAFloat:function(){var b=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(b);return b},clone:function(b){b=b||this;var c=new this.constructor;c.width=b.width;c.height=b.height;c.pixelType=b.pixelType;c.maskIsAlpha=b.maskIsAlpha;b.mask&&(c.mask=new Uint8Array(b.mask));var e,g;if(b.pixels){c.pixels=[];var h=(g=b.pixels.length)&&b.pixels[0].slice;for(e=0;e<g;e++)c.pixels[e]=h?b.pixels[e].slice(0,b.pixels[e].length):
new b.pixels[e].constructor(b.pixels[e])}if(b.statistics)for(c.statistics=[],g=b.statistics.length,e=0;e<g;e++)c.statistics[e]=A.clone(b.statistics[e]);b=b.validPixelCount;null==b&&(b=c.mask?this._getValidPixelCount(c.mask):c.width*c.height);return c},clamp:function(b){if("F64"!==b&&"F32"!==b){switch(b){case "U8":var c=[0,255];break;case "U16":c=[0,65535];break;case "U32":c=[0,4294967295];break;case "S8":c=[-128,127];break;case "S16":c=[-32768,32767];break;case "S32":c=[-2147483648,2147483647];break;
default:c=[-3.4*1E39,3.4*1E39]}var e=c[0];c=c[1];var g=this.pixels,h=this.width*this.height,n=g.length,m,l,t=[];for(m=0;m<n;m++){var v=this._createEmptyBand(b,h);var r=g[m];for(l=0;l<h;l++){var p=r[l];v[l]=p>c?c:p<e?e:p}t.push(v)}this.pixels=t;this.pixelType=b}},calculateStatistics:function(){var b,c=[],e=this.mask;for(b=0;b<this.pixels.length;b++){var g=this.pixels[b];c.push(this._calculateBandStatistics(g,e))}this.statistics=c},_getValidPixelCount:function(b){var c,e=0;for(c=0;c<b.length;c++)b[c]&&
e++;return e},_createEmptyBand:function(b,c){switch(b){case "U8":b=new Uint8Array(c);break;case "U16":b=new Uint16Array(c);break;case "U32":b=new Uint32Array(c);break;case "S8":b=new Int8Array(c);break;case "S16":b=new Int16Array(c);break;case "S32":b=new Int32Array(c);break;case "U32":b=new Uint32Array(c);break;case "F32":b=new Float32Array(c);break;case "F64":b=new Float64Array(c);break;default:b=new Float32Array(c)}return b},_fillFrom8Bit:function(b){var c=this.pixels,e=this.mask;if(!b||!c||!c.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var g,h;var n=g=h=c[0];3<=c.length&&(g=c[1],h=c[2]);c=new Uint32Array(b);var m=this.width*this.height;if(n.length!==m)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(e&&e.length===m)if(this.maskIsAlpha)for(b=0;b<m;b++)e[b]&&(c[b]=e[b]<<24|h[b]<<16|g[b]<<8|n[b]);else for(b=0;b<m;b++)e[b]&&(c[b]=-16777216|h[b]<<16|g[b]<<8|n[b]);else for(b=0;b<m;b++)c[b]=-16777216|h[b]<<16|g[b]<<8|n[b]},_fillFromNon8Bit:function(b){var c=this.pixels,e=this.mask,g=this.statistics;if(!b||
!c||!c.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var h=1,n=0;h=1;g&&0<g.length?(n=g.map(function(v){return v.minValue}).reduce(function(v,r){return Math.min(v,r)}),h=g.map(function(v){return v.maxValue-v.minValue}).reduce(function(v,r){return Math.max(v,r)}),h=255/h):(h=255,"S8"===this.pixelType?(n=-128,h=127):"U16"===this.pixelType?h=65535:"S16"===this.pixelType?(n=-32768,h=32767):"U32"===this.pixelType?h=4294967295:"S32"===this.pixelType?(n=-2147483648,
h=2147483647):"F32"===this.pixelType?(n=-3.4*1E39,h=3.4*1E39):"F64"===this.pixelType&&(n=-Number.MAX_VALUE,h=Number.MAX_VALUE),h=255/(h-n));b=new Uint32Array(b);g=this.width*this.height;var m=c[0];if(m.length!==g)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(3<=c.length){var l=c[1];var t=c[2];if(e&&e.length===g)for(c=0;c<g;c++)e[c]&&(b[c]=-16777216|(t[c]-n)*h<<16|(l[c]-n)*h<<8|(m[c]-n)*h);else for(c=0;c<g;c++)b[c]=-16777216|(t[c]-n)*h<<16|(l[c]-n)*h<<8|(m[c]-n)*
h}else if(e&&e.length===g)for(c=0;c<g;c++)l=(m[c]-n)*h,e[c]&&(b[c]=-16777216|l<<16|l<<8|l);else for(c=0;c<g;c++)l=(m[c]-n)*h,b[c]=-16777216|l<<16|l<<8|l},_fillFrom32Bit:function(b){var c=this.pixels,e=this.mask;if(!b||!c||!c.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var g,h;var n=g=h=c[0];3<=c.length&&(g=c[1],h=c[2]);var m=this.width*this.height;if(n.length!==m)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var l=0;if(e&&
e.length===m)for(c=0;c<m;c++)b[l++]=n[c],b[l++]=g[c],b[l++]=h[c],b[l++]=e[c]&1;else for(c=0;c<m;c++)b[l++]=n[c],b[l++]=g[c],b[l++]=h[c],b[l++]=1},_calculateBandStatistics:function(b,c){var e=Infinity,g=-Infinity,h=b.length,n,m=0;if(c)for(n=0;n<h;n++)c[n]&&(m=b[n],e=m<e?m:e,g=m>g?m:g);else for(n=0;n<h;n++)m=b[n],e=m<e?m:e,g=m>g?m:g;return{minValue:e,maxValue:g}}});H("extend-esri")&&A.setObject("layers.PixelBlock",O,d);return O})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var O=
{defaultNoDataValue:-3.4027999387901484E38,decode:function(H,d){d=d||{};var b=d.inputOffset||0,c=d.encodedMaskData||null===d.encodedMaskData,e={},g=new Uint8Array(H,b,10);e.fileIdentifierString=String.fromCharCode.apply(null,g);if("CntZImage"!=e.fileIdentifierString.trim())throw"Unexpected file identifier string: "+e.fileIdentifierString;b+=10;g=new DataView(H,b,24);e.fileVersion=g.getInt32(0,!0);e.imageType=g.getInt32(4,!0);e.height=g.getUint32(8,!0);e.width=g.getUint32(12,!0);e.maxZError=g.getFloat64(16,
!0);b+=24;if(!c)if(g=new DataView(H,b,16),e.mask={},e.mask.numBlocksY=g.getUint32(0,!0),e.mask.numBlocksX=g.getUint32(4,!0),e.mask.numBytes=g.getUint32(8,!0),e.mask.maxValue=g.getFloat32(12,!0),b+=16,0<e.mask.numBytes){c=new Uint8Array(Math.ceil(e.width*e.height/8));g=new DataView(H,b,e.mask.numBytes);var h=g.getInt16(0,!0),n=2,m=0;do{if(0<h)for(;h--;)c[m++]=g.getUint8(n++);else{var l=g.getUint8(n++);for(h=-h;h--;)c[m++]=l}h=g.getInt16(n,!0);n+=2}while(n<e.mask.numBytes);if(-32768!==h||m<c.length)throw"Unexpected end of mask RLE encoding";
e.mask.bitset=c;b+=e.mask.numBytes}else 0===(e.mask.numBytes|e.mask.numBlocksY|e.mask.maxValue)&&(c=new Uint8Array(Math.ceil(e.width*e.height/8)),e.mask.bitset=c);g=new DataView(H,b,16);e.pixels={};e.pixels.numBlocksY=g.getUint32(0,!0);e.pixels.numBlocksX=g.getUint32(4,!0);e.pixels.numBytes=g.getUint32(8,!0);e.pixels.maxValue=g.getFloat32(12,!0);b+=16;c=e.pixels.numBlocksX;g=e.pixels.numBlocksY;c+=0<e.width%c?1:0;h=g+(0<e.height%g?1:0);e.pixels.blocks=Array(c*h);for(m=n=0;m<h;m++)for(l=0;l<c;l++){var t=
0;g=new DataView(H,b,Math.min(10,H.byteLength-b));var v={};e.pixels.blocks[n++]=v;var r=g.getUint8(0);t++;v.encoding=r&63;if(3<v.encoding)throw"Invalid block encoding ("+v.encoding+")";if(2===v.encoding)b++;else{if(0!==r&&2!==r){r>>=6;v.offsetType=r;if(2===r)v.offset=g.getInt8(1),t++;else if(1===r)v.offset=g.getInt16(1,!0),t+=2;else if(0===r)v.offset=g.getFloat32(1,!0),t+=4;else throw"Invalid block offset type";if(1===v.encoding)if(r=g.getUint8(t),t++,v.bitsPerPixel=r&63,r>>=6,v.numValidPixelsType=
r,2===r)v.numValidPixels=g.getUint8(t),t++;else if(1===r)v.numValidPixels=g.getUint16(t,!0),t+=2;else if(0===r)v.numValidPixels=g.getUint32(t,!0),t+=4;else throw"Invalid valid pixel count type";}b+=t;if(3!=v.encoding)if(0===v.encoding){r=(e.pixels.numBytes-1)/4;if(r!==Math.floor(r))throw"uncompressed block has invalid length";g=new ArrayBuffer(4*r);t=new Uint8Array(g);t.set(new Uint8Array(H,b,4*r));g=new Float32Array(g);v.rawData=g;b+=4*r}else 1===v.encoding&&(r=Math.ceil(v.numValidPixels*v.bitsPerPixel/
8),g=new ArrayBuffer(4*Math.ceil(r/4)),t=new Uint8Array(g),t.set(new Uint8Array(H,b,r)),v.stuffedData=new Uint32Array(g),b+=r)}}e.eofOffset=b;H=null!=d.noDataValue?d.noDataValue:O.defaultNoDataValue;c=d.encodedMaskData;r=d.returnMask;h=0;n=e.pixels.numBlocksX;m=e.pixels.numBlocksY;l=Math.floor(e.width/n);v=Math.floor(e.height/m);t=2*e.maxZError;b=Number.MAX_VALUE;c=c||(e.mask?e.mask.bitset:null);var p;g=new (d.pixelType||Float32Array)(e.width*e.height);r&&c&&(p=new Uint8Array(e.width*e.height));r=
new Float32Array(l*v);for(var k,x,C=0;C<=m;C++){var F=C!==m?v:e.height%m;if(0!==F)for(var P=0;P<=n;P++){var M=P!==n?l:e.width%n;if(0!==M){var J=C*e.width*v+P*l,R=e.width-M,N=e.pixels.blocks[h],K;if(2>N.encoding){if(0===N.encoding)var S=N.rawData;else{var u=K=S=void 0;k=N.stuffedData;x=N.bitsPerPixel;var y=N.numValidPixels,G=N.offset,I=t,E=r,a=e.pixels.maxValue,f=(1<<x)-1,q=0,w=0,z=Math.ceil((a-G)/I);k[k.length-1]<<=8*(4*k.length-Math.ceil(x*y/8));for(u=0;u<y;u++)0===w&&(S=k[q++],w=32),w>=x?(K=S>>>
w-x&f,w-=x):(w=x-w,K=(S&f)<<w&f,S=k[q++],w=32-w,K+=S>>>w),E[u]=K<z?G+K*I:a;S=r}K=0}else var D=2===N.encoding?0:N.offset;if(c)for(x=0;x<F;x++){if(J&7){var B=c[J>>3];B<<=J&7}for(k=0;k<M;k++)J&7||(B=c[J>>3]),B&128?(p&&(p[J]=1),u=2>N.encoding?S[K++]:D,b=b>u?u:b,g[J++]=u):(p&&(p[J]=0),g[J++]=H),B<<=1;J+=R}else if(2>N.encoding)for(x=0;x<F;x++){for(k=0;k<M;k++)u=S[K++],b=b>u?u:b,g[J++]=u;J+=R}else for(b=b>D?D:b,x=0;x<F;x++){for(k=0;k<M;k++)g[J++]=D;J+=R}if(1===N.encoding&&K!==N.numValidPixels)throw"Block and Mask do not match";
h++}}}D=p;p={width:e.width,height:e.height,pixelData:g,minValue:b,maxValue:e.pixels.maxValue,noDataValue:H};D&&(p.maskData=D);d.returnEncodedMask&&e.mask&&(p.encodedMaskData=e.mask.bitset?e.mask.bitset:null);if(d.returnFileInfo&&(p.fileInfo=A(e),d.computeUsedBitDepths)){d=p.fileInfo;D=e.pixels.numBlocksX*e.pixels.numBlocksY;B={};for(S=0;S<D;S++)K=e.pixels.blocks[S],0===K.encoding?B.float32=!0:1===K.encoding?B[K.bitsPerPixel]=!0:B[0]=!0;e=Object.keys(B);d.bitDepths=e}return p}},A=function(H){return{fileIdentifierString:H.fileIdentifierString,
fileVersion:H.fileVersion,imageType:H.imageType,height:H.height,width:H.width,maxZError:H.maxZError,eofOffset:H.eofOffset,mask:H.mask?{numBlocksX:H.mask.numBlocksX,numBlocksY:H.mask.numBlocksY,numBytes:H.mask.numBytes,maxValue:H.mask.maxValue}:null,pixels:{numBlocksX:H.pixels.numBlocksX,numBlocksY:H.pixels.numBlocksY,numBytes:H.pixels.numBytes,maxValue:H.pixels.maxValue,noDataValue:this.noDataValue}}};return O})},"esri/layers/rasterFormats/Lerc2Codec":function(){define([],function(){var O={unstuff:function(d,
b,c,e,g,h,n,m){var l=(1<<c)-1,t=0,v,r=0;d[d.length-1]<<=8*(4*d.length-Math.ceil(c*e/8));if(g)for(v=0;v<e;v++){if(0===r){var p=d[t++];r=32}if(r>=c){var k=p>>>r-c&l;r-=c}else r=c-r,k=(p&l)<<r&l,p=d[t++],r=32-r,k+=p>>>r;b[v]=g[k]}else for(g=Math.ceil((m-h)/n),v=0;v<e;v++)0===r&&(p=d[t++],r=32),r>=c?(k=p>>>r-c&l,r-=c):(r=c-r,k=(p&l)<<r&l,p=d[t++],r=32-r,k+=p>>>r),b[v]=k<g?h+k*n:m},unstuffLUT:function(d,b,c,e,g,h){var n=(1<<b)-1,m=0,l=0,t=0,v=t=0,r=[];d[d.length-1]<<=8*(4*d.length-Math.ceil(b*c/8));var p=
Math.ceil((h-e)/g);for(l=0;l<c;l++){if(0===t){var k=d[m++];t=32}t>=b?(v=k>>>t-b&n,t-=b):(t=b-t,v=(k&n)<<t&n,k=d[m++],t=32-t,v+=k>>>t);r[l]=v<p?e+v*g:h}r.unshift(e);return r},unstuff2:function(d,b,c,e,g,h,n,m){var l=(1<<c)-1,t=0,v,r=0,p=0;if(g)for(v=0;v<e;v++){if(0===r){var k=d[t++];r=32;p=0}if(r>=c){var x=k>>>p&l;r-=c;p+=c}else{var C=c-r;x=k>>>p&l;k=d[t++];r=32-C;x|=(k&(1<<C)-1)<<c-C;p=C}b[v]=g[x]}else for(g=Math.ceil((m-h)/n),v=0;v<e;v++)0===r&&(k=d[t++],r=32,p=0),r>=c?(x=k>>>p&l,r-=c,p+=c):(C=c-
r,x=k>>>p&l,k=d[t++],r=32-C,x|=(k&(1<<C)-1)<<c-C,p=C),b[v]=x<g?h+x*n:m;return b},unstuffLUT2:function(d,b,c,e,g,h){var n=(1<<b)-1,m=0,l=0,t=0,v=0,r=0,p=0,k=[],x=Math.ceil((h-e)/g);for(l=0;l<c;l++){if(0===v){var C=d[m++];v=32;p=0}v>=b?(r=C>>>p&n,v-=b,p+=b):(t=b-v,r=C>>>p&n,C=d[m++],v=32-t,r|=(C&(1<<t)-1)<<b-t,p=t);k[l]=r<x?e+r*g:h}k.unshift(e);return k},originalUnstuff:function(d,b,c,e){var g=(1<<c)-1,h=0,n,m=0;d[d.length-1]<<=8*(4*d.length-Math.ceil(c*e/8));for(n=0;n<e;n++){if(0===m){var l=d[h++];
m=32}if(m>=c){var t=l>>>m-c&g;m-=c}else m=c-m,t=(l&g)<<m&g,l=d[h++],m=32-m,t+=l>>>m;b[n]=t}return b},originalUnstuff2:function(d,b,c,e){var g=(1<<c)-1,h=0,n,m=0,l=0;for(n=0;n<e;n++){if(0===m){var t=d[h++];m=32;l=0}if(m>=c){var v=t>>>l&g;m-=c;l+=c}else{var r=c-m;v=t>>>l&g;t=d[h++];m=32-r;v|=(t&(1<<r)-1)<<c-r;l=r}b[n]=v}return b}},A={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(d){for(var b=65535,c=65535,e=d.length,g=Math.floor(e/2),h=0;g;){var n=359<=g?359:g;g-=n;do b+=d[h++]<<8,c+=b+=
d[h++];while(--n);b=(b&65535)+(b>>>16);c=(c&65535)+(c>>>16)}e&1&&(c+=b+=d[h]<<8);return((c&65535)+(c>>>16)<<16|(b&65535)+(b>>>16))>>>0},readHeaderInfo:function(d,b){var c=b.ptr,e=new Uint8Array(d,c,6),g={};g.fileIdentifierString=String.fromCharCode.apply(null,e);if(0!==g.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+g.fileIdentifierString;c+=6;e=new DataView(d,c,8);var h=e.getInt32(0,!0);g.fileVersion=h;c+=4;3<=h&&(g.checksum=e.getUint32(4,
!0),c+=4);e=new DataView(d,c,12);g.height=e.getUint32(0,!0);g.width=e.getUint32(4,!0);c+=8;4<=h?(g.numDims=e.getUint32(8,!0),c+=4):g.numDims=1;e=new DataView(d,c,40);g.numValidPixel=e.getUint32(0,!0);g.microBlockSize=e.getInt32(4,!0);g.blobSize=e.getInt32(8,!0);g.imageType=e.getInt32(12,!0);g.maxZError=e.getFloat64(16,!0);g.zMin=e.getFloat64(24,!0);g.zMax=e.getFloat64(32,!0);c+=40;b.headerInfo=g;b.ptr=c;if(3<=h&&(d=this.computeChecksumFletcher32(new Uint8Array(d,c-(4<=h?52:48),g.blobSize-14)),d!==
g.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(d,b){var c=b.headerInfo,e=this.getDataTypeArray(c.imageType),g=c.numDims*this.getDataTypeSize(c.imageType),h=this.readSubArray(d,b.ptr,e,g);d=this.readSubArray(d,b.ptr+g,e,g);b.ptr+=2*g;g=!0;for(b=0;b<c.numDims;b++)if(h[b]!==d[b]){g=!1;break}c.minValues=h;c.maxValues=d;return g},readSubArray:function(d,b,c,e){if(c===Uint8Array)d=new Uint8Array(d,b,e);else{var g=new ArrayBuffer(e);(new Uint8Array(g)).set(new Uint8Array(d,b,e));
d=new c(g)}return d},readMask:function(d,b){var c=b.ptr,e=b.headerInfo,g=e.width*e.height,h=e.numValidPixel,n=new DataView(d,c,4);e={};e.numBytes=n.getUint32(0,!0);c+=4;if((0===h||g===h)&&0!==e.numBytes)throw"invalid mask";if(0===h)h=new Uint8Array(Math.ceil(g/8)),e.bitset=h,n=new Uint8Array(g),b.pixels.resultMask=n,c+=e.numBytes;else if(0<e.numBytes){h=new Uint8Array(Math.ceil(g/8));n=new DataView(d,c,e.numBytes);d=n.getInt16(0,!0);var m=2,l=0,t=0;do{if(0<d)for(;d--;)h[l++]=n.getUint8(m++);else for(t=
n.getUint8(m++),d=-d;d--;)h[l++]=t;d=n.getInt16(m,!0);m+=2}while(m<e.numBytes);if(-32768!==d||l<h.length)throw"Unexpected end of mask RLE encoding";n=new Uint8Array(g);for(m=m=d=0;m<g;m++)m&7?(d=h[m>>3],d<<=m&7):d=h[m>>3],d&128&&(n[m]=1);b.pixels.resultMask=n;e.bitset=h;c+=e.numBytes}b.ptr=c;b.mask=e;return!0},readDataOneSweep:function(d,b,c,e){var g=b.ptr,h=b.headerInfo,n=h.numDims,m=h.width*h.height;h=h.numValidPixel*A.getDataTypeSize(h.imageType)*n;var l=b.pixels.resultMask;if(c===Uint8Array)d=
new Uint8Array(d,g,h);else{var t=new ArrayBuffer(h);(new Uint8Array(t)).set(new Uint8Array(d,g,h));d=new c(t)}if(d.length===m*n)b.pixels.resultPixels=e?A.swapDimensionOrder(d,m,n,c,!0):d;else{b.pixels.resultPixels=new c(m*n);var v=t=c=0,r=0;if(1<n)if(e)for(t=0;t<m;t++){if(l[t])for(r=t,v=0;v<n;v++,r+=m)b.pixels.resultPixels[r]=d[c++]}else for(t=0;t<m;t++){if(l[t])for(r=t*n,v=0;v<n;v++)b.pixels.resultPixels[r+v]=d[c++]}else for(t=0;t<m;t++)l[t]&&(b.pixels.resultPixels[t]=d[c++])}b.ptr=g+h;return!0},
readHuffmanTree:function(d,b){var c=this.HUFFMAN_LUT_BITS_MAX,e=new DataView(d,b.ptr,16);b.ptr+=16;if(2>e.getInt32(0,!0))throw"unsupported Huffman version";var g=e.getInt32(4,!0),h=e.getInt32(8,!0);e=e.getInt32(12,!0);if(h>=e)return!1;var n=new Uint32Array(e-h);A.decodeBits(d,b,n);var m=[],l;for(l=h;l<e;l++){var t=l-(l<g?0:g);m[t]={first:n[l-h],second:null}}l=d.byteLength-b.ptr;n=new ArrayBuffer(4*Math.ceil(l/4));(new Uint8Array(n)).set(new Uint8Array(d,b.ptr,l));d=new Uint32Array(n);b=0;n=0;var v=
d[0];for(l=h;l<e;l++){t=l-(l<g?0:g);var r=m[t].first;0<r&&(m[t].second=v<<b>>>32-r,32-b>=r?(b+=r,32===b&&(b=0,n++,v=d[n])):(b+=r-32,n++,v=d[n],m[t].second|=v>>>32-b))}var p=v=0,k=new H;for(l=0;l<m.length;l++)void 0!==m[l]&&(v=Math.max(v,m[l].first));p=v>=c?c:v;c=[];var x;for(l=h;l<e;l++)if(t=l-(l<g?0:g),r=m[t].first,0<r)if(h=[r,t],r<=p){t=m[t].second<<p-r;var C=1<<p-r;for(r=0;r<C;r++)c[t|r]=h}else for(t=m[t].second,C=k,--r;0<=r;r--)(x=t>>>r&1)?(C.right||(C.right=new H),C=C.right):(C.left||(C.left=
new H),C=C.left),0!==r||C.val||(C.val=h[1]);return{decodeLut:c,numBitsLUTQick:p,numBitsLUT:v,tree:k,stuffedData:d,srcPtr:n,bitPos:b}},readHuffman:function(d,b,c,e){var g=b.headerInfo.numDims,h=b.headerInfo.height,n=b.headerInfo.width,m=n*h,l=this.readHuffmanTree(d,b);d=l.decodeLut;var t=l.tree,v=l.stuffedData,r=l.srcPtr,p=l.bitPos,k=l.numBitsLUTQick;l=l.numBitsLUT;var x=0===b.headerInfo.imageType?128:0,C=b.pixels.resultMask,F,P,M,J,R,N,K=0;0<p&&(r++,p=0);var S=v[r],u=1===b.encodeMode,y=new c(m*g),
G=y,I;if(2>g||u)for(I=0;I<g;I++)if(1<g&&(G=new c(y.buffer,m*I,m),K=0),b.headerInfo.numValidPixel===n*h)for(M=R=0;M<h;M++)for(J=0;J<n;J++,R++){var E=0;var a=F=S<<p>>>32-k;32-p<k&&(a=F|=v[r+1]>>>64-p-k);if(d[a])E=d[a][1],p+=d[a][0];else for(a=F=S<<p>>>32-l,32-p<l&&(a=F|=v[r+1]>>>64-p-l),a=t,N=0;N<l;N++)if(a=(P=F>>>l-N-1&1)?a.right:a.left,!a.left&&!a.right){E=a.val;p=p+N+1;break}32<=p&&(p-=32,r++,S=v[r]);E-=x;u?(E=0<J?E+K:0<M?E+G[R-n]:E+K,E&=255,K=G[R]=E):G[R]=E}else for(M=R=0;M<h;M++)for(J=0;J<n;J++,
R++){if(C[R]){E=0;a=F=S<<p>>>32-k;32-p<k&&(a=F|=v[r+1]>>>64-p-k);if(d[a])E=d[a][1],p+=d[a][0];else for(a=F=S<<p>>>32-l,32-p<l&&(a=F|=v[r+1]>>>64-p-l),a=t,N=0;N<l;N++)if(a=(P=F>>>l-N-1&1)?a.right:a.left,!a.left&&!a.right){E=a.val;p=p+N+1;break}32<=p&&(p-=32,r++,S=v[r]);E-=x;u?(E=0<J&&C[R-1]?E+K:0<M&&C[R-n]?E+G[R-n]:E+K,E&=255,K=G[R]=E):G[R]=E}}else for(M=R=0;M<h;M++)for(J=0;J<n;J++)if(R=M*n+J,!C||C[R])for(I=0;I<g;I++,R+=m){E=0;a=F=S<<p>>>32-k;32-p<k&&(a=F|=v[r+1]>>>64-p-k);if(d[a])E=d[a][1],p+=d[a][0];
else for(a=F=S<<p>>>32-l,32-p<l&&(a=F|=v[r+1]>>>64-p-l),a=t,N=0;N<l;N++)if(a=(P=F>>>l-N-1&1)?a.right:a.left,!a.left&&!a.right){E=a.val;p=p+N+1;break}32<=p&&(p-=32,r++,S=v[r]);E-=x;G[R]=E}b.ptr=b.ptr+4*(r+1)+(0<p?4:0);b.pixels.resultPixels=y;1<g&&!e&&(b.pixels.resultPixels=A.swapDimensionOrder(y,m,g,c))},decodeBits:function(d,b,c,e,g){var h=b.headerInfo,n=h.fileVersion,m=0,l=new DataView(d,b.ptr,5<=d.byteLength-b.ptr?5:d.byteLength-b.ptr),t=l.getUint8(0);m++;var v=t>>6,r=0===v?4:3-v,p=0<(t&32)?!0:
!1;v=t&31;t=0;if(1===r)t=l.getUint8(m),m++;else if(2===r)t=l.getUint16(m,!0),m+=2;else if(4===r)t=l.getUint32(m,!0),m+=4;else throw"Invalid valid pixel count type";r=2*h.maxZError;g=1<h.numDims?h.maxValues[g]:h.zMax;if(p){b.counter.lut++;p=l.getUint8(m);m++;h=Math.ceil((p-1)*v/8);var k=Math.ceil(h/4);k=new ArrayBuffer(4*k);var x=new Uint8Array(k);b.ptr+=m;x.set(new Uint8Array(d,b.ptr,h));m=new Uint32Array(k);b.ptr+=h;for(l=0;p-1>>>l;)l++;h=Math.ceil(t*l/8);k=Math.ceil(h/4);k=new ArrayBuffer(4*k);
x=new Uint8Array(k);x.set(new Uint8Array(d,b.ptr,h));d=new Uint32Array(k);b.ptr+=h;b=3<=n?O.unstuffLUT2(m,v,p-1,e,r,g):O.unstuffLUT(m,v,p-1,e,r,g);3<=n?O.unstuff2(d,c,l,t,b):O.unstuff(d,c,l,t,b)}else b.counter.bitstuffer++,l=v,b.ptr+=m,0<l&&(h=Math.ceil(t*l/8),k=Math.ceil(h/4),k=new ArrayBuffer(4*k),x=new Uint8Array(k),x.set(new Uint8Array(d,b.ptr,h)),d=new Uint32Array(k),b.ptr+=h,3<=n?null==e?O.originalUnstuff2(d,c,l,t):O.unstuff2(d,c,l,t,!1,e,r,g):null==e?O.originalUnstuff(d,c,l,t):O.unstuff(d,
c,l,t,!1,e,r,g))},readTiles:function(d,b,c,e){var g=b.headerInfo,h=g.width,n=g.height,m=h*n,l=g.microBlockSize,t=g.imageType,v=A.getDataTypeSize(t),r=Math.ceil(h/l),p=Math.ceil(n/l);b.pixels.numBlocksY=p;b.pixels.numBlocksX=r;var k=b.pixels.ptr=0,x=0,C=0,F=0,P=0,M=0,J=0,R=0,N=k=0,K=0,S=0,u=J=0;J=J=0;var y=new c(l*l);n=n%l||l;var G=h%l||l,I=g.numDims,E,a=b.pixels.resultMask,f=b.pixels.resultPixels,q=5<=g.fileVersion?14:15,w=g.zMax;for(C=0;C<p;C++)for(P=C!==p-1?l:n,F=0;F<r;F++)for(M=F!==r-1?l:G,K=C*
h*l+F*l,S=h-M,E=0;E<I;E++){1<I?(u=f,K=C*h*l+F*l,f=new c(b.pixels.resultPixels.buffer,m*E*v,m),w=g.maxValues[E]):u=null;J=d.byteLength-b.ptr;x=new DataView(d,b.ptr,Math.min(10,J));var z={};J=0;R=x.getUint8(0);J++;var D=5<=g.fileVersion?R&4:0;k=R>>6&255;N=R>>2&q;if(N!==(F*l>>3&q))throw"integrity issue";if(D&&0===E)throw"integrity issue";R&=3;if(3<R)throw b.ptr+=J,"Invalid block encoding ("+R+")";if(2===R){if(D)if(a)for(k=0;k<P;k++)for(x=0;x<M;x++)a[K]&&(f[K]=u[K]),K++;else for(k=0;k<P;k++)for(x=0;x<
M;x++)f[K]=u[K],K++;b.counter.constant++;b.ptr+=J}else if(0===R){if(D)throw"integrity issue";b.counter.uncompressed++;b.ptr+=J;J=P*M*v;u=d.byteLength-b.ptr;J=J<u?J:u;u=new ArrayBuffer(0===J%v?J:J+v-J%v);D=new Uint8Array(u);D.set(new Uint8Array(d,b.ptr,J));u=new c(u);J=0;if(a)for(k=0;k<P;k++){for(x=0;x<M;x++)a[K]&&(f[K]=u[J++]),K++;K+=S}else for(k=0;k<P;k++){for(x=0;x<M;x++)f[K++]=u[J++];K+=S}b.ptr+=J*v}else if(k=A.getDataTypeUsed(D&&6>t?4:t,k),z=A.getOnePixel(z,J,k,x),J+=A.getDataTypeSize(k),3===
R)if(b.ptr+=J,b.counter.constantoffset++,a)for(k=0;k<P;k++){for(x=0;x<M;x++)a[K]&&(f[K]=D?Math.min(w,u[K]+z):z),K++;K+=S}else for(k=0;k<P;k++){for(x=0;x<M;x++)f[K]=D?Math.min(w,u[K]+z):z,K++;K+=S}else if(b.ptr+=J,A.decodeBits(d,b,y,z,E),J=0,D)if(a)for(k=0;k<P;k++){for(x=0;x<M;x++)a[K]&&(f[K]=y[J++]+u[K]),K++;K+=S}else for(k=0;k<P;k++){for(x=0;x<M;x++)f[K]=y[J++]+u[K],K++;K+=S}else if(a)for(k=0;k<P;k++){for(x=0;x<M;x++)a[K]&&(f[K]=y[J++]),K++;K+=S}else for(k=0;k<P;k++){for(x=0;x<M;x++)f[K++]=y[J++];
K+=S}}1<I&&!e&&(b.pixels.resultPixels=A.swapDimensionOrder(b.pixels.resultPixels,m,I,c))},formatFileInfo:function(d){return{fileIdentifierString:d.headerInfo.fileIdentifierString,fileVersion:d.headerInfo.fileVersion,imageType:d.headerInfo.imageType,height:d.headerInfo.height,width:d.headerInfo.width,numValidPixel:d.headerInfo.numValidPixel,microBlockSize:d.headerInfo.microBlockSize,blobSize:d.headerInfo.blobSize,maxZError:d.headerInfo.maxZError,pixelType:A.getPixelType(d.headerInfo.imageType),eofOffset:d.eofOffset,
mask:d.mask?{numBytes:d.mask.numBytes}:null,pixels:{numBlocksX:d.pixels.numBlocksX,numBlocksY:d.pixels.numBlocksY,maxValue:d.headerInfo.zMax,minValue:d.headerInfo.zMin,noDataValue:d.noDataValue}}},constructConstantSurface:function(d,b){var c=d.headerInfo.zMax,e=d.headerInfo.zMin,g=d.headerInfo.maxValues,h=d.headerInfo.numDims,n=d.headerInfo.height*d.headerInfo.width,m=0,l=0,t=0,v=d.pixels.resultMask;d=d.pixels.resultPixels;if(v)if(1<h)if(b)for(m=0;m<h;m++)for(t=m*n,c=g[m],l=0;l<n;l++)v[l]&&(d[t+l]=
c);else for(l=0;l<n;l++){if(v[l])for(t=l*h,m=0;m<h;m++)d[t+h]=g[m]}else for(l=0;l<n;l++)v[l]&&(d[l]=c);else if(1<h&&e!==c)if(b)for(m=0;m<h;m++)for(t=m*n,c=g[m],l=0;l<n;l++)d[t+l]=c;else for(l=0;l<n;l++)for(t=l*h,m=0;m<h;m++)d[t+m]=g[m];else for(l=0;l<n*h;l++)d[l]=c},getDataTypeArray:function(d){switch(d){case 0:d=Int8Array;break;case 1:d=Uint8Array;break;case 2:d=Int16Array;break;case 3:d=Uint16Array;break;case 4:d=Int32Array;break;case 5:d=Uint32Array;break;case 6:d=Float32Array;break;case 7:d=Float64Array;
break;default:d=Float32Array}return d},getPixelType:function(d){switch(d){case 0:d="S8";break;case 1:d="U8";break;case 2:d="S16";break;case 3:d="U16";break;case 4:d="S32";break;case 5:d="U32";break;case 6:d="F32";break;case 7:d="F64";break;default:d="F32"}return d},isValidPixelValue:function(d,b){if(null==b)return!1;switch(d){case 0:d=-128<=b&&127>=b;break;case 1:d=0<=b&&255>=b;break;case 2:d=-32768<=b&&32767>=b;break;case 3:d=0<=b&&65536>=b;break;case 4:d=-2147483648<=b&&2147483647>=b;break;case 5:d=
0<=b&&4294967296>=b;break;case 6:d=-3.4027999387901484E38<=b&&3.4027999387901484E38>=b;break;case 7:d=4.9E-324<=b&&1.7976931348623157E308>=b;break;default:d=!1}return d},getDataTypeSize:function(d){var b=0;switch(d){case 0:case 1:b=1;break;case 2:case 3:b=2;break;case 4:case 5:case 6:b=4;break;case 7:b=8;break;default:b=d}return b},getDataTypeUsed:function(d,b){var c=d;switch(d){case 2:case 4:c=d-b;break;case 3:case 5:c=d-2*b;break;case 6:c=0===b?d:1===b?2:1;break;case 7:c=0===b?d:d-2*b+1;break;default:c=
d}return c},getOnePixel:function(d,b,c,e){d=0;switch(c){case 0:d=e.getInt8(b);break;case 1:d=e.getUint8(b);break;case 2:d=e.getInt16(b,!0);break;case 3:d=e.getUint16(b,!0);break;case 4:d=e.getInt32(b,!0);break;case 5:d=e.getUInt32(b,!0);break;case 6:d=e.getFloat32(b,!0);break;case 7:d=e.getFloat64(b,!0);break;default:throw"the decoder does not understand this pixel type";}return d},swapDimensionOrder:function(d,b,c,e,g){var h=0,n=0,m=0,l=0,t=d;if(1<c)if(t=new e(b*c),g)for(h=0;h<b;h++)for(l=h,m=0;m<
c;m++,l+=b)t[l]=d[n++];else for(h=0;h<b;h++)for(l=h,m=0;m<c;m++,l+=b)t[n++]=d[l];return t}},H=function(d,b,c){this.val=d;this.left=b;this.right=c};return{decode:function(d,b){b=b||{};var c=b.noDataValue,e=0,g={};g.ptr=b.inputOffset||0;g.pixels={};if(A.readHeaderInfo(d,g)){e=g.headerInfo;var h=e.fileVersion,n=A.getDataTypeArray(e.imageType);if(5<h)throw"unsupported lerc version 2."+h;A.readMask(d,g);e.numValidPixel===e.width*e.height||g.pixels.resultMask||(g.pixels.resultMask=b.maskData);var m=e.width*
e.height;g.pixels.resultPixels=new n(m*e.numDims);g.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var l=!b.returnPixelInterleavedDims;if(0!==e.numValidPixel)if(e.zMax===e.zMin)A.constructConstantSurface(g,l);else if(4<=h&&A.checkMinMaxRanges(d,g))A.constructConstantSurface(g,l);else{var t=new DataView(d,g.ptr,2),v=t.getUint8(0);g.ptr++;if(v)A.readDataOneSweep(d,g,n,l);else if(1<h&&1>=e.imageType&&1E-5>Math.abs(e.maxZError-.5)){t=t.getUint8(1);g.ptr++;g.encodeMode=
t;if(2<t||4>h&&1<t)throw"Invalid Huffman flag "+t;t?A.readHuffman(d,g,n,l):A.readTiles(d,g,n,l)}else A.readTiles(d,g,n,l)}g.eofOffset=g.ptr;b.inputOffset?(d=g.headerInfo.blobSize+b.inputOffset-g.ptr,1<=Math.abs(d)&&(g.eofOffset=b.inputOffset+g.headerInfo.blobSize)):(d=g.headerInfo.blobSize-g.ptr,1<=Math.abs(d)&&(g.eofOffset=g.headerInfo.blobSize));d={width:e.width,height:e.height,pixelData:g.pixels.resultPixels,minValue:e.zMin,maxValue:e.zMax,validPixelCount:e.numValidPixel,dimCount:e.numDims,dimStats:{minValues:e.minValues,
maxValues:e.maxValues},maskData:g.pixels.resultMask};if(g.pixels.resultMask&&A.isValidPixelValue(e.imageType,c)){h=g.pixels.resultMask;for(e=0;e<m;e++)h[e]||(d.pixelData[e]=c);d.noDataValue=c}g.noDataValue=c;b.returnFileInfo&&(d.fileInfo=A.formatFileInfo(g));return d}},getBandCount:function(d){for(var b=0,c=0,e={ptr:0,pixels:{}};c<d.byteLength-58;)A.readHeaderInfo(d,e),c+=e.headerInfo.blobSize,b++,e.ptr=c;return b}}})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),
function(O,A,H,d,b,c){O=O(null,{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"],constructor:function(e){A.mixin(this,e);this.isDataUV=e&&e.isDataUV?e.isDataUV:!1;this.computeMagnitudeAndDirection=A.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(e,g){this.inputUnit=e;this.outputUnit=g;this.unitConversionFactor=
1;this._updateUnitConvFactor()},_updateUnitConvFactor:function(){var e=c.indexOf(this.speedUnits,this.inputUnit),g=c.indexOf(this.speedUnits,this.outputUnit);if(this.inputUnit&&this.outputUnit&&0<=e&&0<=g){var h=[1,.277778,.514444,.3048,.44704,0];this.unitConversionFactor=h[e]/h[g]}},computeMagnitudeAndDirection:function(e){if(!b.isDefined(e))throw"Could not compute magnitude and direction. No pixel data is available.";var g=e.pixelBlock;if(!b.isDefined(g)||2!==g.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";
var h=e.extent,n=(h.xmax-h.xmin)/g.width,m=(h.ymax-h.ymin)/g.height,l=h.xmin+n/2;h=h.ymax-m/2;g.statistics[0].minValue=0;g.statistics[0].maxValue=0;var t=180/Math.PI,v=[],r=0,p=0,k=0,x=!b.isDefined(g.mask),C,F,P,M;var J=P=Infinity;var R=M=-Infinity;for(r=0;r<g.height;r++)for(p=0;p<g.width;p++,k++)if(v.push([l+n*p,h-m*r]),x||g.mask[k]){var N=C=g.pixels[0][k];var K=F=g.pixels[1][k];this.isDataUV&&(N=Math.sqrt(C*C+F*F),K=90-t*Math.atan2(F,C));g.pixels[0][k]=N*this.unitConversionFactor;g.pixels[1][k]=
K;N>R&&(R=N);N<J&&(J=N);K>M&&(M=K);K<P&&(P=K)}g.statistics[0].maxValue=R;g.statistics[0].minValue=J;g.statistics[1].maxValue=M;g.statistics[1].minValue=P;e.locations=v;return e}});H("extend-esri")&&A.setObject("layers.pixelFilters.VectorFieldPixelFilter",O,d);return O})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(O,A,H,d){var b;return A(null,{constructor:function(c){this.ctx=c.ctx;this._loadRasterFormatModule()},
decode:function(c,e){if(!e.width||!e.height)throw"Native decoding requires the image format, width and height";var g=new H,h,n=new Uint8Array(c);c=this._getFormat(c);if("error"===c)throw"invalid format";"jpeg"===c&&(h=this._getMask(n,e));var m="",l;for(l=0;l<n.length;l+=65535){var t=n.subarray(l,l+65535>n.length-1?n.length-1:l+65535);m+=String.fromCharCode.apply(null,t)}n="data:image/"+c+";base64,"+window.btoa(m);var v=new Image,r;v.src=n;var p=this;v.onload=function(){p.ctx.clearRect(0,0,e.width,
e.height);p.ctx.drawImage(v,0,0);var k=p.ctx.getImageData(0,0,v.width,v.height);r=k.data;if(h)for(l=0;l<h.length;l++)r[4*l+3]=h[l]?255:0;p.ctx.putImageData(k,0,0);g.resolve(null)};v.onerror=function(){g.reject("cannot load image")};return g},_getFormat:function(c){c=new Uint8Array(c,0,10);var e="error";255===c[0]&&216===c[1]?e="jpeg":137===c[0]&&80===c[1]&&78===c[2]&&71===c[3]&&(e="png");return e},_getMask:function(c,e){try{if(!b)throw"The zlib decoder module is not loaded.";var g=0,h=0,n=Math.round(c.length/
2);1===n%2&&(n+=1);var m=c.length-2;for(g=n;g<m&&(255!==c[g]||217!==c[g+1]);g++);n=g+=2;if(n<c.length-1){var l=(new b(c.subarray(n))).getBytes();var t=new Uint8Array(e.width*e.height);for(g=c=0;g<l.length;g++)for(h=7;0<=h;h--)t[c++]=l[g]>>h&1}}catch(v){}return t},_loadRasterFormatModule:function(){10>d("ie")||O(["./Zlib"],function(c){b=c})}})})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),
function(O,A,H,d,b,c,e,g){O=O(e,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",constructor:function(h){this._url.path+="/identify";this._handler=A.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(h,n,m,l,t){try{var v=new g(h);this._successHandler([v],"onComplete",m,t)}catch(r){this._errorHandler(r,l,t)}},execute:function(h,n,m,l){var t=l.assembly;h=this._encode(A.mixin({},this._url.query,{f:"json"},h.toJson(t&&t[0])));var v=this._handler,
r=this._errorHandler;return b({url:this._url.path,content:h,callbackParamName:"callback",load:function(p,k){v(p,k,n,m,l.dfd)},error:function(p){r(p,m,l.dfd)}})},onComplete:function(){}});c._createWrappers(O);H("extend-esri")&&A.setObject("tasks.ImageServiceIdentifyTask",O,d);return O})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(O,A,H,d,b,c){O=O(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",
constructor:function(e){e.catalogItems&&(this.catalogItems=new c(e.catalogItems));e.location&&(this.location=b.fromJson(e.location));this.catalogItemVisibilities=e.catalogItemVisibilities;this.name=e.name;this.objectId=e.objectId;this.value=e.value;this.processedValues=e.processedValues;this.properties=e.properties}});H("extend-esri")&&A.setObject("tasks.ImageServiceIdentifyResult",O,d);return O})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),
function(O,A,H,d,b,c,e,g){O=O(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,renderingRules:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,maxItemCount:null,returnPixelValues:!0,toJson:function(h){var n=h&&h.geometry||this.geometry;h={geometry:n,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?H.toJson(this.mosaicRule.toJson()):
null,renderingRule:this.renderingRule?H.toJson(this.renderingRule.toJson()):null};n&&(h.geometryType=g.getJsonType(n));n=this.timeExtent;h.time=n?n.toJson().join(","):null;e.isDefined(this.pixelSizeX)&&e.isDefined(this.pixelSizeY)?h.pixelSize=H.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(h.pixelSize=this.pixelSize?H.toJson(this.pixelSize.toJson()):null);this.renderingRules&&(h.renderingRules=H.toJson(d.map(this.renderingRules,function(m){return m.toJson()})));
e.isDefined(this.returnPixelValues)&&(h.returnPixelValues=this.returnPixelValues);e.isDefined(this.maxItemCount)&&(h.maxItemCount=this.maxItemCount);return h}});b("extend-esri")&&A.setObject("tasks.ImageServiceIdentifyParameters",O,c);return O})},"esri/layers/pixelFilters/StretchFilter":function(){define(["dojo/_base/declare","dojo/_base/lang","../PixelBlock"],function(O,A,H){var d;return O(null,{stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,
maxPercent:.5,useGamma:!1,gamma:null,raster:null,outputPixelType:"U8",computeGamma:!1,constructor:function(b){this.stretchType=b.stretchType||b.StretchType||this.stretchType;this.min=b.min||b.Min||this.min;this.max=b.max||b.Max||this.max;this.numberOfStandardDeviations=b.numberOfStandardDeviations||b.NumberOfStandardDeviations||this.numberOfStandardDeviations;this.statistics=b.statistics||b.Statistics||this.statistics;this.dra=b.dra||b.DRA||b.dRA||this.dra;this.minPercent=b.minPercent||b.MinPercent||
this.minPercent;this.maxPercent=b.maxPercent||b.MaxPercent||this.maxPercent;this.useGamma=b.useGamma||b.UseGamma||this.useGamma;this.gamma=b.gamma||b.Gamma||this.gamma;this.computeGamma=b.computeGamma||b.ComputeGamma||this.computeGamma;this.raster=b.raster||b.Raster||this.raster;this.outputPixelType=b.outputPixelType||b.OutputPixelType||this.outputPixelType;this.raster=b.raster||b.Raster||this.raster;d=this},filter:function(b){if(void 0!==b&&null!==b&&null!==b.pixelBlock&&null!==b.pixelBlock.pixels){var c=
b.pixelBlock,e=c.pixels,g=c.width*c.height,h=e.length,n;(n=6===d.stretchType||3===d.stretchType&&d.dra)&&d._calculateStatisticsHistograms(b);if(d.dra)if(n)d._statistics=c.statistics,d._histograms=c.histograms;else{var m=c.statistics;d._statistics=[];for(n=0;n<h;n++)d._statistics[n]=[m[n].minValue,m[n].maxValue,0,0]}else d._statistics=d.statistics,d._histograms=d.histograms;d.computeGamma&&(d.gamma=d._computeGammaValues(c.pixelType),d.useGamma=!0);d._createLUT(b);if(void 0===d.LUT||null===d.LUT)return d._filterNoLUT(b);
m=d.LUT;var l=d.LUTOffset;for(n=0;n<h;n++){var t=m[n];for(c=0;c<g;c++){var v=e[n][c];e[n][c]=t[v-l]}}b.pixelBlock.pixelType="U8";return b}},_calculateStatisticsHistograms:function(b){b=b.pixelBlock;var c=b.pixelType,e=b.pixels,g=b.mask,h=e.length,n,m,l=function(M){this.min=-.5;this.max=255.5;this.size=256;A.mixin(this,M);this.counts=this.counts||new Uint32Array(this.size)},t=[],v,r;for(n=0;n<h;n++){var p=new l;var k=p.counts;var x=e[n];if("U8"===c)if(g)for(m=0;m<b.width*b.height;m++)g[m]&&k[x[m]]++;
else for(m=0;m<b.width*b.height;m++)k[x[m]]++;else{var C=b.statistics[n].minValue;var F=b.statistics[n].maxValue;p.min=C;p.max=F;F=(F-C)/256;var P=new Uint32Array(257);if(g)for(m=0;m<b.width*b.height;m++)g[m]&&P[Math.floor((x[m]-C)/F)]++;else for(m=0;m<b.width*b.height;m++)P[Math.floor((x[m]-C)/F)]++;for(m=0;255>m;m++)k[m]=P[m];k[255]=P[255]+P[256]}t.push(p);x=[];C=b.statistics[n].minValue;F=b.statistics[n].maxValue;for(m=r=v=P=0;m<p.size;m++)P+=k[m],v+=m*k[m];v/=P;for(m=0;m<p.size;m++)r+=k[m]*Math.pow(m-
v,2);k=Math.sqrt(r/(P-1));m=(v+.5)*(p.max-p.min)/p.size+p.min;p=k*(p.max-p.min)/p.size;x.push(C);x.push(F);x.push(m);x.push(p);b.statistics[n]=x}b.histograms=t},_getCutOffPoints:function(b){b=b.pixelBlock.pixels.length;var c=[],e=[],g,h,n;switch(d.stretchType){case 5:for(h=0;h<b;h++)c[h]=d._statistics[h][0],e[h]=d._statistics[h][1];break;case 3:for(h=0;h<b;h++)c[h]=d._statistics[h][2]-d.numberOfStandardDeviations*d._statistics[h][3],e[h]=d._statistics[h][2]+d.numberOfStandardDeviations*d._statistics[h][3],
c[h]<d._statistics[h][0]&&(c[h]=d._statistics[h][0]),e[h]>d._statistics[h][1]&&(e[h]=d._statistics[h][1]);break;case 6:for(h=0;h<b;h++){var m=d._histograms[h];var l=new Uint32Array(m.size);var t=m.counts;for(n=g=0;n<m.size;n++)g+=t[n],l[n]=g;t=d.minPercent*g/100;for(n=1;n<m.size;n++)if(l[n]>t){c[h]=m.min+(m.max-m.min)/m.size*(n-.5);break}t=(1-d.maxPercent/100)*g;for(n=m.size-2;0<=n;n--)if(l[n]<t){e[h]=m.min+(m.max-m.min)/m.size*(n+.5);break}}break;default:for(h=0;h<b;h++)c[h]=0,e[h]=255}return{minCutOff:c,
maxCutOff:e}},_createLUT:function(b){var c=b.pixelBlock,e=c.pixelType;if("U8"===e||"U16"===e||"S8"===e||"S16"===e){if(d._LUTSignature&&(e=d._computeLutSignature(),e.length===d._LUTSignature.length&&!e.some(function(J,R){return J!==d._LUTSignature[R]})))return;e=c.pixels.length;var g=[],h=[],n=[],m,l=d.max,t=d.min,v=d.gamma,r=l-t,p=d._getCutOffPoints(b);b=p.minCutOff;p=p.maxCutOff;var k=0,x=256;"S8"===c.pixelType?k=-127:"S16"===c.pixelType&&(k=-32767);if("U16"===c.pixelType||"S16"===c.pixelType)x=
65536;for(c=0;c<e;c++)g[c]=p[c]-b[c];if(d.useGamma&&null!==v&&v.length===e)for(c=0;c<e;c++)n[c]=1<v[c]?2<v[c]?6.5+Math.pow(v[c]-2,2.5):6.5+100*Math.pow(2-v[c],4):1;if(d.useGamma)for(c=0;c<e;c++){var C=[];for(m=0;m<x;m++){var F=m+k;var P=(F-b[c])/g[c];var M=1;1<v[c]&&(M-=Math.pow(1/r,P*n[c]));F<p[c]&&F>b[c]?C[m]=Math.floor(M*r*Math.pow(P,1/v[c]))+t:F>p[c]?C[m]=l:F<b[c]&&(C[m]=t)}h[c]=C}else for(c=0;c<e;c++){C=[];for(m=0;m<x;m++)F=m+k,C[m]=F<b[c]?t:F>p[c]?l:Math.floor((F-b[c])/g[c]*r)+t;h[c]=C}d.LUT=
h;d.LUTOffset=k;d._LUTSignature=d._computeLutSignature()}},_computeLutSignature:function(){var b=[],c,e;b.push(d.stretchType);b.push(d.min);b.push(d.max);b.push(d.numberOfStandardDeviations);if(d._statistics)for(c=0;c<d._statistics.length;c++)for(e=0;e<d._statistics[c].length;e++)b.push(d._statistics[c][e]);b.push(d.dra?1:0);b.push(d.minPercent);b.push(d.maxPercent);if(d.gamma)for(c=0;c<d._statistics.length;c++)b.push(d.gamma[c]);b.push(d.useGamma?1:0);return b},_filterNoLUT:function(b){if(null!==
b&&null!==b.pixelBlock&&null!==b.pixelBlock.pixels){var c=b.pixelBlock,e=c.pixels,g=c.mask;c=c.width*c.height;var h=e.length,n=[],m=[],l,t=d.max,v=d.min,r=d.gamma,p=t-v;var k=d._getCutOffPoints(b);var x=k.minCutOff,C=k.maxCutOff;for(k=0;k<h;k++)n[k]=C[k]-x[k];if(d.useGamma&&null!==r&&r.length===h)for(k=0;k<h;k++)m[k]=1<r[k]?2<r[k]?6.5+Math.pow(r[k]-2,2.5):6.5+100*Math.pow(2-r[k],4):1;if(d.useGamma)if(void 0!==g&&null!==g)for(l=0;l<c;l++){if(g[l])for(k=0;k<h;k++){var F=e[k][l];var P=(F-x[k])/n[k];
var M=1;1<r[k]&&(M-=Math.pow(1/p,P*m[k]));F<C[k]&&F>x[k]?e[k][l]=Math.floor(M*p*Math.pow(P,1/r[k]))+v:F>C[k]?e[k][l]=t:F<x[k]&&(e[k][l]=v)}}else for(l=0;l<c;l++)for(k=0;k<h;k++)F=e[k][l],P=(F-x[k])/n[k],M=1,1<r[k]&&(M-=Math.pow(1/p,P*m[k])),F<C[k]&&F>x[k]?e[k][l]=Math.floor(M*p*Math.pow(P,1/r[k]))+v:F>C[k]?e[k][l]=t:F<x[k]&&(e[k][l]=v);else if(void 0!==g&&null!==g)for(l=0;l<c;l++){if(g[l])for(k=0;k<h;k++)F=e[k][l],F<C[k]&&F>x[k]?e[k][l]=Math.floor((F-x[k])/n[k]*p)+v:F>C[k]?e[k][l]=t:F<x[k]&&(e[k][l]=
v)}else for(l=0;l<c;l++)for(k=0;k<h;k++)F=e[k][l],F<C[k]&&F>x[k]?e[k][l]=Math.floor((F-x[k])/n[k]*p)+v:F>C[k]?e[k][l]=t:F<x[k]&&(e[k][l]=v);b.pixelBlock.pixelType="U8";return b}},_computeGammaValues:function(b){var c=this._statistics.length,e,g=[];for(e=0;e<c;e++){var h=this._statistics[e][2];"U8"!==b&&(h=255*(h-this._statistics[e][0])/(this._statistics[e][1]-this._statistics[e][0]));g.push(this._computeGammaValue(h))}return g},_computeGammaValue:function(b){if(0!==b&&!(255<b||0>b)){var c=0;0<b&&
150!=b&&255>b&&(c=150>=b?45*Math.cos(.01047*b):17*Math.sin(.021*b));c=Math.log((b+c)/255);if(0!==c&&(b=Math.log(b/255)/c,!isNaN(b)))return Math.min(9.9,Math.max(.01,b))}}})})},"*noref":1}});
define("esri/layers/RasterLayer","dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojo/number ../kernel ../lang ../domUtils ./BaseRasterLayer ./ImageServiceLayerMixin ./pixelFilters/StretchFilter ../SpatialReference ../geometry/Point".split(" "),function(O,A,H,d,b,c,e,g,h,n,m,l,t,v,r,p){O=O([l,t],{declaredClass:"esri.layers.RasterLayer",constructor:function(k,x){this.pixelData=null;null!==this.format&&void 0!==this.format||this.setImageFormat("LERC",
!0)},_setDefaultFilter:function(){if(this.loaded&&this.drawType&&!this._isVectorData()&&(!this.pixelFilter||this._isDefaultPixelFilter))if("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))this._isDefaultPixelFilter&&(this.pixelFilter=null,this._isDefaultPixelFilter=!1);else{var k;if(this.minValues&&this.maxValues&&this.stdvValues&&this.meanValues){var x=[];for(k=0;k<this.minValues.length;k++)x.push([this.minValues[k],this.maxValues[k],
this.meanValues[k],this.stdvValues[k]]);this.bandCount!==x.length&&(x=null)}k=0;var C=!1;"U8"===this.pixelType?(k=5,C=x?!1:!0):x?(k=5,C=!1):(k=6,C=!0);this.renderingRule&&(k=5,C=!0);this.pixelFilter=(new v({stretchType:k,min:0,max:255,dra:C,minPercent:.25,maxPercent:.25,useGamma:!1,computeGamma:!1,statistics:x,numberOfStandardDeviations:2.5})).filter;this._isDefaultPixelFilter=!0}}});b("extend-esri")&&A.setObject("layers.RasterLayer",O,h);return O});