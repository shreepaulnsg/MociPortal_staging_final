// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/ArcGISTiledMapServiceLayer","dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has dojo/io-query ../kernel ../urlUtils ../SpatialReference ./TiledMapServiceLayer ./ArcGISMapServiceLayer ./TileInfo ./TimeInfo ./TileMap".split(" "),function(n,g,h,A,p,q,m,r,k,t,u,v,w,x,y){g=g([u,v],{declaredClass:"esri.layers.ArcGISTiledMapServiceLayer",_agolAttrs:"Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Elevation/World_Hillshade Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Ocean_Basemap Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Transportation World_Imagery World_Street_Map World_Topo_Map".split(" "),
_isReference:!1,_referenceLayers:"Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Reference Ocean/World_Ocean_Reference Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Reference_Overlay Reference/World_Transportation".split(" "),constructor:function(a,b){b&&(b.roundrobin&&(n.deprecated(this.declaredClass+" : Constructor option 'roundrobin' deprecated. Use option 'tileServers'."),b.tileServers=b.roundrobin),this._setTileServers(b.tileServers),
this._loadCallback=b.loadCallback);this._params=h.mixin({},this._url.query);this._initLayer=h.hitch(this,this._initLayer);(a=b&&b.resourceInfo)?this._initLayer(a):(this._load=h.hitch(this,this._load),this._load())},_TILE_FORMATS:{PNG:"png",PNG8:"png",PNG24:"png",PNG32:"png",JPG:"jpg",JPEG:"jpg",GIF:"gif"},_setTileServers:function(a){if(a&&0<a.length){this.tileServers=a;var b,c=a.length;for(b=0;b<c;b++)a[b]=k.urlToObject(a[b]).path}},_initLayer:function(a,b){this.inherited(arguments);this.resourceInfo=
p.toJson(a);this.tileInfo=new w(a.tileInfo);!1!==this.resampling&&(a.capabilities&&-1<a.capabilities.indexOf("Tilemap")?(this.resampling=!0,this.tileMap=new y(this)):this.resampling=!!a.resampling);!this.spatialReference&&this.tileInfo.spatialReference&&(this.spatialReference=new t(this.tileInfo.spatialReference.toJson()));this.isPNG32="PNG24"===this.tileInfo.format||"PNG32"===this.tileInfo.format;a.timeInfo&&(this.timeInfo=new x(a.timeInfo));a.mensurationCapabilities&&(this.mensurationCapabilities=
a.mensurationCapabilities);var c=this._url.path,f=this._loadCallback,l=k.getProtocolForWebResource(!0),d=c.match(/^https?:\/\/(server|services)\.arcgisonline\.com\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i);d=d&&d[2];if(!this.tileServers)if(a.tileServers)this._setTileServers(a.tileServers);else{var e=-1!==c.search(/^https?:\/\/server\.arcgisonline\.com/i),z=-1!==c.search(/^https?:\/\/services\.arcgisonline\.com/i);(e||z)&&this._setTileServers([c,c.replace(e?/server\.arcgisonline/i:
/services\.arcgisonline/i,e?"services.arcgisonline":"server.arcgisonline")])}if(d){d=d.toLowerCase();for(c=0;c<this._agolAttrs.length;c++)if(e=this._agolAttrs[c],e.toLowerCase()===d){this.hasAttributionData=!0;this.attributionDataUrl=this.attributionDataUrl||l+"//static.arcgis.com/attribution/"+e;break}for(c=0;c<this._referenceLayers.length;c++)if(e=this._referenceLayers[c],e.toLowerCase()===d){this._isReference=!0;break}}this.loaded=!0;this.onLoad(this);f&&(delete this._loadCallback,f(this))},getTileUrl:function(a,
b,c){var f=this.tileServers,l=this._getToken(),d=this._url.query;a=(f?f[b%f.length]:this._url.path)+"/tile/"+a+"/"+b+"/"+c;a=k.upgradeToHTTPS(a);this.resampling&&!this.tileMap&&(a+="?blankTile\x3dfalse");d&&(a=this.resampling&&!this.tileMap?a+("\x26"+m.objectToQuery(d)):a+("?"+m.objectToQuery(d)));!l||d&&d.token||(a+=(-1===a.indexOf("?")?"?":"\x26")+"token\x3d"+l);a=this.addTimestampToURL(a);return k.addProxy(a)}});q("extend-esri")&&h.setObject("layers.ArcGISTiledMapServiceLayer",g,r);return g});