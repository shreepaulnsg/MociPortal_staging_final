// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/views/webgl/ShaderTranspiler",["require","exports","./reservedWordsGLSL3","./lib/glsl-tokenizer/string"],function(A,u,w,x){function y(b){return b.map(function(c){return"eof"!==c.type?c.data:""}).join("")}function q(b,c,d,a){a=a||d;for(var f=0;f<b.length;f++){var g=b[f];if("ident"===g.type&&g.data===d)return a in c?c[a]++:c[a]=0,q(b,c,a+"_"+c[a],a)}return d}function z(b,c,d){void 0===d&&(d="afterVersion");var a={data:"\n",type:"whitespace"},f=function(e){return e<b.length?
/[^\r\n]$/.test(b[e].data):!1},g=function(e){for(var l=-1,r=0,p=-1,n=0;n<e.length;n++){var h=e[n];"preprocessor"===h.type&&(h.data.match(/#(if|ifdef|ifndef)\s+.+/)?++r:h.data.match(/#endif\s*.*/)&&--r);("afterVersion"===d||"afterPrecision"===d)&&"preprocessor"===h.type&&/^#version/.test(h.data)&&(p=Math.max(p,n));if("afterPrecision"===d&&"keyword"===h.type&&"precision"===h.data){a:{for(h=n;h<e.length;h++){var v=e[h];if("operator"===v.type&&";"===v.data)break a}h=null}if(null===h)throw Error("precision statement not followed by any semicolons!");
p=Math.max(p,h)}l<p&&0===r&&(l=n)}return l+1}(b);f(g-1)&&b.splice(g++,0,a);for(var k=0;k<c.length;k++){var m=c[k];b.splice(g++,0,m)}f(g-1)&&f(g)&&b.splice(g,0,a)}Object.defineProperty(u,"__esModule",{value:!0});var t=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];u.transpileShader=function(b,c){b=x(b);a:{var d="100";var a="300 es";void 0===d&&(d="100");void 0===a&&(a="300 es");for(var f=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/,g=0;g<b.length;g++){var k=
b[g];if("preprocessor"===k.type){var m=f.exec(k.data);if(m)if(f=m[1].replace(/\s\s+/g," "),f===a){d=f;break a}else if(f===d){k.data="#version "+a;break a}else throw Error("unknown glsl version: "+f);}}b.splice(0,0,{type:"preprocessor",data:"#version "+a},{type:"whitespace",data:"\n"});d=null}if("300 es"===d)throw Error("shader is already glsl 300 es");f=k=null;g={};m={};for(d=0;d<b.length;++d)switch(a=b[d],a.type){case "keyword":"vertex"===c&&"attribute"===a.data?a.data="in":"varying"===a.data&&(a.data=
"vertex"===c?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(a.data.trim())&&(a.data=a.data.replace(/(2D|Cube|EXT)/g,""));if("fragment"===c&&"gl_FragColor"===a.data){if(!k){k=q(b,g,"fragColor");var e=void 0;void 0===e&&(e="lowp");z(b,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:e},{type:"whitespace",data:" "},{type:"keyword",data:"vec4"},{type:"whitespace",data:" "},{type:"ident",data:k},{type:"operator",data:";"}],"afterPrecision")}a.data=
k}else"fragment"===c&&"gl_FragDepthEXT"===a.data&&(f||(f=q(b,g,"gl_FragDepth")),a.data=f);break;case "ident":if(0<=w.indexOf(a.data)){if(e="vertex"===c)a:{for(e=d-1;0<=e;e--){var l=b[e];if("whitespace"!==l.type&&"block-comment"!==l.type)if("keyword"===l.type){if("attribute"===l.data||"in"===l.data){e=!0;break a}}else break}e=!1}if(e)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");a.data in m||(m[a.data]=q(b,g,a.data));a.data=m[a.data]}}for(d=b.length-1;0<=
d;--d)a=b[d],"preprocessor"===a.type&&((c=a.data.match(/#extension\s+(.*):/))&&c[1]&&0<=t.indexOf(c[1].trim())&&(c=b[d+1],b.splice(d,c&&"whitespace"===c.type?2:1)),(c=a.data.match(/#ifdef\s+(.*)/))&&c[1]&&0<=t.indexOf(c[1].trim())&&(a.data="#if 1"),(c=a.data.match(/#ifndef\s+(.*)/))&&c[1]&&0<=t.indexOf(c[1].trim())&&(a.data="#if 0"));return y(b)}});