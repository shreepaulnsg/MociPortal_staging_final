// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/views/webgl/ShaderVariations",["require","exports","./Program","./ShaderSourceVariator","./Util"],function(p,q,l,n,k){function m(e){return e.reduce(function(a,b,c){b&&(a|=1<<c);return a},0)}return function(){function e(a,b,c,f,g,d){"string"===typeof a?this._initParams(a,b,c,f,g,d):this._initObject({programNamePrefix:a.programNamePrefix,shaderSnippetPrefixes:a.shaderSnippetPrefixes,baseDefines:a.baseDefines,snippets:a.snippets,rctx:a.rctx,vertexAttribLocs:a.vertexAttribLocs})}
e.prototype.dispose=function(){this._programCache&&(this._programCache.forEach(function(a){return a.dispose()}),this._programCache.clear())};e.prototype._initObject=function(a){this._initParams(a.programNamePrefix,a.shaderSnippetPrefixes,a.baseDefines,a.snippets,a.rctx,a.vertexAttribLocs)};e.prototype._initParams=function(a,b,c,f,g,d){this._defaultSnippets=f;this._defaultRctx=g;this._defaultVertexAttribLocs=d;this._programCache=new Map;this._variationInfo=new Map;this._shaderSourceVariator=new n(a,
b,c)};e.prototype.addDefine=function(a,b,c,f){this._shaderSourceVariator.addDefine(a,b,c,f)};e.prototype.addBinaryShaderSnippetSuffix=function(a,b,c){this._shaderSourceVariator.addBinaryShaderSnippetSuffix(a,b,c)};e.prototype.addNaryShaderSnippetSuffix=function(a,b){this._shaderSourceVariator.addNaryShaderSnippetSuffix(a,b)};e.prototype.getProgram=function(a,b,c,f){b=b||this._defaultSnippets;c=c||this._defaultRctx;f=f||this._defaultVertexAttribLocs;if(!b)throw Error("No ShaderSnippets provided to getProgram nor to ShaderVariations constructor.");
if(!c)throw Error("No RenderingContext provided to getProgram nor to ShaderVariations constructor.");if(!f)throw Error("No VertexAttributeLocations provided to getProgram nor to ShaderVariations constructor.");var g=m(a);if(this._programCache.has(g))return this._programCache.get(g);a=this._shaderSourceVariator.getShaderVariation(a);var d=a.shaderSnippetNames[0];var h=b[d];k.assert(null!=h,"shader snippet '"+d+"' does not exist");d=a.shaderSnippetNames[1];b=b[d];k.assert(null!=b,"shader snippet '"+
d+"' does not exist");c=new l(c,h,b,f,a.defines);this._programCache.set(g,c);return c};e.prototype.getProgramByKey=function(a){if(this._programCache.has(a))return this._programCache.get(a);if(!this._variationInfo[a])return null;var b=this._variationInfo[a],c=this._defaultSnippets,f=this._defaultRctx,g=this._defaultVertexAttribLocs;var d=b.shaderSnippetNames[0];var h=c[d];k.assert(null!=h,"shader snippet '"+d+"' does not exist");d=b.shaderSnippetNames[1];c=c[d];k.assert(null!=c,"shader snippet '"+
d+"' does not exist");b=new l(f,h,c,g,b.defines);this._programCache.set(a,b);return b};e.prototype.getProgramInfo=function(a){var b=this._shaderSourceVariator.getShaderVariation(a);a=m(a);this._variationInfo[a]||(this._variationInfo[a]=b);return{name:b.programName,key:a}};return e}()});