// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/views/vectorTiles/renderers/FillRenderer","require exports ../../../core/libs/gl-matrix/mat3 ../../../core/libs/gl-matrix/mat4 ../../../core/libs/gl-matrix/vec3 ../../../core/libs/gl-matrix/vec4 ../GeometryUtils ./rendererUtils ./vtShaderSnippets ../../webgl/ShaderVariations ../../webgl/VertexArrayObject".split(" "),function(J,K,B,z,G,C,H,I,D,E,y){var F=1/65536;return function(){function r(){this._fillAttributeLocations={a_pos:0};this._fillAttributeLocationsDD={a_pos:0,
a_color:1};this._outlineAttributeLocations={a_pos:0,a_offset:1,a_xnormal:2};this._outlineAttributeLocationsDD={a_pos:0,a_offset:1,a_xnormal:2,a_color:3};this._initialized=!1;this._viewProjMat=z.create();this._offsetVector=G.create();this._patternMatrix=B.create();this._color=C.create();this._outlineColor=C.create()}r.prototype.dispose=function(){};r.prototype.render=function(d,a,b,c,m,l,h,A,x,n,e){if(0!==a.triangleElementCount){this._initialized||this._initialize(d);var t=void 0!==h.getPaintValue("fill-pattern",
b),f=h.hasDataDrivenColor?[1,1,1,1]:h.getPaintValue("fill-color",b),p=h.hasDataDrivenOpacity?1:h.getPaintValue("fill-opacity",b),g=p*f[3]*e;this._color[0]=g*f[0];this._color[1]=g*f[1];this._color[2]=g*f[2];this._color[3]=g;f=3===m;var k;f&&(k=I.int32To4Bytes(a.layerID));g=l.tileTransform.transform;var u=l.coordRange/512,q=h.getPaintValue("fill-translate",b);if(0!==q[0]||0!==q[1]){z.copy(this._viewProjMat,l.tileTransform.transform);g=q[0];q=q[1];var v=0,w=0;u*=(1<<l.key.level)/Math.pow(2,b);1===h.getPaintValue("fill-translate-anchor",
b)?(v=-H.C_DEG_TO_RAD*c,c=Math.sin(v),w=Math.cos(v),v=u*(g*w-q*c),w=u*(g*c+q*w)):(v=u*g,w=u*q);this._offsetVector[0]=v;this._offsetVector[1]=w;this._offsetVector[2]=0;z.translate(this._viewProjMat,this._viewProjMat,this._offsetVector);g=this._viewProjMat}this._drawFill(d,a,b,m,l,h,A,g,n,e,f,k);if(h.getPaintValue("fill-antialias",b)&&!t&&0<a.outlineElementCount&&(1===m||3===m)){m=h.hasDataDrivenOutline;if(h.outlineUsesFillColor){if(1!==this._color[3])return;this._outlineColor[0]=this._color[0];this._outlineColor[1]=
this._color[1];this._outlineColor[2]=this._color[2];this._outlineColor[3]=this._color[3]}else b=h.hasDataDrivenOutlineColor?[1,1,1,1]:h.getPaintValue("fill-outline-color",b),e*=p*b[3],this._outlineColor[0]=e*b[0],this._outlineColor[1]=e*b[1],this._outlineColor[2]=e*b[2],this._outlineColor[3]=e;n=.75/n;if(e=this._getOutlineVAO(d,l,m))d.bindVAO(e),e=this._outlineShaderVariations.getProgram([m,f],void 0,void 0,m?this._outlineAttributeLocationsDD:this._outlineAttributeLocations),d.bindProgram(e),e.setUniformMatrix4fv("u_transformMatrix",
g),e.setUniformMatrix4fv("u_extrudeMatrix",x),e.setUniform2fv("u_normalized_origin",l.tileTransform.displayCoord),e.setUniform1f("u_depth",h.z+F),e.setUniform1f("u_outline_width",n),e.setUniform4fv("u_color",this._outlineColor),f&&e.setUniform4f("u_id",k[0],k[1],k[2],k[3]),d.drawElements(4,a.outlineElementCount,5125,12*a.outlineElementStart),d.bindVAO()}}};r.prototype._initialize=function(d){if(this._initialized)return!0;var a=new E("fill",["fillVS","fillFS"],[],D,d);a.addDefine("PATTERN","PATTERN",
[!0,!0],"PATTERN");a.addDefine("DD","DD",[!0,!1],"DD");a.addDefine("ID","ID",[!0,!0],"ID");this._fillShaderVariations=a;this._fillVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]};this._fillVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:8,normalized:!0,divisor:0}]};d=new E("outline",["outlineVS","outlineFS"],[],D,d);d.addDefine("DD","DD",
[!0,!1],"DD");d.addDefine("ID","ID",[!0,!0],"ID");this._outlineShaderVariations=d;this._outlineVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:8,normalized:!1,divisor:0}]};this._outlineVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offset",count:2,
type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:12,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:12,normalized:!0,divisor:0}]};return this._initialized=!0};r.prototype._drawFill=function(d,a,b,c,m,l,h,A,x,n,e,t){var f=l.getPaintValue("fill-pattern",b),p=void 0!==f,g=l.hasDataDrivenOpacity?1:n*l.getPaintValue("fill-opacity",b),k=l.hasDataDrivenColor?[1,1,1,1]:l.getPaintValue("fill-color",b);n*=g*k[3];this._color[0]=
n*k[0];this._color[1]=n*k[1];this._color[2]=n*k[2];this._color[3]=n;k=l.hasDataDrivenFill;g=!1;!p&&(k?0:1===n)&&(g=!0);if(!p||0!==c)if(!g||1!==c)if(p||g||0!==c)if(c=this._getFillVAO(d,m,k))d.bindVAO(c),c=this._fillShaderVariations.getProgram([p,k,e],void 0,void 0,k?this._fillAttributeLocationsDD:this._fillAttributeLocations),d.bindProgram(c),p&&(f=h.getMosaicItemPosition(f,!0))&&(b=m.coordRange/512/Math.pow(2,Math.round(b)-m.key.level)/x,B.identity(this._patternMatrix),x=1/(f.size[1]*b),this._patternMatrix[0]=
1/(f.size[0]*b),this._patternMatrix[4]=x,h.bind(d,9729,f.page,1),c.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix),c.setUniform2f("u_pattern_tl",f.tl[0],f.tl[1]),c.setUniform2f("u_pattern_br",f.br[0],f.br[1]),c.setUniform1i("u_texture",1)),c.setUniformMatrix4fv("u_transformMatrix",A),c.setUniform2fv("u_normalized_origin",m.tileTransform.displayCoord),c.setUniform1f("u_depth",l.z+F),c.setUniform4fv("u_color",this._color),e&&c.setUniform4f("u_id",t[0],t[1],t[2],t[3]),d.drawElements(4,a.triangleElementCount,
5125,12*a.triangleElementStart),d.bindVAO()};r.prototype._getFillVAO=function(d,a,b){if(b){if(a.fillDDVertexArrayObject)return a.fillDDVertexArrayObject;b=a.fillDDVertexBuffer;var c=a.fillIndexBuffer;if(!b||!c)return null;a.fillDDVertexArrayObject=new y(d,this._fillAttributeLocationsDD,this._fillVertexAttributesDD,{geometry:b},c);return a.fillDDVertexArrayObject}if(a.fillVertexArrayObject)return a.fillVertexArrayObject;b=a.fillVertexBuffer;c=a.fillIndexBuffer;if(!b||!c)return null;a.fillVertexArrayObject=
new y(d,this._fillAttributeLocations,this._fillVertexAttributes,{geometry:b},c);return a.fillVertexArrayObject};r.prototype._getOutlineVAO=function(d,a,b){if(b){if(a.outlineDDVertexArrayObject)return a.outlineDDVertexArrayObject;b=a.outlineDDVertexBuffer;var c=a.outlineIndexBuffer;if(!b||!c)return null;a.outlineDDVertexArrayObject=new y(d,this._outlineAttributeLocationsDD,this._outlineVertexAttributesDD,{geometry:b},c);return a.outlineDDVertexArrayObject}if(a.outlineVertexArrayObject)return a.outlineVertexArrayObject;
b=a.outlineVertexBuffer;c=a.outlineIndexBuffer;if(!b||!c)return null;a.outlineVertexArrayObject=new y(d,this._outlineAttributeLocations,this._outlineVertexAttributes,{geometry:b},c);return a.outlineVertexArrayObject};return r}()});