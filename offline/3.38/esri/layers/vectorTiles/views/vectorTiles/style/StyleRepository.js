// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/views/vectorTiles/style/StyleRepository",["require","exports","dojo/has","./StyleLayer"],function(q,r,p,k){return function(){function l(b,c){this.styleJSON=b;this.version=parseFloat(b.version);this.sprite=c?c.spriteUrl:b.sprite;this.glyphs=c?c.glyphsUrl:b.glyphs;if(p("stable-symbol-rendering")){var f=(b.layers||[]).filter(function(e){return e.layout&&e.layout["text-font"]})[0];f&&(b.layers||[]).forEach(function(e){e.layout&&e.layout["text-font"]&&(e.layout["text-font"]=
f.layout["text-font"])})}this.layers=(b.layers||[]).map(l._create);this._identifyRefLayers()}l.prototype._identifyRefLayers=function(){for(var b=[],c=[],f=0,e=0,h=this.layers;e<h.length;e++){var a=h[e];if(1===a.type){var g=a,d=a.sourceLayer;d+="|"+JSON.stringify(a.minzoom);d+="|"+JSON.stringify(a.maxzoom);d+="|"+JSON.stringify(a.filter);if(g.hasDataDrivenFill||g.hasDataDrivenOutline)d+="|"+JSON.stringify(f);b.push({key:d,layer:a})}2===a.type&&(g=a,d=a.sourceLayer,d+="|"+JSON.stringify(a.minzoom),
d+="|"+JSON.stringify(a.maxzoom),d+="|"+JSON.stringify(a.filter),d+="|"+JSON.stringify(a.layout&&a.layout["line-cap"]),d+="|"+JSON.stringify(a.layout&&a.layout["line-join"]),g.hasDataDrivenLine&&(d+="|"+JSON.stringify(f)),c.push({key:d,layer:a}));++f}this._assignRefLayers(b);this._assignRefLayers(c)};l.prototype._assignRefLayers=function(b){b.sort(function(m,n){return m.key<n.key?-1:m.key>n.key?1:0});for(var c,f,e=b.length,h=0;h<e;h++){var a=b[h];if(a.key===c)a.layer.refLayerId=f;else if(c=a.key,
f=a.layer.id,1===a.layer.type&&!a.layer.getPaintProperty("fill-outline-color"))for(var g=h+1;g<e;g++){var d=b[g];if(d.key===c){if(d.layer.getPaintProperty("fill-outline-color")){b[h]=d;b[g]=a;f=d.layer.id;break}}else break}}};l._create=function(b,c,f){c=1-1/(f.length+1)*(1+c);switch(b.type){case "background":return new k.BackgroundStyleLayer(0,b,c);case "fill":return new k.FillStyleLayer(1,b,c);case "line":return new k.LineStyleLayer(2,b,c);case "symbol":return new k.SymbolStyleLayer(3,b,c);case "raster":throw Error("Unsupported vector tile raster layer");
case "circle":return new k.CircleStyleLayer(4,b,c)}throw Error("Unknown vector tile layer");};return l}()});