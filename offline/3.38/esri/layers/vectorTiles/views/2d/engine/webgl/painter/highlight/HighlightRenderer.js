// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/views/2d/engine/webgl/painter/highlight/HighlightRenderer","require exports ../../shaders/hlShaderSnippets ../../../../../webgl/BufferObject ../../../../../webgl/ShaderVariations ../../../../../webgl/Texture ../../../../../webgl/VertexArrayObject".split(" "),function(B,C,u,w,v,x,y){var t=[void 0,void 0,void 0,1],l=[3,4],z=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],A=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return function(){function h(){this._height=this._width=void 0;this._highlightOptions=
{fillColor:[.2,.6,.9,.75],outlineColor:[.2,.6,.9,.9],outlinePosition:0,outlineWidth:3.4,innerHaloWidth:2,outerHaloWidth:3.3};this._resources=null}h.prototype.dispose=function(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources.shadeTex.dispose(),this._resources=null)};h.prototype.preBlur=function(a,d){a.bindTexture(d,l[0]);a.bindProgram(this._resources.blurProgram);
this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",z);a.bindVAO(this._resources.quadVAO);a.drawArrays(5,0,4);a.bindVAO()};h.prototype.finalBlur=function(a,d){a.bindTexture(d,l[0]);a.bindProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",A);a.bindVAO(this._resources.quadVAO);
a.drawArrays(5,0,4);a.bindVAO()};h.prototype.renderHighlight=function(a,d){a.bindTexture(d,l[0]);a.bindTexture(this._resources.shadeTex,l[1]);a.bindProgram(this._resources.highlightProgram);a.bindVAO(this._resources.quadVAO);a.drawArrays(5,0,4);a.bindVAO()};h.prototype._initialize=function(a,d,e){this._width=d;this._height=e;d=new w(a,34962,35044,(new Int8Array([-128,-128,0,0,127,-128,255,0,-128,127,0,255,127,127,255,255])).buffer);e=new y(a,{a_position:0,a_texcoord:1},{geometry:[{name:"a_position",
count:2,type:5120,offset:0,stride:4,normalized:!0},{name:"a_texcoord",count:2,type:5121,offset:2,stride:4,normalized:!0}]},{geometry:d});var m=(new v("hl",["texturedVS","highlightFS"],[],u,a,{a_position:0,a_texcoord:1})).getProgram([]),n=(new v("hl",["texturedVS","blurFS"],[],u,a,{a_position:0,a_texcoord:1})).getProgram([]);m.setUniform1i("u_texture",l[0]);m.setUniform1i("u_shade",l[1]);m.setUniform4fv("u_sigmas",t);n.setUniform1i("u_texture",l[0]);n.setUniform4fv("u_sigmas",t);a=new x(a,{target:3553,
pixelFormat:6408,dataType:5121,wrapMode:33071,width:256,height:1,samplingMode:9728});this._resources={quadGeometry:d,quadVAO:e,highlightProgram:m,blurProgram:n,shadeTex:a}};h.prototype.setHighlightOptions=function(a){function d(q,r,k){f[0]=(1-k)*q[0]+k*r[0];f[1]=(1-k)*q[1]+k*r[1];f[2]=(1-k)*q[2]+k*r[2];f[3]=(1-k)*q[3]+k*r[3]}this._highlightOptions=a;if(this._resources){var e=a.outlinePosition-a.outlineWidth/2-a.outerHaloWidth,m=a.outlinePosition-a.outlineWidth/2,n=a.outlinePosition+a.outlineWidth/
2,p=a.outlinePosition+a.outlineWidth/2+a.innerHaloWidth,c=Math.sqrt(Math.PI/2)*t[3],b=Math.abs(e)>c?Math.round(10*(Math.abs(e)-c))/10:0;c=Math.abs(p)>c?Math.round(10*(Math.abs(p)-c))/10:0;b&&!c?console.warn("The outer rim of the highlight is "+b+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!b&&c?console.warn("The inner rim of the highlight is "+c+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):
b&&c&&console.warn("The highlight is "+Math.max(b,c)+"px away from the edge of the feature; consider reducing some width values.");b=new Uint8Array(1024);for(var f=[void 0,void 0,void 0,void 0],g=0;256>g;++g)c=e+g/255*(p-e),c<e?(b[4*g]=0,b[4*g+1]=0,b[4*g+2]=0,b[4*g+3]=0):c<m?d([0,0,0,0],a.outlineColor,(c-e)/(m-e)):c<n?(f[0]=a.outlineColor[0],f[1]=a.outlineColor[1],f[2]=a.outlineColor[2],f[3]=a.outlineColor[3]):c<p?d(a.outlineColor,a.fillColor,(c-n)/(p-n)):(b[4*g]=a.fillColor[0],b[4*g+1]=a.fillColor[1],
b[4*g+2]=a.fillColor[2],b[4*g+3]=a.fillColor[3]),b[4*g]=255*f[0]*f[3],b[4*g+1]=255*f[1]*f[3],b[4*g+2]=255*f[2]*f[3],b[4*g+3]=255*f[3];this._resources.highlightProgram.setUniform2fv("u_minMaxDistance",[e,p]);this._resources.shadeTex.updateData(0,0,0,256,1,b)}};h.prototype.setup=function(a,d,e){this._resources?(this._width=d,this._height=e):(this._initialize(a,d,e),this.setHighlightOptions(this._highlightOptions))};return h}()});