// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/views/2d/engine/webgl/GlyphSource",["require","exports","../../../../request","../../../../core/pbf","../../../../core/promiseUtils"],function(u,v,n,p,q){var r=function(){function d(a){this._metrics=[];for(this._bitmaps=[];a.next();)switch(a.tag()){case 1:for(var b=a.getMessage();b.next();)switch(b.tag()){case 3:for(var c=b.getMessage(),e=void 0,g=void 0,f=void 0,h=void 0,k=void 0,l=void 0,m=void 0;c.next();)switch(c.tag()){case 1:e=c.getUInt32();break;case 2:g=c.getBytes();
break;case 3:f=c.getUInt32();break;case 4:h=c.getUInt32();break;case 5:k=c.getSInt32();break;case 6:l=c.getSInt32();break;case 7:m=c.getUInt32();break;default:c.skip()}e&&(this._metrics[e]={width:f,height:h,left:k,top:l,advance:m},this._bitmaps[e]=g);break;default:b.skip()}break;default:a.skip()}}d.prototype.getMetrics=function(a){return this._metrics[a]};d.prototype.getBitmap=function(a){return this._bitmaps[a]};return d}(),t=function(){function d(){this._ranges=[]}d.prototype.getRange=function(a){return this._ranges[a]};
d.prototype.addRange=function(a,b){this._ranges[a]=b};return d}();return function(){function d(a){this._glyphInfo={};this._baseURL=a}d.prototype.getRange=function(a,b){var c=this._getFontStack(a);if(c.getRange(b))return q.resolve();var e=256*b,g=e+255;a=this._baseURL.replace("{fontstack}",a).replace("{range}",e+"-"+g);return n(a,{callbackParamName:"callback",responseType:"array-buffer"}).then(function(f){c.addRange(b,new r(new p(new Uint8Array(f.data),new DataView(f.data))))})};d.prototype.getGlyph=
function(a,b){if(a=this._getFontStack(a)){var c=Math.floor(b/256);if(!(256<c)&&(a=a.getRange(c)))return{metrics:a.getMetrics(b),bitmap:a.getBitmap(b)}}};d.prototype._getFontStack=function(a){var b=this._glyphInfo[a];b||(b=this._glyphInfo[a]=new t);return b};return d}()});