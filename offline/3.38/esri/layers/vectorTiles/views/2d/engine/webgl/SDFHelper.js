// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/views/2d/engine/webgl/SDFHelper",["require","exports","./Geometry","./Rect","../../../3d/webgl-engine/lib/Util"],function(C,B,F,G,H){function D(v,a,b){H.packFloatRGBA(v,a,b)}Object.defineProperty(B,"__esModule",{value:!0});B.packFloat=D;C=function(){function v(){}v.checkSDF=function(a){return!0};v.prototype._extractGeometry=function(a){if(!a)return null;a=a.symbolLayers;if(!a||1!==a.length)return null;a=a[0];if(!a)return null;a=a.markerGraphics;if(!a||1!==a.length)return null;
a=a[0];if(!a)return null;var b=a.geometry;if(!b||!b.rings)return null;a=[];var e=0;for(b=b.rings;e<b.length;e++){for(var d=[],f=0,h=b[e];f<h.length;f++){var l=h[f];d.push(new F.Point(l[0],l[1]))}a.push(d)}return a};v.prototype._getEnvelope=function(a){for(var b=Infinity,e=-Infinity,d=Infinity,f=-Infinity,h=0;h<a.length;h++)for(var l=0,g=a[h];l<g.length;l++){var k=g[l];k.x<b&&(b=k.x);k.x>e&&(e=k.x);k.y<d&&(d=k.y);k.y>f&&(f=k.y)}return new G(b,d,e-b,f-d)};v.prototype.buildSDF=function(a){a=this._extractGeometry(a);
if(!a)return null;var b=this._getEnvelope(a);if(0>=b.width||0>=b.height)return null;for(var e=64/Math.max(b.width,b.height),d=Math.round(b.width*e),f=Math.round(b.height*e),h=d+62,l=f+62,g=0;g<a.length;g++)for(var k=0,q=a[g];k<q.length;k++){var c=q[k];c.x-=b.x;c.y-=b.y;c.x*=e;c.y*=e;c.x+=30.5;c.y+=30.5}b=this._dist_map(a,h,l,31);this._sign_dist_map(a,h,l,31,b);return[this._encodeDistMap(b,31),h,l,d,f,e]};v.prototype._dist_map=function(a,b,e,d){for(var f=b*e,h=new Float32Array(f),l=d*d+1,g=0;g<f;++g)h[g]=
l;for(l=0;l<a.length;l++){var k=a[l],q=k.length;for(g=1;g<q;++g){var c=k[g-1],n=k[g],r=void 0,m=void 0;c.x<n.x?(r=c.x,m=n.x):(r=n.x,m=c.x);var t=void 0,u=void 0;c.y<n.y?(t=c.y,u=n.y):(t=n.y,u=c.y);var p=Math.floor(r)-d;m=Math.floor(m)+d;t=Math.floor(t)-d;u=Math.floor(u)+d;0>p&&(p=0);m>b&&(m=b);0>t&&(t=0);u>e&&(u=e);r=n.x-c.x;for(var A=n.y-c.y,E=r*r+A*A;p<m;p++)for(var y=t;y<u;y++){var w=(p-c.x)*r+(y-c.y)*A,x=void 0,z=void 0;0>w?(x=c.x,z=c.y):w>E?(x=n.x,z=n.y):(w/=E,x=c.x+w*r,z=c.y+w*A);w=(p-x)*(p-
x)+(y-z)*(y-z);x=(e-y-1)*b+p;w<h[x]&&(h[x]=w)}}}for(g=0;g<f;++g)h[g]=Math.sqrt(h[g]);return h};v.prototype._sign_dist_map=function(a,b,e,d,f){for(var h=0;h<a.length;h++)for(var l=a[h],g=l.length,k=1;k<g;++k){var q=l[k-1],c=l[k],n=void 0,r=void 0;q.x<c.x?(n=q.x,r=c.x):(n=c.x,r=q.x);var m=void 0,t=void 0;q.y<c.y?(m=q.y,t=c.y):(m=c.y,t=q.y);n=Math.floor(n);r=Math.floor(r)+1;m=Math.floor(m);t=Math.floor(t)+1;n<d&&(n=d);r>b-d&&(r=b-d);m<d&&(m=d);for(t>e-d&&(t=e-d);m<t;++m)if(q.y>m!==c.y>m){for(var u=(e-
m-1)*b,p=n;p<r;++p)p<(c.x-q.x)*(m-q.y)/(c.y-q.y)+q.x&&(f[u+p]=-f[u+p]);for(p=d;p<n;++p)f[u+p]=-f[u+p]}}};v.prototype._encodeDistMap=function(a,b){b*=2;for(var e=a.length,d=new Uint8Array(4*e),f=0;f<e;++f)D(.5-a[f]/b,d,4*f);return d};return v}();B.SDFHelper=C});