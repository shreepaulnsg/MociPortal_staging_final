// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/views/2d/engine/webgl/brushes/WGLGeometryBrushLabel","require exports ../../../../../core/tsSupport/extendsHelper ../enums ../Utils ./WGLGeometryBrush ../../../../webgl/VertexArrayObject".split(" "),function(n,p,u,q,k,v,w){Object.defineProperty(p,"__esModule",{value:!0});n=function(l){function h(){var a=null!==l&&l.apply(this,arguments)||this;a._attributeLocations={a_pos:0,a_color:1,a_vertexOffset:2,a_texAndSize:3,a_refSymbolAndPlacementOffset:4,a_visible:5,a_visibilityRange:6};
a._vertexAttributeLayout={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:20,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:20,normalized:!0,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:8,stride:20,normalized:!1,divisor:0},{name:"a_texAndSize",count:4,type:5120,offset:12,stride:20,normalized:!1,divisor:0},{name:"a_refSymbolAndPlacementOffset",count:4,type:5120,offset:16,stride:20,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,
offset:0,stride:1,normalized:!0,divisor:0}],visibilityRange:[{name:"a_visibilityRange",count:2,type:5121,offset:0,stride:2,normalized:!1,divisor:0}]};a._glyphsTextureSize=new Float32Array(2);return a}u(h,l);h.prototype.dispose=function(){};h.prototype.drawGeometry=function(a,c,g,d){if(a.requiredLevel===c.key.level){d=a.context;var f=a.painter,b=a.drawPhase,e=g.materialInfo,x=g.indexCount;g=g.indexFrom;var m=this._attributeLocations,r=a.drawPhase===q.WGLDrawPhase.LABEL_ALPHA,t=e.materialKey;r&&(t|=
8);if(b=f.materialManager.getProgram(t,b,m))d.setStencilTestEnabled(!1),d.bindProgram(b),m=this._getVAO(d,c),d.bindVAO(m),r?(d.setBlendingEnabled(!1),b.setUniform1f("u_fadeStep",a.labelStep)):(e=e.texBindingInfo[0],f.textureManager.bindGlyphsPage(d,e.pageId,e.unit),b.setUniform1i(e.semantic,e.unit)),e=f.textureManager.glyphs,this._glyphsTextureSize[0]=e.width/4,this._glyphsTextureSize[1]=e.height/4,f=f.extrudeNoRotationMatrix,d.bindTexture(a.labelFBO.colorTexture,3),b.setUniform1i("u_referenceTex",
3),b.setUniformMatrix4fv("u_transformMatrix",c.tileTransform.transform),b.setUniformMatrix4fv("u_extrudeMatrix",f),b.setUniform2fv("u_normalized_origin",c.tileTransform.displayCoord),b.setUniform2fv("u_mosaicSize",this._glyphsTextureSize),b.setUniform1f("u_pixelRatio",a.pixelRatio),b.setUniform1f("u_opacity",1),b.setUniform1f("u_zoomLevel",10*a.displayLevel),b.setUniform1f("u_mapRotation",a.state.rotation),b.setUniform1f("u_mapAligned",0),b.setUniform2fv("u_screenSize",a.state.size),d.drawElements(4,
x,5125,4*g),d.bindVAO(null),d.setStencilTestEnabled(!0),d.setBlendingEnabled(!0)}};h.prototype.getGeometryType=function(){return q.WGLGeometryType.LABEL};h.prototype._getVAO=function(a,c){if((c=c.labelGeometry)&&c.vao)return c.vao;var g=c.vertexBufferMap[k.C_VBO_GEOMETRY],d=c.vertexBufferMap[k.C_VBO_VISIBILITY_RANGE],f=c.indexBuffer;if(!g||!f||!d)return null;c.vao=new w(a,this._attributeLocations,this._vertexAttributeLayout,{geometry:g,visibility:c.vertexBufferMap[k.C_VBO_VISIBILITY],visibilityRange:d},
f);return c.vao};return h}(v.default);p.default=n});