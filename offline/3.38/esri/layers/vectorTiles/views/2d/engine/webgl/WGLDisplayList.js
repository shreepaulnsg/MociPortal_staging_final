// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/views/2d/engine/webgl/WGLDisplayList","require exports ../../../../core/tsSupport/generatorHelper ../../../../core/Logger ./enums ./MaterialInfo ./Utils ./util/serializationUtils".split(" "),function(v,E,A,B,l,w,C,m){var D=B.getLogger("esri.views.2d.engine.webgl.WGLDisplayList");v=function(){function d(){this.symbolLevels=[]}Object.defineProperty(d.prototype,"empty",{get:function(){return!this.symbolLevels||0===this.symbolLevels.length},enumerable:!0,configurable:!0});
d.prototype.addToList=function(a){var c=this;Array.isArray(a)?a.forEach(function(b){c._addToList(b)}):this._addToList(a)};d.prototype.removeFromList=function(a){var c=this;Array.isArray(a)||(a=[a]);a.forEach(function(b){c._removeFromList(b)})};d.prototype.ofType=function(a){var c,b,e,h,f,g,k,r,q,t,x;return A(this,function(p){switch(p.label){case 0:c=0,b=this.symbolLevels,p.label=1;case 1:if(!(c<b.length))return[3,8];e=b[c];h=0;f=e.zLevels;p.label=2;case 2:if(!(h<f.length))return[3,7];g=f[h];k=g.geometryDPInfo;
r=this._getDPInfoType(a);if(!k[r])return[3,6];q=0;t=k[r];p.label=3;case 3:if(!(q<t.length))return[3,6];x=t[q];return[4,x];case 4:p.sent(),p.label=5;case 5:return q++,[3,3];case 6:return h++,[3,2];case 7:return c++,[3,1];case 8:return[2]}})};d.prototype._addToList=function(a){var c=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),b=0<c.length?c[c.length-1]:null;null!==b&&C.isSameMaterialInfo(b.materialInfo,a.materialInfo)&&b.indexFrom+b.indexCount===a.indexFrom?b.indexCount+=a.indexCount:
(b=new n,b.indexFrom=a.indexFrom,b.indexCount=a.indexCount,b.materialInfo=a.materialInfo,b.geometryType=a.geometryType,c.push(b))};d.prototype._removeFromList=function(a){for(var c=this._getDisplayList(a.symbolLevel,a.zOrder,a.geometryType),b=c.length,e=void 0,h=0;h<b;++h){var f=c[h];a.indexFrom+a.indexCount>f.indexFrom&&a.indexFrom<f.indexFrom+f.indexCount&&(e=h)}if(void 0!==e)if(f=c[e],a.indexFrom===f.indexFrom)f.indexCount-=a.indexCount,f.indexFrom+=a.indexCount;else if(a.indexFrom+a.indexCount===
f.indexFrom+f.indexCount)f.indexCount-=a.indexCount;else{b=f.indexFrom;h=a.indexFrom-f.indexFrom;var g=a.indexCount;a=f.indexFrom+f.indexCount-(a.indexFrom+a.indexCount);f.indexCount=h;var k=new n;k.geometryType=f.geometryType;k.materialInfo=new w.default;k.materialInfo.copy(f.materialInfo);k.indexFrom=b+h+g;k.indexCount=a;c.splice(e+1,0,k)}};d.prototype._getDisplayList=function(a,c,b){for(var e,h=this.symbolLevels.length,f=0;f<h;f++)if(this.symbolLevels[f].symbolLevel===a){e=this.symbolLevels[f];
break}e||(e=new y,e.symbolLevel=a,this.symbolLevels.push(e));a=e.zLevels.length;for(h=0;h<a;h++)if(e.zLevels[h].zLevel===c){var g=e.zLevels[h];break}g||(g=new z,g.geometryDPInfo=new u,g.zLevel=c,e.zLevels.push(g));switch(b){case l.WGLGeometryType.FILL:g.geometryDPInfo.fill||(g.geometryDPInfo.fill=[]);var k=g.geometryDPInfo.fill;break;case l.WGLGeometryType.LINE:g.geometryDPInfo.line||(g.geometryDPInfo.line=[]);k=g.geometryDPInfo.line;break;case l.WGLGeometryType.MARKER:g.geometryDPInfo.marker||(g.geometryDPInfo.marker=
[]);k=g.geometryDPInfo.marker;break;case l.WGLGeometryType.TEXT:g.geometryDPInfo.text||(g.geometryDPInfo.text=[]);k=g.geometryDPInfo.text;break;case l.WGLGeometryType.LABEL:g.geometryDPInfo.label||(g.geometryDPInfo.label=[]);k=g.geometryDPInfo.label;break;default:console.error("Trying to add a record with geometry type '"+b+"'.")}return k};d.prototype.serialize=function(a){m.serializeList(a,this.symbolLevels);return a};d.deserialize=function(a){var c=new d;c.symbolLevels=m.deserializeList(a,y);return c};
d.prototype._getDPInfoType=function(a){switch(a){case l.WGLGeometryType.FILL:return"fill";case l.WGLGeometryType.LINE:return"line";case l.WGLGeometryType.MARKER:return"marker";case l.WGLGeometryType.TEXT:return"text";case l.WGLGeometryType.LABEL:return"label";default:D.error("DisplayList: Tried to convert unknown geometryType: "+a)}};return d}();var n=function(){function d(){this.materialInfo=null;this.indexCount=this.indexFrom=0}d.prototype.serialize=function(a){this.materialInfo.serialize(a);a.writeInt32(this.indexFrom);
a.writeInt32(this.indexCount);return a};d.deserialize=function(a,c){var b=new d;b.geometryType=c.geometryType;b.materialInfo=w.default.deserialize(a);b.indexFrom=a.readInt32();b.indexCount=a.readInt32();return b};return d}(),u=function(){function d(){this.label=this.text=this.marker=this.line=this.fill=null}d.prototype.serialize=function(a){m.serializeList(a,this.fill);m.serializeList(a,this.line);m.serializeList(a,this.marker);m.serializeList(a,this.text);m.serializeList(a,this.label);return a};
d.deserialize=function(a){var c=new d,b={geometryType:l.WGLGeometryType.FILL},e=m.deserializeList(a,n,b);e.length&&(c.fill=e);b.geometryType=l.WGLGeometryType.LINE;e=m.deserializeList(a,n,b);e.length&&(c.line=e);b.geometryType=l.WGLGeometryType.MARKER;e=m.deserializeList(a,n,b);e.length&&(c.marker=e);b.geometryType=l.WGLGeometryType.TEXT;e=m.deserializeList(a,n,b);e.length&&(c.text=e);b.geometryType=l.WGLGeometryType.LABEL;a=m.deserializeList(a,n,b);a.length&&(c.label=a);return c};return d}(),z=function(){function d(){this.geometryDPInfo=
new u}d.prototype.serialize=function(a){a.writeInt32(this.zLevel);this.geometryDPInfo.serialize(a);return a};d.deserialize=function(a){var c=new d;c.zLevel=a.readInt32();c.geometryDPInfo=u.deserialize(a);return c};return d}(),y=function(){function d(){this.zLevels=[]}d.prototype.serialize=function(a){a.writeInt32(this.symbolLevel);m.serializeList(a,this.zLevels);return a};d.deserialize=function(a){var c=new d;c.symbolLevel=a.readInt32();c.zLevels=m.deserializeList(a,z);return c};return d}();return v});