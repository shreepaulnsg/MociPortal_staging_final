// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/views/2d/engine/webgl/mesh","require exports dojo/has ../../../../core/screenUtils ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix/mat2d ../../../../core/libs/gl-matrix/vec2 ../../../../core/libs/libtess/libtess ./color ./enums ./lineMeshUtil ./MeshData ./number ./TileClipper ./Utils ./visualVariablesUtils".split(" "),function(Aa,Pa,xb,R,yb,ea,S,r,T,Ba,zb,Qa,e,Ab,Ra,Bb){function Sa(f,b,c,p,L,w,x){p=c.slice(p,L);c=f.length/(x.length+1);w=yb(p,w,2);
L=w.length;if(0>=L)return 0;for(var m=0;m<p.length;)f.push(e.i1616to32(p[m++],p[m++])),f.push.apply(f,x);for(f=0;f<L;)b.push(w[f++]+c,w[f++]+c,w[f++]+c)}Object.defineProperty(Pa,"__esModule",{value:!0});var Cb=3.14159265359/180,k=S.create(),t=ea.create(),q=[],U=[],y,Db=function(){function f(){this._indexCounter=this._currentVertexIndex=0;this._triangleIndices=[-1,-1,-1];this.glu=new r.GluTesselator;this.glu.gluTessCallback(r.gluEnum.GLU_TESS_BEGIN,this._begincallback.bind(this));this.glu.gluTessCallback(r.gluEnum.GLU_TESS_VERTEX_DATA,
this._vertexCallback.bind(this));this.glu.gluTessCallback(r.gluEnum.GLU_TESS_END,this._endcallback.bind(this));this.glu.gluTessCallback(r.gluEnum.GLU_TESS_COMBINE,this._combinecallback.bind(this));this.glu.gluTessCallback(r.gluEnum.GLU_TESS_ERROR,this._errorcallback.bind(this));this.glu.gluTessCallback(r.gluEnum.GLU_TESS_EDGE_FLAG,this._edgeCallback.bind(this));this.glu.gluTessProperty(r.gluEnum.GLU_TESS_WINDING_RULE,r.windingRule.GLU_TESS_WINDING_ODD)}f.prototype.beginPolygon=function(b,c){this._triangleIndices[0]=
-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._indexCounter=this._currentVertexIndex=0;this.glu.gluTessBeginPolygon(b);this._indices=c};f.prototype.endPolygon=function(){this.glu.gluTessEndPolygon()};f.prototype.beginContour=function(){this.glu.gluTessBeginContour()};f.prototype.endContour=function(){this.glu.gluTessEndContour()};f.prototype.addVertex=function(b,c){this.glu.gluTessVertex(b,c)};f.prototype._vertexCallback=function(b,c){c[c.length]=b[0];c[c.length]=b[1];this._triangleIndices[this._currentVertexIndex]=
-1;if(2<=this._currentVertexIndex){for(b=0;3>b;b++)-1===this._triangleIndices[b]&&(this._triangleIndices[b]=this._indexCounter++),this._indices[this._indices.length]=this._triangleIndices[b];this._currentVertexIndex=0}else this._currentVertexIndex++};f.prototype._begincallback=function(b){this._triangleIndices[0]=-1;this._triangleIndices[1]=-1;this._triangleIndices[2]=-1;this._currentVertexIndex=0};f.prototype._endcallback=function(){this._currentVertexIndex=0};f.prototype._errorcallback=function(b){};
f.prototype._combinecallback=function(b,c,p){return[b[0],b[1],b[2]]};f.prototype._edgeCallback=function(b){};return f}();Aa=xb("esri-featurelayer-webgl");var Ta="libtess"===(Aa&&Aa.tesselator||"libtess"),z;Pa.createMesh=function(f,b,c,p,L,w,x,m,g,Ua){switch(L){case Ba.WGLGeometryType.MARKER:var Va=new Qa,V,fa,Wa=0,Xa=0,E,M=b.heatmapInfo;if(M){var Ya=Math.round(b.heatmapInfo.radius);var ha=V=0;var Ca=fa=Ya;var W=[1,1,1,1];var N=[0,0,0,0];var O=E=Ya;var Da=0}else{var ia=p.spriteMosaicItem;V=Math.round(ia.rect.x/
4);ha=Math.round(ia.rect.y/4);fa=V+Math.round(ia.rect.width/4);Ca=ha+Math.round(ia.rect.height/4);Wa=Math.round(x*R.pt2px(g.xoffset|0));Xa=Math.round(x*R.pt2px(g.yoffset|0));var Eb=g.color?g.color:[0,0,0,0];W=Ra.isPictureSymbol(g)?[255,255,255,255]:T.copyAndPremultiply(Eb);E=Math.round(x*R.pt2px(g.width||g.size));O=Math.round(x*R.pt2px(g.height||g.size));g.outline?(N=null!=g.outline.color?T.copyAndPremultiply(g.outline.color):[0,0,0,0],Da=null!=g.outline.width?Math.round(R.pt2px(g.outline.width)):
0):(N=[0,0,0,0],Da=0)}ea.identity(t);g.angle&&ea.rotate(t,t,Cb*g.angle);ea.translate(t,t,new Float32Array([-Wa,-Xa]));var a=[],ja=e.i8888to32(W[0],W[1],W[2],W[3]),ka=e.i8888to32(N[0],N[1],N[2],N[3]),la=e.i8888to32(E,O,Da,0),ma=e.numTo32(f),Za=0,$a=0,ab=0,bb=0,X=0,Y=c.vvColor||c.vvOpacity||c.vvRotation||c.vvSizeMinMaxValue||c.vvSizeScaleStops||c.vvSizeFieldStops||c.vvSizeUnitValue;if(Y){var A=b.vvFields,na=A.rotation?b.getValue(m,A.rotation):0,oa=A.opacity?b.getValue(m,A.opacity):0,pa=A.color?b.getValue(m,
A.color):0,P=A.size&&!c.vvSizeScaleStops?b.getValue(m,A.size):0;c.vvSizeUnitValue&&(P=Bb.getVisualVariableSizeValueRepresentationRatio(P,b.vvRanges.size.unitValue.valueRepresentation));if(null===P||isNaN(P))P=NaN;if(null===na||isNaN(na))na=NaN;if(null===pa||isNaN(pa))pa=NaN;if(null===oa||isNaN(oa))oa=NaN;Za=e.toUint32(P);$a=e.toUint32(oa);ab=e.toUint32(na);bb=e.toUint32(pa)}var qa=[Za,bb,$a,ab];M&&(X=e.toUint32(b.heatmapInfo.getIntensity(m)));var F=m.centroid||m.geometry;switch(w){case "esriGeometryPoint":var Q=
[[F.x,F.y]];break;case "esriGeometryMultipoint":Q=F.points;break;case "esriGeometryPolyline":Q=F.paths[0];break;case "esriGeometryPolygon":Q=m.centroid?[[F.x,F.y]]:F.rings[0]}for(var B=0,G,cb=0,db=0,H=Array(4*Q.length),ra=0;ra<Q.length;ra++){var eb=Q[ra],fb=eb[0],gb=eb[1],sa=e.i1616to32(fb+cb,gb+db);cb+=fb;db+=gb;k.set([-.5*E,-.5*O]);S.transformMat2d(k,k,t);a.push(sa);a.push(e.i8888to32(k[0],k[1],V,ha));a.push(ma);a.push(ja);a.push(ka);a.push(la);Y?a.push.apply(a,qa):M&&a.push(X);k.set([.5*E,-.5*
O]);S.transformMat2d(k,k,t);a.push(sa);a.push(e.i8888to32(k[0],k[1],fa,ha));a.push(ma);a.push(ja);a.push(ka);a.push(la);Y?a.push.apply(a,qa):M&&a.push(X);k.set([-.5*E,.5*O]);S.transformMat2d(k,k,t);a.push(sa);a.push(e.i8888to32(k[0],k[1],V,Ca));a.push(ma);a.push(ja);a.push(ka);a.push(la);Y?a.push.apply(a,qa):M&&a.push(X);k.set([.5*E,.5*O]);S.transformMat2d(k,k,t);a.push(sa);a.push(e.i8888to32(k[0],k[1],fa,Ca));a.push(ma);a.push(ja);a.push(ka);a.push(la);Y?a.push.apply(a,qa):M&&a.push(X);G=6*ra;H[G+
0]=B+0;H[G+1]=B+1;H[G+2]=B+2;H[G+3]=B+1;H[G+4]=B+3;H[G+5]=B+2;B+=4}Va.update({geometry:a},B,H);return Va;case Ba.WGLGeometryType.FILL:a:{var ta=null!=p?p.spriteMosaicItem:null,Ea=m.geometry,hb=Ra.isPictureSymbol(g);var Fb=hb?T.premultiplyAlphaUint32(T.white):g.color?T.premultiplyAlphaUint32(g.color):0;var Gb=c.vvColor||c.vvOpacity,ib=new Qa,Fa=0,Ga=0,Ha=0,Ia=0;if(ta){var jb=ta.rect,kb=jb.x,lb=jb.y,Hb=ta.width,Ib=ta.height;Fa=kb+1;Ga=lb+1;Ha=kb+1+Hb;Ia=lb+1+Ib}var Jb=hb&&g.width&&g.height?e.i8888to32(e.nextHighestPowerOfTwo(g.width),
e.nextHighestPowerOfTwo(g.height),0,0):e.i8888to32(e.nextHighestPowerOfTwo(Ha-Fa),e.nextHighestPowerOfTwo(Ia-Ga),0,0),Z=[e.numTo32(f),Fb,e.i1616to32(Fa,Ga),e.i1616to32(Ha,Ia),Jb];if(Gb){var ua=b.vvFields,va=ua.opacity?b.getValue(m,ua.opacity):0,wa=ua.color?b.getValue(m,ua.color):0;if(Ua||null===wa||isNaN(wa))wa=NaN;if(Ua||null===va||isNaN(va))va=NaN;Z.push(e.toUint32(wa),e.toUint32(va))}for(var C=!1,Ja=0,mb=Ea.rings;Ja<mb.length;Ja++){var d=mb[Ja],aa=d.length;if(!(3>aa)){var ba=d[0][0],ca=d[0][1];
if(-8>ba||520<ba||-8>ca||520<ca){C=!0;break}for(var h=1;h<aa;++h)if(ba+=d[h][0],ca+=d[h][1],-8>ba||520<ba||-8>ca||520<ca){C=!0;break}if(C)break}}if(C){y||(y=new Ab.TileClipper(0,0,0,1,8),y.setExtent(512));y.reset(3);for(var Ka=0,nb=Ea.rings;Ka<nb.length;Ka++)if(d=nb[Ka],aa=d.length,!(3>aa)){var n=d[0][0];var l=d[0][1];y.moveTo(n,l);for(h=1;h<aa;++h)n+=d[h][0],l+=d[h][1],y.lineTo(n,l);y.close()}var da={rings:y.result(!Ta)};if(!da.rings||0===da.rings.length){var ob=null;break a}}else da=Ea;var I=[],
xa=[],u;if(Ta){z||(z=new Db);z.beginPolygon(q,xa);for(var La=0,pb=da.rings;La<pb.length;La++)if(d=pb[La],!(3>d.length)){z.beginContour();var D=u=0;if(C)n=d[0].x,l=d[0].y;else{var qb=d[0];n=qb[0];l=qb[1]}var rb=[n,l,0];z.addVertex(rb,rb);for(h=1;h<d.length-1;h++){if(C)n=d[h].x,l=d[h].y;else{var sb=d[h];D=sb[0];u=sb[1];n+=D;l+=u}var tb=[n,l,0];z.addVertex(tb,tb)}z.endContour()}z.endPolygon();for(var ya=0;ya<q.length;ya+=2)I.push(e.i1616to32(q[ya],q[ya+1])),I.push.apply(I,Z)}else{for(var J=0,v=0,Ma=
void 0,Na=void 0,Oa=0,ub=da.rings;Oa<ub.length;Oa++){d=ub[Oa];var K=v;if(C)n=d[0].x,l=d[0].y;else{var vb=d[0];n=vb[0];l=vb[1]}q[v++]=n;q[v++]=l;var za=0;D=u=0;for(h=1;h<d.length;++h){if(C)Ma=d[h].x,Na=d[h].y,D=Ma-n,u=Na-l,za-=D*(l+l+u),n=Ma,l=Na;else{var wb=d[h];D=wb[0];u=wb[1];za-=D*(l+l+u);n+=D;l+=u}q[v++]=n;q[v++]=l}0<za?(0<K-J&&(Sa(I,xa,q,J,K,U,Z),J=K),U.length=0):0>za?0<K-J?U.push(.5*(K-J)):v=K:v=K}0<v-J&&Sa(I,xa,q,J,v,U,Z)}q.length=U.length=0;ib.update({geometry:I},I.length/(Z.length+1),xa);
ob=ib;break a}return ob;case Ba.WGLGeometryType.LINE:return zb.createLineMeshData(f,b,c,p,x,m,g)}return null}});