// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/views/2d/engine/webgl/mesh/templates/WGLMarkerTemplate","require exports ../../../../../../core/tsSupport/extendsHelper ../../../../../../core/Logger ../../../../../../core/screenUtils ../../../../../../core/libs/gl-matrix/mat2d ../../../../../../core/libs/gl-matrix/vec2 ../../color ../../definitions ../../enums ../../number ../../WGLDisplayRecord ./WGLMeshTemplate".split(" "),function(z,A,E,F,u,x,v,B,G,w,t,H,I){Object.defineProperty(A,"__esModule",{value:!0});var y=
F.getLogger("esri.views.2d.engine.webgl.WGLMeshTemplate");z=function(C){function n(c,a,b,m,g,l,k,h,e,p,q){if(255<k||255<h)y.error("mapview-oversized-resource","Marker size was clamped to the maximum allowed value of 200x200 pixels"),k>h?(h*=255/k,k=255):(k*=255/h,h=255);var f=C.call(this)||this;f.geometryType=w.WGLGeometryType.MARKER;var d=v.create(),r=x.create(),D=q.sdf?.5:1;x.translate(r,r,new Float32Array([D*b,D*-m]));g&&x.rotate(r,r,3.14159265359/180*g);f._materialStore=c;f.vvFlags=a;f._materialId=
c.createSpriteMaterial(q,f.geometryType,a);f._fillColor=l;f._outlineColor=e;f._sizeOutlineWidth=t.i8888to32(k,h,p,0);c=Math.round(q.rect.x/4);a=Math.round(q.rect.y/4);g=c+Math.round(q.rect.width/4);q=a+Math.round(q.rect.height/4);d.set([-.5*k,-.5*h]);v.transformMat2d(d,d,r);f._offsetUpperLeft=t.i1616to32(d[0],d[1]);f._texUpperLeft=t.i8888to32(c,a,0,0);d.set([.5*k,-.5*h]);v.transformMat2d(d,d,r);f._offsetUpperRight=t.i1616to32(d[0],d[1]);f._texUpperRight=t.i8888to32(g,a,0,0);d.set([-.5*k,.5*h]);v.transformMat2d(d,
d,r);f._offsetBottomLeft=t.i1616to32(d[0],d[1]);f._texBottomLeft=t.i8888to32(c,q,0,0);d.set([.5*k,.5*h]);v.transformMat2d(d,d,r);f._offsetBottomRight=t.i1616to32(d[0],d[1]);f._texBottomRight=t.i8888to32(g,q,0,0);f.height=h;f.width=k;f.xOffset=b;f.yOffset=m;return f}E(n,C);n.fromPictureMarker=function(c,a,b,m,g){g=Math.round(u.pt2px(b.width));var l=Math.round(u.pt2px(b.height)),k=G.PICTURE_FILL_COLOR,h=Math.round(u.pt2px(b.xoffset||0)),e=Math.round(u.pt2px(b.yoffset||0));return new n(c,a,h,e,b.angle,
k,g,l,0,0,m)};n.fromSimpleMarker=function(c,a,b,m,g){g=B.premultiplyAlphaRGBA(b.color);var l=Math.round(u.pt2px(b.size)),k=Math.round(u.pt2px(b.xoffset||0)),h=Math.round(u.pt2px(b.yoffset||0)),e=b.outline,p=(e&&e.color&&B.premultiplyAlphaRGBA(e.color))|0;e=(e&&e.width&&Math.round(u.pt2px(e.width)))|0;return new n(c,a,k,h,b.angle,g,l,l,p,e,m)};n.prototype.writeMesh=function(c,a,b,m,g,l,k){l=this._materialStore.get(this._materialId);var h=a.indexVector;a=a.get("geometry");var e=new H(m,this.geometryType,
this._materialId),p=this._getOffset(a,l);c.push(e);e.vertexFrom=p;e.indexFrom=h.length;switch(b){case "esriGeometryPoint":b=g.geometry;c=b.x;b=b.y;this._writeVertices(e,a,m,this._getPos(c,b),l,k);this._writeIndices(e,h,p);break;case "esriGeometryPolyline":this._writeMany(e,h,a,p,m,g.geometry.paths[0],l,k);break;case "esriGeometryPolygon":(b=g.centroid)?(c=b.x,b=b.y,this._writeVertices(e,a,m,this._getPos(c,b),l,k),this._writeIndices(e,h,p)):y.error("Tried to render polygon geometries as markers, but found no centroid!");
break;case "esriGeometryMultipoint":this._writeMany(e,h,a,p,m,g.geometry.points,l,k);break;default:y.error("Unable to handle geometryType: "+b)}};n.prototype._getPos=function(c,a){return t.i1616to32(c,a)};n.prototype._writeMany=function(c,a,b,m,g,l,k,h){for(var e=0,p=0,q=0,f=0;f<l.length;f++){var d=l[f],r=d[0];d=d[1];this._writeVertices(c,b,g,this._getPos(r+e,d+p),k,h);this._writeIndices(c,a,m+q);e+=r;p+=d;q+=4}};n.prototype._getOffset=function(c,a){a=a.materialKeyInfo.hasVV()?11:7;return c.length/
a};n.prototype._writeVertices=function(c,a,b,m,g,l){a.push(m);a.push(this._offsetUpperLeft);a.push(this._texUpperLeft);a.push(b);a.push(this._fillColor);a.push(this._outlineColor);a.push(this._sizeOutlineWidth);this._writeVV(a,l,g);a.push(m);a.push(this._offsetUpperRight);a.push(this._texUpperRight);a.push(b);a.push(this._fillColor);a.push(this._outlineColor);a.push(this._sizeOutlineWidth);this._writeVV(a,l,g);a.push(m);a.push(this._offsetBottomLeft);a.push(this._texBottomLeft);a.push(b);a.push(this._fillColor);
a.push(this._outlineColor);a.push(this._sizeOutlineWidth);this._writeVV(a,l,g);a.push(m);a.push(this._offsetBottomRight);a.push(this._texBottomRight);a.push(b);a.push(this._fillColor);a.push(this._outlineColor);a.push(this._sizeOutlineWidth);this._writeVV(a,l,g);c.vertexCount+=4};n.prototype._writeVV=function(c,a,b){b.materialKeyInfo.hasVV()&&(c.push(a[w.VVType.SIZE]),c.push(a[w.VVType.COLOR]),c.push(a[w.VVType.OPACITY]),c.push(a[w.VVType.ROTATION]))};n.prototype._writeIndices=function(c,a,b){a.push(b+
0);a.push(b+1);a.push(b+2);a.push(b+1);a.push(b+3);a.push(b+2);c.indexCount+=6};return n}(I.default);A.default=z});