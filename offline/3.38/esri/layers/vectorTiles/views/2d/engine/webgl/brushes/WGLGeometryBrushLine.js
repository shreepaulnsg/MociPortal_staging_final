// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/views/2d/engine/webgl/brushes/WGLGeometryBrushLine","require exports ../../../../../core/tsSupport/extendsHelper ../enums ../Utils ./WGLGeometryBrush ../../../../webgl/VertexArrayObject".split(" "),function(p,q,u,v,w,x,r){Object.defineProperty(q,"__esModule",{value:!0});p=function(m){function k(){var b=null!==m&&m.apply(this,arguments)||this;b._lineAttributeLocations={a_pos:0,a_id:1,a_color:2,a_offsetAndNormal:3,a_accumulatedDistanceAndHalfWidth:4,a_tlbr:5,a_segmentDirection:6};
b._lineAttributeLocationsVV={a_pos:0,a_id:1,a_color:2,a_offsetAndNormal:3,a_accumulatedDistanceAndHalfWidth:4,a_tlbr:5,a_segmentDirection:6,a_vv:7};b._lineVertexAttributeLayout={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:32,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:4,stride:32,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:32,normalized:!0,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:12,stride:32,normalized:!1,divisor:0},
{name:"a_accumulatedDistanceAndHalfWidth",count:2,type:5123,offset:16,stride:32,normalized:!1,divisor:0},{name:"a_tlbr",count:4,type:5123,offset:20,stride:32,normalized:!1,divisor:0},{name:"a_segmentDirection",count:4,type:5120,offset:28,stride:32,normalized:!1,divisor:0}]};b._lineVertexAttributeLayoutVV={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:44,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:4,stride:44,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,
offset:8,stride:44,normalized:!0,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:12,stride:44,normalized:!1,divisor:0},{name:"a_accumulatedDistanceAndHalfWidth",count:2,type:5123,offset:16,stride:44,normalized:!1,divisor:0},{name:"a_tlbr",count:4,type:5123,offset:20,stride:44,normalized:!1,divisor:0},{name:"a_segmentDirection",count:4,type:5120,offset:28,stride:44,normalized:!1,divisor:0},{name:"a_vv",count:3,type:5126,offset:32,stride:44,normalized:!1,divisor:0}]};b._spritesTextureSize=
new Float32Array(2);return b}u(k,m);k.prototype.dispose=function(){};k.prototype.getGeometryType=function(){return v.WGLGeometryType.LINE};k.prototype.drawGeometry=function(b,e,d,c){c=b.context;var h=b.painter,f=b.rendererInfo,y=b.requiredLevel,a=b.drawPhase,z=d.indexFrom,A=d.indexCount,g=d.materialInfo;d=g.materialKeyInfo;var l=d.hasVV()?this._lineAttributeLocationsVV:this._lineAttributeLocations;if(a=h.materialManager.getProgram(g.materialKey,a,l)){c.bindProgram(a);l=this._getVAO(c,e,d.hasVV());
c.bindVAO(l);l=1/b.pixelRatio;if(0<g.texBindingInfo.length){g=g.texBindingInfo[0];var n=g.pageId,t=h.textureManager.sprites;this._spritesTextureSize[0]=t.getWidth(n);this._spritesTextureSize[1]=t.getHeight(n);h.textureManager.bindSpritePage(c,n,g.unit);a.setUniform1i(g.semantic,g.unit);a.setUniform2fv("u_mosaicSize",this._spritesTextureSize)}b=Math.pow(2,y-e.key.level)/b.pixelRatio;a.setUniform1f("u_zoomFactor",b);a.setUniformMatrix4fv("u_transformMatrix",e.tileTransform.transform);a.setUniformMatrix4fv("u_extrudeMatrix",
h.extrudeMatrix);a.setUniform2fv("u_normalized_origin",e.tileTransform.displayCoord);a.setUniform1f("u_opacity",1);a.setUniform1f("u_blur",0+l);a.setUniform1f("u_antialiasing",l);a.setUniform1f("u_zoomFactor",b);d.vvSizeMinMaxValue&&a.setUniform4fv("u_vvSizeMinMaxValue",f.vvSizeMinMaxValue);d.vvSizeScaleStops&&a.setUniform1f("u_vvSizeScaleStopsValue",f.vvSizeScaleStopsValue);d.vvSizeFieldStops&&(a.setUniform1fv("u_vvSizeFieldStopsValues",f.vvSizeFieldStopsValues),a.setUniform1fv("u_vvSizeFieldStopsSizes",
f.vvSizeFieldStopsSizes));d.vvSizeUnitValue&&a.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",f.vvSizeUnitValueToPixelsRatio);d.vvColor&&(a.setUniform1fv("u_vvColorValues",f.vvColorValues),a.setUniform4fv("u_vvColors",f.vvColors));d.vvOpacity&&(a.setUniform1fv("u_vvOpacityValues",f.vvOpacityValues),a.setUniform1fv("u_vvOpacities",f.vvOpacities));c.setFaceCullingEnabled(!0);c.setFrontFace(2305);c.setCullFace(1029);c.drawElements(4,A,5125,4*z);c.setFaceCullingEnabled(!1);c.bindVAO(null)}};k.prototype._getVAO=
function(b,e,d){if(e.lineGeometry.vao)return e.lineGeometry.vao;var c=e.lineGeometry.vertexBufferMap[w.C_VBO_GEOMETRY],h=e.lineGeometry.indexBuffer;if(!c||!h)return null;e.lineGeometry.vao=d?new r(b,this._lineAttributeLocationsVV,this._lineVertexAttributeLayoutVV,{geometry:c},h):new r(b,this._lineAttributeLocations,this._lineVertexAttributeLayout,{geometry:c},h);return e.lineGeometry.vao};return k}(x.default);q.default=p});