// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/views/3d/webgl-engine/lib/Util",["require","exports","../../support/geometryUtils","./gl-matrix"],function(ha,f,w,g){function F(a,b){if(!a)throw a=Error("dummy"),a.stack&&console.log(a.stack),new N(b);}function r(a,b,c){return a<b?b:a>c?c:a}function G(a){return a/180*Math.PI}function H(a){return 180*a/Math.PI}function O(a,b,c){g.mat4d.multiply(b,a,I);g.mat4d.inverse(I);for(a=0;8>a;++a)g.mat4d.multiplyVec4(I,Y[a],m),g.vec3d.set3(m[0]/m[3],m[1]/m[3],m[2]/m[3],c[a])}function P(a,
b){w.plane.fromPoints(a[4],a[0],a[3],b[0]);w.plane.fromPoints(a[1],a[5],a[6],b[1]);w.plane.fromPoints(a[4],a[5],a[1],b[2]);w.plane.fromPoints(a[3],a[2],a[6],b[3]);w.plane.fromPoints(a[0],a[1],a[2],b[4]);w.plane.fromPoints(a[5],a[4],a[7],b[5])}function Q(a,b,c,d){var e=6378137/Math.sqrt(1-f.ECCENTRICITY_SQUARED*Math.pow(Math.sin(a),2)),h=Math.cos(a);d[0]=(e+c)*Math.cos(b)*h;d[1]=(e*(1-f.ECCENTRICITY_SQUARED)+c)*Math.sin(a);d[2]=-(e+c)*Math.sin(b)*h}function R(a){for(var b in a)return b}function S(a,
b){a[12]=b[0];a[13]=b[1];a[14]=b[2]}function T(a,b){void 0===b&&(b=0);for(var c=0,d=0;4>d;d++)c+=a[b+d]*Z[d];return c}function aa(a){return a-Math.floor(a)}Object.defineProperty(f,"__esModule",{value:!0});var I=g.mat4d.create(),Y=[g.vec4d.createFrom(-1,-1,-1,1),g.vec4d.createFrom(1,-1,-1,1),g.vec4d.createFrom(1,1,-1,1),g.vec4d.createFrom(-1,1,-1,1),g.vec4d.createFrom(-1,-1,1,1),g.vec4d.createFrom(1,-1,1,1),g.vec4d.createFrom(1,1,1,1),g.vec4d.createFrom(-1,1,1,1)],m=g.vec4d.create(),ba=[g.vec3d.create(),
g.vec3d.create(),g.vec3d.create(),g.vec3d.create(),g.vec3d.create(),g.vec3d.create(),g.vec3d.create(),g.vec3d.create()],ca=g.vec3d.create(),U=g.vec3d.create(),v=g.vec3d.create(),n=g.vec3d.create(),p=g.vec3d.create(),z=g.vec3d.create(),A=g.vec3d.create(),J=g.vec3d.create(),K=g.vec3d.create(),x=g.vec3d.create(),u=g.vec3d.create(),y=g.vec3d.create(),B=g.vec3d.create(),da=g.vec3d.createFrom(0,0,0),N=function(){function a(b){this.message=b}a.prototype.toString=function(){return"AssertException: "+this.message};
return a}();f.AssertException=N;f.EARTH_RADIUS=6378137;f.METER2FEET=3.28084;f.ECCENTRICITY_SQUARED=.0066943799901414;f.VertexAttrConstants={POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex"};f.assert=F;f.verify=function(a,b){a||(console.log("Verify failed: "+b),console.log(Error("dummy").stack))};f.isPowerOfTwo=function(a){return 0===
(a&a-1)};f.lerp=function(a,b,c){return a+(b-a)*c};f.clamp=r;f.encodeInt16=function(a){return r(Math.round(32767*a),-32767,32767)};f.encodeNormal=function(a,b){var c=Math.abs(a[0]),d=Math.abs(a[1]),e=1/(c+d+Math.abs(a[2]));c*=e;d*=e;e=Math.min(a[2]*e,0);b[0]=V(a[0])*(c-e);b[1]=V(a[1])*(d-e)};var V="function"===typeof Math.sign?Math.sign:function(a){return+(0<a)-+(0>a)||0};f.fallbackIfUndefined=function(a,b){return void 0===a?b:a};f.hex2rgb=function(a){a=Math.floor(a);return[(a>>16&255)/255,(a>>8&255)/
255,(a&255)/255]};f.rgb2hex=function(a){var b=r(Math.round(255*a[0]),0,255),c=r(Math.round(255*a[1]),0,255);a=r(Math.round(255*a[2]),0,255);return"0x"+((b<<16)+(c<<8)+a).toString(16)};f.dec2hex=function(a){a=a.toString(16);return"00000000".substr(0,8-a.length)+a};f.deg2rad=G;f.rad2deg=H;f.azimuthElevationAngle2Direction=function(a,b){a=1.5*Math.PI-a;b=.5*Math.PI-b;return[Math.cos(a)*Math.sin(b),Math.cos(b),Math.sin(a)*Math.sin(b)]};f.raySphere=function(a,b,c,d,e){c=c||da;var h=g.vec3d.subtract(a,
c,ca);c=g.vec3d.dot(b,b);var k=2*g.vec3d.dot(b,h);d=g.vec3d.dot(h,h)-d*d;d=k*k-4*c*d;if(0>d)return!1;h=Math.sqrt(d);d=(-k-h)/(2*c);c=(-k+h)/(2*c);if(0>d||c<d&&0<c)d=c;return 0<d?(e&&g.vec3d.add(a,g.vec3d.scale(b,d,B),e),!0):!1};f.rayTriangle3D=function(a,b,c,d,e,h,k,l,q){void 0===q&&(q=g.vec3d.create());var t=d[k]-c[h],C=d[k+1]-c[h+1],D=d[k+2]-c[h+2];d=e[l]-c[h];k=e[l+1]-c[h+1];e=e[l+2]-c[h+2];var E=b[1]*e-k*b[2],W=b[2]*d-e*b[0],X=b[0]*k-d*b[1];l=t*E+C*W+D*X;if(-1E-5<l&&1E-5>l)return!1;l=1/l;var L=
a[0]-c[h],M=a[1]-c[h+1];a=a[2]-c[h+2];q[1]=l*(L*E+M*W+a*X);if(0>q[1]||1<q[1])return!1;c=M*D-C*a;a=a*t-D*L;t=L*C-t*M;q[2]=l*(b[0]*c+b[1]*a+b[2]*t);if(0>q[2]||1<q[1]+q[2])return!1;q[0]=l*(d*c+k*a+e*t);return!0};f.rayBoxTest=function(a,b,c,d){var e=(c[0]-a[0])/b[0],h=(d[0]-a[0])/b[0];if(e>h){var k=e;e=h;h=k}var l=(c[1]-a[1])/b[1],q=(d[1]-a[1])/b[1];l>q&&(k=l,l=q,q=k);if(e>q||l>h)return!1;l>e&&(e=l);q<h&&(h=q);c=(c[2]-a[2])/b[2];a=(d[2]-a[2])/b[2];c>a&&(k=c,c=a,a=k);if(e>a||c>h)return!1;a<h&&(h=a);return 0>
h?!1:!0};f.rayRay2D=function(a,b,c,d,e,h){void 0===h&&(h=g.vec2d.create());var k=(d[e]-c[e])*(b[0]-a[0])-(d[0]-c[0])*(b[e]-a[e]);if(0===k)return!1;c=((d[0]-c[0])*(a[e]-c[e])-(d[e]-c[e])*(a[0]-c[0]))/k;h[0]=a[0]+c*(b[0]-a[0]);h[1]=a[e]+c*(b[e]-a[e]);return!0};f.matrixToFrustumPoints=O;f.matrixToFrustumPlanes=function(a,b,c,d){void 0===d&&(d=c,c=ba);O(a,b,c);P(c,d)};f.frustumPointsToPlanes=P;f.project=function(a,b,c,d,e){e||(e=a);m[0]=a[0];m[1]=a[1];m[2]=a[2];m[3]=1;g.mat4d.multiplyVec4(b,m);2<e.length&&
(e[2]=-m[2]);g.mat4d.multiplyVec4(c,m);F(0!==m[3]);e[0]=m[0]/m[3];e[1]=m[1]/m[3];e[2]=m[2]/m[3];e[0]=(.5*e[0]+.5)*d[2]+d[0];e[1]=(.5*e[1]+.5)*d[3]+d[1]};f.geodeticToGeocentricLatidude=function(a){return Math.atan((1-f.ECCENTRICITY_SQUARED)*Math.tan(a))};f.latLon2positionWGS84Ellipsoid=Q;f.pos2latLon=function(a,b){var c=g.vec3d.length(a);b[0]=Math.asin(r(a[1]/c,-1,1));b[1]=(0>a[2]?1:-1)*Math.acos(r(a[0]/(Math.cos(b[0])*c),-1,1));b[0]=H(b[0]);b[1]=H(b[1]);b[2]=c};f.pos2latLonWGS84Ellipsoid=function(a,
b){var c=a[0],d=-a[2],e=a[1],h=Math.sqrt(Math.pow(6378137,2)*(1-f.ECCENTRICITY_SQUARED));a=Math.sqrt(Math.pow(c,2)+Math.pow(d,2));var k=Math.atan2(6378137*e,h*a);c=Math.atan2(d,c);d=Math.atan2(e+Math.pow(Math.sqrt((Math.pow(6378137,2)-Math.pow(h,2))/Math.pow(h,2)),2)*h*Math.pow(Math.sin(k),3),a-6378137*f.ECCENTRICITY_SQUARED*Math.pow(Math.cos(k),3));a=a/Math.cos(d)-6378137/Math.sqrt(1-f.ECCENTRICITY_SQUARED*Math.pow(Math.sin(d),2))+f.EARTH_RADIUS;b[0]=d;b[1]=c;b[2]=a};f.computeGlobeTransformation=
function(a,b,c){var d=G(a[0]);a=G(a[1]);Q(d,a,b,U);g.mat4d.translate(c,U);g.mat4d.rotateY(c,.5*Math.PI+a);g.mat4d.rotateX(c,.5*Math.PI-d);return c};f.readUInt16=function(a,b){return a[b]+(a[b+1]<<8)};f.readUInt32=function(a,b){return a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24)};f.setIfDefined=function(a,b,c){void 0!==b[a]&&(c[a]=b[a])};f.array2object=function(a,b){var c={};if(void 0!==b)for(var d=0;d<a.length;d++){var e=a[d];c[b(e)]=e}else for(b=0;b<a.length;b++)e=a[b],c[e]=e;return c};f.object2array=
function(a){var b=[],c;for(c in a)b.push(a[c]);return b};f.mergeObjects=function(a,b,c){void 0===c&&(c={});if(c!==a)for(var d in a)c[d]=a[d];if(c!==b)for(var e in b)c[e]=b[e];return c};f.subtractObjects=function(a,b){var c={},d;for(d in a)void 0===b[d]&&(c[d]=a[d]);return c};f.intersectObjects=function(a,b){var c={},d;for(d in a)void 0!==b[d]&&(c[d]=a[d]);return c};f.getFirstObjectKey=R;f.getFirstObjectValue=function(a){return a[R(a)]};f.objectEmpty=function(a){for(var b in a)return!1;return!0};f.byteBuffer2base64image=
function(a,b,c,d,e){var h=4*b;F(a.length===h*c,"buffer length must match image resolution");var k=document.createElement("canvas");k.width=b;k.height=c;var l=k.getContext("2d");b=l.getImageData(0,0,b,c);for(var q=b.data,t=0;t<c;++t)for(var C=t*h,D=(c-1-t)*h,E=0;E<h;++E)q[C++]=a[D++];l.putImageData(b,0,0);return k.toDataURL(d,e)};f.cround=function(a){return Math.round(100*a)/100};f.logWithBase=function(a,b){return Math.log(a)/Math.log(b)};f.setMatrixTranslation=S;f.setMatrixTranslation3=function(a,
b,c,d){a[12]=b;a[13]=c;a[14]=d};f.getMatrixTranslation=function(a,b){void 0===b&&(b=g.vec3d.create());b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};f.createTranslationMatrix=function(a,b){a=g.mat4d.identity(a);S(a,b);return a};f.isTranslationMatrix=function(a){return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&1===a[15]};f.fovx2fovy=function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/b)};f.fovy2fovx=function(a,b,c){return 2*
Math.atan(b*Math.tan(.5*a)/c)};f.fovx2fovd=function(a,b,c){return 2*Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*a)/b)};f.fovy2fovd=function(a,b,c){return 2*Math.atan(Math.sqrt(b*b+c*c)*Math.tan(.5*a)/c)};f.fovd2fovx=function(a,b,c){return 2*Math.atan(b*Math.tan(.5*a)/Math.sqrt(b*b+c*c))};f.fovd2fovy=function(a,b,c){return 2*Math.atan(c*Math.tan(.5*a)/Math.sqrt(b*b+c*c))};f.nextHighestPowerOfTwo=function(a){--a;for(var b=1;32>b;b<<=1)a|=a>>b;return a+1};f.nextHighestPowerOfTen=function(a){return Math.pow(10,
Math.ceil(Math.LOG10E*Math.log(a)))};f.lineLineDistanceSquared3D=function(a,b,c,d,e){v[0]=a[0]-c[0];v[1]=a[1]-c[1];v[2]=a[2]-c[2];n[0]=d[0]-c[0];n[1]=d[1]-c[1];n[2]=d[2]-c[2];if(1E-4>Math.abs(n[0])&&1E-4>Math.abs(n[1])&&1E-4>Math.abs(n[2]))return e.success=!1,e;p[0]=b[0]-a[0];p[1]=b[1]-a[1];p[2]=b[2]-a[2];if(1E-4>Math.abs(p[0])&&1E-4>Math.abs(p[1])&&1E-4>Math.abs(p[2]))return e.success=!1,e;b=v[0]*n[0]+v[1]*n[1]+v[2]*n[2];d=n[0]*p[0]+n[1]*p[1]+n[2]*p[2];var h=v[0]*p[0]+v[1]*p[1]+v[2]*p[2],k=n[0]*
n[0]+n[1]*n[1]+n[2]*n[2],l=(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])*k-d*d;if(1E-4>Math.abs(l))return e.success=!1,e;h=r((b*d-h*k)/l,0,1);b=r((b+d*h)/k,0,1);z[0]=a[0]+h*p[0];z[1]=a[1]+h*p[1];z[2]=a[2]+h*p[2];A[0]=c[0]+b*n[0];A[1]=c[1]+b*n[1];A[2]=c[2]+b*n[2];a=g.vec3d.dist2(z,A);e.success=!0;e.dist2=a;e.pa=z;e.pb=A;return e};f.pointLineSegmentDistanceSquared2D=function(a,b,c){u[0]=b[0]-a[0];u[1]=b[1]-a[1];u[2]=0;y[0]=c[0]-a[0];y[1]=c[1]-a[1];y[2]=0;B[0]=c[0];B[1]=c[1];B[2]=0;b=g.vec2d.dot(y,u);c=g.vec2d.dot(u,
u);b=r(b/c,0,1);x[0]=u[0]*b;x[1]=u[1]*b;J[0]=a[0]+x[0];J[1]=a[1]+x[1];g.vec2d.subtract(B,J,K);a=g.vec2d.dot(K,K);b=g.vec2d.dot(y,y);c=g.vec2d.dot(u,u);var d=g.vec2d.dot(x,x);if(d>b||d>c)a=Number.MAX_VALUE;return a};f.packFloatRGBA=function(a,b,c){void 0===c&&(c=0);a=r(a,0,ea);for(var d=0;4>d;d++)b[c+d]=Math.floor(256*aa(a*fa[d]))};f.unpackFloatRGBA=T;var fa=[1,256,65536,16777216],Z=[1/256,1/65536,1/16777216,1/4294967296],ea=T(new Uint8ClampedArray([255,255,255,255]));f.inverseProjectionInfo=function(a,
b,c,d,e){0===a[11]?(d[0]=2/(b*a[0]),d[1]=2/(c*a[5]),d[2]=(1+a[12])/a[0],d[3]=(1+a[13])/a[5],g.vec2d.set2(0,1,e)):(d[0]=-2/(b*a[0]),d[1]=-2/(c*a[5]),d[2]=(1-a[8])/a[0],d[3]=(1-a[9])/a[5],g.vec2d.set2(1,0,e))}});