// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/tasks/operations/pbfQueryUtils","require exports ../../core/Error ../../core/Logger ../../core/pbf ../../layers/graphics/optimizedFeatures".split(" "),function(X,F,G,N,O,B){function H(b){if(b>=I.length){var e=new G("query:parsing-pbf","Error while parsing FeatureSet PBF payload. Unknown GeometryType");J.error(e)}return I[b]}function P(b){var e,a=e||(e={});a[a.STRING=1]="STRING";a[a.FLOAT=2]="FLOAT";a[a.DOUBLE=3]="DOUBLE";a[a.SINT32=4]="SINT32";a[a.UINT32=5]="UINT32";
a[a.INT64=6]="INT64";a[a.UINT64=7]="UINT64";a[a.SINT64=8]="SINT64";for(a[a.BOOL=9]="BOOL";b.next();)switch(b.tag()){case e.STRING:return b.getString();case e.FLOAT:return b.getFloat();case e.DOUBLE:return b.getDouble();case e.SINT32:return b.getSInt32();case e.UINT32:return b.getUInt32();case e.INT64:return b.getInt64();case e.UINT64:return b.getUInt64();case e.SINT64:return b.getSInt64();case e.BOOL:return b.getBool();default:return b.skip(),null}return null}function Q(b){var e,a=e||(e={});a[a.NAME=
1]="NAME";a[a.TYPE=2]="TYPE";a[a.ALIAS=3]="ALIAS";a[a.SQL_TYPE=4]="SQL_TYPE";a[a.DOMAIN=5]="DOMAIN";a[a.DEFAULT_VALUE=6]="DEFAULT_VALUE";for(a={type:K[0]};b.next();)switch(b.tag()){case e.NAME:a.name=b.getString();break;case e.TYPE:a.type=K[b.getEnum()];break;case e.ALIAS:a.alias=b.getString();break;case e.SQL_TYPE:a.sqlType=R[b.getEnum()];break;case e.DOMAIN:b.skip();break;case e.DEFAULT_VALUE:b.skip();break;default:b.skip()}return a}function S(b,e){var a,k=a||(a={});k[k.ATTRIBUTES=1]="ATTRIBUTES";
k[k.GEOMETRY=2]="GEOMETRY";k[k.CENTROID=4]="CENTROID";k=new B.OptimizedFeature;for(var E=0;b.next();)switch(b.tag()){case a.ATTRIBUTES:var l=b.getMessage(),g=e[E++].name;k.attributes[g]=P(l);break;case a.GEOMETRY:l=void 0;g=b.getMessage();var c=l||(l={});c[c.TYPE=1]="TYPE";c[c.LENGTHS=2]="LENGTHS";c[c.COORDS=3]="COORDS";c=new B.OptimizedGeometry;for(var h=c.coords,d=c.lengths;g.next();)switch(g.tag()){case l.LENGTHS:var f=g.getUInt32();for(f=g.pos()+f;g.pos()<f;)d.push(g.getUInt32());break;case l.COORDS:f=
g.getUInt32();f=g.pos()+f;for(var m=0;g.pos()<f;)h[m++]=g.getSInt64();break;default:g.skip()}k.geometry=c;break;case a.CENTROID:l=void 0;g=b.getMessage();c=l||(l={});c[c.TYPE=1]="TYPE";c[c.LENGTHS=2]="LENGTHS";c[c.COORDS=3]="COORDS";c=new B.OptimizedGeometry;for(h=c.coords;g.next();)switch(g.tag()){case l.COORDS:d=g.getUInt32();d=g.pos()+d;for(f=0;g.pos()<d;)h[f++]=g.getSInt64();break;default:g.skip()}k.centroid=c;break;default:b.skip()}return k}Object.defineProperty(F,"__esModule",{value:!0});var J=
N.getLogger("esri.tasks.operations.pbfQueryUtils"),K="esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeString esriFieldTypeDate esriFieldTypeOID esriFieldTypeGeometry esriFieldTypeBlob esriFieldTypeRaster esriFieldTypeGUID esriFieldTypeGlobalID esriFieldTypeXML".split(" "),R="sqlTypeBigInt sqlTypeBinary sqlTypeBit sqlTypeChar sqlTypeDate sqlTypeDecimal sqlTypeDouble sqlTypeFloat sqlTypeGeometry sqlTypeGUID sqlTypeInteger sqlTypeLongNVarchar sqlTypeLongVarbinary sqlTypeLongVarchar sqlTypeNChar sqlTypeNVarchar sqlTypeOther sqlTypeReal sqlTypeSmallInt sqlTypeSqlXml sqlTypeTime sqlTypeTimestamp sqlTypeTimestamp2 sqlTypeTinyInt sqlTypeVarbinary sqlTypeVarchar".split(" "),
I=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],L=["upperLeft","lowerLeft"];F.parsePBFFeatureQuery=function(b){try{var e,a=e||(e={});a[a.QUERY_RESULT=2]="QUERY_RESULT";for(var k=new O(new Uint8Array(b),new DataView(b)),E;k.next();)switch(k.tag()){case e.QUERY_RESULT:b=void 0;var l=k.getMessage(),g=b||(b={});g[g.FEATURE_RESULT=1]="FEATURE_RESULT";for(a={};l.next();)switch(l.tag()){case b.FEATURE_RESULT:var c=void 0,h=l.getMessage(),d=c||(c={});d[d.OBJECT_ID_NAME=
1]="OBJECT_ID_NAME";d[d.UNIQUE_ID_NAME=2]="UNIQUE_ID_NAME";d[d.GLOBAL_ID_NAME=3]="GLOBAL_ID_NAME";d[d.GEOHASH_NAME=4]="GEOHASH_NAME";d[d.GEOMETRY_PROPERTIES=5]="GEOMETRY_PROPERTIES";d[d.SERVER_GENS=6]="SERVER_GENS";d[d.GEOMETRY_TYPE=7]="GEOMETRY_TYPE";d[d.SPATIAL_REFERENCE=8]="SPATIAL_REFERENCE";d[d.EXCEEDED_TRANSFER_LIMIT=9]="EXCEEDED_TRANSFER_LIMIT";d[d.HAS_Z=10]="HAS_Z";d[d.HAS_M=11]="HAS_M";d[d.TRANSFORM=12]="TRANSFORM";d[d.FIELDS=13]="FIELDS";d[d.FEATURES=15]="FEATURES";var f=new B.OptimizedFeatureSet;
for(f.geometryType=H(0);h.next();)switch(h.tag()){case c.OBJECT_ID_NAME:f.objectIdFieldName=h.getString();break;case c.GLOBAL_ID_NAME:f.globalIdFieldName=h.getString();break;case c.GEOHASH_NAME:f.geohashFieldName=h.getString();break;case c.GEOMETRY_PROPERTIES:var m=void 0,x=h.getMessage(),y=m||(m={});y[y.AREA_FIELD_NAME=1]="AREA_FIELD_NAME";y[y.LENGTH_FIELD_NAME=2]="LENGTH_FIELD_NAME";y[y.UNITS=3]="UNITS";for(var p={};x.next();)switch(x.tag()){case m.AREA_FIELD_NAME:p.shapeAreaFieldName=x.getString();
break;case m.LENGTH_FIELD_NAME:p.shapeLengthFieldName=x.getString();break;case m.UNITS:p.units=x.getString();break;default:x.skip()}f.geometryProperties=p;break;case c.GEOMETRY_TYPE:f.geometryType=H(h.getEnum());break;case c.SPATIAL_REFERENCE:m=void 0;var C=h.getMessage(),r=m||(m={});r[r.WKID=1]="WKID";r[r.LASTEST_WKID=2]="LASTEST_WKID";r[r.VCS_WKID=3]="VCS_WKID";r[r.LATEST_VCS_WKID=4]="LATEST_VCS_WKID";r[r.WKT=5]="WKT";for(p={};C.next();)switch(C.tag()){case m.WKID:p.wkid=C.getUInt32();break;case m.WKT:p.wkt=
C.getString();break;default:C.skip()}f.spatialReference=p;break;case c.HAS_Z:f.hasZ=h.getBool();break;case c.HAS_M:f.hasM=h.getBool();break;case c.TRANSFORM:var D=p=m=void 0,z=h.getMessage(),A=D||(D={});A[A.ORIGIN_POSTION=1]="ORIGIN_POSTION";A[A.SCALE=2]="SCALE";A[A.TRANSLATE=3]="TRANSLATE";for(var M=L[0];z.next();)switch(z.tag()){case D.ORIGIN_POSTION:M=L[z.getEnum()];break;case D.SCALE:var n=void 0,v=z.getMessage(),t=n||(n={});t[t.X=1]="X";t[t.Y=2]="Y";t[t.M=3]="M";t[t.Z=4]="Z";for(var q=[0,0];v.next();)switch(v.tag()){case n.X:q[0]=
v.getDouble();break;case n.Y:q[1]=v.getDouble();break;case n.M:q.push(v.getDouble());break;case n.Z:q.push(v.getDouble());break;default:v.skip()}p=q;break;case D.TRANSLATE:n=void 0;var w=z.getMessage(),u=n||(n={});u[u.X=1]="X";u[u.Y=2]="Y";u[u.M=3]="M";u[u.Z=4]="Z";for(q=[0,0];w.next();)switch(w.tag()){case n.X:q[0]=w.getDouble();break;case n.Y:q[1]=w.getDouble();break;case n.M:q.push(w.getDouble());break;case n.Z:q.push(w.getDouble());break;default:w.skip()}m=q;break;default:z.skip()}f.transform=
{originPosition:M,scale:p,translate:m};break;case c.EXCEEDED_TRANSFER_LIMIT:var T=h.getBool();f.exceededTransferLimit=T;break;case c.FIELDS:var U=h.getMessage();f.fields.push(Q(U));break;case c.FEATURES:var V=h.getMessage();f.features.push(S(V,f.fields));break;default:h.skip()}a.featureResult=f;break;default:l.skip()}E=a;break;default:k.skip()}return E.featureResult}catch(W){return e=new G("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:W}),J.error(e),new B.OptimizedFeatureSet}}});