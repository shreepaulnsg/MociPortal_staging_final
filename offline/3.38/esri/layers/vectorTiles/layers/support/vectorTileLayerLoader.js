// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/layers/support/vectorTileLayerLoader","require exports ../../core/tsSupport/assignHelper ../../config ../../request ../../core/promiseUtils ../../core/urlUtils".split(" "),function(B,x,C,w,A,r,e){function n(a){a&&(a=e.getOrigin(a),e.canUseXhr(a)||-1!==y.indexOf(a)||y.push(a))}function p(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];c=void 0;for(var d=0;d<a.length;++d)e.isProtocolRelative(a[d])?c&&(c=c.split("://")[0]+":"+a[d].trim()):c=e.isAbsolute(a[d])?
a[d]:e.join(c,a[d]);return c}function t(a,c,d){var g;if("string"===typeof c){c=e.normalize(c);n(c);var q=e.urlToObject(c);q=A(q.path,{query:{f:"json"},responseType:"json"});var f=g=c}else q=r.resolve({data:c}),g=c.jsonUrl||null,f=d;return q.then(function(h){var b=h.data;h.ssl&&(g&&(g=g.replace(/^http:/i,"https:")),f&&(f=f.replace(/^http:/i,"https:")));if(b.sources){a.styleUrl=g||null;h=f?e.removeFile(f):e.appBaseUrl;a.styleBase=h;a.style=b;a.styleUrl&&n(a.styleUrl);if(a.source)b=r.resolve();else{b:if(b=
b.sources,b.esri)b=b.esri;else{for(var k=0,l=Object.keys(b);k<l.length;k++){var m=l[k];if("vector"===b[m].type){b=b[m];break b}}b=null}b=b.url?t(a,p(h,b.url)):t(a,b,h)}return b}if(b.sources)return r.reject("You must specify the URL or the JSON for a service or for a style.");a.sourceUrl=g||null;h=f?e.removeTrailingSlash(f)+"/":e.appBaseUrl;a.sourceBase=h;a.source=b;if(b.hasOwnProperty("tileInfo"))k=b;else{k={xmin:-2.0037507067161843E7,ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,ymax:2.0037507067161843E7,
spatialReference:{wkid:102100}};m=(k.xmax-k.xmin)/512;l=[];for(var u=b.hasOwnProperty("minzoom")?parseFloat(b.minzoom):0,v=b.hasOwnProperty("maxzoom")?parseFloat(b.maxzoom):16;u<v;u++){var z=m/Math.pow(2,u);l.push({level:u,scale:Math.floor(3779.527559055118*z),resolution:z})}m=0;for(v=b.tiles;m<v.length;m++)n(p(h,v[m]));k={capabilities:"TilesOnly",initialExtent:k,fullExtent:k,minScale:l[0].scale,maxScale:l[l.length-1].scale,tiles:b.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,
y:2.0037508342787E7},lods:l,spatialReference:{wkid:102100}}}}a.validatedSource=k;a.sourceUrl&&n(a.sourceUrl);b=a.style?r.resolve():null==b.defaultStyles?r.reject():"string"===typeof b.defaultStyles?t(a,p(h,b.defaultStyles,"root.json")):t(a,b.defaultStyles,p(h,"root.json"));return b})}Object.defineProperty(x,"__esModule",{value:!0});var y=w.defaults&&w.defaults.io.corsEnabledServers||w.request.corsEnabledServers;x.loadMetadata=function(a){var c={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,
style:null,styleBase:null,styleUrl:null},d="string"===typeof a?[a,null]:[null,a.jsonUrl],g=d[0];d=d[1];var q=g?e.urlToObject(g):null;return t(c,a,d).then(function(){var f={layerDefinition:c.validatedSource,url:g,parsedUrl:q,serviceUrl:c.sourceUrl,style:c.style,styleUrl:c.styleUrl,spriteUrl:c.style.sprite&&p(c.styleBase,c.style.sprite),glyphsUrl:c.style.glyphs&&p(c.styleBase,c.style.glyphs)};n(f.spriteUrl);n(f.glyphsUrl);return f})}});