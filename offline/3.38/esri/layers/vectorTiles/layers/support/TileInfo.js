// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/layers/support/TileInfo","require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/JSONSupport ../../core/kebabDictionary ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ../../geometry/support/aaBoundingRect ../../geometry/support/scaleUtils ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD".split(" "),
function(F,G,y,z,k,n,A,B,h,u,v,C,p,D,E){var w=B({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc"});return function(x){function e(a){a=x.call(this)||this;a.dpi=96;a.format=null;a.origin=null;a.minScale=0;a.maxScale=0;a.size=null;a.spatialReference=null;return a}z(e,x);var r=e;e.create=function(a){void 0===a&&(a={size:256,spatialReference:n.SpatialReference.WebMercator});
var b=a.resolutionFactor||1,c=a.scales,d=a.size||256;a=a.spatialReference||n.SpatialReference.WebMercator;var g=p.getInfo(a);g=g?new n.Point(g.origin[0],g.origin[1],a):new n.Point(0,0,a);var f=1/(39.37*C.getMetersPerUnitForSR(a)*96),q=[];if(c)for(var l=0;l<c.length;l++){var m=c[l],t=m*f;q.push({level:l,scale:m,resolution:t})}else for(m=p.isGeographic(a)?512/d*1.47748799285417E8:256/d*5.91657527591555E8,c=Math.ceil(24/b),q.push({level:0,scale:m,resolution:m*f}),l=1;l<c;l++)m/=Math.pow(2,b),t=m*f,q.push({level:l,
scale:m,resolution:t});return new r({dpi:96,lods:q,origin:g,size:d,spatialReference:a})};Object.defineProperty(e.prototype,"isWrappable",{get:function(){var a=this.spatialReference,b=this.origin;if(a&&b){var c=p.getInfo(a);return a.isWrappable&&Math.abs(c.origin[0]-b.x)<=c.dx}return!1},enumerable:!0,configurable:!0});e.prototype.readOrigin=function(a,b){return n.Point.fromJSON(y({spatialReference:b.spatialReference},a))};Object.defineProperty(e.prototype,"lods",{set:function(a){var b=this,c=0,d=0,
g=[];this._levelToLOD={};a&&(c=-Infinity,d=Infinity,a.forEach(function(f){g.push(f.scale);c=f.scale>c?f.scale:c;d=f.scale<d?f.scale:d;b._levelToLOD[f.level]=f}));this._set("scales",g);this._set("minScale",c);this._set("maxScale",d);this._set("lods",a);this._initializeUpsampleLevels()},enumerable:!0,configurable:!0});e.prototype.readSize=function(a,b){return[b.cols,b.rows]};e.prototype.writeSize=function(a,b){b.cols=a[0];b.rows=a[0]};e.prototype.zoomToScale=function(a){var b=this.scales;if(0>=a)return b[0];
if(a>=b.length)return b[b.length-1];var c=Math.round(a);return b[c]+(c-a)*(b[Math.round(a-.5)]-b[c])};e.prototype.scaleToZoom=function(a){for(var b=this.scales,c=b.length-1,d=0;d<c;d++){var g=b[d],f=b[d+1];if(g<=a)break;if(f===a)return d+1;if(g>a&&f<a)return d+1-(a-f)/(g-f)}return d};e.prototype.snapScale=function(a,b){void 0===b&&(b=.95);a=this.scaleToZoom(a);return a%Math.floor(a)>=b?this.zoomToScale(Math.ceil(a)):this.zoomToScale(Math.floor(a))};e.prototype.tileAt=function(a,b,c,d){var g=this.lodAt(a);
if(!g)return null;if("number"===typeof b){var f=b;b=c}else{if(p.equals(b.spatialReference,this.spatialReference))f=b.x,b=b.y;else{d=D.project(b,this.spatialReference);if(!d)return null;f=d.x;b=d.y}d=c}c=g.resolution*this.size[0];g=g.resolution*this.size[1];d||(d={id:null,level:0,row:0,col:0,extent:v.create()});d.level=a;d.row=Math.floor((this.origin.y-b)/g+.001);d.col=Math.floor((f-this.origin.x)/c+.001);this.updateTileInfo(d);return d};e.prototype.updateTileInfo=function(a){var b=this.lodAt(a.level),
c=b.resolution*this.size[0];b=b.resolution*this.size[1];a.id=a.level+"/"+a.row+"/"+a.col;a.extent||(a.extent=v.create());a.extent[0]=this.origin.x+a.col*c;a.extent[1]=this.origin.y-(a.row+1)*b;a.extent[2]=a.extent[0]+c;a.extent[3]=a.extent[1]+b};e.prototype.upsampleTile=function(a){var b=this._upsampleLevels[a.level];if(!b||-1===b.parentLevel)return!1;a.level=b.parentLevel;a.row=Math.floor(a.row/b.factor+.001);a.col=Math.floor(a.col/b.factor+.001);this.updateTileInfo(a);return!0};e.prototype.getTileBounds=
function(a,b){var c=this.lodAt(b.level).resolution,d=c*this.size[0];c*=this.size[1];a[0]=this.origin.x+b.col*d;a[1]=this.origin.y-(b.row+1)*c;a[2]=a[0]+d;a[3]=a[1]+c;return a};e.prototype.lodAt=function(a){return this._levelToLOD&&this._levelToLOD[a]||null};e.prototype.clone=function(){return r.fromJSON(this.write({}))};e.prototype._initializeUpsampleLevels=function(){var a=this.lods;this._upsampleLevels=[];for(var b=null,c=0;c<a.length;c++){var d=a[c];this._upsampleLevels[d.level]={parentLevel:b?
b.level:-1,factor:b?b.resolution/d.resolution:0};b=d}};k([h.property({type:Number,json:{write:!0}})],e.prototype,"compressionQuality",void 0);k([h.property({type:Number,json:{write:!0}})],e.prototype,"dpi",void 0);k([h.property({type:String,json:{read:w.read,write:w.write}})],e.prototype,"format",void 0);k([h.property({readOnly:!0,dependsOn:["spatialReference","origin"]})],e.prototype,"isWrappable",null);k([h.property({type:n.Point,json:{write:!0}})],e.prototype,"origin",void 0);k([h.reader("origin")],
e.prototype,"readOrigin",null);k([h.property({type:[E],value:null,json:{write:!0}})],e.prototype,"lods",null);k([h.property({readOnly:!0})],e.prototype,"minScale",void 0);k([h.property({readOnly:!0})],e.prototype,"maxScale",void 0);k([h.property({readOnly:!0})],e.prototype,"scales",void 0);k([h.property({cast:function(a){return Array.isArray(a)?a:"number"===typeof a?[a,a]:[256,256]}})],e.prototype,"size",void 0);k([h.reader("size",["rows","cols"])],e.prototype,"readSize",null);k([h.writer("size",
{cols:{type:u.Integer},rows:{type:u.Integer}})],e.prototype,"writeSize",null);k([h.property({type:n.SpatialReference,json:{write:!0}})],e.prototype,"spatialReference",void 0);return e=r=k([h.subclass("esri.layers.support.TileInfo")],e)}(h.declared(A))});