// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/renderers/support/utils",["dojo/date/locale","../../Color","../../core/lang","../../core/numberUtils","dojo/i18n!dojo/cldr/nls/gregorian"],function(u,v,m,p,x){function y(b){return b&&b.map(function(a){return new v(a)})}function w(b,a,c){var d="";0===a?d=q.lt+" ":a===c&&(d=q.gt+" ");return d+b}var n={},q={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%",ld:"\u2013"},z={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},A={millisecond:{dateOptions:{formatLength:"long"},
timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",dateOptions:{formatLength:"long"}},month:{selector:"date",dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},B={formatLength:"short",fullYear:!0},C={formatLength:"short"};m.mixin(n,
{meterIn:{inches:1/.0254,feet:1/.3048,"us-feet":3.28084,yards:1/.9144,miles:1/1609.344,"nautical-miles":1/1852,millimeters:1E3,centimeters:100,decimeters:10,meters:1,kilometers:.001,"decimal-degrees":180/20015077},timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(b,a){var c=[];null==b||b instanceof Date||(b=new Date(b));a=a||{};a=m.mixin({},a);var d=a.selector?a.selector.toLowerCase():null,f=!d||-1<d.indexOf("time");d=!d||-1<d.indexOf("date");
f&&(a.timeOptions=a.timeOptions||C,a.timeOptions&&(a.timeOptions=m.mixin({},a.timeOptions),a.timeOptions.selector=a.timeOptions.selector||"time",c.push(a.timeOptions)));d&&(a.dateOptions=a.dateOptions||B,a.dateOptions&&(a.dateOptions=m.mixin({},a.dateOptions),a.dateOptions.selector=a.dateOptions.selector||"date",c.push(a.dateOptions)));c&&c.length?(c=c.map(function(e){return u.format(b,e)}),a=1==c.length?c[0]:x["dateTimeFormat-medium"].replace(/'/g,"").replace(/\{(\d+)\}/g,function(e,g){return c[g]})):
a=u.format(b);return a},createColorStops:function(b){var a=b.values,c=b.colors,d=b.labelIndexes,f=b.isDate,e=b.dateFormatOptions;b=[];return b=a.map(function(g,k){var l=null;if(!d||-1<d.indexOf(k)){var h;(h=f?n.formatDate(g,e):p.format(g))&&(l=w(h,k,a.length-1))}return{value:g,color:c[k],label:l}})},updateColorStops:function(b){var a=b.stops,c=b.changes,d=b.isDate,f=b.dateFormatOptions,e=[],g=a.map(function(l){return l.value});c.forEach(function(l){e.push(l.index);g[l.index]=l.value});var k=p.round(g,
{indexes:e});a.forEach(function(l,h){l.value=g[h];if(null!=l.label){var r,t=null;(r=d?n.formatDate(k[h],f):p.format(k[h]))&&(t=w(r,h,a.length-1));l.label=t}})},createClassBreakLabel:function(b){var a=b.minValue,c=b.maxValue,d=b.isFirstBreak?"":q.gt+" ";b="percent-of-total"===b.normalizationType?q.pct:"";a=null==a?"":p.format(a);c=null==c?"":p.format(c);return d+a+b+" "+q.ld+" "+c+b},setLabelsForClassBreaks:function(b){var a=b.classBreakInfos,c=b.classificationMethod,d=b.normalizationType,f=[];a&&
a.length&&("standard-deviation"===c?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):b.round?(f.push(a[0].minValue),a.forEach(function(e){f.push(e.maxValue)}),f=p.round(f),a.forEach(function(e,g){e.label=n.createClassBreakLabel({minValue:0===g?f[0]:f[g],maxValue:f[g+1],isFirstBreak:0===g,normalizationType:d})})):a.forEach(function(e,g){e.label=n.createClassBreakLabel({minValue:e.minValue,maxValue:e.maxValue,isFirstBreak:0===g,
normalizationType:d})}))},updateClassBreak:function(b){var a=b.classBreaks,c=b.normalizationType,d=b.change,f=d.index;d=d.value;var e=-1,g=-1,k=a.length;"standard-deviation"===b.classificationMethod?console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method."):(0===f?e=f:f===k?g=f-1:(g=f-1,e=f),-1<e&&e<k&&(b=a[e],b.minValue=d,b.label=n.createClassBreakLabel({minValue:b.minValue,maxValue:b.maxValue,isFirstBreak:0===e,normalizationType:c})),-1<g&&
g<k&&(b=a[g],b.maxValue=d,b.label=n.createClassBreakLabel({minValue:b.minValue,maxValue:b.maxValue,isFirstBreak:0===g,normalizationType:c})))},calculateDateFormatInterval:function(b){var a,c,d=b.length,f=Infinity;b=b.map(function(D){return new Date(D)});for(a=0;a<d-1;a++){var e=b[a];var g=[];var k=Infinity;var l="";for(c=a+1;c<d;c++){var h=b[c];h=e.getFullYear()!==h.getFullYear()&&"year"||e.getMonth()!==h.getMonth()&&"month"||e.getDate()!==h.getDate()&&"day"||e.getHours()!==h.getHours()&&"hour"||
e.getMinutes()!==h.getMinutes()&&"minute"||e.getSeconds()!==h.getSeconds()&&"second"||"millisecond";var r=z[h];r<k&&(k=r,l=h);g.push(h)}if(k<f){f=k;var t=l}}return t},createUniqueValueLabel:function(b){var a=b.value,c=b.fieldInfo,d=b.domain;b=b.dateFormatInterval;var f=String(a);(d=d&&d.codedValues?d.getName(a):null)?f=d:"number"===typeof a&&(f=c&&"date"===c.type?n.formatDate(a,b&&A[b]):p.format(a));return f},cloneColorVariable:function(b){if(b){var a=m.mixin({},b);a.colors=y(a.colors);a.stops=a.stops&&
a.stops.map(function(c){c=m.mixin({},c);c.color&&(c.color=new v(c.color));return c});a.legendOptions&&(a.legendOptions=m.mixin({},a.legendOptions))}return a},cloneOpacityVariable:function(b){if(b){var a=m.mixin({},b);if(b=a.opacityValues)a.opacityValues=b.slice(0);if(b=a.stops)a.stops=b.map(function(c){return m.mixin({},c)});if(b=a.legendOptions)a.legendOptions=m.mixin({},b)}return a},cloneSizeVariable:function(b){if(b){var a=m.mixin({},b);a.stops&&(a.stops=a.stops.map(function(c){return m.mixin({},
c)}));(b=a.minSize)&&"object"===typeof b&&(a.minSize=n.cloneSizeVariable(b));(b=a.maxSize)&&"object"===typeof b&&(a.maxSize=n.cloneSizeVariable(b));if(b=a.legendOptions)if(a.legendOptions=m.mixin({},b),b=b.customValues)a.legendOptions.customValues=b.slice(0)}return a}});return n});