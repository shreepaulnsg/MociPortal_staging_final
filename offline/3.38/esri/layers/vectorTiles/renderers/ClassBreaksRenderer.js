// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("../core/declare ../core/lang ../core/kebabDictionary ../core/Error ../core/Logger ../core/accessorSupport/ensureType ../support/arcadeUtils ../symbols/Symbol ../symbols/PolygonSymbol3D ../symbols/support/jsonUtils ../symbols/support/typeUtils ./Renderer ./support/LegendOptions ./support/ClassBreakInfo".split(" "),function(t,m,u,v,w,p,k,x,y,g,l,z,n,h){var A=w.getLogger("esri.renderers.ClassBreaksRenderer");n=n.LegendOptions;h=h.ClassBreakInfo;var q=u({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",
esriNormalizeByField:"field"}),B=p.ensureType(h),r=t(z,{declaredClass:"esri.renderers.ClassBreaksRenderer",properties:{backgroundFillSymbol:{types:{base:x,key:"type",typeMap:{"simple-fill":l.types.typeMap["simple-fill"],"picture-fill":l.types.typeMap["picture-fill"],"polygon-3d":l.types.typeMap["polygon-3d"]}},value:null,json:{origins:{"web-scene":{read:g.read,write:{target:{backgroundFillSymbol:{type:y}},writer:g.writeTarget}}},read:g.read,write:g.writeTarget}},classBreakInfos:{type:[h],json:{read:function(a,
b,c){if(Array.isArray(a)){var d=b.minValue;return a.map(function(e){var f=new h;f.read(e,c);null==f.minValue&&(f.minValue=d);null==f.maxValue&&(f.maxValue=f.minValue);d=f.maxValue;return f})}},write:function(a,b,c,d){a=a.map(function(e){return e.write({},d)});this._areClassBreaksConsecutive()&&a.forEach(function(e){delete e.classMinValue});b[c]=a}}},minValue:{type:Number,readOnly:!0,dependsOn:["classBreakInfos"],get:function(){return this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0},json:{read:!1,
write:{overridePolicy:function(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}},defaultLabel:{type:String,value:null,json:{write:!0}},defaultSymbol:{types:l.rendererTypes,value:null,json:{origins:{"web-scene":{read:g.read,write:{target:{defaultSymbol:{types:l.rendererTypes3D}},writer:g.writeTarget}}},read:g.read,write:g.writeTarget}},valueExpression:{type:String,value:null,json:{write:!0}},valueExpressionTitle:{type:String,value:null,json:{write:!0}},
compiledFunc:{dependsOn:["valueExpression"],get:function(){return k.createFunction(this.valueExpression)}},legendOptions:{type:n,value:null,json:{write:!0}},field:{value:null,cast:function(a){return null==a?a:"function"===typeof a?a:p.ensureString(a)},json:{type:String,write:function(a,b,c,d){"string"===typeof a?b[c]=a:d&&d.messages?d.messages.push(new v("property:unsupported","ClassBreaksRenderer.field set to a function cannot be written to JSON")):A.error(".field: cannot write field to JSON since it's not a string value")}}},
isMaxInclusive:!0,normalizationField:{type:String,value:null,json:{write:!0}},normalizationTotal:{type:Number,value:null,json:{write:!0}},normalizationType:{type:String,value:null,dependsOn:["normalizationField","normalizationTotal"],get:function(){var a=this._get("normalizationType"),b=!!this.normalizationField,c=null!=this.normalizationTotal;if(b||c)a=b&&"field"||c&&"percent-of-total",b&&c&&console.warn("warning: both normalizationField and normalizationTotal are set!");else if("field"===a||"percent-of-total"===
a)a=null;return a},json:{read:q.fromJSON,write:function(a,b){if(a=q.toJSON(a))b.normalizationType=a}}},requiredFields:{dependsOn:["field","normalizationField","valueExpression"]},type:{value:"class-breaks",json:{write:function(a,b){b.type="classBreaks"}}}},constructor:function(){this.classBreakInfos=[]},addClassBreakInfo:function(a,b,c){a="number"===typeof a?new h({minValue:a,maxValue:b,symbol:c}):B(m.clone(a));this.classBreakInfos.push(a);1===this.classBreakInfos.length&&this.notifyChange("minValue")},
removeClassBreakInfo:function(a,b){var c,d=this.classBreakInfos.length;for(c=0;c<d;c++){var e=[this.classBreakInfos[c].minValue,this.classBreakInfos[c].maxValue];if(e[0]==a&&e[1]==b){this.classBreakInfos.splice(c,1);break}}},getBreakIndex:function(a,b){var c=this.field,d=a.attributes,e=this.classBreakInfos.length,f=this.isMaxInclusive;if(this.valueExpression)a=k.executeFunction(this.compiledFunc,k.createExecContext(a,k.getViewInfo(b)));else if("function"===typeof c)a=c(a);else if(a=parseFloat(d[c]),
b=this.normalizationType)if(c=parseFloat(this.normalizationTotal),d=parseFloat(d[this.normalizationField]),"log"===b)a=Math.log(a)*Math.LOG10E;else if("percent-of-total"===b&&!isNaN(c))a=a/c*100;else if("field"===b&&!isNaN(d)){if(isNaN(a)||isNaN(d))return-1;a/=d}if(null!=a&&!isNaN(a)&&"number"===typeof a)for(d=0;d<e;d++)if(b=[this.classBreakInfos[d].minValue,this.classBreakInfos[d].maxValue],b[0]<=a&&(f?a<=b[1]:a<b[1]))return d;return-1},getClassBreakInfo:function(a,b){a=this.getBreakIndex(a,b);return-1!==
a?this.classBreakInfos[a]:null},getSymbol:function(a,b){a=this.getBreakIndex(a,b);return-1<a?this.classBreakInfos[a].symbol:this.defaultSymbol},getSymbols:function(){var a=[];this.classBreakInfos.forEach(function(b){b.symbol&&a.push(b.symbol)});this.defaultSymbol&&a.push(this.defaultSymbol);return a},clone:function(){return new r({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),
valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:m.clone(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:m.clone(this.visualVariables),legendOptions:m.clone(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})},collectRequiredFields:function(a){this.inherited(arguments);
[this.field,this.normalizationField].forEach(function(b){b&&(a[b]=!0)});this.valueExpression&&k.extractFieldNames(this.valueExpression).forEach(function(b){a[b]=!0})},_areClassBreaksConsecutive:function(){for(var a=this.classBreakInfos,b=1;b<a.length;b++)if(a[b-1].maxValue!==a[b].minValue)return!1;return!0}});return r});