// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/core/accessorSupport/wire",["require","exports","./utils"],function(u,g,f){function m(b,a,c){a=f.splitPath(a);if(Array.isArray(a)){for(var d=[],e=0;e<a.length;e++)d.push((new h(a[e],c)).install(b));return new n(d)}b=(new h(a,c)).install(b);return new p(b)}Object.defineProperty(g,"__esModule",{value:!0});var h=function(){function b(a,c){this.path=a;this.callback=c;this.chain=null;this.path=a;-1<a.indexOf(".")&&(this.chain=f.pathToArray(a));this.callback=c;return this}
b.prototype.install=function(a){a=this.chain?new r(this,a):new t(this,a);return a};b.prototype.notify=function(a){this.callback(a,this.path)};return b}(),t=function(){function b(a,c){this.binding=a;this.target=c;f.getProperties(c).addCursor(this.binding.path,this)}b.prototype.destroy=function(){this.target&&(f.getProperties(this.target).removeCursor(this.binding.path,this),this.target=this.binding=null)};b.prototype.propertyDestroyed=function(a,c){f.getProperties(this.target).removeCursor(c,this)};
b.prototype.propertyInvalidated=function(a,c){this.binding&&this.binding.notify(this.target)};b.prototype.propertyCommitted=function(a,c){this.binding&&this.binding.notify(this.target)};return b}(),r=function(){function b(a,c){this.binding=a;this.target=c;this.stack=[];this.properties=f.getProperties(c);this.stack.push({properties:this.properties,propertyName:a.chain[0]});this.properties.addCursor(a.chain[0],this);this.moveForward();return this}b.prototype.destroy=function(){for(;;){var a=this.stack.pop();
if(null==a)break;a.properties.removeCursor(a.propertyName,this)}this.target=this.binding=null};b.prototype.propertyDestroyed=function(a,c){this.moveBackward(a,c)};b.prototype.propertyInvalidated=function(a,c){this.binding&&this.binding.notify(this.target)};b.prototype.propertyCommitted=function(a,c){this.binding&&(this.moveBackward(a,c),this.moveForward(),this.binding.notify(this.target))};b.prototype.moveBackward=function(a,c){for(var d=this.stack,e=d[d.length-1];e.properties!==a&&e.propertyName!==
c;)e.properties.removeCursor(e.propertyName,this),d.pop(),e=d[d.length-1]};b.prototype.moveForward=function(){var a=this.stack,c=a[a.length-1];c=c.properties.internalGet(c.propertyName);(c=f.getProperties(c))&&a.length<this.binding.chain.length&&(a=this.binding.chain[a.length],this.stack.push({properties:c,propertyName:a}),c.addCursor(a,this),this.moveForward())};return b}(),n=function(){function b(a){this.cursors=a}b.prototype.remove=function(){for(var a=this.cursors;0<a.length;)a.pop().destroy();
this.cursors=null};return b}(),p=function(){function b(a){this.cursor=a}b.prototype.remove=function(){this.cursor.destroy();this.cursor=null};return b}();g.create=function(b,a){b=f.splitPath(b);if(Array.isArray(b)){for(var c=[],d=0;d<b.length;d++)c.push(new h(b[d],a));return function(l){for(var q=[],k=0;k<c.length;k++)q[k]=c[k].install(l);return new n(q)}}var e=new h(b,a);return function(l){return new p(e.install(l))}};g.wire=m;g.default=m});