// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/core/Collection","require exports ./tsSupport/declareExtendsHelper ./tsSupport/decorateHelper dojo/aspect ./Accessor ./ArrayPool ./Evented ./lang ./ObjectPool ./scheduling ./accessorSupport/decorators ./accessorSupport/ensureType".split(" "),function(H,W,L,D,M,N,z,O,P,Q,R,A,I){function B(n){return n?n.isInstanceOf&&n.isInstanceOf(J):!1}function E(n){return n?B(n)?n.toArray():n.length?Array.prototype.slice.apply(n):[]:[]}function F(n){if(n&&n.length)return n[0]}function K(n,
d,t,a){d&&d.forEach(function(b,c,e){n.push(b);K(n,t.call(a,b,c,e),t,a)})}H=function(){function n(){this.target=null;this.defaultPrevented=this.cancellable=!1}n.prototype.preventDefault=function(){this.cancellable&&(this.defaultPrevented=!0)};n.prototype.reset=function(d){this.defaultPrevented=!1;this.item=d};return n}();var S=function(){},q=new Q(H,!0,function(n){n.item=null;n.target=null}),u=new Set,v=new Set,w=new Set,G=new Map,T=0,J=function(n){function d(a){a=n.call(this,a)||this;a._boundDispatch=
a._dispatchColChange.bind(a);a._chgListeners=[];a._notifications=null;a._timer=null;a.length=0;a._items=[];Object.defineProperty(a,"uid",{value:T++});return a}L(d,n);var t=d;d.ofType=function(a){if(!a)return t;if(G.has(a))return G.get(a);if("function"===typeof a)var b=a.prototype.declaredClass;else if(a.base)b=a.base.prototype.declaredClass;else for(var c in a.typeMap){var e=a.typeMap[c].prototype.declaredClass;b=b?b+(" | "+e):e}b=t.createSubclass({declaredClass:"esri.core.Collection\x3c"+b+"\x3e"});
c={Type:a,ensureType:"function"===typeof a?I.ensureType(a):I.ensureOneOfType(a)};Object.defineProperty(b.prototype,"itemType",{value:c});G.set(a,b);return b};d.prototype.normalizeCtorArgs=function(a){return a?Array.isArray(a)||B(a)?{items:a}:a:{}};Object.defineProperty(d.prototype,"items",{get:function(){return this._items},set:function(a){this._emitBeforeChanges()||(this._splice.apply(this,[0,this.length].concat(E(a))),this._emitAfterChanges())},enumerable:!0,configurable:!0});d.prototype.on=function(a,
b){var c;Array.isArray(a)?c=a:-1<a.indexOf(",")&&(c=a.split(/\s*,\s*/));if(c){var e=[];for(a=0;a<c.length;a++)e.push(this.on(c[a],b));e.remove=function(){for(var k=0;k<e.length;k++)e[k].remove()};return e}if("change"===a){var f=this._chgListeners,m={removed:!1,callback:b};f.push(m);this._notifications&&this._notifications.push({listeners:f.slice(),items:this._items.slice(),changes:[]});return{remove:function(){this.remove=S;m.removed=!0;f.splice(f.indexOf(m),1)}}}return M.after(this,"on"+a,b,!0)};
d.prototype.hasEventListener=function(a){return"change"===a?0<this._chgListeners.length:this.inherited(arguments)};d.prototype.add=function(a,b){if(this._emitBeforeChanges())return this;b=this.getNextIndex(b);this._splice(b,0,a);this._emitAfterChanges();return this};d.prototype.addMany=function(a,b){void 0===b&&(b=this._items.length);if(!a||!a.length||this._emitBeforeChanges())return this;b=this.getNextIndex(b);this._splice.apply(this,[b,0].concat(E(a)));this._emitAfterChanges();return this};d.prototype.removeAll=
function(){if(!this.length||this._emitBeforeChanges())return[];var a=this._splice(0,this.length)||[];this._emitAfterChanges();return a};d.prototype.clone=function(){return this._createNewInstance({items:this._items.map(P.clone)})};d.prototype.concat=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];a=a.map(E);return this._createNewInstance({items:(c=this._items).concat.apply(c,a)});var c};d.prototype.drain=function(a,b){if(this.length&&!this._emitBeforeChanges()){for(var c=this._splice(0,
this.length),e=c.length,f=0;f<e;f++)a.call(b,c[f],f,c);this._emitAfterChanges()}};d.prototype.every=function(a,b){return this._items.every(a,b)};d.prototype.filter=function(a,b){var c=2===arguments.length?this._items.filter(a,b):this._items.filter(a);return this._createNewInstance({items:c})};d.prototype.find=function(a,b){if("function"!==typeof a)throw new TypeError(a+" is not a function");for(var c=this._items,e=c.length,f=0;f<e;f++){var m=c[f];if(a.call(b,m,f,c))return m}};d.prototype.findIndex=
function(a,b){if("function"!==typeof a)throw new TypeError(a+" is not a function");for(var c=this._items,e=c.length,f=0;f<e;f++)if(a.call(b,c[f],f,c))return f;return-1};d.prototype.flatten=function(a,b){var c=[];K(c,this,a,b);return new t(c)};d.prototype.forEach=function(a,b){for(var c=this._items,e=c.length,f=0;f<e;f++)a.call(b,c[f],f,c)};d.prototype.getItemAt=function(a){return this._items[a]};d.prototype.getNextIndex=function(a){var b=this.length;a=null==a?b:a;0>a?a=0:a>b&&(a=b);return a};d.prototype.includes=
function(a,b){void 0===b&&(b=0);return arguments.length?-1!==this._items.indexOf(a,b):!1};d.prototype.indexOf=function(a,b){void 0===b&&(b=0);return this._items.indexOf(a,b)};d.prototype.join=function(a){void 0===a&&(a=",");return this._items.join(a)};d.prototype.lastIndexOf=function(a,b){void 0===b&&(b=this.length-1);return this._items.lastIndexOf(a,b)};d.prototype.map=function(a,b){a=this._items.map(a,b);return new t({items:a})};d.prototype.reorder=function(a,b){void 0===b&&(b=this.length-1);var c=
this.indexOf(a);if(-1!==c){0>b?b=0:b>=this.length&&(b=this.length-1);if(c!==b){if(this._emitBeforeChanges())return a;this._splice(c,1);this._splice(b,0,a);this._emitAfterChanges()}return a}};d.prototype.pop=function(){if(this.length&&!this._emitBeforeChanges()){var a=F(this._splice(this.length-1,1));this._emitAfterChanges();return a}};d.prototype.push=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];if(this._emitBeforeChanges())return this.length;this._splice.apply(this,[this.length,
0].concat(a));this._emitAfterChanges();return this.length};d.prototype.reduce=function(a,b){var c=this._items;return 2===arguments.length?c.reduce(a,b):c.reduce(a)};d.prototype.reduceRight=function(a,b){var c=this._items;return 2===arguments.length?c.reduceRight(a,b):c.reduceRight(a)};d.prototype.remove=function(a){return this.removeAt(this.indexOf(a))};d.prototype.removeAt=function(a){if(!(0>a||a>=this.length||this._emitBeforeChanges()))return a=F(this._splice(a,1)),this._emitAfterChanges(),a};d.prototype.removeMany=
function(a){if(!a||!a.length||this._emitBeforeChanges())return[];a=B(a)?a.toArray():a;for(var b=this._items,c=[],e=a.length,f=0;f<e;f++){var m=b.indexOf(a[f]);if(-1<m){for(var k=f+1,l=m+1,h=Math.min(a.length-k,b.length-l),g=0;g<h&&a[k+g]===b[l+g];)g++;k=1+g;(m=this._splice(m,k))&&0<m.length&&c.push.apply(c,m);f+=k-1}}this._emitAfterChanges();return c};d.prototype.reverse=function(){if(this._emitBeforeChanges())return this;var a=this._splice(0,this.length);a&&(a.reverse(),this._splice.apply(this,[0,
0].concat(a)));this._emitAfterChanges();return this};d.prototype.shift=function(){if(this.length&&!this._emitBeforeChanges()){var a=F(this._splice(0,1));this._emitAfterChanges();return a}};d.prototype.slice=function(a,b){void 0===a&&(a=0);void 0===b&&(b=this.length);return this._createNewInstance({items:this._items.slice(a,b)})};d.prototype.some=function(a,b){return this._items.some(a,b)};d.prototype.sort=function(a){if(!this.length||this._emitBeforeChanges())return this;var b=this._splice(0,this.length);
arguments.length?b.sort(a):b.sort();this._splice.apply(this,[0,0].concat(b));return this};d.prototype.splice=function(a,b){for(var c=[],e=2;e<arguments.length;e++)c[e-2]=arguments[e];if(this._emitBeforeChanges())return[];c=this._splice.apply(this,[a,b].concat(c))||[];this._emitAfterChanges();return c};d.prototype.toArray=function(){return this._items.slice()};d.prototype.toJSON=function(){return this.toArray()};d.prototype.toLocaleString=function(){return this._items.toLocaleString()};d.prototype.toString=
function(){return this._items.toString()};d.prototype.unshift=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];if(this._emitBeforeChanges())return this.length;this._splice.apply(this,[0,0].concat(a));this._emitAfterChanges();return this.length};d.prototype._createNewInstance=function(a){return new this.constructor(a)};d.prototype._splice=function(a,b){for(var c=[],e=2;e<arguments.length;e++)c[e-2]=arguments[e];e=this._items;var f=this.constructor.prototype.itemType;!this._notifications&&
this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=R.schedule(this._boundDispatch));if(b){var m=e.splice(a,b);if(this.hasEventListener("before-remove")){var k=q.acquire();k.target=this;k.cancellable=!0;for(var l=0,h=m.length;l<h;l++){var g=m[l];k.reset(g);this.emit("before-remove",k);k.defaultPrevented&&(m.splice(l,1),e.splice(a,0,g),a+=1,--l,--h)}q.release(k)}this.length=
this._items.length;if(this.hasEventListener("after-remove")){g=q.acquire();g.target=this;g.cancellable=!1;h=m.length;for(l=0;l<h;l++)g.reset(m[l]),this.emit("after-remove",g);q.release(g)}}if(c&&c.length){if(f){l=[];for(h=0;h<c.length;h++)g=c[h],k=f.ensureType(g),null==k&&null!=g||l.push(k);c=l}f=this.hasEventListener("before-add");l=this.hasEventListener("after-add");h=a===this.length;if(f||l){g=q.acquire();g.target=this;g.cancellable=!0;k=q.acquire();k.target=this;k.cancellable=!1;for(var r=0,x=
c;r<x.length;r++){var p=x[r];f?(g.reset(p),this.emit("before-add",g),g.defaultPrevented||(h?e.push(p):e.splice(a++,0,p),this._set("length",e.length),l&&(k.reset(p),this.emit("after-add",k)))):(h?e.push(p):e.splice(a++,0,p),this._set("length",e.length),k.reset(p),this.emit("after-add",k))}q.release(g)}else h?e.push.apply(e,c):e.splice.apply(e,[a,0].concat(c)),this._set("length",e.length)}(c&&c.length||m&&m.length)&&this._notifyChangeEvent(c,m);return m};d.prototype._emitBeforeChanges=function(){var a=
!1;if(this.hasEventListener("before-changes")){var b=q.acquire();b.target=this;b.cancellable=!0;this.emit("before-changes",b);a=b.defaultPrevented;q.release(b)}return a};d.prototype._emitAfterChanges=function(){if(this.hasEventListener("after-changes")){var a=q.acquire();a.target=this;a.cancellable=!1;this.emit("after-changes",a);q.release(a)}};d.prototype._notifyChangeEvent=function(a,b){this.hasEventListener("change")&&this._notifications[this._notifications.length-1].changes.push({added:a,removed:b})};
d.prototype._dispatchColChange=function(){this._timer&&(this._timer.remove(),this._timer=null);if(this._notifications){var a=this._notifications;this._notifications=null;for(var b=function(f){var m=f.changes;u.clear();v.clear();w.clear();for(var k=0;k<m.length;k++){var l=m[k],h=l.added;l=l.removed;if(h)if(0===w.size&&0===v.size)for(var g=0,r=h;g<r.length;g++)h=r[g],u.add(h);else for(g=0,r=h;g<r.length;g++)h=r[g],v.has(h)?(w.add(h),v.delete(h)):w.has(h)||u.add(h);if(l)if(0===w.size&&0===u.size)for(g=
0;g<l.length;g++)h=l[g],v.add(h);else for(g=0;g<l.length;g++)h=l[g],u.has(h)?u.delete(h):(w.delete(h),v.add(h))}var x=z.acquire();u.forEach(function(y){x.push(y)});var p=z.acquire();v.forEach(function(y){p.push(y)});var U=c._items,V=f.items,C=z.acquire();w.forEach(function(y){V.indexOf(y)!==U.indexOf(y)&&C.push(y)});if(f.listeners&&(x.length||p.length||C.length))for(m={target:c,added:x,removed:p,moved:C},k=f.listeners.length,h=0;h<k;h++)l=f.listeners[h],l.removed||l.callback.call(c,m);z.release(x);
z.release(p);z.release(C)},c=this,e=0;e<a.length;e++)b(a[e]);u.clear();v.clear();w.clear()}};d.isCollection=B;D([A.property()],d.prototype,"length",void 0);D([A.property()],d.prototype,"items",null);return d=t=D([A.subclass("esri.core.Collection")],d)}(A.declared(N,O));return J});