// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/core/workers/WorkerFallback",["require","exports","dojo/has","../global","./utils"],function(k,x,p,g,h){var q=function(){return function(){var c=this,a=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(function(d){c[d]=function(){for(var b=[],e=0;e<arguments.length;e++)b[e]=arguments[e];return a[d].apply(a,b)}})}}(),l=g.MutationObserver||g.WebKitMutationObserver,m=function(){if(g.process&&g.process.nextTick)var c=function(b){g.process.nextTick(b)};
else if(g.Promise)c=function(b){g.Promise.resolve().then(b)};else if(l){var a=[],d=document.createElement("div");(new l(function(){for(;0<a.length;)a.shift()()})).observe(d,{attributes:!0});c=function(b){a.push(b);d.setAttribute("queueStatus","1")}}return c}();return function(){function c(){this._dispatcher=new q;this._isInitialized=!1;this._workerPostMessage({type:h.MessageType.HANDSHAKE})}c.prototype.terminate=function(){};Object.defineProperty(c.prototype,"onmessage",{get:function(){return this._onmessageHandler},
set:function(a){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler);(this._onmessageHandler=a)&&this.addEventListener("message",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"onerror",{get:function(){return this._onerrorHandler},set:function(a){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler);(this._onerrorHandler=a)&&this.addEventListener("error",a)},enumerable:!0,configurable:!0});c.prototype.postMessage=function(a,
d){var b=this;m(function(){b._workerMessageHandler(new MessageEvent("message",{data:a}))})};c.prototype.dispatchEvent=function(a){return this._dispatcher.dispatchEvent(a)};c.prototype.addEventListener=function(a,d,b){this._dispatcher.addEventListener(a,d,b)};c.prototype.removeEventListener=function(a,d,b){this._dispatcher.removeEventListener(a,d,b)};c.prototype._workerPostMessage=function(a,d){var b=this;m(function(){b.dispatchEvent(new MessageEvent("message",{data:a}))})};c.prototype._workerMessageHandler=
function(a){var d=this;if(a=h.receiveMessage(a)){var b=a.jobId;switch(a.type){case h.MessageType.CONFIGURE:this._isInitialized||this._workerPostMessage({type:h.MessageType.CONFIGURED});break;case h.MessageType.OPEN:a=a.modulePath,p("esri-webpack")?k(["esri/core/workers/RemoteClient","esri/views/vectorTiles/WorkerTileHandler","esri/views/2d/layers/features/Pipeline","esri/views/3d/layers/PointCloudWorker","esri/views/3d/layers/SceneLayerWorker","esri/layers/graphics/sources/support/CSVSourceWorker",
"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker",a],function(e,f,r,t,u,v,w,n){switch(n){case "esri/views/vectorTiles/WorkerTileHandler":break;case "esri/views/2d/layers/features/Pipeline":f=r;break;case "esri/views/3d/layers/PointCloudWorker":f=t;break;case "esri/views/3d/layers/SceneLayerWorker":f=u;break;case "esri/layers/graphics/sources/support/CSVSourceWorker":f=v;break;case "esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":f=w;break;default:f=n}e=e.connect(f);
d._workerPostMessage({type:h.MessageType.OPENED,jobId:b,data:e})}):k(["./RemoteClient",a],function(e,f){e=e.connect(f);d._workerPostMessage({type:h.MessageType.OPENED,jobId:b,data:e})})}}};return c}()});