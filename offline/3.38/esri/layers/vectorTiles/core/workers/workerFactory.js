// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/core/workers/workerFactory","require exports ../tsSupport/assignHelper dojo/_base/kernel ../../config ../../request ../Logger ../promiseUtils ../sniff ../urlUtils ./loaderConfig ./utils ./WorkerFallback".split(" "),function(x,u,g,y,e,z,A,B,n,v,w,h,k){function p(a){return B.create(function(b){function l(c){if(c=h.receiveMessage(c))switch(c.type){case C:c=a;var D=e.workers.loaderUrl||w.DEFAULT_LOADER_URL;if(null!=e["default"]){var f=g({},e);delete f["default"];f=JSON.parse(JSON.stringify(f))}else f=
JSON.parse(JSON.stringify(e));var d=e.workers.loaderConfig;d=w.default({baseUrl:d.baseUrl,locale:y.locale,has:g({"config-deferredInstrumentation":0,"dojo-test-sniff":0,"esri-cors":1,"esri-secure-context":n("esri-secure-context"),"esri-workers-supports-transfer-arraybuffer":n("esri-workers-supports-transfer-arraybuffer"),"events-keypress-typed":0,"host-webworker":1},d.has),map:g({},d.map),paths:g({},d.paths),packages:d.packages||[]});c.postMessage({type:E,configure:{esriConfig:f,loaderUrl:D,loaderConfig:d}});
break;case F:a.removeEventListener("message",l),a.removeEventListener("error",m),b(a)}}function m(c){c.preventDefault();a.removeEventListener("message",l);a.removeEventListener("error",m);q.warn("Failed to create Worker. Fallback to execute module in main thread",c);a=new k;a.addEventListener("message",l);a.addEventListener("error",m)}a.addEventListener("message",l);a.addEventListener("error",m)})}Object.defineProperty(u,"__esModule",{value:!0});var r=v.normalize(x.toUrl("./worker.js")),G=!v.hasSameOrigin(r,
location.href),q=A.getLogger("esri.core.workers"),t=null,F=h.MessageType.CONFIGURED,E=h.MessageType.CONFIGURE,C=h.MessageType.HANDSHAKE;u.createWorker=function(){if(!n("esri-workers"))return p(new k);if(!G){var a=void 0;try{a=new Worker(r)}catch(b){q.warn("Failed to create Worker. Fallback to execute module in main thread",event),a=new k}return p(a)}t||(t=z(r,{responseType:"text"}));return t.then(function(b){return new Worker(URL.createObjectURL(new Blob([b.data],{type:"text/javascript"})))}).catch(function(b){q.warn("Failed to create Worker. Fallback to execute module in main thread",
b);return new k}).then(function(b){return p(b)})}});