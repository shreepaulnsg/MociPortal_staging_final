// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/WCSCoverageDescription","dojo/_base/declare dojo/_base/lang dojo/has ../kernel ./TimeInfo ../geometry/Extent".split(" "),function(B,w,E,F,D,A){var C=function(a,b){var g;for(g=0;g<a.length;g++)if(b(a[g]))return g;return-1};B=B(null,{declaredClass:"esri.layers.WCSCoverageDescription",version:null,id:null,description:null,lonLatEnvelope:null,extent:null,supportedFormats:null,supportedInterpolations:null,bandInfo:null,timeInfo:null,multidimensionalInfo:null,resolution:null,columns:null,
rows:null,nativeCoverageDescription:null,_useEPSGAxis:!1,_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,
21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],constructor:function(a,b){this.version=b;this._parse=w.hitch(this,this._parse);a&&w.mixin(this,this._parse(a,b))},_parse:function(a,b){this.version=b;switch(b){case "1.0.0":a=this._parse100(a);this._useEPSGAxis=!1;this.id=a.name;this.description=a.description||a.label;
this.lonLatEnvelope=a.lonLatEnvelope;this.extent=a.domainSet.spatialDomain.envelope;this.supportedFormats=a.supportedFormats;b=a.domainSet;var g=a.rangeSet;a.supportedInterpolations&&0<a.supportedInterpolations.length&&(this.supportedInterpolations=a.supportedInterpolations.map(function(h){var p=null;-1<h.toLowerCase().indexOf("nearest")?p=0:-1<h.toLowerCase().indexOf("linear")?p=1:-1<h.toLowerCase().indexOf("cubic")&&(p=2);return p}).filter(function(h){return null!==h}));break;case "1.1.0":case "1.1.1":case "1.1.2":a=
this._parse110(a);this.id=a.identifier;this.description=a["abstract"]||a.title;this.extent=a.domain.spatialDomain.envelope;this.supportedFormats=a.supportedFormats;b=a.domain;g=a.range;a.range[0].supportedInterpolations&&0<a.range[0].supportedInterpolations.length&&(this.supportedInterpolations=a.range[0].supportedInterpolations.map(function(h){var p=null;-1<h.toLowerCase().indexOf("nearest")?p=0:-1<h.toLowerCase().indexOf("linear")?p=1:-1<h.toLowerCase().indexOf("bicubic")&&(p=2);return p}).filter(function(h){return null!==
h}));break;case "2.0.1":a=this._parse201(a);this._useEPSGAxis=!0;this.id=a.coverageId;this.description=a.description||a.coverageId;this.extent=a.boundedBy.envelope;this.supportedFormats=a.serviceParameters.supportedFormats;b=a.domainSet;g=a.rangeType;break;default:throw"unsupported WCS version "+b;}this.nativeCoverageDescription=a;this.resolution=a.resolution;this.columns=b.columns||b.spatialDomain.columns;this.rows=b.rows||b.spatialDomain.rows;this.bandInfo=this._getBandInfo(g);this.timeInfo=this._getTimeInfo(a);
this.multidimensionalInfo=this._getMultidimensionalInfo(a)},_getElements:function(a,b){if(!a)return null;if(!b)return a;var g=b;-1<b.indexOf("/")?(g=b.slice(0,b.indexOf("/")),b=b.slice(b.indexOf("/")+1)):b="";return b?this._getElement(a,g).getElementsByTagNameNS("*",b):a.getElementsByTagNameNS("*",g)},_getElement:function(a,b){if(!a)return null;if(!b)return a;var g=b;-1<b.indexOf("/")?(g=b.slice(0,b.indexOf("/")),b=b.slice(b.indexOf("/")+1)):b="";a=this._getElements(a,g);return 0<a.length?b?this._getElement(a[0],
b):a[0]:null},_getElementValue:function(a,b){return(a=this._getElement(a,b))?(a=a.textContent||a.text||a.nodeValue||a.innerText)?a.trim():null:null},_getElementValues:function(a,b){a=this._getElements(a,b);b=[];var g,h;for(h=0;h<a.length;h++)if(g=a[h].textContent||a[h].text||a[h].nodeValue||a[h].innerText)g=g.trim(),""!==g&&b.push(g);return b},_checkTagName:function(a,b){if(null===a||null===b||null===a.tagName||void 0===a.tagName)return!1;a=a.tagName.toLowerCase();b=b.toLowerCase();return a===b||
0<a.indexOf(":"+b)},_parseTimeResolution:function(a){if(!a)return{resolution:null,units:null};var b=a.toUpperCase(),g=["Y","M","D"],h=["H","M","S"];a="Years Months Days Hours Minutes Seconds".split(" ");var p;-1===b.indexOf("PT")?(b=b.slice(1),g=C(g,function(x){return-1<b.indexOf(x)}),-1<g&&(p=a[g])):(b=b.slice(2),g=C(h,function(x){return-1<b.indexOf(x)}),p=a[3+g]);return{resolution:parseFloat(b.substring(0,b.length-1)),units:p}},_getMultidimensionalInfo:function(a){var b,g,h=this.version,p=[];if(0===
h.indexOf("1.1"))(g=a.range.filter(function(c){return-1===c.identifier.toLowerCase().indexOf("field_1")&&!c.axis.some(function(e){return"band"===e.identifier.toLowerCase()})}))&&0<g.length&&(g.forEach(function(c){var e=c.axis.map(function(d){d={name:d.identifier.trim(),field:d.identifier.trim(),unit:d.valuesUnit?d.valuesUnit.trim():"",hasRegularIntervals:!1,values:d.values.map(function(k){return parseFloat(k.trim())})};d.extent=[Math.min.apply(null,d.values),Math.max.apply(null,d.values)];return d});
p.push({name:c.identifier.trim(),description:c.description?c.description.trim():"",unit:"",dimensions:e})}),0<p.length&&(b={variables:p}));else if(0===h.indexOf("2.0")&&(g=[],a.rangeType.forEach(function(c){g=g.concat(c.filter(function(e){return-1===e.name.toLowerCase().indexOf("band")}))}),g&&0<g.length)){var x=[];h=function(c){var e="";if(Math.abs(c-1/24)<1/24*.01){var d=1;e="Hours"}else.01>Math.abs(c-1)?(d=1,e="Days"):1>c?(d=Math.round(24*c),e="Hours"):27.99<c&&31.01>c?(d=1,e="Months"):12>Math.round(c/
30)?(d=12>Math.round(c/30),e="Months"):364.99<c&&366.01>c&&(d=1,e="Years");return{interval:d,intervalUnit:e}};var u=a.boundedBy,n,r;for(n=2;n<a.domainSet.axisLabels.length;n++){var t=(u.uomLabels&&u.uomLabels.length)>n?u.uomLabels[n]:"";t=(r=-1<a.domainSet.axisLabels[n].toLowerCase().indexOf("time")||"iso8601"===t.toLowerCase())?h(a.domainSet.offset[n]):{interval:a.domainSet.offset[n],intervalUnit:t};var f={name:a.domainSet.axisLabels[n].trim(),field:a.domainSet.axisLabels[n].trim(),unit:u.uomLabels&&
u.uomLabels.length>n?u.uomLabels[n].trim():"",hasRegularIntervals:!0};w.mixin(f,t);f.extent=r?[(new Date).setTime(864E5*(a.boundedBy.envelopeAllDims.mins[n]-25569)),(new Date).setTime(864E5*(a.boundedBy.envelopeAllDims.maxs[n]-25569))]:[u.envelopeAllDims.mins[n],u.envelopeAllDims.maxs[n]];x.push(f)}g.forEach(function(c){p.push({name:c.name.trim(),description:c.description.trim(),unit:c.uom.trim(),dimensions:x})});0<p.length&&(b={variables:p})}return b},_getBandInfo:function(a){var b,g,h=!1;switch(this.version){case "1.0.0":for(b=
0;b<a.length&&!h;b++)for(g=0;g<a[b].axis.length;g++)if("band"===a[b].axis[g].name.toLowerCase()){var p=a[b].axis[g].values;h=!0;break}break;case "1.1.0":case "1.1.1":case "1.1.2":for(b=0;b<a.length&&!h;b++)for(g=0;g<a[b].axis.length;g++)if("band"===a[b].axis[g].identifier.toLowerCase()){p=a[b].axis[g].values;h=!0;break}break;case "2.0.1":for(b=0;b<a[0].length;b++)-1<a[0][b].name.toLowerCase().indexOf("band")&&(p=p||[],p.push(a[0][b].name))}return p},_useLatLong:function(a){var b;for(b=0;b<this._REVERSED_LAT_LONG_RANGES.length;b++){var g=
this._REVERSED_LAT_LONG_RANGES[b];if(a>=g[0]&&a<=g[1]){var h=!0;break}}return h},_getTimeInfo:function(a){var b;switch(this.version){case "1.0.0":case "1.1.0":case "1.1.1":case "1.1.2":(a=(a.domainSet||a.domain).temporalDomain)&&(b=new D({timeExtent:[a.begin,a.end],interval:a.resolution,intervalUnit:a.unit}));break;case "2.0.1":var g=C(a.domainSet.axisLabels,function(h){return-1<h.toLowerCase().indexOf("time")});-1<g&&(b=new D({startTimeField:a.domainSet.axisLabels[g],timeExtent:[(new Date).setTime(864E5*
(a.boundedBy.envelopeAllDims.mins[g]-25569)),(new Date).setTime(864E5*(a.boundedBy.envelopeAllDims.maxs[g]-25569))]}))}return b},_parse100:function(a){var b={name:null,label:null,lonLatEnvelope:null,supportedFormats:null,supportedCRSs:null,domainSet:null,rangeSet:null,description:null,metadataLink:null,supportedInterpolations:null},g=a.childNodes.length,h=this._checkTagName,p=w.hitch(this,function(c){var e=this._getElementValues(c,"requestResponseCRSs").map(function(d){return d.split(":")[1]});c=
this._getElementValues(c,"nativeCRSs").map(function(d){return d.split(":")[1]});return{requestResponseCRSs:e,nativeCRSs:c}}),x=w.hitch(this,function(c){var e=this._getElementValues(c,"interpolationMethod"),d=c.getAttribute("default");return void 0!==d||null!==d?[d].concat(e.filter(function(k){return k.toLowerCase()!==d.toLowerCase()})):e}),u=w.hitch(this,function(c){var e=this._getElements(c,"pos");c=this._getElementValue(e[0]).split(" ");e=this._getElementValue(e[1]).split(" ");return new A({xmin:parseFloat(c[0]),
ymin:parseFloat(c[1]),xmax:parseFloat(e[0]),ymax:parseFloat(e[1]),spatialReference:{wkid:4326}})}),n=w.hitch(this,function(c){var e=[];c=this._getElements(c,"RangeSet");var d,k;for(d=0;d<c.length;d++){var m={};m.name=this._getElementValue(c[d],"name");m.label=this._getElementValue(c[d],"label");m.axis=[];var l=this._getElements(c[d],"AxisDescription");for(k=0;k<l.length;k++){var q={};q.name=this._getElementValue(l[k],"name");q.label=this._getElementValue(l[k],"label");var v=[];v=this._getElementValues(l[k],
"singleValue");if(0===v.length){var y=this._getElementValue(l[k],"min");var z=this._getElementValue(l[k],"max");if(null!==y&&null!==z)for(y=parseInt(y,10);y<=parseInt(z,10);y++)v.push(y)}q.values=v;m.axis.push(q)}e.push(m)}return e}),r=w.hitch(this,function(c){var e={},d={},k=this._getElement(c,"spatialDomain"),m=this._getElement(k,"Envelope")||this._getElement(k,"EnvelopeWithTimePeriod"),l=m.getAttribute("srsName").split(":");l=l[l.length-1];var q=this._getElements(m,"pos");m=this._getElementValue(q[0]).split(" ");
q=this._getElementValue(q[1]).split(" ");d.envelope=new A({xmin:parseFloat(m[0]),ymin:parseFloat(m[1]),xmax:parseFloat(q[0]),ymax:parseFloat(q[1]),spatialReference:{wkid:parseInt(l,10)}});l=this._getElement(k,"RectifiedGrid");m=this._getElementValue(l,"low").split(" ");q=this._getElementValue(l,"high").split(" ");l=parseInt(q[0],10)-parseInt(m[0],10)+1;m=parseInt(q[1],10)-parseInt(m[1],10)+1;q=this._getElementValue(k,"origin/pos").split(" ");var v=this._getElements(k,"offsetVector");k=parseFloat(this._getElementValue(v[0]).split(" ")[0]);
v=parseFloat(this._getElementValue(v[0]).split(" ")[1]);d.columns=l;d.rows=m;d.offset={x:k,y:v};d.origin={x:parseFloat(q[0]),y:parseFloat(q[1])};e.spatialDomain=d;d={begin:null,end:null};k=[];if(l=this._getElement(c,"temporalDomain")){c=this._getElements(l,"timeposition");if(0<c.length){for(l=0;l<c.length;l++)k.push(new Date(this._getElementValue(c[l])));d.begin=k[0];d.end=k[k.length-1];d.values=k}else if(c=this._getElement(l,"timePeriod"))d.begin=new Date(this._getElementValue(c,"beginPosition")),
d.end=new Date(this._getElementValue(c,"endPosition")),c=this._getElementValue(c,"timeResolution"),d=w.mixin(d,this._parseTimeResolution(c));e.temporalDomain=d}return e}),t;for(t=0;t<g;t++){var f=a.childNodes[t];h(f,"description")?b.description=this._getElementValue(f):h(f,"name")?b.name=this._getElementValue(f):h(f,"label")?b.label=this._getElementValue(f):h(f,"supportedFormats")?b.supportedFormats=this._getElementValues(f,"formats"):h(f,"supportedCRSs")?b.supportedCRSs=p(f):h(f,"supportedInterpolations")?
b.supportedInterpolations=x(f):h(f,"lonLatEnvelope")?b.lonLatEnvelope=u(f):h(f,"rangeSet")?b.rangeSet=n(f):h(f,"domainSet")&&(b.domainSet=r(f),b.resolution=b.domainSet.spatialDomain.offset)}return b},_parse110:function(a){var b={title:null,"abstract":null,identifier:null,supportedFormats:null,supportedCRSs:null,domain:null,range:null,metadata:null},g=a.childNodes.length,h=this._checkTagName,p=w.hitch(this,function(r){var t=[];r=this._getElements(r,"Field");var f,c;for(f=0;f<r.length;f++){var e={};
e.identifier=this._getElementValue(r[f],"Identifier");e.description=this._getElementValue(r[f],"Description");e.definition=this._getElementValue(r[f],"Definition");e.Abstract=this._getElementValue(r[f],"Abstract");e.Title=this._getElementValue(r[f],"Title");e.supportedInterpolations=this._getElementValues(r[f],"InterpolationMethod");e.axis=[];var d=this._getElements(r[f],"Axis");for(c=0;c<d.length;c++){var k={};k.identifier=d[c].getAttribute("identifier");k.valuesUnit=this._getElementValue(d[c],"valuesUnit");
k.dataType=this._getElementValue(d[c],"DataType");k.values=this._getElementValues(d[c],"Key");e.axis.push(k)}t.push(e)}return t}),x=w.hitch(this,function(r){var t={},f={},c=this._getElement(r,"SpatialDomain"),e=this._getElement(c,"GridCRS"),d=this._getElementValue(e,"GridBaseCRS"),k=this._getElementValue(e,"GridOrigin");k=k?k.split(" "):[0,0];e=this._getElementValue(e,"GridOffsets").split(" ");var m=this._getElements(c,"BoundingBox");for(c=0;c<m.length;c++)if("urn:ogc:def:crs:OGC::imageCRS"===m[c].getAttribute("crs")){var l=
this._getElementValue(m[c],"LowerCorner").split(" ");var q=this._getElementValue(m[c],"UpperCorner").split(" ");var v=parseInt(q[0],10)-parseInt(l[0],10)+1;var y=parseInt(q[1],10)-parseInt(l[1],10)+1}else if(0<m[c].getAttribute("crs").indexOf("EPSG")){var z=m[c].getAttribute("crs").split("::")[1];l=this._getElementValue(m[c],"LowerCorner").split(" ");q=this._getElementValue(m[c],"UpperCorner").split(" ");f.envelope=new A({xmin:parseFloat(l[0]),ymin:parseFloat(l[1]),xmax:parseFloat(q[0]),ymax:parseFloat(q[1]),
spatialReference:{wkid:parseInt(z,10)}})}c=v>y;m=f.envelope.xmax-f.envelope.xmin>f.envelope.ymax-f.envelope.ymin;this._useLatLong(z)&&(c===m?this._useEPSGAxis=!1:(this._useEPSGAxis=!0,f.envelope=new A({xmin:f.envelope.ymin,ymin:f.envelope.xmin,xmax:f.envelope.ymax,ymax:f.envelope.xmax,spatialReference:{wkid:parseInt(z,10)}})));f.columns=v;f.rows=y;f.origin={x:parseFloat(k[0]),y:parseFloat(k[1])};f.offset={x:parseFloat(e[0]),y:parseFloat(e[1])};f.gridBaseCRS=d;t.spatialDomain=f;f={begin:null,end:null};
d=[];if(k=this._getElement(r,"temporalDomain")){r=this._getElements(k,"timeposition");if(0<r.length){for(c=0;c<r.length;c++)d.push(new Date(this._getElementValue(r[c])));f.begin=d[0];f.end=d[d.length-1];f.values=d}else r=this._getElements(k,"timePeriod"),0<r.length&&(f.begin=new Date(this._getElementValue(r[0],"beginPosition")),f.end=new Date(this._getElementValue(r[0],"endPosition")),r=this._getElementValue(r[0],"timeResolution"),f=w.mixin(f,this._parseTimeResolution(r)));t.temporalDomain=f}return t}),
u;for(u=0;u<g;u++){var n=a.childNodes[u];h(n,"Title")?b.title=this._getElementValue(n):h(n,"Abstract")?b["abstract"]=this._getElementValue(n):h(n,"Identifier")?b.identifier=this._getElementValue(n):h(n,"SupportedFormat")?(b.supportedFormats||(b.supportedFormats=[]),b.supportedFormats.push(this._getElementValue(n))):h(n,"SupportedCRS")?(b.supportedCRSs||(b.supportedCRSs=[]),b.supportedCRSs.push(this._getElementValue(n))):h(n,"Range")?b.range=p(n):h(n,"Domain")&&(b.domain=x(n),b.resolution=b.domain.spatialDomain.offset)}return b},
_parse201:function(a){var b={coverageId:null,boundedBy:null,domainSet:null,rangeType:null,serviceParameters:null,coverageFunction:null,extension:null},g=a.childNodes.length,h=function(c){return parseFloat(c)},p=function(c){return parseInt(c,10)},x=this._checkTagName,u=w.hitch(this,function(c){var e={envelope:null,axisLabels:null,uomLabels:null,envelopeAllDims:null};c=this._getElement(c,"Envelope")||this._getElement(c,"EnvelopeWithTimePeriod");var d=c.getAttribute("srsName");d=d.slice(d.lastIndexOf("/")+
1);var k=c.getAttribute("axisLabels"),m=this._getElementValue(c,"lowerCorner").split(" ").map(h),l=this._getElementValue(c,"upperCorner").split(" ").map(h);"y lat latitude north nor n b".split(" ").some(function(q){return q===k[0].toLowerCase()})?e.envelope=new A({xmin:m[1],ymin:m[0],xmax:l[1],ymax:l[0],spatialReference:{wkid:parseInt(d,10)}}):e.envelope=new A({xmin:m[0],ymin:m[1],xmax:l[0],ymax:l[1],spatialReference:{wkid:parseInt(d,10)}});e.axisLabels=k;e.envelopeAllDims={mins:m,maxs:l};c=c.getAttribute("uomLabels").trim().split(" ");
e.uomLabels=c.length?c:null;return e}),n=w.hitch(this,function(c){var e=[];c=this._getElements(c,"DataRecord");var d,k,m,l=function(z){return z.map(function(G){return parseFloat(G)})};for(d=0;d<c.length;d++){var q=this._getElements(c[d],"field");var v=[];for(k=0;k<q.length;k++){var y={};y.name=q[k].getAttribute("name");y.description=this._getElementValue(q[k],"description")||"";y.uom=this._getElement(q[k],"uom").getAttribute("code")||"";if(m=this._getElementValue(q[k],"interval"))m=m.split(" "),y.allowedValues=
l(m);v.push(y)}e.push(v)}return e}),r=w.hitch(this,function(c){var e={},d=this._getElement(c,"RectifiedGrid"),k=this._getElementValue(d,"low").split(" ").map(p),m=this._getElementValue(d,"high").split(" ").map(p);c=[];var l;for(l=0;l<k.length;l++)c.push(m[l]-k[l]+1);var q=this._getElementValue(d,"axisLabels").split(" ");k=this._getElementValue(d,"origin/pos").split(" ").map(h);d=this._getElements(d,"offsetVector");m=[];for(l=0;l<d.length;l++)m.push(parseFloat(this._getElementValue(d[l]).split(" ")[l]));
"y lat latitude north nor n b".split(" ").some(function(v){return v===q[0].toLowerCase()})?(e.columns=c[1],e.rows=c[0],e._resolution={y:m[0],x:m[1]}):(e.columns=c[0],e.rows=c[1],e._resolution={x:m[0],y:m[1]});e.gridSamples=c;e.axisLabels=q;e.offset=m;e.origin=k;return e}),t;for(t=0;t<g;t++){var f=a.childNodes[t];x(f,"coverageId")?b.coverageId=this._getElementValue(f):x(f,"ServiceParameters")?b.serviceParameters={supportedFormats:this._getElementValues(f,"nativeFormat")}:x(f,"boundedBy")?b.boundedBy=
u(f):x(f,"rangeType")?b.rangeType=n(f):x(f,"domainSet")&&(b.domainSet=r(f),b.resolution=b.domainSet._resolution)}return b}});E("extend-esri")&&w.setObject("layers.WCSCoverageDescription",B,F);return B});