// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/WMSLayerInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","../kernel"],function(v,r,w,t,m){v=v(null,{declaredClass:"esri.layers.WMSLayerInfo",name:null,title:null,description:null,extent:null,legendURL:null,subLayers:[],allExtents:[],spatialReferences:[],queryable:!1,showPopup:!1,constructor:function(l){l&&(this.name=l.name,this.title=l.title,this.description=l.description,this.extent=l.extent,this.legendURL=l.legendURL,this.subLayers=
l.subLayers?l.subLayers:[],this.allExtents=l.allExtents?l.allExtents:[],this.spatialReferences=l.spatialReferences?l.spatialReferences:[],this.queryable=!!l.queryable,this.showPopup=!!l.showPopup)},clone:function(){var l={name:this.name,title:this.title,description:this.description,legendURL:this.legendURL};this.extent&&(l.extent=this.extent.getExtent());l.subLayers=[];w.forEach(this.subLayers,function(z){l.subLayers.push(z.clone())});l.allExtents=[];for(x in this.allExtents){var x=parseInt(x,10);
isNaN(x)||(l.allExtents[x]=this.allExtents[x].getExtent())}l.spatialReferences=[];w.forEach(this.spatialReferences,function(z){l.spatialReferences.push(z)});l.queryable=this.queryable;l.showPopup=this.showPopup;return l}});t("extend-esri")&&r.setObject("layers.WMSLayerInfo",v,m);return v})},"*noref":1}});
define("esri/layers/WMSLayer","require dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/sniff ../config ../graphic ../kernel ../request ../urlUtils ../dijit/PopupTemplate ../SpatialReference ../geometry/Extent ../geometry/Point ./DynamicMapServiceLayer ./WMSLayerInfo dojo/query".split(" "),function(v,r,w,t,m,l,x,z,E,C,A,F,B,y,H,D,G){w=w([D],{declaredClass:"esri.layers.WMSLayer",_CRS_TO_EPSG:{84:4326,83:4269,27:4267},_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,
2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,
27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],_WEB_MERCATOR:[102100,3857,102113,900913],_WORLD_MERCATOR:[3395,54004],allExtents:[],version:null,constructor:function(a,b){var c=A.urlToObject(a);c.query&&(c.query.version||c.query.Version||c.query.VERSION)&&(this.version=c.query.version||c.query.Version||c.query.VERSION);this.url=a=this._stripParameters(a,"version service request bbox format height width layers srs crs styles transparent bgcolor exceptions time elevation sld wfs".split(" "));
this._url=A.urlToObject(a);this._getCapabilitiesURL=a;this._initLayer=t.hitch(this,this._initLayer);this._parseCapabilities=t.hitch(this,this._parseCapabilities);this._getCapabilitiesError=t.hitch(this,this._getCapabilitiesError);b?(this.customParameters=b.customParameters,this.customLayerParameters=b.customLayerParameters,this.imageFormat=this._getImageFormat(b.format),this.imageTransparency=!1!==b.transparent,this.visibleLayers=b.visibleLayers?b.visibleLayers:[],this.version=b.version||this.version,
b.resourceInfo?this._readResourceInfo(b.resourceInfo):this._getCapabilities()):(this.imageFormat="image/png",this.imageTransparency=!0,this.visibleLayers=[],this._getCapabilities());this._blankImageURL=v.toUrl("../images/pixel.png");this.extentProcessor=this._createExtentProcessor(0);this._createChildLayer()},setVisibleLayers:function(a){this.visibleLayers=(a=this._checkVisibleLayersList(a))?a:[];this.refresh(!0)},setImageFormat:function(a){this.imageFormat=this._getImageFormat(a);this.refresh(!0)},
setImageTransparency:function(a){this.imageTransparency=a;this.refresh(!0)},setCustomParameters:function(a,b){this.customParameters=a;this.customLayerParameters=b;this.refresh(!0)},refresh:function(){this._refreshTS=Date.now();this.inherited(arguments);this._childLayer&&this._childLayer.refresh.apply(this._childLayer,arguments)},getImageUrl:function(a,b,c,d){if(this.visibleLayers&&0!==this.visibleLayers.length){a=this._getImageParams(a,b,c);a=this._mixinCustomLayerParameters(a);b=this.getMapURL;var g;
b+=-1===b.indexOf("?")?"?":"";for(g in a)a.hasOwnProperty(g)&&(b+="?"===b.substring(b.length-1,b.length)?"":"\x26",b+=g+"\x3d"+a[g]);b=this.addTimestampToURL(b);d(A.addProxy(b))}else d(this._blankImageURL)},_setMap:function(a,b,c){var d=this.inherited(arguments);a.wrapAround180?this._childLayer&&(this.suspended&&this._childLayer.suspend(),this._childLayer._setMap(a,d)):this._childLayer=this.extentProcessor=null;return d},_unsetMap:function(a,b){this._childLayer&&this._childLayer._unsetMap(a,this._div);
this.inherited(arguments)},onSuspend:function(){this.inherited(arguments);this._childLayer&&this._childLayer.suspend()},onResume:function(){this.inherited(arguments);this._childLayer&&this._childLayer.resume()},_createChildLayer:function(){this._childLayer=new D(null,{extentProcessor:this._createExtentProcessor(1)});this._childLayer._isChildLayer=!0;this._childLayer.getImageUrl=t.hitch(this,this.getImageUrl);this._childLayer.loaded=!0},_createExtentProcessor:function(a){return t.hitch(this,this._extentProcessor,
a)},_extentProcessor:function(a,b){var c=b.extent,d=b.width,g=0;if(c){b=c.getWidth()/d;var n=c.bisect();c=n.extents;var e=c[a];e&&(d=n.marginLeft/b,g=0===a?d:d+c[0].getWidth()/b,d=Math.ceil(e.getWidth()/b),g=Math.ceil(g));c=e}return{extent:c,width:d,marginLeft:g}},_getImageParams:function(a,b,c){var d=a.spatialReference.wkid;-1===m.indexOf(this.spatialReferences,d)&&a.spatialReference.latestWkid&&(d=a.spatialReference.latestWkid);if(m.some(this._WEB_MERCATOR,function(k){return k==d})){var g=m.filter(this.spatialReferences,
function(k){return m.some(this._WEB_MERCATOR,function(f){return f==k})},this);0===g.length&&(g=m.filter(this.spatialReferences,function(k){return m.some(this._WORLD_MERCATOR,function(f){return f==k})},this));d=0<g.length?g[0]:this._WEB_MERCATOR[1]}this.spatialReferences=m.filter(this.spatialReferences,function(k){return k!==d});this.spatialReferences.unshift(d);g=a.xmin;var n=a.xmax,e=a.ymin;a=a.ymax;var h={SERVICE:"WMS",REQUEST:"GetMap"};h.FORMAT=this.imageFormat;h.TRANSPARENT=this.imageTransparency?
"TRUE":"FALSE";h.STYLES="";h.VERSION=this.version;h.LAYERS=this.visibleLayers?this.visibleLayers.toString():null;h.WIDTH=b;h.HEIGHT=c;this.maxWidth<b&&(h.WIDTH=this.maxWidth);this.maxHeight<c&&(h.HEIGHT=this.maxHeight);b=d?d:NaN;isNaN(b)||("1.3.0"==this.version?h.CRS="EPSG:"+b:h.SRS="EPSG:"+b);"1.3.0"==this.version&&this._useLatLong(b)?h.BBOX=e+","+g+","+a+","+n:h.BBOX=g+","+e+","+n+","+a;return h},_initLayer:function(a,b){this.spatialReference=new B(this.extent.spatialReference);this.initialExtent=
new y(this.extent);this.fullExtent=new y(this.extent);this.visibleLayers=this._checkVisibleLayersList(this.visibleLayers);var c=t.hitch(this,function(){this.loaded=!0;this.onLoad(this);var d=this._loadCallback;d&&(delete this._loadCallback,d(this))});l("chrome")?(a=x.defaults.io,b="with-credentials"===a.useCors?A.canUseXhr(this.getMapURL,!0):-1,(a=-1<b?a.corsEnabledServers[b]:null)&&a.withCredentials?C({url:this.getMapURL,handleAs:"text",content:{SERVICE:"WMS",REQUEST:"GetMap"}}).addBoth(function(){c()}):
c()):c()},_readResourceInfo:function(a){a.extent?a.layerInfos?(this.extent=a.extent,this.allExtents[0]=a.extent,this.layerInfos=a.layerInfos,this.description=a.description?a.description:"",this.copyright=a.copyright?a.copyright:"",this.title=a.title?a.title:"",this.getMapURL=a.getMapURL?a.getMapURL:this._getCapabilitiesURL,this.getFeatureInfoURL=a.getFeatureInfoURL,this.featureInfoFormat=a.featureInfoFormat,this.version=a.version?a.version:"1.3.0",this.maxWidth=a.maxWidth?a.maxWidth:5E3,this.maxHeight=
a.maxHeight?a.maxHeight:5E3,this.spatialReferences=a.spatialReferences?a.spatialReferences:[],this.imageFormat=this._getImageFormat(a.format),this.setScaleRange(a.minScale,a.maxScale),this.customLayerParameters=a.customLayerParameters||this.customLayerParameters,this.customParameters=a.customParameters||this.customParameters,this._initLayer()):this._errorHandler(Error("esri.layers.WMSLayer: unable to find the 'layerInfos' property in resourceInfo")):this._errorHandler(Error("esri.layers.WMSLayer: Unable to find the 'extent' property in resourceInfo."))},
_getCapabilities:function(a){var b=this._url.query?this._url.query:{};b.SERVICE="WMS";b.REQUEST="GetCapabilities";this.version&&(b.VERSION=this.version);b=this._mixinCustomParameters(b);var c=this._url.path+"?",d;for(d in b)b.hasOwnProperty(d)&&(c+="?"==c.substring(c.length-1,c.length)?"":"\x26",c+=d+"\x3d"+b[d]);C({url:c,handleAs:a||"xml",headers:{"Content-Type":null},load:this._parseCapabilities,error:this._getCapabilitiesError},{usePost:!1})},_parseCapabilities:function(a,b){if(a){if("text"===
b.handleAs){try{var c=(new DOMParser).parseFromString(a,"application/xml")}catch(f){}c&&!c.getElementsByTagName("parsererror").length||this._errorHandler(Error("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (XML Parse error.)"))}else c=a;var d=this;this.version=this._getAttributeValue("WMS_Capabilities","version",c,null);this.version||(this.version=this._getAttributeValue("WMT_MS_Capabilities","version",c,"1.3.0"));a=this._getTag("Service",c);this.title=this._getTagValue("Title",
a,"");this.title||(this.title=this._getTagValue("Name",a,""));this.copyright=this._getTagValue("AccessConstraints",a,"");this.description=this._getTagValue("Abstract",a,"");this.maxWidth=parseInt(this._getTagValue("MaxWidth",a,5E3),10);this.maxHeight=parseInt(this._getTagValue("MaxHeight",a,5E3),10);if(a=this._getTag("Layer",c)){var g=this._getLayerInfo(a),n=0,e=null;a=this._getTag("Capability",c);m.forEach(a.childNodes,function(f){"Layer"==f.nodeName&&(0===n?e=f:(1===n&&g.name&&(g.name="",g.subLayers=
[],g.subLayers.push(this._getLayerInfo(e))),g.subLayers.push(this._getLayerInfo(f))),n++)},this);if(g&&(this.layerInfos=g.subLayers,this.layerInfos&&0!==this.layerInfos.length||(this.layerInfos=[g]),this.extent=g.extent,this.extent||(g.extent=new y(this.layerInfos[0].extent.toJson()),this.extent=g.extent),this.allExtents=g.allExtents,this.allExtents&&this.allExtents.length||(g.allExtents=[],m.forEach(this.layerInfos[0].allExtents,function(f,p){f&&(g.allExtents[p]=new y(f.toJson()))}),this.allExtents=
g.allExtents),this.spatialReferences=g.spatialReferences,!this.spatialReferences.length&&0<this.layerInfos.length)){var h=function(f){var p;for(p=0;p<f.subLayers.length;p++){var q=f.subLayers[p],u=q.spatialReferences;!u.length&&q.subLayers&&0<q.subLayers.length&&(u=h(q));if(u.length)return u}return[]};for(a=0;a<this.layerInfos.length&&(b=this.layerInfos[a],this.spatialReferences=this.layerInfos[0].spatialReferences,!this.spatialReferences.length&&b.subLayers&&0<b.subLayers.length&&(this.spatialReferences=
h(b)),!this.spatialReferences.length);a++);}a=function(f){return(f=r.query("DCPType",d._getTag(f,c)))&&0<f.length&&(f=r.query("HTTP",f[0]))&&0<f.length&&(f=r.query("Get",f[0]))&&0<f.length&&(f=d._getAttributeValue("OnlineResource","xlink:href",f[0],null))?(f.indexOf("\x26")===f.length-1&&(f=f.substring(0,f.length-1)),d._stripParameters(f,["service","request"])):null};b=function(f){var p=[];0===r.query("Operation",c).length?m.forEach(r.query("Format",d._getTag(f,c)),function(q){p.push(q.text?q.text:
q.textContent)}):(m.forEach(r.query("Operation",c),function(q){q.getAttribute("name")===f&&m.forEach(r.query("Format",q),function(u){p.push(u.text?u.text:u.textContent)})}),p.length||m.forEach(r.query("Format",d._getTag(f,c)),function(q){p.push(q.text?q.text:q.textContent)}));return p};this.getMapURL=a("GetMap")||this._getCapabilitiesURL;this.getMapFormats=b("GetMap");this.getMapFormats.length&&!m.some(this.getMapFormats,function(f){return-1<f.indexOf(this.imageFormat)},this)&&(this.imageFormat=this.getMapFormats[0]);
if(this.getFeatureInfoURL=a("GetFeatureInfo"))this.getFeatureInfoFormats=b("GetFeatureInfo"),-1<m.indexOf(this.getFeatureInfoFormats,"text/html")?this.featureInfoFormat="text/html":-1<m.indexOf(this.getFeatureInfoFormats,"text/plain")&&(this.featureInfoFormat="text/plain");if(!this.featureInfoFormat){var k=function(f){if(f&&(f.queryable=!1,f.subLayers))for(var p=0;p<f.subLayers.length;p++)k(f.subLayers[p])};k(g)}this._initLayer()}else this._errorHandler(Error("esri.layers.WMSLayer: Response does not contain any layers."))}else"xml"===
b.handleAs?this._getCapabilities("text"):this._errorHandler(Error("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (Response is null.)"))},_getCapabilitiesError:function(a){a&&a.message&&(a.message="GetCapabilities request for "+this._getCapabilitiesURL+" failed. ("+a.message+")");this._errorHandler(a)},_getLayerInfo:function(a){if(!a)return null;var b=new G;b.name="";b.title="";b.description="";b.allExtents=[];b.spatialReferences=[];b.queryable="1"===a.getAttribute("queryable");
b.subLayers=[];var c=this._getTag("LatLonBoundingBox",a);c&&(b.allExtents[0]=this._getExtent(c,4326));var d=this._getTag("EX_GeographicBoundingBox",a);if(d){var g=new y(0,0,0,0,new B({wkid:4326}));g.xmin=parseFloat(this._getTagValue("westBoundLongitude",d,0));g.ymin=parseFloat(this._getTagValue("southBoundLatitude",d,0));g.xmax=parseFloat(this._getTagValue("eastBoundLongitude",d,0));g.ymax=parseFloat(this._getTagValue("northBoundLatitude",d,0));b.allExtents[0]=g}c||d||(g=new y(-180,-90,180,90,new B({wkid:4326})),
b.allExtents[0]=g);b.extent=b.allExtents[0];var n=-1<m.indexOf(["1.0.0","1.1.0","1.1.1"],this.version)?"SRS":"CRS";m.forEach(a.childNodes,function(e){if("Name"==e.nodeName)b.name=(e.text?e.text:e.textContent)||"";else if("Title"==e.nodeName)b.title=(e.text?e.text:e.textContent)||"";else if("Abstract"==e.nodeName)b.description=(e.text?e.text:e.textContent)||"";else if("BoundingBox"==e.nodeName){var h=e.getAttribute(n);h&&0===h.indexOf("EPSG:")?(h=parseInt(h.substring(5),10),0===h||isNaN(h)||(e="1.3.0"==
this.version?this._getExtent(e,h,this._useLatLong(h)):this._getExtent(e,h),b.allExtents[h]=e,b.extent||(b.extent=e))):h&&0===h.indexOf("CRS:")?(h=parseInt(h.substring(4),10),0===h||isNaN(h)||(this._CRS_TO_EPSG[h]&&(h=this._CRS_TO_EPSG[h]),b.allExtents[h]=this._getExtent(e,h))):(h=parseInt(h,10),0===h||isNaN(h)||(b.allExtents[h]=this._getExtent(e,h)))}else if(e.nodeName==n)e=(e.text?e.text:e.textContent).split(" "),m.forEach(e,function(k){k=-1<k.indexOf(":")?parseInt(k.split(":")[1],10):parseInt(k,
10);0===k||isNaN(k)||(this._CRS_TO_EPSG[k]&&(k=this._CRS_TO_EPSG[k]),-1==m.indexOf(b.spatialReferences,k)&&b.spatialReferences.push(k))},this);else if("Style"!=e.nodeName||b.legendURL)"Layer"===e.nodeName&&b.subLayers.push(this._getLayerInfo(e));else if(e=this._getTag("LegendURL",e))if(e=this._getTag("OnlineResource",e))b.legendURL=e.getAttribute("xlink:href")},this);b.title=b.title||b.name;return b},_getImageFormat:function(a){switch(a?a.toLowerCase():""){case "jpg":return"image/jpeg";case "bmp":return"image/bmp";
case "gif":return"image/gif";case "svg":return"image/svg+xml";default:return"image/png"}},getImageFormat:function(){switch(this.imageFormat?this.imageFormat.toLowerCase():""){case "image/jpeg":return"jpg";case "image/bmp":return"bmp";case "image/gif":return"gif";case "image/svg+xml":return"svg";default:return"png"}},_getExtent:function(a,b,c){if(a){var d=new y;var g=parseFloat(a.getAttribute("minx")),n=parseFloat(a.getAttribute("miny")),e=parseFloat(a.getAttribute("maxx"));a=parseFloat(a.getAttribute("maxy"));
c?(d.xmin=isNaN(n)?-1*Number.MAX_VALUE:n,d.ymin=isNaN(g)?-1*Number.MAX_VALUE:g,d.xmax=isNaN(a)?Number.MAX_VALUE:a,d.ymax=isNaN(e)?Number.MAX_VALUE:e):(d.xmin=isNaN(g)?-1*Number.MAX_VALUE:g,d.ymin=isNaN(n)?-1*Number.MAX_VALUE:n,d.xmax=isNaN(e)?Number.MAX_VALUE:e,d.ymax=isNaN(a)?Number.MAX_VALUE:a);d.spatialReference=new B({wkid:b})}return d},_useLatLong:function(a){var b;for(b=0;b<this._REVERSED_LAT_LONG_RANGES.length;b++){var c=this._REVERSED_LAT_LONG_RANGES[b];if(a>=c[0]&&a<=c[1]){var d=!0;break}}return d},
_getTag:function(a,b){return(a=r.query(a,b))&&0<a.length?a[0]:null},_getTagValue:function(a,b,c){return(a=r.query(a,b))&&0<a.length?a[0].text?a[0].text:a[0].textContent:c},_getAttributeValue:function(a,b,c,d){return(a=r.query(a,c))&&0<a.length?a[0].getAttribute(b):d},_checkVisibleLayersList:function(a){if(a&&0<a.length&&this.layerInfos&&0<this.layerInfos.length&&"number"==typeof a[0]){var b=[];m.forEach(a,function(c){c<this.layerInfos.length&&b.push(this.layerInfos[c].name)},this);a=b}return a},_stripParameters:function(a,
b){a=A.urlToObject(a);var c,d=[];for(c in a.query)a.query.hasOwnProperty(c)&&-1===m.indexOf(b,c.toLowerCase())&&d.push(c+"\x3d"+a.query[c]);return a.path+(d.length?"?"+d.join("\x26"):"")},_getPopupGraphic:function(a,b){var c=this.visibleLayers;if(!c||0===c.length)return null;var d=this._popupGraphic;d||(d=new F({title:this.title||""}),d.setContent(function(k){var f=document.createElement("div");if(k=k&&k.attributes&&k.attributes.QUERY_URL)f.style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%;",
f.innerHTML='\x3ciframe sandbox src\x3d"'+k+'" width\x3d"250" height\x3d"147" frameborder\x3d"0" marginwidth\x3d"0" marginheight\x3d"0" style\x3d"position:absolute;top:0;left:0;width:100%;height:100%;border:0;background:url(\''+v.toUrl("../dijit/images/loading-throb.gif")+"') transparent center no-repeat;\" onload\x3d\"(event.target || event.srcElement).style.background \x3d 'none';\"\x3e\x3c/iframe\x3e";return f}),d=this._popupGraphic=new z(null,null,{},d),d._layer=this);var g=function(k){var f=
[];if(k&&(k.queryable&&k.showPopup&&k.name&&f.push(k.name),k.subLayers))for(var p=0;p<k.subLayers.length;p++){var q=g(k.subLayers[p]);q.length&&(f=f.concat(q))}return f},n=g({subLayers:this.layerInfos});n=m.filter(n,function(k){return-1<m.indexOf(c,k)});if(n.length){var e=this.getFeatureInfoURL;a=this._getImageParams(a.extent,a.width,a.height);a=this._mixinCustomLayerParameters(a);a.REQUEST="GetFeatureInfo";a.INFO_FORMAT=this.featureInfoFormat;a.QUERY_LAYERS=n.join();a.FEATURE_COUNT=25;"1.3.0"===
this.version?(a.I=Math.round(b.x),a.J=Math.round(b.y)):(a.X=Math.round(b.x),a.Y=Math.round(b.y));e+=-1===e.indexOf("?")?"?":"";for(var h in a)a.hasOwnProperty(h)&&(e+="?"===e.substring(e.length-1,e.length)?"":"\x26",e+=h+"\x3d"+a[h]);d.attributes.QUERY_URL=e;return d}return null},_mixinCustomParameters:function(a){if(this.customParameters)for(var b in this.customParameters)a[b]=encodeURIComponent(this.customParameters[b]);return a},_mixinCustomLayerParameters:function(a){if(this.customLayerParameters||
this.customParameters){var b=t.clone(this.customParameters||{});t.mixin(b,this.customLayerParameters||{});for(var c in b)"styles"===c.toLowerCase()&&delete a.STYLES,a[c]=encodeURIComponent(b[c])}return a}});l("extend-esri")&&t.setObject("layers.WMSLayer",w,E);return w});