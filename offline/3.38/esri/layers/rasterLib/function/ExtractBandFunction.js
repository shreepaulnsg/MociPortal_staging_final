// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/rasterLib/function/ExtractBandFunction","dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(l,k,m,q,n,p){return l([m,p],{declaredClass:"esri.layers.rasterLib.function.ExtractBandFunction",functionName:"ExtractBand",supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({bandIDs:[],missingBandAction:0,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);
if(!a.raster)return Error("The raster input to extract band function is invalid.");var b=[],c=a.raster.statistics,e=[],f=a.raster.histograms,h=this.functionArguments.bandIDs.length||a.raster.bandCount;this.functionArguments.bandIDs.forEach(k.hitch(this,function(d){if(d>=h-1){if(1===this.functionArguments.missingBandAction)return Error("missing band "+d);d=h-1}if(0>d)return Error("missing band "+d);void 0!==c&&null!==c&&0<c.length&&b.push(c[d]);void 0!==f&&null!==f&&0<f.length&&e.push(f[d])}));this.rasterInfo=
k.mixin(a.raster,{bandCount:h,pixelType:this._calculatePixelType(this.pixelType,a.raster.pixelType),statistics:b,histograms:e});return!0},read2D:function(a){a=this._clonePixelData(a.raster);if(null!==a&&null!==a.pixelBlock&&null!==a.pixelBlock.pixels){this._performance.start();var b=a.pixelBlock,c=b.statistics,e=b.pixels,f=e.length;if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(0===this.functionArguments.bandIDs.length)return a;var h=[],d=[];this.functionArguments.bandIDs.forEach(function(g){if(g>=
f-1){if(1===this.functionArguments.missingBandAction)throw"missing band "+g;g=f-1}if(0>g)throw"missing band "+g;h.push(e[g]);void 0!==c&&null!==c&&0<c.length&&d.push(c[g])});b.pixels=h;b.statistics=d;b.planes=this.functionArguments.bandIDs.length;return a}},readGL:function(a){this._performance.start();if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(3<this.functionArguments.bandIDs.length)throw"this version does not support more than 3 bands yet";this._initializeProgram({fragment:n.extractBand,
fragmentName:"ExtractBand"});var b=this.functionArguments.bandIDs;1===b.length&&(b=[b[0],b[0],b[0]]);this._bandIDs=b;this._alterBand=!(0===this.functionArguments.bandIDs.length||0===b[0]&&1===b[1]&&2===b[2]);var c=!!(this._alterBand&&a.raster&&a.raster.texture);a=this._setupTextureData(a.raster,{bandIDs:b});var e=this.bindFrameBuffer();c?this._setUniforms({u_bandIDs:b,u_alterBand:this._alterBand}):this._setUniforms({u_bandIDs:b,u_alterBand:!1});this._bindTexture(a.texture,"u_image");this._drawGL();
this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,texture:e.texture}}})});