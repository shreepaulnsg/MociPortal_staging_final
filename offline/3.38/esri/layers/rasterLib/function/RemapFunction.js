// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/rasterLib/function/RemapFunction","dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(k,l,r,m,n,p,q){return k([m,p],{declaredClass:"esri.layers.rasterLib.function.RemapFunction",functionName:"Remap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(a){this.functionArguments=this.mixinIgnoreCase({inputRanges:null,outputValues:null,
outputColors:null,colorBreaks:null,raster:null},a)},bind:function(a){a=this.getSourceRasterInfo(a);if(!a.raster)return Error("The raster input is not available.");var b=!(!this.functionArguments.outputColors&&!this.functionArguments.colorBreaks);this.rasterInfo=l.mixin(a.raster,{bandCount:b?3:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=b?"Processed":
"Thematic";return!0},read2D:function(a){return this._remap(a.raster)},readGL:function(a){return this._remapGL(a.raster)},_remap:function(a){this._performance.start();var b=q.remapColor(a.pixelBlock,this.functionArguments.colorBreaks);this._addPerformanceMetric(this._performance.elapsed());return{extent:a.extent,pixelBlock:b}},_remapGL:function(a){this._performance.start();this._initializeProgram({fragment:n.remap,fragmentName:"Remap"});var b=new Uint8Array(64),e=this.functionArguments.colorBreaks;
e.forEach(function(c,h){b[4*h]=c.mappedColor[0];b[4*h+1]=c.mappedColor[1];b[4*h+2]=c.mappedColor[2];b[4*h+3]=1>=c.mappedColor[3]?255*c.mappedColor[3]:c.mappedColor[3]});var g=e[e.length-1],f=g.mappedColor;b[60]=f[0];b[61]=f[1];b[62]=f[2];b[63]=1>=f[3]?255*f[3]:f[3];var d=new Float32Array(16);e.forEach(function(c,h){d[h]=c.value});d[15]=g.value;this._clrTexture||(this._clrTexture=this._setupColormapTexture(b));e=this._clrTexture;g=this.bindFrameBuffer();a=this._setupTextureData(a);this._setUniforms({u_indexedColormapOffset:0,
u_indexedColormapMaxIndex:b.length/4-1,u_breaks:d});this._bindTexture(e,"u_image1");this._bindTexture(a.texture,"u_image");this._drawGL();return{extent:a.extent,texture:g.texture}},_setupColormapTexture:function(a){var b=this._createTexture(),e=a.length/4,g=new Float32Array(a.length),f=this.renderTexture?255:1,d,c=this.gl;for(d=0;d<a.length;d++)g[d]=a[d]/f;c.getExtension("OES_texture_float");c.texImage2D(c.TEXTURE_2D,0,c.RGBA,e,1,0,c.RGBA,c.FLOAT,g);return b}})});