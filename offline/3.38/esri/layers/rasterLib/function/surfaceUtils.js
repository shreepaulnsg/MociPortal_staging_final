// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/rasterLib/function/surfaceUtils",["dojo/_base/lang"],function(J){return{hillshade:function(p,a){if(null!==p&&null!==p.pixelBlock&&null!==p.pixelBlock.pixels){var g=this._clonePixelBlock(p.pixelBlock),n=a.altitude,b=a.azimuth,c=a.zFactor,w=a.psPower,q=a.psFactor,A=a.hillshadeType,k=a.slopeType,h=a.isGCS;1===A&&(c*=2);a=g.width;var f=g.height,d=g.pixels[0],l=g.mask,r=new Uint8Array(a*f);l&&r.set(l);var u=new Uint8Array(a*f),e=(p.extent.xmax-p.extent.xmin)/a,v=(p.extent.ymax-p.extent.ymin)/
f,x=c/(8*e),y=c/(8*v);.001<c&&h&&(x/=111E3,y/=111E3);3===k&&(h?(x=111E3*e,y=111E3*v,x=(c+Math.pow(x,w)*q)/(8*x),y=(c+Math.pow(y,w)*q)/(8*y)):(x=(c+Math.pow(e,w)*q)/(8*e),y=(c+Math.pow(v,w)*q)/(8*v)));h=(90-n)*Math.PI/180;n=Math.cos(h);var t=(360-b+90)*Math.PI/180;b=Math.sin(h)*Math.cos(t);h=Math.sin(h)*Math.sin(t);c=[];w=[];q=[];e=[315,270,225,360,180,0];var m=[60,60,60,60,60,90];k=[3,5,3,2,1,4];var L=k.reduce(function(F,K){return F+K});v=k.map(function(F){return F/L});if(1===A){var I=e.length;for(k=
0;k<I;k++)n=m[k],b=e[k],h=(90-n)*Math.PI/180,n=Math.cos(h),t=(360-b+90)*Math.PI/180,b=Math.sin(h)*Math.cos(t),h=Math.sin(h)*Math.sin(t),c.push(n),w.push(b),q.push(h)}var C=0;for(k=1;k<f-1;k++)for(m=k*a,e=1;e<a-1;e++)if(l&&!l[m+e])u[m+e]=0;else{t=0;if(l&&(t=l[m-a+e-1]+l[m-a+e]+l[m-a+e+1]+l[m+e-1]+l[m+e+1]+l[m+a+e-1]+l[m+a+e]+l[m+a+e+1],7>t)){u[m+e]=0;r[m+e]=0;continue}if(7===t){var B=l[m-a+e-1]?d[m-a+e-1]:d[m+e];var D=l[m-a+e]?d[m-a+e]:d[m+e];var E=l[m-a+e+1]?d[m-a+e+1]:d[m+e];t=l[m+e-1]?d[m+e-1]:
d[m+e];var G=l[m+e+1]?d[m+e+1]:d[m+e];C=l[m+a+e-1]?d[m+a+e-1]:d[m+e];var z=l[m+a+e]?d[m+a+e]:d[m+e];var H=l[m+a+e+1]?d[m+a+e+1]:d[m+e]}else B=d[m-a+e-1],D=d[m-a+e],E=d[m-a+e+1],t=d[m+e-1],G=d[m+e+1],C=d[m+a+e-1],z=d[m+a+e],H=d[m+a+e+1];t=(E+G+G+H-(B+t+t+C))*x;D=(C+z+z+H-(B+D+D+E))*y;E=Math.sqrt(1+t*t+D*D);C=0;if(0===A)z=h*D-b*t,z=255*(n+z)/E,0>z&&(z=0),C=z;else if(1===A)for(B=0;B<I;B++)z=q[B]*D-w[B]*t,z=255*(c[B]+z)/E,0>z&&(z=0),C+=z*v[B];u[m+e]=C}for(k=0;k<f;k++)u[k*a]=u[k*a+1],u[(k+1)*a-1]=u[(k+
1)*a-2];for(k=1;k<a-1;k++)u[k]=u[k+a],u[k+(f-1)*a]=u[k+(f-2)*a];g.pixelType="U8";g.pixels=[u];g.statistics=[{minValue:0,maxValue:255}];l&&(g.mask=r);return{extent:p.extent,pixelBlock:g}}},slope:function(p,a){if(null!==p&&null!==p.pixelBlock&&null!==p.pixelBlock.pixels){var g=this._clonePixelBlock(p.pixelBlock),n=a.zFactor,b=a.psPower,c=a.psFactor,w=a.slopeType,q=a.isGCS;a=g.width;var A=g.height,k=g.pixels[0],h=g.mask,f=new Uint8Array(a*A);h&&f.set(h);var d=new Float32Array(a*A),l=(p.extent.xmax-p.extent.xmin)/
a,r=(p.extent.ymax-p.extent.ymin)/A,u=n/(8*l),e=n/(8*r);1E-4>Math.abs(n-1)&&q&&(u/=111E3,e/=111E3);3===w&&(q?(u=111E3*l,e=111E3*r,u=(n+Math.pow(u,b)*c)/(8*u),e=(n+Math.pow(e,b)*c)/(8*e)):(u=(n+Math.pow(l,b)*c)/(8*l),e=(n+Math.pow(r,b)*c)/(8*r)));for(n=1;n<A-1;n++)for(c=n*a,b=1;b<a-1;b++)if(h&&!h[c+b])d[c+b]=0;else{r=0;if(h&&(r=h[c-a+b-1]+h[c-a+b]+h[c-a+b+1]+h[c+b-1]+h[c+b+1]+h[c+a+b-1]+h[c+a+b]+h[c+a+b+1],7>r)){d[c+b]=0;f[c+b]=0;continue}if(7===r){r=h[c-a+b-1]?k[c-a+b-1]:k[c+b];q=h[c-a+b]?k[c-a+b]:
k[c+b];l=h[c-a+b+1]?k[c-a+b+1]:k[c+b];var v=h[c+b-1]?k[c+b-1]:k[c+b];var x=h[c+b+1]?k[c+b+1]:k[c+b];var y=h[c+a+b-1]?k[c+a+b-1]:k[c+b];var t=h[c+a+b]?k[c+a+b]:k[c+b];var m=h[c+a+b+1]?k[c+a+b+1]:k[c+b]}else r=k[c-a+b-1],q=k[c-a+b],l=k[c-a+b+1],v=k[c+b-1],x=k[c+b+1],y=k[c+a+b-1],t=k[c+a+b],m=k[c+a+b+1];v=(l+x+x+m-(r+v+v+y))*u;r=(y+t+t+m-(r+q+q+l))*e;r=Math.sqrt(v*v+r*r);d[c+b]=1===w||3===w?57.2957795*Math.atan(r):100*r}for(n=0;n<A;n++)d[n*a]=d[n*a+1],d[(n+1)*a-1]=d[(n+1)*a-2];for(n=1;n<a-1;n++)d[n]=
d[n+a],d[n+(A-1)*a]=d[n+(A-2)*a];g.pixelType="F32";g.pixels=[d];g.statistics=[{minValue:0,maxValue:255}];h&&(g.mask=f);return{extent:p.extent,pixelBlock:g}}},aspect:function(p){if(null!==p&&null!==p.pixelBlock&&null!==p.pixelBlock.pixels){var a=this._clonePixelBlock(p.pixelBlock),g=a.width,n=a.height,b=a.pixels[0],c=a.mask,w=new Uint8Array(g*n);c&&w.set(c);var q=new Float32Array(g*n),A=1/((p.extent.xmax-p.extent.xmin)/g),k=1/((p.extent.ymax-p.extent.ymin)/n),h,f;for(h=1;h<n-1;h++){var d=h*g;for(f=
1;f<g-1;f++)if(c&&!c[d+f])q[d+f]=0;else{var l=0;if(c&&(l=c[d-g+f-1]+c[d-g+f]+c[d-g+f+1]+c[d+f-1]+c[d+f+1]+c[d+g+f-1]+c[d+g+f]+c[d+g+f+1],7>l)){q[d+f]=0;w[d+f]=0;continue}if(7===l){l=c[d-g+f-1]?b[d-g+f-1]:b[d+f];var r=c[d-g+f]?b[d-g+f]:b[d+f];var u=c[d-g+f+1]?b[d-g+f+1]:b[d+f];var e=c[d+f-1]?b[d+f-1]:b[d+f];var v=c[d+f+1]?b[d+f+1]:b[d+f];var x=c[d+g+f-1]?b[d+g+f-1]:b[d+f];var y=c[d+g+f]?b[d+g+f]:b[d+f];var t=c[d+g+f+1]?b[d+g+f+1]:b[d+f]}else l=b[d-g+f-1],r=b[d-g+f],u=b[d-g+f+1],e=b[d+f-1],v=b[d+f+
1],x=b[d+g+f-1],y=b[d+g+f],t=b[d+g+f+1];e=(u+v+v+t-(l+e+e+x))*A;l=(x+y+y+t-(l+r+r+u))*k;0===e&&0===l?l=-1:(l=90-57.29578*Math.atan2(l,-e),0>l&&(l+=360),360===l?l=0:360<l&&(l%=360));q[d+f]=l}}for(h=0;h<n;h++)q[h*g]=q[h*g+1],q[(h+1)*g-1]=q[(h+1)*g-2];for(h=1;h<g-1;h++)q[h]=q[h+g],q[h+(n-1)*g]=q[h+(n-2)*g];a.pixelType="F32";a.pixels=[q];a.statistics={minValue:0,maxValue:360};c&&(a.mask=w);return{extent:p.extent,pixelBlock:a}}},_clonePixelBlock:function(p){return p.clone?p.clone():J.clone(p)}}});