// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/rasterLib/renderer/RasterUniqueValueRenderer",["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../../../renderers/colorRampGenerator"],function(u,x,v,r,w){return u([v],{declaredClass:"esri.layers.rasterLib.renderer.RasterUniqueValueRenderer",rendererName:"UniqueValue",field:"",alias:"",uniqueValueInfos:null,constructor:function(d){d&&d.colormap&&(this.colormap=d.colormap,this._function=new r(d),this._function.outputPixelType="U8",this._function.renderTexture=
!0)},bind:function(d){this.inherited(arguments);if(!this._function){var c=(this.raster&&this.raster.rasterInfo||this._rawRasterInfo).vat;if(!c)throw"uv renderer requires data source to have raster attribute table";var b=this.attributeField||this.field1||this.field,f=this.infos||this.uniqueValueInfos;this.defaultColor=this.defaultColor||this.defaultSymbol&&this.defaultSymbol.color;var g=c.fields.filter(function(a){return"value"===a.name.toLowerCase()})[0];if(g)var k=g.name;b||((b=c.fields.filter(function(a){return-1<
["classname","category"].indexOf(a.name.toLowerCase())})[0])||(b=c.fields.filter(function(a){return"esriFieldTypeString"===a.type})[0]),this.alias=(this.field=b=b&&b.name||k)&&b.alias||k);var h=[],q;if(!f){f=[];var t=c.fields.filter(function(a){return"alpha"===a.name.toLowerCase()})[0];var l=c.fields.filter(function(a){return"red"===a.name.toLowerCase()})[0];var m=c.fields.filter(function(a){return"green"===a.name.toLowerCase()})[0];var n=c.fields.filter(function(a){return"blue"===a.name.toLowerCase()})[0];
for(g=0;g<c.features.length;g++){var e=c.features[g].attributes;(q=f.some(function(a){a.value===e[b]}))||(t&&l&&m&&n?f.push({value:e[b],alias:e[b],color:[e[l.name],e[m.name],e[n.name],e[t.name]]}):l&&m&&n?f.push({value:e[b],alias:e[b],color:[e[l.name],e[m.name],e[n.name]]}):f.push({value:e[b],alias:e[b]}))}if(!(l&&m&&n))for(q=w.createRandomColorRamp({size:f.length}),g=0;g<f.length;g++)f[g].color=q[g];this.uniqueValueInfos=f}if(f)f.forEach(function(a){h=h.concat(c.features.filter(function(p){return a.value==
p.attributes[b]}).map(function(p){return[p.attributes[k]].concat(a.color||a.symbol&&a.symbol.color)}))}),this.defaultColor&&c.features.filter(function(a){h.some(function(p){return p[0]===a.attributes[k]})||h.push([a.attributes[k]].concat(this.defaultColor))});else throw"missing uniqueValueInfos property";this._function=new r({colormap:h});this.colormap=h;this._function.outputPixelType="U8";this._function.renderTexture=!0;this._function.setProcessingContext(this._processingContext)}},draw2D:function(d){d=
this._clonePixelData(d);return d=this._function._colorize(d)},drawGL:function(d){this._function._colorizeGL(d)},toJson:function(d){var c={field:this.field,uniqueValueInfos:this.uniqueValueInfos,defaultColor:this.defaultColor};d&&(c.colormap=this.colormap);return{rendererName:this.rendererName,rendererArguments:c}},toCommonRendererJson:function(){var d=this.attributeField||this.field1||this.field,c=(this.infos||this.uniqueValueInfos).map(function(b){return{value:b.value,label:b.alias+"",symbol:{color:3===
b.color.length?b.color.concat([255]):b.color,type:"esriSFS",style:"esriSFSSolid"}}});return{type:"uniqueValue",field1:d,uniqueValueInfos:c}}})});