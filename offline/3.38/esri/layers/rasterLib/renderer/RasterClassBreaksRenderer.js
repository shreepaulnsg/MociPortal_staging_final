// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/rasterLib/renderer/RasterClassBreaksRenderer",["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../function/RemapFunction"],function(q,r,t,u,v){return q([t],{declaredClass:"esri.layers.rasterLib.renderer.RasterClassBreaksRenderer",rendererName:"ClassBreaks",renderTexture:!0,constructor:function(a){a=a||{};this._function=new v(a);this._function.outputPixelType="U8";var b=a.classBreakInfos;a=a.minValue;null!=a&&b&&(this._function.functionArguments.colorBreaks=
this._getSortedColorBreaks(a,b))},bind:function(a){this.inherited(arguments);this.isColormapFunction=!1;var b=this.raster&&this.raster.rasterInfo||this._rawRasterInfo,c=b&&b.vat;if(c&&"u8"===b.pixelType.toLowerCase()&&this.classBreakInfos){var d=this.field;if(b=c.fields.filter(function(e){return"value"===e.name.toLowerCase()})[0])var g=b.name;var p=c.features.sort(function(e,h){return parseFloat(e.attributes[d])-parseFloat(h.attributes[d])})[0].attributes[d];this.isColormapFunction=!0;var k=[],l=
this.field,m=this.classBreakInfos;m.forEach(function(e,h){c.features.forEach(function(f){var n=m[h-1]&&m[h-1].classMaxValue||p;f.attributes[l]<=e.classMaxValue&&(f.attributes[l]>n||f.attributes[l]===p)&&(n=e.symbol.color,k.some(function(w){return w[0]===f.attributes[g]})||k.push([f.attributes[g]].concat(n)))})});this._function=new u({colormap:k});this.colormap=k;this._function.outputPixelType="U8";this._function.renderTexture=!0}this._function&&this._function.setProcessingContext(r.mixin({useProcessedData:!0},
this._processingContext))},draw2D:function(a){if(this.isColormapFunction)return this._updateColormapParameters(),a=this._clonePixelData(a),a=this._function._colorize(a);this._updateRemapParameters();return this._function._remap(a)},drawGL:function(a){this.isColormapFunction?(this._updateColormapParameters(),this._function._colorizeGL(a)):(this._function.renderTexture=!0,this._updateRemapParameters(),this._function._remapGL(a))},toJson:function(){var a=this._function.toJson().rasterFunctionArguments;
return{rendererName:this.rendererName,rendererArguments:a}},toCommonRendererJson:function(){var a,b=this.classBreakInfos,c=this.colorBreaks;if(null==b&&c)for(b=[],a=0;a<c.length-1;a++)b.push({classMaxValue:c[a+1].value,symbol:{color:c[a].mappedColor,type:"esriSFS",style:"esriSFSSolid"},label:c[a].value+" - "+c[a+1].value});return{type:"classBreaks",field:"Value",minValue:null!=this.minValue?this.minValue:c[0].value,classBreakInfos:b}},_updateRemapParameters:function(){var a=this.classBreakInfos,b=
this.minValue;null!=b&&a&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(b,a))},_getSortedColorBreaks:function(a,b){b=b.map(function(d){return{maxValue:d.classMaxValue,color:d.symbol.color}}).sort(function(d,g){return d.maxValue-g.maxValue});var c=[{value:a,mappedColor:b[0].color}];for(a=0;a<b.length;a++)c.push({value:b[a].maxValue,mappedColor:a===b.length-1?b[a].color:b[a+1].color});return c},_updateColormapParameters:function(){this._function.functionArguments.colormap=
this.colormap;this._function.interpolation=this.interpolation}})});