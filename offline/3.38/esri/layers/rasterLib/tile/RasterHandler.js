// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/rasterLib/tile/RasterHandler","require exports module dojo/Deferred dojo/promise/all ../../PixelBlock ../../vectorTiles/core/workers ../../vectorTiles/core/promiseUtils ../../vectorTiles/core/requireUtils ../../vectorTiles/request ../../rasterLib/function/rasterFunctionHelper ../../rasterLib/renderer/rasterRendererHelper".split(" "),function(p,u,q,k,r,l,n,f,t,v,w,x){function m(d){var a=new k;r(d).then(function(b){a.resolve()});return a.promise}return function(){function d(a){this.customModules=
a&&a.customModules}d.prototype.destroy=function(){this.stop();this.customModules=this.rasterLayer=null};d.prototype.start=function(){this.stop();var a=new k,b=0,c=this.customModules?this.customModules.length+1:1,e=t.getAbsMid("esri/layers/rasterLib/tile/RasterWorker",p,q),g=n.open(e,{client:this}).then(function(h){this._connection=h;b++;b===c&&(this._connected=!0,a.resolve())}.bind(this));this._openDL=[g];this.customModules&&this.customModules.forEach(function(h){g=n.open(h,{client:this}).then(function(y){b++;
b===c&&(this._connected=!0,a.resolve())});this._openDL.push(g);console.log(h)}.bind(this));return this._connectionPromise=a.promise};d.prototype.stop=function(){this._openDL?this._openDL.forEach(function(a){a.isFulfilled()||a.cancel()}.bind(this)):this._connectionPromise&&!this._connectionPromise.isFulfilled()&&this._connectionPromise.cancel();this._connection&&(this._connection.close(),this._connection=null)};d.prototype.decode=function(a){if(!this._connectionPromise.isFulfilled()||!this._connection)return f.reject(Error("no connection"));
var b={id:null};return this._connection.invoke("decode",a,[],b).then(function(c){c.targetWorker=b;return c})};d.prototype.process=function(a){if(!this._connectionPromise.isFulfilled()||!this._connection)return f.reject(Error("no connection"));var b={id:null};a.layerId=this.rasterLayer.layerId;var c=new k;this._connection.invoke("process",a,[],b).then(function(e){e.targetWorker=b;e.src?Object.keys(e.src).forEach(function(g){e.src[g].pixelBlock=new l(e.src[g].pixelBlock)}):e.src=null;e.pixelBlock&&
(e.pixelBlock=new l(e.pixelBlock));c.resolve(e)});return c.promise};d.prototype.render=function(a){if(!this._connectionPromise.isFulfilled()||!this._connection)return f.reject(Error("no connection"));var b={id:null};a.layerId=this.rasterLayer.layerId;return this._connection.invoke("render",a,[],b).then(function(c){c.targetWorker=b;c.pixelBlock=c.pixelBlock?new l(c.pixelBlock):null;return c})};d.prototype.setLayer=function(a){if(!this._connectionPromise.isFulfilled()||!this._connection)return f.reject(Error("no connection"));
this.rasterLayer=a;a=this._connection.broadcast("setLayer",a,[],{id:null});return m(a)};d.prototype.setRasterFunction=function(a){if(!this._connectionPromise.isFulfilled()||!this._connection)return f.reject(Error("no connection"));a=this._connection.broadcast("setRasterFunction",a,[],{id:null});return m(a)};d.prototype.setRasterRenderer=function(a){if(!this._connectionPromise.isFulfilled()||!this._connection)return f.reject(Error("no connection"));a=this._connection.broadcast("setRasterRenderer",
a,[],{id:null});return m(a)};return d}()});