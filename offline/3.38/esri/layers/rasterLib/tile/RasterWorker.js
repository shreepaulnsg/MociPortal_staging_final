// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
require({cache:{"dojo/promise/all":function(){define(["../_base/array","../_base/lang","../Deferred","../when"],function(A,q,a,d){var g=A.some;return function(h){var e,b;q.isArray(h)?b=h:h&&"object"===typeof h&&(e=h);var c=[];if(e){b=[];for(var l in e)Object.hasOwnProperty.call(e,l)&&(c.push(l),b.push(e[l]));var k={}}else b&&(k=[]);if(!b||!b.length)return(new a).resolve(k);var f=new a;f.promise.always(function(){k=c=null});var m=b.length;g(b,function(n,p){e||c.push(p);d(n,function(r){f.isFulfilled()||
(k[c[p]]=r,0===--m&&f.resolve(k))},f.reject);return f.isFulfilled()});return f.promise}})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(A,q,a,d){A=A([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],maskIsAlpha:!1,validPixelCount:null,constructor:function(g){if(g){if(!g.width||Math.floor(g.width)!==g.width)throw"PixelBlock: incorrect width";if(!g.height||Math.floor(g.height)!==
g.height)throw"PixelBlock: incorrect height";if(!g.pixels)throw"PixelBlock: pixel data not present";this.width=g.width;this.height=g.height;this.pixels=g.pixels;this.pixelType=g.pixelType||null;this.statistics=g.statistics;this.mask=g.mask||null;this.maskIsAlpha=g.maskIsAlpha||!1;g=g.validPixelCount;null==g&&(g=this.mask?this._getValidPixelCount(this.mask):this.width*this.height);this.validPixelCount=g}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):
this.statistics.length},addData:function(g){if(!g.pixels||!g.statistics)throw"Pixel data or statistics are not present";if(g.pixels.length!==this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(g.statistics);this.pixels.push(g.pixels)},getAsRGBA:function(){var g=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(g);break;default:this._fillFrom8Bit(g)}return new Uint8ClampedArray(g)},
getAsRGBAFloat:function(){var g=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(g);return g},clone:function(g){g=g||this;var h=new this.constructor;h.width=g.width;h.height=g.height;h.pixelType=g.pixelType;h.maskIsAlpha=g.maskIsAlpha;g.mask&&(h.mask=new Uint8Array(g.mask));var e,b;if(g.pixels){h.pixels=[];var c=(b=g.pixels.length)&&g.pixels[0].slice;for(e=0;e<b;e++)h.pixels[e]=c?g.pixels[e].slice(0,g.pixels[e].length):new g.pixels[e].constructor(g.pixels[e])}if(g.statistics)for(h.statistics=
[],b=g.statistics.length,e=0;e<b;e++)h.statistics[e]=q.clone(g.statistics[e]);g=g.validPixelCount;null==g&&(g=h.mask?this._getValidPixelCount(h.mask):h.width*h.height);return h},clamp:function(g){if("F64"!==g&&"F32"!==g){switch(g){case "U8":var h=[0,255];break;case "U16":h=[0,65535];break;case "U32":h=[0,4294967295];break;case "S8":h=[-128,127];break;case "S16":h=[-32768,32767];break;case "S32":h=[-2147483648,2147483647];break;default:h=[-3.4*1E39,3.4*1E39]}var e=h[0];h=h[1];var b=this.pixels,c=this.width*
this.height,l=b.length,k,f,m=[];for(k=0;k<l;k++){var n=this._createEmptyBand(g,c);var p=b[k];for(f=0;f<c;f++){var r=p[f];n[f]=r>h?h:r<e?e:r}m.push(n)}this.pixels=m;this.pixelType=g}},calculateStatistics:function(){var g,h=[],e=this.mask;for(g=0;g<this.pixels.length;g++){var b=this.pixels[g];h.push(this._calculateBandStatistics(b,e))}this.statistics=h},_getValidPixelCount:function(g){var h,e=0;for(h=0;h<g.length;h++)g[h]&&e++;return e},_createEmptyBand:function(g,h){switch(g){case "U8":g=new Uint8Array(h);
break;case "U16":g=new Uint16Array(h);break;case "U32":g=new Uint32Array(h);break;case "S8":g=new Int8Array(h);break;case "S16":g=new Int16Array(h);break;case "S32":g=new Int32Array(h);break;case "U32":g=new Uint32Array(h);break;case "F32":g=new Float32Array(h);break;case "F64":g=new Float64Array(h);break;default:g=new Float32Array(h)}return g},_fillFrom8Bit:function(g){var h=this.pixels,e=this.mask;if(!g||!h||!h.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var b,c;var l=b=c=h[0];3<=h.length&&(b=h[1],c=h[2]);h=new Uint32Array(g);var k=this.width*this.height;if(l.length!==k)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(e&&e.length===k)if(this.maskIsAlpha)for(g=0;g<k;g++)e[g]&&(h[g]=e[g]<<24|c[g]<<16|b[g]<<8|l[g]);else for(g=0;g<k;g++)e[g]&&(h[g]=-16777216|c[g]<<16|b[g]<<8|l[g]);else for(g=0;g<k;g++)h[g]=-16777216|c[g]<<16|b[g]<<8|l[g]},_fillFromNon8Bit:function(g){var h=this.pixels,e=this.mask,b=this.statistics;if(!g||
!h||!h.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var c=1,l=0;c=1;b&&0<b.length?(l=b.map(function(n){return n.minValue}).reduce(function(n,p){return Math.min(n,p)}),c=b.map(function(n){return n.maxValue-n.minValue}).reduce(function(n,p){return Math.max(n,p)}),c=255/c):(c=255,"S8"===this.pixelType?(l=-128,c=127):"U16"===this.pixelType?c=65535:"S16"===this.pixelType?(l=-32768,c=32767):"U32"===this.pixelType?c=4294967295:"S32"===this.pixelType?(l=-2147483648,
c=2147483647):"F32"===this.pixelType?(l=-3.4*1E39,c=3.4*1E39):"F64"===this.pixelType&&(l=-Number.MAX_VALUE,c=Number.MAX_VALUE),c=255/(c-l));g=new Uint32Array(g);b=this.width*this.height;var k=h[0];if(k.length!==b)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(3<=h.length){var f=h[1];var m=h[2];if(e&&e.length===b)for(h=0;h<b;h++)e[h]&&(g[h]=-16777216|(m[h]-l)*c<<16|(f[h]-l)*c<<8|(k[h]-l)*c);else for(h=0;h<b;h++)g[h]=-16777216|(m[h]-l)*c<<16|(f[h]-l)*c<<8|(k[h]-l)*
c}else if(e&&e.length===b)for(h=0;h<b;h++)f=(k[h]-l)*c,e[h]&&(g[h]=-16777216|f<<16|f<<8|f);else for(h=0;h<b;h++)f=(k[h]-l)*c,g[h]=-16777216|f<<16|f<<8|f},_fillFrom32Bit:function(g){var h=this.pixels,e=this.mask;if(!g||!h||!h.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var b,c;var l=b=c=h[0];3<=h.length&&(b=h[1],c=h[2]);var k=this.width*this.height;if(l.length!==k)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var f=0;if(e&&
e.length===k)for(h=0;h<k;h++)g[f++]=l[h],g[f++]=b[h],g[f++]=c[h],g[f++]=e[h]&1;else for(h=0;h<k;h++)g[f++]=l[h],g[f++]=b[h],g[f++]=c[h],g[f++]=1},_calculateBandStatistics:function(g,h){var e=Infinity,b=-Infinity,c=g.length,l,k=0;if(h)for(l=0;l<c;l++)h[l]&&(k=g[l],e=k<e?k:e,b=k>b?k:b);else for(l=0;l<c;l++)k=g[l],e=k<e?k:e,b=k>b?k:b;return{minValue:e,maxValue:b}}});a("extend-esri")&&q.setObject("layers.PixelBlock",A,d);return A})},"esri/kernel":function(){define(["dojo/_base/kernel","dojo/_base/config",
"dojo/has"],function(A,q,a){var d=function(){return this}(),g=d.location,h=g.pathname,e=g.protocol;g={version:"3.38",_appBaseUrl:e+"//"+g.host+h.substring(0,h.lastIndexOf(h.split("/")[h.split("/").length-1]))};q.noGlobals||(d.esri=g);A.isAsync||a.add("extend-esri",1);(g.dijit=g.dijit||{})._arcgisUrl=("http:"===e||"https:"===e?e:"http:")+"//www.arcgis.com/sharing/rest";return g})},"esri/layers/rasterFormats/rasterCodec":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred ../PixelBlock ./LercCodec ./Lerc2Codec ./JpgPlus ./Png ./Raw ./TiffDecoder".split(" "),
function(A,q,a,d,g,h,e,b,c,l,k){return{validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),supportedFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_isPlatformLittleEndian:function(){var f=new ArrayBuffer(4),m=new Uint8Array(f);(new Uint32Array(f))[0]=1;return 1===m[0]}(),decode:function(f,m){if(void 0===m||null===m)throw"missing decode options";var n;m.format&&(n=m.format.toUpperCase());"BSQ"!==n&&"BIP"!==n&&(n=this._getFormat(f));var p=m.decodeFunc;if(void 0===
p||null===p)p=this._getFormatDecoderDfd(n);return p(f,m)},_getFormatDecoderDfd:function(f){var m=null;switch(f){case "LERC":m=this._decodeLerc;break;case "LERC2":m=this._decodeLerc2;break;case "JPEG":m=this._decodeJpeg;break;case "PNG":m=this._decodePng;break;case "BSQ":m=this._decodeBsq;break;case "BIP":m=this._decodeBip;break;case "TIFF":m=this._decodeTiff;break;default:m=function(n,p){throw"The raster format is not supported";}}m=a.hitch(this,m);return function(n,p){var r=new d;p.isPoint&&p.width&&
(p.width++,p.height++);n=m(n,p);p.isPoint&&p.width&&(this._interpolatePointGrid(n),p.width--,p.height--);r.resolve(n);return r}.bind(this)},_getFormat:function(f){f=new Uint8Array(f,0,10);var m="";if(255===f[0]&&216===f[1])m="JPEG";else if(137===f[0]&&80===f[1]&&78===f[2]&&71===f[3])m="PNG";else if(67===f[0]&&110===f[1]&&116===f[2]&&90===f[3]&&73===f[4]&&109===f[5]&&97===f[6]&&103===f[7]&&101===f[8]&&32===f[9])m="LERC";else if(76===f[0]&&101===f[1]&&114===f[2]&&99===f[3]&&50===f[4]&&32===f[5])m="LERC2";
else if(-1<String.fromCharCode.apply(null,f).toLowerCase().indexOf("error"))m="ERROR";else if(73===f[0]&&73===f[1]&&42===f[2]&&0===f[3]||77===f[0]&&77===f[1]&&0===f[2]&&42===f[3])m="TIFF";return m},_validateDecodeParams:function(f){if(!f.height||Math.floor(f.height)!==f.height)throw"Height not provided.";if(!f.width||Math.floor(f.width)!==f.width)throw"Width not provided.";},_decodeJpeg:function(f,m){if(!b)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(m);f=(new b).decode(f);
if(!this._verifyResult(f,m))throw"The decoded image dimensions are incorrect.";m=new g({width:f.width,height:f.height,pixels:f.pixels,pixelType:"U8",mask:f.mask,statistics:null});m.calculateStatistics();return m},_decodePng:function(f,m){if(!c)throw"The png decoder module is not loaded.";this._validateDecodeParams(m);f=new Uint8Array(f);var n=new c(f);f=new Uint8Array(m.width*m.height*4);n.copyToImageData(f,n.decodePixels());var p=n=0;p=new Uint8Array(m.width*m.height);for(n=0;n<m.width*m.height;n++)p[n]=
f[4*n+3];var r=new g({width:m.width,height:m.height,pixels:[],pixelType:"U8",mask:p,statistics:[]});for(n=0;3>n;n++){var v=new Uint8Array(m.width*m.height);for(p=0;p<m.width*m.height;p++)v[p]=f[4*p+n];r.addData({pixels:v})}r.calculateStatistics();return r},_decodeBsq:function(f,m){if(!l)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(m);var n=m.noDataValue;m.pixelType=this._getpixelTypeAndNoData(m.pixelType);f=l.decodeBSQ(f,{bandCount:m.planes,width:m.width,height:m.height,
pixelType:m.pixelType,noDataValue:n});m=new g({width:m.width,height:m.height,pixels:f.pixels,pixelType:m.pixelType,mask:f.maskData,statistics:null});m.calculateStatistics();return m},_decodeBip:function(f,m){this._validateDecodeParams(m);var n=m.noDataValue;m.pixelType=this._getpixelTypeAndNoData(m.pixelType);f=l.decodeBIP(f,{bandCount:m.planes,width:m.width,height:m.height,pixelType:m.pixelType,noDataValue:n});m=new g({width:m.width,height:m.height,pixels:f.pixels,pixelType:m.pixelType,mask:f.maskData,
statistics:null});m.calculateStatistics();return m},_decodeTiff:function(f,m){this._validateDecodeParams(m);m.pixelType=this._getpixelTypeAndNoData(m.pixelType);f=k.decode(f);f=new g({width:f.width,height:f.height,pixels:f.pixels,pixelType:f.pixelType,mask:f.maskData,statistics:null});f.calculateStatistics();return f},_decodeLerc:function(f,m){if(!this._isPlatformLittleEndian)throw"lerc decoder is not supported on big endian platform";this._validateDecodeParams(m);var n=m.noDataValue;m.pixelType=
this._getpixelTypeAndNoData(m.pixelType);for(var p=0,r,v=0,u,t=f.byteLength-10;v<t;){var w=h.decode(f,{inputOffset:v,encodedMaskData:r,returnMask:0===p?!0:!1,returnEncodedMask:0===p?!0:!1,returnFileInfo:!0,pixelType:m.pixelType,noDataValue:n});v=w.fileInfo.eofOffset;0===p&&(r=w.encodedMaskData,u=new g({width:m.width,height:m.height,pixels:[],pixelType:m.pixelType,mask:w.maskData,statistics:[]}));p++;if(!this._verifyResult(w,m))throw"The decoded image dimensions are incorrect";u.addData({pixels:w.pixelData,
statistics:{minValue:w.minValue,maxValue:w.maxValue,noDataValue:w.noDataValue}})}return u},_decodeLerc2:function(f,m){if(!this._isPlatformLittleEndian)throw"lerc2 decoder is not supported on big endian platform";this._validateDecodeParams(m);m.pixelType=this._getpixelTypeAndNoData(m.pixelType);for(var n=0,p,r,v,u=0,t,w=f.byteLength-10,x=[],y,z=0;u<w;){r=e.decode(f,{inputOffset:u,maskData:p,returnFileInfo:!0});u=r.fileInfo.eofOffset;p=r.maskData;0===n&&(v=r.fileInfo.numValidPixel,t=new g({width:m.width,
height:m.height,pixels:[],dimCount:r.dimCount||1,pixelType:r.fileInfo.pixelType,mask:p,statistics:[]}));r.fileInfo.mask&&0<r.fileInfo.mask.numBytes&&z++;p&&x.push(p);n++;if(!this._verifyResult(r,m))throw"The decoded image dimensions are incorrect";t.addData({pixels:r.pixelData,statistics:{minValue:r.minValue,maxValue:r.maxValue,noDataValue:r.noDataValue,dimStats:r.dimStats}})}if(1<z){m=t.width*t.height;t.bandMasks=x;p=new Uint8Array(m);p.set(x[0]);for(v=1;v<x.length;v++)for(y=x[v],f=0;f<m;f++)p[f]&=
y[f];for(f=v=0;f<m;f++)v+=y[f];t.mask=p}t.validPixelCount=v;return t},_interpolatePointGrid:function(f,m){var n=f.pixels;if(n&&0!==n.length){var p=n.length,r=f.width,v=f.mask,u=r-1,t=f.height-1,w=[],x,y;if(0===(null==m?1:m)){for(m=0;m<p;m++){var z=n[m];var B=new z.constructor(u*t);for(x=0;x<t;x++){var F=x*r;for(y=0;y<u;y++)B[x*u+y]=z[F+y]}w.push(B)}if(v){var D=new Uint8Array(u*t);for(x=0;x<t;x++)for(F=x*r,y=0;y<u;y++)D[x*u+y]=v[F+y]}}else{for(m=0;m<p;m++){z=n[m];B=new z.constructor(u*t);for(x=0;x<
t;x++)for(F=x*r,y=0;y<u;y++)B[x*u+y]=(z[F+y]+z[F+y+1]+z[F+r+y]+z[F+r+y+1])/4;w.push(B)}if(v)for(D=new Uint8Array(u*t),x=0;x<t;x++)for(F=x*r,y=0;y<u;y++)D[x*u+y]=Math.min.apply(null,[v[F+y],v[F+y+1],v[F+r+y],v[F+r+y+1]])}f.width=u;f.height=t;f.mask=D;f.pixels=w;return f}},_getpixelTypeAndNoData:function(f){return"U1"===f||"U2"===f||"U4"===f||"U8"===f?"U8":f},_verifyResult:function(f,m){return f.height!==m.height||f.width!==m.width?!1:!0}}})},"esri/layers/rasterFormats/LercCodec":function(){define([],
function(){var A={defaultNoDataValue:-3.4027999387901484E38,decode:function(a,d){d=d||{};var g=d.inputOffset||0,h=d.encodedMaskData||null===d.encodedMaskData,e={},b=new Uint8Array(a,g,10);e.fileIdentifierString=String.fromCharCode.apply(null,b);if("CntZImage"!=e.fileIdentifierString.trim())throw"Unexpected file identifier string: "+e.fileIdentifierString;g+=10;b=new DataView(a,g,24);e.fileVersion=b.getInt32(0,!0);e.imageType=b.getInt32(4,!0);e.height=b.getUint32(8,!0);e.width=b.getUint32(12,!0);e.maxZError=
b.getFloat64(16,!0);g+=24;if(!h)if(b=new DataView(a,g,16),e.mask={},e.mask.numBlocksY=b.getUint32(0,!0),e.mask.numBlocksX=b.getUint32(4,!0),e.mask.numBytes=b.getUint32(8,!0),e.mask.maxValue=b.getFloat32(12,!0),g+=16,0<e.mask.numBytes){h=new Uint8Array(Math.ceil(e.width*e.height/8));b=new DataView(a,g,e.mask.numBytes);var c=b.getInt16(0,!0),l=2,k=0;do{if(0<c)for(;c--;)h[k++]=b.getUint8(l++);else{var f=b.getUint8(l++);for(c=-c;c--;)h[k++]=f}c=b.getInt16(l,!0);l+=2}while(l<e.mask.numBytes);if(-32768!==
c||k<h.length)throw"Unexpected end of mask RLE encoding";e.mask.bitset=h;g+=e.mask.numBytes}else 0===(e.mask.numBytes|e.mask.numBlocksY|e.mask.maxValue)&&(h=new Uint8Array(Math.ceil(e.width*e.height/8)),e.mask.bitset=h);b=new DataView(a,g,16);e.pixels={};e.pixels.numBlocksY=b.getUint32(0,!0);e.pixels.numBlocksX=b.getUint32(4,!0);e.pixels.numBytes=b.getUint32(8,!0);e.pixels.maxValue=b.getFloat32(12,!0);g+=16;h=e.pixels.numBlocksX;b=e.pixels.numBlocksY;h+=0<e.width%h?1:0;c=b+(0<e.height%b?1:0);e.pixels.blocks=
Array(h*c);for(k=l=0;k<c;k++)for(f=0;f<h;f++){var m=0;b=new DataView(a,g,Math.min(10,a.byteLength-g));var n={};e.pixels.blocks[l++]=n;var p=b.getUint8(0);m++;n.encoding=p&63;if(3<n.encoding)throw"Invalid block encoding ("+n.encoding+")";if(2===n.encoding)g++;else{if(0!==p&&2!==p){p>>=6;n.offsetType=p;if(2===p)n.offset=b.getInt8(1),m++;else if(1===p)n.offset=b.getInt16(1,!0),m+=2;else if(0===p)n.offset=b.getFloat32(1,!0),m+=4;else throw"Invalid block offset type";if(1===n.encoding)if(p=b.getUint8(m),
m++,n.bitsPerPixel=p&63,p>>=6,n.numValidPixelsType=p,2===p)n.numValidPixels=b.getUint8(m),m++;else if(1===p)n.numValidPixels=b.getUint16(m,!0),m+=2;else if(0===p)n.numValidPixels=b.getUint32(m,!0),m+=4;else throw"Invalid valid pixel count type";}g+=m;if(3!=n.encoding)if(0===n.encoding){p=(e.pixels.numBytes-1)/4;if(p!==Math.floor(p))throw"uncompressed block has invalid length";b=new ArrayBuffer(4*p);m=new Uint8Array(b);m.set(new Uint8Array(a,g,4*p));b=new Float32Array(b);n.rawData=b;g+=4*p}else 1===
n.encoding&&(p=Math.ceil(n.numValidPixels*n.bitsPerPixel/8),b=new ArrayBuffer(4*Math.ceil(p/4)),m=new Uint8Array(b),m.set(new Uint8Array(a,g,p)),n.stuffedData=new Uint32Array(b),g+=p)}}e.eofOffset=g;a=null!=d.noDataValue?d.noDataValue:A.defaultNoDataValue;h=d.encodedMaskData;p=d.returnMask;c=0;l=e.pixels.numBlocksX;k=e.pixels.numBlocksY;f=Math.floor(e.width/l);n=Math.floor(e.height/k);m=2*e.maxZError;g=Number.MAX_VALUE;h=h||(e.mask?e.mask.bitset:null);var r;b=new (d.pixelType||Float32Array)(e.width*
e.height);p&&h&&(r=new Uint8Array(e.width*e.height));p=new Float32Array(f*n);for(var v,u,t=0;t<=k;t++){var w=t!==k?n:e.height%k;if(0!==w)for(var x=0;x<=l;x++){var y=x!==l?f:e.width%l;if(0!==y){var z=t*e.width*n+x*f,B=e.width-y,F=e.pixels.blocks[c],D;if(2>F.encoding){if(0===F.encoding)var C=F.rawData;else{var E=D=C=void 0;v=F.stuffedData;u=F.bitsPerPixel;var G=F.numValidPixels,H=F.offset,K=m,M=p,I=e.pixels.maxValue,N=(1<<u)-1,ea=0,T=0,W=Math.ceil((I-H)/K);v[v.length-1]<<=8*(4*v.length-Math.ceil(u*
G/8));for(E=0;E<G;E++)0===T&&(C=v[ea++],T=32),T>=u?(D=C>>>T-u&N,T-=u):(T=u-T,D=(C&N)<<T&N,C=v[ea++],T=32-T,D+=C>>>T),M[E]=D<W?H+D*K:I;C=p}D=0}else var P=2===F.encoding?0:F.offset;if(h)for(u=0;u<w;u++){if(z&7){var Z=h[z>>3];Z<<=z&7}for(v=0;v<y;v++)z&7||(Z=h[z>>3]),Z&128?(r&&(r[z]=1),E=2>F.encoding?C[D++]:P,g=g>E?E:g,b[z++]=E):(r&&(r[z]=0),b[z++]=a),Z<<=1;z+=B}else if(2>F.encoding)for(u=0;u<w;u++){for(v=0;v<y;v++)E=C[D++],g=g>E?E:g,b[z++]=E;z+=B}else for(g=g>P?P:g,u=0;u<w;u++){for(v=0;v<y;v++)b[z++]=
P;z+=B}if(1===F.encoding&&D!==F.numValidPixels)throw"Block and Mask do not match";c++}}}P=r;r={width:e.width,height:e.height,pixelData:b,minValue:g,maxValue:e.pixels.maxValue,noDataValue:a};P&&(r.maskData=P);d.returnEncodedMask&&e.mask&&(r.encodedMaskData=e.mask.bitset?e.mask.bitset:null);if(d.returnFileInfo&&(r.fileInfo=q(e),d.computeUsedBitDepths)){d=r.fileInfo;P=e.pixels.numBlocksX*e.pixels.numBlocksY;Z={};for(C=0;C<P;C++)D=e.pixels.blocks[C],0===D.encoding?Z.float32=!0:1===D.encoding?Z[D.bitsPerPixel]=
!0:Z[0]=!0;e=Object.keys(Z);d.bitDepths=e}return r}},q=function(a){return{fileIdentifierString:a.fileIdentifierString,fileVersion:a.fileVersion,imageType:a.imageType,height:a.height,width:a.width,maxZError:a.maxZError,eofOffset:a.eofOffset,mask:a.mask?{numBlocksX:a.mask.numBlocksX,numBlocksY:a.mask.numBlocksY,numBytes:a.mask.numBytes,maxValue:a.mask.maxValue}:null,pixels:{numBlocksX:a.pixels.numBlocksX,numBlocksY:a.pixels.numBlocksY,numBytes:a.pixels.numBytes,maxValue:a.pixels.maxValue,noDataValue:this.noDataValue}}};
return A})},"esri/layers/rasterFormats/Lerc2Codec":function(){define([],function(){var A={unstuff:function(d,g,h,e,b,c,l,k){var f=(1<<h)-1,m=0,n,p=0;d[d.length-1]<<=8*(4*d.length-Math.ceil(h*e/8));if(b)for(n=0;n<e;n++){if(0===p){var r=d[m++];p=32}if(p>=h){var v=r>>>p-h&f;p-=h}else p=h-p,v=(r&f)<<p&f,r=d[m++],p=32-p,v+=r>>>p;g[n]=b[v]}else for(b=Math.ceil((k-c)/l),n=0;n<e;n++)0===p&&(r=d[m++],p=32),p>=h?(v=r>>>p-h&f,p-=h):(p=h-p,v=(r&f)<<p&f,r=d[m++],p=32-p,v+=r>>>p),g[n]=v<b?c+v*l:k},unstuffLUT:function(d,
g,h,e,b,c){var l=(1<<g)-1,k=0,f=0,m=0,n=m=0,p=[];d[d.length-1]<<=8*(4*d.length-Math.ceil(g*h/8));var r=Math.ceil((c-e)/b);for(f=0;f<h;f++){if(0===m){var v=d[k++];m=32}m>=g?(n=v>>>m-g&l,m-=g):(m=g-m,n=(v&l)<<m&l,v=d[k++],m=32-m,n+=v>>>m);p[f]=n<r?e+n*b:c}p.unshift(e);return p},unstuff2:function(d,g,h,e,b,c,l,k){var f=(1<<h)-1,m=0,n,p=0,r=0;if(b)for(n=0;n<e;n++){if(0===p){var v=d[m++];p=32;r=0}if(p>=h){var u=v>>>r&f;p-=h;r+=h}else{var t=h-p;u=v>>>r&f;v=d[m++];p=32-t;u|=(v&(1<<t)-1)<<h-t;r=t}g[n]=b[u]}else for(b=
Math.ceil((k-c)/l),n=0;n<e;n++)0===p&&(v=d[m++],p=32,r=0),p>=h?(u=v>>>r&f,p-=h,r+=h):(t=h-p,u=v>>>r&f,v=d[m++],p=32-t,u|=(v&(1<<t)-1)<<h-t,r=t),g[n]=u<b?c+u*l:k;return g},unstuffLUT2:function(d,g,h,e,b,c){var l=(1<<g)-1,k=0,f=0,m=0,n=0,p=0,r=0,v=[],u=Math.ceil((c-e)/b);for(f=0;f<h;f++){if(0===n){var t=d[k++];n=32;r=0}n>=g?(p=t>>>r&l,n-=g,r+=g):(m=g-n,p=t>>>r&l,t=d[k++],n=32-m,p|=(t&(1<<m)-1)<<g-m,r=m);v[f]=p<u?e+p*b:c}v.unshift(e);return v},originalUnstuff:function(d,g,h,e){var b=(1<<h)-1,c=0,l,k=
0;d[d.length-1]<<=8*(4*d.length-Math.ceil(h*e/8));for(l=0;l<e;l++){if(0===k){var f=d[c++];k=32}if(k>=h){var m=f>>>k-h&b;k-=h}else k=h-k,m=(f&b)<<k&b,f=d[c++],k=32-k,m+=f>>>k;g[l]=m}return g},originalUnstuff2:function(d,g,h,e){var b=(1<<h)-1,c=0,l,k=0,f=0;for(l=0;l<e;l++){if(0===k){var m=d[c++];k=32;f=0}if(k>=h){var n=m>>>f&b;k-=h;f+=h}else{var p=h-k;n=m>>>f&b;m=d[c++];k=32-p;n|=(m&(1<<p)-1)<<h-p;f=p}g[l]=n}return g}},q={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(d){for(var g=65535,
h=65535,e=d.length,b=Math.floor(e/2),c=0;b;){var l=359<=b?359:b;b-=l;do g+=d[c++]<<8,h+=g+=d[c++];while(--l);g=(g&65535)+(g>>>16);h=(h&65535)+(h>>>16)}e&1&&(h+=g+=d[c]<<8);return((h&65535)+(h>>>16)<<16|(g&65535)+(g>>>16))>>>0},readHeaderInfo:function(d,g){var h=g.ptr,e=new Uint8Array(d,h,6),b={};b.fileIdentifierString=String.fromCharCode.apply(null,e);if(0!==b.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+b.fileIdentifierString;h+=6;e=new DataView(d,
h,8);var c=e.getInt32(0,!0);b.fileVersion=c;h+=4;3<=c&&(b.checksum=e.getUint32(4,!0),h+=4);e=new DataView(d,h,12);b.height=e.getUint32(0,!0);b.width=e.getUint32(4,!0);h+=8;4<=c?(b.numDims=e.getUint32(8,!0),h+=4):b.numDims=1;e=new DataView(d,h,40);b.numValidPixel=e.getUint32(0,!0);b.microBlockSize=e.getInt32(4,!0);b.blobSize=e.getInt32(8,!0);b.imageType=e.getInt32(12,!0);b.maxZError=e.getFloat64(16,!0);b.zMin=e.getFloat64(24,!0);b.zMax=e.getFloat64(32,!0);h+=40;g.headerInfo=b;g.ptr=h;if(3<=c&&(d=this.computeChecksumFletcher32(new Uint8Array(d,
h-(4<=c?52:48),b.blobSize-14)),d!==b.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(d,g){var h=g.headerInfo,e=this.getDataTypeArray(h.imageType),b=h.numDims*this.getDataTypeSize(h.imageType),c=this.readSubArray(d,g.ptr,e,b);d=this.readSubArray(d,g.ptr+b,e,b);g.ptr+=2*b;b=!0;for(g=0;g<h.numDims;g++)if(c[g]!==d[g]){b=!1;break}h.minValues=c;h.maxValues=d;return b},readSubArray:function(d,g,h,e){if(h===Uint8Array)d=new Uint8Array(d,g,e);else{var b=new ArrayBuffer(e);(new Uint8Array(b)).set(new Uint8Array(d,
g,e));d=new h(b)}return d},readMask:function(d,g){var h=g.ptr,e=g.headerInfo,b=e.width*e.height,c=e.numValidPixel,l=new DataView(d,h,4);e={};e.numBytes=l.getUint32(0,!0);h+=4;if((0===c||b===c)&&0!==e.numBytes)throw"invalid mask";if(0===c)c=new Uint8Array(Math.ceil(b/8)),e.bitset=c,l=new Uint8Array(b),g.pixels.resultMask=l,h+=e.numBytes;else if(0<e.numBytes){c=new Uint8Array(Math.ceil(b/8));l=new DataView(d,h,e.numBytes);d=l.getInt16(0,!0);var k=2,f=0,m=0;do{if(0<d)for(;d--;)c[f++]=l.getUint8(k++);
else for(m=l.getUint8(k++),d=-d;d--;)c[f++]=m;d=l.getInt16(k,!0);k+=2}while(k<e.numBytes);if(-32768!==d||f<c.length)throw"Unexpected end of mask RLE encoding";l=new Uint8Array(b);for(k=k=d=0;k<b;k++)k&7?(d=c[k>>3],d<<=k&7):d=c[k>>3],d&128&&(l[k]=1);g.pixels.resultMask=l;e.bitset=c;h+=e.numBytes}g.ptr=h;g.mask=e;return!0},readDataOneSweep:function(d,g,h,e){var b=g.ptr,c=g.headerInfo,l=c.numDims,k=c.width*c.height;c=c.numValidPixel*q.getDataTypeSize(c.imageType)*l;var f=g.pixels.resultMask;if(h===Uint8Array)d=
new Uint8Array(d,b,c);else{var m=new ArrayBuffer(c);(new Uint8Array(m)).set(new Uint8Array(d,b,c));d=new h(m)}if(d.length===k*l)g.pixels.resultPixels=e?q.swapDimensionOrder(d,k,l,h,!0):d;else{g.pixels.resultPixels=new h(k*l);var n=m=h=0,p=0;if(1<l)if(e)for(m=0;m<k;m++){if(f[m])for(p=m,n=0;n<l;n++,p+=k)g.pixels.resultPixels[p]=d[h++]}else for(m=0;m<k;m++){if(f[m])for(p=m*l,n=0;n<l;n++)g.pixels.resultPixels[p+n]=d[h++]}else for(m=0;m<k;m++)f[m]&&(g.pixels.resultPixels[m]=d[h++])}g.ptr=b+c;return!0},
readHuffmanTree:function(d,g){var h=this.HUFFMAN_LUT_BITS_MAX,e=new DataView(d,g.ptr,16);g.ptr+=16;if(2>e.getInt32(0,!0))throw"unsupported Huffman version";var b=e.getInt32(4,!0),c=e.getInt32(8,!0);e=e.getInt32(12,!0);if(c>=e)return!1;var l=new Uint32Array(e-c);q.decodeBits(d,g,l);var k=[],f;for(f=c;f<e;f++){var m=f-(f<b?0:b);k[m]={first:l[f-c],second:null}}f=d.byteLength-g.ptr;l=new ArrayBuffer(4*Math.ceil(f/4));(new Uint8Array(l)).set(new Uint8Array(d,g.ptr,f));d=new Uint32Array(l);g=0;l=0;var n=
d[0];for(f=c;f<e;f++){m=f-(f<b?0:b);var p=k[m].first;0<p&&(k[m].second=n<<g>>>32-p,32-g>=p?(g+=p,32===g&&(g=0,l++,n=d[l])):(g+=p-32,l++,n=d[l],k[m].second|=n>>>32-g))}var r=n=0,v=new a;for(f=0;f<k.length;f++)void 0!==k[f]&&(n=Math.max(n,k[f].first));r=n>=h?h:n;h=[];var u;for(f=c;f<e;f++)if(m=f-(f<b?0:b),p=k[m].first,0<p)if(c=[p,m],p<=r){m=k[m].second<<r-p;var t=1<<r-p;for(p=0;p<t;p++)h[m|p]=c}else for(m=k[m].second,t=v,--p;0<=p;p--)(u=m>>>p&1)?(t.right||(t.right=new a),t=t.right):(t.left||(t.left=
new a),t=t.left),0!==p||t.val||(t.val=c[1]);return{decodeLut:h,numBitsLUTQick:r,numBitsLUT:n,tree:v,stuffedData:d,srcPtr:l,bitPos:g}},readHuffman:function(d,g,h,e){var b=g.headerInfo.numDims,c=g.headerInfo.height,l=g.headerInfo.width,k=l*c,f=this.readHuffmanTree(d,g);d=f.decodeLut;var m=f.tree,n=f.stuffedData,p=f.srcPtr,r=f.bitPos,v=f.numBitsLUTQick;f=f.numBitsLUT;var u=0===g.headerInfo.imageType?128:0,t=g.pixels.resultMask,w,x,y,z,B,F,D=0;0<r&&(p++,r=0);var C=n[p],E=1===g.encodeMode,G=new h(k*b),
H=G,K;if(2>b||E)for(K=0;K<b;K++)if(1<b&&(H=new h(G.buffer,k*K,k),D=0),g.headerInfo.numValidPixel===l*c)for(y=B=0;y<c;y++)for(z=0;z<l;z++,B++){var M=0;var I=w=C<<r>>>32-v;32-r<v&&(I=w|=n[p+1]>>>64-r-v);if(d[I])M=d[I][1],r+=d[I][0];else for(I=w=C<<r>>>32-f,32-r<f&&(I=w|=n[p+1]>>>64-r-f),I=m,F=0;F<f;F++)if(I=(x=w>>>f-F-1&1)?I.right:I.left,!I.left&&!I.right){M=I.val;r=r+F+1;break}32<=r&&(r-=32,p++,C=n[p]);M-=u;E?(M=0<z?M+D:0<y?M+H[B-l]:M+D,M&=255,D=H[B]=M):H[B]=M}else for(y=B=0;y<c;y++)for(z=0;z<l;z++,
B++){if(t[B]){M=0;I=w=C<<r>>>32-v;32-r<v&&(I=w|=n[p+1]>>>64-r-v);if(d[I])M=d[I][1],r+=d[I][0];else for(I=w=C<<r>>>32-f,32-r<f&&(I=w|=n[p+1]>>>64-r-f),I=m,F=0;F<f;F++)if(I=(x=w>>>f-F-1&1)?I.right:I.left,!I.left&&!I.right){M=I.val;r=r+F+1;break}32<=r&&(r-=32,p++,C=n[p]);M-=u;E?(M=0<z&&t[B-1]?M+D:0<y&&t[B-l]?M+H[B-l]:M+D,M&=255,D=H[B]=M):H[B]=M}}else for(y=B=0;y<c;y++)for(z=0;z<l;z++)if(B=y*l+z,!t||t[B])for(K=0;K<b;K++,B+=k){M=0;I=w=C<<r>>>32-v;32-r<v&&(I=w|=n[p+1]>>>64-r-v);if(d[I])M=d[I][1],r+=d[I][0];
else for(I=w=C<<r>>>32-f,32-r<f&&(I=w|=n[p+1]>>>64-r-f),I=m,F=0;F<f;F++)if(I=(x=w>>>f-F-1&1)?I.right:I.left,!I.left&&!I.right){M=I.val;r=r+F+1;break}32<=r&&(r-=32,p++,C=n[p]);M-=u;H[B]=M}g.ptr=g.ptr+4*(p+1)+(0<r?4:0);g.pixels.resultPixels=G;1<b&&!e&&(g.pixels.resultPixels=q.swapDimensionOrder(G,k,b,h))},decodeBits:function(d,g,h,e,b){var c=g.headerInfo,l=c.fileVersion,k=0,f=new DataView(d,g.ptr,5<=d.byteLength-g.ptr?5:d.byteLength-g.ptr),m=f.getUint8(0);k++;var n=m>>6,p=0===n?4:3-n,r=0<(m&32)?!0:
!1;n=m&31;m=0;if(1===p)m=f.getUint8(k),k++;else if(2===p)m=f.getUint16(k,!0),k+=2;else if(4===p)m=f.getUint32(k,!0),k+=4;else throw"Invalid valid pixel count type";p=2*c.maxZError;b=1<c.numDims?c.maxValues[b]:c.zMax;if(r){g.counter.lut++;r=f.getUint8(k);k++;c=Math.ceil((r-1)*n/8);var v=Math.ceil(c/4);v=new ArrayBuffer(4*v);var u=new Uint8Array(v);g.ptr+=k;u.set(new Uint8Array(d,g.ptr,c));k=new Uint32Array(v);g.ptr+=c;for(f=0;r-1>>>f;)f++;c=Math.ceil(m*f/8);v=Math.ceil(c/4);v=new ArrayBuffer(4*v);
u=new Uint8Array(v);u.set(new Uint8Array(d,g.ptr,c));d=new Uint32Array(v);g.ptr+=c;g=3<=l?A.unstuffLUT2(k,n,r-1,e,p,b):A.unstuffLUT(k,n,r-1,e,p,b);3<=l?A.unstuff2(d,h,f,m,g):A.unstuff(d,h,f,m,g)}else g.counter.bitstuffer++,f=n,g.ptr+=k,0<f&&(c=Math.ceil(m*f/8),v=Math.ceil(c/4),v=new ArrayBuffer(4*v),u=new Uint8Array(v),u.set(new Uint8Array(d,g.ptr,c)),d=new Uint32Array(v),g.ptr+=c,3<=l?null==e?A.originalUnstuff2(d,h,f,m):A.unstuff2(d,h,f,m,!1,e,p,b):null==e?A.originalUnstuff(d,h,f,m):A.unstuff(d,
h,f,m,!1,e,p,b))},readTiles:function(d,g,h,e){var b=g.headerInfo,c=b.width,l=b.height,k=c*l,f=b.microBlockSize,m=b.imageType,n=q.getDataTypeSize(m),p=Math.ceil(c/f),r=Math.ceil(l/f);g.pixels.numBlocksY=r;g.pixels.numBlocksX=p;var v=g.pixels.ptr=0,u=0,t=0,w=0,x=0,y=0,z=0,B=0,F=v=0,D=0,C=0,E=z=0;z=z=0;var G=new h(f*f);l=l%f||f;var H=c%f||f,K=b.numDims,M,I=g.pixels.resultMask,N=g.pixels.resultPixels,ea=5<=b.fileVersion?14:15,T=b.zMax;for(t=0;t<r;t++)for(x=t!==r-1?f:l,w=0;w<p;w++)for(y=w!==p-1?f:H,D=
t*c*f+w*f,C=c-y,M=0;M<K;M++){1<K?(E=N,D=t*c*f+w*f,N=new h(g.pixels.resultPixels.buffer,k*M*n,k),T=b.maxValues[M]):E=null;z=d.byteLength-g.ptr;u=new DataView(d,g.ptr,Math.min(10,z));var W={};z=0;B=u.getUint8(0);z++;var P=5<=b.fileVersion?B&4:0;v=B>>6&255;F=B>>2&ea;if(F!==(w*f>>3&ea))throw"integrity issue";if(P&&0===M)throw"integrity issue";B&=3;if(3<B)throw g.ptr+=z,"Invalid block encoding ("+B+")";if(2===B){if(P)if(I)for(v=0;v<x;v++)for(u=0;u<y;u++)I[D]&&(N[D]=E[D]),D++;else for(v=0;v<x;v++)for(u=
0;u<y;u++)N[D]=E[D],D++;g.counter.constant++;g.ptr+=z}else if(0===B){if(P)throw"integrity issue";g.counter.uncompressed++;g.ptr+=z;z=x*y*n;E=d.byteLength-g.ptr;z=z<E?z:E;E=new ArrayBuffer(0===z%n?z:z+n-z%n);P=new Uint8Array(E);P.set(new Uint8Array(d,g.ptr,z));E=new h(E);z=0;if(I)for(v=0;v<x;v++){for(u=0;u<y;u++)I[D]&&(N[D]=E[z++]),D++;D+=C}else for(v=0;v<x;v++){for(u=0;u<y;u++)N[D++]=E[z++];D+=C}g.ptr+=z*n}else if(v=q.getDataTypeUsed(P&&6>m?4:m,v),W=q.getOnePixel(W,z,v,u),z+=q.getDataTypeSize(v),
3===B)if(g.ptr+=z,g.counter.constantoffset++,I)for(v=0;v<x;v++){for(u=0;u<y;u++)I[D]&&(N[D]=P?Math.min(T,E[D]+W):W),D++;D+=C}else for(v=0;v<x;v++){for(u=0;u<y;u++)N[D]=P?Math.min(T,E[D]+W):W,D++;D+=C}else if(g.ptr+=z,q.decodeBits(d,g,G,W,M),z=0,P)if(I)for(v=0;v<x;v++){for(u=0;u<y;u++)I[D]&&(N[D]=G[z++]+E[D]),D++;D+=C}else for(v=0;v<x;v++){for(u=0;u<y;u++)N[D]=G[z++]+E[D],D++;D+=C}else if(I)for(v=0;v<x;v++){for(u=0;u<y;u++)I[D]&&(N[D]=G[z++]),D++;D+=C}else for(v=0;v<x;v++){for(u=0;u<y;u++)N[D++]=G[z++];
D+=C}}1<K&&!e&&(g.pixels.resultPixels=q.swapDimensionOrder(g.pixels.resultPixels,k,K,h))},formatFileInfo:function(d){return{fileIdentifierString:d.headerInfo.fileIdentifierString,fileVersion:d.headerInfo.fileVersion,imageType:d.headerInfo.imageType,height:d.headerInfo.height,width:d.headerInfo.width,numValidPixel:d.headerInfo.numValidPixel,microBlockSize:d.headerInfo.microBlockSize,blobSize:d.headerInfo.blobSize,maxZError:d.headerInfo.maxZError,pixelType:q.getPixelType(d.headerInfo.imageType),eofOffset:d.eofOffset,
mask:d.mask?{numBytes:d.mask.numBytes}:null,pixels:{numBlocksX:d.pixels.numBlocksX,numBlocksY:d.pixels.numBlocksY,maxValue:d.headerInfo.zMax,minValue:d.headerInfo.zMin,noDataValue:d.noDataValue}}},constructConstantSurface:function(d,g){var h=d.headerInfo.zMax,e=d.headerInfo.zMin,b=d.headerInfo.maxValues,c=d.headerInfo.numDims,l=d.headerInfo.height*d.headerInfo.width,k=0,f=0,m=0,n=d.pixels.resultMask;d=d.pixels.resultPixels;if(n)if(1<c)if(g)for(k=0;k<c;k++)for(m=k*l,h=b[k],f=0;f<l;f++)n[f]&&(d[m+f]=
h);else for(f=0;f<l;f++){if(n[f])for(m=f*c,k=0;k<c;k++)d[m+c]=b[k]}else for(f=0;f<l;f++)n[f]&&(d[f]=h);else if(1<c&&e!==h)if(g)for(k=0;k<c;k++)for(m=k*l,h=b[k],f=0;f<l;f++)d[m+f]=h;else for(f=0;f<l;f++)for(m=f*c,k=0;k<c;k++)d[m+k]=b[k];else for(f=0;f<l*c;f++)d[f]=h},getDataTypeArray:function(d){switch(d){case 0:d=Int8Array;break;case 1:d=Uint8Array;break;case 2:d=Int16Array;break;case 3:d=Uint16Array;break;case 4:d=Int32Array;break;case 5:d=Uint32Array;break;case 6:d=Float32Array;break;case 7:d=Float64Array;
break;default:d=Float32Array}return d},getPixelType:function(d){switch(d){case 0:d="S8";break;case 1:d="U8";break;case 2:d="S16";break;case 3:d="U16";break;case 4:d="S32";break;case 5:d="U32";break;case 6:d="F32";break;case 7:d="F64";break;default:d="F32"}return d},isValidPixelValue:function(d,g){if(null==g)return!1;switch(d){case 0:d=-128<=g&&127>=g;break;case 1:d=0<=g&&255>=g;break;case 2:d=-32768<=g&&32767>=g;break;case 3:d=0<=g&&65536>=g;break;case 4:d=-2147483648<=g&&2147483647>=g;break;case 5:d=
0<=g&&4294967296>=g;break;case 6:d=-3.4027999387901484E38<=g&&3.4027999387901484E38>=g;break;case 7:d=4.9E-324<=g&&1.7976931348623157E308>=g;break;default:d=!1}return d},getDataTypeSize:function(d){var g=0;switch(d){case 0:case 1:g=1;break;case 2:case 3:g=2;break;case 4:case 5:case 6:g=4;break;case 7:g=8;break;default:g=d}return g},getDataTypeUsed:function(d,g){var h=d;switch(d){case 2:case 4:h=d-g;break;case 3:case 5:h=d-2*g;break;case 6:h=0===g?d:1===g?2:1;break;case 7:h=0===g?d:d-2*g+1;break;default:h=
d}return h},getOnePixel:function(d,g,h,e){d=0;switch(h){case 0:d=e.getInt8(g);break;case 1:d=e.getUint8(g);break;case 2:d=e.getInt16(g,!0);break;case 3:d=e.getUint16(g,!0);break;case 4:d=e.getInt32(g,!0);break;case 5:d=e.getUInt32(g,!0);break;case 6:d=e.getFloat32(g,!0);break;case 7:d=e.getFloat64(g,!0);break;default:throw"the decoder does not understand this pixel type";}return d},swapDimensionOrder:function(d,g,h,e,b){var c=0,l=0,k=0,f=0,m=d;if(1<h)if(m=new e(g*h),b)for(c=0;c<g;c++)for(f=c,k=0;k<
h;k++,f+=g)m[f]=d[l++];else for(c=0;c<g;c++)for(f=c,k=0;k<h;k++,f+=g)m[l++]=d[f];return m}},a=function(d,g,h){this.val=d;this.left=g;this.right=h};return{decode:function(d,g){g=g||{};var h=g.noDataValue,e=0,b={};b.ptr=g.inputOffset||0;b.pixels={};if(q.readHeaderInfo(d,b)){e=b.headerInfo;var c=e.fileVersion,l=q.getDataTypeArray(e.imageType);if(5<c)throw"unsupported lerc version 2."+c;q.readMask(d,b);e.numValidPixel===e.width*e.height||b.pixels.resultMask||(b.pixels.resultMask=g.maskData);var k=e.width*
e.height;b.pixels.resultPixels=new l(k*e.numDims);b.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};var f=!g.returnPixelInterleavedDims;if(0!==e.numValidPixel)if(e.zMax===e.zMin)q.constructConstantSurface(b,f);else if(4<=c&&q.checkMinMaxRanges(d,b))q.constructConstantSurface(b,f);else{var m=new DataView(d,b.ptr,2),n=m.getUint8(0);b.ptr++;if(n)q.readDataOneSweep(d,b,l,f);else if(1<c&&1>=e.imageType&&1E-5>Math.abs(e.maxZError-.5)){m=m.getUint8(1);b.ptr++;b.encodeMode=
m;if(2<m||4>c&&1<m)throw"Invalid Huffman flag "+m;m?q.readHuffman(d,b,l,f):q.readTiles(d,b,l,f)}else q.readTiles(d,b,l,f)}b.eofOffset=b.ptr;g.inputOffset?(d=b.headerInfo.blobSize+g.inputOffset-b.ptr,1<=Math.abs(d)&&(b.eofOffset=g.inputOffset+b.headerInfo.blobSize)):(d=b.headerInfo.blobSize-b.ptr,1<=Math.abs(d)&&(b.eofOffset=b.headerInfo.blobSize));d={width:e.width,height:e.height,pixelData:b.pixels.resultPixels,minValue:e.zMin,maxValue:e.zMax,validPixelCount:e.numValidPixel,dimCount:e.numDims,dimStats:{minValues:e.minValues,
maxValues:e.maxValues},maskData:b.pixels.resultMask};if(b.pixels.resultMask&&q.isValidPixelValue(e.imageType,h)){c=b.pixels.resultMask;for(e=0;e<k;e++)c[e]||(d.pixelData[e]=h);d.noDataValue=h}b.noDataValue=h;g.returnFileInfo&&(d.fileInfo=q.formatFileInfo(b));return d}},getBandCount:function(d){for(var g=0,h=0,e={ptr:0,pixels:{}};h<d.byteLength-58;)q.readHeaderInfo(d,e),h+=e.headerInfo.blobSize,g++,e.ptr=h;return g}}})},"esri/layers/rasterFormats/JpgPlus":function(){define(["dojo/_base/declare","./Zlib",
"./Jpg"],function(A,q,a){return A(null,{constructor:function(){},decode:function(d){var g=new Uint8Array(d);d=new a;d.parse(g);var h=d.numComponents,e=d.getData(d.width,d.height,!0),b=d.width*d.height,c=d.eof,l=0,k=0,f=0;if(c<g.length-1){k=(new q(g.subarray(c))).getBytes();var m=new Uint8Array(b);for(l=g=0;l<k.length;l++)for(f=7;0<=f;f--)m[g++]=k[l]>>f&1}g=[];if(1===h)g=[e,e,e];else{for(l=0;3>l;l++)h=new Uint8Array(b),g.push(h);for(k=f=0;k<b;k++)for(l=0;3>l;l++)g[l][k]=e[f++]}return{width:d.width,
height:d.height,pixels:g,mask:m}}})})},"esri/layers/rasterFormats/Zlib":function(){define([],function(){var A=function(){function q(){this.bufferLength=this.pos=0;this.eof=!1;this.buffer=null}q.prototype={ensureBuffer:function(a){var d=this.buffer,g=d?d.byteLength:0;if(a<g)return d;for(var h=512;h<a;)h<<=1;a=new Uint8Array(h);for(h=0;h<g;++h)a[h]=d[h];return this.buffer=a},getByte:function(){for(var a=this.pos;this.bufferLength<=a;){if(this.eof)return null;this.readBlock()}return this.buffer[this.pos++]},
getBytes:function(a){var d=this.pos;if(a){this.ensureBuffer(d+a);for(a=d+a;!this.eof&&this.bufferLength<a;)this.readBlock();var g=this.bufferLength;a>g&&(a=g)}else{for(;!this.eof;)this.readBlock();a=this.bufferLength}this.pos=a;return this.buffer.subarray(d,a)},lookChar:function(){for(var a=this.pos;this.bufferLength<=a;){if(this.eof)return null;this.readBlock()}return String.fromCharCode(this.buffer[this.pos])},getChar:function(){for(var a=this.pos;this.bufferLength<=a;){if(this.eof)return null;
this.readBlock()}return String.fromCharCode(this.buffer[this.pos++])},makeSubStream:function(a,d,g){for(var h=a+d;this.bufferLength<=h&&!this.eof;)this.readBlock();return new Stream(this.buffer,a,d,g)},skip:function(a){a||(a=1);this.pos+=a},reset:function(){this.pos=0}};return q}();return function(){function q(c){throw Error(c);}function a(c){var l=0,k=c[l++],f=c[l++];-1!=k&&-1!=f||q("Invalid header in flate stream");8!=(k&15)&&q("Unknown compression method in flate stream");0!=((k<<8)+f)%31&&q("Bad FCHECK in flate stream");
f&32&&q("FDICT bit set in flate stream");this.bytes=c;this.bytesPos=l;this.codeBuf=this.codeSize=0;A.call(this)}if(!self||!self.Uint32Array)return null;var d=new Uint32Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),g=new Uint32Array([3,4,5,6,7,8,9,10,65547,65549,65551,65553,131091,131095,131099,131103,196643,196651,196659,196667,262211,262227,262243,262259,327811,327843,327875,327907,258,258,258]),h=new Uint32Array([1,2,3,4,65541,65543,131081,131085,196625,196633,262177,262193,327745,327777,
393345,393409,459009,459137,524801,525057,590849,591361,657409,658433,724993,727041,794625,798721,868353,876545]),e=[new Uint32Array([459008,524368,524304,524568,459024,524400,524336,590016,459016,524384,524320,589984,524288,524416,524352,590048,459012,524376,524312,589968,459028,524408,524344,590032,459020,524392,524328,59E4,524296,524424,524360,590064,459010,524372,524308,524572,459026,524404,524340,590024,459018,524388,524324,589992,524292,524420,524356,590056,459014,524380,524316,589976,459030,
524412,524348,590040,459022,524396,524332,590008,524300,524428,524364,590072,459009,524370,524306,524570,459025,524402,524338,590020,459017,524386,524322,589988,524290,524418,524354,590052,459013,524378,524314,589972,459029,524410,524346,590036,459021,524394,524330,590004,524298,524426,524362,590068,459011,524374,524310,524574,459027,524406,524342,590028,459019,524390,524326,589996,524294,524422,524358,590060,459015,524382,524318,589980,459031,524414,524350,590044,459023,524398,524334,590012,524302,
524430,524366,590076,459008,524369,524305,524569,459024,524401,524337,590018,459016,524385,524321,589986,524289,524417,524353,590050,459012,524377,524313,589970,459028,524409,524345,590034,459020,524393,524329,590002,524297,524425,524361,590066,459010,524373,524309,524573,459026,524405,524341,590026,459018,524389,524325,589994,524293,524421,524357,590058,459014,524381,524317,589978,459030,524413,524349,590042,459022,524397,524333,590010,524301,524429,524365,590074,459009,524371,524307,524571,459025,
524403,524339,590022,459017,524387,524323,589990,524291,524419,524355,590054,459013,524379,524315,589974,459029,524411,524347,590038,459021,524395,524331,590006,524299,524427,524363,590070,459011,524375,524311,524575,459027,524407,524343,590030,459019,524391,524327,589998,524295,524423,524359,590062,459015,524383,524319,589982,459031,524415,524351,590046,459023,524399,524335,590014,524303,524431,524367,590078,459008,524368,524304,524568,459024,524400,524336,590017,459016,524384,524320,589985,524288,
524416,524352,590049,459012,524376,524312,589969,459028,524408,524344,590033,459020,524392,524328,590001,524296,524424,524360,590065,459010,524372,524308,524572,459026,524404,524340,590025,459018,524388,524324,589993,524292,524420,524356,590057,459014,524380,524316,589977,459030,524412,524348,590041,459022,524396,524332,590009,524300,524428,524364,590073,459009,524370,524306,524570,459025,524402,524338,590021,459017,524386,524322,589989,524290,524418,524354,590053,459013,524378,524314,589973,459029,
524410,524346,590037,459021,524394,524330,590005,524298,524426,524362,590069,459011,524374,524310,524574,459027,524406,524342,590029,459019,524390,524326,589997,524294,524422,524358,590061,459015,524382,524318,589981,459031,524414,524350,590045,459023,524398,524334,590013,524302,524430,524366,590077,459008,524369,524305,524569,459024,524401,524337,590019,459016,524385,524321,589987,524289,524417,524353,590051,459012,524377,524313,589971,459028,524409,524345,590035,459020,524393,524329,590003,524297,
524425,524361,590067,459010,524373,524309,524573,459026,524405,524341,590027,459018,524389,524325,589995,524293,524421,524357,590059,459014,524381,524317,589979,459030,524413,524349,590043,459022,524397,524333,590011,524301,524429,524365,590075,459009,524371,524307,524571,459025,524403,524339,590023,459017,524387,524323,589991,524291,524419,524355,590055,459013,524379,524315,589975,459029,524411,524347,590039,459021,524395,524331,590007,524299,524427,524363,590071,459011,524375,524311,524575,459027,
524407,524343,590031,459019,524391,524327,589999,524295,524423,524359,590063,459015,524383,524319,589983,459031,524415,524351,590047,459023,524399,524335,590015,524303,524431,524367,590079]),9],b=[new Uint32Array([327680,327696,327688,327704,327684,327700,327692,327708,327682,327698,327690,327706,327686,327702,327694,0,327681,327697,327689,327705,327685,327701,327693,327709,327683,327699,327691,327707,327687,327703,327695,0]),5];a.prototype=Object.create(A.prototype);a.prototype.getBits=function(c){for(var l=
this.codeSize,k=this.codeBuf,f=this.bytes,m=this.bytesPos,n;l<c;)"undefined"==typeof(n=f[m++])&&q("Bad encoding in flate stream"),k|=n<<l,l+=8;this.codeBuf=k>>c;this.codeSize=l-=c;this.bytesPos=m;return k&(1<<c)-1};a.prototype.getCode=function(c){var l=c[0],k=c[1];c=this.codeSize;for(var f=this.codeBuf,m=this.bytes,n=this.bytesPos;c<k;){var p;"undefined"==typeof(p=m[n++])&&q("Bad encoding in flate stream");f|=p<<c;c+=8}k=l[f&(1<<k)-1];l=k>>16;k&=65535;(0==c||c<l||0==l)&&q("Bad encoding in flate stream");
this.codeBuf=f>>l;this.codeSize=c-l;this.bytesPos=n;return k};a.prototype.generateHuffmanTable=function(c){for(var l=c.length,k=0,f=0;f<l;++f)c[f]>k&&(k=c[f]);for(var m=1<<k,n=new Uint32Array(m),p=1,r=0,v=2;p<=k;++p,r<<=1,v<<=1)for(var u=0;u<l;++u)if(c[u]==p){var t=0,w=r;for(f=0;f<p;++f)t=t<<1|w&1,w>>=1;for(f=t;f<m;f+=v)n[f]=p<<16|u;++r}return[n,k]};a.prototype.readBlock=function(){function c(t,w,x,y,z){for(t=t.getBits(x)+y;0<t--;)w[r++]=z}var l=this.getBits(3);l&1&&(this.eof=!0);l>>=1;if(0==l){var k=
this.bytes,f=this.bytesPos,m;"undefined"==typeof(m=k[f++])&&q("Bad block header in flate stream");var n=m;"undefined"==typeof(m=k[f++])&&q("Bad block header in flate stream");n|=m<<8;"undefined"==typeof(m=k[f++])&&q("Bad block header in flate stream");l=m;"undefined"==typeof(m=k[f++])&&q("Bad block header in flate stream");(l|m<<8)!=(~n&65535)&&q("Bad uncompressed block length in flate stream");this.codeSize=this.codeBuf=0;m=this.bufferLength;l=this.ensureBuffer(m+n);this.bufferLength=n=m+n;for(var p=
m;p<n;++p){if("undefined"==typeof(m=k[f++])){this.eof=!0;break}l[p]=m}this.bytesPos=f}else{if(1==l)f=e,m=b;else if(2==l){l=this.getBits(5)+257;m=this.getBits(5)+1;k=this.getBits(4)+4;f=Array(d.length);for(var r=0;r<k;)f[d[r++]]=this.getBits(3);f=this.generateHuffmanTable(f);r=k=0;m=l+m;for(n=Array(m);r<m;)p=this.getCode(f),16==p?c(this,n,2,3,k):17==p?c(this,n,3,3,k=0):18==p?c(this,n,7,11,k=0):n[r++]=k=p;f=this.generateHuffmanTable(n.slice(0,l));m=this.generateHuffmanTable(n.slice(l,m))}else q("Unknown block type in flate stream");
n=(l=this.buffer)?l.length:0;for(p=this.bufferLength;;){var v=this.getCode(f);if(256>v)p+1>=n&&(l=this.ensureBuffer(p+1),n=l.length),l[p++]=v;else{if(256==v){this.bufferLength=p;break}v-=257;v=g[v];var u=v>>16;0<u&&(u=this.getBits(u));k=(v&65535)+u;v=this.getCode(m);v=h[v];u=v>>16;0<u&&(u=this.getBits(u));v=(v&65535)+u;p+k>=n&&(l=this.ensureBuffer(p+k),n=l.length);for(u=0;u<k;++u,++p)l[p]=l[p-v]}}}};return a}()})},"esri/layers/rasterFormats/Jpg":function(){define([],function(){var A=function(){function q(a){this.message=
"JPEG error: "+a}q.prototype=Error();q.prototype.name="JpegError";return q.constructor=q}();return function(){function q(){this.decodeTransform=null;this.colorTransform=-1}function a(b,c){for(var l=0,k=[],f,m,n=16;0<n&&!b[n-1];)n--;k.push({children:[],index:0});var p=k[0],r;for(f=0;f<n;f++){for(m=0;m<b[f];m++){p=k.pop();for(p.children[p.index]=c[l];0<p.index;)p=k.pop();p.index++;for(k.push(p);k.length<=f;)k.push(r={children:[],index:0}),p.children[p.index]=r.children,p=r;l++}f+1<n&&(k.push(r={children:[],
index:0}),p.children[p.index]=r.children,p=r)}return k[0].children}function d(b,c,l,k,f,m,n,p,r){function v(){if(0<G)return G--,E>>G&1;E=b[c++];if(255===E){var L=b[c++];if(L)throw new A("unexpected marker "+(E<<8|L).toString(16));}G=7;return E>>>7}function u(L){for(;;){L=L[v()];if("number"===typeof L)return L;if("object"!==typeof L)throw new A("invalid huffman sequence");}}function t(L){for(var J=0;0<L;)J=J<<1|v(),L--;return J}function w(L){if(1===L)return 1===v()?1:-1;var J=t(L);return J>=1<<L-1?
J:J+(-1<<L)+1}function x(L,J){var O=u(L.huffmanTableDC);O=0===O?0:w(O);L.blockData[J]=L.pred+=O;for(O=1;64>O;){var S=u(L.huffmanTableAC),R=S&15;S>>=4;if(0===R){if(15>S)break;O+=16}else O+=S,L.blockData[J+e[O]]=w(R),O++}}function y(L,J){var O=u(L.huffmanTableDC);O=0===O?0:w(O)<<r;L.blockData[J]=L.pred+=O}function z(L,J){L.blockData[J]|=v()<<r}function B(L,J){if(0<H)H--;else for(var O=m;O<=n;){var S=u(L.huffmanTableAC),R=S&15;S>>=4;if(0===R){if(15>S){H=t(S)+(1<<S)-1;break}O+=16}else O+=S,L.blockData[J+
e[O]]=w(R)*(1<<r),O++}}function F(L,J){for(var O=m,S=0,R;O<=n;){R=e[O];switch(K){case 0:S=u(L.huffmanTableAC);R=S&15;S>>=4;if(0===R)15>S?(H=t(S)+(1<<S),K=4):(S=16,K=1);else{if(1!==R)throw new A("invalid ACn encoding");M=w(R);K=S?2:3}continue;case 1:case 2:L.blockData[J+R]?L.blockData[J+R]+=v()<<r:(S--,0===S&&(K=2===K?3:0));break;case 3:L.blockData[J+R]?L.blockData[J+R]+=v()<<r:(L.blockData[J+R]=M<<r,K=0);break;case 4:L.blockData[J+R]&&(L.blockData[J+R]+=v()<<r)}O++}4===K&&(H--,0===H&&(K=0))}var D=
l.mcusPerLine,C=c,E=0,G=0,H=0,K=0,M,I=k.length,N,ea,T,W;p=l.progressive?0===m?0===p?y:z:0===p?B:F:x;var P=0;l=1===I?k[0].blocksPerLine*k[0].blocksPerColumn:D*l.mcusPerColumn;for(var Z,ma;P<l;){var ka=f?Math.min(l-P,f):l;for(N=0;N<I;N++)k[N].pred=0;H=0;if(1===I){var Q=k[0];for(W=0;W<ka;W++)p(Q,64*((Q.blocksPerLine+1)*(P/Q.blocksPerLine|0)+P%Q.blocksPerLine)),P++}else for(W=0;W<ka;W++){for(N=0;N<I;N++)for(Q=k[N],Z=Q.h,ma=Q.v,ea=0;ea<ma;ea++)for(T=0;T<Z;T++)p(Q,64*((Q.blocksPerLine+1)*((P/D|0)*Q.v+ea)+
(P%D*Q.h+T)));P++}G=0;(Q=h(b,c))&&Q.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+Q.invalid),c=Q.offset);Q=Q&&Q.marker;if(!Q||65280>=Q)throw new A("marker was not found");if(65488<=Q&&65495>=Q)c+=2;else break}(Q=h(b,c))&&Q.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+Q.invalid),c=Q.offset);return c-C}function g(b,c){b=c.blocksPerLine;for(var l=c.blocksPerColumn,k=new Int16Array(64),f=0;f<l;f++)for(var m=0;m<b;m++){var n=void 0,p=void 0,r=
void 0,v=void 0,u=void 0,t=void 0,w=void 0,x=void 0,y=u=t=v=p=n=void 0,z=void 0,B=void 0,F=void 0,D=64*((c.blocksPerLine+1)*f+m),C=k,E=c.quantizationTable,G=c.blockData;if(!E)throw new A("missing required Quantization Table.");for(var H=0;64>H;H+=8)n=G[D+H],x=G[D+H+1],w=G[D+H+2],t=G[D+H+3],u=G[D+H+4],v=G[D+H+5],r=G[D+H+6],p=G[D+H+7],n*=E[H],0===(x|w|t|u|v|r|p)?(n=5793*n+512>>10,C[H]=n,C[H+1]=n,C[H+2]=n,C[H+3]=n,C[H+4]=n,C[H+5]=n,C[H+6]=n,C[H+7]=n):(x*=E[H+1],w*=E[H+2],t*=E[H+3],u*=E[H+4],v*=E[H+5],
r*=E[H+6],p*=E[H+7],F=5793*n+128>>8,B=5793*u+128>>8,z=w,y=r,u=2896*(x-p)+128>>8,p=2896*(x+p)+128>>8,t<<=4,v<<=4,F=F+B+1>>1,B=F-B,n=3784*z+1567*y+128>>8,z=1567*z-3784*y+128>>8,y=n,u=u+v+1>>1,v=u-v,p=p+t+1>>1,t=p-t,F=F+y+1>>1,y=F-y,B=B+z+1>>1,z=B-z,n=2276*u+3406*p+2048>>12,u=3406*u-2276*p+2048>>12,p=n,n=799*t+4017*v+2048>>12,t=4017*t-799*v+2048>>12,v=n,C[H]=F+p,C[H+7]=F-p,C[H+1]=B+v,C[H+6]=B-v,C[H+2]=z+t,C[H+5]=z-t,C[H+3]=y+u,C[H+4]=y-u);for(E=0;8>E;++E)n=C[E],x=C[E+8],w=C[E+16],t=C[E+24],u=C[E+32],
v=C[E+40],r=C[E+48],p=C[E+56],0===(x|w|t|u|v|r|p)?(n=5793*n+8192>>14,n=-2040>n?0:2024<=n?255:n+2056>>4,G[D+E]=n,G[D+E+8]=n,G[D+E+16]=n,G[D+E+24]=n,G[D+E+32]=n,G[D+E+40]=n,G[D+E+48]=n,G[D+E+56]=n):(F=5793*n+2048>>12,B=5793*u+2048>>12,z=w,y=r,u=2896*(x-p)+2048>>12,p=2896*(x+p)+2048>>12,F=(F+B+1>>1)+4112,B=F-B,n=3784*z+1567*y+2048>>12,z=1567*z-3784*y+2048>>12,y=n,u=u+v+1>>1,v=u-v,p=p+t+1>>1,t=p-t,F=F+y+1>>1,y=F-y,B=B+z+1>>1,z=B-z,n=2276*u+3406*p+2048>>12,u=3406*u-2276*p+2048>>12,p=n,n=799*t+4017*v+2048>>
12,t=4017*t-799*v+2048>>12,v=n,n=F+p,p=F-p,x=B+v,r=B-v,w=z+t,v=z-t,t=y+u,u=y-u,n=16>n?0:4080<=n?255:n>>4,x=16>x?0:4080<=x?255:x>>4,w=16>w?0:4080<=w?255:w>>4,t=16>t?0:4080<=t?255:t>>4,u=16>u?0:4080<=u?255:u>>4,v=16>v?0:4080<=v?255:v>>4,r=16>r?0:4080<=r?255:r>>4,p=16>p?0:4080<=p?255:p>>4,G[D+E]=n,G[D+E+8]=x,G[D+E+16]=w,G[D+E+24]=t,G[D+E+32]=u,G[D+E+40]=v,G[D+E+48]=r,G[D+E+56]=p)}return c.blockData}function h(b,c,l){var k=b.length-1;l=l<c?l:c;if(c>=k)return null;var f=b[c]<<8|b[c+1];if(65472<=f&&65534>=
f)return{invalid:null,marker:f,offset:c};for(c=b[l]<<8|b[l+1];!(65472<=c&&65534>=c);){if(++l>=k)return null;c=b[l]<<8|b[l+1]}return{invalid:f.toString(16),marker:c,offset:l}}if(!self||!self.Uint8ClampedArray)return null;var e=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]);q.prototype={parse:function(b){function c(){var E=b[f]<<8|b[f+1];f+=2;return E}
function l(){var E=c();E=f+E-2;var G=h(b,E,f);G&&G.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+G.invalid),E=G.offset);E=b.subarray(f,E);f+=E.length;return E}function k(E){for(var G=Math.ceil(E.samplesPerLine/8/E.maxH),H=Math.ceil(E.scanLines/8/E.maxV),K=0;K<E.components.length;K++){C=E.components[K];var M=Math.ceil(Math.ceil(E.samplesPerLine/8)*C.h/E.maxH),I=Math.ceil(Math.ceil(E.scanLines/8)*C.v/E.maxV);C.blockData=new Int16Array(64*H*C.v*(G*C.h+1));C.blocksPerLine=
M;C.blocksPerColumn=I}E.mcusPerLine=G;E.mcusPerColumn=H}var f=0,m=null,n=null,p=[],r=[],v=[],u=c();if(65496!==u)throw new A("SOI not found");for(u=c();65497!==u;){switch(u){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var t=l();65504===u&&74===t[0]&&70===t[1]&&73===t[2]&&70===t[3]&&0===t[4]&&(m={version:{major:t[5],minor:t[6]},densityUnits:t[7],xDensity:t[8]<<
8|t[9],yDensity:t[10]<<8|t[11],thumbWidth:t[12],thumbHeight:t[13],thumbData:t.subarray(14,14+3*t[12]*t[13])});65518===u&&65===t[0]&&100===t[1]&&111===t[2]&&98===t[3]&&101===t[4]&&(n={version:t[5]<<8|t[6],flags0:t[7]<<8|t[8],flags1:t[9]<<8|t[10],transformCode:t[11]});break;case 65499:u=c()+f-2;for(var w;f<u;){var x=b[f++],y=new Uint16Array(64);if(0===x>>4)for(t=0;64>t;t++)w=e[t],y[w]=b[f++];else if(1===x>>4)for(t=0;64>t;t++)w=e[t],y[w]=c();else throw new A("DQT - invalid table spec");p[x&15]=y}break;
case 65472:case 65473:case 65474:if(z)throw new A("Only single frame JPEGs supported");c();var z={};z.extended=65473===u;z.progressive=65474===u;z.precision=b[f++];z.scanLines=c();z.samplesPerLine=c();z.components=[];z.componentIds={};t=b[f++];for(u=y=x=0;u<t;u++){w=b[f];var B=b[f+1]>>4;var F=b[f+1]&15;x<B&&(x=B);y<F&&(y=F);B=z.components.push({h:B,v:F,quantizationId:b[f+2],quantizationTable:null});z.componentIds[w]=B-1;f+=3}z.maxH=x;z.maxV=y;k(z);break;case 65476:w=c();for(u=2;u<w;){x=b[f++];y=new Uint8Array(16);
for(t=B=0;16>t;t++,f++)B+=y[t]=b[f];F=new Uint8Array(B);for(t=0;t<B;t++,f++)F[t]=b[f];u+=17+B;(0===x>>4?v:r)[x&15]=a(y,F)}break;case 65501:c();var D=c();break;case 65498:c();w=b[f++];t=[];for(u=0;u<w;u++){x=z.componentIds[b[f++]];var C=z.components[x];x=b[f++];C.huffmanTableDC=v[x>>4];C.huffmanTableAC=r[x&15];t.push(C)}u=b[f++];w=b[f++];x=b[f++];u=d(b,f,z,t,D,u,w,x>>4,x&15);f+=u;break;case 65535:255!==b[f]&&f--;break;default:if(255===b[f-3]&&192<=b[f-2]&&254>=b[f-2])f-=3;else throw new A("unknown marker "+
u.toString(16));}u=c()}this.width=z.samplesPerLine;this.height=z.scanLines;this.jfif=m;this.eof=f;this.adobe=n;this.components=[];for(u=0;u<z.components.length;u++){C=z.components[u];if(m=p[C.quantizationId])C.quantizationTable=m;this.components.push({output:g(z,C),scaleX:C.h/z.maxH,scaleY:C.v/z.maxV,blocksPerLine:C.blocksPerLine,blocksPerColumn:C.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(b,c){var l=this.width/b,k=this.height/c,f,m,n=0,p=this.components.length,
r=b*c*p,v=new Uint8ClampedArray(r),u=new Uint32Array(b);for(m=0;m<p;m++){var t=this.components[m];var w=t.scaleX*l;var x=t.scaleY*k;n=m;var y=t.output;var z=t.blocksPerLine+1<<3;for(f=0;f<b;f++)t=0|f*w,u[f]=(t&4294967288)<<3|t&7;for(w=0;w<c;w++)for(t=0|w*x,t=z*(t&4294967288)|(t&7)<<3,f=0;f<b;f++)v[n]=y[t+u[f]],n+=p}if(c=this.decodeTransform)for(m=0;m<r;)for(b=t=0;t<p;t++,m++,b+=2)v[m]=(v[m]*c[b]>>8)+c[b+1];return v},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:
3===this.numComponents?0===this.colorTransform?!1:!0:1===this.colorTransform?!0:!1},_convertYccToRgb:function(b){for(var c,l,k,f=0,m=b.length;f<m;f+=3)c=b[f],l=b[f+1],k=b[f+2],b[f]=c-179.456+1.402*k,b[f+1]=c+135.459-.344*l-.714*k,b[f+2]=c-226.816+1.772*l;return b},_convertYcckToRgb:function(b){for(var c,l,k,f,m=0,n=0,p=b.length;n<p;n+=4)c=b[n],l=b[n+1],k=b[n+2],f=b[n+3],b[m++]=-122.67195406894+l*(-6.60635669420364E-5*l+4.37130475926232E-4*k-5.4080610064599E-5*c+4.8449797120281E-4*f-.154362151871126)+
k*(-9.57964378445773E-4*k+8.17076911346625E-4*c-.00477271405408747*f+1.53380253221734)+c*(9.61250184130688E-4*c-.00266257332283933*f+.48357088451265)+f*(-3.36197177618394E-4*f+.484791561490776),b[m++]=107.268039397724+l*(2.19927104525741E-5*l-6.40992018297945E-4*k+6.59397001245577E-4*c+4.26105652938837E-4*f-.176491792462875)+k*(-7.78269941513683E-4*k+.00130872261408275*c+7.70482631801132E-4*f-.151051492775562)+c*(.00126935368114843*c-.00265090189010898*f+.25802910206845)+f*(-3.18913117588328E-4*f-
.213742400323665),b[m++]=-20.810012546947+l*(-5.70115196973677E-4*l-2.63409051004589E-5*k+.0020741088115012*c-.00288260236853442*f+.814272968359295)+k*(-1.53496057440975E-5*k-1.32689043961446E-4*c+5.60833691242812E-4*f-.195152027534049)+c*(.00174418132927582*c-.00255243321439347*f+.116935020465145)+f*(-3.43531996510555E-4*f+.24165260232407);return b},_convertYcckToCmyk:function(b){for(var c,l,k,f=0,m=b.length;f<m;f+=4)c=b[f],l=b[f+1],k=b[f+2],b[f]=434.456-c-1.402*k,b[f+1]=119.541-c+.344*l+.714*k,
b[f+2]=481.816-c-1.772*l;return b},_convertCmykToRgb:function(b){for(var c,l,k,f,m=0,n=1/255,p=0,r=b.length;p<r;p+=4)c=b[p]*n,l=b[p+1]*n,k=b[p+2]*n,f=b[p+3]*n,b[m++]=255+c*(-4.387332384609988*c+54.48615194189176*l+18.82290502165302*k+212.25662451639585*f-285.2331026137004)+l*(1.7149763477362134*l-5.6096736904047315*k-17.873870861415444*f-5.497006427196366)+k*(-2.5217340131683033*k-21.248923337353073*f+17.5119270841813)-f*(21.86122147463605*f+189.48180835922747),b[m++]=255+c*(8.841041422036149*c+60.118027045597366*
l+6.871425592049007*k+31.159100130055922*f-79.2970844816548)+l*(-15.310361306967817*l+17.575251261109482*k+131.35250912493976*f-190.9453302588951)+k*(4.444339102852739*k+9.8632861493405*f-24.86741582555878)-f*(20.737325471181034*f+187.80453709719578),b[m++]=255+c*(.8842522430003296*c+8.078677503112928*l+30.89978309703729*k-.23883238689178934*f-14.183576799673286)+l*(10.49593273432072*l+63.02378494754052*k+50.606957656360734*f-112.23884253719248)+k*(.03296041114873217*k+115.60384449646641*f-193.58209356861505)-
f*(22.33816807309886*f+180.12613974708367);return b},getData:function(b,c,l){if(4<this.numComponents)throw new A("Unsupported color mode");b=this._getLinearizedBlockData(b,c);if(1===this.numComponents&&l){l=b.length;c=new Uint8ClampedArray(3*l);for(var k=0,f=0;f<l;f++){var m=b[f];c[k++]=m;c[k++]=m;c[k++]=m}return c}if(3===this.numComponents&&this._isColorConversionNeeded())return this._convertYccToRgb(b);if(4===this.numComponents){if(this._isColorConversionNeeded())return l?this._convertYcckToRgb(b):
this._convertYcckToCmyk(b);if(l)return this._convertCmykToRgb(b)}return b}};return q}()})},"esri/layers/rasterFormats/Png":function(){define(["./Zlib"],function(A){return function(){function q(d){var g,h;this.data=d;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(h=null;;){var e=this.readUInt32();var b=d=void 0;d=[];for(b=0;4>b;++b)d.push(String.fromCharCode(this.data[this.pos++]));d=d.join("");switch(d){case "IHDR":this.width=this.readUInt32();
this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};break;case "PLTE":this.palette=this.read(e);break;case "fcTL":h&&this.animation.frames.push(h);this.pos+=4;h={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),
yOffset:this.readUInt32()};d=this.readUInt16();e=this.readUInt16()||100;h.delay=1E3*d/e;h.disposeOp=this.data[this.pos++];h.blendOp=this.data[this.pos++];h.data=[];break;case "IDAT":case "fdAT":"fdAT"===d&&(this.pos+=4,e-=4);d=(null!=h?h.data:void 0)||this.imgData;for(b=0;0<=e?b<e:b>e;0<=e?++b:--b)d.push(this.data[this.pos++]);break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=this.read(e);e=255-this.transparency.indexed.length;if(0<e)for(d=0;0<=e?d<e:d>
e;0<=e?++d:--d)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(e)[0];break;case 2:this.transparency.rgb=this.read(e)}break;case "tEXt":b=this.read(e);e=b.indexOf(0);d=String.fromCharCode.apply(String,b.slice(0,e));this.text[d]=String.fromCharCode.apply(String,b.slice(e+1));break;case "IEND":h&&this.animation.frames.push(h);a:{switch(this.colorType){case 0:case 3:case 4:h=1;break a;case 2:case 6:h=3;break a}h=void 0}this.colors=h;this.hasAlphaChannel=4===(g=this.colorType)||
6===g;g=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*g;a:{switch(this.colors){case 1:g="DeviceGray";break a;case 3:g="DeviceRGB";break a}g=void 0}this.colorSpace=g;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=e}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");}}q.load=function(d,g,h){"function"===typeof g&&(h=g);var e=new XMLHttpRequest;e.open("GET",d,!0);e.responseType="arraybuffer";e.onload=function(){var b=new Uint8Array(e.response||
e.mozResponseArrayBuffer);b=new q(b);"function"===typeof(null!=g?g.getContext:void 0)&&b.render(g);return"function"===typeof h?h(b):void 0};return e.send(null)};q.prototype.read=function(d){var g;var h=[];for(g=0;0<=d?g<d:g>d;0<=d?++g:--g)h.push(this.data[this.pos++]);return h};q.prototype.readUInt32=function(){var d=this.data[this.pos++]<<24;var g=this.data[this.pos++]<<16;var h=this.data[this.pos++]<<8;var e=this.data[this.pos++];return d|g|h|e};q.prototype.readUInt16=function(){var d=this.data[this.pos++]<<
8;var g=this.data[this.pos++];return d|g};q.prototype.decodePixels=function(d){var g,h,e,b,c,l,k,f;null==d&&(d=this.imgData);if(0===d.length)return new Uint8Array(0);d=new A(d);d=d.getBytes();var m=this.pixelBitlength/8;var n=m*this.width;var p=new Uint8Array(n*this.height);var r=d.length;for(h=b=c=0;b<r;){switch(d[b++]){case 0:for(e=g=0;g<n;e=g+=1)p[h++]=d[b++];break;case 1:for(e=l=0;l<n;e=l+=1){g=d[b++];var v=e<m?0:p[h-m];p[h++]=(g+v)%256}break;case 2:for(e=v=0;v<n;e=v+=1){g=d[b++];var u=(e-e%m)/
m;l=c&&p[(c-1)*n+u*m+e%m];p[h++]=(l+g)%256}break;case 3:for(e=f=0;f<n;e=f+=1)g=d[b++],u=(e-e%m)/m,v=e<m?0:p[h-m],l=c&&p[(c-1)*n+u*m+e%m],p[h++]=(g+Math.floor((v+l)/2))%256;break;case 4:for(e=f=0;f<n;e=f+=1){g=d[b++];u=(e-e%m)/m;v=e<m?0:p[h-m];0===c?l=k=0:(l=p[(c-1)*n+u*m+e%m],k=u&&p[(c-1)*n+(u-1)*m+e%m]);var t=v+l-k;e=Math.abs(t-v);u=Math.abs(t-l);t=Math.abs(t-k);v=e<=u&&e<=t?v:u<=t?l:k;p[h++]=(g+v)%256}break;default:throw Error("Invalid filter algorithm: "+d[b-1]);}c++}return p};q.prototype.decodePalette=
function(){var d,g,h,e,b;var c=this.palette;var l=this.transparency.indexed||[];var k=new Uint8Array((l.length||0)+c.length);var f=h=d=g=0;for(e=c.length;h<e;f=h+=3)k[g++]=c[f],k[g++]=c[f+1],k[g++]=c[f+2],k[g++]=null!=(b=l[d++])?b:255;return k};q.prototype.copyToImageData=function(d,g){var h,e;var b=this.colors;var c=null;var l=this.hasAlphaChannel;this.palette.length&&(c=null!=(h=this._decodedPalette)?h:this._decodedPalette=this.decodePalette(),b=4,l=!0);d=d.data||d;var k=d.length;var f=c||g;h=e=
0;if(1===b)for(;h<k;)b=c?4*g[h/4]:e,e=f[b++],d[h++]=e,d[h++]=e,d[h++]=e,d[h++]=l?f[b++]:this.transparency.grayscale&&this.transparency.grayscale===e?0:255,e=b;else for(;h<k;)b=c?4*g[h/4]:e,d[h++]=f[b++],d[h++]=f[b++],d[h++]=f[b++],d[h++]=l?f[b++]:this.transparency.rgb&&this.transparency.rgb[1]===f[b-3]&&this.transparency.rgb[3]===f[b-2]&&this.transparency.rgb[5]===f[b-1]?0:255,e=b};q.prototype.decode=function(){var d=new Uint8Array(this.width*this.height*4);this.copyToImageData(d,this.decodePixels());
return d};var a=function(d){(void 0).clearRect(0,0,d.width,d.height);(void 0).putImageData(d,0,0);d=new Image;d.src=(void 0).toDataURL();return d};q.prototype.decodeFrames=function(d){var g,h;if(this.animation){var e=this.animation.frames;var b=[];var c=g=0;for(h=e.length;g<h;c=++g){c=e[c];var l=d.createImageData(c.width,c.height);var k=this.decodePixels(new Uint8Array(c.data));this.copyToImageData(l,k);c.imageData=l;b.push(c.image=a(l))}return b}};q.prototype.renderFrame=function(d,g){var h=this.animation.frames;
var e=h[g];h=h[g-1];0===g&&d.clearRect(0,0,this.width,this.height);1===(null!=h?h.disposeOp:void 0)?d.clearRect(h.xOffset,h.yOffset,h.width,h.height):2===(null!=h?h.disposeOp:void 0)&&d.putImageData(h.imageData,h.xOffset,h.yOffset);0===e.blendOp&&d.clearRect(e.xOffset,e.yOffset,e.width,e.height);return d.drawImage(e.image,e.xOffset,e.yOffset)};q.prototype.animate=function(d){var g,h=this;var e=0;var b=this.animation;var c=b.numFrames;var l=b.frames;var k=b.numPlays;return(g=function(){var f=e++%c;
var m=l[f];h.renderFrame(d,f);if(1<c&&e/c<k)return h.animation._timeout=setTimeout(g,m.delay)})()};q.prototype.stopAnimation=function(){var d;return clearTimeout(null!=(d=this.animation)?d._timeout:void 0)};q.prototype.render=function(d){d._png&&d._png.stopAnimation();d._png=this;d.width=this.width;d.height=this.height;d=d.getContext("2d");if(this.animation)return this.decodeFrames(d),this.animate(d);var g=d.createImageData(this.width,this.height);this.copyToImageData(g,this.decodePixels());return d.putImageData(g,
0,0)};return q}()})},"esri/layers/rasterFormats/Raw":function(){define([],function(){return{decodeBIP:function(A,q){var a=q.pixelType,d=q.bandCount,g=[],h=q.width*q.height,e=this.getBandCount(A,q);d=d||e;var b=A.byteLength-A.byteLength%(h*this._getPixelLength(a)),c=new a(A,0,h*e),l,k,f;for(l=0;l<d;l++){var m=new a(h);for(k=0;k<h;k++)m[k]=c[k*e+l];g.push(m)}b<A.byteLength-1&&(f=this._decodeMask(A.slice(b),q));return{pixels:g,maskData:f}},decodeBSQ:function(A,q){var a=q.pixelType,d=q.bandCount;if(void 0===
d||null===d)d=this.getBandCount(A,q);var g=[],h=q.width*q.height,e=h*d,b=A.byteLength-A.byteLength%(h*this._getPixelLength(a));a=new a(A,0,e);var c;for(e=0;e<d;e++)g.push(a.subarray(e*h,(e+1)*h));b<A.byteLength-1&&(c=this._decodeMask(A.slice(b),q));return{pixels:g,maskData:c}},getBandCount:function(A,q){return Math.floor(A.byteLength/(q.width*q.height*this._getPixelLength(q.pixelType)))},_getPixelLength:function(A){var q=1;switch(A){case Uint8Array:case Int8Array:case Uint8ClampedArray:q=1;break;
case Uint16Array:case Int16Array:q=2;break;case Uint32Array:case Int32Array:case Float32Array:q=4;break;case Float64Array:q=8}return q},_decodeMask:function(A,q){var a=q.width*q.height;if(8*A.byteLength<a)return null;A=new Uint8Array(A,0,Math.ceil(a/8));q=new Uint8Array(q.width*q.height);var d=0,g=0,h=0,e=0;for(h=0;h<A.length-1;h++)for(g=A[h],e=7;0<=e;e--)q[d++]=g>>e&1;for(e=7;d<a-1;)g=A[A.length-1],q[d++]=g>>e&1,e--;return q}}})},"esri/layers/rasterFormats/TiffDecoder":function(){define(["./Jpg",
"./Zlib"],function(A,q){var a=function(){var e=new ArrayBuffer(4),b=new Uint8Array(e);e=new Uint32Array(e);b[0]=1;b[1]=2;b[2]=3;b[3]=4;return 67305985===e[0]},d=function(){var e=[];e[254]="NEWSUBFILETYPE";e[255]="SUBFILETYPE";e[256]="IMAGEWIDTH";e[257]="IMAGELENGTH";e[258]="BITSPERSAMPLE";e[259]="COMPRESSION";e[262]="PHOTOMETRICINTERPRETATION";e[263]="THRESHHOLDING";e[264]="CELLWIDTH";e[265]="CELLLENGTH";e[266]="FILLORDER";e[269]="DOCUMENTNAME";e[270]="IMAGEDESCRIPTION";e[271]="MAKE";e[272]="MODEL";
e[273]="STRIPOFFSETS";e[274]="ORIENTATION";e[277]="SAMPLESPERPIXEL";e[278]="ROWSPERSTRIP";e[279]="STRIPBYTECOUNTS";e[280]="MINSAMPLEVALUE";e[281]="MAXSAMPLEVALUE";e[282]="XRESOLUTION";e[283]="YRESOLUTION";e[284]="PLANARCONFIGURATION";e[285]="PAGENAME";e[286]="XPOSITION";e[287]="YPOSITION";e[288]="FREEOFFSETS";e[289]="FREEBYTECOUNTS";e[290]="GRAYRESPONSEUNIT";e[291]="GRAYRESPONSECURVE";e[292]="T4OPTIONS";e[293]="T6OPTIONS";e[296]="RESOLUTIONUNIT";e[297]="PAGENUMBER";e[300]="COLORRESPONSEUNIT";e[301]=
"TRANSFERFUNCTION";e[305]="SOFTWARE";e[306]="DATETIME";e[315]="ARTIST";e[316]="HOSTCOMPUTER";e[317]="PREDICTOR";e[318]="WHITEPOINT";e[319]="PRIMARYCHROMATICITIES";e[320]="COLORMAP";e[321]="HALFTONEHINTS";e[322]="TILEWIDTH";e[323]="TILELENGTH";e[324]="TILEOFFSETS";e[325]="TILEBYTECOUNTS";e[326]="BADFAXLINES";e[327]="CLEANFAXDATA";e[328]="CONSECUTIVEBADFAXLINES";e[330]="SUBIFD";e[332]="INKSET";e[333]="INKNAMES";e[334]="NUMBEROFINKS";e[336]="DOTRANGE";e[337]="TARGETPRINTER";e[338]="EXTRASAMPLES";e[339]=
"SAMPLEFORMAT";e[340]="SMINSAMPLEVALUE";e[341]="SMAXSAMPLEVALUE";e[342]="TRANSFERRANGE";e[347]="JPEGTABLES";e[512]="JPEGPROC";e[513]="JPEGIFOFFSET";e[514]="JPEGIFBYTECOUNT";e[515]="JPEGRESTARTINTERVAL";e[517]="JPEGLOSSLESSPREDICTORS";e[518]="JPEGPOINTTRANSFORM";e[519]="JPEGQTABLES";e[520]="JPEGDCTABLES";e[521]="JPEGACTABLES";e[529]="YCBCRCOEFFICIENTS";e[530]="YCBCRSUBSAMPLING";e[531]="YCBCRPOSITIONING";e[532]="REFERENCEBLACKWHITE";e[33550]="GEOPIXELSCALE";e[33922]="GEOTIEPOINTS";e[33432]="COPYRIGHT";
e[42112]="GDAL_METADATA";e[42113]="GDAL_NODATA";e[50844]="RPCCOEFFICIENT";e[34735]="GEOKEYDIRECTORY";e[34736]="GEODOUBLEPARAMS";e[34737]="GEOASCIIPARAMS";return e}(),g=[0,1,1,2,4,8,1,1,2,4,8,4,8],h=function(e,b){var c="UNKNOWN";3===e?c="F32":1===e?8>=b?c="U8":16>=b?c="U16":32>=b&&(c="U32"):2===e&&(8>=b?c="S8":16>=b?c="S16":32>=b&&(c="S32"));return c};return{decode:function(e){var b=new DataView(e,0,8),c=b.getUint16(0,!1);if(18761===c)var l=!0;else if(19789===c)l=!1;else throw"unexpected endianess byte";
if(42!==b.getUint16(2,l))throw"unexpected tiff identifier";var k=b.getUint32(4,l);var f=l;var m,n;var p=k;for(var r=[];p;){var v=(new DataView(e,p,2)).getUint16(0,f);var u=p+2;p=(new DataView(e,u+12*v,4)).getUint32(0,f);var t={};for(m=0;m<v;m++){var w=new DataView(e,u,12);var x=w.getUint16(0,f);var y=w.getUint16(2,f);var z=w.getUint32(4,f);var B=w.getUint32(8,f);u+=12;if(!(7===y||12<y)){var F=n={fieldTag:x,fieldType:y,fieldValueCount:z,fieldValueOffset:B},D=void 0,C=void 0,E=e,G=f,H=[],K=n.fieldType,
M=n.fieldValueCount,I=n.fieldValueOffset,N=I,ea=g[K],T=8*ea,W=M*ea,P=M*g[K]*8;if(32>=P)if(G||(I>>>=32-P),1===M)H=[I];else for(D=0;D<M;D++)H.push(I<<T*D>>>32-T);else for(N=I;N<I+W;N+=ea){switch(K){case 1:C=(new DataView(E,N,1)).getUint8(0);break;case 2:C=(new DataView(E,N,1)).getUint8(0);break;case 3:C=(new DataView(E,N,2)).getUint16(0,G);break;case 4:C=(new DataView(E,N,4)).getUint32(0,G);break;case 5:C=(new DataView(E,N,4)).getUint32(0,G)/(new DataView(E,N+4,4)).getUint32(0,G);break;case 6:C=(new DataView(E,
N,1)).getInt8(0);break;case 8:C=(new DataView(E,N,2)).getInt16(0,G);break;case 9:C=(new DataView(E,N,4)).getInt32(0,G);break;case 10:C=(new DataView(E,N,4)).getInt32(0,G)/(new DataView(E,N+4,4)).getInt32(0,G);break;case 11:C=(new DataView(E,N,4)).getFloat32(0,G);break;case 12:C=(new DataView(E,N,8)).getFloat64(0,G);break;case 7:C=null;break;default:C=null}H.push(C)}if(2===K){var Z="",ma=H;H=[];for(D=0;D<ma.length;D++)0===ma[D]&&""!==Z?(H.push(Z),Z=""):Z+=String.fromCharCode(ma[D]);""===Z&&0!==H.length||
H.push(Z)}F.fieldValues=H;var ka=t,Q=d[x];void 0===Q&&(Q="unknown"+x);ka[Q]={type:y,values:n.fieldValues}}}r.push(t)}if(0===r.length)throw"no valid image file directory";var L,J=r[0],O=void 0===J.GDAL_NODATA||null===J.GDAL_NODATA?null:parseFloat(J.GDAL_NODATA.values[0]);if(J.TILEOFFSETS){var S=a()===f,R=J.TILEOFFSETS?J.TILEOFFSETS.values:void 0;if(void 0===R)var aa=void 0;else{var sa=J.TILEBYTECOUNTS.values,ta=J.TILEWIDTH.values[0],Ca=J.TILELENGTH.values[0],Da=J.IMAGEWIDTH.values[0],Sa=J.IMAGELENGTH.values[0],
na=Da*Sa,ha=J.BITSPERSAMPLE.values[0],ba=J.SAMPLESPERPIXEL.values[0],Ea=J.SAMPLEFORMAT?J.SAMPLEFORMAT.values[0]:1,Ma=h(Ea,ha);if(1!==(J.PLANARCONFIGURATION?J.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),"can only handle PLANARCONFIGURATION\x3d1";var la=J.COMPRESSION?J.COMPRESSION.values[0]:1;if(1!==la&&6!==la&&8!==la&&32946!==la)throw console.log("this compression is not supported at this moment"),"this compression is not supported at this moment";
if(3<Ea)aa=void 0;else{if(3===Ea){var oa=new Float32Array(na*ba);var ua=Float32Array}else 1===Ea?8>=ha?(oa=new Uint8Array(na*ba),ua=Uint8Array):16>=ha?(oa=new Uint16Array(na*ba),ua=Uint16Array):32>=ha&&(oa=new Uint32Array(na*ba),ua=Uint32Array):2===Ea&&(8>=ha?(oa=new Int8Array(na*ba),ua=Int8Array):16>=ha?(oa=new Int16Array(na*ba),ua=Int16Array):32>=ha&&(oa=new Int32Array(na*ba),ua=Int32Array));var V,Fa,ca,Ga,Ta,Ya=Math.ceil(Da/ta);if(0===ha%8)for(V=0;V<R.length;V++){var Za=Math.floor(V/Ya)*Ca;var $a=
V%Ya*ta;var ab=(Za*Da+$a)*ba;if("U8"===Ma||"S8"===Ma||S)if(8===la||32946===la){var X=new Uint8Array(e,R[V],sa[V]);var Ua=new q(X);var bb=Ua.getBytes();var pa=new ArrayBuffer(bb.length);X=new Uint8Array(pa);X.set(bb);X.length!==ta*Ca*ba*ha/8&&console.log("tile byte counts is different than expected")}else if(6===la){X=new Uint8Array(e,R[V],sa[V]);var Na=new A;Na.parse(X);var cb=Na.getData(Na.width,Na.height);pa=new ArrayBuffer(cb.length);X=new Uint8Array(pa);X.set(cb)}else 1===la&&(sa[V]!==ta*Ca*ba*
ha/8&&console.log("tile byte counts is different than expected"),pa=e.slice(R[V],R[V]+sa[V]));else{if(8===la||32946===la){X=new Uint8Array(e,R[V],sa[V]);Ua=new q(X);X=Ua.getBytes();pa=new ArrayBuffer(X.length);var Aa=new Uint8Array(pa);X.length!==ta*Ca*ba*ha/8&&console.log("tile byte counts is different than expected")}else 1===la&&(sa[V]!==ta*Ca*ba*ha/8&&console.log("tile byte counts is different than expected"),pa=new ArrayBuffer(sa[V]),X=new Uint8Array(e,R[V],sa[V]),Aa=new Uint8Array(pa));switch(Ma){case "U16":case "S16":for(ca=
0;ca<X.length;ca+=2)Aa[ca]=X[ca+1],Aa[ca+1]=X[ca];break;case "U32":case "S32":case "F32":for(ca=0;ca<X.length;ca+=4)Aa[ca]=X[ca+3],Aa[ca+1]=X[ca+2],Aa[ca+2]=X[ca+1],Aa[ca+3]=X[ca]}}var hb=new ua(pa);var Va=0;var Wa=ab;var ib=Math.min(ta,Da-$a);var jb=Math.min(Ca,Sa-Za);for(Ga=0;Ga<jb;Ga++)for(Wa=ab+Ga*Da*ba,Va=Ga*ta*ba,Ta=0;Ta<ib*ba;Ta++,Wa++,Va++)oa[Wa]=hb[Va]}var Oa={width:Da,height:Sa,pixelType:Ma};if(1===ba)Oa.pixels=[oa];else for(Oa.pixels=[],V=0;V<ba;V++){var db=new ua(na);for(Fa=0;Fa<na;Fa++)db[Fa]=
oa[Fa*ba+V];Oa.pixels.push(db)}aa=Oa}}}else if(J.STRIPOFFSETS){var kb=a()===f,va=J.STRIPOFFSETS?J.STRIPOFFSETS.values:void 0;if(void 0===va)aa=void 0;else{var wa=J.STRIPBYTECOUNTS.values,Ha=J.ROWSPERSTRIP.values,xa=J.IMAGEWIDTH.values[0],Ia=J.IMAGELENGTH.values[0],ya=xa*Ia,ia=J.BITSPERSAMPLE.values[0],fa=J.SAMPLESPERPIXEL.values[0],Ja=J.SAMPLEFORMAT?J.SAMPLEFORMAT.values[0]:1,Pa=h(Ja,ia);if(1!==(J.PLANARCONFIGURATION?J.PLANARCONFIGURATION.values[0]:1))throw console.log("can only handle PLANARCONFIGURATION\x3d1"),
"can only handle PLANARCONFIGURATION\x3d1";var ja=J.COMPRESSION?J.COMPRESSION.values[0]:1;if(1!==ja&&6!==ja&&8!==ja&&32946!==ja)throw console.log("compressed tiff is not supported at this moment"),"compressed tiff is not supported at this moment";if(3<Ja)aa=void 0;else{if(3===Ja){var qa=new Float32Array(ya*fa);var za=Float32Array}else 1===Ja?8>=ia?(qa=new Uint8Array(ya*fa),za=Uint8Array):16>=ia?(qa=new Uint16Array(ya*fa),za=Uint16Array):32>=ia&&(qa=new Uint32Array(ya*fa),za=Uint32Array):2===Ja&&(8>=
ia?(qa=new Int8Array(ya*fa),za=Int8Array):16>=ia?(qa=new Int16Array(ya*fa),za=Int16Array):32>=ia&&(qa=new Int32Array(xa*Ia*fa),za=Int32Array));var U,Ka,da,La=Ha;if(0===ia%8)for(U=0;U<va.length;U++){var lb=U*Ha*xa*fa;La=(U+1)*Ha>Ia?Ia-U*Ha:Ha;if("U8"===Pa||"S8"===Pa||kb)if(8===ja||32946===ja){var Y=new Uint8Array(e,va[U],wa[U]);var Xa=new q(Y);var eb=Xa.getBytes();var ra=new ArrayBuffer(eb.length);Y=new Uint8Array(ra);Y.set(eb);Y.length!==La*xa*fa*ia/8&&console.log("strip byte counts is different than expected")}else if(6===
ja){Y=new Uint8Array(e,va[U],wa[U]);var Qa=new A;Qa.parse(Y);var fb=Qa.getData(Qa.width,Qa.height);ra=new ArrayBuffer(fb.length);Y=new Uint8Array(ra);Y.set(fb)}else 1===ja&&(wa[U]!==La*xa*fa*ia/8&&console.log("strip byte counts is different than expected"),ra=e.slice(va[U],va[U]+wa[U]));else{if(6===ja||8===ja||32946===ja){Y=new Uint8Array(e,va[U],wa[U]);Xa=new q(Y);Y=Xa.getBytes();ra=new ArrayBuffer(Y.length);var Ba=new Uint8Array(ra);Y.length!==La*xa*fa*ia/8&&console.log("strip byte counts is different than expected")}else 1===
ja&&(wa[U]!==La*xa*fa*ia/8&&console.log("strip byte counts is different than expected"),ra=new ArrayBuffer(wa[U]),Y=new Uint8Array(e,va[U],wa[U]),Ba=new Uint8Array(ra));switch(Pa){case "U16":case "S16":for(da=0;da<Y.length;da+=2)Ba[da]=Y[da+1],Ba[da+1]=Y[da];break;case "U32":case "S32":case "F32":for(da=0;da<Y.length;da+=4)Ba[da]=Y[da+3],Ba[da+1]=Y[da+2],Ba[da+2]=Y[da+1],Ba[da+3]=Y[da]}}var mb=new za(ra);qa.set(mb,lb)}var Ra={width:xa,height:Ia,pixelType:Pa};if(1===fa)Ra.pixels=[qa];else for(Ra.pixels=
[],U=0;U<fa;U++){var gb=new za(ya);for(Ka=0;Ka<ya;Ka++)gb[Ka]=qa[Ka*fa+U];Ra.pixels.push(gb)}aa=Ra}}}if(null!==O){aa.maskData=new Uint8Array(aa.width*aa.height);if(1E24<Math.abs(O))for(L=0;L<aa.width*aa.height;L++)aa.maskData[L]=1E-6>Math.abs((aa.pixels[0][L]-O)/O)?0:1;else for(L=0;L<aa.width*aa.height;L++)aa.maskData[L]=aa.pixels[0][L]===O?0:1;aa.noDataValue=O}return aa}}})},"esri/layers/rasterLib/function/rasterFunctionHelper":function(){define(["dojo/_base/declare","dojo/_base/lang","./rasterFunctionRegistry"],
function(A,q,a){return{create:function(d,g){if(d){var h=d.renderTexture,e=Object.keys(d);if(d.read&&!g)return d;d.read&&g&&(d=d.toJson());-1<e.indexOf("name")&&e.indexOf(!1)?(d=q.mixin({},d),g=this._parseV2(d,g)):(d="esri.layers.RasterFunction"===d.declaredClass?d.toJson():q.mixin({},d),g=this._parseV1(d,g));g.branchCount=g.updateBranchStructure();g.renderTexture||(g.renderTexture=!!h);return g}},_parseV1:function(d,g){var h=d.rasterFunction,e=d.rasterFunctionArguments,b=d.renderTexture||d.rasterFunctionArguments.renderTexture||
!1,c,l,k,f,m,n,p;(f=e.raster||e.Raster)&&f.rasterFunction&&(c=this._parseV1(f,g));(f=e.raster2||e.Raster2)&&f.rasterFunction&&(l=this._parseV1(f,g));(f=e.rasters||e.Rasters)&&0<f.length&&(k=f.map(q.hitch(this,function(r){return r&&r.rasterFunction?this._parseV1(r,g):r})));(f=e.dem||e.DEM)&&(f.functionName||f.rasterFunction)&&(m=this._parseV1(f,g));(f=e.fillRaster||e.FillRaster)&&(f.functionName||f.rasterFunction)&&(n=this._parseV1(f,g));f=a.functions[h];if(!f)return console.error("Function is not currently supported: "+
h),null;h=new f(e);h.variableName&&(f=e[h.variableName])&&(f.functionName||f.rasterFunction)&&(p=this._parseV1(f,g));d.outputPixelType&&(h.pixelType=d.outputPixelType);"$$"===c?h.functionArguments.raster=g&&g.raster:null!=c?h.functionArguments.raster=c:h.functionArguments.raster||(h.functionArguments.raster=g&&g.raster);null!=l&&(h.functionArguments.raster2=l);null!=k&&(h.functionArguments.rasters=k.map(function(r){"$$"===r&&(r=g&&g.raster);return r}));null!=m&&(h.functionArguments.dem=m);null!=n&&
(h.functionArguments.fillRaster=n);null!=p&&(h.functionArguments[h.variableName]=p);h.renderTexture=b;return h},_parseV2:function(d,g){if(!d)return null;d=q.clone(d);this._bindV2Args(d,g);var h={};this._convertTov1(d,h);return this._parseV1(h,g)},_bindV2Args:function(d,g){(d||g)&&Object.keys(d).forEach(function(h){d[h]["function"]&&d[h].arguments?this._bindV2Args(d[h].arguments,g):null!=g[d[h].name]&&(d[h].value=g[d[h].name])}.bind(this))},_convertV2Types:function(d){if(!d)return null;"ArgumentArray"===
d.type?d.elements&&"RasterStatistics"===d.elements[0].type&&(d=d.elements):d instanceof Array&&0===d.length&&(d=null);return d},_convertTov1:function(d,g){if((d||g)&&d["function"]){var h=d["function"],e=d.arguments;g.rasterFunction=h.type.replace("Function","");g.outputPixelType="UNKNOWN"===h.pixelType?"Unknown":h.pixelType;g.rasterFunctionArguments={};var b;Object.keys(e).forEach(function(c){e[c]["function"]&&e[c].arguments?(g.rasterFunctionArguments[c]={},this._convertTov1(e[c],g.rasterFunctionArguments[c])):
(b=e[c].value,g.rasterFunctionArguments[c]="object"!==typeof b||b.functionArguments?b:this._convertV2Types(b))}.bind(this))}}}})},"esri/layers/rasterLib/function/rasterFunctionRegistry":function(){define("dojo/_base/declare dojo/_base/lang ../../rasterLib/function/AspectFunction ../../rasterLib/function/BandArithmeticFunction ../../rasterLib/function/ColormapFunction ../../rasterLib/function/CompositeBandFunction ../../rasterLib/function/ContrastBrightnessFunction ../../rasterLib/function/ConvolutionFunction ../../rasterLib/function/ExtractBandFunction ../../rasterLib/function/HillshadeFunction ../../rasterLib/function/LocalFunction ../../rasterLib/function/MaskFunction ../../rasterLib/function/NDVIFunction ../../rasterLib/function/SlopeFunction ../../rasterLib/function/StretchFunction ../../rasterLib/function/RemapFunction ../../rasterLib/function/IdentityFunction ../../rasterLib/function/ResampleFunction".split(" "),
function(A,q,a,d,g,h,e,b,c,l,k,f,m,n,p,r,v,u){return function(){function t(z){z.prototype.supportWebGL&&(x[z.prototype.functionName]=z);z.prototype.support2D&&(w[z.prototype.functionName]=z);y[z.prototype.functionName]=z}var w={},x={},y={};t(a);t(d);t(g);t(h);t(e);t(b);t(c);t(l);t(k);t(f);t(m);t(n);t(p);t(r);t(v);t(u);return{cpu:w,gpu:x,functions:y,register:t,getFunction:function(z){return y[z]},support:function(z,B){return!!("gpu"===B?x:"cpu"===B?w:y)[z]}}}()})},"esri/layers/rasterLib/function/AspectFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),
function(A,q,a,d,g,h,e,b){return A([a,e],{declaredClass:"esri.layers.rasterLib.function.AspectFunction",functionName:"Aspect",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({raster:null},c)},bind:function(){var c=this.getSourceRasterInfo();if(!c.raster)return Error("The raster input to aspect function is invalid.");this.rasterInfo=q.mixin(c.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:[{min:0,max:360}],histograms:null});
this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(c){this._performance.start();c=b.aspect(c.raster);this._addPerformanceMetric(this._performance.elapsed());return c},readGL:function(c){this._performance.start();this._initializeProgram({fragment:h.aspect,fragmentName:"Aspect"});var l=this._setupTextureData(c.raster),k=this.bindFrameBuffer(),f=this.gl,m=f.drawingBufferWidth;f=f.drawingBufferHeight;var n=l.extent;
this._setUniforms({u_resolution:c&&c.raster&&c.raster.pixelBlock?[1/c.raster.pixelBlock.width,1/c.raster.pixelBlock.height]:[1/m,1/f],u_cellSize:[(n.xmax-n.xmin)/m,(n.ymax-n.ymin)/f]});this._bindTexture(l.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:l.extent,texture:k.texture}}})})},"esri/layers/rasterLib/function/RasterFunctionX":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/config ../raster/RasterInfo ../../../geometry/Extent ../../PixelBlock".split(" "),
function(A,q,a,d,g,h){return A(null,{functionName:null,functionArguments:null,pixelType:"Unknown",rasterInfo:null,constructor:function(e){e&&(this.pixelType=e.outputPixelType||e.OutputPixelType||this.pixelType,this.renderTexture=e.renderTexture,this._initFunction())},mixinIgnoreCase:function(e,b){var c=Object.keys(e),l=Object.keys(b),k,f,m=c.length;for(k=0;k<l.length;k++){var n=b[l[k]];if(null!=n)for(f=0;f<m;f++)if(c[f].toLowerCase()===l[k].toLowerCase()){e[c[f]]=n;break}}return e},bind:function(e){},
setProcessingContext:function(e){if(!e)throw"cannot bind to layer without options";this.useWebGL=!!e.useWebGL;this._tileMode=!!e.tileMode;this._glSetting=e.glSetting;this._rawRasterInfo=e.rawRasterInfo;this._xformSetting=e.xformSetting||this._xformSetting;if(!this.useWebGL||this._glSetting&&this._glSetting.gl){this.gl=this.useWebGL?this._glSetting.gl:null;this._glSetting&&(this._glSetting.pingpong=null,this._glSetting.branches=null);var b=this.functionArguments.raster,c=this.functionArguments.raster2,
l=this.functionArguments.dem,k=this.functionArguments.fillRaster,f=this.functionArguments.rasters;b&&b.functionArguments&&b.setProcessingContext(e);c&&c.functionArguments&&c.setProcessingContext(e);l&&l.functionArguments&&l.setProcessingContext(e);k&&k.functionArguments&&k.setProcessingContext(e);if(f)for(b=0;b<f.length;b++)f[b]&&f[b].functionArguments&&f[b].setProcessingContext(e);this.bind()}},updateBranchStructure:function(){var e=0,b=this.functionArguments;b.raster&&b.raster.read&&b.raster.functionArguments&&
(e+=b.raster.updateBranchStructure());b.raster2&&b.raster2.read&&b.raster2.functionArguments&&(e+=b.raster2.updateBranchStructure(),b.raster2.isBranch=!0,b.raster&&b.raster.read&&(b.raster.isBranch=!0));b.rasters&&(e=b.rasters.length,b.rasters.forEach(function(c){c.read&&c.functionArguments&&(c.isBranch=!0)}));b.dem&&b.dem.read&&b.dem.functionArguments&&(e+=b.dem.updateBranchStructure());return 1===e?0:e},read:function(e){e=this.processRasterArgument(e);return this.useWebGL?this.readGL(e):this.read2D(e)},
hasTilingEffects:function(){return!1},read2D:function(){},readGL:function(){},getSourceRasterInfo:function(){var e,b={};if(this.functionArguments.raster2)b.functionArguments.raster=this._bindRaster(this.functionArguments.raster),b.functionArguments.raster2=this._bindRaster(this.functionArguments.raster2);else if(this.functionArguments.rasters)for(b.rasters=[],e=0;e<this.functionArguments.rasters.length;e++)b.rasters[e]=this._bindRaster(this.functionArguments.rasters[e]);else b.raster=this._bindRaster(this.functionArguments.raster);
return this.sourceRasterInfo=b},processRasterArgument:function(e){var b=this.bind();if(!0!==b)throw b;var c={};if(this.functionArguments.raster2)c.raster=this._readRaster(this.functionArguments.raster,e),c.raster2=this._readRaster(this.functionArguments.raster2,e);else if(this.functionArguments.rasters)for(c.rasters=[],b=0;b<this.functionArguments.rasters.length;b++)c.rasters[b]=this._readRaster(this.functionArguments.rasters[b],e);else c.raster=this._readRaster(this.functionArguments.raster,e);return c},
toJson:function(){var e=this.functionArguments,b=e.raster,c=e.raster2;e=e.rasters;b=b?b.toJson?b.toJson():b:null;c=c?c.toJson?c.toJson():c:null;var l;e&&0<e.length&&(l=e.map(function(k){return k.toJson?k.toJson():k}));e=q.mixin({},this.functionArguments);e.raster=b;e.raster2=c;e.rasters=l;e=this._fixRasterFunctionJson(e);return{rasterFunction:this.functionName,rasterFunctionArguments:e,outputPixelType:this.pixelType}},_initFunction:function(e){},_getIntegerRange:function(e){switch(e){case "U8":var b=
[0,255];break;case "U16":b=[0,65535];break;case "U32":b=[0,4294967295];break;case "S8":b=[-128,127];break;case "S16":b=[-32768,32767];break;case "S32":b=[-2147483648,2147483647]}return b},_calculatePixelType:function(e,b){return e&&"unknown"!==e.toLowerCase()?e:b},_clonePixelData:function(e){if(null==e)return e;var b={};e.extent&&(b.extent=new g(e.extent.xmin,e.extent.ymin,e.extent.xmax,e.extent.ymax,e.extent.spatialReference));e=e.pixelBlock;if(null==e)return b;b.pixelBlock=e.clone?e.clone():h.prototype.clone(e);
return b},_readRaster:function(e,b){if(null==e||"$$"===e)var c=this._clonePixelData(b.src[Object.keys(b.src)[0]]);else e&&e.rasterInfo&&!e.functionArguments?c=this._clonePixelData(b.src[e._rasterId]):isNaN(e)?e.read&&(c=e.functionArguments?e.read(b):this._clonePixelData(b)):(c=b.src?b.src[Object.keys(b.src)[0]]:b,b=c.pixelBlock,b=new Float32Array(b.width*b.height),b.fill(parseFloat(e)),c=this._clonePixelData(c),c.pixelBlock.pixels=[b],c.isConstant=!0);return c},_bindRaster:function(e){if(e&&"$$"!==
e)isNaN(e)?e.rasterInfo?b=e.rasterInfo:e.bind&&e.bind()&&(b=e.rasterInfo):b={};else var b=this._rawRasterInfo;b&&(b=b.clone?b.clone():new d(b),b.bandCount=b.bandCount||3);return b},_getOutputBand:function(e,b){switch(e){case "U8":e=new Uint8Array(b);break;case "U16":e=new Uint16Array(b);break;case "U32":e=new Uint32Array(b);break;case "S8":e=new Int8Array(b);break;case "S16":e=new Int16Array(b);break;case "S32":e=new Int32Array(b);break;case "U32":e=new Uint32Array(b);break;case "F32":e=new Float32Array(b);
break;case "F64":e=new Float64Array(b);break;default:e=new Float32Array(b)}return e},_clampBand:function(e,b,c){if(("F64"===b||"F32"===b)&&!c)return e;var l,k=this._getIntegerRange(b),f=e.length;if(k)for(c=k[1],k=k[0],b=this._getOutputBand(b,f),l=0;l<f;l++){var m=e[l];b[l]=m>c?c:m<k?k:m}else b=e;return b},_performance:{start:function(){return this._start=self.performance&&self.performance.now()||new Date}.bind(this),elapsed:function(){return(self.performance&&self.performance.now()||new Date)-this._start}.bind(this)},
_addPerformanceMetric:function(e){a.isDebug&&(self.rasterFunctionPerformance||(self.rasterFunctionPerformance=[]),self.rasterFunctionPerformance.push(e),50<self.rasterFunctionPerformance.length&&self.rasterFunctionPerformance.shift())},_fixRasterFunctionJson:function(e){for(var b in e)e.hasOwnProperty(b)&&(null==e[b]?delete e[b]:e[b]instanceof Object&&!e[b].sourceType&&this._fixRasterFunctionJson(e[b],!0));return e}})})},"esri/layers/rasterLib/raster/RasterInfo":function(){define(["dojo/_base/declare",
"dojo/_base/lang","../../../geometry/Extent","../../../SpatialReference","../tile/RasterTileInfo"],function(A,q,a,d,g){return A(null,{declaredClass:"esri.layers.rasterLib.raster.RasterInfo",bandCount:null,pixelType:null,extent:null,spatialReference:null,width:null,height:null,colormap:null,attributeTable:null,multiDimensionalInfo:null,statistics:null,histograms:null,catalogInfo:null,keyProperties:null,cellSize:null,format:null,compression:null,compressionQuality:null,packetSize:null,geodataXform:null,
constructor:function(h){q.mixin(this,h);this.extent=this.extent?this.extent.toJson?this.extent:new a(this.extent):null;this.spatialReference=this.spatialReference?this.spatialReference.toJson?this.spatialReference:new d(this.spatialReference):null;this.tileInfo=this.tileInfo?this.tileInfo.toJson?this.tileInfo:new g(this.tileInfo):null},toJson:function(){return{bandCount:this.bandCount,pixelType:this.pixelType,extent:this.extent&&this.extent.toJson?this.extent.toJson():this.extent,spatialReference:this.spatialReference&&
this.spatialReference.toJson?this.spatialReference.toJson():this.spatialReference,width:this.width,height:this.height,colormap:this.colormap?q.clone(this.colormap):null,attributeTable:this.attributeTable?q.clone(this.attributeTable):null,multiDimensionalInfo:this.multiDimensionalInfo?q.clone(this.multiDimensionalInfo):null,statistics:this.statistics?q.clone(this.statistics):null,histograms:this.histograms?q.clone(this.histograms):null,catalogInfo:this.catalogInfo?q.clone(this.catalogInfo):null,keyProperties:this.keyProperties?
q.clone(this.keyProperties):null,cellSize:this.cellSize&&this.cellSize.toJson?this.cellSize.toJson():this.cellSize,tileInfo:this.tileInfo&&this.tileInfo.toJson?this.tileInfo.toJson():this.tileInfo,format:this.format,compression:this.compression,compressionQuality:this.compressionQuality,packetSize:this.packetSize,geodataXform:this.geodataXform?q.clone(this.geodataXform):null}},clone:function(){return new this.constructor(this.toJson())}})})},"esri/geometry/Extent":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/has ../kernel ../lang ../SpatialReference ./Geometry ./Point ./webMercatorUtils ./mathUtils ../srUtils".split(" "),
function(A,q,a,d,g,h,e,b,c,l,k,f){function m(){}var n={type:"extent",xmin:0,ymin:0,xmax:0,ymax:0},p=A(b,{declaredClass:"esri.geometry.Extent",type:"extent",xmin:0,ymin:0,xmax:0,ymax:0,constructor:function(r,v,u,t,w){h.isObject(r)?(h.mixin(this,r),this.spatialReference&&(this.spatialReference=f.createSpatialReference(this.spatialReference))):this.update(r,v,u,t,w);this.verifySR()},getWidth:function(){return Math.abs(this.xmax-this.xmin)},getHeight:function(){return Math.abs(this.ymax-this.ymin)},getCenter:function(){return new c((this.xmin+
this.xmax)/2,(this.ymin+this.ymax)/2,this.spatialReference)},getTopLeft:function(){return new c(this.xmin,this.ymax,this.spatialReference)},getTopRight:function(){return new c(this.xmax,this.ymax,this.spatialReference)},getBottomLeft:function(){return new c(this.xmin,this.ymin,this.spatialReference)},getBottomRight:function(){return new c(this.xmax,this.ymin,this.spatialReference)},centerAt:function(r){var v=this.getCenter(),u=r.x-v.x;r=r.y-v.y;return new p(this.xmin+u,this.ymin+r,this.xmax+u,this.ymax+
r,this.spatialReference)},update:function(r,v,u,t,w){this.xmin=r;this.ymin=v;this.xmax=u;this.ymax=t;this.spatialReference=w;this.clearCache();return this},offset:function(r,v){return new p(this.xmin+r,this.ymin+v,this.xmax+r,this.ymax+v,this.spatialReference)},expand:function(r){var v=(1-r)/2;r=this.getWidth()*v;v*=this.getHeight();return new p(this.xmin+r,this.ymin+v,this.xmax-r,this.ymax-v,this.spatialReference)},intersects:function(r){if(!r)return!1;var v=r.type,u=this.spatialReference,t=r.spatialReference;
u&&t&&!u.equals(t)&&u._canProject(t)&&(r=u.isWebMercator()?l.geographicToWebMercator(r):l.webMercatorToGeographic(r,!0));switch(v){case "point":return this.contains(r);case "multipoint":return this._intersectsMultipoint(r);case "extent":return this._intersectsExtent(r);case "polygon":return this._intersectsPolygon(r);case "polyline":return this._intersectsPolyline(r)}},normalize:function(){var r=this._normalize(!1,!0);a.isArray(r)||(r=[r]);return r},shiftCentralMeridian:function(){return this._normalize(!0)},
bisect:function(){var r=this.spatialReference,v=r&&r._getInfo(),u=[],t=0;if(v&&this._isOutOfBounds(v)){var w=this;t=w.xmin;var x=w.ymin,y=w.ymax,z=v.valid[0],B=v.valid[1];w.getWidth()>2*B&&(w=w.getCenter(),w=new p(w.x-B,x,w.x+B,y,new e(r.toJson())));t=w.xmin-t;var F=this._normalizeX(w.xmin,v);v=this._normalizeX(w.xmax,v);F.frameId===v.frameId?u.push(new p(F.x,x,v.x,y,new e(r.toJson()))):u.push(new p(F.x,x,B,y,new e(r.toJson())),new p(z,x,v.x,y,new e(r.toJson())))}else u.push(this.getExtent());return{extents:u,
marginLeft:t}},_intersectsMultipoint:function(r){var v=r.points.length,u;for(u=0;u<v;u++)if(this.contains(r.getPoint(u)))return!0;return!1},_intersectsExtent:function(r){var v,u,t=!1;if(this.xmin<=r.xmin){var w=r.xmin;this.xmax<w?t=!0:v=Math.min(this.xmax,r.xmax)-w}else w=this.xmin,r.xmax<w?t=!0:v=Math.min(this.xmax,r.xmax)-w;if(this.ymin<=r.ymin){var x=r.ymin;this.ymax<x?t=!0:u=Math.min(this.ymax,r.ymax)-x}else x=this.ymin,r.ymax<x?t=!0:u=Math.min(this.ymax,r.ymax)-x;return t?null:new p(w,x,w+v,
x+u,this.spatialReference)},_intersectsPolygon:function(r){var v=[this.xmin,this.ymax],u=[this.xmax,this.ymax],t=[this.xmin,this.ymin],w=[this.xmax,this.ymin],x=[v,u,t,w];v=[[t,v],[v,u],[u,w],[w,t]];t=r.rings;w=t.length;var y=new c(0,0,this.spatialReference);var z=x.length;for(u=0;u<z;u++)if(y.update(x[u][0],x[u][1]),r.contains(y))return!0;y.setSpatialReference(r.spatialReference);for(u=0;u<w;u++)if(x=t[u],z=x.length){var B=x[0];y.update(B[0],B[1]);if(this.contains(y))return!0;for(r=1;r<z;r++){var F=
x[r];y.update(F[0],F[1]);if(this.contains(y)||this._intersectsLine([B,F],v))return!0;B=F}}return!1},_intersectsPolyline:function(r){var v=[[[this.xmin,this.ymin],[this.xmin,this.ymax]],[[this.xmin,this.ymax],[this.xmax,this.ymax]],[[this.xmax,this.ymax],[this.xmax,this.ymin]],[[this.xmax,this.ymin],[this.xmin,this.ymin]]],u,t=r.paths,w=t.length,x,y=new c(0,0,r.spatialReference);for(r=0;r<w;r++){var z=t[r];if(x=z.length){var B=z[0];y.update(B[0],B[1]);if(this.contains(y))return!0;for(u=1;u<x;u++){var F=
z[u];y.update(F[0],F[1]);if(this.contains(y)||this._intersectsLine([B,F],v))return!0;B=F}}}return!1},_intersectsLine:function(r,v){var u=k._getLineIntersection2,t,w=v.length;for(t=0;t<w;t++)if(u(r,v[t]))return!0;return!1},contains:function(r){if(!r)return!1;var v=r.type;if("point"===v){var u=this.spatialReference,t=r.spatialReference;v=r.x;r=r.y;u&&t&&!u.equals(t)&&u._canProject(t)&&(r=u.isWebMercator()?c.lngLatToXY(v,r):c.xyToLngLat(v,r,!0),v=r[0],r=r[1]);return v>=this.xmin&&v<=this.xmax&&r>=this.ymin&&
r<=this.ymax}return"extent"===v?this._containsExtent(r):!1},_containsExtent:function(r){var v=r.xmin,u=r.ymin,t=r.xmax,w=r.ymax,x=r.spatialReference;r=new c(v,u,x);v=new c(v,w,x);w=new c(t,w,x);u=new c(t,u,x);return this.contains(r)&&this.contains(v)&&this.contains(w)&&this.contains(u)?!0:!1},union:function(r){return new p(Math.min(this.xmin,r.xmin),Math.min(this.ymin,r.ymin),Math.max(this.xmax,r.xmax),Math.max(this.ymax,r.ymax),this.spatialReference)},getExtent:function(){var r=this.spatialReference;
return new p(this.xmin,this.ymin,this.xmax,this.ymax,r&&new e(r.toJson()))},_shiftCM:function(r){var v=this.getCacheValue("_shifted");if(!v){v=new p(this.toJson());var u=v.spatialReference;if(r=r||u._getInfo()){var t=this._getCM(r);if(t){var w=u._isWebMercator()?l.webMercatorToGeographic(t):t;v.xmin-=t.x;v.xmax-=t.x;u._isWebMercator()||(w.x=this._normalizeX(w.x,r).x);v.setSpatialReference(new e(h.substitute({Central_Meridian:w.x},4326===u.wkid?r.altTemplate:r.wkTemplate)))}}this.setCacheValue("_shifted",
v)}return v},_getCM:function(r){var v;this._isOutOfBounds(r)&&(v=this.getCenter());return v},_isOutOfBounds:function(r){var v=r.valid[0];r=r.valid[1];var u=this.xmin,t=this.xmax;return!(u>=v&&u<=r&&t>=v&&t<=r)},_normalize:function(r,v,u){var t=new p(this.toJson()),w=t.spatialReference;if(w&&(u=u||w._getInfo())){var x=q.map(this._getParts(u),function(y){return y.extent});return 2<x.length?r?this._shiftCM(u):t.update(u.valid[0],t.ymin,u.valid[1],t.ymax,w):2===x.length?r?this._shiftCM(u):v?x:{rings:q.map(x,
function(y){return[[y.xmin,y.ymin],[y.xmin,y.ymax],[y.xmax,y.ymax],[y.xmax,y.ymin],[y.xmin,y.ymin]]}),spatialReference:w}:x[0]||t}return t},_getParts:function(r){var v=this.getCacheValue("_parts");if(!v){v=[];var u=this.xmin,t=this.xmax,w=this.ymin,x=this.ymax,y=this.spatialReference,z=this.getWidth(),B=u,F=t,D=0,C=0;r=r||y._getInfo();var E=r.valid[0];var G=r.valid[1];C=this._normalizeX(u,r);u=C.x;D=C.frameId;C=this._normalizeX(t,r);t=C.x;C=C.frameId;r=u===t&&0<z;if(z>2*G){z=new p(B<F?u:t,w,G,x,y);
u=new p(E,w,B<F?t:u,x,y);G=new p(0,w,G,x,y);w=new p(E,w,0,x,y);y=[];E=[];z.contains(G)&&y.push(D);z.contains(w)&&E.push(D);u.contains(G)&&y.push(C);u.contains(w)&&E.push(C);for(x=D+1;x<C;x++)y.push(x),E.push(x);v.push({extent:z,frameIds:[D]},{extent:u,frameIds:[C]},{extent:G,frameIds:y},{extent:w,frameIds:E})}else u>t||r?v.push({extent:new p(u,w,G,x,y),frameIds:[D]},{extent:new p(E,w,t,x,y),frameIds:[C]}):v.push({extent:new p(u,w,t,x,y),frameIds:[D]});this.setCacheValue("_parts",v)}return v},_normalizeX:function(r,
v){var u=0,t=v.valid[0],w=v.valid[1];v=2*w;r>w?(u=Math.ceil(Math.abs(r-w)/v),r-=u*v):r<t&&(u=Math.ceil(Math.abs(r-t)/v),r+=u*v,u=-u);return{x:r,frameId:u}},toJson:function(){var r={xmin:this.xmin,ymin:this.ymin,xmax:this.xmax,ymax:this.ymax},v=this.spatialReference;v&&(r.spatialReference=v.toJson());return r}});m.prototype=p.prototype;p.simpleConstructor=m;p.defaultProps=n;d("extend-esri")&&(a.setObject("geometry.Extent",p,g),g.geometry.defaultExtent=n);return p})},"esri/lang":function(){define("dojo/_base/array dojo/_base/json dojo/_base/kernel dojo/_base/lang dojo/date dojo/has dojo/number dojo/date/locale ./kernel".split(" "),
function(A,q,a,d,g,h,e,b,c){function l(t,w,x,y){(w=w&&w[t])?w={formatType:w.formatType,options:w}:y&&-1!==A.indexOf(y.properties||"",t)?w={formatType:y.formatter||"DateString",options:null}:x&&-1!==A.indexOf(x.properties||"",t)&&(w={formatType:x.formatter||"NumberFormat",options:null});return w}function k(t,w,x){return[d.isString(t)?t.split(""):t,w||a.global,d.isString(x)?new Function("item","index","array",x):x]}function f(t){return void 0!==t&&null!==t}function m(t){return f(t)?t:""}function n(t,
w,x,y){var z=x.match(/([^\(]+)(\([^\)]+\))?/i);x=d.trim(z[1]);var B=z[2]?d.trim(z[2]):null;z=w[t];y=y||(B?q.fromJson(B.replace(/^\(/,"({").replace(/\)$/,"})")):{});B=y.utcOffset;if(-1===A.indexOf(r,x))x=d.getObject(x),d.isFunction(x)&&(z=x(z,t,w,y));else if("number"===typeof z||"string"===typeof z&&z&&!isNaN(Number(z)))switch(z=Number(z),x){case "NumberFormat":return e.format(z,y);case "DateString":t=new Date(z);if(y.local||y.systemLocale)return y.systemLocale?t.toLocaleDateString()+(y.hideTime?"":
" "+t.toLocaleTimeString()):t.toDateString()+(y.hideTime?"":" "+t.toTimeString());t=t.toUTCString();y.hideTime&&(t=t.replace(/\s+\d\d:\d\d:\d\d\s+(utc|gmt)/i,""));return t;case "DateFormat":return t=new Date(z),f(B)&&(t=g.add(t,"minute",t.getTimezoneOffset()-B)),b.format(t,y)}return m(z)}function p(t,w){var x;if(w)for(x in t)t.hasOwnProperty(x)&&(void 0===t[x]?delete t[x]:t[x]instanceof Object&&p(t[x],!0));else for(x in t)t.hasOwnProperty(x)&&void 0===t[x]&&delete t[x];return t}var r=["NumberFormat",
"DateString","DateFormat"],v=/<\/?[^>]+>/g,u={valueOf:function(t,w){for(var x in t)if(t[x]==w)return x;return null},stripTags:function(t){if(t){var w=typeof t;if("string"===w)t=t.replace(v,"");else if("object"===w)for(var x in t)(w=t[x])&&"string"===typeof w&&(w=w.replace(v,"")),t[x]=w}return t},substitute:function(t,w,x){if(f(x))if(d.isObject(x)){var y=x.first;var z=x.dateFormat;var B=x.numberFormat;var F=x.format}else y=x;if(w&&"${*}"!==w)return d.replace(w,d.hitch({obj:t},function(C,E){var G=E.split(":");
return 1<G.length?(E=G[0],G.shift(),(C=F&&F[G[0]])?G=C.formatType:(G=G.join(":"),C=null),n(E,this.obj,G,C)):(C=l(E,F,B,z))?n(E,this.obj,C.formatType,C.options):m(this.obj[E])}),/\$\{([^\}]+)\}/g);w=[];for(var D in t)if(x=(x=l(D,F,B,z))?n(D,t,x.formatType,x.options):t[D],w.push(D+" \x3d "+m(x)+"\x3cbr/\x3e"),y)break;return w.join("")},filter:function(t,w,x){w=k(t,x,w);x={};var y;t=w[0];for(y in t)w[2].call(w[y],t[y],y,t)&&(x[y]=t[y]);return x},startsWith:function(t,w,x){x=x||0;return t.indexOf(w,x)===
x},endsWith:function(t,w,x){if("number"!==typeof x||!isFinite(x)||Math.floor(x)!==x||x>t.length)x=t.length;x-=w.length;t=t.indexOf(w,x);return-1!==t&&t===x},isDefined:f,fixJson:p,isObject:function(t){return t&&"object"===typeof t},isString:function(t){return"string"===typeof t},mixin:function(t,w){for(var x in w)w.hasOwnProperty(x)&&(t[x]=w[x]);return t},clone2DArray:function(t){if(t=t?t.slice(0):null){var w,x=t.length;for(w=0;w<x;w++)t[w]=t[w]?t[w].slice(0):null}return t},clone3DArray:function(t){if(t=
t?t.slice(0):null){var w,x=t.length;for(w=0;w<x;w++){t[w]=t[w]?t[w].slice(0):null;var y=t[w];if(y){var z,B=y.length;for(z=0;z<B;z++)y[z]=y[z]?y[z].slice(0):null}}}return t}};h("extend-esri")&&(d.mixin(c,u),c._isDefined=f,c._getParts=k,c._sanitize=p);return u})},"dojo/date":function(){define(["./has","./_base/lang"],function(A,q){var a={getDaysInMonth:function(d){var g=d.getMonth();return 1==g&&a.isLeapYear(d)?29:[31,28,31,30,31,30,31,31,30,31,30,31][g]},isLeapYear:function(d){d=d.getFullYear();return!(d%
400)||!(d%4)&&!!(d%100)},getTimezoneName:function(d){var g=d.toString(),h="",e=g.indexOf("(");if(-1<e)h=g.substring(++e,g.indexOf(")"));else if(e=/([A-Z\/]+) \d{4}$/,g=g.match(e))h=g[1];else if(g=d.toLocaleString(),e=/ ([A-Z\/]+)$/,g=g.match(e))h=g[1];return"AM"==h||"PM"==h?"":h},compare:function(d,g,h){d=new Date(+d);g=new Date(+(g||new Date));"date"==h?(d.setHours(0,0,0,0),g.setHours(0,0,0,0)):"time"==h&&(d.setFullYear(0,0,0),g.setFullYear(0,0,0));return d>g?1:d<g?-1:0},add:function(d,g,h){var e=
new Date(+d),b=!1,c="Date";switch(g){case "day":break;case "weekday":if(g=h%5)var l=parseInt(h/5);else g=0<h?5:-5,l=0<h?(h-5)/5:(h+5)/5;var k=d.getDay(),f=0;6==k&&0<h?f=1:0==k&&0>h&&(f=-1);k+=g;if(0==k||6==k)f=0<h?2:-2;h=7*l+g+f;break;case "year":c="FullYear";b=!0;break;case "week":h*=7;break;case "quarter":h*=3;case "month":b=!0;c="Month";break;default:c="UTC"+g.charAt(0).toUpperCase()+g.substring(1)+"s"}if(c)e["set"+c](e["get"+c]()+h);b&&e.getDate()<d.getDate()&&e.setDate(0);return e},difference:function(d,
g,h){g=g||new Date;h=h||"day";var e=g.getFullYear()-d.getFullYear(),b=1;switch(h){case "quarter":d=d.getMonth();g=g.getMonth();b=Math.floor(g/3)+1+4*e-(Math.floor(d/3)+1);break;case "weekday":e=Math.round(a.difference(d,g,"day"));h=parseInt(a.difference(d,g,"week"));if(0==e%7)e=5*h;else{b=0;var c=d.getDay(),l=g.getDay();h=parseInt(e/7);g=e%7;d=new Date(d);d.setDate(d.getDate()+7*h);d=d.getDay();if(0<e)switch(!0){case 6==c:b=-1;break;case 0==c:b=0;break;case 6==l:b=-1;break;case 0==l:b=-2;break;case 5<
d+g:b=-2}else if(0>e)switch(!0){case 6==c:b=0;break;case 0==c:b=1;break;case 6==l:b=2;break;case 0==l:b=1;break;case 0>d+g:b=2}e=e+b-2*h}b=e;break;case "year":b=e;break;case "month":b=g.getMonth()-d.getMonth()+12*e;break;case "week":b=parseInt(a.difference(d,g,"day")/7);break;case "day":b/=24;case "hour":b/=60;case "minute":b/=60;case "second":b/=1E3;case "millisecond":b*=g.getTime()-d.getTime()}return Math.round(b)}};q.mixin(q.getObject("dojo.date",!0),a);return a})},"dojo/number":function(){define(["./_base/lang",
"./i18n","./i18n!./cldr/nls/number","./string","./regexp"],function(A,q,a,d,g){var h={};A.setObject("dojo.number",h);h.format=function(b,c){c=A.mixin({},c||{});var l=q.normalizeLocale(c.locale);l=q.getLocalization("dojo.cldr","number",l);c.customs=l;l=c.pattern||l[(c.type||"decimal")+"Format"];return isNaN(b)||Infinity==Math.abs(b)?null:h._applyPattern(b,l,c)};h._numberPatternRE=/[#0,]*[#0](?:\.0*#*)?/;h._applyPattern=function(b,c,l){l=l||{};var k=l.customs.group,f=l.customs.decimal;c=c.split(";");
var m=c[0];c=c[0>b?1:0]||"-"+m;if(-1!=c.indexOf("%"))b*=100;else if(-1!=c.indexOf("\u2030"))b*=1E3;else if(-1!=c.indexOf("\u00a4"))k=l.customs.currencyGroup||k,f=l.customs.currencyDecimal||f,c=c.replace(/([\s\xa0\u202f]*)(\u00a4{1,3})([\s\xa0\u202f]*)/,function(p,r,v,u){return(p=l[["symbol","currency","displayName"][v.length-1]]||l.currency||"")?r+p+u:""});else if(-1!=c.indexOf("E"))throw Error("exponential notation not supported");var n=h._numberPatternRE;m=m.match(n);if(!m)throw Error("unable to find a number expression in pattern: "+
c);!1===l.fractional&&(l.places=0);return c.replace(n,h._formatAbsolute(b,m[0],{decimal:f,group:k,places:l.places,round:l.round}))};h.round=function(b,c,l){l=10/(l||10);return(l*+b).toFixed(c)/l};if(0==(.9).toFixed()){var e=h.round;h.round=function(b,c,l){var k=Math.pow(10,-c||0),f=Math.abs(b);if(!b||f>=k)k=0;else if(f/=k,.5>f||.95<=f)k=0;return e(b,c,l)+(0<b?k:-k)}}h._formatAbsolute=function(b,c,l){l=l||{};!0===l.places&&(l.places=0);Infinity===l.places&&(l.places=6);c=c.split(".");var k="string"==
typeof l.places&&l.places.indexOf(","),f=l.places;k?f=l.places.substring(k+1):0<=f||(f=(c[1]||[]).length);0>l.round||(b=h.round(b,f,l.round));b=String(Math.abs(b)).split(".");var m=b[1]||"";c[1]||l.places?(k&&(l.places=l.places.substring(0,k)),k=void 0!==l.places?l.places:c[1]&&c[1].lastIndexOf("0")+1,k>m.length&&(b[1]=d.pad(m,k,"0",!0)),f<m.length&&(b[1]=m.substr(0,f))):b[1]&&b.pop();f=c[0].replace(",","");k=f.indexOf("0");-1!=k&&(k=f.length-k,k>b[0].length&&(b[0]=d.pad(b[0],k)),-1==f.indexOf("#")&&
(b[0]=b[0].substr(b[0].length-k)));f=c[0].lastIndexOf(",");var n;if(-1!=f){var p=c[0].length-f-1;c=c[0].substr(0,f);f=c.lastIndexOf(",");-1!=f&&(n=c.length-f-1)}c=[];for(f=b[0];f;)k=f.length-p,c.push(0<k?f.substr(k):f),f=0<k?f.slice(0,k):"",n&&(p=n,n=void 0);b[0]=c.reverse().join(l.group||",");return b.join(l.decimal||".")};h.regexp=function(b){return h._parseInfo(b).regexp};h._parseInfo=function(b){b=b||{};var c=q.normalizeLocale(b.locale);c=q.getLocalization("dojo.cldr","number",c);var l=b.pattern||
c[(b.type||"decimal")+"Format"],k=c.group,f=c.decimal,m=1;if(-1!=l.indexOf("%"))m/=100;else if(-1!=l.indexOf("\u2030"))m/=1E3;else{var n=-1!=l.indexOf("\u00a4");n&&(k=c.currencyGroup||k,f=c.currencyDecimal||f)}c=l.split(";");1==c.length&&c.push("-"+c[0]);c=g.buildGroupRE(c,function(p){p="(?:"+g.escapeString(p,".")+")";return p.replace(h._numberPatternRE,function(r){var v={signed:!1,separator:b.strict?k:[k,""],fractional:b.fractional,decimal:f,exponent:!1};r=r.split(".");var u=b.places;1==r.length&&
1!=m&&(r[1]="###");1==r.length||0===u?v.fractional=!1:(void 0===u&&(u=b.pattern?r[1].lastIndexOf("0")+1:Infinity),u&&void 0==b.fractional&&(v.fractional=!0),!b.places&&u<r[1].length&&(u+=","+r[1].length),v.places=u);r=r[0].split(",");1<r.length&&(v.groupSize=r.pop().length,1<r.length&&(v.groupSize2=r.pop().length));return"("+h._realNumberRegexp(v)+")"})},!0);n&&(c=c.replace(/([\s\xa0\u202f]*)(\u00a4{1,3})([\s\xa0\u202f]*)/g,function(p,r,v,u){p=g.escapeString(b[["symbol","currency","displayName"][v.length-
1]]||b.currency||"");if(!p)return"";r=r?"[\\s\\xa0\\u202f]":"";u=u?"[\\s\\xa0\\u202f]":"";return b.strict?r+p+u:(r&&(r+="*"),u&&(u+="*"),"(?:"+r+p+u+")?")}));return{regexp:c.replace(/[\xa0\u202f ]/g,"[\\s\\xa0\\u202f]"),group:k,decimal:f,factor:m}};h.parse=function(b,c){c=h._parseInfo(c);b=(new RegExp("^"+c.regexp+"$")).exec(b);if(!b)return NaN;var l=b[1];if(!b[1]){if(!b[2])return NaN;l=b[2];c.factor*=-1}l=l.replace(new RegExp("["+c.group+"\\s\\xa0\\u202f]","g"),"").replace(c.decimal,".");return l*
c.factor};h._realNumberRegexp=function(b){b=b||{};"places"in b||(b.places=Infinity);"string"!=typeof b.decimal&&(b.decimal=".");"fractional"in b&&!/^0/.test(b.places)||(b.fractional=[!0,!1]);"exponent"in b||(b.exponent=[!0,!1]);"eSigned"in b||(b.eSigned=[!0,!1]);var c=h._integerRegexp(b),l=g.buildGroupRE(b.fractional,function(f){var m="";f&&0!==b.places&&(m="\\"+b.decimal,m=Infinity==b.places?"(?:"+m+"\\d+)?":m+("\\d{"+b.places+"}"));return m},!0),k=g.buildGroupRE(b.exponent,function(f){return f?
"([eE]"+h._integerRegexp({signed:b.eSigned})+")":""});c+=l;l&&(c="(?:(?:"+c+")|(?:"+l+"))");return c+k};h._integerRegexp=function(b){b=b||{};"signed"in b||(b.signed=[!0,!1]);"separator"in b?"groupSize"in b||(b.groupSize=3):b.separator="";var c=g.buildGroupRE(b.signed,function(k){return k?"[-+]":""},!0),l=g.buildGroupRE(b.separator,function(k){if(!k)return"(?:\\d+)";k=g.escapeString(k);" "==k?k="\\s":"\u00a0"==k?k="\\s\\xa0":"\u202f"==k&&(k="\\s\\u202f");var f=b.groupSize,m=b.groupSize2;return m?(k=
"(?:0|[1-9]\\d{0,"+(m-1)+"}(?:["+k+"]\\d{"+m+"})*["+k+"]\\d{"+f+"})",0<f-m?"(?:"+k+"|(?:0|[1-9]\\d{0,"+(f-1)+"}))":k):"(?:0|[1-9]\\d{0,"+(f-1)+"}(?:["+k+"]\\d{"+f+"})*)"},!0);return c+l};return h})},"dojo/string":function(){define(["./_base/kernel","./_base/lang"],function(A,q){var a=/[&<>'"\/]/g,d={"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;","/":"\x26#x2F;"},g={};q.setObject("dojo.string",g);g.escape=function(h){return h?h.replace(a,function(e){return d[e]}):
""};g.rep=function(h,e){if(0>=e||!h)return"";for(var b=[];;){e&1&&b.push(h);if(!(e>>=1))break;h+=h}return b.join("")};g.pad=function(h,e,b,c){b||(b="0");h=String(h);e=g.rep(b,Math.ceil((e-h.length)/b.length));return c?h+e:e+h};g.substitute=function(h,e,b,c){c=c||A.global;b=b?q.hitch(c,b):function(l){return l};return h.replace(/\$\{([^\s:\}]*)(?::([^\s:\}]+))?\}/g,function(l,k,f){if(""==k)return"$";l=q.getObject(k,!1,e);f&&(l=q.getObject(f,!1,c).call(c,l,k));f=b(l,k);if("undefined"===typeof f)throw Error('string.substitute could not find key "'+
k+'" in template');return f.toString()})};g.trim=String.prototype.trim?q.trim:function(h){h=h.replace(/^\s+/,"");for(var e=h.length-1;0<=e;e--)if(/\S/.test(h.charAt(e))){h=h.substring(0,e+1);break}return h};return g})},"dojo/regexp":function(){define(["./_base/kernel","./_base/lang"],function(A,q){var a={};q.setObject("dojo.regexp",a);a.escapeString=function(d,g){return d.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,function(h){return g&&-1!=g.indexOf(h)?h:"\\"+h})};a.buildGroupRE=function(d,g,h){if(!(d instanceof
Array))return g(d);for(var e=[],b=0;b<d.length;b++)e.push(g(d[b]));return a.group(e.join("|"),h)};a.group=function(d,g){return"("+(g?"?:":"")+d+")"};return a})},"dojo/date/locale":function(){define("../_base/lang ../_base/array ../date ../cldr/supplemental ../i18n ../regexp ../string ../i18n!../cldr/nls/gregorian module".split(" "),function(A,q,a,d,g,h,e,b,c){function l(v,u,t,w){return w.replace(/([a-z])\1*/ig,function(x){var y=x.charAt(0);x=x.length;var z=["abbr","wide","narrow"];switch(y){case "G":var B=
u[4>x?"eraAbbr":"eraNames"][0>v.getFullYear()?0:1];break;case "y":B=v.getFullYear();switch(x){case 1:break;case 2:if(!t.fullYear){B=String(B);B=B.substr(B.length-2);break}default:var F=!0}break;case "Q":case "q":B=Math.ceil((v.getMonth()+1)/3);F=!0;break;case "M":case "L":B=v.getMonth();3>x?(B+=1,F=!0):(y=["months","L"==y?"standAlone":"format",z[x-3]].join("-"),B=u[y][B]);break;case "w":B=m._getWeekOfYear(v,0);F=!0;break;case "d":B=v.getDate();F=!0;break;case "D":B=m._getDayOfYear(v);F=!0;break;case "e":case "c":if(B=
v.getDay(),2>x){B=(B-d.getFirstDayOfWeek(t.locale)+8)%7;break}case "E":B=v.getDay();3>x?(B+=1,F=!0):(y=["days","c"==y?"standAlone":"format",z[x-3]].join("-"),B=u[y][B]);break;case "a":y=12>v.getHours()?"am":"pm";B=t[y]||u["dayPeriods-format-wide-"+y];break;case "h":case "H":case "K":case "k":F=v.getHours();switch(y){case "h":B=F%12||12;break;case "H":B=F;break;case "K":B=F%12;break;case "k":B=F||24}F=!0;break;case "m":B=v.getMinutes();F=!0;break;case "s":B=v.getSeconds();F=!0;break;case "S":B=Math.round(v.getMilliseconds()*
Math.pow(10,x-3));F=!0;break;case "v":case "z":if(B=m._getZone(v,!0,t))break;x=4;case "Z":y=m._getZone(v,!1,t);y=[0>=y?"+":"-",e.pad(Math.floor(Math.abs(y)/60),2),e.pad(Math.abs(y)%60,2)];4==x&&(y.splice(0,0,"GMT"),y.splice(3,0,":"));B=y.join("");break;default:throw Error("dojo.date.locale.format: invalid pattern char: "+w);}F&&(B=e.pad(B,x));return B})}function k(v,u,t,w){var x=function(B){return B};u=u||x;t=t||x;w=w||x;var y=v.match(/(''|[^'])+/g),z="'"==v.charAt(0);q.forEach(y,function(B,F){B?
(y[F]=(z?t:u)(B.replace(/''/g,"'")),z=!z):y[F]=""});return w(y.join(""))}function f(v,u,t,w){w=h.escapeString(w);t.strict||(w=w.replace(" a"," ?a"));return w.replace(/([a-z])\1*/ig,function(x){var y=x.charAt(0);var z=x.length,B="",F="";t.strict?(1<z&&(B="0{"+(z-1)+"}"),2<z&&(F="0{"+(z-2)+"}")):(B="0?",F="0{0,2}");switch(y){case "y":y="\\d{2,4}";break;case "M":case "L":2<z?(y=u["months-"+("L"==y?"standAlone":"format")+"-"+n[z-3]].slice(0).join("|"),t.strict||(y=y.replace(/\./g,""),y="(?:"+y+")\\.?")):
y="1[0-2]|"+B+"[1-9]";break;case "D":y="[12][0-9][0-9]|3[0-5][0-9]|36[0-6]|"+B+"[1-9][0-9]|"+F+"[1-9]";break;case "d":y="3[01]|[12]\\d|"+B+"[1-9]";break;case "w":y="[1-4][0-9]|5[0-3]|"+B+"[1-9]";break;case "E":case "e":case "c":y=".+?";break;case "h":y="1[0-2]|"+B+"[1-9]";break;case "k":y="1[01]|"+B+"\\d";break;case "H":y="1\\d|2[0-3]|"+B+"\\d";break;case "K":y="1\\d|2[0-4]|"+B+"[1-9]";break;case "m":case "s":y="[0-5]\\d";break;case "S":y="\\d{"+z+"}";break;case "a":z=t.am||u["dayPeriods-format-wide-am"];
B=t.pm||u["dayPeriods-format-wide-pm"];y=z+"|"+B;t.strict||(z!=z.toLowerCase()&&(y+="|"+z.toLowerCase()),B!=B.toLowerCase()&&(y+="|"+B.toLowerCase()),-1!=y.indexOf(".")&&(y+="|"+y.replace(/\./g,"")));y=y.replace(/\./g,"\\.");break;default:y=".*"}v&&v.push(x);return"("+y+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var m={};A.setObject(c.id.replace(/\//g,"."),m);m._getZone=function(v,u,t){return u?a.getTimezoneName(v):v.getTimezoneOffset()};m.format=function(v,u){u=u||{};var t=g.normalizeLocale(u.locale),
w=u.formatLength||"short";t=m._getGregorianBundle(t);var x=[];v=A.hitch(this,l,v,t,u);if("year"==u.selector)return k(t["dateFormatItem-yyyy"]||"yyyy",v);var y;"date"!=u.selector&&(y=u.timePattern||t["timeFormat-"+w])&&x.push(k(y,v));"time"!=u.selector&&(y=u.datePattern||t["dateFormat-"+w])&&x.push(k(y,v));return 1==x.length?x[0]:t["dateTimeFormat-"+w].replace(/'/g,"").replace(/\{(\d+)\}/g,function(z,B){return x[B]})};m.regexp=function(v){return m._parseInfo(v).regexp};m._parseInfo=function(v){v=v||
{};var u=g.normalizeLocale(v.locale);u=m._getGregorianBundle(u);var t=v.formatLength||"short",w=v.datePattern||u["dateFormat-"+t],x=v.timePattern||u["timeFormat-"+t];t="date"==v.selector?w:"time"==v.selector?x:u["dateTimeFormat-"+t].replace(/\{(\d+)\}/g,function(z,B){return[x,w][B]});var y=[];return{regexp:k(t,A.hitch(this,f,y,u,v)),tokens:y,bundle:u}};m.parse=function(v,u){var t=/[\u200E\u200F\u202A\u202E]/g,w=m._parseInfo(u),x=w.tokens,y=w.bundle;v=(new RegExp("^"+w.regexp.replace(t,"")+"$",w.strict?
"":"i")).exec(v&&v.replace(t,""));if(!v)return null;var z=["abbr","wide","narrow"],B=[1970,0,1,0,0,0,0],F="";v=q.every(v,function(C,E){if(!E)return!0;var G=x[E-1];E=G.length;G=G.charAt(0);switch(G){case "y":if(2!=E&&u.strict)B[0]=C;else if(100>C)C=Number(C),G=""+(new Date).getFullYear(),E=100*G.substring(0,2),G=Math.min(Number(G.substring(2,4))+20,99),B[0]=C<G?E+C:E-100+C;else{if(u.strict)return!1;B[0]=C}break;case "M":case "L":if(2<E){if(E=y["months-"+("L"==G?"standAlone":"format")+"-"+z[E-3]].concat(),
u.strict||(C=C.replace(".","").toLowerCase(),E=q.map(E,function(K){return K.replace(".","").toLowerCase()})),C=q.indexOf(E,C),-1==C)return!1}else C--;B[1]=C;break;case "E":case "e":case "c":E=y["days-"+("c"==G?"standAlone":"format")+"-"+z[E-3]].concat();u.strict||(C=C.toLowerCase(),E=q.map(E,function(K){return K.toLowerCase()}));C=q.indexOf(E,C);if(-1==C)return!1;break;case "D":B[1]=0;case "d":B[2]=C;break;case "a":E=u.am||y["dayPeriods-format-wide-am"];G=u.pm||y["dayPeriods-format-wide-pm"];if(!u.strict){var H=
/\./g;C=C.replace(H,"").toLowerCase();E=E.replace(H,"").toLowerCase();G=G.replace(H,"").toLowerCase()}if(u.strict&&C!=E&&C!=G)return!1;F=C==G?"p":C==E?"a":"";break;case "K":24==C&&(C=0);case "h":case "H":case "k":if(23<C)return!1;B[3]=C;break;case "m":B[4]=C;break;case "s":B[5]=C;break;case "S":B[6]=C}return!0});t=+B[3];"p"===F&&12>t?B[3]=t+12:"a"===F&&12==t&&(B[3]=0);t=new Date(B[0],B[1],B[2],B[3],B[4],B[5],B[6]);u.strict&&t.setFullYear(B[0]);var D=x.join("");w=-1!=D.indexOf("d");D=-1!=D.indexOf("M");
if(!v||D&&t.getMonth()>B[1]||w&&t.getDate()>B[2])return null;if(D&&t.getMonth()<B[1]||w&&t.getDate()<B[2])t=a.add(t,"hour",1);return t};var n=["abbr","wide","narrow"],p=[],r={};m.addCustomFormats=function(v,u){p.push({pkg:v,name:u});r={}};m._getGregorianBundle=function(v){if(r[v])return r[v];var u={};q.forEach(p,function(t){t=g.getLocalization(t.pkg,t.name,v);u=A.mixin(u,t)},this);return r[v]=u};m.addCustomFormats(c.id.replace(/\/date\/locale$/,".cldr"),"gregorian");m.getNames=function(v,u,t,w){w=
m._getGregorianBundle(w);v=[v,t,u];if("standAlone"==t){t=v.join("-");var x=w[t];1==x[0]&&(x=void 0)}v[1]="format";return(x||w[v.join("-")]).concat()};m.isWeekend=function(v,u){u=d.getWeekend(u);v=(v||new Date).getDay();u.end<u.start&&(u.end+=7,v<u.start&&(v+=7));return v>=u.start&&v<=u.end};m._getDayOfYear=function(v){return a.difference(new Date(v.getFullYear(),0,1,v.getHours()),v)+1};m._getWeekOfYear=function(v,u){1==arguments.length&&(u=0);var t=(new Date(v.getFullYear(),0,1)).getDay(),w=(t-u+
7)%7;w=Math.floor((m._getDayOfYear(v)+w-1)/7);t==u&&w++;return w};return m})},"dojo/cldr/supplemental":function(){define(["../_base/lang","../i18n"],function(A,q){var a={};A.setObject("dojo.cldr.supplemental",a);a.getFirstDayOfWeek=function(d){d={bd:5,mv:5,ae:6,af:6,bh:6,dj:6,dz:6,eg:6,iq:6,ir:6,jo:6,kw:6,ly:6,ma:6,om:6,qa:6,sa:6,sd:6,sy:6,ye:6,ag:0,ar:0,as:0,au:0,br:0,bs:0,bt:0,bw:0,by:0,bz:0,ca:0,cn:0,co:0,dm:0,"do":0,et:0,gt:0,gu:0,hk:0,hn:0,id:0,ie:0,il:0,"in":0,jm:0,jp:0,ke:0,kh:0,kr:0,la:0,
mh:0,mm:0,mo:0,mt:0,mx:0,mz:0,ni:0,np:0,nz:0,pa:0,pe:0,ph:0,pk:0,pr:0,py:0,sg:0,sv:0,th:0,tn:0,tt:0,tw:0,um:0,us:0,ve:0,vi:0,ws:0,za:0,zw:0}[a._region(d)];return void 0===d?1:d};a._region=function(d){d=q.normalizeLocale(d);d=d.split("-");var g=d[1];g?4==g.length&&(g=d[2]):g={aa:"et",ab:"ge",af:"za",ak:"gh",am:"et",ar:"eg",as:"in",av:"ru",ay:"bo",az:"az",ba:"ru",be:"by",bg:"bg",bi:"vu",bm:"ml",bn:"bd",bo:"cn",br:"fr",bs:"ba",ca:"es",ce:"ru",ch:"gu",co:"fr",cr:"ca",cs:"cz",cv:"ru",cy:"gb",da:"dk",de:"de",
dv:"mv",dz:"bt",ee:"gh",el:"gr",en:"us",es:"es",et:"ee",eu:"es",fa:"ir",ff:"sn",fi:"fi",fj:"fj",fo:"fo",fr:"fr",fy:"nl",ga:"ie",gd:"gb",gl:"es",gn:"py",gu:"in",gv:"gb",ha:"ng",he:"il",hi:"in",ho:"pg",hr:"hr",ht:"ht",hu:"hu",hy:"am",ia:"fr",id:"id",ig:"ng",ii:"cn",ik:"us","in":"id",is:"is",it:"it",iu:"ca",iw:"il",ja:"jp",ji:"ua",jv:"id",jw:"id",ka:"ge",kg:"cd",ki:"ke",kj:"na",kk:"kz",kl:"gl",km:"kh",kn:"in",ko:"kr",ks:"in",ku:"tr",kv:"ru",kw:"gb",ky:"kg",la:"va",lb:"lu",lg:"ug",li:"nl",ln:"cd",lo:"la",
lt:"lt",lu:"cd",lv:"lv",mg:"mg",mh:"mh",mi:"nz",mk:"mk",ml:"in",mn:"mn",mo:"ro",mr:"in",ms:"my",mt:"mt",my:"mm",na:"nr",nb:"no",nd:"zw",ne:"np",ng:"na",nl:"nl",nn:"no",no:"no",nr:"za",nv:"us",ny:"mw",oc:"fr",om:"et",or:"in",os:"ge",pa:"in",pl:"pl",ps:"af",pt:"br",qu:"pe",rm:"ch",rn:"bi",ro:"ro",ru:"ru",rw:"rw",sa:"in",sd:"in",se:"no",sg:"cf",si:"lk",sk:"sk",sl:"si",sm:"ws",sn:"zw",so:"so",sq:"al",sr:"rs",ss:"za",st:"za",su:"id",sv:"se",sw:"tz",ta:"in",te:"in",tg:"tj",th:"th",ti:"et",tk:"tm",tl:"ph",
tn:"za",to:"to",tr:"tr",ts:"za",tt:"ru",ty:"pf",ug:"cn",uk:"ua",ur:"pk",uz:"uz",ve:"za",vi:"vn",wa:"be",wo:"sn",xh:"za",yi:"il",yo:"ng",za:"cn",zh:"cn",zu:"za",ace:"id",ady:"ru",agq:"cm",alt:"ru",amo:"ng",asa:"tz",ast:"es",awa:"in",bal:"pk",ban:"id",bas:"cm",bax:"cm",bbc:"id",bem:"zm",bez:"tz",bfq:"in",bft:"pk",bfy:"in",bhb:"in",bho:"in",bik:"ph",bin:"ng",bjj:"in",bku:"ph",bqv:"ci",bra:"in",brx:"in",bss:"cm",btv:"pk",bua:"ru",buc:"yt",bug:"id",bya:"id",byn:"er",cch:"ng",ccp:"in",ceb:"ph",cgg:"ug",
chk:"fm",chm:"ru",chp:"ca",chr:"us",cja:"kh",cjm:"vn",ckb:"iq",crk:"ca",csb:"pl",dar:"ru",dav:"ke",den:"ca",dgr:"ca",dje:"ne",doi:"in",dsb:"de",dua:"cm",dyo:"sn",dyu:"bf",ebu:"ke",efi:"ng",ewo:"cm",fan:"gq",fil:"ph",fon:"bj",fur:"it",gaa:"gh",gag:"md",gbm:"in",gcr:"gf",gez:"et",gil:"ki",gon:"in",gor:"id",grt:"in",gsw:"ch",guz:"ke",gwi:"ca",haw:"us",hil:"ph",hne:"in",hnn:"ph",hoc:"in",hoj:"in",ibb:"ng",ilo:"ph",inh:"ru",jgo:"cm",jmc:"tz",kaa:"uz",kab:"dz",kaj:"ng",kam:"ke",kbd:"ru",kcg:"ng",kde:"tz",
kdt:"th",kea:"cv",ken:"cm",kfo:"ci",kfr:"in",kha:"in",khb:"cn",khq:"ml",kht:"in",kkj:"cm",kln:"ke",kmb:"ao",koi:"ru",kok:"in",kos:"fm",kpe:"lr",krc:"ru",kri:"sl",krl:"ru",kru:"in",ksb:"tz",ksf:"cm",ksh:"de",kum:"ru",lag:"tz",lah:"pk",lbe:"ru",lcp:"cn",lep:"in",lez:"ru",lif:"np",lis:"cn",lki:"ir",lmn:"in",lol:"cd",lua:"cd",luo:"ke",luy:"ke",lwl:"th",mad:"id",mag:"in",mai:"in",mak:"id",man:"gn",mas:"ke",mdf:"ru",mdh:"ph",mdr:"id",men:"sl",mer:"ke",mfe:"mu",mgh:"mz",mgo:"cm",min:"id",mni:"in",mnk:"gm",
mnw:"mm",mos:"bf",mua:"cm",mwr:"in",myv:"ru",nap:"it",naq:"na",nds:"de","new":"np",niu:"nu",nmg:"cm",nnh:"cm",nod:"th",nso:"za",nus:"sd",nym:"tz",nyn:"ug",pag:"ph",pam:"ph",pap:"bq",pau:"pw",pon:"fm",prd:"ir",raj:"in",rcf:"re",rej:"id",rjs:"np",rkt:"in",rof:"tz",rwk:"tz",saf:"gh",sah:"ru",saq:"ke",sas:"id",sat:"in",saz:"in",sbp:"tz",scn:"it",sco:"gb",sdh:"ir",seh:"mz",ses:"ml",shi:"ma",shn:"mm",sid:"et",sma:"se",smj:"se",smn:"fi",sms:"fi",snk:"ml",srn:"sr",srr:"sn",ssy:"er",suk:"tz",sus:"gn",swb:"yt",
swc:"cd",syl:"bd",syr:"sy",tbw:"ph",tcy:"in",tdd:"cn",tem:"sl",teo:"ug",tet:"tl",tig:"er",tiv:"ng",tkl:"tk",tmh:"ne",tpi:"pg",trv:"tw",tsg:"ph",tts:"th",tum:"mw",tvl:"tv",twq:"ne",tyv:"ru",tzm:"ma",udm:"ru",uli:"fm",umb:"ao",unr:"in",unx:"in",vai:"lr",vun:"tz",wae:"ch",wal:"et",war:"ph",xog:"ug",xsr:"np",yao:"mz",yap:"fm",yav:"cm",zza:"tr"}[d[0]];return g};a.getWeekend=function(d){var g=a._region(d);d={"in":0,af:4,dz:4,ir:4,om:4,sa:4,ye:4,ae:5,bh:5,eg:5,il:5,iq:5,jo:5,kw:5,ly:5,ma:5,qa:5,sd:5,sy:5,
tn:5}[g];g={af:5,dz:5,ir:5,om:5,sa:5,ye:5,ae:6,bh:5,eg:6,il:6,iq:6,jo:6,kw:6,ly:6,ma:6,qa:6,sd:6,sy:6,tn:6}[g];void 0===d&&(d=6);void 0===g&&(g=0);return{start:d,end:g}};return a})},"esri/SpatialReference":function(){define(["dojo/_base/declare","dojo/_base/array","dojo/has","./kernel","./lang"],function(A,q,a,d,g){function h(){}var e=[-2.0037508342788905E7,2.0037508342788905E7],b=[-2.0037508342787E7,2.0037508342787E7];A=A(null,{declaredClass:"esri.SpatialReference",constructor:function(c){c&&(g.isObject(c)?
g.mixin(this,c):g.isString(c)?this.wkt=c:this.wkid=c)},wkid:null,wkt:null,_info:{102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',
valid:e,origin:b,dx:1E-5},102100:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',valid:e,origin:b,
dx:1E-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:e,origin:b,dx:1E-5},3857:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',
valid:e,origin:b,dx:1E-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",${Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",${Central_Meridian}],UNIT["Degrees",111319.491]]',
valid:[-180,180],origin:[-180,180],dx:1E-5}},_isWebMercator:function(){return-1!==q.indexOf([102113,102100,3857,3785],this.wkid)},_isWrappable:function(){return-1!==q.indexOf([102113,102100,3857,3785,4326],this.wkid)},_getInfo:function(){return this.wkid?this._info[this.wkid]:null},_canProject:function(c){var l=!1;c&&(l=this.isWebMercator()&&4326===c.wkid||c.isWebMercator()&&4326===this.wkid);return l},isWebMercator:function(){return this._isWebMercator()},equals:function(c){var l=!1;c&&(this===c&&
(l=!0),this.wkid||c.wkid?l=this.wkid===c.wkid||this.isWebMercator()&&c.isWebMercator()||this.wkid===c.latestWkid||c.wkid===this.latestWkid:this.wkt&&c.wkt&&(l=this.wkt.toUpperCase()===c.wkt.toUpperCase()));return l},toJson:function(){var c=null;null!=this.wkid?c={wkid:this.wkid}:null!=this.wkt&&(c={wkt:this.wkt});c&&null!=this.latestWkid&&(c.latestWkid=this.latestWkid);return c}});h.prototype=A.prototype;A.simpleConstructor=h;a("extend-esri")&&(d.SpatialReference=A);return A})},"esri/geometry/Geometry":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel","../SpatialReference"],function(A,q,a,d,g){A=A(null,{declaredClass:"esri.geometry.Geometry",spatialReference:null,type:null,cache:void 0,setSpatialReference:function(h){this.spatialReference=h;return this},verifySR:function(){this.spatialReference||this.setSpatialReference(new g(4326))},getExtent:function(){return null},clearCache:function(){this.cache=void 0},getCacheValue:function(h){return this.cache&&this.cache[h]},setCacheValue:function(h,e){this.cache||
(this.cache={});this.cache[h]=e}});a("extend-esri")&&q.setObject("geometry.Geometry",A,d);return A})},"esri/geometry/Point":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../SpatialReference ./Geometry ../srUtils".split(" "),function(A,q,a,d,g,h,e,b){function c(n,p){89.99999<p?p=89.99999:-89.99999>p&&(p=-89.99999);p*=.017453292519943;return[111319.49079327169*n,3189068.5*Math.log((1+Math.sin(p))/(1-Math.sin(p)))]}function l(n,p,r){n=n/6378137*57.29577951308232;return r?
[n,57.29577951308232*(1.5707963267948966-2*Math.atan(Math.exp(-1*p/6378137)))]:[n-360*Math.floor((n+180)/360),57.29577951308232*(1.5707963267948966-2*Math.atan(Math.exp(-1*p/6378137)))]}function k(){}function f(){}function m(n){var p=n._json;n._unquantizeFn?(p=n._unquantizeFn({x:p.x,y:p.y}),n._xVal=p.x,n._yVal=p.y,n._unquantizeFn=null):(n._xVal=p.x,n._yVal=p.y);n._json=null}h={type:"point",x:0,y:0};A=A(e,{declaredClass:"esri.geometry.Point",type:"point",x:0,y:0,constructor:function(n,p,r){q.isArray(n)?
(this.x=n[0],this.y=n[1],this.spatialReference=p):g.isObject(n)?(g.mixin(this,n),null!=this.latitude&&(this.y=this.latitude),null!=this.longitude&&(this.x=this.longitude),this.spatialReference&&(this.spatialReference=b.createSpatialReference(this.spatialReference))):(this.x=n,this.y=p,this.spatialReference=r);this.verifySR()},offset:function(n,p){return new this.constructor(this.x+n,this.y+p,this.spatialReference)},setX:function(n){this.x=n;this.clearCache();return this},setY:function(n){this.y=n;
this.clearCache();return this},setLongitude:function(n){var p=this.spatialReference;p&&(p._isWebMercator()?this.setX(c(n,this.y)[0]):4326===p.wkid&&this.setX(n));return this},setLatitude:function(n){var p=this.spatialReference;p&&(p._isWebMercator()?this.setY(c(this.x,n)[1]):4326===p.wkid&&this.setY(n));return this},getLongitude:function(){var n=this.spatialReference;if(n)if(n._isWebMercator())var p=l(this.x,this.y)[0];else 4326===n.wkid&&(p=this.x);return p},getLatitude:function(){var n=this.spatialReference;
if(n)if(n._isWebMercator())var p=l(this.x,this.y)[1];else 4326===n.wkid&&(p=this.y);return p},update:function(n,p){this.x=n;this.y=p;this.clearCache();return this},normalize:function(){var n=this.x,p=this.spatialReference;if(p){var r=p._getInfo();r&&(n=this._normalizeX(n,r))}return new this.constructor(n,this.y,p)},_normalizeX:function(n,p){var r=p.valid[0],v=p.valid[1];p=2*v;n>v?(r=Math.ceil(Math.abs(n-v)/p),n-=r*p):n<r&&(r=Math.ceil(Math.abs(n-r)/p),n+=r*p);return n},toJson:function(){var n={x:this.x,
y:this.y},p=this.spatialReference;p&&(n.spatialReference=p.toJson());return n}});k.prototype=A.prototype;f.prototype=new k;Object.defineProperty(f.prototype,"x",{get:function(){this._json&&m(this);return this._xVal},set:function(n){this._xVal=n}});Object.defineProperty(f.prototype,"y",{get:function(){this._json&&m(this);return this._yVal},set:function(n){this._yVal=n}});f.prototype.setupLazyUnquantization=function(n,p){this._unquantizeFn=n;this._json=p};A.simpleConstructor=k;A.accessorConstructor=
f;A.lngLatToXY=c;A.xyToLngLat=l;A.defaultProps=h;A.metersPerDegree=6378137*Math.PI/180;a("extend-esri")&&(q.setObject("geometry.Point",A,d),d.geometry.defaultPoint=h);return A})},"esri/srUtils":function(){define(["./SpatialReference","./ImageSpatialReference","./kernel","./sniff","dojo/_base/lang"],function(A,q,a,d,g){function h(b){var c=!1;b&&(b.ics||b.icsid)&&(c=!0);return c}var e={isICS:h,createSpatialReference:function(b){var c=null;b&&(c=h(b)?new q(b):new A(b));return c}};d("extend-esri")&&g.mixin(a,
e);return e})},"esri/ImageSpatialReference":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ./kernel ./lang ./SpatialReference".split(" "),function(A,q,a,d,g,h){A=A(h,{declaredClass:"esri.ImageSpatialReference",constructor:function(e){e&&q.isObject(e)&&q.mixin(this,e)},icsid:null,icsns:null,ics:null,_isWebMercator:function(){return!1},_isWrappable:function(){return!1},equals:function(e){var b=!1;if(e)if(this.icsid&&e.icsid){if(b=this.icsid===e.icsid,this.icsns||e.icsns)b=b&&this.icsns===
e.icsns}else this.ics&&e.ics&&(b=this.ics===e.ics);return b},toJson:function(e){var b=null,c=g.isDefined;e=c(e)?e:!0;c(this.icsid)?(b={icsid:this.icsid},c(this.icsns)&&(b.icsns=this.icsns)):c(this.ics)&&(b={ics:this.ics});c(this.url)&&c(b)&&e&&(b.url=this.url);return b}});a("extend-esri")&&(d.ImageSpatialReference=A);return A})},"esri/sniff":function(){define(["dojo/_base/sniff","dojo/global","./kernel"],function(A,q,a){var d=A("ff"),g=A("ie"),h=void 0===g&&7<=A("trident"),e=A("edge"),b=A("webkit"),
c=A("opera"),l=A("chrome"),k=A("safari"),f=navigator.userAgent,m;(m=f.match(/(iPhone|iPad|CPU)\s+OS\s+(\d+_\d+)/i))&&A.add("esri-iphone",parseFloat(m[2].replace("_",".")));(m=f.match(/Android\s+(\d+(\.\d+)*)/i))&&A.add("esri-android",parseFloat(m[1]));(m=f.match(/Fennec\/(\d+\.\d+)/i))&&A.add("esri-fennec",parseFloat(m[1]));0<=f.indexOf("BlackBerry")&&0<=f.indexOf("WebKit")&&A.add("esri-blackberry",1);A.add("esri-touch",A("esri-iphone")||A("esri-android")||A("esri-blackberry")||6<=A("esri-fennec")||
(d||b)&&(document.createTouch||"ontouchstart"in q||q.TouchEvent&&0<navigator.maxTouchPoints)?!0:!1);(m=f.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i))&&A.add("esri-mobile",!!m);A.add("esri-pointer",!d&&(navigator.pointerEnabled||navigator.msPointerEnabled||!!q.PointerEvent));a._getDOMAccessor=function(p){var r="";d?r="Moz":b?r="Webkit":g?r="ms":c&&(r="O");return r+p.charAt(0).toUpperCase()+p.substr(1)};A.add("esri-phonegap",!!q.cordova);A.add("esri-cors",A("esri-phonegap")||
q.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest);A.add("esri-file-upload",q.FormData&&q.FileList?!0:!1);A.add("esri-script-sandbox",function(){return"MessageChannel"in q&&"HTMLIFrameElement"in q&&"sandbox"in HTMLIFrameElement.prototype});A.add("esri-secure-context",function(){if("isSecureContext"in q)return q.isSecureContext;if(q.location&&q.location.origin)return 0===q.location.origin.indexOf("https:")});A.add("esri-wasm","WebAssembly"in q);A.add("esri-workers",q.Worker?!0:!1);A.add("esri-featurelayer-webgl",
!1);if(f=A("esri-featurelayer-webgl")){var n=A("esri-mobile");m=n?1:2;n=n?1:3;"object"===typeof f?(f.maxDrillLevel=null==f.maxDrillLevel?m:f.maxDrillLevel,f.maxRecordCountFactor=null==f.maxRecordCountFactor?n:f.maxRecordCountFactor,f.enablePBFQuery=null==f.enablePBFQuery?!0:f.enablePBFQuery):A.add("esri-featurelayer-webgl",{maxDrillLevel:m,maxRecordCountFactor:n,enablePBFQuery:!0},null,!0)}A.add("esri-featurelayer-webgl-labeling",!1);A.add("esri-pbf",!g||10<=g);A.add("esri-featurelayer-pbf",!0);A.add("esri-transforms",
h||e||9<=g||3.5<=d||4<=l||3.1<=k||10.5<=c||3.2<=A("esri-iphone")||2.1<=A("esri-android"));A.add("esri-transitions",h||e||10<=g||4<=d||4<=l||3.1<=k||10.5<=c||3.2<=A("esri-iphone")||2.1<=A("esri-android"));A.add("esri-transforms3d",h||e||10<=d||12<=l||4<=k||3.2<=A("esri-iphone")||3<=A("esri-android"));A.add("esri-url-encodes-apostrophe",function(){if(!q.document)return!1;var p=q.document.createElement("a");p.href="?'";return-1<p.href.indexOf("?%27")});3>A("esri-android")&&(A.add("esri-transforms",!1,
!1,!0),A.add("esri-transitions",!1,!1,!0),A.add("esri-transforms3d",!1,!1,!0));A.add("esri-will-change",A("esri-transforms")&&(52<=l||11.1<=k));a._css=function(p){var r=A("esri-transforms3d");void 0!==p&&null!==p?r=p:r&&(l||k&&!A("esri-iphone"))&&(r=!1);var v=r?"translate3d(":"translate(",u=r?l?",-1px)":",0px)":")",t=r?"scale3d(":"scale(",w=r?",1)":")",x=r?"rotate3d(0,0,1,":"rotate(",y=r?"matrix3d(":"matrix(",z=r?",0,0,":",",B=r?",0,0,0,0,1,0,":",",F=r?",0,1)":")";return{names:{transition:b&&"-webkit-transition"||
d&&"MozTransition"||c&&"OTransition"||g&&"msTransition"||"transition",transform:b&&"-webkit-transform"||d&&"MozTransform"||c&&"OTransform"||g&&"msTransform"||"transform",transformName:b&&"-webkit-transform"||d&&"-moz-transform"||c&&"-o-transform"||g&&"-ms-transform"||"transform",origin:b&&"-webkit-transform-origin"||d&&"MozTransformOrigin"||c&&"OTransformOrigin"||g&&"msTransformOrigin"||"transformOrigin",endEvent:b&&"webkitTransitionEnd"||d&&"transitionend"||c&&"oTransitionEnd"||g&&"MSTransitionEnd"||
"transitionend"},translate:function(D,C){return v+D+"px,"+C+"px"+u},scale:function(D){return t+D+","+D+w},rotate:function(D){return x+D+"deg)"},matrix:function(D){return y+D.xx+","+D.xy+z+D.yx+","+D.yy+B+D.dx.toFixed(10)+(d&&59>=d?"px,":",")+D.dy.toFixed(10)+(d&&59>=d?"px":"")+F},getScaleFromMatrix:function(D){if(!D)return 1;D=D.toLowerCase();var C=-1<D.indexOf("matrix3d")?"matrix3d(":"matrix(";return Number(D.substring(C.length,D.indexOf(",")))}}};A("extend-esri")&&(a.isiPhone=A("esri-iphone"),a.isAndroid=
A("esri-android"),a.isFennec=A("esri-fennec"),a.isBlackBerry=A("esri-blackberry"),a.isTouchEnabled=A("esri-touch"),a.isPointerEnabled=A("esri-pointer"),a._hasCors=A("esri-cors"),a._hasFileUpload=A("esri-file-upload"),a._hasTransforms=A("esri-transforms"),a._hasTransitions=A("esri-transitions"),a._has3DTransforms=A("esri-transforms3d"));return A})},"esri/geometry/webMercatorUtils":function(){define("dojo/_base/array dojo/_base/lang dojo/has ../kernel ../SpatialReference ./Point".split(" "),function(A,
q,a,d,g,h){function e(l,k,f,m){if("point"===l.type){var n=k(l.x,l.y,m);return new l.constructor(n[0],n[1],new g(f))}if("extent"===l.type){n=k(l.xmin,l.ymin,m);var p=k(l.xmax,l.ymax,m);return new l.constructor(n[0],n[1],p[0],p[1],new g(f))}if("polyline"===l.type||"polygon"===l.type){n="polyline"===l.type;var r=[],v;A.forEach(n?l.paths:l.rings,function(t){r.push(v=[]);A.forEach(t,function(w){v.push(k(w[0],w[1],m))})});return n?new l.constructor({paths:r,spatialReference:new g(f)}):new l.constructor({rings:r,
spatialReference:new g(f)})}if("multipoint"===l.type){var u=[];A.forEach(l.points,function(t){u.push(k(t[0],t[1],m))});return new l.constructor({points:u,spatialReference:new g(f)})}}function b(l,k){l=l&&(null!=l.wkid?l:l.spatialReference);k=k&&(null!=k.wkid?k:k.spatialReference);return l&&k?k.equals(l)?!0:k._canProject(l):!1}var c={canProject:b,project:function(l,k){var f=l&&l.spatialReference;k=k&&(null!=k.wkid?k:k.spatialReference);f&&k?f.equals(k)?l=new l.constructor(l.toJson()):b(f,k)?k.isWebMercator()?
l=e(l,h.lngLatToXY,{wkid:102100}):4326===k.wkid&&(l=e(l,h.xyToLngLat,{wkid:4326})):l=null:l=null;return l},lngLatToXY:h.lngLatToXY,xyToLngLat:h.xyToLngLat,metersPerDegree:h.metersPerDegree,geographicToWebMercator:function(l){return e(l,h.lngLatToXY,{wkid:102100})},webMercatorToGeographic:function(l,k){return e(l,h.xyToLngLat,{wkid:4326},k)}};a("extend-esri")&&q.mixin(q.getObject("geometry",!0,d),c);return c})},"esri/geometry/mathUtils":function(){define(["dojo/_base/lang","dojo/has","../kernel","./Point"],
function(A,q,a,d){function g(c,l,k){return c instanceof d?new d(c.x+k*(l.x-c.x),c.y+k*(l.y-c.y)):[c[0]+k*(l[0]-c[0]),c[1]+k*(l[1]-c[1])]}function h(c,l){return 1E-8>Math.abs(c-l)}function e(c,l,k,f){var m=h(c[0],l[0])?1E10:(c[1]-l[1])/(c[0]-l[0]),n=h(k[0],f[0])?1E10:(k[1]-f[1])/(k[0]-f[0]),p=c[1]-m*c[0],r=k[1]-n*k[0];if(h(m,n)){if(h(p,r)){if(h(c[0],l[0]))if(Math.min(c[1],l[1])<Math.max(k[1],f[1])||Math.max(c[1],l[1])>Math.min(k[1],f[1])){c=(c[1]+l[1]+k[1]+f[1]-Math.min(c[1],l[1],k[1],f[1])-Math.max(c[1],
l[1],k[1],f[1]))/2;var v=(c-p)/m}else return null;else if(Math.min(c[0],l[0])<Math.max(k[0],f[0])||Math.max(c[0],l[0])>Math.min(k[0],f[0]))v=(c[0]+l[0]+k[0]+f[0]-Math.min(c[0],l[0],k[0],f[0])-Math.max(c[0],l[0],k[0],f[0]))/2,c=m*v+p;else return null;return[v,c]}return null}h(m,1E10)?(v=c[0],c=n*v+r):h(n,1E10)?(v=k[0],c=m*v+p):(v=-(p-r)/(m-n),c=c[1]===l[1]?c[1]:k[1]===f[1]?k[1]:m*v+p);return[v,c]}var b={getLength:function(c,l){var k=l.x-c.x;c=l.y-c.y;return Math.sqrt(k*k+c*c)},_getLength:function(c,
l){var k=l[0]-c[0];c=l[1]-c[1];return Math.sqrt(k*k+c*c)},getPointOnLine:g,getMidpoint:function(c,l){return g(c,l,.5)},_equals:h,_getLineIntersection:e,getLineIntersection:function(c,l,k,f,m){(c=e([c.x,c.y],[l.x,l.y],[k.x,k.y],[f.x,f.y]))&&(c=new d(c[0],c[1],m));return c},_getLineIntersection2:function(c,l){var k=c[0],f=c[1],m=l[0],n=l[1];l=k[0];k=k[1];c=f[0];f=f[1];var p=m[0],r=m[1];m=n[0]-p;p=l-p;var v=c-l;n=n[1]-r;r=k-r;var u=f-k,t=n*v-m*u;if(0===t)return!1;m=(m*r-n*p)/t;p=(v*r-u*p)/t;return 0<=
m&&1>=m&&0<=p&&1>=p?[l+m*(c-l),k+m*(f-k)]:!1},_pointLineDistance:function(c,l){var k=l[0],f=l[1];l=k[0];var m=k[1];k=c[0];c=c[1];var n=f[0]-l,p=f[1]-m,r=k-l,v=c-m;f=Math.sqrt;var u=Math.pow,t=f(u(n,2)+u(p,2));r=(r*n+v*p)/(t*t);m+=r*p;return f(u(k-(l+r*n),2)+u(c-m,2))}};q("extend-esri")&&A.mixin(A.getObject("geometry",!0,a),b);return b})},"esri/layers/rasterLib/tile/RasterTileInfo":function(){define("dojo/_base/declare dojo/_base/lang ../../../geometry/Extent ../../../SpatialReference ../../../geometry/Point ../../../lang ../../TileInfo".split(" "),
function(A,q,a,d,g,h,e){return A([e],{declaredClass:"esri.layers.rasterLib.tile.RasterTileInfo",rows:512,cols:512,compressionQuality:95,lercError:.01,spatialReference:null,origin:null,virtual:!0,tileType:"Raster",constructor:function(b,c){if(b||c){var l=c&&c.refTileInfo;b?this.virtual=!1:(this.virtual=!0,q.mixin(this,{rows:c.rows||this.rows,cols:c.cols||this.cols,compressionQuality:c.compressionQuality||95,lercError:c.compressionTolerance||.01,spatialReference:c.spatialReference,origin:c.origin}),
this.width=this.cols,this.height=this.rows,this.origin||(l?this.origin=l.origin:c.spatialReference.isWebMercator()||c.extent&&360<=Math.max(Math.abs(c.extent.xmin),Math.abs(c.extent.xmax))?this.origin={x:-2.0037508342787E7,y:2.0037508342787E7}:-1<[4326,4269].indexOf(c.spatialReference.wkid)||360>Math.max(Math.abs(c.extent.xmin),Math.abs(c.extent.xmax))?this.origin={x:-180,y:90}:this.origin={x:c.extent.xmin,y:c.extent.ymax}))}},toJson:function(){var b=e.prototype.toJson.apply(this);b.tileType=this.tileType;
b.virtual=this.virtual;b.lercError=this.lercError;return b},clone:function(){return new this.prototype(this.toJson())}})})},"esri/layers/TileInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../SpatialReference ../geometry/Point ./LOD".split(" "),function(A,q,a,d,g,h,e,b,c){A=A(null,{declaredClass:"esri.layers.TileInfo",constructor:function(l){q.mixin(this,l);this.width=this.cols;this.height=this.rows;this._levelToLOD={};l=this.spatialReference;
var k=this.origin;l&&(l=this.spatialReference=new e(l.toJson?l.toJson():l));k&&(this.origin=new b(k.toJson?k.toJson():k),!k.spatialReference&&l&&this.origin.setSpatialReference(new e(l.toJson())));this.lods=a.map(this.lods,function(n){return new c(n)});a.forEach(this.lods,function(n){this._levelToLOD[n.level]=n},this);l=!1;k=this.spatialReference;var f=this.origin;if(k&&f){var m=k._getInfo();m&&(l=k._isWrappable()&&Math.abs(m.origin[0]-f.x)<=m.dx)}this.isWrappable=l;this._initializeUpsampleLevels()},
toJson:function(){return h.fixJson({rows:this.rows,cols:this.cols,dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin&&this.origin.toJson(),spatialReference:this.spatialReference&&this.spatialReference.toJson(),lods:this.lods&&a.map(this.lods,function(l){return l.toJson()})})},lodAt:function(l){return this._levelToLOD&&this._levelToLOD[l]||null},updateTileInfo:function(l){var k=this.lodAt(l.level),f=k.resolution*this.width;k=k.resolution*this.height;l.id=
l.level+"/"+l.row+"/"+l.col;l.extent||(l.extent=[0,0,0,0]);l.extent[0]=this.origin.x+l.col*f;l.extent[1]=this.origin.y-(l.row+1)*k;l.extent[2]=l.extent[0]+f;l.extent[3]=l.extent[1]+k},upsampleTile:function(l){var k=this._upsampleLevels[l.level];if(!k||-1===k.parentLevel)return!1;l.level=k.parentLevel;l.row=Math.floor(l.row/k.factor+.001);l.col=Math.floor(l.col/k.factor+.001);this.updateTileInfo(l);return!0},_initializeUpsampleLevels:function(){var l=this.lods;this._upsampleLevels=[];for(var k=null,
f=0;f<l.length;f++){var m=l[f];this._upsampleLevels[m.level]={parentLevel:k?k.level:-1,factor:k?k.resolution/m.resolution:0};k=m}}});d("extend-esri")&&q.setObject("layers.TileInfo",A,g);return A})},"esri/layers/LOD":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(A,q,a,d,g){A=A(null,{declaredClass:"esri.layers.LOD",constructor:function(h){q.mixin(this,h)},toJson:function(){return g.fixJson({level:this.level,levelValue:this.levelValue,resolution:this.resolution,
scale:this.scale})}});a("extend-esri")&&q.setObject("layers.LOD",A,d);return A})},"esri/WKIDUnitConversion":function(){define(["dojo/has","./kernel"],function(A,q){var a,d={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.116756,5E4,15E4],units:"Meter Foot Foot_US Foot_Clarke Yard_Clarke Link_Clarke Yard_Sears Foot_Sears Chain_Sears Chain_Benoit_1895_B Yard_Indian Yard_Indian_1937 Foot_Gold_Coast Chain_Sears_1922_Truncated 50_Kilometers 150_Kilometers".split(" "),
2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:13,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,
3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,
3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,
3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,
5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,
6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,
6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,
6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,
6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,
7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,
7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,
8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,
8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,
8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22332:0,22391:0,22392:0,22700:0,22770:0,22780:0,22832:0,
23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25E3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,
30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:14,102069:15,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102761:2,
102762:0,102763:2,102764:0,102765:0,102766:2,102962:0,102963:0,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,
103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,
103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,
103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(a=2E3;2045>=
a;a++)d[a]=0;for(a=2056;2065>=a;a++)d[a]=0;for(a=2067;2135>=a;a++)d[a]=0;for(a=2137;2154>=a;a++)d[a]=0;for(a=2161;2170>=a;a++)d[a]=0;for(a=2172;2193>=a;a++)d[a]=0;for(a=2195;2198>=a;a++)d[a]=0;for(a=2200;2203>=a;a++)d[a]=0;for(a=2205;2217>=a;a++)d[a]=0;for(a=2222;2224>=a;a++)d[a]=1;for(a=2225;2250>=a;a++)d[a]=2;for(a=2251;2253>=a;a++)d[a]=1;for(a=2257;2264>=a;a++)d[a]=2;for(a=2274;2279>=a;a++)d[a]=2;for(a=2280;2282>=a;a++)d[a]=1;for(a=2283;2289>=a;a++)d[a]=2;for(a=2290;2292>=a;a++)d[a]=0;for(a=2308;2313>=
a;a++)d[a]=0;for(a=2315;2491>=a;a++)d[a]=0;for(a=2494;2866>=a;a++)d[a]=0;for(a=2867;2869>=a;a++)d[a]=1;for(a=2870;2888>=a;a++)d[a]=2;for(a=2891;2895>=a;a++)d[a]=2;for(a=2896;2898>=a;a++)d[a]=1;for(a=2902;2908>=a;a++)d[a]=2;for(a=2915;2920>=a;a++)d[a]=2;for(a=2921;2923>=a;a++)d[a]=1;for(a=2924;2930>=a;a++)d[a]=2;for(a=2931;2962>=a;a++)d[a]=0;for(a=2964;2968>=a;a++)d[a]=2;for(a=2969;2973>=a;a++)d[a]=0;for(a=2975;2991>=a;a++)d[a]=0;for(a=2995;3051>=a;a++)d[a]=0;for(a=3054;3079>=a;a++)d[a]=0;for(a=3081;3088>=
a;a++)d[a]=0;for(a=3092;3101>=a;a++)d[a]=0;for(a=3106;3138>=a;a++)d[a]=0;for(a=3146;3151>=a;a++)d[a]=0;for(a=3153;3166>=a;a++)d[a]=0;for(a=3168;3172>=a;a++)d[a]=0;for(a=3174;3203>=a;a++)d[a]=0;for(a=3294;3358>=a;a++)d[a]=0;for(a=3367;3403>=a;a++)d[a]=0;for(a=3408;3416>=a;a++)d[a]=0;for(a=3417;3438>=a;a++)d[a]=2;for(a=3441;3446>=a;a++)d[a]=2;for(a=3447;3450>=a;a++)d[a]=0;for(a=3451;3459>=a;a++)d[a]=2;for(a=3460;3478>=a;a++)d[a]=0;for(a=3554;3559>=a;a++)d[a]=0;for(a=3560;3570>=a;a++)d[a]=2;for(a=3571;3581>=
a;a++)d[a]=0;for(a=3594;3597>=a;a++)d[a]=0;for(a=3601;3604>=a;a++)d[a]=0;for(a=3637;3639>=a;a++)d[a]=0;for(a=3665;3667>=a;a++)d[a]=0;for(a=3693;3695>=a;a++)d[a]=0;for(a=3701;3727>=a;a++)d[a]=0;for(a=3728;3739>=a;a++)d[a]=2;for(a=3740;3751>=a;a++)d[a]=0;for(a=3753;3760>=a;a++)d[a]=2;for(a=3761;3773>=a;a++)d[a]=0;for(a=3775;3777>=a;a++)d[a]=0;for(a=3779;3781>=a;a++)d[a]=0;for(a=3783;3785>=a;a++)d[a]=0;for(a=3788;3791>=a;a++)d[a]=0;for(a=3797;3802>=a;a++)d[a]=0;for(a=3814;3816>=a;a++)d[a]=0;for(a=3825;3829>=
a;a++)d[a]=0;for(a=3832;3841>=a;a++)d[a]=0;for(a=3844;3852>=a;a++)d[a]=0;for(a=3873;3885>=a;a++)d[a]=0;for(a=3890;3893>=a;a++)d[a]=0;for(a=3907;3912>=a;a++)d[a]=0;for(a=3942;3950>=a;a++)d[a]=0;for(a=3968;3970>=a;a++)d[a]=0;for(a=3973;3976>=a;a++)d[a]=0;for(a=3986;3989>=a;a++)d[a]=0;for(a=3994;3997>=a;a++)d[a]=0;for(a=4048;4051>=a;a++)d[a]=0;for(a=4056;4063>=a;a++)d[a]=0;for(a=4093;4096>=a;a++)d[a]=0;for(a=4390;4398>=a;a++)d[a]=0;for(a=4399;4413>=a;a++)d[a]=2;for(a=4418;4433>=a;a++)d[a]=2;for(a=4455;4457>=
a;a++)d[a]=2;for(a=4484;4489>=a;a++)d[a]=0;for(a=4491;4554>=a;a++)d[a]=0;for(a=4568;4589>=a;a++)d[a]=0;for(a=4652;4656>=a;a++)d[a]=0;for(a=4766;4800>=a;a++)d[a]=0;for(a=5014;5016>=a;a++)d[a]=0;for(a=5069;5072>=a;a++)d[a]=0;for(a=5105;5130>=a;a++)d[a]=0;for(a=5173;5188>=a;a++)d[a]=0;for(a=5253;5259>=a;a++)d[a]=0;for(a=5269;5275>=a;a++)d[a]=0;for(a=5292;5311>=a;a++)d[a]=0;for(a=5329;5331>=a;a++)d[a]=0;for(a=5343;5349>=a;a++)d[a]=0;for(a=5355;5357>=a;a++)d[a]=0;for(a=5387;5389>=a;a++)d[a]=0;for(a=5459;5463>=
a;a++)d[a]=0;for(a=5479;5482>=a;a++)d[a]=0;for(a=5518;5520>=a;a++)d[a]=0;for(a=5530;5539>=a;a++)d[a]=0;for(a=5550;5552>=a;a++)d[a]=0;for(a=5562;5583>=a;a++)d[a]=0;for(a=5623;5625>=a;a++)d[a]=2;for(a=5631;5639>=a;a++)d[a]=0;for(a=5649;5653>=a;a++)d[a]=0;for(a=5663;5680>=a;a++)d[a]=0;for(a=5682;5685>=a;a++)d[a]=0;for(a=5875;5877>=a;a++)d[a]=0;for(a=5896;5899>=a;a++)d[a]=0;for(a=5921;5940>=a;a++)d[a]=0;for(a=6050;6125>=a;a++)d[a]=0;for(a=6244;6275>=a;a++)d[a]=0;for(a=6328;6348>=a;a++)d[a]=0;for(a=6350;6356>=
a;a++)d[a]=0;for(a=6366;6372>=a;a++)d[a]=0;for(a=6381;6387>=a;a++)d[a]=0;for(a=6393;6404>=a;a++)d[a]=0;for(a=6480;6483>=a;a++)d[a]=0;for(a=6511;6514>=a;a++)d[a]=0;for(a=6579;6581>=a;a++)d[a]=0;for(a=6619;6624>=a;a++)d[a]=0;for(a=6625;6627>=a;a++)d[a]=2;for(a=6628;6632>=a;a++)d[a]=0;for(a=6634;6637>=a;a++)d[a]=0;for(a=6669;6692>=a;a++)d[a]=0;for(a=6707;6709>=a;a++)d[a]=0;for(a=6720;6723>=a;a++)d[a]=0;for(a=6732;6738>=a;a++)d[a]=0;for(a=6931;6933>=a;a++)d[a]=0;for(a=6956;6959>=a;a++)d[a]=0;for(a=7005;7007>=
a;a++)d[a]=0;for(a=7057;7070>=a;a++)d[a]=2;for(a=7074;7082>=a;a++)d[a]=0;for(a=7109;7118>=a;a++)d[a]=0;for(a=7119;7127>=a;a++)d[a]=1;for(a=7374;7376>=a;a++)d[a]=0;for(a=7528;7586>=a;a++)d[a]=0;for(a=7587;7645>=a;a++)d[a]=2;for(a=7692;7696>=a;a++)d[a]=0;for(a=7755;7787>=a;a++)d[a]=0;for(a=7791;7795>=a;a++)d[a]=0;for(a=7799;7801>=a;a++)d[a]=0;for(a=7803;7805>=a;a++)d[a]=0;for(a=7825;7831>=a;a++)d[a]=0;for(a=7845;7859>=a;a++)d[a]=0;for(a=8013;8032>=a;a++)d[a]=0;for(a=8065;8068>=a;a++)d[a]=1;for(a=8518;8529>=
a;a++)d[a]=2;for(a=8533;8536>=a;a++)d[a]=2;for(a=8538;8540>=a;a++)d[a]=2;for(a=8677;8679>=a;a++)d[a]=0;for(a=8836;8840>=a;a++)d[a]=0;for(a=8857;8859>=a;a++)d[a]=0;for(a=8908;8910>=a;a++)d[a]=0;for(a=9154;9159>=a;a++)d[a]=0;for(a=9205;9218>=a;a++)d[a]=0;for(a=9271;9273>=a;a++)d[a]=0;for(a=9295;9297>=a;a++)d[a]=0;for(a=9356;9360>=a;a++)d[a]=0;for(a=9404;9407>=a;a++)d[a]=0;for(a=9476;9482>=a;a++)d[a]=0;for(a=9487;9494>=a;a++)d[a]=0;for(a=9697;9699>=a;a++)d[a]=0;for(a=20002;20032>=a;a++)d[a]=0;for(a=
20062;20092>=a;a++)d[a]=0;for(a=20135;20138>=a;a++)d[a]=0;for(a=20248;20258>=a;a++)d[a]=0;for(a=20348;20358>=a;a++)d[a]=0;for(a=20436;20440>=a;a++)d[a]=0;for(a=20822;20824>=a;a++)d[a]=0;for(a=20934;20936>=a;a++)d[a]=0;for(a=21035;21037>=a;a++)d[a]=0;for(a=21095;21097>=a;a++)d[a]=0;for(a=21148;21150>=a;a++)d[a]=0;for(a=21413;21423>=a;a++)d[a]=0;for(a=21453;21463>=a;a++)d[a]=0;for(a=21473;21483>=a;a++)d[a]=0;for(a=21780;21782>=a;a++)d[a]=0;for(a=21891;21894>=a;a++)d[a]=0;for(a=21896;21899>=a;a++)d[a]=
0;for(a=22171;22177>=a;a++)d[a]=0;for(a=22181;22187>=a;a++)d[a]=0;for(a=22191;22197>=a;a++)d[a]=0;for(a=22234;22236>=a;a++)d[a]=0;for(a=22521;22525>=a;a++)d[a]=0;for(a=22991;22994>=a;a++)d[a]=0;for(a=23028;23038>=a;a++)d[a]=0;for(a=23830;23853>=a;a++)d[a]=0;for(a=23866;23872>=a;a++)d[a]=0;for(a=23877;23884>=a;a++)d[a]=0;for(a=23886;23894>=a;a++)d[a]=0;for(a=23946;23948>=a;a++)d[a]=0;for(a=24311;24313>=a;a++)d[a]=0;for(a=24342;24347>=a;a++)d[a]=0;for(a=24370;24374>=a;a++)d[a]=10;for(a=24375;24381>=
a;a++)d[a]=0;for(a=24718;24721>=a;a++)d[a]=0;for(a=24817;24821>=a;a++)d[a]=0;for(a=24877;24882>=a;a++)d[a]=0;for(a=24891;24893>=a;a++)d[a]=0;for(a=25391;25395>=a;a++)d[a]=0;for(a=25828;25838>=a;a++)d[a]=0;for(a=26191;26195>=a;a++)d[a]=0;for(a=26391;26393>=a;a++)d[a]=0;for(a=26701;26722>=a;a++)d[a]=0;for(a=26729;26799>=a;a++)d[a]=2;for(a=26801;26803>=a;a++)d[a]=2;for(a=26811;26813>=a;a++)d[a]=2;for(a=26847;26870>=a;a++)d[a]=2;for(a=26891;26899>=a;a++)d[a]=0;for(a=26901;26923>=a;a++)d[a]=0;for(a=26929;26946>=
a;a++)d[a]=0;for(a=26948;26998>=a;a++)d[a]=0;for(a=27037;27040>=a;a++)d[a]=0;for(a=27205;27232>=a;a++)d[a]=0;for(a=27258;27260>=a;a++)d[a]=0;for(a=27391;27398>=a;a++)d[a]=0;for(a=27561;27564>=a;a++)d[a]=0;for(a=27571;27574>=a;a++)d[a]=0;for(a=27581;27584>=a;a++)d[a]=0;for(a=27591;27594>=a;a++)d[a]=0;for(a=28191;28193>=a;a++)d[a]=0;for(a=28348;28358>=a;a++)d[a]=0;for(a=28402;28432>=a;a++)d[a]=0;for(a=28462;28492>=a;a++)d[a]=0;for(a=29118;29122>=a;a++)d[a]=0;for(a=29168;29172>=a;a++)d[a]=0;for(a=29177;29185>=
a;a++)d[a]=0;for(a=29187;29195>=a;a++)d[a]=0;for(a=29900;29903>=a;a++)d[a]=0;for(a=30161;30179>=a;a++)d[a]=0;for(a=30491;30494>=a;a++)d[a]=0;for(a=30729;30732>=a;a++)d[a]=0;for(a=31251;31259>=a;a++)d[a]=0;for(a=31265;31268>=a;a++)d[a]=0;for(a=31275;31279>=a;a++)d[a]=0;for(a=31281;31297>=a;a++)d[a]=0;for(a=31461;31469>=a;a++)d[a]=0;for(a=31491;31495>=a;a++)d[a]=0;for(a=31917;31922>=a;a++)d[a]=0;for(a=31965;32E3>=a;a++)d[a]=0;for(a=32001;32003>=a;a++)d[a]=2;for(a=32005;32031>=a;a++)d[a]=2;for(a=32033;32060>=
a;a++)d[a]=2;for(a=32064;32067>=a;a++)d[a]=2;for(a=32074;32077>=a;a++)d[a]=2;for(a=32081;32086>=a;a++)d[a]=0;for(a=32107;32130>=a;a++)d[a]=0;for(a=32133;32158>=a;a++)d[a]=0;for(a=32164;32167>=a;a++)d[a]=2;for(a=32180;32199>=a;a++)d[a]=0;for(a=32201;32260>=a;a++)d[a]=0;for(a=32301;32360>=a;a++)d[a]=0;for(a=32601;32662>=a;a++)d[a]=0;for(a=32664;32667>=a;a++)d[a]=2;for(a=32701;32761>=a;a++)d[a]=0;for(a=53001;53004>=a;a++)d[a]=0;for(a=53008;53019>=a;a++)d[a]=0;for(a=53021;53032>=a;a++)d[a]=0;for(a=53034;53037>=
a;a++)d[a]=0;for(a=53042;53046>=a;a++)d[a]=0;for(a=53074;53080>=a;a++)d[a]=0;for(a=54001;54004>=a;a++)d[a]=0;for(a=54008;54019>=a;a++)d[a]=0;for(a=54021;54032>=a;a++)d[a]=0;for(a=54034;54037>=a;a++)d[a]=0;for(a=54042;54046>=a;a++)d[a]=0;for(a=54048;54053>=a;a++)d[a]=0;for(a=54074;54080>=a;a++)d[a]=0;for(a=54098;54101>=a;a++)d[a]=0;for(a=102001;102040>=a;a++)d[a]=0;for(a=102042;102063>=a;a++)d[a]=0;for(a=102065;102067>=a;a++)d[a]=0;for(a=102070;102117>=a;a++)d[a]=0;for(a=102122;102216>=a;a++)d[a]=
0;for(a=102221;102377>=a;a++)d[a]=0;for(a=102382;102388>=a;a++)d[a]=0;for(a=102389;102398>=a;a++)d[a]=2;for(a=102399;102444>=a;a++)d[a]=0;for(a=102445;102447>=a;a++)d[a]=2;for(a=102448;102458>=a;a++)d[a]=0;for(a=102459;102468>=a;a++)d[a]=2;for(a=102469;102499>=a;a++)d[a]=0;for(a=102500;102519>=a;a++)d[a]=1;for(a=102520;102524>=a;a++)d[a]=0;for(a=102525;102529>=a;a++)d[a]=2;for(a=102530;102588>=a;a++)d[a]=0;for(a=102590;102598>=a;a++)d[a]=0;for(a=102601;102603>=a;a++)d[a]=0;for(a=102605;102628>=a;a++)d[a]=
0;for(a=102629;102646>=a;a++)d[a]=2;for(a=102648;102700>=a;a++)d[a]=2;for(a=102701;102703>=a;a++)d[a]=0;for(a=102707;102730>=a;a++)d[a]=2;for(a=102733;102758>=a;a++)d[a]=2;for(a=102767;102900>=a;a++)d[a]=0;for(a=102965;102969>=a;a++)d[a]=0;for(a=102971;102973>=a;a++)d[a]=0;for(a=102975;102989>=a;a++)d[a]=0;for(a=102990;102992>=a;a++)d[a]=1;for(a=102997;103002>=a;a++)d[a]=0;for(a=103003;103008>=a;a++)d[a]=2;for(a=103009;103011>=a;a++)d[a]=0;for(a=103012;103014>=a;a++)d[a]=2;for(a=103019;103021>=a;a++)d[a]=
0;for(a=103022;103024>=a;a++)d[a]=2;for(a=103029;103031>=a;a++)d[a]=0;for(a=103032;103034>=a;a++)d[a]=2;for(a=103065;103068>=a;a++)d[a]=0;for(a=103074;103076>=a;a++)d[a]=0;for(a=103077;103079>=a;a++)d[a]=1;for(a=103080;103082>=a;a++)d[a]=0;for(a=103083;103085>=a;a++)d[a]=2;for(a=103090;103093>=a;a++)d[a]=0;for(a=103097;103099>=a;a++)d[a]=0;for(a=103100;103102>=a;a++)d[a]=2;for(a=103107;103109>=a;a++)d[a]=0;for(a=103110;103112>=a;a++)d[a]=2;for(a=103113;103116>=a;a++)d[a]=0;for(a=103117;103120>=a;a++)d[a]=
2;for(a=103153;103157>=a;a++)d[a]=0;for(a=103158;103162>=a;a++)d[a]=2;for(a=103163;103165>=a;a++)d[a]=0;for(a=103166;103168>=a;a++)d[a]=1;for(a=103169;103171>=a;a++)d[a]=2;for(a=103186;103188>=a;a++)d[a]=0;for(a=103189;103191>=a;a++)d[a]=2;for(a=103192;103195>=a;a++)d[a]=0;for(a=103196;103199>=a;a++)d[a]=2;for(a=103200;103224>=a;a++)d[a]=0;for(a=103225;103227>=a;a++)d[a]=1;for(a=103232;103237>=a;a++)d[a]=0;for(a=103238;103243>=a;a++)d[a]=2;for(a=103244;103246>=a;a++)d[a]=0;for(a=103247;103249>=a;a++)d[a]=
2;for(a=103254;103256>=a;a++)d[a]=0;for(a=103257;103259>=a;a++)d[a]=2;for(a=103264;103266>=a;a++)d[a]=0;for(a=103267;103269>=a;a++)d[a]=2;for(a=103300;103375>=a;a++)d[a]=0;for(a=103381;103383>=a;a++)d[a]=0;for(a=103384;103386>=a;a++)d[a]=1;for(a=103387;103389>=a;a++)d[a]=0;for(a=103390;103392>=a;a++)d[a]=2;for(a=103397;103399>=a;a++)d[a]=0;for(a=103400;103471>=a;a++)d[a]=2;for(a=103476;103478>=a;a++)d[a]=0;for(a=103479;103481>=a;a++)d[a]=2;for(a=103486;103488>=a;a++)d[a]=0;for(a=103489;103491>=a;a++)d[a]=
2;for(a=103492;103495>=a;a++)d[a]=0;for(a=103496;103499>=a;a++)d[a]=2;for(a=103528;103543>=a;a++)d[a]=0;for(a=103544;103548>=a;a++)d[a]=2;for(a=103549;103551>=a;a++)d[a]=0;for(a=103552;103554>=a;a++)d[a]=1;for(a=103555;103557>=a;a++)d[a]=2;for(a=103558;103560>=a;a++)d[a]=0;for(a=103571;103573>=a;a++)d[a]=0;for(a=103574;103576>=a;a++)d[a]=2;for(a=103577;103580>=a;a++)d[a]=0;for(a=103581;103583>=a;a++)d[a]=2;for(a=103595;103694>=a;a++)d[a]=0;for(a=103696;103699>=a;a++)d[a]=0;for(a=103700;103793>=a;a++)d[a]=
2;for(a=103794;103872>=a;a++)d[a]=0;for(a=103900;103971>=a;a++)d[a]=2;A("extend-esri")&&(q.WKIDUnitConversion=d);return d})},"esri/layers/rasterLib/function/pixelShaders":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaderScripts"],function(A,q,a){A={shaderType:"fragment",getShader:function(d,g){var h=d.createShader(d.FRAGMENT_SHADER);d.shaderSource(h,g);d.compileShader(h);d.getShaderParameter(h,d.COMPILE_STATUS)||(h=null);return h}};q.mixin(A,a);return A})},"esri/layers/rasterLib/function/pixelShaderScripts":function(){define([],
function(){return{aspect:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nfloat pi \x3d 3.141592653589793238;\nfloat dz_dx \x3d 0.0;\nfloat dz_dy \x3d 0.0;\nvec4 va, vb, vc,vd,ve,vf,vg,vh,vi;\nvec2 axy \x3d vec2(-1.0,-1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s)\n{\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t)\n{\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e1.0-u_resolution.s)\n{\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0- u_resolution.t)\n{\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0-u_resolution.s)\x3e\x3dv_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0-u_resolution.t)\x3e\x3dv_texCoord.t)\n{\nva \x3d texture2D(u_image, v_texCoord + u_resolution* axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution* bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution* cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution* dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution* vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution* fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution* gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution* hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution* ixy);\n}\ndz_dx \x3d (vc+2.0*vf+vi - va - 2.0*vd - vg).r/(8.0*u_cellSize[0]);\ndz_dy \x3d -(vg+2.0*vh+vi - va - 2.0*vb - vc).r/(8.0*u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat aspect_rad \x3d 0.0;\nif (dz_dx \x3d\x3d 0.0)\n{\nif (dz_dy \x3e 0.0)\naspect_rad \x3d 0.5 * pi;\nelse if (dz_dy \x3c 0.0)\naspect_rad \x3d 1.5 * pi;\nelse\nalpha \x3d 0.0;//undefined make it nodata\n}\nelse\n{\naspect_rad \x3d 0.5*pi + atan(dz_dy, -dz_dx);\nif (aspect_rad \x3c 0.0)\naspect_rad \x3d 2.0*pi + aspect_rad;\n}\nfloat aspect \x3d aspect_rad * 180.0 / pi;\ngl_FragColor \x3d vec4(aspect, aspect, aspect, alpha);\n}",
bandArithmetic:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_nir;\nuniform int u_bandId_red;\nuniform bool u_scaled;\nuniform int u_bandCount;\nuniform int u_method;\nuniform float u_constants[6];\nvec4 calculateNDVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n} else {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nvec4 calculateSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat savi_denom \x3d nir + red + u_constants[0];\nfloat savi;\nif (savi_denom \x3d\x3d 0.0) {\nsavi \x3d 0.0;\n} else {\nsavi \x3d (nir - red) / savi_denom * (1.0 + u_constants[0]);\n}\nreturn vec4(savi, savi, savi, currentPixel.a);\n}\nvec4 calculateMSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat msavi \x3d 0.5 * (2.0 * (nir + 1.0) - sqrt(pow((2.0 * nir + 1.0), 2.0) - 8.0 * (nir - red)));\nreturn vec4(msavi, msavi, msavi, currentPixel.a);\n}\nvec4 calculateTSAVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat s \x3d u_constants[0];\nfloat a \x3d u_constants[1];\nfloat x \x3d u_constants[2];\nfloat tsavi_denom \x3d a * nir + red - a * s + x * (1.0 + s * s);\nfloat tsavi;\nif (tsavi_denom \x3d\x3d 0.0) {\ntsavi \x3d 0.0;\n} else {\ntsavi \x3d s * (nir - s * red - a) / tsavi_denom;\n}\nreturn vec4(tsavi, tsavi, tsavi, currentPixel.a);\n}\nvec4 calculatePVI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat a \x3d u_constants[0];\nfloat b \x3d u_constants[1];\nfloat pvi \x3d (nir - a * red - b) / sqrt(1.0 + a * 2.0);\nreturn vec4(pvi, pvi, pvi, currentPixel.a);\n}\nvec4 calculateGEMI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat gemi;\nif (red \x3d\x3d 1.0) {\ngemi \x3d 0.0;\n} else {\nfloat eta \x3d (2.0 * (nir * nir - red * red) + 1.5 * nir + 0.5 * red) / (nir + red + 0.5);\nfloat gemi \x3d eta * (1.0 - 0.25*eta) - (red - 0.125) / (1.0 - red);\n}\nreturn vec4(gemi, gemi, gemi, currentPixel.a);\n}\nvec4 calculateVARI() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(currentPixel.r);\nfloat green \x3d float(currentPixel.g);\nfloat blue \x3d float(currentPixel.b);\nfloat vari \x3d (green - red) /(green + red - blue);\nreturn vec4(vari, vari, vari, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 pv;\nif (u_method \x3c 4) {\nif (u_method \x3d\x3d 1) {\npv \x3d calculateNDVI();\n} else if (u_method \x3d\x3d 2) {\npv \x3d calculateSAVI();\n} else if (u_method \x3d\x3d 3) {\npv \x3d calculateTSAVI();\n} else if (u_method \x3d\x3d 4) {\npv \x3d calculateMSAVI();\n}\n} else {\nif (u_method \x3d\x3d 5) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 6) {\npv \x3d calculatePVI();\n} else if (u_method \x3d\x3d 7) {\npv \x3d calculateGEMI();\n} else if (u_method \x3d\x3d 9) {\npv \x3d calculateVARI();\n}\n}\ngl_FragColor \x3d pv;\n}",
colormap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nvec4 colorize() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat clrIndex \x3d currentPixel.r - u_indexedColormapOffset;\nvec4 result;\nif (currentPixel.a \x3d\x3d 0.0 || clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d colorize();\n}",
compositeBand:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 composite() {\nvec4 p0, p1, p2;\np0 \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nif (u_rasterCount \x3d\x3d 1){\nresult \x3d p0;\n}\nelse if (u_rasterCount \x3d\x3d 2){\np1 \x3d texture2D(u_image1, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,0.0,min(p0.a,p1.a));\n}\nelse if (u_rasterCount \x3d\x3d 3){\np1 \x3d texture2D(u_image1, v_texCoord);\np2 \x3d texture2D(u_image2, v_texCoord);\nresult \x3d vec4(p0.r,p1.r,p2.r,min(min(p0.a,p1.a),p2.a));\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d composite();\n}",
constant:"precision mediump float;\nuniform vec4 u_color;\nvoid main() {\ngl_FragColor \x3d u_color;\n}",contrastBrightness:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_contrastOffset;\nuniform float u_brightnessOffset;\nuniform float u_scaleFactor;\nvec4 adjustContrastBrightness() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat c \x3d u_contrastOffset;\nfloat b \x3d u_brightnessOffset;\nfloat maxI \x3d 255.0;\nfloat mid \x3d 128.0;\nvec4 v;\nif (c \x3e 0.0 \x26\x26 c \x3c 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) / (2.0 * (100.0 - c)) + mid;\n} else if (c \x3c\x3d 0.0 \x26\x26 c \x3e -100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + 2.0 * maxI * b) * (100.0 + c) / 20000.0 + mid;\n} else if (c \x3d\x3d 100.0) {\nv \x3d (200.0 * currentPixel - 100.0 * maxI + (maxI + 1.0) * (100.0 - c) + 2.0 * maxI * b);\nv \x3d (sign(v) + 1.0) / 2.0; //binary contrast with extra mid tone at 0.5\n} else if (c \x3d\x3d -100.0) {\nv \x3d vec4(mid, mid, mid, currentPixel.a); //no contrast\n}\nreturn vec4(v.r / u_scaleFactor, v.g / u_scaleFactor, v.b / u_scaleFactor, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d adjustContrastBrightness();\n}",
convolution:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform float u_kernel[25];\nuniform int u_kernelSize;\nvec4 convolve33(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nvec2 xy11 \x3d vec2(-1.0, -1.0);\nvec2 xy12 \x3d vec2(0.0, -1.0);\nvec2 xy13 \x3d vec2(1.0, -1.0);\nvec2 xy21 \x3d vec2(-1.0, 0.0);\nvec2 xy23 \x3d vec2(1.0, 0.0);\nvec2 xy31 \x3d vec2(-1.0, 1.0);\nvec2 xy32 \x3d vec2(0.0, 1.0);\nvec2 xy33 \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\nxy11[0] \x3d 1.0;\nxy21[0] \x3d 1.0;\nxy31[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\nxy11[1] \x3d 1.0;\nxy12[1] \x3d 1.0;\nxy13[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxy13[0] \x3d -1.0;\nxy23[0] \x3d -1.0;\nxy33[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nxy31[1] \x3d -1.0;\nxy32[1] \x3d -1.0;\nxy33[1] \x3d -1.0;\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * xy11) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * xy12) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * xy13) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * xy21) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(0, 0)) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * xy23) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * xy31) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * xy32) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * xy33) * u_kernel[8];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nvec4 convolve55(){\nvec4 vp11, vp12, vp13, vp21, vp22, vp23, vp31, vp32, vp33;\nfloat xdif[5];//https://www.opengl.org/wiki/Data_Type_(GLSL) array constructor ES3.0\nfloat ydif[5];\nfloat a \x3d -2.0;\nfor (int i\x3d0; i\x3c5; i++){\nxdif[i] \x3d a;\nydif[i] \x3d a;\na++;\n}\nif (v_texCoord.s \x3c u_resolution.s *2.0) { //2 pixel\nxdif[0] \x3d 2.0;\nif (v_texCoord.s \x3c u_resolution.s) { //1 pixel\nxdif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.s \x3e 1.0 - u_resolution.s *2.0) {\nxdif[0] \x3d -2.0;\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\nxdif[1] \x3d -1.0;\n}\n}\nif (v_texCoord.t \x3c u_resolution.t *2.0) {\nydif[0] \x3d 2.0;\nif (v_texCoord.t \x3c u_resolution.t) {\nydif[1] \x3d 1.0;\n}\n}\nelse if (v_texCoord.t \x3e 1.0 - u_resolution.t*2.0) {\nydif[0] \x3d -2.0;\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\nydif[1] \x3d -1.0;\n}\n}\nvec4 convolResult \x3d\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[0])) * u_kernel[0] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[0])) * u_kernel[1] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[0])) * u_kernel[2] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[0])) * u_kernel[3] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[0])) * u_kernel[4] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[1])) * u_kernel[5] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[1])) * u_kernel[6] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[1])) * u_kernel[7] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[1])) * u_kernel[8] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[1])) * u_kernel[9] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[2])) * u_kernel[10] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[2])) * u_kernel[11] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[2])) * u_kernel[12] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[2])) * u_kernel[13] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[2])) * u_kernel[14] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[3])) * u_kernel[15] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[3])) * u_kernel[16] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[3])) * u_kernel[17] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[3])) * u_kernel[18] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[3])) * u_kernel[19] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[0], ydif[4])) * u_kernel[20] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[1], ydif[4])) * u_kernel[21] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[2], ydif[4])) * u_kernel[22] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[3], ydif[4])) * u_kernel[23] +\ntexture2D(u_image, v_texCoord + u_resolution * vec2(xdif[4], ydif[4])) * u_kernel[24];\nreturn vec4(convolResult.rgb, texture2D(u_image, v_texCoord).a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_kernelSize \x3d\x3d 9){\ngl_FragColor \x3d convolve33();\n}\nelse {\ngl_FragColor \x3d convolve55();\n}\n}",
extractBand:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandIDs[3];\nuniform bool u_alterBand;\nvec4 extractBand() {\nvec4 p \x3d texture2D(u_image, v_texCoord);\nif (!u_alterBand){\nreturn p;\n}\nfloat r, g, b;\nif (u_bandIDs[0] \x3d\x3d0){\nr \x3d p.r;\n}\nelse if (u_bandIDs[0] \x3d\x3d1){\nr \x3d p.g;\n}\nelse if (u_bandIDs[0] \x3d\x3d2){\nr \x3d p.b;\n}\nif (u_bandIDs[1] \x3d\x3d0){\ng \x3d p.r;\n}\nelse if (u_bandIDs[1] \x3d\x3d1){\ng \x3d p.g;\n}\nelse if (u_bandIDs[1] \x3d\x3d2){\ng \x3d p.b;\n}\nif (u_bandIDs[2] \x3d\x3d0){\nb \x3d p.r;\n}\nelse if (u_bandIDs[2] \x3d\x3d1){\nb \x3d p.g;\n}\nelse if (u_bandIDs[2] \x3d\x3d2){\nb \x3d p.b;\n}\nreturn vec4(r, g, b, p.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d extractBand();\n}",
hillshade:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform int u_slopeType;\nuniform int u_hillshadeType;\nuniform int u_lightSourceCount;\nuniform float u_sinZcosA;\nuniform float u_sinZsinA;\nuniform float u_cosZ;\nuniform float u_sinZcosAs[6];\nuniform float u_sinZsinAs[6];\nuniform float u_cosZs[6];\nuniform float u_weights[6];\nuniform float u_xFactor;\nuniform float u_yFactor;\nuniform bool u_scaled;\nuniform float u_minValue;\nuniform float u_maxValue;\nuniform bool u_applyColorramp;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvec3 rgb2hsv(vec3 c) {\nvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p \x3d c.g \x3c c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q \x3d c.r \x3c p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d \x3d q.x - min(q.w, q.y);\nfloat e \x3d 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {\nfloat clrIndex \x3d clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);\nvec4 rgb \x3d texture2D(u_image1, vec2(clrIndex, 0.0));\nvec3 hsv \x3d rgb2hsv(rgb.xyz);\nhsv.z \x3d hillshade;\nreturn vec4(hsv2rgb(hsv) * alpha, alpha);\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 va, vb, vc, vd, ve, vf, vg, vh, vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat dzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_xFactor;\nfloat dzy \x3d (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_yFactor; //flip\nfloat s2 \x3d sqrt(1.0 + dzx * dzx + dzy * dzy);\nfloat hillshade \x3d 0.0;\nif (u_hillshadeType \x3d\x3d 0){\nfloat cosDelta \x3d u_sinZsinA * dzy - u_sinZcosA * dzx;\nfloat z \x3d (u_cosZ + cosDelta) / s2;\nif (z \x3c 0.0)  z \x3d 0.0;\nhillshade \x3d z;\n}\nelse if (u_hillshadeType \x3d\x3d 1){\nfor (int k \x3d 0; k \x3c 6; k++) {\nfloat cosDelta \x3d u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;\nfloat z \x3d (u_cosZs[k] + cosDelta) / s2;\nif (z \x3c 0.0) z \x3d 0.0;\nhillshade \x3d hillshade + z * u_weights[k];\nif (k \x3d\x3d u_lightSourceCount-1) break;\n}\n}\nif (u_applyColorramp) {\nvec4 result \x3d overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);\nif (u_scaled) {\nresult \x3d vec4(result.rgb * 255.0, result.a);\n}\ngl_FragColor \x3d result;\n} else {\nif (u_scaled) {\nhillshade \x3d hillshade * 255.0;\nif (hillshade\x3e 255.0) {\nhillshade \x3d 255.0;\n}\n}\ngl_FragColor \x3d vec4(hillshade, hillshade, hillshade, alpha);\n}\n}",
identity:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandCount;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d  texture2D(u_image, v_texCoord);\ngl_FragColor \x3d vec4( currentPixel.rgb, currentPixel.a); //encode_float(currentPixel.r);\n}",
local:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform int u_rasterCount;\nvec4 polyfill;\nvec4 localOp1() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 result;\nvec4 replaceme1;\nreturn result;\n}\nvec4 localOp2() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 result;\nvec4 replaceme2;\nreturn result;\n}\nvec4 localOp3() {\nvec4 a \x3d texture2D(u_image, v_texCoord);\nvec4 b \x3d texture2D(u_image1, v_texCoord);\nvec4 c \x3d texture2D(u_image2, v_texCoord);\nvec4 result;\nvec4 replaceme3;\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d localOp1();\n}",
local0:"precision mediump float;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_operation;\nuniform int u_constant[3];\nuniform vec4 gamma;\nfloat localOperate1(float a, float b, float c){\nfloat result;\nif (u_operation \x3d\x3d 1){\nresult \x3d a + b;\n}\nelse if (u_operation \x3d\x3d 2){\nresult \x3d a - b;\n}\nelse if (u_operation \x3d\x3d3){\nresult \x3d a * b;\n}\nelse if (u_operation \x3d\x3d4){\nresult \x3d sqrt(a);\n}\nelse if (u_operation \x3d\x3d5){\nresult \x3d pow(a, b);\n}\nelse if (u_operation \x3d\x3d6){\nresult \x3d acos(a);\n}\nelse if (u_operation \x3d\x3d7){\nresult \x3d asin(a);\n}\nelse if (u_operation \x3d\x3d8){\nresult \x3d atan(a);\n}\nelse if (u_operation \x3d\x3d9){\nresult \x3d 999.0; //atanh not available\n}\nelse if (u_operation \x3d\x3d10){\nresult \x3d abs(a);\n}\nelse if (u_operation \x3d\x3d13){\nresult \x3d 999.0; //bitwise not available\n}\nelse if (u_operation \x3d\x3d17){\nresult \x3d a !\x3d 0.0 \x26\x26 b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d18){\nresult \x3d a \x3d\x3d0.0? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d19){\nresult \x3d a !\x3d 0.0 || b !\x3d0.0;\n}\nelse if (u_operation \x3d\x3d20){\nresult \x3d a !\x3d 0.0 ^^ b !\x3d0.0; //exclusive or\n}\nelse if (u_operation \x3d\x3d21){\nresult \x3d cos(a);\n}\nelse if (u_operation \x3d\x3d23){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d24){\nresult \x3d a \x3d\x3d b ? 1.0:0.0;\n}\nelse if (u_operation \x3d\x3d25){\nresult \x3d exp(a);\n}\nelse if (u_operation \x3d\x3d26){\nresult \x3d pow(10.0, a);\n}\nelse if (u_operation \x3d\x3d27){\nresult \x3d exp2(a);\n}\nelse if (u_operation \x3d\x3d28){\nresult \x3d a \x3e b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d29){\nresult \x3d  a \x3e\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d30){\nresult \x3d floor(a); //int\n}\nelse if (u_operation \x3d\x3d31){\nresult \x3d a \x3d\x3d0? 1.0:0.0; //null pass mask\n}\nelse if (u_operation \x3d\x3d32){\nresult \x3d a; //float\n}\nelse if (u_operation \x3d\x3d33){\nresult \x3d a \x3c b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d34){\nresult \x3d a \x3c\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d35){\nresult \x3d log(a);\n}\nelse if (u_operation \x3d\x3d36){\nresult \x3d log2(a) / log2(10.0);\n}\nelse if (u_operation \x3d\x3d37){\nresult \x3d log2(a);\n}\nelse if (u_operation \x3d\x3d44){\nresult \x3d mod(a, b);\n}\nelse if (u_operation \x3d\x3d45){\nresult \x3d -a;\n}\nelse if (u_operation \x3d\x3d46){\nresult \x3d a !\x3d b? 1.0 : 0.0;\n}\nelse if (u_operation \x3d\x3d48){\nresult \x3d ceil(a);\n}\nelse if (u_operation \x3d\x3d49){\nresult \x3d floor(a);\n}\nelse if (u_operation \x3d\x3d51){\nresult \x3d sin(a);\n}\nelse if (u_operation \x3d\x3d53){\nresult \x3d a * a;\n}\nelse if (u_operation \x3d\x3d56){\nresult \x3d tan(a);\n}\nelse if (u_operation \x3d\x3d57){\nresult \x3d 999.0; //tanh not available\n}\nelse if (u_operation \x3d\x3d59){\nresult \x3d 999.0; //acosh not available\n}\nelse if (u_operation \x3d\x3d60){\nresult \x3d 999.0; //asinh not available\n}\nelse if (u_operation \x3d\x3d61){\nresult \x3d atan(a, b);\n}\nelse if (u_operation \x3d\x3d64){\nresult \x3d a / b;\n}\nelse if (u_operation \x3d\x3d65){\nresult \x3d floor(a/b);\n}\nelse if (u_operation \x3d\x3d76){\nresult \x3d a !\x3d0? b:c;\n}\n}\nvoid main() {\nvec4 currentPixel0 \x3d  texture2D(u_image0, v_texCoord);\nfloat graya, reda, greena, bluea;\nif (u_bandCount \x3d\x3d 1) {\ngraya \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngl_FragColor \x3d vec4(graya, graya, graya, currentPixel.a);\n}\nelse if (u_bandCount \x3d\x3d 3) {\nreda \x3d stretchOneaue(float(currentPixel.r), u_minCutOff[0], u_maxCutOff[0], u_minOutput[0], u_maxOutput[0], u_factor[0]);\ngreena \x3d stretchOneaue(float(currentPixel.g), u_minCutOff[1], u_maxCutOff[1], u_minOutput[1], u_maxOutput[1], u_factor[1]);\nbluea \x3d stretchOneaue(float(currentPixel.b), u_minCutOff[2], u_maxCutOff[2], u_minOutput[2], u_maxOutput[2], u_factor[2]);\ngl_FragColor \x3d vec4(reda, greena, bluea, currentPixel.a);\n}\n}",
mask:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform float u_includedRanges[6];\nuniform bool u_includedRanges_specified;\nuniform float u_noDataValues[6];\nuniform bool u_noDataValues_specified;\nuniform int u_noDataInterpretation;\nuniform int u_bandCount;\nvec4 mask() {\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nvec4 processedPixel \x3d currentPixel;\nif (u_includedRanges_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n} else if (u_bandCount \x3d\x3d 3) {\nif (currentPixel.r \x3e u_includedRanges[0] \x26\x26 currentPixel.r \x3c u_includedRanges[1] \x26\x26 currentPixel.g \x3e u_includedRanges[2] \x26\x26 currentPixel.g \x3c u_includedRanges[3] \x26\x26 currentPixel.b \x3e u_includedRanges[4] \x26\x26 currentPixel.b \x3c u_includedRanges[5])\nprocessedPixel \x3d vec4(currentPixel.rgb, currentPixel.a);\nelse\nprocessedPixel \x3d vec4(currentPixel.rgb, 0);\n}\n}\nif (u_noDataValues_specified) {\nif (u_bandCount \x3d\x3d 1) {\nif (processedPixel.r \x3d\x3d u_noDataValues[0])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n} else if (u_bandCount \x3d\x3d 3) {\nif (u_noDataInterpretation \x3d\x3d1 \x26\x26 processedPixel.r \x3d\x3d u_noDataValues[0] \x26\x26 processedPixel.g \x3d\x3d u_noDataValues[1] \x26\x26 processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse if (processedPixel.r \x3d\x3d u_noDataValues[0] || processedPixel.g \x3d\x3d u_noDataValues[1] || processedPixel.b \x3d\x3d u_noDataValues[2])\nprocessedPixel \x3d vec4(processedPixel.rgb, 0);\nelse\nprocessedPixel \x3d vec4(processedPixel.rgb, processedPixel.a);\n}\n}\nreturn processedPixel;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d mask();\n}",
ndvi:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform int u_bandId_red;\nuniform int u_bandId_nir;\nuniform bool u_scaled;\nuniform int u_bandCount;\nvec4 calculateNDVI(){\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nfloat red \x3d float(u_bandId_red \x3d\x3d 0 ? currentPixel.r : (u_bandId_red \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat nir \x3d float(u_bandId_nir \x3d\x3d 0 ? currentPixel.r : (u_bandId_nir \x3d\x3d 1 ? currentPixel.g : currentPixel.b));\nfloat ndvi_denom \x3d nir + red;\nfloat ndvi;\nif (ndvi_denom \x3d\x3d 0.0) {\nndvi \x3d 0.0;\n}\nelse {\nndvi \x3d (nir - red) / ndvi_denom;\nif (u_scaled) {\nndvi \x3d float(floor(ndvi * 100.0 + 100.5));\n}\n}\nreturn vec4(ndvi, ndvi, ndvi, currentPixel.a);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateNDVI();\n}",
remap:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nvarying vec2 v_texCoord;\nuniform float u_indexedColormapOffset;\nuniform float u_indexedColormapMaxIndex;\nuniform float u_breaks[16];\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nreturn vp;\n}\nfloat getRemapIndex(float pixelValue) {\nif (pixelValue \x3c u_breaks[0] || pixelValue \x3e u_breaks[15]) {\nreturn -1.0;\n}\nfor (int i \x3d 0; i \x3c 16; i++) {\nif (pixelValue \x3c u_breaks[i]) {\nreturn float(i - 1);\n}\n}\nif (pixelValue \x3d\x3d u_breaks[15]) {\nreturn 15.0;\n}\nreturn 0.0;\n}\nvec4 colorize(float pv) {\nfloat clrIndex \x3d pv - u_indexedColormapOffset;\nvec4 result;\nif (clrIndex \x3e u_indexedColormapMaxIndex) {\nresult \x3d vec4(0.0, 0.0, 0.0, 0.0);\n}\nelse {\nvec2 clrPosition \x3d vec2(clrIndex / u_indexedColormapMaxIndex, 0.0);\nvec4 color \x3d texture2D(u_image1, clrPosition);\nresult \x3d vec4(color.r, color.g, color.b, color.a);\n}\nreturn result;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nvec4 currentPixel \x3d texture2D(u_image, v_texCoord);\nif (currentPixel.a \x3d\x3d 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nfloat remappedIndex \x3d getRemapIndex(currentPixel.r);\nif (remappedIndex \x3c 0.0) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\ngl_FragColor \x3d colorize(remappedIndex);\n}",
resample:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resamplingRatio;\nuniform int u_resamplingType;\nuniform vec2 u_anchor;\nuniform vec2 u_resolution;\nvec4 resample(){\nvec2 pos_nn, pos_ul, pos_ur, pos_ll, pos_lr, pos_offset;\nfloat weight,weight_total, weight_ul, weight_ur, weight_ll, weight_lr;\nvec4 vp;  //v_texCoord is canvas space 0-1\nvec2 originalResolution \x3d vec2(u_resolution.s*u_resamplingRatio.s, u_resolution.t*u_resamplingRatio.t);\nvec2 pos \x3d vec2(u_anchor.s+(v_texCoord.s-u_anchor.s),(u_anchor.t+(v_texCoord.t-u_anchor.t)));\nif (u_resamplingType \x3d\x3d 0)\n{//shift and scaling, y \x3d ax+b so x \x3d (y-b)/a\npos_nn \x3d vec2(floor(pos.s/originalResolution.s+0.5)*originalResolution.s,floor(pos.t/originalResolution.t+0.5)*originalResolution.t);\nif (pos_nn.s \x3c0.0 || pos_nn.s \x3e 1.0 || pos_nn.t \x3c0.0 || pos_nn.t \x3e 1.0){\nvp \x3d vec4(1.0, 0.0, 0.0, 1.0);//vec4(0.0, 1.0, 0.0, vp.a);\n}\nelse {\nvp \x3d texture2D(u_image, vec2(pos_nn.s, pos_nn.t));\n}\n}\nelse if (u_resamplingType \x3d\x3d 1)\n{//shift and scaling, 4 neighbors y \x3d ax+b so x \x3d (y-b)/a\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t);\npos_ur \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t);\npos_ll \x3d vec2(pos_ul.s, pos_ul.t+originalResolution.t);\npos_lr \x3d vec2(pos_ul.s+originalResolution.s, pos_ul.t+originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nweight_lr \x3d sqrt(pow(pos_offset.s,2.0) + pow(pos_offset.t,2.0));\nweight_ul \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(originalResolution.t- pos_offset.t,2.0));\nweight_ur \x3d sqrt(pow( pos_offset.s,2.0)+ 1.0- pow(originalResolution.t - pos_offset.t,2.0));\nweight_ll \x3d sqrt(pow( originalResolution.s- pos_offset.s,2.0)+ pow(pos_offset.t,2.0));\nvp \x3d (texture2D(u_image, pos_ul) * weight_ul + texture2D(u_image, pos_ur) * weight_ur + texture2D(u_image, pos_ll) * weight_ll + texture2D(u_image, pos_lr) * weight_lr)/(weight_ul+weight_ur+weight_ll+weight_lr);\n}\nelse if (u_resamplingType \x3d\x3d 2)\n{//shift and scaling, 16 neighbors\nweight_total \x3d 0.0;\nvp \x3d vec4(0.0,0.0,0.0,0.0);\npos_ul \x3d vec2(floor(pos.s/originalResolution.s)*originalResolution.s-originalResolution.s,floor(pos.t/originalResolution.t)*originalResolution.t-originalResolution.t);\npos_offset \x3d vec2(pos.s - floor(pos_ul.s),pos.t - floor(pos_ul.t));\nfor (int i\x3d0; i\x3c4; i++){//row\nfor (int j\x3d0; j\x3c4; j++){//col\nweight \x3d sqrt(pow(pos_offset.s-float(j),2.0)+ pow(pos_offset.t-float(i),2.0));\nvp +\x3dtexture2D(u_image, vec2(pos_ul.s+float(i)*originalResolution.s,pos_ul.t+float(j)*originalResolution.t)) * weight;\nweight_total +\x3d weight;\n}\n}\nvp \x3d vp/weight_total;\n}\nreturn vp;\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d resample();\n}",
slope:"precision mediump float;\nuniform sampler2D u_image;\nvarying vec2 v_texCoord;\nuniform vec2 u_resolution;\nuniform vec2 u_cellSize;\nuniform float u_zfactor;\nuniform float u_altitude;\nuniform float u_azimuth;\nfloat shift_right(float v, float amt) {\nv \x3d floor(v) + 0.5;\nreturn floor(v / exp2(amt));\n}\nfloat shift_left(float v, float amt) {\nreturn floor(v * exp2(amt) + 0.5);\n}\nfloat mask_last(float v, float bits) {\nreturn mod(v, shift_left(1.0, bits));\n}\nfloat extract_bits(float num, float from, float to) {\nfrom \x3d floor(from + 0.5);\nto \x3d floor(to + 0.5);\nreturn mask_last(shift_right(num, from), to - from);\n}\nvec4 encode_float(float val) {\nif (val \x3d\x3d 0.0)\nreturn vec4(0, 0, 0, 0);\nfloat sign \x3d val \x3e 0.0 ? 0.0 : 1.0;\nval \x3d abs(val);\nfloat exponent \x3d floor(log2(val));\nfloat biased_exponent \x3d exponent + 127.0;\nfloat fraction \x3d ((val / exp2(exponent)) - 1.0) * 8388608.0;\nfloat t \x3d biased_exponent / 2.0;\nfloat last_bit_of_biased_exponent \x3d fract(t) * 2.0;\nfloat remaining_bits_of_biased_exponent \x3d floor(t);\nfloat byte4 \x3d extract_bits(fraction, 0.0, 8.0) / 255.0;\nfloat byte3 \x3d extract_bits(fraction, 8.0, 16.0) / 255.0;\nfloat byte2 \x3d (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\nfloat byte1 \x3d (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\nreturn vec4(byte4, byte3, byte2, byte1);\n}\nfloat getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){\nif (a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0 || a \x3d\x3d 0.0 || a \x3d\x3d 0.0 || a\x3d\x3d0.0) {\nreturn 0.0;\n}\nelse {\nreturn e;\n}\n}\nvec4 calculateSlope() {\nfloat pi \x3d 3.141592653589793238;\nfloat dzx \x3d 0.0;\nfloat dzy \x3d 0.0;\nvec4 va,  vb,  vc,  vd,  ve,  vf,  vg,  vh,  vi;\nvec2 axy \x3d vec2(-1.0, -1.0);\nvec2 bxy \x3d vec2(0.0, -1.0);\nvec2 cxy \x3d vec2(1.0, -1.0);\nvec2 dxy \x3d vec2(-1.0, 0.0);\nvec2 fxy \x3d vec2(1.0, 0.0);\nvec2 gxy \x3d vec2(-1.0, 1.0);\nvec2 hxy \x3d vec2(0.0, 1.0);\nvec2 ixy \x3d vec2(1.0, 1.0);\nif (v_texCoord.s \x3c u_resolution.s) {\naxy[0] \x3d 1.0;\ndxy[0] \x3d 1.0;\ngxy[0] \x3d 1.0;\n}\nif (v_texCoord.t \x3c u_resolution.t) {\naxy[1] \x3d 1.0;\nbxy[1] \x3d 1.0;\ncxy[1] \x3d 1.0;\n}\nif (v_texCoord.s \x3e 1.0 - u_resolution.s) {\ncxy[0] \x3d -1.0;\nfxy[0] \x3d -1.0;\nixy[0] \x3d -1.0;\n}\nif (v_texCoord.t \x3e 1.0 - u_resolution.t) {\ngxy[1] \x3d -1.0;\nhxy[1] \x3d -1.0;\nixy[1] \x3d -1.0;\n}\nif (v_texCoord.s \x3e\x3d u_resolution.s \x26\x26 (1.0 - u_resolution.s) \x3e\x3d v_texCoord.s \x26\x26 v_texCoord.t \x3e\x3d u_resolution.t \x26\x26 (1.0 - u_resolution.t) \x3e\x3d v_texCoord.t) {\nva \x3d texture2D(u_image, v_texCoord + u_resolution * axy);\nvb \x3d texture2D(u_image, v_texCoord + u_resolution * bxy);\nvc \x3d texture2D(u_image, v_texCoord + u_resolution * cxy);\nvd \x3d texture2D(u_image, v_texCoord + u_resolution * dxy);\nve \x3d texture2D(u_image, v_texCoord + u_resolution * vec2(0, 0));\nvf \x3d texture2D(u_image, v_texCoord + u_resolution * fxy);\nvg \x3d texture2D(u_image, v_texCoord + u_resolution * gxy);\nvh \x3d texture2D(u_image, v_texCoord + u_resolution * hxy);\nvi \x3d texture2D(u_image, v_texCoord + u_resolution * ixy);\n}\ndzx \x3d (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r / (8.0 * u_cellSize[0]);\ndzy \x3d -(vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r / (8.0 * u_cellSize[1]);\nfloat alpha \x3d getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);\nfloat slope \x3d atan(u_zfactor * sqrt(dzx * dzx + dzy * dzy)) * 57.2957795;\nreturn vec4(slope, slope, slope, alpha);\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\ngl_FragColor \x3d calculateSlope();\n}",
stretch:"precision mediump float;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nvarying vec2 v_texCoord;\nuniform float u_minCutOff[3];\nuniform float u_maxCutOff[3];\nuniform float u_minOutput[3];\nuniform float u_maxOutput[3];\nuniform float u_factor[3];\nuniform int u_bandCount;\nuniform vec2 u_sourceDim;\nuniform vec2 u_targetDim;\nuniform int u_state;\nuniform bool u_minMaxTexture;\nuniform bool u_useGamma;\nuniform float u_gamma[4];\nuniform float u_gammaCorrection[4];\nuniform bool u_scaled;\nuniform vec2 u_rawResolution;\nuniform int u_resampling;\nvec4 getPixelValue(vec2 coords) {\nif (u_resampling \x3d\x3d 0) {\nreturn texture2D(u_image, coords);\n}\nvec2 pos_ul \x3d floor(coords / u_rawResolution) * u_rawResolution;\nvec2 pos_ur \x3d pos_ul + vec2(1.0, 0.0) * u_rawResolution;\nvec2 pos_ll \x3d pos_ul + vec2(0.0, 1.0) * u_rawResolution;\nvec2 pos_lr \x3d pos_ul + vec2(1.0, 1.0) * u_rawResolution;\nvec2 weight \x3d fract(coords / u_rawResolution);\nvec4 vp_ul \x3d texture2D(u_image, pos_ul);\nvec4 vp_ur \x3d texture2D(u_image, pos_ur);\nvec4 vp_ll \x3d texture2D(u_image, pos_ll);\nvec4 vp_lr \x3d texture2D(u_image, pos_lr);\nvec4 vp \x3d mix(mix(vp_ul, vp_ur, weight.x), mix(vp_ll, vp_lr, weight.x), weight.y);\nif (u_bandCount \x3d\x3d 1) {\nfloat alpha \x3d vp_ul.a * vp_ur.a * vp_ll.a * vp_lr.a;\nvec4 vp_nn \x3d texture2D(u_image, coords);\nreturn alpha \x3d\x3d 0.0 ? vp_nn : vec4(vp.rgb, alpha);\n}\nreturn vp;\n}\nvec4 findMin(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r),min(p1.g, p2.g),min(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(max(p1.r, p2.r),max(p1.g, p2.g),max(p1.b, p2.b),p1.a);\n}\n}\nvec4 findMinMax(vec4 p1, vec4 p2) {\nif (p1.a \x3d\x3d 0.0) {\nreturn p2;\n} else if (p2.a \x3d\x3d 0.0) {\nreturn p1;\n} else {\nreturn vec4(min(p1.r, p2.r), max(p1.g, p2.g), 0.0, p1.a);\n}\n}\nvec4 minMax(int state) {\nvec2 pixelFract \x3d fract(v_texCoord * u_sourceDim);\nfloat xshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.s; //take left pixel if \x3e 0.5\nfloat yshift \x3d ((pixelFract.s \x3e\x3d 0.5 || pixelFract.s \x3d\x3d 0.0) ? -1.0 : 1.0) / u_sourceDim.t; //take bottom pixel if \x3e 0.5\nif (u_sourceDim.s \x3d\x3d 1.0) {\nxshift \x3d 0.0;\n}\nif (u_sourceDim.t \x3d\x3d 1.0) {\nyshift \x3d 0.0;\n}\nvec4 p1 \x3d texture2D(u_image, v_texCoord);\nvec4 p2 \x3d texture2D(u_image, v_texCoord + vec2(xshift, 0.0));\nvec4 p3 \x3d texture2D(u_image, v_texCoord + vec2(0.0, yshift));\nvec4 p4 \x3d texture2D(u_image, v_texCoord + vec2(xshift, yshift));\nvec4 pval;\nif (state \x3d\x3d 2) {\npval \x3d findMinMax(findMinMax(p1, p2), findMinMax(p3, p4));\n} else if (state \x3d\x3d 1) {\npval \x3d findMax(findMax(p1, p2), findMax(p3, p4));\n} else if (state \x3d\x3d 0) {\npval \x3d findMin(findMin(p1, p2), findMin(p3, p4));\n}\nreturn pval;\n}\nfloat stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool scaled) {\nfloat stretchedVal;\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nstretchedVal \x3d minOutput + (val - minCutOff) * factor;\n} else if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nfloat stretchOneValueGamma(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, float gamma, float gammaCorrection, bool scaled) {\nfloat stretchedVal;\nfloat tempf \x3d 1.0;\nfloat outRange \x3d maxOutput - minOutput;\nfloat relativeVal \x3d (val - minCutOff) / (maxCutOff - minCutOff);\nif (val \x3e minCutOff \x26\x26 val \x3c maxCutOff) {\nif (gamma \x3e 1.0) {\ntempf -\x3d pow(1.0 / outRange, relativeVal * gammaCorrection);\n}\nstretchedVal \x3d floor(tempf * outRange * pow(relativeVal, 1.0 / gamma)) + minOutput;\n}\nelse if (val \x3e\x3d maxCutOff) {\nstretchedVal \x3d maxOutput;\n} else {\nstretchedVal \x3d minOutput;\n}\nif (scaled) {\nreturn stretchedVal;\n}\nelse {\nreturn stretchedVal / maxOutput; //0-1\n}\n}\nbool isOutside(){\nif (v_texCoord.t\x3e1.00001 ||v_texCoord.t\x3c-0.00001 || v_texCoord.s\x3e1.00001 ||v_texCoord.s\x3c-0.00001) {\ngl_FragColor \x3d vec4(0.0, 0.0, 0.0, 0.0);\nreturn true;\n}\nelse {\nreturn false;\n}\n}\nvoid main() {\nif (isOutside()) {\nreturn;\n}\nif (u_state \x3d\x3d 100) {\nvec4 currentPixel \x3d getPixelValue(v_texCoord);\nfloat grayVal,\nredVal,\ngreenVal,\nblueVal;\nfloat min0,\nmax0,\nmin1,\nmax1,\nmin2,\nmax2,\nfactor0,\nfactor1,\nfactor2;\nvec4 minV, maxV;\nif (u_minMaxTexture) {\nif (u_bandCount \x3d\x3d 1) {\nminV \x3d texture2D(u_image1, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d minV.g;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\n} else {\nminV \x3d texture2D(u_image1, v_texCoord);\nmaxV \x3d texture2D(u_image2, v_texCoord);\nmin0 \x3d minV.r;\nmax0 \x3d maxV.r;\nmin1 \x3d minV.g;\nmax1 \x3d maxV.g;\nmin2 \x3d minV.b;\nmax2 \x3d maxV.b;\nfactor0 \x3d (u_maxOutput[0] - u_minOutput[0]) / (max0 - min0);\nfactor1 \x3d (u_maxOutput[1] - u_minOutput[1]) / (max1 - min1);\nfactor2 \x3d (u_maxOutput[2] - u_minOutput[2]) / (max2 - min2);\n}\n} else {\nmin0 \x3d u_minCutOff[0];\nmax0 \x3d u_maxCutOff[0];\nmin1 \x3d u_minCutOff[1];\nmax1 \x3d u_maxCutOff[1];\nmin2 \x3d u_minCutOff[2];\nmax2 \x3d u_maxCutOff[2];\nfactor0 \x3d u_factor[0];\nfactor1 \x3d u_factor[1];\nfactor2 \x3d u_factor[2];\n}\nif (u_useGamma){\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValueGamma(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_gamma[0], u_gammaCorrection[0], u_scaled);\ngreenVal \x3d stretchOneValueGamma(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_gamma[1], u_gammaCorrection[1], u_scaled);\nblueVal \x3d stretchOneValueGamma(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_gamma[1], u_gammaCorrection[2], u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\nelse {\nif (u_bandCount \x3d\x3d 1) {\ngrayVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngl_FragColor \x3d vec4(grayVal, grayVal, grayVal, currentPixel.a);\n} else {\nredVal \x3d stretchOneValue(float(currentPixel.r), min0, max0, u_minOutput[0], u_maxOutput[0], factor0, u_scaled);\ngreenVal \x3d stretchOneValue(float(currentPixel.g), min1, max1, u_minOutput[1], u_maxOutput[1], factor1, u_scaled);\nblueVal \x3d stretchOneValue(float(currentPixel.b), min2, max2, u_minOutput[2], u_maxOutput[2], factor2, u_scaled);\ngl_FragColor \x3d vec4(redVal, greenVal, blueVal, currentPixel.a);\n}\n}\n} else {\nvec4 currentPixel \x3d minMax(u_state);\ngl_FragColor \x3d currentPixel;\n}\n}"}})},
"esri/layers/rasterLib/function/RasterFunctionWebGLMixin":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ./pixelShaders ./vertexShaders ./webglHelper ./convolutionKernel".split(" "),function(A,q,a,d,g,h,e){return A(null,{gl:null,rgbaFloatData:null,originalTexture:null,lastTexture:null,renderTexture:!1,constructor:function(b){this._isProgramInitialized=!1;this.gl=b&&b.gl;b&&b.renderTexture&&(this.renderTexture=b.renderTexture);this._xformSetting=b&&b._xformSetting||{requireProjection:!1,
meshSize:[20,20]}},bindFrameBuffer:function(){var b=this.gl;this._setupPingPongTextures();this._setupBranchingTextures();var c=this._glSetting;this.isBranch?(c.branchIndex=(c.branchIndex+1)%c.branchCount,c=c.branches[c.branchIndex]):(c.pingpongIndex=(c.pingpongIndex+1)%c.pingpong.length,c=c.pingpong[c.pingpongIndex]);b.bindFramebuffer(b.FRAMEBUFFER,c.frameBuffer);b.viewport(0,0,b.drawingBufferWidth,b.drawingBufferHeight);return c},_initializeProgram:function(b){if(this.gl)try{var c=this.gl;c.viewport(0,
0,c.drawingBufferWidth,c.drawingBufferHeight);var l=this._glSetting.programUniforms,k="local"===this.functionName?"local"+this.functionArguments.operation:this.functionName,f=l[k];if(f)this._uniforms=f.uniforms,this.rasterProgram=f.program;else{var m=(this._useMesh=this._tileMode&&this._xformSetting.requireProjection)?g.mesh:g.basic,n=g.getShader(c,b.vertex||m),p=d.getShader(c,b.fragment),r=this._loadProgram(n,p),v={rasterProgram:h.getUniforms(c,r)};l[k]={uniforms:v,program:r};this.rasterProgram=
r;this._uniforms=v}c.useProgram(this.rasterProgram);var u=c.getAttribLocation(this.rasterProgram,"a_texCoord"),t=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,t);var w=h.createMesh(this._xformSetting.meshSize);c.bufferData(c.ARRAY_BUFFER,w,c.STATIC_DRAW);c.enableVertexAttribArray(u);c.vertexAttribPointer(u,2,c.FLOAT,!1,0,0);c.disable(c.DEPTH_TEST);c.blendFunc(c.SRC_ALPHA,c.ZERO);c.disable(c.BLEND);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!1);this._shaderInfo=
{fragment:b.fragmentName}}catch(x){console.error("webgl exception: "+x.message)}else console.error("WebGL is required.")},_setUniform:function(b,c,l){null!=c&&(l&&!this._uniforms[l]&&(this._uniforms[l]=h.getUniforms(this.gl,this[l])),l=l?this._uniforms[l]:this._uniforms.rasterProgram,(b=l[b]||l[b+"[0]"])&&h.setUniform(this.gl,b,c))},_setUniforms:function(b,c){var l=Object.keys(b),k,f=l.length;for(k=0;k<f;k++)this._setUniform(l[k],b[l[k]],c);this.rawInput?this._setUniform("u_flipY",!0,c):this._setUniform("u_flipY",
!1,c);this._tileMode?(this.rawInput?(b=this._xformSetting.offset,l=this._xformSetting.scale):(b=[0,0],l=[1,1]),this._setUniform("u_xformOffset",b,c),this._setUniform("u_xformScale",l,c),this._xformSetting.requireProjection&&(this.rawInput?(this._setupXformTexture(),this._setUniform("u_projection",!0,c),this._setUniform("u_transformGridSize",this._xformSetting.gridConfig.size,c),this._setUniform("u_transformSpacing",this._xformSetting.gridConfig.spacing,c),this._setUniform("u_targetImageSize",new Float32Array([this.gl.drawingBufferWidth,
this.gl.drawingBufferHeight]),c)):this._setUniform("u_projection",!1,c))):(b=[0,0],l=[1,1],this._setUniform("u_xformOffset",b,c),this._setUniform("u_xformScale",l,c));this.rawInput&&this._rawResolution&&("RSP_BilinearInterpolation"===this.interpolation||"RSP_CubicConvolution"===this.interpolation)?(this._setUniform("u_resampling",1),this._setUniform("u_rawResolution",this._rawResolution)):this._setUniform("u_resampling",0)},_setupTextureData:function(b,c){if(b.texture)return b;b.raster&&b.raster.pixelBlock&&
(b=b.raster);this.rawInput=!0;var l=c&&c.notOriginal,k=c&&c.bandIDs;c&&c.reCreate?c=!1:(c=this._tileMode?!this._xformSetting.hasNewTexture:!this._glSetting.hasNewTexture)&&this._originalBandIDs&&(c=k?this._originalBandIDs.join("")===k.join(""):!1);0<this._glSetting.branchCount&&(c=!1);if(c&&this.originalTexture)return{extent:b.extent,texture:this.originalTexture};c=this._createTexture();l||(this.originalTexture=c,this._originalBandIDs=k);l=this.gl;var f=b.pixelBlock;this._rawResolution=f?[1/b.pixelBlock.width,
1/b.pixelBlock.height]:[1/this.gl.drawingBufferWidth,1/this.gl.drawingBufferHeight];var m=0;k&&0<k.length&&f&&(m=Math.max.apply(null,k),f.pixels.length>m&&k&&(f.pixels=k.map(function(p){return f.pixels[p]}),f.statistics&&(f.statistics=k.map(function(p){return f.statistics[p]}))));k=f.width;m=f.height;l.getExtension("OES_texture_float");var n=f.getAsRGBAFloat();l.texImage2D(l.TEXTURE_2D,0,l.RGBA,k,m,0,l.RGBA,l.FLOAT,n);return{extent:b.extent,texture:c}},_setupPingPongTextures:function(){var b=this._glSetting;
if(!b||!b.pingpong){b.pingpong=[];var c=h.createBufferTexture(this.gl,!1);b.pingpong.push(c);c=h.createBufferTexture(this.gl,!1);b.pingpong.push(c);b.pingpongIndex=1}},_setupBranchingTextures:function(){var b=this._glSetting;if(!b||!b.branches){b.branches=[];var c=0,l=b.branchCount;if(0<l){for(c=0;c<l;c++){var k=h.createBufferTexture(this.gl,!1);b.branches.push(k)}b.branchIndex=l-1}}},_setupXformTexture:function(b){for(var c=this._createTexture(),l=this.gl,k=4*this._xformSetting.gridConfig.size[0],
f=this._xformSetting.gridConfig.size[1],m=new Float32Array(k*f*4),n=0,p=0;p<this._xformSetting.gridConfig.coefficients.length;p++)m[n++]=this._xformSetting.gridConfig.coefficients[p],2===p%3&&(m[n++]=1);l.getExtension("OES_texture_float");l.texImage2D(l.TEXTURE_2D,0,l.RGBA,k,f,0,l.RGBA,l.FLOAT,m);this._bindTexture(c,"u_transformGrid",b)},_createTexture:function(b){return h.createTexture(this.gl,b)},_bindTexture:function(b,c,l){c=c||"u_image";l=this._uniforms[l||"rasterProgram"];var k=this._getTextureIndex(c);
if(-1!==k){var f=this.gl;f.uniform1i(l[c].location,k);f.activeTexture(f.TEXTURE0+k);f.bindTexture(f.TEXTURE_2D,b)}},_getTextureIndex:function(b,c){c=this._uniforms[c||"rasterProgram"];if(!c||!c[b]||c[b].info.type!==this.gl.SAMPLER_2D)return-1;if("u_transformGrid"===b)return 0;b="u_image"===b?0:parseInt(b.replace("u_image",""));return this._xformSetting.requireProjection?b+1:b},_drawGL:function(b){var c=this.gl;this.renderTexture?(c.enable(c.BLEND),c.bindFramebuffer(c.FRAMEBUFFER,null)):c.disable(c.BLEND);
b||c.viewport(0,0,c.drawingBufferWidth,c.drawingBufferHeight);b=this._xformSetting.meshSize||[1,1];c.drawArrays(c.TRIANGLES,0,b[0]*b[1]*6);this._drawMesh()},_drawMesh:function(){if(this.renderTexture&&this._glSetting.drawMesh){this.meshProgram=this.meshProgram||this._setupMeshProgram();var b=this.gl;b.useProgram(this.meshProgram);b.bindFramebuffer(b.FRAMEBUFFER,null);var c=b.getAttribLocation(this.meshProgram,"a_texCoord"),l=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,l);l=this._xformSetting.meshSize||
[1,1];var k=h.createMesh(l,!0);b.bufferData(b.ARRAY_BUFFER,k,b.STATIC_DRAW);b.enableVertexAttribArray(c);b.vertexAttribPointer(c,2,b.FLOAT,!1,0,0);b.disable(b.DEPTH_TEST);b.blendFunc(b.ONE,b.ZERO);this._setUniforms({u_color:[0,0,1,1],u_drawMeshLines:!0},"meshProgram");b.drawArrays(b.LINES,0,l[0]*l[1]*10)}},_setupMeshProgram:function(){var b=g.getShader(this.gl,g.mesh),c=d.getShader(this.gl,d.constant);return this._loadProgram(b,c)},_loadProgram:function(b,c){return h.loadProgram(this.gl,b,c)},_getShaderScript:function(b,
c){c=document.getElementById(c);if(!c)return null;b="";for(c=c.firstChild;c;)3==c.nodeType&&(b+=c.textContent),c=c.nextSibling;return b}})})},"esri/layers/rasterLib/function/vertexShaders":function(){define(["dojo/_base/declare","dojo/_base/lang","./vertexShaderScripts"],function(A,q,a){A={shaderType:"vertex",getShader:function(d,g){var h=d.createShader(d.VERTEX_SHADER);d.shaderSource(h,g);d.compileShader(h);d.getShaderParameter(h,d.COMPILE_STATUS)||(h=null);return h}};q.mixin(A,a);return A})},"esri/layers/rasterLib/function/vertexShaderScripts":function(){define([],
function(){return{basic:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform bool u_flipY;\nvoid main() {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}",histogram:"attribute float a_pixelIndex;\nuniform sampler2D u_image;\nuniform sampler2D u_image1;\nuniform sampler2D u_image2;\nuniform vec2 u_sourceDim;\nuniform vec2 u_halfPixel;\nuniform vec4 u_bandSelection;\nuniform vec4 u_mins;\nuniform vec4 u_factors;\nuniform float u_size;\nuniform int u_bandCount;\nuniform bool u_minMaxTexture;\nvoid main() {\nfloat row \x3d a_pixelIndex/u_sourceDim.s;\nvec2 coord \x3d vec2(fract(row), floor(row)/u_sourceDim.t);\nvec4 pv \x3d texture2D(u_image, coord + u_halfPixel);\nvec4 minVal, maxVal, pvm;\nif (u_minMaxTexture){\nif (u_bandCount \x3d\x3d1){ //min \x3d red, max \x3d green\nvec4 minmax \x3d texture2D(u_image1, vec2(0.5,0.5));\nminVal \x3d vec4(minmax.r, minmax.r, minmax.r, 0.0);\nmaxVal \x3d vec4(minmax.g, minmax.g, minmax.g, 0.0);\n}\nelse if (u_bandCount \x3d\x3d3){ //min \x3d red, max \x3d green\nminVal \x3d texture2D(u_image1, vec2(0.5,0.5));\nmaxVal \x3d texture2D(u_image2, vec2(0.5,0.5));\n}\nvec4 factors \x3d u_size/(maxVal-minVal+vec4(0.0,0.0,0.0,1.0)) * u_factors;\npvm \x3d (pv - minVal) * factors;\n}\nelse {\npvm \x3d (pv - u_mins) * u_factors;\n}\nfloat histVal \x3d min(floor(pvm.r+pvm.g+pvm.b), u_size-1.0);\nhistVal \x3d pv.a \x3d\x3d 1.0? histVal: u_size;\ngl_Position \x3d vec4((histVal+0.1) / (u_size+1.0) * 2.0 - 1.0, 0.5, 0, 1);\ngl_PointSize \x3d 1.0;\n}",
mesh:"varying vec2 v_texCoord;\nattribute vec2 a_texCoord;\nuniform bool u_drawMeshLines;\nuniform bool u_flipY;\nuniform vec2 u_xformOffset;\nuniform vec2 u_xformScale;\nuniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nuniform vec2 u_srcImageSize;\nuniform bool u_projection;\nvec2 projectPixelLocation(vec2 coords) {\nvec2 index_image \x3d floor(coords * u_targetImageSize);\nvec2 oneTransformPixel \x3d vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform \x3d floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos \x3d fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location \x3d index_transform + oneTransformPixel * 0.5;\nif (pos.s \x3c\x3d pos.t) {\nvec4 ll_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc \x3d texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def \x3d texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s \x3d dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t \x3d dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;// + halfPixel;\n}\nvoid main() {\nif (u_projection) {\nv_texCoord \x3d projectPixelLocation(a_texCoord);\n} else {\nv_texCoord \x3d u_xformOffset + a_texCoord * u_xformScale;\n}\nif (u_flipY) {\nv_texCoord.t \x3d 1.0 - v_texCoord.t;\n}\nvec2 position \x3d a_texCoord * 2.0 - 1.0;\nif (u_drawMeshLines){\nvec2 adjustedPos \x3d (v_texCoord - u_xformOffset) / u_xformScale;\ngl_Position \x3d vec4( adjustedPos * 2.0 - 1.0, 0.0, 1.0);\n}\nelse {\ngl_Position \x3d vec4(position, 0.0, 1.0);\n}\n}"}})},
"esri/layers/rasterLib/function/webglHelper":function(){define([],function(){var A={getUniforms:function(q,a){var d=q.getProgramParameter(a,q.ACTIVE_UNIFORMS),g,h,e={};for(g=0;g<d;g++)(h=q.getActiveUniform(a,g))&&(e[h.name]={location:q.getUniformLocation(a,h.name),info:h});return e},setUniform:function(q,a,d){var g=a.info,h=a.location,e=g.type;if(null==d)console.log("uniform "+a.info.name+" has null or undefined value");else switch(e){case q.FLOAT:1<g.size?0===d.length?console.log("uniform "+a.info.name+
" has length 0"):q.uniform1fv(h,d):q.uniform1f(h,d);break;case q.FLOAT_VEC2:if(0===d.length){console.log("uniform "+a.info.name+" has length 0");break}q.uniform2fv(h,d);break;case q.FLOAT_VEC3:if(0===d.length){console.log("uniform "+a.info.name+" has length 0");break}q.uniform3fv(h,d);break;case q.FLOAT_VEC4:if(0===d.length){console.log("uniform "+a.info.name+" has length 0");break}q.uniform4fv(h,d);break;case q.INT:case q.BOOL:1<g.size?0===d.length?console.log("uniform "+a.info.name+" has length 0"):
q.uniform1iv(h,d):q.uniform1i(h,d);break;case q.INT_VEC2:case q.BOOL_VEC2:if(0===d.length){console.log("uniform "+a.info.name+" has length 0");break}q.uniform2iv(h,d);break;case q.INT_VEC3:case q.BOOL_VEC3:if(0===d.length){console.log("uniform "+a.info.name+" has length 0");break}q.uniform3iv(h,d);break;case q.INT_VEC4:case q.BOOL_VEC4:0===d.length?console.log("uniform "+a.info.name+" has length 0"):q.uniform4iv(h,d)}},createTexture:function(q,a){var d=q.createTexture();q.bindTexture(q.TEXTURE_2D,
d);q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.CLAMP_TO_EDGE);q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.CLAMP_TO_EDGE);q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,a?q.LINEAR:q.NEAREST);q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,a?q.LINEAR:q.NEAREST);return d},createBufferTexture:function(q,a,d){a=A.createTexture(q,a);q.getExtension("OES_texture_float");d=d||[q.drawingBufferWidth,q.drawingBufferHeight];q.texImage2D(q.TEXTURE_2D,0,q.RGBA,d[0],d[1],0,q.RGBA,q.FLOAT,null);d=q.createFramebuffer();
q.bindFramebuffer(q.FRAMEBUFFER,d);q.framebufferTexture2D(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,q.TEXTURE_2D,a,0);return{texture:a,frameBuffer:d}},getShader:function(q,a,d){d=d?q.createShader(q.VERTEX_SHADER):q.createShader(q.FRAGMENT_SHADER);q.shaderSource(d,a);q.compileShader(d);q.getShaderParameter(d,q.COMPILE_STATUS)||(console.log(q.getShaderInfoLog(d)),d=null);return d},loadProgram:function(q,a,d){var g=q.createProgram();q.attachShader(g,a);q.attachShader(g,d);q.linkProgram(g);q.getProgramParameter(g,
q.LINK_STATUS)||(console.warn("failed to load webgl program: "+q.getProgramInfoLog(g)),q.deleteProgram(g),g=null);return g},createMesh:function(q,a){if(!q||1===q[0]&&1===q[1])return new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]);var d=q&&a?new Float32Array(q[0]*q[1]*20):new Float32Array(q[0]*q[1]*12);var g=.9998/q[1],h=.9998/q[0],e,b,c=0;for(e=0;e<q[1];e++)for(b=0;b<q[0];b++){var l=1E-4+g*e;var k=1E-4+h*b;q&&!a?(d[c++]=l,d[c++]=k,d[c++]=l+g,d[c++]=k,d[c++]=l,d[c++]=k+h,d[c++]=l,d[c++]=k+h,d[c++]=l+g,
d[c++]=k,d[c++]=l+g,d[c++]=k+h):(d[c++]=l,d[c++]=k,d[c++]=l,d[c++]=k+h,d[c++]=l,d[c++]=k+h,d[c++]=l+g,d[c++]=k+h,d[c++]=l+g,d[c++]=k+h,d[c++]=l+g,d[c++]=k,d[c++]=l,d[c++]=k,d[c++]=l+g,d[c++]=k,d[c++]=l,d[c++]=k+h,d[c++]=l+g,d[c++]=k)}return d}};return A})},"esri/layers/rasterLib/function/convolutionKernel":function(){define([],function(){var A={Default:[0,0,0,0,1,0,0,0,0],LineDetectionHorizontal:[-1,-1,-1,2,2,2,-1,-1,-1],LineDetectionVertical:[-1,2,-1,-1,2,-1,-1,2,-1],LineDetectionLeftDiagonal:[2,
-1,-1,-1,2,-1,-1,-1,2],LineDetectionRightDiagonal:[-1,-1,2,-1,2,-1,2,-1,-1],GradientNorth:[-1,-2,-1,0,0,0,1,2,1],GradientWest:[-1,0,1,-2,0,2,-1,0,1],GradientEast:[1,0,-1,2,0,-2,1,0,-1],GradientSouth:[1,2,1,0,0,0,-1,-2,-1],GradientNorthEast:[0,-1,-2,1,0,-1,2,1,0],GradientNorthWest:[-2,-1,0,-1,0,1,0,1,2],SmoothArithmeticMean:[.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111,.111111111111],Smoothing3x3:[.0625,.125,.0625,.125,.25,.125,.0625,
.125,.0625],Smoothing5x5:[1,1,1,1,1,1,4,4,4,1,1,4,12,4,1,1,4,4,4,1,1,1,1,1,1],Sharpening3x3:[-1,-1,-1,-1,9,-1,-1,-1,-1],Sharpening5x5:[-1,-3,-4,-3,-1,-3,0,6,0,-3,-4,6,21,6,-4,-3,0,6,0,-3,-1,-3,-4,-3,-1],Laplacian3x3:[0,-1,0,-1,4,-1,0,-1,0],Laplacian5x5:[0,0,-1,0,0,0,-1,-2,-1,0,-1,-2,17,-2,-1,0,-1,-2,-1,0,0,0,-1,0,0],SobelHorizontal:[-1,-2,-1,0,0,0,1,2,1],SobelVertical:[-1,0,1,-2,0,2,-1,0,1],Sharpen:[0,-.25,0,-.25,2,-.25,0,-.25,0],Sharpen2:[-.25,-.25,-.25,-.25,3,-.25,-.25,-.25,-.25],PointSpread:[-.627,
.352,-.627,.352,2.923,.352,-.627,.352,-.627],getKernel:function(q){switch(q){case 0:return A.LineDetectionHorizontal;case 1:return A.LineDetectionVertical;case 2:return A.LineDetectionLeftDiagonal;case 3:return A.LineDetectionRightDiagonal;case 4:return A.GradientNorth;case 5:return A.GradientWest;case 6:return A.GradientEast;case 7:return A.GradientSouth;case 8:return A.GradientNorthEast;case 9:return A.GradientNorthWest;case 10:return A.SmoothArithmeticMean;case 11:return A.Smoothing3x3;case 12:return A.Smoothing5x5;
case 13:return A.Sharpening3x3;case 14:return A.Sharpening5x5;case 15:return A.Laplacian3x3;case 16:return A.Laplacian5x5;case 17:return A.SobelHorizontal;case 18:return A.SobelVertical;case 19:return A.Sharpen;case 20:return A.Sharpen2;case 21:return A.PointSpread;default:return A.Default}}};return A})},"esri/layers/rasterLib/function/surfaceUtils":function(){define(["dojo/_base/lang"],function(A){return{hillshade:function(q,a){if(null!==q&&null!==q.pixelBlock&&null!==q.pixelBlock.pixels){var d=
this._clonePixelBlock(q.pixelBlock),g=a.altitude,h=a.azimuth,e=a.zFactor,b=a.psPower,c=a.psFactor,l=a.hillshadeType,k=a.slopeType,f=a.isGCS;1===l&&(e*=2);a=d.width;var m=d.height,n=d.pixels[0],p=d.mask,r=new Uint8Array(a*m);p&&r.set(p);var v=new Uint8Array(a*m),u=(q.extent.xmax-q.extent.xmin)/a,t=(q.extent.ymax-q.extent.ymin)/m,w=e/(8*u),x=e/(8*t);.001<e&&f&&(w/=111E3,x/=111E3);3===k&&(f?(w=111E3*u,x=111E3*t,w=(e+Math.pow(w,b)*c)/(8*w),x=(e+Math.pow(x,b)*c)/(8*x)):(w=(e+Math.pow(u,b)*c)/(8*u),x=(e+
Math.pow(t,b)*c)/(8*t)));f=(90-g)*Math.PI/180;g=Math.cos(f);var y=(360-h+90)*Math.PI/180;h=Math.sin(f)*Math.cos(y);f=Math.sin(f)*Math.sin(y);e=[];b=[];c=[];u=[315,270,225,360,180,0];var z=[60,60,60,60,60,90];k=[3,5,3,2,1,4];var B=k.reduce(function(I,N){return I+N});t=k.map(function(I){return I/B});if(1===l){var F=u.length;for(k=0;k<F;k++)g=z[k],h=u[k],f=(90-g)*Math.PI/180,g=Math.cos(f),y=(360-h+90)*Math.PI/180,h=Math.sin(f)*Math.cos(y),f=Math.sin(f)*Math.sin(y),e.push(g),b.push(h),c.push(f)}var D=
0;for(k=1;k<m-1;k++)for(z=k*a,u=1;u<a-1;u++)if(p&&!p[z+u])v[z+u]=0;else{y=0;if(p&&(y=p[z-a+u-1]+p[z-a+u]+p[z-a+u+1]+p[z+u-1]+p[z+u+1]+p[z+a+u-1]+p[z+a+u]+p[z+a+u+1],7>y)){v[z+u]=0;r[z+u]=0;continue}if(7===y){var C=p[z-a+u-1]?n[z-a+u-1]:n[z+u];var E=p[z-a+u]?n[z-a+u]:n[z+u];var G=p[z-a+u+1]?n[z-a+u+1]:n[z+u];y=p[z+u-1]?n[z+u-1]:n[z+u];var H=p[z+u+1]?n[z+u+1]:n[z+u];D=p[z+a+u-1]?n[z+a+u-1]:n[z+u];var K=p[z+a+u]?n[z+a+u]:n[z+u];var M=p[z+a+u+1]?n[z+a+u+1]:n[z+u]}else C=n[z-a+u-1],E=n[z-a+u],G=n[z-a+
u+1],y=n[z+u-1],H=n[z+u+1],D=n[z+a+u-1],K=n[z+a+u],M=n[z+a+u+1];y=(G+H+H+M-(C+y+y+D))*w;E=(D+K+K+M-(C+E+E+G))*x;G=Math.sqrt(1+y*y+E*E);D=0;if(0===l)K=f*E-h*y,K=255*(g+K)/G,0>K&&(K=0),D=K;else if(1===l)for(C=0;C<F;C++)K=c[C]*E-b[C]*y,K=255*(e[C]+K)/G,0>K&&(K=0),D+=K*t[C];v[z+u]=D}for(k=0;k<m;k++)v[k*a]=v[k*a+1],v[(k+1)*a-1]=v[(k+1)*a-2];for(k=1;k<a-1;k++)v[k]=v[k+a],v[k+(m-1)*a]=v[k+(m-2)*a];d.pixelType="U8";d.pixels=[v];d.statistics=[{minValue:0,maxValue:255}];p&&(d.mask=r);return{extent:q.extent,
pixelBlock:d}}},slope:function(q,a){if(null!==q&&null!==q.pixelBlock&&null!==q.pixelBlock.pixels){var d=this._clonePixelBlock(q.pixelBlock),g=a.zFactor,h=a.psPower,e=a.psFactor,b=a.slopeType,c=a.isGCS;a=d.width;var l=d.height,k=d.pixels[0],f=d.mask,m=new Uint8Array(a*l);f&&m.set(f);var n=new Float32Array(a*l),p=(q.extent.xmax-q.extent.xmin)/a,r=(q.extent.ymax-q.extent.ymin)/l,v=g/(8*p),u=g/(8*r);1E-4>Math.abs(g-1)&&c&&(v/=111E3,u/=111E3);3===b&&(c?(v=111E3*p,u=111E3*r,v=(g+Math.pow(v,h)*e)/(8*v),
u=(g+Math.pow(u,h)*e)/(8*u)):(v=(g+Math.pow(p,h)*e)/(8*p),u=(g+Math.pow(r,h)*e)/(8*r)));for(g=1;g<l-1;g++)for(e=g*a,h=1;h<a-1;h++)if(f&&!f[e+h])n[e+h]=0;else{r=0;if(f&&(r=f[e-a+h-1]+f[e-a+h]+f[e-a+h+1]+f[e+h-1]+f[e+h+1]+f[e+a+h-1]+f[e+a+h]+f[e+a+h+1],7>r)){n[e+h]=0;m[e+h]=0;continue}if(7===r){r=f[e-a+h-1]?k[e-a+h-1]:k[e+h];c=f[e-a+h]?k[e-a+h]:k[e+h];p=f[e-a+h+1]?k[e-a+h+1]:k[e+h];var t=f[e+h-1]?k[e+h-1]:k[e+h];var w=f[e+h+1]?k[e+h+1]:k[e+h];var x=f[e+a+h-1]?k[e+a+h-1]:k[e+h];var y=f[e+a+h]?k[e+a+
h]:k[e+h];var z=f[e+a+h+1]?k[e+a+h+1]:k[e+h]}else r=k[e-a+h-1],c=k[e-a+h],p=k[e-a+h+1],t=k[e+h-1],w=k[e+h+1],x=k[e+a+h-1],y=k[e+a+h],z=k[e+a+h+1];t=(p+w+w+z-(r+t+t+x))*v;r=(x+y+y+z-(r+c+c+p))*u;r=Math.sqrt(t*t+r*r);n[e+h]=1===b||3===b?57.2957795*Math.atan(r):100*r}for(g=0;g<l;g++)n[g*a]=n[g*a+1],n[(g+1)*a-1]=n[(g+1)*a-2];for(g=1;g<a-1;g++)n[g]=n[g+a],n[g+(l-1)*a]=n[g+(l-2)*a];d.pixelType="F32";d.pixels=[n];d.statistics=[{minValue:0,maxValue:255}];f&&(d.mask=m);return{extent:q.extent,pixelBlock:d}}},
aspect:function(q){if(null!==q&&null!==q.pixelBlock&&null!==q.pixelBlock.pixels){var a=this._clonePixelBlock(q.pixelBlock),d=a.width,g=a.height,h=a.pixels[0],e=a.mask,b=new Uint8Array(d*g);e&&b.set(e);var c=new Float32Array(d*g),l=1/((q.extent.xmax-q.extent.xmin)/d),k=1/((q.extent.ymax-q.extent.ymin)/g),f,m;for(f=1;f<g-1;f++){var n=f*d;for(m=1;m<d-1;m++)if(e&&!e[n+m])c[n+m]=0;else{var p=0;if(e&&(p=e[n-d+m-1]+e[n-d+m]+e[n-d+m+1]+e[n+m-1]+e[n+m+1]+e[n+d+m-1]+e[n+d+m]+e[n+d+m+1],7>p)){c[n+m]=0;b[n+m]=
0;continue}if(7===p){p=e[n-d+m-1]?h[n-d+m-1]:h[n+m];var r=e[n-d+m]?h[n-d+m]:h[n+m];var v=e[n-d+m+1]?h[n-d+m+1]:h[n+m];var u=e[n+m-1]?h[n+m-1]:h[n+m];var t=e[n+m+1]?h[n+m+1]:h[n+m];var w=e[n+d+m-1]?h[n+d+m-1]:h[n+m];var x=e[n+d+m]?h[n+d+m]:h[n+m];var y=e[n+d+m+1]?h[n+d+m+1]:h[n+m]}else p=h[n-d+m-1],r=h[n-d+m],v=h[n-d+m+1],u=h[n+m-1],t=h[n+m+1],w=h[n+d+m-1],x=h[n+d+m],y=h[n+d+m+1];u=(v+t+t+y-(p+u+u+w))*l;p=(w+x+x+y-(p+r+r+v))*k;0===u&&0===p?p=-1:(p=90-57.29578*Math.atan2(p,-u),0>p&&(p+=360),360===p?
p=0:360<p&&(p%=360));c[n+m]=p}}for(f=0;f<g;f++)c[f*d]=c[f*d+1],c[(f+1)*d-1]=c[(f+1)*d-2];for(f=1;f<d-1;f++)c[f]=c[f+d],c[f+(g-1)*d]=c[f+(g-2)*d];a.pixelType="F32";a.pixels=[c];a.statistics={minValue:0,maxValue:360};e&&(a.mask=b);return{extent:q.extent,pixelBlock:a}}},_clonePixelBlock:function(q){return q.clone?q.clone():A.clone(q)}}})},"esri/layers/rasterLib/function/BandArithmeticFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),
function(A,q,a,d,g,h,e){return A([a,h],{declaredClass:"esri.layers.rasterLib.function.BandArithmeticFunction",functionName:"BandArithmetic",supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=this.mixinIgnoreCase({method:1,bandIndexes:"",raster:null},b)},bind:function(b){b=this.getSourceRasterInfo(b);if(!b.raster)return Error("The raster input to band arithmetic function is invalid.");this.rasterInfo=q.mixin(b.raster,{bandCount:8===this.functionArguments.method?b.raster.bandCount:
1,pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(b){this._performance.start();b=b.raster;var c=e.calculate(b.pixelBlock,{bandIndexes:this.functionArguments.bandIndexes,method:this.functionArguments.method});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);
return{extent:b.extent,pixelBlock:c}},readGL:function(b){this._performance.start();this._initializeProgram({fragment:g.bandArithmetic,fragmentName:"bandArithmetic"});var c=this.functionArguments.bandIndexes.trim().split(" ").map(function(m){return parseInt(m,10)});this._infraredBandID=c[0]-1;this._visibleBandID=c[1]-1;this._alterBand=2<Math.max(this._infraredBandID,this._visibleBandID)?!0:!1;b=this._setupTextureData(b.raster,this._alterBand&&2==c.length?{bandIDs:[this._infraredBandID,this._visibleBandID,
this._infraredBandID]}:{bandIDs:[c[0]-1,c[1]-1,c[2]-1]});var l=this.bindFrameBuffer(),k=this.functionArguments.method,f=2<c.length?c.slice(2):null;this._alterBand?this._setUniforms({u_method:k,u_bandId_nir:0,u_bandId_red:1,u_constants:f}):this._setUniforms({u_method:k,u_bandId_nir:c[0]-1,u_bandId_red:c[1]-1,u_constants:f});this._bindTexture(b.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:b.extent,texture:l.texture}}})})},"esri/layers/rasterLib/function/rasterIndex":function(){define(["dojo/_base/lang"],
function(A){return{calculate:function(q,a){if(q&&q.pixels&&q.pixels.length){var d=a&&a.bandIndexes;a=a&&a.method;var g=d.trim().split(" ").map(function(b){return parseInt(b,10)}).filter(function(b){return null!=b});q=this._clonePixelBlock(q);var h=q.pixels,e=q.mask;switch(a){case 1:h=this._calculateNDVI(e,h[g[0]-1],h[g[1]-1]);break;case 2:h=this._calculateSAVI(e,h[g[0]-1],h[g[1]-1],g[2]);break;case 3:h=this._calculateTSAVI(e,h[g[0]-1],h[g[1]-1],g[2],g[3],g[4]);break;case 4:h=this._calculateMSAVI(e,
h[g[0]-1],h[g[1]-1]);break;case 5:h=this._calculateGEMI(e,h[g[0]-1],h[g[1]-1]);break;case 6:h=this._calculatePVI(e,h[g[0]-1],h[g[1]-1],g[2],g[3]);break;case 7:h=this._calculateGVITM(e,h[g[0]-1],h[g[1]-1],h[g[2]-1],h[g[3]-1],h[g[4]-1],h[g[5]-1]);break;case 8:h=this._calculateSultan(e,h[g[0]-1],h[g[1]-1],h[g[2]-1],h[g[3]-1],h[g[4]-1],h[g[5]-1]);break;case 9:h=this._calculateVARI(e,h[g[0]-1],h[g[1]-1],h[g[2]-1]);break;case 0:h=this._calculateUserDefined(e,h,d)}q.pixels=h;q.pixelType="F32";q.calculateStatistics();
return q}},_clonePixelBlock:function(q){return q.clone?q.clone():A.clone(q)},_parseUserDefined:function(q,a){q=q.replace(" ","");0===q.indexOf("-")&&(q="0"+q);0===q.indexOf("+")&&(q=q.slice(1,q.length));q=q.split("");var d=[],g=[],h="+-*/()".split(""),e,b="";for(e=0;e<q.length;e++){var c=q[e];h.some(function(l){return l===c})?(""!==b&&g.push(parseFloat(b)),d.push(c),b=""):"b"===c.toLowerCase()?(e++,b=c.concat(q[e]),g.push(a[parseInt(b[1],10)-1]),b=""):(b=b.concat(c),e===q.length-1&&g.push(parseFloat(b)))}return{ops:d,
nums:g}},_op:function(q,a,d,g){if(d.constructor===Number&&g.constructor===Number)return d+g;var h;if(d.constructor===Number){var e=g.length;var b=d;d=new Float32Array(e);for(h=0;h<e;h++)d[h]=b}else if(e=d.length,g.constructor===Number)for(b=g,g=new Float32Array(e),h=0;h<e;h++)g[h]=b;b=new Float32Array(e);if(null==q)if("+"===a)for(h=0;h<e;h++)b[h]=d[h]+g[h];else if("-"===a)for(h=0;h<e;h++)b[h]=d[h]-g[h];else if("*"===a)for(h=0;h<e;h++)b[h]=d[h]*g[h];else{if("/"===a)for(h=0;h<e;h++)b[h]=d[h]/g[h]}else if("+"===
a)for(h=0;h<e;h++)q[h]&&(b[h]=d[h]+g[h]);else if("-"===a)for(h=0;h<e;h++)q[h]&&(b[h]=d[h]-g[h]);else if("*"===a)for(h=0;h<e;h++)q[h]&&(b[h]=d[h]*g[h]);else if("/"===a)for(h=0;h<e;h++)q[h]&&(b[h]=d[h]/g[h]);return b},_shrinkOp:function(q,a){q.splice(a,1);var d=a=0,g=0;do{for(a=g=d=0;a<q.length;a++)if("("===q[a])d=a;else if(")"===q[a]){g=a;break}g===d+1&&q.splice(d,2)}while(g===d+1);return q},_getPriorityOpIndex:function(q,a){if(1===q.length)return{opIndex:0,numIndex:0};var d=a=0,g=0,h=-1,e=0;for(a=
0;a<q.length;a++)if("("===q[a])d=a;else if(")"===q[a]){g=a;break}var b=0===g?q:q.slice(d+1,g);for(a=0;a<b.length;a++)if("*"===b[a]||"/"===b[a]){h=a;break}if(!(-1<h))for(a=0;a<b.length;a++)if("+"===b[a]||"-"===b[a]){h=a;break}0<g&&(h+=d+1);for(a=0;a<h;a++)"("===q[a]&&e++;return{opIndex:h,numIndex:h-e}},_calculateUserDefined:function(q,a,d){a=this._parseUserDefined(d,a);d=a.ops;for(var g=a.nums,h,e,b;0<d.length&&(a=this._getPriorityOpIndex(d,g),h=d[a.opIndex],e=g[a.numIndex],b=g[a.numIndex+1],h=this._op(q,
h,e,b),1!==d.length);)d=this._shrinkOp(d,a.opIndex),g.splice(a.numIndex,2,h);return[h]},_calculateNDVI:function(q,a,d){var g=d.length,h=new Float32Array(g),e;if(null==q)for(e=0;e<g;e++){var b=d[e];var c=a[e];h[e]=(c-b)/(c+b)}else for(e=0;e<g;e++)q[e]&&(b=d[e],c=a[e],h[e]=(c-b)/(c+b));return[h]},_calculateSAVI:function(q,a,d,g){var h=d.length,e=new Float32Array(h),b;if(null==q)for(b=0;b<h;b++){var c=d[b];var l=a[b];e[b]=(l-c)/(l+c+g)*(1+g)}else for(b=0;b<h;b++)q[b]&&(c=d[b],l=a[b],e[b]=(l-c)/(l+c+
g)*(1+g));return[e]},_calculateTSAVI:function(q,a,d,g,h,e){var b=d.length,c=new Float32Array(b),l=-h*g+e*(1+g*g);if(null==q)for(e=0;e<b;e++){var k=d[e];var f=a[e];c[e]=g*(f-g*k-h)/(h*f+k+l)}else for(e=0;e<b;e++)q[e]&&(k=d[e],f=a[e],c[e]=g*(f-g*k-h)/(h*f+k+l));return[c]},_calculateMSAVI:function(q,a,d){var g=d.length,h=new Float32Array(g),e;if(null==q)for(e=0;e<g;e++){var b=d[e];var c=a[e];h[e]=.5*(2*(c+1)-Math.sqrt(Math.pow(2*c+1,2)-8*(c-b)))}else for(e=0;e<g;e++)q[e]&&(h[e]=.5*(2*(c+1)-Math.sqrt(Math.pow(2*
c+1,2)-8*(c-b))));return[h]},_calculateGEMI:function(q,a,d){var g=d.length,h=new Float32Array(g),e;if(null==q)for(e=0;e<g;e++){var b=d[e];var c=a[e];c=(2*(c*c-b*b)+1.5*c+.5*b)/(c+b+.5);h[e]=c*(1-.25*c)-(b-.125)/(1-b)}else for(e=0;e<g;e++)q[e]&&(b=d[e],c=a[e],c=(2*(c*c-b*b)+1.5*c+.5*b)/(c+b+.5),h[e]=c*(1-.25*c)-(b-.125)/(1-b));return[h]},_calculatePVI:function(q,a,d,g,h){var e=d.length,b=new Float32Array(e),c,l=Math.sqrt(1+g*g);if(null==q)for(c=0;c<e;c++){var k=d[c];var f=a[c];b[c]=(f-g*k-h)/l}else for(c=
0;c<e;c++)q[c]&&(k=d[c],f=a[c],b[c]=(f-g*k-h)/l);return[b]},_calculateGVITM:function(q,a,d,g,h,e,b){var c=a.length,l=new Float32Array(c),k;if(null==q)for(k=0;k<c;k++)l[k]=-.2848*a[k]-.2435*d[k]-.5436*g[k]+.7243*h[k]+.084*e[k]-1.18*b[k];else for(k=0;k<c;k++)q[k]&&(l[k]=-.2848*a[k]-.2435*d[k]-.5436*g[k]+.7243*h[k]+.084*e[k]-1.18*b[k]);return[l]},_calculateSultan:function(q,a,d,g,h,e,b){d=a.length;var c=new Float32Array(d),l=new Float32Array(d),k=new Float32Array(d),f;if(null==q)for(f=0;f<d;f++)c[f]=
e[f]/b[f]*100,l[f]=e[f]/a[f]*100,k[f]=g[f]/h[f]*(e[f]/h[f])*100;else for(f=0;f<d;f++)q[f]&&(c[f]=e[f]/b[f]*100,l[f]=e[f]/a[f]*100,k[f]=g[f]/h[f]*(e[f]/h[f])*100);return[c,l,k]},_calculateVARI:function(q,a,d,g){var h=a.length,e=new Float32Array(h),b;if(null==q)for(b=0;b<h;b++){var c=a[b];var l=d[b];var k=g[b];e[b]=(l-c)/(l+c-k)}else for(b=0;b<h;b++)if(q[b])for(b=0;b<h;b++)c=a[b],l=d[b],k=g[b],e[b]=(l-c)/(l+c-k);return[e]}}})},"esri/layers/rasterLib/function/ColormapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(A,q,a,d,g,h,e){return A([d,h],{declaredClass:"esri.layers.rasterLib.function.ColormapFunction",functionName:"Colormap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=this.mixinIgnoreCase({colormap:null,colorRampName:null,colorRamp:null,colorMapName:null,raster:null},b);this.invert=b&&b.invert;b=b.colormap||b.Colormap;if(b){if(b.features||b[0].attributes){b=b.features||b;var c=Object.keys(b[0].attributes);var l=c.filter(function(r){return"alpha"===
r.toLowerCase()})[0];var k=c.filter(function(r){return"value"===r.toLowerCase()})[0];var f=c.filter(function(r){return"red"===r.toLowerCase()})[0];var m=c.filter(function(r){return"green"===r.toLowerCase()})[0];var n=c.filter(function(r){return"blue"===r.toLowerCase()})[0];if(!(k&&f&&m&&n))throw"invalid colormap";b=b.map(function(r){return l?[r.attributes[k],r.attributes[f],r.attributes[m],r.attributes[n],r.attributes[l]]:[r.attributes[k],r.attributes[f],r.attributes[m],r.attributes[n]]});var p=1.1>
Math.max.apply(null,b.map(function(r){return r[1]}));c=l&&1.1>Math.max.apply(null,b.map(function(r){return r[4]}));if(p)for(p=0;p<b.length;p++)b[p][1]=Math.round(255*b[p][1]),b[p][2]=Math.round(255*b[p][2]),b[p][3]=Math.round(255*b[p][3]),c&&(b[p][4]=Math.round(255*b[p][4]))}this.functionArguments.colormap=this._sortClr(b)}this._initialize()},bind:function(b){this._initialize();b=this.getSourceRasterInfo(b);if(!b.raster||"F32"===b.raster.pixelType)return Error("The raster input to colormap function is invalid. It must be integer type.");
this.rasterInfo=q.mixin(b.raster,{bandCount:3,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(b){return this._colorize(b.raster)},readGL:function(b){return this._colorizeGL(b.raster)},_colorize:function(b){this._performance.start();var c=e.colorize(b.pixelBlock,{indexedColormap:this._indexedColormap,indexedColormapOffset:this._indexedColormapOffset,
indexed2DColormap:this._indexed2DColormap,alphaSpecified:this._alphaSpecified});this._addPerformanceMetric(this._performance.elapsed());return{extent:b.extent,pixelBlock:c}},_binarySearchClr:function(b,c){for(var l=0,k=b.length-1,f=0,m=0;l<k;)if(f=Math.floor((l+k)/2),m=b[f],m[0]<c)l=f;else if(m[0]>c)k=f;else return m.slice(1);return null},_sortClr:function(b,c){var l,k=[];for(l=0;l<b.length;l++)k.push(b[l]);for(l=0;l<k.length-1;l++){var f=k[l];for(b=l+1;b<k.length;b++)f[0]>k[b][0]&&(f=k[b],k[b]=k[l],
k[l]=f)}if(c)for(l=0;l<k.length/2;l++)f=k[l],k[k.length-1-l]=k[l],k[l]=f;return k},_invertColorRamp:function(b){if(!b)return b;var c={type:b.type};"random"===b.type?c=b:"multipart"===b.type?c.colorRamps=b.colorRamps.map(function(l){return{fromColor:l.toColor,toColor:l.fromColor}}).reverse():(c.fromColor=b.toColor,c.toColor=b.fromColor);return c},_initialize:function(){this._indexedColormapOffset=0;if(this.functionArguments.colormap){var b=e.buildIndexedColormap(this.functionArguments.colormap);this._alphaSpecified=
b&&b.alphaSpecified;this._indexedColormap=b&&b.indexedColormap;this._indexedColormapOffset=b&&b.offset;this._indexedColormap||(this._indexed2DColormap=this._getIndexed2DColormap())}else this.functionArguments.colorRamp?this._indexedColormap="multipart"===this.functionArguments.colorRamp.type?this.invert?a.createMultiPartColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):a.createMultiPartColorRamp(this.functionArguments.colorRamp):this.invert?a.createAlgorithmicColorRamp(this._invertColorRamp(this.functionArguments.colorRamp)):
a.createAlgorithmicColorRamp(this.functionArguments.colorRamp):this.functionArguments.colormapName&&"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=a.createRandomColorRamp())},_getIndexed2DColormap:function(){var b=this.functionArguments.colormap;if(!b)return null;var c=0;0>b[0][0]&&(c=b[0][0]);var l=[],k=5===b[0].length,f;for(f=0;f<b.length;f++)l[b[f][0]-c]=k?b[f].slice(1):b[f].slice(1).concat([255]);return l},_colorizeGL:function(b){this._performance.start();
this._initializeProgram({fragment:g.colormap,fragmentName:"Colormap"});var c=this._indexedColormap,l=this._indexedColormapOffset;this._clrTexture||(this._clrTexture=this._setupColormapTexture(c));var k=this._clrTexture,f=this.bindFrameBuffer();b=this._setupTextureData(b);this._setUniforms({u_indexedColormapOffset:l,u_indexedColormapMaxIndex:c.length/4-1});this._bindTexture(k,"u_image1");this._bindTexture(b.texture,"u_image");this._drawGL();return{extent:b.extent,texture:f.texture}},_setupColormapTexture:function(b){var c=
this._createTexture(),l=this.gl,k=b.length/4,f=new Float32Array(b.length),m,n=this.renderTexture?255:1;for(m=0;m<b.length;m++)f[m]=b[m]/n;l.getExtension("OES_texture_float");l.texImage2D(l.TEXTURE_2D,0,l.RGBA,k,1,0,l.RGBA,l.FLOAT,f);return c}})})},"esri/renderers/colorRampGenerator":function(){define(["dojo/_base/declare","dojo/_base/lang","../renderers/colorUtils"],function(A,q,a){return{createAlgorithmicColorRamp:function(d,g){if(!d)return null;var h=d.fromColor,e=d.toColor;if(!h||!e)return null;
void 0===h.r&&3<=h.length&&(h={r:h[0],g:h[1],b:h[2]});void 0===e.r&&3<=e.length&&(e={r:e[0],g:e[1],b:e[2]});var b=d.size||256;d=d.algorithm||"cie-lab";if(1===b)var c=[h.r,h.g,h.b,255];else if(2===b)c=[h.r,h.g,h.b,255,e.r,e.g,h.b,255];else if(-1<d.toLowerCase().indexOf("hsv")){c=a.toHSV(h);e=a.toHSV(e);b=b||256;var l=0===c.s,k=0===e.s;h=c.h;d=e.h;l&&!k?h=c.h=d:k&&!l&&(d=e.h=h);l=Math.abs(d-h);180>l?d=(d-h)/(b-1):(l=360-l,d=h>d?l/(b-1):-l/(b-1));l=(e.s-c.s)/(b-1);k=(e.v-c.v)/(b-1);var f=c.s;c=c.v;var m,
n=new Uint8Array(4*b);for(m=0;m<b-1;m++){var p=a.toRGB({h:h,s:f,v:c});n[4*m]=p.r;n[4*m+1]=p.g;n[4*m+2]=p.b;n[4*m+3]=255;h+=d;f+=l;c+=k;360<h?h-=360:0>h&&(h+=360)}p=a.toRGB(e);n[4*(b-1)]=p.r;n[4*(b-1)+1]=p.g;n[4*(b-1)+2]=p.b;n[4*(b-1)+3]=255;c=n}else if(-1<d.toLowerCase().indexOf("lch")){f=a.toLCH(h);e=a.toLCH(e);b=b||256;c=(e.l-f.l)/(b-1);h=(e.c-f.c)/(b-1);d=(e.h-f.h)/(b-1);l=f.l;k=f.c;f=f.h;n=new Uint8Array(4*b);for(m=0;m<b-1;m++)p=a.toRGB({l:l,c:k,h:f}),n[4*m]=p.r,n[4*m+1]=p.g,n[4*m+2]=p.b,n[4*
m+3]=255,l+=c,k+=h,f+=d;p=a.toRGB(e);n[4*(b-1)]=p.r;n[4*(b-1)+1]=p.g;n[4*(b-1)+2]=p.b;n[4*(b-1)+3]=255;c=n}else if(-1<d.toLowerCase().indexOf("lab")){f=a.toLAB(h);e=a.toLAB(e);b=b||256;c=(e.l-f.l)/(b-1);h=(e.a-f.a)/(b-1);d=(e.b-f.b)/(b-1);l=f.l;k=f.a;f=f.b;n=new Uint8Array(4*b);for(m=0;m<b-1;m++)p=a.toRGB({l:l,a:k,b:f}),n[4*m]=p.r,n[4*m+1]=p.g,n[4*m+2]=p.b,n[4*m+3]=255,l+=c,k+=h,f+=d;p=a.toRGB(e);n[4*(b-1)]=p.r;n[4*(b-1)+1]=p.g;n[4*(b-1)+2]=p.b;n[4*(b-1)+3]=255;c=n}if(g&&!1===g.flattened)for(g=c,
c=[],e=0;e<c/4;e++)c[e]=g.slice(4*e,4*e+4);return c},createMultiPartColorRamp:function(d,g){if(!d)return null;g=g&&q.clone(g)||{flattened:!0};var h=d.colorRamps;if(!h||0===h.length)return null;var e=d.size||256;d=Math.max(Math.floor(e/h.length),1);var b=Math.max(d,e-(h.length-1)*d),c=!1!==g.flattened;g.flattened=!0;e=(h.length-1)*d+b;var l=new Uint8Array(4*e);for(e=0;e<h.length;e++){var k={fromColor:h[e].fromColor,toColor:h[e].toColor,size:e===h.length-1?b:d};l instanceof Array?l.concat(this.createAlgorithmicColorRamp(k,
g)):l.set(this.createAlgorithmicColorRamp(k,g),d*e*4)}if(!c)for(g=l,l=[],e=0;e<l/4;e++)l[e]=g.slice(4*e,4*e+4);return l},createRandomColorRamp:function(d){d=d||{};var g=d.size||256,h=!1===d.flattened;var e=h?new Uint8Array(4*g):[];for(d=0;d<g;d++)h?(e[4*d]=Math.round(255*Math.random()),e[4*d+1]=Math.round(255*Math.random()),e[4*d+2]=Math.round(255*Math.random()),e[4*d+3]=255):e[d]=[Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random()),255];return e}}})},"esri/renderers/colorUtils":function(){define(["dojo/_base/Color",
"dojo/_base/array"],function(A,q){var a={COEF_RGB2XYZ:[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],COEF_XYZ2RGB:[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]],matrixProduct:function(g,h){var e=[],b,c;if(g[0].length!==h.length)throw"dimensions do not match";var l=g.length,k=g[0].length,f=0;for(b=0;b<l;b++){for(c=f=0;c<k;c++)f+=g[b][c]*h[c];e.push(f)}return e},rgb2xyz:function(g){g=[g.r/255,g.g/255,g.b/255].map(function(h){return.04045>=h?h/12.92:Math.pow((h+.055)/
1.055,2.4)});g=this.matrixProduct(this.COEF_RGB2XYZ,g);return{x:100*g[0],y:100*g[1],z:100*g[2]}},xyz2rgb:function(g){g=this.matrixProduct(this.COEF_XYZ2RGB,[g.x/100,g.y/100,g.z/100]).map(function(h){return Math.min(1,Math.max(.0031308>=h?12.92*h:1.055*Math.pow(h,1/2.4)-.055,0))});return{r:Math.round(255*g[0]),g:Math.round(255*g[1]),b:Math.round(255*g[2])}},xyz2lab:function(g){g=[g.x/95.047,g.y/100,g.z/108.883].map(function(h){return h>Math.pow(6/29,3)?Math.pow(h,1/3):1/3*Math.pow(29/6,2)*h+4/29});
return{l:116*g[1]-16,a:500*(g[0]-g[1]),b:200*(g[1]-g[2])}},lab2xyz:function(g){var h=g.l;g=[(h+16)/116+g.a/500,(h+16)/116,(h+16)/116-g.b/200].map(function(e){return e>6/29?Math.pow(e,3):3*Math.pow(6/29,2)*(e-4/29)});return{x:95.047*g[0],y:100*g[1],z:108.883*g[2]}},lab2lch:function(g){var h=g.l,e=g.a,b=g.b;g=Math.sqrt(e*e+b*b);e=Math.atan2(b,e);e=0<e?e:e+2*Math.PI;return{l:h,c:g,h:e}},lch2lab:function(g){var h=g.c,e=g.h;return{l:g.l,a:h*Math.cos(e),b:h*Math.sin(e)}},rgb2lab:function(g){return this.xyz2lab(this.rgb2xyz(g))},
lab2rgb:function(g){return this.xyz2rgb(this.lab2xyz(g))},rgb2lch:function(g){return this.lab2lch(this.xyz2lab(this.rgb2xyz(g)))},lch2rgb:function(g){return this.xyz2rgb(this.lab2xyz(this.lch2lab(g)))}},d={rgb2hsv:function(g){var h=g.r,e=g.g;g=g.b;var b=Math.max(h,e,g),c=b-Math.min(h,e,g),l;0===c?l=0:b===h?l=(e-g)/c%6:b===e?l=(g-h)/c+2:b===g&&(l=(h-e)/c+4);0>l&&(l+=6);return{h:60*l,s:100*(0===c?0:c/b),v:100/255*b}},hsv2rgb:function(g){var h=(g.h+360)%360/60,e=g.v/100*255;g=g.s/100*e;var b=g*(1-Math.abs(h%
2-1));switch(Math.floor(h)){case 0:h={r:g,g:b,b:0};break;case 1:h={r:b,g:g,b:0};break;case 2:h={r:0,g:g,b:b};break;case 3:h={r:0,g:b,b:g};break;case 4:h={r:b,g:0,b:g};break;case 5:case 6:h={r:g,g:0,b:b};break;default:h={r:0,g:0,b:0}}h.r=Math.round(h.r+e-g);h.g=Math.round(h.g+e-g);h.b=Math.round(h.b+e-g);return h}};return{toRGB:function(g){var h;void 0!==g.r&&void 0!==g.g&&void 0!==g.b?h=g:void 0!==g.l&&void 0!==g.c&&void 0!==g.h?h=a.lch2rgb(g):void 0!==g.l&&void 0!==g.a&&void 0!==g.b?h=a.lab2rgb(g):
void 0!==g.x&&void 0!==g.y&&void 0!==g.z?h=a.xyz2rgb(g):void 0!==g.h&&void 0!==g.s&&void 0!==g.v&&(h=d.hsv2rgb(g));return h},toHSV:function(g){if(void 0!==g.h&&void 0!==g.s&&void 0!==g.v)return g;g=this.toRGB(g);return d.rgb2hsv(g)},toLAB:function(g){return void 0!==g.l&&void 0!==g.a&&void 0!==g.b?g:a.rgb2lab(this.toRGB(g))},toLCH:function(g){return void 0!==g.l&&void 0!==g.c&&void 0!==g.h?g:a.rgb2lch(this.toRGB(g))},toXYZ:function(g){return void 0!==g.x&&void 0!==g.y&&void 0!==g.z?g:a.rgb2xyz(this.toRGB(g))},
getDojoColor:function(g){if(g){if(Array.isArray(g))return A.fromArray(g);if(void 0!==g.r&&void 0!==g.g&&void 0!==g.b)return g}},correctRGBLimits:function(g){var h=[g.r,g.g,g.b];q.forEach(h,function(e,b){0>h[b]?h[b]=0:255<h[b]&&(h[b]=255);h[b]=Math.floor(h[b])});return{r:h[0],g:h[1],b:h[2],a:1}}}})},"esri/layers/rasterLib/function/rasterUtils":function(){define(["dojo/_base/lang"],function(A){return{mask:function(q,a){if(q&&q.pixels&&q.pixels.length){q=this._clonePixelBlock(q);var d=a.includedRanges,
g=a.noDataInterpretation;a=a.noDataValues;if(null===d&&null===a)return q;var h=q.pixels,e=q.mask,b=q.width*q.height,c=h.length,l;if(null!==a&&a.length!==c)throw"expect "+c+" elements in noDataValues";if(null!==d&&d.length!==2*c)throw"expect "+2*c+" elements in IncludeRanges";if(null==e){e=new Uint8Array(b);for(l=0;l<b;l++)e[l]=1;q.mask=e}if(0===g)for(g=0;g<c;g++){var k=h[g];var f=null===d?null:d[2*g];var m=null===d?null:d[2*g+1];var n=null===a?null:parseFloat(a[g]);if(null===f||null===m)for(l=0;l<
b;l++){if(e[l]){var p=k[l];p===n&&(e[l]=0)}}else if(null===n)for(l=0;l<b;l++)e[l]&&(p=k[l],p<f||p>m)&&(e[l]=0);else for(l=0;l<b;l++)e[l]&&(p=k[l],p<f||p>m||p===n)&&(e[l]=0)}else{var r=new Uint8Array(b);for(l=0;l<b;l++)r[l]=e[l];for(g=0;g<c;g++)if(k=h[g],f=null===d?null:d[2*g],m=null===d?null:d[2*g+1],n=null===a?null:parseFloat(a[g]),null===f||null===m)for(l=0;l<b;l++)r[l]&&(p=k[l],p!==n&&(r=0));else if(null===n)for(l=0;l<b;l++)r[l]&&(p=k[l],p<=f&&p<=m&&(r=0));else for(l=0;l<b;l++)r[l]&&(p=k[l],p<=
f&&p<=m&&p!==n&&(r=0));for(l=0;l<b;l++)e[l]&&r[l]&&(e[l]=0)}return q}},calculateStatisticsHistograms:function(q,a){q=this._clonePixelBlock(q);a=q.pixelType;var d=q.pixels,g=q.mask,h=d.length,e,b,c=[],l;for(e=0;e<h;e++){var k={min:-.5,max:255.5,size:256,counts:new Uint32Array(256)};var f=k.counts;var m=d[e];if("U8"===a)if(g)for(b=0;b<q.width*q.height;b++)g[b]&&f[m[b]]++;else for(b=0;b<q.width*q.height;b++)f[m[b]]++;else{var n=q.statistics[e].minValue;var p=q.statistics[e].maxValue;k.min=n;k.max=p;
p=(p-n)/256;var r=new Uint32Array(257);if(g)for(b=0;b<q.width*q.height;b++)g[b]&&r[Math.floor((m[b]-n)/p)]++;else for(b=0;b<q.width*q.height;b++)r[Math.floor((m[b]-n)/p)]++;for(b=0;255>b;b++)f[b]=r[b];f[255]=r[255]+r[256]}c.push(k);n=q.statistics[e].minValue;p=q.statistics[e].maxValue;for(b=r=l=m=0;b<k.size;b++)m+=f[b],l+=b*f[b];l/=m;for(b=0;b<k.size;b++)r+=f[b]*Math.pow(b-l,2);f=Math.sqrt(r/(m-1));b=(l+.5)*(k.max-k.min)/k.size+k.min;k=f*(k.max-k.min)/k.size;q.statistics[e]={min:n,minValue:n,max:p,
maxValue:p,mean:b,stddev:k}}q.histograms=c;return q},buildIndexedColormap:function(q,a){if(!q)return null;var d=0;0>q[0][0]&&(d=q[0][0]);var g=Math.max(256,q[q.length-1][0]-d);if(65536<g)return null;var h=new Uint8Array(4*g),e=[],b=0,c=5===q[0].length;if(a)for(e=q[b],a=e[0]-d;a<g;a++)h[4*a]=e[1],h[4*a+1]=e[2],h[4*a+2]=e[3],h[4*a+3]=c?e[4]:255,a===e[0]-d&&(e=b===q.length-1?e:q[++b]);else for(a=0;a<q.length;a++)e=q[a],b=4*(e[0]-d),h[b]=e[1],h[b+1]=e[2],h[b+2]=e[3],h[b+3]=c?e[4]:255;return{indexedColormap:h,
offset:d,alphaSpecified:c}},colorize:function(q,a){if(null!==q&&null!==q.pixels){q=this._clonePixelBlock(q);var d=q.pixels,g=q.width*q.height,h=q.mask,e=a.indexedColormap,b=a.indexedColormapOffset,c=e&&e.length-1,l=a.indexed2DColormap;a=a.alphaSpecified;if(3<=d.length)throw"colormap only works on single band image";var k=d[0],f=new Uint8Array(k.length),m=new Uint8Array(k.length),n=new Uint8Array(k.length),p=0;if(e)if(h)for(d=0;d<g;d++)h[d]&&(p=4*(k[d]-b),p<b||p>c?h[d]=0:(f[d]=e[p],m[d]=e[p+1],n[d]=
e[p+2],h[d]=e[p+3]));else{h=new Uint8Array(g);for(d=0;d<g;d++)p=4*(k[d]-b),p<b||p>c?h[d]=0:(f[d]=e[p],m[d]=e[p+1],n[d]=e[p+2],h[d]=e[p+3]);q.mask=h}else if(h)for(d=0;d<g;d++)h[d]&&(e=l[k[d]],f[d]=e[0],m[d]=e[1],n[d]=e[2],h[d]=e[3]);else{h=new Uint8Array(g);for(d=0;d<g;d++)e=l[k[d]],f[d]=e[0],m[d]=e[1],n[d]=e[2],h[d]=e[3];q.mask=h}q.pixels=[f,m,n];q.statistics=null;q.pixelType="U8";q.maskIsAlpha=a;return q}},convolute:function(q,a){q=this._clonePixelBlock(q);var d=q.pixels,g=q.width,h=q.height,e=g*
h,b=d.length,c,l,k,f,m=[],n=[],p=a.normalizedKernel,r=a.kernelRows,v=a.kernelCols;for(a=0;a<b;a++){var u=d[a];var t=new Float32Array(e);t.set(u);for(k=1;k<h-1;k++){var w=k*g;for(f=1;f<g-1;f++){for(c=n=0;c<r;c++)for(l=0;l<v;l++)n+=u[w+f+(c-1)*g+l-1]*p[c*v+l];t[w+f]=n}}m.push(t)}q.pixels=m;return q},contrastBrightnessStretch:function(q,a){if(null!==q&&null!==q.pixels){q=this._clonePixelBlock(q);var d=q.pixels,g=q.mask,h=q.width*q.height,e=d.length;var b=a&&a.contrastOffset;a=a&&a.brightnessOffset;if("U8"!==
q.pixelType)throw"the contrast and brightness function only supports 8 bit unsigned integer data";var c=this._createContrastBrightnessLUT(b,a);if(null==g)for(b=0;b<h;b++)for(a=0;a<e;a++)d[a][b]=c[d[a][b]];else for(b=0;b<h;b++)if(g[b])for(a=0;a<e;a++)d[a][b]=c[d[a][b]];q.pixelType="U8";return q}},isNull:function(q,a){if(null!==q&&null!==q.pixels){q=this._clonePixelBlock(q);a=q.mask;var d=q.pixels[0],g=d.length,h;if(a){for(h=0;h<g;h++)d[h]=a[h]?0:1;q.mask=null}else if(d.fill)d.fill(0);else for(h=0;h<
g;h++)d[h]=0;return q}},setNull:function(q){if(null!==a&&null!==a.pixels){var a=this._clonePixelBlock(q);q=a.mask;var d=a.pixels[0],g=d.length,h;q=q||new Uint8Array(g);for(h=0;h<g;h++)q[h]=d[h]?0:1;a.mask=q;return a}},local:function(q,a){if(!a)return q[0];var d=a.rasterCountNeeded;a=a.functor;var g=this._clonePixelBlock(q[0]);if(null!==g&&null!==g.pixels){var h=g.width*g.height,e;q=(e=q[1])&&e.pixels[0];var b=e&&e.mask,c=g.mask,l=g.pixels[0];if(2===d)if(!c&&b)c=b;else if(c&&b)for(e=0;e<h;e++)c[e]=
c[e]&&b[e]?1:0;g.mask=c;if(1===d)if(null==c)for(e=0;e<h;e++)l[e]=a(l[e]);else for(e=0;e<h;e++)c[e]&&(l[e]=a(l[e]));else if(2===d)if(null==c)for(e=0;e<h;e++)l[e]=a(l[e],q[e]);else for(e=0;e<h;e++)c[e]&&(l[e]=a(l[e],q[e]));g.mask=c;g.calculateStatistics();return g}},remapColor:function(q,a){q=this._clonePixelBlock(q);var d=q.width*q.height,g=a.length,h=Math.floor(g/2),e=a[Math.floor(h)],b=a[0].value,c=a[a.length-1].value,l=q.pixels[0],k,f,m=!1,n=new Uint8Array(d),p=new Uint8Array(d),r=new Uint8Array(d),
v=q.mask,u=4===a[0].mappedColor.length;v&&0!==v.length||(v=new Uint8Array(d),v.fill(u?255:1),q.mask=v);for(f=0;f<d;f++)if(v[f]){var t=l[f];if(t<b||t>c)n[f]=p[f]=r[f]=v[f]=0;else{m=!1;var w=h;var x=e;var y=0;for(k=g-1;1<k-y;){if(t===x.value){m=!0;break}t>x.value?y=w:k=w;w=Math.floor((y+k)/2);x=a[Math.floor(w)]}m||(x=t===a[k].value?a[k]:a[y]);n[f]=x.mappedColor[0];p[f]=x.mappedColor[1];r[f]=x.mappedColor[2];v[f]=x.mappedColor[3]}}q.pixels=[n,p,r];q.mask=v;q.pixelType="u8";q.maskIsAlpha=u;return q},
_clonePixelBlock:function(q){if(q.clone)return q.clone();var a=A.clone(q),d;if(q.pixels&&q.pixels[0]&&0<q.pixels[0].length&&!(a.pixels&&a.pixels[0]&&0<a.pixels[0].length)){a.pixels=[];var g=q.pixels.length;for(d=0;d<g;d++)a.pixels[d]=new q.pixels[d].constructor(q.pixels[d])}if(q.statistics)for(a.statistics=[],g=q.statistics.length,d=0;d<g;d++)a.statistics[d]=A.clone(q.statistics[d]);q.mask&&(a.mask=new Uint8Array(q.mask));return a},_createContrastBrightnessLUT:function(q,a){if(this._contrastCache&&
this._contrastCache.contrastOffset===q&&this._contrastCache.brightnessOffset===a)return this._contrastCache.lut;var d=Math.min(Math.max(q,-100),100),g=Math.min(Math.max(a,-100),100),h,e=new Uint8Array(256);for(h=0;256>h;h++){if(0<d&&100>d)var b=(200*h-25500+510*g)/(2*(100-d))+128;else 0>=d&&-100<d?b=(200*h-25500+510*g)*(100+d)/2E4+128:100===d?(b=200*h-25500+256*(100-d)+510*g,b=0<b?255:0):-100===d&&(b=128);e[h]=255<b?255:0>b?0:b}this._contrastCache={contrastOffset:q,brightnessOffset:a,lut:e};return e}}})},
"esri/layers/rasterLib/function/CompositeBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(A,q,a,d,g,h){return A([a,h],{declaredClass:"esri.layers.rasterLib.function.CompositeBandFunction",functionName:"CompositeBand",supportWebGL:!0,support2D:!0,constructor:function(e){this.functionArguments=this.mixinIgnoreCase({rasters:null},e)},bind:function(e){e=this.getSourceRasterInfo(e);if(!e.rasters)return Error("The rasters input to composite band function is invalid.");
var b=[],c=[],l=e.rasters.length,k;if(e.rasters[0].statistics)for(k=0;k<l;k++)b.push(e.rasters[k].statistics[0]);if(e.rasters[0].histograms)for(k=0;k<l;k++)c.push(e.rasters[k].histograms[0]);this.rasterInfo=q.mixin(e.rasters[0],{bandCount:l,pixelType:this._calculatePixelType(this.pixelType,e.rasters[0].pixelType),statistics:b,histograms:c});return!0},read2D:function(e){e=e.rasters;if(null!=e&&0!==e.length){var b=this._clonePixelData(e[0]),c=b.pixelBlock,l=[],k=[];for(f=0;f<e.length;f++)l.push(e[f].pixelBlock.pixels[0]),
k.push(e[f].pixelBlock.statistics[0]);c.pixels=l;c.stackedStatistics=k;c.planes=e.length;var f;k=c.width*c.height;for(f=0;f<e.length;f++)if(c=e[f].pixelBlock.mask,m&&c)for(l=0;l<k;l++)m[l]&=c[l];else var m=m||c;b.maks=m;return b}},readGL:function(e){this._performance.start();this._initializeProgram({fragment:g.compositeBand,fragmentName:"CompositeBand"});var b=e.rasters;if(null!=b&&0!==b.length){b=b.length;var c,l=this.bindFrameBuffer();for(c=0;c<b;c++){var k=this._setupTextureData(e.rasters[c],{notOriginal:0<
c});var f=0<c?c.toString():"";this._bindTexture(k.texture,"u_image"+f)}this._setUniforms({u_rasterCount:b});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:k.extent,texture:l.texture}}}})})},"esri/layers/rasterLib/function/ContrastBrightnessFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(A,q,a,d,g,h,e){return A([a,h],{declaredClass:"esri.layers.rasterLib.function.ContrastBrightnessFunction",
renderTexture:!0,functionName:"ContrastBrightness",supportWebGL:!0,support2D:!0,pixelType:"U8",constructor:function(b){this.functionArguments=this.mixinIgnoreCase({contrastOffset:0,brightnessOffset:0,raster:null},b)},bind:function(b){b=this.getSourceRasterInfo(b);if(!b.raster)return Error("The raster input to contrast and brightness function is invalid.");this.rasterInfo=q.mixin(b.raster,{bandCount:b.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});
this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Processed";return!0},read2D:function(b){b=b.raster;if(null!==b&&null!==b.pixelBlock&&null!==b.pixelBlock.pixels){var c=e.contrastBrightnessStretch(b.pixelBlock,{contrastOffset:this.functionArguments.contrastOffset,brightnessOffset:this.functionArguments.brightnessOffset});"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType,c.pixels=c.pixels.map(q.hitch(this,function(l){return this._clampBand(l,
c.pixelType)})));return{extent:b.extent,pixelBlock:c}}},readGL:function(b){return this._cbGL(b.raster)},_cbGL:function(b){this._performance.start();this._initializeProgram({fragment:g.contrastBrightness,fragmentName:"ContrastBrightness"});b=this._setupTextureData(b);this._setUniforms({u_contrastOffset:Math.min(Math.max(this.functionArguments.contrastOffset,-100),100),u_brightnessOffset:Math.min(Math.max(this.functionArguments.brightnessOffset,-100),100),u_scaleFactor:this.renderTexture?255:1});this._bindTexture(b.texture,
"u_image");var c=this.bindFrameBuffer();this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:b.extent,texture:c.texture}}})})},"esri/layers/rasterLib/function/ConvolutionFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./convolutionKernel ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(A,q,a,d,g,h,e,b){return A([a,e],{declaredClass:"esri.layers.rasterLib.function.ConvolutionFunction",functionName:"Convolution",
supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({columns:3,rows:3,type:0,kernel:null,raster:null},c)},bind:function(c){c=this.getSourceRasterInfo(c);if(!c.raster)return Error("The raster input to convolution function is invalid.");this.rasterInfo=q.mixin(c.raster,{bandCount:c.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,c.raster.pixelType),statistics:c.raster.statistics,histograms:c.raster.histograms});this.rasterInfo.keyProperties=
this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(c){this._performance.start();c=c.raster;var l=this._analyzeKernel(),k=b.convolute(c.pixelBlock,{normalizedKernel:l.normalizedKernel,kernelCols:this.functionArguments.columns,kernelRows:this.functionArguments.rows});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(k.pixelType=this.pixelType);k.pixels=k.pixels.map(q.hitch(this,function(f){return this._clampBand(f,
k.pixelType)}));return{extent:c.extent,pixelBlock:k}},readGL:function(c){this._performance.start();this._initializeProgram({fragment:h.convolution,fragmentName:"Convolution"});var l=this._setupTextureData(c.raster),k=this.bindFrameBuffer(),f=this.gl,m=f.drawingBufferWidth;f=f.drawingBufferHeight;var n=this.functionArguments.kernel;this._setUniforms({u_resolution:c&&c.raster&&c.raster.pixelBlock?[1/c.raster.pixelBlock.width,1/c.raster.pixelBlock.height]:[1/m,1/f],u_kernel:n,u_kernelSize:n.length});
this._bindTexture(l.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:l.extent,texture:k.texture}},_analyzeKernel:function(){var c=this.functionArguments.kernel,l=c.reduce(function(m,n){return m+n});0!==l&&1!==l&&(c=c.map(function(m){return m/l}));var k,f=[];for(k=0;k<c.length;k++)f.some(function(m){return m===c[k]})||f.push(c[k]);return{normalizedKernel:c,distinctValues:f}},_analyzeKernelPattern:function(){var c=this.functionArguments.rows,l=
this.functionArguments.columns,k=this.functionArguments.kernel,f=[],m,n;for(m=0;m<c;m++)f.push({weights:k.slice(m*l,(m+1)*l)});var p;for(m=1;m<c;m++){var r=f[m].weights;for(k=0;k<m;k++)if(p=f[k].weights){var v=r[0]/p[0];for(n=1;n<l;n++)r[n]/p[n]!==v&&(v=null);null!==v&&(f[m]={row:k,factor:v})}}return f}})})},"esri/layers/rasterLib/function/ExtractBandFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),
function(A,q,a,d,g,h){return A([a,h],{declaredClass:"esri.layers.rasterLib.function.ExtractBandFunction",functionName:"ExtractBand",supportWebGL:!0,support2D:!0,constructor:function(e){this.functionArguments=this.mixinIgnoreCase({bandIDs:[],missingBandAction:0,raster:null},e)},bind:function(e){e=this.getSourceRasterInfo(e);if(!e.raster)return Error("The raster input to extract band function is invalid.");var b=[],c=e.raster.statistics,l=[],k=e.raster.histograms,f=this.functionArguments.bandIDs.length||
e.raster.bandCount;this.functionArguments.bandIDs.forEach(q.hitch(this,function(m){if(m>=f-1){if(1===this.functionArguments.missingBandAction)return Error("missing band "+m);m=f-1}if(0>m)return Error("missing band "+m);void 0!==c&&null!==c&&0<c.length&&b.push(c[m]);void 0!==k&&null!==k&&0<k.length&&l.push(k[m])}));this.rasterInfo=q.mixin(e.raster,{bandCount:f,pixelType:this._calculatePixelType(this.pixelType,e.raster.pixelType),statistics:b,histograms:l});return!0},read2D:function(e){e=this._clonePixelData(e.raster);
if(null!==e&&null!==e.pixelBlock&&null!==e.pixelBlock.pixels){this._performance.start();var b=e.pixelBlock,c=b.statistics,l=b.pixels,k=l.length;if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(0===this.functionArguments.bandIDs.length)return e;var f=[],m=[];this.functionArguments.bandIDs.forEach(function(n){if(n>=k-1){if(1===this.functionArguments.missingBandAction)throw"missing band "+n;n=k-1}if(0>n)throw"missing band "+n;f.push(l[n]);void 0!==c&&null!==c&&0<c.length&&
m.push(c[n])});b.pixels=f;b.statistics=m;b.planes=this.functionArguments.bandIDs.length;return e}},readGL:function(e){this._performance.start();if(null==this.functionArguments.bandIDs)throw"missing bandIDs parameter";if(3<this.functionArguments.bandIDs.length)throw"this version does not support more than 3 bands yet";this._initializeProgram({fragment:g.extractBand,fragmentName:"ExtractBand"});var b=this.functionArguments.bandIDs;1===b.length&&(b=[b[0],b[0],b[0]]);this._bandIDs=b;this._alterBand=!(0===
this.functionArguments.bandIDs.length||0===b[0]&&1===b[1]&&2===b[2]);var c=!!(this._alterBand&&e.raster&&e.raster.texture);e=this._setupTextureData(e.raster,{bandIDs:b});var l=this.bindFrameBuffer();c?this._setUniforms({u_bandIDs:b,u_alterBand:this._alterBand}):this._setUniforms({u_bandIDs:b,u_alterBand:!1});this._bindTexture(e.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:e.extent,texture:l.texture}}})})},"esri/layers/rasterLib/function/HillshadeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../renderers/colorRampGenerator ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils ./rasterUtils".split(" "),
function(A,q,a,d,g,h,e,b,c,l){return A([a,b],{declaredClass:"esri.layers.rasterLib.function.HillshadeFunction",functionName:"Hillshade",supportWebGL:!0,support2D:!0,renderTexture:!0,constructor:function(k){this.functionArguments=this.mixinIgnoreCase({hillshadeType:0,altitude:45,azimuth:315,zFactor:1,slopeType:1,psPower:.664,psFactor:.024,colorRamp:null,raster:null},k);this._azimuths=[315,270,225,360,180,0];this._altitudes=[60,60,60,60,60,90];this._weights=[3,5,3,2,1,4];var f=this._weights.reduce(function(m,
n){return m+n});this._weights=this._weights.map(function(m){return m/f})},bind:function(k){k=this.getSourceRasterInfo(k);if(!k.raster)return Error("The raster input to hillshade function is invalid.");k.raster.statistics&&(this.srcStatistics=k.raster.statistics);this.rasterInfo=q.mixin(k.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:[{min:0,max:255}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=
"Generic";this._initializeColormap();return!0},read2D:function(k){this._performance.start();k=k.raster;k=c.hillshade(k,{altitude:this.functionArguments.altitude,azimuth:this.functionArguments.azimuth,zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,hillshadeType:this.functionArguments.hillshadeType,slopeType:this.functionArguments.slopeType,isGCS:k.extent.spatialReference.wkid&&null==g[k.extent.spatialReference.wkid]});this._addPerformanceMetric(this._performance.elapsed());
return k},readGL:function(k){this._performance.start();this._initializeProgram({fragment:e.hillshade,fragmentName:"Hillshade"});this.functionArguments.colorRamp&&this._indexedColormap&&!this._clrTexture&&(this._clrTexture=this._setupColormapTexture(this._indexedColormap));var f=this._setupTextureData(k.raster),m=this.bindFrameBuffer(),n=this.gl,p=n.drawingBufferWidth;n=n.drawingBufferHeight;var r=f.extent,v=(r.xmax-r.xmin)/p,u=(r.ymax-r.ymin)/n,t=this.functionArguments.altitude,w=this.functionArguments.azimuth,
x=this.functionArguments.zFactor;1===this.functionArguments.hillshadeType&&(x*=2);var y=x/(8*v),z=x/(8*u);.001<x&&r.spatialReference.wkid&&null==g[r.spatialReference.wkid]&&(y/=111E3,z/=111E3);var B=this.functionArguments.psPower,F=this.functionArguments.psFactor;3===this.functionArguments.slopeType&&((y=r.spatialReference.wkid&&null==g[r.spatialReference.wkid])?(y=111E3*v,z=111E3*u,y=(x+Math.pow(y,B)*F)/(8*y),z=(x+Math.pow(z,B)*F)/(8*z)):(y=(x+Math.pow(v,B)*F)/(8*v),z=(x+Math.pow(u,B)*F)/(8*u)));
var D=(90-t)*Math.PI/180;t=Math.cos(D);var C=(360-w+90)*Math.PI/180;w=Math.sin(D)*Math.cos(C);D=Math.sin(D)*Math.sin(C);B=Array(6);F=Array(6);r=Array(6);var E=this._weights,G;if(1===this.functionArguments.hillshadeType){var H=this._azimuths.length;for(G=0;G<H;G++)t=this._altitudes[G],w=this._azimuths[G],D=(90-t)*Math.PI/180,t=Math.cos(D),C=(360-w+90)*Math.PI/180,w=Math.sin(D)*Math.cos(C),D=Math.sin(D)*Math.sin(C),B[G]=t,F[G]=w,r[G]=D}else B[0]=t,F[0]=w,r[0]=D;B=B.map(function(K){return parseFloat(K)});
F=F.map(function(K){return parseFloat(K)});r=r.map(function(K){return parseFloat(K)});this._setUniforms({u_cellSize:[v,u],u_zfactor:x,u_xFactor:y,u_yFactor:z,u_sinZcosA:w,u_sinZsinA:D,u_cosZ:t,u_sinZcosAs:F,u_sinZsinAs:r,u_cosZs:B,u_weights:E,u_hillshadeType:this.functionArguments.hillshadeType,u_resolution:k&&k.raster&&k.raster.pixelBlock?[1/k.raster.pixelBlock.width,1/k.raster.pixelBlock.height]:[1/p,1/n],u_scaled:!this.renderTexture,u_applyColorramp:this._clrTexture?!0:!1,u_minValue:this.srcStatistics[0].min,
u_maxValue:this.srcStatistics[0].max,u_indexedColormapOffset:this._indexedColormapOffset||0,u_indexedColormapMaxIndex:this._indexedColormap?this._indexedColormap.length/4-1:0});this._clrTexture&&this._bindTexture(this._clrTexture,"u_image1");this._bindTexture(f.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:f.extent,texture:m.texture}},_initializeColormap:function(){this._indexedColormapOffset=0;var k=this._indexedColormap,f=this.functionArguments.colorRamp;
this.functionArguments.colormap?(this._alphaSpecified=(f=l.buildIndexedColormap(this.functionArguments.colormap))&&f.alphaSpecified,this._indexedColormap=f&&f.indexedColormap,this._indexedColormapOffset=f&&f.offset):f?(this._indexedColormap="multipart"===f.type?this.invert?d.createMultiPartColorRamp(this._invertColorRamp(f)):d.createMultiPartColorRamp(f):this.invert?d.createAlgorithmicColorRamp(this._invertColorRamp(f)):d.createAlgorithmicColorRamp(f),f.fromColor&&f.toColor&&"000"===f.fromColor.slice(0,
3).join("")&&"255255255"===f.toColor.slice(0,3).join("")&&(this._clrTexture=this._indexedColormap=null)):this.functionArguments.colormapName?"random"===this.functionArguments.colormapName.toLowerCase()&&(this._indexedColormap=d.createRandomColorRamp()):this._clrTexture=this._indexedColormap=null;if(k&&this._indexedColormap){f=!0;for(var m=0;m<k.length;m++)if(k[m]!==this._indexedColormap[m]){f=!1;break}f||(this._clrTexture=null)}},_setupColormapTexture:function(k){var f=this._createTexture(),m=this.gl,
n=k.length/4,p=new Float32Array(k.length),r;for(r=0;r<k.length;r++)p[r]=k[r]/255;m.getExtension("OES_texture_float");m.texImage2D(m.TEXTURE_2D,0,m.RGBA,n,1,0,m.RGBA,m.FLOAT,p);return f}})})},"esri/layers/rasterLib/function/LocalFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(A,q,a,d,g,h,e){return A([a,h],{declaredClass:"esri.layers.rasterLib.function.LocalFunction",functionName:"Local",
supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=this.mixinIgnoreCase({operation:null,rasters:null},b)},bind:function(b){b=this.getSourceRasterInfo(b);var c=0;b.raster?c=b.raster.bandCount:b.rasters&&(c=Math.max.apply(null,b.rasters.map(function(l){return l.bandCount})));if(0===c)return Error("The raster input to local function is invalid. It only takes single band input.");b=b.raster||b.rasters.filter(function(l){return!!l.extent})[0];this.rasterInfo=q.mixin(b,{bandCount:1,
pixelType:this._calculatePixelType(this.pixelType,"F32"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(b){var c=[];c=b.raster?b.raster2?[b.raster,b.raster2]:[b.raster]:b.rasters;b=c.map(function(n){return n.pixelBlock});var l=this.functionArguments.operation;if(null===l)return c[0];this._performance.start();var k=this._getOperations(),f=k.operators[l-1];k=k.functors[l-1];
if(!this.functionArguments.rasters){if(1!==f)throw"no sufficient rasters, require "+f;}else if(999!==f&&this.functionArguments.rasters.length!==f)throw"number of rasters does not meet (short or exceed) the operation requirment, require "+f;var m=31===l?e.isNull(b[0]):50===l?e.setNull(b[0]):e.local(b,{rasterCountNeeded:f,functor:k});"Unknown"!==this.pixelType&&(m.pixelType=this.pixelType,m.pixels=m.pixels.map(q.hitch(this,function(n){return this._clampBand(n,m.pixelType)})));m.statistics||m.calculateStatistics();
return{extent:c[0].extent,pixelBlock:m}},readGL:function(b){this._performance.start();var c=this.functionArguments.operation,l=this._getWebGLOperations(),k=l.operators[c-1],f=g.local;l="result\x3d"+l.functors[c-1]+";";31!==c&&50!==c&&(l+="result \x3d vec4(result.rgb, a.a);");f=f.replace("vec4 replaceme"+k+";",l);l=this.gl.getParameter(this.gl.VERSION);var m="";if(-1<l.toLowerCase().indexOf("webgl 1.0")||-1<l.toLowerCase().indexOf("webgl 0."))m=this._getPolyfill(c);f=f.replace("vec4 polyfill;",m);
1<k&&(f=f.replace("gl_FragColor \x3d localOp1();","gl_FragColor \x3d localOp1();".replace("1",k.toString())));this._initializeProgram({fragment:f,fragmentName:"Local"});c=b.rasters;if(null!=c&&0!==c.length){c=c.length;l=this.bindFrameBuffer();for(k=0;k<c;k++){f=0<k?k.toString():"";var n=this._setupTextureData(b.rasters[k],{reCreate:!0});this._bindTexture(n.texture,"u_image"+f)}this._setUniforms({});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:n.extent,texture:l.texture}}},
_getOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:[function(b,c){return b+c},function(b,c){return b-c},function(b,c){return b*c},function(b){return Math.sqrt(b)},function(b,c){return Math.pow(b,c)},function(b){return Math.acos(b)},function(b){return Math.asin(b)},function(b){return Math.atan(b)},function(b){return Math.atanh(b)},
function(b){return Math.abs(b)},function(b,c){return b&c},function(b,c){return b<<c},function(b){return~b},function(b,c){return b|c},function(b,c){return b>>c},function(b,c){return b^c},function(b,c){return b&&c},function(b){return!b},function(b,c){return b||c},function(b,c){return b!=c},function(b){return Math.cos(b)},function(b,c){return Math.cosh(b)},function(b,c){return b/c},function(b,c){return b==c},function(b){return Math.exp(b)},function(b){return Math.pow(10,b)},function(b){return Math.pow(2,
b)},function(b,c){return b>c?1:0},function(b,c){return b>=c?1:0},function(b,c){return Math.floor(b)},function(b){return!b},function(b){return b},function(b,c){return b<c?1:0},function(b,c){return b<=c?1:0},function(b){return Math.log(b)},function(b,c){return Math.log10(b)},function(b,c){return Math.log2(b)},999,999,999,999,999,999,function(b,c){return b%c},function(b){return-b},function(b,c){return b!=c?1:0},999,function(b,c){return Math.floor(b)},function(b,c){return Math.ceil(b)},function(b,c){return c?
0:b},function(b,c){return Math.sin(b)},function(b,c){return Math.sinh(b)},function(b,c){return b*b},999,999,function(b){return Math.tan(b)},function(b){return Math.tanh(b)},999,function(b){return Math.acosh(b)},function(b){return Math.asinh(b)},function(b,c){return Math.atan2(b,c)},function(b,c){return b/c},function(b,c){return Math.floor(b/c)},999,999,999,999,999,999,999,999,999,999,function(b,c,l){return b?c:l}]}},_polyfill:{sinh:"vec4 sinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp - 1.0/halfexp;\n}",
asinh:"vec4 asinh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp - 1.0/halfexp);\n}",cosh:"vec4 cosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn halfexp + 1.0/halfexp;\n}",acosh:"vec4 acosh(vec4 x) {\nvec4 halfexp \x3d exp(x)/2.0;\nreturn 1.0/(halfexp + 1.0/halfexp);\n}",tanh:"vec4 tanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx - 1.0/expx)/(expx + 1.0/expx);\n}",atanh:"vec4 atanh(vec4 x) {\nvec4 expx \x3d exp(x);\nreturn (expx + 1.0/expx)/(expx - 1.0/expx);\n}"},_getPolyfill:function(b){var c=
"";switch(b){case 9:c=this._polyfill.atanh;break;case 22:c=this._polyfill.cosh;break;case 52:c=this._polyfill.sinh;break;case 57:c=this._polyfill.tanh;break;case 59:c=this._polyfill.acosh;break;case 60:c=this._polyfill.asinh}return c},_getWebGLOperations:function(){return{operators:[2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,1,1,1,1,999,999,1,1,999,1,1,2,2,2,999,999,999,999,999,999,999,999,999,999,3],functors:["(a + b)","(a - b)",
"(a * b)","sqrt(a)","pow(a, b)","acos(a)","asin(a)","atan(a)","atanh(a)","abs(a)","a","a","a","a","a","a","(a.r\x3d\x3d0.0 || b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","a.r\x3d\x3d0.0?vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","(a.r\x3d\x3d0.0 \x26\x26 b.r\x3d\x3d0.0) ? vec4(0.0,0.0,0.0,a.a) : vec4(1.0,1.0,1.0,a.a)","(a.r\x3d\x3d0.0 ^^ b.r\x3d\x3d0.0) ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","cos(a)","cosh(a)","a / b","a.r \x3d\x3d b.r? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
"exp(a)","pow(10.0, a)","pow(2.0, a)","a.r \x3e b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3e\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","floor(a)","a.a \x3d\x3d 0.0? vec4(1.0,1.0,1.0,1.0) : vec4(0.0,0.0,0.0,1.0)","a","a.r \x3c b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","a.r \x3c\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)","log(a)","log2(a) / log2(10.0)","log2(a)",999,999,999,999,999,999,"mod(a, b)","-a","a.r !\x3d b.r ? vec4(1.0,1.0,1.0,a.a) : vec4(0.0,0.0,0.0,a.a)",
999,"floor(a)","ceil(a)","a.r !\x3d 0.0 ? vec4(0.0,0.0,0.0,0.0) : a","sin(a)","sinh(a)","a * a",999,999,"tan(a)","tanh(a)",999,"acosh(a)","asinh(a)","atan(a, b)","a / b","floor(a / b)",999,999,999,999,999,999,999,999,999,999,"a.r!\x3d0 ? b : c"]}}})})},"esri/layers/rasterLib/function/MaskFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),function(A,q,a,d,g,h,e){return A([a,h],{declaredClass:"esri.layers.rasterLib.function.MaskFunction",
functionName:"Mask",supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=this.mixinIgnoreCase({includedRanges:null,noDataInterpretation:0,noDataValues:null,raster:null},b)},bind:function(b){b=this.getSourceRasterInfo(b);if(!b.raster)return Error("The raster input to mask function is invalid.");this.rasterInfo=q.mixin(b.raster,{bandCount:b.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,b.raster.pixelType),statistics:b.raster.statistics,histograms:b.raster.histograms});
return!0},read2D:function(b){this._performance.start();b=b.raster;var c=e.mask(b.pixelBlock,{includedRanges:this.functionArguments.includedRanges,noDataInterpretation:this.functionArguments.noDataInterpretation,noDataValues:this.functionArguments.noDataValues});this._addPerformanceMetric(this._performance.elapsed());"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);return{extent:b.extent,pixelBlock:c}},readGL:function(b){this._performance.start();this._initializeProgram({fragment:g.mask,fragmentName:"Mask"});
b=this._setupTextureData(b.raster);var c=this.bindFrameBuffer(),l=this.functionArguments.includedRanges,k=this.functionArguments.noDataValues?this.functionArguments.noDataValues.map(function(f){return parseFloat(f,10)}):null;this._setUniforms({u_includedRanges:l,u_includedRanges_specified:l?!0:!1,u_noDataValues:k,u_noDataValues_specified:k?!0:!1,u_noDataInterpretation:this.functionArguments.noDataInterpretation,u_bandCount:Math.min(this.sourceRasterInfo.raster.bandCount,3)});this._bindTexture(b.texture,
"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:b.extent,texture:c.texture}}})})},"esri/layers/rasterLib/function/NDVIFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./rasterIndex".split(" "),function(A,q,a,d,g,h,e){return A([a,h],{declaredClass:"esri.layers.rasterLib.function.NDVIFunction",functionName:"NDVI",supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=
this.mixinIgnoreCase({visibleBandID:1,infraredBandID:2,scaled:!0,raster:null},b)},bind:function(b){b=this.getSourceRasterInfo(b);if(!(b.raster&&1<b.raster.bandCount))return Error("The raster input to ndvi function is invalid. It requires more than 1 band.");this.rasterInfo=q.mixin(b.raster,{bandCount:1,pixelType:this._calculatePixelType(this.pixelType,this.scaled?"U8":"F32"),statistics:this.scaled?[{min:0,max:200}]:[{min:-1,max:1}],histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||
{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(b){this._performance.start();b=b.raster;var c=e.calculate(b.pixelBlock,{bandIndexes:[this.functionArguments.infraredBandID+1,this.functionArguments.visibleBandID+1].join(" "),method:1}),l;if(this.functionArguments.scaled){var k=c.pixels[0];var f=c.mask;var m=k.length;var n=new Uint8Array(m);if(null==f)for(l=0;l<m;l++)n[l]=100*k[l]+100&255;else for(l=0;l<m;l++)f[l]&&(n[l]=100*k[l]+100&255);c.pixels[0]=n;c.pixelType="U8"}this._addPerformanceMetric(this._performance.elapsed());
"Unknown"!==this.pixelType&&(c.pixelType=this.pixelType);return{extent:b.extent,pixelBlock:c}},readGL:function(b){this._performance.start();this._initializeProgram({fragment:g.ndvi,fragmentName:"NDVI"});var c=this.functionArguments.visibleBandID,l=this.functionArguments.infraredBandID,k=this.functionArguments.scaled||!1;this._alterBand=2<Math.max(l,c)?!0:!1;b=this._setupTextureData(b.raster,{bandIDs:this._alterBand?{bandIDs:[l,c,l]}:null});var f=this.bindFrameBuffer();this._alterBand?this._setUniforms({u_bandId_nir:0,
u_bandId_red:1,u_scaled:k}):this._setUniforms({u_bandId_nir:l,u_bandId_red:c,u_scaled:k});this._bindTexture(b.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:b.extent,texture:f.texture}}})})},"esri/layers/rasterLib/function/SlopeFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../../WKIDUnitConversion ../../PixelBlock ./pixelShaders ./RasterFunctionWebGLMixin ./surfaceUtils".split(" "),function(A,q,a,d,g,h,
e,b){return A([a,e],{declaredClass:"esri.layers.rasterLib.function.SlopeFunction",functionName:"Slope",supportWebGL:!0,support2D:!0,constructor:function(c){this.functionArguments=this.mixinIgnoreCase({zFactor:1,slopeType:1,psPower:.664,psFactor:.024,raster:null},c)},bind:function(c){c=this.getSourceRasterInfo(c);if(!c.raster)return Error("The raster input to slope function is invalid.");this.rasterInfo=q.mixin(c.raster,{bandCount:1,pixelType:this._calculatePixelType(this.outputPixelType,"F32"),statistics:1===
this.slopeType||3===this.slopeType?[{min:0,max:90}]:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(c){this._performance.start();c=c.raster;c=b.slope(c,{zFactor:this.functionArguments.zFactor,psPower:this.functionArguments.psPower,psFactor:this.functionArguments.psFactor,slopeType:this.functionArguments.slopeType,isGCS:c.extent.spatialReference.wkid&&null==d[c.extent.spatialReference.wkid]});
this._addPerformanceMetric(this._performance.elapsed());return c},readGL:function(c){this._performance.start();this._initializeProgram({fragment:h.slope,fragmentName:"Slope"});var l=this._setupTextureData(c.raster),k=this.bindFrameBuffer(),f=this.gl,m=f.drawingBufferWidth;f=f.drawingBufferHeight;var n=l.extent;this._setUniforms({u_resolution:c&&c.raster&&c.raster.pixelBlock?[1/c.raster.pixelBlock.width,1/c.raster.pixelBlock.height]:[1/m,1/f],u_cellSize:[(n.xmax-n.xmin)/m,(n.ymax-n.ymin)/f],u_zfactor:this.functionArguments.zFactor});
this._bindTexture(l.texture,"u_image");this._drawGL();this._addPerformanceMetric(this._performance.elapsed());return{extent:l.extent,texture:k.texture}}})})},"esri/layers/rasterLib/function/StretchFunction":function(){define("dojo/_base/declare dojo/_base/lang ./RasterFunctionX ../../PixelBlock ./vertexShaders ./pixelShaders ./RasterFunctionWebGLMixin".split(" "),function(A,q,a,d,g,h,e){return A([a,e],{declaredClass:"esri.layers.rasterLib.function.StretchFunction",functionName:"Stretch",supportWebGL:!0,
support2D:!0,constructor:function(b){this.functionArguments=this.mixinIgnoreCase({stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,raster:null,computeGamma:!1},b);this.functionArguments.statistics=this._convertStats(this.functionArguments.statistics);-1===[0,3,5,6].indexOf(this.functionArguments.stretchType)&&(console.error("The specific stretch type has not been implemented: "+this.functionArguments.stretchType),
this.functionArguments.stretchType=5);this.min=null==this.min?0:this.min;this.max=null==this.max?255:this.max},bind:function(b){b=this.getSourceRasterInfo(b);if(!b.raster)return Error("The raster input to stretch function is invalid.");b.raster.statistics&&(this.srcStatistics=this._convertStats(b.raster.statistics));b.raster.histograms&&(this.srcHistograms=b.raster.histograms);this.rasterInfo=q.mixin({},b.raster,{bandCount:b.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,"U8"),
statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType="Generic";return!0},read2D:function(b){b=b.raster;this._stretch(b);return b},hasTilingEffects:function(b){b=b||this.functionArguments;return!!(b.dra||b.raster&&"object"===typeof b.raster&&b.raster.dra)},_convertStats:function(b){return b?b.map(function(c){return c&&null!=c.min?[c.min,c.max,c.mean,c.stddev]:c}):null},_updateStatistisHistograms:function(b){var c=this.functionArguments,
l=c.histograms||this.srcHistograms;if(b&&b.pixelBlock&&b.pixelBlock.pixels){if(0===c.stretchType)this._statistics=c.statistics&&0<c.statistics.length?c.statistics:this.srcStatistics,this._histograms=l;else{var k=b.pixelBlock,f=k.pixels.length,m=6===c.stretchType&&(c.dra||!l)||3===c.stretchType&&c.dra;m&&(k.statistics||k.calculateStatistics(),this._calculateStatisticsHistograms(b));if(c.dra)if(k.statistics||k.calculateStatistics(),m)this._statistics=k.statistics,this._histograms=k.histograms;else for(c=
k.statistics,this._statistics=[],b=0;b<f;b++)this._statistics[b]=[c[b].minValue,c[b].maxValue,0,0];else this._statistics=c.statistics&&0<c.statistics.length?c.statistics:this.srcStatistics,this._histograms=l}this._statistics=this._convertStats(this._statistics);this._gammaCorrection=this._getGammaCorrection()}else this._statistics=c.statistics&&0<c.statistics.length?c.statistics:this.srcStatistics,this._histograms=l,this._gammaCorrection=this._getGammaCorrection(),this._statistics=this._convertStats(this._statistics)},
_getGammaCorrection:function(){var b=this.functionArguments.gamma;if(b){var c=[],l;for(l=0;l<b.length;l++)c[l]=1<b[l]?2<b[l]?6.5+Math.pow(b[l]-2,2.5):6.5+100*Math.pow(2-b[l],4):1;return c}},_stretch:function(b){if(null!==b&&null!==b.pixelBlock&&null!==b.pixelBlock.pixels&&0!==this.functionArguments.stretchType){this._updateStatistisHistograms(b);var c=b.pixelBlock,l=c.pixels;c=c.width*c.height;var k=l.length,f,m;this._createLUT(b);if(null==this.LUT)return this._filterNoLUT(b);var n=this.LUT,p=this.LUTOffset;
for(f=0;f<k;f++){var r=n[f];for(m=0;m<c;m++){var v=l[f][m];l[f][m]=r[v-p]}}b.pixelBlock.pixelType="U8"}},_calculateStatisticsHistograms:function(b){b=b.pixelBlock;var c=b.pixelType,l=b.pixels,k=b.mask,f=l.length,m,n,p=function(F){this.min=-.5;this.max=255.5;this.size=256;q.mixin(this,F);this.counts=this.counts||new Uint32Array(this.size)},r=[],v,u;for(m=0;m<f;m++){var t=new p;var w=t.counts;var x=l[m];if("U8"===c)if(k)for(n=0;n<b.width*b.height;n++)k[n]&&w[x[n]]++;else for(n=0;n<b.width*b.height;n++)w[x[n]]++;
else{var y=b.statistics[m].minValue;var z=b.statistics[m].maxValue;t.min=y;t.max=z;z=(z-y)/256;var B=new Uint32Array(257);if(k)for(n=0;n<b.width*b.height;n++)k[n]&&B[Math.floor((x[n]-y)/z)]++;else for(n=0;n<b.width*b.height;n++)B[Math.floor((x[n]-y)/z)]++;for(n=0;255>n;n++)w[n]=B[n];w[255]=B[255]+B[256]}r.push(t);x=[];y=b.statistics[m].minValue;z=b.statistics[m].maxValue;for(n=u=v=B=0;n<t.size;n++)B+=w[n],v+=n*w[n];v/=B;for(n=0;n<t.size;n++)u+=w[n]*Math.pow(n-v,2);w=Math.sqrt(u/(B-1));n=(v+.5)*(t.max-
t.min)/t.size+t.min;t=w*(t.max-t.min)/t.size;x.push(y);x.push(z);x.push(n);x.push(t);b.statistics[m]={min:y,minValue:y,max:z,maxValue:z,mean:n,stddev:t}}b.histograms=r},_getCutOffPoints:function(b){var c=this.functionArguments,l=999;b&&b.pixelBlock?l=b.pixelBlock.pixels.length:b&&b.texture&&(l=3);b=Math.min(l,this._statistics.length);var k=[],f=[],m,n;switch(c.stretchType){case 5:for(m=0;m<b;m++)k[m]=this._statistics[m][0],f[m]=this._statistics[m][1];break;case 3:for(m=0;m<b;m++)k[m]=this._statistics[m][2]-
c.numberOfStandardDeviations*this._statistics[m][3],f[m]=this._statistics[m][2]+c.numberOfStandardDeviations*this._statistics[m][3],k[m]<this._statistics[m][0]&&(k[m]=this._statistics[m][0]),f[m]>this._statistics[m][1]&&(f[m]=this._statistics[m][1]);break;case 6:for(m=0;m<b;m++){l=this._histograms[m];var p=new Uint32Array(l.size);var r=l.counts;var v=0;var u=-.5===l.min&&1===(l.max-l.min)/r?.5:0;for(n=0;n<l.size;n++)v+=r[n],p[n]=v;r=c.minPercent*v/100;for(n=0;n<l.size;n++)if(p[n]>r){k[m]=l.min+(l.max-
l.min)/l.size*(n+u);break}r=(1-c.maxPercent/100)*v;for(n=l.size-2;0<=n;n--)if(p[n]<r){f[m]=l.min+(l.max-l.min)/l.size*(n+2-u);break}}break;default:for(m=0;m<l;m++)k[m]=0,f[m]=255}return{minCutOff:k,maxCutOff:f}},_createLUT:function(b){var c=this.functionArguments,l=b.pixelBlock,k=l.pixelType;if("U8"===k||"U16"===k||"S8"===k||"S16"===k){if(this._LUTSignature&&(k=this._computeLutSignature(),k.length===this._LUTSignature.length&&!k.some(function(D,C){return D!==this._LUTSignature[C]}.bind(this))))return;
k=l.pixels.length;var f=[],m=[],n=c.max,p=c.min,r=c.gamma,v=n-p,u=this._getCutOffPoints(b);b=u.minCutOff;u=u.maxCutOff;var t=0,w=256;"S8"===l.pixelType?t=-127:"S16"===l.pixelType&&(t=-32767);if("U16"===l.pixelType||"S16"===l.pixelType)w=65536;for(l=0;l<k;l++)f[l]=u[l]-b[l];var x=this._gammaCorrection;if(c.useGamma)for(l=0;l<k;l++){var y=[];for(c=0;c<w;c++){var z=c+t;var B=(z-b[l])/f[l];var F=1;1<r[l]&&(F-=Math.pow(1/v,B*x[l]));z<u[l]&&z>b[l]?y[c]=Math.floor(F*v*Math.pow(B,1/r[l]))+p:z>u[l]?y[c]=n:
z<b[l]&&(y[c]=p)}m[l]=y}else for(l=0;l<k;l++){y=[];for(c=0;c<w;c++)z=c+t,y[c]=z<b[l]?p:z>u[l]?n:Math.floor((z-b[l])/f[l]*v)+p;m[l]=y}this.LUT=m;this.LUTOffset=t;this._LUTSignature=this._computeLutSignature()}},_computeLutSignature:function(){var b=this.functionArguments,c=[],l,k;c.push(b.stretchType);c.push(b.min);c.push(b.max);c.push(b.numberOfStandardDeviations);if(this._statistics)for(l=0;l<this._statistics.length;l++)for(k=0;k<this._statistics[l].length;k++)c.push(this._statistics[l][k]);c.push(b.dra?
1:0);c.push(b.minPercent);c.push(b.maxPercent);if(b.gamma)for(l=0;l<this._statistics.length;l++)c.push(b.gamma[l]);c.push(b.useGamma?1:0);return c},_filterNoLUT:function(b){if(null!==b&&null!==b.pixelBlock&&null!==b.pixelBlock.pixels){var c=this.functionArguments,l=b.pixelBlock,k=l.pixels,f=l.mask;l=l.width*l.height;var m=k.length,n=[],p=[],r=c.max,v=c.min,u=c.gamma,t=r-v;var w=this._getCutOffPoints(b);var x=w.minCutOff,y=w.maxCutOff;for(w=0;w<m;w++)n[w]=y[w]-x[w];if(c.useGamma&&null!==u&&u.length>=
m)for(w=0;w<m;w++)p[w]=1<u[w]?2<u[w]?6.5+Math.pow(u[w]-2,2.5):6.5+100*Math.pow(2-u[w],4):1;if(c.useGamma)if(void 0!==f&&null!==f)for(c=0;c<l;c++){if(f[c])for(w=0;w<m;w++){var z=k[w][c];var B=(z-x[w])/n[w];var F=1;1<u[w]&&(F-=Math.pow(1/t,B*p[w]));z<y[w]&&z>x[w]?k[w][c]=Math.floor(F*t*Math.pow(B,1/u[w]))+v:z>y[w]?k[w][c]=r:z<x[w]&&(k[w][c]=v)}}else for(c=0;c<l;c++)for(w=0;w<m;w++)z=k[w][c],B=(z-x[w])/n[w],F=1,1<u[w]&&(F-=Math.pow(1/t,B*p[w])),z<y[w]&&z>x[w]?k[w][c]=Math.floor(F*t*Math.pow(B,1/u[w]))+
v:z>y[w]?k[w][c]=r:z<x[w]&&(k[w][c]=v);else if(void 0!==f&&null!==f)for(c=0;c<l;c++){if(f[c])for(w=0;w<m;w++)z=k[w][c],z<y[w]&&z>x[w]?k[w][c]=Math.floor((z-x[w])/n[w]*t)+v:z>y[w]?k[w][c]=r:z<x[w]&&(k[w][c]=v)}else for(c=0;c<l;c++)for(w=0;w<m;w++)z=k[w][c],z<y[w]&&z>x[w]?k[w][c]=Math.floor((z-x[w])/n[w]*t)+v:z>y[w]?k[w][c]=r:z<x[w]&&(k[w][c]=v);b.pixelBlock.pixelType="U8";return b}},_computeGammaValues:function(b){var c=this._statistics.length,l,k=[];for(l=0;l<c;l++){var f=this._statistics[l][2];"U8"!==
b&&(f=255*(f-this._statistics[l][0])/(this._statistics[l][1]-this._statistics[l][0]));k.push(this._computeGammaValue(f))}return k},_computeGammaValue:function(b){if(0!==b&&!(255<b||0>b)){var c=0;0<b&&150!=b&&255>b&&(c=150>=b?45*Math.cos(.01047*b):17*Math.sin(.021*b));c=Math.log((b+c)/255);if(0!==c&&(b=Math.log(b/255)/c,!isNaN(b)))return Math.min(9.9,Math.max(.01,b))}},readGL:function(b){return this._stretchGL(b.raster)},_stretchGL:function(b){this._performance.start();var c=this.renderTexture,l,k=
b.pixelBlock&&b.pixelBlock.pixels&&b.pixelBlock.pixels.length||this.sourceRasterInfo.raster.bandCount,f=b.pixelBlock,m=this.gl,n=m.drawingBufferWidth,p=m.drawingBufferHeight;if(!f&&this.functionArguments.dra){var r=new Float32Array(n*p*4),v=new Uint8Array(n*p);var u=new Float32Array(n*p);var t=new Float32Array(n*p);var w=new Float32Array(n*p);m.checkFramebufferStatus(m.FRAMEBUFFER)==m.FRAMEBUFFER_COMPLETE&&m.readPixels(0,0,n,p,m.RGBA,m.FLOAT,r);for(l=0;l<n*p;l++)u[l]=r[4*l],t[l]=r[4*l+1],w[l]=r[4*
l+2],v[l]=r[4*l+3];b.pixelBlock=new d({width:n,height:p,pixels:[u,t,w],mask:v});b.pixelBlock.calculateStatistics()}!f&&this.functionArguments.dra&&this._useGPUStats?(u=new Float32Array(k),t=new Float32Array(k)):(this._updateStatistisHistograms(b),r=this._getCutOffPoints(b),u=new Float32Array(k),t=new Float32Array(k),u.set(r.minCutOff.slice(0,k)),t.set(r.maxCutOff.slice(0,k)));this._initializeProgram({fragment:h.stretch,fragmentName:"Stretch"});r=this._setupTextureData(b);v=this.bindFrameBuffer();
this.renderTexture=!1;this._performance.start();if(!f&&this.functionArguments.dra&&this._useGPUStats){this._setUniforms({u_sourceDim:[n,p],u_bandCount:k});if(1===k)var x=this._readMinMax(r,2);else{x=this._readMinMax(r,0);var y=this._readMinMax(r,1)}if(6===this.functionArguments.stretchType||3===this.functionArguments.stretchType&&this.functionArguments.dra)l=this._readHistogram(x,y,b),u=l.minCutOff||u,t=l.minCutOff||t}w=this.functionArguments.max-this.functionArguments.min;b=new Float32Array(k);for(l=
0;l<k;l++)b[l]=w/(t[l]-u[l]);this._useGPUStats&&this._initializeProgram({fragment:h.stretch,fragmentName:"Stretch"});m.blendFunc(m.SRC_ALPHA,m.ZERO);w=new Float32Array(3);var z=new Float32Array(3);for(l=0;3>l;l++)w[l]=this.functionArguments.min,z[l]=this.functionArguments.max;l=this.functionArguments.useGamma;var B=this.functionArguments.gamma,F=this._gammaCorrection;Array.isArray(B)&&B.length>=k||(l=!1);this._setUniforms({u_sourceDim:[n,p],u_bandCount:k,u_minOutput:w,u_maxOutput:z,u_minCutOff:u,
u_maxCutOff:t,u_factor:b,u_state:100,u_useGamma:l,u_gamma:B,u_scaled:!c,u_gammaCorrection:F,u_minMaxTexture:!f&&this.functionArguments.dra&&this._useGPUStats?!0:!1});this.renderTexture=c;m.viewport(0,0,n,p);this._bindTexture(r.texture,"u_image");!f&&this.functionArguments.dra&&this._useGPUStats&&(c=m.getUniformLocation(this.rasterProgram,"u_image1"),m.uniform1i(c,1),m.activeTexture(m.TEXTURE1),m.bindTexture(m.TEXTURE_2D,x.texture),1<k&&(k=m.getUniformLocation(this.rasterProgram,"u_image2"),m.uniform1i(k,
2),m.activeTexture(m.TEXTURE2),m.bindTexture(m.TEXTURE_2D,y.texture)));this._drawGL();return{extent:r.extent,texture:v.texture}},_readMinMax:function(b,c){var l=this.gl,k=b.width||l.drawingBufferWidth,f=b.height||l.drawingBufferHeight;this._setUniforms({u_state:c});this.renderTexture=!1;var m=b.texture;for(l.activeTexture(l.TEXTURE0);1<k||1<f;){var n=this._createTexture();c=Math.max(Math.ceil(k/2),1);var p=Math.max(Math.ceil(f/2),1);l.getExtension("OES_texture_float");l.texImage2D(l.TEXTURE_2D,0,
l.RGBA,c,p,0,l.RGBA,l.FLOAT,null);b=l.createFramebuffer();l.bindFramebuffer(l.FRAMEBUFFER,b);l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,n,0);l.viewport(0,0,c,p);l.bindTexture(l.TEXTURE_2D,m);this._setUniforms({u_sourceDim:[k,f]});k=c;f=p;this._drawGL(!0);m=n}b=new Float32Array(k*f*4);l.checkFramebufferStatus(l.FRAMEBUFFER)==l.FRAMEBUFFER_COMPLETE&&l.readPixels(0,0,k,f,l.RGBA,l.FLOAT,b);return{texture:n,minmax:b}},_readHistogram:function(b,c,l){if(b)try{var k=this.gl,f=k.drawingBufferWidth,
m=k.drawingBufferHeight,n,p,r;if(b.texture instanceof WebGLTexture){var v=!0;var u=[1,0,0,1];if(c){var t=b.minmax;var w=c.minmax}else t=[b.minmax[0]],w=[b.minmax[1]]}else for(w=c,t=b,u=new Float32Array(w.length),n=0;n<w.length;n++)u[n]=256/(w[n]-t[n]);var x=new Float32Array(f*m);for(r=0;r<x.length;r++)x[r]=r;if(!this.histogramProgram){var y=g.getShader(k,g.histogram),z=h.getShader(k,h.constant);this.histogramProgram=this._loadProgram(y,z)}k.blendFunc(k.ONE,k.ONE);k.enable(k.BLEND);k.useProgram(this.histogramProgram);
var B=k.getAttribLocation(this.histogramProgram,"a_pixelIndex"),F=k.createBuffer();k.bindBuffer(k.ARRAY_BUFFER,F);k.bufferData(k.ARRAY_BUFFER,x,k.STATIC_DRAW);k.enableVertexAttribArray(B);k.vertexAttribPointer(B,1,k.FLOAT,!1,0,0);var D=this._setupHistTexture(l),C=this._createTexture();k.getExtension("OES_texture_float");k.texImage2D(k.TEXTURE_2D,0,k.RGBA,257,1,0,k.RGBA,k.FLOAT,null);var E=k.createFramebuffer();k.bindFramebuffer(k.FRAMEBUFFER,E);k.framebufferTexture2D(k.FRAMEBUFFER,k.COLOR_ATTACHMENT0,
k.TEXTURE_2D,C,0);k.viewport(0,0,257,1);var G=k.getUniformLocation(this.histogramProgram,"u_image");k.uniform1i(G,0);k.activeTexture(k.TEXTURE0);k.bindTexture(k.TEXTURE_2D,D);var H=k.getUniformLocation(this.histogramProgram,"u_sourceDim");k.uniform2f(H,f,m);var K=k.getUniformLocation(this.histogramProgram,"u_bandCount");k.uniform1i(K,3);var M=k.getUniformLocation(this.histogramProgram,"u_halfPixel");k.uniform2f(M,.5/f,.5/m);var I=k.getUniformLocation(this.histogramProgram,"u_minMaxTexture");if(v){k.uniform1i(I,
1);var N=k.getUniformLocation(this.histogramProgram,"u_image1");k.uniform1i(N,1);k.activeTexture(k.TEXTURE1);k.bindTexture(k.TEXTURE_2D,b.texture);if(c){var ea=k.getUniformLocation(this.histogramProgram,"u_image2");k.uniform1i(ea,2);k.activeTexture(k.TEXTURE2);k.bindTexture(k.TEXTURE_2D,c.texture)}}else{var T=k.getUniformLocation(this.histogramProgram,"u_mins");k.uniform4f(T,t[0],t[0],t[0],t[0]);k.uniform1i(I,0)}var W=k.getUniformLocation(this.histogramProgram,"u_color"),P=k.getUniformLocation(this.histogramProgram,
"u_factors"),Z=k.getUniformLocation(this.histogramProgram,"u_size");k.uniform1f(Z,256);b=[];c=[];k.uniform4fv(W,[1,0,0,1]);k.uniform4fv(P,[u[0],0,0,1]);k.drawArrays(k.POINTS,0,x.length);var ma=this.sourceRasterInfo.raster.bandCount;1<ma&&(k.uniform4fv(W,[0,1,0,1]),k.uniform4fv(P,[0,u[0],0,1]),k.drawArrays(k.POINTS,0,x.length),k.uniform4fv(W,[0,0,1,1]),k.uniform4fv(P,[0,0,u[0],1]),k.drawArrays(k.POINTS,0,x.length));if(k.checkFramebufferStatus(k.FRAMEBUFFER)==k.FRAMEBUFFER_COMPLETE){var ka=new Float32Array(1028);
k.readPixels(0,0,257,1,k.RGBA,k.FLOAT,ka);k=0;var Q=-.5===t[0]&&1===(w[0]-t[0])/256?.5:0;for(n=0;n<ma;n++){var L=new Float32Array(257);var J=new Float32Array(257);for(r=k=0;256>r;r++)k+=ka[4*r+n],L[r]=k,J[r]=ka[4*r+n];J[256]=ka[1024+n];L[256]=k+ka[1024+n];var O=this.functionArguments.minPercent*k/100;if(w){for(p=0;256>p;p++)if(L[p]>O){b[n]=t[0]+(w[0]-t[0])/256*(p+Q);break}O=(1-this.functionArguments.maxPercent/100)*k;for(p=254;0<=p;p--)if(L[p]<O){c[n]=t[0]+(w[0]-t[0])/256*(p+2-Q);break}}}}return{histogram:ka,
minCutOff:b,maxCutOff:c}}catch(S){console.debug("webgl filter exception: "+S.message)}},_setupHistTexture:function(b){if(b instanceof WebGLTexture)return b;var c=this.originalHistTexture=this._createTexture(),l=this.gl;b=b.pixelBlock;var k=b.width,f=b.height;l.getExtension("OES_texture_float");this.rgbaFloatData=b.getAsRGBAFloat();l.texImage2D(l.TEXTURE_2D,0,l.RGBA,k,f,0,l.RGBA,l.FLOAT,this.rgbaFloatData);return c}})})},"esri/layers/rasterLib/function/RemapFunction":function(){define("dojo/_base/declare dojo/_base/lang ../../../renderers/colorRampGenerator ./RasterFunctionX ./pixelShaders ./RasterFunctionWebGLMixin ./rasterUtils".split(" "),
function(A,q,a,d,g,h,e){return A([d,h],{declaredClass:"esri.layers.rasterLib.function.RemapFunction",functionName:"Remap",pixelType:"U8",renderTexture:!1,supportWebGL:!0,support2D:!0,constructor:function(b){this.functionArguments=this.mixinIgnoreCase({inputRanges:null,outputValues:null,outputColors:null,colorBreaks:null,raster:null},b)},bind:function(b){b=this.getSourceRasterInfo(b);if(!b.raster)return Error("The raster input is not available.");var c=!(!this.functionArguments.outputColors&&!this.functionArguments.colorBreaks);
this.rasterInfo=q.mixin(b.raster,{bandCount:c?3:1,pixelType:this._calculatePixelType(this.pixelType,"U8"),statistics:null,histograms:null});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};this.rasterInfo.keyProperties.DataType=c?"Processed":"Thematic";return!0},read2D:function(b){return this._remap(b.raster)},readGL:function(b){return this._remapGL(b.raster)},_remap:function(b){this._performance.start();var c=e.remapColor(b.pixelBlock,this.functionArguments.colorBreaks);this._addPerformanceMetric(this._performance.elapsed());
return{extent:b.extent,pixelBlock:c}},_remapGL:function(b){this._performance.start();this._initializeProgram({fragment:g.remap,fragmentName:"Remap"});var c=new Uint8Array(64),l=this.functionArguments.colorBreaks;l.forEach(function(n,p){c[4*p]=n.mappedColor[0];c[4*p+1]=n.mappedColor[1];c[4*p+2]=n.mappedColor[2];c[4*p+3]=1>=n.mappedColor[3]?255*n.mappedColor[3]:n.mappedColor[3]});var k=l[l.length-1],f=k.mappedColor;c[60]=f[0];c[61]=f[1];c[62]=f[2];c[63]=1>=f[3]?255*f[3]:f[3];var m=new Float32Array(16);
l.forEach(function(n,p){m[p]=n.value});m[15]=k.value;this._clrTexture||(this._clrTexture=this._setupColormapTexture(c));l=this._clrTexture;k=this.bindFrameBuffer();b=this._setupTextureData(b);this._setUniforms({u_indexedColormapOffset:0,u_indexedColormapMaxIndex:c.length/4-1,u_breaks:m});this._bindTexture(l,"u_image1");this._bindTexture(b.texture,"u_image");this._drawGL();return{extent:b.extent,texture:k.texture}},_setupColormapTexture:function(b){var c=this._createTexture(),l=b.length/4,k=new Float32Array(b.length),
f=this.renderTexture?255:1,m,n=this.gl;for(m=0;m<b.length;m++)k[m]=b[m]/f;n.getExtension("OES_texture_float");n.texImage2D(n.TEXTURE_2D,0,n.RGBA,l,1,0,n.RGBA,n.FLOAT,k);return c}})})},"esri/layers/rasterLib/function/IdentityFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(A,q,a,d,g){return A([d,g],{declaredClass:"esri.layers.rasterLib.function.IdentityFunction",functionName:"Identity",supportWebGL:!0,support2D:!0,
constructor:function(h){this.functionArguments={raster:null}},bind:function(h){h=this.getSourceRasterInfo(h);if(!h.raster)return Error("The raster input to identity function is invalid.");this.rasterInfo=q.mixin(h.raster,{});return!0},read2D:function(h){return h.raster},readGL:function(h){this._initializeProgram({fragment:a.identity,fragmentName:"identity"});h=this._setupTextureData(h.raster);var e=this.bindFrameBuffer();this._bindTexture(h.texture,"u_image");this._drawGL();return{extent:h.extent,
texture:e.texture}}})})},"esri/layers/rasterLib/function/ResampleFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","./pixelShaders","./RasterFunctionX","./RasterFunctionWebGLMixin"],function(A,q,a,d,g){return A([d,g],{declaredClass:"esri.layers.rasterLib.function.ResampleFunction",renderTexture:!0,resamplingOrigin:null,resamplingRatio:null,zFactor:1,functionName:"Resample",supportWebGL:!0,support2D:!1,constructor:function(h){this.functionArguments=this.mixinIgnoreCase({resamplingType:0},
h)},bind:function(h){h=this.getSourceRasterInfo(h);if(!h.raster)return Error("The raster input to convolution function is invalid.");this.rasterInfo=q.mixin(h.raster,{bandCount:h.raster.bandCount,pixelType:this._calculatePixelType(this.pixelType,h.raster.pixelType),statistics:h.raster.statistics,histograms:h.raster.histograms});this.rasterInfo.keyProperties=this.rasterInfo.keyProperties||{};return!0},readGL:function(h){this._performance.start();this._initializeProgram({fragment:a.resample,fragmentName:"Resample"});
var e=this._setupTextureData(h.raster),b=this.bindFrameBuffer(),c=this.gl,l=c.drawingBufferWidth;c=c.drawingBufferHeight;var k=h.raster;void 0!==k.pixelBlock?(e=e||this._setupTextureData(k),h=k.pixelBlock.width,k=k.pixelBlock.height):(e=e||k,h=l,k=c);this._setUniforms({u_resamplingRatio:this.resamplingRatio||[h/l,k/c],u_anchor:this.resamplingOrigin||[0,1],u_resamplingType:this.functionArguments.resamplingType,u_resolution:[1/l,1/c]});this._drawGL();this._addPerformanceMetric(this._performance.elapsed());
return{extent:e.extent,texture:b.texture}}})})},"esri/layers/rasterLib/renderer/rasterRendererHelper":function(){define("dojo/_base/declare dojo/_base/lang ../../PixelBlock ./RasterColormapRenderer ./RasterUniqueValueRenderer ./RasterRGBRenderer ./RasterStretchColorRampRenderer ./RasterClassBreaksRenderer ./RasterShadedReliefRenderer".split(" "),function(A,q,a,d,g,h,e,b,c){var l=function(){function k(m){f[m.prototype.rendererName]=m}var f={};k(d);k(h);k(e);k(g);k(b);k(c);return f}();return{wellKnownRenderers:l,
isSupported:function(k){if(!k)return!1;var f=!0;l[k.rendererName]||(f=!1);return f},create:function(k){if(!k)return null;if(k.rendererName){var f=k.rendererName;k=k.rendererArguments}else f="uniqueValue rasterStretch rasterShadedRelief rgb rasterColormap classBreaks".split(" ").indexOf(k.type),f="UniqueValue Stretch ShadedRelief RGB Colormap ClassBreaks".split(" ")[f],"rasterStretch"===k.type&&k.bandIndex&&1<k.bandIndex.length&&(f="RGB");return(f=l[f])?new f(k):null},createDefaultRenderer:function(k){if(k&&
k.raster){var f=k.raster.rasterInfo,m=k.raster.dataType;if(f){var n=k.raster.rasterFunction,p=["Stretch","Colormap","ContrastAndBrightness"];if(n&&"U8"===f.pixelType&&-1<p.indexOf(n.functionName))n.renderTexture=!0;else if("Processed"!==m||!(k.useWebGL&&n&&n.renderTexture||!k.useWebGL&&"U8"===f.pixelType)){n&&(f=n.rasterInfo);n=f.bandCount;var r=f.colormap,v=f.vat;p=f.histograms;p&&0===p.length&&(p=null);var u=f.statistics&&f.statistics.map(function(x){return[x.min,x.max,x.mean,x.stddev]});if(1===
n&&r&&0<r.length)var t=this._getDefaultColormapRenderer(v,r);else if(1===n&&v&&v.features&&0<v.features.length)t=new g({});else{r=0;v=!1;m||!k.raster||!k.raster.tileInfo||void 0!==k.raster.tileInfo.tileType&&"Map"!==k.raster.tileInfo.tileType?"U8"===f.pixelType&&"Processed"===m?(r=5,u=u||[[0,255,0,0],[0,255,0,0],[0,255,0,0]],v=!1):"U8"===f.pixelType||"Elevation"===m?(r=5,v=u?!1:!0):"Scientific"===m||"StdTime"===m?(r=5,v=u?!1:!0,t=this._getDefaultScientificColorRamp()):p&&0<p.length?(r=6,v=!1):u?(r=
5,v=!1):(r=6,v=!0):(u=[[0,255,0,0],[0,255,0,0],[0,255,0,0]],r=5,v=!1);u||(r=5,v=!0);var w;3<=n&&!(k.bandIds||k.raster&&k.raster.imageServiceParams&&k.raster.imageServiceParams.bandIds)&&(w=this.getDefaultBandCombination(f));w&&(u=w.map(function(x){return u[x]}));k={stretchType:r,min:0,max:255,dra:v,minPercent:.25,maxPercent:.25,useGamma:!1,computeGamma:!1,statistics:u,histograms:p,numberOfStandardDeviations:2.5,bandIndex:w};1===n||w&&1===w.length?(t&&(k.colorRamp=t,k.invert=!1),t=new e(k)):t=new h(k)}return t}}}},
getDefaultBandCombination:function(k){var f=k.bandCount;if(1===f)return null;if(2===f)return[0];var m=(k=k.keyProperties)&&k.ChangeAnalysisParameters&&k.ChangeAnalysisParameters.AnalysisType;if(m&&("ccdc"===m.toLowerCase()||"landtrendr"===m.toLowerCase()))return[0];k=k&&k.BandProperties;var n;if(k&&k.length===f){var p=this.getWellKnownBandIndexes(k);k=p.red;m=p.green;var r=p.blue;p=p.nir;null!=k&&null!=m&&null!=r?n=[k,m,r]:null!=p&&null!=k&&null!=m&&(n=[p,k,m])}!n&&3<=f&&(n=[0,1,2]);return n},getWellKnownBandIndexes:function(k){for(var f=
{},m=0;m<k.length;m++){var n=k[m],p=n.BandName&&n.BandName.toLowerCase();"red"===p?f.red=m:"green"===p?f.green=m:"blue"===p?f.blue=m:"nearinfrared"===p||"nearinfrared_1"===p||"nir"===p?f.nir=m:n.WavelengthMax&&n.WavelengthMin&&(p=n.WavelengthMin,n=n.WavelengthMax,null==f.blue&&410<=p&&480>=p&&480<=n&&540>=n?f.blue=m:null==f.green&&490<=p&&560>=p&&560<=n&&610>=n?f.green=m:null==f.red&&595<=p&&670>=p&&660<=n&&730>=n?f.red=m:null==f.nir&&700<=p&&860>=p&&800<=n&&950>=n&&(f.nir=m))}return f},_getDefaultColormapRenderer:function(k,
f){if(f||f.length){var m=[],n=this._ratContainsColormap(k);if(n)var p=this._getRATValueClassNameMap(k);f.forEach(function(r){var v=p?p[r[0]]:r[0];m.push({color:[r[1],r[2],r[3]],value:r[0],label:n?null!=v?v:"":r[0]})});return new d({colormapInfos:m})}},_ratContainsColormap:function(k){if(!k||!k.fields)return!1;var f,m,n;return k.fields.some(function(p){p&&p.name&&(p=p.name.toLowerCase(),"red"===p&&(f=!0),"green"===p&&(m=!0),"blue"===p&&(n=!0));return f&&m&&n})},_getRATValueClassNameMap:function(k){if(!k||
!k.fields)return null;var f={},m,n;k.fields.forEach(function(p){if("classname"===p.name.toLowerCase()||"class_name"===p.name.toLowerCase())m=p.name;"value"===p.name.toLowerCase()&&(n=p.name)});k.features.forEach(function(p){p=p.attributes;f[p[n]]=m?p[m]:p[n]});return f},_getDefaultScientificColorRamp:function(){return{type:"multipart",colorRamps:[{fromColor:[255,0,0],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[0,0,255]}].map(function(k){return{fromColor:k.toColor,
toColor:k.fromColor}}).reverse()}}}})},"esri/layers/rasterLib/renderer/RasterColormapRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction"],function(A,q,a,d){return A([a],{declaredClass:"esri.layers.rasterLib.renderer.RasterColormapRenderer",rendererName:"Colormap",renderTexture:!0,constructor:function(g){g&&g.colormapInfos&&(g.colormap=g.colormapInfos.map(function(h){return[h.value].concat(h.color)}));this._function=new d(g);this._function.outputPixelType=
"U8";this._function.renderTexture=!0},draw2D:function(g){this._updateColormapParameters();g=this._clonePixelData(g);return g=this._function._colorize(g)},drawGL:function(g){this._updateColormapParameters();this._function._colorizeGL(g)},toJson:function(){var g=this._function.toJson().rasterFunctionArguments;return{rendererName:this.rendererName,rendererArguments:g}},toCommonRendererJson:function(){return{type:"rasterColormap",colormapInfos:this.colormapInfos||this.colormap.map(function(g){return{value:g[0],
color:g.slice(1),label:g[0]}})}},_updateColormapParameters:function(){var g=this._function.functionArguments;g.colormap=this.colormap;g.colormapName=this.colormapName;g.colorRamp=this.colorRamp;g.colorRampName=this.colorRampName}})})},"esri/layers/rasterLib/renderer/RasterRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","../../../geometry/Extent","../../PixelBlock"],function(A,q,a,d){return A(null,{declaredClass:"esri.layers.rasterLib.renderer.RasterRenderer",raster:null,constructor:function(g){g=
g||{};this.raster=g.raster||g.Raster||this.raster;this.draw=q.hitch(this,this.draw);this.bind=q.hitch(this,this.bind);g=q.clone(g);Object.keys(g).forEach(function(h){null==g[h]&&delete g[h]});q.mixin(this,g)},bind:function(g){if(!g)throw"failed to bind without options";var h=g;g.layer&&(g=g.layer,h={id:g.id,rawRasterInfo:g.raster.rasterInfo,glSetting:g._glSetting,xformSetting:g.tileManager&&g.tileManager.xformSetting,useWebGL:g.useWebGL,resampling:g.tileMode&&g.tileManager&&g.tileManager.xformSetting.requireProjection&&
!g._hasTilingEffects&&"Thematic"!==g.raster.dataType?1:0,tileMode:g.tileMode});this._rawRasterInfo=h.rawRasterInfo;this.useWebGL=h.useWebGL;this._function&&this._function.setProcessingContext(q.mixin({useProcessedData:!0},h));this._processingContext=h},hasTilingEffects:function(){},draw:function(g){return this.useWebGL?this.drawGL(g):this.draw2D(g)},toJson:function(){},_clonePixelData:function(g){if(null==g)return g;var h={};g.extent&&(h.extent=new a(g.extent.xmin,g.extent.ymin,g.extent.xmax,g.extent.ymax,
g.extent.spatialReference));g=g.processedPixelBlock||g.pixelBlock;if(null==g)return h;h.pixelBlock=g.clone?g.clone():d.prototype.clone(g);return h}})})},"esri/layers/rasterLib/renderer/RasterUniqueValueRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../../../renderers/colorRampGenerator"],function(A,q,a,d,g){return A([a],{declaredClass:"esri.layers.rasterLib.renderer.RasterUniqueValueRenderer",rendererName:"UniqueValue",field:"",
alias:"",uniqueValueInfos:null,constructor:function(h){h&&h.colormap&&(this.colormap=h.colormap,this._function=new d(h),this._function.outputPixelType="U8",this._function.renderTexture=!0)},bind:function(h){this.inherited(arguments);if(!this._function){var e=(this.raster&&this.raster.rasterInfo||this._rawRasterInfo).vat;if(!e)throw"uv renderer requires data source to have raster attribute table";var b=this.attributeField||this.field1||this.field,c=this.infos||this.uniqueValueInfos;this.defaultColor=
this.defaultColor||this.defaultSymbol&&this.defaultSymbol.color;var l=e.fields.filter(function(t){return"value"===t.name.toLowerCase()})[0];if(l)var k=l.name;b||((b=e.fields.filter(function(t){return-1<["classname","category"].indexOf(t.name.toLowerCase())})[0])||(b=e.fields.filter(function(t){return"esriFieldTypeString"===t.type})[0]),this.alias=(this.field=b=b&&b.name||k)&&b.alias||k);var f=[],m;if(!c){c=[];var n=e.fields.filter(function(t){return"alpha"===t.name.toLowerCase()})[0];var p=e.fields.filter(function(t){return"red"===
t.name.toLowerCase()})[0];var r=e.fields.filter(function(t){return"green"===t.name.toLowerCase()})[0];var v=e.fields.filter(function(t){return"blue"===t.name.toLowerCase()})[0];for(l=0;l<e.features.length;l++){var u=e.features[l].attributes;(m=c.some(function(t){t.value===u[b]}))||(n&&p&&r&&v?c.push({value:u[b],alias:u[b],color:[u[p.name],u[r.name],u[v.name],u[n.name]]}):p&&r&&v?c.push({value:u[b],alias:u[b],color:[u[p.name],u[r.name],u[v.name]]}):c.push({value:u[b],alias:u[b]}))}if(!(p&&r&&v))for(m=
g.createRandomColorRamp({size:c.length}),l=0;l<c.length;l++)c[l].color=m[l];this.uniqueValueInfos=c}if(c)c.forEach(function(t){f=f.concat(e.features.filter(function(w){return t.value==w.attributes[b]}).map(function(w){return[w.attributes[k]].concat(t.color||t.symbol&&t.symbol.color)}))}),this.defaultColor&&e.features.filter(function(t){f.some(function(w){return w[0]===t.attributes[k]})||f.push([t.attributes[k]].concat(this.defaultColor))});else throw"missing uniqueValueInfos property";this._function=
new d({colormap:f});this.colormap=f;this._function.outputPixelType="U8";this._function.renderTexture=!0;this._function.setProcessingContext(this._processingContext)}},draw2D:function(h){h=this._clonePixelData(h);return h=this._function._colorize(h)},drawGL:function(h){this._function._colorizeGL(h)},toJson:function(h){var e={field:this.field,uniqueValueInfos:this.uniqueValueInfos,defaultColor:this.defaultColor};h&&(e.colormap=this.colormap);return{rendererName:this.rendererName,rendererArguments:e}},
toCommonRendererJson:function(){var h=this.attributeField||this.field1||this.field,e=(this.infos||this.uniqueValueInfos).map(function(b){return{value:b.value,label:b.alias+"",symbol:{color:3===b.color.length?b.color.concat([255]):b.color,type:"esriSFS",style:"esriSFSSolid"}}});return{type:"uniqueValue",field1:h,uniqueValueInfos:e}}})})},"esri/layers/rasterLib/renderer/RasterRGBRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/rasterUtils".split(" "),
function(A,q,a,d,g,h){return A([a],{declaredClass:"esri.layers.rasterLib.renderer.RasterRGBRenderer",rendererName:"RGB",bandIndex:null,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(e){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);
e=q.mixin({},e,{stretchType:this.stretchType});this._stretchFunction=new d(e);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this.bandIndex=e.bandIndex||e.BandIndex;this._function=new g(e);this._function.functionArguments.raster=this._stretchFunction;this._function.renderTexture=!0},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},draw2D:function(e){this._updateStretchParameters();e=this._clonePixelData(e);if("U8"===e.pixelBlock.pixelType&&
!this.contrastOffset&&!this.brightnessOffset)return e;this._stretchFunction._stretch(e);var b=e.pixelBlock,c=this.bandIndex,l=Math.max.apply(null,c);b&&b.pixels.length>l&&c&&(b.pixels=c.map(function(k){return b.pixels[k]}),b.statistics&&(b.statistics=c.map(function(k){return b.statistics[k]})));if(this.contrastOffset||this.brightnessOffset)e.pixelBlock=h.contrastBrightnessStretch(e.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return e},drawGL:function(e){this._updateStretchParameters();
e.pixelBlock&&(e=this._clonePixelData(e));var b=e.pixelBlock,c=this.bandIndex,l=Math.max.apply(null,c),k=this.statistics&&0<this.statistics.length?this.statistics:this._stretchFunction&&this._stretchFunction.srcStatistics,f=this.histograms&&0<this.histograms.length?this.histograms:this._stretchFunction&&this._stretchFunction.srcHistograms,m,n;b&&b.pixels.length>l&&c&&(b.pixels=c.map(function(p){return b.pixels[p]}),b.statistics&&(b.statistics=c.map(function(p){return b.statistics[p]})),k&&0<k.length&&
k.length!==c.length&&(m=c.map(function(p){return k[p]})),f&&0<f.length&&f.length!==c.length&&(n=c.map(function(p){return f[p]})));this._stretchFunction.functionArguments.statistics=m||k;this._stretchFunction.functionArguments.histograms=n||f;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._function.renderTexture=!0,e=this._stretchFunction._stretchGL(e),this._function._cbGL(e)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(e))},toJson:function(){var e=
this._stretchFunction.toJson().rasterFunctionArguments;e.bandIndex=this.bandIndex;e.contrastOffset=this.contrastOffset;e.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:e}},toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||"minMax",min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:q.clone(this.statistics),
dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,gamma:q.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},_updateStretchParameters:function(){var e=this._stretchFunction.functionArguments;e.stretchType=this.stretchType;e.min=this.min;e.max=this.max;e.numberOfStandardDeviations=this.numberOfStandardDeviations;e.statistics=this.statistics;e.histograms=this.histograms;e.dra=this.dra;e.minPercent=this.minPercent;
e.maxPercent=this.maxPercent;e.useGamma=this.useGamma;e.gamma=this.gamma;e.computeGamma=this.computeGamma;this._stretchFunction.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterStretchColorRampRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/ResampleFunction ../function/StretchFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),function(A,q,a,d,g,h,e,b){return A([a],
{declaredClass:"esri.layers.rasterLib.renderer.RasterStretchColorRampRenderer",rendererName:"Stretch",bandIndex:[0],colorRamp:null,invert:!1,stretchType:0,min:0,max:255,numberOfStandardDeviations:2,statistics:null,histograms:null,dra:!1,minPercent:.25,maxPercent:.5,useGamma:!1,gamma:null,computeGamma:!1,sigmoidStrengthLevel:1,constructor:function(c){this.stretchType="number"===typeof this.stretchType?this.stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ").indexOf(this.stretchType);
c=q.mixin({},c,{stretchType:this.stretchType});Object.keys(c).forEach(function(l){null==c[l]&&delete c[l]});this._function=new h(c);this._stretchFunction=new g(c);this._stretchFunction.outputPixelType="U8";this._stretchFunction.renderTexture=!1;this._clrFunction=new e(c);this._clrFunction.functionArguments.raster=this._stretchFunction;this._clrFunction.renderTexture=!1;this._function.functionArguments.raster=this._clrFunction},hasTilingEffects:function(){return this._stretchFunction.hasTilingEffects()},
draw2D:function(c){this._updateStretchParameters();c=this._clonePixelData(c);if("U8"===c.pixelBlock.pixelType&&!(this.contrastOffset||this.brightnessOffset||this.colorRamp))return c;this._stretchFunction._stretch(c);var l=c.pixelBlock,k=this.bandIndex?this.bandIndex[0]:0;l&&1<l.pixels.length&&l.pixels.length>k&&(l.pixels=[l.pixels[k]],l.statistics&&(l.statistics=[l.statistics[k]]));this.colorRamp&&(c=this._clrFunction._colorize(c));if(this.contrastOffset||this.brightnessOffset)c.pixelBlock=b.contrastBrightnessStretch(c.pixelBlock,
{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return c},drawGL:function(c){this._updateStretchParameters();c.pixelBlock&&(c=this._clonePixelData(c));var l=c.pixelBlock,k=this.bandIndex?this.bandIndex[0]||0:0,f=this.statistics&&0<this.statistics.length?this.statistics:this._stretchFunction&&this._stretchFunction.srcStatistics,m=this.histograms&&0<this.histograms.length?this.histograms:this._stretchFunction&&this._stretchFunction.srcHistograms,n,p;l&&1<l.pixels.length&&
l.pixels.length>k&&(l.pixels=[l.pixels[k]],l.statistics&&(l.statistics=[l.statistics[k]]),f&&f.length>k&&(n=[f[k]]),m&&m.length>k&&(p=[m[k]]));this._stretchFunction.functionArguments.statistics=n||f;this._stretchFunction.functionArguments.histograms=p||m;l=!!this.colorRamp;this.contrastOffset||this.brightnessOffset?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!1,this._function.renderTexture=!0,c=this._stretchFunction._stretchGL(c),l&&(c=this._clrFunction._colorizeGL(c)),
this._function._cbGL(c)):l?(this._stretchFunction.renderTexture=!1,this._clrFunction.renderTexture=!0,c=this._stretchFunction._stretchGL(c),this._clrFunction._colorizeGL(c)):(this._stretchFunction.renderTexture=!0,this._stretchFunction._stretchGL(c))},toJson:function(){var c=this._stretchFunction.toJson().rasterFunctionArguments;c.colorRamp=this.colorRamp||"";this.invert&&(c.invert=!0);c.contrastOffset=this.contrastOffset;c.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,
rendererArguments:c}},toCommonRendererJson:function(){return{type:"rasterStretch",stretchType:"none   standardDeviation histogramEqualization minMax percentClip   sigmoid".split(" ")[this.stretchType]||"minMax",colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp,min:this.min,max:this.max,numberOfStandardDeviations:this.numberOfStandardDeviations,statistics:q.clone(this.statistics),dra:this.dra,minPercent:this.minPercent,maxPercent:this.maxPercent,useGamma:this.useGamma,
gamma:q.clone(this.gamma),computeGamma:this.computeGamma,sigmoidStrengthLevel:this.sigmoidStrengthLevel}},_updateStretchParameters:function(){var c=this._stretchFunction.functionArguments;c.stretchType=this.stretchType;c.min=this.min;c.max=this.max;c.numberOfStandardDeviations=this.numberOfStandardDeviations;c.statistics=this.statistics;c.histograms=this.histograms;c.dra=this.dra;c.minPercent=this.minPercent;c.maxPercent=this.maxPercent;c.useGamma=this.useGamma;c.gamma=this.gamma;c.computeGamma=this.computeGamma;
this._stretchFunction.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterClassBreaksRenderer":function(){define(["dojo/_base/declare","dojo/_base/lang","./RasterRenderer","../function/ColormapFunction","../function/RemapFunction"],function(A,q,a,d,g){return A([a],{declaredClass:"esri.layers.rasterLib.renderer.RasterClassBreaksRenderer",rendererName:"ClassBreaks",renderTexture:!0,constructor:function(h){h=h||{};this._function=new g(h);this._function.outputPixelType="U8";var e=
h.classBreakInfos;h=h.minValue;null!=h&&e&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(h,e))},bind:function(h){this.inherited(arguments);this.isColormapFunction=!1;var e=this.raster&&this.raster.rasterInfo||this._rawRasterInfo,b=e&&e.vat;if(b&&"u8"===e.pixelType.toLowerCase()&&this.classBreakInfos){var c=this.field;if(e=b.fields.filter(function(p){return"value"===p.name.toLowerCase()})[0])var l=e.name;var k=b.features.sort(function(p,r){return parseFloat(p.attributes[c])-
parseFloat(r.attributes[c])})[0].attributes[c];this.isColormapFunction=!0;var f=[],m=this.field,n=this.classBreakInfos;n.forEach(function(p,r){b.features.forEach(function(v){var u=n[r-1]&&n[r-1].classMaxValue||k;v.attributes[m]<=p.classMaxValue&&(v.attributes[m]>u||v.attributes[m]===k)&&(u=p.symbol.color,f.some(function(t){return t[0]===v.attributes[l]})||f.push([v.attributes[l]].concat(u)))})});this._function=new d({colormap:f});this.colormap=f;this._function.outputPixelType="U8";this._function.renderTexture=
!0}this._function&&this._function.setProcessingContext(q.mixin({useProcessedData:!0},this._processingContext))},draw2D:function(h){if(this.isColormapFunction)return this._updateColormapParameters(),h=this._clonePixelData(h),h=this._function._colorize(h);this._updateRemapParameters();return this._function._remap(h)},drawGL:function(h){this.isColormapFunction?(this._updateColormapParameters(),this._function._colorizeGL(h)):(this._function.renderTexture=!0,this._updateRemapParameters(),this._function._remapGL(h))},
toJson:function(){var h=this._function.toJson().rasterFunctionArguments;return{rendererName:this.rendererName,rendererArguments:h}},toCommonRendererJson:function(){var h,e=this.classBreakInfos,b=this.colorBreaks;if(null==e&&b)for(e=[],h=0;h<b.length-1;h++)e.push({classMaxValue:b[h+1].value,symbol:{color:b[h].mappedColor,type:"esriSFS",style:"esriSFSSolid"},label:b[h].value+" - "+b[h+1].value});return{type:"classBreaks",field:"Value",minValue:null!=this.minValue?this.minValue:b[0].value,classBreakInfos:e}},
_updateRemapParameters:function(){var h=this.classBreakInfos,e=this.minValue;null!=e&&h&&(this._function.functionArguments.colorBreaks=this._getSortedColorBreaks(e,h))},_getSortedColorBreaks:function(h,e){e=e.map(function(c){return{maxValue:c.classMaxValue,color:c.symbol.color}}).sort(function(c,l){return c.maxValue-l.maxValue});var b=[{value:h,mappedColor:e[0].color}];for(h=0;h<e.length;h++)b.push({value:e[h].maxValue,mappedColor:h===e.length-1?e[h].color:e[h+1].color});return b},_updateColormapParameters:function(){this._function.functionArguments.colormap=
this.colormap;this._function.interpolation=this.interpolation}})})},"esri/layers/rasterLib/renderer/RasterShadedReliefRenderer":function(){define("dojo/_base/declare dojo/_base/lang ./RasterRenderer ../function/HillshadeFunction ../function/ContrastBrightnessFunction ../function/ColormapFunction ../function/rasterUtils".split(" "),function(A,q,a,d,g,h,e){return A([a],{declaredClass:"esri.layers.rasterLib.renderer.RasterShadedReliefRenderer",rendererName:"ShadedRelief",hillshadeType:null,azimuth:315,
altitude:45,zFactor:1,slopeType:null,psPower:.664,psFactor:.024,raster:null,constructor:function(b){this.hillshadeType="number"===typeof this.hillshadeType?this.hillshadeType:["traditional","multi-directional"].indexOf(this.hillshadeType);b&&b.scalingType&&(this.slopeType="adjusted"===b.scalingType?3:1);b&&b.pixelSizePower&&(this.psPower=b.pixelSizePower);b&&b.pixelSizeFactor&&(this.psFactor=b.pixelSizeFactor);b=q.mixin({},b,{hillshadeType:this.hillshadeType,psPower:this.psPower,psFactor:this.psFactor,
slopeType:this.slopeType});Object.keys(b).forEach(function(c){null==b[c]&&delete b[c]});this._function=new g(b);this._hillshadeFunction=new d(b);this._hillshadeFunction.outputPixelType="U8";this._hillshadeFunction.renderTexture=!1;this._function.functionArguments.raster=this._hillshadeFunction},hasTilingEffects:function(){return this._hillshadeFunction.hasTilingEffects()},draw2D:function(b){this._updateHillshadeParameters();b=this._clonePixelData(b);b=this._hillshadeFunction.read2D({raster:b});if(this.contrastOffset||
this.brightnessOffset)b.pixelBlock=e.contrastBrightnessStretch(b.pixelBlock,{contrastOffset:this.contrastOffset,brightnessOffset:this.brightnessOffset});return b},drawGL:function(b){this._updateHillshadeParameters();this.contrastOffset||this.brightnessOffset?(this._hillshadeFunction.renderTexture=!1,this._function.renderTexture=!0,b=this._hillshadeFunction.readGL({raster:b}),this._function._cbGL(b)):(this._hillshadeFunction.renderTexture=!0,this._hillshadeFunction.readGL({raster:b}))},toJson:function(){var b=
this._hillshadeFunction.toJson().rasterFunctionArguments;b.colorRamp=this.colorRamp||"";this.invert&&(b.invert=!0);b.contrastOffset=this.contrastOffset;b.brightnessOffset=this.brightnessOffset;return{rendererName:this.rendererName,rendererArguments:b}},toCommonRendererJson:function(){return{type:"rasterShadedRelief",hillshadeType:["traditional","multi-directional"][this.hillshadeType]||"traditional",azimuth:this.azimuth,altitude:this.altitude,zFactor:this.zFactor,scalingType:3===this.slopeType?"adjusted":
"none",pixelSizePower:this.psPower,pixelSizeFactor:this.psFactor,colorRamp:this.colorRamp&&this.colorRamp.toJson?this.colorRamp.toJson():this.colorRamp}},_updateHillshadeParameters:function(){var b=this._hillshadeFunction.functionArguments;b.hillshadeType=this.hillshadeType;b.azimuth=this.azimuth;b.altitude=this.altitude;b.zFactor=this.zFactor;b.slopeType=this.slopeType;b.psPower=this.psPower;b.psFactor=this.psFactor}})})},"*now":function(A){A(['dojo/i18n!*preload*esri/layers/rasterLib/tile/nls/RasterWorker*["ar","bs","ca","cs","da","de","de-ch","el","en-au","en-ca","en-gb","en-us","es","es-mx","et","fi","fr","fr-ch","he","hr","hu","id","it","it-ch","ja","ko","lt","lv","nl","nb","pl","pt","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","uk","vi","zh-cn","zh-hk","zh-tw","ROOT"]'])},
"*noref":1}});
define("esri/layers/rasterLib/tile/RasterWorker","require exports module dojo/Deferred dojo/promise/all ../../PixelBlock ../../rasterFormats/rasterCodec ../function/rasterFunctionHelper ../renderer/rasterRendererHelper ../raster/RasterInfo".split(" "),function(A,q,a,d,g,h,e,b,c,l){return function(){function k(f){this.processingSettings={}}k.prototype.setLayer=function(f){var m=new d,n=f.layerId;this.processingSettings[n]=this.processingSettings[n]||{};f.raster&&(this.processingSettings[n].raster=f.raster,
f.raster.rasterInfo&&(this.processingSettings[n].raster.rasterInfo=new l(f.raster.rasterInfo)));this.processingSettings[n].bandCount=f.bandCount;this.processingSettings[n].useWebGL=!1;m.resolve();return m.promise};k.prototype.setRasterFunction=function(f){var m=new d,n=f.layerId;f=f.data;this.processingSettings[n]=this.processingSettings[n]||{};f?(f=b.create(f),this.processingSettings[n].rasterFunction=f,this.processingSettings[n].rasterFunction.setProcessingContext(this.processingSettings[n])):this.processingSettings[n].rasterFunction=
null;m.resolve();return m.promise};k.prototype.setRasterRenderer=function(f){var m=new d,n=f.layerId;f=f.data;this.processingSettings[n]=this.processingSettings[n]||{};f?(this.processingSettings[n].rasterRenderer=c.create(f),this.processingSettings[n].rasterRenderer.bind({layer:this.processingSettings[n]})):this.processingSettings[n].rasterRenderer=null;m.resolve();return m.promise};k.prototype.processTileData=function(f){return this.decode(f).then(function(m){this.process(m).then(function(n){this.render(n)}.bind(this))}.bind(this))};
k.prototype.decode=function(f){return e.decode(f.encodedData,f.decodeParams)};k.prototype.process=function(f){var m=new d,n=this.processingSettings[f.layerId].rasterFunction,p;n&&f&&(p=n.read(f));m.resolve(p||f);return m.promise};k.prototype.render=function(f){var m=new d,n=this.processingSettings[f.layerId].rasterRenderer,p;n&&f&&(p=n.draw(f));m.resolve(p||f);return m.promise};return k}()});