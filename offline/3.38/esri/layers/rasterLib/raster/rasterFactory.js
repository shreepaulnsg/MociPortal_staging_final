// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.38/esri/copyright.txt for details.
//>>built
define("esri/layers/rasterLib/raster/rasterFactory","require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/sniff dojo/when ../../../kernel ../../../Evented ../../../request ../../../deferredUtils ../../../urlUtils ./ImageServiceRaster ./TileServiceRaster ./TileRaster ./FunctionRaster".split(" "),function(p,C,d,l,D,E,u,r,v,F,w,x,y,z,t,A,q){p={customDrivers:[],create:function(a){if(a){if(a.url){var b=y.urlToObject(a.url);var c=b.path;var e=b.query}b=
a.serviceInfo;var g=a.rasterFxArgs||{},k=new l,m=d.hitch(this,function(f){console.error(f);this._trycustomDrivers(d.mixin({url:c},a),0,k)});if(c)if(-1===c.toLowerCase().indexOf("imageserver")&&-1===c.toLowerCase().indexOf("mapserver")){var h=new A(d.mixin({},a,{url:c}));a.rasterFx&&(h=new q({rasterFx:a.rasterFx,rasterFxArgs:d.mixin({},g,{raster:h})}));var n=h}else{n=new l;b=b||this._getServiceInfo(c,e);var B=d.hitch(this,function(f){f.bandCount?h=f.capabilities&&-1<f.capabilities.toLowerCase().indexOf("tileonly")?
new t(d.mixin({},{serviceInfo:f},e,a,{url:c})):new z(d.mixin({},{serviceInfo:f},e,a,{url:c})):f.tileInfo&&(h=new t(d.mixin({},{serviceInfo:f},e,this._options,{url:c})));a.rasterFx&&(h=new q({rasterFx:a.rasterFx,rasterFxArgs:d.mixin({},g,{raster:h})}));n.resolve(h)});r(b,B,m)}else n=h=new q({rasterFx:a.rasterFx,rasterFxArgs:d.mixin({},g,{raster:h})});r(n,d.hitch(this,function(f){f?f.open().then(d.hitch(this,function(G){k.resolve(f)}),m):m(Error("There is no raster to open"))}),m);return k.promise}},
register:function(a){this.customDrivers=this.customDrivers||[];0<this.customDrivers.filter(function(b){return b.sourceType===a.prototype.sourceType}).length||this.customDrivers.push(a)},_trycustomDrivers:function(a,b,c){c=c||new l;var e=this.customDrivers[b];if(e){var g=new e(a);g.open().then(d.hitch(this,function(k){c.resolve(g)}),d.hitch(this,function(k){this._trycustomDrivers(a,b+1,c)}))}else c.reject("cannot load layer "+(a&&a.url||""));return c.promise},_getServiceInfo:function(a,b){b=b||{};
var c=b.bandIds;b=b.renderingRule;var e=new l(x._dfdCanceller),g={f:"json"};c&&(g.bandIds=c);b&&(g.renderingRule=b.toJson?JSON.stringify(b.toJson()):JSON.stringify(b));e._pendingDfd=w({url:a,content:g,handleAs:"json",callbackParamName:"callback"});e._pendingDfd.then(function(k){e.callback(k)},function(k){e.errback(k)});return e.promise}};u("extend-esri")&&d.setObject("layers.rasterLib.raster.rasterFactory",p,v);return p});