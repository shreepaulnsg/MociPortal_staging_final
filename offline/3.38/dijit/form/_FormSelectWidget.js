//>>built
define("dijit/form/_FormSelectWidget","dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),function(e,p,q,t,u,v,w,r,f,x,y,z,A){return u("dijit.form._FormSelectWidget",A,{multiple:!1,options:null,store:null,_setStoreAttr:function(a){this._created&&this._deprecatedSetStore(a)},query:null,_setQueryAttr:function(a){this._created&&
this._deprecatedSetStore(this.store,this.selectedValue,{query:a})},queryOptions:null,_setQueryOptionsAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:a})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,onLoadDeferred:null,getOptions:function(a){var b=this.options||[];if(null==a)return b;if(f.isArrayLike(a))return e.map(a,"return this.getOptions(item);",this);f.isString(a)&&(a={value:a});f.isObject(a)&&(e.some(b,function(c,k){for(var d in a)if(!(d in
c)||c[d]!=a[d])return!1;a=k;return!0})||(a=-1));return 0<=a&&a<b.length?b[a]:null},addOption:function(a){e.forEach(f.isArrayLike(a)?a:[a],function(b){b&&f.isObject(b)&&this.options.push(b)},this);this._loadChildren()},removeOption:function(a){a=this.getOptions(f.isArrayLike(a)?a:[a]);e.forEach(a,function(b){b&&(this.options=e.filter(this.options,function(c){return c.value!==b.value||c.label!==b.label}),this._removeOptionItem(b))},this);this._loadChildren()},updateOption:function(a){e.forEach(f.isArrayLike(a)?
a:[a],function(b){var c=this.getOptions({value:b.value}),k;if(c)for(k in b)c[k]=b[k]},this);this._loadChildren()},setStore:function(a,b,c){r.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.","","2.0");this._deprecatedSetStore(a,b,c)},_deprecatedSetStore:function(a,b,c){var k=this.store;c=c||{};if(k!==a){for(var d;d=this._notifyConnections.pop();)d.remove();
a.get||(f.mixin(a,{_oldAPI:!0,get:function(h){var l=new p;this.fetchItemByIdentity({identity:h,onItem:function(g){l.resolve(g)},onError:function(g){l.reject(g)}});return l.promise},query:function(h,l){var g=new p(function(){m.abort&&m.abort()});g.total=new p;var m=this.fetch(f.mixin({query:h,onBegin:function(n){g.total.resolve(n)},onComplete:function(n){g.resolve(n)},onError:function(n){g.reject(n)}},l));return new z(g)}}),a.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[q.after(a,
"onNew",f.hitch(this,"_onNewItem"),!0),q.after(a,"onDelete",f.hitch(this,"_onDeleteItem"),!0),q.after(a,"onSet",f.hitch(this,"_onSetItem"),!0)]));this._set("store",a)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);c.query&&this._set("query",c.query);c.queryOptions&&this._set("queryOptions",c.queryOptions);a&&a.query&&
(this._loadingStore=!0,this.onLoadDeferred=new p,this._queryRes=a.query(this.query,this.queryOptions),y(this._queryRes,f.hitch(this,function(h){if(this.sortByLabel&&!c.sort&&h.length)if(a.getValue)h.sort(t.createSortFunction([{attribute:a.getLabelAttributes(h[0])[0]}],a));else{var l=this.labelAttr;h.sort(function(g,m){return g[l]>m[l]?1:m[l]>g[l]?-1:0})}c.onFetch&&(h=c.onFetch.call(this,h,c));e.forEach(h,function(g){this._addOptionForItem(g)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(f.hitch(this,
function(g,m,n){m==n?this._onSetItem(g):(-1!=m&&this._onDeleteItem(g),-1!=n&&this._onNewItem(g))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:b);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(h):this._loadChildren();this.onLoadDeferred.resolve(!0);this.onSetStore()}),f.hitch(this,function(h){console.error("dijit.form.Select: "+h.toString());this.onLoadDeferred.reject(h)})));return k},_setValueAttr:function(a,b){this._onChangeActive||
(b=null);if(this._loadingStore)this._pendingValue=a;else if(null!=a){a=f.isArrayLike(a)?e.map(a,function(d){return f.isObject(d)?d:{value:d}}):f.isObject(a)?[a]:[{value:a}];a=e.filter(this.getOptions(a),function(d){return d&&d.value});var c=this.getOptions()||[];this.multiple||a[0]&&a[0].value||!c.length||(a[0]=c[0]);e.forEach(c,function(d){d.selected=e.some(a,function(h){return h.value===d.value})});c=e.map(a,function(d){return d.value});if("undefined"!=typeof c&&"undefined"!=typeof c[0]){var k=
e.map(a,function(d){return d.label});this._setDisplay(this.multiple?k:k[0]);this.inherited(arguments,[this.multiple?c:c[0],b]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var a=e.map([].concat(this.get("selectedOptions")),function(b){return b&&"label"in b?b.label:b?b.value:null},this);return this.multiple?a:a[0]},_setDisplayedValueAttr:function(a){this.set("value",this.getOptions("string"==typeof a?{label:a}:a))},_loadChildren:function(){this._loadingStore||(e.forEach(this._getChildren(),
function(a){a.destroyRecursive()}),e.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var a=[].concat(this.value);if(a&&a[0]){var b=this;e.forEach(this._getChildren(),function(c){var k=e.some(a,function(d){return c.option&&d===c.option.value});k&&!b.multiple&&(b.focusedChild=c);w.toggle(c.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),k);c.domNode.setAttribute("aria-selected",
k?"true":"false")},this)}},_getValueFromOpts:function(){var a=this.getOptions()||[];if(!this.multiple&&a.length){var b=e.filter(a,function(c){return c.selected})[0];if(b&&b.value)return b.value;a[0].selected=!0;return a[0].value}return this.multiple?e.map(e.filter(a,function(c){return c.selected}),function(c){return c.value})||[]:""},_onNewItem:function(a,b){b&&b.parent||this._addOptionForItem(a)},_onDeleteItem:function(a){this.removeOption({value:this.store.getIdentity(a)})},_onSetItem:function(a){this.updateOption(this._getOptionObjForItem(a))},
_getOptionObjForItem:function(a){var b=this.store,c=this.labelAttr&&this.labelAttr in a?a[this.labelAttr]:b.getLabel(a);return{value:c?b.getIdentity(a):null,label:c,item:a}},_addOptionForItem:function(a){var b=this.store;b.isItemLoaded&&!b.isItemLoaded(a)?b.loadItem({item:a,onItem:function(c){this._addOptionForItem(c)},scope:this}):(a=this._getOptionObjForItem(a),this.addOption(a))},constructor:function(a){this._oValue=(a||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);
v.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?x("\x3e *",this.srcNodeRef).map(function(a){return"separator"===a.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:a.getAttribute("data-"+r._scopeName+"-value")||a.getAttribute("value"),label:String(a.innerHTML),selected:a.getAttribute("selected")||!1,disabled:a.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",
this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);q.after(this,"onChange",f.hitch(this,"_updateSelection"));var a=this.store;a&&(a.getIdentity||a.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(a,this._oValue,{query:this.query,queryOptions:this.queryOptions}));this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var a;a=this._notifyConnections.pop();)a.remove();
this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})});