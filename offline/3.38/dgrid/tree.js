//>>built
define("dgrid/tree","dojo/_base/declare dojo/_base/array dojo/_base/Deferred dojo/_base/lang dojo/query dojo/on dojo/aspect ./util/has-css3 ./Grid dojo/has!touch?./util/touch put-selector/put".split(" "),function(M,I,z,J,A,K,t,B,L,C,f){function D(d,u,m,h){h=this.grid.isRTL?"right":"left";var b=".dgrid-expando-icon";u&&(b+=".ui-icon.ui-icon-triangle-1-"+(m?"se":"e"));d=f("div"+b+"[style\x3dmargin-"+h+": "+d*(this.indentWidth||9)+"px; float: "+h+"]");d.innerHTML="\x26nbsp;";return d}function E(d){var u=
this,m=this.style.height;m&&(this.style.display="0px"==m?"none":"block");d&&(f(this,".dgrid-tree-resetting"),setTimeout(function(){f(u,"!dgrid-tree-resetting")}));this.style.height=""}function F(d){var u=d.renderCell||L.defaultRenderCell,m,h;d||(d={});d.shouldExpand=d.shouldExpand||function(b,p,e){return e};t.after(d,"init",function(){var b=d.grid,p=".dgrid-content .dgrid-column-"+d.id,e=[];b.cleanEmptyObservers=!1;if(!b.store)throw Error("dgrid tree column plugin requires a store to operate.");d.renderExpando||
(d.renderExpando=D);e.push(b.on(d.expandOn||".dgrid-expando-icon:click,"+p+":dblclick,"+p+":keydown",function(a){var c=b.row(a);b.store.mayHaveChildren&&!b.store.mayHaveChildren(c.data)||"keydown"==a.type&&32!=a.keyCode||"dblclick"==a.type&&h&&1<h.count&&c.id==h.id&&-1<a.target.className.indexOf("dgrid-expando-icon")||b.expand(c);-1<a.target.className.indexOf("dgrid-expando-icon")&&(h&&h.id==b.row(a).id?h.count++:h={id:b.row(a).id,count:1})}));B("touch")&&e.push(b.on(C.selector(p,C.dbltap),function(){b.expand(this)}));
b._expanded||(b._expanded={});e.push(t.after(b,"insertRow",function(a){var c=this.row(a);d.shouldExpand(c,m,this._expanded[c.id])&&this.expand(a,!0,!0);return a}));e.push(t.before(b,"removeRow",function(a,c){if(a=a.connected)A("\x3e.dgrid-row",a).forEach(function(g){b.removeRow(g,!0)}),c||f(a,"!")}));d.collapseOnRefresh&&e.push(t.after(b,"cleanup",function(){this._expanded={}}));b._calcRowHeight=function(a){var c=a.connected;return a.offsetHeight+(c?c.offsetHeight:0)};b.expand=function(a,c,g){var k=
a.element?a:b.row(a),q=B("transitionend");a=new z;var y=a.promise;a.resolve();a=k.element;a=-1<a.className.indexOf("dgrid-expando-icon")?a:A(".dgrid-expando-icon",a)[0];g=g||!1===d.enableTransitions;if(a&&a.mayHaveChildren&&(g||c!==!!this._expanded[k.id])){var n=void 0===c?!this._expanded[k.id]:c;f(a,".ui-icon-triangle-1-"+(n?"se":"e")+"!ui-icon-triangle-1-"+(n?"e":"se"));c=k.element;var l=c.connected,w={originalQuery:this.query};if(!l){l=w.container=c.connected=f(c,"+div.dgrid-tree-container");var v=
function(x){return b.store.getChildren(k.data,x)};d.allowDuplicates&&(w.parentId=k.id);"level"in a&&(v.level=a.level);y=y.then(function(){if(b.renderQuery)return b.renderQuery(v,w);var x=f(l,"div"),G=b.renderArray(v(w),x,"level"in v?{queryLevel:v.level}:{});z.when(G,function(){f(x,"!")});return G});q?K(l,q,E):E.call(l)}l.hidden=!n;var r=l.style;if(!q||g)r.display=n?"block":"none",r.height="";else{if(n){r.display="block";var H=l.scrollHeight;r.height="0px"}else f(l,".dgrid-tree-resetting"),r.height=
l.scrollHeight+"px";setTimeout(function(){f(l,"!dgrid-tree-resetting");r.height=n?H?H+"px":"auto":"0px"})}n?this._expanded[k.id]=!0:delete this._expanded[k.id]}return y};t.after(d,"destroy",function(){I.forEach(e,function(a){a.remove()});delete b.expand;delete b._calcRowHeight})});d.renderCell=function(b,p,e,a){var c=d.grid,g=Number(a&&a.queryLevel)+1,k=!c.store.mayHaveChildren||c.store.mayHaveChildren(b),q=a.parentId;g=m=isNaN(g)?0:g;c=d.renderExpando(g,k,c._expanded[(q?q+"-":"")+c.store.getIdentity(b)],
b);c.level=g;c.mayHaveChildren=k;(b=u.call(d,b,p,e,a))&&b.nodeType?(f(e,c),f(e,b)):e.insertBefore(c,e.firstChild)};return d}F.defaultRenderExpando=D;J.getObject("dgrid.tree",!0);return dgrid.tree=F});