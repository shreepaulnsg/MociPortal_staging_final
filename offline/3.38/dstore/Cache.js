//>>built
define("dstore/Cache","dojo/_base/array dojo/when dojo/_base/declare dojo/_base/lang ./Store ./Memory ./QueryResults".split(" "),function(u,f,k,p,l,v,w){function m(a){return function(){var b=this.inherited(arguments),d=this.cachingCollection||this.cachingStore;b.cachingCollection=d[a].apply(d,arguments);b.isValidFetchCache=!0===this.canCacheQuery||this.canCacheQuery(a,arguments);return b}}function q(a){a.cachingStore||(a.cachingStore=new v);a.cachingStore.Model=a.Model;a.cachingStore.idProperty=a.idProperty}
var t={cachingStore:null,constructor:function(){q(this)},canCacheQuery:function(a,b){return!1},isAvailableInCache:function(){return this.isValidFetchCache&&(this.allLoaded||this.fetchRequest)||this._parent&&this._parent.isAvailableInCache()},fetch:function(){return this._fetch(arguments)},fetchRange:function(){return this._fetch(arguments,!0)},_fetch:function(a,b){var d=this.cachingStore,c=this.cachingCollection||d,e=this,h=this.isAvailableInCache();if(h)return new w(f(h,function(){return e.isAvailableInCache()?
b?c.fetchRange(a[0]):c.fetch():e.inherited(a)}));h=this.fetchRequest=this.inherited(a);f(h,function(g){var r=!b;e.fetchRequest=null;u.forEach(g,function(n){!e.isLoaded||e.isLoaded(n)?d.putSync?d.putSync(n):d.put(n):r=!1});r&&(e.allLoaded=!0);return g},function(g){e.fetchRequest=null;if(g)throw g;throw Error("Error fetching data from master-store");});return h},isValidFetchCache:!1,get:function(a,b){var d=this.cachingStore,c=this.getInherited(arguments),e=this;return f(this.fetchRequest,function(){return f(d.get(a),
function(h){if(void 0!==h)return h;if(c)return f(c.call(e,a,b),function(g){g&&d.put(g,{id:a});return g})})})},add:function(a,b){var d=this.cachingStore;return f(this.inherited(arguments),function(c){var e=d.put(c&&"object"===typeof c?c:a,b);return c||e})},put:function(a,b){var d=this.cachingStore;d.put(a,b);return f(this.inherited(arguments)).then(function(c){var e=d.put(c&&"object"===typeof c?c:a,b);return c||e},function(c){d.remove(b&&b.id||d.getIdentity(a));if(c)throw c;throw Error("Failed to put() object to master-store");
})},remove:function(a,b){var d=this.cachingStore;return f(this.inherited(arguments),function(c){return f(d.remove(a,b),function(){return c})})},evict:function(a){this.allLoaded=!1;return this.cachingStore.remove(a)},invalidate:function(){this.allLoaded=!1},_createSubCollection:function(){var a=this.inherited(arguments);a._parent=this;return a},sort:m("sort"),filter:m("filter"),select:m("select"),_getQuerierFactory:function(a){var b=this.cachingStore;return this.inherited(arguments)||p.hitch(b,b._getQuerierFactory(a))}};
l=k(null,t);l.create=function(a,b){a=k.safeMixin(p.delegate(a),t);k.safeMixin(a,b);q(a);return a};return l});