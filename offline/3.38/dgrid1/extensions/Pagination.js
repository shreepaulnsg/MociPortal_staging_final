//>>built
define("dgrid1/extensions/Pagination","../_StoreMixin dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/dom-construct dojo/dom-class dojo/on dojo/query dojo/string dojo/has dojo/keys dojo/when ../util/misc dojo/i18n!./nls/pagination dojo/_base/sniff".split(" "),function(C,D,E,F,f,G,v,x,H,N,I,J,O,K){function L(b){b._removeNoDataNode()||b.cleanup();b.contentNode.innerHTML=""}function A(b){if(b.loadingNode)b._loadingCount--,b._loadingCount||(f.destroy(b.loadingNode),delete b.loadingNode);else if(b._oldPageNodes){for(var a in b._oldPageNodes)b.removeRow(b._oldPageNodes[a]);
delete b._oldPageNodes}delete b._isLoading}return D(C,{rowsPerPage:10,pagingTextBox:!1,previousNextArrows:!0,firstLastArrows:!1,pagingLinks:2,pageSizeOptions:null,showLoadingMessage:!0,i18nPagination:K,showFooter:!0,_currentPage:1,_loadingCount:0,buildRendering:function(){this.inherited(arguments);var b=this,a=this.paginationNode=f.create("div",{className:"dgrid-pagination"},this.footerNode),c=this.paginationStatusNode=f.create("div",{className:"dgrid-status"},a),d=this.i18nPagination;"function"===
typeof this._processScroll&&(this.bodyNode.innerHTML=d.notCompatibleWithOnDemand,console.warn(d.notCompatibleWithOnDemand));c.tabIndex=0;this._updatePaginationSizeSelect();this._updateRowsPerPageOption();this._updatePaginationStatus(this._total);a=this.paginationNavigationNode=f.create("div",{className:"dgrid-navigation"},a);this.firstLastArrows&&(this.paginationFirstNode=f.create("span",{"aria-label":d.gotoFirst,className:"dgrid-first dgrid-page-link",innerHTML:"\u00ab",tabIndex:0},a));this.previousNextArrows&&
(this.paginationPreviousNode=f.create("span",{"aria-label":d.gotoPrev,className:"dgrid-previous dgrid-page-link",innerHTML:"\u2039",tabIndex:0},a));this.paginationLinksNode=f.create("span",{className:"dgrid-pagination-links"},a);this.previousNextArrows&&(this.paginationNextNode=f.create("span",{"aria-label":d.gotoNext,className:"dgrid-next dgrid-page-link",innerHTML:"\u203a",tabIndex:0},a));this.firstLastArrows&&(this.paginationLastNode=f.create("span",{"aria-label":d.gotoLast,className:"dgrid-last dgrid-page-link",
innerHTML:"\u00bb",tabIndex:0},a));this._listeners.push(v(a,".dgrid-page-link:click,.dgrid-page-link:keydown",function(h){if("keydown"!==h.type||13===h.keyCode)if(h=this.className,!(b._isLoading||-1<h.indexOf("dgrid-page-disabled"))){var r=b._currentPage;var p=Math.ceil(b._total/b.rowsPerPage);this===b.paginationPreviousNode?b.gotoPage(r-1):this===b.paginationNextNode?b.gotoPage(r+1):this===b.paginationFirstNode?b.gotoPage(1):this===b.paginationLastNode?b.gotoPage(p):"dgrid-page-link"===h&&b.gotoPage(+this.innerHTML)}}))},
destroy:function(){this.inherited(arguments);this._pagingTextBoxChangeHandle&&this._pagingTextBoxChangeHandle.remove();this._pagingTextBoxKeyPressHandle&&this._pagingTextBoxKeyPressHandle.remove()},_updatePaginationSizeSelect:function(){var b=this.pageSizeOptions,a=this.paginationSizeSelect;if(b&&b.length){if(!a){a=this.paginationSizeSelect=f.create("select",{"aria-label":this.i18nPagination.rowsPerPage,className:"dgrid-page-size"},this.paginationNode);var c=this._paginationSizeChangeHandle=v(a,"change",
F.hitch(this,function(){this.set("rowsPerPage",+this.paginationSizeSelect.value)}));this._listeners.push(c)}for(c=a.options.length=0;c<b.length;c++)f.create("option",{innerHTML:b[c],selected:this.rowsPerPage===b[c],value:b[c]},a);this._updateRowsPerPageOption()}else b&&b.length||!a||(f.destroy(a),this.paginationSizeSelect=null,this._paginationSizeChangeHandle.remove())},_setPageSizeOptions:function(b){this.pageSizeOptions=b&&b.sort(function(a,c){return a-c});this._updatePaginationSizeSelect()},_updateRowsPerPageOption:function(){var b=
this.rowsPerPage,a=this.pageSizeOptions,c=this.paginationSizeSelect;c&&(0>E.indexOf(a,b)?this._setPageSizeOptions(a.concat([b])):c.value=""+b)},_setRowsPerPage:function(b){this.rowsPerPage=b;this._updateRowsPerPageOption();this.gotoPage(1)},_updateNavigation:function(b){function a(e){e=+e;!isNaN(e)&&0<e&&e<=l&&r.gotoPage(e)}function c(e,q){var y=!0;if(r.pagingTextBox&&e===m&&1<l)q=f.create("input",{"aria-label":p.jumpPage,className:"dgrid-page-input",type:"text",value:m},t),r._pagingTextBoxChangeHandle=
v(q,"change",function(){y&&a(+this.value);y=!0}),r._pagingTextBoxKeyPressHandle=v(q,"keypress",function(M){M.keyCode===I.ENTER&&(y=!1,a(+this.value))}),g&&"INPUT"===g.tagName&&q.focus();else{var w=e===m;q=f.create("span",{"aria-label":p.gotoPage,className:"dgrid-page-link"+(w?" dgrid-page-disabled":""),innerHTML:e+(q?" ":""),tabIndex:w?-1:0},t);z===e&&(w?e<l?z++:B.focus():q.focus());w||(B=q)}}function d(e,q){G.toggle(e,"dgrid-page-disabled",q);e.tabIndex=q?-1:0}function h(){f.create("span",{className:"dgrid-page-skip",
innerHTML:"..."},t)}var r=this,p=this.i18nPagination,t=this.paginationLinksNode,m=this._currentPage,k=this.pagingLinks,n=this.paginationNavigationNode,l=Math.ceil(b/this.rowsPerPage);b=this._pagingTextBoxKeyPressHandle;var u=this._pagingTextBoxChangeHandle,g=document.activeElement,z,B;g&&this.paginationNavigationNode.contains(g)?"dgrid-page-link"===g.className&&(z=+g.innerHTML):g=null;b&&b.remove();u&&u.remove();t.innerHTML="";x(".dgrid-first, .dgrid-previous",n).forEach(function(e){d(e,1===m)});
x(".dgrid-last, .dgrid-next",n).forEach(function(e){d(e,m>=l)});if(k&&0<l){c(1,!0);n=m-k;for(2<n?h():n=2;n<Math.min(m+k+1,l);n++)c(n,!0);m+k+1<l&&h();1<l&&c(l)}else r.pagingTextBox&&c(m);g&&-1===g.tabIndex&&(k=x('[tabindex\x3d"0"]',this.paginationNavigationNode),g===this.paginationPreviousNode||g===this.paginationFirstNode?g=k[0]:k.length&&(g=k[k.length-1]),g&&g.focus())},_updatePaginationStatus:function(b){var a=this.rowsPerPage,c=Math.min(b,(this._currentPage-1)*a+1);this.paginationStatusNode.innerHTML=
H.substitute(this.i18nPagination.status,{start:c,end:Math.min(b,c+a-1),total:b})},refresh:function(b){var a=this,c=b&&b.keepCurrentPage?Math.min(this._currentPage,Math.ceil(this._total/this.rowsPerPage)):1;this.inherited(arguments);return this.gotoPage(c).then(function(d){a._emitRefreshComplete();return d})},_onNotification:function(b,a,c){b=this.rowsPerPage;var d=this._currentPage*b;"add"===a.type&&a.index<d||"delete"===a.type&&a.previousIndex<d||"update"===a.type&&Math.floor(a.index/b)!==Math.floor(a.previousIndex/
b)?this.gotoPage(Math.min(this._currentPage,Math.ceil(a.totalLength/this.rowsPerPage))||1):c===this._renderedCollection&&a.totalLength!==this._total&&(this._updatePaginationStatus(a.totalLength),this._updateNavigation(a.totalLength))},renderQueryResults:function(b,a){var c=this,d=this.inherited(arguments);a||(this._topLevelRequest&&(this._topLevelRequest.cancel(),delete this._topLevelRequest),"function"===typeof d.cancel&&(this._topLevelRequest=d),d.then(function(){c._topLevelRequest&&delete c._topLevelRequest}));
return d},insertRow:function(){var b=this._oldPageNodes,a=this.inherited(arguments);b&&a===b[a.id]&&delete b[a.id];return a},gotoPage:function(b){var a=this,c=(this._currentPage-1)*this.rowsPerPage;if(!this._renderedCollection)return console.warn("Pagination requires a collection to operate."),J([]);this._renderedCollection.releaseRange&&this._renderedCollection.releaseRange(c,c+this.rowsPerPage);return this._trackError(function(){var d=a.rowsPerPage,h=(b-1)*d,r={start:h,count:d},p=a.contentNode,
t,m;if(a.showLoadingMessage)a._loadingCount++,L(a),a.loadingNode=f.create("div",{className:"dgrid-loading",innerHTML:a.loadingMessage},p);else{a._oldPageNodes=t={};p=p.children;var k=0;for(m=p.length;k<m;k++)t[p[k].id]=p[k]}a._isLoading=!0;var n=a._renderedCollection.fetchRange({start:h,end:h+d});return a.renderQueryResults(n,null,r).then(function(l){A(a);a.scrollTo({y:0});a._rows&&(a._rows.min=h,a._rows.max=h+d-1);n.totalLength.then(function(u){u||a._insertNoDataNode();a._total=u;a._currentPage=
b;a._rowsOnPage=l.length;a._updatePaginationStatus(u);a._updateNavigation(u)});return n},function(l){A(a);throw l;})})}})});