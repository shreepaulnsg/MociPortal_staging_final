//>>built
define("dojox/rpc/Rest",["dojo","dojox"],function(m,h){function p(c,e,a,f){c.addCallback(function(g){c.ioArgs.xhr&&a&&(a=c.ioArgs.xhr.getResponseHeader("Content-Range"),c.fullLength=a&&(a=a.match(/\/(.*)/))&&parseInt(a[1]));return g});return c}m.getObject("rpc.Rest",!0,h);h.rpc&&h.rpc.transportRegistry&&h.rpc.transportRegistry.register("REST",function(c){return"REST"==c},{getExecutor:function(c,e,a){return new h.rpc.Rest(e.name,(e.contentType||a._smd.contentType||"").match(/json|javascript/),null,
function(f,g){f=a._getRequest(e,[f]);f.url=f.target+(f.data?"?"+f.data:"");g&&(0<=g.start||0<=g.count)&&(f.headers=f.headers||{},f.headers.Range="items\x3d"+(g.start||"0")+"-"+("count"in g&&Infinity!=g.count?g.count+(g.start||0)-1:""));return f})}});var l=h.rpc.Rest=function(c,e,a,f){function g(b){k[b]=function(d,n){return l._change(b,k,d,n)}}var k=function(b,d){return l._get(k,b,d)};k.isJson=e;k._schema=a;k.cache={serialize:e?(h.json&&h.json.ref||m).toJson:function(b){return b}};k._getRequest=f||
function(b,d){m.isObject(b)&&(b=(b=m.objectToQuery(b))?"?"+b:"");if(d&&d.sort&&!d.queryStr){b+=(b?"\x26":"?")+"sort(";for(var n=0;n<d.sort.length;n++){var q=d.sort[n];b+=(0<n?",":"")+(q.descending?"-":"+")+encodeURIComponent(q.attribute)}b+=")"}b={url:c+(null==b?"":b),handleAs:e?"json":"text",contentType:e?"application/json":"text/plain",sync:h.rpc._sync,headers:{Accept:e?"application/json,application/javascript":"*/*"}};d&&(0<=d.start||0<=d.count)&&(b.headers.Range="items\x3d"+(d.start||"0")+"-"+
("count"in d&&Infinity!=d.count?d.count+(d.start||0)-1:""));h.rpc._sync=!1;return b};g("put");g("post");g("delete");k.servicePath=c;return k};l._index={};l._timeStamps={};l._change=function(c,e,a,f){a=e._getRequest(a);a[c+"Data"]=f;return p(m.xhr(c.toUpperCase(),a,!0),e)};l._get=function(c,e,a){a=a||{};return p(m.xhrGet(c._getRequest(e,a)),c,0<=a.start||0<=a.count,e)};return l});