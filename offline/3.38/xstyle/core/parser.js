//>>built
define("xstyle/core/parser",[],function(){function O(){this.push.apply(this,arguments)}function K(k){this.value=k}function U(){var k=this.args[0];if("string"==typeof k)var x=k.split(/\s*,\s*/);else if(k){x=[];for(var A=0,t=0;t<k.length+1;t++){var u=k[t];if("string"==typeof u||void 0===u)if(u=u&&u.split(/\s*,\s*/),1<x.length||void 0===u){var m=k.slice(A,t);0<A&&m.unshift(x.pop());A=t+1;x.push(m);u&&x.push.apply(x,u.slice(1))}}}else return[];return x}function P(k,x,A){function t(B,y){function L(l){D=
!1;var g=m.lastIndex;l.then(function(){D=!0;d&&(m.lastIndex=g,Q())});var d=!0}function Q(){function l(f){f&&"string"==typeof f&&E&&(f=E+f);b?b.push?"string"==typeof b[b.length-1]&&"string"==typeof f?b[b.length-1]+=f:f&&b.push(f):"string"==typeof b&&"string"==typeof f?b+=f:b=new O(b,f):b=f}for(D=!0;D;){var g=m.exec(B);if(!g)break;var d=g[5],E=g[1],e=g[2],c=g[3],q=g[4];q=q&&M(q);e=e&&M(e);if(C){if(c){var h=e;var n=c.charAt(0);var F="?"==c.charAt(1);-1<c.indexOf("\n")&&(q=c.slice(1))}else q=e;var b=
q;C=!1}else q=c?e+c:e,l(q);"{"!=d&&(p+=g[0]);switch(d){case "'":case '"':var G="'"==d?V:W;G.lastIndex=m.lastIndex;(d=G.exec(B))||v("unterminated string");e=d[1].replace(/\\([a-fA-F\d]{0,5}[ a-fA-F\d]?)/g,function(f,R){if(R)return String.fromCharCode(parseInt(R,16))});m.lastIndex=G.lastIndex;l(new K(e));p+=d[0];continue;case "\\":d=G.lastIndex++;l(B.charAt(d));continue;case "(":case "{":case "[":if("{"==d){C=!0;":"==n&&c&&(e+=c);e&&E&&(e=E+e);p=M((p+e).replace(/\s+/g," "));l(c=a.newRule(p));"\x3d"==
n&&(H=!1,b.creating=!0);var z=null,X=I;g[6]&&(q=y.cssRules||y.rules,c.cssRule=z=q[g[6].slice(1)])&&(p=z.selectorText);if(a.root&&H)for(q=y.cssRules||y.rules;z=q[I++];)if(z.selectorText==p||z.selectorText&&z.selectorText.replace(/::/g,":").replace(/'/g,'"')==p.replace(/::/g,":").replace(/'/g,'"')){c.cssRule=z;break}z||(c.ruleIndex=I=X);c.styleSheet=y;b.creating?(c.selector="."+("\x3d"==n?e.match(/[\w-]*$/g,"")[0]:"")+"-x-"+Y++,c.creating=!0):/^@(?!font-face)(?!FONT-FACE)/.test(p)?c.setMediaSelector(p):
c.selector=a.root?p:a.selector+" "+p;p=""}else e=q.match(/(.*?)([\w-]*)$/),l(c=a.newCall(e[2],b,a)),c.ref=a.getDefinition(e[2]),c.getArgs=U,(b.calls||(b.calls=[])).push(c);a.currentName=h;a.currentSequence=b;a.assignmentOperator=n;var J;"{"==d&&(J=c.selector.match(/[@:]\w+/))&&(J=J[0],(h=a.getDefinition(J))&&h.selector&&h.selector(c));r.push(a=c);a.operator=d;a.start=m.lastIndex;b=h=null;continue}if(b)if(e="string"==typeof b?b:b[0],e.charAt&&"@"==e.charAt(0))if(g=e.match(/\w+/)[0],"import"==g)e=P.getStyleSheet((y.cssRules||
y.imports)[I++],b,y),g=m.lastIndex,t(e.localSource,e),m.lastIndex=g;else{if("xstyle"==g){if("start"==e.slice(8,13))c=a?a.newRule(""):S,c.root=a.root,r.push(a=c);else{var S=a||S;r.pop();a=r[r.length-1]}m=a?u:/(@[\w\s])/g}}else if("\x3d"===n)try{var w=a.declareDefinition(h,b,F);w&&w.then&&L(w)}catch(f){v(f)}switch(d){case ":":"\x3d"==n?(C=!0,n=":"):l(":");break;case "}":if(h&&!a.root&&!a.isMediaBlock)try{a[":"==n?"setValue":"declareDefinition"](h,b,F)}catch(f){v(f)}case ")":case "]":Z[a.operator]!=
d&&v("Incorrect opening operator "+a.operator+" with closing operator "+d);h=null;h=B.slice(a.start,m.lastIndex-1);a.cssText=a.cssText?a.cssText+";"+h:h;if("}"==d){"}"==N&&(N=a.parent.selector)&&"@"==!N.charAt(0)&&v("A nested rule must end with a semicolon");if(a.root)v("Unmatched "+d);else{try{a.onRule(a.selector,a)}catch(f){v(f)}H=!0}p=""}if(")"==d||"]"==d)a.args=[b];if(")"==d&&!n){try{w=r[r.length-2].onArguments&&r[r.length-2].onArguments(a)}catch(f){v(f)}w&&w.then&&L(w)}r.pop();a=r[r.length-1];
b=a.currentSequence;h=a.currentName;n=a.assignmentOperator;if(a.root&&"}"==d){if(n)try{a[":"==n?"setValue":"declareDefinition"](h,b,F)}catch(f){v(f)}C=!0;n=!1}break;case "":case void 0:return;case ";":if(a&&h){try{(w=a[":"==n?"setValue":"declareDefinition"](h,b,F))&&w.then&&L(w)}catch(f){v(f)}h}b=null;C=!0;n=H=!1;p=""}var N=d}}function v(l){var g=B.slice(0,m.lastIndex).split("\n"),d=g[g.length-1];g=(y.href||"in-page stylesheet")+":"+g.length+":"+d.length+" near:\n"+d.slice(-40);if(t.onerror)t.onerror(l,
g);console.error(l.message||l,g);l.stack&&console.error(l.stack)}B=B.replace(aa,function(l){return l.replace(/[^\n]/g,"")});var a=k;m.lastIndex=0;var D,I=0,H=!0,p="",C=!0;Q()}A=A||{addRule:function(){},cssRules:[]};var u,m=u=/(\s*)((?:[^{\}\[\]\(\)\\'":=;]|\[(?:[^\]'"]|'(?:\\.|[^'])*'|"(?:\\.|[^"])*")\])*)([=:]\??\s*([^{\}\[\]\(\)\\'":;]*))?(?:([{\}\[\]\(\)\\'":;])(\/\d+)?|$)/g,r=[k];k.parse=t;t(x,A)}var V=/((?:\\.|[^'])*)'/g,W=/((?:\\.|[^"])*)"/g,aa=/\/\*[\w\W]*?\*\//g,Z={"{":"}","[":"]","(":")"},
Y=0,M="".trim?function(k){return k.trim()}:function(k){return k.replace(/^\s+|\s+$/g,"")},T=O.prototype=[];T.toString=function(){return this.join("")};T.isSequence=!0;K.prototype.toString=function(){return'"'+this.value.replace(/["\\\n\r]/g,"\\$\x26")+'"'};K.prototype.isLiteralString=!0;return P});