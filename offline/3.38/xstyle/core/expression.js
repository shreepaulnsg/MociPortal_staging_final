//>>built
define("xstyle/core/expression",["xstyle/core/utils","xstyle/core/Definition"],function(w,E){function F(c,e){var g=e[0];return g&&c?(g=J(g),F(c.property?c.property(g):c[g],e.slice(1))):c}function G(c,e,g){if(K(e,c)){var d={};d[c]=function(a){for(var k=[],f=0,n=e.length;f<n;f++){var b=e[f];b&&"function"==typeof b[c]&&(b=b[c](a));k[f]=b}return g(k)};return d}return g(e)}function A(c,e){return{apply:function(g,d,a){for(var k=0,f=d.length;k<f;k++){var n=d[k];n.dependencyOf&&n.dependencyOf(a)}k=function(){var b=
[];if(c.selfExecuting)return c.apply(g,d,a);for(var l=0,h=d.length;l<h;l++)b[l]=d[l].valueOf();if(c.selfWaiting)return c.apply(g,b,a);b.push(g);return w.whenAll(b,function(p){var t=p.pop();return G("forRule",p,function(v){return G("forElement",v,function(q){return c.apply(t,q,a)})})})};k.reverse=function(b){return e(b,d)};return k}}}function B(c){return H[c]||(H[c]=new Function("a","b","return "+c))}function m(c,e,g,d,a){function k(b){b.skipResolve=!0;b.precedence=e;b.infix=!1!==a}var f=function(b,
l){var h=l[0];l=l[1];if(h&&h.put)b=d(b,l&&l.valueOf()),b!==L&&h.put(b);else if(l&&l.put)l.put(a(b,h&&h.valueOf()));else throw new TypeError("Can not put");},n={apply:function(b,l,h){var p;g=B(g);d=d&&B(d);a=a&&B(a);u[c]=p=A(g,f);k(p);return p.apply(b,l,h)}};k(n);u[c]=n}function y(c,e){function g(p){for(;l<=p.precedence;){var t=f.pop(),v=u[f.pop()],q=new E;q.setCompute(v.apply(null,v.infix?[f.pop(),t]:[t],q));n=f.length?f[f.length-1]:void 0;f.push(q);l=n&&u[n]&&u[n].precedence}}var d;e=e.join?e.slice():
[e];for(d=0;d<e.length;d++){var a=e[d];if("string"==typeof a){var k=a.match(/"[^"]*"|[+\-<>\|\/\?:^*!&|]+|[\w_$\.\/-]+/g);a=[d,1];k&&a.push.apply(a,k);e.splice.apply(e,a);d+=a.length-3}}var f=[],n;k={};for(d=0;d<e.length;d++){a=e[d];if("("==a.operator){var b=f[f.length-1];void 0===b||u.hasOwnProperty(b)?a=y(c,a.getArgs()[0]):(f.pop(),a=function(p,t){function v(C){return w.when(p.valueOf(),function(r){var D=p.parent&&p.parent.valueOf();if(!r.selfResolving){if(!q){q=[];for(var z=0,M=t.length;z<M;z++)q[z]=
y(c,t[z]);I=r.selfReacting?r.apply(D,q,x):A(r).apply(D,q,x)}return I()}r=r.apply(D,t,x);return C?r:r.valueOf()})}var q,I,x=new E(v);x.setReverseCompute(function(){var C=arguments;return w.when(v(!0),function(r){return r.put.apply(r,C)})});return x}(b,a.getArgs()))}else if(u.hasOwnProperty(a)){b=u[a];g(b);var l=(n||b).precedence}else if(-1<a)a=+a;else if(a.isLiteralString)a=a.value;else{a=a.split(/\s*\/\s*/);b=a[0];var h=c.getDefinition(b);if("string"==typeof h||h instanceof Array)h=y(c,h);else if(void 0===
h)throw Error('Could not find reference "'+b+'"');k[b]=h;1<a.length&&(h=F(h,a.slice(1)));a=h}f.push(a)}g({precedence:100});if(1<f.length)throw Error("Could not reduce expression");a=f[0];a.inputs=k;return a}var J=w.convertCssNameToJs,K=w.someHasProperty,L={},H={},u={};m("+",6,"a+b","a-b","a-b");m("-",6,"a-b","a+b","b-a");m("*",5,"a*b","a/b","a/b");m("/",5,"a/b","a*b","b/a");m("?",16,"b[a?0:1]","a\x3d\x3d\x3db[0]||(a\x3d\x3d\x3db[1]?false:deny)","[a,b]");m(":",15,"[a,b]","a[0]?a[1]:deny","a[1]");m("!",
4,"!a","!a",!1);m("%",5,"a%b");m("\x3e",8,"a\x3eb");m("\x3e\x3d",8,"a\x3e\x3db");m("\x3c",8,"a\x3cb");m("\x3c\x3d",8,"a\x3c\x3db");m("\x3d\x3d",9,"a\x3d\x3d\x3db");m("\x26",8,"a\x26\x26b");m("|",8,"a||b");return{react:A,evaluate:y,selfResolving:function(c){c.selfResolving=!0;return c}}});